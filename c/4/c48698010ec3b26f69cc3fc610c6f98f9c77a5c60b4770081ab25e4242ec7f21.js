"use strict";function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}unction placeCaretAtEnd(e){if(e.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(e),o.collapse(!1),o.select()}}function setCaretPosition(e){var t=window.getSelection(),n=document.createRange();n.setStart(e.node,e.position),n.collapse(!0),t.removeAllRanges(),t.addRange(n)}function htmlImages(e,t,n){var o=0;return e.replace(/"[^"]*"|(https?:\/\/[^\/\s]+\/\S+\.(?:gif|jpe?g|tiff|png|svg|webp))\b/gi,function(e,t,i,r){return t?(o++,o<=n?'<a href="'+t+'" target="_blank"><img src="'+t+'" alt="" /></a>':t):e}).replace(/(?!")([a-z0-9]{24}\.(?:gif|jpg|jpeg|tiff|png|svg|webp))(?!")/gi,'<a href="'+t+'/file/$1" target="_blank"><img src="'+t+'/file/$1" alt="" /></a>')}function htmlContent(e,t){function n(e,n){return t?/(\.gif|jpg|jpeg|tiff|png|svg|webp)$/.test(n)?n:'<a href="'+n+'" class="gc-link" rel="nofollow" target="_blank">'+n+"</a>":n}return e.replace(/`{3}(<br \/>)?([\s\S]*?)`{3}(<br \/>)?/gm,"<pre>$2</pre>").replace(/`([\s\S]*?)`/gm,"<code>$1</code>").replace(/<div>/g,"").replace(/<\/div>/g,"<br />").replace(/((&lt;br\h{0,1}\/{0,1}\h{0,1}&gt;)|(\r\n|\n|\r))/g,"<br />").replace(/(\s*<br\s*\/>){3,}/g,"<br /><br />").replace(/&nbsp;/g,"").replace(/<a(?![^>]+href).*?>(.*?)<\/a>/g,"$1").replace(/$/," ").replace(/(https?:\/\/[^"<\s]+[^.<\s"()][-A-Za-z0-9+&@#\/%=~_|])(?![^<>]*>|[^"]*?<\/a)(?=\s|$)/gi,n)}function contains(e){if(!(0 in arguments))throw new TypeError("1 argument is required");do if(window===e)return!0;while(e=e&&e.parentNode);return!1}angular.module("gc.services",[]).constant("BASE_URL","https://graphcomment.com").constant("API_URL","https://graphcomment.com/api").constant("BO_URL","https://graphcomment.com/admin").constant("WS_URL","wss://graphcomment.com/websocket").constant("URL_SHORTENER","https://yak.li").constant("RECAPTCHA_PUBLIC_KEY","6LfeKZYUAAAAAFDIBvQRBB5W34niIuhCnARZWck0").constant("ORANGE_BASE_URL","https://graphcomment.orange.fr").constant("ORANGE_API_URL","https://graphcomment.orange.fr/api").constant("ORANGE_WS_URL","wss://graphcomment.orange.fr/websocket").constant("ORANGE_URL_SHORTENER","https://graphcomment.orange.fr/yakli").constant("DEFAULT_LANGUAGE","en").constant("APP_LANGUAGES",[{value:"en",label:"English"},{value:"fr",label:"Fran\xe7ais"},{value:"de",label:"Deutsch"},{value:"zh",label:"\u4e2d\u6587"},{value:"es",label:"Espa\xf1ol"},{value:"pt",label:"Portugu\xeas"},{value:"it",label:"Italiano"},{value:"cz",label:"\u010ce\u0161tina"},{value:"fa",label:"\u0641\u0627\u0631\u0633\u06cc"},{value:"he",label:"\u05e2\u05d1\u05e8\u05d9\u05ea"},{value:"ru",label:"\u0440\u0443\u0441\u0441\u043a\u0438\u0439"},{value:"vi",label:"Ti\u1ebfng vi\u1ec7t"},{value:"uk",label:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430"},{value:"tr",label:"T\xfcrk\xe7e"},{value:"ar",label:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629"},{value:"id",label:"Bahasa Indonesia"},{value:"hu",label:"Magyar"},{value:"ca",label:"Catal\xe0"},{value:"sv",label:"Svenska"},{value:"pl",label:"Polski"},{value:"nb",label:"Norsk Bokm\xe5l"}]),angular.module("gc.share",["gc.services"]).service("ShareService",["$rootScope","$http","$filter","URL_SHORTENER",function(e,t,n,o){function i(e,t,n){var o,i=document.createElement("a"),r=/(?:\?|&amp;|&)+([^=]+)(?:=([^&]*))*/g,a=[];for(i.href=e,t=encodeURIComponent(t);o=r.exec(i.search);)t!=o[1]&&a.push(o[1]+(o[2]?"="+o[2]:""));return a.push(t+(n?"="+encodeURIComponent(n):"")),i.search=a.join("&"),i.href}this.shortenUrl=function(e,n){var r=document.createElement("a");r.href=e,e.indexOf("url=")===-1&&(r.href=Utils.appendGetParam(r.href,"url=%2F"));var a=r.search.match(/(?:[\?|&])([^=]+)=([^&]+)/g).map(.reduce({}),e=a.url;e=i(e,"comment_id",n),e=i(e,"scroll_top","1");var c={url:o,method:"POST",data:{url:e},withCredentials:!1};return t(c).error(function(e){console.error(e)})},this.openShareWindow=function(t,o){var i;if("fb"===t)i="http://www.facebook.com/sharer/sharer.php?u="+o;else if("twitter"===t){var r=function(e){e=e.replace(/<br( \/)?>/gim,"\r\n");var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""},a=e.popinShare.profile,c=n("translate")("twitter share text",{url:o,content:"CONTENT",by:a&&a.twitter_username?n("translate")("by",{user:a.twitter_username}):""}),s=e.popinShare.comment,u=s.content;s.ecd?u=CommentService.ECD.getECDTitle(s._id):CommentService.title&&(u=CommentService.title);var s=r(u),l=n("truncate")(s,280-(c.length-"CONTENT".length));c=c.replace("CONTENT",l),i="http://twitter.com/intent/tweet?text="+encodeURIComponent(c)}else"linkedin"===t&&(i="https://www.linkedin.com/shareArticle?mini=true&url="+o+"&source=LinkedIn"+o);window.open(i,"Share","width=700,height=700")}}]),angular.module("services.comments",["gc.services","gc.user","gc.lang"]).service("CommentService",["$http","$log","$rootScope","$timeout","$filter","$q","getSearchParameters","Utils","LocalStorageService","ReadStatusService","API_URL","URL_SHORTENER","DEFAULT_LANGUAGE","APP_LANGUAGES","PostMessageService","$injector",function(e,t,n,o,i,r,a,c,s,u,l,d,m,p,f,g){unction v(e,t){return t._id?e[t._id]=t:e[t]=t,t.child_comments&&angular.isArray(t.child_comments)&&t.child_comments.reduce(v,e),e}function b(e,t){e.child_comments.forEach(function(t){if(!E.isMine(t)&&(t.is_read=u.isRead(t._id),t.is_new=!E._comments[t._id]&&E._comments[e._id]&&E._comments[e._id].child_comments_ids.indexOf(t._id)===-1||!t.is_read&&!E.isMine(t)&&E.isAfterLastVisit(t),t.is_new))for(var n=t;n.parent_id;){if(n=E._comments[n.parent_id],!n)return;n.has_new_replies=!0}}),e._id===t&&w(e),e.child_comments.forEach(function(e){b(e)})}function w(e){E._comments[e._id]?(e.child_comments.forEach(function(t,n){E._comments[t._id]&&(e.child_comments[n]=E._comments[t._id])}),angular.extend(E._comments[e._id],e)):E._comments[e._id]=e}function y(e){e.top_voters=c.topVoters(e,!0),e.votes_count=c.votesCount(e,!0)}function C(e,t){y(e),e.count_child||(e.count_child=0),e.child_comments.forEach(function(e){w(e),t&&C(e,!0)}),w(e)}function S(e){for(var t in E._comments)if(E._comments[t]._id===e)return E._comments[t];return!1}function k(){var e=g.get("GcUser"),t=e.getGuest(),n=e.getUser();return t?{email:t.email,username:t.username}:n?{_id:n._id,depth:n.loading_depth===-1?null:n.loading_depth+2}:void 0}function $(e,t){0!==e&&(t.active=!0,t.child_comments&&0!==t.child_comments.length&&$(e-1,t.child_comments[0]))}function P(){var e=(E.website.loading_depth||DEFAULT_DEPTH)-1,t=g.get("GcUser").getUser();return t&&"undefined"!=typeof t.loading_depth&&t.loading_depth!==-1&&(e=t.loading_depth+1),e}function U(e,t){var n=new RegExp(t,"g"),o=e.content.replace(n,'<span class="gc-selected-search-word">'.concat(t,"</span>"));return e.content=o,e.isSearch=!0,e}function x(e){return e=e.replace(/\\n/g," <br/>"),e=e.replace(/(<br\s?\/?>)+$/g,""),e=e.replace(/<div>/gi,"<br>").replace(/<\/div>/gi,""),e=e.replace(/<a[^<]+href="(\S+)"[^<]*><img[^<]+src="(\S+)"[^<]*><\/a>/gi,"$1"),e=e.replace(/<code>(.*)<\/code>/gi,"$1"),e=e.replace(/<pre>(.*)<\/pre>/gi,"$1"),e=e.replace(new RegExp(l+"/file/","g"),"")}var E=this,L=!1;this.lastVisit=s.getItem("last_visit_"+c.getUniqueUrlIdentifier());var R=moment().subtract(1,"hour");this.lastVisit&&!moment(this.lastVisit).isBefore(R)||s.setItem("last_visit_"+c.getUniqueUrlIdentifier(),(new Date).toISOString()),E.computeVotes=y,this._comments={},this.comments=[],this.ecd=[],this.thread_id="",this.website_id="",this.url="",this.website="",E.retrieveComment=S,this.updateCachedUser=function(e,t){function n(t,o,i){i.forEach(function(i){i&&i.author&&i.author._id===t&&angular.extend(i.cached_author,o),n(e,o,i.child_comments)})}var o=g.get("GcUser");o.updateKnownUserField(e,t);var i={username:t.username,picture:t.picture};void 0!==i.picture&&(i.picture+="#"+Math.floor(1e3*Math.random()+1)),n(e,i,this.comments)},this.getWebsite=function(o){return e.get(l+"/pub/website/"+o).success(function(e){if(E.website=e,n.website=e,n.sso_direct_link=null,n.isOrange="orange"===e.custom_client,t.debug("website",e),E.website.searchActive=!1,e.graphcomment&&e.graphcomment.search_motor&&(E.website.searchActive=e.graphcomment.search_motor.active),e.count_per_page===Number.MAX_VALUE&&(e.count_per_page=Number.POSITIVE_INFINITY),e.first_load_count===Number.MAX_VALUE&&(e.first_load_count=Number.POSITIVE_INFINITY),e.sso&&e.sso.active&&e.sso.login_redirect&&!e.sso.unidirectional){var o=e.sso.link;c.inApp()?n.sso_direct_link=c.appendGetParam(o,"gc_url="+encodeURIComponent(window.location.href)):n.sso_direct_link=c.appendGetParam(o,"gc_url="+encodeURIComponent(c.getParameterByName("url")||window.location.href))}e.languages||(e.languages=p.map(function(e){return e.value})),E.website.edition||(e.edition={link:!0,upload:!0,formatting:!0,emoticons:!0}),e.theme||(e.theme="auto"),"undefined"==typeof e.embeded_files&&(e.embeded_files=1),"undefined"==typeof e.embeded_external_link&&(e.embeded_external_link=1),n.$broadcast("website",e)})},this.init=function(e){var t=window.location.origin+window.location.pathname,n=a();return this.page=0,this.title=decodeURIComponent(n.title)||"gcmt",this.url=decodeURIComponent(n.url)||t,this.identifier=decodeURIComponent(n.identifier)||"main",this.uid=decodeURIComponent(n.uid),this.guid=decodeURIComponent(n.guid),this.category=decodeURIComponent(n.category),this.publication_date=decodeURIComponent(n.publication_date),this.lifetime=decodeURIComponent(n.lifetime),this.website_id=n.website_id||"dev-site-graphcomment",this.ecd=[],E.commentsAdded=0,e.force_sort=!1,this.getThread(e)},this.getThread=function(o){o=o||{};g.get("GcUser").getUser();o.force_sort="undefined"==typeof o.force_sort||o.force_sort,o.comment_id&&delete o.offset,this.currentThreadRequest&&this.currentThreadRequest.resolve(),this.currentThreadRequest=r.defer();var i={url:l+"/thread?sort="+n.sorting+(o.force_sort?"&force_sort=true":""),method:"POST",timeout:this.currentThreadRequest.promise,data:{website_id:this.website_id,url:this.url,uid:this.uid,guid:this.guid,category:this.category,publication_date:this.publication_date,lifetime:this.lifetime,identifier:this.identifier,page_title:this.title,loading_depth:o.bbf3d===!0?3:this.website.loading_depth,parent_id:o.parent_id,offset:o.offset,limit:o.limit,user:k(),comment_id:o.comment_id}};return E.offset=o.offset,E.limit=o.limit,e(i).success(function(e){if(o.parent_id){var t=e.child_comments[0],i=E.comments.find(function(e){return e._id===t._id});return i.child_comments=t.child_comments,void C(i,!0)}var r;return E.comments.length&&e.child_comments.forEach(function(e){E.comments.find(function(t){return t._id===e._id})||(r=!0)}),E.comments.length&&!r||E.page++,E.ecd=e.ecd,E.thread=e,E.thread_id=e._id,E.isLocked=e.is_locked,E.total_comments=e.count_comments,u.setThreadId(E.thread_id),n.$broadcast("thread",e),e.child_comments.forEach(function(e){o.comment_id||$(P(),e),b(e),C(e,!0)}),E.getPopulate(e.child_comments)}).error(function(e){e&&e.type&&"404"===e.type?t.error("The website id "+opts.website_id+" has not been created yet"):e&&t.error(e),"orange"===E.website.custom_client&&n.spupLog("[spup] thread error: "+JSON.stringify(e))})},this.getPopulate=function(e){e=e||E.comments;var t=n.yakli&&n.yakli.pos>E.offset;e.forEach(function(e,n){E.comments.find(function(t){return t._id===e._id})||E.comments.splice(n+(t?0:E.offset)+E.commentsAdded,0,e)}),n.gcReady=!0,L||(n.$broadcast("gc:ready"),L=!0),n.$broadcast("thread-stats")},this.getSearch=function(t){var n={page:1,limit:10},o=Object.assign(n,t);return e({url:l+"/thread/"+E.thread_id+"/search/comments/",method:"GET",params:o}).success(function(e){E.search_comments=[],e.comments.forEach(function(e){E.search_comments.push(U(e,o.search))})})},this.countComments=function(){var t=a();if(!t.website_id)return{success:function(){}};var n=l+"/pub/numberOfComments?website="+t.website_id;return n+="&url="+encodeURIComponent(t.url),t.uid&&(n+="&uid="+encodeURIComponent(t.uid)),t.guid&&(n+="&guid="+encodeURIComponent(t.guid)),e.get(n)},this.reset=function(){E.page=0},this.waitForWebsite=function(e){E.website?(e(E.website),n.spupLog("[spup] has website",!!E.website)):n.$on("website",function(t,o){n.spupLog("[spup] website fetched",!!o),e(o)})},this.waitForThread=function(e){E.thread?e(E.thread):n.$on("thread",},this.resetAll=function(){E.page=0,E.comments=[],E._comments={}},this.getCustomImage=function(){if(E.website&&E.website.plan&&E.website.custom&&E.website.custom.image)return E.website.custom.image},this.initDataVote=function(e){function t(n){for(var o in n){if(n[o].rating={has_voted:!1,vote_rate:0},void 0!==e&&null!==e&&(!n[o].author||n[o].author._id!==e._id)){var r=i("filter")(n[o].voters,{user:e._id.toString()});void 0!==r&&r.length>0&&(n[o].rating.has_voted=!0,n[o].rating.vote_rate=r[0].score)}n[o].child_comments&&n[o].child_comments.length>0&&t(n[o].child_comments)}}function o(n){n.forEach(function(n){if(n.rating={has_voted:!1,vote_rate:0},void 0!==e&&null!==e&&(!n.author||n.author._id!==e._id)){var o=i("filter")(n.voters,{user:e._id.toString()});void 0!==o&&o.length>0&&(n.rating.has_voted=!0,n.rating.vote_rate=o[0].score)}n.child_comments&&n.child_comments.length>0&&t(n.child_comments)})}n.searchMode||(t(this._comments),o(this.comments))},this.hasAlreadyVoted=function(e,t){return!(!e||!t)&&e.voters.some(},this.addMessage=function(t){var n;t.content=x(t.content),t.rating={has_voted:!1,vote_rate:0};var o=g.get("GcUser"),i=o.getGuest();return n=l+"/thread/"+this.thread_id+"/"+(i?"guest/":"")+"comment/"+(t.parent_id||""),t.parent_id?mixpanel.track("comment:reply"):mixpanel.track("comment:post"),e.post(n,t).success(function(e){t.parent_id?E._comments[t.parent_id].count_child++:E.comments.unshift(e),E._comments[e._id]=e,f.postMessage("gc-new-comment",e),this.removeSavedComment()}).error(function(e){h(e)})},this.updateMessage=function(t){var n,o=angular.extend({},t);return o.content=x(o.content),o.rating={has_voted:!1,vote_rate:0},n=l+"/thread/"+this.thread_id+"/comment/"+t._id,mixpanel.track("comment:edit"),e.put(n,o).success(function(e){delete e.child_comments,angular.extend(t,e),E._comments[e._id]=e}).error(function(e){h(e)})},this.voteOnComment=function(o,i,r){var a={url:l+"/thread/"+this.thread_id+"/comment/vote/"+o._id,method:"POST",data:{score:i,boost:r}};return n.$broadcast("comment:vote"),e(a).error(h).then(function(e){return e.data.err&&t.warn("you have already voted"),o.voters=e.data.voters,o.score=e.data.score,y(o),e.data.result&&(o.result=e.data.result),e.data})},this.remove=function(t,n){var o=g.get("GcUser");if(o.getUser()&&o.getUser().can_moderate)var i={method:"POST",url:l+"/website/"+this.website._id+"/thread/"+(t.thread._id||this.thread_id)+"/comment/"+t._id+"/deleted",data:{motif:t.motif,motif_id:t.motif_id}};else var i={method:"DELETE",url:l+"/comment/"+t._id};return e(i).success(function(e){if(delete e.child_comments,angular.extend(t,e),"deleted_by_user"!==e.content)if(n){var o=n.child_comments.findIndex(function(e){return e._id===t._id});n.child_comments.splice(o,1),n.count_child--}else{var o=E.comments.findIndex(function(e){return e._id===t._id});E.comments.splice(o,1)}})},this.disapprove=function(t){return e.post(l+"/website/"+this.website._id+"/thread/"+this.thread_id+"/comment/"+t._id+"/disapprove",{motif:t.motif,motif_id:t.motif_id}).success(function(e){t.status=e.status})},this.report=function(t,n){return e({method:"POST",url:l+"/thread/"+this.thread_id+"/comment/"+t._id+"/offense",data:n})},this.signalAsSpam=function(t,n){return e({method:"POST",url:l+"/website/"+this.website._id+"/thread/"+this.thread_id+"/comment/"+t._id+"/markspam"}).success(function(){this.remove(t,n)}.bind(this))},this.setSort=function(t){return e.put(l+"/thread/"+this.thread_id+"/sort",{sort:t})},this.isBan=function(t){return e.post(l+"/website/"+this.website._id+"/isban",t)},this.ban=function(t){return e.post(l+"/website/"+this.website._id+"/ban",t)},this.unban=function(t){return e.put(l+"/website/"+this.website._id+"/ban",t)},this.loadChildrenWithParentId=function(o,i,a){var c=l+"/thread/"+this.thread_id+"/load-comment/"+i+"?sort="+n.sorting,s={depth:a||2,clicked_id:o._id,user:k()};g.get("GcUser");return this.currentLoadChildrenRequest&&this.currentLoadChildrenRequest.resolve(),this.currentLoadChildrenRequest=r.defer(),e({method:"POST",timeout:this.currentLoadChildrenRequest.promise,url:c,data:s}).success(function(e){function n(e,t){var n=!1;return e.every(function(e){return e._id!==t._id||(n=e,!1)}),n}b(e,o._id),e.child_comments.forEach(function(e){e._id===o._id&&C(e,!0)});var r=S(i),a=[],c=!1;r.child_comments.every(function(t,o){return n(e.child_comments,t)!==!1?t._id===e.child_comments[o]._id||(a.length>0&&(c=n(a,e.child_comments[o]))!==!1?(a.push(t),r.child_comments[o]=c,E._comments[c._id]=c,!0):(a.push(r.child_comments[o]),r.child_comments.every(function(t,n){return e.child_comments[o]._id!==t._id||(r.child_comments[o]=r.child_comments[n],E._comments[r.child_comments[n]._id]=r.child_comments[n],!1)})===!0&&(r.child_comments[o]=e.child_comments[o],E._comments[e.child_comments[o]._id]=e.child_comments[o]),!0)):(r.child_comments.splice(o,1),!0)});for(var s=r.child_comments.length;s<e.child_comments.length;s++)a.length>0&&(c=n(a,e.child_comments[s]))!==!1?(r.child_comments[s]=c,E._comments[c._id]=c):(r.child_comments[s]=e.child_comments[s],E._comments[e.child_comments[s]._id]=e.child_comments[s]);t.debug(r)}).error(h)},this.getUserObject=function(t){return e({url:l+"/users/show/"+t+"?website="+this.website_id,method:"GET"})},this.getComment=this.getLastComments=function(t){return e.get(l+"/thread/"+this.thread_id+"/last-comments?from_date="+t.toISOString())},this.getUserInfos=function(t){return e.get(l+"/website/"+this.website._id+"/show/"+t)},this.getUserComments=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"date",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return e({url:l+"/users/comments/"+t+"?&website_id="+this.website._id+"&page="+n+"&limit="+i+("date"===o?"":"&"+o+"=true"),method:"GET"}).success(},this.populate=function(t){var o={url:l+"/thread/populate/"+t+"?sort="+n.sorting,method:"GET"};return e(o).success(function(e){E._comments[e._id]=e,y(e),E._comments=e.child_comments.reduce(v,E._comments);var o=null;E.statsMap.hasOwnProperty(e._id)&&(e.comments=E.statsMap[e._id].comments,e.participants=E.statsMap[e._id].participants);var i=E._comments[t];for(i.active=!0;i.parent_id;)i=E._comments[i.parent_id],i.active=!0;E.comments.some(,n.$broadcast("collapse:anything:else",{depth:0,rootId:null}),E.commentsAdded++,n.searchMode||(null!==o?E.comments[o]=angular.extend({},E.comments[o],e):E.comments.push(angular.extend({},e)))}).error(h).then(function(e){return e.data})},this.totalComments=function(){for(var e=0,t=0;t<this.comments.length;t++)e+=this.comments[t].comments||0;return e},this.getRootComment=function(e){var t=this._comments[e];if(void 0!==t){if(!t.parent_id)return t;for(t||console.error("comment %s not found",e);t.parent_id;){var n=t.parent_id;t=this._comments[n],t||console.error("comment %s not found (from %s)",n,e)}return t}},this.recursiveFind=function(e,t){return e.child_comments.find(function(e){return e._id===t?e:E.recursiveFind(e,t)})},this.getLastChildComment=function(e){return e.child_comments.length?this.getLastChildComment(e.child_comments[0]):e},this.getThreadStats=function(t){return e.get(l+"/thread/"+E.thread_id+"/countComments").success(function(e){E.total_comments=e,t=t||E.comments,t.forEach(;var o=n.yakli&&n.yakli.pos>E.offset;t.forEach(function(e,t){E.comments.find(function(t){return t._id===e._id})||E.comments.splice(t+(o?0:E.offset)+E.commentsAdded,0,e)}),n.gcReady=!0,L||(n.$broadcast("gc:ready"),L=!0),n.$broadcast("thread-stats")})},this.hasMoreComments=function(){return!!this.thread&&this.offset+this.limit<this.thread.total_root_comments},this.addFile=function(t){var n=new FormData;return n.append("file",t),e.post(l+"/thread/"+E.thread_id+"/add_file",n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).error(},this.getNumberOfHostedFiles=function(e){if(!e)return 0;var t=_.unique(e.match(/(?=[\s])?([a-z0-9]{24}\.(?:gif|jpg|jpeg|tiff|png|svg|webp))(?=[\s])?/gi));return t?t.length:0},this.pin=function(t){e.post(l+"/website/"+this.website._id+"/thread/"+E.thread_id+"/comment/"+t._id+"/pinned").success(function(e){t.pinned=e.pinned})},this.getSelectedECD=function(){var e=[];return function t(n){n.forEach(function(n){n.editor_choice===!0&&e.push(n),n.child_comments&&n.child_comments.length>0&&t(n.child_comments)})}(this.comments),e},this.cancelSelectedECD=function(){!function e(t){t.forEach(function(t){t.editor_choice===!0&&(t.editor_choice=!1),t.child_comments&&t.child_comments.length>0&&e(t.child_comments)})}(this.comments)},this.isAfterLastVisit=this.isMine=function(e){var t=g.get("GcUser"),n=t.getUser(),o=t.getGuest();return!(!e.author||!n||n._id!==e.author._id)||!(!e.cached_author||!o||o.email!==e.cached_author.email)},this.append=function(e){var t=E._comments[e.parent_id];if(t&&!t.child_comments.find(function(t){return t._id===e._id})){e.is_new=!0,w(e);for(var o=e;o.parent_id&&(o=E._comments[o.parent_id]);)o.has_new_replies=!0;n.lastCommentOpened!==t._id||t.child_comments.length||(n.$emit("comment:"+t._id+":setChildComment",e),n.lastCommentOpened=e._id),t.child_comments.unshift(e),t.child_comments_ids.unshift(e._id)}},this.setSavedComment=function(e,t){s.setItem("gc_saved_comment_"+this.thread_id,{content:e,parent_id:t&&t._id})},this.getSavedComment=this.removeSavedComment=function(e){s.removeItem("gc_saved_comment_"+this.thread_id),e&&n.$broadcast("reset_write_comment")},this.postSavedComment=function(){var e=this.getSavedComment();e&&(this.removeSavedComment(!0),setTimeout(function(){this.addMessage(e).then(function(t){e.parent_id&&n.$broadcast("comment:"+e.parent_id+":setChildComment",t.data)})},1e3))},this.ECD={},this.ECD.getECDTitle=function(e){var t=E.ecd.find(;if(t)return t.title},this.ECD.pushECD=function(t,n){var o=l+"/thread/"+E.thread_id+"/ecd",i={title:t,comments:n};return e.post(o,i).success(function(e){E.ecd=e.ecd}).error(h)},this.ECD.updateECD=function(t,n,o){var i=l+"/thread/"+E.thread_id+"/ecd/"+t;e.put(i,{title:n}).success(function(e){return o(e)}).error(h)},this.ECD.deleteECD=function(t,n){var o=l+"/thread/"+E.thread_id+"/ecd/"+t;e["delete"](o).success(function(e){return n(e)}).error(h)},this.ECD.selectAllTree=function(e){function t(e,n,o){var i=E._comments[e.parent_id];i&&(i.editor_choice=n,o&&o._id===i._id||i.parent_id&&t(i,n,o))}function n(e,t){var o=E._comments[e.parent_id];return!(!o||o._id!==t._id)||!(!o||!o.parent_id)&&n(o,t)}var o=JSON.parse(JSON.stringify(E.getSelectedECD()));0===o.length?(e.editor_choice=!0,t(e,!0)):e.editor_choice===!0?(e.editor_choice=!1,o.length>1&&e._id!==o[o.length-1]._id&&t(e,!1)):(e.editor_choice=!0,n(e,o[0])?t(e,!0,o[0]):t(o[0],!0,e))}}]),angular.module("service.GcECD",["pascalprecht.translate"]).factory("GcECD",["$rootScope","$translate","$log","CommentService","LocalStorageService",function(e,t,n,o,i){var r={ecd_editorial_mode:i.getItem("ecd_mode")||!1};return e.$on("logged_in",function(e,t){"admin"!==t.role&&(r.ecd_editorial_mode=!1)}),e.$on("logged_out",function(){r.ecd_editorial_mode=!1,r.switchEditorialMode(!1),r.cancelECD()}),r.toggleEditorialMode=r.switchEditorialMode=function(e){this.ecd_editorial_mode=e,i.setItem("ecd_mode",this.ecd_editorial_mode),this.ecd_editorial_mode||r.cancelECD()},r.editorialMode=function(t){e.ecd_creation_mode?e.$broadcast("editorial",{activate:!1,comment:t}):e.$broadcast("editorial",{activate:!0,comment:t}),e.ecd_creation_mode=!e.ecd_creation_mode},r.validateECD=function(){if(0!==o.getSelectedECD().length){var t=angular.copy(o.getSelectedECD());t.forEach(function(e){e.active=!1,e.child_comments=[],e.parent_id=null}),o.ecd.push({new_mode:!0,comments:t,title:""}),mixpanel.track("ecd:added"),e.$emit("scrollTo",".gc-body"),o.cancelSelectedECD()}},r.cancelECD=function(){e.$broadcast("editorial",{activate:!1}),e.ecd_creation_mode=!1,o.cancelSelectedECD()},r.editECD=function(e,t){e.stopPropagation(),t.edit_mode=!0,t.old_title=t.title},r.onKeypress=function(e,t){13===e.keyCode&&t.title&&t.title.length>2&&r.saveECD(t)},r.saveECD=function(e){e.new_mode?r.addECD(e):e.edit_mode&&r.updateECD(e),mixpanel.track("ecd:saved")},r.addECD=function(t){t.new_mode=!1;var n=[];t.comments.forEach(function(e){e.user_picture=e.cached_author.picture||"/images/avatar_3.png",n.push({user_picture:e.user_picture,comment:e._id})}),o.ECD.pushECD(t.title,n),e.$broadcast("editorial",{activate:!1}),e.ecd_creation_mode=!1},r.updateECD=function(e){e.edit_mode=!1,e.old_title!==e.title&&o.ECD.updateECD(e._id,e.title,function(e){console.log(e)})},r.deleteECD=function(n){n.new_mode?(o.ecd.pop(),e.$broadcast("editorial",{activate:!1}),e.ecd_creation_mode=!1):n.edit_mode&&t("ecd delete confirm").then(function(e){confirm(e)&&(o.ECD.deleteECD(n._id,,mixpanel.track("ecd:deleted"))})},r}]),angular.module("gc.user",["gc.services","angular-jwt","gc.localstorage"]).factory("GcUser",["$http","$rootScope","$q","$log","$window","$timeout","API_URL","CommentService","PostMessageService","Utils","jwtHelper","LocalStorageService",function(e,t,n,o,i,r,a,c,s,u,l,d){var m={website_id:u.getParameterByName("website_id")||"dev-site-graphcomment"},p={},f=null,g=null,h=0,v="en",_=a+"/users",b=window.location.hostname.indexOf("orange.fr")!==-1;m.init=function(t){var n=d.getItem("guest");n&&m.setGuest("object"===_typeof(n)?n:JSON.parse(n)),c.website.sso.active&&c.website.sso.unidirectional||this.checkTokenInUrl();var o={method:"GET",url:_+"/me?website="+this.website_id+"&plateform=front"};setTimeout(function(){return e(o).then(function(e){e.data.gcCode&&410===e.data.gcCode?(m.setUser(null),d.removeToken(),d.removeItem("gc_user"),t()):(m.setUser(e.data),m.canModerate(e.data),t(e.data))})},1e3)},m.setUser=function(e){f=e,Raven&&Raven.setUserContext(e),t.gcUser=e,t.gcUserHasPrivileges=m.hasPrivileges(),t.gcUserIsAdmin=m.isOwner()||m.isAdministrator(),window.parent&&s.postMessage("gc-user-data",{user:e}),null===e?(b||Sentry.captureMessage("User.setUser broadcast logout"),t.$broadcast("logged_out",null)):(t.$broadcast("logged_in",f),t.$broadcast("user:change",f))},m.canModerate=function(t){e({method:"GET",url:a+"/users/website/"+this.website_id+"/can_moderate"}).success(},m.addKnownUser=m.getKnownUser=function(e){return p[e]},m.updateKnownUserField=m.setUserPicture=function(e){f.picture=e+"?"+Math.floor(1e3*Math.random()+1),m.setUser(f),m.updateCachedUser({picture:e})},m.addNotification=function(e){h+=1,f.notifications.unshift(e)},m.getNotifications=m.getUnreadNotifications=function(){return h},m.markNotificationsAsRead=function(){h=0,e.get(a+"/notifications/mark_as_read").success(function(e){m.setUser(e)}).error(function(e){o.error(e)})},m.getUser=function(){return f},m.refresh=function(n,i){function r(e){if(!e.gcCode||410!==e.gcCode){var n=e;return o.debug("user: ",n),m.setGuest(null),m.canModerate(n),m.setUser(n),n.profile_found||"orange"!==c.website.custom_client&&t.$broadcast("profile-popin:open",n._id,{fromMenu:!0}),a(null,n)}}var a=s=null;return"function"==typeof n?a=n:n&&(s=n,"function"==typeof i&&(a=i)),s&&this.setToken(s),e({method:"GET",url:_+"/me?website="+this.website_id+"&plateform=front"}).success(r).error(},m.setToken=function(e){var t=e;return"JWT"!==t.substring(0,"JWT".length)&&(t="JWT "+t),window.parent&&s.postMessage("gc-token",{gcToken:t}),d.setToken(t)},m.getToken=function(){return d.getToken()},m.isLocallyLogged=m.setGuest=function(e){d.setItem("guest",e),g=e,Raven&&Raven.setUserContext(e),t.gcGuest=e,e&&t.$broadcast("logged_in",{})},m.getGuest=m.isGuest=m.logout=function(e){"slave"===u.getParameterByName("auth")?s.postCommand("logout"):this.oldLogout(e);
},m.oldLogout=function(e){m.setUser(null),m.setGuest(null),d.removeToken(),d.removeItem("gc_user"),b||Sentry.captureMessage("User.logout broadcast logout "),t.$broadcast("logged_out",null),t.orangeUser=null,!e&&mixpanel.track("auth:logout"),s.postMessage("gc-token",{gcToken:null}),i.parent.postMessage(JSON.stringify({onLogout:!0}),"*"),s.postMessage("logged-out",{})},m.checkTokenInUrl=function(){var e=u.getParameterByName("token");e&&m.refresh(e,function(e,n){if(e)throw e;o.debug("Social Login [ New user: ",n," ]"),mixpanel.track("auth:social_(unknown)_success"),t.$emit("scrollTo",0);var i=u.removeUrlParameter(window.location.href,"token");window.location.href=i})},m.login=function(t,n,o){return e.post(o||_+"/login",{username:t,password:n,website:c.website._id}).then(function(e){var t=e.data.token;return!t&&e.data.datas&&(e.data.datas.token&&(t=e.data.datas.token),i.parent.postMessage(JSON.stringify({onLogin:e.data.datas}),"*")),m.refresh(t)})},m.register=function(t,n,i,r){var a=new FormData;return a.append("username",t),a.append("password",n),a.append("email",i),a.append("picture",r),a.append("website",c.website._id),a.append("language",window.navigator.userLanguage||window.navigator.language),a.append("_url",u.getParameterByName("url")||window.location.href),e({url:_+"/registerData",method:"post",headers:{"Content-Type":void 0},data:a}).success(},m.initSpup=function(e){if(t.spupLog("[spup] initSpup()"),t.orangeUser&&m.isLocallyLogged())if(t.orangeUser.id!==-1||m.getUser()){if(t.spupLog("[spup] check multi-account"),t.orangeUser.name===m.getUser().pseudo)return t.spupLog("[spup] everything is fine",t.orangeUser,m.getUser()),!0;t.spupLog("[spup] disconnect (mutli-account)",t.orangeUser,m.getUser()),m.logout(!0),r(function(){m.initSpup(e)},0)}else{t.spupLog("[spup] user not authenticated");var n=t.$on("spup_registered",function(){t.spupLog("[spup] user not authenticated ... done"),e(),n()});window.parent.postMessage({target:"spup",command:"create",params:[]},"*")}else{t.spupLog("[spup] no spup user");var n=t.$on("spup_registered",function(){t.spupLog("[spup] no spup user ... done"),e(),n()});window.parent.postMessage({target:"spup",command:"get",params:[!1]},"*")}},m.registerSpup=function(n){t.spupLog("[spup] registerSpup()");var o=new FormData;return o.append("uid",n.id),o.append("name",n.name),o.append("email",n.email),o.append("avatar",n.avatar["142x142"]),o.append("status",n.status.global),e({url:_+"/loginAndOrRegisterByUidAndEmail/website/"+c.website._id,method:"post",headers:{"Content-Type":void 0},data:o}).success(function(e){return t.spupLog("[spup] register",e),m.refresh(e.token,})},m.hasSpupCookie=m.sso=function(n,o){var i=u.getParameterByName("api_public_key");if(n&&i)return e({method:"post",url:a+"/users/sso/loginAndOrRegisterByUid/website/"+c.website._id,headers:{Authorization:void 0},data:{key:{pubKey:i,auth:n}}}).success(function(e){m.ssoDone=!0,m.setToken(e.token),m.init(o)}.bind(this)).error(function(e){e.err&&"pseudo already exist, please change your pseudo"===e.err&&(t.ssoConflict=!0,t.ssoConflictUsername=e.username,d.removeToken(),s.postMessage("gc-sso-conflict"),console.error("[gc] SSO: "+e.err),m.ssoDone=!0,m.init(o))}.bind(this))},m.isGuestBanned=function(){var t=m.getGuest();if(t){var n="?email="+encodeURIComponent(t.email)+"&username="+encodeURIComponent(t.username);return e.get(a+"/ban/guest/website/"+c.website._id+n)}},m.resetPass=function(t){return e.post(_+"/reset_password",{email:t,lang:document.documentElement.lang||"navigator"in window&&window.navigator.language||"en"})},m.updateCachedUser=m.update=function(t,n,i){var r=new FormData;for(var a in t)"_id"!==a&&r.append(a,t[a]);return r.append("_url",u.getParameterByName("url")||window.location.href),e({url:_+"/update",method:"post",headers:{"Content-Type":void 0},data:r,uploadEventHandlers:{progress:function(e){i&&i(Math.round(100*e.loaded/e.total))}}}).success(function(e){return e.profile_found=!0,m.setUser(e),m.updateCachedUser(e),n(null,e)}).error(function(e){o.debug("update error",e);var t=e.err||e.msg||e.gcErr;return t=t?~t.indexOf("email empty or null")?"email empty":~t.indexOf("email bad format")?"email bad format":~t.indexOf("email already exist")?"email already exist":~t.indexOf("bad_extension")||~t.indexOf("ETOOBIG")?"wrong profile picture":~t.indexOf("username already exist")?"username already used":~t.indexOf("pseudo already exist")?"pseudo already used":~t.indexOf("bio too long")?"bio too long":"error":"error",n(t,null)})},m.resendToken=function(){return e.post(_+"/resend_token",{_url:u.getParameterByName("url")||window.location.href,website:c.website._id})},m.validEmail=function(t,n,o){return e.post(_+"/verify_email",{token:n,email:t,website:c.website._id}).success(function(e){return m.setUser(e),o(null,e)}).error(function(e){return e&&e.msg?o(e.msg,null):o("internal error",null)})};var w,y=[];return m.getDefaultAvatars=function(){return w||(w=!0,e.get(_+"/default_avatars").success(function(e){angular.merge(y,e.avatars)})),y},m.getPreferedLanguage=function(){return null===f?v:f.lang},m.hasPrivileges=m.isSuperAdmin=m.isOwner=function(){return f&&f._id===c.website.owner},m.isAdministrator=function(){return f&&c.website.administrators&&c.website.administrators.indexOf(f._id)!==-1},m.isModerator=function(){return f&&c.website.moderators&&c.website.moderators.indexOf(f._id)!==-1},m.cancelEmailValidation=function(){return e.post(_+"/reset_validation").success(function(e){m.setUser(e)})},m.sendRecoTo=function(t){return e.post(_+"/notifications/reco/to/"+t+"/website/"+c.website._id)},m.canSendRecoTo=function(t){return e.get(_+"/notifications/check/reco/to/"+t+"/website/"+c.website._id)},m}]),angular.module("gc.focus",[]).service("FocusService",["$document","$timeout",function(e,t){var n,o;this.focusActivated=this.getFocusId=this.activate=function(t){n=t,o=e[0].getElementById("comment-"+t),e.on("mousedown",this.detectClickOutside)},this.desactivate=function(){t(0),e.off("mousedown",this.detectClickOutside)},this.detectClickOutside=function(e){$(e.target).closest(".gc-profile-wrapper").length||$(e.target).closest(".list-menu-item-editor").length||o&&e.target!==o&&!o.contains(e.target)&&(e.preventDefault(),this.desactivate())}.bind(this),e.on("click",this.detectClickOutside.bind(this))}]),angular.module("gc.sliders",[]).service("SliderService",["$rootScope","$document","$window","$timeout","$interval",function(e,t,n,o,i){function r(){if(c=t[0].querySelector(".gc-slider")){var e=window.innerWidth<500,n=window.innerWidth-25,o=Math.min(c.getBoundingClientRect().width,n),i=o-2*(e?22:32)-(e?125:145),r=c.querySelector(".gc-slider-item");if(s.avatarWidth=r&&r.getBoundingClientRect().width||32,s.maxVisibleAvatar=Math.floor(i/s.avatarWidth),s.maxVisibleAvatar=Math.min(s.maxVisibleAvatar,20),isNaN(s.maxVisibleAvatar))throw"[GcError] maxVisibleAvatar is Nan: ".concat(c.getBoundingClientRect().width," ").concat(s.avatarWidth)}}function a(){o(function(){r()},100,!0)}var c,s=this;this.avatarWidth=0,this.maxVisibleAvatar=1,this.computeNbVisibleAvatar=r,this.init=function(){e.$on("gc:ready",function(){angular.element(n).on("resize",a),o(function(){r()},0),i(function(){r()},1e3)})}}]),angular.module("gc.readstatus",["gc.services"]).service("ReadStatusService",["$rootScope","LocalStorageService",function(e,t){unction o(){t.setItem(i(),c)}ar r=null,a=null,c=null;this.setThreadId=e.$on("logged_in",function(t,n){a=n._id,c=null,e.$broadcast("read:refresh","logged_in")}),e.$on("logged_out",function(){var t=null!==a;a=null,t&&(c=[],o()),e.$broadcast("read:refresh","logged_out")}),this.isRead=function(e){return null===c&&(c=n()||[]),"string"==typeof c&&(c=JSON.parse(c)),c.indexOf(e)!==-1},this.markAsRead=function(e){this.isRead(e._id)||(c.push(e._id),o())}}]),angular.module("gc.lang",["pascalprecht.translate"]).service("LanguageUtils",["$window","$translate","$rootScope","$log","GcUser","CommentService",function(e,t,n,o,i,r){function a(e){if(n.lang!==e){document.documentElement.lang=e,n.lang=e,t.use(e).then(;var o=e;"zh"===o&&(o="zh-cn"),"cz"===o&&(o="cs"),moment.locale(o),"he"===e||"fa"===e||"ar"===e?(n.rtl=!0,document.documentElement.dir="rtl"):(n.rtl=!1,document.documentElement.dir="ltr")}}function c(){if("all"!==t.instant("all"))return $("body").addClass("translations-loaded"),!0}c();var s=setInterval(100);window.gcSetLang=a,this.init=this.getBrowserLanguage=function(){var t={browser:""},n=["language","browserLanguage","systemLanguage","userLanguage"].some(function(t){var n=e.navigator[t];return!!(n&&n.length>0)&&(o.debug("browser language : ",n),this.browser=n,!0)},t);if(n){var i=t.browser.slice(0,2);return i}},this.updateUILanguage=function(){var e,t=i.getUser(),n=r.website.languages;n&&(t&&n.indexOf(t.language)!==-1?(o.debug("gcLang take user language : ",t.language),e=t.language):n.indexOf(this.lang)!==-1?(o.debug("gcLang take page language : ",this.lang),e=this.lang):(o.debug("gcLang take the default language : ",n[0]),e=n[0]),a(e))},this.getUserLanguage=function(){return t.use()}}]),angular.module("gc.localstorage",[]).service("LocalStorageService",["Utils",function(e){function t(){return"slave"===e.getParameterByName("auth")}var n=null;this.getItem=function(e){return store.get(e)},this.setItem=this.removeItem=function(e){store.remove(e)},this.getToken=function(){return t()?n:this.getItem("gc_token")},this.setToken=function(e){return t()&&(n=e),this.setItem("gc_token",e)},this.removeToken=function(){return t()&&(n=null),this.removeItem("gc_token")},Cookies.remove("gc_token")}]),angular.module("gc.ga",[]).service("GoogleAnalyticsService",function(){this.init=function(){!window,document,"script","dataLayer","GTM-T2W4NVG")}}),angular.module("gc.pub",[]).service("PubService",["$http","BASE_URL",function(e,t){this.sendAudience=function(n){return e.get(t+"/api/pub/has_read_comments/thread/".concat(n))}}]),angular.module("gc.perfs",[]).service("Perfs",[function(){var e={};return{init:measure:done:function(){e.render=(new Date).getTime();var t=e.start,n=e.render,o=["debug perfs:"],i=0;for(var r in e)if("start"!==r){var a=e[r]-t-i,c=Math.round(a/(n-t)*100);o.push("- "+r+": "+a+"ms ("+c+"%)"),i=e[r]-t}window.debugPerfs=}}]),angular.module("gc.emoticon",[]).service("EmoticonService",["$window",function(e){function t(){if(!e.document.createElement("canvas").getContext)return!1;var t=e.document.createElement("canvas").getContext("2d");if("function"!=typeof t.fillText)return!1;var n=String.fromCharCode(55357)+String.fromCharCode(56899);try{t.textBaseline="top",t.font="32px Arial",t.fillText(n,0,0)}catch(o){return!0}return 0!==t.getImageData(16,16,1,1).data[0]}ar o="https://twemoji.maxcdn.com/2/svg/%%code_point%%.svg",i="([\ud83c-\ud83e][\udc00-\udfff]|[#-9]\ufe0f?\u20e3|\u2639|\ue50a|\u27b0|\u2797|\u2796|\u2795|\u2755|\u2754|\u2753|\u274e|\u274c|\u2728|\u270b|\u270a|\u2705|\u26ce|\u23f3|\u23f0|\u23ec|\u23eb|\u23ea|\u23e9|\u27bf|\xa9|\xae|(\u3299|\u303d|\u3030|\u2b55|\u2b50|\u2b1c|\u2b1b|\u2b07|\u2b06|\u2b05|\u2935|\u2934|\u27a1|\u2764|\u2757|\u2747|\u2744|\u2734|\u2733|\u2716|\u2714|\u2712|\u270f|\u270c|\u2709|\u2708|\u2702|\u26fd|\u26fa|\u26f5|\u26f3|\u26f2|\u26ea|\u26d4|\u26c5|\u26c4|\u26be|\u26bd|\u26ab|\u26aa|\u26a1|\u26a0|\u2693|\u267f|\u267b|\u3297|\u2666|\u2665|\u2663|\u2660|\u2653|\u2652|\u2651|\u2650|\u264f|\u264e|\u264d|\u264c|\u264b|\u264a|\u2649|\u2648|\u263a|\u261d|\u2615|\u2614|\u2611|\u260e|\u2601|\u2600|\u25fe|\u25fd|\u25fc|\u25fb|\u25c0|\u25b6|\u25ab|\u25aa|\u24c2|\u231b|\u231a|\u21aa|\u21a9|\u2199|\u2198|\u2197|\u2196|\u2195|\u2194|\u2139|\u2122|\u2049|\u203c|\u2668)([\ufe0e\ufe0f]))",r=new RegExp(i,"g"),a=new RegExp('<img class="emoji" draggable="false" alt="'+i+'" src="https[^"]*.svg"[^>]*>',"g"),c=this;this.supportsEmoticons=t(),this.emoticonToImageUrl=function(e){var t=n(e);return t=t.replace("-fe0f",""),o.replace("%%code_point%%",t)},this.emoticonToImgElement=function(t){var n=e.document.createElement("img");return n.className="emoji",n.draggable=!1,n.alt=t,n.src=this.emoticonToImageUrl(t),n},this.emoticonToImage=this.replaceHtmlImgByUnicode=this.replaceUnicodeByHtmlImg=]).filter("emoticonsFallback",["EmoticonService",function(e){return function(t,n,o){return e.supportsEmoticons?t:e.replaceUnicodeByHtmlImg(t)}}]),angular.module("gc.utils",[]).service("Utils",["$window","$document","$q","$translate","$injector",function(e,t,n,o,i){var r,a,c={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(r in c)if(r in document){a=c[r];break}return{iOS:function(){return"undefined"==typeof this._isIOS&&(this._isIOS=/iPad|iPhone|iPod/.test(e.navigator.userAgent)&&!e.MSStream),this._isIOS},isMobile:function(){return"undefined"==typeof this._isMobile&&(this._isMobile=/iPhone|iPad|iPod|Android|BlackBerry|Opera Mini|IEMobile|WPDesktop/i.test(e.navigator.userAgent)),this._isMobile},inApp:isFacebookApp:isProd:inIframe:inOverlay:appendGetParam:function(e,t){return e.indexOf("?")===-1?e+"?"+t:e+"&"+t},removeHash:function(e){return e.replace(/#.*$/,"")},getCookieValue:stripAttributes:getParameterByName:function(e){if(this._paramCache||(this._paramCache={}),"undefined"!=typeof this._paramCache[e])return this._paramCache[e];e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"(?:=([^&#]*))?"),n=t.exec(location.search),o=null===n?void 0:!n[1]||decodeURIComponent(n[1].replace(/\+/g," "));return this._paramCache[e]=o,o},removeUrlParameter:function(e,t){var n=e.split("?");if(n.length>=2){for(var o=encodeURIComponent(t)+"=",i=n[1].split(/[&;]/g),r=i.length;r-- >0;)i[r].lastIndexOf(o,0)!==-1&&i.splice(r,1);return n[0]+(i.length>0?"?"+i.join("&"):"")}return e},hash:function s(e){var t,n,s=0;if(0===e.length)return s;for(t=0;t<e.length;t++)n=e.charCodeAt(t),s=(s<<5)-s+n,s|=0;return s},getUniqueUrlIdentifier:function(){return this.hash(this.getParameterByName("url")+this.getParameterByName("identifier"))},getScrollPosition:function(){if(this.inOverlay()){var e=$(".gc-body").offset();return{top:-e.top,left:-e.left}}var n=t[0],o=t[0].documentElement;return{top:window.pageYOffset||o.scrollTop||n.body.scrollTop||0,left:window.pageXOffset||o.scrollLeft||n.body.scrollLeft||0}},preloadImage:function(e){var t=n.defer(),o=new Image;return o.onload=o.onerror=function(){t.reject()},o.src=e,t.promise},appendScript:function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)},appendStyle:voteIcon:function(e){var t={};if(t[-3]='<span class="gcicon-rulesviolation"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span></span>',t[-2]='<span class="gcicon-troll"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span></span>',t[-1]='<span class="gcicon-offtopic"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span></span>',t[0]="",t[1]='<span class="gcicon-like"><span class="path1"></span><span class="path2"></span><span class="path3"></span></span>',t[2]='<span class="gcicon-target"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span></span>',t[3]='<span class="gcicon-diamond"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span></span>',t[e])return t[e]},filterOutTrolls:function(e){var t=i.get("GcUser").getUser();return e.filter(function(e){return!(e.score_received<=-.6&&e.score<=-2&&(!t||t._id!==e.user))})},filterOutShadowVotes:function(e){var t=i.get("GcUser").getUser();return e.filter(function(e){if(e.visible===!1){if(!t)return!1;if(t._id!==e.user)return!1}return!0})},getVoters:function(e,t){if(e.voters&&e.voters.length>0){var n=e.voters.filter(;return n=this.filterOutShadowVotes(n),t&&(n=this.filterOutTrolls(n)),n}return[]},topVoters:function(e,t){var n=[],o=this.getVoters(e,t);if(0===o.length)return"";if(CommentService.website.votes_discreet){var r=0;return o.forEach(function(e){r+=e.score>0?1:0}),r<=0?"":this.voteIcon(1)+" "+r}var a=o.map(function(e){return e.score}).reduce(function(e,t){return e[t]=(e[t]||0)+1,e},{}),n=[];for(var c in a)n.push({name:Number(c),count:a[c]});var s=i.get("GcUser").getUser();if(!s){var u=n.find(function(e){return e.name===-2}),l=u?u.count:0,d=o.length,m=100*l/d;if(l>0&&m<=30){var p=n.findIndex(function(e){return e.name===-2});n.splice(p,1)}}n.sort(function(e,t){return t.count-e.count}),n=n.slice(0,3);var f=n.map(function(e){return this.voteIcon(e.name)+" "}.bind(this)).join("");return f+='<span class="count">'+o.length+"</span>"||""},votesCount:function(e,t){function n(e){return e>999?(e/1e3).toFixed(1)+"k":e}var i=[],r=this.getVoters(e,t),a=r.map(function(e){return e.score}).reduce({}),i=[],c=0;for(var s in a)i.push({name:s,count:n(a[s])}),c+=a[s];if(!i.length)return"";i.sort(;var u='<span class="all">'+o.instant("all")+" ("+c+")</span> ";return u+=i.map(function(e){return this.voteIcon(e.name)+' <span class="count">'+e.count+"</span> "}.bind(this)).join("")},pageVisible:isScrolledIntoView:function(e,t,n){var o=t.getBoundingClientRect(),i=o.top,r=o.bottom;return n?i<window.innerHeight&&r>=0:i>=0&&r-o.height<=e.offsetHeight}}}]),angular.module("gc.postmessage",[]).service("PostMessageService",["Utils",function(e){this.postMessage=function(t,n){var o=e.getParameterByName("pid")||0;window.parent.postMessage({name:t,data:n,pid:o},"*")},this.postCommand=function(e,t){window.parent.postMessage({type:"__semiologic__COMMAND__semiologic__",command:e,data:t},"*")}}]),angular.module("gc.notifs",[]).service("Notifs",["$rootScope","$http","API_URL","WS_URL","WS","CommentService","GcUser",function(e,t,n,o,i,r,a){return{notifs:[],init:function(t){a.getUser()&&(t&&this.connect("ready"),this.fetch()),e.$on("logged_in",function(e,n){this.notifs=[],n._id&&(t&&this.connect("reconnect"),this.fetch())}.bind(this))},onMsg:function(t){if(t.msg){if(this.notifs.find(function(e){return e._id===t.msg._id}))return;this.notifs.unshift(t.msg),e.$broadcast("notif",t.msg)}},onOpen:function(e){var t=this,n=a.getUser(),o=r.website._id;n&&t.send(JSON.stringify({joinUser:o+n._id}))},connect:function(e){console.debug("WS connect",e);i.create(this.onMsg.bind(this),this.onOpen)},fetch:function(){return t.get(n+"/users/notifications/website/"+r.website._id+"?page_size=300").success(function(e){e.gcCode||(this.notifs=e.notifications||[])}.bind(this))},updateViews:function(e){return t.put(n+"/users/notifications/website/"+r.website._id,{ids:e.join(",")}).success(function(){for(var t=0;t<e.length;t++)this.notifs.find(function(n){return n._id===e[t]}).view=!0}.bind(this))}}}]),angular.module("gc.ws",[]).service("WS",["$rootScope","WS_URL",function(e,t){return{create:function(e,n){console.debug("WS connect");var o=new WebSocket(t);return o.onerror=function(e){console.error("WS error",e)},o.onclose=function(t){console.debug("WS close",t.code,t.reason,t.wasClean),clearTimeout(this.reconnectTimeout),this.reconnectTimeout=setTimeout(bind(this),5e3)}.bind(this),o.onmessage=function(t){try{var n=JSON.parse(t.data)}catch(o){return void console.error("unable to parse WS event",t.data)}e(n)}.bind(this),o.onopen=n,o}}}]),angular.module("gc.recaptcha",[]).service("RecaptchaService",["$http","API_URL",function(e,t){this.getCode=function(){return e({method:"GET",url:t+"/captcha/"})},this.validate=function(n){return e({method:"POST",url:t+"/captcha/",data:n})}}]),angular.module("gc.auth-popin",["gc.services"]).constant("gc.popup.version","1.2").controller("AuthPopinController",["$scope","$element","$rootScope","$window","$document","$log","$timeout","BASE_URL","API_URL","BO_URL","Utils","GcUser","LanguageUtils","PostMessageService","CommentService",function(e,t,n,o,i,r,a,c,s,u,l,d,m,p,f){function g(){e.show=!1}function h(){e.splashStart||(e.splashStart=!1,a(function(){e.splashStart=!0},500))}function v(){e.splashStart=!1}function _(t){var i=n.$on("logged_in",function(){w.close(),e.show=!1,i()});e.websiteId=e.website?e.website._id:null;var a=e.ssoEnabled()?e.website.sso[t]+"?origin_url="+l.getParameterByName("url"):s+"/users/"+t+"?from_website="+e.websiteId;if(r.debug("popupUrl",a),l.inApp()||l.isFacebookApp()){if(a+="&redirect=true",l.getParameterByName(t+"_redirect_after_login"))a+="&redirect_after_login="+encodeURIComponent(l.getParameterByName(t+"_redirect_after_login"));else if(l.inIframe()){var c=l.removeHash(l.getParameterByName("url"));a+="&redirect_after_login="+encodeURIComponent(c)}else a+="&redirect_after_login="+encodeURIComponent(window.location.href);l.inIframe()?window.top.location.href=a:window.location.href=a}else w=window.open(a,"GraphComment Social Login","width=700,height=700");o.socialPopupClose=function(e){r.debug("socialPopupClose()"),w&&w.close(),d.refresh(e,function(e,n){e||(r.debug("Social Login [ New user: ",n," ]"),mixpanel.track("auth:social_"+t+"_success"))})}}var b,w;e.BASE_URL=c,e.user={},e.data={},e.page,e.recoverUrl=u+"/#forgot/",e.data.language=m.getBrowserLanguage(),e.showPage={back:function(t){t&&t.preventDefault(),e.prevPage?e.showPage[e.prevPage]():e.showPage.signin()},signin:function(t){t&&t.preventDefault(),e.prevPage=e.page,e.page="signin",e.showLink="signup",v(),mixpanel.track("auth:signin_show")},signup:function(t){t&&t.preventDefault(),e.prevPage=e.page,e.page="signup",e.showLink="signin",h(),e.conflicted_username=null,e.conflicted_email=null,mixpanel.track("auth:signup_show")},signupEmail:function(t){t&&t.preventDefault(),e.prevPage=e.page,e.page="signupEmail",e.showLink="signin",h(),e.conflicted_username=null,e.conflicted_email=null,mixpanel.track("auth:signup_email_show")},guest:function(t){t&&t.preventDefault(),e.prevPage=e.page,e.page="guest",e.showLink="signin",h(),mixpanel.track("auth:guest_show")},resetPass:function(t){t&&t.preventDefault(),e.prevPage=e.page,e.page="resetPass",e.showLink="signup",v(),mixpanel.track("auth:reset_pass_show")}},e.popinStyle={},n.$on("show:popup",function(t,o){if("slave"===l.getParameterByName("auth"))switch(o.page){case"signin":return void p.postCommand("login");case"signup":return void p.postCommand("signup")}if(e.website=f.website,e.website.sso.active&&e.website.sso.login_redirect){var i=e.website.sso.link;return void(l.inApp()?(i=l.appendGetParam(i,"gc_url="+encodeURIComponent(window.location.href)),window.location.href=i):(i=l.appendGetParam(i,"gc_url="+encodeURIComponent(l.getParameterByName("url")||window.location.href)),p.postMessage("gc-redirect",{url:i})))}if(n.ssoUnidirectionalEnabled())return void p.postMessage("gc-sso-auth");if(e.show=!0,!e.showPage[o.page])throw'GcPopup: page "'+o.page+'" not found';if(e.ssoEnabled()&&"signin"!==o.page&&(o.page="signin"),e.showPage[o.page](),o.data&&(e.data=o.data),e.customImage=f.getCustomImage(),e.websiteId=e.website?e.website._id:null,e.logins=e.website.login.order.slice().filter(,e.hasSocialLogins="email"!==e.logins[0],h(),o.target){var r=o.target.getBoundingClientRect(),a=r.top;a+=o.offset||0,a=Math.max(0,a)}else var a=0;e.popinStyle={top:(l.inIframe()?a:0)+40+"px"}}),e.ssoEnabled=function(){return e.website.sso&&e.website.sso.unidirectional===!1&&e.website.sso.active},e.signin=function(){e.err=null;var t=e.ssoEnabled()&&e.website.sso.link;return e.website.sso.active&&e.website.sso.login_redirect?(t=l.appendGetParam(t,"gc_url="+window.location.href),void(window.location.href=t)):void d.login(e.user.username,e.user.password,t).then(function(){g(),r.log("Logged in",d.getUser().username),mixpanel.track("auth:signin_success")},function(t){401===t.status?e.err="bad credentials":e.err="server error"})},e.signup=function(){e.signupErr=null,e.signupConflictedUsername=null,e.signupConflictedEmail=null,d.register(e.data.username,e.data.password,e.data.email,e.data.avatar).then(function(t){mixpanel.track("auth:signup_email_success"),mixpanel.alias(t.data._id),d.login(e.data.username,e.data.password).then(function(){g(),r.log("Logged in",d.getUser().username)},function(){e.err="server error"})},function(t){var n=t.data;n&&n.err&&(n.err.indexOf("username already used")!==-1?e.signupConflictedUsername=e.data.username:n.err.indexOf("email already used")!==-1?e.signupConflictedEmail=e.data.email:e.signupErr="unknown error")})},e.forms={},e.submitGuest=function(){e.forms.fGuest.$invalid||(d.setGuest({username:e.data.username,email:e.data.email}),g(),mixpanel.track("auth:guest_success"),e.$apply())},window.onGuestFormSubmit=e.submitGuest.bind(e),e.resetPass=function(){e.resetPassUserNotFound=null,d.resetPass(e.user.email).then(function(t){t.data&&t.data.err&&"user_not_found"===t.data.err&&(e.resetPassUserNotFound=t.data.msg)})},e.loginWith=function(e){r.debug("loginAndWatch("+e+")"),mixpanel.track("auth:social_"+e+"_show"),_(e)},e.overlayClick=function(t){t.target.classList.contains("gc-popin-wrapper")&&e.cancelAndClose()},e.openRegisterPopup=function(){var t=n.$on("logged_in",,i=e.website.sso.register;i=l.appendGetParam(i,"gc_url="+window.location.href),w=window.open(i,"Register","width=700,height=700"),o.socialPopupClose=function(e){r.debug("socialPopupClose()",e),w.close(),d.refresh(e,function(e,t){e||(r.debug("Social Login [ New user: ",t," ]"),mixpanel.track("auth:social_"+provider+"_success"))})}},e.onAvatarUpload=function(t){var n=t.target.files;if(n&&n.length){var o=new FileReader;o.onload=function(t){e.avatarSrc=t.target.result,e.$apply()},o.readAsDataURL(n[0])}},e.cancelAndClose=function(){mixpanel.track("auth:cancel"),n.$broadcast("auth:cancel"),g(),b&&clearInterval(b),w&&w.close()}}]).directive("authPopin",["$document","$timeout","$sce","$translate","$rootScope",function(e,t,n,o,i){return{restrict:"E",replace:!0,scope:!0,templateUrl:"authPopin.html",controller:"AuthPopinController",controllerAs:"popup",bindToController:!0,link:function(t,n){e.on("keyup.gc-auth",,t.$on("$destroy",}}}]),angular.module("gc.ban-popin",["gc.services"]).directive("banPopin",["$rootScope","$window","$timeout","CommentService","LocalStorageService",function(e,t,n,o,i){return{restrict:"E",replace:!0,scope:{user:"=",callback:"&"},templateUrl:"banPopin.html",link:function(t,r,a){function c(){var e=moment();switch(t.banData.date.range){case"1 day":e.add(1,"day");break;case"1 week":e.add(1,"week");break;case"2 weeks":e.add(2,"weeks");break;case"custom":e.add(t.banData.date.custom.count,t.banData.date.custom.type);break;case"permanently":return null;default:throw"unknown date range ".concat(t.banData.date.range)}return e.toDate()}t.website=o.website,t.isGuest=!t.user._id,t.activeBanTab=i.getItem("ban-tab")||"permanent-ban",t.banData="object"===_typeof(i.getItem("ban-data"))?i.getItem("ban-data"):{account:!t.isGuest,email:t.isGuest,reason_id:0,date:{range:"1 day",custom:{count:"1",type:"hour"}}},t.close=function(){e.banPopinVisible=!1,e.banPopinUser=null},t.overlayClick=function(e){e.target.classList.contains("gc-popin-wrapper")&&t.close()},t.submit=function(){"free"===t.website.rights&&"permanent-ban"!==t.activeBanTab||["pseudo","email","ip","account"].forEach(function(e){if(("ip"!==e||t.user.ip)&&("account"!==e||!t.isGuest)){var i="account"===e?null:t.user[e];"pseudo"!==e||i||(i=t.user.username),o["account"===e||t.banData[e]?"ban":"unban"]({type:e,element:i,user:"account"===e?t.user:null,reason:t.banData.reason,reason_id:t.banData.reason_id,hide_ban_message:t.banData.hide_ban_message,permanent:"permanent-ban"===t.activeBanTab,shadow:"shadow-ban"===t.activeBanTab,date_start:"temporary-ban"===t.activeBanTab?new Date:null,date_end:"permanent-ban"!==t.activeBanTab?c():null}).then(function(){"account"===e&&n(function(){t.close(),t.callback()()},1e3)})}})},t.setBanTab=t.$watch("banData",function(){var e=angular.copy(t.banData);e.reason_id=0,delete e.reason,i.setItem("ban-data",e)},!0)}}}]),angular.module("GraphCommentModule",["services.comments","gc.user","gc.share","gc.perfs","gc.auth-popin","gc.ban-popin","gc.ng-repeat-done","gc.profile-popin","ui-rangeSlider","service.GcECD","ng"]).constant("version","0.1").constant("TMP_ID","XXXXtmpID").controller("GraphcommentController",["$scope","$element","$rootScope","$log","$http","$location","$timeout","$document","$translate","$filter","GcUser","BASE_URL","CommentService","ShareService","SliderService","FocusService","LanguageUtils","LocalStorageService","GoogleAnalyticsService","PubService","API_URL","Perfs","Utils","PostMessageService","Notifs","WS",function(e,t,n,o,i,r,a,c,s,u,l,d,m,p,f,g,h,v,b,w,y,C,S,k,P,U){function x(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=o.offset||0,r=o.timeout||0,c=o.skipFocus||!1;if(!m._comments[t])return void console.error("comment %s not found, %s comments",t,m.comments.length);var s,u=_createForOfIteratorHelper(m.comments);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(l._id===t)break;n.$emit("embeds:load:"+l._id)}}catch(d){u.e(d)}finally{u.f()}a(function(){a(function(){var o=$("#comment-"+t);i=i||0,i+=o.offset().top,e.$emit("scrollTo",i-n.fixedHeaderHeight),console.debug("[gc] scroll comment %s %s px","#comment-"+t,i)},0),a(function(){if(!c){angular.element(document.body).removeClass("no-transition");var e=m.getRootComment(t);g.activate(e._id),n.$emit("yakli-link-scroll-done")}},1800)},r)}function E(){var e=S.getParameterByName("readonly");
return!!e&&"false"!==e}function L(){s(["sort by relevance","oldest","newest"]).then(function(t){D={relevance:t["sort by relevance"],oldest:t.oldest,newest:t.newest},e.sortingLabel=D[e.sorting]})}function R(t){if(!n.newComments.find(function(e){return e._id===t._id})){if(t.parent_id){if(a(function(){m.append(t)}),n.newComments.find(function(e){return e._id===t.parent_id}))return;if(S.getParameterByName("disable_live_replies")&&"false"!==S.getParameterByName("disable_live_replies"))return}if(m._comments[t._id]&&"pending"===m._comments[t._id].status&&"approved"===t.status&&(m._comments[t._id].status=t.status),m._comments[t._id])return;var o=l.getUser();if(o&&t.author&&o._id===t.author._id)return;var i=l.getGuest();if(i&&t.guest&&i.email===t.cached_author.email)return;n.autoOpenNewComments&&"newest"===e.sorting?(t.isNew=!0,t.isShown=!0,m.comments.unshift(t)):n.newComments.unshift(t),m._comments[t._id]=t,m.total_comments++,"newest"===e.sorting&&e.computeLastCommentRead()}}window.CommentService=m,window.Utils=S,f.init(),n.ecd_creation_mode=!1,n.fixedHeaderHeight=0,n.votePopin={},n.iframeScroll={pos:{top:0,left:0},win:{width:0,height:0}},n.isWidget=S.getParameterByName("widget")&&"true"===S.getParameterByName("widget"),n.Utils=S,e.GcUser=l,e.voteIcon=S.voteIcon,n.searchMode=!1,e.searchClass="",n.disableTrackingOnLogout=!1,n.getMotifs=function(){for(var e={},t=0;t<=24;t++)e[t]=s.instant("motif_"+t);return e[99]=s.instant("motif_99"),e},n.getWebsiteLang=e.mainColorClass={};var A;e.isSortHelpActive=!1,e.toggleSortHelp=e.enterSortHelp=function(){A=a(function(){e.isSortHelpActive=!0,c.on("mouseover",function(t){t&&t.stopPropagation();var n=document.querySelector(".gc-help-sort-content");n&&n.contains(t.target)||(c.off("mouseout"),a(function(){e.isSortHelpActive=!1},20,!0))})},50,!0)},e.leaveSortHelp=e.countPerPage=0,e.showGuestPopup=function(e){e.preventDefault();var t=l.getGuest();n.$broadcast("show:popup",{page:"guest",data:{username:t&&t.username,email:t&&t.email}})},e.showSigninPopup=function(e){n.$broadcast("show:popup",{page:"signin",target:e.target})},e.showSignupPopup=e.manageSpupPseudo=function(){n.spupLog('[spup] click "manage pseudo"');var e=m.website;e.custom_client_login===!0&&window.parent.postMessage({target:"spup",command:"manage",params:[]},"*")};var I=[],T=n.spupLog=function(){m.website&&"orange"===m.website.custom_client&&(console.log.apply(console,arguments),I.push(Array.prototype.slice.call(arguments)))};e.debugSpup=function(){e.spupPopinOpen=!0;var t=["browser: "+window.navigator.userAgent,"OS: "+window.navigator.platform,"spup user: "+JSON.stringify(n.orangeUser),"graphcomment user: "+JSON.stringify(l.getUser()),"graphcomment version: "+window.gcVersion,"-------------","informations for the developper:",""];return I.forEach(function(e){t.push(e.map(.join("\r\n"))}),t.join("\r\n")},e.sendSpupReport=function(t,n){var o=$(".spup-report-number");t=t||o.val(),/^gc?[0-9]+$/.test(t)?(o.removeClass("ng-invalid").addClass("ng-valid"),i.post(d+"/api/pub/sendSupportEmail",{content:e.debugSpup(),ticketNumber:t}).success(function(t){mixpanel.track("orange:spup_report"),n||alert(s.instant("spup report success")),e.spupPopinOpen=!1})):(alert(s.instant("spup report error")+" "+t),o.removeClass("ng-valid").addClass("ng-invalid"))},e.selectLogs=function(){var e=t.find(".gc-popin--spup pre")[0],n=document.createRange();n.selectNodeContents(e);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)},e.closeSpupPopin=function(){e.spupPopinOpen=!1},n.$on("thread",function(t,o){var i=m.website;"orange"===i.custom_client&&a(function(){var t=!0;T("[spup] register event listeners");var o=window.addEventListener("message",function(e){if(!o(e.origin))return void console.error("Origine non autoris\xe9e:",e.origin);var t=e.data;if(t.source&&"spup"===t.source){var n=window["on"+t.event.charAt(0).toUpperCase()+t.event.slice(1)];"function"==typeof n&&n.apply(window,[t.data])}},!1),window.onCreated=function(e){T("[spup][created] event received",e),n.orangeUser=e,n.orangeUser&&n.orangeUser.id!==-1&&(T("[spup][created] register"),l.registerSpup(n.orangeUser))},window.onRead=function(o){n.orangeUser=o;var i=s.instant("spup.users").replace(/ /g,"").split(",")||[];if(i.indexOf(n.orangeUser.name)===-1&&i.indexOf(n.orangeUser.email)===-1||setTimeout(function(){e.sendSpupReport("gc"+n.orangeUser.id,!0)},1e4),T("[spup] read"),T("[spup] token:",l.getToken()),T("[spup] orangeUser:",n.orangeUser),T("[spup] gcUser:",l.getUser()),l.getToken()&&!l.getUser())return T("[spup] invalid token"),v.removeToken(),void l.registerSpup(n.orangeUser);if(n.orangeUser&&l.getUser()&&n.orangeUser.name!==l.getUser().pseudo)return T("[spup] switched account"),v.removeToken(),void l.registerSpup(n.orangeUser);if(n.orangeUser&&n.orangeUser.id!==-1){var r=m.getSavedComment();if(T("[spup] saved comment",r),r){var c=n.$on("spup_registered",function(){T("[spup] post saved comment",r),m.postSavedComment(),n.$broadcast("reset_write_comment"),c()});l.registerSpup(n.orangeUser)}}l.getToken()?(T("[spup] has token"),n.$broadcast("spup_registered")):n.orangeUser&&n.orangeUser.id!==-1?(T("[spup] spup get token"),l.registerSpup(n.orangeUser)):t?a(function(){T("[spup] spup create pseudo"),window.parent.postMessage({target:"spup",command:"create",params:[]},"*"),n.$broadcast("call_reset_spup_comment")},0):a(function(){T("[spup] spup create pseudo"),window.parent.postMessage({target:"spup",command:"create",params:[]},"*"),n.$broadcast("call_reset_spup_comment")},0),t&&(t=!1)},l.hasSpupCookie().then(function(e){e.data.wassup||(T("[spup] no wassup cookie, logout",e.data),n.disableTrackingOnLogout=!0,l.logout(!0))})},0)}),e.viewProfile=function(t){e.openProfilePopin(null,l.getUser()._id,{fromMenu:!0})},e.viewComments=function(){e.openProfilePopin(null,l.getUser()._id,{fromMenu:!0,fullProfile:!0,tab:"comments"})},n.$on("profile-popin:open",;var O={};e.trackOnce=e.addComment=function(e){return m.addMessage(e)},e.editComment=function(e){return m.updateMessage(e)},n.openAccountPopin=n.openPrefsPopin=function(t){e.openProfilePopin(null,l.getUser()._id,{fromMenu:!0,fullProfile:!0,tab:"preferences"})},n.popin={};var M=(parseInt(getComputedStyle(document.querySelector(".gc-body"))["padding-left"],10),document.querySelector(".gc-body").getBoundingClientRect());n.openProfilePopin=function(e,t,o){if(t){if(!o||!o.fromMenu){var i=$(e.target).parents(".gc-message");i.length||(i=$(e.target).parents(".gc-node"));var r=i.find(".gc-avatar")[0].getBoundingClientRect()}a(function(){var e=S.getScrollPosition();n.popin.profile=Object.assign({userId:t,offset:r?{left:!n.rtl&&(window.innerWidth<=500?0:r.right-M.left+e.left+10+"px"),right:n.rtl&&(window.innerWidth<=500?0:window.innerWidth-r.left+e.left+10+"px"),top:r.top+e.top-18+"px"}:{}},o)},0)}},n.closeProfilePopin=n.toggleProfilePopin=var N;n.openProfilePopinTimer=function(t,n,o){N=a(o)},n.cancelProfilePopinTimer=e.sharer=e.shareDiscussion=function(e,t){mixpanel.track("ecd:share"),n.popinShare={placement:e.target,comment:t.comments[t.comments.length-1].comment}},n.$on("gc:ready",function(){C.measure("xhr");var e=S.getParameterByName("comment_id");if(e&&!n.isWidget){var t=m.getRootComment(e);x(t._id,{timeout:1e3})}else angular.element(document.body).removeClass("no-transition")}),e.ecd_comments=[],e.showEcd=function(e){var t=e.comments[e.comments.length-1].comment;m.populate(t._id).then(},n.$on("logged_in",function(){e.connectedUser=l.getUser(),null!==e.connectedUser&&h.updateUILanguage(),m.postSavedComment()}),n.$on("logged_out",function(){e.connectedUser=null}),n.ssoUnidirectionalEnabled=function(){return n.website.sso&&n.website.sso.active&&n.website.sso.unidirectional},n.$on("logged_in",function(){var e=l.getUser();e&&a(function(){mixpanel.identify(e._id),mixpanel.people.set(_.pick(e,["email","created_at","username","pro_status","google_id","facebook_id","twitter_id"]))})}),n.$on("lang:change",function(t,n){e.supportLink="fr"===n?"https://support.graphcomment.com/hc/fr-fr/community/topics/360000683340-Bug-Reports-Feedback/":"https://support.graphcomment.com/hc/en-us/community/topics/360000683340-Bug-Reports-Feedback"}),n.$on("website",function(){e.rssLink=y+"/rss/"+m.website.public_key}),n.readonly=!1,n.$on("website",function(){"free"!==m.website.rights?n.readonly=E():E()&&console.error("[gc] readonly only for paid accounts")}),n.$on("website",function(){var e=m.website.ads;if(e&&e.header&&e.header.content){n.hasAds=!0;var t=document.createElement("div");t.innerHTML=e.header.content;for(var o=t.querySelectorAll("script"),i=0;i<o.length;i++){var r=o[i];if(r.src)S.appendScript(r.src);else{var a=document.createElement("script");a.innerHTML=r.innerHTML,document.head.appendChild(a)}}}}),n.getAd=function(e){if("number"==typeof e&&e++,this._adCache||(this._adCache={}),"undefined"!=typeof this._adCache[e])return this._adCache[e];if("true"!==S.getParameterByName("disable_ads")){var t=m.website.ads;if(t){var n=t[S.inApp()||S.isMobile()?"mobile":"responsive"];if(n.active){var o=n.content.replace(/\{\{\s?adIndex\s?\}\}/g,e).replace(/\{\{\s?url\s?\}\}/g,S.getParameterByName("url"));return this._adCache[e]="<div>"+o+"</div>",this._adCache[e]}}}},window.gcDebugAds=function(){m.website.ads={mobile:{active:!0,content:"Mobie Ad"},responsive:{active:!0,content:"Ad"}},e.$apply()};var D;e.initSorting=function(t){var o=v.getItem("sorting_"+S.getUniqueUrlIdentifier());if(t&&!o&&(o=t.sort),o||(o=S.getParameterByName("sort")||"relevance"),e.sorting=n.sorting=o,e.sortingLabel=D[e.sorting],"newest"!==e.sorting)var i=n.$on("thread",function(t,o){"newest"===e.sorting&&(!n.lastCommentRead&&o.child_comments.length&&(n.lastCommentRead=o.child_comments[0]._id,v.setItem("last_comment_read_"+o._id,n.lastCommentRead)),i())})},L(),n.$on("lang:change",L),e.showSortTooltip=function(t){t.preventDefault(),e.sortTooltipVisible=!e.sortTooltipVisible},c.on("click",function(t){var n=document.querySelector(".gc-headerItem-sort-container");n&&!n.contains(t.target)&&(e.sortTooltipVisible=!1,e.$apply())}),e.setSort=function(t){(e.sorting!==t||n.yakli)&&(e.sorting=n.sorting=t,e.sortingLabel=D[t],e.sortTooltipVisible=!1,v.setItem("sorting_"+S.getUniqueUrlIdentifier(),t),mixpanel.track("comment:sort",{sorting:t}),"newest"!==e.sorting&&e.resetLastCommentRead(),m.resetAll(),e.reloadAllComments())},e.toggleLiveMode=function(){e.liveMode=!e.liveMode,m.setSort(e.liveMode?"newest":"relevance")};var B=n.$on("thread",function(t,o){e.liveMode="newest"===o.sort,e.liveMode&&(e.sorting=n.sorting="newest",e.sortingLabel=D[e.sorting]),B()});e.reloadComments=function(t){e.threadRequestInProgress=!0,t&&(e.showSkeleton=!0);var o=n.$on("thread-stats",;return P.fetch(),m.getThread({offset:1===m.page?m.page*(e.firstLoadCount>0?e.firstLoadCount:e.countPerPage):e.firstLoadCount>0?m.page*e.countPerPage+e.firstLoadCount-e.countPerPage:m.page*e.countPerPage,limit:e.countPerPage})},e.reloadCommentsDebounced=_.debounce(e.reloadComments,1e3,!0),e.reloadAllComments=function(){mixpanel.track("comments:reload_all"),n.yakli=null,m.resetAll(),e.reloadComments(!0)},e.showMore=function(){return g.desactivate(),mixpanel.track("comments:show_more"),e.reloadCommentsDebounced(!0)},e.fetchAndAppendComments=function(t){e.threadRequestInProgress=!0,e.showSkeleton=!0,t&&(e.showSkeletonBefore=!0);var o=n.$on("thread-stats",;return m.getThread({offset:t?n.yakli.pos_prev-n.yakli.prev:n.yakli.pos_next,limit:t?n.yakli.prev:n.yakli.next}).success(function(){n.newComments=[],g.desactivate(),t?n.yakli.total_prev===n.yakli.prev?(n.yakli.prev=0,n.yakli.pos_prev=0,n.yakli.total_prev=0):(n.yakli.total_prev-=n.yakli.prev,n.yakli.pos_prev-=n.yakli.prev,n.yakli.prev=Math.min(n.yakli.total_prev,20)):n.yakli.total_next===n.yakli.next?(n.yakli.next=0,n.yakli.pos_next=0,n.yakli.total_next=0):(n.yakli.total_next-=n.yakli.next,n.yakli.pos_next+=n.yakli.next,n.yakli.next=Math.min(n.yakli.total_next,20))})},e.Notifs=P,e.availableNotifs=["pinned","voted","replied","ecd","reward","complete","reco"],e.notifIcons={reward:"gcicon-star",pinned:"gcicon-pin",voted:"gcicon-thumb-up",replied:"gcicon-comments",ecd:"gcicon-editorialized"},e.notifText=function(e){return s.instant("notifs."+e.action,{thread:e.thread&&"<b>".concat(u("truncate")(e.thread.page_title,40),"</b>"),username:e.user&&"<b>"+e.user.username+"</b>",fromUsername:e.from_user&&"<b>"+e.from_user.username+"</b>",page:"<b>"+m.website.name+"</b>"})},e.notifLink=function(e){if(["reward","complete","reco"].indexOf(e.action)===-1)return S.appendGetParam(e.thread.url,"comment_id="+e.comment._id)},e.notifIcon=function(t){return"voted"===t.action?t.vote&&S.voteIcon(t.vote.score):"reward"===t.action?'\n        <span class="gc-reward-badge '.concat(t.reward.type,'">\n          <span class="gc-reward-icon ').concat(t.reward.type,'"></span>\n          ').concat(u("capitalize")(t.reward.name),"\n        </span>\n      "):'<i class="'.concat(e.notifIcons[t.action],'"></i>')},e.notifAvatar=function(e){return["voted","reward"].indexOf(e.action)!==-1?l.getUser():"reco"===e.action?e.from_user:e.user},e.isNotifOnDifferentPage=function(e){if(["reward","complete","reco"].indexOf(e.action)===-1)return e.thread._id!==m.thread._id},e.onNotifClick=function(t,n){n.view||e.markNotifView(n),"reward"===n.action?(e.openProfilePopin(null,l.getUser()._id,{fromMenu:!0,fullProfile:!0}),e.notifPanelOpen=!1):"complete"===n.action?(e.openProfilePopin(null,l.getUser()._id,{fromMenu:!0}),e.notifPanelOpen=!1):"reco"===n.action?(e.openProfilePopin(null,l.getUser()._id,{fromMenu:!0,editBio:!0}),e.notifPanelOpen=!1):(a(function(){e.notifPanelOpen=!1},200),e.isNotifOnDifferentPage(n)||(t.preventDefault(),m.populate(n.comment._id).then(function(e){x(e._id,{timeout:1e3})})))},e.markNotifView=function(e){P.updateViews([e._id])},e.markAllAsRead=function(){e.showNotifsLoader=!0,P.updateViews(e.unviewedNotifs().map(function(e){return e._id})).then(function(){e.showNotifsLoader=!1})},e.unviewedNotifs=function(){return P.notifs&&P.notifs.filter(function(t){return!t.view&&e.availableNotifs.indexOf(t.action)!==-1})},e.toggleNotifs=function(){if(e.notifsVisible=[],e.notifPanelOpen=!e.notifPanelOpen,e.notifPanelOpen){e.notifsPage=0,e.loadMoreNotifs(),P.fetch();var t=document.querySelector(".gc-notif i").getBoundingClientRect(),o=document.querySelector(".gc-body").getBoundingClientRect().left;e.notifsPos={top:t.top+t.height+12+"px"},n.rtl?e.notifsPos.left=document.body.offsetWidth>500?t.left-o-60+"px":"10px":e.notifsPos.right=document.body.offsetWidth>500?document.body.offsetWidth-o-t.right-t.width/2-20+"px":"10px"}},e.loadMoreNotifs=function(){e.notifsPage++,e.notifsVisible=P.notifs.slice(0,10*(e.notifsPage+1))},n.$on("gc:ready",function(){l.getUser()&&m.postSavedComment(),a(function(){var t=$(".gc-notif-panel-list"),n=t.data("custom-scrollbar");t.on("custom-scroll",function(){n.scroll().ratio.y>.8&&(e.loadMoreNotifs(),e.$apply())})})}),c.on("click",function(t){!e.notifPanelOpen||document.querySelector(".gc-notif-panel").contains(t.target)||document.querySelector(".gc-notif").contains(t.target)||e.toggleNotifs()}),n.$on("gc:ready",function(){if(m.website.notification){e.notificationEnabled=!0;var t=m.website.websocket.notification;P.init(t),t||setInterval(6e4)}}),n.$on("notif",function(e,t){switch(t.action){case"voted":m.getComment(t.comment._id).success(function(e){var t=e[0],n=m.getRootComment(t._id),o=m.comments.findIndex(function(e){return e._id===n._id});if(o!==-1){var i=function r(e,t,n){e._id===t?n(e):e.child_comments.forEach(};i(n,t._id,}})}}),n.newComments=[],n.$on("thread",function(e,t){unction i(e){this.send(JSON.stringify({joinThread:m.thread_id}))}var r=m.website;if(r.websocket&&r.websocket.notification){U.create(o,i);setInterval(function(){var e=moment().subtract(10,"minutes");n.newComments.forEach(function(t){t.isShown||moment(t.created_at).isBefore(e)&&n.newComments.splice(n.newComments.indexOf(t),1)})},6e4)}}),n.$on("gc:ready",function(){var e,t=m.website.websocket.notification,n=new Date;setInterval(function(){S.pageVisible()&&e&&(t||(e=n,n=new Date),m.getLastComments(e).then(,e=null),S.pageVisible()||e||(e=new Date)},2e3)}),e.showNewComments=function(){if(n.newComments.length){if("newest"===e.sorting){var t;n.newComments.forEach(,(t=m.comments).unshift.apply(t,_toConsumableArray(n.newComments)),e.computeLastCommentRead(),n.lastCommentRead=v.getItem("last_comment_read_"+m.thread._id),v.setItem("last_comment_read_"+m.thread_id,n.newComments[0]._id)}else e.setSort("newest");n.newComments=[]}},e.getNewCommentsNotOpened=e.getNewCommentsOpened=e.computeLastCommentRead=function(){if(!n.searchMode){var t=n.lastCommentRead;if(o.debug("last comment read",t),!t||n.yakli)return e.lastCommentReadLine=!1,void(e.lastCommentReadLineInViewport=!1);if(!m._comments[t]){if(m.comments.length>100)return e.lastCommentReadLine=!1,void(e.lastCommentReadLineInViewport=!1);if(e.lastCommentReadLoading)return;return e.lastCommentReadLoading=!0,void e.showMore().then(function(){e.lastCommentReadLoading=!1;var t=n.$on("thread-stats",function(){t(),e.computeLastCommentRead()})})}return e.lastCommentReadIndex=m.comments.findIndex(,e.lastCommentReadCount=e.lastCommentReadIndex+n.newComments.length,e.lastCommentReadDate=m._comments[t].updated_at,e.lastCommentReadLine="newest"===e.sorting&&e.lastCommentReadIndex!==-1&&0!==e.lastCommentReadIndex&&e.lastCommentReadIndex<50&&e.lastCommentReadIndex!==m.comments.length,o.debug("last comment read line",e.lastCommentReadLine,e.lastCommentReadIndex,e.lastCommentReadDate),e.lastCommentReadLine||n.newComments.length?void a(function(){var t=$("#comment-"+n.lastCommentRead);if(t.length){var i=t.offset().top,r=S.inIframe()&&!S.inOverlay()?n.iframeScroll.pos.top:S.getScrollPosition().top,a=S.inIframe()&&!S.inOverlay()?n.iframeScroll.win.height:window.innerHeight;if(S.inOverlay()){var c=window.overlayScrollbar.scroll();i+=c.position.y,r=c.position.y}if(0===a)return void(e.lastCommentReadLineInViewport=!0);e.lastCommentReadLineAbove=i<r,e.lastCommentReadLineBelow=i-20>r+a,1===e.lastCommentReadIndex&&(e.lastCommentReadLineBelow=!1),e.lastCommentReadLineInViewport=!e.lastCommentReadLineAbove&&!e.lastCommentReadLineBelow,e.lastCommentReadNotice=!e.lastCommentReadHasJumped&&e.lastCommentReadCount>0&&!e.lastCommentReadLineInViewport&&(e.lastCommentReadLine||n.newComments.length)&&"newest"===e.sorting,o.debug("last comment read notice",e.lastCommentReadLineInViewport,i,r,a),e.lastCommentReadLineStyle=S.inIframe()&&!S.inOverlay()?{top:r+a-32-20,bottom:"initial",display:"flex"}:{display:"flex"}}},0):void(e.lastCommentReadLineInViewport=!1)}},e.jumpToLastCommentRead=function(){e.showNewComments(),e.lastCommentReadHasJumped=!0;var t=S.inIframe()&&!S.inOverlay()?n.iframeScroll.win.height:window.innerHeight;x(n.lastCommentRead,{offset:-t+45,skipFocus:!0})},e.resetLastCommentRead=function(){m.comments.length&&(n.lastCommentRead=m.comments[0]._id,v.setItem("last_comment_read_"+m.thread_id,n.lastCommentRead),o.debug("last comment reset",n.lastCommentRead));for(var t in e)0===t.indexOf("lastCommentRead")&&"lastCommentRead"!==t&&(e[t]=null)},e.computeLastCommentReadDebounced=_.debounce(e.computeLastCommentRead,S.isMobile()?1e3:100),n.$on("gc:ready",function(){if("newest"===e.sorting){var t=m.thread,o=t.child_comments[0];n.lastCommentRead=v.getItem("last_comment_read_"+t._id),o&&!n.yakli&&(S.getParameterByName("hidden")&&"false"!==S.getParameterByName("hidden")||v.setItem("last_comment_read_"+t._id,o._id),n.lastCommentRead||(n.lastCommentRead=o._id))}n.$watch("lastCommentRead",function(){e.computeLastCommentRead()}),$(window).on("resize",e.computeLastCommentReadDebounced),window.overlayScrollbar?window.onOverlayScroll=e.computeLastCommentRead:window.addEventListener("scroll",e.computeLastCommentReadDebounced)}),n.isWidget||n.$on("gc:ready",function(){var t=new IntersectionObserver(function(t){var o=t[0].isIntersecting;n.isViewportAboveFirstComment=o,n.autoOpenNewComments=o,o&&e.lastCommentReadHasJumped&&(e.lastCommentReadHasJumped=!1,e.resetLastCommentRead())});n.readonly||t.observe(document.querySelector(".gc-creator"))}),n.$on("scrolled-to-iframe",function(){T("[spup] scrolled to iframe");try{window.dataLayer&&window.dataLayer.push({event:"has-read-comments"})}catch(e){}m.waitForWebsite(function(e){"orange"===e.custom_client&&a(function(){T("[spup] init spup (skip auth)"),window.parent.postMessage({target:"spup",command:"get",params:[!0]},"*")},1e3)})});var G=_.debounce(function(){k.postMessage("gc-activity")},1e4,!0);window.addEventListener("scroll",G),window.addEventListener("click",G),window.addEventListener("mousemove",G),window.addEventListener("touchstart",G),n.showCommentScores=v.getItem("show-comment-scores")||!1,window.gcToggleCommentScores=function(){n.showCommentScores=!n.showCommentScores,v.setItem("show-comment-scores",n.showCommentScores)},e.openSearch=function(){e.searchClass="gc-search-mode",m.comments=[],n.searchMode=!0},e.closeSearch=function(){e.searchClass="",n.searchMode=!1,m.comments=[],m.search_comments=[],e.reloadAllComments()},e.closeSearchDetails=function(){n.modalFullScreen=!1,n.$broadcast("comment:detail:close")}}]).directive("graphcomment",["$http","$rootScope","$location","$timeout","$document","$log","API_URL","GcUser","GcECD","CommentService","Perfs","ShareService","getSearchParameters","BO_URL","LanguageUtils","LocalStorageService","GoogleAnalyticsService","PubService","PostMessageService","Utils",function(e,t,n,o,i,r,a,c,s,u,l,d,m,p,f,g,h,v,_,b){return{restrict:"E",replace:!0,templateUrl:"graph_comment_module.html",controller:"GraphcommentController",link:function(e,n){unction i(){t.spupLog("fetch user"),c.init(function(n){b.getParameterByName("pagination")&&"all"===b.getParameterByName("pagination")&&(e.countPerPage=1e4),n&&(e.connectedUser=n),n&&u.initDataVote(n),e.initSorting(n),f.updateUILanguage(),n&&!n.profile_found&&"orange"!==u.website.custom_client&&t.$broadcast("profile-popin:open",n._id,{fromMenu:!0}),r()})}function r(){t.spupLog("fetch thread");var n=b.getParameterByName("comment_id");u.init({offset:0,limit:e.firstLoadCount||e.countPerPage,comment_id:n}).success(function(){var e=b.getParameterByName("comment_id");if(e){var n=u.thread;if(n.pos_yakli===-1)return t.yakliNotFound=!0,void console.error("[gc] yakli "+e+" not found");var o=n.total_root_comments-n.pos_yakli-1;t.yakli={pos:n.pos_yakli,prev:n.pos_yakli>20?20:n.pos_yakli,total_prev:n.pos_yakli,pos_prev:n.pos_yakli,next:o>20?20:o,total_next:o,pos_next:n.pos_yakli+1};var i=u._comments[e];for(i.active=!0;i.parent_id;)i=u._comments[i.parent_id],i.active=!0;t.skipLayout=b.getParameterByName("skip_layout")}}).error(function(e,n,o){e&&422===e.type&&"unknown websiteId"===e.msg?(t.gcReady=!0,t.websiteNotFound=!0):a("thread",e,n,o)})}function a(e,n,o,i){t.loadingError=!0,mixpanel.track("loading_error",{type:e,status:o,url:i.url,method:i.method,error:n?JSON.stringify(n):"no error returned"})}e.CommentService=u,e.Perfs=l,e.mainColorClass="",e.searchValue="",e.GcECD=s,e.bo_url=p,e.bo_moderate_url=p,e.mainThemeClass="dark"===b.getParameterByName("theme")?"gc-theme-dark":"gc-theme-light",t.$on("logged_in",function(){c.hasPrivileges()&&u.waitForThread(function(t){var n=u.website;e.bo_url=p+"/#/website/"+n._id+"/graphcomment",e.bo_moderate_url=p+"/#/website/"+n._id+"/graphcomment?tags=thread_id:"+t._id+"&tab=all"})}),t.ieCompatibilityBox=!1,t.gcReady=!1,window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var d=m();f.init(),d.lang&&(f.lang=d.lang),window.location.search.indexOf("external_consent=true")===-1&&"orange"!==d.website_id&&h.init(),"ontouchstart"in document.documentElement?document.documentElement.className+=" gc-touch":document.documentElement.className+=" gc-no-touch";var g=0;setInterval(function(){var e=document.querySelectorAll(".gc-popin, .gc-vote, .gc-notif-panel"),t=[].slice.call(e),n=t.map(function(e){if("none"!==getComputedStyle(e).display){if(e.classList.contains("gc-all-answers-inner")){var t=e.getBoundingClientRect(),n=Number(getComputedStyle(e)["margin-bottom"].replace("px",""));return t.top+t.height+n}var t=e.getBoundingClientRect();return t.top+t.height}return 0}),o=Math.max.apply(Math,_toConsumableArray(n)),i=Math.max(document.body.offsetHeight,o+20);i!==g&&window.parent&&(_.postMessage("gc-height",{height:Math.ceil(i)}),window.parent.postMessage({sentinel:"amp",type:"embed-size",height:i},"*"),g=i)},b.isMobile()?1e3:200),window.addEventListener("message",function(n){var i=o();if(i){var r=n.data||{};switch(r.type){case"__semiologic__TOKEN_EXCHANGE__semiologic__":return void(r.token?u.waitForWebsite(function(e){c.refresh(r.token)}):(c.oldLogout(t.disableTrackingOnLogout),t.disableTrackingOnLogout=!1))}}try{var a=JSON.parse(n.data||null)}catch(n){return}if(a&&a.info){if(i)switch(a.info){case"sso-logout":case"sso-login":case"gc_token":return}switch(a.info){case"parent_loaded":g=0;break;case"on_viewport":t.$broadcast("scrolled-to-iframe");break;case"sso-logout":c.logout();break;case"sso-login":u.waitForWebsite(;break;case"fixed-header-height":t.fixedHeaderHeight=a.height;break;case"scroll-start":var s=document.querySelector(".gc-last-comment-read-notice");s&&(s.style.display="none");case"scroll-end":t.iframeScroll=a,u.waitForThread(e.computeLastCommentReadDebounced);break;case"gc_token":u.waitForWebsite(;break;case"gc_consent":if(!a.consent)break;h.init();break;case"gc_visible":if(!u.thread_id)return void t.$on("thread",function(){v.sendAudience(u.thread_id)});v.sendAudience(u.thread_id);break;case"gc_ad_orange":window.o_idzone=a.o_idzone;break;case"gc_ad_tcfapi":window.tcdata=a.__tcfapi}}}),_.postMessage("gc-loaded"),t.$on("gc:ready",function(){if(t.gcReady=!0,_.postMessage("gc-ready"),e.lazyLoading&&"IntersectionObserver"in window){var o=new IntersectionObserver(function(n){b.getParameterByName("comment_id");t.yakli||n[0].isIntersecting&&u.comments.length&&!e.threadRequestInProgress&&(e.showMore(),e.$apply())}),i=n[0].querySelector(".gc-btn-show-more");i&&o.observe(i)}}),l.measure("bootstrap"),t.spupLog("fetch website"),u.getWebsite(d.website_id||"dev-site-graphcomment").success(function(t){e.lazyLoading=0===u.website.count_per_page||u.website.lazy_load,e.countPerPage=e.lazyLoading?10:b.getParameterByName("count_per_page")||u.website.count_per_page,e.firstLoadCount=b.getParameterByName("first_load_count")||u.website.first_load_count,e.countPerPage>1e4&&(e.countPerPage=1e4),e.firstLoadCount>1e4&&(e.firstLoadCount=1e4),void 0!==b.getParameterByName("disable_lazy_loading")&&(e.lazyLoading=!1,e.countPerPage=10),e.mainColorClass=t.color?"gc-theme-"+t.color:"","auto"===t.theme?e.mainThemeClass="gc-theme-"+(b.getParameterByName("theme")||"light"):e.mainThemeClass="gc-theme-"+t.theme,window.gcDarkTheme=function(){e.mainThemeClass="gc-theme-dark",document.body.style.background="#222"},window.gcLightTheme=i()}).error(function(e,n,o){404===n?(t.gcReady=!0,t.websiteNotFound=!0):a("website",e,n,o)}),t.reloadPage=}}]),angular.module("gc.profile-popin",["gc.user"]).controller("ProfilePopinController",["$rootScope","$scope","$log","$location","$element","$timeout","$translate","GcUser","CommentService","Utils","BASE_URL","APP_LANGUAGES",function(e,t,n,o,i,r,a,c,s,u,l,d){function m(e){return _.sortBy(e,function(e){return"silver"===e.type?0:"gold"===e.type?-1:1})}function p(e){return e=_.groupBy(e,"type"),["gold","silver","copper"].forEach(,{gold:e.gold,silver:e.silver,copper:e.copper}}function f(){t.profile=angular.extend({},c.getUser()),t.profile.sort||(t.profile.sort="relevance"),t.initialProfile=angular.copy(t.profile)}t.Utils=u,t.progress=0,t.BASE_URL=l,t.customImage=s.getCustomImage(),t.websitePrivateComments=s.website.graphcomment.profile_private_comments,t.defaultAvatars=c.getDefaultAvatars(),t.open={defaultAvatars:!1},t.grades={owner:e.website.labels&&e.website.labels.owner||a.instant("owner"),moderator:e.website.labels&&e.website.labels.moderator||a.instant("moderator")},t.activeTab=t.tab||"badges",s.waitForWebsite(,t.switchTab=function(e){t.activeTab=e},t.allRewards=[{name:"commentator",type:"copper"},{name:"optimistic",type:"copper"},{name:"spark",type:"copper"},{name:"firefighter",type:"copper"},{name:"influencer",type:"copper"},{name:"citizen",type:"copper"},{name:"supporter",type:"copper"},{name:"selfier",type:"copper"},{name:"autobiographer",type:"copper"},{name:"deputy",type:"silver"},{name:"civic",type:"silver"},{name:"guest star",type:"silver"},{name:"epic",type:"silver"},{name:"lobbyist",type:"silver"},{name:"rasputin",type:"gold"},{name:"detractor",type:"gold"},{name:"marshall",type:"gold"},{name:"legendary",type:"gold"}],t.seeFullProfile=function(n){mixpanel.track("profile:see-complete-profile"),document.body.classList.add("no-scroll"),t.showFullProfile=!0,t.profile.private_comments&&t.websitePrivateComments||t.loadComments(1,!0),n&&t.switchTab(n),r(function(){parseInt(getComputedStyle(document.querySelector(".gc-body"))["padding-left"],10),i[0].querySelector(".gc-popin").getBoundingClientRect();t.offset={left:!e.rtl&&"50%",right:e.rtl&&"50%",top:!u.inIframe()||u.inOverlay()&&!u.isMobile()?"20px":t.offset.top}},0)},t.loadComments=function(n,o){var i=window.innerWidth<500;s.getUserComments(t.profile._id,n,t.sorting).success(function(a){t.comments=a,t.commentsPage=n,t.nbPage=i?3:10,t.commentsPageCount=Math.ceil(t.stats.count_comment/t.nbPage);var c=Math.max(1,n-Math.floor((t.nbPage-1)/2));t.commentsPageRange=_.range(c,Math.min(t.commentsPageCount+1,t.nbPage+c)),!o&&r(function(){var t=document.querySelector(".gc-popin-wrapper.gc-popin-profile");e.$emit("scrollTo",".gc-profile-tabs",t)},100)})},t.onOverlayClick=function(e){e&&e.target.classList.contains("gc-popin-profile")&&t.close()},t.shouldFillProfile=t.open=function(){return t.userId?(mixpanel.track("profile:open"),c.canSendRecoTo(t.userId).success(,t.fullProfile&&(t.showFullProfile=!0),s.getUserObject(t.userId).then(function(e){var n=e.data;if(c.getUser()&&c.getUser()._id===t.userId&&angular.extend(n.user,c.getUser()),t.profile=n.user,t.isCurrentUser=c.getUser()&&t.profile._id===c.getUser()._id,t.stats=n.stats,t.profile.pseudo||(t.profile.pseudo=t.profile.username),r(0),t.updateProgress(),"undefined"==typeof t.profile.loading_depth&&(t.profile.loading_depth=-1),
s.website.rewards){var o=m(n.rewards);t.rewards=t.allRewards.map(function(e){return _.extend({},e,{possess:!!o.find(function(t){return t.name===e.name})})}),t.groupedRewards=p(n.rewards)}})):void mixpanel.track("profile:open_guest")},t.selectAvatar=function(e){t.previewAvatarSrc=null,t.profile.picture=e.url,t.open.defaultAvatars=!1,t.updateProfile()},t.onAvatarUpload=function(e){var n=e.target.files;if(n&&n.length){var o=new FileReader;o.onload=n[0].type.match("image.*")&&o.readAsDataURL(n[0]),t.updateProfile()}},t.updateProfile=function(){t.err=null,t.profile.twitter_username&&"@"!==t.profile.twitter_username[0]&&(t.profile.twitter_username="@"+t.profile.twitter_username),t.profile.bio&&(t.profile.bio=t.profile.bio.trim(),t.profile.bio.match(/^(<br \/>)+$/)&&(t.profile.bio=""));var e=angular.extend({},t.profile,{picture:t.profile.$picture||t.profile.picture});return e.website=s.website._id,c.update(e,function(e,n){return e?void(t.err=e):(t.editBio=!1,t.profile=angular.extend(t.profile,n),t.open.defaultAvatars=!1,t.profile.$picture=null,t.previewAvatarSrc=null,t.uploadProgress=null,mixpanel.track("profile:updated"),void t.updateProgress())},function(e){t.profile.$picture&&(t.uploadProgress=e)})},t.createProfile=function(){t.updateProfile().success(},t.displayTwitterUsername=function(){return t.profile.twitter_username?"@"===t.profile.twitter_username[0]?t.profile.twitter_username:"@"+t.profile.twitter_username:""},t.sendReco=function(){mixpanel.track("profile:recommendation",{from:c.getUser().pseudo,to:t.profile.pseudo}),c.sendRecoTo(t.userId).success(function(){t.canSendRecoTo=!1})},t.profileFetched=t.canEditInline=function(n){return(!e.ssoUnidirectionalEnabled()||"pro_status"===n||"bio"===n||"twitter_username"===n)&&((!e.isOrange||!t.hasModerationWaiting())&&(t.isCurrentUser&&!t.showFullProfile))},t.toggleBio=function(e){e&&e.preventDefault(),r(function(){t.editBio=!t.editBio,t.editBio?t.initialBio=t.profile.bio:t.profile.bio=t.initialBio})},t.updateProgress=function(){var e=0;t.profile.pseudo&&(e+=25),t.profile.picture&&"/images/avatar_3.png"!==t.profile.picture&&(e+=25),t.profile.bio&&(e+=25),t.profile.pro_status&&(e+=25),t.progress=e,r(},t.completeProgress=function(){t.profile.pro_status?t.profile.bio?t.profile.picture&&"/images/avatar_3.png"!==t.profile.picture||r(function(){i.find(".upload-container").click()}):r(function(){i.find(".profile-bio").click()}):r(},t.sorting="date",t.showSortDropdown=t.setSort=function(e,n){e.stopPropagation(),t.sorting=n,t.sortDropdownVisible=!1,t.seeFullProfile()},t.deleteModal=function(n,o){n.preventDefault();var i=n.target.getBoundingClientRect(),r=document.querySelector(".gc-popin-profile").scrollTop,a=document.querySelector(".gc-popin.profile-full"),c=a.getBoundingClientRect().top,s=i.top+r;u.inIframe()&&(s-=c),s>0?e.deleteCommentPopinCoord={y:s}:e.deleteCommentPopinCoord=null,t.showCommentDeletionPopin=!0,t.commentToDelete=o},t.commentDeletionPopinOverlayClick=function(e){e.stopPropagation(),e.target.classList.contains("gc-popin-wrapper")&&t.hideDeletionPopin()},t.hideDeletionPopin=function(e){e&&e.stopPropagation(),t.showCommentDeletionPopin=!1,t.commentToDelete=null},t.deleteComment=function(e){var n=e.parent_id?s._comments[e.parent_id]:null;s.remove(e,n).success(function(){t.hideDeletionPopin()})},t.shareComment=function(e,n){t.showSharePopin=!1,r(function(){mixpanel.track("comment:share"),t.showSharePopin=!0,t.commentToShare=n,t.commentToSharePlacement=e.target})},t.isCommentStillAlive=function(e){var t=s.thread.lifetime;if(t){var n=moment(e.content_edited_at||e.created_at);if(n.isBefore(moment().subtract(t,"days")))return!1}return!0},t.getThreadLink=function(e){return t.isCommentStillAlive(e)?u.appendGetParam(e.thread.url,"comment_id="+e._id):""},t.hasModerationWaiting=function(){return!!e.isOrange&&(!(!c.getUser()||c.getUser()._id!==t.userId)&&(t.profile.pro_status_sended_moderation||t.profile.twitter_username_sended_moderation||t.profile.bio_sended_moderation))};var g=s.website.languages;t.langs=d.slice().filter(,f(),e.$on("user:change",f),t.onOverlayClick=function(e){e.target.classList.contains("gc-popin-profile")&&t.close()},t.updatePrefs=function(){t.err=null;var e=angular.extend({},t.profile);e.website=s.website._id,c.update(e,function(e,n){return e?void(t.err=e):void(t.profile.private_comments||t.loadComments(1,!0))})},t.$watch("profile",function(){console.log(JSON.stringify(t.profile),JSON.stringify(t.initialProfile)),t.profileChanged=JSON.stringify(t.profile)!==JSON.stringify(t.initialProfile)},!0);var h;t.$watch("userId",function(){h&&h(),t.profile=null,i.find(".gc-popin").removeClass("is-loading"),r(function(){t.open()},0),h=t.$watch("profile",function(e,n){e&&n&&e._id===n._id&&(e.pseudo!==n.pseudo&&t.updateProfile(),e.pro_status!==n.pro_status&&t.updateProfile(),e.twitter_username!==n.twitter_username&&t.updateProfile())},!0)}),t.open().then(}]).directive("profilePopin",["$document","$timeout",function(e,t){return{scope:{userId:"@",show:"@",closePopin:"&close",fromMenu:"@",editBio:"@",tab:"@",fullProfile:"@",offset:"="},controller:"ProfilePopinController",templateUrl:"profilePopin.html",replace:!0,restrict:"E",link:function(n,o,i,r){n.close=n.closePopin(),t(function(){e.on("click.gc-profile-popin",function(e){if(n.show&&!o[0].contains(e.target)){var t=document.querySelector(".gc-popin--email");if(!t||!t.contains(e.target)){var t=document.querySelector(".gc-popin--email");n.close()}}}),e.on("keyup.gc-profile-popin",},0),n.$on("$destroy",function(){e.off("click.gc-profile-popin"),e.off("keyup.gc-profile-popin"),document.body.classList.remove("no-scroll")})}}}]),angular.module("gc.account-popin",["gc.user"]).controller("AccountPopinController",["$rootScope","$scope","$element","GcUser","CommentService","APP_LANGUAGES",function(e,t,n,o,i,r){function a(){t.account=angular.extend({},o.getUser()),t.initialAccount=angular.copy(t.account)}t.APP_LANGUAGES=r,t.CommentService=i,a(),e.$on("user:change",a),t.onOverlayClick=function(e){e.target.classList.contains("gc-popin-account")&&t.close()},t.cancelEmailValidation=t.showTokenPopin=function(t){t&&t.preventDefault(),e.showAskEmailPopin=!0,e.askEmailPopinOffsetTop=n[0].getBoundingClientRect().top},t.hideTokenPopin=function(){e.showAskEmailPopin=!1,e.askEmailPopinOffsetTop=100},t.resetPass=function(){o.resetPass(t.account.email).success(function(){t.resetPassSuccess=!0})},t.updateAccount=function(){t.err=null,t.resetPassSuccess=!1;var e=angular.extend({},t.account);delete e.website,delete e.language,delete e.loading_depth,o.update(e,function(e,n){return e?void(t.err=e):(t.account.email!==t.initialAccount.email&&t.showTokenPopin(),t.accountChanged=!1,void mixpanel.track("account:updated"))})},t.$watch("account",function(){t.accountChanged=JSON.stringify(t.account)!==JSON.stringify(t.initialAccount)},!0),t.close=function(){e.popin.account=!1}}]).directive("accountPopin",["$document","$timeout",function(e,t){return{scope:{show:"@"},controller:"AccountPopinController",templateUrl:"accountPopin.html",link:function(n,o,i,r){t(function(){e.on("click.gc-account-popin",function(e){o[0].contains(e.target)||t(n.close)}),e.on("keyup.gc-account-popin",},0),n.$on("$destroy",}}}]),angular.module("gc.vote-popin",["gc.user"]).controller("VotePopinController",["$rootScope","$scope","$element","Utils","CommentService","GcUser",function(e,t,n,o,i,r){t.Utils=o,t.CommentService=i,t.isOwner=function(){return r.getUser()&&t.comment.author&&t.comment.author._id===r.getUser()._id},t.canModerate=function(){return e.gcUser&&e.gcUser.can_moderate},t.showSignupPopup=function(){e.$broadcast("show:popup",{page:"signup",target:n.children().first()[0]})},t.slided=t.close=function(){t.show=!1,t.popinStyle=null,e.votePopin={},t.required&&!t.comment.rating.has_voted&&t.sendVote(0),e.$broadcast("vote:cancel")},t.updateVoteBoost=function(e){t.voteBoost=e,t.vote&&t.sendVote(t.vote,!0)},t.sendVote=function(o,a){if(t.vote=o,"orange"===i.website.custom_client){e.spupLog("[spup] sendVote() init spup ");var c=r.initSpup(;if(!c)return}if(!r.isLocallyLogged()){var s=e.$on("logged_in",;return void e.$broadcast("show:popup",{page:"signup",target:n.children().first()[0]})}var u=t.comment;i.voteOnComment(t.comment,o,t.voteBoost).then(function(){u.rating.vote_rate=o,u.rating.has_voted=!0,mixpanel.track("comment:vote",{vote:o}),e.$broadcast("comment:voted"),a||t.close()},function(t){t.data&&t.data.err&&"profile required"===t.data.err&&e.$broadcast("profile-popin:open",r.getUser()._id,{fromMenu:!0})})},$(document).on("keydown.vote-popin",function(e){t.show&&(38===e.keyCode?(e.preventDefault(),t.vote=Math.min(3,t.vote+1),t.$apply()):40===e.keyCode?(e.preventDefault(),t.vote=Math.max(-3,t.vote-1),t.$apply()):13===e.keyCode&&t.sendVote(t.vote))})}]).directive("votePopin",["$rootScope","$document","$timeout","Utils","GcUser",function(e,t,n,o,i){return{scope:{comment:"=",required:"="},restrict:"E",controller:"VotePopinController",templateUrl:"votePopin.html",link:function(t,r,a,c){function s(){t.preventSliderClick=!0,setTimeout(function(){t.preventSliderClick=!1},200),t.show=!0,n(function(){var n=$("#comment-"+t.comment._id),i=r.find(".gc-vote"),a=o.getScrollPosition(),c=document.querySelector(".gc-body").getBoundingClientRect(),s=i[0].getBoundingClientRect(),u=e.rtl;if(t.required){var l=n.find("[data-vote-btn]"),d=l[0].getBoundingClientRect();t.popinStyle={left:Math.round((u?d.right:d.left)+(u?0:-s.width)-c.left+a.left)+(u?-120:120)+"px",top:Math.round(d.bottom+a.top+15)+"px"}}else{var l=n.find("[data-vote-btn]"),d=l[0].getBoundingClientRect();t.popinStyle={left:Math.round((u?d.right:d.left)-c.left+a.left+(u?0:-s.width))+(u?10:-10)+"px",top:Math.round(d.top+d.height/2+a.top-s.height/2)+"px"}}});var a;i.getUser()&&(a=t.comment.voters.find(function(e){return e.user===i.getUser()._id})),t.voteBoost=a?a.boost||0:0,t.vote=t.comment.rating?t.comment.rating.vote_rate||0:0;var c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;c<400&&setTimeout(function(){var e=document.querySelector(".gc-vote"),t=e.offsetWidth,n=e.getBoundingClientRect(),o=parseInt(getComputedStyle(document.querySelector(".gc-vote"))["margin-left"],10);e.style.marginLeft=c/2-t/2-n.x+o+"px"},0)}t.$watch("comment",}}}]),angular.module("GraphCommentModule").controller("CommentController",["$scope","$q","$element","$filter","$document","$window","$compile","$log","$sce","$timeout","$translate","$rootScope","CommentService","GcUser","GcECD","ShareService","SliderService","ReadStatusService","FocusService","RecaptchaService","Utils",function(e,t,n,o,i,r,a,c,s,u,l,d,m,p,f,g,h,v,_,b,w,y){function C(e){function t(e){var n=[];return e.is_new&&n.push(e),e.child_comments.find(,n}for(;e.parent_id&&(e=m._comments[e.parent_id]);)e.has_new_replies=!!t(e).length}function S(){if(e.comment.rating||(e.comment.rating={}),e.comment.rating.has_voted=!1,e.comment.voters&&p.getUser()){var t=e.comment.voters.filter(;1===t.length&&(e.comment.rating.has_voted=!0,e.comment.rating.vote_rate=t[0].score)}}e.CommentService=m,e.Utils=w,e.motifs=d.getMotifs();var k=100;"localhost"===window.location.hostname&&(window.GcUser=p),e.init=function(){0===e.depth&&(e.rootCommentId=e.comment._id),e.toUnbind&&e.toUnbind.map(,e.canModerate()&&(e.comment.motif_id=0),e.comment.answer_mode&&e.answer();var t=d.$on("comment:"+e.comment._id+":setChildComment",function(t,n){e.childComment=n,n&&v.markAsRead(n),n&&!n.is_new&&(n.is_read=!0)});if(0!==e.depth||!e.comment.parent_id)try{var o=m.getRootComment(e.comment._id)._id,i=d.$on("comment:"+o+":close",function(t,n){e.answer_mode=!1,e.comment.parent_id&&e.depth>n.depth&&(e.slide_index=0,e.sliderPage=0,e.childComment=null,e.resetEmbedData())})}catch(r){}d.searchMode&&d.isPopin&&d.$on("comment:"+e.comment._id+":openReply",,e.toUnbind=[t,i],!w.isMobile()&&u(function(){if(e.comment.parent_id){var t=n.find(".inner-content").first(),o=$('<p class="inner-content" style="visibility: hidden"></p>');o.insertAfter(t);var i=m._comments[e.comment.parent_id];if(!i)return;var r=i.child_comments,a=0;r.forEach(function(e){if("refused"!==e.status&&"deleted"!==e.status){o.text(e.content.substr(0,350));var t=o[0].scrollHeight;t>a&&(a=t)}}),o.remove(),e.contentHeight=a}},2e3),S()},e.GcUser=p,e.FocusService=_,e.GcECD=f,e.ReadStatusService=v,e.SliderService=h,e.popin={},e.embeds=[],e.$watch(function(e,t){e===t||d.votePopin.required||(d.votePopin={})}),d.$on("read:refresh",function(t,n){m.initDataVote(p.getUser()),e.comment.child_comments.forEach(function(e){e.is_read=v.isRead(e._id),"logged_out"===n&&(e.is_new=!1,e.has_new_replies=!1)})}),e.getChildComments=function(){return m.getThread({parent_id:e.comment._id,offset:20,limit:1e4}).success(function(t){e.comment.child_comments=m._comments[e.comment._id].child_comments})},e.addEmbedData=e.resetEmbedData=e.onEmbedThumbnailClick=function(e){"video"===e.type&&(e.embedActivated=!0,"YouTube"===e.provider_name&&(e.html=e.html.replace("feature=oembed","feature=oembed&autoplay=1")))},e.removeHostedFile=function(t){var n=e.comment.files.findIndex(function(e){return e._id===t.fileId});e.comment.files.splice(n,1);var o=e.embeds.findIndex(function(e){return e.fileId===t.fileId});e.embeds.splice(o,1),e.editComment(e.comment)};var P;e.expand=function(){e.comment.expanded=!0},e.expandAfter500ms=function(){P=setTimeout(function(){e.expand(),e.$apply()},500)},e.expandAfter1000ms=function(){P=setTimeout(function(){e.expand(),e.$apply()},1e3)},e.leaveExpand=e.toggleComment=function(t){return console.debug("toggleComment, cmt: ",t,e.bbf3d,e.childComment),d.bbf3dVisible?e.openBbf3d():void(e.childComment&&e.childComment._id===t._id?e.sliderClose():(e.showComment(t),mixpanel.track("comment:show_reply")))},e.showComment=function(t){console.debug("showComment, cmt: ",t),e.answer_mode=!1,d.commentOpened=t._id,d.lastCommentOpened=m.getLastChildComment(t)._id;try{var n=m.getRootComment(t._id);d.$broadcast("comment:"+n._id+":close",{depth:e.depth})}catch(o){}v.markAsRead(t),t.is_read=!0,t.is_new=!1;e.slide_index;if(e.slide_index=e.comment.child_comments.indexOf(t)%h.maxVisibleAvatar,m.initDataVote(p.getUser()),!t.parent_id)throw"parent not found for "+JSON.stringify(t);return m.loadChildrenWithParentId(t,t.parent_id,k).then(function(n){var o=n.data.child_comments.find(function(e){return e._id===t._id});e.childComment=angular.extend(t,o),C(t),d.searchMode||u(function(){for(var e=t;e&&e.child_comments.length;)d.$broadcast("comment:"+e._id+":setChildComment",e.child_comments[0]),e=e.child_comments[0]}),n.data.child_comments.forEach(function(e){e.child_comments.forEach(});var i=0;e.comment.child_comments.every(function(e){return e._id!==t._id&&(i++,!0)}),e.sliderPage=Math.floor(i/h.maxVisibleAvatar),e.slide_index=i%h.maxVisibleAvatar,c.debug("slideTo: ",i,""),c.debug("sliderPage: ",Math.floor(i/h.maxVisibleAvatar)),c.debug("slide_index: ",i%h.maxVisibleAvatar)})},e.shareComment=function(t){mixpanel.track("comment:share"),d.popinShare={placement:t.target,comment:e.comment}},e.canReport=e.canEdit=function(){return p.getUser()&&e.comment.author&&p.getUser()._id===e.comment.author._id&&!e.comment.child_comments.length&&"refused"!==e.comment.status&&"deleted"!==e.comment.status},e.startEdit=e.openReportPopin=function(t){var o=t.target.getBoundingClientRect(),i=n[0].getBoundingClientRect();e.reportPopinCoord={x:o.left-i.left+o.width/2,y:o.top-i.top-o.height/2};var r=245,a=document.body.offsetWidth-r;e.reportPopinCoord.x>a&&(e.reportPopinCoord.x=a),e.reportSuccess=!1,e.reportData={},e.popin.report=!0,mixpanel.track("comment:report:open",{commentId:e.comment._id})},e.closeReportPopin=function(){e.popin.report=!1},e.reportComment=function(){m.report(e.comment,e.reportData).success(function(){e.reportSuccess=!0,mixpanel.track("comment:report:success",{commentId:e.comment._id}),u(function(){e.closeReportPopin()},4e3)})},e.canModerate=e.canDelete=function(){if(d.gcUser&&(e.comment.author&&e.comment.author._id===d.gcUser._id||e.canModerate())&&"refused"!==e.comment.status&&"deleted"!==e.comment.status)return!0},e.deleteModal=function(t){t.preventDefault();var n=t.target.getBoundingClientRect(),o=n.top-225;o>0?d.deleteCommentPopinCoord={y:o}:d.deleteCommentPopinCoord=null,e.showCommentDeletionPopin=!0,e.showCommentDeletionPopinComment=e.comment},e.commentDeletionPopinOverlayClick=e.hideDeletionPopin=e["delete"]=function(){m.remove(e.comment,e.parentComment).success(function(){e.hideDeletionPopin(),e.comment.child_comments.length&&!e.canModerate()||(e.parentComment&&e.$parent.sliderClose(),$("#comment-"+e.comment._id).remove())})},e.refuse=function(){return"refused"===e.comment.status?void e.hideDeletionPopin():void m.disapprove(e.comment).then(function(){e.hideDeletionPopin()})},e.signalAsSpam=function(t){t.preventDefault(),l("are you sure").then(function(t){confirm(t)&&m.signalAsSpam(e.comment,e.parentComment).success(})},e.checkIsBan=function(){m.isBan({comment_id:e.comment._id}).success(function(t){if(t){if(t.gcCode&&410===t.gcCode)return void(d.gcUser.can_moderate=!1);if(t.shadow)var i="shadow banned";else if(t.permanent)var i="permanent banned";else var i="temporary banned";var r=l.instant(i,{date:o("simpleDate")(t.date_end)});e.userIsBanned=!0}else{var r=l.instant("ban user");e.userIsBanned=!1}n.find(".gc-action-ban").attr("data-gc-tooltip",r)})},e.banUser=function(t,n){if(t.preventDefault(),e.userIsBanned)return e.unBanUser(t,n);n.guest?(d.banPopinUser=n.cached_author,d.banPopinVisible=!0,m.getComment(n._id).success(function(e){d.banPopinUser.ip=e[0].ip})):m.getUserInfos(n.author._id).success(function(e){d.banPopinUser=e.user,d.banPopinVisible=!0,m.getComment(n._id).success(function(e){d.banPopinUser.ip=e[0].ip})}),d.banPopinCallback=e.checkIsBan;var o=t.target.getBoundingClientRect(),i=o.top-225;i>0?d.banPopinCoord={y:i}:d.banPopinCoord=null},e.unBanUser=function(n,o){function i(n){m.getComment(o._id).success(function(o){n.ip=o[0].ip;var i=[];["pseudo","email","ip","account"].forEach(function(e){("ip"!==e||n.ip)&&("pseudo"!==e||n._id||(n.pseudo=n.username),i.push(m.unban({type:e,element:"account"===e?null:n[e],user:"account"===e?n:null})))}),t.all(i).then(e.checkIsBan)})}confirm(l.instant("unban confirmation"))&&(o.guest?i(o.cached_author):m.getUserInfos(o.author._id).success()},d.$on("logged_in",,e.startVote=e.showRealContent=function(){return"approved"===e.comment.status||"pending"===e.comment.status||!(!e.comment.shadow||!e.isOwner())},e.isOwner=function(){return d.gcUser&&e.comment.author&&e.comment.author._id===d.gcUser._id},e.emitToChild=function(){e.$broadcast("editorial",{activate:!0}),d.ecd_creation_mode=!d.ecd_creation_mode},e.pinComment=e.$on("editorial",function(t,n){e.answer_mode=!1,e.ecd_creation_mode=n.activate,e.comment.editor_choice=!1}),e.answer=function(){d.votePopin={};var t;e.answer_mode||(t=m.getRootComment(e.comment._id)),e.answer_mode=!e.answer_mode,e.childComment=null,u(},e.addComment=function(t){if(0!==t.content.length)return t.parent_id=e.comment._id,m.addMessage(t).success(function(t){t.is_read=!0,e.bbf3d?e.comment.child_comments.push(t):(e.childComment=t,e.comment.child_comments.unshift(t)),e.answer_mode=!1,e.slide_index=0,e.sliderPage=0,u(function(){h.computeNbVisibleAvatar()},0,!1)}).error(function(e){c.error("Cannot send the comment",e),e&&411===e.gcCode&&c.error("User not complete (missing email)")})},e.editComment=function(e){return m.updateMessage(e)},e.closeAnswer=e.editorChoice=e.slide_index=0,e.sliderPage=0,e.slideTo=function(t){var n=t+h.maxVisibleAvatar*e.sliderPage;e.showComment(e.comment.child_comments[n])},e.canSlideNext=function(){return e.slide_index+h.maxVisibleAvatar*e.sliderPage<e.comment.count_child-1&&e.slide_index<h.maxVisibleAvatar-1},e.sliderNext=function(){mixpanel.track("comment:show_next_reply"),e.slideTo(Math.min(e.slide_index+1,h.maxVisibleAvatar))},e.canShowArrow=function(){return 0===e.slide_index&&0===e.sliderPage||!e.childComment},e.canSlidePrev=function(){return e.slide_index>0&&e.childComment},e.sliderPrev=function(){mixpanel.track("comment:show_prev_reply"),e.slideTo(Math.max(e.slide_index-1,0))},e.canShowArrowIcon=e.canSlideNextPage=function(){return e.slide_index===h.maxVisibleAvatar-1&&e.slide_index+e.slide_index*e.sliderPage<e.comment.count_child-1},e.sliderNextPage=function(){mixpanel.track("comment:show_next_page"),e.getChildComments().then(},e.canSlidePrevPage=function(){return 0===e.slide_index&&e.sliderPage>0&&e.childComment},e.sliderPagePrev=function(){mixpanel.track("comment:show_prev_page"),e.sliderPage-=1,e.slideTo(0)},e.sliderDontOpen=e.sliderClose=e.closeParent=e.getRank=function(e){if(e.parent_id){var t=m._comments[e.parent_id];if(t){var n=t.child_comments.findIndex(function(t){return t._id===e._id});if(n!==-1)return n+1}}},e.canOpenBbf3d=function(){var t=d.website.bbf3d_level;return!!t&&(!(!d.bbf3dVisible||!e.bbf3d)||(e.comment.child_comments.length>=t||void 0))},e.openBbf3d=function(t){if(e.canOpenBbf3d())if(mixpanel.track("comment:show_all_replies"),d.bbf3dCount){e.bbf3dLevel=d.bbf3dCount,e.bbf3dVisible=!0,e.bbf3dComment=e.comment;d.$on("bbf3d-close",function(t,n){n===e.bbf3dLevel&&(e.bbf3dLevel=null,e.bbf3dVisible=!1,e.bbf3dComment=null)})}else d.bbf3dVisible=!0,d.bbf3dComment=e.comment},e.commentFullscreen=null,e.openCommentFullscreen=function(t){d.isPopin=!0;var n=t.target.getBoundingClientRect(),o=w.getScrollPosition();if(d.searchMode)var i=n.top+o.top-220+"px";else var i=n.top+o.top-80+"px";e.commentFullscreenTop=i,m.populate(e.comment._id).then(function(t){var n=m.recursiveFind(t,e.comment._id);for(n.active=!0;n.parent_id;)n=m._comments[n.parent_id],n.active=!0;if(d.searchMode){d.modalFullScreen=!0;var o=m.getLastChildComment(t);t.defaultId=e.comment._id,g.shortenUrl(o.thread.url||document.URL,o._id).success(function(e){t.url=e.short_url,m._comments[t._id]=t,d.$broadcast("comment:detail:open",t)})}else m._comments[t._id]=t,e.commentFullscreen=t})["catch"](},e.openCommentFullscreenAndWriteCommment=function(t){d.isPopin=!0,d.modalFullScreen=!0;var n=t.target.getBoundingClientRect(),o=w.getScrollPosition(),i=n.top+o.top-80+"px";e.commentFullscreenTop=i,m.populate(e.comment._id).then(function(e){var t=m.getLastChildComment(e);g.shortenUrl(t.thread.url||document.URL,t._id).success(function(t){e.url=t.short_url,e.answer_mode=!0,d.$broadcast("comment:detail:open",e)})})},e.closeCommentFullscreen=e.populateParent=function(){var t=m.comments.findIndex(;m.populate(e.comment._id).then(function(n){var o=m.comments.findIndex(;o!==-1&&m.comments.splice(o,1),m._comments[n._id]=n;var n=e.comment;for(n.active=!0;n.parent_id;)n=m._comments[n.parent_id],n.active=!0;n.isShown=!0,n.child_comments.find(,m.comments[t]=n,u(function(){var e=$("#comment-"+n._id);d.$emit("scrollTo",e.offset().top-d.fixedHeaderHeight),_.activate(n._id)},1e3)})},e.logCmt=e.addChildComments=function(){if(!e.comment.isSearch){var t=d.website.loading_depth-2,n=p.getUser();n&&"undefined"!=typeof n.loading_depth&&n.loading_depth!==-1&&(t=n.loading_depth),t=t||k;var o=e.depth>1&&m.getRootComment(e.comment._id).already_displayed_once,i=w.getParameterByName("comment_id");if(!e.childComment&&!e.bbf3d&&e.comment.child_comments.length&&0!==e.depth&&e.comment._id!==i&&(o||e.depth<t)){var r=e.comment.child_comments[0];e.childComment=r,r.is_new=!1,C(r)}if((e.depth===t||0===e.comment.child_comments.length)&&!e.comment.parent){var a=m.getRootComment(e.comment._id);a.already_displayed_once=!0}e.comment.child_comments.map(.some(function(t,n){return t.active===!0&&(t.is_read=!0,u(function(){e.sliderPage=Math.floor(n/h.maxVisibleAvatar),e.slide_index=n%h.maxVisibleAvatar,e.childComment=t},0),!0)})}},e.initDisplayIndex=function(e,t){"object"===_typeof(e)&&(e.display_index=t)},e.notifyViewAvatarChanged=]).directive("comment",function(){return{replace:!0,restrict:"E",scope:{comment:"=",root:"=",depth:"=",parentId:"@?",parentComment:"=?",bbf3d:"@?",ecdCreationMode:"@",searchMode:"@"},templateUrl:"comment.html",controller:"CommentController",link:function(e,t){e.ecd_creation_mode="true"===e.ecdCreationMode,e.$watch("comment._id",function(){e.init(),e.addChildComments()}),e.$watch("comment",function(t,n){var o=t.count_child===n.count_child;if(e.childComment&&o){var i=t.child_comments.find(;e.childComment.child_comments=i.child_comments}},!0)}}}),angular.module("GraphCommentModule").controller("Bbf3dController",["$scope","$element","$timeout","$translate","$rootScope","CommentService","Utils",function(e,t,n,o,i,r,a){i.bbf3dCount||(i.bbf3dCount=0),e.openBbf3d=function(){e.showBbf3dOverlay=0===i.bbf3dCount,e.bbf3dLimit=20,e.bbf3dLevel=i.bbf3dCount,document.body.classList.add("no-scroll");var o=document.querySelector("#comment-"+e.comment._id),c=Math.max(0,o.getBoundingClientRect().top-100);if(0===i.bbf3dCount&&a.inIframe()?e.bbf3dTop=c+parseInt(i.fixedHeaderHeight)+40+"px":e.bbf3dTop="10px",0===i.bbf3dCount){var s=a.getScrollPosition();e.bbf3dScrollTop=s.top}else e.bbf3dScrollTop=0;i.bbf3dCount+=1,r.getThread({bbf3d:!0,parent_id:e.comment._id,offset:20,limit:1e4}).success(function(t){e.comment.child_comments=r._comments[e.comment._id].child_comments}),n(function(){e.bbf3dInitialScroll=a.inIframe()?c:document.querySelector(".gc-all-answers.has-overlay").scrollTop}),n(function(){var n=t[0].querySelectorAll(".gc-all-answers-comment .gc-is-new");n.length&&(e.bbf3dObserver=new IntersectionObserver(function(t){var n=t.filter(;n.forEach(function(n){var o=t[0].target;if(o){e.bbf3dObserver.unobserve(o);var i=o.id.replace("comment-",""),a=r.retrieveComment(i);ReadStatusService.markAsRead(a),a.is_new=!1,checkParentsHasNoMorNewComments(a)}})},{threshold:1}),n.forEach()})},e.closeBbf3d=function(t){i.bbf3dCount=e.bbf3dLevel,0===i.bbf3dCount&&(document.body.classList.remove("no-scroll"),i.bbf3dVisible=!1),i.$emit("bbf3d-close",e.bbf3dLevel),e.bbf3dObserver&&e.bbf3dObserver.disconnect(),t&&(a.inIframe()?i.$emit("scrollTo",e.bbf3dInitialScroll,null,0):document.querySelector(".gc-all-answers.has-overlay").scrollTo(0,e.bbf3dInitialScroll))},e.bbf3dShowMore=e.addComment=function(e){return r.addMessage(e)},e.editComment=]).directive("bbf3d",function(){return{replace:!0,restrict:"E",scope:{comment:"="},templateUrl:"bbf3d.html",controller:"Bbf3dController",link:}),angular.module("GraphCommentModule").controller("WriteCommentController",["$scope","$rootScope","$element","$window","$log","$timeout","$document","$filter","$sce","GcUser","CommentService","EmoticonService","EmbedService","WriteCommentFormatHandler","LocalStorageService","SelectionCoordinate","Utils","API_URL","TMP_ID",function(e,t,n,o,i,r,a,c,s,u,l,d,m,p,f,g,h,v,_){function b(){u.hasPrivileges()?(e.comment.admin_boost=f.getItem("admin_boost"),"undefined"==typeof e.comment.admin_boost&&(e.comment.admin_boost=!0)):e.comment.admin_boost=!1}unction y(e,t){if(o.getSelection){var i=o.getSelection(),a=i.getRangeAt(0);if(!C(a.startContainer,"gc-comment-textarea"))return;a.collapse(!1),a.insertNode(e),r(function(){a.setStartAfter(e),i.removeAllRanges(),i.addRange(a),n.find(".gc-comment-textarea").trigger("gc-update-value")})}}function C(e,t){return!!(e.className&&e.className.indexOf(t)>=0)||!!e.parentNode&&C(e.parentNode,t)}function S(e,n){l.website.edition.formatting&&t.$broadcast("smedPopup",{action:"open",coordinates:{x:n.x+n.width/2,y:n.y},callbacks:p})}function k(){o.document.selection?o.document.selection.empty():window.getSelection&&o.getSelection().removeAllRanges()}function P(n){var o=u.getGuest(),i=u.getUser()||o,a={_id:n._id||_,author:i._id,admin_boost:n.admin_boost,child_comments:n.child_comments||[],created_at:n.created_at||new Date,content:d.replaceHtmlImgByUnicode(n.content),comments:n.comments||1,cached_author:n.cached_author||{username:i.username,picture:i.picture}};if(o&&(a.username=o.username,a.email=o.email),e.parentComment&&!e.comment.editing){a.parent_id=e.parentComment._id;for(var c=e.parentComment._id;null!==c&&l._comments.hasOwnProperty(c)&&"undefined"!=typeof l._comments[c];)l._comments[c].comments+=1,c=l._comments[c].parent_id?l._comments[c].parent_id:null}e.submitted({message:a}).success(function(n){if(e.comment.editing?e.comment.editing=!1:e.comment.content="",f.removeItem("comment_edit_"+e.comment._id),e.hideLoader(),e.clearEmbeds(),t.$broadcast("textarea:update"),t.$broadcast("smedPopup",{action:"close"}),t.lastCommentRead=n._id,f.setItem("last_comment_read_"+l.thread_id,n._id),e.parentComment||(l.commentsAdded=0),l.total_comments++,e.parentComment&&!e.comment.editing){var o=u.getUser();if(o&&"false"===e.hasVoted&&(e.parentComment.author&&e.parentComment.author._id!==u.getUser()._id||e.parentComment.guest)){t.votePopin={comment:e.parentComment,required:!0},e.bbf3d&&r(function(){t.$emit("scrollTo",$(".gc-vote").offset().top-50)},500);var i=t.$on("comment:voted",,a=t.$on("vote:cancel",;return!1}}}).error(function(o){if(e.hideLoader(),o.err)if("comment too long"===o.err)e.commentTooLong=!0;else if("user is banned"===o.err)u.getUser()?u.refresh(function(){e.detectBanWarning()}):e.detectBanWarning();else if("profile is deleted"===o.err&&"orange"===l.website.custom_client){t.spupLog('[spup] spup "profile is deleted"');
var i=l.website;i.custom_client_login===!0&&window.parent.postMessage({target:"spup",command:"manage",params:[]},"*")}else"profile required"===o.err&&t.$broadcast("profile-popin:open",u.getUser()._id,{fromMenu:!0});if(o.msg&&"route need authentication"===o.msg&&"orange"===l.website.custom_client){t.spupLog("[spup] route need authentication"),u.registerSpup(t.orangeUser);var r=t.$on("spup_registered",function(){t.spupLog("[spup] route need authentication ... done"),P(n),r()})}})}function U(){if(!(u.isLocallyLogged()||l.website.guest&&u.getGuest())){i.debug("User not logged."),l.setSavedComment(e.comment.content,e.parentComment),t.ssoUnidirectionalEnabled()&&e.hideLoader(),t.$broadcast("show:popup",{page:"signup",target:n[0],offset:-200});var o=t.$on("logged_in",function(t,n){return l.removeSavedComment(),e.parentComment&&(e.parentComment=l._comments[e.parentComment._id]),"object"===_typeof(e.parentComment)&&e.parentComment.rating.has_voted===!0?void P(e.commentPushWhileNotLogged[e.commentPushWhileNotLogged.length-1]):u.isGuest()?void P(e.commentPushWhileNotLogged[e.commentPushWhileNotLogged.length-1]):(e.commentPushWhileNotLogged.length>0&&P(e.commentPushWhileNotLogged[e.commentPushWhileNotLogged.length-1]),e.commentPushWhileNotLogged=[],void o())}),r=t.$on("auth:cancel",;return!1}return e.commentPushWhileNotLogged.length>0&&P(e.commentPushWhileNotLogged[e.commentPushWhileNotLogged.length-1]),e.commentPushWhileNotLogged=[],!1}e.GcUser=u,e.moment=moment,e.CommentService=l,e.trackingSent=!1,e.embeds=[],e.embedBatchId=0,e.oldEmbedUrlsDetected=[],e.isMobile=h.isMobile(),e.comment?e.comment.editing&&(e.comment.content=f.getItem("comment_"+e.comment._id)||c("commentImages")(e.comment.content)):e.comment={content:""},b(),t.$on("logged_in",function(){var t=u.getUser();t&&(e.comment.author={_id:t._id}),b()}),t.$on("thread",function(){e.parentComment||e.comment.content||(e.comment.content=f.getItem("new_comment_"+l.thread_id))}),t.$on("lang:change",function(t,n){var o={fr:"https://support.graphcomment.com/hc/fr/articles/360011204059-Qui-a-bloqu%C3%A9-mon-compte-ou-supprim%C3%A9-mon-commentaire-",en:"https://support.graphcomment.com/hc/en-us/articles/360011204059-Who-blocked-my-account-or-deleted-removed-my-comment-"};e.banUrl="fr"===n?o.fr:o.en}),e.showSigninPopup=function(o){l.setSavedComment(e.comment.content,e.parentComment),t.$broadcast("show:popup",{page:"signin",target:n[0],offset:-200})},e.showSignupPopup=function(o){l.setSavedComment(e.comment.content,e.parentComment),t.$broadcast("show:popup",{page:"signup",target:n[0],offset:-200})},e.cancelEdit=function(){mixpanel.track("comment:cancel"),e.banWarning=null,e.comment.editing?(e.comment.editing=!1,e.comment.content=e.comment.initialContent):e.comment.content="",e.parentComment?f.removeItem("comment_"+e.parentComment._id):f.removeItem("new_comment_"+l.thread_id),w(),e.clearEmbeds(),e.close(),e.commentTooLong=!1},t.$on("reset_write_comment",e.cancelEdit),e.isEmoticonsContainerActive=!1,e.emoticonList=["\ud83d\ude00","\ud83d\ude2c","\ud83d\ude01","\ud83d\ude02","\ud83d\ude03","\ud83d\ude04","\ud83d\ude05","\ud83d\ude06","\ud83d\ude07","\ud83d\ude09","\ud83d\ude0a","\ud83d\ude42","\ud83d\ude43","\ud83d\ude0b","\ud83d\ude0c","\ud83d\ude0d","\ud83d\ude18","\ud83d\ude17","\ud83d\ude19","\ud83d\ude1a","\ud83d\ude1c","\ud83d\ude1d","\ud83d\ude1b","\ud83e\udd11","\ud83e\udd13","\ud83d\ude0e","\ud83e\udd17","\ud83d\ude0f","\ud83d\ude36","\ud83d\ude10","\ud83d\ude11","\ud83d\ude12","\ud83d\ude44","\ud83e\udd14","\ud83d\ude33","\ud83d\ude1e","\ud83d\ude1f","\ud83d\ude20","\ud83d\ude21","\ud83d\ude14","\ud83d\ude15","\ud83d\ude41","\ud83d\ude23","\ud83d\ude16","\ud83d\ude2b","\ud83d\ude29","\ud83d\ude24","\ud83d\ude2e","\ud83d\ude31","\ud83d\ude28","\ud83d\ude30","\ud83d\ude2f","\ud83d\ude26","\ud83d\ude27","\ud83d\ude22","\ud83d\ude25","\ud83d\ude2a","\ud83d\ude13","\ud83d\ude2d","\ud83d\ude35","\ud83d\ude32","\ud83e\udd10","\ud83d\ude37","\ud83e\udd12","\ud83e\udd15","\ud83d\ude34","\ud83d\ude08","\u2764\ufe0f","\ud83d\udc4d","\ud83d\udc4e","\ud83d\udca3","\ud83c\udf89"],e.emoticonButtonClick=function(t){t.stopPropagation(),e.isEmoticonsContainerActive?w():e.isEmoticonsContainerActive=!0,e.smartEditTooltip=!1},a.on("click",function(e){var t=document.querySelector(".gc-comment-emoticon-popin");t&&!t.contains(e.target)&&w()}),e.chooseEmoticon=function(t,i){t.preventDefault(),t.stopPropagation();n[0].querySelector(".gc-comment-textarea");if(d.supportsEmoticons)var a=o.document.createTextNode(i);else var a=d.emoticonToImgElement(i);y(a),r(},e.renderEmoticon=function(e){return d.supportsEmoticons?e:s.trustAsHtml(d.emoticonToImage(e))},e.detectBanWarning=function(){var t=u.getUser(),n=u.getGuest();t&&t.is_ban?(e.banWarning=t.ban[0],e.closeBanWarning=:n?u.isGuestBanned().success(function(t){var n=t[0];n&&n.active&&!n.shadow&&(e.banWarning=n)}):e.banWarning=null},e.getBanMessage=function(e){var t=l.website;return t.moderation_content&&t.moderation_content.active?t.moderation_content[e]:e+" banned message"},e.writeComment=function(){e.detectBanWarning(),e.trackingSent===!1&&(mixpanel.track("comment:is_writting"),e.trackingSent=!0),e.comment.editing?f.setItem("comment_edit_"+e.comment._id,e.comment.content):e.parentComment?f.setItem("comment_"+e.parentComment._id,e.comment.content):f.setItem("new_comment_"+l.thread_id,e.comment.content);var t=l.website.embeded_external_link,n=m.findEmbedables(e,e.comment.content),o=e.oldEmbedUrlsDetected.slice(0,t),i=n.slice(0,t);(o.length!==i.length||o.some()&&(e.clearEmbeds(),m.loadEmbeds(e,i,t)),e.oldEmbedUrlsDetected=n},e.onEmbedDetected=e.clearEmbeds=function(){e.embeds=[],e.oldEmbedUrlsDetected=[],e.embedBatchId=Date.now()},e.onKeydown=e.$on("comment:create",function(t,n){e.comment.content=f.getItem("comment_"+n.id)}),e.TextAreaControl={onSelection:S},o.document.onmouseup=function(){""===g.getSelectionInfos().text&&t.$broadcast("smedPopup",{action:"close"})},o.document.onkeyup=function(e){w(),e=e||window.event;var n=!1;n="key"in e?"Escape"===e.key:27===e.keyCode,n&&k(),e.target.classList.contains("gc-smed-input")||t.$broadcast("smedPopup",{action:"close"})},e.checkUploadLimit=function(){if(!l.website.edition.upload)return!1;if(!u.isLocallyLogged())return console.error("should be logged to upload"),!1;if(0===l.website.embeded_files)return console.error("upload is disabled"),!1;var t=l.getNumberOfHostedFiles(e.comment.content);return!(t>=l.website.embeded_files)||(console.error("upload limit reached (%s max - %s already uploaded)",l.website.embeded_files,t),!1)},e.paste=function(t){t.preventDefault();var n=(t.originalEvent||t).clipboardData,o=n.getData("text/html"),i=new DOMParser,r=i.parseFromString(o,"text/html");if(!o&&(o=(t.originalEvent||t).clipboardData.getData("text/plain"),o&&(!n.files.length||!e.checkUploadLimit())))return void document.execCommand("insertHTML",!1,o);if(r&&r.body){r.body.normalize(),o=r.body.innerHTML;var a=i.parseFromString(o.replace(/<img[\s\S]*?>/g,""),"text/html");a.body.innerText.trim()||(o="")}var s=o.replace(/<(?!a|img)\s*(\w+)[^<]*?>/gm,"<$1>").replace(/<img[^<]+src="(?!https?:\/\/).+"[^<]*?>/gm,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<style>[\s\S]*?<\/style>/g,"").replace(/style="[\s\S]*?"/g,"").replace(/class="[\s\S]*?"/g,"");if(s&&document.execCommand("insertHTML",!1,s),e.checkUploadLimit()&&n.items.length){if(!e.checkUploadLimit())return;for(var u=0;u<n.items.length;u++){var d=n.items[u];if(d.type.match(/image.*/)){if(o&&n.types.indexOf("text/rtf")>=0)return;t.preventDefault();var m=d.getAsFile();return e.showLoader(),void l.addFile(m).success(function(t){if(t.status&&413===t.status)e.onUploadError(t);else{var n=c("commentImages")("".concat(t._id,".").concat(t.metadata.extension))+"<br>";document.execCommand("insertHTML",!1,n),e.hideLoader()}}).error(function(t){e.onUploadError(t)})}}}},e.uploadFile=function(t){if(e.checkUploadLimit()){var n=t.target.files;if(n&&n.length){t.preventDefault();var o=n[0];e.showLoader(),l.addFile(o).success(function(t){t.status&&413===t.status?e.onUploadError(t):e.addHostedFile(t)}).error(}}},e.showLoader=function(){e.inProgress=!0,e.loaderVisible=!0},e.hideLoader=e.addHostedFile=function(t){e.hideLoader();var o=t._id+"."+t.metadata.extension;e.comment.content||(e.comment.content=""),""!==e.comment.content&&(e.comment.content+="<br>"),e.comment.content+=c("commentImages")(o)+"<br>&nbsp;",r(function(){h.iOS()||placeCaretAtEnd(n[0].querySelector(".gc-comment-textarea"))})},e.onUploadError=function(t){e.hideLoader(),t&&"ETOOBIG"===t.code?alert("The file you are uploading is too big (2Mb max)."):t&&t.err?alert(t.err):alert("There was an error with your upload.")},e.commentPushWhileNotLogged=[],e.canWriteComment=function(){var e=u.getUser();return!e||!e.is_ban||!e.is_ban.active||e.is_ban.shadow||e.is_ban.hide_ban_message},e.toggleAdminBoost=function(){e.comment.admin_boost=!e.comment.admin_boost,f.setItem("admin_boost",e.comment.admin_boost)},e.sendComment=function x(){if(e.comment.content=n.find(".gc-comment-textarea").html(),!(e.comment.content.length>l.website.graphcomment.length_comment)){if(e.commentTooLong=!1,e.detectBanWarning(),"orange"===l.website.custom_client){var o=t.spupLog("[spup] sendComment() init spup");var i=u.initSpup(x),r=t.$on("call_reset_spup_comment",;if(!i)return void e.showLoader();o()}if(e.canWriteComment()){e.showLoader(),e.parentComment?f.removeItem("comment_"+e.parentComment._id):f.removeItem("new_comment_"+l.thread_id);var a=JSON.parse(JSON.stringify(e.comment));return e.commentPushWhileNotLogged.push(a),U()}}},e.openGuestForm=function(){e.guest={},e.showGuestForm=!0},e.closeGuestForm=e.forms={},e.sendCommentAsGuest=function(){return e.forms.fCommentGuest&&e.forms.fCommentGuest.$invalid?void console.error("[gc] invalid guest form",e.form.fCommentGuest):(u.setGuest({username:e.guest.username,email:e.guest.email}),mixpanel.track("auth:guest_success"),e.sendComment(),void e.closeGuestForm())}}]).directive("writeComment",["$rootScope","Utils",function(e,t){return{restrict:"E",replace:!0,scope:{active:"@",bbf3d:"@?",submitted:"&",comment:"=?",parentComment:"=?",disableAutoFocus:"@",close:"&",hasVoted:"@",rating:"="},controller:"WriteCommentController",templateUrl:"write_comment.html",link:function(e,n){setTimeout(function(){var o=n[0].querySelector(".gc-comment-textarea");e.comment.editing?t.iOS()||placeCaretAtEnd(o):e.parentComment&&(t.iOS()||e.disableAutoFocus||o.focus())},10)}}}]).service("WriteCommentFormatHandler",["$document","$window","SelectionCoordinate",function(e,t,n){this.bold=function(t){e[0].execCommand("bold",!1,null),t.close()},this.italic=function(t){e[0].execCommand("italic",!1,null),t.close()},this.underline=function(t){e[0].execCommand("underline",!1,null),t.close()},this.code=function(t){var o=n.getSelectionInfos().text;if(/^`/.test(o))var i=o.replace(/^[`]+(.*[^`])[`]+$/,"$1");else if(o.match(/\n/g)||o.length>40)var i="```<br>"+o.replace(/\n/g,"<br>")+"<br>```";else var i="`"+o+"`";e[0].execCommand("insertHTML",!1,i),t.close()},this.link=function(n,o){e[0].execCommand("CreateLink",!1,o);var i=t.getSelection().focusNode.parentNode,r=angular.element(i);r.addClass("gc-link"),r.attr("target","_blank"),r.attr("rel","nofollow"),n.close()}}]),angular.module("GraphCommentModule").directive("searchComment",["CommentService","$rootScope","$anchorScroll","$timeout",function(e,t,n,o){return{restrict:"E",replace:!0,templateUrl:"search.html",link:function(i,r,a){i.CommentService=e,i.searchValue="",i.commentNumber=null,i.limit=10,i.isDetails=!1;var c=null;i.searchComments=function(t){13===t.keyCode&&c!==i.searchValue&&(i.commentNumber=null,i.list=[],c=i.searchValue,e.getSearch({search:i.searchValue}).then()},i.setPage=function(t){i.currentPage!==t&&(i.currentPage=t,e.getSearch({search:i.searchValue,page:t}),o(300))},t.$on("comment:detail:close",function(){i.isDetails=!1,i.commentDetails=null}),t.$on("comment:detail:open",function(e,r){n("search"),i.isDetails=!0,t.hideHeader=!0,i.commentDetails=r,o(function(){i.showDetails=!0},300)})}}}]),function(){angular.module("gc.filters",[]).factory("getUserImage",function(){return function(e){return e?e.cached_author?e.cached_author.picture:e.picture:"img/avatar_3.png"}}).filter("getUserAvatar",["$filter",function(e){return function(t){return'\n      <div class="gc-avatar">\n        <img\n           class="gc-profile-picture"\n           src="'.concat(e("extractImgCmt")(t),'"\n           alt=""\n           />\n           </div>\n      <b>').concat(t.cached_author.username,"</b>\n    ")}}]).filter("slice",function(){return function(e,t){if(!Array.isArray(e))return[];var n=Number(t)||0;return e.slice(n)}}).filter("fromNow",function(){return function(e){return moment(new Date(e)).fromNow()}}).filter("simpleDate",function(){return function(e){return moment(new Date(e)).format("LLLL")}}).filter("shortDate",function(){return function(e){return moment(new Date(e)).format("LL")}}).filter("dateTime",function(){return function(e){return moment(new Date(e)).format("YYYY-MM-DD HH:mm:ss")}}).filter("moment",function(){return function(e,t){return moment(new Date(e)).format(t)}}).filter("plusminus",function(){return function(e){return e>0?"+"+e:e}}).filter("plusminusLabel",function(){return ).filter("truncate",function(){return function(e,t,n){if(!e)return"";isNaN(t)&&(t=10);var o="...";return n?e:e.length<=t||e.length-o.length<=t?e:e.substring(0,t-o.length)+o}}).filter("extractImgCmt",["BASE_URL",function(e){return function(t){if(!t.cached_author)return"";var n=t.cached_author.avatar||t.cached_author.picture;return/^(https?|data):/.test(n)?n:"http"===n.slice(0,"http".length)?n:e+n}}]).filter("userImage",["BASE_URL",function(e){return function(t){return t&&"string"==typeof t.picture&&t.picture.indexOf("images/avatar_3.png")===-1&&!/^(https?|data):/.test(t.picture)?"http"===t.picture.slice(0,"http".length)?t.picture:e+t.picture:t&&"string"==typeof t.picture&&/^(https?|data):/.test(t.picture)?t.picture:"/images/avatar_3.png"}}]).filter("ecdUserImage",["BASE_URL",function(e){return function(t){return t&&"string"==typeof t.user_picture&&t.user_picture.indexOf("images/avatar_3.png")===-1&&!/^(https?|data):/.test(t.user_picture)?"http"===t.user_picture.slice(0,"http".length)?t.user_picture:e+t.user_picture:t&&"string"==typeof t.user_picture&&/^(https?|data):/.test(t.user_picture)?t.user_picture:"/images/avatar_3.png"}}]).filter("removeDuplicatedAvatar",function(){return function(e){var t=[];return e.forEach(function(e){var n=!1;t.forEach(,n||t.push(e)}),t}}).filter("extractUsername",function(){return function(e){return e.username?e.username:e.cached_author?e.cached_author.username:(console.error("[GcFilter] failed to extract username",e),"<username>")}}).filter("extractProfileUrl",["extractUsernameFilter","BASE_URL",function(e,t){return function(n){var o=e(n);return"Deleted User"===o?"":t+"/users/"+o}}]).filter("beautifyJson",function(){return function(e){var t=angular.copy(e);return JSON.stringify(t,null,4)}}).filter("capitalize",function(){return function(e){return void 0!==e?e.charAt(0).toUpperCase()+e.slice(1):""}}).filter("highlight",function(){return function(e,t){return!t.term||t.term.length<3?e:e.replace(new RegExp(t.term,"gi"),'<span class="match">$&</span>')}}).filter("bytesToMb",function(){var e=function(e,t){var n=1024,o=1024*n,i=1024*o,r=1024*i;return e>=0&&e<n?e+" B":e>=n&&e<o?(e/n).toFixed(t)+" KB":e>=o&&e<i?(e/o).toFixed(t)+" MB":e>=i&&e<r?(e/i).toFixed(t)+" GB":e>=r?(e/r).toFixed(t)+" TB":e+" B"};return ).filter("limitHtml",function(){return function(e,t,n){var o=function(e){var t=[],n=function(e){return e.replace(/<[\/]?([^>]*)>/,"$1")};return angular.forEach(e,function(o,i){/<\//.test(o)&&(0===i?t.push(o):n(o)!==n(e[i-1])&&t.push(o))}),t.join("")},i=function(e,t){var n,o=!1,i=!1,r=!1,a=!1,c={textCounter:0,offsetCounter:0,setEllipsis:!1,overElementArray:[]};return angular.forEach(e,function(e){a=c.textCounter<t,"<"!==e||o||i?"&"!==e||o||i?o?(!a&&(n+=e),">"===e&&(!a&&c.overElementArray.push(n),r=!0,o=!1)):";"===e&&i&&(i=!1,c.textCounter++,r=!0):i=!0:(!a&&(n="<"),o=!0),a?(o||i||r||c.textCounter++,c.offsetCounter++):c.setEllipsis=!0,r=!1}),c},r=i(e.toString(),t);return e.toString().substr(0,r.offsetCounter)+n+o(r.overElementArray)}}).filter("commentImages",["API_URL","CommentService",function(e,t){return function(n){var o=t.website.embeded_external_link;return htmlImages(n,e,o)}}]).filter("htmlContent",["API_URL","CommentService",function(e,t){return function(n){var o=t.website.embeded_external_link;return htmlImages(htmlContent(n,t.website.edition.link),e,o)}}]).filter("orderByCustomFunction",.filter("htmlSafe",["$sce",).filter("getDomain",function(){return ).filter("isOwner",["CommentService",function(e){return function(t){var n=e.website,o=t.author&&t.author._id;return n.owner===o}}]).filter("isAdministrator",["CommentService",function(e){return function(t){var n=e.website,o=t.author&&t.author._id;return n.administrators&&n.administrators.indexOf(o)!==-1}}]).filter("isModerator",["CommentService",function(e){return function(t){var n=e.website,o=t.author&&t.author._id;return n.moderators&&n.moderators.indexOf(o)!==-1}}]).filter("round",[function(){return function(e,t){t=t||0;var n=0===t?1:10*t;return Math.round(e*n)/n}}])}(),function(){angular.module("gc.directives",[]).directive("minLengthForgiving",function(){return{require:"ngModel",link:function(e,t,n,o){function i(e){return o.$setValidity("min-length",e.length>=r),e}var r=Number(n.minLengthForgiving);o.$parsers.push(i)}}}).directive("maxLengthForgiving",function(){return{require:"ngModel",link:function(e,t,n,o){function i(e){return o.$setValidity("max-length",e.length<=r),e}var r=Number(n.maxLengthForgiving);o.$parsers.push(i)}}}).directive("editableMaxlength",function(){return{require:"ngModel",link:function(e,t,n,o){var i=Number(n.editableMaxlength);t.on("keydown paste",function(e){$(this).text().length>=i&&8!=e.keyCode&&e.preventDefault()})}}}).directive("waitImageLoaded",function(){return{restrict:"A",link:function(e,t,n){$(t).css("visibility","hidden"),t.bind("load",,t.bind("error",function(){})}}}).directive("convertToNumber",function(){return{require:"ngModel",link:function(e,t,n,o){o.$parsers.push(,o.$formatters.push(}}}).directive("time",["$filter",function(e){return{restrict:"E",link:function(t,n,o){if(o.datetime){var i=moment(o.datetime,"YYYY-MM-DD HH:mm:ss").toDate();setInterval(function(){n.text(e("fromNow")(i))},6e4)}}}}]).directive("visible",function(){return{restrict:"A",link:function(e,t,n){e.$watch(n.visible,}}}).directive("html",["$rootScope","$timeout",function($rootScope,$timeout){return{restrict:"A",link:function link(scope,element,attrs){element[0].insertAdjacentHTML("beforeend",attrs.html),$timeout(function(){for(var $scripts=element[0].querySelectorAll("script"),i=0;i<$scripts.length;i++)eval($scripts[i].innerHTML)},Number(attrs.htmlScriptTimeout)||0)}}}])}(),angular.module("gc.custom-on-change",[]).directive("customOnChange",function(){return{restrict:"A",link:function(e,t,n){var o=e.$eval(n.customOnChange);t.on("change",,t.on("$destroy",function(){t.off()})}}}),angular.module("gc.drop-upload",[]).directive("dropUpload",["CommentService",function(e){return{restrict:"A",scope:{callbacks:"&dropUpload"},link:function(t,n,o){n.on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),n.on("dragenter",,n.on("drop",function(n){n.preventDefault(),n.stopPropagation();var o=t.callbacks(),i=n.originalEvent.dataTransfer;if(o.check()&&i&&i.files.length>0)for(var r=0;r<i.files.length;r++)return o.init&&o.init(),void e.addFile(i.files[r]).success(function(e){e.status&&413===e.status?o.error(e):o.done(e)}).error(function(e){o.error(e)});return!1})}}}]),angular.module("gc.fileread",[]).directive("fileread",[function(){return{scope:{fileread:"="},link:function(e,t,n){t.bind("change",function(t){e.$apply(function(){e.fileread=t.target.files[0]})})}}}]),angular.module("gc.ui.focus",[]).directive("focus",["$timeout",function(e){return{link:function(t,n,o){"false"!==o.focus&&(n[0].focus(),e(25))}}}]),angular.module("gc.fallback-avatar",[]).directive("fallbackSrc",function(){var e="/images/avatar_3.png";return{restrict:"A",link:function(t,n,o){o.ngSrc||o.src||n.attr("src",e),n.unbind("error"),n.bind("error",}}}),angular.module("gc.progress-bar",[]).directive("progressBar",,angular.module("gc.custom-scrollbar",[]).directive("customScrollbar",function(){return{restrict:"A",link:function(e,t,n){var o=OverlayScrollbars(t[0],{scrollbars:{autoHide:"move"},callbacks:{onScroll:function(e){t.trigger("custom-scroll",e)}}});t.data("custom-scrollbar",o)}}}),angular.module("utils.scroll",[]).directive("smoothScroll",["$rootScope","GcUser","CommentService","PostMessageService","Utils","$document","$window",function(e,t,n,o,i,r,a){function c(e,c,l,d){function m(){v=Date.now()-b,_=v/d,_=_>=1?1:_;var e={top:w.top-s(_)*(w.top-(g.top-10)),left:w.left-s(_)*(w.left-g.left)};p.scrollTo(e.left,e.top),_<1&&u(m)}var p=l||a;if(n.initDataVote(t.getUser()),"string"==typeof c){var f=r[0].querySelector(c);if(!f)return void console.error('[scroller] element "'+c+'" not found');var g=f.getBoundingClientRect()}else var g={left:0,top:c};if(d=isNaN(d)?800:d||0,i.inOverlay()&&!i.isMobile()){var h=8;return void window.overlayScrollbar.scroll({y:g.top-h},d,"easeOutQuart")}if(i.inIframe())return void o.postMessage("gc-scroll",{scrollTo:g.top-10,duration:d});var v,_,b=Date.now(),w=i.getScrollPosition();l&&(g={left:g.left+l.scrollLeft,top:g.top+l.scrollTop},w={left:w.left+l.scrollLeft,top:w.top+l.scrollTop}),u(m)}function s(e){return 1- --e*e*e*e}var u=a.requestAnimationFrame||function(e){return setTimeout(function(){e()},1e3/60)};return{restrict:"A",link:function(t){e.$on("scrollTo",c),t.$on("$destroy",function(){e.$off("scrollTo",c)}),window.debugScrollTo=c}}}]),angular.module("gc.ui.showMore",[]).directive("gcShowMore",["$rootScope","$compile","$sanitize","$filter","CommentService","Utils",function(e,t,n,o,i,r){var a=[];return{link:function(n,c){var s;n.$watch("comment",function(u){f((!s||s!==u.content)&&a.indexOf(u._id)===-1){if(a.push(u._id),u.parent_id){var d=e.commentOpened;if(u._id===d)return;if(d&&(d=i._comments[d])){var m=i.recursiveFind(d,u._id);if(m)return}}var p=u.content;s=u.content;var f=o("htmlContent")(p);f=o("emoticonsFallback")(f);var g=350;if(l(p)<=g||r.getParameterByName("comment_id")===u._id)return void c.empty().append(f);var h='<span ng-hide="comment.expanded" ng-click="comment.expanded = true">'+o("htmlContent")(o("limitHtml")(p,g,""))+"</span>",v='<span class="full-content" ng-show="comment.expanded">'+o("htmlContent")(p)+"</span>";h=o("emoticonsFallback")(h),v=o("emoticonsFallback")(v);var _='<span ng-hide="comment.expanded" ng-click="comment.expanded = true">...&nbsp;&nbsp;&nbsp;<span class="gc-show-more"      ng-mouseenter="expandAfter500ms()"      ng-mouseleave="leaveExpand()">  <span translate>readmore</span>  <span class="gcicon-readmore"></span></span></span>';c.empty().append(t(h)(n)).append(t(_)(n)).append(t(v)(n))}},!0)}}}]),angular.module("ui.bootstrap.dropdown",[]).constant("dropdownConfig",{openClass:"dropdown--open"}).service("dropdownService",["$document",function(e){var t=null;this.open=this.close=var n=function(e){var n=t.getToggleElement();e&&n&&n[0].contains(e.target)||t.$apply(function(){t.isOpen=!1})},o=]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate",).directive("dropdown",function(){return{restrict:"CA",controller:"DropdownController",link:}).directive("dropdownToggle",function(){return{restrict:"CA",require:"?^dropdown",link:}),angular.module("ngUpload",[]).directive("uploadSubmit",["$parse",function(){function e(t,n){t=angular.element(t);var o=t.parent();return n=n.toLowerCase(),o&&o[0].tagName.toLowerCase()===n?o:o?e(o,n):null}return{restrict:"AC",link:function(t,n){n.bind("click",function(t){if(t&&(t.preventDefault(),t.stopPropagation()),!n.attr("disabled")){var o=e(n,"form");o.triggerHandler("submit"),o[0].submit()}})}}}]).directive("ngUpload",["$log","$parse","$document",function(e,t,n){function o(e){var t,o=n.find("head");return angular.forEach(o.find("meta"),,angular.element(t)}var i=1;return{restrict:"AC",link:function(n,r,a){unction s(){p.unbind("load"),n.$$phase?c(!1):n.$apply(;try{var t,o=(p[0].contentDocument||p[0].contentWindow.document).body;try{t=angular.fromJson(o.innerText||o.textContent)}catch(i){t=o.innerHTML,e.warn("Response is not valid JSON")}n.$$phase?l(n,{content:t}):n.$apply(function(){l(n,{content:t})})}catch(r){d&&(n.$$phase?d(n,{error:r}):n.$apply()}}i++;var u={},l=a.ngUpload?t(a.ngUpload):angular.noop,d=a.errorCatcher?t(a.errorCatcher):null,m=a.ngUploadLoading?t(a.ngUploadLoading):null;a.hasOwnProperty("uploadOptionsConvertHidden")&&(u.convertHidden="false"!==a.uploadOptionsConvertHidden),a.hasOwnProperty("uploadOptionsEnableRailsCsrf")&&(u.enableRailsCsrf="false"!==a.uploadOptionsEnableRailsCsrf),a.hasOwnProperty("uploadOptionsBeforeSubmit")&&(u.beforeSubmit=t(a.uploadOptionsBeforeSubmit)),r.attr({target:"upload-iframe-"+i,method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});var p=angular.element('<iframe name="upload-iframe-'+i+'" border="0" width="0" height="0" style="width:0px;height:0px;border:none;display:none">');if(u.enableRailsCsrf){var f=angular.element("<input />");f.attr("class","upload-csrf-token"),f.attr("type","hidden"),f.attr("name",o("csrf-param").attr("content")),f.val(o("csrf-token").attr("content")),r.append(f)}r.after(p),c(!1),r.bind("submit",function(){var e=n[a.name];return(!e||!e.$invalid)&&((!u.beforeSubmit||u.beforeSubmit(n,{})!==!1)&&(p.bind("load",s),u.convertHidden&&angular.forEach(r.find("input"),function(e){var t=angular.element(e);t.attr("ng-model")&&t.attr("type")&&"hidden"===t.attr("type")&&t.attr("value",n.$eval(t.attr("ng-model")))}),void(n.$$phase?(m&&m(n),c(!0)):n.$apply()))})}}}]),angular.module("ngTouch",[]).directive("ngTouchstart",function(){function e(e,t){function n(n){var o=t.attr("ng-touchstart");e.$event=n,e.$apply(o)}t.bind("touchstart",n)}return e.$inject=["$scope","$element"],{controller:e}}).directive("ngTouchend",function(){function e(e,t){function n(n){var o=t.attr("ng-touchend");e.$event=n,e.$apply(o)}t.bind("touchend",n)}return e.$inject=["$scope","$element"],{controller:e}}),angular.module("gc.ng-repeat-done",[]).directive("ngRepeatDone",["$timeout",function(e){return{link:function(t,n,o){t.$last&&e(function(){t.$eval(o.ngRepeatDone)})}}}]),angular.module("ui-rangeSlider",[]).directive("rangeSlider",["$log","$window","$document","$timeout",function(e,t,n,o){return{restrict:"EA",replace:!0,scope:{start:"=",end:"=",step:"=",sliderValue:"=",slided:"&"},link:function(e,n,i){function r(t){if(!g&&!h)return void t.preventDefault();if(h=!1,s)var n=(t.clientX||t.changedTouches[0].clientX)-d,o=n/p;else var i=(t.clientY||t.changedTouches[0].clientY)-d,o=i/m;o=Math.max(0,Math.min(1,o));var r=Math.round(100*o),a=r%l;0!==a&&(a<l/2?r-=a:r+=l-a),o=r/100;var c=Math.abs(e.end-e.start/l)*l;f=Math.min(100/(c/Math.round(o*c)),100),u.css(s?"width":"height",f+"%"),t.preventDefault()}function a(){g&&(o(function(){var t=Math.round(f*(e.end-e.start)/100+e.start),n=t%l;0!==n&&(n<l/2?t-=n:t+=l-n),e.slided({value:t})}),g=!1)}var c,s=n.hasClass("is-horizontal"),u=n.find("span"),l=parseInt(i.step,10)||1;e.update=function(){c=100*(e.sliderValue-e.start)/(e.end-e.start),u.css(s?"width":"height",c+"%")},e.$watch("sliderValue",,o(function(){e.update()});var d,m,p,f,g,h;n.on("mousedown touchstart",function(e){var t=n[0].querySelector(".gc-slider-enlarger"),o=getComputedStyle(t);s?(p=t.getBoundingClientRect().width,p-=parseFloat(o.paddingLeft)+parseFloat(o.paddingRight),d=t.getBoundingClientRect().left,d+=parseFloat(o.paddingLeft)):(m=t.getBoundingClientRect().height,m-=parseFloat(o.paddingTop)+parseFloat(o.paddingBottom),d=t.getBoundingClientRect().top,d+=parseFloat(o.paddingTop)),h=!0,r(e),g=!0}),n.on("mousemove touchmove",r),n.on("mouseup touchend",a),t.addEventListener("mouseup",a)}}}]),angular.module("gc.ui.autoGrow",[]).directive("autoGrow",["$timeout","$rootScope",function(e,t){return{link:function(e,n,o){unction r(){var e=n.val().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/\s{2,}/g,function(e){return e.substr(1).split("").map(i).join("")+""});s.css({lineHeight:c.getPropertyValue("line-height"),fontSize:c.getPropertyValue("font-size"),wordWrap:c.getPropertyValue("word-wrap"),width:n[0].offsetWidth+"px"}),s.html(e);var t=o.autoGrowPadding?Number(o.autoGrowPadding):20;n.css("height",Math.max(s[0].offsetHeight+t,""===n.val()?a:s[0].offsetHeight+t)+"px")}var a=n[0].offsetHeight,c=getComputedStyle(n[0],null),s=angular.element('<div class="text-area-shadow"></div>').css({position:"absolute",top:"-10000px",left:"-10000px",
width:n[0].offsetWidth+"px",fontSize:c.getPropertyValue("font-size"),fontFamily:c.getPropertyValue("font-family"),lineHeight:c.getPropertyValue("line-height"),resize:"none"});angular.element(document.body).append(s),n.on("keyup keydown keypress change",r),setTimeout(function(){r()},1),e.$on("$destroy",,t.$on("textarea:update",}}}]),angular.module("gc.ui.contentselectable",[]).service("SelectionCoordinate",["$window",function(e){this.getSelectionInfos=function(t){t=t||e;var n,o,i=t.document,r=i.selection,a=0,c=0,s=0,u=0,l="";if(r)"Control"!==r.type&&(n=r.createRange(),n.collapse(!0),a=n.boundingLeft,c=n.boundingTop,s=n.boundingWidth,u=n.boundingHeight);else if(t.getSelection&&(l=window.getSelection().toString(),r=t.getSelection(),r.rangeCount&&(n=r.getRangeAt(0).cloneRange(),n.getBoundingClientRect&&(o=n.getBoundingClientRect(),n.collapse(!0),a=o.left,c=o.top,s=o.right-o.left,u=o.bottom-o.top),0===a&&0===c))){var d=i.createElement("span");if(d.getClientRects&&(d.appendChild(i.createTextNode("\u200b")),n.insertNode(d),o=d.getClientRects()[0])){a=o.left,c=o.top,s=o.right-o.left,u=o.bottom-o.top;var m=d.parentNode;m.removeChild(d),m.normalize()}}return{x:a,y:c,width:s,height:u,text:l}}}]).directive("contentSelectable",["SelectionCoordinate",function(e){return{restrict:"A",scope:{contentSelectControl:"="},link:function(t,n){function o(n){if(1===n.which&&"function"==typeof t.iControl.onSelection){var o=e.getSelectionInfos();o.text&&t.iControl.onSelection(i,o)}}t.iControl=t.contentSelectControl||{};var i=n[0];i.addEventListener("mouseup",o)}}}]),angular.module("gc.ui.contenteditable",[]).directive("contenteditable",["$sce",function(e){return{restrict:"A",require:"?ngModel",link:function(t,n,o,i){function r(){var e=n.html();o.stripBr&&"<br>"===e&&(e=""),i.$setViewValue(e)}i&&(i.$render=function(){n.html(e.getTrustedHtml(i.$viewValue||""))},n.on("blur keyup input gc-update-value",function(){t.$evalAsync(r)}),r())}}}]),angular.module("gc.ui.textareaFocus",[]).directive("textareaFocus",["$parse","LocalStorageService","CommentService","Utils",function(e,t,n,o){return{restrict:"A",link:function(i,r,a){function c(e){var t;return $(e.target).parents(".gc-comment-cgu").length?void(t=!1):(d?d.forEach(function(n){t||(t=e.target.matches(n),!t&&e.target.parentNode&&(t=e.target.parentNode.matches(n)))}):t=!1,void(t||(e.preventDefault(),u.focus())))}f(!o.iOS()){i.comment._id||(i.comment.content=t.getItem("commentN1_"+n.thread_id));var u=angular.element(r[0].querySelector('[contenteditable="true"]'))[0];r.on("click",c);var l=i.$on("$destroy",s),d=null;a.textareaFocusExcept&&(d=e(a.textareaFocusExcept)())}}}}]),angular.module("gc.askpopin",["gc.user"]).controller("AskEmailPopinController",["$rootScope","GcUser","$scope","$log","$location","$timeout","BASE_URL",function(e,t,n,o,i,r,a){n.user&&n.user.validation&&(n.GcUser=t,n.popinUser={email:n.user.validation.v_email},n.forgotUrl=a+"/admin/#/forgot",n.visibleForm=function(){return n.user&&n.user.validation&&n.user.validation.v_email?"token":"email"},n.saveEmail=function(){return n.errorValidation=null,n.tokenResent=null,n.user.validation&&n.user.validation.v_email||i.url(""),t.update({email:n.popinUser.email},function(t){t?n.errorValidation="valid email already exist":("email"===n.visibleForm()&&(e.showAskEmailPopin=!1),n.token="")})},n.resendToken=function(){t.resendToken().success(function(){n.tokenResent=!0})},n.validEmail=function(){n.errorValidation=null,n.tokenResent=null;var e=document.querySelector("form[name=askTokenForm] input[type=number]").value;t.validEmail(n.popinUser.email,e,function(e){return e?(o.debug(e),void(e.indexOf("validation")!==-1?n.errorValidation="email validation failed":e.indexOf("token bad format")!==-1?n.errorValidation=e:e.indexOf("email")!==-1&&(n.errorValidation="valid email already exist"))):(mixpanel.track("auth:token_validated"),void n.close())})},n.close=e.$on("logged_out",function(){n.close()}))}]).directive("askEmailPopin",[function(){return{scope:{user:"="},controller:"AskEmailPopinController",controllerAs:"popin",restrict:"AE",templateUrl:"askEmailPopin.html",link:function(e,t,n,o){o.user=e.user,o.token=e.token}}}]),angular.module("gc.share-popin",["gc.user"]).directive("sharePopin",["$rootScope","$timeout","$document","Utils","ShareService","CommentService",function(e,t,n,o,i,r){return{scope:{comment:"=",placement:"=",show:"="},restrict:"E",templateUrl:"sharePopin.html",link:function(a,c,s,u){function l(){var t=a.placement.getBoundingClientRect(),n=o.getScrollPosition(),c=document.querySelector(".gc-body").getBoundingClientRect();a.popinCoord={x:t.left+n.left-c.left,y:t.top-10+n.top};var s={width:170,height:75};a.popinCoord.x+=s.width/2*(e.rtl?-.5:-1),a.popinCoord.y-=s.height/2,a.popinCoord.x<10&&(a.popinCoord.x=10),a.comment.author&&r.getUserObject(a.comment.author._id).success(,a.short_url="",i.shortenUrl(a.comment.thread.url||document.URL,a.comment._id).success(function(e){a.short_url=e.short_url})}a.show&&(a.$watch("placement",l),a.sharer=function(e){mixpanel.track("comment:share:social",e),i.openShareWindow(e,a.short_url)},a.copyClipboard=function(e){mixpanel.track("comment:share:yakli");var n=e.target;n.setSelectionRange(0,9999),document.execCommand("copy"),a.copied=!0,t(function(){a.copied=!1},1500)},t(function(){var e=c[0].querySelector(".share-shortened-url");n.on("click",function(o){e.contains(o.target)||$(o.target).hasClass(".gc-share")||$(o.target).parents(".gc-share").length||(n.off("click"),t(function(){a.show=!1}))})}))}}}]),angular.module("gc.ui.smartEditPopup",[]).directive("smartEditPopup",["$log","$window","CommentService",function(e,t,n){return{restrict:"AE",templateUrl:"smartEditPopup.html",replace:!0,scope:{smedControl:"="},link:function(e,o){function i(e,t){"open"===t.action?(d.options=t,t.callbacks&&(d.callbacks=t.callbacks),d.show(t.coordinates.x,t.coordinates.y)):"close"===t.action&&d.close()}function r(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount){for(var t=[],n=0,o=e.rangeCount;n<o;++n)t.push(e.getRangeAt(n));return t}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null}function a(e){if(e)if(window.getSelection){var t=window.getSelection();t.removeAllRanges();for(var n=0,o=e.length;n<o;++n)t.addRange(e[n])}else document.selection&&e.select&&e.select()}function c(t){e.arrowOffset=t-5+"px"}function s(e){var n=5;e.left<n?(c(e.left+n),e.left=n):e.left+e.width>t.innerWidth-n?(c(e.left+e.width-t.innerWidth-n),e.left=t.innerWidth-e.width-n):c(0),e.top+=window.scrollY||window.pageYOffset||document.body.scrollTop;var o={left:e.left+"px",top:e.top+"px"};e.display&&(o.display=e.display),u.css(o)}var u=o,l={popupWidth:u[0].clientWidth},d=e.smedControl||{},m=null;d.popupEl=u,d.callbacks={},0===l.popupWidth&&(l.popupWidth=164),u.on("mouseup",function(e){e.stopPropagation()}),e.linkInterface=!1,e.CommentService=n,d.show=function(t,n){e.linkInterface=!1;var o={display:"block"};l.x=t,l.y=n,o.left=l.x-l.popupWidth/2,o.top=l.y-50,o.width=l.popupWidth,s(o),e.$$phase||e.$apply()},d.close=function(){u.css({display:"none"}),e.linkChosen="",e.linkInterface=!1},e.$on("smedPopup",i),e.selectModifier=function(t,n){switch(t.preventDefault(),n){case"bold":d.callbacks.bold&&d.callbacks.bold(d);break;case"italic":d.callbacks.italic&&d.callbacks.italic(d);break;case"underline":d.callbacks.underline&&d.callbacks.underline(d);break;case"code":d.callbacks.code&&d.callbacks.code(d);break;case"link":m=r(),e.changeToLink();break;default:console.error("select modifier unknown")}},e.changeToLink=function(){var t={left:l.x-112.5,top:l.y-50,width:225};s(t),e.linkInterface=!0,e.linkChosen=""},e.changeToMenu=function(){var t={left:l.x-l.popupWidth/2,top:l.y-50,width:l.popupWidth};s(t),e.linkInterface=!1},e.linkWithUrl=function(){m&&e.linkChosen&&(a(m),d.callbacks.link&&d.callbacks.link(d,e.linkChosen))}}}}]),angular.module("gc.embed",[]).service("EmbedService",["$rootScope","$window","$http","$sce","$q","$timeout","Utils","API_URL",function(e,t,n,o,i,r,a,c){function s(e){var t=[],n=/(?:<a [^>]*href=["'](http[^"']+)["'][^>]*>)|(https?:\/\/[^"<\s]+[^.<\s"()][-A-Za-z0-9+&@#\/%=~_|])(?![^<>]*>|[^"]*?<\/a)/g,o=e.match(n);return o&&o.forEach(function(e){n.lastIndex=0;var o=n.exec(e),i=o[1]||o[2];"&nbsp"===i.slice(-5)&&(i=i.substr(0,i.length-5)),t.push(i)}),t}function u(e,r,a){return function(){r=o.trustAsResourceUrl(r);var c=angular.callbacks.$$counter.toString(36),s="angularcallbacks"+angular.callbacks.$$counter.toString(36);return t[s]=function(e){angular.callbacks["_"+c](e)},n.jsonp(r,{jsonpCallbackParam:a||"callback"}).then(function(t){return!t.data||t.data.error?i.reject(t.data.error):(t.data.initialUrl=e,t.data)},function(e){console.log("embed err",e)})["finally"](}}function l(e,t){return function(){var o="https://www.youtube.com/watch?v="+e;return n.post(c+"/pub/scrap",{url:o}).then(function(n){if(!n.data||n.data.error)return i.reject(n.data.error);var o=n.data;return{type:"video",provider_name:"YouTube",provider_url:"https://www.youtube.com/",title:o.title,description:o.description.replace(/\n|&#10;/g," "),thumbnail_url:o.image,url:"https://www.youtube.com/watch?v="+e,initialUrl:t,html:'<iframe width=" 459" height="344" src="https://www.youtube.com/embed/'+e+'?feature=oembed&autoplay=1" frameborder="0" allowfullscreen="allowfullscreen"></iframe>'}})}}function d(e){return e&&0===e.indexOf("http://")?"https://images.weserv.nl/?url="+encodeURIComponent(e.substr(7)):e}function m(e){return function(){return n.post(c+"/pub/scrap",{url:e}).then(function(t){var n=t.data;if(n){if(!n["og:title"]&&!n.title||!n["og:description"]&&!n.description)return i.reject("Page title/description missing");var o={type:"opengraph",provider_url:n["og:url"]?n["og:url"]:e,title:n["og:title"]||n.title,description:n["og:description"]||n.description,initialUrl:e};return n["og:site_name"]&&(o.provider_name=n["og:site_name"]),n["og:image:secure_url"]&&(n["og:image"]=n["og:image:secure_url"]),n["og:image"]=d(n["og:image"]),n["og:image"]?o.image=n["og:image"]:n.image&&(o.image=n.image),o}return i.reject("Page not found")},}}function p(e,n){if(S.indexOf(e)===-1){var o=t.document.createElement("script");o.async="async",o.src=e,n&&(o.onload=n),t.document.body.appendChild(o)}}var f=/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/ytscreeningroom\?v=|\/feeds\/api\/videos\/|\/user\S*[^\w\-\s]|\S*[^\w\-\s]))([\w\-]{11})[?=&+%\w-]*/i,g=/dailymotion.com\/video\/([a-zA-Z0-9-_]+)/i,h=/twitch.tv\/[a-zA_Z0-9_]+/i,v=/vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)*/i,_=/flickr\.com\/photos\/.+/i,b=/instagr\.?am(\.com)?\/.+/i,w=/open\.spotify\.com\/(track|album|user)\/[a-zA-Z0-9-_]+/i,y=/twitter\.com?\/.+\/status\/.+/i,C=this,S=[],k={};this.findEmbedables=function(n,o){for(var i=s(o),r=[],a=0;a<i.length;a++){var c,d=i[a];d.match(f)?c=l(RegExp.$1,d):d.match(g)?c=u(d,"https://www.dailymotion.com/services/oembed?autoplay=true&url=http://www.dailymotion.com/video/"+RegExp.$1):d.match(h)?c=u(d,"https://api.twitch.tv/v5/oembed?autoplay=true&url="+encodeURIComponent(d)):d.match(v)?c=u(d,"https://vimeo.com/api/oembed.json?autoplay=true&url="+encodeURIComponent(d)):d.match(_)?c=u(d,"https://www.flickr.com/services/oembed/?format=json&url="+encodeURIComponent(d),"jsoncallback"):d.match(b)?t.document.body.offsetWidth>400&&(c=u(d,"https://api.instagram.com/oembed/?maxwidth=320&lang="+e.lang+"&omitscript=true&url="+encodeURIComponent(d)),p("https://platform.instagram.com/en_US/embeds.js",function(){setInterval(function(){window.instgrm.Embeds.process()},1500)})):d.match(w)?c=u(d,"https://open.spotify.com/oembed?url="+encodeURIComponent(d)):d.match(y)?t.document.body.offsetWidth>400&&(c=u(d,"https://publish.twitter.com/oembed?lang="+e.lang+"&omitscript=true&theme="+(CommentService.website.theme||"light")+"&url="+encodeURIComponent(d)),p("https://platform.twitter.com/widgets.js",):c=m(d),c&&r.push({url:d,callback:c})}return r},this.loadEmbeds=function(e,t,n){if(t.length>0&&n>0){var o=e.embedBatchId;if(k[t[0].url])return void r(function(){e.onEmbedDetected({data:k[t[0].url]}),C.loadEmbeds(e,t.slice(1),n-1)});t[0].callback().then(function(i){k[t[0].url]=i,e.embedBatchId===o&&(e.onEmbedDetected({data:i}),C.loadEmbeds(e,t.slice(1),n-1))},function(i){e.embedBatchId===o&&C.loadEmbeds(e,t.slice(1),n)})}}}]).directive("gcEmbed",["CommentService","$timeout","$rootScope","EmbedService","Utils","API_URL",function(e,t,n,o,i,r){function a(e){var t=e.querySelector(".full-content");return t?t.innerHTML:e.innerHTML}function c(t,n){var i=o.findEmbedables(t,n);o.loadEmbeds(t,i,e.website.embeded_external_link)}function s(e,t){if("IntersectionObserver"in window){var o=n.$on("embeds:load:"+e.comment._id,function(){c(e,a(t)),i.disconnect()}),i=new IntersectionObserver(function(n){n[0].isIntersecting&&(c(e,a(t)),i.disconnect(),o())},{rootMargin:"0px 0px 300px 0px"});i.observe(t)}else c(e,a(t))}return{restrict:"A",scope:{comment:"=gcEmbed",onEmbedDetected:"&",embedBatchId:"="},link:function(e,n,o){t(100),e.$watch("embedBatchId",function(t,o){t!==o&&c(e,a(n[0]))})}}}]),console.log("[gc version] "+window.gcVersion),angular.module("graphcomment",["ngSanitize","ngUpload","ngTouch","ngSentry","gc.ui.autoGrow","gc.ui.textareaFocus","gc.ui.contentselectable","gc.ui.contenteditable","gc.ui.smartEditPopup","gc.ui.focus","gc.fallback-avatar","gc.progress-bar","gc.ui.showMore","ui.bootstrap.dropdown","GraphCommentModule","utils.scroll","gc.filters","gc.directives","gc.services","gc.share","gc.perfs","gc.readstatus","gc.focus","gc.sliders","gc.askpopin","gc.share-popin","gc.profile-popin","gc.account-popin","gc.vote-popin","gc.lang","gc.localstorage","gc.postmessage","gc.emoticon","gc.embed","gc.utils","gc.notifs","gc.ws","gc.custom-on-change","gc.fileread","gc.drop-upload","gc.custom-scrollbar","pascalprecht.translate","angular-jwt","xeditable","bw.paging","720kb.tooltips","gc.ga","gc.pub","gc.recaptcha"]).constant("DEBUG",!0).factory("authInterceptor",["$rootScope","$q","LocalStorageService","API_URL",function(e,t,n,o){return{request:function(e){if("string"==typeof e.url&&0===e.url.indexOf(o)){e.headers=e.headers||{};var t=n.getToken();/^".*"$/.test(t)&&(t=t.replace(/^"(.*)"$/,"$1")),!t||"Authorization"in e.headers||(e.headers.Authorization=t)}return e},response:function(e){401===e.status;var o=e.headers("Authorization");if(o){var i=o;"JWT"!==i.substring(0,"JWT".length)&&(i="JWT "+i),n.setToken(i)}return e||t.when(e)}}}]).config(["$httpProvider",function(e){e.interceptors.push("authInterceptor"),e.defaults.headers.common["Cache-Control"]="no-cache",e.defaults.cache=!1,e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.get["If-Modified-Since"]="0"}]).config(["$qProvider",function(e){e.errorOnUnhandledRejections(!1)}]).config(["$rootScopeProvider",).config(["$provide",function(e){e.decorator("$http",["$delegate",function(e){function t(e){return function(){var t=e.apply(null,arguments);return t.success=function(e){return t.then(function(t){e(t.data,t.status,t.config)}),t},t.error=function(e){return t.then(null,,t},t}}var n=t(e);return angular.extend(n,e),["get","delete","head","jsonp","post","put","patch"].forEach(,n}])}]).config(["$translateProvider","DEFAULT_LANGUAGE","APP_LANGUAGES",function(e,t,n){e.useStaticFilesLoader({prefix:"lang/",suffix:"-"+window.langRev+".json"}),e.useSanitizeValueStrategy(null);var o=n.map(function(e){return e.value});e.registerAvailableLanguageKeys(o,{"en-*":"en","fr-*":"fr","zh-*":"zh","es-*":"es","pt-*":"pt","it-*":"it","cz-*":"cz","fa-*":"fa","en_*":"en","fr_*":"fr","zh_*":"zh","es_*":"es","pt_*":"pt","cz_*":"cz","fa_*":"fa","uk_*":"uk","tr_*":"tr","ar-*":"ar","id-*":"id","hu-*":"hu","ca-*":"ca","sv-*":"sv","pl-*":"pl","nb-*":"nb"});var i;["language","browserLanguage","systemLanguage","userLanguage"].forEach(function(e){var t=window.navigator[e];t&&t.length>0&&(i=t)}),i&&(i=i.slice(0,2)),e.preferredLanguage(i||t)}]).config(["DEBUG","$logProvider",function(e,t){e||t.debugEnabled(!1)}]).config(["$compileProvider",).config(["$provide","ORANGE_BASE_URL","ORANGE_API_URL","ORANGE_WS_URL","ORANGE_URL_SHORTENER",function(e,t,n,o,i){var r=window.location.hostname.indexOf("orange.fr")!==-1;r&&(e.constant("BASE_URL",t),e.constant("API_URL",n),e.constant("WS_URL",o),e.constant("URL_SHORTENER",i))}]).factory("getSearchParameters",["$window",function(e){return function(){function t(e){for(var t={},n=e.split("&"),o=0;o<n.length;o++){var i=n[o].split("=");t[i[0]]=i[1]}return t}var n=e.location.search.substr(1);return null!==n&&""!==n?t(n):{}}}]).run(["DEBUG","$log","$rootScope","CommentService","Perfs",function(e,t,n,o,i){e||(t.log=angular.noop,t.error=angular.noop,t.info=angular.noop,t.warn=angular.noop),i.init(),$("[data-gc-loader]").remove(),o.countComments().success(}]),Array.from||(Array.from=)),"undefined"==typeof Node.prototype.contains&&(Node.prototype.contains=contains),"undefined"==typeof HTMLElement.prototype.contains&&(HTMLElement.prototype.contains=contains),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:configurable:!0,writable:!0}),String.prototype.trim||(String.prototype.trim=,"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:writable:!0,configurable:!0}),function(){ar t="undefined"!=typeof exports?exports:"undefined"!=typeof self?self:$.global,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=,t.atob||(t.atob=}(),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||,Array.prototype.every||(Array.prototype.every=function(e,t){var n,o;if(null==this)throw new TypeError("this vaut null ou n est pas d\xe9fini");var i=Object(this),r=i.length>>>0;if("function"!=typeof e)throw new TypeError;for(arguments.length>1&&(n=t),o=0;o<r;){var a;if(o in i){a=i[o];var c=e.call(n,a,o,i);if(!c)return!1}o++}return!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:configurable:!0,writable:!0}),NodeList.prototype.forEach=Array.prototype.forEach;
//# sourceMappingURL=main.js.map
