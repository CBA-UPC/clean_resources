;
(self.AMP=self.AMP||[]).push({m:1,v:"2312191621000",n:"amp-video",ev:"0.1",l:!0,f:function(t,i){(()=>{var i;ar e=function s(t){return new Promise(()}ar{isArray:o}=Array;ar{hasOwnProperty:a,toString:h}=Object.prototype;nction d(t,i,n,e,s,r,o,c,a,h,u){return t}nction m(t,i){return t.replace(/^|,/g,`$&${i} `)}ction P(t,i){return v(i),n=`> ${i}`,t.querySelectorAll(m(n,":scope"));var n}var A,b,y={bubbles:!0,cancelable:!0};unction E(t,i,n=null){if(!n)return void t,i);const e=n.nextSibling;t.insertBefore(i,e)}unction T(t,i,n,e){const s=n||{};d(t.ownerDocument);const{bubbles:r,cancelable:o}=e||y,c=new MessageEvent(i,{data:s,bubbles:r,cancelable:o});t.dispatchEvent(c)}ction k(t){return function(t,i){if(d(1===i.length),d(Array.isArray(i)||(n=i,a.call(n,"raw"))),self.trustedTypes&&self.trustedTypes.createPolicy){const n=self.trustedTypes.createPolicy("static-template#createNode",{createHTML:);t.innerHTML=n.createHTML("ignored")}else t.innerHTML=i[0];var n;const e=t.firstElementChild;return d(e),d(!e.nextElementSibling),t.removeChild(e),e}(A,t)}ction x(t,...i){try{return t.apply(null,i)}catch(t){!function(t){const i=C.apply(null,arguments);setTimeout((()=>{throw O(i),i}))}(t)}}r $=["Webkit","webkit","Moz","moz","ms","O","o"],F={"getPropertyPriority":()=>"","getPropertyValue":;function L(t){const i=t.replace(/[A-Z]/g,();return $.some(()?`-${i}`:i}unction U(t,i,n,e,s){const r=z(t.style,i,s);if(!r)return;const o=e?n+e:n;t.style.setProperty(L(r),o)}ction Y(t,i){const n=s((()=>t.play(!!i)));return n.catch((),n}var W=/vertical/,H=new WeakMap,J=new WeakMap,G=new WeakMap;unction Z(t){const i=new Set;for(let n=t.length-1;n>=0;n--){const e=t[n],{target:s}=e;if(i.has(s))continue;i.add(s);const r=J.get(s);if(r){G.set(s,e);for(let t=0;t<r.length;t++){const{callback:i,type:n}=r[t];K(n,i,e)}}}}function K(t,i,n){if(0==t){const{contentRect:t}=n,{height:e,width:s}=t;x(i,{width:s,height:e})}else if(1==t){const{borderBoxSize:t}=n;let e;if(t)e=t.length>0?t[0]:{inlineSize:0,blockSize:0};else{const{target:t}=n,i=p(t),s=W.test(i,t).writingMode),{offsetHeight:r,offsetWidth:o}=t;let c,a;s?(a=o,c=r):(c=o,a=r),e={inlineSize:c,blockSize:a}}x(i,e)}} nt=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;unction st(t){let i=!1,n=null,e=t;return(...t)=>(i||(n=e.apply(self,t),i=!0,e=null),n)}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var rt=self.__AMP_LOG;P__EXPERIMENT_TOGGLES";function Pt(t,i){const n=t);return!!n[i]}var At,bt,yt,Mt=t=>dt(t,"action"),Et=t=>ut(t,"extensions"),Rt=t=>ut(t,"performance"),Tt=t=>ut(t,"platform"),It=t=>mt(t,"timer"),Vt=t=>dt(t,"url"),wt=function kt(t,i,n={}){const{needsRootBounds:e,rootMargin:s,threshold:r}=n,o=function(t){return t.parent&&t.parent!=t}(i)&&(e||s)?i.document:void 0;return new i.IntersectionObserver(t,{threshold:r,root:o,rootMargin:s})}function St(t){var i;let n=null===(i=At)||void 0===i?void 0:i.get(t);if(!n){const i=function(t){At||(At=new WeakMap,bt=new WeakMap),d(bt);let i=bt.get(t);return i||(i=kt((t=>{const n=new Set;for(let s=t.length-1;s>=0;s--){var e;const{target:r}=t[s];n.has(r)||(n.add(r),d(i),i.unobserve(r),d(At),null===(e=At.get(r))||void 0===e||e.resolve(t[s]),At.delete(r))}}),t,{needsRootBounds:!0}),bt.set(t,i)),i}(p(t));d(At),i.observe(t),n=new e,At.set(t,n)}return n.promise}function Ct(t,i,n,e){let s=t,r=n,o=const c=),a=!(null==e||!e.capture);return s.addEventListener(i,o,c?e:a),()=>{null==s||s.removeEventListener(i,o,c?e:a),r=null,s=null,o=null}}function Ot(t,i,n,e){const s={detail:n};return Object.assign(s,e),new t.CustomEvent(i,s)}unction jt(t,i,n,e){let s=n;const r=Ct(t,i,(t=>{try{s(t)}finally{s=null,r()}}),e);return r}var qt=['<button aria-label="Unmute video" class="i-amphtml-video-mask i-amphtml-fill-content" tabindex=0></button>'],$t=["<i-amphtml-video-icon class=amp-video-eq><div class=amp-video-eq-col><div class=amp-video-eq-filler></div><div class=amp-video-eq-filler></div></div></i-amphtml-video-icon>"];r zt=class{constructor(){this.Pv=!1,this.Mv=new class{constructor(){this.Vt=null}add(t){return this.Vt||(this.Vt=[]),this.Vt.push(t),()=>{this.remove(t)}}remove(t){this.Vt&&this.Vt,t)}ire(t){if(this.Vt)for(const i of this.Vt.slice())i(t)}}essionActive(){return this.Pv}},Ut={"title":"","artist":"","album":"","artwork":[{"src":""}]},Bt="registered",Nt="load",Dt="loadedmetadata",Yt="play",Wt="playing",Ht="pause",Jt="ended",Gt="muted",Xt="unmuted",Zt="reloaded",Kt="ad_start",Qt="ad_end",ti="playing_manual",ii="paused",ni="video-play",ei="user-interacted";ar ri="video-manager",oi=(t,i)=>!!t&&(t.video===i||t.video.element===i);r hi=t=>!!t&&!isNaN(t)&&t>1;function ui(t,i,n){const{video:e}=t;t.getAnalyticsDetails().then((t=>{n&&Object.assign(t,n),T(e.element,i,t)}))}function li(t){!function(t,i,e,s){const r=ft(t),c=pt(r);!function(t,i,n,e,s,r){const o=vt(t);let c=o[n];c||(c=o[n]={obj:null,promise:null,resolve:null,reject:null,context:null,ctor:null,sharedInstance:!1}),c.ctor||(c.ctor=e,c.context=i,c.sharedInstance=!1,c.resolve&&mt(t,n))}(c,r,i,class{constructor(t){this.ampdoc=t,this.installAutoplayStyles=st((()=>function(t){!function(t,i,n,e,s){const r=t.getHeadNode(),o=function(t,i,n,e){let s=t.__AMP_CSS_SM;s||(s=t.__AMP_CSS_SM=u());const r=!n&&e&&"amp-custom"!=e&&"amp-keyframes"!=e,o=n?"amp-runtime":r?`amp-extension=${e}`:null;if(o){const n=Ft(t,s,o);if(n)return"STYLE"==n.tagName&&n.textContent!==i&&(n.textContent=i),n}const c=(t.ownerDocument||t).createElement("style");c.textContent=i;let a=null;return n?c.setAttribute("amp-runtime",""):r?(c.setAttribute("amp-extension",e||""),a=Ft(t,s,"amp-runtime")):(e&&c.setAttribute(e,""),a=t.lastChild),E(t,c,a),o&&(s[o]=c),c}(r,r,i),e||!1,s||null);if(n){const i=t.getRootNode();if(Lt(i,o))return n(o),o;const e=setInterval((()=>{Lt(i,o)&&(clearInterval(e),n(o))}),4)}}(t,".i-amphtml-video-mask{display:block;z-index:1;-webkit-appearance:none;appearance:none;background:transparent;border:none}.amp-video-eq{display:none}.i-amphtml-video-interface:not(amp-video) .amp-video-eq,amp-story .amp-video-eq,amp-video[controls] .amp-video-eq{display:-ms-flexbox;display:flex}[noaudio] .amp-video-eq{display:none!important}.amp-video-eq{pointer-events:none!important;-ms-flex-align:end;align-items:flex-end;bottom:7px;height:12px;opacity:0.8;overflow:hidden;position:absolute;right:7px;width:20px;z-index:1}.amp-video-eq-col{-ms-flex:1;flex:1;height:100%;margin-right:1px;position:relative}.amp-video-eq-col div{animation-name:amp-video-eq-animation;animation-timing-function:linear;animation-iteration-count:infinite;animation-direction:alternate;background-color:#fafafa;height:100%;position:absolute;width:100%;will-change:transform;animation-play-state:paused}.amp-video-eq-play .amp-video-eq-col div{animation-play-state:running}.amp-video-eq-1-1{animation-duration:0.3s;transform:translateY(60%)}.amp-video-eq-1-2{animation-duration:0.45s;transform:translateY(60%)}.amp-video-eq-2-1{animation-duration:0.5s;transform:translateY(30%)}.amp-video-eq-2-2{animation-duration:0.4s;transform:translateY(30%)}.amp-video-eq-3-1{animation-duration:0.3s;transform:translateY(70%)}.amp-video-eq-3-2{animation-duration:0.35s;transform:translateY(70%)}.amp-video-eq-4-1{animation-duration:0.4s;transform:translateY(50%)}.amp-video-eq-4-2{animation-duration:0.25s;transform:translateY(50%)}@keyframes amp-video-eq-animation{0%{transform:translateY(100%)}to{transform:translateY(0)}}\n/*# sourceURL=/css/video-autoplay.css*/",null,!1,"amp-video-autoplay")}(this.ampdoc))),this.Ev=null,this.Rv=null,this.Tv=null,this.Re=It(t.win),this.Iv=Mt(t.getHeadNode()),this.Vv=()=>this.kv(),this.Sv=st((()=>new class{constructor(t,i){this.Cv=i,this.Ni=t,this.Ov=null,this.xv=null,this.Ev=[],this.c_=[],this.jv=()=>this.$v(),this.Fv=t=>this.Lv(t)==ti,this.zv=this.Bv(),this.Nv()}egister(t){const{video:i}=t,{element:n}=i;this.Dv(n)&&(this.Ev.push(i),xt(n,Ht,this.jv),xt(n,Wt,this.jv),xt(n,Jt,this.jv),i.signals().whenSignal(ei).then(this.jv),this.$v())}Nv(){const t=this.Ni.getRootNode(),i=()=>this.Yv();this.c_.push(xt(t,"webkitfullscreenchange",i),xt(t,"mozfullscreenchange",i),xt(t,"fullscreenchange",i),xt(t,"MSFullscreenChange",i))}isInLandscapev(){const{win:t}=this.Ni,{screen:i}=t;if(i&&"orientation"in i){const t=i.orientation;this.c_.push(xt(t,"change",(()=>this.Wv())))}this.c_.push(xt(t,"orientationchange",(()=>this.Wv())))}Wvv(t){const i=Tt(this.Ni.win);this.Ov=t,i.isAndroid()&&i.isChrome()?t.fullscreenEnter():this.Gv(t).then((()=>t.fullscreenEnter()))}Jv(t){this.Ov=null,this.Gv(t,"center").then((()=>t.fullscreenExit()))}Gv(t,i=null){const{element:e}=t,s=this.Xv();return this.Zv().then((()=>St(e))).then((({boundingClientRect:t})=>{const{bottom:r,top:o}=t,c=s.getSize().height;if(o>=0&&r<=c)return n();const a=i||(r>c?"bottom":"top");return s.animateScrollIntoView(e,a)}))}Xv(){return wt(this.Ni)}v(){if(this.isInLandscape())return Promise.resolve(this.xv);this.xv=null;const t=this.Ev.filter(this.Fv).map(();return Promise.all(t).then((t=>{const i=t.sort(this.zv)[0];return i&&i.intersectionRatio>.5?i.target.getImpl().then(():this.xv}))}Uv(t,i){const{boundingClientRect:n,intersectionRatio:e}=t,{boundingClientRect:s,intersectionRatio:r}=i,o=e-r;if(Math.abs(o)>.1)return o;const c=wt(this.Ni),a=ci(c,n),h=ci(c,s);return a<h||a>h?a-h:n.top-s.top}(this.ampdoc,this))),this.Re.delay(this.Vv,1e3)}disposevv(t){const i="timeUpdate",n=t.video.getCurrentTime(),e=t.video.getDuration();if(l(n)&&l(e)&&e>0){const s=n/e,r=Ot(this.ampdoc.win,`${ri}.${i}`,{"time":n,"percent":s});this.Iv.trigger(t.video.element,i,r,1)}}register(t){at(t);const i=t;if(this.Qv(t),!t.supportsPlatform())return;if(this.Y_(t))return;if(!this.Rv){const t=t=>t.forEach(();this.Rv=kt(t,this.ampdoc.win,{threshold:.5})}this.Rv.observe(i.element),xt(i.element,Zt,(()=>n.videoLoaded())),this.Ev=this.Ev||[];const n=new class{constructor(t,i){this.Cv=t,this.Ni=t.ampdoc,this.video=i,this.Z_=!0,this.K_=!1,this.Q_=!1,this.tP=!1,this.rs=!1,this.iP=new zt,this.iP.onSessionEnd((()=>ui(this,"video-session"))),this.nP=new zt,this.nP.onSessionEnd((),this.eP=st((()=>new class{constructor(t,i){this.Re=It(t),this.sP=i,this.c_=null,this.rP=0,this.oP=0}start(){const{element:t}=this.sP.video;this.stop(),this.c_=this.c_||[],this.cP()?this.aP(this.oP):this.c_.push(jt(t,Dt,()),this.c_.push(xt(t,Jt,())}stopP(){const{video:t}=this.sP,i=t.getDuration();if(!hi(i))return!1;if(ai(i)<250){const i=Math.ceil(5);this.uP("This video is too short for `video-percentage-played`. Reports may be innacurate. For best results, use videos over",i,"seconds long.",t.element)}return!0}uP(...t){ot().warn.apply(ot(),[ri].concat(t))}aP(t){if(t!=this.oP)return;const{sP:i,Re:n}=this,{video:e}=i,s=()=>this.aP(t);if(i.getPlayingState()==ii)return void n.delay(s,500);const r=e.getDuration();if(!hi(r))return void n.delay(s,500);const o=(h=ai(r),d(!0),Math.min(Math.max(h,250),4e3)),c=e.getCurrentTime()/r*100,a=5*Math.floor(c/5);var h;at(l(a)),this.hP(a),n.delay(s,o)}hPP(this.Ni.win,this))),this.dP=!1,this.fP=!1,this.pP=null,this.dt=!1,this.mP=!1,this.hasAutoplay=i.element.hasAttribute("autoplay"),this.hasAutoplay&&this.Cv.installAutoplayStyles(),this.vP=Ut,this._P=this.gP=xt(i.element,Nt,(()=>this.videoLoaded())),xt(i.element,Ht,(()=>this.PP())),xt(i.element,Yt,(()=>{this.mP=!0,ui(this,ni)})),xt(i.element,Wt,(()=>this.AP())),xt(i.element,Gt,(),xt(i.element,Xt,(()=>{this.dt=!1,this.Cv.pauseOtherVideos(this)})),xt(i.element,"amp:video:tick",(t=>{const i=t.data,n=i.eventType;n&&this.bP(n,i.vars)})),xt(i.element,Jt,(()=>{this.tP=!1,ui(this,"video-ended")})),xt(i.element,Kt,(()=>{this.tP=!0,ui(this,"video-ad-start")})),xt(i.element,Qt,(()=>{this.tP=!1,ui(this,"video-ad-end")})),i.signals().whenSignal(Bt).then((()=>this.yP())),this.MP=st((()=>{const t="firstPlay",i=Ot(this.Ni.win,t,{}),{element:n}=this.video;Mt(n).trigger(n,t,i,1)})),this.EP()}P(t,i){const n={"__amp:eventType":t};Object.keys(i).forEach((),ui(this,"video-hosted-custom",n)}EP(){this.video.signals().whenSignal("playback-delegated").then(()}isMuted(){return this.dt}isPlaybackManaged(){return this.Z_}yPP(){const{element:t}=this.video;return!(this.video.preimplementsAutoFullscreen()||!t.hasAttribute("rotate-to-fullscreen"))&&ht(this.video.isInteractive(),"Only interactive videos are allowed to enter fullscreen on rotate. Set the `controls` attribute on %s to enable.",t)}AP(){this.Q_=!0,this.getPlayingState()==ti&&(this.MP(),this.Cv.pauseOtherVideos(this));const{video:t}=this,{element:i}=t;t.preimplementsMediaSessionAPI()||i.classList.contains("i-amphtml-disable-mediasession")||(function(t,i){const n=Vt(t);if(i&&i.artwork){const{artwork:t}=i;at(o(t)),t.forEach((t=>{if(t){const e=(i=t,"[object Object]"===h.call(i)?t.src:t);ht(n.isProtocolValid(e))}var i}))}}(i,this.vP),function(t,i,n,e){const{navigator:s}=t;"mediaSession"in s&&t.MediaMetadata&&(s.mediaSession.metadata=new t.MediaMetadata(Ut),s.mediaSession.metadata=new t.MediaMetadata(i),s.mediaSession.setActionHandler("play",n),s.mediaSession.setActionHandler("pause",e))}(this.Ni.win,this.vP,this._P,this.gP)),this.iP.beginSession(),this.rs&&this.nP.beginSession(),this.mP||ui(this,ni)}PPideoLoadedP(){if(this.video.preimplementsMediaSessionAPI())return;this.video.getMetadata()&&(this.vP=u(this.video.getMetadata()));const t=this.Ni.win.document;if(!this.vP.artwork||0==this.vP.artwork.length){const i=function(t){const i=t.querySelector('script[type="application/ld+json"]');if(!i)return;const n=i.textContent);return n&&n.image?"string"==typeof n.image?n.image:n.image["@list"]&&"string"==typeof n.image["@list"][0]?n.image["@list"][0]:"string"==typeof n.image.url?n.image.url:"string"==typeof n.image[0]?n.image[0]:void 0:void 0}(t)||t)||t);i&&(this.vP.artwork=[{"src":i}])}if(!this.vP.title){const i=this.video.element.getAttribute("title")||this.video.element.getAttribute("aria-label")||this.pP.getAttribute("title")||this.pP.getAttribute("aria-label")||t.title;i&&(this.vP.title=i)}}P(){this.Ni.isVisible()&&N(this.Ni.win).then((t=>{this.hasAutoplay&&!this.userInteracted()&&t?this.kP():this.SP()}))}TP(){this.video.isInteractive()&&this.video.hideControls(),N(this.Ni.win).then((t=>{t||!this.video.isInteractive()?(this.video.mute(),this.CP()):this.video.showControls()}))}CP(){const{video:t}=this,{element:i,win:n}=this.video;if(i.hasAttribute("noaudio")||i.signals().get(ei))return;const e=function(t,i){const n=w(i)($t),e=n.firstElementChild;for(let t=0;t<4;t++){const i=e.cloneNode(!0),s=i.children;for(let i=0;i<s.length;i++)s[i].classList.add(`amp-video-eq-${t+1}-${i+1}`);n.appendChild(i)}return M(e),n}(0,i),s=[e];function r(i){t.mutateElementSkipRemeasure((()=>{s.forEach((t=>{!t,i)}))}))}function o(i){t.mutateElementSkipRemeasure(()}const c=[xt(i,Ht,(()=>o(!1))),xt(i,Wt,(),xt(i,Kt,(()=>{r(!1),t.showControls()})),xt(i,Qt,(),xt(i,Xt,(()=>si(t)))];if(t.isInteractive()){t.hideControls();const n=i,this.vP);s.push(n),c.push(xt(n,"click",())}t.mutateElementSkipRemeasure((),this.tP&&r(!1),t.signals().whenSignal(ei).then((()=>{this.MP(),t.isInteractive()&&t.showControls(),t.unmute(),c.forEach((),t.mutateElementSkipRemeasure(()}))}kPdateVisibilityetPlayingStatesRollingAd(){return this.tP}userInteractedetAnalyticsDetails(){const{video:t}=this;return Promise.all([N(this.Ni.win),St(t.element)]).then((i=>{const n=i[0],e=i[1],{height:s,width:r}=e.boundingClientRect,o=this.hasAutoplay&&n,c=t.getPlayedRanges(),a=c.reduce((,0);return{"autoplay":o,"currentTime":t.getCurrentTime(),"duration":t.getDuration(),"height":s,"id":t.element.id,"muted":this.dt,"playedTotal":a,"playedRangesJson":JSON.stringify(c),"state":this.getPlayingState(),"width":r}}))}}(this,t);this.Ev.push(n);const{element:e}=n.video;T(e,Bt),e),t.signals().signal(Bt),e.classList.add("i-amphtml-video-interface")}Qv(t){n("play",(),n("pause",(()=>t.pause())),n("mute",(()=>t.mute())),n("unmute",(()=>t.unmute()));const i=function n(i,n){t.registerAction(i,(,1)}n("fullscreenenter",i),n("fullscreen",i)}Y_){return this.Sv()}getVideoStateProperty(t,i){const e=this.ampdoc.getRootNode(),s=ot().assertElement(e.getElementById(t),`Could not find an element with id="${t}" for VIDEO_STATE`),r=this.X_(s);return(r?r.getAnalyticsDetails():n()).then(()}getPlayingState(t){return this.X_(t).getPlayingState()}isMuted(t){return this.X_(t).isMuted()}userInteracted(t){return this.X_(t).userInteracted()}auseOtherVideos(t){this.Ev.forEach((i=>{i.isPlaybackManaged()&&i!==t&&i.getPlayingState()==ti&&i.video.pause()}))}})}(t,"video-manager")}var di,fi=class t{tatic makeeref,pi={"slow-2g":50,"2g":50,"3g":1e3,"4g":2500,"5g":5e3},mi="i-amphtml-is-video-fully-loaded-override-for-testing";function vi(t,i){return g(t,(t=>"SOURCE"==t.tagName&&i(t)))}function _i(t){if(!t.duration)return 0;let i=0;for(let n=0;n<t.buffered.length;n++)i+=t.buffered.end(n)-t.buffered.start(n);return i/t.duration}function gi(t,i){if(!!i===i||null==i)return;if(Array.isArray(i))return void i.forEach(();const n=i;t.appendChild(n.nodeType?n:self.document.createTextNode(String(i)))}function Pi(t,i,...n){if("string"!=typeof t)return t(it(it({},i),{},{children:n}));const e=null==i?void 0:i.xmlns;e&&delete i.xmlns;const s=e?self.document.createElementNS(e,t):self.document.createElement(t);return gi(s,n),i&&Object.keys(i).forEach((t=>{!function(t,i,n){if(!1!==n&&null!=n)if("function"!=typeof n||"o"!==i[0]||"n"!==i[1])t.setAttribute(i,!0===n?"":String(n));else{const e=i.toLowerCase().substring(2);t.addEventListener(e,n)}}(s,t,i[t])})),s}var Ai;function bi(t,i){return t,i))}var yi=["h264","vp09"];function Mi(t,i,s=Number.POSITIVE_INFINITY){var o;const{win:c}=i;if(Tt(c).isBot())return n();t.hasAttribute("crossorigin")||t.setAttribute("crossorigin","");const a=t.getAttribute("src"),h=null===(o=t.querySelector("source[src]"))||void 0===o?void 0:o.getAttribute("src");return a||h?(Rt(i.win).addEnabledExperiment("video-cache"),function(t,i){const{win:n}=i;if(t,n)){const t=n.document.getElementById("amp-google-video-cache-response");try{const i=JSON.parse(t.textContent);if(i.sources)return Promise.resolve(i)}catch(t){}}const{canonicalUrl:s,sourceUrl:o}=lt(n.document,"documentInfo").get();!function(t,i){if(!t.hasAttribute("src"))return;const n=i.document.createElement("source"),e=t.getAttribute("src");n.setAttribute("src",e);const s=t.getAttribute("type");s&&n.setAttribute("type",s),t.removeAttribute("src"),t.removeAttribute("type"),t.querySelectorAll("source").forEach(M),t.insertBefore(n,t.firstChild)}(t,n);const c=(h=function(t){var i;const n=r(t.querySelectorAll("source[src]"));for(let t=0;t<n.length;t++)if(_(n[t],'[type*="video/mp4"]'))return n[t].getAttribute("src");return null===(i=n[0])||void 0===i?void 0:i.getAttribute("src")}(t),a=u=o,u="string"==typeof a?a):a,new URL(h,u.href).toString());var a,h,u;return function(t,i){return Et(i.win).installExtensionForDoc(i,"amp-cache-url").then((()=>function(t,i){return function(t,i){const n=function(t,i){const n=vt(t)[i];return n?n.promise?n.promise:(mt(t,i),n.promise=Promise.resolve(n.obj)):null}(t,i);if(n)return n;const s=vt(t);return s[i]=function(){const t=new e,{promise:i,reject:n,resolve:s}=t;return i.catch((()=>{})),{obj:null,promise:i,resolve:s,reject:n,context:null,ctor:null}}(),s[i].promise}(pt(t),i)}(t,"cache-url")))}(t,i).then(().then((t=>{const i=bi(t.replace(/\/[ic]\//,"/mbv/"),{"amp_video_host_url":s,"amp_video_require_acao_header":1});return(e=n,ut(e,"xhr")).fetch(i,{prerenderSafe:!0}).then(();var e}))}(t,i).then((i=>{!function(t,i,n){i.sort(((t,i)=>{var n,e;const s=null===(n=t.codec)||void 0===n?void 0:n.split(".")[0],r=null===(e=i.codec)||void 0===e?void 0:e.split(".")[0],o=yi.indexOf(s),c=yi.indexOf(r);if(o>c)return 1;if(o<c)return-1;const a=t.bitrate_kbps,h=i.bitrate_kbps;return a>h?1:a<h?-1:0})).forEach((i=>{if(i.bitrate_kbps>n)return;let e=i.type;i.codec&&"h264"!==i.codec&&(e+="; codecs="+i.codec);const s=(r=t.ownerDocument,o={"src":i.url,type:e,"data-bitrate":i.bitrate_kbps,"i-amphtml-video-cached-source":""},R(r.createElement("source"),o));var r,o;t.insertBefore(s,t.firstChild)}))}(t,i.sources,s),Pt(c,"story-video-cache-apply-audio")&&function(t,i){!1===i&&t.setAttribute("noaudio","")}(t,i.has_audio),function(t,i){if(!i||!i.src||!i.srclang||t.querySelector("track"))return;const n=Pi("track",{src:i.src,srclang:i.srclang,kind:"captions"}),e=Pi("amp-story-captions",{id:i.src,"style-preset":"default",layout:"container","auto-append":!0});t.setAttribute("captions-id",i.src),t.appendChild(n),t.appendChild(e)}(t,i.captions)})).catch(()):(ot().error("AMP-VIDEO","Video cache not properly configured"),n())}var Ei=["<i-amphtml-poster></i-amphtml-poster>"],Ri="amp-video",Ti=["aria-describedby","aria-label","aria-labelledby","controls","crossorigin","disableremoteplayback","controlsList","title"],Ii={"high":2e3,"medium":720,"low":400},Vi=["loop","poster","preload"],wi=Ti.concat(Vi),ki=class extends t.BaseElement{static prerenderAllowedonstructor(t){super(t),this.xP=null,this.dt=!1,this.vP=Ut,this.c_=[],this.jP=null,this.qP=null,this.$P=new this.element),this.zP=!1}preconnectCallback(t){this.UP().forEach((i=>{var n;(n=this.win,ut(n,"preconnect")).url(this.getAmpDoc(),i,t)}))}UP(){const t=this.element.getAttribute("src");if(t)return[t];const i=[];return r(P(this.element,"source")).forEach((t=>{const n=t.getAttribute("src");n&&i.push(n);const e=t.getAttribute("amp-orig-src");e&&i.push(e)})),i}isLayoutSupporteduildCallback(){const{element:t}=this;this.BP(),this.xP=t.ownerDocument.createElement("video");const i=t.getAttribute("poster");var n,e;this.xP.setAttribute("playsinline",""),this.xP.setAttribute("webkit-playsinline",""),this.xP.setAttribute("preload","none"),this.NP(),V(Ti,this.element,this.xP,!0),this.DP(),I(this.xP,!0),n=this.element,e=this.xP,n.hasAttribute("object-fit")&&U(e,"object-fit",n.getAttribute("object-fit")),n.hasAttribute("object-position")&&U(e,"object-position",n.getAttribute("object-position")),t.appendChild(this.xP);const s=t.getAttribute("artist"),r=t.getAttribute("title"),o=t.getAttribute("album"),c=t.getAttribute("artwork");if(this.vP={"title":r||"","artist":s||"","album":o||"","artwork":[{"src":c||i||""}]},this.qP=!!this.element.querySelector("source[data-bitrate]")||this.element.hasAttribute("cache")||this.YP(),li(t),(a=t,lt(a,"video-manager")).register(this),this.element.hasAttribute("cache"))return this.WP(),Mi(this.element,this.getAmpDoc(),this.HP());var a}NP(){const{element:t}=this;(function(t){return!!t)})(t)&&["i-amphtml-disable-mediasession","i-amphtml-poolbound"].forEach(()}mutatedAttributesCallback(t){if(!this.xP)return;const{element:i}=this;if(t.src&&(this.hv().assertHttpsUrl(i.getAttribute("src"),i),V(["src"],this.element,this.xP)),V(wi.filter((),this.element,this.xP,!0),t.src&&T(i,Zt),t.artwork||t.poster){const t=i.getAttribute("artwork"),n=i.getAttribute("poster");this.vP.artwork=[{"src":t||n||""}]}if(t.album){const t=i.getAttribute("album");this.vP.album=t||""}if(t.title){const t=i.getAttribute("title");this.vP.title=t||""}if(t.artist){const t=i.getAttribute("artist");this.vP.artist=t||""}}layoutCallback(){if(this.xP=this.xP,!this.GP())return this.toggleFallback(!0),n();let t;V(Vi,this.element,this.xP,!0),this.XP(),this.ZP((()=>this.KP())),this.QP(),"prerender"==this.getAmpDoc().getVisibilityState()||"preview"==this.getAmpDoc().getVisibilityState()?(this.element.hasAttribute("preload")||this.xP.setAttribute("preload","auto"),t=this.getAmpDoc().whenFirstVisible().then((()=>(this.tA(),It(this.win).promise(1).then((()=>{if(!this.iA())return this.loadPromise(this.xP)})))))):this.tA();const i=this.loadPromise(this.xP).then(null,().then((()=>this.nA()));return"none"!==this.element.getAttribute("preload")?this.iA()?t:i:void 0}eA(t){if(!this.xP.error||this.xP.error.code!=MediaError.MEDIA_ERR_DECODE)return;if(ot().error(Ri,`Decode error in ${this.xP.currentSrc}`,this.element),this.xP.src)return;let i=0;const n=g(this.xP,(t=>"SOURCE"==t.tagName&&(i++,t.src==this.xP.currentSrc)));0!=i&&(M(n),t.stopImmediatePropagation(),this.xP.load(),this.play(!1))}WP(){this.sA().forEach((t=>{t.setAttribute("src",t.getAttribute("amp-orig-src")),t.removeAttribute("amp-orig-src")}))}QP(){at(this.xP);const t=r(P(this.element,"source"));if(this.element.hasAttribute("src")&&Si(this.element)){const i=this.element.getAttribute("src"),n=this.element.getAttribute("type"),e=this.rA(i,n),s=this.element.getAttribute("amp-orig-src");e.setAttribute("amp-orig-src",s),this.element.removeAttribute("src"),this.element.removeAttribute("type"),t.unshift(e)}t.forEach((t=>{if(Si(t,this.element)){t.remove();const i=Object.keys(Ii),n=t.getAttribute("type"),e=t.getAttribute("amp-orig-src"),s=this.HP();i.forEach(((r,o)=>{if(s<Ii[r])return;const c=bi(t.src,{"amp_video_quality":r}),a=this.rA(c,n,{"data-bitrate":Ii[r],"i-amphtml-video-cached-source":""});o===i.length-1&&a.setAttribute("amp-orig-src",e),this.xP.appendChild(a)}))}else t.hasAttribute("i-amphtml-video-cached-source")&&this.xP.appendChild(t)})),this.xP.changedSources&&this.xP.changedSources()}tA(){at(this.xP);const t=r(P(this.element,"source")),{element:i}=this,n=this.hv();i.hasAttribute("src")&&!Si(i)&&(n.assertHttpsUrl(i.getAttribute("src"),i),V(["src"],this.element,this.xP)),t.forEach((t=>{at(!Si(t,i)),n.assertHttpsUrl(t.getAttribute("src"),t),this.xP.appendChild(t)})),r(this.xP.querySelectorAll("[amp-orig-src]")).forEach((t=>{const i=t.getAttribute("amp-orig-src"),n=t.getAttribute("type"),e=this.rA(i,n);E(this.xP,e,t)})),r(P(i,"track")).forEach((),this.oA(),this.xP.changedSources&&this.xP.changedSources()}rA(t,i,n={}){const{element:e}=this;this.hv().assertHttpsUrl(t,e);const s=e.ownerDocument.createElement("source");return s.setAttribute("src",t),i&&s.setAttribute("type",i),R(s,n),s}sA(){const{element:t}=this,i=r(P(t,"source")),n=[];i.push(t);for(let t=0;t<i.length;t++)Si(i[t])&&n.push(i[t]);return n}PP(){const t=this.xP;t.addEventListener("error",(),this.c_.push(this.forwardEvents([Jt,Dt,"loadeddata",Ht,Wt,Yt],t)),this.c_.push(xt(t,"volumechange",(()=>{const{muted:t}=this.xP;this.dt!=t&&(this.dt=t,T(this.element,this.dt?Gt:Xt))}))),["play","pause","ended"].forEach((i=>{this.c_.push(xt(t,i,(()=>this.JP("play"==i))))}))}cAesetOnDomChange(){var t,i;this.xP=(i=this.element,v("video"),"> video",i.querySelector(m("> video",":scope"))),this.cA(),this.DP(),this.qP&&(t=this.win,di||(Pt(t,"flexible-bitrate")&&Rt(t).addEnabledExperiment("flexible-bitrate"),di=new class{constructor(t){this.win=t,this.aA="",this.hA=this.uA(),this.lA=[]}manage(t){Pt(this.win,"flexible-bitrate")&&(t.changedSources||(function(t,i){xt(t,"waiting",(()=>{if(t.readyState<1||_i(t)>.99)return;let n=null;const e=jt(t,"playing",();n=setTimeout((,100)}))}(t,(()=>this.dA(t))),xt(t,"downgrade",(),t.changedSources=this.lA.push(fi.make(this.win,t))))}dA(t){const i=function(t){return at(vi(t,())}(t),n=i.pA-1;n>=this.hA||(this.hA=n,this.mA(t,i.pA),this.vA())}_A(){const{connection:t}=this.win.navigator;return t&&t.effectiveType?t.effectiveType:"4g"}uAA(t){const i=r(P(t,"source"));i.forEach((t=>{if(t.pA)return;const i=t.getAttribute("data-bitrate");t.pA=i?parseInt(i,10):Number.POSITIVE_INFINITY}));let n=!1;return i.sort(((t,i)=>{const e=this.gA(i)-this.gA(t);return e<0&&(n=!0),e})),n&&i.forEach((),n}gAA(t,i){return!!vi(t,()}mA(t,i){if(!this.PA(t,i))return;const{currentTime:n}=t;t.pause(),this.fA(t)?(t.load(),jt(t,"loadedmetadata",()):Y(t)}vA(t))).manage(this.xP),this.xP.readyState>=1?this.nA():(function(t,i,n,e){let s;const r=new Promise(();return r.then(s,s),r}(this.xP).then((),this.oA())}oA(){const t=this.element.getAttribute("captions-id");if(!t)return;const i=this.win.document.querySelector(`amp-story-captions#${n=t,CSS.escape(n)}`);var n;if(!i)return;const e=this.getAmpDoc();Et(e.win).installExtensionForDoc(e,"amp-story-captions","0.1"),this.zP=!0,i.getImpl().then((t=>{t.setVideoElement&&t.setVideoElement(this.xP)}))}nAif(!Tt(this.win).isAndroid())return;const{element:t}=this;if(t.querySelector("i-amphtml-poster"))return;const i=t.getAttribute("poster");if(!i)return;const n=w(t)(Ei);!function(t,i){const{style:n}=t;d(!0),d(!n.display),n.display="block"}(n),B(n,{"background-image":`url(${i})`,"background-size":"cover","background-position":"center"}),n.classList.add("i-amphtml-android-poster-bug"),I(n),t.appendChild(n)}ute(){this.iA()||(this.xP.muted=!0)}unmuteowControls(){this.xP.controls=!0}ullscreenEnter(){!this.xP)}fullscreenExit(){!function(t){const i=t.cancelFullScreen||t.exitFullscreen||t.webkitExitFullscreen||t.webkitCancelFullScreen||t.mozCancelFullScreen||t.msExitFullscreen;if(i)return void i.call(t);const{ownerDocument:n}=t;if(!n)return;const e=n.cancelFullScreen||n.exitFullscreen||n.webkitExitFullscreen||n.webkitCancelFullScreen||n.mozCancelFullScreen||n.msExitFullscreen;e&&e.call(n)}(this.xP)}isFullscreen(){return function(t){const{webkitDisplayingFullscreen:i}=t;if(void 0!==i)return i;const{ownerDocument:n}=t;return!!n&&(n.fullscreenElement||n.webkitFullscreenElement||n.mozFullScreenElement||n.webkitCurrentFullScreenElement)==t}(this.xP)}reimplementsMediaSessionAPI(){return!1}etCurrentTime(){return this.xP.currentTime}etPlayedRanges(){const{played:t}=this.xP,{length:i}=t,n=[];for(let e=0;e<i;e++)n.push([t.start(e),t.end(e)]);return n}A(){const t=this.getPlaceholder();return!(!t||!t.classList.contains("i-amphtml-blurry-placeholder")||(function(t,i){const{style:n}=t;for(const t in i)n.setProperty(L(z(n,t)),String(i[t]),"important")}(t,{"opacity":0}),0))}ZPggleCaptions(t){r(this.xP.textTracks).forEach((i=>{i.mode=t?this.zP?"hidden":"showing":"disabled"}))}};.registerElement(Ri,ki)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-video-0.1.mjs.map