import{ai as _e,az as be,as as Ae,a5 as Ie,N as Et,aa as Ze,dF as De,bd as Ct,aF as St,b4 as st,d2 as me,aA as Ce,aB as Ot,d3 as et,aC as tt,ay as We,a1 as Qe,dG as Ft,G as ot,bR as Rt,bu as Lt,a6 as lt,dH as de,u as Ye,at as Xe,dI as Nt,bl as jt,l as Mt,aw as ut,dJ as oe,bA as qe,g as $t,ab as qt,dK as Ht,dL as Ut,dM as zt,cz as Tt,aD as Gt,bs as Kt,bE as Qt,b1 as Yt,dN as Xt,dO as we,dP as Je,dQ as Jt,dR as _t,bi as Zt,c2 as er}from"./itinerary-entities.5f897bcd.js";import{l as ke,r as X,c as z,w as Ee,aa as Vt,G as N,P as Z,x as ae,z as c,R as Re,Y as G,H as ee,Q as se,I as ue,a7 as Pe,a6 as he,N as rt,O as at,F as ve,a as ct,an as He,ao as Ue,$ as Ve,n as Me,q as ze,U as tr,a1 as rr,ab as ar,a3 as nr,a4 as ir,y as sr}from"./graphql.5cf3693b.js";import{g as It,u as dt,b as nt,A as Bt,M as or,_ as lr,I as ur}from"./entry.a7cea746.js";import{R as cr}from"./ReserveError.1a4bdf27.js";import{T as dr}from"./Timer.ca14a1b8.js";import{_ as fr}from"./notFound.914cc6f2.js";import{U as Dt}from"./UserForm.60e3d2ec.js";import{P as Te,L as it,R as Ke,S as xt}from"./itinerary-modules.2ea32123.js";import{A as hr}from"./AddMemberByExcelModal.921db927.js";import{A as vr}from"./AddLabel.7a680199.js";import"./service-client.4862e840.js";import"./addEditTeamModal.2b9cd274.js";import"./useMrDropzone.7636171e.js";import"./useTutorial.34e7d475.js";/* empty css                 */const pr=""+globalThis.__publicAssetsURL("img/threeperiods.gif"),mr=ke({__name:"CarPlateInput",props:{modelValue:{default:()=>["","الف","","ایران",""]}},emits:["update:modelValue"],setup(W,{expose:re,emit:H}){const j=["","الف","","ایران",""],$=X("الف_ب_پ_ت_ث_ج_چ_ح_خ_د_ذ_ر_ز_ژ_س_ش_ص_ض_ط_ظ_ع_غ_ف_ق_ک_گ_ل_م_ن_و_ه_ی"),q=_e(),O=X(j),o=X({}),_=z(()=>{for(let d=0;d<5;d++)if(o.value[d])return!0;return!1}),m=z(()=>$.value.split("_").map(d=>({id:d,label:d}))),b=z(()=>({id:O.value[1],label:O.value[1]})),v=z(()=>q.t("MrInput.defaultError",{placeholder:q.t("PassengerForm.carPlate")})),p=()=>{const d=[/\d{2}/,/.+/,/\d{3}/,/.+/,/\d{2}/];for(let g=0;g<5;g++)o.value[g]=!d[g].test(O.value[g]);return _.value},E=d=>({"input-error":o.value[d]}),B=()=>O.value;return Ee(O,d=>{H("update:modelValue",d)}),Vt(()=>{W.modelValue&&W.modelValue.length&&W.modelValue.forEach((d,g)=>{d&&(O.value[g]=d)})}),re({inputError:E,getData:B,validate:p}),(d,g)=>(N(),Z("div",{class:Re(["car-plate-input-container",{"scroll-input-container-error":c(_)}])},[ae(be,{modelValue:c(O)[4],"onUpdate:modelValue":[g[0]||(g[0]=R=>c(O)[4]=R),p],"max-length":2,type:"number",placeholder:"ایران",class:"part",label:"پلاک خودرو",required:"",invalid:c(o)[4],"error-text":c(v),onBlur:p},null,8,["modelValue","invalid","error-text"]),ae(be,{modelValue:c(O)[2],"onUpdate:modelValue":[g[1]||(g[1]=R=>c(O)[2]=R),p],"max-length":3,type:"number",placeholder:"123",label:"‌",required:"",invalid:c(o)[2],"error-text":c(v),class:"part",onBlur:p},null,8,["modelValue","invalid","error-text"]),ae(It,{"model-value":c(b),options:c(m),placeholder:"حرف",label:"‌",required:"",invalid:c(o)[1],description:c(v),class:"part",onBlur:p,"onUpdate:modelValue":g[2]||(g[2]=R=>c(O)[1]=R.id)},null,8,["model-value","options","invalid","description"]),ae(be,{modelValue:c(O)[0],"onUpdate:modelValue":[g[3]||(g[3]=R=>c(O)[0]=R),p],"max-length":2,type:"number",placeholder:"12",required:"",invalid:c(o)[0],"error-text":c(v),label:"‌",class:"part",onBlur:p},null,8,["modelValue","invalid","error-text"])],2))}});const yr=Ae(mr,[["__scopeId","data-v-d61298d1"]]),gr={key:0,class:"field-container"},br={class:"radio-group"},Pr=ke({__name:"HotelCheckForm",props:{packageIndex:{},hasEarlyCheckin:{type:Boolean},hasLateCheckout:{type:Boolean}},emits:["update:early","update:late"],setup(W,{emit:re}){const H=Ie(),j=Et(),$=z(()=>{var v;return(v=q.value.selectedPrices)==null?void 0:v[W.packageIndex]}),q=z(()=>j.selectedPackages[0]),O=z(()=>{var v,p;return`ورود زودتر از ساعت ${(v=$.value)==null?void 0:v.checkinHour} (${Ze((p=$.value)==null?void 0:p.earlyCheckinPrice)})`}),o=z(()=>{var v,p;return`ورود دیرتر از ساعت ${(v=$.value)==null?void 0:v.checkoutHour} (${Ze((p=$.value)==null?void 0:p.lateCheckoutPrice)})`}),_=z(()=>{var v,p;return!!((p=(v=$.value)==null?void 0:v.selectedExtraFormOptions)!=null&&p.find(E=>E.id===De.EarlyCheckin))}),m=z(()=>{var v,p;return!!((p=(v=$.value)==null?void 0:v.selectedExtraFormOptions)!=null&&p.find(E=>E.id===De.LateCheckout))}),b=(v,p)=>{var E,B;switch(v){case"in":{const d=(E=$.value)==null?void 0:E.getAvailableFormExtraOptions().find(g=>g.id===De.EarlyCheckin);if(!d)return;j.toggleExtraOptionsForSelectedPrice({enable:p,priceClassIndex:W.packageIndex,option:d,type:"form",package:j.selectedPackages[0]}),re("update:early",p);break}case"out":{const d=(B=$.value)==null?void 0:B.getAvailableFormExtraOptions().find(g=>g.id===De.LateCheckout);if(!d)return;j.toggleExtraOptionsForSelectedPrice({enable:p,priceClassIndex:W.packageIndex,option:d,type:"form",package:j.selectedPackages[0]}),re("update:late",p);break}}H.refetchPrebills(!0)};return(v,p)=>v.hasEarlyCheckin||v.hasLateCheckout?(N(),Z("div",gr,[G("div",br,[v.hasEarlyCheckin?(N(),ee(Ct,{key:0,"model-value":c(_),label:c(O),"onUpdate:modelValue":p[0]||(p[0]=E=>b("in",E))},null,8,["model-value","label"])):se("",!0),v.hasLateCheckout?(N(),ee(Ct,{key:1,"model-value":c(m),label:c(o),"onUpdate:modelValue":p[1]||(p[1]=E=>b("out",E))},null,8,["model-value","label"])):se("",!0)])])):se("",!0)}});const kr=Ae(Pr,[["__scopeId","data-v-9bfab789"]]),Ar={class:"action-buttons"},wr=ke({__name:"AddPassenger",emits:["close"],setup(W,{expose:re,emit:H}){const j=St(),$=Ie(),q=X(null),{isMobileSize:O}=st(),{handleException:o}=dt(),_=X(!1),m=z(()=>me.Gender|me.FirstName|me.LastName|me.PersianFirstName|me.PersianLastName|me.Nationality|me.PassportNumber|me.PassportExpiry|me.BirthDate),b=z(()=>(m.value|me.NationalCode|me.NationalityCode)&(~me.PassportNumber&~me.PassportExpiry)),v=()=>{var d;if(((d=q.value)==null?void 0:d.validateAll())&&q){const g=q.value.getData(),R={GroupId:g.groupId||null,BirthDay:g.birthDate||null,FirstName:g.firstName||null,LastName:g.lastName||null,Male:g.gender===et.Male,NationalCode:g.nationalCode||null,Nationality:g.nationalityCode||null,PassportExpiration:g.passportExpiry||null,PassportNumber:g.passportNumber||null,PersianFirstName:g.persianFirstName||null,PersianLastName:g.persianLastName||null,PassportIssuer:g.nationalityCode||null,PaxType:null,Uuid:null,Id:0};_.value=!0,j.addPreviousPax(R).then(()=>{$.loadPrevPax(!0),_.value=!1,H("close")}).catch(I=>{o(I),_.value=!1})}};re({back:()=>{O.value&&H("close")}});const E=_e();return(B,d)=>(N(),ee(Ot,{title:"افزودن مسافر",onClose:d[2]||(d[2]=g=>H("close"))},{footer:ue(()=>[G("div",Ar,[ae(Ce,{id:"click cancle button-pLp",type:"bordered","full-width":"",onClick:d[0]||(d[0]=g=>H("close"))},{default:ue(()=>[Pe(he(c(E).t("PrevPax.cancel")),1)]),_:1}),ae(Ce,{id:"click record button-pLp","full-width":"",loading:c(_),onClick:d[1]||(d[1]=g=>v())},{default:ue(()=>[Pe(he(c(E).t("PrevPax.register")),1)]),_:1},8,["loading"])])]),default:ue(()=>[ae(Dt,{ref_key:"passengerForm",ref:q,column:"","passenger-title":"افزودن مسافر","pax-type":c(Te).Adult,"foreigner-extra-fields":c(me).NationalityCode,"iranian-extra-fields":c(me).NationalCode,"required-fields":c(b),"default-fields":c(m),"form-type":"AddPrevPax"},null,8,["pax-type","foreigner-extra-fields","iranian-extra-fields","required-fields","default-fields"])]),_:1}))}});const Cr=Ae(wr,[["__scopeId","data-v-a6034918"]]),_r=W=>(He("data-v-75da0672"),W=W(),Ue(),W),xr={class:"content"},Er={key:1},Sr={class:"not-found"},Or=_r(()=>G("img",{class:"image",alt:"Not found",src:fr},null,-1)),Rr={class:"body"},Mr={class:"new-users-title"},Tr={class:"footer-container"},Vr=ke({__name:"PrevPax",props:{paxIndex:{}},emits:["close"],setup(W,{expose:re,emit:H}){const j=Ie(),$=_e(),{open:q}=tt({component:Cr}),{open:O}=tt({component:hr}),{paxSort:o}=j,{prevPax:_}=We(j),m=Qe(),b=Ft("new-users",null),{isOrganizationalUser:v}=We(m),p=ot(),{isMobileSize:E}=st(),B=X(""),d=z(()=>{var i;return((i=j.prevPax)==null?void 0:i.length)===0}),g=z(()=>j.prevPaxLoadingStatus!==it.None),R=z(()=>j.prevPaxLoadingStatus===it.Loading),I=z(()=>{var i;return(((i=j.prevPax)==null?void 0:i.length)||0)<7}),C=z(()=>{var i,e;return((e=(i=_.value)==null?void 0:i.map((n,l)=>{var a;return{label:`${n.persianFirstName||n.firstName} ${n.persianLastName||n.lastName} ${V(n.paxType)}`,value:n.id,disabled:w(n),description:x(n),nationalCode:n.nationalCode,className:b.value&&_.value&&((a=_.value)==null?void 0:a.length)-Number(b.value)-1===l?"divider":void 0}}))==null?void 0:e.filter(n=>{var l;return!B.value.trim()||n.label.replace(/ \(.*\)$/g,"").toLowerCase().includes(B.value.trim().toLowerCase())||((l=n.nationalCode)==null?void 0:l.includes(B.value.trim().toLowerCase()))}))||[]}),f=z(()=>j.disablePaxTypeValidation),y=z(()=>{var i,e;return(e=(i=j.prevPax)==null?void 0:i.find(n=>n.selectedForIndex===W.paxIndex))==null?void 0:e.id}),k=()=>{q()},S=async()=>{var e;p.trackPosthog("add-prev-pax-open-excel-modal");const{args:i}=await O();i!=null&&i[0]&&(p.trackPosthog("add-prev-pax-success-excel-usage"),b.value=(e=_.value)==null?void 0:e.length,o("NewestFirst"),j.loadPrevPax(!0))},T=()=>{H("close")},V=(i,e)=>{if(f.value)return e?`(مسافر ${e})`:"";switch(i){case Te.Adult:return`(${$.t("PrevPax.adult")}${e?` ${e}`:""})`;case Te.Child:return`(${$.t("PrevPax.child")}${e?` ${e}`:""})`;case Te.Infant:return`(${$.t("PrevPax.infant")}${e?` ${e}`:""})`;default:return""}},x=i=>i.selectedForIndex!==null&&i.selectedForIndex!==W.paxIndex?V(i.paxType,i.selectedForIndex+1):"",w=i=>i.selectedForIndex!==null&&i.selectedForIndex!==W.paxIndex?!0:f.value?!1:j.paxForms[W.paxIndex].paxType!==i.paxType,h=i=>{j.selectPrevPax({paxIndex:W.paxIndex,id:i}),H("close")};return re({open:g}),(i,e)=>(N(),ee(Ot,{title:c($).t("PrevPax.selectPassenger"),"mobile-page":"",onClose:T},{footer:ue(()=>[G("div",Tr,[rt(ae(Ce,{id:"add-passenger-button",class:"action-button",type:"bordered","full-width":"",onClick:S},{default:ue(()=>[Pe(" افزودن گروهی ")]),_:1},512),[[at,c(v)]]),ae(Ce,{id:"add-passenger-button",class:"action-button","full-width":"",onClick:k},{default:ue(()=>[Pe(he(c($).t("PrevPax.addPassenger")),1)]),_:1})])]),default:ue(()=>[G("div",xr,[c(R)?(N(),ee(Rt,{key:0})):c(d)?(N(),Z("div",Er,[G("div",Sr,[Or,G("span",Rr,he(c($).t("PrevPax.noPassenger")),1)])])):(N(),Z(ve,{key:2},[ae(be,{modelValue:c(B),"onUpdate:modelValue":e[0]||(e[0]=n=>ct(B)?B.value=n:null),required:"",placeholder:"جستجوی مسافر براساس نام، نام خانوادگی یا کد ملی",class:Re(["search",{hide:c(I)}]),label:c(E)?void 0:c($).t("PrevPax.selectPassengerPlz")},null,8,["modelValue","class","label"]),rt(G("div",Mr," اخیراً افزوده شده ",512),[[at,c(b)!==null]]),ae(Lt,{name:`prev-pax-${i.paxIndex}-old`,radios:c(C),"model-value":c(y),"gap-items":8,"onUpdate:modelValue":h},null,8,["name","radios","model-value"])],64))])]),_:1},8,["title"]))}});const Ir=Ae(Vr,[["__scopeId","data-v-75da0672"]]),Br={class:"optional-service-container"},Dr=ke({__name:"TrainOptionalService",props:{passengerIndex:{}},setup(W,{expose:re}){const H=lt(),j=_e(),$=X([]),q=X([]),O=z(()=>H.optionalServices.filter(p=>{var E;return(E=p.services)==null?void 0:E.length})),o=z(()=>H.selectedOptionalServicesByPaxIndex[W.passengerIndex]),_=z(()=>O.value.map(p=>({...p,services:p.services.map(E=>({id:E.id,label:E.price?`${E.label} - ${Ze(E.price)}`:`${E.label} (${j.t("free")})`}))}))),m=(p,E)=>{H.selectOptionalService({services:p,passIndex:E})},b=(p,E)=>{var B;p&&($.value[E]=(B=O.value[E])==null?void 0:B.services.find(d=>d.id===p.id),v())},v=()=>(q.value=$.value.map(p=>!(p&&p.id!==null&&p.id!==void 0)),q.value.some(p=>p));return Ee(()=>$.value,p=>{if(p!=null&&p.some(E=>!o.value||!o.value.some(B=>(B==null?void 0:B.service)===E))){const E=p.filter(B=>B!==void 0).map((B,d)=>({service:B,itineraryPackage:O.value[d].itineraryPackage}));m(E,W.passengerIndex)}},{deep:!0}),Ee(()=>o.value,()=>{$.value=O.value.map((p,E)=>{var d,g;const B=(d=o.value)==null?void 0:d.find(R=>(R==null?void 0:R.itineraryPackage)===p.itineraryPackage);return(B==null?void 0:B.service)??((g=O.value[E])==null?void 0:g.services[0])})},{immediate:!0}),re({validate:v}),(p,E)=>(N(),Z("span",Br,[(N(!0),Z(ve,null,Ve(c(_),(B,d)=>(N(),ee(It,{key:d,"model-value":c($)[d],placeholder:c(j).t("TrainOptionalService.selectServiceRoute",{origin:B.itineraryPackage.origin,destination:B.itineraryPackage.destination}),label:c(j).t("TrainOptionalService.selectServiceRoute",{origin:B.itineraryPackage.origin,destination:B.itineraryPackage.destination}),invalid:!!c(q)[d],options:B.services,description:c(q)[d]?c(j).t("TrainOptionalService.selectServiceError"):void 0,required:"","onUpdate:modelValue":g=>b(g,d)},null,8,["model-value","placeholder","label","invalid","options","description","onUpdate:modelValue"]))),128))]))}});const Wr=Ae(Dr,[["__scopeId","data-v-16f11732"]]),Fr={class:"delete-pax"},Lr=ke({__name:"BuyForm",props:{index:{default:0},busSeatHandler:{}},emits:["submit"],setup(W,{expose:re,emit:H}){const j={[de.CarModel]:"carModel",[de.CarPlate]:"carPlate",[de.TrainOptionalService]:"trainOptionalService",[de.HotelEarlyCheckin]:"hotelEarlyCheckin",[de.HotelLateCheckout]:"hotelLateCheckout",[de.All]:"undef",[de.None]:"undef"},$=Ye(),q=Qe(),O=Ie(),o=lt(),{day:_}=Mt(),m=_e(),b=X(null),v=X(null),p=X(null),{open:E,close:B}=tt({component:Ir,attrs:{paxIndex:W.index}}),d=ut(),g=Xe(),{handleException:R}=dt(),I=X(de),C=X({carPlate:[],carModel:"",undef:void 0,hotelEarlyCheckin:!1,hotelLateCheckout:!1}),f=X({}),y=z(()=>O.paxForms[W.index]),k=z(()=>O.itineraryPackages[0]),S=z(()=>{var A,M;return W.index?null:(A=q.userInfo)!=null&&A.birthDate?_.gregory((M=q.userInfo)==null?void 0:M.birthDate).toDate():null}),T=z(()=>{var A,M;return W.index?null:(A=q.userInfo)!=null&&A.passportExpiry?_.gregory((M=q.userInfo)==null?void 0:M.passportExpiry).toDate():null}),V=z(()=>W.index?o.pax[W.index]:o.pax[W.index]||O.defaultPassenger),x=z(()=>$.reserveType===Ke.Hotel?y.value.title:`${W.index+1}. ${y.value.title}`),w=z(()=>{var D;const{adultCount:A}=O,M=A===1&&y.value.paxType===Te.Adult;return((D=k.value)==null?void 0:D.hasPassengerDelete)&&!M}),h=z(()=>Object.keys(f.value).reduce((A,M)=>A||f.value[parseInt(M)],!1)),i=z(()=>{var M;let A=(M=b.value)==null?void 0:M.dirty;return A||(A=!!C.value.carModel),A||(A=C.value.carPlate.some(Boolean)),A||(A=C.value.hotelEarlyCheckin),A||(A=C.value.hotelLateCheckout),A}),e=async()=>{d==null||d.trackEvent({event:"pfp-passenger list button click"});let A=!0;if(!q.loggedIn)try{A=await q.promptLogin({message:"برای استفاده از لیست مسافران قبلی، به حساب کاربری خود وارد شوید.",rejectionText:""})}catch{}A&&(sessionStorage.getItem("new-users")&&O.paxSort("NewestFirst"),O.loadPrevPax(),E())},n=async()=>{var D;const A=(D=b.value)==null?void 0:D.dirty;let M;if(A?M=(await g({title:"حذف مسافر",icon:"warning",text:"آیا از حذف این مسافر مطمئن هستید؟",showCancelButton:!0,cancelButtonText:"انصراف",confirmButtonText:"بله حذف کن"})).isConfirmed:M=!0,M)try{O.deletePax(W.index),Me(()=>{o.deselectOptionalService(W.index),Me(()=>O.refetchPrebills())})}catch(F){R(F,{title:"خطا!"})}},l=(A,M)=>{let D=M;return M===void 0&&(D=y.value.buyExtraFields),!!(D&A)},a=A=>l(A,y.value.requiredBuyExtraFields),r=()=>u(de.All),u=A=>{let M=!0;A===de.All&&(f.value={},M=b.value.validateAll());for(const D in de){const F=parseInt(D);if(F&A&&a(F)&&l(F)){const K=C.value[j[F]];f.value[F]=K===""||Array.isArray(K)&&(K==null?void 0:K.length)===0}}return A&de.CarPlate&&l(de.CarPlate)&&p&&(f.value[de.CarPlate]=p.value.validate()),A&de.TrainOptionalService&&l(de.TrainOptionalService)&&v&&(f.value[de.TrainOptionalService]=v.value.validate()),!h.value&&M},s=A=>f.value[A]?"input-error":"",t=()=>{var M;return{...(M=b.value)==null?void 0:M.getData(),carPlate:C.value.carPlate,carModel:C.value.carModel,trainOptionalService:o.selectedOptionalServicesByPaxIndex[W.index],hotelLateCheckout:C.value.hotelLateCheckout,hotelEarlyCheckin:C.value.hotelEarlyCheckin}};function P(A){W.busSeatHandler.updateGender(W.index,A)}return re({inputError:s,getData:t,validateAll:r,dirty:i,closePaxModal:B}),(A,M)=>{var D;return N(),ee(Dt,{ref_key:"form",ref:b,index:A.index,"passenger-title":c(x),"passenger-sub-title":c(y).subTitle,"initial-value":c(V),"initial-birth-date":c(S),"initial-passport-expiry":c(T),"default-fields":c(y).fields,"required-fields":c(y).requiredFields,"iranian-required-fields":c(y).iranianExtraFields,"foreigner-required-fields":c(y).foreignerExtraFields,"iranian-extra-fields":c(y).iranianExtraFields,"foreigner-extra-fields":c(y).foreignerExtraFields,"pax-type":c(y).paxType,"initial-gender":(D=c(y).metadata)==null?void 0:D.gender,"form-type":"BuyForm",onSubmit:M[6]||(M[6]=F=>H("submit")),"onUpdate:gender":P},{"header-append":ue(()=>[G("div",Fr,[ae(Ce,{type:"transparent",size:"medium","right-icon":c(Nt),onClick:e},{default:ue(()=>[Pe(" مسافران قبلی ")]),_:1},8,["right-icon"]),c(w)?(N(),ee(nt,{key:0,margin:"0",vertical:"",size:"20px"})):se("",!0),c(w)?(N(),ee(Ce,{key:1,type:"transparent",size:"medium","icon-button":{icon:c(jt),color:"var(--red-400)"},onClick:M[0]||(M[0]=F=>n())},null,8,["icon-button"])):se("",!0)])]),"extra-fields":ue(()=>[l(c(I).TrainOptionalService)?(N(),ee(Wr,{key:"TrainOptionalService",ref_key:"trainOptionalServiceRef",ref:v,"passenger-index":A.index},null,8,["passenger-index"])):se("",!0),l(c(I).CarModel)?(N(),ee(be,{id:"CarModel",key:"CarModel",modelValue:c(C).carModel,"onUpdate:modelValue":M[1]||(M[1]=F=>c(C).carModel=F),"data-id":"car-model",size:"dense",autocomplete:"off",required:"",placeholder:c(m).t("PassengerForm.carExample"),label:c(m).t("PassengerForm.carModel"),type:"text",class:Re(["passportNumber required",s(c(I).CarModel)]),invalid:c(f)[c(I).CarModel],onBlur:M[2]||(M[2]=F=>u(c(I).CarModel))},null,8,["modelValue","placeholder","label","class","invalid"])):se("",!0),l(c(I).CarPlate)?(N(),ee(yr,{key:"CarPlate",ref_key:"carPlate",ref:p,modelValue:c(C).carPlate,"onUpdate:modelValue":M[3]||(M[3]=F=>c(C).carPlate=F)},null,8,["modelValue"])):se("",!0),ae(kr,{"package-index":A.index,"has-late-checkout":l(c(I).HotelLateCheckout),"has-early-checkin":l(c(I).HotelEarlyCheckin),"onUpdate:late":M[4]||(M[4]=F=>c(C).hotelLateCheckout=F),"onUpdate:early":M[5]||(M[5]=F=>c(C).hotelEarlyCheckin=F)},null,8,["package-index","has-late-checkout","has-early-checkin"])]),_:1},8,["index","passenger-title","passenger-sub-title","initial-value","initial-birth-date","initial-passport-expiry","default-fields","required-fields","iranian-required-fields","foreigner-required-fields","iranian-extra-fields","foreigner-extra-fields","pax-type","initial-gender"])}}});const Nr=Ae(Lr,[["__scopeId","data-v-1d9abcf9"]]),jr={id:"contact"},$r={class:"info-form"},qr={class:"contact-title"},Hr=ke({__name:"ContactForm",props:{hasDestinationPhone:{type:Boolean},initialValue:{default:()=>({email:null,phone:null,mobile:null,destinationMobile:null})}},emits:["submit"],setup(W,{expose:re,emit:H}){const j=Qe(),$=Ie(),{initialContact:q}=We($),O=Xe(),o=_e(),{isMobileSize:_}=st(),m=ut(),b=X({mobile:"",destinationMobile:"",email:"",phone:""}),v=X({}),p=X({}),E=X({}),B=z(()=>{const h=Object.keys(p.value).reduce((e,n)=>e||p.value[parseInt(n)],!1),i=Object.keys(E.value).reduce((e,n)=>e||E.value[n],!1);return h||i}),d=z(()=>_.value?"number":"text"),g=z(()=>!!b.value.destinationMobile||!!b.value.email||!!b.value.mobile||!!b.value.phone||!!Object.keys(v.value).length),R=z(()=>$.extraInfoFields),I=z(()=>{const h=i=>{var e,n,l,a;switch(i.Type){case"CheckBox":return{component:"MrCheckbox",required:!!i.Required};case"Switch":return{component:"MrSwitch",activeLabel:((e=i.Items)==null?void 0:e[0])||void 0,inactiveLabel:((n=i.Items)==null?void 0:n[1])||void 0,required:!!i.Required};case"Radio":return{component:"MrRadioButton",name:i.Label,radios:(l=i.Items)==null?void 0:l.map(r=>({label:r,value:r})),required:!!i.Required};case"Select":return{component:"MrSelect",options:(a=i.Items)==null?void 0:a.map(r=>({id:r,label:r})),required:!!i.Required};case"TextArea":case"TextField":return{component:"MrInput",textArea:i.Type==="TextArea",fullWidth:!0,required:!!i.Required};default:return{component:""}}};return R.value.map(i=>({label:i.Label||"",placeholder:i.Placeholder||"",required:!!i.Required,style:i.Width?{flexBasis:`${i.Width}%`}:void 0,...i,...h(i)}))}),C=z(()=>R.value.map(h=>{const i=v.value[h.Label||""];return h.Type==="Select"?v?{id:i,label:i}:void 0:v})),f=z(()=>Object.entries(v.value).map(([h,i])=>`${h}: ${i}`).join("،")),y=()=>k(oe.All),k=h=>(h&oe.Mobile&&(m==null||m.trackEvent({event:"generate_lead"}),p.value[oe.Mobile]=!/^09\d{9}$/.test(qe(b.value.mobile||""))),h&oe.Phone&&(p.value[oe.Phone]=!!b.value.phone&&!/^0\d{10}$/.test(qe(b.value.phone))),h&oe.Email&&(p.value[oe.Email]=!!b.value.email&&!/^(([^<>()\\[\].,;:\s@"]+(\.[^<>()\\[\].,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}])|(([a-zA-Z\-\d]+\.)+[a-zA-Z]{2,}))$/.test(b.value.email)),h&oe.DestinationMobile&&(p.value[oe.DestinationMobile]=!!b.value.destinationMobile&&!/^(\+|00|0)[1-9][0-9]{7,32}$/.test(qe(b.value.destinationMobile))),S(),!B.value),S=()=>{R.value.forEach(h=>T(h))},T=h=>{if(h.Required){const i=v.value[h.Label||""];E.value[h.Label||""]=i==null||i===""}},V=()=>{const h={...b.value};return h.mobile=qe(h.mobile),h.destinationMobile=qe(h.destinationMobile),h},x=h=>{if(h.key==="Enter"){H("submit");return}h.key.match(/[0-9۰-۹]+/)||(O({icon:"warning",text:o.t("ContactForm.numbersOnly"),confirmButtonText:o.t("ContactForm.ok")}),h.preventDefault())},w=(h,i)=>{if(h.Type==="Select"){const e=i;v.value[h.Label||""]=e.id}else v.value[h.Label||""]=i;Me(()=>T(h))};return Ee(q,h=>{!b.value.mobile&&!b.value.phone&&!b.value.email&&(b.value.mobile=h.mobile||"",b.value.email=h.email||"",b.value.phone=h.tel||"")}),ze(()=>{j.loadUser(!1,0),W.initialValue.mobile||W.initialValue.destinationMobile||W.initialValue.email||W.initialValue.phone?(b.value.mobile=W.initialValue.mobile||"",b.value.destinationMobile=W.initialValue.destinationMobile||"",b.value.email=W.initialValue.email||"",b.value.phone=W.initialValue.phone||""):(b.value.mobile=q.value.mobile||"",b.value.email=q.value.email||"",b.value.phone=q.value.tel||"")}),re({dirty:g,extraData:f,validateAll:y,getData:V}),(h,i)=>(N(),Z("div",jr,[G("div",$r,[G("span",qr,he(c(o).t("ContactForm.contacts")),1),ae(be,{modelValue:c(b).mobile,"onUpdate:modelValue":[i[0]||(i[0]=e=>c(b).mobile=e),i[2]||(i[2]=e=>k(c(oe).Mobile))],class:"mobile info-item","data-id":"mobile","max-length":11,dir:"ltr",placeholder:c(o).t("ContactForm.mobilePhone"),label:c(o).t("ContactForm.mobilePhone"),type:c(d),valid:"false",style:{"background-color":"white"},size:"dense",invalid:c(p)[c(oe).Mobile],required:"",onBlur:i[1]||(i[1]=e=>k(c(oe).Mobile)),onKeypress:x},null,8,["modelValue","placeholder","label","type","invalid"]),ae(be,{modelValue:c(b).phone,"onUpdate:modelValue":[i[3]||(i[3]=e=>c(b).phone=e),i[5]||(i[5]=e=>k(c(oe).Phone))],class:"info-item","data-id":"phone","max-length":11,dir:"ltr",placeholder:c(o).t("ContactForm.linePhone"),label:c(o).t("ContactForm.linePhone"),type:c(d),valid:"false",style:{"background-color":"white"},invalid:c(p)[c(oe).Phone],size:"dense",onBlur:i[4]||(i[4]=e=>k(c(oe).Phone)),onKeypress:x},null,8,["modelValue","placeholder","label","type","invalid"]),h.hasDestinationPhone?(N(),ee(be,{key:0,modelValue:c(b).destinationMobile,"onUpdate:modelValue":[i[6]||(i[6]=e=>c(b).destinationMobile=e),i[8]||(i[8]=e=>k(c(oe).DestinationMobile))],"data-id":"dest-mobile",class:"destinationMobile info-item",dir:"ltr",placeholder:c(o).t("ContactForm.destinationPhone"),label:c(o).t("ContactForm.destinationPhone"),type:c(d),invalid:c(p)[c(oe).DestinationMobile],size:"dense",onBlur:i[7]||(i[7]=e=>k(c(oe).DestinationMobile)),onKeypress:x},null,8,["modelValue","placeholder","label","type","invalid"])):se("",!0),ae(be,{modelValue:c(b).email,"onUpdate:modelValue":i[9]||(i[9]=e=>c(b).email=e),class:"info-item","data-id":"email",dir:"ltr",placeholder:c(o).t("ContactForm.email"),label:c(o).t("ContactForm.email"),type:"text",size:"dense",invalid:c(p)[c(oe).Email],onBlur:i[10]||(i[10]=e=>k(c(oe).Email))},null,8,["modelValue","placeholder","label","invalid"]),(N(!0),Z(ve,null,Ve(c(I),(e,n)=>(N(),ee(rr(e.component),tr({key:e.label},e,{"model-value":c(C)[n],invalid:c(E)[e.Label??""],"onUpdate:modelValue":l=>w(e,l),onBlur:l=>T(e)}),null,16,["model-value","invalid","onUpdate:modelValue","onBlur"]))),128))])]))}});const Ur=Ae(Hr,[["__scopeId","data-v-680e38f0"]]),zr=W=>(He("data-v-5677ff8b"),W=W(),Ue(),W),Gr=zr(()=>G("span",{class:"request-title"},"ترانسفر رایگان",-1)),Kr={class:"field-container"},Qr={class:"inputs"},Yr=ke({__name:"FreeTransferForm",setup(W,{expose:re}){const H=Ie(),j=X({origin:"",flightNumber:""}),$=z(()=>{var O;return((O=H.itineraryPackages[0])==null?void 0:O.hasFreeTransfer)??!1}),q=z(()=>!!j.value.origin||!!j.value.flightNumber);return ze(()=>{if($.value){const O=H.itineraryPackages[1];O&&O.isFlightPackage()&&(j.value={flightNumber:O.serviceNumber,origin:O.originName})}}),re({dirty:q,origin:j.value.origin,flightNumber:j.value.flightNumber}),(O,o)=>rt((N(),ee(Bt,{class:"free-transfer",description:"برای استفاده از ترانسفر رایگان هتل، شماره پرواز خود را وارد کنید. در صورت نیاز می‌توانید این مورد را بعداً به صورت تلفنی به تیم پشتیبانی مستربلیط اطلاع دهید."},{title:ue(()=>[Gr]),default:ue(()=>[G("div",Kr,[G("div",Qr,[ae(be,{modelValue:c(j).flightNumber,"onUpdate:modelValue":o[0]||(o[0]=_=>c(j).flightNumber=_),label:"شماره پرواز",placeholder:"شماره پرواز","hide-description":""},null,8,["modelValue"]),ae(be,{modelValue:c(j).origin,"onUpdate:modelValue":o[1]||(o[1]=_=>c(j).origin=_),label:"مبدأ پرواز",placeholder:"مبدأ پرواز","hide-description":""},null,8,["modelValue"])])])]),_:1},512)),[[at,c($)]])}});const Xr=Ae(Yr,[["__scopeId","data-v-5677ff8b"]]),Jr=W=>(He("data-v-d6284f8e"),W=W(),Ue(),W),Zr=Jr(()=>G("span",{class:"request-title"}," درخواست اضافه از هتل (اختیاری)",-1)),ea=ke({__name:"HotelRequestForm",setup(W,{expose:re}){const H=X("");return re({value:H}),(j,$)=>(N(),ee(Bt,{"initial-state":"opened",class:"root",description:"درخواست شما را به هتل منتقل می‌کنیم. اما انجام شدن درخواست، بستگی به شرایط هتل دارد."},{title:ue(()=>[Zr]),default:ue(()=>[ae(be,{modelValue:c(H),"onUpdate:modelValue":$[0]||($[0]=q=>ct(H)?H.value=q:null),"hide-description":"","text-area":"","full-width":"",placeholder:"درخواست اضافه از هتل"},null,8,["modelValue"])]),_:1}))}});const ta=Ae(ea,[["__scopeId","data-v-d6284f8e"]]);var Wt={exports:{}};/*!
 * wavesurfer.js 6.6.4 (2023-06-10)
 * https://wavesurfer-js.org
 * @license BSD-3-Clause
 */(function(W,re){(function(j,$){W.exports=$()})(self,()=>(()=>{var H={"./src/drawer.canvasentry.js":(O,o,_)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var m=v(_("./src/util/style.js")),b=v(_("./src/util/get-id.js"));function v(C){return C&&C.__esModule?C:{default:C}}function p(C){"@babel/helpers - typeof";return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},p(C)}function E(C,f){if(!(C instanceof f))throw new TypeError("Cannot call a class as a function")}function B(C,f){for(var y=0;y<f.length;y++){var k=f[y];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(C,g(k.key),k)}}function d(C,f,y){return f&&B(C.prototype,f),y&&B(C,y),Object.defineProperty(C,"prototype",{writable:!1}),C}function g(C){var f=R(C,"string");return p(f)==="symbol"?f:String(f)}function R(C,f){if(p(C)!=="object"||C===null)return C;var y=C[Symbol.toPrimitive];if(y!==void 0){var k=y.call(C,f||"default");if(p(k)!=="object")return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(C)}var I=function(){function C(){E(this,C),this.wave=null,this.waveCtx=null,this.progress=null,this.progressCtx=null,this.start=0,this.end=1,this.id=(0,b.default)(typeof this.constructor.name<"u"?this.constructor.name.toLowerCase()+"_":"canvasentry_"),this.canvasContextAttributes={}}return d(C,[{key:"initWave",value:function(y){this.wave=y,this.waveCtx=this.wave.getContext("2d",this.canvasContextAttributes)}},{key:"initProgress",value:function(y){this.progress=y,this.progressCtx=this.progress.getContext("2d",this.canvasContextAttributes)}},{key:"updateDimensions",value:function(y,k,S,T){this.start=this.wave.offsetLeft/k||0,this.end=this.start+y/k,this.wave.width=S,this.wave.height=T;var V={width:y+"px"};(0,m.default)(this.wave,V),this.hasProgressCanvas&&(this.progress.width=S,this.progress.height=T,(0,m.default)(this.progress,V))}},{key:"clearWave",value:function(){this.waveCtx.clearRect(0,0,this.waveCtx.canvas.width,this.waveCtx.canvas.height),this.hasProgressCanvas&&this.progressCtx.clearRect(0,0,this.progressCtx.canvas.width,this.progressCtx.canvas.height)}},{key:"setFillStyles",value:function(y,k){this.waveCtx.fillStyle=this.getFillStyle(this.waveCtx,y),this.hasProgressCanvas&&(this.progressCtx.fillStyle=this.getFillStyle(this.progressCtx,k))}},{key:"getFillStyle",value:function(y,k){if(typeof k=="string"||k instanceof CanvasGradient)return k;var S=y.createLinearGradient(0,0,0,y.canvas.height);return k.forEach(function(T,V){return S.addColorStop(V/k.length,T)}),S}},{key:"applyCanvasTransforms",value:function(y){y&&(this.waveCtx.setTransform(0,1,1,0,0,0),this.hasProgressCanvas&&this.progressCtx.setTransform(0,1,1,0,0,0))}},{key:"fillRects",value:function(y,k,S,T,V){this.fillRectToContext(this.waveCtx,y,k,S,T,V),this.hasProgressCanvas&&this.fillRectToContext(this.progressCtx,y,k,S,T,V)}},{key:"fillRectToContext",value:function(y,k,S,T,V,x){y&&(x?this.drawRoundedRect(y,k,S,T,V,x):y.fillRect(k,S,T,V))}},{key:"drawRoundedRect",value:function(y,k,S,T,V,x){V!==0&&(V<0&&(V*=-1,S-=V),y.beginPath(),y.moveTo(k+x,S),y.lineTo(k+T-x,S),y.quadraticCurveTo(k+T,S,k+T,S+x),y.lineTo(k+T,S+V-x),y.quadraticCurveTo(k+T,S+V,k+T-x,S+V),y.lineTo(k+x,S+V),y.quadraticCurveTo(k,S+V,k,S+V-x),y.lineTo(k,S+x),y.quadraticCurveTo(k,S,k+x,S),y.closePath(),y.fill())}},{key:"drawLines",value:function(y,k,S,T,V,x){this.drawLineToContext(this.waveCtx,y,k,S,T,V,x),this.hasProgressCanvas&&this.drawLineToContext(this.progressCtx,y,k,S,T,V,x)}},{key:"drawLineToContext",value:function(y,k,S,T,V,x,w){if(y){var h=k.length/2,i=Math.round(h*this.start),e=Math.round(h*this.end)+1,n=i,l=e,a=this.wave.width/(l-n-1),r=T+V,u=S/T;y.beginPath(),y.moveTo((n-i)*a,r),y.lineTo((n-i)*a,r-Math.round((k[2*n]||0)/u));var s,t,P;for(s=n;s<l;s++)t=k[2*s]||0,P=Math.round(t/u),y.lineTo((s-i)*a+this.halfPixel,r-P);var A=l-1;for(A;A>=n;A--)t=k[2*A+1]||0,P=Math.round(t/u),y.lineTo((A-i)*a+this.halfPixel,r-P);y.lineTo((n-i)*a,r-Math.round((k[2*n+1]||0)/u)),y.closePath(),y.fill()}}},{key:"destroy",value:function(){this.waveCtx=null,this.wave=null,this.progressCtx=null,this.progress=null}},{key:"getImage",value:function(y,k,S){var T=this;if(S==="blob")return new Promise(function(V){T.wave.toBlob(V,y,k)});if(S==="dataURL")return this.wave.toDataURL(y,k)}}]),C}();o.default=I,O.exports=o.default},"./src/drawer.js":(O,o,_)=>{function m(x){"@babel/helpers - typeof";return m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},m(x)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var b=p(_("./src/util/index.js"));function v(x){if(typeof WeakMap!="function")return null;var w=new WeakMap,h=new WeakMap;return(v=function(e){return e?h:w})(x)}function p(x,w){if(!w&&x&&x.__esModule)return x;if(x===null||m(x)!=="object"&&typeof x!="function")return{default:x};var h=v(w);if(h&&h.has(x))return h.get(x);var i={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in x)if(n!=="default"&&Object.prototype.hasOwnProperty.call(x,n)){var l=e?Object.getOwnPropertyDescriptor(x,n):null;l&&(l.get||l.set)?Object.defineProperty(i,n,l):i[n]=x[n]}return i.default=x,h&&h.set(x,i),i}function E(x,w){if(!(x instanceof w))throw new TypeError("Cannot call a class as a function")}function B(x,w){for(var h=0;h<w.length;h++){var i=w[h];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(x,g(i.key),i)}}function d(x,w,h){return w&&B(x.prototype,w),h&&B(x,h),Object.defineProperty(x,"prototype",{writable:!1}),x}function g(x){var w=R(x,"string");return m(w)==="symbol"?w:String(w)}function R(x,w){if(m(x)!=="object"||x===null)return x;var h=x[Symbol.toPrimitive];if(h!==void 0){var i=h.call(x,w||"default");if(m(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(w==="string"?String:Number)(x)}function I(x,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function");x.prototype=Object.create(w&&w.prototype,{constructor:{value:x,writable:!0,configurable:!0}}),Object.defineProperty(x,"prototype",{writable:!1}),w&&C(x,w)}function C(x,w){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,e){return i.__proto__=e,i},C(x,w)}function f(x){var w=S();return function(){var i=T(x),e;if(w){var n=T(this).constructor;e=Reflect.construct(i,arguments,n)}else e=i.apply(this,arguments);return y(this,e)}}function y(x,w){if(w&&(m(w)==="object"||typeof w=="function"))return w;if(w!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return k(x)}function k(x){if(x===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return x}function S(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function T(x){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(h){return h.__proto__||Object.getPrototypeOf(h)},T(x)}var V=function(x){I(h,x);var w=f(h);function h(i,e){var n;return E(this,h),n=w.call(this),n.container=b.withOrientation(i,e.vertical),n.params=e,n.width=0,n.height=e.height*n.params.pixelRatio,n.lastPos=0,n.wrapper=null,n}return d(h,[{key:"style",value:function(e,n){return b.style(e,n)}},{key:"createWrapper",value:function(){this.wrapper=b.withOrientation(this.container.appendChild(document.createElement("wave")),this.params.vertical),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",cursor:this.params.hideCursor?"none":"auto",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()}},{key:"handleEvent",value:function(e,n){!n&&e.preventDefault();var l=b.withOrientation(e.targetTouches?e.targetTouches[0]:e,this.params.vertical).clientX,a=this.wrapper.getBoundingClientRect(),r=this.width,u=this.getWidth(),s=this.getProgressPixels(a,l),t;return!this.params.fillParent&&r<u?t=s*(this.params.pixelRatio/r)||0:t=(s+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,b.clamp(t,0,1)}},{key:"getProgressPixels",value:function(e,n){return this.params.rtl?e.right-n:n-e.left}},{key:"setupWrapperEvents",value:function(){var e=this;this.wrapper.addEventListener("click",function(n){var l=b.withOrientation(n,e.params.vertical),a=e.wrapper.offsetHeight-e.wrapper.clientHeight;if(a!==0){var r=e.wrapper.getBoundingClientRect();if(l.clientY>=r.bottom-a)return}e.params.interact&&e.fireEvent("click",n,e.handleEvent(n))}),this.wrapper.addEventListener("dblclick",function(n){e.params.interact&&e.fireEvent("dblclick",n,e.handleEvent(n))}),this.wrapper.addEventListener("scroll",function(n){return e.fireEvent("scroll",n)})}},{key:"drawPeaks",value:function(e,n,l,a){this.setWidth(n)||this.clearWave(),this.params.barWidth?this.drawBars(e,0,l,a):this.drawWave(e,0,l,a)}},{key:"resetScroll",value:function(){this.wrapper!==null&&(this.wrapper.scrollLeft=0)}},{key:"recenter",value:function(e){var n=this.wrapper.scrollWidth*e;this.recenterOnPosition(n,!0)}},{key:"recenterOnPosition",value:function(e,n){var l=this.wrapper.scrollLeft,a=~~(this.wrapper.clientWidth/2),r=this.wrapper.scrollWidth-this.wrapper.clientWidth,u=e-a,s=u-l;if(r!=0){if(!n&&-a<=s&&s<a){var t=this.params.autoCenterRate;t/=a,t*=r,s=Math.max(-t,Math.min(t,s)),u=l+s}u=Math.max(0,Math.min(r,u)),u!=l&&(this.wrapper.scrollLeft=u)}}},{key:"getScrollX",value:function(){var e=0;if(this.wrapper){var n=this.params.pixelRatio;if(e=Math.round(this.wrapper.scrollLeft*n),this.params.scrollParent){var l=~~(this.wrapper.scrollWidth*n-this.getWidth());e=Math.min(l,Math.max(0,e))}}return e}},{key:"getWidth",value:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)}},{key:"setWidth",value:function(e){if(this.width==e)return!1;if(this.width=e,this.params.fillParent||this.params.scrollParent)this.style(this.wrapper,{width:""});else{var n=~~(this.width/this.params.pixelRatio)+"px";this.style(this.wrapper,{width:n})}return this.updateSize(),!0}},{key:"setHeight",value:function(e){return e==this.height?!1:(this.height=e,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"progress",value:function(e){var n=1/this.params.pixelRatio,l=Math.round(e*this.width)*n;if(l<this.lastPos||l-this.lastPos>=n){if(this.lastPos=l,this.params.scrollParent&&this.params.autoCenter){var a=~~(this.wrapper.scrollWidth*e);this.recenterOnPosition(a,this.params.autoCenterImmediately)}this.updateProgress(l)}}},{key:"destroy",value:function(){this.unAll(),this.wrapper&&(this.wrapper.parentNode==this.container.domElement&&this.container.removeChild(this.wrapper.domElement),this.wrapper=null)}},{key:"updateCursor",value:function(){}},{key:"updateSize",value:function(){}},{key:"drawBars",value:function(e,n,l,a){}},{key:"drawWave",value:function(e,n,l,a){}},{key:"clearWave",value:function(){}},{key:"updateProgress",value:function(e){}}]),h}(b.Observer);o.default=V,O.exports=o.default},"./src/drawer.multicanvas.js":(O,o,_)=>{function m(i){"@babel/helpers - typeof";return m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(i)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var b=d(_("./src/drawer.js")),v=B(_("./src/util/index.js")),p=d(_("./src/drawer.canvasentry.js"));function E(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(E=function(a){return a?n:e})(i)}function B(i,e){if(!e&&i&&i.__esModule)return i;if(i===null||m(i)!=="object"&&typeof i!="function")return{default:i};var n=E(e);if(n&&n.has(i))return n.get(i);var l={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in i)if(r!=="default"&&Object.prototype.hasOwnProperty.call(i,r)){var u=a?Object.getOwnPropertyDescriptor(i,r):null;u&&(u.get||u.set)?Object.defineProperty(l,r,u):l[r]=i[r]}return l.default=i,n&&n.set(i,l),l}function d(i){return i&&i.__esModule?i:{default:i}}function g(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function R(i,e){for(var n=0;n<e.length;n++){var l=e[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(i,C(l.key),l)}}function I(i,e,n){return e&&R(i.prototype,e),n&&R(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function C(i){var e=f(i,"string");return m(e)==="symbol"?e:String(e)}function f(i,e){if(m(i)!=="object"||i===null)return i;var n=i[Symbol.toPrimitive];if(n!==void 0){var l=n.call(i,e||"default");if(m(l)!=="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function y(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&k(i,e)}function k(i,e){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,a){return l.__proto__=a,l},k(i,e)}function S(i){var e=x();return function(){var l=w(i),a;if(e){var r=w(this).constructor;a=Reflect.construct(l,arguments,r)}else a=l.apply(this,arguments);return T(this,a)}}function T(i,e){if(e&&(m(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return V(i)}function V(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function w(i){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},w(i)}var h=function(i){y(n,i);var e=S(n);function n(l,a){var r;return g(this,n),r=e.call(this,l,a),r.maxCanvasWidth=a.maxCanvasWidth,r.maxCanvasElementWidth=Math.round(a.maxCanvasWidth/a.pixelRatio),r.hasProgressCanvas=a.waveColor!=a.progressColor,r.halfPixel=.5/a.pixelRatio,r.canvases=[],r.progressWave=null,r.EntryClass=p.default,r.canvasContextAttributes=a.drawingContextAttributes,r.overlap=2*Math.ceil(a.pixelRatio/2),r.barRadius=a.barRadius||0,r.vertical=a.vertical,r}return I(n,[{key:"init",value:function(){this.createWrapper(),this.createElements()}},{key:"createElements",value:function(){this.progressWave=v.withOrientation(this.wrapper.appendChild(document.createElement("wave")),this.params.vertical),this.style(this.progressWave,{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"}),this.addCanvas(),this.updateCursor()}},{key:"updateCursor",value:function(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},{key:"updateSize",value:function(){for(var a=this,r=Math.round(this.width/this.params.pixelRatio),u=Math.ceil(r/(this.maxCanvasElementWidth+this.overlap));this.canvases.length<u;)this.addCanvas();for(;this.canvases.length>u;)this.removeCanvas();var s=this.maxCanvasWidth+this.overlap,t=this.canvases.length-1;this.canvases.forEach(function(P,A){A==t&&(s=a.width-a.maxCanvasWidth*t),a.updateDimensions(P,s,a.height),P.clearWave()})}},{key:"addCanvas",value:function(){var a=new this.EntryClass;a.canvasContextAttributes=this.canvasContextAttributes,a.hasProgressCanvas=this.hasProgressCanvas,a.halfPixel=this.halfPixel;var r=this.maxCanvasElementWidth*this.canvases.length,u=v.withOrientation(this.wrapper.appendChild(document.createElement("canvas")),this.params.vertical);if(this.style(u,{position:"absolute",zIndex:2,left:r+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"}),a.initWave(u),this.hasProgressCanvas){var s=v.withOrientation(this.progressWave.appendChild(document.createElement("canvas")),this.params.vertical);this.style(s,{position:"absolute",left:r+"px",top:0,bottom:0,height:"100%"}),a.initProgress(s)}this.canvases.push(a)}},{key:"removeCanvas",value:function(){var a=this.canvases[this.canvases.length-1];a.wave.parentElement.removeChild(a.wave.domElement),this.hasProgressCanvas&&a.progress.parentElement.removeChild(a.progress.domElement),a&&(a.destroy(),a=null),this.canvases.pop()}},{key:"updateDimensions",value:function(a,r,u){var s=Math.round(r/this.params.pixelRatio),t=Math.round(this.width/this.params.pixelRatio);a.updateDimensions(s,t,r,u),this.style(this.progressWave,{display:"block"})}},{key:"clearWave",value:function(){var a=this;v.frame(function(){a.canvases.forEach(function(r){return r.clearWave()})})()}},{key:"drawBars",value:function(a,r,u,s){var t=this;return this.prepareDraw(a,r,u,s,function(P){var A=P.absmax,M=P.hasMinVals;P.height;var D=P.offsetY,F=P.halfH,K=P.peaks,U=P.channelIndex;if(u!==void 0){var ne=M?2:1,pe=K.length/ne,te=t.params.barWidth*t.params.pixelRatio,ge=t.params.barGap===null?Math.max(t.params.pixelRatio,~~(te/2)):Math.max(t.params.pixelRatio,t.params.barGap*t.params.pixelRatio),ce=te+ge,fe=pe/t.width,Le=u,Ne=s,xe=Le;for(xe;xe<Ne;xe+=ce){var je=0,L=Math.floor(xe*fe)*ne,Q=Math.floor((xe+ce)*fe)*ne;do{var Y=Math.abs(K[L]);Y>je&&(je=Y),L+=ne}while(L<Q);var J=Math.round(je/A*F);t.params.barMinHeight&&(J=Math.max(J,t.params.barMinHeight)),t.fillRect(xe+t.halfPixel,F-J+D,te+t.halfPixel,J*2,t.barRadius,U)}}})}},{key:"drawWave",value:function(a,r,u,s){var t=this;return this.prepareDraw(a,r,u,s,function(P){var A=P.absmax,M=P.hasMinVals;P.height;var D=P.offsetY,F=P.halfH,K=P.peaks,U=P.channelIndex;if(!M){var ne=[],pe=K.length,te=0;for(te;te<pe;te++)ne[2*te]=K[te],ne[2*te+1]=-K[te];K=ne}u!==void 0&&t.drawLine(K,A,F,D,u,s,U),t.fillRect(0,F+D-t.halfPixel,t.width,t.halfPixel,t.barRadius,U)})}},{key:"drawLine",value:function(a,r,u,s,t,P,A){var M=this,D=this.params.splitChannelsOptions.channelColors[A]||{},F=D.waveColor,K=D.progressColor;this.canvases.forEach(function(U,ne){M.setFillStyles(U,F,K),M.applyCanvasTransforms(U,M.params.vertical),U.drawLines(a,r,u,s,t,P)})}},{key:"fillRect",value:function(a,r,u,s,t,P){var A=Math.floor(a/this.maxCanvasWidth),M=Math.min(Math.ceil((a+u)/this.maxCanvasWidth)+1,this.canvases.length),D=A;for(D;D<M;D++){var F=this.canvases[D],K=D*this.maxCanvasWidth,U={x1:Math.max(a,D*this.maxCanvasWidth),y1:r,x2:Math.min(a+u,D*this.maxCanvasWidth+F.wave.width),y2:r+s};if(U.x1<U.x2){var ne=this.params.splitChannelsOptions.channelColors[P]||{},pe=ne.waveColor,te=ne.progressColor;this.setFillStyles(F,pe,te),this.applyCanvasTransforms(F,this.params.vertical),F.fillRects(U.x1-K,U.y1,U.x2-U.x1,U.y2-U.y1,t)}}}},{key:"hideChannel",value:function(a){return this.params.splitChannels&&this.params.splitChannelsOptions.filterChannels.includes(a)}},{key:"prepareDraw",value:function(a,r,u,s,t,P,A){var M=this;return v.frame(function(){if(a[0]instanceof Array){var D=a;if(M.params.splitChannels){var F=D.filter(function(ce,fe){return!M.hideChannel(fe)});M.params.splitChannelsOptions.overlay||M.setHeight(Math.max(F.length,1)*M.params.height*M.params.pixelRatio);var K;return M.params.splitChannelsOptions&&M.params.splitChannelsOptions.relativeNormalization&&(K=v.max(D.map(function(ce){return v.absMax(ce)}))),D.forEach(function(ce,fe){return M.prepareDraw(ce,fe,u,s,t,F.indexOf(ce),K)})}a=D[0]}if(!M.hideChannel(r)){var U=1/M.params.barHeight;M.params.normalize&&(U=A===void 0?v.absMax(a):A);var ne=[].some.call(a,function(ce){return ce<0}),pe=M.params.height*M.params.pixelRatio,te=pe/2,ge=pe*P||0;return M.params.splitChannelsOptions&&M.params.splitChannelsOptions.overlay&&(ge=0),t({absmax:U,hasMinVals:ne,height:pe,offsetY:ge,halfH:te,peaks:a,channelIndex:r})}})()}},{key:"setFillStyles",value:function(a){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.params.waveColor,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.params.progressColor;a.setFillStyles(r,u)}},{key:"applyCanvasTransforms",value:function(a){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;a.applyCanvasTransforms(r)}},{key:"getImage",value:function(a,r,u){if(u==="blob")return Promise.all(this.canvases.map(function(t){return t.getImage(a,r,u)}));if(u==="dataURL"){var s=this.canvases.map(function(t){return t.getImage(a,r,u)});return s.length>1?s:s[0]}}},{key:"updateProgress",value:function(a){this.style(this.progressWave,{width:a+"px"})}}]),n}(b.default);o.default=h,O.exports=o.default},"./src/mediaelement-webaudio.js":(O,o,_)=>{function m(w){"@babel/helpers - typeof";return m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},m(w)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var b=v(_("./src/mediaelement.js"));function v(w){return w&&w.__esModule?w:{default:w}}function p(w,h){if(!(w instanceof h))throw new TypeError("Cannot call a class as a function")}function E(w,h){for(var i=0;i<h.length;i++){var e=h[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(w,d(e.key),e)}}function B(w,h,i){return h&&E(w.prototype,h),i&&E(w,i),Object.defineProperty(w,"prototype",{writable:!1}),w}function d(w){var h=g(w,"string");return m(h)==="symbol"?h:String(h)}function g(w,h){if(m(w)!=="object"||w===null)return w;var i=w[Symbol.toPrimitive];if(i!==void 0){var e=i.call(w,h||"default");if(m(e)!=="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(w)}function R(){return typeof Reflect<"u"&&Reflect.get?R=Reflect.get.bind():R=function(h,i,e){var n=I(h,i);if(n){var l=Object.getOwnPropertyDescriptor(n,i);return l.get?l.get.call(arguments.length<3?h:e):l.value}},R.apply(this,arguments)}function I(w,h){for(;!Object.prototype.hasOwnProperty.call(w,h)&&(w=V(w),w!==null););return w}function C(w,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");w.prototype=Object.create(h&&h.prototype,{constructor:{value:w,writable:!0,configurable:!0}}),Object.defineProperty(w,"prototype",{writable:!1}),h&&f(w,h)}function f(w,h){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},f(w,h)}function y(w){var h=T();return function(){var e=V(w),n;if(h){var l=V(this).constructor;n=Reflect.construct(e,arguments,l)}else n=e.apply(this,arguments);return k(this,n)}}function k(w,h){if(h&&(m(h)==="object"||typeof h=="function"))return h;if(h!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return S(w)}function S(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}function T(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function V(w){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},V(w)}var x=function(w){C(i,w);var h=y(i);function i(e){var n;return p(this,i),n=h.call(this,e),n.params=e,n.sourceMediaElement=null,n}return B(i,[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer(),this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode()}},{key:"_load",value:function(n,l,a){R(V(i.prototype),"_load",this).call(this,n,l,a),this.createMediaElementSource(n)}},{key:"createMediaElementSource",value:function(n){this.sourceMediaElement=this.ac.createMediaElementSource(n),this.sourceMediaElement.connect(this.analyser)}},{key:"play",value:function(n,l){return this.resumeAudioContext(),R(V(i.prototype),"play",this).call(this,n,l)}},{key:"destroy",value:function(){R(V(i.prototype),"destroy",this).call(this),this.destroyWebAudio()}}]),i}(b.default);o.default=x,O.exports=o.default},"./src/mediaelement.js":(O,o,_)=>{function m(e){"@babel/helpers - typeof";return m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},m(e)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var b=B(_("./src/webaudio.js")),v=E(_("./src/util/index.js"));function p(e){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(p=function(r){return r?l:n})(e)}function E(e,n){if(!n&&e&&e.__esModule)return e;if(e===null||m(e)!=="object"&&typeof e!="function")return{default:e};var l=p(n);if(l&&l.has(e))return l.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var s=r?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(a,u,s):a[u]=e[u]}return a.default=e,l&&l.set(e,a),a}function B(e){return e&&e.__esModule?e:{default:e}}function d(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function g(e,n){for(var l=0;l<n.length;l++){var a=n[l];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,I(a.key),a)}}function R(e,n,l){return n&&g(e.prototype,n),l&&g(e,l),Object.defineProperty(e,"prototype",{writable:!1}),e}function I(e){var n=C(e,"string");return m(n)==="symbol"?n:String(n)}function C(e,n){if(m(e)!=="object"||e===null)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var a=l.call(e,n||"default");if(m(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function f(){return typeof Reflect<"u"&&Reflect.get?f=Reflect.get.bind():f=function(n,l,a){var r=y(n,l);if(r){var u=Object.getOwnPropertyDescriptor(r,l);return u.get?u.get.call(arguments.length<3?n:a):u.value}},f.apply(this,arguments)}function y(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&(e=h(e),e!==null););return e}function k(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&S(e,n)}function S(e,n){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,r){return a.__proto__=r,a},S(e,n)}function T(e){var n=w();return function(){var a=h(e),r;if(n){var u=h(this).constructor;r=Reflect.construct(a,arguments,u)}else r=a.apply(this,arguments);return V(this,r)}}function V(e,n){if(n&&(m(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return x(e)}function x(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},h(e)}var i=function(e){k(l,e);var n=T(l);function l(a){var r;return d(this,l),r=n.call(this,a),r.params=a,r.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){},volume:0},r.mediaType=a.mediaType.toLowerCase(),r.elementPosition=a.elementPosition,r.peaks=null,r.playbackRate=1,r.volume=1,r.isMuted=!1,r.buffer=null,r.onPlayEnd=null,r.mediaListeners={},r}return R(l,[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer()}},{key:"_setupMediaListeners",value:function(){var r=this;this.mediaListeners.error=function(){r.fireEvent("error","Error loading media element")},this.mediaListeners.waiting=function(){r.fireEvent("waiting")},this.mediaListeners.canplay=function(){r.fireEvent("canplay")},this.mediaListeners.ended=function(){r.fireEvent("finish")},this.mediaListeners.play=function(){r.fireEvent("play")},this.mediaListeners.pause=function(){r.fireEvent("pause")},this.mediaListeners.seeked=function(u){r.fireEvent("seek")},this.mediaListeners.volumechange=function(u){r.isMuted=r.media.muted,r.isMuted?r.volume=0:r.volume=r.media.volume,r.fireEvent("volume")},Object.keys(this.mediaListeners).forEach(function(u){r.media.removeEventListener(u,r.mediaListeners[u]),r.media.addEventListener(u,r.mediaListeners[u])})}},{key:"createTimer",value:function(){var r=this,u=function s(){r.isPaused()||(r.fireEvent("audioprocess",r.getCurrentTime()),v.frame(s)())};this.on("play",u),this.on("pause",function(){r.fireEvent("audioprocess",r.getCurrentTime())})}},{key:"load",value:function(r,u,s,t){var P=document.createElement(this.mediaType);P.controls=this.params.mediaControls,P.autoplay=this.params.autoplay||!1,P.preload=t??"auto",P.src=r,P.style.width="100%";var A=u.querySelector(this.mediaType);A&&u.removeChild(A),u.appendChild(P),this._load(P,s,t)}},{key:"loadElt",value:function(r,u){r.controls=this.params.mediaControls,r.autoplay=this.params.autoplay||!1,this._load(r,u,r.preload)}},{key:"_load",value:function(r,u,s){if(!(r instanceof HTMLMediaElement)||typeof r.addEventListener>"u")throw new Error("media parameter is not a valid media element");typeof r.load=="function"&&!(u&&s=="none")&&r.load(),this.media=r,this._setupMediaListeners(),this.peaks=u,this.onPlayEnd=null,this.buffer=null,this.isMuted=r.muted,this.setPlaybackRate(this.playbackRate),this.setVolume(this.volume)}},{key:"isPaused",value:function(){return!this.media||this.media.paused}},{key:"getDuration",value:function(){if(this.explicitDuration)return this.explicitDuration;var r=(this.buffer||this.media).duration;return r>=1/0&&(r=this.media.seekable.end(0)),r}},{key:"getCurrentTime",value:function(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function(r){this.playbackRate=r||1,this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function(r){r!=null&&!isNaN(r)&&(this.media.currentTime=r),this.clearPlayEnd()}},{key:"play",value:function(r,u){this.seekTo(r);var s=this.media.play();return u&&this.setPlayEnd(u),s}},{key:"pause",value:function(){var r;return this.media&&(r=this.media.pause()),this.clearPlayEnd(),r}},{key:"setPlayEnd",value:function(r){var u=this;this.clearPlayEnd(),this._onPlayEnd=function(s){s>=r&&(u.pause(),u.seekTo(r))},this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function(){this._onPlayEnd&&(this.un("audioprocess",this._onPlayEnd),this._onPlayEnd=null)}},{key:"getPeaks",value:function(r,u,s){return this.buffer?f(h(l.prototype),"getPeaks",this).call(this,r,u,s):this.peaks||[]}},{key:"setSinkId",value:function(r){return r?this.media.setSinkId?this.media.setSinkId(r):Promise.reject(new Error("setSinkId is not supported in your browser")):Promise.reject(new Error("Invalid deviceId: "+r))}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(r){this.volume=r,this.media.volume!==this.volume&&(this.media.volume=this.volume)}},{key:"setMute",value:function(r){this.isMuted=this.media.muted=r}},{key:"destroy",value:function(){var r=this;this.pause(),this.unAll(),this.destroyed=!0,Object.keys(this.mediaListeners).forEach(function(u){r.media&&r.media.removeEventListener(u,r.mediaListeners[u])}),this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}]),l}(b.default);o.default=i,O.exports=o.default},"./src/peakcache.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;function _(d){"@babel/helpers - typeof";return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},_(d)}function m(d,g){if(!(d instanceof g))throw new TypeError("Cannot call a class as a function")}function b(d,g){for(var R=0;R<g.length;R++){var I=g[R];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(d,p(I.key),I)}}function v(d,g,R){return g&&b(d.prototype,g),R&&b(d,R),Object.defineProperty(d,"prototype",{writable:!1}),d}function p(d){var g=E(d,"string");return _(g)==="symbol"?g:String(g)}function E(d,g){if(_(d)!=="object"||d===null)return d;var R=d[Symbol.toPrimitive];if(R!==void 0){var I=R.call(d,g||"default");if(_(I)!=="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(d)}var B=function(){function d(){m(this,d),this.clearPeakCache()}return v(d,[{key:"clearPeakCache",value:function(){this.peakCacheRanges=[],this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function(R,I,C){R!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=R);for(var f=[],y=0;y<this.peakCacheRanges.length&&this.peakCacheRanges[y]<I;)y++;for(y%2==0&&f.push(I);y<this.peakCacheRanges.length&&this.peakCacheRanges[y]<=C;)f.push(this.peakCacheRanges[y]),y++;y%2==0&&f.push(C),f=f.filter(function(S,T,V){return T==0?S!=V[T+1]:T==V.length-1?S!=V[T-1]:S!=V[T-1]&&S!=V[T+1]}),this.peakCacheRanges=this.peakCacheRanges.concat(f),this.peakCacheRanges=this.peakCacheRanges.sort(function(S,T){return S-T}).filter(function(S,T,V){return T==0?S!=V[T+1]:T==V.length-1?S!=V[T-1]:S!=V[T-1]&&S!=V[T+1]});var k=[];for(y=0;y<f.length;y+=2)k.push([f[y],f[y+1]]);return k}},{key:"getCacheRanges",value:function(){var R=[],I;for(I=0;I<this.peakCacheRanges.length;I+=2)R.push([this.peakCacheRanges[I],this.peakCacheRanges[I+1]]);return R}}]),d}();o.default=B,O.exports=o.default},"./src/util/absMax.js":(O,o,_)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=p;var m=v(_("./src/util/max.js")),b=v(_("./src/util/min.js"));function v(E){return E&&E.__esModule?E:{default:E}}function p(E){var B=(0,m.default)(E),d=(0,b.default)(E);return-d>B?-d:B}O.exports=o.default},"./src/util/clamp.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=_;function _(m,b,v){return Math.min(Math.max(b,m),v)}O.exports=o.default},"./src/util/fetch.js":(O,o,_)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=I;var m=b(_("./src/util/observer.js"));function b(C){return C&&C.__esModule?C:{default:C}}function v(C){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},v(C)}function p(C,f){if(!(C instanceof f))throw new TypeError("Cannot call a class as a function")}function E(C,f){for(var y=0;y<f.length;y++){var k=f[y];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(C,d(k.key),k)}}function B(C,f,y){return f&&E(C.prototype,f),y&&E(C,y),Object.defineProperty(C,"prototype",{writable:!1}),C}function d(C){var f=g(C,"string");return v(f)==="symbol"?f:String(f)}function g(C,f){if(v(C)!=="object"||C===null)return C;var y=C[Symbol.toPrimitive];if(y!==void 0){var k=y.call(C,f||"default");if(v(k)!=="object")return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(C)}var R=function(){function C(f,y,k){p(this,C),this.instance=f,this.instance._reader=k.body.getReader(),this.total=parseInt(y,10),this.loaded=0}return B(C,[{key:"start",value:function(y){var k=this,S=function T(){k.instance._reader.read().then(function(V){var x=V.done,w=V.value;if(x){k.total===0&&k.instance.onProgress.call(k.instance,{loaded:k.loaded,total:k.total,lengthComputable:!1}),y.close();return}k.loaded+=w.byteLength,k.instance.onProgress.call(k.instance,{loaded:k.loaded,total:k.total,lengthComputable:k.total!==0}),y.enqueue(w),T()}).catch(function(V){y.error(V)})};S()}}]),C}();function I(C){if(C){if(!C.url)throw new Error("fetch url missing")}else throw new Error("fetch options missing");var f=new m.default,y=new Headers,k=new Request(C.url);f.controller=new AbortController,C&&C.requestHeaders&&C.requestHeaders.forEach(function(V){y.append(V.key,V.value)});var S=C.responseType||"json",T={method:C.method||"GET",headers:y,mode:C.mode||"cors",credentials:C.credentials||"same-origin",cache:C.cache||"default",redirect:C.redirect||"follow",referrer:C.referrer||"client",signal:f.controller.signal};return fetch(k,T).then(function(V){f.response=V;var x=!0;V.body||(x=!1);var w=V.headers.get("content-length");return w===null&&(x=!1),x?(f.onProgress=function(h){f.fireEvent("progress",h)},new Response(new ReadableStream(new R(f,w,V)),T)):V}).then(function(V){var x;if(V.ok)switch(S){case"arraybuffer":return V.arrayBuffer();case"json":return V.json();case"blob":return V.blob();case"text":return V.text();default:x="Unknown responseType: "+S;break}throw x||(x="HTTP error status: "+V.status),new Error(x)}).then(function(V){f.fireEvent("success",V)}).catch(function(V){f.fireEvent("error",V)}),f.fetchRequest=k,f}O.exports=o.default},"./src/util/frame.js":(O,o,_)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=v;var m=b(_("./src/util/request-animation-frame.js"));function b(p){return p&&p.__esModule?p:{default:p}}function v(p){return function(){for(var E=arguments.length,B=new Array(E),d=0;d<E;d++)B[d]=arguments[d];return(0,m.default)(function(){return p.apply(void 0,B)})}}O.exports=o.default},"./src/util/get-id.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=_;function _(m){return m===void 0&&(m="wavesurfer_"),m+Math.random().toString(32).substring(2)}O.exports=o.default},"./src/util/index.js":(O,o,_)=>{Object.defineProperty(o,"__esModule",{value:!0}),Object.defineProperty(o,"Observer",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(o,"absMax",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(o,"clamp",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(o,"debounce",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(o,"fetchFile",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(o,"frame",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(o,"getId",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(o,"ignoreSilenceMode",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(o,"max",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(o,"min",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(o,"preventClick",{enumerable:!0,get:function(){return I.default}}),Object.defineProperty(o,"requestAnimationFrame",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(o,"style",{enumerable:!0,get:function(){return B.default}}),Object.defineProperty(o,"withOrientation",{enumerable:!0,get:function(){return y.default}});var m=S(_("./src/util/get-id.js")),b=S(_("./src/util/max.js")),v=S(_("./src/util/min.js")),p=S(_("./src/util/absMax.js")),E=S(_("./src/util/observer.js")),B=S(_("./src/util/style.js")),d=S(_("./src/util/request-animation-frame.js")),g=S(_("./src/util/frame.js")),R=S(_("./node_modules/debounce/index.js")),I=S(_("./src/util/prevent-click.js")),C=S(_("./src/util/fetch.js")),f=S(_("./src/util/clamp.js")),y=S(_("./src/util/orientation.js")),k=S(_("./src/util/silence-mode.js"));function S(T){return T&&T.__esModule?T:{default:T}}},"./src/util/max.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=_;function _(m){var b=-1/0;return Object.keys(m).forEach(function(v){m[v]>b&&(b=m[v])}),b}O.exports=o.default},"./src/util/min.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=_;function _(m){var b=1/0;return Object.keys(m).forEach(function(v){m[v]<b&&(b=m[v])}),b}O.exports=o.default},"./src/util/observer.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;function _(d){"@babel/helpers - typeof";return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},_(d)}function m(d,g){if(!(d instanceof g))throw new TypeError("Cannot call a class as a function")}function b(d,g){for(var R=0;R<g.length;R++){var I=g[R];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(d,p(I.key),I)}}function v(d,g,R){return g&&b(d.prototype,g),R&&b(d,R),Object.defineProperty(d,"prototype",{writable:!1}),d}function p(d){var g=E(d,"string");return _(g)==="symbol"?g:String(g)}function E(d,g){if(_(d)!=="object"||d===null)return d;var R=d[Symbol.toPrimitive];if(R!==void 0){var I=R.call(d,g||"default");if(_(I)!=="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(d)}var B=function(){function d(){m(this,d),this._disabledEventEmissions=[],this.handlers=null}return v(d,[{key:"on",value:function(R,I){var C=this;this.handlers||(this.handlers={});var f=this.handlers[R];return f||(f=this.handlers[R]=[]),f.push(I),{name:R,callback:I,un:function(k,S){return C.un(k,S)}}}},{key:"un",value:function(R,I){if(this.handlers){var C=this.handlers[R],f;if(C)if(I)for(f=C.length-1;f>=0;f--)C[f]==I&&C.splice(f,1);else C.length=0}}},{key:"unAll",value:function(){this.handlers=null}},{key:"once",value:function(R,I){var C=this,f=function y(){for(var k=arguments.length,S=new Array(k),T=0;T<k;T++)S[T]=arguments[T];I.apply(C,S),setTimeout(function(){C.un(R,y)},0)};return this.on(R,f)}},{key:"setDisabledEventEmissions",value:function(R){this._disabledEventEmissions=R}},{key:"_isDisabledEventEmission",value:function(R){return this._disabledEventEmissions&&this._disabledEventEmissions.includes(R)}},{key:"fireEvent",value:function(R){for(var I=arguments.length,C=new Array(I>1?I-1:0),f=1;f<I;f++)C[f-1]=arguments[f];if(!(!this.handlers||this._isDisabledEventEmission(R))){var y=this.handlers[R];y&&y.forEach(function(k){k.apply(void 0,C)})}}}]),d}();o.default=B,O.exports=o.default},"./src/util/orientation.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=v;var _={width:"height",height:"width",overflowX:"overflowY",overflowY:"overflowX",clientWidth:"clientHeight",clientHeight:"clientWidth",clientX:"clientY",clientY:"clientX",scrollWidth:"scrollHeight",scrollLeft:"scrollTop",offsetLeft:"offsetTop",offsetTop:"offsetLeft",offsetHeight:"offsetWidth",offsetWidth:"offsetHeight",left:"top",right:"bottom",top:"left",bottom:"right",borderRightStyle:"borderBottomStyle",borderRightWidth:"borderBottomWidth",borderRightColor:"borderBottomColor"};function m(p,E){return Object.prototype.hasOwnProperty.call(_,p)&&E?_[p]:p}var b=Symbol("isProxy");function v(p,E){return p[b]?p:new Proxy(p,{get:function(d,g,R){if(g===b)return!0;if(g==="domElement")return d;if(g==="style")return v(d.style,E);if(g==="canvas")return v(d.canvas,E);if(g==="getBoundingClientRect")return function(){return v(d.getBoundingClientRect.apply(d,arguments),E)};if(g==="getContext")return function(){return v(d.getContext.apply(d,arguments),E)};var I=d[m(g,E)];return typeof I=="function"?I.bind(d):I},set:function(d,g,R){return d[m(g,E)]=R,!0}})}O.exports=o.default},"./src/util/prevent-click.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=m;function _(b){b.stopPropagation(),document.body.removeEventListener("click",_,!0)}function m(b){document.body.addEventListener("click",_,!0)}O.exports=o.default},"./src/util/request-animation-frame.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var _=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(m,b){return setTimeout(m,1e3/60)}).bind(window);o.default=_,O.exports=o.default},"./src/util/silence-mode.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=_;function _(){var m=new AudioContext,b=m.createBufferSource();b.buffer=m.createBuffer(1,1,44100),b.connect(m.destination),b.start();var v="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",p=document.createElement("div");p.innerHTML='<audio x-webkit-airplay="deny"></audio>';var E=p.children.item(0);E.src=v,E.preload="auto",E.type="audio/mpeg",E.disableRemotePlayback=!0,E.play(),E.remove(),p.remove()}O.exports=o.default},"./src/util/style.js":(O,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=_;function _(m,b){return Object.keys(b).forEach(function(v){m.style[v]!==b[v]&&(m.style[v]=b[v])}),m}O.exports=o.default},"./src/wavesurfer.js":(O,o,_)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var m=R(_("./src/util/index.js")),b=d(_("./src/drawer.multicanvas.js")),v=d(_("./src/webaudio.js")),p=d(_("./src/mediaelement.js")),E=d(_("./src/peakcache.js")),B=d(_("./src/mediaelement-webaudio.js"));function d(a){return a&&a.__esModule?a:{default:a}}function g(a){if(typeof WeakMap!="function")return null;var r=new WeakMap,u=new WeakMap;return(g=function(t){return t?u:r})(a)}function R(a,r){if(!r&&a&&a.__esModule)return a;if(a===null||x(a)!=="object"&&typeof a!="function")return{default:a};var u=g(r);if(u&&u.has(a))return u.get(a);var s={},t=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var P in a)if(P!=="default"&&Object.prototype.hasOwnProperty.call(a,P)){var A=t?Object.getOwnPropertyDescriptor(a,P):null;A&&(A.get||A.set)?Object.defineProperty(s,P,A):s[P]=a[P]}return s.default=a,u&&u.set(a,s),s}function I(a,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(r&&r.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),r&&C(a,r)}function C(a,r){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,t){return s.__proto__=t,s},C(a,r)}function f(a){var r=S();return function(){var s=T(a),t;if(r){var P=T(this).constructor;t=Reflect.construct(s,arguments,P)}else t=s.apply(this,arguments);return y(this,t)}}function y(a,r){if(r&&(x(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return k(a)}function k(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function S(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function T(a){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},T(a)}function V(a,r,u){return r=e(r),r in a?Object.defineProperty(a,r,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[r]=u,a}function x(a){"@babel/helpers - typeof";return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},x(a)}function w(a,r){if(!(a instanceof r))throw new TypeError("Cannot call a class as a function")}function h(a,r){for(var u=0;u<r.length;u++){var s=r[u];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(a,e(s.key),s)}}function i(a,r,u){return r&&h(a.prototype,r),u&&h(a,u),Object.defineProperty(a,"prototype",{writable:!1}),a}function e(a){var r=n(a,"string");return x(r)==="symbol"?r:String(r)}function n(a,r){if(x(a)!=="object"||a===null)return a;var u=a[Symbol.toPrimitive];if(u!==void 0){var s=u.call(a,r||"default");if(x(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(a)}var l=function(a){I(u,a);var r=f(u);function u(s){var t;if(w(this,u),t=r.call(this),V(k(t),"defaultParams",{audioContext:null,audioScriptProcessor:null,audioRate:1,autoCenter:!0,autoCenterRate:5,autoCenterImmediately:!1,backend:"WebAudio",backgroundColor:null,barHeight:1,barRadius:0,barGap:null,barMinHeight:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,drawingContextAttributes:{desynchronized:!1},duration:null,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,hideCursor:!1,ignoreSilenceMode:!1,interact:!0,loopSelection:!0,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,normalize:!1,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:!0,renderer:b.default,responsive:!1,rtl:!1,scrollParent:!1,skipLength:2,splitChannels:!1,splitChannelsOptions:{overlay:!1,channelColors:{},filterChannels:[],relativeNormalization:!1,splitDragSelection:!1},vertical:!1,waveColor:"#999",xhr:{}}),V(k(t),"backends",{MediaElement:p.default,WebAudio:v.default,MediaElementWebAudio:B.default}),V(k(t),"util",m),t.params=Object.assign({},t.defaultParams,s),t.params.splitChannelsOptions=Object.assign({},t.defaultParams.splitChannelsOptions,s.splitChannelsOptions),t.container=typeof s.container=="string"?document.querySelector(t.params.container):t.params.container,!t.container)throw new Error("Container element not found");if(t.params.mediaContainer==null?t.mediaContainer=t.container:typeof t.params.mediaContainer=="string"?t.mediaContainer=document.querySelector(t.params.mediaContainer):t.mediaContainer=t.params.mediaContainer,!t.mediaContainer)throw new Error("Media Container element not found");if(t.params.maxCanvasWidth<=1)throw new Error("maxCanvasWidth must be greater than 1");if(t.params.maxCanvasWidth%2==1)throw new Error("maxCanvasWidth must be an even number");if(t.params.rtl===!0&&(t.params.vertical===!0?m.style(t.container,{transform:"rotateX(180deg)"}):m.style(t.container,{transform:"rotateY(180deg)"})),t.params.backgroundColor&&t.setBackgroundColor(t.params.backgroundColor),t.savedVolume=0,t.isMuted=!1,t.tmpEvents=[],t.currentRequest=null,t.arraybuffer=null,t.drawer=null,t.backend=null,t.peakCache=null,typeof t.params.renderer!="function")throw new Error("Renderer parameter is invalid");t.Drawer=t.params.renderer,t.params.backend=="AudioElement"&&(t.params.backend="MediaElement"),(t.params.backend=="WebAudio"||t.params.backend==="MediaElementWebAudio")&&!v.default.prototype.supportsWebAudio.call(null)&&(t.params.backend="MediaElement"),t.Backend=t.backends[t.params.backend],t.initialisedPluginList={},t.isDestroyed=!1,t.isReady=!1;var P=0;return t._onResize=m.debounce(function(){t.drawer.wrapper&&P!=t.drawer.wrapper.clientWidth&&!t.params.scrollParent&&(P=t.drawer.wrapper.clientWidth,P&&t.drawer.fireEvent("redraw"))},typeof t.params.responsive=="number"?t.params.responsive:100),y(t,k(t))}return i(u,[{key:"init",value:function(){return this.registerPlugins(this.params.plugins),this.createDrawer(),this.createBackend(),this.createPeakCache(),this}},{key:"registerPlugins",value:function(t){var P=this;return t.forEach(function(A){return P.addPlugin(A)}),t.forEach(function(A){A.deferInit||P.initPlugin(A.name)}),this.fireEvent("plugins-registered",t),this}},{key:"getActivePlugins",value:function(){return this.initialisedPluginList}},{key:"addPlugin",value:function(t){var P=this;if(!t.name)throw new Error("Plugin does not have a name!");if(!t.instance)throw new Error("Plugin ".concat(t.name," does not have an instance property!"));t.staticProps&&Object.keys(t.staticProps).forEach(function(D){P[D]=t.staticProps[D]});var A=t.instance,M=Object.getOwnPropertyNames(m.Observer.prototype);return M.forEach(function(D){A.prototype[D]=m.Observer.prototype[D]}),this[t.name]=new A(t.params||{},this),this.fireEvent("plugin-added",t.name),this}},{key:"initPlugin",value:function(t){if(!this[t])throw new Error("Plugin ".concat(t," has not been added yet!"));return this.initialisedPluginList[t]&&this.destroyPlugin(t),this[t].init(),this.initialisedPluginList[t]=!0,this.fireEvent("plugin-initialised",t),this}},{key:"destroyPlugin",value:function(t){if(!this[t])throw new Error("Plugin ".concat(t," has not been added yet and cannot be destroyed!"));if(!this.initialisedPluginList[t])throw new Error("Plugin ".concat(t," is not active and cannot be destroyed!"));if(typeof this[t].destroy!="function")throw new Error("Plugin ".concat(t," does not have a destroy function!"));return this[t].destroy(),delete this.initialisedPluginList[t],this.fireEvent("plugin-destroyed",t),this}},{key:"destroyAllPlugins",value:function(){var t=this;Object.keys(this.initialisedPluginList).forEach(function(P){return t.destroyPlugin(P)})}},{key:"createDrawer",value:function(){var t=this;this.drawer=new this.Drawer(this.container,this.params),this.drawer.init(),this.fireEvent("drawer-created",this.drawer),this.params.responsive!==!1&&(window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0)),this.drawer.on("redraw",function(){t.drawBuffer(),t.drawer.progress(t.backend.getPlayedPercents())}),this.drawer.on("click",function(P,A){setTimeout(function(){return t.seekTo(A)},0)}),this.drawer.on("scroll",function(P){t.params.partialRender&&t.drawBuffer(),t.fireEvent("scroll",P)}),this.drawer.on("dblclick",function(P,A){t.fireEvent("dblclick",P,A)})}},{key:"createBackend",value:function(){var t=this;this.backend&&this.backend.destroy(),this.backend=new this.Backend(this.params),this.backend.init(),this.fireEvent("backend-created",this.backend),this.backend.on("finish",function(){t.drawer.progress(t.backend.getPlayedPercents()),t.fireEvent("finish")}),this.backend.on("play",function(){return t.fireEvent("play")}),this.backend.on("pause",function(){return t.fireEvent("pause")}),this.backend.on("audioprocess",function(P){t.drawer.progress(t.backend.getPlayedPercents()),t.fireEvent("audioprocess",P)}),(this.params.backend==="MediaElement"||this.params.backend==="MediaElementWebAudio")&&(this.backend.on("seek",function(){t.drawer.progress(t.backend.getPlayedPercents())}),this.backend.on("volume",function(){var P=t.getVolume();t.fireEvent("volume",P),t.backend.isMuted!==t.isMuted&&(t.isMuted=t.backend.isMuted,t.fireEvent("mute",t.isMuted))}))}},{key:"createPeakCache",value:function(){this.params.partialRender&&(this.peakCache=new E.default)}},{key:"getDuration",value:function(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function(t){t>=this.getDuration()?this.seekTo(1):this.seekTo(t/this.getDuration())}},{key:"play",value:function(t,P){var A=this;return this.params.ignoreSilenceMode&&m.ignoreSilenceMode(),this.fireEvent("interaction",function(){return A.play(t,P)}),this.backend.play(t,P)}},{key:"setPlayEnd",value:function(t){this.backend.setPlayEnd(t)}},{key:"pause",value:function(){if(!this.backend.isPaused())return this.backend.pause()}},{key:"playPause",value:function(){return this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function(){return!this.backend.isPaused()}},{key:"skipBackward",value:function(t){this.skip(-t||-this.params.skipLength)}},{key:"skipForward",value:function(t){this.skip(t||this.params.skipLength)}},{key:"skip",value:function(t){var P=this.getDuration()||1,A=this.getCurrentTime()||0;A=Math.max(0,Math.min(P,A+(t||0))),this.seekAndCenter(A/P)}},{key:"seekAndCenter",value:function(t){this.seekTo(t),this.drawer.recenter(t)}},{key:"seekTo",value:function(t){var P=this;if(typeof t!="number"||!isFinite(t)||t<0||t>1)throw new Error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!");this.fireEvent("interaction",function(){return P.seekTo(t)});var A=this.params.backend==="WebAudio",M=this.backend.isPaused();A&&!M&&this.backend.pause();var D=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(t*this.getDuration()),this.drawer.progress(t),A&&!M&&this.backend.play(),this.params.scrollParent=D,this.fireEvent("seek",t)}},{key:"stop",value:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)}},{key:"setSinkId",value:function(t){return this.backend.setSinkId(t)}},{key:"setVolume",value:function(t){if(this.isMuted===!0){this.savedVolume=t;return}this.backend.setVolume(t),this.fireEvent("volume",t)}},{key:"getVolume",value:function(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function(t){this.backend.setPlaybackRate(t)}},{key:"getPlaybackRate",value:function(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function(){this.setMute(!this.isMuted)}},{key:"setMute",value:function(t){if(t===this.isMuted){this.fireEvent("mute",this.isMuted);return}this.backend.setMute?(this.backend.setMute(t),this.isMuted=t):t?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0,this.fireEvent("volume",0)):(this.backend.setVolume(this.savedVolume),this.isMuted=!1,this.fireEvent("volume",this.savedVolume)),this.fireEvent("mute",this.isMuted)}},{key:"getMute",value:function(){return this.isMuted}},{key:"getFilters",value:function(){return this.backend.filters||[]}},{key:"toggleScroll",value:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()}},{key:"toggleInteraction",value:function(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.params.splitChannelsOptions.channelColors[t]?this.params.splitChannelsOptions.channelColors[t].waveColor:this.params.waveColor}},{key:"setWaveColor",value:function(t){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;this.params.splitChannelsOptions.channelColors[P]?this.params.splitChannelsOptions.channelColors[P].waveColor=t:this.params.waveColor=t,this.drawBuffer()}},{key:"getProgressColor",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.params.splitChannelsOptions.channelColors[t]?this.params.splitChannelsOptions.channelColors[t].progressColor:this.params.progressColor}},{key:"setProgressColor",value:function(t,P){this.params.splitChannelsOptions.channelColors[P]?this.params.splitChannelsOptions.channelColors[P].progressColor=t:this.params.progressColor=t,this.drawBuffer()}},{key:"getBackgroundColor",value:function(){return this.params.backgroundColor}},{key:"setBackgroundColor",value:function(t){this.params.backgroundColor=t,m.style(this.container,{background:this.params.backgroundColor})}},{key:"getCursorColor",value:function(){return this.params.cursorColor}},{key:"setCursorColor",value:function(t){this.params.cursorColor=t,this.drawer.updateCursor()}},{key:"getHeight",value:function(){return this.params.height}},{key:"setHeight",value:function(t){this.params.height=t,this.drawer.setHeight(t*this.params.pixelRatio),this.drawBuffer()}},{key:"setFilteredChannels",value:function(t){this.params.splitChannelsOptions.filterChannels=t,this.drawBuffer()}},{key:"drawBuffer",value:function(){var t=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),P=this.drawer.getWidth(),A=t,M=0,D=Math.max(M+P,A);this.params.fillParent&&(!this.params.scrollParent||t<P)&&(A=P,M=0,D=A);var F;if(this.params.partialRender){var K=this.peakCache.addRangeToPeakCache(A,M,D),U;for(U=0;U<K.length;U++)F=this.backend.getPeaks(A,K[U][0],K[U][1]),this.drawer.drawPeaks(F,A,K[U][0],K[U][1])}else F=this.backend.getPeaks(A,M,D),this.drawer.drawPeaks(F,A,M,D);this.fireEvent("redraw",F,A)}},{key:"zoom",value:function(t){t?(this.params.minPxPerSec=t,this.params.scrollParent=!0):(this.params.minPxPerSec=this.defaultParams.minPxPerSec,this.params.scrollParent=!1),this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",t)}},{key:"loadArrayBuffer",value:function(t){var P=this;this.decodeArrayBuffer(t,function(A){P.isDestroyed||P.loadDecodedBuffer(A)})}},{key:"loadDecodedBuffer",value:function(t){this.backend.load(t),this.drawBuffer(),this.isReady=!0,this.fireEvent("ready")}},{key:"loadBlob",value:function(t){var P=this,A=new FileReader;A.addEventListener("progress",function(M){return P.onProgress(M)}),A.addEventListener("load",function(M){return P.loadArrayBuffer(M.target.result)}),A.addEventListener("error",function(){return P.fireEvent("error","Error reading file")}),A.readAsArrayBuffer(t),this.empty()}},{key:"load",value:function(t,P,A,M){if(!t)throw new Error("url parameter cannot be empty");if(this.empty(),A){var D={"Preload is not 'auto', 'none' or 'metadata'":["auto","metadata","none"].indexOf(A)===-1,"Peaks are not provided":!P,"Backend is not of type 'MediaElement' or 'MediaElementWebAudio'":["MediaElement","MediaElementWebAudio"].indexOf(this.params.backend)===-1,"Url is not of type string":typeof t!="string"},F=Object.keys(D).filter(function(K){return D[K]});F.length&&(console.warn(`Preload parameter of wavesurfer.load will be ignored because:
	- `+F.join(`
	- `)),A=null)}switch(this.params.backend==="WebAudio"&&t instanceof HTMLMediaElement&&(t=t.src),this.params.backend){case"WebAudio":return this.loadBuffer(t,P,M);case"MediaElement":case"MediaElementWebAudio":return this.loadMediaElement(t,P,A,M)}}},{key:"loadBuffer",value:function(t,P,A){var M=this,D=function(K){return K&&M.tmpEvents.push(M.once("ready",K)),M.getArrayBuffer(t,function(U){return M.loadArrayBuffer(U)})};if(P)this.backend.setPeaks(P,A),this.drawBuffer(),this.fireEvent("waveform-ready"),this.tmpEvents.push(this.once("interaction",D));else return D()}},{key:"loadMediaElement",value:function(t,P,A,M){var D=this,F=t;if(typeof t=="string")this.backend.load(F,this.mediaContainer,P,A);else{var K=t;this.backend.loadElt(K,P),F=K.src}this.tmpEvents.push(this.backend.once("canplay",function(){D.backend.destroyed||(D.drawBuffer(),D.isReady=!0,D.fireEvent("ready"))}),this.backend.once("error",function(U){return D.fireEvent("error",U)})),P&&(this.backend.setPeaks(P,M),this.drawBuffer(),this.fireEvent("waveform-ready")),(!P||this.params.forceDecode)&&this.backend.supportsWebAudio()&&this.getArrayBuffer(F,function(U){D.decodeArrayBuffer(U,function(ne){D.backend.buffer=ne,D.backend.setPeaks(null),D.drawBuffer(),D.fireEvent("waveform-ready")})})}},{key:"decodeArrayBuffer",value:function(t,P){var A=this;this.isDestroyed||(this.arraybuffer=t,this.backend.decodeArrayBuffer(t,function(M){!A.isDestroyed&&A.arraybuffer==t&&(P(M),A.arraybuffer=null)},function(){return A.fireEvent("error","Error decoding audiobuffer")}))}},{key:"getArrayBuffer",value:function(t,P){var A=this,M=Object.assign({url:t,responseType:"arraybuffer"},this.params.xhr),D=m.fetchFile(M);return this.currentRequest=D,this.tmpEvents.push(D.on("progress",function(F){A.onProgress(F)}),D.on("success",function(F){P(F),A.currentRequest=null}),D.on("error",function(F){A.fireEvent("error",F),A.currentRequest=null})),D}},{key:"onProgress",value:function(t){var P;t.lengthComputable?P=t.loaded/t.total:P=t.loaded/(t.loaded+1e6),this.fireEvent("loading",Math.round(P*100),t.target)}},{key:"exportPCM",value:function(t,P,A,M,D){t=t||1024,M=M||0,P=P||1e4,A=A||!1;var F=this.backend.getPeaks(t,M,D),K=[].map.call(F,function(U){return Math.round(U*P)/P});return new Promise(function(U,ne){if(!A){var pe=new Blob([JSON.stringify(K)],{type:"application/json;charset=utf-8"}),te=URL.createObjectURL(pe);window.open(te),URL.revokeObjectURL(te)}U(K)})}},{key:"exportImage",value:function(t,P,A){return t||(t="image/png"),P||(P=1),A||(A="dataURL"),this.drawer.getImage(t,P,A)}},{key:"cancelAjax",value:function(){this.currentRequest&&this.currentRequest.controller&&(this.currentRequest._reader&&this.currentRequest._reader.cancel().catch(function(t){}),this.currentRequest.controller.abort(),this.currentRequest=null)}},{key:"clearTmpEvents",value:function(){this.tmpEvents.forEach(function(t){return t.un()})}},{key:"empty",value:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.isReady=!1,this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}},{key:"destroy",value:function(){this.destroyAllPlugins(),this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),this.params.responsive!==!1&&(window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0)),this.backend&&(this.backend.destroy(),this.backend=null),this.drawer&&this.drawer.destroy(),this.isDestroyed=!0,this.isReady=!1,this.arraybuffer=null}}],[{key:"create",value:function(t){var P=new u(t);return P.init()}}]),u}(m.Observer);o.default=l,V(l,"VERSION","6.6.4"),V(l,"util",m),O.exports=o.default},"./src/webaudio.js":(O,o,_)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var m=v(_("./src/util/index.js"));function b(e){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(b=function(r){return r?l:n})(e)}function v(e,n){if(!n&&e&&e.__esModule)return e;if(e===null||p(e)!=="object"&&typeof e!="function")return{default:e};var l=b(n);if(l&&l.has(e))return l.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var s=r?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(a,u,s):a[u]=e[u]}return a.default=e,l&&l.set(e,a),a}function p(e){"@babel/helpers - typeof";return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},p(e)}function E(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function B(e,n){for(var l=0;l<n.length;l++){var a=n[l];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,T(a.key),a)}}function d(e,n,l){return n&&B(e.prototype,n),l&&B(e,l),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&R(e,n)}function R(e,n){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,r){return a.__proto__=r,a},R(e,n)}function I(e){var n=y();return function(){var a=k(e),r;if(n){var u=k(this).constructor;r=Reflect.construct(a,arguments,u)}else r=a.apply(this,arguments);return C(this,r)}}function C(e,n){if(n&&(p(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function f(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},k(e)}function S(e,n,l){return n=T(n),n in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function T(e){var n=V(e,"string");return p(n)==="symbol"?n:String(n)}function V(e,n){if(p(e)!=="object"||e===null)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var a=l.call(e,n||"default");if(p(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var x="playing",w="paused",h="finished",i=function(e){g(l,e);var n=I(l);function l(a){var r,u,s;return E(this,l),s=n.call(this),S(f(s),"audioContext",null),S(f(s),"stateBehaviors",(r={},S(r,x,{init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var P=this.getDuration();return this.getCurrentTime()/P||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}}),S(r,w,{init:function(){},getPlayedPercents:function(){var P=this.getDuration();return this.getCurrentTime()/P||0},getCurrentTime:function(){return this.startPosition}}),S(r,h,{init:function(){this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}}),r)),s.params=a,s.ac=a.audioContext||(s.supportsWebAudio()?s.getAudioContext():{}),s.lastPlay=s.ac.currentTime,s.startPosition=0,s.scheduledPause=null,s.states=(u={},S(u,x,Object.create(s.stateBehaviors[x])),S(u,w,Object.create(s.stateBehaviors[w])),S(u,h,Object.create(s.stateBehaviors[h])),u),s.buffer=null,s.filters=[],s.gainNode=null,s.mergedPeaks=null,s.offlineAc=null,s.peaks=null,s.playbackRate=1,s.analyser=null,s.scriptNode=null,s.source=null,s.splitPeaks=[],s.state=null,s.explicitDuration=a.duration,s.sinkStreamDestination=null,s.sinkAudioElement=null,s.destroyed=!1,s}return d(l,[{key:"supportsWebAudio",value:function(){return!!(window.AudioContext||window.webkitAudioContext)}},{key:"getAudioContext",value:function(){return window.WaveSurferAudioContext||(window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)),window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function(r){return window.WaveSurferOfflineAudioContext||(window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,r)),window.WaveSurferOfflineAudioContext}},{key:"init",value:function(){this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(w),this.setPlaybackRate(this.params.audioRate),this.setLength(0)}},{key:"disconnectFilters",value:function(){this.filters&&(this.filters.forEach(function(r){r&&r.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))}},{key:"setState",value:function(r){this.state!==this.states[r]&&(this.state=this.states[r],this.state.init.call(this))}},{key:"setFilter",value:function(){for(var r=arguments.length,u=new Array(r),s=0;s<r;s++)u[s]=arguments[s];this.setFilters(u)}},{key:"setFilters",value:function(r){this.disconnectFilters(),r&&r.length&&(this.filters=r,this.analyser.disconnect(),r.reduce(function(u,s){return u.connect(s),s},this.analyser).connect(this.gainNode))}},{key:"createScriptNode",value:function(){this.params.audioScriptProcessor&&(this.scriptNode=this.params.audioScriptProcessor,this.scriptNode.connect(this.ac.destination))}},{key:"addOnAudioProcess",value:function(){var r=this,u=function s(){var t=r.getCurrentTime();t>=r.getDuration()&&r.state!==r.states[h]?(r.setState(h),r.fireEvent("pause")):t>=r.scheduledPause&&r.state!==r.states[w]?r.pause():r.state===r.states[x]&&(r.fireEvent("audioprocess",t),m.frame(s)())};u()}},{key:"createAnalyserNode",value:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)}},{key:"setSinkId",value:function(r){return r?(this.sinkAudioElement||(this.sinkAudioElement=new window.Audio,this.sinkAudioElement.autoplay=!0),this.sinkAudioElement.setSinkId?(this.sinkStreamDestination||(this.sinkStreamDestination=this.ac.createMediaStreamDestination()),this.gainNode.disconnect(),this.gainNode.connect(this.sinkStreamDestination),this.sinkAudioElement.srcObject=this.sinkStreamDestination.stream,this.sinkAudioElement.setSinkId(r)):Promise.reject(new Error("setSinkId is not supported in your browser"))):Promise.reject(new Error("Invalid deviceId: "+r))}},{key:"setVolume",value:function(r){this.gainNode.gain.setValueAtTime(r,this.ac.currentTime)}},{key:"getVolume",value:function(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function(r,u,s){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac&&this.ac.sampleRate?this.ac.sampleRate:44100)),"webkitAudioContext"in window?this.offlineAc.decodeAudioData(r,function(t){return u(t)},s):this.offlineAc.decodeAudioData(r).then(function(t){return u(t)}).catch(function(t){return s(t)})}},{key:"setPeaks",value:function(r,u){u!=null&&(this.explicitDuration=u),this.peaks=r}},{key:"setLength",value:function(r){if(!(this.mergedPeaks&&r==2*this.mergedPeaks.length-1+2)){this.splitPeaks=[],this.mergedPeaks=[];var u=this.buffer?this.buffer.numberOfChannels:1,s;for(s=0;s<u;s++)this.splitPeaks[s]=[],this.splitPeaks[s][2*(r-1)]=0,this.splitPeaks[s][2*(r-1)+1]=0;this.mergedPeaks[2*(r-1)]=0,this.mergedPeaks[2*(r-1)+1]=0}}},{key:"getPeaks",value:function(r,u,s){if(this.peaks)return this.peaks;if(!this.buffer)return[];if(u=u||0,s=s||r-1,this.setLength(r),!this.buffer)return this.params.splitChannels?this.splitPeaks:this.mergedPeaks;if(!this.buffer.length){var t=this.createBuffer(1,4096,this.sampleRate);this.buffer=t.buffer}var P=this.buffer.length/r,A=~~(P/10)||1,M=this.buffer.numberOfChannels,D;for(D=0;D<M;D++){var F=this.splitPeaks[D],K=this.buffer.getChannelData(D),U=void 0;for(U=u;U<=s;U++){var ne=~~(U*P),pe=~~(ne+P),te=K[ne],ge=te,ce=void 0;for(ce=ne;ce<pe;ce+=A){var fe=K[ce];fe>ge&&(ge=fe),fe<te&&(te=fe)}F[2*U]=ge,F[2*U+1]=te,(D==0||ge>this.mergedPeaks[2*U])&&(this.mergedPeaks[2*U]=ge),(D==0||te<this.mergedPeaks[2*U+1])&&(this.mergedPeaks[2*U+1]=te)}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPlayedPercents",value:function(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function(){this.source&&this.source.disconnect()}},{key:"destroyWebAudio",value:function(){this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode&&this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&(typeof this.ac.close=="function"&&this.ac.state!="closed"&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:window.WaveSurferAudioContext=null,window.WaveSurferOfflineAudioContext=null),this.sinkStreamDestination&&(this.sinkAudioElement.pause(),this.sinkAudioElement.srcObject=null,this.sinkStreamDestination.disconnect(),this.sinkStreamDestination=null)}},{key:"destroy",value:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.destroyed=!0,this.destroyWebAudio()}},{key:"load",value:function(r){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=r,this.createSource()}},{key:"createSource",value:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.setPlaybackRate(this.playbackRate),this.source.buffer=this.buffer,this.source.connect(this.analyser)}},{key:"resumeAudioContext",value:function(){this.ac.state=="suspended"&&this.ac.resume&&this.ac.resume()}},{key:"isPaused",value:function(){return this.state!==this.states[x]}},{key:"getDuration",value:function(){return this.explicitDuration?this.explicitDuration:this.buffer?this.buffer.duration:0}},{key:"seekTo",value:function(r,u){if(this.buffer)return this.scheduledPause=null,r==null&&(r=this.getCurrentTime(),r>=this.getDuration()&&(r=0)),u==null&&(u=this.getDuration()),this.startPosition=r,this.lastPlay=this.ac.currentTime,this.state===this.states[h]&&this.setState(w),{start:r,end:u}}},{key:"getPlayedTime",value:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function(r,u){if(this.buffer){this.createSource();var s=this.seekTo(r,u);r=s.start,u=s.end,this.scheduledPause=u,this.source.start(0,r),this.resumeAudioContext(),this.setState(x),this.fireEvent("play")}}},{key:"pause",value:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime();try{this.source&&this.source.stop(0)}catch{}this.setState(w),this.fireEvent("pause")}},{key:"getCurrentTime",value:function(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setPlaybackRate",value:function(r){this.playbackRate=r||1,this.source&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime)}},{key:"setPlayEnd",value:function(r){this.scheduledPause=r}}]),l}(m.Observer);o.default=i,O.exports=o.default},"./node_modules/debounce/index.js":O=>{function o(_,m,b){var v,p,E,B,d;m==null&&(m=100);function g(){var I=Date.now()-B;I<m&&I>=0?v=setTimeout(g,m-I):(v=null,b||(d=_.apply(E,p),E=p=null))}var R=function(){E=this,p=arguments,B=Date.now();var I=b&&!v;return v||(v=setTimeout(g,m)),I&&(d=_.apply(E,p),E=p=null),d};return R.clear=function(){v&&(clearTimeout(v),v=null)},R.flush=function(){v&&(d=_.apply(E,p),E=p=null,clearTimeout(v),v=null)},R}o.debounce=o,O.exports=o}},j={};function $(O){var o=j[O];if(o!==void 0)return o.exports;var _=j[O]={exports:{}};return H[O](_,_.exports,$),_.exports}var q=$("./src/wavesurfer.js");return q})())})(Wt);var ra=Wt.exports;const aa=$t(ra),Be=W=>(He("data-v-9291e144"),W=W(),Ue(),W),na={class:"bus-seats-root"},ia={class:"info-form","data-id":"seat-select"},sa={class:"enterInfo"},oa={class:"seat-select-container"},la={key:0,class:"seats-info"},ua={key:0},ca={class:"seat-guide-container"},da={class:"guide-wrapper selectable-seat"},fa=Be(()=>G("div",{class:"seat-guide"},null,-1)),ha=Be(()=>G("div",{class:"guide-wrapper selected-seat"},[G("div",{class:"seat-guide"}),Pe(" انتخاب شده   ")],-1)),va={class:"guide-wrapper unselectable-seat"},pa=Be(()=>G("div",{class:"seat-guide"},null,-1)),ma=ar('<div class="rect top first" data-v-9291e144></div><div class="rect top second" data-v-9291e144></div><div class="rect top third" data-v-9291e144></div><div class="rect bottom first" data-v-9291e144></div><div class="rect bottom second" data-v-9291e144></div><div class="rect bottom third" data-v-9291e144></div>',6),ya=Be(()=>G("div",{class:"left mirror"},null,-1)),ga=Be(()=>G("div",{class:"right mirror"},null,-1)),ba=Be(()=>G("div",{class:"front chassis"},null,-1)),Pa=Be(()=>G("div",{class:"rear chassis"},null,-1)),ka=["onClick"],Aa={key:0,class:"seat space"},wa=ke({__name:"BusSeats",props:{hasPlayer:{type:Boolean},busIndex:{},handler:{}},setup(W){const re=Ye(),H=qt(),j=ot(),$=X(null),q=_e(),O=X(!1),o=X(!0),_=X(null),m=z(()=>re.reserveType===Ke.Taxi);return Ee(o,b=>{var v,p;b?((v=_.value)==null||v.play(),j.trackPosthog("play-music")):((p=_.value)==null||p.pause(),j.trackPosthog("pause-music"))}),Ee(O,b=>{b&&Me(()=>{$.value&&_.value&&(_.value=aa.create({container:$.value,barWidth:2.75,barGap:1.5,height:25,progressColor:"#0f84fa",waveColor:"#d9d9d9"}),_.value.load(H.nextRandomMusic),j.trackAll("bus-music-player-initiated"),_.value.on("ready",()=>{var v;return(v=_.value)==null?void 0:v.play()}),_.value.on("finish",()=>{var v;return(v=_.value)==null?void 0:v.play()}))})}),ze(async()=>{W.hasPlayer&&await H.getMusicList()}),(b,v)=>(N(),Z("div",na,[G("div",ia,[G("h2",sa,he(c(q).t("BusSeats.selectBusSeat",{vehicle:c(m)?"تاکسی":"اتوبوس"}))+" "+he(b.handler.h2Names[b.busIndex]),1),G("div",oa,[b.busIndex?se("",!0):(N(),Z("div",la,[G("ul",null,[G("li",null,he(c(q).t("BusSeats.clickSeatSelect")),1),G("li",null,he(c(q).t("BusSeats.selectGender")),1),c(m)?se("",!0):(N(),Z("li",ua,he(c(q).t("BusSeats.seatGenderRule")),1))])])),G("div",ca,[G("div",da,[fa,Pe(" "+he(c(q).t("BusSeats.selectable"))+"    ",1)]),ha,G("div",va,[pa,Pe(" "+he(c(q).t("BusSeats.unselectable"))+"    ",1)])]),b.handler.isSeatsLoading[b.busIndex]?(N(),ee(Rt,{key:1})):(N(),Z("div",{key:2,class:Re(["transport-seats",{taxi:c(m)}])},[c(m)?(N(),Z(ve,{key:1},[ya,ga,ba,Pa],64)):(N(),Z(ve,{key:0},[ma],64)),G("div",{class:Re(["bus-header",{taxi:c(m)}])},[c(O)?(N(),Z(ve,{key:1},[G("div",{ref_key:"playerContainer",ref:$,class:"player"},null,512),ae(Ce,{"icon-button":{icon:c(o)?c(Ut):c(zt)},size:"small",type:"transparent",onClick:v[1]||(v[1]=p=>o.value=!c(o))},null,8,["icon-button"])],64)):(N(),Z(ve,{key:0},[G("span",{class:Re({center:!b.hasPlayer})}," جلوی "+he(c(m)?"تاکسی":"اتوبوس"),3),b.hasPlayer?(N(),ee(Ce,{key:0,class:"feel",size:"small",type:"transparent","right-icon":c(Ht),onClick:v[0]||(v[0]=p=>O.value=!c(O))},{default:ue(()=>[Pe(" حال خوب ")]),_:1},8,["right-icon"])):se("",!0)],64))],2),(N(!0),Z(ve,null,Ve(b.handler.seatMapping[b.busIndex],(p,E)=>(N(),Z("div",{key:E,class:"seats-row"},[(N(!0),Z(ve,null,Ve(p,(B,d)=>(N(),Z(ve,{key:`${d}.${E}`},[G("div",{class:Re(["seat",[`status-${B.status}`,{selected:!B.selected}]]),onClick:g=>b.handler.toggleSeat(b.busIndex,B.number)},[B.status===c(Tt).Empty?(N(),Z(ve,{key:0},[Pe(he(B.number),1)],64)):B.icon?(N(),ee(Gt,{key:1,size:"large",class:"seat-icon",icon:B.icon},null,8,["icon"])):se("",!0)],10,ka),d===(b.handler.seatsInfo[b.busIndex].spacePlace||0)-1?(N(),Z("div",Aa)):se("",!0)],64))),128))]))),128))],2))])])]))}});const Ca=Ae(wa,[["__scopeId","data-v-9291e144"]]),_a=ke({__name:"BusSeatsHandler",props:{handler:{}},emits:["back"],setup(W,{emit:re}){const H=_e(),j=Xe(),$=Ye();return ze(async()=>{try{await W.handler.loadSeats()}catch{await j({icon:"error",text:H.t("BusSeats.loadSeatsErrors"),confirmButtonText:H.t("BusSeats.back")}),re("back")}W.handler.seatMapping.some(q=>q.length&&q.every(O=>O.every(o=>o.status!==Tt.Empty)))&&(await j({icon:"error",text:H.t("BusSeats.fulledSeats"),confirmButtonText:H.t("BusSeats.back")}),$.currentItineraryModule().resetLastLoadTime({index:$.currentSetIndex}),re("back"))}),(q,O)=>{const o=lr;return N(),ee(o,null,{default:ue(()=>[(N(!0),Z(ve,null,Ve(q.handler.buses.filter(_=>_.needsSelectSeat),(_,m)=>(N(),ee(Ca,{key:_.id,"bus-index":m,"has-player":!m,handler:q.handler},null,8,["bus-index","has-player","handler"]))),128)),q.handler.addPassAlert?(N(),ee(or,{key:0,type:"warning",items:[{message:q.handler.addPassAlert}]},null,8,["items"])):se("",!0)]),_:1})}}}),Fe=W=>(He("data-v-ec898bff"),W=W(),Ue(),W),xa={class:"form-page-container"},Ea={key:0,class:"loading"},Sa=Fe(()=>G("br",null,null,-1)),Oa=Fe(()=>G("br",null,null,-1)),Ra=Fe(()=>G("img",{src:pr,alt:"..."},null,-1)),Ma=Fe(()=>G("h4",null,"لطفا این صفحه را ترک نکنید و منتظر بمانید",-1)),Ta={class:"pax-container"},Va={class:"header"},Ia=Fe(()=>G("span",{class:"header-title"},"ورود اطلاعات مسافران",-1)),Ba={key:1,class:"add-passenger"},Da=Fe(()=>G("span",{class:"desktop-only"},"افزودن مسافر",-1)),Wa=ke({__name:"form",setup(W,{expose:re}){const H=Ye(),j=Kt(),{isAutoReserve:$,demandAvailabilityCheck:q}=We(j),O=Qe(),o=Ie(),{assignLabels:_}=St(),m=lt(),b=Et(),v=ot(),p=Qt(),{day:E}=Mt(),B=Yt(),d=X(null),g=X(null),R=X(null),I=X(null),C=X(null),f=ut(),y=nr(),k=ir(),S=Xe(),{handleException:T}=dt(),{isOnline:V}=Xt(),x=X(!0),w=X(!0),{itineraryPackages:h,showTimer:i,verificationStatus:e,needsDestinationMobile:n,busSeatHandler:l}=We(o),{reserveType:a}=We(H),r=X(""),u=X([]),s=_e(),t=z(()=>o.expiryTime?E.gregory(o.expiryTime).diff(E.gregory()):0),P=z(()=>{const[L]=h.value;return(L==null?void 0:L.passengerCountEditTypes)??[]}),A=z(()=>o.paxForms.length);Ee(A,()=>m.loadReceivedTripScore());const M=z(()=>[we.None,we.Loading].includes(e.value)),D=z(()=>e.value===we.Verified),F=z(()=>{var Y,J;let L=!1;const Q=d.value||[];for(const Se of Q)L||(L=Se.dirty);return L||(L=!!((Y=g.value)!=null&&Y.dirty)),L||(L=!!(R!=null&&R.value)),L||(L=!!((J=I.value)!=null&&J.dirty)),L}),K=z(()=>({mobile:m.mobile,email:m.email,destinationMobile:m.destinationMobile,phone:m.landline})),U=z(()=>{if(!V)return s.t("TrainErrors.noInternet");switch(a.value){case Ke.Flight:return`${s.t("FlightErrors.unableFlight")}
${s.t("FlightErrors.tryAnotherTime")}`;default:return s.t("TrainErrors.globalError")}}),ne=z(()=>h.value.some(L=>L.isHotelPackage())),pe=L=>{f==null||f.trackEvent({event:"form-add-pax",pax:L===Te.Adult?"adult":L===Te.Child?"child":"infant"});try{o.addPax(L),Me(()=>o.refetchPrebills())}catch(Q){T(Q,{title:"خطا!"})}},te=()=>{var Q;const L=(((Q=C.value)==null?void 0:Q.getBoundingClientRect().top)||0)+document.documentElement.scrollTop+150;x.value=window.scrollY+window.innerHeight<L},ge=()=>{y.back()},ce=async()=>{await S({icon:"warning",title:s.t("Timer.timeOverTitle"),text:s.t("Timer.timeOverMessage"),confirmButtonText:s.t("Timer.ok")}),f==null||f.trackEvent({event:"ok button-time is up"}),fe()},fe=()=>{var L;if(w.value=!1,H.reserveType===Ke.Hotel)(L=b.selectedPackages[0])!=null&&L.isHotelPackage()&&(b.selectedPackages[0].loadedPrices=[]),y.back();else{const Q=o.itineraryPackages.some(J=>J.checkNeedsRaiseClass({adultCount:o.adultCount,childCount:o.childCount,infantCount:o.infantCount})),Y=$.value||Q?2:1;o.itineraryPackages=[],b.clearSelectedPackages(),p.selectedBundlePackage=null,H.forceLoadAvailable(!0),y.go(-Y)}},Le=async()=>{var ht,vt,pt,mt,yt,gt,bt,Pt,kt,At,wt;let L=!0;const Q=[];(d.value??[]).forEach(ie=>{L=L&&ie.validateAll(),Q.push(ie.getData())});const Y=!!((ht=g.value)!=null&&ht.validateAll());if(L=L&&Y,!L){Ne({focusInput:!0});return}if(!l.value.isValid){await S({title:"توجه",icon:"error",text:`باید ${l.value.passCount} صندلی انتخاب کنید.`,confirmButtonText:"باشه",didClose:()=>Ne({className:"scroll-seat-select"})});return}const J=Q.map(ie=>ie.nationalCode);if(J.some((ie,ye)=>ie&&J.indexOf(ie)!==ye)){await S({title:s.t("FormAlert.alertText"),icon:"error",text:s.t("FormAlert.duplicateNationalCode"),confirmButtonText:s.t("FormAlert.ok"),didClose:()=>Ne({className:"scroll-national-code"})});return}let Ge=null;if(o.itineraryPackages.forEach(ie=>{var $e;const ye=ie;($e=ye.selectedPrice)!=null&&$e.sellType&&(ye.selectedPrice.sellType.code===xt.Male&&Q.some(Oe=>Oe.gender===et.Female)||ye.selectedPrice.sellType.code===xt.Female&&Q.some(Oe=>Oe.gender===et.Male))&&(Ge=ye.selectedPrice.sellType)}),Ge){const{isConfirmed:ie}=await S({text:s.t("TrainAlerts.confirmGender",{gender:Ge.title}),confirmButtonText:s.t("TrainAlerts.confirm"),showCancelButton:!0,cancelButtonText:s.t("TrainAlerts.cancel")});if(!ie)return}const le=(vt=g.value)==null?void 0:vt.getData();let ft;h.value.some(ie=>ie.isHotelPackage())&&(ft=(pt=h.value[0].selectedPrices)==null?void 0:pt.map(ie=>{var ye,$e;return{id:ie.room.roomId,hasEarlyCheckin:(ye=ie.selectedExtraOptions)==null?void 0:ye.some(Oe=>Oe.id===De.EarlyCheckin),hasLateCheckout:($e=ie.selectedExtraOptions)==null?void 0:$e.some(Oe=>Oe.id===De.LateCheckout)}}));try{if($.value&&((yt=(mt=q.value)==null?void 0:mt.trips)!=null&&yt.length)){const{isConfirmed:ye}=await S({icon:"warning",text:"ظرفیت خالی برای سفر انتخاب شده موجود است",cancelButtonText:"بازگشت به لیست",confirmButtonText:"متوجه شدم",showCancelButton:!0});if(!ye){y.go(-3);return}}const ie=await m.registerPaxInfo({pax:Q,email:(le==null?void 0:le.email)||"",mobile:(le==null?void 0:le.mobile)||"",landline:(le==null?void 0:le.phone)||"",destinationMobile:(le==null?void 0:le.destinationMobile)||"",customData:{seatHandler:l.value,rooms:ft,requestFromHotel:(gt=R==null?void 0:R.value)==null?void 0:gt.value},formDirty:o.formDirty,origin:((bt=I.value)==null?void 0:bt.origin)||"",flightNumber:((Pt=I.value)==null?void 0:Pt.flightNumber)||"",message:(kt=g.value)==null?void 0:kt.extraData});if(ie)u.value.length>0&&m.billCode&&O.isOrganizationalUser&&await _({BillCode:m.billCode.toString(),LabelIds:(At=u.value)==null?void 0:At.map(({id:ye})=>Number(ye))}).catch(()=>{}),f==null||f.trackEvent({event:"pfp-next button click"}),await o.refetchPrebills(),v.setWebengageUserInfo({mobile:le==null?void 0:le.mobile,email:le==null?void 0:le.email}),m.informationRegisterStatus=ie?Je.Registered:Je.Error,o.isFloatingReserve?await y.push({path:"/reserve/float",query:{reserveId:(wt=m.reserveId)==null?void 0:wt.toString()}}):await y.push("/reserve/prepay");else throw new Error("خطای نامشخص")}catch(ie){T(ie)}},Ne=L=>{Me(()=>{er(L)})},xe=()=>{f==null||f.trackEvent({event:"begin_checkout",value:{transaction_id:m.billCode,value:m.totalPriceUnformatted/1e4,currency:"USD",items:o.itineraryPackages.map(L=>({id:L.invoiceTitle,name:L.invoiceTitle,category:L.reserveType,price:(L.totalPayableForCheck??0)/1e4,quantity:L.totalCount}))}})},je=async L=>{let Q={title:s.t("Bill.attention"),text:L.message,icon:"warning",confirmButtonText:s.t("Bill.ok")};(L.type==="priceIncrease"||L.type==="timeChange")&&(Q={...Q,showCancelButton:!0,cancelButtonText:s.t("Bill.goBack"),confirmButtonText:s.t("Bill.ok"),allowOutsideClick:!1,allowEscapeKey:!1}),v.trackAll("reserveError",{status:L.type});const{isConfirmed:Y}=await S(Q);Y||(L.type==="priceIncrease"&&(f==null||f.trackEvent({event:"back button-price change"}),y.back()),L.type==="timeChange"&&(f==null||f.trackEvent({event:"re-search button-time change"}),y.back())),(L.type==="priceIncrease"||L.type==="priceDecrease")&&(m.priceChangeMessageShown=!0)};return Ee(k,()=>{const{editingItem:L}=m;L&&Me(()=>{const Q=document.getElementById(L),Y=Q==null?void 0:Q.querySelector("#FirstName input");Q&&window.setTimeout(()=>{Q.scrollIntoView({behavior:"smooth"}),Y&&(Y==null||Y.focus())},500),m.editingItem=""})},{immediate:!0,deep:!0}),Vt(()=>{const L=k.query.reserveType;!b.selectedPackages.length&&!sessionStorage.getItem("reserveData")&&!L?(w.value=!1,y.push("/")):o.itineraryPackages=b.selectedPackages}),ze(async()=>{var Y;if(m.editingItem="",m.informationRegisterStatus===Je.Registered){e.value=we.Verified;return}const L=k.query.reserveType;if(L)try{H.setReserveType(L),H.currentItineraryModule().initSm(k.fullPath),await H.currentItineraryModule().formAutoReserve(k.query)}catch(J){J instanceof Error&&(r.value=J.message,o.verificationStatus=we.UnknownError);return}else H.currentItineraryModule().initSmInFormPage&&H.currentItineraryModule().initSm(k.fullPath);o.loadSession(),o.isLoadFromSession||o.setCounts({adultCount:H.adultCount,childCount:H.childCount,infantCount:H.infantCount}),m.customData=null,m.couponStatus=Jt.None,o.setPrevPax({prevPax:[]}),o.prevPaxLoadingStatus=it.None,o.clearState(),O.loadCredit(!0);let Q;try{Q=await o.verify()}catch(J){switch(J instanceof _t&&J.error===we.ShowAndReturn&&(await S({icon:"warning",text:J.customMessage,confirmButtonText:"باشه"}),fe()),J instanceof _t&&J.customMessage&&(r.value=J.customMessage),e.value){case we.UnknownError:v.trackAll("reserveError",{status:"unknownError",...v.searchResultsAttributesForReserve});break;case we.IsFull:v.trackAll("reserveError",{status:"capacity",...v.searchResultsAttributesForReserve});break;case we.UnableToConnect:v.trackAll("reserveError",{status:"connection",...v.searchResultsAttributesForReserve});break}return}if(D.value){const[J]=o.itineraryPackages;v.trackAll("reserve",{isDiscounted:`${(Y=J.selectedPrices)==null?void 0:Y.some(Se=>Se.isDiscounted)}`,isFeatured:"false",isSameService:`${J.reserveType===H.firstReserveType}`,isMasir:"false",...v.searchResultsAttributesForReserve}),xe()}if(Q)for(const J in Q.warningMessages)await je(Q.warningMessages[J]);j.checkReserve(),window.addEventListener("scroll",te)}),sr(()=>{window.removeEventListener("scroll",te)}),ur(async(L,Q,Y)=>{var J,Se;if((Se=(J=d.value)==null?void 0:J[0])==null||Se.closePaxModal(),L.path==="/reserve/prepay"||L.path==="/reserve/float"){Y();return}w.value&&F?(await S({icon:"warning",text:`مطمئنید؟
    در صورت بازگشت به صفحه قبل، اطلاعات وارد شده از دست می‌روند.`,confirmButtonText:"بله",cancelButtonText:"خیر",showCancelButton:!0})).isConfirmed?Y():Y(!1):Y()}),re({back:ge,proceed:Le}),(L,Q)=>(N(),Z("div",xa,[c(M)?(N(),Z("div",Ea,[Sa,Oa,G("h3",null,[Pe(he(`${c(B).title} در تلاش برای انجام رزرو است`)+" ",1),Ra]),Ma])):c(D)?(N(),Z(ve,{key:2},[c(l).hasSeatSelection?(N(),ee(_a,{key:0,handler:c(l),onBack:fe},null,8,["handler"])):se("",!0),G("div",Ta,[G("div",Va,[Ia,c(i)?(N(),ee(dr,{key:0,"timer-millis":c(t),onTimeUp:ce},null,8,["timer-millis"])):se("",!0)]),ae(nt,{thickness:"1px",margin:"0"}),(N(!0),Z(ve,null,Ve(c(A),Y=>(N(),Z(ve,{key:Y},[Y>1?(N(),ee(nt,{key:0,thickness:"1px",margin:"0"})):se("",!0),ae(Nr,{ref_for:!0,ref_key:"forms",ref:d,index:Y-1,"bus-seat-handler":c(l),onSubmit:Le},null,8,["index","bus-seat-handler"])],64))),128))]),c(P).length?(N(),Z("div",Ba,[Da,(N(!0),Z(ve,null,Ve(c(P),Y=>(N(),ee(Ce,{key:Y.code,"right-icon":c(Zt),type:"transparent",size:"small",onClick:J=>pe(Y.code)},{default:ue(()=>[Pe(he(Y.title),1)]),_:2},1032,["right-icon","onClick"]))),128))])):se("",!0),c(O).isOrganizationalUser?(N(),ee(vr,{key:2,labels:c(u),"onUpdate:labels":Q[0]||(Q[0]=Y=>ct(u)?u.value=Y:null)},null,8,["labels"])):se("",!0),ae(Ur,{ref_key:"contactForm",ref:g,"has-destination-phone":c(n),"initial-value":c(K),onSubmit:Le},null,8,["has-destination-phone","initial-value"]),c(ne)?(N(),ee(ta,{key:3,ref_key:"hotelRequest",ref:R},null,512)):se("",!0),ae(Xr,{ref_key:"freeTransform",ref:I},null,512),G("div",{ref_key:"actionsMarker",ref:C,class:"actions-marker"},null,512)],64)):(N(),ee(cr,{key:1,"wrapper-id":"pfp-reserve-error",error:c(r)||c(U),onResearch:fe},null,8,["error"]))]))}});const Za=Ae(Wa,[["__scopeId","data-v-ec898bff"]]);export{Za as default};
