(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1689],{51389:38445:function(e,t,a){"use strict";var n=a(52322),r=a(78066);t.Z=e=>{let{name:t,logo:a,handleNext:o,...s}=e;return(0,n.jsxs)(r.Z,{containerClass:"mt-5",title:"Add engagement fields to ".concat(t),nextButton:(0,n.jsxs)("button",{className:"btn-white justify-center bg-white font-medium shadow",onClick:o,children:[(0,n.jsx)(a,{className:"mr-2"}),"Automap fields"]}),...s,children:[(0,n.jsxs)("div",{className:"rounded-md border bg-gray-50 px-4 py-3 text-sm shadow-sm",children:[(0,n.jsx)("div",{className:"mb-1 font-medium",children:"Fields successfully created"}),(0,n.jsxs)("div",{children:["The Navattic engagement fields have been added to your ",t," instance."]})]}),(0,n.jsx)("div",{className:"mt-5 text-base font-medium",children:"Auto-map new fields"}),(0,n.jsxs)("div",{className:"mt-1 text-sm text-gray-500",children:["Automatically connect these new ",t," fields to the corresponding Navattic engagement fields."]})]})}},13710:function(e,t,a){"use strict";var n=a(52322),r=a(2784),o=a(99219),s=a(61807),i=a(78066),l=a(73022),c=a(77512);t.Z=function(e){let{error:t,name:a,logo:d,handleNext:u,allowedFields:m,children:p,loading:h,...g}=e,[x,f]=(0,r.useState)(new Set);return(0,r.useEffect)(()=>{f(m.reduce(new Set))},[m]),(0,n.jsx)(i.Z,{containerClass:"mt-5",title:"Add engagement fields to ".concat(a),nextButton:h?(0,n.jsx)(s.Z,{}):(0,n.jsxs)("button",{className:"btn-white justify-center bg-white font-medium shadow",onClick:children:[(0,n.jsx)(d,{className:"mr-2"}),"Create Fields"]}),...g,children:(0,n.jsxs)("div",{className:"-mt-2 space-y-4",children:[t&&(0,n.jsx)("div",{className:"space-x-2 rounded border bg-gray-50 px-4 py-3 text-sm text-rose-900",children:t}),(0,n.jsx)("div",{className:"space-y-1.5",children:m.map(e=>{let t=e.type===l.J.NUMBER?o.yEv:o.Rhe;return(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)(c.XZ,{name:e.name,checked:x.has(e.name),onChange:t=>{var a,n;t?(a=e.name,f(e=>{let t=new Set(e);return t.add(a),t})):(n=e.name,f()}}),(0,n.jsxs)("div",{className:"flex w-full items-center rounded border px-3 py-2 text-[12px] text-gray-700 shadow-sm",children:[(0,n.jsx)("div",{className:"mr-3 rounded bg-gray-600",children:(0,n.jsx)(t,{className:"h-3.5 w-3.5 text-white"})}),e.name]})]},e.name)})}),p]})})}},40761:function(e,t,a){"use strict";a.d(t,{Z:function(){return QuickSetupCollapse}});var n=a(52322),r=a(37100);function QuickSetupCollapse(e){let{objectName:t,logo:a,integrationName:o,onClick:s}=e;return(0,n.jsxs)(r.Z,{title:(0,n.jsxs)("div",{className:"flex items-center",children:["Quick Setup",(0,n.jsx)("div",{className:"ml-3 rounded border bg-gray-50 px-1 text-[13px] leading-5 text-gray-600",children:t})]}),className:"mt-5 overflow-hidden rounded-md border border-gray-200",children:[(0,n.jsxs)("div",{className:"text-sm leading-relaxed text-gray-500",children:["Create Navattic engagement fields on your ",o," instance. You'll have an option to select which fields to create."]}),(0,n.jsxs)("button",{onClick:s,className:"btn-white mt-4 w-full justify-center bg-white font-medium shadow",children:[(0,n.jsx)(a,{className:"mr-2"}),"Auto-create engagement fields"]})]})}},38265:function(e,t,a){"use strict";a.d(t,{Z:function(){return ConnectForm}});var n=a(52322),r=a(47330),o=a(73235),s=a(66547),i=a(91210),l=a(26806);et c=(0,s.ZP)(_templateObject(),i.$);var d=a(86414),u=a(53954),m=a(56958);let p=Object.values(r.tw).map(;function ConnectForm(e){let{webhookEvents:t,webhookAuthType:a,webhookAuthValue:r,integrationSettings:o,children:s,url:i}=e,{workspace:h}=(0,u.cF)(),[,g]=l.Db(c),{name:x,Logo:f,webhookFormat:b}=o;return(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),m.A.promise(g({workspaceId:h.id,data:{name:x,auth:{type:a,value:r},events:null!=t?t:p,format:b,url:i}}).then(e=>{if(e.error)throw Error(e.error.message);d.Z.track("".concat(x.toLowerCase(),"_integration_connected"))}),{loading:"Connecting to ".concat(x,"..."),success:"Connected to ".concat(x),error:"Error connecting to ".concat(x)})},children:[s,(0,n.jsxs)("button",{className:"btn-white mt-5 w-full justify-center bg-white font-medium shadow",type:"submit",children:[(0,n.jsx)(f,{className:"mr-2 h-4 w-4"}),"Connect to ",x]})]})}},78066:function(e,t,a){"use strict";a.d(t,{Z:function(){return Modal}});var n=a(52322),r=a(2784),o=a(68810),s=a(64529),i=a(83122),l=a(82002),c=a(89370);}},199},2307:function(e,t,a){"use strict";a.r(t),a.d(t,{defaul}});var n=a(52322),r=a(99219),o=a(2784),s=a(40761),i=a(1991);let fetchProgramsFromMarketo=async e=>{let{id:t}=e,a=await fetch("".concat((0,i.ZA)(),"?id=").concat(t));if(!a.ok)return{result:[],success:!1};let n=await a.json();return n},fetchLeadFieldsFromMarketo=async e=>{let{webhookId:t}=e,a=await fetch("".concat((0,i.g9)(),"?id=").concat(t));if(!a.ok)return{result:[],success:!1};let n=await a.json();return{result:n.result[0].fields,success:!0}},createLeadFieldsInMarketo=async e=>{let{webhookId:t,request:a}=e,n=await fetch("".concat((0,i.g9)(),"?id=").concat(t),{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}});if(!n.ok){let e=await n.json();return{result:[],success:!1,error:e.error}}let r=await n.json();return r};var l=a(73022),c=a(56958),d=a(38445),u=a(13710);let m={[l.J.STRING]:"string",[l.J.NUMBER]:"integer",[l.J.BOOLEAN]:"boolean"};var MarketoQuick=e=>{let{objectName:t,webhook:a,logo:r,integrationName:i,afterCreateFields:p,autoMapField:h}=e,[g,x]=(0,o.useState)(!1),[f,b]=(0,o.useState)(!1),[j,v]=(0,o.useState)([]),[w,y]=(0,o.useState)(!1);async function handleNextCreateFields(e){y(!0);let t=l.VG.filte)),{success:n}=await createLeadFieldsInMarketo({webhookId:a.id,request:{input:t.filteD).map(e=>({displayName:e.label,name:e.name,description:e.description,dataType:m[e.type]}))}});y(!1),null==p||p(),n?(v(t),x(!1),b(!0)):(c.A.error("Failed to create fields."),x(!1),b(!1))}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.Z,{objectName:t,integrationName:i,logo:r,onClick:()=>x(!0)}),(0,n.jsx)(u.Z,{name:i,logo:r,allowedFields:l.VG.filte)),handleNext:handleNextCreateFields,open:g,handleClose:()=>x(!1),loading:w}),(0,n.jsx)(d.Z,{open:f,handleClos),name:i,logo:r,handleNext:()=>{j.forEach(h),b(!1),x(!1)}})]})},p=a(27425),h=a(32517),g=a(18318),x=a(52934),f=a(77815);let useLoadMarketoFields=e=>{let{webhookId:t,onError:a}=e,[n,r]=(0,o.useState)(!1),[s,i]=(0,o.useState)([]),l=(0,o.useCallback)(()=>{if(!t)return;let e=!0;return r(!0),fetchLeadFieldsFromMarketo({webhookId:t}).then(async t=>{e&&(r(!1),t.success?i(t.result):a("Could not retrieve fields from Marketo"))}),()=>{e=!1}},[t,a]);return(0,o.useEffect},[l]),{fetching:n,fields:s,refresh:l}},useLoadMarketoPrograms=e=>{let{webhookId:t,onError:a}=e,[n,r]=(0,o.useState)(!1),[s,i]=(0,o.useState)([]);return(0,o.useEffect)(()=>{if(!t)return;let e=!0;return r(!0),fetchProgramsFromMarketo({id:t}).then(async t=>{e&&(r(!1),t.success?i(t.result):a("Could not retrieve programs from Marketo"))}}},[t,a]),{fetching:n,programs:s}};var b=a(20851),j=a(47128),v=a(91077);let stringifyMarketoConfig=e=>JSON.stringify(e);var w=a(47330),y=a(77512),k=a(38265);let N=[{heading:"Create an API Only User Role",link:"https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/users-and-roles/create-an-api-only-user-role.html"},{heading:"Create an API Only User",link:"https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/users-and-roles/create-an-api-only-user.html"},{heading:"Create a Custom Service",link:"https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/additional-integrations/create-a-custom-service-for-use-with-REST-api.html"},{heading:"Add your Custom Service ID and secret below",link:"https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/additional-integrations/create-a-custom-service-for-use-with-REST-api.html#credentials-for-api-access"},{heading:"Add your Identity and Endpoint URLs below",link:"https://developers.marketo.com/REST-api/base-url/"}],RequiredTextField=e=>{let{label:t,name:a,placeholder:r,textValue:o,setTextValue:s}=e;return(0,n.jsx)(y.oi,{placeholder:r,name:a,labelText:t,value:o,onChang),type:"text",required:!0,className:"w-full"})},C=["get-programs","get-lead-fields","describe-lead"];var S=a(5001),M=a(83408);let F=(0,M.hu)("debug:navattic:marketo"),stringifyParam);var R=a(64766),I=a(97185);let E={name:"Marketo",screenshot:"https://www.navattic.com/img/marketo-dashboard.png",allowTestConnection:!0,webhookFormat:w.M8.Marketo,Logo:r.HdF,ConnectComponent:function(e){let{integrationSettings:t}=e,[a,s]=(0,o.useState)(""),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(""),[u,m]=(0,o.useState)(""),p=(0,o.useMemo),[a,i,c,u]);return(0,n.jsxs)(n.Fragment,{children:[N.map((e,t)=>(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("div",{className:"mb-1 text-base font-semibold",children:[t+1,". ",e.heading]}),(0,n.jsxs)("a",{className:"link flex items-center text-sm",target:"_blank",rel:"noreferrer",href:e.link,children:["Follow steps in Marketo documentation",(0,n.jsx)(r.h0n,{className:"ml-1 h-3 w-3"})]})]},e.heading)),(0,n.jsx)(k.Z,{webhookAuthType:w.H4.None,webhookAuthValue:p,integrationSettings:t,children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(RequiredTextField,{label:"Client ID",name:"client-id",textValue:c,setTextValue:d,placeholder:"Your Custom Service Client ID"}),(0,n.jsx)(RequiredTextField,{label:"Client Secret",name:"client-secret",textValue:u,setTextValue:m,placeholder:"Your Custom Service Client Secret"}),(0,n.jsx)(RequiredTextField,{label:"Endpoint URL",name:"endpoint-url",textValue:a,setTextValue:s,placeholder:"https://<munchkin-id>.mktorest.com/rest"}),(0,n.jsx)(RequiredTextField,{label:"Identity URL",name:"identity-url",textValue:i,setTextValue:l,placeholder:"https://<munchkin-id>.mktorest.com/identity"})]})})]})},DevelopmentComponent:e=>{let[t,a]=(0,o.useState)("get-programs"),[r,s]=(0,o.useState)("{}"),[i,l]=(0,o.useState)(""),[d,u]=(0,o.useState)(0),{webhook:m}=e,onClick=async()=>{if(!t){(0,h.Rn)("Need to specify a method");return}let e=(0,b.OA)(r);if(!e){(0,h.Rn)("Invalid JSON body provided");return}c.A.promise((async()=>{let a=await fetch("/api/private/marketo",{method:S.Z.POST,headers:{"Content-Type":"application/json"},body:stringifyParams({method:t,webhookId:m.id,data:e})}),n=await a.text(),r=(0,b.OA)(n);r?(F.log(r),l(JSON.stringify(r,null,2))):l(n),u(a.status)})(),{loading:"Sending request to Marketo...",success:"Successfully hit Marketo endpoint",error:h.bW})};return(0,n.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,n.jsx)("label",{htmlFor:"select-method",className:"label-small",children:"Select method"}),(0,n.jsx)(g.Z,{selected:t,onChang),disabled:!1,items:C.ma))}),(0,n.jsx)(y.gx,{id:"json-body",style:{fontFamily:"Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace"},labelText:"JSON body",className:"mt-3 w-full",value:r,onChange:s}),(0,n.jsx)("button",{className:"btn-blue my-3 w-full",onClick:onClick,children:"Send Test Request"}),(0,n.jsx)(y.gx,{id:"json-response",labelText:"Response",readOnly:!0,style:{fontFamily:"Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace"},className:"mt-3 w-full",value:i,placeholder:"Response goes here"}),d?(0,n.jsx)("label",{className:"label-base text-base text-gray-500",children:"Status: ".concat(d)}):null]})},ConfigurationComponent:e=>{var t;let{webhook:a,integrationSettings:s}=e,i=(0,b.OA)(a.config||""),[l,d]=(0,o.useState)(i||{fieldMap:{}}),[,u]=(0,x.I)(),{fields:m,fetching:w,refresh:y}=useLoadMarketoFields({webhookId:a.id,onError:h.Rn}),k=(0,o.useCallback),[m]),{programs:N,fetching:C}=useLoadMarketoPrograms({webhookId:a.id,onError:h.Rn}),[{data:S}]=(0,f.x)({variables:{workspaceId:a.workspaceId}}),M=(0,o.useMemo],[null==S?void 0:S.formFieldMetadata]),onSave=async()=>{if(!l.program){(0,h.Rn)("Please select a program");return}return c.A.promise(u({id:a.id,config:stringifyMarketoConfig(l)}).then(e=>{if(null==e?void 0:e.error)throw Error("Error saving: ".concat(e.error.message))}),{success:"Saved Marketo configuration!",loading:"Saving Marketo configuration...",error:h.bW})},F=(0,o.useMemo)(()=>({Leads:{toIcon:s.Logo,preventDuplicates:!0,fromIcon:()=>(0,n.jsx)(v.H,{className:"shrink-0",white:!1,height:15}),fromOptions:(0,j.Ed)(M).map(e=>({label:e.name,value:e.id})),toOptions:m.ma)),mappings:Object.entries(l.fieldMap||{}).map((e,t)=>{let[a,n]=e;return{id:t.toString(),from:a,to:n}}),onChange:e=>d(t=>({...t,fieldMap:Object.fromEntries(e.ma]))}))}}),[l.fieldMap,m,M,s.Logo]);return(0,n.jsxs)("div",{className:"mx-auto max-w-[440px]",children:[(0,n.jsx)("label",{className:"label-small",children:"Program"}),C?(0,n.jsxs)("div",{className:"mt-2 flex flex-row items-center justify-center space-x-2 text-sm text-gray-500",children:[(0,n.jsx)(r.L4p,{className:"h-3 w-3"}),(0,n.jsx)("span",{children:"Loading programs..."})]}):(0,n.jsx)(g.Z,{items:N.ma)),selected:l.program?{id:l.program.id.toString(),name:null===(t=l.program)||void 0===t?void 0:t.name}:void 0,selectFirstItem:!0,onChange:e=>d(t=>({...t,program:{id:parseInt(e.id),name:e.name}})),placeHolder:"Select program",renderSelectedIco)}),(0,n.jsx)(MarketoQuick,{objectName:"Leads",logo:s.Logo,integrationName:s.name,webhook:a,afterCreateFields:y,autoMapField:e=>{d(t=>{var a;return{...t,fieldMap:{...t.fieldMap,[e.name]:(null===(a=k(e))||void 0===a?void 0:a.name)||""}}})}}),(0,n.jsx)(p.Z,{tabs:F}),(0,n.jsxs)("button",{onClick:onSave,className:"btn-white mt-7 w-full justify-center bg-white font-medium shadow",children:[(0,n.jsx)(s.Logo,{className:"mr-2"}),"Save configuration"]})]})}}MarketoIntegrationPage.getLayou};var T=MarketoIntegrationPage}}]);
//# sourceMappingURL=marketo-552aa85253ac1fe5.js.map