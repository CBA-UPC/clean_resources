/*
 ashiato_multireco-1.8.0.js
 Copyright (c) 2022 Rakuten.Inc
 Date: 2022-12-27 14:35:24
*/

!function(a,b,c){"use strict";function d(a,b){function c(a){a.naturalWidth<=1&&a.naturalHeight<=1&&(f(a).attr("src",d),f(a).attr("srcset",""))}var d="https://r.r10s.jp/com/js/d/common/images/no-image.png?_ex="+b;f("#ashiatoRecoExistItemDisplay img").each(function(){-1===g.indexOf(this)&&(g.push(this),this.complete?c(this):f(this).one("load",.one("error",function(){f(this).attr("src",d),f(this).attr("srcset","")}))})}function e(){
d("#ashiatoRecoAshiatoItemDisplay img","122x122"),d("#ashiatoRecoRecoSlider img","130x130")}if(b!==c){b.noConflict();var f=b;if(f.RJS_Helpers&&f().RJS_Slideshow){var g=[];(new function(){var b=this;f.extend(b,{settings:{common:{noready:[0,"Int","^[0-1]$"],pagespeed:[100,"Range","0,9999"],opacityspeed:[100,"Range","0,9999"],autoslidetime:[2,"Range","1,99"],autoslideflag:["next","Str","^(next|prev)$"],autoslide:[0,"Int","^[0-1]$"],autoresize:[1,"Int","^[0-1]$"],
impvar:["","Str","^[a-zA-Z0-9_]{3,64}$"],impdisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],impnodisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],verticalmode:[0,"Int","^[1]$"],ajaxtimer:[3,"Range","1,99"],recothreshold:[5,"Int","^[1-9]$"],rankingshuffle:[1,"Int","^[0-1]$"],requestwait:[500,"Range","1,9999"],checkinterval:[100,"Range","1,9999"],genrefilter:["551169","Str","^[0-9,]{1,69}$"],showonnodata:[0,"Int"]},ashiato:{imagesize:["80x80","Str","^[1-9][0-9]{1,2}[x:][1-9][0-9]{1,2}"],
omitname:[26,"Range","0,100"],maxitem:[1,"Int","^[1-9]$"],url:["","Str","^(https?:)?//(?:[a-zA-Z0-9_\\-]+\\.)+rakuten\\.co\\.jp\\/[a-zA-Z0-9_&=\\?\\-\\.%:\\/]+$"],sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"],mockdata:["","Str"]},reco:{imagesize:["80x80","Str","^[1-9][0-9]{1,2}[x:][1-9][0-9]{1,2}"],omitname:[26,"Range","0,100"],maxitem:[3,"Int","^[1-9]$"],url:["","Str","^(https?:)?//(?:[a-zA-Z0-9_\\-]+\\.)+rakuten\\.co\\.jp\\/[a-zA-Z0-9_&=\\?\\-\\.%:\\/]+$"],sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"],
placement:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"],mockdata:["","Str"]},ranking:{url:["","Str","^(https?:)?//(?:[a-zA-Z0-9_\\-]+\\.)+rakuten\\.co\\.jp\\/[a-zA-Z0-9_&=\\?\\-\\.%:\\/]+$"],genrelayer:[2,"Int","^[1-9]$"],sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"]}},eobj:{common:{config:f("#ashiatoRecoCommonConfig"),existItem:f("#ashiatoRecoExistItemDisplay"),altContents:f("#ashiatoRecoAlteredContents"),recoSlider:f("#ashiatoRecoRecoSlider"),loading:f("#ashiatoRecoLoading")},ashiato:{
config:f("#ashiatoRecoAshiatoConfig"),prevButton:f("#ashiatoRecoCheckPrevButton"),nextButton:f("#ashiatoRecoCheckNextButton"),proto:f("#prototypeAshiatoRecoAshiatoItem"),itemsDisplay:f("#ashiatoRecoAshiatoItemDisplay")},reco:{config:f("#ashiatoRecoRecoConfig"),prevButton:f("#ashiatoRecoPrevButton"),nextButton:f("#ashiatoRecoNextButton"),proto:f("#prototypeAshiatoRecoRecoItem"),itemsDisplay:f("#ashiatoRecoRecoItemsDisplay"),altContents:f("#ashiatoRecoRecoAlteredContents")},ranking:{
config:f("#ashiatoRecoRankingConfig")}},status:{error:!1,isTimeout:!1},props:{ashiato:{items:[],proto:{html:"",height:0,width:0,identifiers:{itemurl:["",/\#ITEMURL\#/g,""],imageele:['<img src="#ITEMIMGURL#" alt="#ITEMIMGALT#" title="#ITEMIMGTITLE#">',/\#ITEMIMGELE\#/g,""],imageurl:["",/\#ITEMIMGURL\#/g,""],imagealt:["",/\#ITEMIMGALT\#/g,""],imagetitle:["",/\#ITEMIMGTITLE\#/g,""],itemname:["",/\#ITEMNAME\#/g,""],itemprice:["",/\#ITEMPRICE\#/g,""],greatersuffix:["",/\#GREATERSUFFIX\#/g,""]}}},
reco:{items:[],visitedPages:[],proto:{html:"",height:0,width:0,identifiers:{itemurl:["",/\#ITEMURL\#/g,""],imageele:['<img src="#ITEMIMGURL#" alt="#ITEMIMGALT#" title="#ITEMIMGTITLE#">',/\#ITEMIMGELE\#/g,""],imageurl:["",/\#ITEMIMGURL\#/g,""],imagealt:["",/\#ITEMIMGALT\#/g,""],imagetitle:["",/\#ITEMIMGTITLE\#/g,""],itemname:["",/\#ITEMNAME\#/g,""],itemprice:["",/\#ITEMPRICE\#/g,""],greatersuffix:["",/\#GREATERSUFFIX\#/g,""]}}},currentAshiatoIndex:!1,requestPermission:!0,
requestPermissionTimer:null,checkWaitInterval:null,initialized:!1},initialize:function(){if(!b.loadSettings())return void b.displayDefaultContents();1==b.settings.noReady?b.begin():f(document).ready(},loadSettings:function(){return b.eobj.ashiato.proto.hide(),b.eobj.reco.proto.hide(),b.settings.common=f.RJS_Helpers.readAttr(b.eobj.common.config,b.settings.common),b.settings.ashiato=f.RJS_Helpers.readAttr(b.eobj.ashiato.config,b.settings.ashiato),
b.settings.reco=f.RJS_Helpers.readAttr(b.eobj.reco.config,b.settings.reco),b.settings.ranking=f.RJS_Helpers.readAttr(b.eobj.ranking.config,b.settings.ranking),f.extend(b.settings.ashiato,b.settings.common,b.settings.ashiato),f.extend(b.settings.reco,b.settings.common,b.settings.reco),b.settings.ashiato.autoslide=0,b.settings.ashiato.maxitem=1,b.settings.reco.autoslide=0,
!(""==b.settings.ashiato.url||b.settings.ashiato.url.length>512)&&(!(""==b.settings.reco.url||b.settings.reco.url.length>512)&&(!(""==b.settings.ranking.url||b.settings.ranking.url.length>512)&&(0!==b.eobj.ashiato.proto.length&&(0!==b.eobj.reco.proto.length&&(b.settings.common.autoslidetime*=1e3,b.settings.common.ajaxtimer*=1e3,b.eobj.common.config.remove(),b.eobj.ashiato.config.remove(),b.eobj.reco.config.remove(),!0)))))},displayDefaultContents:function(a){b.eobj.ashiato.proto.remove(),
b.eobj.reco.proto.remove(),b.eobj.common.altContents.show(),b.eobj.common.existItem.remove(),a&&b.regImpressionCode(a)},displayRecoDefaultContents:displayRecoLoading:function(){b.eobj.reco.altContents.hide(),b.eobj.common.altContents.hide(),b.eobj.common.recoSlider.hide(),b.eobj.common.existItem.show(),b.eobj.common.loading.show()},begin:function(){b.getAshiatoData()},
getAshiatoData:function(){function d(a){return b.status.isTimeout?(b.displayDefaultContents(),!1):(clearTimeout(g),a.code===c||a.num===c?(b.displayDefaultContents(),!1):"0"!=a.code?("1"!=a.code&&"8"!=a.code||b.regImpressionCode(b.settings.common.impnodisp),b.displayDefaultContents(),!1):a.items.length<1?(b.displayDefaultContents(b.settings.common.impnodisp),!1):(b.props.ashiato.items=a.items.filter(.map(function(a){return{
itemname:b.editItemname(a.itemname,b.settings.ashiato.omitname),itemprice:b.editItemprice(a.itemprice),greatersuffix:1===a.haspricerange?"\uff5e":"",itemurl:b.editItemurl(a.itemurlfull,b.settings.ashiato.sid),imageele:"",imageurl:""!=a.imageurl?b.editImageurl(a.imageurl,b.settings.ashiato.imagesize):a.imageurl64,imagealt:b.editItemname(a.itemname,b.settings.ashiato.omitname),imagetitle:b.editItemname(a.itemname,b.settings.ashiato.omitname),mngnumber:a.mngnumber,shopurl:a.shopurl,itemid:a.itemid,
shopid:a.shopid,genreidlist:a.genreidlist}}),0===b.eobj.ashiato.proto.length?(b.displayDefaultContents(),!1):(b.props.ashiato.proto.width=b.eobj.ashiato.proto.outerWidth(),b.props.ashiato.proto.height=b.eobj.ashiato.proto.outerHeight(),b.props.ashiato.proto.html=b.eobj.ashiato.proto.html(),""==b.props.ashiato.proto.html?(b.displayDefaultContents(),!1):(b.eobj.ashiato.proto.remove(),b.eobj.ashiato.itemsDisplay.RJS_Slideshow(b,{settings:b.settings.ashiato,itemPrototype:b.props.ashiato.proto,
eobj:b.eobj.ashiato,items:b.props.ashiato.items,events:{beforeFirstRender:afterSlide:function(a,b){b.props.reco.visitedPages=[],b.getCachedRecoData(a)||b.getRecoData(a)}}}),b.getRecoData(0),void e()))))}var g;b.status.isTimeout=!1;try{if(g=setTimeout(b.settings.common.ajaxtimer),b.settings.ashiato.mockdata){return void d(a.JSON.parse(b.settings.ashiato.mockdata))}f.ajax({
url:b.settings.ashiato.url,cache:!1,dataType:"jsonp",scriptCharset:"euc-jp",timeout:b.settings.common.ajaxtimer,success:error:)}catch(a){return void b.displayDefaultContents()}},getCachedRecoData:function(a){if(!1===a||0==b.props.reco.items.length)return!1;var d=b.props.reco.items[a];return d!=c&&0!=d.length&&(b.displayRecoLoading(),b.displayRecoData(a),!0)},getRecoData:function(d){function e(a,d){
var e,h,i,j,k,l=[],m={},n=[],o=[],p=b.props.ashiato.items[d];if(b.status.isTimeout)return!1;if(clearTimeout(g),a.status===c)return!1;var q,r;if(b.settings.reco.placement?(q=a.reco_count,r=a.reco):(q=a.item_count,r=a.item),q===c)return!1;if("Success"!=a.status&&"NotFound"!=a.status)return!1;for(i=0,h=r.length;i<h;i++)e=r[i],j=b.editItemurl(e.item_url,b.settings.reco.sid),a.tracking_tag&&(j=f.RJS_Helpers.urlParameter(j,{rtg:a.tracking_tag},!1)),n.push(e.shop_id+"/"+e.item_id),e.rtg&&o.push(e.rtg),
l.push({itemname:b.editItemname(e.item_name,b.settings.reco.omitname),itemurl:j,imageele:"",imageurl:e.image_path1?b.editR2P2Imageurl(e.image_path1,b.settings.reco.imagesize):e.image_url1,imagealt:b.editItemname(e.item_name,b.settings.reco.omitname),imagetitle:b.editItemname(e.item_name,b.settings.reco.omitname),itemprice:b.editItemprice(e.item_price),greatersuffix:b.hasPriceRange(e)?"\uff5e":""});return m.cpData={rec_pid:[p.shopid+"/"+p.itemid],rec_id:n,rec_rtg:o,rec_srv:"ichiba",rec_sid:a.sid
},b.settings.reco.placement?m.cpData.rec_rpl=b.settings.reco.placement:(k=f.RJS_Helpers.urlParameter(b.settings.reco.url))&&k.sid&&(m.pData.rec_rpl=k.sid),b.props.reco.items[d]=l,!(q<b.settings.common.recothreshold)&&b.displayRecoData(d,m)}if(b.displayRecoLoading(),!b.props.requestPermission)return clearInterval(b.props.checkWaitInterval),void(b.props.checkWaitInterval=setInterval(function(){b.props.requestPermission&&(clearInterval(b.props.checkWaitInterval),b.getRecoData(d))
},b.settings.common.checkinterval));var g;b.status.isTimeout=!1;try{g=setTimeout(b.settings.common.ajaxtimer);var h,i=b.props.ashiato.items[d],j=b.settings.reco.url,k=i.shopid+"_"+i.itemid;if(b.settings.reco.placement){var l=new URL(j+b.settings.reco.placement);l.searchParams.append("id",k),j=l.toString()}else h={item_id:k};if(b.settings.reco.mockdata){return void(e(a.JSON.parse(b.settings.reco.mockdata),d)||b.getRankingData(d))}f.ajax({
url:j,cache:!1,data:h,scriptCharset:"euc-jp",timeout:b.settings.common.ajaxtimer,success:error:)}catch(a){return b.getRankingData(d),!1}return!0},getRankingData:function(a){function d(a,d){if(b.status.isTimeout)return!1;if(clearTimeout(e),a.status===c||a.num===c)return!1;if("Success"!=a.status&&"GenreNotFound"!=a.status)return!1
;if(a.num<b.settings.common.recothreshold)return b.regImpressionCode(b.settings.common.impnodisp),!1;for(var g=b.props.ashiato.items[d],h=[],i=0;i<a.items.length;i++){var j=(/R2=([^\&]+)/.exec(a.items[i].itemurl)||[])[1],k=!0;j===c&&/^https?:\/\/item.rakuten.co.jp/.test(a.items[i].itemurl)&&(k=!1,j=a.items[i].itemurl),j!==c&&(b.endsWith(j,g.shopurl+"/"+g.mngnumber+"/")||h.push({itemname:b.editItemname(a.items[i].itemname,b.settings.reco.omitname),
itemurl:b.editItemurl(a.items[i].itemurl,b.settings.ranking.sid,k),imageele:"",imageurl:b.editImageurl(a.items[i].imageurl64,b.settings.reco.imagesize),imagealt:b.editItemname(a.items[i].itemname,b.settings.reco.omitname),imagetitle:b.editItemname(a.items[i].itemname,b.settings.reco.omitname),itemprice:b.editItemprice(a.items[i].price),greatersuffix:1===a.items[i].haspricerange?"\uff5e":""}))}return h.length<b.settings.common.recothreshold?(b.regImpressionCode(b.settings.common.impnodisp),
!1):(1===b.settings.common.rankingshuffle&&(h=b.shuffle(h)),b.props.reco.items[d]==c&&(b.props.reco.items[d]=[]),b.props.reco.items[d]=f.merge(b.props.reco.items[d],h),b.displayRecoData(d))}var e;b.status.isTimeout=!1;try{var g=b.props.ashiato.items[a],h=g.genreidlist.replace(/^\//,"").split("/"),i=b.settings.common.genrefilter.split(",");for(var j in i)if(-1!=f.inArray(i[j],h))return b.props.initialized=!0,b.props.reco.items[a].length>0?b.displayRecoData(a):b.displayRecoDefaultContents(),
b.props.requestPermission=!1,b.props.requestPermissionTimer=setTimeout(function(){b.props.requestPermission=!0},b.settings.common.requestwait),!1;h=h[b.settings.ranking.genrelayer],h===c&&(h=0),e=setTimeout(function(){b.status.isTimeout=!0,b.props.initialized||b.settings.common.showonnodata?b.displayRecoDefaultContents():b.displayDefaultContents()},b.settings.common.ajaxtimer),f.ajax({url:b.settings.ranking.url,cache:!0,dataType:"jsonp",data:{gid:h},jsonpCallback:"jsonp0123456789012",
scriptCharset:"euc-jp",timeout:b.settings.common.ajaxtimer,success:function(c){d(c,a)||(b.props.initialized||b.settings.common.showonnodata?b.displayRecoDefaultContents():b.displayDefaultContents())},error:function(a,c,d){b.props.initialized||b.settings.common.showonnodata?b.displayRecoDefaultContents():b.displayDefaultContents()}})}catch(a){return b.props.initialized||b.settings.common.showonnodata?b.displayRecoDefaultContents():b.displayDefaultContents(),!1}return!0},
displayRecoData:function(a,c){function d(a){var d;c&&-1===f.inArray(a,b.props.reco.visitedPages)&&(d=f.extend({},c),d.cpData.rec_rpp=a,b.sendToRAT(d),b.props.reco.visitedPages.push(a))}return 0!==b.eobj.reco.proto.length&&(b.props.reco.proto.width=b.eobj.reco.proto.outerWidth(),b.props.reco.proto.height=b.eobj.reco.proto.outerHeight(),b.props.reco.proto.html=b.eobj.reco.proto.html(),""!=b.props.reco.proto.html&&(b.eobj.reco.proto.hide(),b.eobj.reco.itemsDisplay.empty(),
b.eobj.reco.prevButton.find("a").unbind("click"),b.eobj.reco.nextButton.find("a").unbind("click"),b.eobj.reco.altContents.hide(),b.eobj.common.loading.hide(),b.eobj.common.recoSlider.show(),b.regImpressionCode(b.settings.common.impdisp),b.eobj.reco.itemsDisplay.RJS_Slideshow(b,{settings:b.settings.reco,itemPrototype:b.props.reco.proto,eobj:b.eobj.reco,items:b.props.reco.items[a],events:{beforeFirstRender:function(a,b){b.props.initialized=!0,b.eobj.reco.itemsDisplay.show()},
afterFirstRender:function(a,b){var c=b.eobj.reco.itemsDisplay.children().first().find(">div").length;b.props.requestPermission=!1,b.props.requestPermissionTimer=setTimeout(b.settings.common.requestwait),d("[0, "+c+"]")},afterSlide:function(a,b){d("["+a+", "+(a+b.eobj.reco.itemsDisplay.children().first().find(">div").length)+"]"),e()}}}),e(),!0))},regImpressionCode:function(d){return a[b.settings.common.impvar]===c||""==d?"":a[b.settings.common.impvar]=d},
sendToRAT:function(b){var c={accountId:470,options:["url","ua"],cpData:{sid:"ichiba",evn:"reco"}};b&&(c=f.extend(!0,{},c,b)),f(document).ready(function(){a.RAT&&"function"==typeof RAT.addCustomEvent&&a.RAT.addCustomEvent(c)})},shuffle:function(a){for(var b=Array.apply(null,a),c=b.length;c;){var d=Math.floor(Math.random()*c),e=b[--c];b[c]=b[d],b[d]=e}return b},endsWith:editItemname:function(a,b){
return a=f.RJS_Helpers.omitStr(a,b,"\u2026"),f.browser.msie||(a=a.split("").join(String.fromCharCode(8203))),a},editItemprice:function(a){return""!=a&&a!==c?String(a).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):a},editImageurl:function(a,b){return""!=a&&(a=f.RJS_Helpers.urlParameter(a,{_ex:b.replace(":","x"),fitin:b.replace("x",":")})),a},editR2P2Imageurl:function(a,b){var d="https://thumbnail.image.rakuten.co.jp/"+a;return""==a||b===c?d:f.RJS_Helpers.urlParameter(d,{_ex:b.replace(":","x"),
fitin:b.replace("x",":")})},editItemurl:function(a,b,c){return""!=b&&(a=c?f.RJS_Helpers.urlR2Parameter(a,{"s-id":b},!1):f.RJS_Helpers.urlParameter(a,{"s-id":b},!1)),a},hasPriceRange:function(a){return"item_price_min3"===a.item_price_base_field&&a.item_price_min3<a.item_price_max3||"item_price_min2"===a.item_price_base_field&&a.item_price_min2<a.item_price_max2}})}).initialize()}}}(this,window.jQuery);
