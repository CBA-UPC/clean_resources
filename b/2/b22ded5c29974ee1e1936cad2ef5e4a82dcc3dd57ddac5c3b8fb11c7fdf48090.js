(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9713],{13421:57006:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return S},default:);var s,a,i=n(52322),r=n(8583),c=n(2784),l=n(52934),o=n(47330),d=n(1422),u=n(45152),m=n(6676),h=n.n(m),g=n(56958),f=n(91077),x=n(18318);(s=a||(a={})).NewLead="NEW LEAD",s.NewAccount="NEW ACCOUNT";let getDefaultSlackRule=()=>({id:h()(),trigger:"NEW LEAD",channelId:void 0,connectedProjects:[]});function SlackRuleCard(e){let{rule:t,onChange:n,channelsOptions:s,onDelete:a,triggerOptions:c}=e;return(0,i.jsxs)("div",{className:"flex items-center justify-between space-x-2 rounded border-slate-500 p-3",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(x.Z,{items:c,renderSelectedIcon:()=>(0,i.jsx)(f.H,{className:"mr-2"}),selected:t.trigger,onChange:e=>{n&&n({...t,trigger:e.id})}}),(0,i.jsx)(r.XCv,{}),(0,i.jsx)(x.Z,{items:s,selected:t.channelId,onChange:e=>{n&&n({...t,channelId:e.id})},renderSelectedIcon:()=>(0,i.jsx)(r.js3,{className:"mr-2"})})]}),(0,i.jsx)("button",{onClick:className:"px-2",children:(0,i.jsx)(r.XHJ,{width:".75em",height:".75em"})})]})}var p=n(35196),j=n(34126);n(83122);var N=n(13077);n(34406);let storeSlackInfo=b=["channels:read","chat:write","channels:join","groups:read"];var w=n(64766),k=n(170);let v={name:"Slack",screenshot:"https://www.navattic.com/img/integrations/slack.jpg",allowTestConnection:!0,webhookFormat:o.M8.Slack,Logo:ConnectComponent:function(e){let{clientId:t,integrationSettings:n}=e,{workspace:s}=(0,u.cF)(),{Logo:a}=n;return(0,i.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),e.stopPropagation(),!t)return;let n=storeSlackInfo({workspaceSlug:s.slug});window.location.href=function(e){let{clientId:t,scopes:n,userScopes:s,state:a}=e,i=n.join(","),r=(null==s?void 0:s.join(","))||"";return"https://slack.com/oauth/v2/authorize?".concat(j.stringify({client_id:t,scope:i,user_scope:r,state:a}))}({clientId:t,scopes:b,state:n})},children:[(0,i.jsx)("h4",{className:"mb-1 text-base font-semibold",children:"Connect Navattic to Slack"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Slack will prompt you to add the Navattic app to your workspace."}),(0,i.jsxs)("button",{className:"btn-white mt-7 bg-white font-medium shadow",type:"submit",children:[(0,i.jsx)(a,{className:"mr-2 h-4 w-4"}),"Connect to Slack"]})]})},ConfigurationComponent:function(e){let{webhook:t,integrationSettings:n}=e,[,s]=(0,l.I)(),{workspace:a}=(0,u.cF)(),[m,h]=(0,c.useState)([]),f=(0,u.NK)(a,o.TT.Enrichment),{data:x}=function(e){let[t,n]=(0,c.useState)([]),[s,a]=(0,c.useState)(!1),[i,r]=(0,c.useState)(null);return(0,c.useEffect)(()=>{e&&(a(!0),r(null),fetch("/api/integration/slack/channels?id=".concat(e)).then(.then(.catch(r))},[e]),{data:t,fetching:s,error:i}}(t.id);(0,c.useEffect)(()=>{if(t.config){let e=JSON.parse(t.config||"{}");h(e.rules)}},[t.config,t.id]);let p=(0,c.useMemo)(()=>{let e=[{id:"NEW LEAD",name:"New Lead"}];return f&&e.push({id:"NEW ACCOUNT",name:"New Account"}),e},[f]);return(0,i.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,i.jsx)("div",{className:"w-full overflow-hidden rounded-md border bg-gray-50 text-sm",children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"mb-1 flex items-center gap-x-2 border-b bg-white px-3 py-2 font-medium",children:[(0,i.jsx)("div",{className:"rounded border bg-gray-100 px-1 py-[2px] font-semibold leading-none  text-gray-600",children:"#"}),"Add the Navattic Slack App to your Slack channel"]}),(0,i.jsxs)("div",{className:"px-3 py-2",children:["In Slack, go to ",(0,i.jsx)("b",{children:"Channel Settings"})," → click ",(0,i.jsx)("b",{children:"Integrations"})," → click"," ",(0,i.jsx)("b",{children:"Add Apps"})," → select ",(0,i.jsx)("b",{children:"Navattic"}),"."]})]})}),(0,i.jsxs)("div",{className:"mt-4 rounded border",children:[(0,i.jsxs)("div",{className:"flex items-center px-3 py-2 text-base font-medium leading-none",children:["Rule Destinations",(0,i.jsx)("div",{className:"ml-3 rounded border bg-gray-50 px-1 text-[13px] leading-5 text-gray-600",children:"Channel"})]}),(0,i.jsxs)("ul",{role:"list",className:"divide-y divide-gray-200 border-t border-gray-200",children:[m.map(e=>(0,i.jsx)(SlackRuleCard,{rule:e,channelsOptions:x,onChange?t:n)),triggerOptions:p,onD==e))},e.id)),(0,i.jsx)("div",{className:"flex items-center justify-between bg-gray-50 px-2 py-2",children:(0,i.jsxs)("button",{onClick:function(){h([...m,getDefaultSlackRule()])},type:"button",className:"btn-white bg-white text-sm font-medium",children:[(0,i.jsx)(r.pOD,{className:"mr-1 h-3 w-3","aria-hidden":"true"}),"Add Rule"]})})]})]}),(0,i.jsxs)("button",{onClick:function(){return g.A.promise(s({id:t.id,config:JSON.stringify({rules:m})}).then(e=>{if(null==e?void 0:e.error)throw Error("Error saving: ".concat((0,d.q)(e.error.message)))}),{success:"Saved Slack configuration!",loading:"Saving Slack configuration...",at(e)})},className:"btn-white mt-7 w-full justify-center bg-white font-medium shadow",children:[(0,i.jsx)(n.Logo,{className:"mr-2"}),"Save configuration"]})]})}};function SlackIntegrationPage(e){return(0,i.jsx)(w.Z,{integrationSettings:v,clientId:e.clientId})}SlackIntegrationPage.getL:e})};var S=!0,y=SlackIntegrationPage}},function(e){e.O(0,[8934,3211,696,8426,3265,1617,4637,5837,9623,3327,4054,5306,7330,8583,6870,7156,6456,170,4766,9774,2888421)}),_N_E=e.O()}]);
//# sourceMappingURL=slack-77dc56af9ab32b87.js.map