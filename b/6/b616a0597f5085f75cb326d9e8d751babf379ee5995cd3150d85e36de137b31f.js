"use strict";(self.webpackChunkregistration=self.webpackChunkregistration||[]).push([[130],{4326:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(5861),o=r(4687),a=r.n(o),c=r(1890),i=r.n(c),s=r(417),u=r(3929);const d=(0,n.Z)(a().mark((function e(){var t,r,n,o,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i().getAsyncToken();case 2:return t=e.sent,r=t.networkId,e.next=6,(0,s.default)("me/network-token/".concat(r),{method:"POST",body:JSON.stringify({spot_id:u.D5})});case 6:return n=e.sent,o=n.network_id,c=n.token,i().setToken(c,o),e.abrupt("return",{token:c});case 11:case"end":return e.stop()}}),e)})))},3329:(e,t,r)=>{r.r(t),r.d(t,{LoginMethod:()=>n,default:()=>h});var n,o=r(5861),a=r(4687),c=r.n(a),i=r(1890),s=r.n(i),u=r(4543),d=r.n(u),p=r(4984),l=r(417),f=r(2832),g=r(3929),m=r(6276),v=r(3527);!n||(n={}));const h=function(){var e=(0,o.Z)(c().mark((function e(t,r){var n,o,a,u,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().getAsyncUser();case 2:if(n=e.sent,e.prev=3,!g.or&&!g.s1){e.next=10;break}return e.next=7,d()("v1.0.0/authentication/current-user",{method:"POST",headers:{"x-spot-id":g.D5,"x-real-user-mode":"true"}},{overrideRecoveryMode:!0});case 7:o=e.sent,e.next=13;break;case 10:return e.next=12,(0,l.default)("me/login",{method:"POST",body:JSON.stringify({spot_id:g.D5})});case 12:o=e.sent;case 13:return(a=(0,i.parseUser)(o)).isRegistered&&r&&(m.Z.send("login_success"),(0,p.dispatchSpotimEvent)("spot-im-post-login",{currentUser:{email:a.email||"",username:a.username||""}}),(0,f.trackEvent)({source:"conversation",spot_id:g.D5,post_id:g.F,type:"user-identified",native:r,target_type:n.id,is_registered:!0,segment:(0,p.getLocation)().origin,user_id:a.id}),t&&(u={userId:a.id,displayName:a.displayName,imageId:a.imageId,social:t},g.Nv||(u.email=a.email),h=(0,v.oF)(JSON.stringify(u)),localStorage.setItem(g.nc,h))),e.abrupt("return",a);case 18:throw e.prev=18,e.t0=e.catch(3),m.Z.error("login",e.t0),new Error("Login failed due to with error: ".concat(e.t0));case 22:case"end":return e.stop()}}),e,null,[[3,18]])})));return ()},2741:(e,t,r)=>{r.r(t),r.d(t,{default:()=>S});var n=r(4942),o=r(5861),a=r(4687),c=r.n(a),i=r(1890),s=r.n(i),u=r(4543),d=r.n(u),p=r(417),l=r(2832),f=r(4984),g=r(3929),m=r(6276),v=r(2e3),h=r(4326),w=r(3329),y=r(5945);r k=(0,r(4233).D)("Registration");const S=function(){var e=(0,o.Z)(c().mark((function e(t){var r,n,o,a,u,b,S,x;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.source,n=t.tokenRecoveryMode,o=t.isLogoutFlow,a=void 0!==o&&o,e.prev=1,k("Logout started"),e.next=5,s().getAsyncUser();case 5:if((u=e.sent).isRegistered){e.next=9;break}return e.abrupt("return",u);case 9:if(!g.or){e.next=16;break}return e.next=12,d()("v1.0.0/authentication/logout",{method:"POST",headers:{"x-spot-id":g.D5}});case 12:b=e.sent,u=(0,i.parseUser)(b),e.next=26;break;case 16:return e.next=18,(0,p.default)("me/logout",{method:"POST",body:JSON.stringify({spot_id:g.D5})});case 18:return e.next=20,(0,h.Z)();case 20:return S=e.sent,x=S.token,s().setToken(x),e.next=25,(0,w.default)();case 25:u=e.sent;case 26:if(g.c&&a&&(0,f.dispatchSpotimEvent)("spot-im-sso-complete",{type:"logout"}),n){e.next=31;break}return(0,y.MP)(),e.next=31,(0,v.l)(O(O({},u),{},{isSuperAdmin:!1}));case 31:return k("Logout succeed, new current user is: ",u),(0,l.trackEvent)({source:r,spot_id:g.D5,post_id:g.F,type:"logout-clicked",item_type:"logout",segment:"success"}),e.abrupt("return",u);case 36:return e.prev=36,e.t0=e.catch(1),m.Z.error("logout",e.t0),k("Logout failed with: ",e.t0),(0,l.trackEvent)({source:r,spot_id:g.D5,post_id:g.F,type:"logout-clicked",item_type:"logout",segment:"error"}),e.abrupt("return",new Error("Logout failed due to with error: ".concat(e.t0)));case 42:case"end":return e.stop()}}),e,null,[[1,36]])})));return function(t){return e.apply(this,arguments)}}()},4233:(e,t,r)=>{r.d(t,{D:()=>i});var n=r(4984),o="SPOTIM_DEBUG_API",a=null;function c(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=console).log.apply(t,["%cSpot.IM ".concat(e),"background: #307fe2; color: white;"].concat(n))}function i(e){var t=function(){try{if(null===a){var e=new URLSearchParams((0,n.getLocation)().search);if((a=e.get(o.toLowerCase()))||(a=window.SPOTIM_DEBUG_API),!a)try{a=window.localStorage.getItem(o)}catch(e){}a||(a=""),a=a.split(",").map(()}return a}catch(e){return[]}}();return t.indexOf("*")>-1||t.indexOf(e.toLowerCase())>-1?c.bind(null,e):},5945:(e,t,r)=>{r.d(t,{BR:()=>s,MP:()=>u,fR:()=>i});var n=r(6276),o=r(4233),a="OWֹֹ_EXTERNAL_USER_ID",c=(0,o.D)("TTH"),i=function(e){var t;try{t=localStorage.getItem(a)||""}catch(e){var r="TTH - cannot get ".concat(a," from local storage: ").concat(e);c(r),n.Z.error("startTTH",r)}return String(e)!==String(t)},s=function(e){try{localStorage.setItem(a,e)}catch(e){var t="TTH - cannot set ".concat(a," in local storage: ").concat(e);c(t),n.Z.error("startTTH",t)}},u=function(){try{localStorage.removeItem(a)}catch(t){var e="TTH - cannot set ".concat(a," in local storage: ").concat(t);c(e),n.Z.error("startTTH",e)}}},3527:(e,t,r)=>{r.d(t,{FB:()=>c,NV:()=>u,TD:()=>i,fm:()=>d,lZ:()=>a,oF:()=>s,tq:()=>o});var n=r(1002}var a=o(),c=("object"===("undefined"==typeof window?"undefined":(0,n.Z)(window))&&/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent}}var },},}},2e3:(e,t,r)=>{r.d(t,{u});var n=r(5861),o=r(4687),a=r.n(o),c=r(1890),i=r.n(c),s=r(3929),u=function(){var e=(0,n.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout}),s.NK)}));case 2:case"end":return e.stop()}}),e)})));retur}}()}}]);
//# sourceMappingURL=registration-logout-bundle.js.map