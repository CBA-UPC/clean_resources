;
(self.AMP=self.AMP||[]).push({m:1,v:"2312191621000",n:"amp-autocomplete",ev:"0.1",l:!0,f:function(t,e){(()=>{var e,i,s,n=Object.create,r=Object.defineProperty,o=Object.getOwnPropertyDescriptor,h=Object.getOwnPropertyNames,u=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,l=(e={"third_party/fuzzysearch/index.js"(t,e){e.exports=function(t,e){var i=e.length,s=t.length;if(s>i)return!1;if(s===i&&t===e)return!0;t:for(var n=0,r=0;n<s;n++){for(var o=t.charCodeAt(n);r<i;)if(e.charCodeAt(r++)===o)continue t;return!1}return!0}}},;isArray:f}=Array;ar{hasOwnProperty:A,toString:b}=Object.prototype;tion x(t,e,i,s,n,r,o,h,u,a,l){return t} y=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;elf.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var M=self.__AMP_LOG;t,e,i,s){const n={detail:i};return Object.assign(n,s),new t.CustomEvent(e,n)}ar H,q=((),J=new Set(["c","v","a","ad"]),W="__amp_source_origin",B=function G(t,e){return H||(H=self.document.createElement("a")),H,t)}unction Q(t,e,i,s){return function(t,e,i){if(!e)return t;const s=t.split("#",2),n=s[0].split("?",2);let r=n[0]+(n[1]?i?`?${e}&${n[1]}`:`?${n[1]}&${e}`:`?${e}`);return r+=s[1]?`#${s[1]}`:"",r}(t,K(e,i),s)}var X=["GET","POST"],Y=[f,;ar tt=((t,e,i)=>(i=null!=t?n(u(t)):{},((t&&t.__esModule?i:r(i,"default",{value:t,enumerable:!0}),t)))(l()),et={NONE:0,OPT_IN:1,ALL:2};function it(t,e,i,s){const n=((t);return(i>=et.OPT_IN?n.expandUrlAsync(e):Promise.resolve(e)).then((e=>{if(i===et.OPT_IN){const e=n.collectDisallowedVarsSync(t);if(e.length>0)throw O().createError(`URL variable substitutions in CORS fetches from dynamic URLs (e.g. via amp-bind) require opt-in. Please add data-amp-replace="${e.join(" ")}" to the <${t.tagName}> element. See https://bit.ly/amp-var-subs.`)}const r={};return t.hasAttribute("credentials")&&(r.credentials=t.getAttribute("credentials")),s&&(r.cache="reload"),{"xhrUrl":e,"fetchOpt":r}}))}var st="amp-autocomplete",nt="none",rt=class extends t.BaseElement{constructor(t){super(t),this.pn=null,this.I4=null,this.R4=null,this.y4="",this.Cj="",this.O4=1,this.j4=null,this.S4=!1,this.U4=!1,this.F4=!1,this.C4="",this.D4="",this.N4=-1,this.z4=null,this.HF=t.id?t.id:Math.floor(100*Math.random()),this.Tb=null,this.GF=!1,this.L4=null,this.tM=null,this.H4=!1,this.getSsrTemplateHelper=function(t){let e=!1,i=null,s=t;return(...t)=>(e||(i=s.apply(self,t),e=!0,s=null),i)}((()=>new class{sEnabledssertTrustedViewer(t){return this.Fe.isTrustedViewer().then(()}ssr(t,e,i=null,s={}){let n;return i||(n=this.tM.maybeFindTemplate(t)),this.assertTrustedViewer(t).then((()=>this.Fe.sendMessageAwaitResponse("viewerRenderTemplate",this.sJ(e,n,i,s))))}applySsrOrCsrTemplate(t,e){let i;return this.isEnabled()?(S("string"==typeof e.html,"Skipping template rendering due to failed fetch"),i=this.assertTrustedViewer(t).then(()):i=f(e)?this.tM.findAndRenderTemplateArray(t,e):this.tM.findAndRenderTemplate(t,e),i}sJ(t,e,i,s={}){const n={"type":this.eJ},r=i&&i.successTemplate?i.successTemplate:e;r&&(n.successTemplate={"type":"amp-mustache","payload":r.innerHTML});const o=i&&i.errorTemplate?i.errorTemplate:null;return o&&(n.errorTemplate={"type":"amp-mustache","payload":o.innerHTML}),s&&Object.assign(n,s),{"originalRequest":Z(t.xhrUrl,t.fetchOpt),"ampComponent":n}}}(st,k(this.element,"viewer"),this.tM))),this.q4=!1,this.tc=null,this.Uu=null,this.J4=!1,this.W4=t.id?t.id:Math.floor(100*Math.random())+"_AMP_content_"}buildCallback(){this.tM=k(this.element,"templates"),this.tc=F(this.element,"action"),this.Uu=(t=>k(this.element,"viewport"))(),this.R4=this.B4();const t=this.R4.getAttribute("type");S(!this.R4.hasAttribute("type")||"text"===t||"search"===t,'%s requires the "type" attribute to be "text" or "search" if present on <input>. %s',st,this.element),this.pn=this.G4(),this.D4=this.element.getAttribute("query"),this.C4=this.element.getAttribute("src");const e=this.element.querySelector('script[type="application/json"]');e?this.I4=this.K4(e):this.element.hasAttribute("src"),this.R4.setAttribute("dir","auto"),this.R4.setAttribute("aria-autocomplete","both"),this.R4.setAttribute("role","textbox"),this.R4.setAttribute("aria-controls",this.W4),"INPUT"===this.R4.tagName&&(this.element.setAttribute("role","combobox"),this.R4.setAttribute("aria-multiline","false")),this.element.setAttribute("aria-haspopup","listbox"),this.element.setAttribute("aria-expanded","false"),this.element.setAttribute("aria-owns",this.W4);const i=this.Q4();var s;i&&i.hasAttribute("autocomplete")&&(this.L4=i.getAttribute("autocomplete")),this.q4=this.getSsrTemplateHelper().isEnabled(),this.H4=this.tM.hasTemplate(this.element,"template, script[template]"),this.q4&&(S(this.C4,'%s requires data to be provided via "src" attribute for server-side rendering. %s',st,this.element),S(this.H4,`${st} should provide a <template> or <script type="plain/text"> element.`),S(!this.element.hasAttribute("filter"),`${st} does not support client-side filter when server-side render is required.`)),this.Cj=this.element.getAttribute("filter")||nt,S("substring"===(s=this.Cj)||"prefix"===s||"token-prefix"===s||"fuzzy"===s||"custom"===s||"none"===s,"Unexpected filter: %s. %s",this.Cj,this.element),this.O4=this.element.hasAttribute("min-characters")?parseInt(this.element.getAttribute("min-characters"),10):1,this.element.hasAttribute("max-entries");const n=this.element.getAttribute("max-items")||this.element.getAttribute("max-entries");return this.j4=n?parseInt(n,10):null,this.S4=this.pn.shouldSuggestFirst(),this.F4=this.element.hasAttribute("highlight-user-entry"),this.Tb=this.rJ(),this.element.appendChild(this.Tb),this.mT(),c()}mT(){this.R4.addEventListener("touchstart",(()=>{this.X4()}),{passive:!0}),this.R4.addEventListener("input",(()=>{this.Y4()})),this.R4.addEventListener("keydown",(t=>{this.oH(t)})),this.R4.addEventListener("focus",(()=>{this.X4().then((()=>{const t=this.pn.shouldShowOnFocus();this.Z4(t)}))})),this.R4.addEventListener("blur",(()=>{this.Z4(!1)})),this.Tb.addEventListener("mousedown",(t=>{this._3(t)}))}B4(){const t=this.element.querySelectorAll("input,textarea");return S(1==t.length,"%s should contain exactly one <input> or <textarea> descendant %s",st,this.element),t[0]}4(){return this.element.hasAttribute("inline")?new class{constructor(t){const{element:e}=t;this.yf=e,this.Ee=this.yf.getAttribute("inline"),S(""!==this.Ee,'Empty value for the "inline" attr is unsupported, %s. %s',"amp-autocomplete",e),S(""!==this.Ee,"AutocompleteBindingInline does not support an empty value in the constructor."),this.A3=null;const i=this.Ee.replace(/([()[{*+.$^\\|?])/g,"\\$1"),s=`((${i}|^${i})(\\w+)?)`;this.b3=new RegExp(s,"gm")}shouldAutocomplete(t){const e=this.P3(this.b3,t);return this.A3=e,!!e}P3(t,e){if(!t)return null;const{selectionStart:i,value:s}=e;let n,r;for(;null!==(n=t.exec(s))&&!(n[0].length+g(n,"index")>i);)r=n;return!r||r[0].length+g(r,"index")<i?null:r}getUserInputForUpdate(t){return this.A3&&this.A3[0]?this.A3[0].slice(this.Ee.length):""}getUserInputForUpdateWithSelection(t,e,i){if(!this.A3)return e.value;let s=e.selectionStart;const n=Number(g(this.A3,"index")),r=i.length;s>=n+r&&(s-=r),E(e),s=s+t.length+1,e.setSelectionRange(s,s),this.A3=null;const{value:o}=e;return o.slice(0,n+this.Ee.length)+t+" "+o.slice(n+this.Ee.length+r)}houldSuggestFirst(){return this.yf.hasAttribute("suggest-first")}shouldShowOnFocus(){return!1}his):new class{constructor(t){const{element:e}=t;this.S4=e.hasAttribute("suggest-first");const i=e.getAttribute("filter");this.S4&&"prefix"!==i&&(this.S4=!1),this.v3=e.hasAttribute("submit-on-enter")}yActiveItemInInput(t,e,i){t.value=e,this.S4&&t.setSelectionRange(i.length,e.length)}removeSelectionHighlightinghouldPreventDefaultOnEnter(this)}K4(t){const e=I(R(t.textContent,(t=>{throw t})),this.element.getAttribute("items")||"items");return e?O().assertArray(e):[]}g3(){const t=this.getAmpDoc(),e=et.ALL,i=this.element.getAttribute("items")||"items";return this.I3(),this.q4?it(this.element,this.element.getAttribute("src"),e,!1).then((t=>{var e,s,n;t.xhrUrl=(e=this.win,s=t.xhrUrl,n=t.fetchOpt,x("string"==typeof s),!1!==n.ampCors&&(s=function(t,e){!function(t){const e=G(t).search);S(!(W in e),"Source origin is not allowed in %s",t)}(e);const i=function(t){return G(function(t){if(!t=B(t)))return t.href;const e=t.pathname.split("/"),i=e[1];S(J.has(i),"Unknown path prefix in url %s",t.href);const s=e[2],n="s"==s?"https://"+decodeURIComponent(e[3]):"http://"+decodeURIComponent(s);return S(n.indexOf(".")>0,"Expected a . in origin %s",n),e.splice(1,"s"==s?3:2),n+e.join("/")+function(t,e){if(!t||"?"==t)return"";const i=new RegExp("[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\\b[^&]*","g"),s=t.replace(i,"").replace(/^[?&]/,"");return s?"?"+s:""}(t.search)+(t.hash||"")}(t)).origin}(t.location.href);return Q(e,W,i)}(e,s)),s),t.fetchOpt=this.win,t.xhrUrl,t.fetchOpt),function(t){const e=t,"application/json");if("POST"==e.method&&!L(e.body)){x(Y.some(()),e.headers["Content-Type"]=e.headers["Content-Type"]||"text/plain;charset=utf-8";const t=e.headers["Content-Type"];e.body="application/x-www-form-urlencoded"===t?function(t){const e=[];for(const s in t){let n=t[s];if(null!=n){n=f(i=n)?i:[i];for(let t=0;t<n.length;t++)e.push(K(s,n[t]))}}var i;return e.join("&")}(e.body):JSON.stringify(e.body)}}(t.fetchOpt);const r={"ampAutocompleteAttributes":{"items":i,"maxItems":this.j4}};return this.getSsrTemplateHelper().ssr(this.element,t,null,r)})):function(t,e,i={}){const{expr:s=".",refresh:n=!1,url:r=e.getAttribute("src"),urlReplacement:o=et.NONE,xssiPrefix:h}=i;!function(t,e,i="source"){var s;S(null!=t,"%s %s must be available",e,i),S("https:"==(s=B(s=t)).protocol||"localhost"==s.hostname||"127.0.0.1"==s.hostname||s.hostname,".localhost")||/^\/\//.test(t),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',e,i,t)}(r,e);const u=U(t.win,"batched-xhr");return it(e,r,o,n).then(().then((e=>{return(i=t.win,U(i,"xhr")).xssiJson(e,h);var i})).then(().catch((t=>{throw O().createError("failed fetching JSON data",t)}))}(t,this.element,{expr:i,urlReplacement:e}).catch(()}I3(){if(!this.D4)return;const t=this.x3(this.y4);this.element.setAttribute("src",t)}x3(t=""){return Q(this.C4,this.D4,t)}rJ(){const t=this.element.ownerDocument.createElement("div");return t.classList.add("i-amphtml-autocomplete-results"),this.R3()&&t.classList.add("i-amphtml-autocomplete-results-up"),t.setAttribute("role","listbox"),t.setAttribute("id",this.W4),T(t,!1),t}layoutCallback(){return this.R4.setAttribute("autocomplete","off"),this.element.hasAttribute("prefetch")&&this.X4(),this.E3(this.I4,this.y4)}mutatedAttributesCallback(t){const e=t.src;return null==e?c():"string"==typeof e?(this.C4=e,this.g3().then((t=>{this.I4=t||[],this.E3(this.I4,this.y4)}),(t=>{this.T3(t)}))):"object"==typeof e?(this.I4=e.items||[],this.E3(this.I4,this.y4)):void O().error(st,'Unexpected "src" type: '+e)}y3(t,e=""){const i=this.element.ownerDocument.createElement("div");i.classList.add("i-amphtml-autocomplete-item"),i.setAttribute("role","option"),i.setAttribute("data-value",t),i.setAttribute("dir","auto"),i.textContent=t;const s=i.childNodes[0],n=t.toLocaleLowerCase(),r=e.toLocaleLowerCase();if(this.F4&&e&&e.length<=t.length&&_(n,r)){const o=n.indexOf(r),h=this.element.ownerDocument.createElement("span");h.classList.add("autocomplete-partial"),h.appendChild(this.element.ownerDocument.createTextNode(t.slice(o,o+e.length)));const u=s.splitText(o);u.splitText(e.length),i.replaceChild(h,u)}return i}Y4(){return this.pn.shouldAutocomplete(this.R4)?this.w3():this.mutateElement(()}w3(){const t=0===this.y4.length&&1===this.R4.value.length;return this.y4=this.pn.getUserInputForUpdate(this.R4),(this.q4||this.D4?this.g3():Promise.resolve(this.I4)).then((e=>(this.I4=e,this.mutateElement((()=>{this.E3(this.I4,this.y4).then(()})))))}O3(t){this.V3(!0),this.S4&&(this.U4&&!t||this.j3(1),this.U4=!1)}_3(t){const e=t.target,i=this.S3(e),{selectedObject:s,selectedText:n}=this.U3(i);return this.mutateElement((()=>{this.F3(n,s)}))}E3(t,e=""){return this.M3(),!t||e.length<this.O4?c():this.q4?v(t,"html")?this.C3(t,this.Tb,e):c():this.D3(t,e)}D3(t,e){if(!t.length)return c();const i=this.N3(t,e).map((t=>{let e=t;return"object"==typeof t&&(e=m(m({},t),{},{objToJson:)),e}));return this.C3(i,this.Tb,e)}C3(t,e,i){let s=c();return this.z3(),this.H4?s=this.getSsrTemplateHelper().applySsrOrCsrTemplate(this.element,t).then((t=>{(f(t)?t:[t]).forEach((t=>{t.hasAttribute("data-disabled")?t.setAttribute("aria-disabled","true"):t.hasAttribute("data-value"),t.classList.add("i-amphtml-autocomplete-item"),t.setAttribute("role","option"),e.appendChild(t)}))})):t.forEach((t=>{S("string"==typeof t,"%s data must provide template for non-string items. %s",st,this.element),e.appendChild(this.y3(t,i))})),s}N3(t,e){if(this.Cj===nt)return this.L3(t);e=e.toLocaleLowerCase();const i=this.element.getAttribute("filter-value")||"value",s=t.filter((t=>{switch("object"==typeof t&&(t=I(t,i)),S("string"==typeof t,'%s data property "%s" must map to string type. %s',st,i,this.element),t=t.toLocaleLowerCase(),this.Cj){case"substring":return _(t,e);case"prefix":return t.startsWith(e);case"token-prefix":return this.H3(t,e);case"fuzzy":return(0,tt.default)(e,t);case"custom":throw new Error("Filter not yet supported: %s",this.Cj,this.element);default:throw new Error("Unexpected filter: %s",this.Cj,this.element)}}));return this.L3(s)}H3(t,e){if(""===e)return!0;const i=this.q3(t),s=this.q3(e),n=this.J3(i),r=s[s.length-1];s.splice(s.length-1,1);let o=!0;for(let t=0;t<s.length;t++){const e=s[t];if(""===e)continue;if(!v(n,e)){o=!1;break}const i=Number(g(n,e));i>1?n[e]=i-1:delete n[e]}const h=Object.keys(n);return o&&(""===r||h.some(())}q33(t){const e=P();return t.forEach((t=>{const i=v(e,t)?g(e,t)+1:1;e[t]=i})),e}L3(t){return this.j4&&this.j4<t.length&&(t=t.slice(0,this.j4)),t}V3(t){this.R4.setAttribute("aria-expanded",t),T(this.Tb,t)}Z4(t){const e=this.Q4();e&&(t?e.setAttribute("autocomplete","off"):this.L4?e.setAttribute("autocomplete",this.L4):e.removeAttribute("autocomplete"));let i=!1;return this.measureMutateElement((()=>{i=this.R3()}),(()=>{t||(this.y4=this.R4.value,this.E3(this.I4,this.y4),this.z3()),this.W3(i),this.V3(t)}))}X4(){return this.J4||!this.element.hasAttribute("src")?c():(this.J4=!0,this.g3().then((,())}3(){const t=this.Uu.getHeight()||0;return this.R4.getBoundingClientRect().top>t/2}B3(){return!this.Tb.hasAttribute("hidden")&&this.Tb.children.length>0}S3(t){return null===t?null:t.classList.contains("i-amphtml-autocomplete-item")?t:this.S3(t.parentElement)}U3(t){if(null===t||t.hasAttribute("data-disabled"))return{selectedObject:null,selectedText:null};const e=this.G3(t);return this.K3(e),{selectedObject:this.Q3(t),selectedText:e}}K3(t){this.R4.value=this.pn.getUserInputForUpdateWithSelection(t,this.R4,this.y4),this.y4=this.pn.getUserInputForUpdate(this.R4)}G3(t){return t.getAttribute("data-value")||t.textContent||""}Q3(t){return t.hasAttribute("data-json")?R(t.getAttribute("data-json"),():null}F3(t,e){null!==t&&(this.X3(t,e),this.M3(),this.V3(!1))}X3(t,e){const i=m({value:t},e&&{valueAsObject:e}),s=z(this.win,"amp-autocomplete.select",i);this.tc.trigger(this.element,"select",s,3);const n=z(this.win,"change",i,{bubbles:!0});this.R4.dispatchEvent(n)}j3(t){if(0===t||!this.B3()||this.GF)return c();const e=-1===this.N4&&t<0?t:this.N4+t,i=this.Y3();if(0===i.length)return c();const s=(n=e,r=i.length,n>0&&r>0?n%r:(n%r+r)%r);var n,r;const o=i[s],h=o.getAttribute("data-value");let u,a;return this.pn.displayActiveItemInInput(this.R4,h,this.y4),this.measureMutateElement((()=>{const{offsetHeight:e,offsetTop:i}=o,{offsetHeight:s,scrollTop:n}=this.Tb;u=n>i||n+s<i+e,a=t>0?i+e-s:i}),(()=>{u&&(this.Tb.scrollTop=a),this.z3(),o.classList.add("i-amphtml-autocomplete-item-active"),o.setAttribute("aria-selected","true");let t=o.getAttribute("id");t||(t=this.HF+"_AMP_content_"+s,o.setAttribute("id",t)),this.R4.setAttribute("aria-activedescendant",t),this.N4=s,this.z4=o,E(this.z4)}))}33(){this.z4&&(this.z4.classList.toggle("i-amphtml-autocomplete-item-active",!1),this.z4.removeAttribute("aria-selected"),"autocomplete-selected"===this.z4.getAttribute("id")&&this.z4.removeAttribute("id"),this.R4.removeAttribute("aria-activedescendent"),this.z4=null,this.N4=-1)}M3(){this.GF=!1,this.Tb)}oH(t){switch(t.key){case"ArrowDown":return t.preventDefault(),this.B3()?this.N4===this.Y3().length-1?(this.Z3(),c()):this.j3(1):this.mutateElement((()=>{this.E3(this.I4,this.y4),this.V3(!0)}));case"ArrowUp":return t.preventDefault(),0===this.N4?(this.Z3(),c()):this.j3(-1);case"Enter":const e=this.pn.shouldPreventDefaultOnEnter(!!this.z4);if(this.B3()&&e&&t.preventDefault(),this.pn.removeSelectionHighlighting(this.R4),this.B3()&&this.z4){const{selectedObject:t,selectedText:e}=this.U3(this.z4);return this.mutateElement(()}return this.mutateElement(();case"Escape":return this.mutateElement((()=>{this.GF||(t.preventDefault(),this.Z3(),this.V3(!1))}));case"Tab":if(this.B3()&&this.z4){t.preventDefault();const{selectedObject:e,selectedText:i}=this.U3(this.z4);return this.mutateElement(()}return c();case"Backspace":return this.U4=this.S4,c();default:return c()}}T3(t){if(!this.GF){if(this.M3(),!this.getFallback())throw t;this.GF=!0,this.toggleFallback(!0)}};t.registerElement(st,rt,"amp-autocomplete,amp-autocomplete>input,amp-autocomplete>textarea{font-family:sans-serif}amp-autocomplete>input,amp-autocomplete>textarea{border-radius:4px;box-sizing:border-box}.i-amphtml-autocomplete-results{position:absolute;top:100%;width:calc(100% + 1rem);min-width:calc(2em + 2rem);max-height:40vh;margin-top:.5rem;margin-left:-.5rem;border-radius:4px;overflow-y:auto;overflow-x:hidden;background-color:#fff;box-shadow:0px 2px 4px 0px rgba(0,0,0,.5);z-index:10}.i-amphtml-autocomplete-results-up{top:auto;bottom:100%;margin-bottom:.5rem}.i-amphtml-autocomplete-item{position:relative;padding:.5rem 1rem;cursor:pointer}.i-amphtml-autocomplete-item:first-child{border-radius:4px 4px 0px 0px}.i-amphtml-autocomplete-item:nth-last-child(2){border-radius:0px 0px 4px 4px}.i-amphtml-autocomplete-item-active:not([data-disabled]),.i-amphtml-autocomplete-item:hover:not([data-disabled]){background-color:rgba(0,0,0,.15)}.i-amphtml-autocomplete-item[data-disabled]{color:rgba(0,0,0,.33)}\n/*# sourceURL=/extensions/amp-autocomplete/0.1/amp-autocomplete.css*/")})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-autocomplete-0.1.mjs.map