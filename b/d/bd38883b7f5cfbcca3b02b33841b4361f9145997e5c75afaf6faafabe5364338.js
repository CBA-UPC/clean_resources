/*! For license information please see 107.cf7d87eba799a309a454.chunk.v7.js.LICENSE.txt */
(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[107],{"/Oio":BOsL:function(e,t,r){"use strict";r.r(t),r.d(t,"getToken",(function(){return ho})),r.d(t,"useInitializeAuthStateHandlers",(function(){return To})),r.d(t,"initializeMsalWithBroker",(function(){return lo}));var n={};r.r(n),r.d(n,"BrowserCacheManager",(function(){return Nt})),r.d(n,"StandardInteractionClient",(function(){return Cr})),r.d(n,"RedirectClient",(function(){return Ar})),r.d(n,"PopupClient",(function(){return Pr})),r.d(n,"SilentIframeClient",(function(){return Ur})),r.d(n,"SilentCacheClient",(function(){return kr})),r.d(n,"SilentRefreshClient",(function(){return Hr})),r.d(n,"NativeInteractionClient",(function(){return Sr})),r.d(n,"RedirectHandler",(function(){return Er})),r.d(n,"EventHandler",(function(){return Br})),r.d(n,"NativeMessageHandler",(function(){return Rr})),r.d(n,"BrowserConstants",(function(){return Z})),r.d(n,"TemporaryCacheKeys",(function(){return Q})),r.d(n,"CryptoOps",(function(){return an})),r.d(n,"NativeAuthError",(function(){return Ir})),r.d(n,"BrowserPerformanceClient",(function(){return un})),r.d(n,"BrowserPerformanceMeasurement",(function(){return cn}));var o=r("QjXU"),i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function a(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function c(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function u(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}ar d,h,p,f,g,m={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",REGIONAL_AUTH_NON_MSI_QUERY_STRING:"allowestsrnonmsi=true",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},v=[m.OPENID_SCOPE,m.PROFILE_SCOPE,m.OFFLINE_ACCESS_SCOPE],y=l(v,[m.EMAIL_SCOPE]);!function(e){e.CONTENT_TYPE="Content-Type",e.RETRY_AFTER="Retry-After",e.CCS_HEADER="X-AnchorMailbox",e.WWWAuthenticate="WWW-Authenticate",e.AuthenticationInfo="Authentication-Info",e.X_MS_REQUEST_ID="x-ms-request-id",e.X_MS_HTTP_VERSION="x-ms-httpver"}(d||(d={})),function(e){e.ID_TOKEN="idtoken",e.CLIENT_INFO="client.info",e.ADAL_ID_TOKEN="adal.idtoken",e.ERROR="error",e.ERROR_DESC="error.description",e.ACTIVE_ACCOUNT="active-account",e.ACTIVE_ACCOUNT_FILTERS="active-account-filters"}(h||(h={})),function(e){e.COMMON="common",e.ORGANIZATIONS="organizations",e.CONSUMERS="consumers"}(p||(p={})),f||(f={})),function(e){e.ACCESS_TOKEN="access_token",e.XMS_CC="xms_cc"}(g||(g={}));var C,T={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"};!function(e){e.ACCOUNT="account",e.SID="sid",e.LOGIN_HINT="login_hint",e.ID_TOKEN="id_token",e.DOMAIN_HINT="domain_hint",e.ORGANIZATIONS="organizations",e.CONSUMERS="consumers",e.ACCOUNT_ID="accountIdentifier",e.HOMEACCOUNT_ID="homeAccountIdentifier"}(C||(C={}));var E,_,I,w,b,k,S={PLAIN:"plain",S256:"S256"};!function(e){e.QUERY="query",e.FRAGMENT="fragment",e.FORM_POST="form_post"}(E||(E={})),function(e){e.IMPLICIT_GRANT="implicit",e.AUTHORIZATION_CODE_GRANT="authorization_code",e.CLIENT_CREDENTIALS_GRANT="client_credentials",e.RESOURCE_OWNER_PASSWORD_GRANT="password",e.REFRESH_TOKEN_GRANT="refresh_token",e.DEVICE_CODE_GRANT="device_code",e.JWT_BEARER="urn:ietf:params:oauth:grant-type:jwt-bearer"}(_||(_={})),function(e){e.MSSTS_ACCOUNT_TYPE="MSSTS",e.ADFS_ACCOUNT_TYPE="ADFS",e.MSAV1_ACCOUNT_TYPE="MSA",e.GENERIC_ACCOUNT_TYPE="Generic"}(I||(I={})),function(e){e.CACHE_KEY_SEPARATOR="-",e.CLIENT_INFO_SEPARATOR="."}(w||(w={})),function(e){e.ID_TOKEN="IdToken",e.ACCESS_TOKEN="AccessToken",e.ACCESS_TOKEN_WITH_AUTH_SCHEME="AccessToken_With_AuthScheme",e.REFRESH_TOKEN="RefreshToken"}(b||(b={})),function(e){e[e.ADFS=1001]="ADFS",e[e.MSA=1002]="MSA",e[e.MSSTS=1003]="MSSTS",e[e.GENERIC=1004]="GENERIC",e[e.ACCESS_TOKEN=2001]="ACCESS_TOKEN",e[e.REFRESH_TOKEN=2002]="REFRESH_TOKEN",e[e.ID_TOKEN=2003]="ID_TOKEN",e[e.APP_METADATA=3001]="APP_METADATA",e[e.UNDEFINED=9999]="UNDEFINED"}(k||(k={}));var R,A="appmetadata",P="1",N="authority-metadata";!function(e){e.CONFIG="config",e.CACHE="cache",e.NETWORK="network",e.HARDCODED_VALUES="hardcoded_values"}(R||(R={}));var O,M={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"};!function(e){e.BEARER="Bearer",e.POP="pop",e.SSH="ssh-cert"}(O||(O={}));var q,U,H,B,D,L,x="retry-after, h429",K="invalid_grant",F="client_mismatch";!function(e){e.username="username",e.password="password"}(q||(q={})),U||(U={})),function(e){e.FAILED_AUTO_DETECTION="1",e.INTERNAL_CACHE="2",e.ENVIRONMENT_VARIABLE="3",e.IMDS="4"}(H||(H={})),B||(B={})),function(e){e.NO_CACHE_HIT="0",e.FORCE_REFRESH="1",e.NO_CACHED_ACCESS_TOKEN="2",e.CACHED_ACCESS_TOKEN_EXPIRED="3",e.REFRESH_CACHED_ACCESS_TOKEN="4",e.CLAIMS_REQUESTED_CACHE_SKIPPED="5"}(D||(D={})),function(e){e.Jwt="JWT",e.Jwk="JWK",e.Pop="pop"}(L||(L={}));var G,j,z,Q,Y,W,V,J,X,Z={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},$="53ee284d-920a-4b59-9d30-a60315b26836";!function(e){e.HandshakeRequest="Handshake",e.HandshakeResponse="HandshakeResponse",e.GetToken="GetToken",e.Response="Response"}(G||(G={})),j||(j={})),function(e){e.GET="GET",e.POST="POST"}(z||(z={})),Q||(Q={})),function(e){e.ACCOUNT_KEYS="msal.account.keys",e.TOKEN_KEYS="msal.token.keys"}(Y||(Y={})),function(e){e.WRAPPER_SKU="wrapper.sku",e.WRAPPER_VER="wrapper.version"}(W||(W={})),V||(V={})),J||(J={})),X||(X={}));var ee,te={scopes:v},re="jwk";!function(e){e.React="@azure/msal-react",e.Angular="@azure/msal-angular"}(ee||(ee={}));var ne,oe="msal.db";!ne||(ne={}));var ie=function(e){function t(r,n,o){var i=this;return i=e.call(this,n?r+": "+n:r)||this,Object.setPrototypeOf(i,t.prototype),i.errorCode=r||m.EMPTY_STRING,i.errorMessage=n||m.EMPTY_STRING,i.subError=o||m.EMPTY_STRING,i.name="AuthError",i}return a(t,e),t.prototype.setCorrelationId=function(e){this.correlationId=e},t.createUnexpectedError=function(e){return new t("unexpected_error","Unexpected error in authentication.: "+e)},t.createPostRequestFailed=function(e){return new t("post_request_failed","Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details.: "+e)},t}(Error),ae=["interaction_required","consent_required","login_required"],se=["message_only","additional_action","basic_action","user_password_expired","consent_required"],ce="no_tokens_found",ue=function(e){function t(r,n,o,i,a,s,c){var u=e.call(this,r,n,o)||this;return Object.setPrototypeOf(u,t.prototype),u.timestamp=i||m.EMPTY_STRING,u.traceId=a||m.EMPTY_STRING,u.correlationId=s||m.EMPTY_STRING,u.claims=c||m.EMPTY_STRING,u.name="InteractionRequiredAuthError",u}return a(t,e),t.isInteractionRequiredError=t.createNoTokensFoundError=function(){return new t(ce,"No refresh token found in the cache. Please sign-in.")},t.createNativeAccountUnavailableError=function(){return new t("native_account_unavailable","The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.")},t}(ie),le=r("Dn7E"),de=r("E7ar"),he=r("8wW2"),pe=new Set(["OneDrive","SharePoint"]),fe=function(e){return"api/refresh".concat(e).concat("Graph"===e?"Access":"","Token/v2")},ge=me=new Map,ve=r("ywfh"),ye=r("RJ4M"),Ce=r("a3FV"),Te=r("/Oio"),Ee=r("0TX8"),_e=r("lAHu"),Ie=function(e,t){return Object(o.__awaiter)(void 0,void 0,void 0,(function(){var n,i,a;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:if(t||!pe.has(e))return[2,t];o.label=1;case 1:return o.trys.push([1,4,,5]),[4,r.e(721).then(r.bind(null,"neT0"))];case 2:return[4,o.sent().fetchUserEntitlements()];case 3:return(null==(n=o.sent())?void 0:n.result)?"OneDrive"===e?[2,null!==(i=n.result.OneDriveResourceId)&&void 0!==i?i:t]:"SharePoint"===e?[2,null!==(a=n.result.SharePointResourceId)&&void 0!==a?a:t]:[3,5]:(Object(le.a)({eventName:"ResolveUrlEntitlementsMissing",featureName:"AccessToken"}),[2,t]);case 4:return o.sent(),Object(le.a)({eventName:"ResolveUrlEntitlementsFailedToFetch",featureName:"AccessToken"}),[3,5];case 5:return t||Object(le.a)({eventName:"ResolveUrlResourceIdNotResolved",featureName:"AccessToken"}),[2,t]}}))}))},we=new Map;function be(e,t,r,n,i,a,s){return void 0===a&&(a=!1),void 0===s&&(s=""),Object(o.__awaiter)(this,void 0,void 0,(function(){var c,u,l,d,h,p;return Object(o.__generator)(this,(function(f){switch(f.label){case 0:return we||(we=new Map),[4,Ie(e,s)];case 1:return c=f.sent(),u=function(e,t){return e+(t?"_".concat(t):"")}(e,c),(l=we.get(u))&&!a?[2,l]:(d=function(e){var t=e),r=void 0;if(me.has(t))r=me.get(t);else{try{r=Object(de.a)(t)}catch(e){Object(he.a)().handleError(e)}me.set(t,r)}return r&&r[e]}(e),h=d?function(e,t,r){void 0===r&&(r="");var n=t?t.ExpiryMs?t:Object(o.__assign)(Object(o.__assign)({},t),{ExpiryMs:ge()}):{TokenValue:"",ExpiryMs:ge()};return{refreshEndpoint:fe(e),token:n,resourceUrl:r}}(e,d,c):{refreshEndpoint:fe(e),token:{TokenValue:"",ExpiryMs:ge()},resourceUrl:c},p=function(e,t,r,n,i,a,s,c){return s||!function(e,t){return(!t||t===e.resourceUrl)&&!!e.token&&!!e.token.TokenValue&&!!e.token.ExpiryMs&&e.token.ExpiryMs>(new Date).getTime()}(t,c)?t.token&&t.token.HasPermanentError?Promise.reject("Permanent auth error has been detected; refresh token for <".concat(e,"> is aborted.")):t.token&&t.token.HasCAPError?Promise.reject("CAP_Error"):function(e,t,r,n,i,a,s,c){var u=this,l=function(d){return Object(o.__awaiter)(u,void 0,void 0,(function(){var u,h,p,f,g;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return u=function(e,t){return t&&0!==d?l(--d):Promise.reject(e)},!(h=c||t.resourceUrl)&&pe.has(e)?[2,u("Missing resource url, but is required for <".concat(e,">."),!1)]:(p=s||!!t.token.TokenValue,f="".concat(r,"/").concat(t.refreshEndpoint).concat(p?"?bypassCache=true":""),g={method:"GET",responseType:"json",url:f,headers:h?{"X-OfficeHome-ResourceUrl":h}:{}},[4,Object(Ee.a)(g,a,Te.a.OfficeHomeReact,i)]);case 1:return o.sent(),[2,Object(_e.a)(Ce.a.RefreshAccessTokenRequest,"Refresh_Access_Token",g,r,n,void 0,(function(t,r){if(r.State=p?"Bypass_Cache":"Regular",r.Consumer=e,r.Retry=(1-d).toString(),h){r.ResourceUrl={value:h,kind:2};var n=Object(ve.a)(h);!n&&function(e){return Object(ye.a)(e).lastIndexOf("live.net")>0}(h)&&(n="Consumer"),r.DocumentType=n||""}})).then((function(e){var t=e.data;return t&&t.TokenValue?t:u("Response did not contain valid token",!0)})).catch((function(e){return u("Request failed"+(e?" with error code: ".concat(e.status):""),!e||500===e.status)}))]}}))}))};return l(1).then(()}(e,t,r,n,i,a,s,c):Promise.resolve(t)}(e,h,t,r,n,i,a,c).then((function(e){return{success:!0,token:e.token.TokenValue,expiryMs:e.token.ExpiryMs,format:"JWT",source:"OfficeHome"}})),we.set(u,p),[2,p])}}))}))}var ke=r("3vWs"),Se=r("MJsD"),Re=r("RV7E"),Ae=r("gCKw"),Pe=r("VKX6"),Ne=r("tyUq");function Oe(e){return e?"string"==typeof e?e:"name: ".concat(e.name,". code: ").concat(e.errorCode,". message: ").concat(e.errorMessage,". subError: ").concat(e.subError,". correlationId: ").concat(e.correlationId):""}var Me=function(e,t){return(Me=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function qe(e,t){function r(){this.constructor=e}Me(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var Ue=function(){return(Ue=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function He(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function Be(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function De(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function Le(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(De(arguments[t]));return e}var xe=ar Fe=e,Ve="token_refresh_required",Je=function(e){function t(r,n){var o=e.call(this,r,n)||this;return o.name="ClientAuthError",Object.setPrototypeOf(o,t.prototype),o}return a(t,e),t.createClientInfoDecodingError=function(e){return new t("client_info_decoding_error","The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause. Failed with error: "+e)},t.createClientInfoEmptyError=function(){return new t("client_info_empty_error","The client info was empty. Please review the trace to determine the root cause.")},t.createTokenParsingError=function(e){return new t("token_parsing_error","Token cannot be parsed. Please review stack trace to determine root cause. Failed with error: "+e)},t.createTokenNullOrEmptyError=function(e){return new t("null_or_empty_token","The token is null or empty. Please review the trace to determine the root cause. Raw Token Value: "+e)},t.createEndpointDiscoveryIncompleteError=function(e){return new t("endpoints_resolution_error","Error: could not resolve endpoints. Please check network and try again. Detail: "+e)},t.createNetworkError=function(e,r){return new t("network_error","Network request failed. Please check network trace to determine root cause. | Fetch client threw: "+r+" | Attempted to reach: "+e.split("?")[0])},t.createUnableToGetOpenidConfigError=function(e){return new t("openid_config_error","Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints. Attempted to retrieve endpoints from: "+e)},t.createHashNotDeserializedError=function(e){return new t("hash_not_deserialized","The hash parameters could not be deserialized. Please review the trace to determine the root cause. Given Object: "+e)},t.createInvalidStateError=function(e,r){return new t("invalid_state","State was not the expected format. Please check the logs to determine whether the request was sent using ProtocolUtils.setRequestState(). Invalid State: "+e+", Root Err: "+r)},t.createStateMismatchError=function(){return new t("state_mismatch","State mismatch error. Please check your network. Continued requests may cause cache overflow.")},t.createStateNotFoundError=function(e){return new t("state_not_found","State not found:  "+e)},t.createNonceMismatchError=function(){return new t("nonce_mismatch","Nonce mismatch error. This may be caused by a race condition in concurrent requests.")},t.createAuthTimeNotFoundError=function(){return new t("auth_time_not_found","Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.")},t.createMaxAgeTranspiredError=function(){return new t("max_age_transpired","Max Age is set to 0, or too much time has elapsed since the last end-user authentication.")},t.createNonceNotFoundError=function(e){return new t("nonce_not_found","nonce not found:  "+e)},t.createMultipleMatchingTokensInCacheError=function(){return new t("multiple_matching_tokens","The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account..")},t.createMultipleMatchingAccountsInCacheError=function(){return new t("multiple_matching_accounts","The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account")},t.createMultipleMatchingAppMetadataInCacheError=function(){return new t("multiple_matching_appMetadata","The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata")},t.createTokenRequestCannotBeMadeError=function(){return new t("request_cannot_be_made","Token request cannot be made without authorization code or refresh token.")},t.createAppendEmptyScopeToSetError=function(e){return new t("cannot_append_empty_scope","Cannot append null or empty scope to ScopeSet. Please check the stack trace for more info. Given Scope: "+e)},t.createRemoveEmptyScopeFromSetError=function(e){return new t("cannot_remove_empty_scope","Cannot remove null or empty scope from ScopeSet. Please check the stack trace for more info. Given Scope: "+e)},t.createAppendScopeSetError=function(e){return new t("cannot_append_scopeset","Cannot append ScopeSet due to error. Detail Error: "+e)},t.createEmptyInputScopeSetError=function(){return new t("empty_input_scopeset","Empty input ScopeSet cannot be processed.")},t.createDeviceCodeCancelledError=function(){return new t("device_code_polling_cancelled","Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.")},t.createDeviceCodeExpiredError=function(){return new t("device_code_expired","Device code is expired.")},t.createDeviceCodeUnknownError=function(){return new t("device_code_unknown_error","Device code stopped polling for unknown reasons.")},t.createNoAccountInSilentRequestError=function(){return new t("no_account_in_silent_request","Please pass an account object, silent flow is not supported without account information")},t.createNullOrUndefinedCacheRecord=function(){return new t("invalid_cache_record","Cache record object was null or undefined.")},t.createInvalidCacheEnvironmentError=function(){return new t("invalid_cache_environment","Invalid environment when attempting to create cache entry")},t.createNoAccountFoundError=function(){return new t("no_account_found","No account found in cache for given key.")},t.createCachePluginError=function(){return new t("no cache plugin set on CacheManager","ICachePlugin needs to be set before using readFromStorage or writeFromStorage")},t.createNoCryptoObjectError=function(e){return new t("no_crypto_object","No crypto object detected. This is required for the following operation: "+e)},t.createInvalidCacheTypeError=function(){return new t("invalid_cache_type","Invalid cache type")},t.createUnexpectedAccountTypeError=function(){return new t("unexpected_account_type","Unexpected account type.")},t.createUnexpectedCredentialTypeError=function(){return new t("unexpected_credential_type","Unexpected credential type.")},t.createInvalidAssertionError=function(){return new t("invalid_assertion","Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515")},t.createInvalidCredentialError=function(){return new t("invalid_client_credential","Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential")},t.createRefreshRequiredError=function(){return new t(Ve,"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.")},t.createUserTimeoutReachedError=function(){return new t("user_timeout_reached","User defined timeout for device code polling reached")},t.createTokenClaimsRequiredError=function(){return new t("token_claims_cnf_required_for_signedjwt","Cannot generate a POP jwt if the token_claims are not populated")},t.createNoAuthCodeInServerResponseError=function(){return new t("authorization_code_missing_from_server_response","Server response does not contain an authorization code to proceed")},t.createBindingKeyNotRemovedError=function(){return new t("binding_key_not_removed","Could not remove the credential's binding key from storage.")},t.createLogoutNotSupportedError=function(){return new t("end_session_endpoint_not_supported","Provided authority does not support logout.")},t.createKeyIdMissingError=function(){return new t("key_id_missing","A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.")},t.createNoNetworkConnectivityError=function(){return new t("no_network_connectivity","No network connectivity. Check your internet connection.")},t.createUserCanceledError=function(){return new t("user_canceled","User canceled the flow.")},t}(ie),Xe=function(){function e(){}return e.prototype.generateAccountId=function(){return e.generateAccountIdForCacheKey(this.homeAccountId,this.environment)},e.prototype.generateCredentialId=e.prototype.generateTarget=function(){return e.generateTargetForCacheKey(this.target)},e.prototype.generateCredentialKey=e.prototype.generateType=e.generateCredentialCacheKey=e.generateAccountIdForCacheKey=e.generateCredentialIdForCacheKey=function(e,t,r,n){return[e,e===b.REFRESH_TOKEN&&n||t,r||m.EMPTY_STRING].join(w.CACHE_KEY_SEPARATOR).toLowerCase()},e.generateTargetForCacheKey=function(e){return(e||m.EMPTY_STRING).toLowerCase()},e.generateClaimsHashForCacheKey=e.generateSchemeForCacheKey=e}(),Ze=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.createIdTokenEntity=t.isIdTokenEntity=function(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.credentialType===b.ID_TOKEN},t}(Xe),$e=function(e){function t(r,n){var o=e.call(this,r,n)||this;return o.name="ClientConfigurationError",Object.setPrototypeOf(o,t.prototype),o}return a(t,e),t.createRedirectUriEmptyError=function(){return new t("redirect_uri_empty","A redirect URI is required for all calls, and none has been set.")},t.createPostLogoutRedirectUriEmptyError=function(){return new t("post_logout_uri_empty","A post logout redirect has not been set.")},t.createClaimsRequestParsingError=function(e){return new t("claims_request_parsing_error","Could not parse the given claims request object. Given value: "+e)},t.createInsecureAuthorityUriError=function(e){return new t("authority_uri_insecure","Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options Given URI: "+e)},t.createUrlParseError=function(e){return new t("url_parse_error","URL could not be parsed into appropriate segments. Given Error: "+e)},t.createUrlEmptyError=function(){return new t("empty_url_error","URL was empty or null.")},t.createEmptyScopesArrayError=function(){return new t("empty_input_scopes_error","Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.")},t.createClientIdSingleScopeError=function(e){return new t("clientid_input_scopes_error","Client ID can only be provided as a single scope. Given Scopes: "+e)},t.createInvalidPromptError=function(e){return new t("invalid_prompt_value","Supported prompt values are 'login', 'select_account', 'consent', 'create', 'none' and 'no_session'.  Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest Given value: "+e)},t.createInvalidClaimsRequestError=function(){return new t("invalid_claims","Given claims parameter must be a stringified JSON object.")},t.createEmptyLogoutRequestError=function(){return new t("logout_request_empty","The logout request was null or undefined.")},t.createEmptyTokenRequestError=function(){return new t("token_request_empty","Token request was empty and not found in cache.")},t.createInvalidCodeChallengeMethodError=function(){return new t("invalid_code_challenge_method",'code_challenge_method passed is invalid. Valid values are "plain" and "S256".')},t.createInvalidCodeChallengeParamsError=function(){return new t("pkce_params_missing","Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request")},t.createInvalidCloudDiscoveryMetadataError=function(){return new t("invalid_cloud_discovery_metadata","Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields")},t.createInvalidAuthorityMetadataError=function(){return new t("invalid_authority_metadata","Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.")},t.createUntrustedAuthorityError=function(){return new t("untrusted_authority","The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.")},t.createInvalidAzureCloudInstanceError=function(){return new t("invalid_azure_cloud_instance","Invalid AzureCloudInstance provided. Please refer MSAL JS docs: aks.ms/msaljs/azure_cloud_instance for valid values")},t.createMissingSshJwkError=function(){return new t("missing_ssh_jwk","Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.")},t.createMissingSshKidError=function(){return new t("missing_ssh_kid","Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.")},t.createMissingNonceAuthenticationHeadersError=function(){return new t("missing_nonce_authentication_header","Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.")},t.createInvalidAuthenticationHeaderError=t.createAuthorityMismatchError=function(){return new t("authority_mismatch","Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority.")},t}(Je),et=),tt=function(){eturn e.fromString=function(t){return new e((t||m.EMPTY_STRING).split(" "))},e.createSearchScopes=function(t){var r=new e(t);return r.containsOnlyOIDCScopes()?r.removeScope(m.OFFLINE_ACCESS_SCOPE):r.removeOIDCScopes(),r},e.prototype.validateInputScopes=e.prototype.containsScope=e.prototype.containsScopeSet=function(e){var t=this;return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every((function(e){return t.containsScope(e)}))},e.prototype.containsOnlyOIDCScopes=e.prototype.appendScope=e.prototype.appendScopes=e.prototype.removeScope=e.prototype.removeOIDCScopes=e.prototype.unionScopeSets=e.prototype.intersectingScopeSets=function(e){if(!e)throw Je.createEmptyInputScopeSetError();e.containsOnlyOIDCScopes()||e.removeOIDCScopes();var t=this.unionScopeSets(e),r=e.getScopeCount(),n=this.getScopeCount();return t.size<n+r},e.prototype.getScopeCount=function(){return this.scopes.size},e.prototype.asArray=e.prototype.printScopes=e.prototype.printScopesLowerCase=e}();e||(We={}));var ot,it=function(){function e(){}return e.prototype.generateAccountId=e.prototype.generateAccountKey=e.prototype.generateType=e.prototype.getAccountInfo=e.generateAccountCacheKey=e.createAccount=function(t,r,n,o,i,a,s,c){var u,l,d,h,p,f,g=new e;g.authorityType=I.MSSTS_ACCOUNT_TYPE,g.clientInfo=t,g.homeAccountId=r,g.nativeAccountId=c;var v=s||o&&o.getPreferredCache();if(!v)throw Je.createInvalidCacheEnvironmentError();if(g.environment=v,g.realm=(null===(u=null==n?void 0:n.claims)||void 0===u?void 0:u.tid)||m.EMPTY_STRING,n){g.idTokenClaims=n.claims,g.localAccountId=(null===(l=null==n?void 0:n.claims)||void 0===l?void 0:l.oid)||(null===(d=null==n?void 0:n.claims)||void 0===d?void 0:d.sub)||m.EMPTY_STRING;var y=null===(h=null==n?void 0:n.claims)||void 0===h?void 0:h.preferred_username,C=(null===(p=null==n?void 0:n.claims)||void 0===p?void 0:p.emails)?n.claims.emails[0]:null;g.username=y||C||m.EMPTY_STRING,g.name=null===(f=null==n?void 0:n.claims)||void 0===f?void 0:f.name}return g.cloudGraphHostName=i,g.msGraphHost=a,g},e.createGenericAccount=function(t,r,n,o,i,a){var s,c,u,l,d=new e;d.authorityType=n&&n.authorityType===We.Adfs?I.ADFS_ACCOUNT_TYPE:I.GENERIC_ACCOUNT_TYPE,d.homeAccountId=t,d.realm=m.EMPTY_STRING;var h=a||n&&n.getPreferredCache();if(!h)throw Je.createInvalidCacheEnvironmentError();return r&&(d.localAccountId=(null===(s=null==r?void 0:r.claims)||void 0===s?void 0:s.oid)||(null===(c=null==r?void 0:r.claims)||void 0===c?void 0:c.sub)||m.EMPTY_STRING,d.username=(null===(u=null==r?void 0:r.claims)||void 0===u?void 0:u.upn)||m.EMPTY_STRING,d.name=(null===(l=null==r?void 0:r.claims)||void 0===l?void 0:l.name)||m.EMPTY_STRING,d.idTokenClaims=null==r?void 0:r.claims),d.environment=h,d.cloudGraphHostName=o,d.msGraphHost=i,d},e.generateHomeAccountId=function(e,t,r,n,o){var i,a=(null===(i=null==o?void 0:o.claims)||void 0===i?void 0:i.sub)?o.claims.sub:m.EMPTY_STRING;if(t===We.Adfs||t===We.Dsts)return a;if(e)try{var s=rt(e,n);if(!et.isEmpty(s.uid)&&!et.isEmpty(s.utid))return""+s.uid+w.CLIENT_INFO_SEPARATOR+s.utid}catch(e){}return r.verbose("No client info in response"),a},e.isAccountEntity=function(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")},e.accountInfoIsEqual=e}(),at=function(){eturn e.extractTokenClaims=function(e,t){var r=et.decodeAuthToken(e);try{var n=t.base64Decode(r.JWSPayload);return JSON.parse(n)}catch(e){throw Je.createTokenParsingError(e)}},e.checkMaxAge=function(e,t){if(0===t||Date.now()-3e5>e+t)throw Je.createMaxAgeTranspiredError()},e}(),st="@azure/msal-common",ct="13.3.0",ut=function(){eturn e.prototype.getAllAccounts=e.prototype.getAccountInfoFilteredBy=e.prototype.getAccountInfoFromEntity=e.prototype.saveCacheRecord=e.prototype.saveAccessToken=function(e){return c(this,void 0,void 0,(function(){var t,r,n,o,i=this;return u(this,(function(a){switch(a.label){case 0:return t={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),n=tt.fromString(e.target),o=[],r.accessToken.forEach((function(e){if(i.accessTokenKeyMatchesFilter(e,t,!1)){var r=i.getAccessTokenCredential(e);r&&i.credentialMatchesFilter(r,t)&&tt.fromString(r.target).intersectingScopeSets(n)&&o.push(i.removeAccessToken(e))}})),[4,Promise.all(o)];case 1:return a.sent(),this.setAccessTokenCredential(e),[2]}}))}))},e.prototype.getAccountsFilteredBy=e.prototype.isAccountKey=function(e,t,r){return!(e.split(w.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))},e.prototype.isCredentialKey=function(e){if(e.split(w.CACHE_KEY_SEPARATOR).length<6)return!1;var t=e.toLowerCase();if(-1===t.indexOf(b.ID_TOKEN.toLowerCase())&&-1===t.indexOf(b.ACCESS_TOKEN.toLowerCase())&&-1===t.indexOf(b.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())&&-1===t.indexOf(b.REFRESH_TOKEN.toLowerCase()))return!1;if(t.indexOf(b.REFRESH_TOKEN.toLowerCase())>-1){var r=""+b.REFRESH_TOKEN+w.CACHE_KEY_SEPARATOR+P+w.CACHE_KEY_SEPARATOR;if(-1===t.indexOf((""+b.REFRESH_TOKEN+w.CACHE_KEY_SEPARATOR+this.clientId+w.CACHE_KEY_SEPARATOR).toLowerCase())&&-1===t.indexOf(r.toLowerCase()))return!1}else if(-1===t.indexOf(this.clientId.toLowerCase()))return!1;return!0},e.prototype.credentialMatchesFilter=function(e,t){if(t.clientId&&!this.matchClientId(e,t.clientId))return!1;if(t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash))return!1;if("string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId))return!1;if(t.environment&&!this.matchEnvironment(e,t.environment))return!1;if(t.realm&&!this.matchRealm(e,t.realm))return!1;if(t.credentialType&&!this.matchCredentialType(e,t.credentialType))return!1;if(t.familyId&&!this.matchFamilyId(e,t.familyId))return!1;if(t.target&&!this.matchTarget(e,t.target))return!1;if((t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash)return!1;if(e.credentialType===b.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(t.tokenType&&!this.matchTokenType(e,t.tokenType))return!1;if(t.tokenType===O.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId))return!1}return!0},e.prototype.getAppMetadataFilteredBy=e.prototype.getAppMetadataFilteredByInternal=e.prototype.getAuthorityMetadataByAlias=e.prototype.removeAllAccounts=function(){return c(this,void 0,void 0,(function(){var e,t,r=this;return u(this,()}))},e.prototype.removeAccount=function(e){return c(this,void 0,void 0,(function(){var t;return u(this,(function(r){switch(r.label){case 0:if(!(t=this.getAccount(e)))throw Je.createNoAccountFoundError();return[4,this.removeAccountContext(t)];case 1:return r.sent(),this.removeItem(e),[2]}}))}))},e.prototype.removeAccountContext=function(e){return c(this,void 0,void 0,(function(){var t,r,n,o=this;return u(this,()}))},e.prototype.removeAccessToken=function(e){return c(this,void 0,void 0,(function(){var t,r;return u(this,(function(n){switch(n.label){case 0:if(!(t=this.getAccessTokenCredential(e)))return[2];if(t.credentialType.toLowerCase()!==b.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())return[3,4];if(t.tokenType!==O.POP)return[3,4];if(!(r=t.keyId))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.cryptoImpl.removeTokenBindingKey(r)];case 2:return n.sent(),[3,4];case 3:throw n.sent(),Je.createBindingKeyNotRemovedError();case 4:return[2,this.removeItem(e)]}}))}))},e.prototype.removeAppMetadata=e.prototype.readCacheRecord=e.prototype.readAccountFromCache=e.prototype.getIdToken=function(e,t){this.commonLogger.trace("CacheManager - getIdToken called");var r=this.getIdTokensByFilter({homeAccountId:e.homeAccountId,environment:e.environment,credentialType:b.ID_TOKEN,clientId:this.clientId,realm:e.tenantId},t),n=r.length;if(n<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(n>1)throw Je.createMultipleMatchingTokensInCacheError();return this.commonLogger.info("CacheManager:getIdToken - Returning id token"),r[0]},e.prototype.getIdTokensByFilter=function(e,t){var r=this,n=t&&t.idToken||this.getTokenKeys().idToken,o=[];return n.forEach((function(t){if(r.idTokenKeyMatchesFilter(t,s({clientId:r.clientId},e))){var n=r.getIdTokenCredential(t);n&&r.credentialMatchesFilter(n,e)&&o.push(n)}})),o},e.prototype.idTokenKeyMatchesFilter=function(e,t){var r=e.toLowerCase();return!(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))},e.prototype.removeIdToken=function(e){this.removeItem(e)},e.prototype.removeRefreshToken=e.prototype.getAccessToken=function(e,t,r){var n=this;this.commonLogger.trace("CacheManager - getAccessToken called");var o=tt.createSearchScopes(t.scopes),i=t.authenticationScheme||O.BEARER,a=i&&i.toLowerCase()!==O.BEARER.toLowerCase()?b.ACCESS_TOKEN_WITH_AUTH_SCHEME:b.ACCESS_TOKEN,s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:a,clientId:this.clientId,realm:e.tenantId,target:o,tokenType:i,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},c=r&&r.accessToken||this.getTokenKeys().accessToken,u=[];c.forEach((function(e){if(n.accessTokenKeyMatchesFilter(e,s,!0)){var t=n.getAccessTokenCredential(e);t&&n.credentialMatchesFilter(t,s)&&u.push(t)}}));var l=u.length;if(l<1)return this.commonLogger.info("CacheManager:getAccessToken - No token found"),null;if(l>1)throw Je.createMultipleMatchingTokensInCacheError();return this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),u[0]},e.prototype.accessTokenKeyMatchesFilter=e.prototype.getAccessTokensByFilter=e.prototype.getRefreshToken=function(e,t,r){var n=this;this.commonLogger.trace("CacheManager - getRefreshToken called");var o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:b.REFRESH_TOKEN,clientId:this.clientId,familyId:t?P:void 0},i=r&&r.refreshToken||this.getTokenKeys().refreshToken,a=[];return i.forEach((),a.length<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),a[0])},e.prototype.refreshTokenKeyMatchesFilter=function(e,t){var r=e.toLowerCase();return!(t.familyId&&-1===r.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))},e.prototype.readAppMetadataFromCache=function(e){var t=this.getAppMetadataFilteredBy({environment:e,clientId:this.clientId}),r=Object.keys(t).map((),n=r.length;if(n<1)return null;if(n>1)throw Je.createMultipleMatchingAppMetadataInCacheError();return r[0]},e.prototype.isAppMetadataFOCI=function(e){var t=this.readAppMetadataFromCache(e);return!(!t||t.familyId!==P)},e.prototype.matchHomeAccountId=function(e,t){return!("string"!=typeof e.homeAccountId||t!==e.homeAccountId)},e.prototype.matchLocalAccountId=e.prototype.matchUsername=function(e,t){return!("string"!=typeof e.username||t.toLowerCase()!==e.username.toLowerCase())},e.prototype.matchUserAssertionHash=function(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)},e.prototype.matchEnvironment=e.prototype.matchCredentialType=e.prototype.matchClientId=function(e,t){return!(!e.clientId||t!==e.clientId)},e.prototype.matchFamilyId=function(e,t){return!(!e.familyId||t!==e.familyId)},e.prototype.matchRealm=function(e,t){return!(!e.realm||t!==e.realm)},e.prototype.matchNativeAccountId=e.prototype.matchTarget=function(e,t){return!(e.credentialType!==b.ACCESS_TOKEN&&e.credentialType!==b.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&tt.fromString(e.target).containsScopeSet(t)},e.prototype.matchTokenType=function(e,t){return!(!e.tokenType||e.tokenType!==t)},e.prototype.matchKeyId=e.prototype.isAppMetadata=function(e){return-1!==e.indexOf(A)},e.prototype.isAuthorityMetadata=e.prototype.generateAuthorityMetadataCacheKey=e.toObject=e}(),lt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.setAccount=function(){throw ie.createUnexpectedError("Storage interface - setAccount() has not been implemented for the cacheStorage interface.")},t.prototype.getAccount=function(){throw ie.createUnexpectedError("Storage interface - getAccount() has not been implemented for the cacheStorage interface.")},t.prototype.setIdTokenCredential=function(){throw ie.createUnexpectedError("Storage interface - setIdTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.getIdTokenCredential=function(){throw ie.createUnexpectedError("Storage interface - getIdTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.setAccessTokenCredential=function(){throw ie.createUnexpectedError("Storage interface - setAccessTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.getAccessTokenCredential=function(){throw ie.createUnexpectedError("Storage interface - getAccessTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.setRefreshTokenCredential=function(){throw ie.createUnexpectedError("Storage interface - setRefreshTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.getRefreshTokenCredential=function(){throw ie.createUnexpectedError("Storage interface - getRefreshTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.setAppMetadata=function(){throw ie.createUnexpectedError("Storage interface - setAppMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.getAppMetadata=function(){throw ie.createUnexpectedError("Storage interface - getAppMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.setServerTelemetry=function(){throw ie.createUnexpectedError("Storage interface - setServerTelemetry() has not been implemented for the cacheStorage interface.")},t.prototype.getServerTelemetry=function(){throw ie.createUnexpectedError("Storage interface - getServerTelemetry() has not been implemented for the cacheStorage interface.")},t.prototype.setAuthorityMetadata=function(){throw ie.createUnexpectedError("Storage interface - setAuthorityMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.getAuthorityMetadata=function(){throw ie.createUnexpectedError("Storage interface - getAuthorityMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.getAuthorityMetadataKeys=function(){throw ie.createUnexpectedError("Storage interface - getAuthorityMetadataKeys() has not been implemented for the cacheStorage interface.")},t.prototype.setThrottlingCache=function(){throw ie.createUnexpectedError("Storage interface - setThrottlingCache() has not been implemented for the cacheStorage interface.")},t.prototype.getThrottlingCache=function(){throw ie.createUnexpectedError("Storage interface - getThrottlingCache() has not been implemented for the cacheStorage interface.")},t.prototype.removeItem=function(){throw ie.createUnexpectedError("Storage interface - removeItem() has not been implemented for the cacheStorage interface.")},t.prototype.containsKey=function(){throw ie.createUnexpectedError("Storage interface - containsKey() has not been implemented for the cacheStorage interface.")},t.prototype.getKeys=function(){throw ie.createUnexpectedError("Storage interface - getKeys() has not been implemented for the cacheStorage interface.")},t.prototype.getAccountKeys=function(){throw ie.createUnexpectedError("Storage interface - getAccountKeys() has not been implemented for the cacheStorage interface.")},t.prototype.getTokenKeys=function(){throw ie.createUnexpectedError("Storage interface - getTokenKeys() has not been implemented for the cacheStorage interface.")},t.prototype.clear=function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){throw ie.createUnexpectedError("Storage interface - clear() has not been implemented for the cacheStorage interface.")}))}))},t.prototype.updateCredentialCacheKey=function(){throw ie.createUnexpectedError("Storage interface - updateCredentialCacheKey() has not been implemented for the cacheStorage interface.")},t}(ut),dt=),ht=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.createAccessTokenEntity=function(e,r,n,o,i,a,s,c,u,l,d,h,p,f,g){var m,v,y=new t;y.homeAccountId=e,y.credentialType=b.ACCESS_TOKEN,y.secret=n;var C=dt.nowSeconds();if(y.cachedAt=C.toString(),y.expiresOn=s.toString(),y.extendedExpiresOn=c.toString(),l&&(y.refreshOn=l.toString()),y.environment=r,y.clientId=o,y.realm=i,y.target=a,y.userAssertionHash=h,y.tokenType=et.isEmpty(d)?O.BEARER:d,f&&(y.requestedClaims=f,y.requestedClaimsHash=g),(null===(m=y.tokenType)||void 0===m?void 0:m.toLowerCase())!==O.BEARER.toLowerCase())switch(y.credentialType=b.ACCESS_TOKEN_WITH_AUTH_SCHEME,y.tokenType){case O.POP:var T=at.extractTokenClaims(n,u);if(!(null===(v=null==T?void 0:T.cnf)||void 0===v?void 0:v.kid))throw Je.createTokenClaimsRequiredError();y.keyId=T.cnf.kid;break;case O.SSH:y.keyId=p}return y},t.isAccessTokenEntity=function(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.hasOwnProperty("target")&&(e.credentialType===b.ACCESS_TOKEN||e.credentialType===b.ACCESS_TOKEN_WITH_AUTH_SCHEME)},t}(Xe),pt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.createRefreshTokenEntity=t.isRefreshTokenEntity=function(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.credentialType===b.REFRESH_TOKEN},t}(Xe),ft=function(){function e(){}return e.prototype.generateAppMetadataKey=e.generateAppMetadataCacheKey=e.createAppMetadataEntity=e.isAppMetadataEntity=function(e,t){return!!t&&0===e.indexOf(A)&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("environment")},e}(),gt=),mt=function(){function e(){this.expiresAt=dt.nowSeconds()+86400}return e.prototype.updateCloudDiscoveryMetadata=e.prototype.updateEndpointMetadata=e.prototype.updateCanonicalAuthority=function(e){this.canonical_authority=e},e.prototype.resetExpiresAt=e.prototype.isExpired=e.isAuthorityMetadataEntity=function(e,t){return!!t&&0===e.indexOf(N)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")},e}(),vt=function(){function e(){}return e.isThrottlingEntity=function(e,t){var r=!1;e&&(r=0===e.indexOf("throttling"));var n=!0;return t&&(n=t.hasOwnProperty("throttleTime")),r&&n},e}(),yt=);!function(e){e.HOME_ACCOUNT_ID="home_account_id",e.UPN="UPN"}(ot||(ot={}));var Ct,Tt,Et={createNewGuid:function(){throw ie.createUnexpectedError("Crypto interface - createNewGuid() has not been implemented")},base64Decode:function(){throw ie.createUnexpectedError("Crypto interface - base64Decode() has not been implemented")},base64Encode:generatePkceCodes:function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){throw ie.createUnexpectedError("Crypto interface - generatePkceCodes() has not been implemented")}))}))},getPublicKeyThumbprint:function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){throw ie.createUnexpectedError("Crypto interface - getPublicKeyThumbprint() has not been implemented")}))}))},removeTokenBindingKey:function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){throw ie.createUnexpectedError("Crypto interface - removeTokenBindingKey() has not been implemented")}))}))},clearKeystore:function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){throw ie.createUnexpectedError("Crypto interface - clearKeystore() has not been implemented")}))}))},signJwt:function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){throw ie.createUnexpectedError("Crypto interface - signJwt() has not been implemented")}))}))},hashString:function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){throw ie.createUnexpectedError("Crypto interface - hashString() has not been implemented")}))}))}},_t="user_cancelled",It="crypto_key_not_found",wt="database_unavailable",bt=function(e){eturn Ke(t,e),t.createPkceNotGeneratedError=function(e){return new t("pkce_not_created","The PKCE code challenge and verifier could not be generated. Detail:"+e)},t.createCryptoNotAvailableError=function(e){return new t("crypto_nonexistent","The crypto object or function is not available. Detail:"+e)},t.createHttpMethodNotImplementedError=function(e){return new t("http_method_not_implemented","The HTTP method given has not been implemented in this library. Given Method: "+e)},t.createEmptyNavigationUriError=function(){return new t("empty_navigate_uri","Navigation URI is empty. Please check stack trace for more info.")},t.createEmptyHashError=function(e){return new t("hash_empty_error","Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. For more visit: aka.ms/msaljs/browser-errors. Given Url: "+e)},t.createHashDoesNotContainStateError=function(){return new t("no_state_in_hash","Hash does not contain state. Please verify that the request originated from msal.")},t.createHashDoesNotContainKnownPropertiesError=function(){return new t("hash_does_not_contain_known_properties","Hash does not contain known properites. Please verify that your redirectUri is not changing the hash. For more visit: aka.ms/msaljs/browser-errors.")},t.createUnableToParseStateError=function(){return new t("unable_to_parse_state","Unable to parse state. Please verify that the request originated from msal.")},t.createStateInteractionTypeMismatchError=function(){return new t("state_interaction_type_mismatch","Hash contains state but the interaction type does not match the caller.")},t.createInteractionInProgressError=function(){return new t("interaction_in_progress","Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.  For more visit: aka.ms/msaljs/browser-errors.")},t.createPopupWindowError=function(e){var r="Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.";return new t("popup_window_error",r=et.isEmpty(e)?r:r+" Details: "+e)},t.createEmptyWindowCreatedError=function(){return new t("empty_window_error","window.open returned null or undefined window object.")},t.createUserCancelledError=function(){return new t(_t,"User cancelled the flow.")},t.createMonitorPopupTimeoutError=function(){return new t("monitor_window_timeout","Token acquisition in popup failed due to timeout. For more visit: aka.ms/msaljs/browser-errors.")},t.createMonitorIframeTimeoutError=function(){return new t("monitor_window_timeout","Token acquisition in iframe failed due to timeout. For more visit: aka.ms/msaljs/browser-errors.")},t.createRedirectInIframeError=function(e){return new t("redirect_in_iframe","Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs. (window.parent !== window) => "+e)},t.createBlockReloadInHiddenIframeError=function(){return new t("block_iframe_reload","Request was blocked inside an iframe because MSAL detected an authentication response. For more visit: aka.ms/msaljs/browser-errors")},t.createBlockAcquireTokenInPopupsError=function(){return new t("block_nested_popups","Request was blocked inside a popup because MSAL detected it was running in a popup.")},t.createIframeClosedPrematurelyError=function(){return new t("iframe_closed_prematurely","The iframe being monitored was closed prematurely.")},t.createSilentLogoutUnsupportedError=function(){return new t("silent_logout_unsupported","Silent logout not supported. Please call logoutRedirect or logoutPopup instead.")},t.createNoAccountError=function(){return new t("no_account_error","No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.")},t.createSilentPromptValueError=function(e){return new t("silent_prompt_value_error","The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'. Given value: "+e)},t.createUnableToParseTokenRequestCacheError=function(){return new t("unable_to_parse_token_request_cache_error","The cached token request could not be parsed.")},t.createNoTokenRequestCacheError=function(){return new t("no_token_request_cache_error","No token request found in cache.")},t.createAuthRequestNotSetError=function(){return new t("auth_request_not_set_error","Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler")},t.createNoCachedAuthorityError=function(){return new t("no_cached_authority_error","No cached authority found.")},t.createInvalidCacheTypeError=function(){return new t("invalid_cache_type","Invalid cache type")},t.createNonBrowserEnvironmentError=function(){return new t("non_browser_environment","Login and token requests are not supported in non-browser environments.")},t.createDatabaseNotOpenError=function(){return new t("database_not_open","Database is not open!")},t.createNoNetworkConnectivityError=function(){return new t("no_network_connectivity","No network connectivity. Check your internet connection.")},t.createPostRequestFailedError=function(e,r){return new t("post_request_failed","Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA' | Network client threw: "+e+" | Attempted to reach: "+r.split("?")[0])},t.createGetRequestFailedError=function(e,r){return new t("get_request_failed","Network request failed. Please check the network trace to determine root cause. | Network client threw: "+e+" | Attempted to reach: "+r.split("?")[0])},t.createFailedToParseNetworkResponseError=function(e){return new t("failed_to_parse_response","Failed to parse network response. Check network trace. | Attempted to reach: "+e.split("?")[0])},t.createUnableToLoadTokenError=function(e){return new t("unable_to_load_token","Error loading token to cache. | "+e)},t.createSigningKeyNotFoundInStorageError=function(e){return new t(It,"Cryptographic Key or Keypair not found in browser storage. | No match found for KeyId: "+e)},t.createAuthCodeRequiredError=function(){return new t("auth_code_required","An authorization code must be provided (as the `code` property on the request) to this flow.")},t.createAuthCodeOrNativeAccountIdRequiredError=function(){return new t("auth_code_or_nativeAccountId_required","An authorization code or nativeAccountId must be provided to this flow.")},t.createSpaCodeAndNativeAccountIdPresentError=function(){return new t("spa_code_and_nativeAccountId_present","Request cannot contain both spa code and native account id.")},t.createDatabaseUnavailableError=t.createUnableToAcquireTokenFromNativePlatformError=function(){return new t("unable_to_acquire_token_from_native_platform","Unable to acquire token from native platform. For a list of possible reasons visit aka.ms/msaljs/browser-errors.")},t.createNativeHandshakeTimeoutError=function(){return new t("native_handshake_timeout","Timed out while attempting to establish connection to browser extension")},t.createNativeExtensionNotInstalledError=function(){return new t("native_extension_not_installed","Native extension is not installed. If you think this is a mistake call the initialize function.")},t.createNativeConnectionNotEstablishedError=function(){return new t("native_connection_not_established","Connection to native platform has not been established. Please install a compatible browser extension and run initialize(). For more please visit aka.ms/msaljs/browser-errors.")},t.createNativeBrokerCalledBeforeInitialize=function(){return new t("native_broker_called_before_initialize","You must call and await the initialize function before attempting to call any other MSAL API when native brokering is enabled. For more please visit aka.ms/msaljs/browser-errors.")},t.createNativePromptParameterNotSupportedError=function(){return new t("native_prompt_not_supported","The provided prompt is not supported by the native platform. This request should be routed to the web based flow.")},t}(ie),kt=function(e){eturn Ke(t,e),t.createRedirectUriEmptyError=function(){return new t("redirect_uri_empty","A redirect URI is required for all calls, and none has been set.")},t.createPostLogoutRedirectUriEmptyError=function(){return new t("post_logout_uri_empty","A post logout redirect has not been set.")},t.createStorageNotSupportedError=function(e){return new t("storage_not_supported","Given storage configuration option was not supported. Given Location: "+e)},t.createRedirectCallbacksNotSetError=function(){return new t("no_redirect_callbacks","No redirect callbacks have been set. Please call setRedirectCallbacks() with the appropriate function arguments before continuing. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics.")},t.createStubPcaInstanceCalledError=function(){return new t("stubbed_public_client_application_called","Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors")},t.createInMemoryRedirectUnavailableError=function(){return new t("in_mem_redirect_unavailable","Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true.")},t.createEntropyNotProvided=t}(ie),St=function(){eturn e.prototype.validateWindowStorage=function(e){if(e!==j.LocalStorage&&e!==j.SessionStorage)throw kt.createStorageNotSupportedError(e);if(!window[e])throw kt.createStorageNotSupportedError(e)},e.prototype.getItem=function(e){return this.windowStorage.getItem(e)},e.prototype.setItem=function(e,t){this.windowStorage.setItem(e,t)},e.prototype.removeItem=function(e){this.windowStorage.removeItem(e)},e.prototype.getKeys=function(){return Object.keys(this.windowStorage)},e.prototype.containsKey=function(e){return this.windowStorage.hasOwnProperty(e)},e}(),Rt=),At=function(){eturn Object.defineProperty(e.prototype,"urlString",{get:function(){return this._urlString},enumerable:!1,configurable:!0}),e.canonicalizeUri=e.prototype.validateAsUri=e.appendQueryString=e.removeHashFromUrl=e.prototype.replaceTenantPath=e.prototype.getHash=e.prototype.getUrlComponents=e.getDomainFromUrl=e.getAbsoluteUrl=e.parseHash=function(e){var t=e.indexOf("#"),r=e.indexOf("#/");return r>-1?e.substring(r+2):t>-1?e.substring(t+1):m.EMPTY_STRING},e.parseQueryString=e.constructAuthorityUriFromObject=e.getDeserializedHash=function(t){if(et.isEmpty(t))return{};var r=e.parseHash(t),n=et.queryStringToObject(et.isEmpty(r)?t:r);if(!n)throw Je.createHashNotDeserializedError(JSON.stringify(n));return n},e.getDeserializedQueryString=e.hashContainsKnownProperties=e}(),Pt=),Nt=function(e){eturn Ke(t,e),t.prototype.setupBrowserStorage=t.prototype.setupTemporaryCacheStorage=function(e,t){switch(t){case j.LocalStorage:case j.SessionStorage:try{return new St(e||j.SessionStorage)}catch(e){return this.logger.verbose(e),this.internalStorage}case j.MemoryStorage:default:return this.internalStorage}},t.prototype.migrateCacheEntries=function(){var e=this,t=m.CACHE_PREFIX+"."+h.CLIENT_INFO,r=m.CACHE_PREFIX+"."+h.ERROR,n=m.CACHE_PREFIX+"."+h.ERROR_DESC,o=[this.browserStorage.getItem(m.CACHE_PREFIX+"."+h.ID_TOKEN),this.browserStorage.getItem(t),this.browserStorage.getItem(r),this.browserStorage.getItem(n)];[h.ID_TOKEN,h.CLIENT_INFO,h.ERROR,h.ERROR_DESC].forEach(()},t.prototype.migrateCacheEntry=t.prototype.createKeyMaps=function(){var e=this;this.logger.trace("BrowserCacheManager - createKeyMaps called.");var t=this.getItem(Y.ACCOUNT_KEYS),r=this.getItem(Y.TOKEN_KEYS+"."+this.clientId);t&&r?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach((function(t){var r;if(e.isCredentialKey(t)&&(r=e.getItem(t))){var n=e.validateAndParseJson(r);if(n&&n.hasOwnProperty("credentialType"))switch(n.credentialType){case b.ID_TOKEN:if(Ze.isIdTokenEntity(n)){e.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),e.logger.tracePii("BrowserCacheManager:createKeyMaps - idToken with key: "+t+" found, saving key to token key map");var o=ut.toObject(new Ze,n),i=e.updateCredentialCacheKey(t,o);return void e.addTokenKey(i,b.ID_TOKEN)}e.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),e.logger.tracePii("BrowserCacheManager:createKeyMaps - failed idToken validation on key: "+t);break;case b.ACCESS_TOKEN:case b.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(ht.isAccessTokenEntity(n)){e.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),e.logger.tracePii("BrowserCacheManager:createKeyMaps - accessToken with key: "+t+" found, saving key to token key map");var a=ut.toObject(new ht,n);return i=e.updateCredentialCacheKey(t,a),void e.addTokenKey(i,b.ACCESS_TOKEN)}e.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),e.logger.tracePii("BrowserCacheManager:createKeyMaps - failed accessToken validation on key: "+t);break;case b.REFRESH_TOKEN:if(pt.isRefreshTokenEntity(n)){e.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),e.logger.tracePii("BrowserCacheManager:createKeyMaps - refreshToken with key: "+t+" found, saving key to token key map");var s=ut.toObject(new pt,n);return i=e.updateCredentialCacheKey(t,s),void e.addTokenKey(i,b.REFRESH_TOKEN)}e.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),e.logger.tracePii("BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: "+t)}}if(e.isAccountKey(t)&&(r=e.getItem(t))){var c=e.validateAndParseJson(r);c&&it.isAccountEntity(c)&&(e.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),e.logger.tracePii("BrowserCacheManager:createKeyMaps - account with key: "+t+" found, saving key to account key map"),e.addAccountKeyToMap(t))}}))},t.prototype.validateAndParseJson=t.prototype.getItem=function(e){return this.browserStorage.getItem(e)},t.prototype.setItem=function(e,t){this.browserStorage.setItem(e,t)},t.prototype.getAccount=function(e){this.logger.trace("BrowserCacheManager.getAccount called");var t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;var r=this.validateAndParseJson(t);return r&&it.isAccountEntity(r)?ut.toObject(new it,r):(this.removeAccountKeyFromMap(e),null)},t.prototype.setAccount=t.prototype.getAccountKeys=function(){this.logger.trace("BrowserCacheManager.getAccountKeys called");var e=this.getItem(Y.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])},t.prototype.addAccountKeyToMap=function(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii("BrowserCacheManager.addAccountKeyToMap called with key: "+e);var t=this.getAccountKeys();-1===t.indexOf(e)?(t.push(e),this.setItem(Y.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")},t.prototype.removeAccountKeyFromMap=function(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii("BrowserCacheManager.removeAccountKeyFromMap called with key: "+e);var t=this.getAccountKeys(),r=t.indexOf(e);r>-1?(t.splice(r,1),this.setItem(Y.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")},t.prototype.removeAccount=function(t){return je(this,void 0,void 0,(function(){return ze(this,()}))},t.prototype.removeIdToken=function(t){e.prototype.removeIdToken.call(this,t),this.removeTokenKey(t,b.ID_TOKEN)},t.prototype.removeAccessToken=function(t){return je(this,void 0,void 0,(function(){return ze(this,(function(r){return e.prototype.removeAccessToken.call(this,t),this.removeTokenKey(t,b.ACCESS_TOKEN),[2]}))}))},t.prototype.removeRefreshToken=function(t){e.prototype.removeRefreshToken.call(this,t),this.removeTokenKey(t,b.REFRESH_TOKEN)},t.prototype.getTokenKeys=function(){this.logger.trace("BrowserCacheManager.getTokenKeys called");var e=this.getItem(Y.TOKEN_KEYS+"."+this.clientId);if(e){var t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}},t.prototype.addTokenKey=function(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");var r=this.getTokenKeys();switch(t){case b.ID_TOKEN:-1===r.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case b.ACCESS_TOKEN:-1===r.accessToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),r.accessToken.push(e));break;case b.REFRESH_TOKEN:-1===r.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:this.logger.error("BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: "+t),Je.createUnexpectedCredentialTypeError()}this.setItem(Y.TOKEN_KEYS+"."+this.clientId,JSON.stringify(r))},t.prototype.removeTokenKey=function(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");var r=this.getTokenKeys();switch(t){case b.ID_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: "+e+" from map");var n=r.idToken.indexOf(e);n>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(n,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case b.ACCESS_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: "+e+" from map");var o=r.accessToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case b.REFRESH_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: "+e+" from map");var i=r.refreshToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:this.logger.error("BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: "+t),Je.createUnexpectedCredentialTypeError()}this.setItem(Y.TOKEN_KEYS+"."+this.clientId,JSON.stringify(r))},t.prototype.getIdTokenCredential=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,b.ID_TOKEN),null;var r=this.validateAndParseJson(t);return r&&Ze.isIdTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),ut.toObject(new Ze,r)):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,b.ID_TOKEN),null)},t.prototype.setIdTokenCredential=function(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");var t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,b.ID_TOKEN)},t.prototype.getAccessTokenCredential=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,b.ACCESS_TOKEN),null;var r=this.validateAndParseJson(t);return r&&ht.isAccessTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),ut.toObject(new ht,r)):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,b.ACCESS_TOKEN),null)},t.prototype.setAccessTokenCredential=function(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");var t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,b.ACCESS_TOKEN)},t.prototype.getRefreshTokenCredential=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,b.REFRESH_TOKEN),null;var r=this.validateAndParseJson(t);return r&&pt.isRefreshTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),ut.toObject(new pt,r)):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,b.REFRESH_TOKEN),null)},t.prototype.setRefreshTokenCredential=function(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");var t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,b.REFRESH_TOKEN)},t.prototype.getAppMetadata=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&ft.isAppMetadataEntity(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),ut.toObject(new ft,r)):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)},t.prototype.setAppMetadata=t.prototype.getServerTelemetry=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&gt.isServerTelemetryEntity(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),ut.toObject(new gt,r)):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)},t.prototype.setServerTelemetry=function(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))},t.prototype.getAuthorityMetadata=t.prototype.getAuthorityMetadataKeys=t.prototype.setWrapperMetadata=t.prototype.getWrapperMetadata=function(){return[this.internalStorage.getItem(W.WRAPPER_SKU)||m.EMPTY_STRING,this.internalStorage.getItem(W.WRAPPER_VER)||m.EMPTY_STRING]},t.prototype.setAuthorityMetadata=t.prototype.getActiveAccount=t.prototype.setActiveAccount=function(e){var t=this.generateCacheKey(h.ACTIVE_ACCOUNT_FILTERS),r=this.generateCacheKey(h.ACTIVE_ACCOUNT);e?(this.logger.verbose("setActiveAccount: Active account set"),this.browserStorage.setItem(t,JSON.stringify({homeAccountId:e.homeAccountId,localAccountId:e.localAccountId})),this.browserStorage.setItem(r,e.localAccountId)):(this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(r))},t.prototype.getAccountInfoByFilter=function(e){var t=this.getAllAccounts();return this.logger.trace("BrowserCacheManager.getAccountInfoByFilter: total "+t.length+" accounts found"),t.filter(()},t.prototype.getAccountInfoByHints=function(e,t){var r=this.getAllAccounts().filter((function(r){return t?t===(r.idTokenClaims&&r.idTokenClaims.sid):!!e&&e===r.username}));if(1===r.length)return r[0];if(r.length>1)throw Je.createMultipleMatchingAccountsInCacheError();return null},t.prototype.getThrottlingCache=t.prototype.setThrottlingCache=t.prototype.getTemporaryCache=t.prototype.setTemporaryCache=t.prototype.removeItem=t.prototype.containsKey=t.prototype.getKeys=t.prototype.clear=t.prototype.clearTokensAndKeysWithClaims=function(){return je(this,void 0,void 0,(function(){var e,t,r=this;return ze(this,(function(n){switch(n.label){case 0:return this.logger.trace("BrowserCacheManager.clearTokensAndKeysWithClaims called"),e=this.getTokenKeys(),t=[],e.accessToken.forEach((function(e){var n=r.getAccessTokenCredential(e);(null==n?void 0:n.requestedClaimsHash)&&e.includes(n.requestedClaimsHash.toLowerCase())&&t.push(r.removeAccessToken(e))})),[4,Promise.all(t)];case 1:return n.sent(),t.length>0&&this.logger.warning(t.length+" access tokens with claims in the cache keys have been removed from the cache."),[2]}}))}))},t.prototype.setItemCookie=function(e,t,r){var n=encodeURIComponent(e)+"="+encodeURIComponent(t)+";path=/;SameSite=Lax;";r&&(n+="expires="+this.getCookieExpirationTime(r)+";"),this.cacheConfig.secureCookies&&(n+="Secure;"),document.cookie=n},t.prototype.getItemCookie=function(e){for(var t=encodeURIComponent(e)+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return decodeURIComponent(o.substring(t.length,o.length))}return m.EMPTY_STRING},t.prototype.clearMsalCookies=function(){var e=this,t=m.CACHE_PREFIX+"."+this.clientId;document.cookie.split(";").forEach(()},t.prototype.clearItemCookie=t.prototype.getCookieExpirationTime=t.prototype.getCache=function(){return this.browserStorage},t.prototype.setCache=function(){},t.prototype.generateCacheKey=function(e){return this.validateAndParseJson(e)?JSON.stringify(e):et.startsWith(e,m.CACHE_PREFIX)||et.startsWith(e,h.ADAL_ID_TOKEN)?e:m.CACHE_PREFIX+"."+this.clientId+"."+e},t.prototype.generateAuthorityKey=function(e){var t=yt.parseRequestState(this.cryptoImpl,e).libraryState.id;return this.generateCacheKey(Q.AUTHORITY+"."+t)},t.prototype.generateNonceKey=function(e){var t=yt.parseRequestState(this.cryptoImpl,e).libraryState.id;return this.generateCacheKey(Q.NONCE_IDTOKEN+"."+t)},t.prototype.generateStateKey=t.prototype.getCachedAuthority=t.prototype.updateCacheEntries=function(e,t,r,n,o){this.logger.trace("BrowserCacheManager.updateCacheEntries called");var i=this.generateStateKey(e);this.setTemporaryCache(i,e,!1);var a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);var s=this.generateAuthorityKey(e);if(this.setTemporaryCache(s,r,!1),o){var c={credential:o.homeAccountId,type:ot.HOME_ACCOUNT_ID};this.setTemporaryCache(Q.CCS_CREDENTIAL,JSON.stringify(c),!0)}else et.isEmpty(n)||(c={credential:n,type:ot.UPN},this.setTemporaryCache(Q.CCS_CREDENTIAL,JSON.stringify(c),!0))},t.prototype.resetRequestCache=t.prototype.cleanRequestByState=t.prototype.cleanRequestByInteractionType=t.prototype.cacheCodeRequest=t.prototype.getCachedRequest=t.prototype.getCachedNativeRequest=function(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");var e=this.getTemporaryCache(Q.NATIVE_REQUEST,!0);return e?this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)},t.prototype.isInteractionInProgress=t.prototype.getInteractionInProgress=function(){return this.getTemporaryCache(m.CACHE_PREFIX+"."+Q.INTERACTION_STATUS_KEY,!1)},t.prototype.setInteractionInProgress=t.prototype.getLegacyLoginHint=t.prototype.updateCredentialCacheKey=t.prototype.getRedirectRequestContext=t.prototype.setRedirectRequestContext=t}(ut);!Ct||(Ct={})),Tt||(Tt={}));var Ot,Mt=new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status"]);!Ot||(Ot={}));var qt,Ut=function(){function e(t,r,n){this.level=Ot.Info;var o=t||e.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||function(){},this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level="number"==typeof o.logLevel?o.logLevel:Ot.Info,this.correlationId=o.correlationId||m.EMPTY_STRING,this.packageName=r||m.EMPTY_STRING,this.packageVersion=n||m.EMPTY_STRING}return e.createDefaultLoggerOptions=e.prototype.clone=e.prototype.logMessage=function(e,t){if(!(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)){var r,n=(new Date).toUTCString();r=et.isEmpty(t.correlationId)?et.isEmpty(this.correlationId)?"["+n+"]":"["+n+"] : ["+this.correlationId+"]":"["+n+"] : ["+t.correlationId+"]",this.executeCallback(t.logLevel,r+" : "+this.packageName+"@"+this.packageVersion+" : "+Ot[t.logLevel]+" - "+e,t.containsPii||!1)}},e.prototype.executeCallback=e.prototype.error=function(e,t){this.logMessage(e,{logLevel:Ot.Error,containsPii:!1,correlationId:t||m.EMPTY_STRING})},e.prototype.errorPii=function(e,t){this.logMessage(e,{logLevel:Ot.Error,containsPii:!0,correlationId:t||m.EMPTY_STRING})},e.prototype.warning=function(e,t){this.logMessage(e,{logLevel:Ot.Warning,containsPii:!1,correlationId:t||m.EMPTY_STRING})},e.prototype.warningPii=function(e,t){this.logMessage(e,{logLevel:Ot.Warning,containsPii:!0,correlationId:t||m.EMPTY_STRING})},e.prototype.info=function(e,t){this.logMessage(e,{logLevel:Ot.Info,containsPii:!1,correlationId:t||m.EMPTY_STRING})},e.prototype.infoPii=function(e,t){this.logMessage(e,{logLevel:Ot.Info,containsPii:!0,correlationId:t||m.EMPTY_STRING})},e.prototype.verbose=function(e,t){this.logMessage(e,{logLevel:Ot.Verbose,containsPii:!1,correlationId:t||m.EMPTY_STRING})},e.prototype.verbosePii=function(e,t){this.logMessage(e,{logLevel:Ot.Verbose,containsPii:!0,correlationId:t||m.EMPTY_STRING})},e.prototype.trace=function(e,t){this.logMessage(e,{logLevel:Ot.Trace,containsPii:!1,correlationId:t||m.EMPTY_STRING})},e.prototype.tracePii=e.prototype.isPiiLoggingEnabled=e}();!qt||(qt={}));var Ht={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},Bt={loggerCallback:piiLoggingEnabled:!1,logLevel:Ot.Info,correlationId:m.EMPTY_STRING},Dt={claimsBasedCachingEnabled:!0},Lt={sendGetRequestAsync:function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){throw ie.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented")}))}))},sendPostRequestAsync:function(){return c(this,void 0,void 0,(function(){return u(this,()}))}},xt={sku:m.SKU,version:ct,cpu:m.EMPTY_STRING,os:m.EMPTY_STRING},Kt={clientSecret:m.EMPTY_STRING,clientAssertion:void 0},Ft={azureCloudInstance:qt.None,tenant:""+m.DEFAULT_COMMON_TENANT},Gt={application:{appName:"",appVersion:""}};function jt(e){return s({clientCapabilities:[],azureCloudOptions:Ft,skipAuthorityMetadataCache:!1},e)}var zt,Qt=ie),Yt=function(){function e(){}return e.generateThrottlingStorageKey=e.preProcess=function(t,r){var n,o=e.generateThrottlingStorageKey(r),i=t.getThrottlingCache(o);if(i){if(i.throttleTime<Date.now())return void t.removeItem(o);throw new Qt((null===(n=i.errorCodes)||void 0===n?void 0:n.join(" "))||m.EMPTY_STRING,i.errorMessage,i.subError)}},e.postProcess=e.checkResponseStatus=e.checkResponseForRetryAfter=function(e){return!!e.headers&&e.headers.hasOwnProperty(d.RETRY_AFTER)&&(e.status<200||e.status>=300)},e.calculateThrottleTime=function(e){var t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(1e3*Math.min(r+(t||60),r+3600))},e.removeThrottle=function(e,t,r,n){var o=this.generateThrottlingStorageKey({clientId:t,authority:r.authority,scopes:r.scopes,homeAccountIdentifier:n,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid});e.removeItem(o)},e}(),Wt=function(){function e(e,t){this.networkClient=e,this.cacheManager=t}return e.prototype.sendPostRequest=function(e,t,r){return c(this,void 0,void 0,(function(){var n,o;return u(this,(function(i){switch(i.label){case 0:Yt.preProcess(this.cacheManager,e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.networkClient.sendPostRequestAsync(t,r)];case 2:return n=i.sent(),[3,4];case 3:throw(o=i.sent())instanceof ie?o:Je.createNetworkError(t,o);case 4:return Yt.postProcess(this.cacheManager,e,n),[2,n]}}))}))},e}(),Vt=function(){function e(){}return e.validateRedirectUri=function(e){if(et.isEmpty(e))throw $e.createRedirectUriEmptyError()},e.validatePrompt=function(e){var t=[];for(var r in T)t.push(T[r]);if(t.indexOf(e)<0)throw $e.createInvalidPromptError(e)},e.validateClaims=function(e){try{JSON.parse(e)}catch(e){throw $e.createInvalidClaimsRequestError()}},e.validateCodeChallengeParams=function(e,t){if(et.isEmpty(e)||et.isEmpty(t))throw $e.createInvalidCodeChallengeParamsError();this.validateCodeChallengeMethod(t)},e.validateCodeChallengeMethod=e.sanitizeEQParams=e}(),Jt=function(){function e(){this.parameters=new Map}return e.prototype.addResponseTypeCode=function(){this.parameters.set(f.RESPONSE_TYPE,encodeURIComponent(m.CODE_RESPONSE_TYPE))},e.prototype.addResponseTypeForTokenAndIdToken=e.prototype.addResponseMode=function(e){this.parameters.set(f.RESPONSE_MODE,encodeURIComponent(e||E.QUERY))},e.prototype.addNativeBroker=e.prototype.addScopes=function(e,t){void 0===t&&(t=!0);var r=t?l(e||[],v):e||[],n=new tt(r);this.parameters.set(f.SCOPE,encodeURIComponent(n.printScopes()))},e.prototype.addClientId=function(e){this.parameters.set(f.CLIENT_ID,encodeURIComponent(e))},e.prototype.addRedirectUri=function(e){Vt.validateRedirectUri(e),this.parameters.set(f.REDIRECT_URI,encodeURIComponent(e))},e.prototype.addPostLogoutRedirectUri=function(e){Vt.validateRedirectUri(e),this.parameters.set(f.POST_LOGOUT_URI,encodeURIComponent(e))},e.prototype.addIdTokenHint=function(e){this.parameters.set(f.ID_TOKEN_HINT,encodeURIComponent(e))},e.prototype.addDomainHint=function(e){this.parameters.set(C.DOMAIN_HINT,encodeURIComponent(e))},e.prototype.addLoginHint=function(e){this.parameters.set(C.LOGIN_HINT,encodeURIComponent(e))},e.prototype.addCcsUpn=function(e){this.parameters.set(d.CCS_HEADER,encodeURIComponent("UPN:"+e))},e.prototype.addCcsOid=function(e){this.parameters.set(d.CCS_HEADER,encodeURIComponent("Oid:"+e.uid+"@"+e.utid))},e.prototype.addSid=function(e){this.parameters.set(C.SID,encodeURIComponent(e))},e.prototype.addClaims=function(e,t){var r=this.addClientCapabilitiesToClaims(e,t);Vt.validateClaims(r),this.parameters.set(f.CLAIMS,encodeURIComponent(r))},e.prototype.addCorrelationId=function(e){this.parameters.set(f.CLIENT_REQUEST_ID,encodeURIComponent(e))},e.prototype.addLibraryInfo=e.prototype.addApplicationTelemetry=function(e){(null==e?void 0:e.appName)&&this.parameters.set(f.X_APP_NAME,e.appName),(null==e?void 0:e.appVersion)&&this.parameters.set(f.X_APP_VER,e.appVersion)},e.prototype.addPrompt=function(e){Vt.validatePrompt(e),this.parameters.set(""+f.PROMPT,encodeURIComponent(e))},e.prototype.addState=function(e){et.isEmpty(e)||this.parameters.set(f.STATE,encodeURIComponent(e))},e.prototype.addNonce=function(e){this.parameters.set(f.NONCE,encodeURIComponent(e))},e.prototype.addCodeChallengeParams=function(e,t){if(Vt.validateCodeChallengeParams(e,t),!e||!t)throw $e.createInvalidCodeChallengeParamsError();this.parameters.set(f.CODE_CHALLENGE,encodeURIComponent(e)),this.parameters.set(f.CODE_CHALLENGE_METHOD,encodeURIComponent(t))},e.prototype.addAuthorizationCode=function(e){this.parameters.set(f.CODE,encodeURIComponent(e))},e.prototype.addDeviceCode=function(e){this.parameters.set(f.DEVICE_CODE,encodeURIComponent(e))},e.prototype.addRefreshToken=function(e){this.parameters.set(f.REFRESH_TOKEN,encodeURIComponent(e))},e.prototype.addCodeVerifier=function(e){this.parameters.set(f.CODE_VERIFIER,encodeURIComponent(e))},e.prototype.addClientSecret=function(e){this.parameters.set(f.CLIENT_SECRET,encodeURIComponent(e))},e.prototype.addClientAssertion=function(e){et.isEmpty(e)||this.parameters.set(f.CLIENT_ASSERTION,encodeURIComponent(e))},e.prototype.addClientAssertionType=e.prototype.addOboAssertion=function(e){this.parameters.set(f.OBO_ASSERTION,encodeURIComponent(e))},e.prototype.addRequestTokenUse=function(e){this.parameters.set(f.REQUESTED_TOKEN_USE,encodeURIComponent(e))},e.prototype.addGrantType=function(e){this.parameters.set(f.GRANT_TYPE,encodeURIComponent(e))},e.prototype.addClientInfo=e.prototype.addExtraQueryParameters=e.prototype.addClientCapabilitiesToClaims=e.prototype.addUsername=function(e){this.parameters.set(q.username,encodeURIComponent(e))},e.prototype.addPassword=function(e){this.parameters.set(q.password,encodeURIComponent(e))},e.prototype.addPopToken=function(e){et.isEmpty(e)||(this.parameters.set(f.TOKEN_TYPE,O.POP),this.parameters.set(f.REQ_CNF,encodeURIComponent(e)))},e.prototype.addSshJwk=e.prototype.addServerTelemetry=e.prototype.addThrottling=e.prototype.addLogoutHint=e.prototype.createQueryString=e}(),Xt=function(){function e(e,t){this.config=function(e){var t=e.authOptions,r=e.systemOptions,n=e.loggerOptions,o=e.cacheOptions,i=e.storageInterface,a=e.networkInterface,c=e.cryptoInterface,u=e.clientCredentials,l=e.libraryInfo,d=e.telemetry,h=e.serverTelemetryManager,p=e.persistencePlugin,f=e.serializableCache,g=s(s({},Bt),n);return{authOptions:jt(t),systemOptions:s(s({},Ht),r),loggerOptions:g,cacheOptions:s(s({},Dt),o),storageInterface:i||new lt(t.clientId,Et,new Ut(g)),networkInterface:a||Lt,cryptoInterface:c||Et,clientCredentials:u||Kt,libraryInfo:s(s({},xt),l),telemetry:s(s({},Gt),d),serverTelemetryManager:h||null,persistencePlugin:p||null,serializableCache:f||null}}(e),this.logger=new Ut(this.config.loggerOptions,st,ct),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new Wt(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}return e.prototype.createTokenRequestHeaders=function(e){var t={};if(t[d.CONTENT_TYPE]=m.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case ot.HOME_ACCOUNT_ID:try{var r=nt(e.credential);t[d.CCS_HEADER]="Oid:"+r.uid+"@"+r.utid}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case ot.UPN:t[d.CCS_HEADER]="UPN: "+e.credential}return t},e.prototype.executePostToTokenEndpoint=e.prototype.updateAuthority=e.prototype.createTokenQueryParameters=e}(),Zt=function(){return ();!function(e){e.SW="sw",e.UHW="uhw"}(zt||(zt={}));var $t=function(){function e(e,t){this.cryptoUtils=e,this.performanceClient=t}return e.prototype.generateCnf=function(e){var t,r;return c(this,void 0,void 0,(function(){var n,o,i;return u(this,()}))},e.prototype.generateKid=function(e){var t;return c(this,void 0,void 0,(function(){return u(this,()}))},e.prototype.signPopToken=e.prototype.signPayload=function(e,t,r,n){return c(this,void 0,void 0,(function(){var o,i,a,c,l,d;return u(this,(function(u){switch(u.label){case 0:return o=r.resourceRequestMethod,a=r.shrClaims,c=r.shrNonce,l=(i=r.resourceRequestUri)?new At(i):void 0,d=null==l?void 0:l.getUrlComponents(),[4,this.cryptoUtils.signJwt(s({at:e,ts:dt.nowSeconds(),m:null==o?void 0:o.toUpperCase(),u:null==d?void 0:d.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:null==d?void 0:d.AbsolutePath,q:(null==d?void 0:d.QueryString)?[[],d.QueryString]:void 0,client_claims:a||void 0},n),t,r.correlationId)];case 1:return[2,u.sent()]}}))}))},e}(),er=),tr=function(){eturn e.prototype.validateServerAuthorizationCodeResponse=function(e,t,r){if(!e.state||!t)throw Je.createStateNotFoundError(e.state?"Cached State":"Server State");if(decodeURIComponent(e.state)!==decodeURIComponent(t))throw Je.createStateMismatchError();if(e.error||e.error_description||e.suberror){if(ue.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new ue(e.error||m.EMPTY_STRING,e.error_description,e.suberror,e.timestamp||m.EMPTY_STRING,e.trace_id||m.EMPTY_STRING,e.correlation_id||m.EMPTY_STRING,e.claims||m.EMPTY_STRING);throw new Qt(e.error||m.EMPTY_STRING,e.error_description,e.suberror)}e.client_info&&rt(e.client_info,r)},e.prototype.validateTokenResponse=function(e){if(e.error||e.error_description||e.suberror){if(ue.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new ue(e.error,e.error_description,e.suberror,e.timestamp||m.EMPTY_STRING,e.trace_id||m.EMPTY_STRING,e.correlation_id||m.EMPTY_STRING,e.claims||m.EMPTY_STRING);throw new Qt(e.error,e.error_codes+" - ["+e.timestamp+"]: "+e.error_description+" - Correlation ID: "+e.correlation_id+" - Trace ID: "+e.trace_id,e.suberror)}},e.prototype.handleServerTokenResponse=function(t,r,n,o,i,a,s,l,d){var h;return c(this,void 0,void 0,(function(){var c,p,f,g,v,y;return u(this,(function(u){switch(u.label){case 0:if(null===(h=this.performanceClient)||void 0===h||h.addQueueMeasurement(Ct.HandleServerTokenResponse,t.correlation_id),t.id_token){if(c=new at(t.id_token||m.EMPTY_STRING,this.cryptoObj),i&&!et.isEmpty(i.nonce)&&c.claims.nonce!==i.nonce)throw Je.createNonceMismatchError();if(o.maxAge||0===o.maxAge){if(!(p=c.claims.auth_time))throw Je.createAuthTimeNotFoundError();at.checkMaxAge(p,o.maxAge)}}this.homeAccountIdentifier=it.generateHomeAccountId(t.client_info||m.EMPTY_STRING,r.authorityType,this.logger,this.cryptoObj,c),i&&i.state&&(f=yt.parseRequestState(this.cryptoObj,i.state)),t.key_id=t.key_id||o.sshKid||void 0,g=this.generateCacheRecord(t,r,n,o,c,a,i),u.label=1;case 1:return u.trys.push([1,,5,8]),this.persistencePlugin&&this.serializableCache?(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),v=new er(this.serializableCache,!0),[4,this.persistencePlugin.beforeCacheAccess(v)]):[3,3];case 2:u.sent(),u.label=3;case 3:return!s||l||!g.account||(y=g.account.generateAccountKey(),this.cacheStorage.getAccount(y))?[4,this.cacheStorage.saveCacheRecord(g)]:(this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),[2,e.generateAuthenticationResult(this.cryptoObj,r,g,!1,o,c,f,void 0,d)]);case 4:return u.sent(),[3,8];case 5:return this.persistencePlugin&&this.serializableCache&&v?(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),[4,this.persistencePlugin.afterCacheAccess(v)]):[3,7];case 6:u.sent(),u.label=7;case 7:return[7];case 8:return[2,e.generateAuthenticationResult(this.cryptoObj,r,g,!1,o,c,f,t,d)]}}))}))},e.prototype.generateCacheRecord=function(e,t,r,n,o,i,a){var s,c,u=t.getPreferredCache();if(et.isEmpty(u))throw Je.createInvalidCacheEnvironmentError();!et.isEmpty(e.id_token)&&o&&(s=Ze.createIdTokenEntity(this.homeAccountIdentifier,u,e.id_token||m.EMPTY_STRING,this.clientId,o.claims.tid||m.EMPTY_STRING),c=this.generateAccountEntity(e,o,t,a));var l=null;if(!et.isEmpty(e.access_token)){var d=e.scope?tt.fromString(e.scope):new tt(n.scopes||[]),h=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,p=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,f=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,g=r+h,v=g+p,y=f&&f>0?r+f:void 0;l=ht.createAccessTokenEntity(this.homeAccountIdentifier,u,e.access_token||m.EMPTY_STRING,this.clientId,o?o.claims.tid||m.EMPTY_STRING:t.tenant,d.printScopes(),g,v,this.cryptoObj,y,e.token_type,i,e.key_id,n.claims,n.requestedClaimsHash)}var C=null;et.isEmpty(e.refresh_token)||(C=pt.createRefreshTokenEntity(this.homeAccountIdentifier,u,e.refresh_token||m.EMPTY_STRING,this.clientId,e.foci,i));var T=null;return et.isEmpty(e.foci)||(T=ft.createAppMetadataEntity(this.clientId,u,e.foci)),new Zt(c,s,l,C,T)},e.prototype.generateAccountEntity=function(e,t,r,n){var o=n?n.cloud_graph_host_name:m.EMPTY_STRING,i=n?n.msgraph_host:m.EMPTY_STRING;if(r.authorityType===We.Adfs)return this.logger.verbose("Authority type is ADFS, creating ADFS account"),it.createGenericAccount(this.homeAccountIdentifier,t,r,o,i);if(et.isEmpty(e.client_info)&&"AAD"===r.protocolMode)throw Je.createClientInfoEmptyError();return e.client_info?it.createAccount(e.client_info,this.homeAccountIdentifier,t,r,o,i):it.createGenericAccount(this.homeAccountIdentifier,t,r,o,i)},e.generateAuthenticationResult=function(e,t,r,n,o,i,a,s,l){var d,h,p;return c(this,void 0,void 0,(function(){var c,f,g,v,y,C,T,E,_,I,w;return u(this,(function(u){switch(u.label){case 0:if(c=m.EMPTY_STRING,f=[],g=null,y=m.EMPTY_STRING,!r.accessToken)return[3,4];if(r.accessToken.tokenType!==O.POP)return[3,2];if(C=new $t(e),E=(T=r.accessToken).secret,!(_=T.keyId))throw Je.createKeyIdMissingError();return[4,C.signPopToken(E,_,o)];case 1:return c=u.sent(),[3,3];case 2:c=r.accessToken.secret,u.label=3;case 3:f=tt.fromString(r.accessToken.target).asArray(),g=new Date(1e3*Number(r.accessToken.expiresOn)),v=new Date(1e3*Number(r.accessToken.extendedExpiresOn)),u.label=4;case 4:return r.appMetadata&&(y=r.appMetadata.familyId===P?P:m.EMPTY_STRING),I=(null==i?void 0:i.claims.oid)||(null==i?void 0:i.claims.sub)||m.EMPTY_STRING,w=(null==i?void 0:i.claims.tid)||m.EMPTY_STRING,(null==s?void 0:s.spa_accountid)&&r.account&&(r.account.nativeAccountId=null==s?void 0:s.spa_accountid),[2,{authority:t.canonicalAuthority,uniqueId:I,tenantId:w,scopes:f,account:r.account?r.account.getAccountInfo():null,idToken:i?i.rawToken:m.EMPTY_STRING,idTokenClaims:i?i.claims:{},accessToken:c,fromCache:n,expiresOn:g,correlationId:o.correlationId,requestId:l||m.EMPTY_STRING,extExpiresOn:v,familyId:y,tokenType:(null===(d=r.accessToken)||void 0===d?void 0:d.tokenType)||m.EMPTY_STRING,state:a?a.userRequestState:m.EMPTY_STRING,cloudGraphHostName:(null===(h=r.account)||void 0===h?void 0:h.cloudGraphHostName)||m.EMPTY_STRING,msGraphHost:(null===(p=r.account)||void 0===p?void 0:p.msGraphHost)||m.EMPTY_STRING,code:null==s?void 0:s.spa_code,fromNativeBroker:!1}]}}))}))},e}(),rr=function(e){eturn a(t,e),t.prototype.getAuthCodeUrl=function(e){var t,r;return c(this,void 0,void 0,(function(){var n;return u(this,()}))},t.prototype.acquireToken=function(e,t){var r,n,o,i,a,s;return c(this,void 0,void 0,(function(){var c,l,h,p,f,g,m=this;return u(this,(function(u){switch(u.label){case 0:if(!e||!e.code)throw Je.createTokenRequestCannotBeMadeError();return null===(r=this.performanceClient)||void 0===r||r.addQueueMeasurement(Ct.AuthClientAcquireToken,e.correlationId),c=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement("AuthCodeClientAcquireToken",e.correlationId),this.logger.info("in acquireToken call in auth-code client"),l=dt.nowSeconds(),null===(o=this.performanceClient)||void 0===o||o.setPreQueueTime(Ct.AuthClientExecuteTokenRequest,e.correlationId),[4,this.executeTokenRequest(this.authority,e)];case 1:return h=u.sent(),p=null===(i=h.headers)||void 0===i?void 0:i[d.X_MS_REQUEST_ID],(f=null===(a=h.headers)||void 0===a?void 0:a[d.X_MS_HTTP_VERSION])&&(null==c||c.addStaticFields({httpVerAuthority:f})),(g=new tr(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient)).validateTokenResponse(h.body),null===(s=this.performanceClient)||void 0===s||s.setPreQueueTime(Ct.HandleServerTokenResponse,e.correlationId),[2,g.handleServerTokenResponse(h.body,this.authority,l,e,t,void 0,void 0,void 0,p).then(().catch(()]}}))}))},t.prototype.handleFragmentResponse=t.prototype.getLogoutUri=t.prototype.executeTokenRequest=function(e,t){var r,n;return c(this,void 0,void 0,(function(){var o,i,a,s,c,l;return u(this,(function(u){switch(u.label){case 0:return null===(r=this.performanceClient)||void 0===r||r.addQueueMeasurement(Ct.AuthClientExecuteTokenRequest,t.correlationId),null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(Ct.AuthClientCreateTokenRequestBody,t.correlationId),o=this.createTokenQueryParameters(t),i=At.appendQueryString(e.tokenEndpoint,o),[4,this.createTokenRequestBody(t)];case 1:if(a=u.sent(),s=void 0,t.clientInfo)try{c=rt(t.clientInfo,this.cryptoUtils),s={credential:""+c.uid+w.CLIENT_INFO_SEPARATOR+c.utid,type:ot.HOME_ACCOUNT_ID}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}return l=this.createTokenRequestHeaders(s||t.ccsCredential),[2,this.executePostToTokenEndpoint(i,a,l,{clientId:this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid})]}}))}))},t.prototype.createTokenRequestBody=function(e){var t,r;return c(this,void 0,void 0,(function(){var n,o,i,a,s,c,l,d;return u(this,(function(u){switch(u.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Ct.AuthClientCreateTokenRequestBody,e.correlationId),(n=new Jt).addClientId(this.config.authOptions.clientId),this.includeRedirectUri?n.addRedirectUri(e.redirectUri):Vt.validateRedirectUri(e.redirectUri),n.addScopes(e.scopes),n.addAuthorizationCode(e.code),n.addLibraryInfo(this.config.libraryInfo),n.addApplicationTelemetry(this.config.telemetry.application),n.addThrottling(),this.serverTelemetryManager&&n.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&n.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&n.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion&&(n.addClientAssertion((o=this.config.clientCredentials.clientAssertion).assertion),n.addClientAssertionType(o.assertionType)),n.addGrantType(_.AUTHORIZATION_CODE_GRANT),n.addClientInfo(),e.authenticationScheme!==O.POP?[3,2]:(i=new $t(this.cryptoUtils,this.performanceClient),null===(r=this.performanceClient)||void 0===r||r.setPreQueueTime(Ct.PopTokenGenerateCnf,e.correlationId),[4,i.generateCnf(e)]);case 1:return a=u.sent(),n.addPopToken(a.reqCnfString),[3,3];case 2:if(e.authenticationScheme===O.SSH){if(!e.sshJwk)throw $e.createMissingSshJwkError();n.addSshJwk(e.sshJwk)}u.label=3;case 3:if(s=e.correlationId||this.config.cryptoInterface.createNewGuid(),n.addCorrelationId(s),(!et.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,this.config.authOptions.clientCapabilities),c=void 0,e.clientInfo)try{l=rt(e.clientInfo,this.cryptoUtils),c={credential:""+l.uid+w.CLIENT_INFO_SEPARATOR+l.utid,type:ot.HOME_ACCOUNT_ID}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}else c=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&c)switch(c.type){case ot.HOME_ACCOUNT_ID:try{l=nt(c.credential),n.addCcsOid(l)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case ot.UPN:n.addCcsUpn(c.credential)}return e.tokenBodyParameters&&n.addExtraQueryParameters(e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[f.RETURN_SPA_CODE]||n.addExtraQueryParameters(((d={})[f.RETURN_SPA_CODE]="1",d)),[2,n.createQueryString()]}}))}))},t.prototype.createAuthCodeUrlQueryString=function(e){var t;return c(this,void 0,void 0,(function(){var r,n,o,i,a,s,c;return u(this,(function(u){switch(u.label){case 0:if(null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Ct.AuthClientCreateQueryString,e.correlationId),(r=new Jt).addClientId(this.config.authOptions.clientId),n=l(e.scopes||[],e.extraScopesToConsent||[]),r.addScopes(n),r.addRedirectUri(e.redirectUri),o=e.correlationId||this.config.cryptoInterface.createNewGuid(),r.addCorrelationId(o),r.addResponseMode(e.responseMode),r.addResponseTypeCode(),r.addLibraryInfo(this.config.libraryInfo),r.addApplicationTelemetry(this.config.telemetry.application),r.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&r.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&r.addPrompt(e.prompt),e.domainHint&&r.addDomainHint(e.domainHint),e.prompt!==T.SELECT_ACCOUNT)if(e.sid&&e.prompt===T.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),r.addSid(e.sid);else if(e.account){if(i=this.extractAccountSid(e.account),a=this.extractLoginHint(e.account)){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),r.addLoginHint(a);try{s=nt(e.account.homeAccountId),r.addCcsOid(s)}catch(e){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(i&&e.prompt===T.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),r.addSid(i);try{s=nt(e.account.homeAccountId),r.addCcsOid(s)}catch(e){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),r.addLoginHint(e.loginHint),r.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),r.addLoginHint(e.account.username);try{s=nt(e.account.homeAccountId),r.addCcsOid(s)}catch(e){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),r.addLoginHint(e.loginHint),r.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return e.nonce&&r.addNonce(e.nonce),e.state&&r.addState(e.state),(!et.isEmpty(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.extraQueryParameters&&r.addExtraQueryParameters(e.extraQueryParameters),e.nativeBroker?(r.addNativeBroker(),e.authenticationScheme!==O.POP?[3,2]:[4,new $t(this.cryptoUtils).generateCnf(e)]):[3,2];case 1:c=u.sent(),r.addPopToken(c.reqCnfString),u.label=2;case 2:return[2,r.createQueryString()]}}))}))},t.prototype.createLogoutUrlQueryString=t.prototype.extractAccountSid=function(e){var t;return(null===(t=e.idTokenClaims)||void 0===t?void 0:t.sid)||null},t.prototype.extractLoginHint=t}(Xt);ar or,ir={"https://login.microsoftonline.com/common/":{token_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/common/":{token_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/common/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/common/":{token_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/consumers/":{token_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/consumers/":{token_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/consumers/":{token_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/organizations/":{token_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/organizations/":{token_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/organizations/":{token_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"}},ar={"https://login.microsoftonline.com/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/common/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/consumers/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/organizations/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}};!or||(or={}));var sr,cr,ur=function(){eturn e.prototype.detectRegion=function(t,r){var n,o,i,a;return c(this,void 0,void 0,(function(){var s,c,l,d,h;return u(this,(function(u){switch(u.label){case 0:if(null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(Ct.RegionDiscoveryDetectRegion,this.correlationId),s=t)return[3,8];c=e.IMDS_OPTIONS,u.label=1;case 1:return u.trys.push([1,6,,7]),null===(o=this.performanceClient)||void 0===o||o.setPreQueueTime(Ct.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[4,this.getRegionFromIMDS(m.IMDS_VERSION,c)];case 2:return(l=u.sent()).status===U.httpSuccess&&(s=l.body,r.region_source=H.IMDS),l.status!==U.httpBadRequest?[3,5]:(null===(i=this.performanceClient)||void 0===i||i.setPreQueueTime(Ct.RegionDiscoveryGetCurrentVersion,this.correlationId),[4,this.getCurrentVersion(c)]);case 3:return(d=u.sent())?(null===(a=this.performanceClient)||void 0===a||a.setPreQueueTime(Ct.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[4,this.getRegionFromIMDS(d,c)]):(r.region_source=H.FAILED_AUTO_DETECTION,[2,null]);case 4:(h=u.sent()).status===U.httpSuccess&&(s=h.body,r.region_source=H.IMDS),u.label=5;case 5:return[3,7];case 6:return u.sent(),r.region_source=H.FAILED_AUTO_DETECTION,[2,null];case 7:return[3,9];case 8:r.region_source=H.ENVIRONMENT_VARIABLE,u.label=9;case 9:return s||(r.region_source=H.FAILED_AUTO_DETECTION),[2,s||null]}}))}))},e.prototype.getRegionFromIMDS=function(e,t){var r;return c(this,void 0,void 0,(function(){return u(this,(function(n){return null===(r=this.performanceClient)||void 0===r||r.addQueueMeasurement(Ct.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[2,this.networkInterface.sendGetRequestAsync(m.IMDS_ENDPOINT+"?api-version="+e+"&format=text",t,m.IMDS_TIMEOUT)]}))}))},e.prototype.getCurrentVersion=function(e){var t;return c(this,void 0,void 0,(function(){var r;return u(this,(function(n){switch(n.label){case 0:null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Ct.RegionDiscoveryGetCurrentVersion,this.correlationId),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(m.IMDS_ENDPOINT+"?format=json",e)];case 2:return(r=n.sent()).status===U.httpBadRequest&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?[2,r.body["newest-versions"][0]]:[2,null];case 3:return n.sent(),[2,null];case 4:return[2]}}))}))},e.IMDS_OPTIONS={headers:{Metadata:"true"}},e}(),lr=function(){eturn e.prototype.getAuthorityType=function(e){if(e.HostNameAndPort.endsWith(m.CIAM_AUTH_URL))return We.Ciam;var t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case m.ADFS:return We.Adfs;case m.DSTS:return We.Dsts}return We.Default},Object.defineProperty(e.prototype,"authorityType",{get:enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"protocolMode",{get:function(){return this.authorityOptions.protocolMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canonicalAuthority",{get:set:enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canonicalAuthorityUrlComponents",{get:enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hostnameAndPort",{get:enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tenant",{get:enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"authorizationEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw Je.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw Je.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceCodeEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw Je.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endSessionEndpoint",{get:function(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw Je.createLogoutNotSupportedError();return this.replacePath(this.metadata.end_session_endpoint)}throw Je.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selfSignedJwtAudience",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw Je.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"jwksUri",{get:enumerable:!1,configurable:!0}),e.prototype.canReplaceTenant=function(t){return 1===t.PathSegments.length&&!e.reservedTenantDomains.has(t.PathSegments[0])&&this.getAuthorityType(t)===We.Default&&this.protocolMode===or.AAD},e.prototype.replaceTenant=e.prototype.replacePath=Object.defineProperty(e.prototype,"defaultOpenIdConfigurationEndpoint",{get:enumerable:!1,configurable:!0}),e.prototype.discoveryComplete=e.prototype.resolveEndpointsAsync=function(){var e,t,r;return c(this,void 0,void 0,(function(){var n,o,i,a;return u(this,(function(s){switch(s.label){case 0:return null===(e=this.performanceClient)||void 0===e||e.addQueueMeasurement(Ct.AuthorityResolveEndpointsAsync,this.correlationId),(n=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort))||(n=new mt).updateCanonicalAuthority(this.canonicalAuthority),null===(t=this.performanceClient)||void 0===t||t.setPreQueueTime(Ct.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId),[4,this.updateCloudDiscoveryMetadata(n)];case 1:return o=s.sent(),this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,n.preferred_network),null===(r=this.performanceClient)||void 0===r||r.setPreQueueTime(Ct.AuthorityUpdateEndpointMetadata,this.correlationId),[4,this.updateEndpointMetadata(n)];case 2:return i=s.sent(),o!==R.CACHE&&i!==R.CACHE&&(n.resetExpiresAt(),n.updateCanonicalAuthority(this.canonicalAuthority)),a=this.cacheManager.generateAuthorityMetadataCacheKey(n.preferred_cache),this.cacheManager.setAuthorityMetadata(a,n),this.metadata=n,[2]}}))}))},e.prototype.updateEndpointMetadata=function(e){var t,r,n,o,i,a;return c(this,void 0,void 0,(function(){var s,c;return u(this,(function(u){switch(u.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Ct.AuthorityUpdateEndpointMetadata,this.correlationId),(s=this.getEndpointMetadataFromConfig())?(e.updateEndpointMetadata(s,!1),[2,R.CONFIG]):this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!e.isExpired()?[2,R.CACHE]:(null===(r=this.performanceClient)||void 0===r||r.setPreQueueTime(Ct.AuthorityGetEndpointMetadataFromNetwork,this.correlationId),[4,this.getEndpointMetadataFromNetwork()]);case 1:return(s=u.sent())?(null===(n=this.authorityOptions.azureRegionConfiguration)||void 0===n?void 0:n.azureRegion)?(null===(o=this.performanceClient)||void 0===o||o.setPreQueueTime(Ct.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),[4,this.updateMetadataWithRegionalInformation(s)]):[3,3]:[3,4];case 2:s=u.sent(),u.label=3;case 3:return e.updateEndpointMetadata(s,!0),[2,R.NETWORK];case 4:return!(c=this.getEndpointMetadataFromHardcodedValues())||this.authorityOptions.skipAuthorityMetadataCache?[3,7]:(null===(i=this.authorityOptions.azureRegionConfiguration)||void 0===i?void 0:i.azureRegion)?(null===(a=this.performanceClient)||void 0===a||a.setPreQueueTime(Ct.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),[4,this.updateMetadataWithRegionalInformation(c)]):[3,6];case 5:c=u.sent(),u.label=6;case 6:return e.updateEndpointMetadata(c,!1),[2,R.HARDCODED_VALUES];case 7:throw Je.createUnableToGetOpenidConfigError(this.defaultOpenIdConfigurationEndpoint)}}))}))},e.prototype.isAuthoritySameType=e.prototype.getEndpointMetadataFromConfig=e.prototype.getEndpointMetadataFromNetwork=function(){var e;return c(this,void 0,void 0,(function(){var t,r;return u(this,(function(n){switch(n.label){case 0:null===(e=this.performanceClient)||void 0===e||e.addQueueMeasurement(Ct.AuthorityGetEndpointMetadataFromNetwork,this.correlationId),t={},n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(this.defaultOpenIdConfigurationEndpoint,t)];case 2:return[2,nr((r=n.sent()).body)?r.body:null];case 3:return n.sent(),[2,null];case 4:return[2]}}))}))},e.prototype.getEndpointMetadataFromHardcodedValues=function(){return this.canonicalAuthority in ir?ir[this.canonicalAuthority]:null},e.prototype.updateMetadataWithRegionalInformation=function(t){var r,n,o,i;return c(this,void 0,void 0,(function(){var a,s;return u(this,(function(c){switch(c.label){case 0:return null===(r=this.performanceClient)||void 0===r||r.addQueueMeasurement(Ct.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),(a=null===(n=this.authorityOptions.azureRegionConfiguration)||void 0===n?void 0:n.azureRegion)?a!==m.AZURE_REGION_AUTO_DISCOVER_FLAG?(this.regionDiscoveryMetadata.region_outcome=B.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=a,[2,e.replaceWithRegionalInformation(t,a)]):(null===(o=this.performanceClient)||void 0===o||o.setPreQueueTime(Ct.RegionDiscoveryDetectRegion,this.correlationId),[4,this.regionDiscovery.detectRegion(null===(i=this.authorityOptions.azureRegionConfiguration)||void 0===i?void 0:i.environmentRegion,this.regionDiscoveryMetadata)]):[3,2];case 1:if(s=c.sent())return this.regionDiscoveryMetadata.region_outcome=B.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=s,[2,e.replaceWithRegionalInformation(t,s)];this.regionDiscoveryMetadata.region_outcome=B.AUTO_DETECTION_REQUESTED_FAILED,c.label=2;case 2:return[2,t]}}))}))},e.prototype.updateCloudDiscoveryMetadata=function(e){var t,r;return c(this,void 0,void 0,(function(){var n,o,i;return u(this,(function(a){switch(a.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Ct.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId),this.logger.verbose("Attempting to get cloud discovery metadata in the config"),this.logger.verbosePii("Known Authorities: "+(this.authorityOptions.knownAuthorities||m.NOT_APPLICABLE)),this.logger.verbosePii("Authority Metadata: "+(this.authorityOptions.authorityMetadata||m.NOT_APPLICABLE)),this.logger.verbosePii("Canonical Authority: "+(e.canonical_authority||m.NOT_APPLICABLE)),(n=this.getCloudDiscoveryMetadataFromConfig())?(this.logger.verbose("Found cloud discovery metadata in the config."),e.updateCloudDiscoveryMetadata(n,!1),[2,R.CONFIG]):(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the cache."),o=e.isExpired(),this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!o?(this.logger.verbose("Found metadata in the cache."),[2,R.CACHE]):(o&&this.logger.verbose("The metadata entity is expired."),this.logger.verbose("Did not find cloud discovery metadata in the cache... Attempting to get cloud discovery metadata from the network."),null===(r=this.performanceClient)||void 0===r||r.setPreQueueTime(Ct.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId),[4,this.getCloudDiscoveryMetadataFromNetwork()]));case 1:if(n=a.sent())return this.logger.verbose("cloud discovery metadata was successfully returned from getCloudDiscoveryMetadataFromNetwork()"),e.updateCloudDiscoveryMetadata(n,!0),[2,R.NETWORK];if(this.logger.verbose("Did not find cloud discovery metadata from the network... Attempting to get cloud discovery metadata from hardcoded values."),(i=this.getCloudDiscoveryMetadataFromHarcodedValues())&&!this.options.skipAuthorityMetadataCache)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),e.updateCloudDiscoveryMetadata(i,!1),[2,R.HARDCODED_VALUES];throw this.logger.error("Did not find cloud discovery metadata from hardcoded values... Metadata could not be obtained from config, cache, network or hardcoded values. Throwing Untrusted Authority Error."),$e.createUntrustedAuthorityError()}}))}))},e.prototype.getCloudDiscoveryMetadataFromConfig=function(){if(this.authorityType===We.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),e.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");var t=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),r=e.getCloudDiscoveryMetadataFromNetworkResponse(t.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),r)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),r;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch(e){throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),$e.createInvalidCloudDiscoveryMetadataError()}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),e.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null},e.prototype.getCloudDiscoveryMetadataFromNetwork=function(){var t;return c(this,void 0,void 0,(function(){var r,n,o,i,a,s,c,l;return u(this,(function(u){switch(u.label){case 0:null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Ct.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId),r=""+m.AAD_INSTANCE_DISCOVERY_ENDPT+this.canonicalAuthority+"oauth2/v2.0/authorize",n={},o=null,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(r,n)];case 2:if(i=u.sent(),a=void 0,s=void 0,function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(i.body))s=(a=i.body).metadata,this.logger.verbosePii("tenant_discovery_endpoint is: "+a.tenant_discovery_endpoint);else{if(!i.body))return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),[2,null];if(this.logger.warning("A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: "+i.status),(a=i.body).error===m.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),[2,null];this.logger.warning("The CloudInstanceDiscoveryErrorResponse error is "+a.error),this.logger.warning("The CloudInstanceDiscoveryErrorResponse error description is "+a.error_description),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),s=[]}return this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),o=e.getCloudDiscoveryMetadataFromNetworkResponse(s,this.hostnameAndPort),[3,4];case 3:return c=u.sent(),this.logger.error(c instanceof ie?"There was a network error while attempting to get the cloud discovery instance metadata.\nError: "+c.errorCode+"\nError Description: "+c.errorMessage:"A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: "+(l=c).name+"\nError Description: "+l.message),[2,null];case 4:return o||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),o=e.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),[2,o]}}))}))},e.prototype.getCloudDiscoveryMetadataFromHarcodedValues=e.prototype.isInKnownAuthorities=e.generateAuthority=function(e,t){var r;return t&&t.azureCloudInstance!==qt.None&&(r=t.azureCloudInstance+"/"+(t.tenant?t.tenant:m.DEFAULT_COMMON_TENANT)+"/"),r||e},e.createCloudDiscoveryMetadataFromHost=e.getCloudDiscoveryMetadataFromNetworkResponse=e.prototype.getPreferredCache=e.prototype.isAlias=e.isPublicCloudAuthority=e.buildRegionalAuthorityString=e.replaceWithRegionalInformation=e.transformCIAMAuthority=function(e){var t=e.endsWith(m.FORWARD_SLASH)?e:""+e+m.FORWARD_SLASH,r=new At(e).getUrlComponents();return 0===r.PathSegments.length&&r.HostNameAndPort.endsWith(m.CIAM_AUTH_URL)&&(t=""+t+r.HostNameAndPort.split(".")[0]+m.AAD_TENANT_DOMAIN_SUFFIX),t},e.reservedTenantDomains=new Set(["{tenant}","{tenantid}",p.COMMON,p.CONSUMERS,p.ORGANIZATIONS]),e}(),dr=function(){function e(){}return e.createDiscoveredInstance=function(t,r,n,o,i,a,s){return c(this,void 0,void 0,(function(){var c,l,d;return u(this,(function(u){switch(u.label){case 0:null==a||a.addQueueMeasurement(Ct.AuthorityFactoryCreateDiscoveredInstance,s),c=lr.transformCIAMAuthority(t),l=e.createInstance(c,r,n,o,i,a,s),u.label=1;case 1:return u.trys.push([1,3,,4]),null==a||a.setPreQueueTime(Ct.AuthorityResolveEndpointsAsync,s),[4,l.resolveEndpointsAsync()];case 2:return u.sent(),[2,l];case 3:throw d=u.sent(),Je.createEndpointDiscoveryIncompleteError(d);case 4:return[2]}}))}))},e.createInstance=function(e,t,r,n,o,i,a){if(et.isEmpty(e))throw $e.createUrlEmptyError();return new lr(e,t,r,n,o,i,a)},e}(),hr=function(){eturn e.prototype.generateCurrentRequestHeaderValue=function(){var e=""+this.apiId+M.VALUE_SEPARATOR+this.cacheOutcome,t=[this.wrapperSKU,this.wrapperVer].join(M.VALUE_SEPARATOR),r=[e,this.getRegionDiscoveryFields()].join(M.VALUE_SEPARATOR);return[M.SCHEMA_VERSION,r,t].join(M.CATEGORY_SEPARATOR)},e.prototype.generateLastRequestHeaderValue=e.prototype.cacheFailedRequest=e.prototype.incrementCacheHits=e.prototype.getLastRequests=e.prototype.clearTelemetryCache=e.maxErrorsToSend=function(e){var t,r=0,n=0,o=e.errors.length;for(t=0;t<o;t++){var i=e.failedRequests[2*t+1]||m.EMPTY_STRING,a=e.errors[t]||m.EMPTY_STRING;if(!((n+=(e.failedRequests[2*t]||m.EMPTY_STRING).toString().length+i.toString().length+a.length+3)<M.MAX_LAST_HEADER_BYTES))break;r+=1}return r},e.prototype.getRegionDiscoveryFields=e.prototype.updateRegionDiscoveryMetadata=e.prototype.setCacheOutcome=e}(),pr="@azure/msal-browser",fr="2.38.2",gr=),mr=function(){function e(){}return e.prototype.sendGetRequestAsync=function(e,t){return je(this,void 0,void 0,(function(){return ze(this,(function(r){return[2,this.sendRequestAsync(e,z.GET,t)]}))}))},e.prototype.sendPostRequestAsync=e.prototype.sendRequestAsync=function(e,t,r){var n=this;return new Promise((function(o,i){var a=new XMLHttpRequest;if(a.open(t,e,!0),n.setXhrHeaders(a,r),a.onload=function(){(a.status<200||a.status>=300)&&i(t===z.POST?bt.createPostRequestFailedError("Failed with status "+a.status,e):bt.createGetRequestFailedError("Failed with status "+a.status,e));try{var r=JSON.parse(a.responseText),s={headers:n.getHeaderDict(a),body:r,status:a.status};o(s)}catch(t){i(bt.createFailedToParseNetworkResponseError(e))}},a.onerror=function(){window.navigator.onLine?i(t===z.POST?bt.createPostRequestFailedError("Failed with status "+a.status,e):bt.createGetRequestFailedError("Failed with status "+a.status,e)):i(bt.createNoNetworkConnectivityError())},t===z.POST&&r&&r.body)a.send(r.body);else{if(t!==z.GET)throw bt.createHttpMethodNotImplementedError(t);a.send()}}))},e.prototype.setXhrHeaders=e.prototype.getHeaderDict=e}(),vr=function(){eturn e.clearHash=function(e){e.location.hash=m.EMPTY_STRING,"function"==typeof e.history.replaceState&&e.history.replaceState(null,m.EMPTY_STRING,""+e.location.origin+e.location.pathname+e.location.search)},e.replaceHash=e.isInIframe=e.isInPopup=function(){return"undefined"!=typeof window&&!!window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(Z.POPUP_NAME_PREFIX+".")},e.getCurrentUri=e.getHomepage=e.getBrowserNetworkClient=e.blockReloadInHiddenIframes=e.blockRedirectInIframe=e.blockAcquireTokenInPopups=e.blockNonBrowserEnvironment=e.blockNativeBrokerCalledBeforeInitialized=e.detectIEOrEdge=e}(),yr=function(){eturn e.prototype.clearCacheOnLogout=e.prototype.initializeBaseRequest=function(e,t){return je(this,void 0,void 0,(function(){var r,n,o,i;return ze(this,(function(a){switch(a.label){case 0:return this.performanceClient.addQueueMeasurement(Ct.InitializeBaseRequest,e.correlationId),this.logger.verbose("Initializing BaseAuthRequest"),r=e.authority||this.config.auth.authority,t?[4,this.validateRequestAuthority(r,t)]:[3,2];case 1:a.sent(),a.label=2;case 2:if(n=Ye(e&&e.scopes||[]),(o=Fe(Fe({},e),{correlationId:this.correlationId,authority:r,scopes:n})).authenticationScheme){if(o.authenticationScheme===O.SSH){if(!e.sshJwk)throw $e.createMissingSshJwkError();if(!e.sshKid)throw $e.createMissingSshKidError()}this.logger.verbose('Authentication Scheme set to "'+o.authenticationScheme+'" as configured in Auth request')}else o.authenticationScheme=O.BEARER,this.logger.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return this.config.cache.claimsBasedCachingEnabled&&e.claims&&!et.isEmptyObj(e.claims)?(i=o,[4,this.browserCrypto.hashString(e.claims)]):[3,4];case 3:i.requestedClaimsHash=a.sent(),a.label=4;case 4:return[2,o]}}))}))},e.prototype.getRedirectUri=e.prototype.validateRequestAuthority=function(e,t){return je(this,void 0,void 0,(function(){return ze(this,()}))},e.prototype.initializeServerTelemetryManager=e.prototype.getDiscoveredAuthority=function(e){return je(this,void 0,void 0,(function(){var t;return ze(this,(function(r){switch(r.label){case 0:return this.logger.verbose("getDiscoveredAuthority called"),t={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata},e?(this.logger.verbose("Creating discovered authority with request authority"),[4,dr.createDiscoveredInstance(e,this.config.system.networkClient,this.browserStorage,t,this.logger)]):[3,2];case 1:return[2,r.sent()];case 2:return this.logger.verbose("Creating discovered authority with configured authority"),[4,dr.createDiscoveredInstance(this.config.auth.authority,this.config.system.networkClient,this.browserStorage,t,this.logger)];case 3:return[2,r.sent()]}}))}))},e}(),Cr=function(e){eturn Ke(t,e),t.prototype.initializeAuthorizationCodeRequest=function(e){return je(this,void 0,void 0,(function(){var t,r;return ze(this,(function(n){switch(n.label){case 0:return this.performanceClient.addQueueMeasurement(Ct.StandardInteractionClientInitializeAuthorizationCodeRequest,e.correlationId),this.logger.verbose("initializeAuthorizationRequest called",e.correlationId),[4,this.browserCrypto.generatePkceCodes()];case 1:return t=n.sent(),r=Fe(Fe({},e),{redirectUri:e.redirectUri,code:m.EMPTY_STRING,codeVerifier:t.verifier}),e.codeChallenge=t.challenge,e.codeChallengeMethod=m.S256_CODE_CHALLENGE_METHOD,[2,r]}}))}))},t.prototype.initializeLogoutRequest=function(e){this.logger.verbose("initializeLogoutRequest called",null==e?void 0:e.correlationId);var t=Fe({correlationId:this.correlationId||this.browserCrypto.createNewGuid()},e);if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){var r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=At.getAbsoluteUrl(e.postLogoutRedirectUri,vr.getCurrentUri())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=At.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,vr.getCurrentUri())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=At.getAbsoluteUrl(vr.getCurrentUri(),vr.getCurrentUri())),t},t.prototype.getLogoutHintFromIdTokenClaims=t.prototype.createAuthCodeClient=function(e,t,r){return je(this,void 0,void 0,(function(){var n;return ze(this,()}))},t.prototype.getClientConfiguration=function(e,t,r){return je(this,void 0,void 0,(function(){var n,o;return ze(this,(function(i){switch(i.label){case 0:return this.performanceClient.addQueueMeasurement(Ct.StandardInteractionClientGetClientConfiguration,this.correlationId),this.logger.verbose("getClientConfiguration called",this.correlationId),this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),[4,this.getDiscoveredAuthority(t,r)];case 1:return n=i.sent(),[2,{authOptions:{clientId:this.config.auth.clientId,authority:n,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:(o=this.config.system.loggerOptions).loggerCallback,piiLoggingEnabled:o.piiLoggingEnabled,logLevel:o.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:e,libraryInfo:{sku:Z.MSAL_SKU,version:fr,cpu:m.EMPTY_STRING,os:m.EMPTY_STRING},telemetry:this.config.telemetry}]}}))}))},t.prototype.validateAndExtractStateFromHash=t.prototype.getDiscoveredAuthority=function(e,t){var r;return je(this,void 0,void 0,(function(){var n,o,i;return ze(this,(function(a){switch(a.label){case 0:return this.performanceClient.addQueueMeasurement(Ct.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),this.logger.verbose("getDiscoveredAuthority called",this.correlationId),n=null===(r=this.performanceClient)||void 0===r?void 0:r.startMeasurement(Ct.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),o={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},i=lr.generateAuthority(e||this.config.auth.authority,t||this.config.auth.azureCloudOptions),this.logger.verbose("Creating discovered authority with configured authority",this.correlationId),this.performanceClient.setPreQueueTime(Ct.AuthorityFactoryCreateDiscoveredInstance,this.correlationId),[4,dr.createDiscoveredInstance(i,this.config.system.networkClient,this.browserStorage,o,this.logger,this.performanceClient,this.correlationId).then(().catch(()];case 1:return[2,a.sent()]}}))}))},t.prototype.initializeAuthorizationRequest=function(e,t){return je(this,void 0,void 0,(function(){var r,n,o,i,a,s;return ze(this,(function(c){switch(c.label){case 0:return this.performanceClient.addQueueMeasurement(Ct.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId),this.logger.verbose("initializeAuthorizationRequest called",this.correlationId),r=this.getRedirectUri(e.redirectUri),n=yt.setRequestState(this.browserCrypto,e&&e.state||m.EMPTY_STRING,{interactionType:t}),this.performanceClient.setPreQueueTime(Ct.InitializeBaseRequest,this.correlationId),i=[{}],[4,this.initializeBaseRequest(e)];case 1:return o=Fe.apply(void 0,[Fe.apply(void 0,i.concat([c.sent()])),{redirectUri:r,state:n,nonce:e.nonce||this.browserCrypto.createNewGuid(),responseMode:E.FRAGMENT}]),(a=e.account||this.browserStorage.getActiveAccount())&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii("Setting validated request account: "+a.homeAccountId,this.correlationId),o.account=a),et.isEmpty(o.loginHint)&&!a&&(s=this.browserStorage.getLegacyLoginHint())&&(o.loginHint=s),[2,o]}}))}))},t}(yr),Tr=function(){eturn e.prototype.handleCodeResponseFromHash=function(e,t,r,n){return je(this,void 0,void 0,(function(){var o,i,a;return ze(this,(function(s){if(this.performanceClient.addQueueMeasurement(Ct.HandleCodeResponseFromHash,this.authCodeRequest.correlationId),this.logger.verbose("InteractionHandler.handleCodeResponse called"),et.isEmpty(e))throw bt.createEmptyHashError(e);if(o=this.browserStorage.generateStateKey(t),!(i=this.browserStorage.getTemporaryCache(o)))throw Je.createStateNotFoundError("Cached State");try{a=this.authModule.handleFragmentResponse(e,i)}catch(e){throw e instanceof Qt&&e.subError===_t?bt.createUserCancelledError():e}return this.performanceClient.setPreQueueTime(Ct.HandleCodeResponseFromServer,this.authCodeRequest.correlationId),[2,this.handleCodeResponseFromServer(a,t,r,n)]}))}))},e.prototype.handleCodeResponseFromServer=function(e,t,r,n,o){return void 0===o&&(o=!0),je(this,void 0,void 0,(function(){var i,a,s,c,u,l;return ze(this,(function(d){switch(d.label){case 0:if(this.performanceClient.addQueueMeasurement(Ct.HandleCodeResponseFromServer,this.authCodeRequest.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),i=this.browserStorage.generateStateKey(t),!(a=this.browserStorage.getTemporaryCache(i)))throw Je.createStateNotFoundError("Cached State");return s=this.browserStorage.generateNonceKey(a),c=this.browserStorage.getTemporaryCache(s),this.authCodeRequest.code=e.code,e.cloud_instance_host_name?(this.performanceClient.setPreQueueTime(Ct.UpdateTokenEndpointAuthority,this.authCodeRequest.correlationId),[4,this.updateTokenEndpointAuthority(e.cloud_instance_host_name,r,n)]):[3,2];case 1:d.sent(),d.label=2;case 2:return o&&(e.nonce=c||void 0),e.state=a,e.client_info?this.authCodeRequest.clientInfo=e.client_info:(u=this.checkCcsCredentials())&&(this.authCodeRequest.ccsCredential=u),this.performanceClient.setPreQueueTime(Ct.AuthClientAcquireToken,this.authCodeRequest.correlationId),[4,this.authModule.acquireToken(this.authCodeRequest,e)];case 3:return l=d.sent(),this.browserStorage.cleanRequestByState(t),[2,l]}}))}))},e.prototype.updateTokenEndpointAuthority=function(e,t,r){return je(this,void 0,void 0,(function(){var n;return ze(this,(function(o){switch(o.label){case 0:return this.performanceClient.addQueueMeasurement(Ct.UpdateTokenEndpointAuthority,this.authCodeRequest.correlationId),[4,dr.createDiscoveredInstance("https://"+e+"/"+t.tenant+"/",r,this.browserStorage,t.options,this.logger,this.performanceClient,this.authCodeRequest.correlationId)];case 1:return n=o.sent(),this.authModule.updateAuthority(n),[2]}}))}))},e.prototype.checkCcsCredentials=e}(),Er=function(e){eturn Ke(t,e),t.prototype.initiateAuthRequest=function(e,t){return je(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(n.label){case 0:return this.logger.verbose("RedirectHandler.initiateAuthRequest called"),et.isEmpty(e)?[3,7]:(t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(Q.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(Q.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest,this.browserCrypto),this.logger.infoPii("RedirectHandler.initiateAuthRequest: Navigate to: "+e),r={apiId:V.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1},"function"!=typeof t.onRedirectNavigate?[3,4]:(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1===t.onRedirectNavigate(e)?[3,2]:(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),[4,t.navigationClient.navigateExternal(e,r)])));case 1:return n.sent(),[2];case 2:return this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation"),[2];case 3:return[3,6];case 4:return this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),[4,t.navigationClient.navigateExternal(e,r)];case 5:return n.sent(),[2];case 6:return[3,8];case 7:throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),bt.createEmptyNavigationUriError();case 8:return[2]}}))}))},t.prototype.handleCodeResponseFromHash=function(e,t,r,n){return je(this,void 0,void 0,(function(){var o,i,a,s,c,u,l;return ze(this,(function(d){switch(d.label){case 0:if(this.logger.verbose("RedirectHandler.handleCodeResponse called"),et.isEmpty(e))throw bt.createEmptyHashError(e);if(this.browserStorage.setInteractionInProgress(!1),o=this.browserStorage.generateStateKey(t),!(i=this.browserStorage.getTemporaryCache(o)))throw Je.createStateNotFoundError("Cached State");try{a=this.authModule.handleFragmentResponse(e,i)}catch(e){throw e instanceof Qt&&e.subError===_t?bt.createUserCancelledError():e}return s=this.browserStorage.generateNonceKey(i),c=this.browserStorage.getTemporaryCache(s),this.authCodeRequest.code=a.code,a.cloud_instance_host_name?[4,this.updateTokenEndpointAuthority(a.cloud_instance_host_name,r,n)]:[3,2];case 1:d.sent(),d.label=2;case 2:return a.nonce=c||void 0,a.state=i,a.client_info?this.authCodeRequest.clientInfo=a.client_info:(u=this.checkCcsCredentials())&&(this.authCodeRequest.ccsCredential=u),[4,this.authModule.acquireToken(this.authCodeRequest,a)];case 3:return l=d.sent(),this.browserStorage.cleanRequestByState(t),[2,l]}}))}))},t}(Tr);!sr||(sr={})),function(e){e.USER_INTERACTION_REQUIRED="USER_INTERACTION_REQUIRED",e.USER_CANCEL="USER_CANCEL",e.NO_NETWORK="NO_NETWORK",e.TRANSIENT_ERROR="TRANSIENT_ERROR",e.PERSISTENT_ERROR="PERSISTENT_ERROR",e.DISABLED="DISABLED",e.ACCOUNT_UNAVAILABLE="ACCOUNT_UNAVAILABLE"}(cr||(cr={}));var _r,Ir=function(e){eturn Ke(t,e),t.prototype.isFatal=function(){if(this.ext&&this.ext.status&&(this.ext.status===cr.PERSISTENT_ERROR||this.ext.status===cr.DISABLED))return!0;switch(this.errorCode){case"ContentError":return!0;default:return!1}},t.createError=t.createUserSwitchError=function(){return new t("user_switch","User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again.")},t.createTokensNotFoundInCacheError=function(){return new t("tokens_not_found_in_internal_memory_cache","Tokens not cached in MSAL JS internal memory, please make the WAM request")},t}(ie),wr=function(e){function t(t,r){return e.call(this,t,r)||this}return a(t,e),t.prototype.acquireToken=function(e){var t,r,n,o,i,a,s;return c(this,void 0,void 0,(function(){var c,l,h,p,f,g,m=this;return u(this,(function(u){switch(u.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Ct.RefreshTokenClientAcquireToken,e.correlationId),c=null===(r=this.performanceClient)||void 0===r?void 0:r.startMeasurement(Ct.RefreshTokenClientAcquireToken,e.correlationId),this.logger.verbose("RefreshTokenClientAcquireToken called",e.correlationId),l=dt.nowSeconds(),null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(Ct.RefreshTokenClientExecuteTokenRequest,e.correlationId),[4,this.executeTokenRequest(e,this.authority)];case 1:return h=u.sent(),p=null===(o=h.headers)||void 0===o?void 0:o[d.X_MS_HTTP_VERSION],null==c||c.addStaticFields({refreshTokenSize:(null===(i=h.body.refresh_token)||void 0===i?void 0:i.length)||0}),p&&(null==c||c.addStaticFields({httpVerToken:p})),f=null===(a=h.headers)||void 0===a?void 0:a[d.X_MS_REQUEST_ID],(g=new tr(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin)).validateTokenResponse(h.body),null===(s=this.performanceClient)||void 0===s||s.setPreQueueTime(Ct.HandleServerTokenResponse,e.correlationId),[2,g.handleServerTokenResponse(h.body,this.authority,l,e,void 0,void 0,!0,e.forceCache,f).then((function(e){return null==c||c.endMeasurement({success:!0}),e})).catch((function(t){throw m.logger.verbose("Error in fetching refresh token",e.correlationId),null==c||c.endMeasurement({errorCode:t.errorCode,subErrorCode:t.subError,success:!1}),t}))]}}))}))},t.prototype.acquireTokenByRefreshToken=function(e){var t,r,n,o;return c(this,void 0,void 0,(function(){var i;return u(this,(function(a){if(!e)throw $e.createEmptyTokenRequestError();if(null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Ct.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw Je.createNoAccountInSilentRequestError();if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return null===(r=this.performanceClient)||void 0===r||r.setPreQueueTime(Ct.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),[2,this.acquireTokenWithCachedRefreshToken(e,!0)]}catch(t){if(i=t instanceof Qt&&t.errorCode===K&&t.subError===F,t instanceof ue&&t.errorCode===ce||i)return null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(Ct.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),[2,this.acquireTokenWithCachedRefreshToken(e,!1)];throw t}return null===(o=this.performanceClient)||void 0===o||o.setPreQueueTime(Ct.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),[2,this.acquireTokenWithCachedRefreshToken(e,!1)]}))}))},t.prototype.acquireTokenWithCachedRefreshToken=function(e,t){var r,n,o;return c(this,void 0,void 0,(function(){var i,a,c;return u(this,(function(u){if(null===(r=this.performanceClient)||void 0===r||r.addQueueMeasurement(Ct.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),i=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement(Ct.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),this.logger.verbose("RefreshTokenClientAcquireTokenWithCachedRefreshToken called",e.correlationId),!(a=this.cacheManager.getRefreshToken(e.account,t)))throw null==i||i.discardMeasurement(),ue.createNoTokensFoundError();return null==i||i.endMeasurement({success:!0}),c=s(s({},e),{refreshToken:a.secret,authenticationScheme:e.authenticationScheme||O.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:ot.HOME_ACCOUNT_ID}}),null===(o=this.performanceClient)||void 0===o||o.setPreQueueTime(Ct.RefreshTokenClientAcquireToken,e.correlationId),[2,this.acquireToken(c)]}))}))},t.prototype.executeTokenRequest=function(e,t){var r,n,o;return c(this,void 0,void 0,(function(){var i,a,s,c,l;return u(this,(function(u){switch(u.label){case 0:return null===(r=this.performanceClient)||void 0===r||r.addQueueMeasurement(Ct.RefreshTokenClientExecuteTokenRequest,e.correlationId),i=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement(Ct.RefreshTokenClientExecuteTokenRequest,e.correlationId),null===(o=this.performanceClient)||void 0===o||o.setPreQueueTime(Ct.RefreshTokenClientCreateTokenRequestBody,e.correlationId),a=this.createTokenQueryParameters(e),s=At.appendQueryString(t.tokenEndpoint,a),[4,this.createTokenRequestBody(e)];case 1:return c=u.sent(),l=this.createTokenRequestHeaders(e.ccsCredential),[2,this.executePostToTokenEndpoint(s,c,l,{clientId:this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid}).then((function(e){return null==i||i.endMeasurement({success:!0}),e})).catch(()]}}))}))},t.prototype.createTokenRequestBody=function(e){var t,r,n;return c(this,void 0,void 0,(function(){var o,i,a,s,c,l,d;return u(this,(function(u){switch(u.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Ct.RefreshTokenClientCreateTokenRequestBody,e.correlationId),o=e.correlationId,i=null===(r=this.performanceClient)||void 0===r?void 0:r.startMeasurement(Ct.BaseClientCreateTokenRequestHeaders,o),(a=new Jt).addClientId(this.config.authOptions.clientId),a.addScopes(e.scopes),a.addGrantType(_.REFRESH_TOKEN_GRANT),a.addClientInfo(),a.addLibraryInfo(this.config.libraryInfo),a.addApplicationTelemetry(this.config.telemetry.application),a.addThrottling(),this.serverTelemetryManager&&a.addServerTelemetry(this.serverTelemetryManager),a.addCorrelationId(o),a.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&a.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion&&(a.addClientAssertion((s=this.config.clientCredentials.clientAssertion).assertion),a.addClientAssertionType(s.assertionType)),e.authenticationScheme!==O.POP?[3,2]:(c=new $t(this.cryptoUtils,this.performanceClient),null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(Ct.PopTokenGenerateCnf,e.correlationId),[4,c.generateCnf(e)]);case 1:return l=u.sent(),a.addPopToken(l.reqCnfString),[3,3];case 2:if(e.authenticationScheme===O.SSH){if(!e.sshJwk)throw null==i||i.endMeasurement({success:!1}),$e.createMissingSshJwkError();a.addSshJwk(e.sshJwk)}u.label=3;case 3:if((!et.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&a.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case ot.HOME_ACCOUNT_ID:try{d=nt(e.ccsCredential.credential),a.addCcsOid(d)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case ot.UPN:a.addCcsUpn(e.ccsCredential.credential)}return null==i||i.endMeasurement({success:!0}),[2,a.createQueryString()]}}))}))},t}(Xt),br=function(e){eturn a(t,e),t.prototype.acquireToken=function(e){return c(this,void 0,void 0,(function(){var t;return u(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.acquireCachedToken(e)];case 1:return[2,r.sent()];case 2:if((t=r.sent())instanceof Je&&t.errorCode===Ve)return[2,new wr(this.config,this.performanceClient).acquireTokenByRefreshToken(e)];throw t;case 3:return[2]}}))}))},t.prototype.acquireCachedToken=function(e){var t,r,n,o,i;return c(this,void 0,void 0,(function(){var a,s;return u(this,(function(c){switch(c.label){case 0:if(!e)throw $e.createEmptyTokenRequestError();if(e.forceRefresh)throw null===(t=this.serverTelemetryManager)||void 0===t||t.setCacheOutcome(D.FORCE_REFRESH),this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because forceRefresh is true."),Je.createRefreshRequiredError();if(!this.config.cacheOptions.claimsBasedCachingEnabled&&!et.isEmptyObj(e.claims))throw null===(r=this.serverTelemetryManager)||void 0===r||r.setCacheOutcome(D.CLAIMS_REQUESTED_CACHE_SKIPPED),this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because claims-based caching is disabled and claims were requested."),Je.createRefreshRequiredError();if(!e.account)throw Je.createNoAccountInSilentRequestError();if(a=e.authority||this.authority.getPreferredCache(),!(s=this.cacheManager.readCacheRecord(e.account,e,a)).accessToken)throw null===(n=this.serverTelemetryManager)||void 0===n||n.setCacheOutcome(D.NO_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - No access token found in cache for the given properties."),Je.createRefreshRequiredError();if(dt.wasClockTurnedBack(s.accessToken.cachedAt)||dt.isTokenExpired(s.accessToken.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw null===(o=this.serverTelemetryManager)||void 0===o||o.setCacheOutcome(D.CACHED_ACCESS_TOKEN_EXPIRED),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token is expired or will expire within "+this.config.systemOptions.tokenRenewalOffsetSeconds+" seconds."),Je.createRefreshRequiredError();if(s.accessToken.refreshOn&&dt.isTokenExpired(s.accessToken.refreshOn,0))throw null===(i=this.serverTelemetryManager)||void 0===i||i.setCacheOutcome(D.REFRESH_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'."),Je.createRefreshRequiredError();return this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[4,this.generateResultFromCacheRecord(s,e)];case 1:return[2,c.sent()]}}))}))},t.prototype.generateResultFromCacheRecord=function(e,t){return c(this,void 0,void 0,(function(){var r,n;return u(this,(function(o){switch(o.label){case 0:if(e.idToken&&(r=new at(e.idToken.secret,this.config.cryptoInterface)),t.maxAge||0===t.maxAge){if(!(n=null==r?void 0:r.claims.auth_time))throw Je.createAuthTimeNotFoundError();at.checkMaxAge(n,t.maxAge)}return[4,tr.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)];case 1:return[2,o.sent()]}}))}))},t}(Xt),kr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ke(t,e),t.prototype.acquireToken=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i;return ze(this,(function(a){switch(a.label){case 0:return t=this.performanceClient.startMeasurement(Ct.SilentCacheClientAcquireToken,e.correlationId),r=this.initializeServerTelemetryManager(V.acquireTokenSilent_silentFlow),[4,this.createSilentFlowClient(r,e.authority,e.azureCloudOptions)];case 1:n=a.sent(),this.logger.verbose("Silent auth client created"),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,n.acquireCachedToken(e)];case 3:return o=a.sent(),t.endMeasurement({success:!0,fromCache:!0}),[2,o];case 4:throw(i=a.sent())instanceof bt&&i.errorCode===It&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),t.endMeasurement({errorCode:i instanceof ie&&i.errorCode||void 0,subErrorCode:i instanceof ie&&i.subError||void 0,success:!1}),i;case 5:return[2]}}))}))},t.prototype.logout=function(){return Promise.reject(bt.createSilentLogoutUnsupportedError())},t.prototype.createSilentFlowClient=function(e,t,r){return je(this,void 0,void 0,(function(){var n;return ze(this,(function(o){switch(o.label){case 0:return this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientGetClientConfiguration,this.correlationId),[4,this.getClientConfiguration(e,t,r)];case 1:return n=o.sent(),[2,new br(n,this.performanceClient)]}}))}))},t.prototype.initializeSilentRequest=function(e,t){return je(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(n.label){case 0:return this.performanceClient.addQueueMeasurement(Ct.InitializeSilentRequest,this.correlationId),this.performanceClient.setPreQueueTime(Ct.InitializeBaseRequest,this.correlationId),r=[Fe({},e)],[4,this.initializeBaseRequest(e,t)];case 1:return[2,Fe.apply(void 0,[Fe.apply(void 0,r.concat([n.sent()])),{account:t,forceRefresh:e.forceRefresh||!1}])]}}))}))},t}(Cr),Sr=function(e){eturn Ke(t,e),t.prototype.acquireToken=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a;return ze(this,(function(s){switch(s.label){case 0:return this.logger.trace("NativeInteractionClient - acquireToken called."),t=this.performanceClient.startMeasurement(Ct.NativeInteractionClientAcquireToken,e.correlationId),r=dt.nowSeconds(),[4,this.initializeNativeRequest(e)];case 1:n=s.sent(),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,this.acquireTokensFromCache(this.accountId,n)];case 3:return o=s.sent(),t.endMeasurement({success:!0,isNativeBroker:!1,fromCache:!0}),[2,o];case 4:return s.sent(),this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call"),[3,5];case 5:return[4,this.nativeMessageHandler.sendMessage({method:G.GetToken,request:n})];case 6:return i=s.sent(),a=this.validateNativeResponse(i),[2,this.handleNativeResponse(a,n,r).then((function(e){return t.endMeasurement({success:!0,isNativeBroker:!0,requestId:e.requestId}),e})).catch(()]}}))}))},t.prototype.createSilentCacheRequest=t.prototype.acquireTokensFromCache=function(e,t){return je(this,void 0,void 0,(function(){var r,n;return ze(this,(function(o){switch(o.label){case 0:if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),Je.createNoAccountFoundError();if(!(r=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:e})))throw Je.createNoAccountFoundError();o.label=1;case 1:return o.trys.push([1,3,,4]),n=this.createSilentCacheRequest(t,r),[4,this.silentCacheClient.acquireToken(n)];case 2:return[2,o.sent()];case 3:throw o.sent();case 4:return[2]}}))}))},t.prototype.acquireTokenRedirect=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a;return ze(this,(function(s){switch(s.label){case 0:return this.logger.trace("NativeInteractionClient - acquireTokenRedirect called."),[4,this.initializeNativeRequest(e)];case 1:t=s.sent(),r={method:G.GetToken,request:t},s.label=2;case 2:return s.trys.push([2,4,,5]),[4,this.nativeMessageHandler.sendMessage(r)];case 3:return n=s.sent(),this.validateNativeResponse(n),[3,5];case 4:if((o=s.sent())instanceof Ir&&o.isFatal())throw o;return[3,5];case 5:return this.browserStorage.setTemporaryCache(Q.NATIVE_REQUEST,JSON.stringify(t),!0),i={apiId:V.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri),[4,this.navigationClient.navigateExternal(a,i)];case 6:return s.sent(),[2]}}))}))},t.prototype.handleRedirectPromise=function(){return je(this,void 0,void 0,(function(){var e,t,r,n,o,i,a,s;return ze(this,(function(c){switch(c.label){case 0:if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),[2,null];if(!(e=this.browserStorage.getCachedNativeRequest()))return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),[2,null];t=e.prompt,r=Ge(e,["prompt"]),t&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Q.NATIVE_REQUEST)),n={method:G.GetToken,request:r},o=dt.nowSeconds(),c.label=1;case 1:return c.trys.push([1,3,,4]),this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker."),[4,this.nativeMessageHandler.sendMessage(n)];case 2:return i=c.sent(),this.validateNativeResponse(i),a=this.handleNativeResponse(i,r,o),this.browserStorage.setInteractionInProgress(!1),[2,a];case 3:throw s=c.sent(),this.browserStorage.setInteractionInProgress(!1),s;case 4:return[2]}}))}))},t.prototype.logout=t.prototype.handleNativeResponse=function(e,t,r){return je(this,void 0,void 0,(function(){var n,o,i,a,s,c;return ze(this,(function(u){switch(u.label){case 0:if(this.logger.trace("NativeInteractionClient - handleNativeResponse called."),e.account.id!==t.accountId)throw Ir.createUserSwitchError();return[4,this.getDiscoveredAuthority(t.authority)];case 1:return n=u.sent(),o=n.getPreferredCache(),i=this.createIdTokenObj(e),a=this.createHomeAccountIdentifier(e,i),s=this.createAccountEntity(e,a,i,o),[4,this.generateAuthenticationResult(e,t,i,s,n.canonicalAuthority,r)];case 2:return c=u.sent(),this.cacheAccount(s),this.cacheNativeTokens(e,t,a,s,i,c.accessToken,c.tenantId,r),[2,c]}}))}))},t.prototype.createIdTokenObj=function(e){return new at(e.id_token||m.EMPTY_STRING,this.browserCrypto)},t.prototype.createHomeAccountIdentifier=function(e,t){return it.generateHomeAccountId(e.client_info||m.EMPTY_STRING,We.Default,this.logger,this.browserCrypto,t)},t.prototype.createAccountEntity=function(e,t,r,n){return it.createAccount(e.client_info,t,r,void 0,void 0,void 0,n,e.account.id)},t.prototype.generateScopes=function(e,t){return tt.fromString(e.scope?e.scope:t.scope)},t.prototype.generatePopAccessToken=function(e,t){return je(this,void 0,void 0,(function(){var r,n;return ze(this,(function(o){switch(o.label){case 0:if(t.tokenType!==O.POP)return[3,2];if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),[2,e.shr];if(r=new $t(this.browserCrypto),n={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce},!t.keyId)throw Je.createKeyIdMissingError();return[4,r.signPopToken(e.access_token,t.keyId,n)];case 1:return[2,o.sent()];case 2:return[2,e.access_token]}}))}))},t.prototype.generateAuthenticationResult=function(e,t,r,n,o,i){return je(this,void 0,void 0,(function(){var a,s,c,u,l,d,h;return ze(this,(function(p){switch(p.label){case 0:return a=this.addTelemetryFromNativeResponse(e),s=tt.fromString(e.scope?e.scope:t.scope),u=(c=e.account.properties||{}).UID||r.claims.oid||r.claims.sub||m.EMPTY_STRING,l=c.TenantId||r.claims.tid||m.EMPTY_STRING,[4,this.generatePopAccessToken(e,t)];case 1:return d=p.sent(),h=t.tokenType===O.POP?O.POP:O.BEARER,[2,{authority:o,uniqueId:u,tenantId:l,scopes:s.asArray(),account:n.getAccountInfo(),idToken:e.id_token,idTokenClaims:r.claims,accessToken:d,fromCache:!!a&&this.isResponseFromCache(a),expiresOn:new Date(1e3*Number(i+e.expires_in)),tokenType:h,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}]}}))}))},t.prototype.cacheAccount=t.prototype.cacheNativeTokens=function(e,t,r,n,o,i,a,s){var c=Ze.createIdTokenEntity(r,t.authority,e.id_token||m.EMPTY_STRING,t.clientId,o.claims.tid||m.EMPTY_STRING),u=s+(t.tokenType===O.POP?m.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),l=this.generateScopes(e,t),d=ht.createAccessTokenEntity(r,t.authority,i,t.clientId,o?o.claims.tid||m.EMPTY_STRING:a,l.printScopes(),u,0,this.browserCrypto),h=new Zt(n,c,d);this.nativeStorageManager.saveCacheRecord(h)},t.prototype.addTelemetryFromNativeResponse=t.prototype.validateNativeResponse=t.prototype.getMATSFromResponse=t.prototype.isResponseFromCache=t.prototype.initializeNativeRequest=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a,s,c,u,l=this;return ze(this,(function(d){switch(d.label){case 0:return this.logger.trace("NativeInteractionClient - initializeNativeRequest called"),t=e.authority||this.config.auth.authority,e.account?[4,this.validateRequestAuthority(t,e.account)]:[3,2];case 1:d.sent(),d.label=2;case 2:return(r=new At(t)).validateAsUri(),n=e.scopes,o=Ge(e,["scopes"]),(i=new tt(n||[])).appendScopes(v),a=function(){switch(l.apiId){case V.ssoSilent:case V.acquireTokenSilent_silentFlow:return l.logger.trace("initializeNativeRequest: silent request sets prompt to none"),T.NONE}if(e.prompt)switch(e.prompt){case T.NONE:case T.CONSENT:case T.LOGIN:return l.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw l.logger.trace("initializeNativeRequest: prompt = "+e.prompt+" is not compatible with native flow"),bt.createNativePromptParameterNotSupportedError()}else l.logger.trace("initializeNativeRequest: prompt was not provided")},s=Fe(Fe({},o),{accountId:this.accountId,clientId:this.config.auth.clientId,authority:r.urlString,scope:i.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:a(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:Fe(Fe(Fe({},e.extraQueryParameters),e.tokenQueryParameters),{telemetry:"MATS"}),extendedExpiryToken:!1}),e.authenticationScheme!==O.POP?[3,4]:(c={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},[4,new $t(this.browserCrypto).generateCnf(c)]);case 3:u=d.sent(),s.reqCnf=u.reqCnfString,s.keyId=u.kid,d.label=4;case 4:return[2,s]}}))}))},t}(yr),Rr=function(){eturn e.prototype.sendMessage=function(e){return je(this,void 0,void 0,(function(){var t,r=this;return ze(this,(function(n){return this.logger.trace("NativeMessageHandler - sendMessage called."),t={channel:$,extensionId:this.extensionId,responseId:this.responseId++,body:e},this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii("NativeMessageHandler - Sending request to browser extension: "+JSON.stringify(t)),this.messageChannel.port1.postMessage(t),[2,new Promise(()]}))}))},e.createProvider=function(t,r,n){return je(this,void 0,void 0,(function(){var o,i;return ze(this,(function(a){switch(a.label){case 0:t.trace("NativeMessageHandler - createProvider called."),a.label=1;case 1:return a.trys.push([1,3,,5]),[4,(o=new e(t,r,n,"ppnbnpeolgkicgegkbkbjmhlideopiji")).sendHandshakeRequest()];case 2:return a.sent(),[2,o];case 3:return a.sent(),[4,(i=new e(t,r,n)).sendHandshakeRequest()];case 4:return a.sent(),[2,i];case 5:return[2]}}))}))},e.prototype.sendHandshakeRequest=function(){return je(this,void 0,void 0,(function(){var e,t=this;return ze(this,(function(r){return this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1),e={channel:$,extensionId:this.extensionId,responseId:this.responseId++,body:{method:G.HandshakeRequest}},this.handshakeEvent.addStaticFields({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=window.postMessage(e,window.origin,[this.messageChannel.port2]),[2,new Promise(()]}))}))},e.prototype.onWindowMessage=function(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source===window){var t=e.data;if(t.channel&&t.channel===$&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===G.HandshakeRequest){this.logger.verbose(t.extensionId?"Extension with id: "+t.extensionId+" not installed":"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1);var r=this.handshakeResolvers.get(t.responseId);r&&(this.handshakeEvent.endMeasurement({success:!1,extensionInstalled:!1}),r.reject(bt.createNativeExtensionNotInstalledError()))}}},e.prototype.onChannelMessage=function(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");var t=e.data,r=this.resolvers.get(t.responseId),n=this.handshakeResolvers.get(t.responseId);try{var o=t.body.method;if(o===G.Response){if(!r)return;var i=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii("NativeMessageHandler - Received response from browser extension: "+JSON.stringify(i)),"Success"!==i.status)r.reject(Ir.createError(i.code,i.description,i.ext));else{if(!i.result)throw ie.createUnexpectedError("Event does not contain result.");i.result.code&&i.result.description?r.reject(Ir.createError(i.result.code,i.result.description,i.result.ext)):r.resolve(i.result)}this.resolvers.delete(t.responseId)}else if(o===G.HandshakeResponse){if(!n)return;clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose("NativeMessageHandler - Received HandshakeResponse from extension: "+this.extensionId),this.handshakeEvent.endMeasurement({extensionInstalled:!0,success:!0}),n.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(t){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii("Error parsing response from WAM Extension: "+t.toString()),this.logger.errorPii("Unable to parse "+e),r?r.reject(t):n&&n.reject(t)}},e.prototype.getExtensionId=function(){return this.extensionId},e.prototype.getExtensionVersion=function(){return this.extensionVersion},e.isNativeAvailable=e}(),Ar=function(e){function t(t,r,n,o,i,a,s,c,u,l){var d=e.call(this,t,r,n,o,i,a,s,u,l)||this;return d.nativeStorage=c,d}return Ke(t,e),t.prototype.acquireToken=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a,s,c,u,l=this;return ze(this,(function(d){switch(d.label){case 0:return this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId),[4,this.initializeAuthorizationRequest(e,J.Redirect)];case 1:t=d.sent(),this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||m.EMPTY_STRING,t.account||null),r=this.initializeServerTelemetryManager(V.acquireTokenRedirect),n=function(e){e.persisted&&(l.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),l.browserStorage.cleanRequestByState(t.state),l.eventHandler.emitEvent(sr.RESTORE_FROM_BFCACHE,J.Redirect))},d.label=2;case 2:return d.trys.push([2,7,,8]),this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientInitializeAuthorizationCodeRequest,e.correlationId),[4,this.initializeAuthorizationCodeRequest(t)];case 3:return o=d.sent(),this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientCreateAuthCodeClient,e.correlationId),[4,this.createAuthCodeClient(r,t.authority,t.azureCloudOptions)];case 4:return i=d.sent(),this.logger.verbose("Auth code client created"),a=new Er(i,this.browserStorage,o,this.logger,this.browserCrypto,this.performanceClient),[4,i.getAuthCodeUrl(Fe(Fe({},t),{nativeBroker:Rr.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}))];case 5:return s=d.sent(),c=this.getRedirectStartPage(e.redirectStartPage),this.logger.verbosePii("Redirect start page: "+c),window.addEventListener("pageshow",n),[4,a.initiateAuthRequest(s,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:c,onRedirectNavigate:e.onRedirectNavigate})];case 6:return[2,d.sent()];case 7:throw(u=d.sent())instanceof ie&&u.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",n),r.cacheFailedRequest(u),this.browserStorage.cleanRequestByState(t.state),u;case 8:return[2]}}))}))},t.prototype.handleRedirectPromise=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a,s,c,u,l,d,h;return ze(this,(function(p){switch(p.label){case 0:t=this.initializeServerTelemetryManager(V.handleRedirectPromise),p.label=1;case 1:if(p.trys.push([1,10,,11]),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),[2,null];if(!(r=this.getRedirectResponseHash(e||window.location.hash)))return this.logger.info("handleRedirectPromise did not detect a response hash as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(J.Redirect),[2,null];n=void 0;try{o=At.getDeserializedHash(r),n=this.validateAndExtractStateFromHash(o,J.Redirect),this.logger.verbose("State extracted from hash")}catch(e){return this.logger.info("handleRedirectPromise was unable to extract state due to: "+e),this.browserStorage.cleanRequestByInteractionType(J.Redirect),[2,null]}return i=this.browserStorage.getTemporaryCache(Q.ORIGIN_URI,!0)||m.EMPTY_STRING,a=At.removeHashFromUrl(i),s=At.removeHashFromUrl(window.location.href),a===s&&this.config.auth.navigateToLoginRequestUrl?(this.logger.verbose("Current page is loginRequestUrl, handling hash"),[4,this.handleHash(r,n,t)]):[3,3];case 2:return c=p.sent(),i.indexOf("#")>-1&&vr.replaceHash(i),[2,c];case 3:return this.config.auth.navigateToLoginRequestUrl?[3,4]:(this.logger.verbose("NavigateToLoginRequestUrl set to false, handling hash"),[2,this.handleHash(r,n,t)]);case 4:return vr.isInIframe()&&!this.config.system.allowRedirectInIframe?[3,9]:(this.browserStorage.setTemporaryCache(Q.URL_HASH,r,!0),u={apiId:V.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0},l=!0,i&&"null"!==i?[3,6]:(d=vr.getHomepage(),this.browserStorage.setTemporaryCache(Q.ORIGIN_URI,d,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),[4,this.navigationClient.navigateInternal(d,u)]));case 5:return l=p.sent(),[3,8];case 6:return this.logger.verbose("Navigating to loginRequestUrl: "+i),[4,this.navigationClient.navigateInternal(i,u)];case 7:l=p.sent(),p.label=8;case 8:if(!l)return[2,this.handleHash(r,n,t)];p.label=9;case 9:return[2,null];case 10:throw(h=p.sent())instanceof ie&&h.setCorrelationId(this.correlationId),t.cacheFailedRequest(h),this.browserStorage.cleanRequestByInteractionType(J.Redirect),h;case 11:return[2]}}))}))},t.prototype.getRedirectResponseHash=t.prototype.handleHash=function(e,t,r){return je(this,void 0,void 0,(function(){var n,o,i,a,s,c,u=this;return ze(this,(function(l){switch(l.label){case 0:if(n=this.browserStorage.getCachedRequest(t,this.browserCrypto),this.logger.verbose("handleHash called, retrieved cached request"),(o=At.getDeserializedHash(e)).accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw bt.createNativeConnectionNotEstablishedError();return i=new Sr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,V.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,o.accountId,this.nativeStorage,n.correlationId),a=yt.parseRequestState(this.browserCrypto,t).userRequestState,[2,i.acquireToken(Fe(Fe({},n),{state:a,prompt:void 0})).finally((function(){u.browserStorage.cleanRequestByState(t)}))]}if(!(s=this.browserStorage.getCachedAuthority(t)))throw bt.createNoCachedAuthorityError();return this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientCreateAuthCodeClient,n.correlationId),[4,this.createAuthCodeClient(r,s)];case 1:return c=l.sent(),this.logger.verbose("Auth code client created"),Yt.removeThrottle(this.browserStorage,this.config.auth.clientId,n),[4,new Er(c,this.browserStorage,n,this.logger,this.browserCrypto,this.performanceClient).handleCodeResponseFromHash(e,t,c.authority,this.networkClient)];case 2:return[2,l.sent()]}}))}))},t.prototype.logout=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a;return ze(this,(function(s){switch(s.label){case 0:this.logger.verbose("logoutRedirect called"),t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(V.logout),s.label=1;case 1:return s.trys.push([1,10,,11]),this.eventHandler.emitEvent(sr.LOGOUT_START,J.Redirect,e),[4,this.clearCacheOnLogout(t.account)];case 2:return s.sent(),n={apiId:V.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientCreateAuthCodeClient,t.correlationId),[4,this.createAuthCodeClient(r,e&&e.authority)];case 3:return o=s.sent(),this.logger.verbose("Auth code client created"),i=o.getLogoutUri(t),this.eventHandler.emitEvent(sr.LOGOUT_SUCCESS,J.Redirect,t),e&&"function"==typeof e.onRedirectNavigate?!1===e.onRedirectNavigate(i)?[3,5]:(this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),[4,this.navigationClient.navigateExternal(i,n)]):[3,7];case 4:return s.sent(),[2];case 5:this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation"),s.label=6;case 6:return[3,9];case 7:return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),[4,this.navigationClient.navigateExternal(i,n)];case 8:return s.sent(),[2];case 9:return[3,11];case 10:throw(a=s.sent())instanceof ie&&a.setCorrelationId(this.correlationId),r.cacheFailedRequest(a),this.eventHandler.emitEvent(sr.LOGOUT_FAILURE,J.Redirect,null,a),this.eventHandler.emitEvent(sr.LOGOUT_END,J.Redirect),a;case 11:return this.eventHandler.emitEvent(sr.LOGOUT_END,J.Redirect),[2]}}))}))},t.prototype.getRedirectStartPage=t}(Cr),Pr=function(e){eturn Ke(t,e),t.prototype.acquireToken=t.prototype.logout=t.prototype.acquireTokenPopupAsync=function(e,t,r,n){return je(this,void 0,void 0,(function(){var o,i,a,s,c,u,l,d,h,p,f,g,v,y,C,T=this;return ze(this,(function(E){switch(E.label){case 0:return this.logger.verbose("acquireTokenPopupAsync called"),o=this.initializeServerTelemetryManager(V.acquireTokenPopup),this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId),[4,this.initializeAuthorizationRequest(e,J.Popup)];case 1:i=E.sent(),this.browserStorage.updateCacheEntries(i.state,i.nonce,i.authority,i.loginHint||m.EMPTY_STRING,i.account||null),E.label=2;case 2:return E.trys.push([2,8,,9]),this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientInitializeAuthorizationCodeRequest,e.correlationId),[4,this.initializeAuthorizationCodeRequest(i)];case 3:return a=E.sent(),this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientCreateAuthCodeClient,e.correlationId),[4,this.createAuthCodeClient(o,i.authority,i.azureCloudOptions)];case 4:return s=E.sent(),this.logger.verbose("Auth code client created"),c=Rr.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme),u=void 0,c&&(u=this.performanceClient.startMeasurement(Ct.FetchAccountIdWithNativeBroker,e.correlationId)),[4,s.getAuthCodeUrl(Fe(Fe({},i),{nativeBroker:c}))];case 5:return l=E.sent(),d=new Tr(s,this.browserStorage,a,this.logger,this.performanceClient),h=this.initiateAuthRequest(l,{popup:n,popupName:t,popupWindowAttributes:r}),this.eventHandler.emitEvent(sr.POPUP_OPENED,J.Popup,{popupWindow:h},null),[4,this.monitorPopupForHash(h)];case 6:if(p=E.sent(),f=At.getDeserializedHash(p),g=this.validateAndExtractStateFromHash(f,J.Popup,i.correlationId),Yt.removeThrottle(this.browserStorage,this.config.auth.clientId,a),f.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),u&&u.endMeasurement({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw bt.createNativeConnectionNotEstablishedError();return v=new Sr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,V.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,f.accountId,this.nativeStorage,i.correlationId),y=yt.parseRequestState(this.browserCrypto,g).userRequestState,[2,v.acquireToken(Fe(Fe({},i),{state:y,prompt:void 0})).finally((function(){T.browserStorage.cleanRequestByState(g)}))]}return[4,d.handleCodeResponseFromHash(p,g,s.authority,this.networkClient)];case 7:return[2,E.sent()];case 8:throw C=E.sent(),n&&n.close(),C instanceof ie&&C.setCorrelationId(this.correlationId),o.cacheFailedRequest(C),this.browserStorage.cleanRequestByState(i.state),C;case 9:return[2]}}))}))},t.prototype.logoutPopupAsync=function(e,t,r,n,o,i){return je(this,void 0,void 0,(function(){var a,s,c,u,l,d,h;return ze(this,(function(p){switch(p.label){case 0:this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(sr.LOGOUT_START,J.Popup,e),a=this.initializeServerTelemetryManager(V.logoutPopup),p.label=1;case 1:return p.trys.push([1,5,,6]),[4,this.clearCacheOnLogout(e.account)];case 2:return p.sent(),this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientCreateAuthCodeClient,e.correlationId),[4,this.createAuthCodeClient(a,n)];case 3:return s=p.sent(),this.logger.verbose("Auth code client created"),c=s.getLogoutUri(e),this.eventHandler.emitEvent(sr.LOGOUT_SUCCESS,J.Popup,e),u=this.openPopup(c,{popupName:t,popupWindowAttributes:r,popup:o}),this.eventHandler.emitEvent(sr.POPUP_OPENED,J.Popup,{popupWindow:u},null),[4,this.waitForLogoutPopup(u)];case 4:return p.sent(),i?(l={apiId:V.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},d=At.getAbsoluteUrl(i,vr.getCurrentUri()),this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii("Redirecting main window to: "+d),this.navigationClient.navigateInternal(d,l)):this.logger.verbose("No main window navigation requested"),[3,6];case 5:throw h=p.sent(),o&&o.close(),h instanceof ie&&h.setCorrelationId(this.correlationId),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(sr.LOGOUT_FAILURE,J.Popup,null,h),this.eventHandler.emitEvent(sr.LOGOUT_END,J.Popup),a.cacheFailedRequest(h),h;case 6:return this.eventHandler.emitEvent(sr.LOGOUT_END,J.Popup),[2]}}))}))},t.prototype.initiateAuthRequest=t.prototype.monitorPopupForHash=t.prototype.waitForLogoutPopup=t.prototype.openPopup=function(e,t){try{var r=void 0;if(t.popup?(r=t.popup,this.logger.verbosePii("Navigating popup window to: "+e),r.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii("Opening popup window to: "+e),r=this.openSizedPopup(e,t.popupName,t.popupWindowAttributes)),!r)throw bt.createEmptyWindowCreatedError();return r.focus&&r.focus(),this.currentWindow=r,window.addEventListener("beforeunload",this.unloadWindow),r}catch(e){throw this.logger.error("error opening popup "+e.message),this.browserStorage.setInteractionInProgress(!1),bt.createPopupWindowError(e.toString())}},t.prototype.openSizedPopup=t.prototype.unloadWindow=t.prototype.cleanPopup=t.prototype.generatePopupName=t.prototype.generateLogoutPopupName=function(e){return Z.POPUP_NAME_PREFIX+"."+this.config.auth.clientId+"."+(e.account&&e.account.homeAccountId)+"."+this.correlationId},t}(Cr),Nr={sendGetRequestAsync:function(){return Promise.reject(ie.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented for the Network interface."))},sendPostRequestAsync:,Or=),Mr=6e3,qr=function(e){eturn Ke(t,e),t.prototype.initiateAuthRequest=function(e){return je(this,void 0,void 0,(function(){return ze(this,(function(t){switch(t.label){case 0:if(this.performanceClient.addQueueMeasurement(Ct.SilentHandlerInitiateAuthRequest,this.authCodeRequest.correlationId),et.isEmpty(e))throw this.logger.info("Navigate url is empty"),bt.createEmptyNavigationUriError();return this.navigateFrameWait?(this.performanceClient.setPreQueueTime(Ct.SilentHandlerLoadFrame,this.authCodeRequest.correlationId),[4,this.loadFrame(e)]):[3,2];case 1:return[2,t.sent()];case 2:return[2,this.loadFrameSync(e)]}}))}))},t.prototype.monitorIframeForHash=function(e,t){var r=this;return this.performanceClient.addQueueMeasurement(Ct.SilentHandlerMonitorIframeForHash,this.authCodeRequest.correlationId),new Promise((function(n,o){t<Mr&&r.logger.warning("system.loadFrameTimeout or system.iframeHashTimeout set to lower ("+t+"ms) than the default (6000ms). This may result in timeouts.");var i=window.performance.now()+t,a=setInterval((,r.pollIntervalMilliseconds)}))},t.prototype.loadFrame=t.prototype.loadFrameSync=t.prototype.createHiddenIframe=t.prototype.removeHiddenIframe=t}(Tr),Ur=function(e){eturn Ke(t,e),t.prototype.acquireToken=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i;return ze(this,(function(a){switch(a.label){case 0:if(this.performanceClient.addQueueMeasurement(Ct.SilentIframeClientAcquireToken,e.correlationId),this.logger.verbose("acquireTokenByIframe called"),t=this.performanceClient.startMeasurement(Ct.SilentIframeClientAcquireToken,e.correlationId),et.isEmpty(e.loginHint)&&et.isEmpty(e.sid)&&(!e.account||et.isEmpty(e.account.username))&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request."),e.prompt&&e.prompt!==T.NONE&&e.prompt!==T.NO_SESSION)throw t.endMeasurement({success:!1}),bt.createSilentPromptValueError(e.prompt);return this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId),[4,this.initializeAuthorizationRequest(Fe(Fe({},e),{prompt:e.prompt||T.NONE}),J.Silent)];case 1:r=a.sent(),this.browserStorage.updateCacheEntries(r.state,r.nonce,r.authority,r.loginHint||m.EMPTY_STRING,r.account||null),n=this.initializeServerTelemetryManager(this.apiId),a.label=2;case 2:return a.trys.push([2,5,,6]),this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientCreateAuthCodeClient,e.correlationId),[4,this.createAuthCodeClient(n,r.authority,r.azureCloudOptions)];case 3:return o=a.sent(),this.logger.verbose("Auth code client created"),this.performanceClient.setPreQueueTime(Ct.SilentIframeClientTokenHelper,e.correlationId),[4,this.silentTokenHelper(o,r).then(()];case 4:return[2,a.sent()];case 5:throw(i=a.sent())instanceof ie&&i.setCorrelationId(this.correlationId),n.cacheFailedRequest(i),this.browserStorage.cleanRequestByState(r.state),t.endMeasurement({errorCode:i instanceof ie&&i.errorCode||void 0,subErrorCode:i instanceof ie&&i.subError||void 0,success:!1}),i;case 6:return[2]}}))}))},t.prototype.logout=function(){return Promise.reject(bt.createSilentLogoutUnsupportedError())},t.prototype.silentTokenHelper=function(e,t){return je(this,void 0,void 0,(function(){var r,n,o,i,a,s,c,u,l,d=this;return ze(this,(function(h){switch(h.label){case 0:return this.performanceClient.addQueueMeasurement(Ct.SilentIframeClientTokenHelper,t.correlationId),this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId),[4,this.initializeAuthorizationCodeRequest(t)];case 1:return r=h.sent(),this.performanceClient.setPreQueueTime(Ct.GetAuthCodeUrl,t.correlationId),[4,e.getAuthCodeUrl(Fe(Fe({},t),{nativeBroker:Rr.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}))];case 2:return n=h.sent(),o=new qr(e,this.browserStorage,r,this.logger,this.config.system,this.performanceClient),this.performanceClient.setPreQueueTime(Ct.SilentHandlerInitiateAuthRequest,t.correlationId),[4,o.initiateAuthRequest(n)];case 3:return i=h.sent(),this.performanceClient.setPreQueueTime(Ct.SilentHandlerMonitorIframeForHash,t.correlationId),[4,o.monitorIframeForHash(i,this.config.system.iframeHashTimeout)];case 4:if(a=h.sent(),s=At.getDeserializedHash(a),c=this.validateAndExtractStateFromHash(s,J.Silent,r.correlationId),s.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw bt.createNativeConnectionNotEstablishedError();return u=new Sr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,s.accountId,this.browserStorage,this.correlationId),l=yt.parseRequestState(this.browserCrypto,c).userRequestState,[2,u.acquireToken(Fe(Fe({},t),{state:l,prompt:t.prompt||T.NONE})).finally(()]}return this.performanceClient.setPreQueueTime(Ct.HandleCodeResponseFromHash,t.correlationId),[2,o.handleCodeResponseFromHash(a,c,e.authority,this.networkClient)]}}))}))},t}(Cr),Hr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ke(t,e),t.prototype.acquireToken=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a=this;return ze(this,(function(s){switch(s.label){case 0:return this.performanceClient.addQueueMeasurement(Ct.SilentRefreshClientAcquireToken,e.correlationId),this.performanceClient.setPreQueueTime(Ct.InitializeBaseRequest,e.correlationId),r=[Fe({},e)],[4,this.initializeBaseRequest(e,e.account)];case 1:return t=Fe.apply(void 0,r.concat([s.sent()])),n=this.performanceClient.startMeasurement(Ct.SilentRefreshClientAcquireToken,t.correlationId),o=this.initializeServerTelemetryManager(V.acquireTokenSilent_silentFlow),[4,this.createRefreshTokenClient(o,t.authority,t.azureCloudOptions)];case 2:return i=s.sent(),this.logger.verbose("Refresh token client created"),this.performanceClient.setPreQueueTime(Ct.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),[2,i.acquireTokenByRefreshToken(t).then(().catch(()]}}))}))},t.prototype.logout=function(){return Promise.reject(bt.createSilentLogoutUnsupportedError())},t.prototype.createRefreshTokenClient=function(e,t,r){return je(this,void 0,void 0,(function(){var n;return ze(this,()}))},t}(Cr),Br=function(){eturn e.prototype.addEventCallback=e.prototype.removeEventCallback=e.prototype.enableAccountStorageEvents=e.prototype.disableAccountStorageEvents=e.prototype.emitEvent=e.prototype.handleAccountCacheChange=function(e){try{var t=e.newValue||e.oldValue;if(!t)return;var r=JSON.parse(t);if("object"!=typeof r||!it.isAccountEntity(r))return;var n=ut.toObject(new it,r).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(sr.ACCOUNT_ADDED,void 0,n)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(sr.ACCOUNT_REMOVED,void 0,n))}catch(e){return}},e}(),Dr=function(e){function t(r,n){var o=e.call(this,r,n)||this;return o.name="JoseHeaderError",Object.setPrototypeOf(o,t.prototype),o}return a(t,e),t.createMissingKidError=function(){return new t("missing_kid_error","The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.")},t.createMissingAlgError=function(){return new t("missing_alg_error","The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided.")},t}(ie),Lr=),xr=),Kr=function(){function e(e){this.cryptoObj=e}return e.prototype.generateGuid=function(){try{var e=new Uint8Array(16);return this.cryptoObj.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,xr.decimalToHex(e[0])+xr.decimalToHex(e[1])+xr.decimalToHex(e[2])+xr.decimalToHex(e[3])+"-"+xr.decimalToHex(e[4])+xr.decimalToHex(e[5])+"-"+xr.decimalToHex(e[6])+xr.decimalToHex(e[7])+"-"+xr.decimalToHex(e[8])+xr.decimalToHex(e[9])+"-"+xr.decimalToHex(e[10])+xr.decimalToHex(e[11])+xr.decimalToHex(e[12])+xr.decimalToHex(e[13])+xr.decimalToHex(e[14])+xr.decimalToHex(e[15])}catch(e){for(var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",r="0123456789abcdef",n=0,o=m.EMPTY_STRING,i=0;i<36;i++)"-"!==t[i]&&"4"!==t[i]&&(n=16*Math.random()|0),"x"===t[i]?o+=r[n]:"y"===t[i]?(n&=3,o+=r[n|=8]):o+=t[i];return o}},e.prototype.isGuid=e}(),Fr=function(){function e(){}return e.stringToUtf8Arr=e.stringToArrayBuffer=e.utf8ArrToString=e.getSortedObjectString=e}(),Gr=function(){function e(){}return e.prototype.urlEncode=e.prototype.urlEncodeArr=e.prototype.encode=function(e){var t=Fr.stringToUtf8Arr(e);return this.base64EncArr(t)},e.prototype.base64EncArr=function(e){for(var t=(3-e.length%3)%3,r=m.EMPTY_STRING,n=void 0,o=e.length,i=0,a=0;a<o;a++)i|=e[a]<<(16>>>(n=a%3)&24),2!==n&&e.length-a!=1||(r+=String.fromCharCode(this.uint6ToB64(i>>>18&63),this.uint6ToB64(i>>>12&63),this.uint6ToB64(i>>>6&63),this.uint6ToB64(63&i)),i=0);return 0===t?r:r.substring(0,r.length-t)+(1===t?"=":"==")},e.prototype.uint6ToB64=e}(),jr=function(){function e(){}return e.prototype.decode=e.prototype.base64DecToArr=function(e,t){for(var r=e.replace(/[^A-Za-z0-9\+\/]/g,m.EMPTY_STRING),n=r.length,o=t?Math.ceil((3*n+1>>>2)/t)*t:3*n+1>>>2,i=new Uint8Array(o),a=void 0,s=void 0,c=0,u=0,l=0;l<n;l++)if(s=3&l,c|=this.b64ToUint6(r.charCodeAt(l))<<18-6*s,3===s||n-l==1){for(a=0;a<3&&u<o;a++,u++)i[u]=c>>>(16>>>a&24)&255;c=0}return i},e.prototype.b64ToUint6=e}(),zr=),Qr=),Yr=),Wr=function(){function e(){}return e.prototype.getRandomValues=e.prototype.generateKey=function(e,t,r){return je(this,void 0,void 0,(function(){return ze(this,(function(n){return[2,new Promise((function(n,o){var i=window.msCrypto.subtle.generateKey(e,t,r);i.addEventListener("complete",(function(e){n(e.target.result)})),i.addEventListener("error",(function(e){o(e)}))}))]}))}))},e.prototype.exportKey=function(e){return je(this,void 0,void 0,(function(){return ze(this,(function(t){return[2,new Promise((function(t,r){var n=window.msCrypto.subtle.exportKey(re,e);n.addEventListener("complete",(function(e){var n=Fr.utf8ArrToString(new Uint8Array(e.target.result)).replace(/\r/g,m.EMPTY_STRING).replace(/\n/g,m.EMPTY_STRING).replace(/\t/g,m.EMPTY_STRING).split(" ").join(m.EMPTY_STRING).replace("\0",m.EMPTY_STRING);try{t(JSON.parse(n))}catch(e){r(e)}})),n.addEventListener("error",(function(e){r(e)}))}))]}))}))},e.prototype.importKey=function(e,t,r,n){return je(this,void 0,void 0,(function(){var o,i;return ze(this,(function(a){return o=Fr.getSortedObjectString(e),i=Fr.stringToArrayBuffer(o),[2,new Promise((function(e,o){var a=window.msCrypto.subtle.importKey(re,i,t,r,n);a.addEventListener("complete",(function(t){e(t.target.result)})),a.addEventListener("error",(function(e){o(e)}))}))]}))}))},e.prototype.sign=function(e,t,r){return je(this,void 0,void 0,(function(){return ze(this,()}))},e.prototype.digest=e}(),Vr="SHA-256",Jr=new Uint8Array([1,0,1]),Xr=function(){function e(e,t){var r,n;if(this.logger=e,this.cryptoOptions=t,this.hasBrowserCrypto())this.logger.verbose("BrowserCrypto: modern crypto interface available"),this.subtleCrypto=new Qr;else if(this.hasIECrypto())this.logger.verbose("BrowserCrypto: MS crypto interface available"),this.subtleCrypto=new Wr;else{if(!this.hasMsrCrypto()||!(null===(r=this.cryptoOptions)||void 0===r?void 0:r.useMsrCrypto))throw this.hasMsrCrypto()&&this.logger.info("BrowserCrypto: MSR Crypto interface available but system.cryptoOptions.useMsrCrypto not enabled"),this.logger.error("BrowserCrypto: No crypto interfaces available."),bt.createCryptoNotAvailableError("Browser crypto, msCrypto, or msrCrypto interfaces not available.");this.logger.verbose("BrowserCrypto: MSR crypto interface available"),this.subtleCrypto=new Yr}if(this.subtleCrypto.initPrng){if(this.logger.verbose("BrowserCrypto: Interface requires entropy"),!(null===(n=this.cryptoOptions)||void 0===n?void 0:n.entropy))throw this.logger.error("BrowserCrypto: Interface requires entropy but none provided."),kt.createEntropyNotProvided();this.logger.verbose("BrowserCrypto: Entropy provided"),this.subtleCrypto.initPrng(this.cryptoOptions.entropy)}this.keygenAlgorithmOptions={name:"RSASSA-PKCS1-v1_5",hash:Vr,modulusLength:2048,publicExponent:Jr}}return e.prototype.hasIECrypto=function(){return"msCrypto"in window},e.prototype.hasBrowserCrypto=function(){return"crypto"in window},e.prototype.hasMsrCrypto=e.prototype.sha256Digest=e.prototype.getRandomValues=function(e){return this.subtleCrypto.getRandomValues(e)},e.prototype.generateKeyPair=function(e,t){return je(this,void 0,void 0,(function(){return ze(this,(function(r){return[2,this.subtleCrypto.generateKey(this.keygenAlgorithmOptions,e,t)]}))}))},e.prototype.exportJwk=e.prototype.importJwk=e.prototype.sign=e}(),Zr=function(){function e(){this.dbName=oe,this.version=1,this.tableName="msal.db.keys",this.dbOpen=!1}return e.prototype.open=function(){return je(this,void 0,void 0,(function(){var e=this;return ze(this,(function(t){return[2,new Promise((function(t,r){var n=window.indexedDB.open(e.dbName,e.version);n.addEventListener("upgradeneeded",(),n.addEventListener("success",(function(r){e.db=r.target.result,e.dbOpen=!0,t()})),n.addEventListener("error",()}))]}))}))},e.prototype.closeConnection=e.prototype.validateDbIsOpen=e.prototype.getItem=function(e){return je(this,void 0,void 0,(function(){var t=this;return ze(this,()}))},e.prototype.setItem=function(e,t){return je(this,void 0,void 0,(function(){var r=this;return ze(this,()}))},e.prototype.removeItem=function(e){return je(this,void 0,void 0,(function(){var t=this;return ze(this,()}))},e.prototype.getKeys=function(){return je(this,void 0,void 0,(function(){var e=this;return ze(this,()}))},e.prototype.containsKey=function(e){return je(this,void 0,void 0,(function(){var t=this;return ze(this,()}))},e.prototype.deleteDatabase=e}(),$r=function(){eturn e.prototype.handleDatabaseAccessError=function(e){if(!(e instanceof bt&&e.errorCode===wt))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")},e.prototype.getItem=function(e){return je(this,void 0,void 0,(function(){var t,r;return ze(this,(function(n){switch(n.label){case 0:if(t=this.inMemoryCache.getItem(e))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),[4,this.indexedDBCache.getItem(e)];case 2:return[2,n.sent()];case 3:return r=n.sent(),this.handleDatabaseAccessError(r),[3,4];case 4:return[2,t]}}))}))},e.prototype.setItem=e.prototype.removeItem=e.prototype.getKeys=function(){return je(this,void 0,void 0,(function(){var e,t;return ze(this,()}))},e.prototype.containsKey=function(e){return je(this,void 0,void 0,(function(){var t,r;return ze(this,()}))},e.prototype.clearInMemory=e.prototype.clearPersistent=function(){return je(this,void 0,void 0,(function(){var e,t;return ze(this,()}))},e}();!function(e){e.asymmetricKeys="asymmetricKeys",e.symmetricKeys="symmetricKeys"}(_r||(_r={}));var en,tn,rn,nn,on=function(){eturn e.prototype.clear=function(){return je(this,void 0,void 0,(function(){var e;return ze(this,()}))},e}(),an=function(){eturn e.prototype.createNewGuid=function(){return this.guidGenerator.generateGuid()},e.prototype.base64Encode=function(e){return this.b64Encode.encode(e)},e.prototype.base64Decode=function(e){return this.b64Decode.decode(e)},e.prototype.generatePkceCodes=e.prototype.getPublicKeyThumbprint=function(t){var r;return je(this,void 0,void 0,(function(){var n,o,i,a,s,c,u;return ze(this,(function(l){switch(l.label){case 0:return n=null===(r=this.performanceClient)||void 0===r?void 0:r.startMeasurement(Ct.CryptoOptsGetPublicKeyThumbprint,t.correlationId),[4,this.browserCrypto.generateKeyPair(e.EXTRACTABLE,e.POP_KEY_USAGES)];case 1:return o=l.sent(),[4,this.browserCrypto.exportJwk(o.publicKey)];case 2:return i=l.sent(),a=Fr.getSortedObjectString({e:i.e,kty:i.kty,n:i.n}),[4,this.hashString(a)];case 3:return s=l.sent(),[4,this.browserCrypto.exportJwk(o.privateKey)];case 4:return c=l.sent(),[4,this.browserCrypto.importJwk(c,!1,["sign"])];case 5:return u=l.sent(),[4,this.cache.asymmetricKeys.setItem(s,{privateKey:u,publicKey:o.publicKey,requestMethod:t.resourceRequestMethod,requestUri:t.resourceRequestUri})];case 6:return l.sent(),n&&n.endMeasurement({success:!0}),[2,s]}}))}))},e.prototype.removeTokenBindingKey=function(e){return je(this,void 0,void 0,(function(){return ze(this,()}))},e.prototype.clearKeystore=e.prototype.signJwt=function(e,t,r){var n;return je(this,void 0,void 0,(function(){var o,i,a,s,c,u,l,d,h,p,f,g,m;return ze(this,(function(v){switch(v.label){case 0:return o=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement(Ct.CryptoOptsSignJwt,r),[4,this.cache.asymmetricKeys.getItem(t)];case 1:if(!(i=v.sent()))throw bt.createSigningKeyNotFoundInStorageError(t);return[4,this.browserCrypto.exportJwk(i.publicKey)];case 2:return a=v.sent(),s=Fr.getSortedObjectString(a),c=this.b64Encode.urlEncode(JSON.stringify({kid:t})),u=Lr.getShrHeaderString({kid:c,alg:a.alg}),l=this.b64Encode.urlEncode(u),e.cnf={jwk:JSON.parse(s)},d=this.b64Encode.urlEncode(JSON.stringify(e)),p=Fr.stringToArrayBuffer(h=l+"."+d),[4,this.browserCrypto.sign(i.privateKey,p)];case 3:return f=v.sent(),g=this.b64Encode.urlEncodeArr(new Uint8Array(f)),m=h+"."+g,o&&o.endMeasurement({success:!0}),[2,m]}}))}))},e.prototype.hashString=e.POP_KEY_USAGES=["sign","verify"],e.EXTRACTABLE=!0,e}(),sn=function(){eturn e.prototype.startPerformanceMeasurement=function(e,t){return{}},e.prototype.startPerformanceMeasuremeant=e.prototype.getIntFields=e.prototype.getPreQueueTime=e.prototype.calculateQueuedTime=e.prototype.addQueueMeasurement=function(e,t,r,n){if(t){if(0===r)this.logger.trace("PerformanceClient.addQueueMeasurement: queue time provided for "+e+" is "+r);else if(!r)return void this.logger.trace("PerformanceClient.addQueueMeasurement: no queue time provided for "+e);var o={eventName:e,queueTime:r,manuallyCompleted:n},i=this.queueMeasurements.get(t);i?(i.push(o),this.queueMeasurements.set(t,i)):(this.logger.trace("PerformanceClient.addQueueMeasurement: adding correlationId "+t+" to queue measurements"),this.queueMeasurements.set(t,[o])),this.preQueueTimeByCorrelationId.delete(t)}else this.logger.trace("PerformanceClient.addQueueMeasurement: correlationId not provided for "+e+", cannot add queue measurement")},e.prototype.startMeasurement=function(e,t){var r,n,o=this,i=t||this.generateId();t||this.logger.info("PerformanceClient: No correlation id provided for "+e+", generating",i),this.logger.trace("PerformanceClient: Performance measurement started for "+e,i);var a=this.startPerformanceMeasuremeant(e,i);a.startMeasurement();var c={eventId:this.generateId(),status:Tt.InProgress,authority:this.authority,libraryName:this.libraryName,libraryVersion:this.libraryVersion,clientId:this.clientId,name:e,startTimeMs:Date.now(),correlationId:i,appName:null===(r=this.applicationTelemetry)||void 0===r?void 0:r.appName,appVersion:null===(n=this.applicationTelemetry)||void 0===n?void 0:n.appVersion};return this.cacheEventByCorrelationId(c),{endMeasurement:function(e){return o.endMeasurement(s(s({},c),e),a)},discardMeasurement:addStaticFields:function(e){return o.addStaticFields(e,c.correlationId)},increment:measurement:a,event:c}},e.prototype.endMeasurement=function(e,t){var r,n,o=this,i=this.eventsByCorrelationId.get(e.correlationId);if(!i)return this.logger.trace("PerformanceClient: Measurement not found for "+e.eventId,e.correlationId),null;var a=e.eventId===i.eventId,c={totalQueueTime:0,totalQueueCount:0,manuallyCompletedCount:0};a?(c=this.getQueueInfo(e.correlationId),this.discardCache(i.correlationId)):null===(r=i.incompleteSubMeasurements)||void 0===r||r.delete(e.eventId),null==t||t.endMeasurement();var u=null==t?void 0:t.flushMeasurement();if(!u)return this.logger.trace("PerformanceClient: Performance measurement not taken",i.correlationId),null;if(this.logger.trace("PerformanceClient: Performance measurement ended for "+e.name+": "+u+" ms",e.correlationId),!a)return i[e.name+"DurationMs"]=Math.floor(u),s({},i);var l=s(s({},i),e),d=0;return null===(n=l.incompleteSubMeasurements)||void 0===n||n.forEach((),l.incompleteSubMeasurements=void 0,l=s(s({},l),{durationMs:Math.round(u),queuedTimeMs:c.totalQueueTime,queuedCount:c.totalQueueCount,queuedManuallyCompletedCount:c.manuallyCompletedCount,status:Tt.Completed,incompleteSubsCount:d}),this.truncateIntegralFields(l,this.getIntFields()),this.emitEvents([l],e.correlationId),l},e.prototype.addStaticFields=function(e,t){this.logger.trace("PerformanceClient: Updating static fields");var r=this.eventsByCorrelationId.get(t);r?this.eventsByCorrelationId.set(t,s(s({},r),e)):this.logger.trace("PerformanceClient: Event not found for",t)},e.prototype.increment=e.prototype.cacheEventByCorrelationId=function(e){var t=this.eventsByCorrelationId.get(e.correlationId);t?(this.logger.trace("PerformanceClient: Performance measurement for "+e.name+" added/updated",e.correlationId),t.incompleteSubMeasurements=t.incompleteSubMeasurements||new Map,t.incompleteSubMeasurements.set(e.eventId,{name:e.name,startTimeMs:e.startTimeMs})):(this.logger.trace("PerformanceClient: Performance measurement for "+e.name+" started",e.correlationId),this.eventsByCorrelationId.set(e.correlationId,s({},e)))},e.prototype.getQueueInfo=e.prototype.discardMeasurements=e.prototype.discardCache=e.prototype.addPerformanceCallback=e.prototype.removePerformanceCallback=function(e){var t=this.callbacks.delete(e);return this.logger.verbose(t?"PerformanceClient: Performance callback "+e+" removed.":"PerformanceClient: Performance callback "+e+" not removed."),t},e.prototype.emitEvents=e.prototype.truncateIntegralFields=e}(),cn=),un=function(e){eturn Ke(t,e),t.prototype.startPerformanceMeasuremeant=t.prototype.generateId=function(){return this.guidGenerator.generateGuid()},t.prototype.getPageVisibility=t.prototype.deleteIncompleteSubMeasurements=function(e){var t=this.eventsByCorrelationId.get(e.event.correlationId),r=[];t&&t.eventId===e.event.eventId&&(null==t?void 0:t.incompleteSubMeasurements)&&t.incompleteSubMeasurements.forEach((),r.length>0&&cn.flushMeasurements(e.event.correlationId,r)},t.prototype.supportsBrowserPerformanceNow=t.prototype.startMeasurement=function(t,r){var n=this,o=this.getPageVisibility(),i=e.prototype.startMeasurement.call(this,t,r);return Fe(Fe({},i),{endMeasurement:function(e){var t=i.endMeasurement(Fe({startPageVisibility:o,endPageVisibility:n.getPageVisibility()},e));return n.deleteIncompleteSubMeasurements(i),t},discardMeasurement:)},t.prototype.setPreQueueTime=t.prototype.addQueueMeasurement=t}(sn);!en||(en={})),tn||(tn={})),function(e){e.BROKER_CLIENT_ID="brk_client_id",e.BROKER_REDIRECT_URI="brk_redirect_uri"}(rn||(rn={})),nn||(nn={}));var ln="plain",dn="S256",hn=function(){eturn e.validateMessage=function(e){if(!e.data||!e.data.messageType)return null;switch(e.data.messageType){case en.HANDSHAKE_REQUEST:case en.HANDSHAKE_RESPONSE:case en.HANDLE_REDIRECT_REQUEST:case en.AUTH_REQUEST:case en.AUTH_RESULT:case en.REDIRECT_RESPONSE:return e;default:return null}},e}(),pn=function(e){function t(t,r){var n=e.call(this,en.HANDSHAKE_REQUEST)||this;return n.embeddedClientId=t,n.version=r,n}return qe(t,e),t.validate=function(e){return e.data&&e.data.messageType===en.HANDSHAKE_REQUEST&&e.data.embeddedClientId&&e.data.version?new t(e.data.embeddedClientId,e.data.version):null},t}(hn),fn=function(e){function t(r,n){var o=e.call(this,r,n)||this;return Object.setPrototypeOf(o,t.prototype),o.name=nn.BROKER_AUTH_ERROR_NAME,o}return qe(t,e),t.createNoTokensToCacheError=function(){return new t("no_tokens_to_cache","The broker did not have any tokens for the client to cache.")},t.createNoEmbeddedAppError=function(){return new t("no_embedded_app","The embedded application object was not created. Please ensure you have configured your application correctly for an embedded application: https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/broker-v2/lib/msal-browser/docs/broker.md#brokered-application-configuration")},t.createBrokerResponseInvalidError=function(){return new t("broker_response_invalid","The broker response did not have the expected values.")},t.createBrokerRequestIncompleteError=function(){return new t("broker_request_incomplete","The brokered request did not have the expected values.")},t.createBrokerPopupRequestRedirectingError=function(){return new t("broker_popup_will_redirect","The request for a brokered popup requires a redirect by the broker. If your app does not perform the redirect, please check the broker's logs.")},t.createNoTrustedBrokersProvidedError=function(){return new bt("no_trusted_brokers_provided","No trusted brokers provided.")},t.createBrokeringDisabledError=function(e){return new bt("brokering_disabled","Brokering is not enabled for the client application. Please check logs to see if handshake was performed. Inner Error: "+e)},t.createMessageBrokerTimeoutError=function(){return new bt("broker_timeout","Message broker timed out.")},t.createMessageBrokerHandshakeTimeoutError=function(){return new bt("broker_handshake_timeout","Broker handshake response timed out.")},t.createInvalidBrokerMessageError=function(){return new bt("invalid_broker_message","messageType for broker message is invalid")},t.createUntrustedBrokerError=function(){return new bt("untrusted_broker_error","The given broker origin is not trusted.")},t}(bt),gn=function(e){function t(t,r){var n=e.call(this,en.HANDSHAKE_RESPONSE)||this;return n.version=t,n.brokerOrigin=r,n}return qe(t,e),t.validate=function(e,r){var n=hn.validateMessage(e);if(r&&n&&n.data.messageType===en.HANDSHAKE_RESPONSE&&n.data.version){if(r.filter(().length<=0)throw fn.createUntrustedBrokerError();return new t(n.data.version,n.origin)}return null},t}(hn),mn=function(e){eturn qe(t,e),Object.defineProperty(t.prototype,"embeddedAppOrigin",{get:function(){return this._embeddedAppOrigin},enumerable:!1,configurable:!0}),t.validate=function(e){return e.data&&e.data.messageType===en.AUTH_REQUEST&&e.data.embeddedClientId&&e.data.interactionType&&e.data.request?new t(e.data.embeddedClientId,e.data.interactionType,e.data.request,e.origin):null},t}(hn),vn=function(e){eturn qe(t,e),t.validate=function(e){return e.data&&e.data.messageType===en.REDIRECT_RESPONSE?new t:null},t}(hn),yn=function(e){function t(t,r,n){var o=e.call(this,en.AUTH_RESULT)||this;return o.interactionType=t,o.result=r,o.errorPayload=o.generateErrorPayload(n),o}return qe(t,e),t.prototype.generateErrorPayload=function(e){return e?Ue({},e):void 0},t.validate=function(e){return e.data&&e.data.messageType===en.AUTH_RESULT&&e.data.interactionType&&(e.data.result||e.data.errorPayload)?new t(e.data.interactionType,e.data.result,e.data.errorPayload):null},t.detectError=function(e){switch(e.name){case nn.INTERACTION_REQ_ERROR_NAME:return new ue(e.errorCode,e.errorMessage,e.subError);case nn.SERVER_ERROR_NAME:return new Qt(e.errorCode,e.errorMessage,e.subError);case nn.CLIENT_AUTH_ERR_NAME:return new Je(e.errorCode,e.errorMessage);case nn.CLIENT_CONFIG_ERROR_NAME:return new $e(e.errorCode,e.errorMessage);case nn.BROWSER_AUTH_ERROR_NAME:return new bt(e.errorCode,e.errorMessage);case nn.BROWSER_CONFIG_ERROR_NAME:return new kt(e.errorCode,e.errorMessage);case nn.BROKER_AUTH_ERROR_NAME:return new fn(e.errorCode,e.errorMessage);case nn.AUTH_ERROR_NAME:return new ie(e.errorCode,e.errorMessage,e.subError);default:return ie.createUnexpectedError("Unknown error: "+JSON.stringify(e))}},t.processBrokerResponseMessage=t.processBrokerResponse=function(e,r){if(!e)return null;if(e.errorPayload)throw t.detectError(e.errorPayload);if(!e.result||!e.result.tokensToCache)throw fn.createBrokerResponseInvalidError();var n=new ht,o=new Ze,i=new it,a=e.result.tokensToCache,s={accessToken:ut.toObject(a.accessToken,n),idToken:ut.toObject(a.idToken,o),account:ut.toObject(a.account,i),refreshToken:null,appMetadata:null};return r.saveCacheRecord(s),delete e.result.tokensToCache,Ue({},e.result)},t}(hn),Cn=function(e){eturn qe(t,e),t.validate=function(e){return e.data&&e.data.messageType===en.HANDLE_REDIRECT_REQUEST&&e.data.embeddedClientId&&e.data.version?new t(e.data.embeddedClientId,e.data.version):null},t}(hn),Tn=),En=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.generateId=t.prototype.startPerformanceMeasuremeant=function(){return new Tn},t.prototype.startPerformanceMeasurement=t.prototype.calculateQueuedTime=t.prototype.addQueueMeasurement=t.prototype.setPreQueueTime=t}(sn),_n=function(){eturn e.prototype.loadExternalTokens=function(e,t,r){if(this.logger.info("TokenCache - loadExternalTokens called"),!t.id_token)throw bt.createUnableToLoadTokenError("Please ensure server response includes id token.");var n,o,i=new at(t.id_token,this.cryptoObj);if(e.account){var a=this.loadAccount(i,e.account.environment,void 0,void 0,e.account.homeAccountId);n=new Zt(a,this.loadIdToken(i,a.homeAccountId,e.account.environment,e.account.tenantId),this.loadAccessToken(e,t,a.homeAccountId,e.account.environment,e.account.tenantId,r),this.loadRefreshToken(e,t,a.homeAccountId,e.account.environment))}else{if(!e.authority)throw bt.createUnableToLoadTokenError("Please provide a request with an account or a request with authority.");var s=lr.generateAuthority(e.authority,e.azureCloudOptions);if(o=new lr(s,this.config.system.networkClient,this.storage,{protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},this.logger),r.clientInfo)this.logger.trace("TokenCache - homeAccountId from options"),a=this.loadAccount(i,o.hostnameAndPort,r.clientInfo,o.authorityType),n=new Zt(a,this.loadIdToken(i,a.homeAccountId,o.hostnameAndPort,o.tenant),this.loadAccessToken(e,t,a.homeAccountId,o.hostnameAndPort,o.tenant,r),this.loadRefreshToken(e,t,a.homeAccountId,o.hostnameAndPort));else{if(!t.client_info)throw bt.createUnableToLoadTokenError("Please provide clientInfo in the response or options.");this.logger.trace("TokenCache - homeAccountId from response"),a=this.loadAccount(i,o.hostnameAndPort,t.client_info,o.authorityType),n=new Zt(a,this.loadIdToken(i,a.homeAccountId,o.hostnameAndPort,o.tenant),this.loadAccessToken(e,t,a.homeAccountId,o.hostnameAndPort,o.tenant,r),this.loadRefreshToken(e,t,a.homeAccountId,o.hostnameAndPort))}}return this.generateAuthenticationResult(e,i,n,o)},e.prototype.loadAccount=e.prototype.loadIdToken=e.prototype.loadAccessToken=function(e,t,r,n,o,i){if(!t.access_token)return this.logger.verbose("TokenCache - No access token provided for caching"),null;if(!t.expires_in)throw bt.createUnableToLoadTokenError("Please ensure server response includes expires_in value.");if(!i.extendedExpiresOn)throw bt.createUnableToLoadTokenError("Please provide an extendedExpiresOn value in the options.");var a=new tt(e.scopes).printScopes(),s=i.expiresOn||t.expires_in+(new Date).getTime()/1e3,c=ht.createAccessTokenEntity(r,n,t.access_token,this.config.auth.clientId,o,a,s,i.extendedExpiresOn,this.cryptoObj);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading access token"),this.storage.setAccessTokenCredential(c),c;throw bt.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},e.prototype.loadRefreshToken=e.prototype.generateAuthenticationResult=function(e,t,r,n){var o,i,a,s,c=m.EMPTY_STRING,u=[],l=null;return(null==r?void 0:r.accessToken)&&(c=r.accessToken.secret,u=tt.fromString(r.accessToken.target).asArray(),l=new Date(1e3*Number(r.accessToken.expiresOn)),s=new Date(1e3*Number(r.accessToken.extendedExpiresOn))),{authority:n?n.canonicalAuthority:m.EMPTY_STRING,uniqueId:(null==t?void 0:t.claims.oid)||(null==t?void 0:t.claims.sub)||m.EMPTY_STRING,tenantId:(null==t?void 0:t.claims.tid)||m.EMPTY_STRING,scopes:u,account:(null==r?void 0:r.account)?r.account.getAccountInfo():null,idToken:t?t.rawToken:m.EMPTY_STRING,idTokenClaims:t?t.claims:{},accessToken:c,fromCache:!0,expiresOn:l,correlationId:e.correlationId||m.EMPTY_STRING,requestId:m.EMPTY_STRING,extExpiresOn:s,familyId:m.EMPTY_STRING,tokenType:(null===(o=null==r?void 0:r.accessToken)||void 0===o?void 0:o.tokenType)||m.EMPTY_STRING,state:m.EMPTY_STRING,cloudGraphHostName:(null===(i=null==r?void 0:r.account)||void 0===i?void 0:i.cloudGraphHostName)||m.EMPTY_STRING,msGraphHost:(null===(a=null==r?void 0:r.account)||void 0===a?void 0:a.msGraphHost)||m.EMPTY_STRING,code:void 0,fromNativeBroker:!1}},e}(),In=rr),wn=function(e){eturn Ke(t,e),t.prototype.acquireToken=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a;return ze(this,(function(s){switch(s.label){case 0:if(this.logger.trace("SilentAuthCodeClient.acquireToken called"),!e.code)throw bt.createAuthCodeRequiredError();return this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId),[4,this.initializeAuthorizationRequest(e,J.Silent)];case 1:t=s.sent(),this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||m.EMPTY_STRING,t.account||null),r=this.initializeServerTelemetryManager(this.apiId),s.label=2;case 2:return s.trys.push([2,4,,5]),n=Fe(Fe({},t),{code:e.code}),this.performanceClient.setPreQueueTime(Ct.StandardInteractionClientGetClientConfiguration,e.correlationId),[4,this.getClientConfiguration(r,t.authority)];case 3:return o=s.sent(),i=new In(o),this.logger.verbose("Auth code client created"),[2,new qr(i,this.browserStorage,n,this.logger,this.config.system,this.performanceClient).handleCodeResponseFromServer({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t.state,i.authority,this.networkClient,!1)];case 4:throw(a=s.sent())instanceof ie&&a.setCorrelationId(this.correlationId),r.cacheFailedRequest(a),this.browserStorage.cleanRequestByState(t.state),a;case 5:return[2]}}))}))},t.prototype.logout=t}(Cr),bn=function(e){eturn Ke(t,e),t.prototype.loginRedirect=t.prototype.loginPopup=t.prototype.acquireTokenSilent=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a,s=this;return ze(this,(function(c){if(t=this.getRequestCorrelationId(e),(r=this.performanceClient.startMeasurement(Ct.AcquireTokenSilent,t)).addStaticFields({cacheLookupPolicy:e.cacheLookupPolicy}),this.preflightBrowserEnvironmentCheck(J.Silent),this.logger.verbose("acquireTokenSilent called",t),!(n=e.account||this.getActiveAccount()))throw bt.createNoAccountError();return o=JSON.stringify({clientId:this.config.auth.clientId,authority:e.authority||m.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:n.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid}),void 0===(i=this.activeSilentTokenRequests.get(o))?(this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t),this.performanceClient.setPreQueueTime(Ct.AcquireTokenSilentAsync,t),a=this.acquireTokenSilentAsync(Fe(Fe({},e),{correlationId:t}),n).then(().catch((),this.activeSilentTokenRequests.set(o,a),[2,a]):(this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),r.discardMeasurement(),[2,i])}))}))},t.prototype.trackPageVisibility=t.prototype.acquireTokenSilentAsync=function(e,t){var r;return je(this,void 0,void 0,(function(){var n,o,i,a,s,c=this;return ze(this,(function(u){switch(u.label){case 0:return this.performanceClient.addQueueMeasurement(Ct.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_START,J.Silent,e),this.astsAsyncMeasurement=this.performanceClient.startMeasurement(Ct.AcquireTokenSilentAsync,e.correlationId),null===(r=this.astsAsyncMeasurement)||void 0===r||r.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibility),Rr.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&t.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),o=Fe(Fe({},e),{account:t}),n=this.acquireTokenNative(o,V.acquireTokenSilent_silentFlow).catch((function(t){return je(c,void 0,void 0,(function(){return ze(this,()}))})),[3,3]):[3,1];case 1:return this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),i=this.createSilentCacheClient(e.correlationId),this.performanceClient.setPreQueueTime(Ct.InitializeSilentRequest,e.correlationId),[4,i.initializeSilentRequest(e,t)];case 2:a=u.sent(),s=Fe(Fe({},e),{cacheLookupPolicy:e.cacheLookupPolicy||ne.Default}),this.performanceClient.setPreQueueTime(Ct.AcquireTokenFromCache,a.correlationId),n=this.acquireTokenFromCache(i,a,s).catch((function(t){if(s.cacheLookupPolicy===ne.AccessToken)throw t;return vr.blockReloadInHiddenIframes(),c.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_NETWORK_START,J.Silent,a),c.performanceClient.setPreQueueTime(Ct.AcquireTokenByRefreshToken,a.correlationId),c.acquireTokenByRefreshToken(a,s).catch((function(t){if((!(t instanceof Qt)||t.errorCode!==Z.INVALID_GRANT_ERROR||t instanceof ue||s.cacheLookupPolicy===ne.AccessTokenAndRefreshToken||s.cacheLookupPolicy===ne.RefreshToken)&&s.cacheLookupPolicy!==ne.Skip&&t.errorCode!==ce)throw t;return c.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",e.correlationId),c.performanceClient.setPreQueueTime(Ct.AcquireTokenBySilentIframe,a.correlationId),c.acquireTokenBySilentIframe(a)}))})),u.label=3;case 3:return[2,n.then((function(e){var t;return c.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_SUCCESS,J.Silent,e),null===(t=c.astsAsyncMeasurement)||void 0===t||t.endMeasurement({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e})).catch((function(e){var t;throw c.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_FAILURE,J.Silent,null,e),null===(t=c.astsAsyncMeasurement)||void 0===t||t.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})).finally((function(){document.removeEventListener("visibilitychange",c.trackPageVisibility)}))]}}))}))},t}(function(){function e(e){this.isBrowserEnvironment="undefined"!=typeof window,this.config=function(e,t){var r=e.auth,n=e.cache,o=e.system,i=e.telemetry,a={clientId:m.EMPTY_STRING,authority:""+m.DEFAULT_AUTHORITY,knownAuthorities:[],cloudDiscoveryMetadata:m.EMPTY_STRING,authorityMetadata:m.EMPTY_STRING,redirectUri:m.EMPTY_STRING,postLogoutRedirectUri:m.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:or.AAD,azureCloudOptions:{azureCloudInstance:qt.None,tenant:m.EMPTY_STRING},skipAuthorityMetadataCache:!1},s={cacheLocation:j.SessionStorage,temporaryCacheLocation:j.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!n||n.cacheLocation!==j.LocalStorage),claimsBasedCachingEnabled:!0},c={loggerCallback:function(){},logLevel:Ot.Info,piiLoggingEnabled:!1},u=Fe(Fe({},Ht),{loggerOptions:c,networkClient:t?vr.getBrowserNetworkClient():Nr,navigationClient:new Or,loadFrameTimeout:0,windowHashTimeout:(null==o?void 0:o.loadFrameTimeout)||6e4,iframeHashTimeout:(null==o?void 0:o.loadFrameTimeout)||Mr,navigateFrameWait:t&&vr.detectIEOrEdge()?500:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(null==o?void 0:o.nativeBrokerHandshakeTimeout)||2e3,pollIntervalMilliseconds:Z.DEFAULT_POLL_INTERVAL_MS,cryptoOptions:{useMsrCrypto:!1,entropy:void 0}}),l=Fe(Fe({},o),{loggerOptions:(null==o?void 0:o.loggerOptions)||c}),d={application:{appName:m.EMPTY_STRING,appVersion:m.EMPTY_STRING}};return{auth:Fe(Fe({},a),r),cache:Fe(Fe({},s),n),system:Fe(Fe({},u),l),telemetry:Fe(Fe({},d),i)}}(e,this.isBrowserEnvironment),this.initialized=!1,this.logger=new Ut(this.config.system.loggerOptions,pr,fr),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.isBrowserEnvironment?new un(this.config.auth.clientId,this.config.auth.authority,this.logger,pr,fr,this.config.telemetry.application,this.config.system.cryptoOptions):new En(this.config.auth.clientId,this.config.auth.authority,this.logger,pr,fr,this.config.telemetry.application),this.browserCrypto=this.isBrowserEnvironment?new an(this.logger,this.performanceClient,this.config.system.cryptoOptions):Et,this.eventHandler=new Br(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new Nt(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger):function(e,t){return new Nt(e,{cacheLocation:j.MemoryStorage,temporaryCacheLocation:j.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!0},Et,t)}(this.config.auth.clientId,this.logger),this.nativeInternalStorage=new Nt(this.config.auth.clientId,{cacheLocation:j.MemoryStorage,temporaryCacheLocation:j.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!0},this.browserCrypto,this.logger),this.tokenCache=new _n(this.config,this.browserStorage,this.logger,this.browserCrypto),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}return e.prototype.initialize=function(){return je(this,void 0,void 0,(function(){var e,t,r,n,o;return ze(this,(function(i){switch(i.label){case 0:if(this.logger.trace("initialize called"),this.initialized)return this.logger.info("initialize has already been called, exiting early."),[2];if(e=this.config.system.allowNativeBroker,t=this.performanceClient.startMeasurement(Ct.InitializeClientApplication),this.eventHandler.emitEvent(sr.INITIALIZE_START),!e)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),r=this,[4,Rr.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)];case 2:return r.nativeExtensionProvider=i.sent(),[3,4];case 3:return n=i.sent(),this.logger.verbose(n),[3,4];case 4:return this.config.cache.claimsBasedCachingEnabled?[3,6]:(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),o=this.performanceClient.startMeasurement(Ct.ClearTokensAndKeysWithClaims),[4,this.browserStorage.clearTokensAndKeysWithClaims()]);case 5:i.sent(),o.endMeasurement({success:!0}),i.label=6;case 6:return this.initialized=!0,this.eventHandler.emitEvent(sr.INITIALIZE_END),t.endMeasurement({allowNativeBroker:e,success:!0}),[2]}}))}))},e.prototype.handleRedirectPromise=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a,s,c,u=this;return ze(this,(function(l){return this.logger.verbose("handleRedirectPromise called"),vr.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),t=this.getAllAccounts(),this.isBrowserEnvironment?(void 0===(n=this.redirectResponse.get(r=e||m.EMPTY_STRING))?(this.eventHandler.emitEvent(sr.HANDLE_REDIRECT_START,J.Redirect),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise"),o=this.browserStorage.getCachedNativeRequest(),i=void 0,o&&Rr.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e?(this.logger.trace("handleRedirectPromise - acquiring token from native platform"),a=new Sr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,V.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,o.accountId,this.nativeInternalStorage,o.correlationId),i=a.handleRedirectPromise()):(this.logger.trace("handleRedirectPromise - acquiring token from web flow"),s=this.browserStorage.getTemporaryCache(Q.CORRELATION_ID,!0)||m.EMPTY_STRING,c=this.createRedirectClient(s),i=c.handleRedirectPromise(e)),n=i.then((function(e){return e&&(t.length<u.getAllAccounts().length?(u.eventHandler.emitEvent(sr.LOGIN_SUCCESS,J.Redirect,e),u.logger.verbose("handleRedirectResponse returned result, login success")):(u.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_SUCCESS,J.Redirect,e),u.logger.verbose("handleRedirectResponse returned result, acquire token success"))),u.eventHandler.emitEvent(sr.HANDLE_REDIRECT_END,J.Redirect),e})).catch((function(e){throw u.eventHandler.emitEvent(t.length>0?sr.ACQUIRE_TOKEN_FAILURE:sr.LOGIN_FAILURE,J.Redirect,null,e),u.eventHandler.emitEvent(sr.HANDLE_REDIRECT_END,J.Redirect),e})),this.redirectResponse.set(r,n)):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),[2,n]):(this.logger.verbose("handleRedirectPromise returns null, not browser environment"),[2,null])}))}))},e.prototype.acquireTokenRedirect=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i,a=this;return ze(this,(function(s){return t=this.getRequestCorrelationId(e),this.logger.verbose("acquireTokenRedirect called",t),this.preflightBrowserEnvironmentCheck(J.Redirect),r=this.getAllAccounts().length>0,this.eventHandler.emitEvent(r?sr.ACQUIRE_TOKEN_START:sr.LOGIN_START,J.Redirect,e),this.nativeExtensionProvider&&this.canUseNative(e)?(o=new Sr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,V.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId),n=o.acquireTokenRedirect(e).catch((function(t){if(t instanceof Ir&&t.isFatal())return a.nativeExtensionProvider=void 0,a.createRedirectClient(e.correlationId).acquireToken(e);if(t instanceof ue)return a.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),a.createRedirectClient(e.correlationId).acquireToken(e);throw a.browserStorage.setInteractionInProgress(!1),t}))):(i=this.createRedirectClient(e.correlationId),n=i.acquireToken(e)),[2,n.catch((function(e){throw a.eventHandler.emitEvent(r?sr.ACQUIRE_TOKEN_FAILURE:sr.LOGIN_FAILURE,J.Redirect,null,e),e}))]}))}))},e.prototype.acquireTokenPopup=function(e){var t=this,r=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(Ct.AcquireTokenPopup,r);try{this.logger.verbose("acquireTokenPopup called",r),this.preflightBrowserEnvironmentCheck(J.Popup)}catch(e){return Promise.reject(e)}var o=this.getAllAccounts();return this.eventHandler.emitEvent(o.length>0?sr.ACQUIRE_TOKEN_START:sr.LOGIN_START,J.Popup,e),(this.canUseNative(e)?this.acquireTokenNative(e,V.acquireTokenPopup).then(().catch((function(r){if(r instanceof Ir&&r.isFatal())return t.nativeExtensionProvider=void 0,t.createPopupClient(e.correlationId).acquireToken(e);if(r instanceof ue)return t.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createPopupClient(e.correlationId).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),r})):this.createPopupClient(e.correlationId).acquireToken(e)).then((function(e){var r=o.length<t.getAllAccounts().length;return t.eventHandler.emitEvent(r?sr.LOGIN_SUCCESS:sr.ACQUIRE_TOKEN_SUCCESS,J.Popup,e),n.addStaticFields({accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),n.endMeasurement({success:!0,requestId:e.requestId}),e})).catch((function(e){return t.eventHandler.emitEvent(o.length>0?sr.ACQUIRE_TOKEN_FAILURE:sr.LOGIN_FAILURE,J.Popup,null,e),n.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),Promise.reject(e)}))},e.prototype.trackPageVisibilityWithMeasurement=e.prototype.ssoSilent=function(e){var t;return je(this,void 0,void 0,(function(){var r,n,o,i,a=this;return ze(this,(function(s){return r=this.getRequestCorrelationId(e),n=Fe(Fe({},e),{prompt:e.prompt,correlationId:r}),this.preflightBrowserEnvironmentCheck(J.Silent),this.ssoSilentMeasurement=this.performanceClient.startMeasurement(Ct.SsoSilent,r),null===(t=this.ssoSilentMeasurement)||void 0===t||t.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",r),this.eventHandler.emitEvent(sr.SSO_SILENT_START,J.Silent,n),this.canUseNative(n)?o=this.acquireTokenNative(n,V.ssoSilent).catch(():(i=this.createSilentIframeClient(n.correlationId),o=i.acquireToken(n)),[2,o.then((function(e){var t,r;return a.eventHandler.emitEvent(sr.SSO_SILENT_SUCCESS,J.Silent,e),null===(t=a.ssoSilentMeasurement)||void 0===t||t.addStaticFields({accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),null===(r=a.ssoSilentMeasurement)||void 0===r||r.endMeasurement({success:!0,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e})).catch((function(e){var t;throw a.eventHandler.emitEvent(sr.SSO_SILENT_FAILURE,J.Silent,null,e),null===(t=a.ssoSilentMeasurement)||void 0===t||t.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})).finally((function(){document.removeEventListener("visibilitychange",a.trackPageVisibilityWithMeasurement)}))]}))}))},e.prototype.acquireTokenByCode=function(e){return je(this,void 0,void 0,(function(){var t,r,n,o,i=this;return ze(this,(function(a){t=this.getRequestCorrelationId(e),this.preflightBrowserEnvironmentCheck(J.Silent),this.logger.trace("acquireTokenByCode called",t),this.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_BY_CODE_START,J.Silent,e),r=this.performanceClient.startMeasurement(Ct.AcquireTokenByCode,e.correlationId);try{if(e.code&&e.nativeAccountId)throw bt.createSpaCodeAndNativeAccountIdPresentError();if(e.code)return(o=this.hybridAuthCodeResponses.get(n=e.code))?(this.logger.verbose("Existing acquireTokenByCode request found",e.correlationId),r.discardMeasurement()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),o=this.acquireTokenByCodeAsync(Fe(Fe({},e),{correlationId:t})).then((function(e){return i.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_BY_CODE_SUCCESS,J.Silent,e),i.hybridAuthCodeResponses.delete(n),r.addStaticFields({accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),r.endMeasurement({success:!0,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e})).catch((function(e){throw i.hybridAuthCodeResponses.delete(n),i.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_BY_CODE_FAILURE,J.Silent,null,e),r.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})),this.hybridAuthCodeResponses.set(n,o)),[2,o];if(e.nativeAccountId){if(this.canUseNative(e,e.nativeAccountId))return[2,this.acquireTokenNative(e,V.acquireTokenByCode,e.nativeAccountId).catch(()];throw bt.createUnableToAcquireTokenFromNativePlatformError()}throw bt.createAuthCodeOrNativeAccountIdRequiredError()}catch(e){throw this.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_BY_CODE_FAILURE,J.Silent,null,e),r.endMeasurement({errorCode:e instanceof ie&&e.errorCode||void 0,subErrorCode:e instanceof ie&&e.subError||void 0,success:!1}),e}return[2]}))}))},e.prototype.acquireTokenByCodeAsync=function(e){var t;return je(this,void 0,void 0,(function(){var r=this;return ze(this,()}))},e.prototype.acquireTokenFromCache=function(e,t,r){return je(this,void 0,void 0,(function(){return ze(this,(function(n){switch(this.performanceClient.addQueueMeasurement(Ct.AcquireTokenFromCache,t.correlationId),r.cacheLookupPolicy){case ne.Default:case ne.AccessToken:case ne.AccessTokenAndRefreshToken:return[2,e.acquireToken(t)];default:throw Je.createRefreshRequiredError()}return[2]}))}))},e.prototype.acquireTokenByRefreshToken=function(e,t){return je(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(this.performanceClient.addQueueMeasurement(Ct.AcquireTokenByRefreshToken,e.correlationId),t.cacheLookupPolicy){case ne.Default:case ne.AccessTokenAndRefreshToken:case ne.RefreshToken:case ne.RefreshTokenAndNetwork:return r=this.createSilentRefreshClient(e.correlationId),this.performanceClient.setPreQueueTime(Ct.SilentRefreshClientAcquireToken,e.correlationId),[2,r.acquireToken(e)];default:throw Je.createRefreshRequiredError()}return[2]}))}))},e.prototype.acquireTokenBySilentIframe=function(e){return je(this,void 0,void 0,(function(){var t;return ze(this,()}))},e.prototype.logout=e.prototype.logoutRedirect=function(e){return je(this,void 0,void 0,(function(){var t;return ze(this,(function(r){return t=this.getRequestCorrelationId(e),this.preflightBrowserEnvironmentCheck(J.Redirect),[2,this.createRedirectClient(t).logout(e)]}))}))},e.prototype.logoutPopup=e.prototype.getAllAccounts=e.prototype.getAccountByUsername=function(e){if(this.logger.trace("getAccountByUsername called"),!e)return this.logger.warning("getAccountByUsername: No username provided"),null;var t=this.browserStorage.getAccountInfoFilteredBy({username:e});return t?(this.logger.verbose("getAccountByUsername: Account matching username found, returning"),this.logger.verbosePii("getAccountByUsername: Returning signed-in accounts matching username: "+e),t):(this.logger.verbose("getAccountByUsername: No matching account found, returning null"),null)},e.prototype.getAccountByHomeId=function(e){if(this.logger.trace("getAccountByHomeId called"),!e)return this.logger.warning("getAccountByHomeId: No homeAccountId provided"),null;var t=this.browserStorage.getAccountInfoFilteredBy({homeAccountId:e});return t?(this.logger.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),this.logger.verbosePii("getAccountByHomeId: Returning signed-in accounts matching homeAccountId: "+e),t):(this.logger.verbose("getAccountByHomeId: No matching account found, returning null"),null)},e.prototype.getAccountByLocalId=e.prototype.setActiveAccount=function(e){this.browserStorage.setActiveAccount(e)},e.prototype.getActiveAccount=e.prototype.preflightBrowserEnvironmentCheck=function(e,t){if(void 0===t&&(t=!0),this.logger.verbose("preflightBrowserEnvironmentCheck started"),vr.blockNonBrowserEnvironment(this.isBrowserEnvironment),vr.blockRedirectInIframe(e,this.config.system.allowRedirectInIframe),vr.blockReloadInHiddenIframes(),vr.blockAcquireTokenInPopups(),vr.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),e===J.Redirect&&this.config.cache.cacheLocation===j.MemoryStorage&&!this.config.cache.storeAuthStateInCookie)throw kt.createInMemoryRedirectUnavailableError();e!==J.Redirect&&e!==J.Popup||this.preflightInteractiveRequest(t)},e.prototype.preflightInteractiveRequest=e.prototype.acquireTokenNative=function(e,t,r){return je(this,void 0,void 0,(function(){return ze(this,()}))},e.prototype.canUseNative=function(e,t){if(this.logger.trace("canUseNative called"),!Rr.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case T.NONE:case T.CONSENT:case T.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace("canUseNative: prompt = "+e.prompt+" is not compatible with native flow, returning false"),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))},e.prototype.getNativeAccountId=e.prototype.createPopupClient=function(e){return new Pr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},e.prototype.createRedirectClient=e.prototype.createSilentIframeClient=e.prototype.createSilentCacheClient=function(e){return new kr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)},e.prototype.createSilentRefreshClient=e.prototype.createSilentAuthCodeClient=e.prototype.addEventCallback=function(e){return this.eventHandler.addEventCallback(e)},e.prototype.removeEventCallback=e.prototype.addPerformanceCallback=function(e){return this.performanceClient.addPerformanceCallback(e)},e.prototype.removePerformanceCallback=e.prototype.enableAccountStorageEvents=function(){this.eventHandler.enableAccountStorageEvents()},e.prototype.disableAccountStorageEvents=e.prototype.getTokenCache=function(){return this.tokenCache},e.prototype.getLogger=function(){return this.logger},e.prototype.setLogger=function(e){this.logger=e},e.prototype.initializeWrapperLibrary=e.prototype.setNavigationClient=function(e){this.navigationClient=e},e.prototype.getConfiguration=function(){return this.config},e.prototype.getRequestCorrelationId=function(e){return(null==e?void 0:e.correlationId)?e.correlationId:this.isBrowserEnvironment?this.browserCrypto.createNewGuid():m.EMPTY_STRING},e}()),kn=r("6jEx"),Sn=function(){function e(t,r){this.logger=t,this.isSampled=!(null==r?void 0:r.disabled)&&this.calculateSampling(null==r?void 0:r.samplingPercentage),this.logger.verbose("PerformanceTelemetryReporter: Sampled for 1p telemetry: "+this.isSampled.toString()),this.eventsToEmit=(null==r?void 0:r.eventsToEmit)||[Ct.AcquireTokenSilent,Ct.SsoSilent,Ct.AcquireTokenByCode],this.logger.verbose("PerformanceTelemetryReporter: Events to be tracked include : "+this.eventsToEmit),this.logger.verbose("PerformanceTelemetryReporter: Events passed in the PerformanceTelemetryConfiguration are: "+(null==r?void 0:r.eventsToEmit));var n={instrumentationKey:e.instrumentationKey,extensions:[]};this.appInsights=new kn.a,this.appInsights.initialize(n,[]),this.logger.verbose("PerformanceTelemetryReporter: Initialized")}return e.prototype.calculateSampling=function(t){return 0===t?(this.logger.verbose(" PerformanceTelemetryReporter: No sampling rate configured."),!1):(this.logger.verbose("PerformanceTelemetryReporter: Configured sampling rate = "+t+" "),this.logger.verbose("PerformanceTelemetryReporter: DEFAULT sampling rate = "+e.DEFAULT_SAMPLING_RATE),Math.random()<=(t||e.DEFAULT_SAMPLING_RATE))},e.prototype.sendCustomEvent=function(e){var t=Ue(Ue({},e),{appName:void 0}),r={name:e.name,data:t};this.logger.verbose("PerformanceTelemetryReporter: Sending "+r.name+" for tracking"),this.appInsights.track(r)},e.prototype.canSendEvent=function(t){var r,n=!this.eventsToEmit||(null===(r=this.eventsToEmit)||void 0===r?void 0:r.indexOf(t.name))>-1,o=e.DEFAULT_ALLOWED_CLOUDS.some((function(e){return 0===t.authority.indexOf(e.toString())}));return this.isSampled&&n&&o},e.prototype.getPerformanceTelemetryCallback=function(){var e=this;return this.logger.trace("PerformanceTelemetryReporter: Attaching callback to send custom metrics."),this.logger.verbose(" PerformanceTelemetryReporter: Returning callback as telemetry emitted."),function(t){t.forEach((function(t){e.canSendEvent(t)?(e.logger.verbose("PerformanceTelemetryReporter: Emitting telemetry for "+t.name,t.correlationId),e.sendCustomEvent(t)):e.logger.verbose("PerformanceTelemetryReporter: Skipping telemetry for "+t.name,t.correlationId)}))}},e.DEFAULT_SAMPLING_RATE=.1,e.DEFAULT_ALLOWED_CLOUDS=[qt.AzurePublic,qt.AzurePpe],e.instrumentationKey="d634483c08244c1ca09af2b2d952c92e-ab2bba03-2ba3-49d8-a82c-ef6da750d8ab-7725",e}(),Rn=function(e){function t(t,r){var n=e.call(this,t)||this,o=new Sn(n.getLogger(),null==r?void 0:r.performanceTelemetryConfiguration);return n.addPerformanceCallback(o.getPerformanceTelemetryCallback()),n}return qe(t,e),t}(bn);function An(e){var t=e.brokerOptions;return{brokerOptions:Ue(Ue({},{preferredInteractionType:null,brokerRedirectParams:{},actAsBroker:!1,allowBrokering:!1,trustedBrokerDomains:[],brokerHandshakeTimeout:(null==t?void 0:t.brokerHandshakeTimeout)||2e3,brokerMessageTimeout:(null==t?void 0:t.brokerMessageTimeout)||6e3,brokerInteractionTimeout:(null==t?void 0:t.brokerInteractionTimeout)||3e5}),t)}}var Pn,Nn=function(){function e(){}return e.validateRedirectUri=e.validatePrompt=e.validateClaims=e.validateCodeChallengeParams=e.validateCodeChallengeMethod=function(e){if([ln,dn].indexOf(e)<0)throw $e.createInvalidCodeChallengeMethodError()},e.sanitizeEQParams=e}(),On=function(){eturn e.prototype.addResponseTypeCode=e.prototype.addResponseMode=e.prototype.addScopes=e.prototype.addClientId=function(e){this.parameters.set(f.CLIENT_ID,encodeURIComponent(e))},e.prototype.addBrokerClientId=function(e){this.parameters.set(rn.BROKER_CLIENT_ID,encodeURIComponent(e))},e.prototype.addRedirectUri=function(e,t){if(Nn.validateRedirectUri(e),t){var r=this.buildRedirectUri(e,t);this.parameters.set(f.REDIRECT_URI,encodeURIComponent(r))}else this.parameters.set(f.REDIRECT_URI,encodeURIComponent(e))},e.prototype.buildRedirectUri=function(e,t){return"brk-"+t+"://"+new At(e).getUrlComponents().HostNameAndPort},e.prototype.addBrokerRedirectUri=function(e){this.parameters.set(rn.BROKER_REDIRECT_URI,encodeURIComponent(e))},e.prototype.addPostLogoutRedirectUri=e.prototype.addIdTokenHint=function(e){this.parameters.set(f.ID_TOKEN_HINT,encodeURIComponent(e))},e.prototype.addDomainHint=function(e){this.parameters.set(C.DOMAIN_HINT,encodeURIComponent(e))},e.prototype.addLoginHint=function(e){this.parameters.set(C.LOGIN_HINT,encodeURIComponent(e))},e.prototype.addCcsUpn=e.prototype.addCcsOid=e.prototype.addSid=function(e){this.parameters.set(C.SID,encodeURIComponent(e))},e.prototype.addClaims=e.prototype.addCorrelationId=function(e){this.parameters.set(f.CLIENT_REQUEST_ID,encodeURIComponent(e))},e.prototype.addLibraryInfo=e.prototype.addPrompt=e.prototype.addState=function(e){et.isEmpty(e)||this.parameters.set(f.STATE,encodeURIComponent(e))},e.prototype.addNonce=function(e){this.parameters.set(f.NONCE,encodeURIComponent(e))},e.prototype.addCodeChallengeParams=e.prototype.addAuthorizationCode=function(e){this.parameters.set(f.CODE,encodeURIComponent(e))},e.prototype.addDeviceCode=function(e){this.parameters.set(f.DEVICE_CODE,encodeURIComponent(e))},e.prototype.addRefreshToken=function(e){this.parameters.set(f.REFRESH_TOKEN,encodeURIComponent(e))},e.prototype.addCodeVerifier=function(e){this.parameters.set(f.CODE_VERIFIER,encodeURIComponent(e))},e.prototype.addClientSecret=function(e){this.parameters.set(f.CLIENT_SECRET,encodeURIComponent(e))},e.prototype.addClientAssertion=function(e){this.parameters.set(f.CLIENT_ASSERTION,encodeURIComponent(e))},e.prototype.addClientAssertionType=function(e){this.parameters.set(f.CLIENT_ASSERTION_TYPE,encodeURIComponent(e))},e.prototype.addOboAssertion=function(e){this.parameters.set(f.OBO_ASSERTION,encodeURIComponent(e))},e.prototype.addRequestTokenUse=function(e){this.parameters.set(f.REQUESTED_TOKEN_USE,encodeURIComponent(e))},e.prototype.addGrantType=function(e){this.parameters.set(f.GRANT_TYPE,encodeURIComponent(e))},e.prototype.addClientInfo=e.prototype.addExtraQueryParameters=e.prototype.addClientCapabilitiesToClaims=function(e,t){var r;if(e)try{r=JSON.parse(e)}catch(e){throw $e.createInvalidClaimsRequestError()}else r={};return t&&t.length>0&&(r.hasOwnProperty(g.ACCESS_TOKEN)||(r[g.ACCESS_TOKEN]={}),r[g.ACCESS_TOKEN][g.XMS_CC]={values:t}),JSON.stringify(r)},e.prototype.addUsername=function(e){this.parameters.set(q.username,e)},e.prototype.addPassword=e.prototype.addPopToken=function(e){et.isEmpty(e)||(this.parameters.set(f.TOKEN_TYPE,O.POP),this.parameters.set(f.REQ_CNF,encodeURIComponent(e)))},e.prototype.addSshJwk=function(e){et.isEmpty(e)||(this.parameters.set(f.TOKEN_TYPE,O.SSH),this.parameters.set(f.REQ_CNF,encodeURIComponent(e)))},e.prototype.addServerTelemetry=function(e){this.parameters.set(f.X_CLIENT_CURR_TELEM,e.generateCurrentRequestHeaderValue()),this.parameters.set(f.X_CLIENT_LAST_TELEM,e.generateLastRequestHeaderValue())},e.prototype.addThrottling=function(){this.parameters.set(f.X_MS_LIB_CAPABILITY,x)},e.prototype.addLogoutHint=function(e){this.parameters.set(f.LOGOUT_HINT,encodeURIComponent(e))},e.prototype.createQueryString=function(){var e=new Array;return this.parameters.forEach((function(t,r){e.push(r+"="+t)})),e.join("&")},e}(),Mn=function(){return function(e,t,r,n,o){this.account=e||null,this.idToken=t||null,this.accessToken=r||null,this.refreshToken=n||null,this.appMetadata=o||null}}(),qn=function(){eturn e.prototype.validateServerAuthorizationCodeResponse=function(e,t,r){if(!e.state||!t)throw Je.createStateNotFoundError(e.state?"Cached State":"Server State");if(decodeURIComponent(e.state)!==decodeURIComponent(t))throw Je.createStateMismatchError();if(e.error||e.error_description||e.suberror){if(ue.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new ue(e.error||m.EMPTY_STRING,e.error_description,e.suberror);throw new Qt(e.error||m.EMPTY_STRING,e.error_description,e.suberror)}e.client_info&&rt(e.client_info,r)},e.prototype.validateTokenResponse=function(e){if(e.error||e.error_description||e.suberror){if(ue.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new ue(e.error,e.error_description,e.suberror);throw new Qt(e.error,e.error_codes+" - ["+e.timestamp+"]: "+e.error_description+" - Correlation ID: "+e.correlation_id+" - Trace ID: "+e.trace_id,e.suberror)}},e.prototype.handleServerTokenResponse=function(t,r,n,o,i,a,s){return He(this,void 0,void 0,(function(){var c,u,l,d,h;return Be(this,(function(p){switch(p.label){case 0:if(t.id_token&&(c=new at(t.id_token||m.EMPTY_STRING,this.cryptoObj),i&&!et.isEmpty(i.nonce)&&c.claims.nonce!==i.nonce))throw Je.createNonceMismatchError();this.homeAccountIdentifier=it.generateHomeAccountId(t.client_info||m.EMPTY_STRING,r.authorityType,this.logger,this.cryptoObj,c),i&&i.state&&(u=yt.parseRequestState(this.cryptoObj,i.state)),t.key_id=t.key_id||o.sshKid||void 0,l=this.generateCacheRecord(t,r,n,o,c,a,i),p.label=1;case 1:return p.trys.push([1,,5,8]),this.persistencePlugin&&this.serializableCache?(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),d=new er(this.serializableCache,!0),[4,this.persistencePlugin.beforeCacheAccess(d)]):[3,3];case 2:p.sent(),p.label=3;case 3:return s&&l.account&&(h=l.account.generateAccountKey(),!this.cacheStorage.getAccount(h))?(this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),[2,e.generateAuthenticationResult(this.cryptoObj,r,l,!1,o,c,u)]):[4,this.cacheStorage.saveCacheRecord(l)];case 4:return p.sent(),[3,8];case 5:return this.persistencePlugin&&this.serializableCache&&d?(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),[4,this.persistencePlugin.afterCacheAccess(d)]):[3,7];case 6:p.sent(),p.label=7;case 7:return[7];case 8:return[2,e.generateAuthenticationResult(this.cryptoObj,r,l,!1,o,c,u,t.spa_code)]}}))}))},e.prototype.handleBrokeredServerTokenResponse=function(t,r,n,o,i,a,s){return He(this,void 0,void 0,(function(){var c,u,l,d,h;return Be(this,(function(p){switch(p.label){case 0:if(t.id_token&&(c=new at(t.id_token||m.EMPTY_STRING,this.cryptoObj),a&&!et.isEmpty(a.nonce)&&c.claims.nonce!==a.nonce))throw Je.createNonceMismatchError();return this.homeAccountIdentifier=it.generateHomeAccountId(t.client_info||m.EMPTY_STRING,r.authorityType,this.logger,this.cryptoObj,c),a&&a.state&&(u=yt.parseRequestState(this.cryptoObj,a.state)),(l=this.generateCacheRecord(t,r,n,o,c,s,a,o.embeddedAppClientId)).refreshToken&&this.cacheStorage.setRefreshTokenCredential(l.refreshToken),l.account&&this.cacheStorage.setAccount(l.account),l.refreshToken=null,[4,e.generateAuthenticationResult(this.cryptoObj,r,l,!1,o,c,u)];case 1:return d=p.sent(),h=this.generateResponseThumbprint(r,o.scopes,o.embeddedAppClientId,i),[2,Ue(Ue({},d),{tokensToCache:l,responseThumbprint:h})]}}))}))},e.prototype.generateCacheRecord=function(e,t,r,n,o,i,a,s){var c,u,l=t.getPreferredCache();if(et.isEmpty(l))throw Je.createInvalidCacheEnvironmentError();!et.isEmpty(e.id_token)&&o&&(c=Ze.createIdTokenEntity(this.homeAccountIdentifier,l,e.id_token||m.EMPTY_STRING,s||this.clientId,o.claims.tid||m.EMPTY_STRING),u=this.generateAccountEntity(e,o,t,i,a));var d=null;if(!et.isEmpty(e.access_token)){var h=e.scope?tt.fromString(e.scope):new tt(n.scopes||[]),p=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,f=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,g=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,v=r+p,y=v+f,C=g&&g>0?r+g:void 0;d=ht.createAccessTokenEntity(this.homeAccountIdentifier,l,e.access_token||m.EMPTY_STRING,s||this.clientId,o?o.claims.tid||m.EMPTY_STRING:t.tenant,h.printScopes(),v,y,this.cryptoObj,C,e.token_type,i,e.key_id,n.claims,n.requestedClaimsHash)}var T=null;et.isEmpty(e.refresh_token)||(T=pt.createRefreshTokenEntity(this.homeAccountIdentifier,l,e.refresh_token||m.EMPTY_STRING,this.clientId,e.foci,i));var E=null;return et.isEmpty(e.foci)||(E=ft.createAppMetadataEntity(s||this.clientId,l,e.foci)),new Mn(u,c,d,T,E)},e.prototype.generateAccountEntity=function(e,t,r,n,o){var i=o?o.cloud_graph_host_name:"",a=o?o.msgraph_host:"";if(r.authorityType===We.Adfs)return this.logger.verbose("Authority type is ADFS, creating ADFS account"),it.createGenericAccount(this.homeAccountIdentifier,t,r,n,i,a);if(et.isEmpty(e.client_info)&&"AAD"===r.protocolMode)throw Je.createClientInfoEmptyError();return e.client_info?it.createAccount(e.client_info,this.homeAccountIdentifier,t,r,n,i,a):it.createGenericAccount(this.homeAccountIdentifier,t,r,n,i,a)},e.generateAuthenticationResult=function(e,t,r,n,o,i,a,s){var c,u,l;return He(this,void 0,void 0,(function(){var d,h,p,f,g,v,y,C,T;return Be(this,(function(E){switch(E.label){case 0:if(d="",h=[],p=null,g=m.EMPTY_STRING,!r.accessToken)return[3,4];if(r.accessToken.tokenType!==O.POP||!r.accessToken.keyId)return[3,2];if(v=new $t(e),C=(y=r.accessToken).secret,!(T=y.keyId))throw Je.createKeyIdMissingError();return[4,v.signPopToken(C,T,o)];case 1:return d=E.sent(),[3,3];case 2:d=r.accessToken.secret,E.label=3;case 3:h=tt.fromString(r.accessToken.target).asArray(),p=new Date(1e3*Number(r.accessToken.expiresOn)),f=new Date(1e3*Number(r.accessToken.extendedExpiresOn)),E.label=4;case 4:return r.appMetadata&&(g=r.appMetadata.familyId===P?P:m.EMPTY_STRING),[2,{authority:t.canonicalAuthority,uniqueId:(null==i?void 0:i.claims.oid)||(null==i?void 0:i.claims.sub)||m.EMPTY_STRING,tenantId:(null==i?void 0:i.claims.tid)||m.EMPTY_STRING,scopes:h,account:r.account?r.account.getAccountInfo():null,idToken:i?i.rawToken:m.EMPTY_STRING,idTokenClaims:i?i.claims:{},accessToken:d,fromCache:n,expiresOn:p,correlationId:o.correlationId,extExpiresOn:f,familyId:g,tokenType:(null===(c=r.accessToken)||void 0===c?void 0:c.tokenType)||m.EMPTY_STRING,state:a?a.userRequestState:m.EMPTY_STRING,cloudGraphHostName:(null===(u=r.account)||void 0===u?void 0:u.cloudGraphHostName)||m.EMPTY_STRING,msGraphHost:(null===(l=r.account)||void 0===l?void 0:l.msGraphHost)||m.EMPTY_STRING,code:s}]}}))}))},e.prototype.generateResponseThumbprint=function(e,t,r,n){return n+"."+this.cryptoObj.base64Encode(JSON.stringify({authority:e.canonicalAuthority,clientId:r,scopes:t}))},e}(),Un=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.getAuthCodeUrl=t.prototype.acquireToken=function(e,t){return He(this,void 0,void 0,(function(){var r,n,o;return Be(this,(function(i){switch(i.label){case 0:if(this.logger.verbose("in acquireToken call"),!e||et.isEmpty(e.code))throw Je.createTokenRequestCannotBeMadeError();return r=dt.nowSeconds(),[4,this.executeBrokerTokenRequest(this.authority,e)];case 1:return n=i.sent(),(o=new qn(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin)).validateTokenResponse(n.body),e.embeddedAppClientId?[3,3]:[4,o.handleServerTokenResponse(n.body,this.authority,r,e,t)];case 2:return[2,i.sent()];case 3:return[4,o.handleBrokeredServerTokenResponse(n.body,this.authority,r,e,e.redirectUri,t)];case 4:return[2,i.sent()]}}))}))},t.prototype.executeBrokerTokenRequest=function(e,t){return He(this,void 0,void 0,(function(){var r,n,o,i,a,s,c;return Be(this,(function(u){switch(u.label){case 0:return r={clientId:this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid},[4,this.createBrokerTokenRequestBody(t)];case 1:if(n=u.sent(),o=this.createBrokerTokenQueryParameters(t),i=void 0,t.clientInfo)try{a=rt(t.clientInfo,this.cryptoUtils),i={credential:a.uid+"."+a.utid,type:ot.HOME_ACCOUNT_ID}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}return s=this.createTokenRequestHeaders(i||t.ccsCredential),c=et.isEmpty(o)?e.tokenEndpoint:e.tokenEndpoint+"?"+o,[2,this.executePostToTokenEndpoint(c,n,s,r)]}}))}))},t.prototype.createBrokerAuthCodeUrlQueryString=function(e){var t=new On;t.addClientId(e.embeddedAppClientId);var r=Le(e.scopes||[],e.extraScopesToConsent||[]);t.addScopes(r),t.addRedirectUri(e.redirectUri,this.config.authOptions.clientId);var n=e.correlationId||this.config.cryptoInterface.createNewGuid();if(t.addCorrelationId(n),t.addResponseMode(e.responseMode),t.addResponseTypeCode(),t.addLibraryInfo(this.config.libraryInfo),t.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&t.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&t.addPrompt(e.prompt),e.domainHint&&t.addDomainHint(e.domainHint),e.prompt!==T.SELECT_ACCOUNT)if(e.sid&&e.prompt===T.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),t.addSid(e.sid);else if(e.account){var o=this.extractSidFromAccount(e.account);if(o&&e.prompt===T.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),t.addSid(o);try{var i=nt(e.account.homeAccountId);t.addCcsOid(i)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),t.addLoginHint(e.account.username);try{i=nt(e.account.homeAccountId),t.addCcsOid(i)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return e.nonce&&t.addNonce(e.nonce),e.state&&t.addState(e.state),(!et.isEmpty(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),t.addBrokerClientId(this.config.authOptions.clientId),t.addBrokerRedirectUri(e.brokerRedirectUri),t.createQueryString()},t.prototype.createBrokerTokenQueryParameters=function(e){var t=new On;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()},t.prototype.createBrokerTokenRequestBody=function(e){return He(this,void 0,void 0,(function(){var t,r,n,o,i,a;return Be(this,(function(s){switch(s.label){case 0:return(t=new On).addClientId(e.embeddedAppClientId),t.addRedirectUri(e.redirectUri,this.config.authOptions.clientId),t.addScopes(e.scopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addThrottling(),this.serverTelemetryManager&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),t.addGrantType("authorization_code"),t.addClientInfo(),e.authenticationScheme===O.POP&&e.resourceRequestMethod&&e.resourceRequestUri?[4,new $t(this.cryptoUtils).generateCnf(e)]:[3,2];case 1:return r=s.sent(),t.addPopToken(r.reqCnfString),[3,3];case 2:if(e.authenticationScheme===O.SSH){if(!e.sshJwk)throw $e.createMissingSshJwkError();t.addSshJwk(e.sshJwk)}s.label=3;case 3:if(n=e.correlationId||this.config.cryptoInterface.createNewGuid(),t.addCorrelationId(n),(!et.isEmpty(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),o=void 0,e.clientInfo)try{i=rt(e.clientInfo,this.cryptoUtils),o={credential:i.uid+"."+i.utid,type:ot.HOME_ACCOUNT_ID}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}else o=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&o)switch(o.type){case ot.HOME_ACCOUNT_ID:try{i=nt(o.credential),t.addCcsOid(i)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case ot.UPN:t.addCcsUpn(o.credential)}return e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[f.RETURN_SPA_CODE]||t.addExtraQueryParameters(((a={})[f.RETURN_SPA_CODE]="1",a)),t.addBrokerClientId(this.config.authOptions.clientId),t.addBrokerRedirectUri(e.brokerRedirectUri),[2,t.createQueryString()]}}))}))},t.prototype.extractSidFromAccount=t}(rr),Hn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.acquireToken=function(e){return He(this,void 0,void 0,(function(){var t,r,o,i,a,s,c,u;return Be(this,(function(l){switch(l.label){case 0:return[4,this.initializeBrokeredRequest(e,J.Redirect)];case 1:t=l.sent(),this.browserStorage.setRedirectRequestContext(t.embeddedAppClientId),this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null),r=this.initializeServerTelemetryManager(V.acquireTokenRedirect),l.label=2;case 2:return l.trys.push([2,7,,8]),[4,this.initializeAuthorizationCodeRequest(t)];case 3:return o=l.sent(),[4,this.createAuthCodeClient(r,t.authority)];case 4:return i=l.sent(),this.logger.verbose("Auth code client created"),a=new n.RedirectHandler(i,this.browserStorage,o,this.logger,this.browserCrypto,this.performanceClient),[4,i.getAuthCodeUrl(t)];case 5:return s=l.sent(),c=this.getRedirectStartPage(e.redirectStartPage),this.logger.verbosePii("Redirect start page: "+c),[4,a.initiateAuthRequest(s,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:c,onRedirectNavigate:e.onRedirectNavigate})];case 6:return[2,l.sent()];case 7:throw(u=l.sent())instanceof ie&&u.setCorrelationId(this.correlationId),r.cacheFailedRequest(u),this.browserStorage.cleanRequestByState(t.state),u;case 8:return[2]}}))}))},t.prototype.createAuthCodeClient=function(e,t){return He(this,void 0,void 0,(function(){var r;return Be(this,(function(n){switch(n.label){case 0:return[4,this.getClientConfiguration(e,t)];case 1:return r=n.sent(),[2,new Un(r)]}}))}))},t.prototype.initializeBrokeredRequest=function(e,t){return He(this,void 0,void 0,(function(){var r,n,o,i,a,s,c,u,l;return Be(this,(function(d){switch(d.label){case 0:return this.logger.verbose("initializeBrokeredRequest called"),r=m.EMPTY_STRING,e.state&&(n=yt.parseRequestState(this.browserCrypto,e.state),r=n&&n.userRequestState||""),o=e.authority||this.config.auth.authority,i=new tt(e.scopes||[]),a={interactionType:t,brokeredClientId:e.embeddedAppClientId,brokeredReqAuthority:o,brokeredReqScopes:i.printScopes()},s=yt.setRequestState(this.browserCrypto,r,a),(c=e.account||this.browserStorage.getActiveAccount())&&(this.logger.verbose("Setting validated request account"),this.logger.verbosePii("Setting validated request account: "+c)),u=e.nonce||this.browserCrypto.createNewGuid(),this.browserStorage.setInteractionInProgress(!0),l=[{}],[4,this.initializeBaseRequest(e)];case 1:return[2,Ue.apply(void 0,[Ue.apply(void 0,l.concat([d.sent()])),{account:c||void 0,state:s,nonce:u,responseMode:E.FRAGMENT,authority:o,correlationId:this.correlationId,scopes:Le(e&&e.scopes||[]),redirectUri:this.getRedirectUri(e.redirectUri),brokerRedirectUri:e.brokerRedirectUri,embeddedAppClientId:e.embeddedAppClientId}])]}}))}))},t}(n.RedirectClient),Bn=function(){function e(){}return e.setRequestState=function(t,r,n,o){var i=e.generateLibraryState(t,n,o);return et.isEmpty(r)?i:""+i+m.RESOURCE_DELIM+r},e.generateLibraryState=function(e,t,r){if(!e)throw Je.createNoCryptoObjectError("generateLibraryState");var n={id:r||e.createNewGuid()};t&&(n.meta=t);var o=JSON.stringify(n);return e.base64Encode(o)},e.parseRequestState=function(e,t){if(!e)throw Je.createNoCryptoObjectError("parseRequestState");if(et.isEmpty(t))throw Je.createInvalidStateError(t,"Null, undefined or empty state");try{var r=t.split(m.RESOURCE_DELIM),n=r[0],o=r.length>1?r.slice(1).join(m.RESOURCE_DELIM):"",i=e.base64Decode(n),a=JSON.parse(i);return{userRequestState:et.isEmpty(o)?"":o,libraryState:a}}catch(e){throw Je.createInvalidStateError(t,e.message)}},e}(),Dn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.acquireToken=function(e){return He(this,void 0,void 0,(function(){var t,r,n,o,i;return Be(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.initializeBrokeredRequest(e,J.Popup)];case 1:return t=a.sent(),this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null),r=this.generatePopupName(t.scopes,t.authority),n=e.popupWindowAttributes||{},this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),[2,this.acquireTokenPopupAsync(t,r,n)]):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),o=this.openSizedPopup("about:blank",r,n),[2,this.acquireTokenPopupAsync(t,r,n,o)]);case 2:return i=a.sent(),[2,Promise.reject(i)];case 3:return[2]}}))}))},t.prototype.createAuthCodeClient=function(e,t){return He(this,void 0,void 0,(function(){var r;return Be(this,(function(n){switch(n.label){case 0:return[4,this.getClientConfiguration(e,t)];case 1:return r=n.sent(),[2,new Un(r)]}}))}))},t.prototype.initializeBrokeredRequest=function(e,t){return He(this,void 0,void 0,(function(){var r,n,o,i,a,s,c,u,l,d;return Be(this,(function(h){switch(h.label){case 0:return this.logger.verbose("initializeBrokeredRequest called"),r=m.EMPTY_STRING,n=m.EMPTY_STRING,e.state&&(o=Bn.parseRequestState(this.browserCrypto,e.state),r=o&&o.userRequestState||m.EMPTY_STRING,n=o&&o.libraryState.id||m.EMPTY_STRING),i=e.authority||this.config.auth.authority,a=new tt(e.scopes||[]),s={interactionType:t,brokeredClientId:e.embeddedAppClientId,brokeredReqAuthority:i,brokeredReqScopes:a.printScopes()},c=Bn.setRequestState(this.browserCrypto,r,s,n),(u=e.account||this.browserStorage.getActiveAccount())&&(this.logger.verbose("Setting validated request account"),this.logger.verbosePii("Setting validated request account: "+u)),l=e.nonce||this.browserCrypto.createNewGuid(),this.browserStorage.setInteractionInProgress(!0),d=[{}],[4,this.initializeBaseRequest(e)];case 1:return[2,Ue.apply(void 0,[Ue.apply(void 0,d.concat([h.sent()])),{account:u||void 0,state:c,nonce:l,responseMode:E.FRAGMENT,authority:i,correlationId:this.correlationId,scopes:Le(e&&e.scopes||[]),redirectUri:this.getRedirectUri(e.redirectUri),brokerRedirectUri:e.brokerRedirectUri,embeddedAppClientId:e.embeddedAppClientId}])]}}))}))},t}(n.PopupClient),Ln=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.acquireToken=function(t){return He(this,void 0,void 0,(function(){var r;return Be(this,(function(n){switch(n.label){case 0:if(this.logger.verbose("acquireTokenByIframe called"),et.isEmpty(t.loginHint)&&et.isEmpty(t.sid)&&(!t.account||et.isEmpty(t.account.username))&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request."),t.prompt&&t.prompt!==T.NONE)throw bt.createSilentPromptValueError(t.prompt);return[4,this.initializeBrokeredRequest(Ue(Ue({},t),{prompt:T.NONE}),J.Silent)];case 1:return r=n.sent(),[2,e.prototype.acquireToken.call(this,r)]}}))}))},t.prototype.createAuthCodeClient=function(e,t){return He(this,void 0,void 0,(function(){var r;return Be(this,(function(n){switch(n.label){case 0:return[4,this.getClientConfiguration(e,t)];case 1:return r=n.sent(),[2,new Un(r)]}}))}))},t.prototype.initializeBrokeredRequest=function(e,t){return He(this,void 0,void 0,(function(){var r,n,o,i,a,s,c,u,l;return Be(this,(function(d){switch(d.label){case 0:return this.logger.verbose("initializeBrokeredRequest called"),r=m.EMPTY_STRING,e.state&&(n=yt.parseRequestState(this.browserCrypto,e.state),r=n&&n.userRequestState||""),o=e.authority||this.config.auth.authority,i=new tt(e.scopes||[]),a={interactionType:t,brokeredClientId:e.embeddedAppClientId,brokeredReqAuthority:o,brokeredReqScopes:i.printScopes()},s=yt.setRequestState(this.browserCrypto,r,a),(c=e.account||this.browserStorage.getActiveAccount())&&(this.logger.verbose("Setting validated request account"),this.logger.verbosePii("Setting validated request account: "+c)),u=e.nonce||this.browserCrypto.createNewGuid(),l=[{}],[4,this.initializeBaseRequest(e)];case 1:return[2,Ue.apply(void 0,[Ue.apply(void 0,l.concat([d.sent()])),{account:c||void 0,state:s,nonce:u,responseMode:E.FRAGMENT,authority:o,correlationId:this.correlationId,scopes:Le(e&&e.scopes||[]),redirectUri:this.getRedirectUri(e.redirectUri)}])]}}))}))},t}(n.SilentIframeClient),xn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.acquireToken=function(e){return He(this,void 0,void 0,(function(){var t,r,n;return Be(this,(function(o){switch(o.label){case 0:return t=dt.nowSeconds(),[4,this.executeBrokerTokenRequest(e,this.authority)];case 1:return r=o.sent(),(n=new qn(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin)).validateTokenResponse(r.body),e.embeddedAppClientId?[2,n.handleBrokeredServerTokenResponse(r.body,this.authority,t,e,e.embeddedAppRedirectUri)]:[2,n.handleServerTokenResponse(r.body,this.authority,t,e,void 0,void 0,!0)]}}))}))},t.prototype.acquireTokenByRefreshToken=function(e){return He(this,void 0,void 0,(function(){var t;return Be(this,(function(r){if(!e)throw $e.createEmptyTokenRequestError();if(!e.account)throw Je.createNoAccountInSilentRequestError();if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return[2,this.acquireBrokerTokenWithCachedRefreshToken(e,!0)]}catch(r){if(t=r instanceof Qt&&r.errorCode===K&&r.subError===F,r instanceof ue&&r.errorCode===ce||t)return[2,this.acquireBrokerTokenWithCachedRefreshToken(e,!1)];throw r}return[2,this.acquireBrokerTokenWithCachedRefreshToken(e,!1)]}))}))},t.prototype.executeBrokerTokenRequest=t.prototype.acquireBrokerTokenWithCachedRefreshToken=function(e,t){return He(this,void 0,void 0,(function(){var r,n;return Be(this,(function(o){if(!(r=this.cacheManager.getRefreshToken(e.account,t)))throw ue.createNoTokensFoundError();return n=Ue(Ue({},e),{refreshToken:r.secret}),[2,this.acquireToken(n)]}))}))},t.prototype.createBrokerTokenQueryParameters=function(e){var t=new On;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()},t.prototype.createBrokerTokenRequestBody=function(e){return He(this,void 0,void 0,(function(){var t,r,n,o;return Be(this,(function(i){switch(i.label){case 0:return(t=new On).addClientId(e.embeddedAppClientId),t.addScopes(e.scopes),t.addGrantType("refresh_token"),t.addClientInfo(),t.addLibraryInfo(this.config.libraryInfo),t.addThrottling(),this.serverTelemetryManager&&t.addServerTelemetry(this.serverTelemetryManager),r=e.correlationId||this.config.cryptoInterface.createNewGuid(),t.addCorrelationId(r),t.addRefreshToken(e.refreshToken),e.authenticationScheme!==O.POP?[3,2]:[4,new $t(this.cryptoUtils).generateCnf(e)];case 1:return n=i.sent(),t.addPopToken(n.reqCnfString),[3,3];case 2:if(e.authenticationScheme===O.SSH){if(!e.sshJwk)throw $e.createMissingSshJwkError();t.addSshJwk(e.sshJwk)}i.label=3;case 3:if((!et.isEmpty(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case ot.HOME_ACCOUNT_ID:try{o=nt(e.ccsCredential.credential),t.addCcsOid(o)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case ot.UPN:t.addCcsUpn(e.ccsCredential.credential)}return t.addBrokerClientId(this.config.authOptions.clientId),t.addRedirectUri(e.embeddedAppRedirectUri,this.config.authOptions.clientId),[2,t.createQueryString()]}}))}))},t}(wr),Kn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.acquireToken=function(e){return He(this,void 0,void 0,(function(){var t,r,n,o=this;return Be(this,(function(i){switch(i.label){case 0:return t=Ue(Ue({},e),this.initializeBaseRequest(e,e.account)),r=this.initializeServerTelemetryManager(V.acquireTokenSilent_silentFlow),[4,this.createRefreshTokenClient(r,t.authority)];case 1:return n=i.sent(),this.logger.verbose("Refresh token client created"),[2,n.acquireTokenByRefreshToken(t).catch(()]}}))}))},t.prototype.createRefreshTokenClient=t}(n.SilentRefreshClient),Fn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.generateBrokerResponseKey=t.prototype.getBrokerResponseByOrigin=function(e){var t=this.getMemoryKeys(),r=tn.BROKER_RESPONSE+"."+e,n=t.filter(();return n.length<=0?null:(n.length>1&&this.logger.error("Too many responses found for the origin, sending back the first one found. You may need to call login/acquireTokenPopup/Silent() again."),this.getBrokerResponse(n[0]))},t.prototype.getBrokerResponseByThumbprint=function(e,t){var r=t+"."+this.cryptoImpl.base64Encode(JSON.stringify(e));return this.getBrokerResponse(tn.BROKER_RESPONSE+"."+r)},t.prototype.getBrokerResponse=function(e){var t=this.getMemoryCache(e);return t?(this.removeMemoryItem(e),t):null},t.prototype.removeMemoryItem=t.prototype.getMemoryCache=function(e){var t=this.generateCacheKey(e);return this.internalStorage.getItem(t)||null},t.prototype.setMemoryCache=t.prototype.getMemoryKeys=function(){return this.internalStorage.getKeys()},t}(n.BrowserCacheManager),Gn=function(e){function t(t,r,n,o,i,a,s,c,u,l,d,h){var p=e.call(this,t,r,n,o,i,a,s,c,u,l,d,h)||this;return p.embeddedAppClientId="",p.embeddedAppOrigin="",p}return qe(t,e),t.prototype.acquireToken=function(t){return He(this,void 0,void 0,(function(){var r;return Be(this,(function(n){switch(n.label){case 0:return this.logger.verbose("Getting tokens from brokered native flow."),this.embeddedAppClientId=(r=t).embeddedAppClientId,this.embeddedAppOrigin=r.embeddedAppRedirectUri,[4,e.prototype.acquireToken.call(this,r)];case 1:return[2,n.sent()]}}))}))},t.prototype.handleNativeResponse=function(t,r,n){var o;return He(this,void 0,void 0,(function(){var i,a,s,c,u,l,d,h;return Be(this,(function(p){switch(p.label){case 0:return this.logger.trace("BrokerNativeInteractionClient - handleNativeResponse called"),a="",s=this.createIdTokenObj(t),c=this.createHomeAccountIdentifier(t,s),u=null===(o=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:r.accountId}))||void 0===o?void 0:o.homeAccountId,l=new qn(this.config.auth.clientId,this.browserStorage,this.browserCrypto,this.logger,null,null),[4,this.getDiscoveredAuthority(r.authority)];case 1:return d=p.sent(),c!==u||t.account.id===r.accountId?[3,3]:(this.logger.verbose("Getting tokens from brokered native flow."),[4,this.handleEmbeddedNativeResponse(t,r,c,s,n)]);case 2:return i=p.sent(),a=l.generateResponseThumbprint(d,tt.fromString(t.scope).asArray(),this.embeddedAppClientId||r.embeddedAppClientId,this.embeddedAppOrigin||r.embeddedAppRedirectUri),[3,5];case 3:return[4,e.prototype.handleNativeResponse.call(this,t,r,n)];case 4:i=p.sent(),p.label=5;case 5:return h=l.generateCacheRecord(t,d,n,this.convertNativeRequestToBaseAuthRequest(r),s,void 0,void 0,this.embeddedAppClientId||r.embeddedAppClientId),[2,Ue(Ue({},i),{tokensToCache:h,responseThumbprint:a})]}}))}))},t.prototype.handleEmbeddedNativeResponse=function(e,t,r,n,o){return He(this,void 0,void 0,(function(){var i,a,s;return Be(this,(function(c){switch(c.label){case 0:return[4,this.getDiscoveredAuthority(t.authority)];case 1:return i=c.sent(),a=i.getPreferredCache(),s=this.createAccountEntity(e,r,n,a),[4,this.generateAuthenticationResult(e,t,n,s,i.canonicalAuthority,o)];case 2:return[2,c.sent()]}}))}))},t.prototype.convertNativeRequestToBaseAuthRequest=function(e){var t=e.scope,r=e,["scope"]),n=tt.fromString(t);return Ue(Ue({},r),{scopes:n.asArray()})},t}(n.NativeInteractionClient);!Pn||(Pn={}));var jn=new Set(["brokerInteractionTimeoutMs","brokerMessageTimeoutMs","brokerHandshakeTimeoutMs","brokerIframeTimeoutMs"]);unction Qn(e,t){e&&e.addStaticFields(function(e){var t,r;try{for(var n=Object.keys(e)),o=n.next();!o.done;o=n.next()){var i=o.value;jn.has(i)&&"number"==typeof e[i]&&(e[i]=Math.floor(e[i]))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return e}(t))}var Yn,Wn,Vn=function(e){function t(t,r){var n=e.call(this,t)||this;return n.brokerStorage=new Fn(n.config.auth.clientId,n.config.cache,n.browserCrypto,n.logger),n.currentBrokerRedirectResponse=void 0,n.hybridAuthPromise=void 0,n.experimentalConfig=An(r),n}return qe(t,e),t.prototype.handleRedirectPromise=function(e){return He(this,void 0,void 0,(function(){var t,r;return Be(this,(function(o){switch(o.label){case 0:return t=this.handleBrokerRedirect(e),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(n.TemporaryCacheKeys.REDIRECT_CONTEXT)),this.currentBrokerRedirectResponse=this.waitForBrokeredResponse(t),[4,this.currentBrokerRedirectResponse];case 1:return r=o.sent(),this.currentBrokerRedirectResponse=void 0,[2,r&&!r.tokensToCache?r:null]}}))}))},t.prototype.getRequestContext=function(){return this.brokerStorage.getRedirectRequestContext()},t.prototype.handleBrokerRedirect=function(e){return He(this,void 0,void 0,(function(){var t,r,o,i,a,s,c,u,l=this;return Be(this,(function(d){return this.eventHandler.emitEvent(sr.HANDLE_REDIRECT_START,J.Redirect),this.logger.verbose("handleBrokerRedirect called"),t=this.getAllAccounts(),this.isBrowserEnvironment?(void 0===(o=this.redirectResponse.get(r=e||m.EMPTY_STRING))?(this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise"),i=this.browserStorage.getCachedNativeRequest(),a=void 0,i&&n.NativeMessageHandler.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e?(this.logger.trace("handleRedirectPromise - acquiring token from native platform"),s=new Gn(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,V.ssoSilent,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(i),this.nativeInternalStorage,i.correlationId),a=s.handleRedirectPromise()):(c=this.browserStorage.getTemporaryCache(n.TemporaryCacheKeys.CORRELATION_ID,!0)||"",u=new Hn(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,c),a=u.handleRedirectPromise(e)),o=a.then((function(e){return e&&(t.length<l.getAllAccounts().length?(l.eventHandler.emitEvent(sr.LOGIN_SUCCESS,J.Redirect,e),l.logger.verbose("handleRedirectResponse returned result, login success")):(l.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_SUCCESS,J.Redirect,e),l.logger.verbose("handleRedirectResponse returned result, acquire token success"))),l.eventHandler.emitEvent(sr.HANDLE_REDIRECT_END,J.Redirect),e})).catch((function(e){throw l.eventHandler.emitEvent(t.length>0?sr.ACQUIRE_TOKEN_FAILURE:sr.LOGIN_FAILURE,J.Redirect,null,e),l.eventHandler.emitEvent(sr.HANDLE_REDIRECT_END,J.Redirect),e})),this.redirectResponse.set(r,o)):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),[2,o]):(this.logger.verbose("handleRedirectPromise returns null, not browser environment"),[2,null])}))}))},t.prototype.waitForBrokeredResponse=function(e){return He(this,void 0,void 0,(function(){var t;return Be(this,(function(r){switch(r.label){case 0:return[4,e];case 1:if(t=r.sent()){if(!t.tokensToCache)return[2,t];this.brokerStorage.setMemoryCache(this.brokerStorage.generateBrokerResponseKey(t.responseThumbprint),JSON.stringify(t)),this.setActiveAccount(t.account)}return[2,null]}}))}))},t.prototype.listenForBrokerMessage=function(e){return He(this,void 0,void 0,(function(){return Be(this,(function(t){return this.logger.verbose("listening for child broker messages."),window.addEventListener("message",this.handleBrokerMessage.bind(this)),e&&e.codeRequest&&(this.hybridAuthPromise=this.acquireTokenByCode(e.codeRequest)),[2,this.hybridAuthPromise]}))}))},t.prototype.handleBrokerMessage=function(e){return He(this,void 0,void 0,(function(){var t;return Be(this,(function(r){switch(r.label){case 0:if(!(t=hn.validateMessage(e)))return[3,8];switch(t.data.messageType){case en.HANDSHAKE_REQUEST:return[3,1];case en.HANDLE_REDIRECT_REQUEST:return[3,3];case en.AUTH_REQUEST:return[3,5]}return[3,7];case 1:return this.logger.verbose("Broker handshake request received"),[4,this.handleBrokerHandshake(t)];case 2:return[2,r.sent()];case 3:return this.logger.verbose("Broker handle redirect request received"),[4,this.handleBrokerRedirectResponse(t)];case 4:return[2,r.sent()];case 5:return this.logger.verbose("Broker auth request received"),[4,this.handleBrokerAuthRequest(t)];case 6:return[2,r.sent()];case 7:case 8:return[2]}}))}))},t.prototype.handleBrokerHandshake=function(e){return He(this,void 0,void 0,(function(){var t,r,n,o;return Be(this,(function(i){switch(i.label){case 0:if(t=zn(this.performanceClient,Pn.BrokerClientApplicationHandleBrokerHandshake),r=pn.validate(e),this.logger.verbose("Broker handshake validated: "+JSON.stringify(r)),n=new gn(fr,""),!this.hybridAuthPromise)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.hybridAuthPromise];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),this.logger.error("Broker could obtain tokens use authorization code initializer: "+o),[3,4];case 4:return e.source.postMessage(n,e.origin),t.endMeasurement({success:!0}),this.logger.verbose("Sending handshake response to "+e.origin),[2]}}))}))},t.prototype.handleBrokerRedirectResponse=function(e){return He(this,void 0,void 0,(function(){var t,r,n,o,i;return Be(this,(function(a){switch(a.label){case 0:return Cn.validate(e)?(t=e.ports[0],this.currentBrokerRedirectResponse?[4,this.currentBrokerRedirectResponse]:[3,2]):[3,3];case 1:a.sent(),a.label=2;case 2:if(r=this.brokerStorage.getBrokerResponseByOrigin(e.origin))return n=JSON.parse(r),o=e.ports[0],i=new yn(J.Redirect,n),this.logger.verbosePii("Sending auth response"),o.postMessage(i),o.close(),[2];i=new yn(J.Redirect,null),t.postMessage(i),t.close(),a.label=3;case 3:return[2]}}))}))},t.prototype.handleBrokerAuthRequest=function(e){return He(this,void 0,void 0,(function(){var t,r,n,o,i,a,s;return Be(this,(function(c){switch(c.label){case 0:if(!(t=mn.validate(e)))return[3,3];if(!t.request.authority||!t.request.scopes)throw fn.createBrokerRequestIncompleteError();return zn(this.performanceClient,Ct.AcquireTokenByBroker,t.request.correlationId),this.logger.verbose("Broker auth request validated: "+t),this.currentBrokerRedirectResponse?[4,this.currentBrokerRedirectResponse]:[3,2];case 1:c.sent(),c.label=2;case 2:if(r=this.brokerStorage.getBrokerResponseByThumbprint({authority:t.request.authority,clientId:t.embeddedClientId,scopes:t.request.scopes},this.getEmbeddedAppRedirectUri(t.embeddedAppOrigin)))return n=JSON.parse(r),o=e.ports[0],i=new yn(J.Redirect,n),this.logger.verbosePii("Sending auth response"),o.postMessage(i),o.close(),[2];switch(a=t.request.account||this.getActiveAccount(),t.interactionType){case J.Silent:return a?[2,this.brokeredSilentRequest(t,e.ports[0],a)]:[2,this.brokeredSsoSilentRequest(t,e.ports[0])];case J.Redirect:case J.Popup:default:return s=this.getInteractionType(t.interactionType),[2,this.interactiveBrokerRequest(s,t,e)]}c.label=3;case 3:return[2]}}))}))},t.prototype.getInteractionType=t.prototype.interactiveBrokerRequest=function(e,t,r){return He(this,void 0,void 0,(function(){return Be(this,(function(n){switch(e){case J.Redirect:return[2,this.brokeredRedirectRequest(t,r.ports[0])];case J.Popup:return[2,this.brokeredPopupRequest(t,r.ports[0])];case J.Silent:return this.logger.error("Invalid code path. interactiveBrokerRequest() should only be called for interactive requests."),[2];case J.None:return this.logger.error("Broker is blocking interactive requests. Please attempt a silent request or sign into the broker first."),[2];default:return this.logger.error("Invalid code path. interactiveBrokerRequest() should only be called for interactive requests."),[2]}}))}))},t.prototype.brokeredRedirectRequest=function(e,t){var r,n;return He(this,void 0,void 0,(function(){var o,i,a,s,c,u,l;return Be(this,(function(d){switch(d.label){case 0:this.logger.verbose("Brokered redirect request initiated."),d.label=1;case 1:return d.trys.push([1,5,,6]),o=new vn,t.postMessage(o),t.close(),this.logger.verbose("Sending redirect response: "+o),a=new Hn(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,(i=e.request).correlationId),i.redirectUri=e.embeddedAppOrigin,i.embeddedAppClientId=e.embeddedClientId,i.brokerRedirectUri=a.getRedirectUri(),i.redirectStartPage=null===(r=this.experimentalConfig.brokerOptions.brokerRedirectParams)||void 0===r?void 0:r.redirectStartPage,i.onRedirectNavigate=null===(n=this.experimentalConfig.brokerOptions.brokerRedirectParams)||void 0===n?void 0:n.onRedirectNavigate,s=i.account||this.getActiveAccount(),this.canUseNative(i,null==s?void 0:s.nativeAccountId)?(this.logger.verbose("Native flow available for broker."),i.embeddedAppRedirectUri=this.getEmbeddedAppRedirectUri(e.embeddedAppOrigin),(c=e.request).extraQueryParameters=Ue(Ue({},c.extraQueryParameters),{child_client_id:i.embeddedAppClientId,child_redirect_uri:i.embeddedAppRedirectUri}),c.redirectUri=vr.getCurrentUri(),this.browserStorage.setRedirectRequestContext(i.embeddedAppClientId),this.browserStorage.setInteractionInProgress(!0),[4,this.acquireTokenByNative(c,V.acquireTokenRedirect)]):[3,3];case 2:return d.sent(),[3,4];case 3:return[2,a.acquireToken(i)];case 4:return[3,6];case 5:return u=d.sent(),l=new yn(J.Redirect,null,u),this.logger.verbose("Found auth error in redirect: "+u),t.postMessage(l),t.close(),[3,6];case 6:return[2]}}))}))},t.prototype.brokeredPopupRequest=function(e,t){return He(this,void 0,void 0,(function(){var r,n,o,i,a,s,c;return Be(this,(function(u){switch(u.label){case 0:this.logger.verbose("Brokered popup request initiated."),u.label=1;case 1:return u.trys.push([1,6,,7]),n=new Dn(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,(r=e.request).correlationId),r.redirectUri=e.embeddedAppOrigin,r.embeddedAppClientId=e.embeddedClientId,r.brokerRedirectUri=n.getRedirectUri(),o=void 0,i=r.account||this.getActiveAccount(),this.canUseNative(r,null==i?void 0:i.nativeAccountId)?(this.logger.verbose("Native flow available for broker."),r.embeddedAppRedirectUri=this.getEmbeddedAppRedirectUri(e.embeddedAppOrigin),(a=e.request).extraQueryParameters=Ue(Ue({},a.extraQueryParameters),{child_client_id:r.embeddedAppClientId,child_redirect_uri:r.embeddedAppRedirectUri}),a.redirectUri=vr.getCurrentUri(),[4,this.acquireTokenByNative(a,V.acquireTokenPopup)]):[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,n.acquireToken(r)];case 4:o=u.sent(),u.label=5;case 5:return c=new yn(J.Popup,o),this.logger.verbosePii("Sending auth response"),t.postMessage(c),t.close(),[3,7];case 6:return s=u.sent(),c=new yn(J.Popup,null,s),this.logger.verbose("Found auth error in popup: "+s),t.postMessage(c),t.close(),[3,7];case 7:return[2]}}))}))},t.prototype.brokeredSsoSilentRequest=function(e,t){var r,n,o,i;return He(this,void 0,void 0,(function(){var a,s,c,u,l,d,h,p;return Be(this,(function(f){switch(f.label){case 0:a=zn(this.performanceClient,Pn.BrokerClientApplicationBrokeredSSOSilentRequest,e.request.correlationId),this.logger.verbose("Brokered SSO Silent request initiated."),f.label=1;case 1:return f.trys.push([1,6,,7]),c=new Ln(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,V.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,(s=e.request).correlationId),s.redirectUri=e.embeddedAppOrigin,s.embeddedAppClientId=e.embeddedClientId,s.brokerRedirectUri=c.getRedirectUri(),u=void 0,l=s.account||this.getActiveAccount(),this.canUseNative(s,null==l?void 0:l.nativeAccountId)?(this.logger.verbose("Native flow available for broker."),s.embeddedAppRedirectUri=this.getEmbeddedAppRedirectUri(e.embeddedAppOrigin),(d=e.request).extraQueryParameters=Ue(Ue({},d.extraQueryParameters),{child_client_id:s.embeddedAppClientId,child_redirect_uri:s.embeddedAppRedirectUri}),d.redirectUri=vr.getCurrentUri(),[4,this.acquireTokenByNative(d,V.ssoSilent)]):[3,3];case 2:return u=f.sent(),[3,5];case 3:return[4,c.acquireToken(s)];case 4:u=f.sent(),f.label=5;case 5:return p=new yn(J.Silent,u),this.logger.verbosePii("Sending auth response"),t.postMessage(p),t.close(),a.endMeasurement({success:!0,fromCache:null===(r=p.result)||void 0===r?void 0:r.fromCache,accessTokenSize:null===(n=p.result)||void 0===n?void 0:n.accessToken.length,idTokenSize:null===(o=p.result)||void 0===o?void 0:o.idToken.length,requestId:null===(i=p.result)||void 0===i?void 0:i.requestId}),[3,7];case 6:return h=f.sent(),p=new yn(J.Silent,null,h),this.logger.verbose("Found auth error in ssoSilent: "+h),t.postMessage(p),t.close(),a.endMeasurement({errorCode:h.errorCode,subErrorCode:h.subError,success:!1}),[3,7];case 7:return[2]}}))}))},t.prototype.brokeredSilentRequest=function(e,t,r){return He(this,void 0,void 0,(function(){var n,o,i,a,s,c,u,l;return Be(this,(function(d){switch(d.label){case 0:n=zn(this.performanceClient,Pn.BrokerClientApplicationBrokeredSilentRequest,e.request.correlationId),this.logger.verbose("Brokered Silent request initiated."),d.label=1;case 1:return d.trys.push([1,6,,7]),(o=e.request).embeddedAppClientId=e.embeddedClientId,o.embeddedAppRedirectUri=e.embeddedAppOrigin,o.account||(o.account=r),i=void 0,this.canUseNative(o)?(this.logger.verbose("Native flow available for broker."),o.embeddedAppRedirectUri=this.getEmbeddedAppRedirectUri(e.embeddedAppOrigin),(a=e.request).extraQueryParameters=Ue(Ue({},a.extraQueryParameters),{child_client_id:o.embeddedAppClientId,child_redirect_uri:o.embeddedAppRedirectUri}),a.redirectUri=vr.getCurrentUri(),[4,this.acquireTokenByNative(a,V.acquireTokenSilent_silentFlow)]):[3,3];case 2:return i=d.sent(),[3,5];case 3:return[4,this.acquireTokenByRefreshToken(o)];case 4:i=d.sent(),d.label=5;case 5:return(l=new yn(J.Silent,i)).result&&l.result.tokensToCache?(this.logger.verbosePii("Sending auth response: "+JSON.stringify(l)),t.postMessage(l),t.close(),n.endMeasurement({success:!0,fromCache:l.result.fromCache,accessTokenSize:l.result.accessToken.length,idTokenSize:l.result.idToken.length,isNativeBroker:l.result.fromNativeBroker,requestId:l.result.requestId})):(s=fn.createNoTokensToCacheError(),c=new yn(J.Silent,null,s),this.logger.verbose(""+s),t.postMessage(c),t.close(),n.endMeasurement({errorCode:s.errorCode,subErrorCode:s.subError,success:!1})),[3,7];case 6:return u=d.sent(),l=new yn(J.Silent,null,u),this.logger.verbose("Found auth error in silent: "+u),t.postMessage(l),t.close(),n.endMeasurement({errorCode:u.errorCode,subErrorCode:u.subError,success:!1}),[3,7];case 7:return[2]}}))}))},t.prototype.acquireTokenByRefreshToken=function(e){return He(this,void 0,void 0,(function(){var t,r=this;return Be(this,(function(o){return this.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_NETWORK_START,J.Silent,e),vr.blockReloadInHiddenIframes(),[2,(t=new Kn(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e.correlationId)).acquireToken(e).catch((function(o){if(o instanceof Qt&&o.errorCode===n.BrowserConstants.INVALID_GRANT_ERROR&&!(o instanceof ue))return r.logger.verbose("Refresh token expired or invalid, attempting acquire token by iframe",e.correlationId),new Ln(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,V.acquireTokenSilent_authCode,r.performanceClient,r.nativeInternalStorage,r.nativeExtensionProvider).acquireToken(Ue(Ue({},e),{brokerRedirectUri:t.getRedirectUri()}));throw o}))]}))}))},t.prototype.acquireTokenByNative=function(e,t,r){return He(this,void 0,void 0,(function(){var o,i=this;return Be(this,(function(a){if(this.logger.trace("Brokered acquireTokenNative called"),!this.nativeExtensionProvider)throw bt.createNativeConnectionNotEstablishedError();return o=new Gn(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,V.ssoSilent,this.performanceClient,this.nativeExtensionProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId),t===V.acquireTokenRedirect?[2,o.acquireTokenRedirect(e)]:[2,o.acquireToken(e).catch((function(e){throw e instanceof n.NativeAuthError&&e.isFatal()&&(i.nativeExtensionProvider=void 0),e}))]}))}))},t.prototype.getEmbeddedAppRedirectUri=function(e){return(new On).buildRedirectUri(e,this.config.auth.clientId)},t}(Rn);!function(e){e.Interaction="brokerInteractionTimeoutMs",e.Message="brokerMessageTimeoutMs",e.Iframe="brokerIframeTimeoutMs"}(Yn||(Yn={})),function(e){e.Interaction="brokerInteractionTimedOut",e.Message="brokerMessageTimedOut",e.Iframe="brokerIframeTimedOut"}(Wn||(Wn={}));var Jn,Xn,Zn=function(){function e(e,t,r,n,o){this.brokerOpts=t,this.clientId=e,this.logger=r,this.browserStorage=n,this.brokerConnectionEstablished=!1,this.version=fr,this.brokerOrigin=m.EMPTY_STRING,this.performanceClient=o}return Object.defineProperty(e.prototype,"trustedBrokersProvided",{get:function(){return!!this.brokerOpts.trustedBrokerDomains&&this.brokerOpts.trustedBrokerDomains.length>=1},enumerable:!1,configurable:!0}),e.prototype.initiateHandshake=function(e){return He(this,void 0,void 0,(function(){var t,r;return Be(this,(function(n){switch(n.label){case 0:if(!this.trustedBrokersProvided)throw fn.createNoTrustedBrokersProvidedError();n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.sendHandshakeRequest(e)];case 2:return t=n.sent(),this.brokerOrigin=t.brokerOrigin,this.brokerConnectionEstablished=!0,[3,4];case 3:return r=n.sent(),this.logger.error(r.message),this.brokerConnectionEstablished=!1,[3,4];case 4:return[2]}}))}))},e.prototype.preflightBrokerRequest=function(){return He(this,void 0,void 0,(function(){var e;return Be(this,(function(t){switch(t.label){case 0:if(this.brokerConnectionEstablished)return[3,4];this.logger.verbose("Attempting handshake..."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.initiateHandshake(this.performanceEvent)];case 2:return t.sent(),[3,4];case 3:throw e=t.sent(),this.logger.error("Handshake rejected"),fn.createBrokeringDisabledError(e.message);case 4:return[2]}}))}))},e.prototype.sendSsoSilentRequest=function(e){return He(this,void 0,void 0,(function(){var t,r,n;return Be(this,(function(o){switch(o.label){case 0:this.performanceEvent=zn(this.performanceClient,Pn.EmbeddedClientApplicationSendSSOSilentRequest,e.correlationId),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.preflightBrokerRequest()];case 2:return o.sent(),[4,this.sendRequest(e,J.Silent,{type:Yn.Iframe,error:Wn.Iframe,value:Mr})];case 3:if(t=o.sent(),!(r=yn.processBrokerResponseMessage(t,this.browserStorage)))throw this.performanceEvent.endMeasurement({success:!1}),this.logger.errorPii("Broker response is empty in brokered ssoSilent request: "+JSON.stringify(r)),fn.createBrokerResponseInvalidError();return this.performanceEvent.endMeasurement({success:!0,fromCache:r.fromCache,accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length,isNativeBroker:r.fromNativeBroker,requestId:r.requestId}),[2,r];case 4:throw n=o.sent(),this.performanceEvent.endMeasurement({success:!1}),n;case 5:return[2]}}))}))},e.prototype.sendPopupRequest=function(e){return He(this,void 0,void 0,(function(){var t,r,n;return Be(this,(function(o){switch(o.label){case 0:this.performanceEvent=zn(this.performanceClient,Pn.EmbeddedClientApplicationSendPopupRequest,e.correlationId),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.preflightBrokerRequest()];case 2:return o.sent(),[4,this.sendRequest(e,J.Popup,{type:Yn.Interaction,error:Wn.Interaction,value:this.brokerOpts.brokerInteractionTimeout})];case 3:if(t=o.sent(),!(r=yn.processBrokerResponseMessage(t,this.browserStorage))){if(this.performanceEvent.endMeasurement({success:!1}),!vn.validate(t))throw this.logger.errorPii("Broker response is empty in brokered popup request: "+JSON.stringify(r)),fn.createBrokerResponseInvalidError();throw this.logger.verbose("popupRequest requires a redirect by the broker, this app will now redirect."),fn.createBrokerPopupRequestRedirectingError()}return this.performanceEvent.endMeasurement({success:!0,fromCache:r.fromCache,accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length,isNativeBroker:r.fromNativeBroker,requestId:r.requestId}),[2,r];case 4:throw n=o.sent(),this.performanceEvent.endMeasurement({success:!1}),n;case 5:return[2]}}))}))},e.prototype.sendRedirectRequest=function(e){return He(this,void 0,void 0,(function(){var t,r,n;return Be(this,(function(o){switch(o.label){case 0:this.performanceEvent=zn(this.performanceClient,Pn.EmbeddedClientApplicationSendRedirectRequest,e.correlationId),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.preflightBrokerRequest()];case 2:return o.sent(),[4,this.sendRequest(e,J.Redirect,{type:Yn.Interaction,error:Wn.Interaction,value:this.brokerOpts.brokerInteractionTimeout})];case 3:if(t=o.sent(),!(r=vn.validate(t)))throw this.logger.errorPii("Broker response is not a redirect: "+JSON.stringify(r)),fn.createBrokerResponseInvalidError();return this.logger.verbose("Broker redirecting: "+r),this.performanceEvent.endMeasurement({success:!0}),[3,5];case 4:throw n=o.sent(),this.performanceEvent.endMeasurement({success:!1}),n;case 5:return[2]}}))}))},e.prototype.sendHandleRedirectRequest=function(){return He(this,void 0,void 0,(function(){var e,t,r,n;return Be(this,(function(o){switch(o.label){case 0:this.performanceEvent=zn(this.performanceClient,Pn.EmbeddedClientApplicationHandleRedirectRequest),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.preflightBrokerRequest()];case 2:return o.sent(),e=new Cn(this.clientId,this.version),[4,this.messageBroker(e,{type:Yn.Message,error:Wn.Message,value:this.brokerOpts.brokerMessageTimeout})];case 3:return t=o.sent(),r=yn.processBrokerResponseMessage(t,this.browserStorage),this.performanceEvent.endMeasurement({success:!0,fromCache:null==r?void 0:r.fromCache,accessTokenSize:null==r?void 0:r.accessToken.length,idTokenSize:null==r?void 0:r.idToken.length,isNativeBroker:null==r?void 0:r.fromNativeBroker}),[2,r];case 4:throw n=o.sent(),this.performanceEvent.endMeasurement({success:!1}),n;case 5:return[2]}}))}))},e.prototype.sendSilentRefreshRequest=function(e){return He(this,void 0,void 0,(function(){var t,r,n;return Be(this,(function(o){switch(o.label){case 0:this.performanceEvent=zn(this.performanceClient,Pn.EmbeddedClientApplicationSendSilentRefreshRequest,e.correlationId),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.preflightBrokerRequest()];case 2:return o.sent(),[4,this.sendRequest(e,J.Silent,{type:Yn.Message,error:Wn.Message,value:this.brokerOpts.brokerMessageTimeout})];case 3:if(t=o.sent(),!(r=yn.processBrokerResponseMessage(t,this.browserStorage)))throw this.logger.errorPii("Broker response is empty in brokered silent refresh request: "+JSON.stringify(r)),fn.createBrokerResponseInvalidError();return this.performanceEvent.endMeasurement({success:!0,fromCache:r.fromCache,accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length,isNativeBroker:r.fromNativeBroker}),[2,r];case 4:throw n=o.sent(),this.performanceEvent.endMeasurement({success:!1}),n;case 5:return[2]}}))}))},e.prototype.sendRequest=function(e,t,r){return He(this,void 0,void 0,(function(){var n;return Be(this,(function(o){return n=new mn(this.clientId,t,e,m.EMPTY_STRING),[2,this.messageBroker(n,r)]}))}))},e.prototype.sendHandshakeRequest=function(e){return He(this,void 0,void 0,(function(){var t=this;return Be(this,(function(r){return[2,new Promise((function(r,n){var o,i=setTimeout((function(){t.logger.warning("Broker handshake timed out"),window.removeEventListener("message",a),Qn(e,{brokerHandshakeTimedOut:!0}),n(fn.createMessageBrokerHandshakeTimeoutError())}),t.brokerOpts.brokerHandshakeTimeout);Qn(e,{brokerHandshakeTimeoutMs:t.brokerOpts.brokerHandshakeTimeout});var a=function(e){try{var o=gn.validate(e,t.brokerOpts.trustedBrokerDomains);o?(clearTimeout(i),t.logger.verbose("Received handshake response: "+JSON.stringify(o)),window.removeEventListener("message",a),r(o)):(t.logger.warning("Message is not handshake response"),t.logger.verbosePii(""+JSON.stringify(e.data)))}catch(e){window.removeEventListener("message",a),n(e)}};window.addEventListener("message",a);var s=new pn(t.clientId,t.version);t.logger.verbose("Sending handshake request: "+s),null===(o=window.top)||void 0===o||o.postMessage(s,"*")}))]}))}))},e.prototype.messageBroker=function(e,t){return void 0===t&&(t={type:Yn.Message,error:Wn.Message,value:this.brokerOpts.brokerMessageTimeout}),He(this,void 0,void 0,(function(){var r=this;return Be(this,(function(n){return[2,new Promise((function(n,o){var i,a=setTimeout((function(){var e={};e[t.error.toString()]=!0,Qn(r.performanceEvent,e),o(fn.createMessageBrokerTimeoutError())}),t.value),s={};s[t.type.toString()]=t.value,Qn(r.performanceEvent,s);var c=r.messageChannel||new MessageChannel;c.port1.onmessage=function(e){r.logger.verbose("in messageBroker<T> w/ origin: "+e),clearTimeout(a),c.port1.close(),n(e)},null===(i=window.top)||void 0===i||i.postMessage(e,r.brokerOrigin,[c.port2])}))]}))}))},e.prototype.setMessageChannel=function(e){this.messageChannel=e},e}(),$n=function(e){function t(t,r,n,o,i,a,s,c,u,l,d,h){var p=e.call(this,t,r,n,o,i,a,c,u,l)||this;return p.experimentalConfig=s,p.embeddedApp=d,p.broker=h,p}return qe(t,e),t.prototype.acquireToken=function(){throw new Error("Method not implemented.")},t.prototype.acquireTokenPopup=function(e){return He(this,void 0,void 0,(function(){var t;return Be(this,(function(r){switch(r.label){case 0:if(!this.embeddedApp)throw fn.createNoEmbeddedAppError();return[4,this.initializeAuthorizationRequest(e,J.Popup)];case 1:return t=r.sent(),[2,this.embeddedApp.sendPopupRequest(t)]}}))}))},t.prototype.ssoSilent=function(e){return He(this,void 0,void 0,(function(){var t,r;return Be(this,(function(n){switch(n.label){case 0:if(!this.embeddedApp)throw fn.createNoEmbeddedAppError();return[4,this.initializeAuthorizationRequest(Ue(Ue({},e),{prompt:T.NONE}),J.Silent)];case 1:t=n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,this.embeddedApp.sendSsoSilentRequest(t)];case 3:return[2,n.sent()];case 4:throw(r=n.sent())instanceof ie&&r.setCorrelationId(this.correlationId),this.browserStorage.cleanRequestByState(t.state),r;case 5:return[2]}}))}))},t.prototype.acquireTokenByBrokerRefresh=function(e){return He(this,void 0,void 0,(function(){var t;return Be(this,(function(r){switch(r.label){case 0:if(!this.embeddedApp)throw fn.createNoEmbeddedAppError();return e.account?[4,this.validateRequestAuthority(e.authority||this.config.auth.authority,e.account)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,this.embeddedApp.sendSilentRefreshRequest(e)];case 3:return t=r.sent(),this.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_SUCCESS,J.Silent,t),[2,t]}}))}))},t.prototype.logout=t}(n.StandardInteractionClient),eo=function(e){function t(t,r,n){var o=e.call(this,t,n)||this;return o.experimentalConfig=An(r),o}return qe(t,e),t.prototype.initializeBrokering=function(e){return He(this,void 0,void 0,(function(){var t;return Be(this,(function(r){switch(r.label){case 0:return this.isBrowserEnvironment?(t=zn(this.performanceClient,Pn.ExperimentalPublicClientApplicationInitializeBrokering),!this.experimentalConfig.brokerOptions.actAsBroker||vr.isInIframe()?[3,3]:(this.experimentalConfig.brokerOptions.allowBrokering&&this.logger.verbose("Running in top frame and both actAsBroker, allowBrokering flags set to true. actAsBroker takes precedence."),this.broker=new Vn(this.config,this.experimentalConfig),this.logger.verbose("Acting as Broker"),this.logger.verbose("Initialize the extension for the new broker instance"),[4,this.broker.initialize()])):[2];case 1:return r.sent(),[4,this.broker.listenForBrokerMessage(e)];case 2:return r.sent(),t.endMeasurement({success:!0}),[3,5];case 3:return this.experimentalConfig.brokerOptions.allowBrokering?(this.embeddedApp=new Zn(this.config.auth.clientId,this.experimentalConfig.brokerOptions,this.logger,this.browserStorage,this.performanceClient),this.logger.verbose("Acting as child"),[4,this.embeddedApp.initiateHandshake(t)]):[3,5];case 4:r.sent(),t.endMeasurement({success:this.embeddedApp.brokerConnectionEstablished}),r.label=5;case 5:return[2]}}))}))},t.prototype.handleRedirectPromise=function(t){var r;return He(this,void 0,void 0,(function(){var n,o;return Be(this,(function(i){switch(i.label){case 0:return n=null===(r=this.broker)||void 0===r?void 0:r.getRequestContext(),this.embeddedApp&&this.embeddedApp.brokerConnectionEstablished?[4,this.embeddedApp.sendHandleRedirectRequest()]:[3,2];case 1:return o=i.sent(),this.browserStorage.setInteractionInProgress(!1),[2,o];case 2:return this.broker&&n&&n!==this.config.auth.clientId?[2,this.broker.handleRedirectPromise(t)]:[2,e.prototype.handleRedirectPromise.call(this,t)];case 3:return[2]}}))}))},t.prototype.acquireTokenRedirect=function(t){var r;return He(this,void 0,void 0,(function(){return Be(this,(function(n){if(null===(r=this.embeddedApp)||void 0===r?void 0:r.brokerConnectionEstablished)throw bt.createRedirectInIframeError(vr.isInIframe());return[2,e.prototype.acquireTokenRedirect.call(this,t)]}))}))},t.prototype.acquireTokenPopup=function(e){var t,r=this,o=zn(this.performanceClient,Ct.AcquireTokenPopup,e.correlationId);try{var i=!!(null===(t=this.embeddedApp)||void 0===t?void 0:t.brokerConnectionEstablished);if(this.preflightBrowserEnvironmentCheck(J.Popup,!i),this.logger.verbose("experimental acquireTokenPopup called",e.correlationId),i)return new $n(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.experimentalConfig,this.performanceClient,this.nativeExtensionProvider,e.correlationId,this.embeddedApp,this.broker).acquireTokenPopup(e).then((function(e){return Qn(o,{accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),o.endMeasurement({success:!0,requestId:e.requestId}),e})).catch((function(e){return o.endMeasurement({success:!1,errorCode:e.errorCode,subErrorCode:e.subError}),Promise.reject(e)}));var a=this.getAllAccounts();this.eventHandler.emitEvent(a.length>0?sr.ACQUIRE_TOKEN_START:sr.LOGIN_START,J.Popup,e);var s=void 0;return this.canUseNative(e)?(this.logger.verbose("Native popup flow activated"),s=this.acquireTokenNative(e,V.acquireTokenPopup).then((function(e){return r.browserStorage.setInteractionInProgress(!1),o.endMeasurement({success:!0,isNativeBroker:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,requestId:e.requestId}),e})).catch((function(t){if(t instanceof n.NativeAuthError&&t.isFatal())return r.logger.verbose("Native Auth Error"),r.nativeExtensionProvider=void 0,r.createPopupClient(e.correlationId).acquireToken(e);if(t instanceof ue)return r.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),r.createPopupClient(e.correlationId).acquireToken(e);throw r.browserStorage.setInteractionInProgress(!1),t}))):s=new n.PopupClient(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e.correlationId).acquireToken(e),s.then((function(e){var t=a.length<r.getAllAccounts().length;return r.eventHandler.emitEvent(t?sr.LOGIN_SUCCESS:sr.ACQUIRE_TOKEN_SUCCESS,J.Popup,e),Qn(o,{accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),o.endMeasurement({success:!0,requestId:e.requestId}),e})).catch((function(e){return r.eventHandler.emitEvent(a.length>0?sr.ACQUIRE_TOKEN_FAILURE:sr.LOGIN_FAILURE,J.Popup,null,e),o.endMeasurement({success:!1}),Promise.reject(e)}))}catch(e){return o.endMeasurement({success:!1}),Promise.reject(e)}},t.prototype.ssoSilent=function(e){return He(this,void 0,void 0,(function(){var t,r,o,i=this;return Be(this,(function(a){this.preflightBrowserEnvironmentCheck(J.Silent),t=zn(this.performanceClient,Ct.SsoSilent,e.correlationId),this.logger.verbose("ssoSilent called",e.correlationId),this.eventHandler.emitEvent(sr.SSO_SILENT_START,J.Silent,e);try{return this.embeddedApp&&this.embeddedApp.brokerConnectionEstablished?[2,new $n(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.experimentalConfig,this.performanceClient,this.nativeExtensionProvider,e.correlationId,this.embeddedApp,this.broker).ssoSilent(e).then(().catch((function(e){throw t.endMeasurement({success:!1,errorCode:e.errorCode,subErrorCode:e.subError}),e}))]:(r=void 0,this.canUseNative(e)?(this.logger.verbose("Native sso silent flow activated"),r=this.acquireTokenNative(e,V.ssoSilent).catch((function(t){if(t instanceof n.NativeAuthError&&t.isFatal())return i.logger.verbose("Native Auth Error"),i.nativeExtensionProvider=void 0,i.createSilentIframeClient(e.correlationId).acquireToken(e);throw t}))):(o=new n.SilentIframeClient(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,V.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e.correlationId),r=o.acquireToken(e)),[2,r.then((function(e){return i.eventHandler.emitEvent(sr.SSO_SILENT_SUCCESS,J.Silent,e),t.addStaticFields({accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),t.endMeasurement({success:!0,fromCache:e.fromCache,requestId:e.requestId}),e})).catch(()])}catch(e){throw this.eventHandler.emitEvent(sr.SSO_SILENT_FAILURE,J.Silent,null,e),t.endMeasurement({success:!1,errorCode:e.errorCode,subErrorCode:e.subError}),e}return[2]}))}))},t.prototype.acquireTokenSilentAsync=function(e,t){return He(this,void 0,void 0,(function(){var r,o,i,a,s,c=this;return Be(this,(function(u){switch(u.label){case 0:return this.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_START,J.Silent,e),r=zn(this.performanceClient,Ct.AcquireTokenSilentAsync,e.correlationId),this.canUseNative(e)?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),i=Ue(Ue({},e),{account:t}),o=this.acquireTokenNative(i,V.acquireTokenSilent_silentFlow).catch((function(t){return He(c,void 0,void 0,(function(){return Be(this,(function(r){if(t instanceof n.NativeAuthError&&t.isFatal())return this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,[2,this.createSilentIframeClient(e.correlationId).acquireToken(e)];throw t}))}))})),[3,3]):[3,1];case 1:return this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),[4,(a=new n.SilentCacheClient(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient)).initializeSilentRequest(e,t)];case 2:s=u.sent(),o=a.acquireToken(s).catch((function(){return He(c,void 0,void 0,(function(){return Be(this,(function(t){return this.embeddedApp&&this.embeddedApp.brokerConnectionEstablished?[2,new $n(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.experimentalConfig,this.performanceClient,this.nativeExtensionProvider,e.correlationId,this.embeddedApp,this.broker).acquireTokenByBrokerRefresh(s)]:[2,this.acquireTokenByRefreshToken(s,e)]}))}))})),u.label=3;case 3:return[2,o.then((function(e){return c.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_SUCCESS,J.Silent,e),r.endMeasurement({success:!0,fromCache:e.fromCache,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e})).catch((function(e){throw c.eventHandler.emitEvent(sr.ACQUIRE_TOKEN_FAILURE,J.Silent,null,e),r.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e}))]}}))}))},t.prototype.setActiveAccount=t}(Rn),to=r("mJgL"),ro=r("W7wX"),no=r("CMIS");function oo(e){window.location.assign("/login?login_hint=".concat(e,"&ru=").concat(encodeURIComponent(window.location.pathname+window.location.search)))}function io(e){if(e){var t=e.identityIssuedTimeUnixMs||Date.now(),r=864e5-(Date.now()-t)-3e5;window.setTimeout((,r)}}var ao,so,co=new Map;function uo(e){!function(){var e=this;window.setInterval((function(){return Object(o.__awaiter)(e,void 0,void 0,(function(){var e,t,r;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return[4,ho({tokenConsumer:"OfficeHome",forceFetch:!0})];case 1:return(e=n.sent()).success?[2]:e.error instanceof ie&&e.error.errorCode?[4,Object(ro.a)()]:[3,3];case 2:t=n.sent(),oo(null!==(r=t.userPrincipalName)&&void 0!==r?r:""),n.label=3;case 3:return[2]}}))}))}),33e5)}(),io(e)}function lo(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return ao?[2,ao]:[2,ao=Object(Ae.a)().then((function(e){var t;return(null===(t=e.result.dimeBrokerGates)||void 0===t?void 0:t.dimeBrokerEnabled)?Object(to.a)().then((function(e){return Object(ro.a)().then((function(t){var r,n=e.result.authOptions;return(so=new eo({auth:{clientId:null!==(r=null==n?void 0:n.aadAppId)&&void 0!==r?r:"",redirectUri:"https://".concat(window.location.host).concat(null==n?void 0:n.spaRedirectUrlPath),authority:(null==n?void 0:n.aadAuthorityUrlRoot)+"/".concat(t.tenantId)},cache:{cacheLocation:"localStorage"}},{brokerOptions:{actAsBroker:!0,preferredInteractionType:J.Popup}})).initializeBrokering().then((function(){return so}))}))})):Promise.resolve(null)}))]}))}))}function ho(e){var t,r;return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,i,a,s,c,u,l,d;return Object(o.__generator)(this,(function(h){switch(h.label){case 0:return[4,Object(Se.a)()];case 1:return[4,(n=h.sent()).getIdentity()];case 2:return i=h.sent(),[4,Object(Ae.a)()];case 3:if(a=h.sent(),s=e.tokenConsumer,c=e.resourceId,u=e.scope,l=e.forceFetch,d=e.silent,i.authType!==ke.a.MSA||(null===(r=null===(t=a.result)||void 0===t?void 0:t.hybridAuthV2Gates)||void 0===r?void 0:r.hybridAuthV2Enabled))return[3,8];h.label=4;case 4:return h.trys.push([4,7,,8]),[4,lo()];case 5:return h.sent(),[4,be(s,n.officeHomeApiRoot,n.correlationId,n.getIdentity,n.inMockMode,l,c)];case 6:return[2,h.sent()];case 7:return[2,fo(h.sent())];case 8:return[2,new Promise((function(t,r){n.inMockMode?t({success:!0,format:"JWT",source:"OfficeHome",token:"mocktoken"}):function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return Jn?[2,Jn]:[2,Jn=Object(to.a)().then((function(e){return Object(ro.a)().then((function(t){return Object(Se.a)().then((function(r){var n,i,a;!function(e,t){var r=e.resources||{};co.set("OfficeHome",{id:(e.authOptions||{}).officeHomeTokenScope,includesScope:!0}),co.set("Portal",{id:r.adminPortal}),co.set("BingAnswers",{id:r.bingAnswers}),co.set("ConsumerShellService",{id:r.consumerShellServiceV2}),co.set("FluidPushChannel",{id:r.pushChannel}),co.set("Forms",{id:r.forms}),co.set("Graph",{id:r.graph}),co.set("Loki",{id:r.loki}),co.set("MfsService",{id:r.mfs}),co.set("MruPlusPlus",t.isMsa?{id:r.mruMsaV2,includesScope:!0}:{id:r.mru}),co.set("MyApps",{id:r.myApps}),co.set("Notify",{id:r.notify}),co.set("Ods",{id:r.ods}),co.set("OneNote",{id:r.oneNote}),co.set("Portal",{id:r.adminPortal}),co.set("QueryFormulation",{id:r.autosuggest}),co.set("Substrate",{id:r.substrate}),co.set("Sway",{id:r.sway}),co.set("TenantFeedback",{id:r.tenantFeedback}),co.set("Thor",{id:r.thor}),co.set("Yammer",{id:r.yammer}),co.set("AugLoop",{id:r.augLoop}),co.set("VisioService",{id:r.visio}),co.set("CaptureService",{id:r.capture}),co.set("WCSS",{id:r.shellWeb})}(e.result||{},t);var s=e.result.authOptions;if(Xn=new eo({auth:{clientId:null!==(n=null==s?void 0:s.aadAppId)&&void 0!==n?n:"",redirectUri:"https://".concat(window.location.host).concat(null==s?void 0:s.spaRedirectUrlPath),authority:(null==s?void 0:s.aadAuthorityUrlRoot)+"/".concat(t.tenantId)},cache:{cacheLocation:"localStorage"}},{brokerOptions:{actAsBroker:t.isMsa,preferredInteractionType:J.Popup}}),r.inMockMode)return Xn;var c=document.getElementById("spa-auth-code");if(c&&c.textContent)return function(e,t,r){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,i,a,s,c,u;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:n="Msal_AuthCodeExchange",i=Object(Pe.a)(),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,Xn.acquireTokenByCode({code:e,scopes:[t]})];case 2:return a=o.sent(),u=Object(Pe.a)(),Object(Ne.a)({eventName:n,httpCode:200,latency:u-i}),Xn.setActiveAccount(a.account),uo(r),r.isMsa?[4,Xn.initializeBrokering()]:[3,4];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:return s=o.sent(),c=s,u=Object(Pe.a)(),Object(Ne.a)({eventName:n,httpCode:500,latency:u-i,error:Oe(c)}),window.setTimeout((function(){var e;oo(null!==(e=r.userPrincipalName)&&void 0!==e?e:"")}),6e4),[3,6];case 6:return[2,Xn]}}))}))}(c.textContent,null!==(i=null==s?void 0:s.officeHomeTokenScope)&&void 0!==i?i:"",t);var u=Xn.getAllAccounts().find((function(e){var r;return(null===(r=e.idTokenClaims)||void 0===r?void 0:r.oid)===t.objectId&&e.tenantId==t.tenantId}));return u?(Xn.setActiveAccount(u),uo(t),t.isMsa?Xn.initializeBrokering().then((function(){return Xn})):Xn):(Object(no.a)({eventName:"Msal_AccountNotFound",errorType:"Authentication_Failed",debugInfo:"spauthcode present: ".concat(!!c)}),oo(null!==(a=t.userPrincipalName)&&void 0!==a?a:""),Xn)}))}))}))]}))}))}().then((function(r){var n=function(e,t,r){if("MetaOS"===e&&t&&"/"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t)return r?t+"/"+r:t+"/.default";var n=co.get(e);return n&&n.id?n.includesScope?n.id:r?n.id+"/"+r:n.id+"/.default":""}(s,c,u);if(!n){var o="No token resourceID provided";return po({params:e,latency:-1,success:!1,fromCache:!1,error:o}),void t(fo(o))}var h=Object(Pe.a)();r.acquireTokenSilent({scopes:[n],forceRefresh:l,cacheLookupPolicy:ne.Default}).then((function(r){var n,o=Object(Pe.a)();po({params:e,latency:o-h,success:!0,fromCache:r.fromCache}),t({success:!0,token:r.accessToken,format:"JWT",source:"OfficeHome",expiryMs:null===(n=r.expiresOn)||void 0===n?void 0:n.getTime()})})).catch((function(o){var c,u,l=o,p=Object(Pe.a)();po({params:e,latency:p-h,success:!1,fromCache:!1,error:l}),(null===(u=null===(c=a.result)||void 0===c?void 0:c.authGates)||void 0===u?void 0:u.authSubstrateTokenCheck)&&l instanceof ue&&!1!==d&&("OfficeHome"===s||"Substrate"===s)?oo(i.userPrincipalName||""):l instanceof ue&&!1===d&&e.capDialogData?Object(Re.c)({category:e.capDialogData.category,error:go(l.subError),fileType:e.capDialogData.fileType,onActionClicked:function(){r.acquireTokenPopup({scopes:[n]}).then((function(r){var n;po({params:e,latency:-1,success:!0,fromCache:!1,error:"acquired from popup"}),t({success:!0,token:r.accessToken,format:"JWT",source:"OfficeHome",expiryMs:null===(n=r.expiresOn)||void 0===n?void 0:n.getTime()})})).catch((function(r){po({params:e,latency:-1,success:!1,fromCache:!1,error:r}),t(fo(r))}))},onClose:):t(fo(l))}))})).catch(()}))]}}))}))}function po(e){if(!e.fromCache){var t="Msal_Token_Fetch_"+e.params.tokenConsumer;Object(Ne.a)({eventName:t,httpCode:e.success?200:500,latency:Math.round(e.latency),fromCache:e.fromCache,error:Oe(e.error)})}}function fo(e){return{success:!1,error:e,token:"",format:"JWT",source:"OfficeHome"}}ar mo=r("NrNW"),vo=r("CaQ9"),yo=r("mXGw");function Co(e){window.location.assign("/estslogout?ru=".concat(encodeURIComponent(e)))}function To(){var e=Object(yo.useRef)(!1),t=Object(mo.a)().data,r=Object(vo.a)().data;Object(yo.useEffect)((function(){!e.current&&t&&r&&(function(e,t){Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(r){return function(e,t){document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&function(e,t){Object(o.__awaiter)(this,void 0,void 0,(function(){var r,n,i;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return r={url:e.officeHomeApiRoot+"/api/checklogin/v3",method:"GET",params:t.isMsa?void 0:{hybridauth:"1"}},[4,Object(Ee.a)(r,e.inMockMode,Te.a.OfficeHomeReact,(function(){return Promise.resolve(t)}))];case 1:return o.sent(),[4,Object(_e.a)(Ce.a.CheckLoginRequest,"Check_Login",r,e.officeHomeApiRoot,e.correlationId)];case 2:return!(n=o.sent()).data||"Expired"!==n.data.LoginState&&"SignedOut"!==n.data.LoginState&&"PolicyCheckFailed"!==n.data.LoginState?n.data&&"AccountMismatch"===n.data.LoginState&&window.MastInteraction?(i=n.data,window.MastInteraction.UpdateAccount(i.CurrentAccountPuid||"",{authenticatedState:1,idp:i.CurrentAccountType||"",upn:i.CurrentAccountUpn||""},!0),window.MastInteraction.ShowPrompt("SwitchAccount"),[2]):[2]:(oo(t.userPrincipalName||""),[2])}}))}))}(e,t)}))}(e,t),function(e,t){window.addEventListener("message",(function(r){if(r&&r.data){var n=void 0;try{n=JSON.parse(r.data)}catch(e){return}n&&"abtSignOutEventForHost"===n.eventId&&Co("/abtsignout?rs=".concat(e.preferredCulture,"&build=").concat(e.buildVersion,"&ru=").concat(encodeURIComponent(window.location.pathname+window.location.search),"&upn=").concat(t.userPrincipalName)),n&&"abtSignOutEventForHostUserGenerated"===n.eventId&&Co("/")}}))}(e,t),t.isMsa&&io(t),[2]}))}))}(t,r),e.current=!0)}),[t,r])}},CaQ9:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r("NrNW"),o=r("B5kz");function i(){var e=Object(n.a)().data;return Object(o.c)(["Identity"],(function(){return e.getIdentity()}),{cacheTime:1/0,staleTime:1/0,enabled:!!e})}},GeVZ:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=new RegExp(["^(https?:)//","(([^:/?#]*)(?::([0-9]+))?)","(/{0,1}[^?#]*)","(\\?[^#]*|)","(#.*|)$"].join(""));function o(e){if(e&&e.length){var t=e.match(n);if(t)return{href:e,protocol:t[1],host:t[2],hostname:t[3],port:t[4],path:t[5],search:t[6],hash:t[7]}}}},MJsD:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r("QjXU"),o=r("B5kz"),i=r("zPZ9");function a(){return Object(n.__awaiter)(this,void 0,void 0,(function(){return Object(n.__generator)(this,(function(e){return[2,o.a.fetchQuery(["OfficeComponentContext"],(function(){return i.a}),{cacheTime:1/0,staleTime:1/0})]}))}))}},NrNW:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r("B5kz"),o=r("zPZ9");function i(){return Object(n.c)(["OfficeComponentContext"],(,{cacheTime:1/0,staleTime:1/0})}},RJ4M:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("GeVZ");function o(e){var t=Object(n.a)(e);return t&&t.hostname||""}},RV7E:function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){return a}));var n=new(r("AlWG").a)(null);7wX:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r("QjXU"),o=r("MJsD"),i=r("B5kz");function a(){return Object(n.__awaiter)(this,void 0,void 0,(function(){var e;return Object(n.__generator)(this,(function(t){switch(t.label){case 0:return[4,Object(o.a)()];case 1:return e=t.sent(),[2,i.a.fetchQuery(["Identity"],(,{cacheTime:1/0,staleTime:1/0})]}}))}))}},gCKw:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r("QjXU"),o=r("MJsD"),i=r("B5kz"),a=r("W7wX"),s=r("XcEc");function c(){var e=this;return i.a.fetchQuery(["FeatureGates"],(function(){return Object(n.__awaiter)(e,void 0,void 0,(function(){var e,t,r;return Object(n.__generator)(this,(function(i){switch(i.label){case 0:return[4,Promise.all([Object(o.a)(),Object(a.a)()])];case 1:return e=n.__read.apply(void 0,[i.sent(),2]),t=e[0],r=e[1],[2,Object(s.a)(r,t)]}}))}))}),{staleTime:1/0,cacheTime:1/0})}},mJgL:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r("QjXU"),o=r("MJsD"),i=r("B5kz"),a=r("W7wX"),s=r("yNE0");function c(){var e=this;return i.a.fetchQuery(["FeatureSettings"],(function(){return Object(n.__awaiter)(e,void 0,void 0,(function(){var e,t,r;return Object(n.__generator)(this,(function(i){switch(i.label){case 0:return[4,Promise.all([Object(o.a)(),Object(a.a)()])];case 1:return e=n.__read.apply(void 0,[i.sent(),2]),t=e[0],r=e[1],[2,Object(s.a)(r,t)]}}))}))}),{staleTime:1/0,cacheTime:1/0})}},qAi5:yNE0:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r("QjXU"),o=r("mgFK"),i=r("CRHC"),a=r("m32Q"),s=r("lkvL"),c=r("a3FV"),u=r("0TX8"),l=r("Wa5Y");function d(e,t,r,o,i,a,s){return Object(n.__awaiter)(this,void 0,void 0,(function(){var d,h,p;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:d={},h={method:"GET",responseType:"json",url:"".concat(o,"/api/featureSettings")},n.label=1;case 1:return n.trys.push([1,4,,5]),[4,Object(u.a)(h,r,i,t)];case 2:return n.sent(),[4,Object(l.a)(c.a.FeatureSettingsRequest,"FeatureSettings",h.url,h,s,a,o,e,"OfficeHome",{})];case 3:return(p=n.sent().data)?[2,p]:[3,5];case 4:return n.sent(),[3,5];case 5:return[2,d]}}))}))}var h="featureSettings";function p(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){return Object(n.__generator)(this,(function(t){switch(t.label){case 0:return[4,Object(o.a)(h,e)];case 1:return[2,t.sent()]}}))}))}function f(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){return Object(n.__generator)(this,(function(r){return[2,Object(i.a)((function(){return function(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return[4,p(t)];case 1:return void 0!==(r=n.sent())?[3,3]:[4,d(t.correlationId,(,t.inMockMode,t.officeHomeApiRoot,t.workload,t.getAccessToken,t.jwtAuthEnabled)];case 2:r=n.sent(),n.label=3;case 3:return[2,r]}}))}))}(e,t)}),(function(){return Object(a.a)({userId:e.puid,collectionName:h,collectionVersion:1,key:h})}),(function(t){return Object(s.a)({userId:e.puid,collectionName:h,collectionVersion:1,key:h,data:0===Object.keys(t).length?null:t})}))]}))}))}},ywfh:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("qAi5");function o(e){if(e&&e.length){if(e.match(n.a)||e.match(n.b))return"Documents";if(e.match(n.c))return"Sites"}}}}]);
//# sourceMappingURL=107.cf7d87eba799a309a454.chunk.v7.js.map