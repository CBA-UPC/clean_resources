"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[892],{JUlG:CjDN:function(e,t,n){n.d(t,{Z:function(){return I}});var r=n("11lP"),i=n("QslU"),o=n("Oz0t"),s=n("V67U"),a=n.n(s),u=n("3Fx5"),c=n("bBVy"),d=n("8pxB"),l=n("uvxJ"),f=n("aysb");function p(e){var t=e.onLogin,n=(0,o.useContext)(c.Z),s=n.i18n,a=n.domain,p=(0,u.tv)(),v=a.get("config").get("AUTHENTICATION").LOGIN_ERROR_TYPES,h=(0,o.useState)(!1),g=h[0],_=h[1],m=(0,o.useState)(null),y=m[0],E=m[1];return(0,i.jsxs)(i.Fragment,{children:[!y&&(0,i.jsx)(f.Z,{isSpaced:!0,isFullWidth:!0,children:(0,i.jsx)(d.Z,{tab:d.G.LOGIN,onChange:function(e){e===d.G.REGISTER&&window.open(s.url("/LINK_REGISTER"),"_self")},onForgotPasswordClick:onLogin:t,onLoginError:function(e){var t=e.errorCode,n=e.email;t!==v.BLOCKED&&t!==v.REVIEW&&t!==v.CHALLENGE||E({error:t,email:n})},onResetPasswordError:function(e){var t=(void 0===e?{}:e).email;E({email:t}),_(!0)},children:function(e){var t=e.tab,n=e.formProps;return(0,i.jsx)(i.Fragment,{children:t===d.G.LOGIN&&(0,i.jsx)(l.Z,(0,r.Z)({},n,{openLinksInNewTab:!1,defaultSessionPersist:!0,isSocialEnabled:!0}))})}})}),(0,i.jsxs)("div",{className:"ma-ContentLogin-error",children:[g&&(0,i.jsx)(d.Z.ResetPassword,{email:null==y?void 0:y.email,onSubmitSuccess:),y&&!g&&(0,i.jsx)(d.Z.ErrorState,{error:y,onClose:)]})]})}p.propTypes={onLogin:a().func.isRequired},p.displayName="ContentLogin";var v=p,h=n("Ab2B"),g=n("op6l"),_=n("U21o"),m="loading",y="content",E="fallback",L=function(e){var t=e.children,n=e.fallback,r=void 0===n?v:n,s=(0,u.tv)(),a=(0,_.C6)(),c=(0,o.useRef)(!1),d=(0,o.useState)(!1),l=d[0],f=d[1],p=(0,o.useState)(m),L=p[0],I=p[1],x=a.isReady,O=a.isAuthenticated,b=a.isLoading,S=L===y&&!O,C=function(){};return(0,o.useEffect)((,[]),(0,o.useEffect)((function(){if(x){if(!b)return c.current?void(O?I(y):s.push("/")):(I(O?y:E),void(c.current=!0));I(m)}}),[s,b,x,O]),!l||S?null:(0,i.jsxs)(h.Z,{isLoading:L===m,hideContentWhileLoading:!0,children:[(0,i.jsx)(g.Z,{value:L===y,children:),(0,i.jsx)(g.Z,{value:L===E,children:)]})};function I(e,t){return function(n){return(0,i.jsx)(L,{fallback:t,children:function(t){return(0,i.jsx)(e,(0,r.Z)({},t,n))}})}}L.propTypes={children:a().func,fallback:a().node}},"9Y+p":function(e,t,n){n.d(t,{Z:function(){return s}});var r=n("QslU"),i=(n("Oz0t"),n("V67U")),o=n.n(i);.displayName="LayoutFullHeight",s.propTypes={children:o().node}},aysb:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n("11lP"),i=n("dLhX"),o=n("QslU"),s=(n("Oz0t"),n("7aI0")),a=n.n(s),u=n("V67U"),c=n.n(u),d="ma-SharedBox";function l(e){var t,n=e.isSpaced,s=e.isFullWidth,u=(0,i.Z)(e,["isSpaced","isFullWidth"]),c=a()(d,((t={})[d+"--spaced"]=n,t[d+"--full-width"]=s,t));return(0,o.jsx)("div",(0,r.Z)({className:c},u))}l.displayName="SharedBox",l.propTypes={isSpaced:c().bool,isFullWidth:c().bool}},"5As0":function(e,t,n){n.r(t),n.d(t,{default:);var r=n("Tim7"),i=n("jbFD"),o=n.n(i),s=n("Oz0t"),a=n("beVP"),u=n("11lP"),c=n("dLhX"),d=n("CW94"),l=n("2GZr"),f=n("QslU"),p=n("V67U"),v=n.n(p),h=n("AgMK"),g=n("bBVy"),_=n("3Fx5"),m=n("pCxQ"),y=n("VG2F"),E=n("Ab2B"),L=n("op6l"),I=n("FhAj"),x=n("b6IY"),O=function(e){var t=e.onClickCancel,n=e.isLoadingOnSubmit,r=(0,s.useContext)(g.Z).i18n,i=(0,x.I)(x.I.SIZES.SM);return(0,f.jsxs)("div",{className:Z+"-footer",children:[(0,f.jsx)("div",{children:(0,f.jsx)(I.ZP,{design:"flat",onClick:t,link:!0,fullWidth:!i,children:r.t("CONTENT_AD_EDIT_CANCEL_BUTTON")})}),(0,f.jsx)("div",{children:(0,f.jsx)(I.ZP,{isLoading:n,design:"solid",isSubmit:!0,fullWidth:!i,children:r.t("CONTENT_AD_EDIT_SUBMIT_BUTTON")})})]})};O.propTypes={onClickCancel:v().func.isRequired,isLoadingOnSubmit:v().func.isRequired};var b=O,S="pta-modificar anuncio",C=n("Ymwb"),N=n("JUlG"),A="fulfilled",T=function(e){function t(t){var n,r=t.upload,i=t.adId,o=t.userId;return(n=e.call(this)||this)._upload=r,n._adId=i,n._userId=o,n}(0,C.Z)(t,e);var n=t.prototype;return n.uploadAllAndRetryFailed=function(e){var t=e.media,n=void 0===t?[]:t,r=this;return(0,a.Z)((function(){var e,t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,r.uploadAll({media:n})];case 1:return e=i.sent()||[],t=r.filterUploadableMedia({results:e}),r.emit("finish",{media:t}),[2]}}))}))()},n.uploadAll=function(e){var t=e.media,n=this;return Promise.all(t.map(().map(())},n.uploadSingle=function(e){var t=e.mediaItem;return t.isNew||t.isModified?this._upload.execute({media:t.blob,adId:this._adId,userId:this._userId}):Promise.resolve([null,{id:t.id}])},n.reflect=function(e,t){var n=this;return e.then((function(e){return n.emit("successSingle"),{status:A,response:e[1],index:t}}),(function(e){return{status:"rejected",error:e[0],index:t}}))},n.filterUploadableMedia=function(e){return e.results.filter(().filter((function(e){var t;return!!(null==e||null==(t=e.response)?void 0:t.id)})).map((function(e){var t=e.response,n=void 0===t?{}:t;return{id:n.id,type:n.type}}))},t}(n.n(N)()),j=n("WrYh"),w=n("L4nv"),R=function(e){var t=e.adId,n=e.onError,r=void 0===n?n,i=e.isActiveAdEditV2,o=void 0!==i&&i,u=(0,s.useState)({}),c=u[0],d=u[1],f=(0,s.useState)(""),p=f[0],v=f[1],h=(0,s.useState)({}),_=h[0],m=h[1],y=(0,s.useState)(!1),E=y[0],L=y[1],I=(0,s.useState)(""),x=I[0],O=I[1],b=(0,s.useContext)(g.Z).domain,S=!!Object.keys(c).length&&p&&!!Object.keys(_).length;return(0,j.Z)((0,a.Z)((function(){var e,n,i,s,a,u,c,f,p;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return[4,b.get("get_ad_ad_creation_use_case").execute({adId:t,isVersion2:o})];case 1:return e=l.sent(),n=e[0],i=e[1],n?(L(!0),r(n),console.error(n),[2]):(d(i),[4,b.get("get_form_type_from_category_id_ad_creation_use_case").execute({id:null==i?void 0:i.category})]);case 2:return s=l.sent(),a=s[0],u=s[1].formType,a?(L(!0),r(a),console.error(a),[2]):(v(u+"-v2"),[4,(0,w.o)({categoryId:null==i?void 0:i.category,domain:b})]);case 3:return c=l.sent(),f=c.categoryParents,p=c.parentCategoryId,m(f),O(p),[2]}}))}))),{initialAd:c,formTypeV2:p,categoryParents:_,isFilledInitialData:S,isError:E,parentCategoryId:x}},Z="ma-ContentAdEdit";function P(e){var t=e.adId,n=e.page,r=(0,s.useContext)(g.Z),i=r.domain,o=r.i18n,p=(0,_.tv)(),v=(0,y.e)().add,I=(0,s.useState)(!1),x=I[0],O=I[1],C=(0,s.useState)({}),N=C[0],A=C[1],j=(0,h.SS)("ff_web_ba_create_update_ad_v2").isActive,w=function(){return v({content:o.t("CONTENT_AD_EDIT_ERROR_MESSAGE"),type:"error"})},P=F=R({adId:t,onError:isActiveAdEditV2:j}),k=F.initialAd,D=F.formTypeV2,G=F.categoryParents,M=F.parentCategoryId,U=F.isFilledInitialData;(0,s.useEffect)((function(){window.scrollTo(0,0),function(e){var t=e.domain,n=e.page,r=e.categoryParents;t.get("call_view_tracking_use_case").execute({page:n,data:(0,u.Z)({},r)})}({domain:i,page:n,categoryParents:G})}),[G,i,n]);var $=(0,a.Z)((function(e){var t,r,s,a,c,d,f,h,g,_,y,E;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return t=e.submittedAdFields,r=e.media,s=e.locationParsed,a=r.map((function(e,t){return(0,u.Z)({},e,{sorting:++t})})),c=t[m.t$.GEOLOCATION]&&JSON.parse(t[m.t$.GEOLOCATION]),[4,i.get("edit_ad_ad_creation_use_case").execute({ad:(0,u.Z)({},t,(d={userId:k.userId,id:p.params.adId,categoryId:k.category},d[m.t$.PROVINCE]=s.provinceId,d[m.t$.MUNICIPALITY]=s.localityId,d),c&&(f={},f[m.t$.GEOLOCATION]=c,f),k[m.t$.SELLER_TYPE]&&(h={},h[m.t$.SELLER_TYPE]=t[m.t$.SELLER_TYPE]||k[m.t$.SELLER_TYPE],h),k[m.t$.SUPPLY_OR_DEMAND]&&(g={},g[m.t$.SUPPLY_OR_DEMAND]=k[m.t$.SUPPLY_OR_DEMAND],g),void 0!==k[m.t$.CONSENT_SHARING]&&(_={},_[m.t$.CONSENT_SHARING]=k[m.t$.CONSENT_SHARING].toString(),_),k[m.t$.COLOR]&&{color:Array.isArray(t[m.t$.COLOR])?t[m.t$.COLOR]:[t[m.t$.COLOR]]},{media:a}),isVersion2:j})];case 1:return y=l.sent(),(E=y[0])?(console.error({id:"edit_ad_ad_creation_use_case_error",message:E.message,stack:E.stack}),w(),function(e){var t=e.domain,n=e.categoryParents,r=e.page,i=t.get("config").get("TRACKING_EVENTS_NAMES").FORM_ERROR;t.get("call_link_tracking_use_case").execute({page:r,event:i,data:(0,u.Z)({form_name:S,form_error:"error de servidor"},n)})}({domain:i,categoryParents:G,page:n})):(v({content:o.t("CONTENT_AD_EDIT_SUCCESS_MESSAGE"),type:"success"}),function(e){var t,n=e.domain,r=e.modifiedFields,i=e.page,o=e.categoryParents,s=n.get("config").get("TRACKING_EVENTS_NAMES").AD_EDIT_MODIFIED;n.get("call_link_tracking_use_case").execute({page:i,event:s,data:(0,u.Z)({hit_information:(t=r,Object.keys(t).join("_"))},r.packageWeight&&{package_weight:r.packageWeight},{categoryParents:o})})}({domain:i,modifiedFields:N,page:n,categoryParents:G})),[2]}}))})),V=(0,a.Z)((function(e){var t,n,r;return(0,l.__generator)(this,(function(o){return t=e.adFields,O(!0),n=t.location?JSON.parse(t.location):{},(r=new T({upload:i.get("save_ad_media_draft_ad_creation_use_case"),adId:k.id,userId:k.userId})).on("finish",(0,a.Z)((function(e){var r;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return r=e.media,[4,$({submittedAdFields:t,media:r,locationParsed:n})];case 1:return i.sent(),O(!1),P(),[2]}}))}))),r.uploadAllAndRetryFailed({media:t.media||[]}),[2]}))})),Y=function(e){var t=e.field,n=e.value;n!==k[t]?A((function(e){var r;return(0,u.Z)({},e,((r={})[t]=n,r))})):A((function(e){e[t];return(0,c.Z)(e,[t].map(d.Z))}))};return(0,f.jsx)("div",{className:Z,children:(0,f.jsx)(E.Z,{isLoading:!U,children:(0,f.jsx)(L.Z,{value:U,children:function(){var e,t;return(0,f.jsx)(m.ZP,{isEdit:!0,parentCategoryId:M,initialFields:(0,u.Z)({},k,(e={},e[m.t$.GEOLOCATION]=(null==k?void 0:k.geolocation)?JSON.stringify(k.geolocation):null,e),(t={},t[m.t$.IS_EDIT]="true",t)),handleOnSubmit:V,formType:D,categoryParents:G,trackingFormName:S,onModifyField:Y,children:(0,f.jsx)(b,{onClickCancel:P,isLoadingOnSubmit:x})})}})})})}P.displayName="ContentAdEdit",P.propTypes={adId:v().string,page:v().string};var F=n("CjDN"),k=n("Bd1x"),D=n("9Y+p"),G=n("IBpw"),M=n("h8GR"),U=(0,F.Z)(P),$=function(e){var t=e.adId,n=e.page,r=e.seoDefinition;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(k.Z,{children:(0,f.jsxs)(D.Z,{children:[(0,f.jsx)(G.Z,{seoDefinition:r}),(0,f.jsx)(M.Z,{page:n,disableInitialCall:!0}),(0,f.jsx)(k.Z.Header,{page:n}),(0,f.jsx)(k.Z.Body,{children:(0,f.jsx)(k.Z.MainContent,{children:(0,f.jsx)(U,{adId:t,page:n})})})]})}),(0,f.jsx)(k.Z.FooterLite,{})]})};$.displayName="ClassifiedEdit",$.getInitialProps=function(){var e=(0,r.Z)(o().mark((function e(t){var n,r,i,s,a,u,c,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.context.domain,r=t.routeInfo,i=r.params.adId,s=n.get("config").get("PAGES"),a=s.AD_EDIT,e.next=5,n.get("get_definition_by_page_seo_use_case").execute({page:a});case 5:return u=e.sent,c=u[0],d=u[1],c&&console.error({message:"AdEdit seo error",error:c}),e.abrupt("return",{adId:i,page:a,seoDefinition:d});case 10:case"end":return e.stop()}}),e)})));return ();var V=$},bxRl:]);