require=(()({1:[function(require,module,exports){"use strict";var __createBinding=(this&&this.__createBinding)||(Object.create?(function(o,m,k,k2){if(k2===undefined)k2=k;Object.defineProperty(o,k2,{enumerable:true,get:function(){return m[k];}});}):(function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];}));var __setModuleDefault=(this&&this.__setModuleDefault)||(Object.create?(:;var __importStar=(this&&this.__importStar)||Object.defineProperty(exports,"__esModule",{value:true});const hlsjs=__importStar(require("./index"));if(!window.p2pml){window.p2pml={};}
window.p2pml.hlsjs=hlsjs;},{"./index":"p2p-media-loader-hlsjs"}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Engine=void 0;const events_1=require("events");const p2p_media_loader_core_1=require("p2p-media-loader-core");const segment_manager_1=require("./segment-manager");const hlsjs_loader_1=require("./hlsjs-loader");class Engine extends events_1.EventEmitter{constructor(settings={}){super();this.loader=new p2p_media_loader_core_1.HybridLoader(settings.loader);this.segmentManager=new segment_manager_1.SegmentManager(this.loader,settings.segments);Object.keys(p2p_media_loader_core_1.Events).map(.forEach(;}
createLoaderClass(){var _a;const engine=this;return _a=class{constructor(){this.load=async(context,config,callbacks)=>{this.context=context;await this.impl.load(context,config,callbacks);};this.abort=()=>{if(this.context){this.impl.abort(this.context);}};this.destroy=()=>{if(this.context){this.impl.abort(this.context);}};this.getResponseHeader=this.impl=new hlsjs_loader_1.HlsJsLoader(engine.segmentManager);this.stats=this.impl.stats;}},_a.getEngine=_a;}

exports.Engine=Engine;},{"./hlsjs-loader":3,"./segment-manager":4,"events":"events","p2p-media-loader-core":"p2p-media-loader-core"}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.HlsJsLoader=void 0;const DEFAULT_DOWNLOAD_LATENCY=1;const DEFAULT_DOWNLOAD_BANDWIDTH=12500;class HlsJsLoader{constructor(segmentManager){this.stats={trequest:0,tfirst:0,tload:0,tparsed:0,loaded:0,total:0,aborted:false,retry:0,chunkCount:1,bwEstimate:0,loading:{start:0,end:0,first:0,},parsing:{start:0,end:0,},buffering:{start:0,end:0,first:0,},};this.segmentManager=segmentManager;}
async load(context,_config,callbacks){if(context.type){try{const result=await this.segmentManager.loadPlaylist(context.url);this.successPlaylist(result,context,callbacks);}
catch(e){this.error(e,context,callbacks);}}
else if(context.frag){try{const result=await this.segmentManager.loadSegment(context.url,getByteRange(context));const{content}=result;if(content!==undefined){setTimeout(()=>this.successSegment(content,result.downloadBandwidth,context,callbacks),0);}}
catch(e){setTimeout(0);}}
else{console.warn("Unknown load request",context);}}
abortsuccessPlaylist(xhr,context,callbacks){const now=performance.now();this.stats.trequest=now-300;this.stats.tfirst=now-200;this.stats.tload=now-1;this.stats.tparsed=now;this.stats.loaded=xhr.response.length;this.stats.total=xhr.response.length;createUniversalStats(this.stats);callbacks.onSuccess({url:xhr.responseURL,data:xhr.response,},this.stats,context,undefined);}
successSegment(content,downloadBandwidth,context,callbacks){const now=performance.now();const downloadTime=content.byteLength/(downloadBandwidth===undefined||downloadBandwidth<=0?DEFAULT_DOWNLOAD_BANDWIDTH:downloadBandwidth);this.stats.trequest=now-DEFAULT_DOWNLOAD_LATENCY-downloadTime;this.stats.tfirst=now-downloadTime;this.stats.tload=now-1;this.stats.tparsed=now;this.stats.loaded=content.byteLength;this.stats.total=content.byteLength;createUniversalStats(this.stats);if(callbacks.onProgress){callbacks.onProgress(this.stats,context,content,undefined);}
callbacks.onSuccess({url:context.url,data:content,},this.stats,context,undefined);}

exports.HlsJsLoader=HlsJsLoader;function createUniversalStats(stats){stats.aborted=false;stats.retry=0;stats.chunkCount=1;stats.bwEstimate=0;stats.loading={start:stats.trequest,end:stats.tload,first:stats.tfirst,};stats.parsing={start:stats.tload,end:stats.tparsed,};stats.buffering={start:stats.tload,end:stats.tparsed,first:stats.tload,};}
function getByteRange(context){return context.rangeStart===undefined||context.rangeEnd===undefined||(context.rangeStart===0&&context.rangeEnd===0)?undefined:{offset:context.rangeStart,length:context.rangeEnd-context.rangeStart};}},{}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SegmentManager=void 0;const p2p_media_loader_core_1=require("p2p-media-loader-core");const m3u8_parser_1=require("m3u8-parser");const defaultSettings={forwardSegmentCount:20,swarmId:undefined,assetsStorage:undefined,};class SegmentManager{constructor(loader,settings={}){this.masterPlaylist=null;this.variantPlaylists=new Map();this.segmentRequest=null;this.playQueue=[];this.onSegmentLoaded=(segment)=>{if(this.segmentRequest&&this.segmentRequest.segmentUrl===segment.url&&byteRangeToString(this.segmentRequest.segmentByteRange)===segment.range){this.segmentRequest.onSuccess(segment.data.slice(0),segment.downloadBandwidth);this.segmentRequest=null;}};this.onSegmentError=(segment,error)=>{if(this.segmentRequest&&this.segmentRequest.segmentUrl===segment.url&&byteRangeToString(this.segmentRequest.segmentByteRange)===segment.range){this.segmentRequest.onError(error);this.segmentRequest=null;}};this.onSegmentAbort=(segment)=>{if(this.segmentRequest&&this.segmentRequest.segmentUrl===segment.url&&byteRangeToString(this.segmentRequest.segmentByteRange)===segment.range){this.segmentRequest.onError("Loading aborted: internal abort");this.segmentRequest=null;}};this.settings=Object.assign(Object.assign({},defaultSettings),settings);this.loader=loader;this.loader.on(p2p_media_loader_core_1.Events.SegmentLoaded,this.onSegmentLoaded);this.loader.on(p2p_media_loader_core_1.Events.SegmentError,this.onSegmentError);this.loader.on(p2p_media_loader_core_1.Events.SegmentAbort,this.onSegmentAbort);}
processPlaylist(requestUrl,content,responseUrl){const parser=new m3u8_parser_1.Parser();parser.push(content);parser.end();const playlist=new Playlist(requestUrl,responseUrl,parser.manifest);if(playlist.manifest.playlists){this.masterPlaylist=playlist;for(const[key,variantPlaylist]of this.variantPlaylists){const{streamSwarmId,found,index}=this.getStreamSwarmId(variantPlaylist.requestUrl);if(!found){this.variantPlaylists.delete(key);}
else{variantPlaylist.streamSwarmId=streamSwarmId;variantPlaylist.streamId="V"+index.toString();}}}
else{const{streamSwarmId,found,index}=this.getStreamSwarmId(requestUrl);if(found||this.masterPlaylist===null){playlist.streamSwarmId=streamSwarmId;playlist.streamId=this.masterPlaylist===null?undefined:"V"+index.toString();this.variantPlaylists.set(requestUrl,playlist);this.updateSegments();}}}
async loadPlaylist(url){const assetsStorage=this.settings.assetsStorage;let xhr;if(assetsStorage!==undefined){let masterSwarmId;masterSwarmId=this.getMasterSwarmId();if(masterSwarmId===undefined){masterSwarmId=url.split("?")[0];}
const asset=await assetsStorage.getAsset(url,undefined,masterSwarmId);if(asset!==undefined){xhr={responseURL:asset.responseUri,response:asset.data,};}
else{xhr=await this.loadContent(url,"text");void assetsStorage.storeAsset({masterManifestUri:this.masterPlaylist!==null?this.masterPlaylist.requestUrl:url,masterSwarmId:masterSwarmId,requestUri:url,responseUri:xhr.responseURL,data:xhr.response,});}}
else{xhr=await this.loadContent(url,"text");}
this.processPlaylist(url,xhr.response,xhr.responseURL);return xhr;}
async loadSegment(url,byteRange){var _a;const segmentLocation=this.getSegmentLocation(url,byteRange);const byteRangeString=byteRangeToString(byteRange);if(!segmentLocation){let content;const assetsStorage=this.settings.assetsStorage;if(assetsStorage!==undefined){let masterManifestUri=(_a=this.masterPlaylist)===null||_a===void 0?void 0:_a.requestUrl;let masterSwarmId;masterSwarmId=this.getMasterSwarmId();if(masterSwarmId===undefined&&this.variantPlaylists.size===1){const result=this.variantPlaylists.values().next();if(!result.done){masterSwarmId=result.value.requestUrl.split("?")[0];}}
if(masterManifestUri===undefined&&this.variantPlaylists.size===1){const result=this.variantPlaylists.values().next();if(!result.done){masterManifestUri=result.value.requestUrl;}}
if(masterSwarmId!==undefined&&masterManifestUri!==undefined){const asset=await assetsStorage.getAsset(url,byteRangeString,masterSwarmId);if(asset!==undefined){content=asset.data;}
else{const xhr=await this.loadContent(url,"arraybuffer",byteRangeString);content=xhr.response;void assetsStorage.storeAsset({masterManifestUri:masterManifestUri,masterSwarmId:masterSwarmId,requestUri:url,requestRange:byteRangeString,responseUri:xhr.responseURL,data:content,});}}}
if(content===undefined){const xhr=await this.loadContent(url,"arraybuffer",byteRangeString);content=xhr.response;}
return{content,downloadBandwidth:0};}
const segmentSequence=(segmentLocation.playlist.manifest.mediaSequence?segmentLocation.playlist.manifest.mediaSequence:0)+
segmentLocation.segmentIndex;if(this.playQueue.length>0){const previousSegment=this.playQueue[this.playQueue.length-1];if(previousSegment.segmentSequence!==segmentSequence-1){this.playQueue=[];}}
if(this.segmentRequest){this.segmentRequest.onError("Cancel segment request: simultaneous segment requests are not supported");}
const promise=new Promise(;this.playQueue.push({segmentUrl:url,segmentByteRange:byteRange,segmentSequence:segmentSequence});void this.loadSegments(segmentLocation.playlist,segmentLocation.segmentIndex,true);return promise;}
setPlayingSegment(url,byteRange,start,duration){const urlIndex=this.playQueue.findIndex(;if(urlIndex>=0){this.playQueue=this.playQueue.slice(urlIndex);this.playQueue[0].playPosition={start,duration};this.updateSegments();}}
setPlayingSegmentByCurrentTime(playheadPosition){if(this.playQueue.length===0||!this.playQueue[0].playPosition){return;}
const currentSegmentPosition=this.playQueue[0].playPosition;const segmentEndTime=currentSegmentPosition.start+currentSegmentPosition.duration;if(segmentEndTime-playheadPosition<0.2){this.playQueue=this.playQueue.slice(1);this.updateSegments();}}
abortSegment(url,byteRange){if(this.segmentRequest&&this.segmentRequest.segmentUrl===url&&compareByteRanges(this.segmentRequest.segmentByteRange,byteRange)){this.segmentRequest.onSuccess(undefined,0);this.segmentRequest=null;}}
async destroy(){if(this.segmentRequest){this.segmentRequest.onError("Loading aborted: object destroyed");this.segmentRequest=null;}
this.masterPlaylist=null;this.variantPlaylists.clear();this.playQueue=[];if(this.settings.assetsStorage!==undefined){await this.settings.assetsStorage.destroy();}
await this.loader.destroy();}
updateSegments(){if(!this.segmentRequest){return;}
const segmentLocation=this.getSegmentLocation(this.segmentRequest.segmentUrl,this.segmentRequest.segmentByteRange);if(segmentLocation){void this.loadSegments(segmentLocation.playlist,segmentLocation.segmentIndex,false);}}
getSegmentLocation(url,byteRange){for(const playlist of this.variantPlaylists.values()){const segmentIndex=playlist.getSegmentIndex(url,byteRange);if(segmentIndex>=0){return{playlist:playlist,segmentIndex:segmentIndex};}}
return undefined;}
async loadSegments(playlist,segmentIndex,requestFirstSegment){var _a;const segments=[];const playlistSegments=playlist.manifest.segments;const initialSequence=(_a=playlist.manifest.mediaSequence)!==null&&_a!==void 0?_a:0;let loadSegmentId=null;let priority=Math.max(0,this.playQueue.length-1);const masterSwarmId=this.getMasterSwarmId();for(let i=segmentIndex;i<playlistSegments.length&&segments.length<this.settings.forwardSegmentCount;++i){const segment=playlist.manifest.segments[i];const url=playlist.getSegmentAbsoluteUrl(segment.uri);const byteRange=segment.byteRange;const id=this.getSegmentId(playlist,initialSequence+i);segments.push({id:id,url:url,masterSwarmId:masterSwarmId!==undefined?masterSwarmId:playlist.streamSwarmId,masterManifestUri:this.masterPlaylist!==null?this.masterPlaylist.requestUrl:playlist.requestUrl,streamId:playlist.streamId,sequence:(initialSequence+i).toString(),range:byteRangeToString(byteRange),priority:priority++,});if(requestFirstSegment&&!loadSegmentId){loadSegmentId=id;}}
this.loader.load(segments,playlist.streamSwarmId);if(loadSegmentId){const segment=await this.loader.getSegment(loadSegmentId);if(segment){this.onSegmentLoaded(segment);}}}
getMasterSwarmId(){const settingsSwarmId=this.settings.swarmId&&this.settings.swarmId.length!==0?this.settings.swarmId:undefined;if(settingsSwarmId!==undefined){return settingsSwarmId;}
return this.masterPlaylist!==null?this.masterPlaylist.requestUrl.split("?")[0]:undefined;}
getStreamSwarmId(playlistUrl){const masterSwarmId=this.getMasterSwarmId();if(this.masterPlaylist&&this.masterPlaylist.manifest.playlists&&masterSwarmId){for(let i=0;i<this.masterPlaylist.manifest.playlists.length;++i){const url=new URL(this.masterPlaylist.manifest.playlists[i].uri,this.masterPlaylist.responseUrl).toString();if(url===playlistUrl){return{streamSwarmId:`${masterSwarmId}+V${i}`,found:true,index:i};}}}
return{streamSwarmId:masterSwarmId!==null&&masterSwarmId!==void 0?masterSwarmId:playlistUrl.split("?")[0],found:false,index:-1,};}
async loadContent(url,responseType,range){return new Promise((resolve,reject)=>{const xhr=new XMLHttpRequest();xhr.open("GET",url,true);xhr.responseType=responseType;if(range){xhr.setRequestHeader("Range",range);}
xhr.addEventListener("readystatechange",()=>{if(xhr.readyState!==4)
return;if(xhr.status>=200&&xhr.status<300){resolve(xhr);}
else{reject(xhr.statusText);}});const xhrSetup=this.loader.getSettings().xhrSetup;if(xhrSetup){xhrSetup(xhr,url);}
xhr.send();});}}
exports.SegmentManager=SegmentManager;class Playlist{getSegmentIndex(url,byteRange){for(let i=0;i<this.manifest.segments.length;++i){const segment=this.manifest.segments[i];const segmentUrl=this.getSegmentAbsoluteUrl(segment.uri);if(url===segmentUrl&&compareByteRanges(segment.byteRange,byteRange)){return i;}}
return-1;}

class SegmentRequest{
function compareByteRanges(b1,b2){return b1===undefined?b2===undefined:b2!==undefined&&b1.length===b2.length&&b1.offset===b2.offset;}
function byteRangeToString(byteRange){if(byteRange===undefined){return undefined;}
const end=byteRange.offset+byteRange.length-1;return `bytes=${byteRange.offset}-${end}`;}},{"m3u8-parser":13,"p2p-media-loader-core":"p2p-media-loader-core"}],5:[function(require,module,exports){module.exports=_assertThisInitialized;module.exports["default"]=module.exports,module.exports.__esModule=true;},{}],6:[function(require,module,exports){module.exports=_extends;module.exports["default"]=module.exports,module.exports.__esModule=true;},{}],7:[{"./setPrototypeOf.js":9}],8:[function(require,module,exports){module.exports=_interopRequireDefault;module.exports["default"]=module.exports,module.exports.__esModule=true;},{}],9:[function(require,module,exports){module.exports=_setPrototypeOf;module.exports["default"]=module.exports,module.exports.__esModule=true;},{}],10:[function(require,module,exports){(function(Buffer){(function(){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=decodeB64ToUint8Array;var _window=_interopRequireDefault(require("global/window"));var atob=module.exports=exports.default;}).call(this)}).call(this,require("buffer").Buffer)},{"@babel/runtime/helpers/interopRequireDefault":8,"buffer":"buffer","global/window":12}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var Stream=);exports.default=Stream;module.exports=exports.default;},{}],12:[function(require,module,exports){(function(global){(function(){var win;if(typeof window!=="undefined"){win=window;}else if(typeof global!=="undefined"){win=global;}else if(typeof self!=="undefined"){win=self;}else{win={};}
module.exports=win;}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],13:[function(require,module,exports){/*!@name m3u8-parser @version 4.6.0 @license Apache-2.0*/'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _inheritsLoose=require('@babel/runtime/helpers/inheritsLoose');var Stream=require('@videojs/vhs-utils/cjs/stream.js');var _extends=require('@babel/runtime/helpers/extends');var _assertThisInitialized=require('@babel/runtime/helpers/assertThisInitialized');var decodeB64ToUint8Array=require('@videojs/vhs-utils/cjs/decode-b64-to-uint8-array.js');var _inheritsLoose__default=_interopDefaultLegacy(_inheritsLoose);var Stream__default=_interopDefaultLegacy(Stream);var _extends__default=_interopDefaultLegacy(_extends);var _assertThisInitialized__default=_interopDefaultLegacy(_assertThisInitialized);var decodeB64ToUint8Array__default=_interopDefaultLegacy(decodeB64ToUint8Array);var LineStream=function(_Stream){_inheritsLoose__default['default'](LineStream,_Stream);var _proto=LineStream.prototype;_proto.push=return LineStream;}(Stream__default['default']);var TAB=String.fromCharCode(0x09);var parseByterange=var attributeSeparator=var parseAttributes=var ParseStream=function(_Stream){_inheritsLoose__default['default'](ParseStream,_Stream);var _proto=ParseStream.prototype;_proto.push=function push(line){var _this2=this;var match;var event;line=line.trim();if(line.length===0){return;}
if(line[0]!=='#'){this.trigger('data',{type:'uri',uri:line});return;}
var newLines=this.tagMappers.reduce([line]);newLines.forEach(function(newLine){for(var i=0;i<_this2.customParsers.length;i++){if(_this2.customParsers[i].call(_this2,newLine)){return;}}
if(newLine.indexOf('#EXT')!==0){_this2.trigger('data',{type:'comment',text:newLine.slice(1)});return;}
newLine=newLine.replace('\r','');match=/^#EXTM3U/.exec(newLine);if(match){_this2.trigger('data',{type:'tag',tagType:'m3u'});return;}
match=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(newLine);if(match){event={type:'tag',tagType:'inf'};if(match[1]){event.duration=parseFloat(match[1]);}
if(match[2]){event.title=match[2];}
_this2.trigger('data',event);return;}
match=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(newLine);if(match){event={type:'tag',tagType:'targetduration'};if(match[1]){event.duration=parseInt(match[1],10);}
_this2.trigger('data',event);return;}
match=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(newLine);if(match){event={type:'tag',tagType:'version'};if(match[1]){event.version=parseInt(match[1],10);}
_this2.trigger('data',event);return;}
match=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(newLine);if(match){event={type:'tag',tagType:'media-sequence'};if(match[1]){event.number=parseInt(match[1],10);}
_this2.trigger('data',event);return;}
match=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(newLine);if(match){event={type:'tag',tagType:'discontinuity-sequence'};if(match[1]){event.number=parseInt(match[1],10);}
_this2.trigger('data',event);return;}
match=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(newLine);if(match){event={type:'tag',tagType:'playlist-type'};if(match[1]){event.playlistType=match[1];}
_this2.trigger('data',event);return;}
match=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(newLine);if(match){event=_extends__default['default'](parseByterange(match[1]),{type:'tag',tagType:'byterange'});_this2.trigger('data',event);return;}
match=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(newLine);if(match){event={type:'tag',tagType:'allow-cache'};if(match[1]){event.allowed=!/NO/.test(match[1]);}
_this2.trigger('data',event);return;}
match=/^#EXT-X-MAP:?(.*)$/.exec(newLine);if(match){event={type:'tag',tagType:'map'};if(match[1]){var attributes=parseAttributes(match[1]);if(attributes.URI){event.uri=attributes.URI;}
if(attributes.BYTERANGE){event.byterange=parseByterange(attributes.BYTERANGE);}}
_this2.trigger('data',event);return;}
match=/^#EXT-X-STREAM-INF:?(.*)$/.exec(newLine);if(match){event={type:'tag',tagType:'stream-inf'};if(match[1]){event.attributes=parseAttributes(match[1]);if(event.attributes.RESOLUTION){var split=event.attributes.RESOLUTION.split('x');var resolution={};if(split[0]){resolution.width=parseInt(split[0],10);}
if(split[1]){resolution.height=parseInt(split[1],10);}
event.attributes.RESOLUTION=resolution;}
if(event.attributes.BANDWIDTH){event.attributes.BANDWIDTH=parseInt(event.attributes.BANDWIDTH,10);}
if(event.attributes['PROGRAM-ID']){event.attributes['PROGRAM-ID']=parseInt(event.attributes['PROGRAM-ID'],10);}}
_this2.trigger('data',event);return;}
match=/^#EXT-X-MEDIA:?(.*)$/.exec(newLine);if(match){event={type:'tag',tagType:'media'};if(match[1]){event.attributes=parseAttributes(match[1]);}
_this2.trigger('data',event);return;}
match=/^#EXT-X-ENDLIST/.exec(newLine);if(match){_this2.trigger('data',{type:'tag',tagType:'endlist'});return;}
match=/^#EXT-X-DISCONTINUITY/.exec(newLine);if(match){_this2.trigger('data',{type:'tag',tagType:'discontinuity'});return;}
match=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(newLine);if(match){event={type:'tag',tagType:'program-date-time'};if(match[1]){event.dateTimeString=match[1];event.dateTimeObject=new Date(match[1]);}
_this2.trigger('data',event);return;}
match=/^#EXT-X-KEY:?(.*)$/.exec(newLine);if(match){event={type:'tag',tagType:'key'};if(match[1]){event.attributes=parseAttributes(match[1]);if(event.attributes.IV){if(event.attributes.IV.substring(0,2).toLowerCase()==='0x'){event.attributes.IV=event.attributes.IV.substring(2);}
event.attributes.IV=event.attributes.IV.match(/.{8}/g);event.attributes.IV[0]=parseInt(event.attributes.IV[0],16);event.attributes.IV[1]=parseInt(event.attributes.IV[1],16);event.attributes.IV[2]=parseInt(event.attributes.IV[2],16);event.attributes.IV[3]=parseInt(event.attributes.IV[3],16);event.attributes.IV=new Uint32Array(event.attributes.IV);}}
_this2.trigger('data',event);return;}
match=/^#EXT-X-START:?(.*)$/.exec(newLine);if(match){event={type:'tag',tagType:'start'};if(match[1]){event.attributes=parseAttributes(match[1]);event.attributes['TIME-OFFSET']=parseFloat(event.attributes['TIME-OFFSET']);event.attributes.PRECISE=/YES/.test(event.attributes.PRECISE);}
_this2.trigger('data',event);return;}
match=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(newLine);if(match){event={type:'tag',tagType:'cue-out-cont'};if(match[1]){event.data=match[1];}else{event.data='';}
_this2.trigger('data',event);return;}
match=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(newLine);if(match){event={type:'tag',tagType:'cue-out'};if(match[1]){event.data=match[1];}else{event.data='';}
_this2.trigger('data',event);return;}
match=/^#EXT-X-CUE-IN:?(.*)?$/.exec(newLine);if(match){event={type:'tag',tagType:'cue-in'};if(match[1]){event.data=match[1];}else{event.data='';}
_this2.trigger('data',event);return;}
match=/^#EXT-X-SKIP:(.*)$/.exec(newLine);if(match&&match[1]){event={type:'tag',tagType:'skip'};event.attributes=parseAttributes(match[1]);if(event.attributes.hasOwnProperty('SKIPPED-SEGMENTS')){event.attributes['SKIPPED-SEGMENTS']=parseInt(event.attributes['SKIPPED-SEGMENTS'],10);}
if(event.attributes.hasOwnProperty('RECENTLY-REMOVED-DATERANGES')){event.attributes['RECENTLY-REMOVED-DATERANGES']=event.attributes['RECENTLY-REMOVED-DATERANGES'].split(TAB);}
_this2.trigger('data',event);return;}
match=/^#EXT-X-PART:(.*)$/.exec(newLine);if(match&&match[1]){event={type:'tag',tagType:'part'};event.attributes=parseAttributes(match[1]);['DURATION'].forEach(function(key){if(event.attributes.hasOwnProperty(key)){event.attributes[key]=parseFloat(event.attributes[key]);}});['INDEPENDENT','GAP'].forEach(function(key){if(event.attributes.hasOwnProperty(key)){event.attributes[key]=/YES/.test(event.attributes[key]);}});if(event.attributes.hasOwnProperty('BYTERANGE')){event.attributes.byterange=parseByterange(event.attributes.BYTERANGE);}
_this2.trigger('data',event);return;}
match=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(newLine);if(match&&match[1]){event={type:'tag',tagType:'server-control'};event.attributes=parseAttributes(match[1]);['CAN-SKIP-UNTIL','PART-HOLD-BACK','HOLD-BACK'].forEach(function(key){if(event.attributes.hasOwnProperty(key)){event.attributes[key]=parseFloat(event.attributes[key]);}});['CAN-SKIP-DATERANGES','CAN-BLOCK-RELOAD'].forEach(;_this2.trigger('data',event);return;}
match=/^#EXT-X-PART-INF:(.*)$/.exec(newLine);if(match&&match[1]){event={type:'tag',tagType:'part-inf'};event.attributes=parseAttributes(match[1]);['PART-TARGET'].forEach(;_this2.trigger('data',event);return;}
match=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(newLine);if(match&&match[1]){event={type:'tag',tagType:'preload-hint'};event.attributes=parseAttributes(match[1]);['BYTERANGE-START','BYTERANGE-LENGTH'].forEach(;_this2.trigger('data',event);return;}
match=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(newLine);if(match&&match[1]){event={type:'tag',tagType:'rendition-report'};event.attributes=parseAttributes(match[1]);['LAST-MSN','LAST-PART'].forEach(;_this2.trigger('data',event);return;}
_this2.trigger('data',{type:'tag',data:newLine.slice(4)});});};_proto.addParser=_proto.addTagMapper=return ParseStream;}(Stream__default['default']);var camelCase=var camelCaseKeys=var setHoldBack=var Parser=function(_Stream){_inheritsLoose__default['default'](Parser,_Stream);function Parser(){var _this;_this=_Stream.call(this)||this;_this.lineStream=new LineStream();_this.parseStream=new ParseStream();_this.lineStream.pipe(_this.parseStream);var self=_assertThisInitialized__default['default'](_this);var uris=[];var currentUri={};var currentMap;var _key;var hasParts=false;var noop=function noop(){};var defaultMediaGroups={'AUDIO':{},'VIDEO':{},'CLOSED-CAPTIONS':{},'SUBTITLES':{}};var widevineUuid='urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed';var currentTimeline=0;_this.manifest={allowCache:true,discontinuityStarts:[],segments:[]};var lastByterangeEnd=0;var lastPartByterangeEnd=0;_this.on('end',;_this.parseStream.on('data',function(entry){var mediaGroup;var rendition;({tag:function tag(){(({version:'allow-cache':byterange:endlist:inf:key:function key(){if(!entry.attributes){this.trigger('warn',{message:'ignoring key declaration without attribute list'});return;}
if(entry.attributes.METHOD==='NONE'){_key=null;return;}
if(!entry.attributes.URI){this.trigger('warn',{message:'ignoring key declaration without URI'});return;}
if(entry.attributes.KEYFORMAT===widevineUuid){var VALID_METHODS=['SAMPLE-AES','SAMPLE-AES-CTR','SAMPLE-AES-CENC'];if(VALID_METHODS.indexOf(entry.attributes.METHOD)===-1){this.trigger('warn',{message:'invalid key method provided for Widevine'});return;}
if(entry.attributes.METHOD==='SAMPLE-AES-CENC'){this.trigger('warn',{message:'SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead'});}
if(entry.attributes.URI.substring(0,23)!=='data:text/plain;base64,'){this.trigger('warn',{message:'invalid key URI provided for Widevine'});return;}
if(!(entry.attributes.KEYID&&entry.attributes.KEYID.substring(0,2)==='0x')){this.trigger('warn',{message:'invalid key ID provided for Widevine'});return;}
this.manifest.contentProtection={'com.widevine.alpha':{attributes:{schemeIdUri:entry.attributes.KEYFORMAT,keyId:entry.attributes.KEYID.substring(2)},pssh:decodeB64ToUint8Array__default['default'](entry.attributes.URI.split(',')[1])}};return;}
if(!entry.attributes.METHOD){this.trigger('warn',{message:'defaulting key method to AES-128'});}
_key={method:entry.attributes.METHOD||'AES-128',uri:entry.attributes.URI};if(typeof entry.attributes.IV!=='undefined'){_key.iv=entry.attributes.IV;}},'media-sequence':'discontinuity-sequence':'playlist-type':map:'stream-inf':function streamInf(){this.manifest.playlists=uris;this.manifest.mediaGroups=this.manifest.mediaGroups||defaultMediaGroups;if(!entry.attributes){this.trigger('warn',{message:'ignoring empty stream-inf attributes'});return;}
if(!currentUri.attributes){currentUri.attributes={};}
_extends__default['default'](currentUri.attributes,entry.attributes);},media:discontinuity:'program-date-time':targetduration:start:'cue-out':function cueOut(){currentUri.cueOut=entry.data;},'cue-out-cont':function cueOutCont(){currentUri.cueOutCont=entry.data;},'cue-in':'skip':'part':'server-control':'preload-hint':'rendition-report':'part-inf':)[entry.tagType]||noop).call(self);},uri:comment:custom:)[entry.type].call(self);});return _this;}
var _proto=Parser.prototype;_proto.warnOnMissingAttributes_=_proto.push=function push(chunk){this.lineStream.push(chunk);};_proto.end=_proto.addParser=function addParser(options){this.parseStream.addParser(options);};_proto.addTagMapper=return Parser;}(Stream__default['default']);exports.LineStream=LineStream;exports.ParseStream=ParseStream;exports.Parser=Parser;},{"@babel/runtime/helpers/assertThisInitialized":5,"@babel/runtime/helpers/extends":6,"@babel/runtime/helpers/inheritsLoose":7,"@videojs/vhs-utils/cjs/decode-b64-to-uint8-array.js":10,"@videojs/vhs-utils/cjs/stream.js":11}],"p2p-media-loader-hlsjs":[function(require,module,exports){"use strict";var __createBinding=(this&&this.__createBinding)||(Object.create?(:();var __exportStar=(this&&this.__exportStar)||Object.defineProperty(exports,"__esModule",{value:true});exports.initJwPlayer=exports.initMediaElementJsPlayer=exports.initVideoJsHlsJsPlugin=exports.initVideoJsContribHlsJsPlayer=exports.initFlowplayerHlsJsPlayer=exports.initClapprPlayer=exports.initHlsJsPlayer=exports.version=void 0;exports.version="0.6.2";__exportStar(require("./engine"),exports);__exportStar(require("./segment-manager"),exports);function initHlsJsPlayer(player){if(player&&player.config&&player.config.loader&&typeof player.config.loader.getEngine==="function"){initHlsJsEvents(player,player.config.loader.getEngine());}}
exports.initHlsJsPlayer=initHlsJsPlayer;function initClapprPlayer(player){player.on("play",()=>{const playback=player.core.getCurrentPlayback();if(playback._hls&&!playback._hls._p2pm_linitialized){playback._hls._p2pm_linitialized=true;initHlsJsPlayer(player.core.getCurrentPlayback()._hls);}});}
exports.initClapprPlayer=initClapprPlayer;function initFlowplayerHlsJsPlayer(player){player.on("ready",()=>{var _a;return initHlsJsPlayer((_a=player.engine.hlsjs)!==null&&_a!==void 0?_a:player.engine.hls);});}
exports.initFlowplayerHlsJsPlayer=initFlowplayerHlsJsPlayer;function initVideoJsContribHlsJsPlayer(player){player.ready(()=>{const options=player.tech_.options_;if(options&&options.hlsjsConfig&&options.hlsjsConfig.loader&&typeof options.hlsjsConfig.loader.getEngine==="function"){initHlsJsEvents(player.tech_,options.hlsjsConfig.loader.getEngine());}});}
exports.initVideoJsContribHlsJsPlayer=initVideoJsContribHlsJsPlayer;function initVideoJsHlsJsPlugin(){if(videojs==undefined||videojs.Html5Hlsjs==undefined){return;}
videojs.Html5Hlsjs.addHook("beforeinitialize",(videojsPlayer,hlsjs)=>{if(hlsjs.config&&hlsjs.config.loader&&typeof hlsjs.config.loader.getEngine==="function"){initHlsJsEvents(hlsjs,hlsjs.config.loader.getEngine());}});}
exports.initVideoJsHlsJsPlugin=initVideoJsHlsJsPlugin;function initMediaElementJsPlayer(mediaElement){mediaElement.addEventListener("hlsFragChanged",(event)=>{const hls=mediaElement.hlsPlayer;if(hls&&hls.config&&hls.config.loader&&typeof hls.config.loader.getEngine==="function"){const engine=hls.config.loader.getEngine();if(event.data&&event.data.length>1){const frag=event.data[1].frag;const byteRange=frag.byteRange.length!==2?undefined:{offset:frag.byteRange[0],length:frag.byteRange[1]-frag.byteRange[0]};engine.setPlayingSegment(frag.url,byteRange,frag.start,frag.duration);}}});mediaElement.addEventListener("hlsDestroying",async()=>{const hls=mediaElement.hlsPlayer;if(hls&&hls.config&&hls.config.loader&&typeof hls.config.loader.getEngine==="function"){const engine=hls.config.loader.getEngine();await engine.destroy();}});mediaElement.addEventListener("hlsError",(event)=>{const hls=mediaElement.hlsPlayer;if(hls&&hls.config&&hls.config.loader&&typeof hls.config.loader.getEngine==="function"){if(event.data!==undefined&&event.data.details==="bufferStalledError"){const engine=hls.config.loader.getEngine();engine.setPlayingSegmentByCurrentTime(hls.media.currentTime);}}});}
exports.initMediaElementJsPlayer=initMediaElementJsPlayer;function initJwPlayer(player,hlsjsConfig){const iid=setInterval(()=>{if(player.hls&&player.hls.config){clearInterval(iid);Object.assign(player.hls.config,hlsjsConfig);initHlsJsPlayer(player.hls);}},200);}
exports.initJwPlayer=initJwPlayer;function initHlsJsEvents(player,engine){player.on("hlsFragChanged",(_event,data)=>{const frag=data.frag;const byteRange=frag.byteRange.length!==2?undefined:{offset:frag.byteRange[0],length:frag.byteRange[1]-frag.byteRange[0]};engine.setPlayingSegment(frag.url,byteRange,frag.start,frag.duration);});player.on("hlsDestroying",;player.on("hlsError",(_event,errorData)=>{if(errorData.details==="bufferStalledError"){const htmlMediaElement=(player.media===undefined?player.el_:player.media);if(htmlMediaElement){engine.setPlayingSegmentByCurrentTime(htmlMediaElement.currentTime);}}});}},{"./engine":2,"./segment-manager":4}]},{},[1]);