/*! For license information please see 4f1bc8b9-8f510a585acbc802df0a.js.LICENSE.txt */
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[9934],{38710:function(e,t,n){n.d(t,{s:function(){return $v}});var i=n(44461),r=n.n(i),o=n(25608),s=n(96126),a=n(20064),c=n(86775),l=n(11254),u=n(56263),h=n(97309),d=n(40290),p=n(29583),f=n(47083),m=n(35980),g=n(24279),v=n(21340),y=n(72602),b=n(67697),x=n(33721),w=n(64593),_=n(34155);(".carousel-row-container .position-relative{position:relative}.swan-carousel-slide .vista-video-player{position:unset}.on-page-builder .see-details{display:inline;font-weight:300}.on-page-builder .builder-container .builder-controls{position:relative}.on-page-builder .builder-container .builder-controls .price-column,.on-page-builder .builder-container .builder-controls .quantity-control,.on-page-builder .builder-container .builder-controls .selector-column{padding:0}.on-page-builder .builder-container .builder-controls .controls-row{margin:0}.on-page-builder .builder-container .price-block{font-weight:lighter}.on-page-builder .builder-container .discount-text{color:#0a806b}.on-page-builder .builder-step-loader{opacity:0;transition:opacity .2s ease;z-index:-10}.on-page-builder .loader-active{opacity:1;transition-delay:.35s;z-index:10}.on-page-builder .satisfaction-guaranteed-spacer{margin-left:-36px;margin-right:-36px;margin-top:-38px}.on-page-builder .satisfaction-guaranteed{margin:0 -36px}.on-page-builder .satisfaction-guaranteed img{margin-right:8px}.shop-with-your-design-img{background-color:#f2f2f2;object-fit:scale-down!important}@media only screen and (max-width:767px){.satisfaction-guaranteed-spacer{margin-left:-16px;margin-right:-16px}}@media only screen and (max-width:1023px){.on-page-builder{margin:0 auto;max-width:375px}.on-page-builder .builder-container h1{font-size:1rem;font-weight:700}.on-page-builder .builder-container .builder-controls{margin-top:8px}.on-page-builder .satisfaction-guaranteed{margin:0 -16px}.on-page-builder .satisfaction-guaranteed-spacer{margin-left:-16px;margin-right:-16px}.price-row{margin-top:8px!important}}"),M(".on-page-builder .builder-container .builder-controls .swan-row{margin:0}");const S={label:"Vortex 3D toggle button view",pageStage:"Discover",pageSection:"Product Builder"},E=["aFrames","flexiblePackagingDoypacks","standUpPouches","flatPouches","recyclablePouches","shippingBoxes","softTouchBusinessCards","kraftBusinessCards","premiumPlusBusinessCards","recycledMatteBusinessCards"],T={"en-SG":["aFrames"],"en-AU":["aFrames"],"de-DE":["flatPouches"],"en-NZ":["aFrames","standUpPouches"],"en-GB":["softTouchBusinessCards","kraftBusinessCards","premiumPlusBusinessCards","recycledMatteBusinessCards"]};var A,P;(P=A||(A={})).Video="Video",P.Image="Image";class L{static sendTracking(e,t,n,i=0){const r=window.tracking;r&&r.track&&r.page?(0!==i&&e.info(`Tracking ${t}: Success after ${i} attempt(s).`),n()):i<10?setTimeout((()=>L.sendTracking(e,t,n,++i)),1e3):e.error(`ERROR: Tracking ${t}: Tracking is not initialized after 10s.`)}static trackVortexHeroGalleryViewed(e,t,n,i,r){const o="Vortex 3D Toggle Button Viewed";L.sendTracking(r,o,(()=>{window.tracking.track(o,{eventDetail:i,label:S.label,eventName:o,product_id:e.mpvId,name:e.name,pageSection:n.pageSection,pageStage:n.pageStage,pageName:n.analyticsPageName,trackingTenant:t})}))}static trackVortexHeroGalleryClicked(e,t,n,i,r){const o="Vortex 3D Toggle Button Clicked";L.sendTracking(r,o,(()=>{window.tracking.track(o,{eventDetail:i,label:S.label,pageSection:n.pageSection,pageStage:n.pageStage,pageName:n.analyticsPageName,trackingTenant:t,product_id:e.mpvId,name:e.name})}))}static trackHeroGalleryThumbnailClicked(e,t,n,i,r){const o="Media Engaged";L.sendTracking(r,o,(()=>{window.tracking.track(o,{category:t,label:"Hero Gallery Thumbnail",eventDetail:`position_${e}`,pageStage:i.pageStage,pageSection:i.pageSection,pageName:i.analyticsPageName,product_id:n.mpvId,name:n.name,core_product_id:n.coreProductId,core_product_version:n.version})}))}}var O,R={exports:{}};O=R,);var C,I,N=(I=R.exports)&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I;!function(e){e.ResponsiveImage="responsive-image",e.FluidImage="fluid-image"}(C||(C={}));const D=e=>{const t={src:e.cloudinaryUrl,alt:e.altTextOverride||e.alt||"",styles:e.styles||""},n=N({[`${e.className}`]:!!e.className});return e.imageType===C.ResponsiveImage?r().createElement(o.v,Object.assign({},t,{aspectRatio:e.aspectRatio,onClick:e.onClickHandler,className:n})):r().createElement(s.R,Object.assign({},t,{className:n}))},z=e=>{const{publicId:t,playerId:n,videoConfig:o,canonicalDomain:s,tenant:a}=e,[c,l]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{const e=window.setInterval((function(){!u&&window.cloudinary&&window.cloudinary.Cloudinary&&(h(!0),window.clearInterval(e))}),100);return function(){window.clearInterval(e)}}),[]),(0,i.useEffect)((()=>{if(u&&!c){const e=Object.assign(Object.assign({},o),{fluid:!0,colors:{accent:"#0099e0"},controls:!0,logoOnclickUrl:`https://${s}/`,logoImageUrl:"https://cms.cloudinary.vpsvc.com/image/upload/dpr_auto,q_auto/v1560966964/logomark.png"});try{window.cloudinary.videoPlayer(n,Object.assign(Object.assign({},e),{cloud_name:a.toLowerCase(),secure:!0,cloudinaryAnalytics:!0})).source({publicId:t})}catch(P){!function(e){var t;if(!(null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.includes("Element is not a video tag")))throw e}(P)}l(!0)}}),[u]),r().createElement(r().Fragment,null,r().createElement(w.Helmet,null,r().createElement("link",{href:"https://unpkg.com/cloudinary-video-player@1.10.3/dist/cld-video-player.min.css",rel:"stylesheet",type:"text/css"}),r().createElement("script",{defer:!0,src:"https://unpkg.com/cloudinary-video-player@1.10.3/dist/cld-video-player.min.js",type:"text/javascript"})),r().createElement("video",{id:n,controls:!0,className:"cld-video-player vista-video-player"}))},U=e=>{var t;return H(e)?`${B(e)}.jpg`:(null===(t=null==e?void 0:e.cloudinaryImage)||void 0===t?void 0:t.cloudinaryUrl)?e.cloudinaryImage.cloudinaryUrl:""},B=F=(e,t,n,i,o,s)=>{const c=e.map(((e,c)=>{if(H(e)){const t=`gallery-video-${c}`;return r().createElement(a.q,{key:t},r().createElement(z,{publicId:e.video.publicId,playerId:t,tenant:n,canonicalDomain:i,videoConfig:{loop:!0,autoplay:!0,playsInline:!0,preload:"none",muted:!0,transformation:{transformation:"productPageHeroGalleryTransformation_v2",crop:"scale",format:"auto",width:"auto",dpr:"auto",quality:"auto",startOffset:e.posterImageFrame}}}))}if(e.cloudinaryImage){const n=new x.default;return r().createElement(a.q,{key:`gallery-image-${c}`},r().createElement("picture",{key:`image-${c}`},r().createElement("source",{media:"(max-width: 767px)",srcSet:`${e.cloudinaryImage.mobileCloudinaryUrl} 768w`,sizes:"(max-width: 767px) 100vw"}),r().createElement("source",{srcSet:`${e.cloudinaryImage.cloudinaryUrl} 1700w`}),r().createElement("img",{src:e.cloudinaryImage.cloudinaryUrl,alt:e.altTextOverride||n.replace(o,{productName:t,index:c+1}),className:s&&"shop-with-your-design"===e.cloudinaryImage.alt?"shop-with-your-design-img":void 0})))}return r().createElement(r().Fragment,null)}));return c},k=(e,t,n)=>{const i=[];return{thumbnailImages:null==e?void 0:e.map(((e,o)=>{if(H(e))return i.push(""),r().createElement(c.n,{key:`thumbnail-image-${o}`,onClick:()=>n(o,A.Video)},r().createElement(s.R,{src:U(e)}));if(e.cloudinaryImage){const s=(new x.default).replace(t,{index:o+1});return i.push(s),r().createElement(a.q,{key:`thumbnail-image-${o}`,onClick:,r().createElement(D,{cloudinaryUrl:e.cloudinaryImage.contentfulThumbnailCloudinaryUrl||e.cloudinaryImage.thumbnailCloudinaryUrl||e.cloudinaryImage.cloudinaryUrl,altTextOverride:s,key:`thumbnail-${o}`}))}return r().createElement(r().Fragment,null)})),thumbnailImageAltTexts:i}},j=(e,t)=>t&&e?`${e.trim()} ${t}`:t,H=M(".desktop-canvas-height{height:73vh}.mobile-height{height:40vh}.vortex-canvas-loader{left:50%;position:absolute;top:50%;-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.vortex-actions-container{flex-wrap:wrap;gap:8px;justify-content:center;width:100%}.vortex-toggle-switch{position:relative}.vortex-toggle-switch.mobile-vortex{top:-36px}.vortex-toggle-switch.other-vortex{top:-56px}.vortex-toggle-switch.no-top{top:0}.vortex-toggle-switch .no-right-margin{margin-right:0;z-index:99}");const G=({vortexEnabled:e,onRequestActivatedChange:t,isMobile:n,vortexToggleView:i})=>{const o=i||"3D View";return r().createElement(l.h,{className:"vortex-toggle-switch "+(e?"no-top":n?"mobile-vortex":"other-vortex"),justifyContent:"flex-end"},r().createElement(u.Z,{className:"no-right-margin",activated:e,onRequestActivatedChange:t,"aria-labelledby":o},r().createElement(h.s,null,o),r().createElement(d.e,null,o)))};var V,W;!function(e){e[e.forward=0]="forward",e[e.backward=1]="backward"}(V||(V={})),function(e){e[e.playing=0]="playing",e[e.paused=1]="paused"}(W||(W={}));class q{constructor(){Object.defineProperty(this,"animations",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"animationState",{enumerable:!0,configurable:!0,writable:!0,value:W.playing})}auseAnimations(){this.animationState=W.paused}date(e){this.animationState!==W.paused&&this.animations.forEach((t=>t.update(e)))}leanAnimations(){const e=[];this.animations.forEach((),this.animations=e}cancelAnimations(e){this.stopAnimations(e),(void 0===e?this.animations:this.animations.filter((t=>t.tags.includes(e)))).forEach((e=>e.cancel()))}stopAnimations(e){e?this.animations.filter(().forEach((e=>e.stop())):this.animations.forEach((e=>e.stop()))}resumeAnimations(e){e?this.animations.filter(().forEach((e=>e.start())):this.animations.forEach(()}}class X{constructor(e,t){Object.defineProperty(this,"minRange",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRange",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"applyDamping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"elapsedTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"swivelGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shouldDamp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dampValue",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"resolveAnimation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"activeState",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"canceledState",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialRotation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]});const n=function(e){const t=e||45;return t>2*Math.PI?t/180*Math.PI:t}(t.range);this.minRange=-n,this.maxRange=n,this.elapsedTime=0,this.swivelGroup=e,this.initialRotation=this.swivelGroup.rotation.y,this.shouldDamp=void 0!==t.damping,this.shouldDamp&&(this.dampValue=!0===t.damping?-.05:-t.damping),this.applyDamping=this.shouldDamp?(e,t)=>e*Math.pow(Math.E,this.dampValue*t):get isComplete(){return this.completed}get isCanceled(){return this.canceledState}ancelet isActive(){return this.activeState}update(e){if(this.isActive){let t=Math.sin(this.elapsedTime);t=this.applyDamping(t,this.elapsedTime),this.shouldDamp&&this.dampValue*this.elapsedTime<-4&&(this.activeState=!1,this.completed=!0,this.resolveAnimation&&this.resolveAnimation());const n=function(e,t,n){const i=(t-e)/2;return i*n+(t-1*i)}(this.minRange,this.maxRange,t);this.swivelGroup.rotation.y=n,this.elapsedTime+=e}}start(){return this.activeState=!0,this.shouldDamp?new Promise((e=>{this.resolveAnimation=e})):Promise.resolve()}resume(){void 0!==this.resolveAnimation&&(this.activeState=!0)}stop(){this.activeState=!1}}const Y=0,Z=1,J=2,$=1,K=2,Q=3,ee=0,te=1,ne=2,ie=0,re=1,oe=2,se=3,ae=4,ce=5,le=100,ue=101,he=102,de=103,pe=104,fe=200,me=201,ge=202,ve=203,ye=204,be=205,xe=206,we=207,_e=208,Me=209,Se=210,Ee=0,Te=1,Ae=2,Pe=3,Le=4,Oe=5,Re=6,Ce=7,Ie=0,Ne=1,De=2,ze=0,Ue=1,Be=2,Fe=3,ke=4,je=5,He=301,Ge=302,Ve=303,We=304,qe=306,Xe=307,Ye=1e3,Ze=1001,Je=1002,$e=1003,Ke=1004,Qe=1005,et=1006,tt=1007,nt=1008,it=1009,rt=1010,ot=1011,st=1012,at=1013,ct=1014,lt=1015,ut=1016,ht=1017,dt=1018,pt=1019,ft=1020,mt=1021,gt=1022,vt=1023,yt=1024,bt=1025,xt=1026,wt=1027,_t=1028,Mt=1029,St=1030,Et=1031,Tt=1032,At=1033,Pt=33776,Lt=33777,Ot=33778,Rt=33779,Ct=35840,It=35841,Nt=35842,Dt=35843,zt=36196,Ut=37492,Bt=37496,Ft=37808,kt=37809,jt=37810,Ht=37811,Gt=37812,Vt=37813,Wt=37814,qt=37815,Xt=37816,Yt=37817,Zt=37818,Jt=37819,$t=37820,Kt=37821,Qt=36492,en=37840,tn=37841,nn=37842,rn=37843,on=37844,sn=37845,an=37846,cn=37847,ln=37848,un=37849,hn=37850,dn=37851,pn=37852,fn=37853,mn=2300,gn=2301,vn=2302,yn=2400,bn=2401,xn=2402,wn=3e3,_n=3001,Mn=3007,Sn=3002,En=3003,Tn=3004,An=3005,Pn=3006,Ln=3200,On=3201,Rn=0,Cn=1,In=7680,Nn=519,Dn=35044,zn=35048,Un="300 es";bject.assign(Bn.prototype,{addEventListener:hasEventListener:removeEventListener:dispatchEvent:function(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e)}}});const Fn=[];for(let Kv=0;Kv<256;Kv++)Fn[Kv]=(Kv<16?"0":"")+Kv.toString(16);let kn=1234567;const jn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:clamp:euclideanModulo:mapLinear:lerp:smoothstep:smootherstep:randInt:randFloat:randFloatSpread:seededRandom:degToRad:function(e){return e*jn.DEG2RAD},radToDeg:isPowerOfTwo:ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:setQuaternionFromProperEuler:;class Hn{constructor(e=0,t=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}etX(e){return this.x=e,this}setY(e){return this.y=e,this}){return this.multiplyScalar(1/e)}in(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}mpLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}e(){return this.divideScalar(this.length()||1)}istanceTo(e){return Math.sqrt(this.distanceToSquared(e))}tLength(e){return this.normalize().multiplyScalar(e)}mArrayoArrayss Gn{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}actBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}emultiply(e){return this.multiplyMatrices(e,this)}InversetNormalMatrixtUvTransformrrayoArraylet Vn;const Wn={getDataURL:;let qn=0;n.DEFAULT_IMAGE=void 0,Xn.DEFAULT_MAPPING=300,Xn.prototype=Object.assign(Object.create(Bn.prototype),{constructor:Xn,isTexture:!0,updateMatrix:clone:function(){return(new this.constructor).copy(this)},copy:toJSON:dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:),Object.defineProperty(Xn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});class Yn{constructor(e=0,t=0,n=0,i=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}tX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}one(){return new this.constructor(this.x,this.y,this.z,this.w)} this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}r(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}sromArrayoArrayrototype=Object.assign(Object.create(Bn.prototype),{constructor:Zn,isWebGLRenderTarget:!0,setSize:clone:function(){return(new this.constructor).copy(this)},copy:dispose:function(){this.dispatchEvent({type:"dispose"})}}),Jn.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Jn,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Zn.prototype.copy.call(this,e),this.samples=e.samples,this}});class $n{constructor(e=0,t=0,n=0,i=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=n,this._w=i}tatic slerpFlat(e,t,n,i,r,o,s){let a=n[i+0],c=n[i+1],l=n[i+2],u=n[i+3];const h=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(u!==f||a!==h||c!==d||l!==p){let e=1-s;const t=a*h+c*d+l*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,s=Math.sin(s*o)/r}const r=s*n;if(a=a*e+h*r,c=c*e+d*r,l=l*e+p*r,u=u*e+f*r,e===1-s){const e=1/Math.sqrt(a*a+c*c+l*l+u*u);a*=e,c*=e,l*=e,u*=e}}e[t]=a,e[t+1]=c,e[t+2]=l,e[t+3]=u}et x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}UnitVectorsrse(){return this.conjugate()}Array(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}class Kn{constructor(e=0,t=0,n=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=n}etScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}one(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}ddScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}plyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}ideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}mpLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}ze(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}ross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}eToistanceTo(e){return Math.sqrt(this.distanceToSquared(e))}tFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}etFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}FromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}quals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}onst Qn=new Kn,ei=new $n;class ti{constructor(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new Kn(1/0,1/0,1/0),this.max=void 0!==t?t:new Kn(-1/0,-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}tFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ri.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}lone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}ndByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}nt(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Kn),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ri.copy(e).clamp(this.min,this.max).sub(e).length()}ion(e){return this.min.min(e.min),this.max.max(e.max),this}ranslate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}onst ii=[new Kn,new Kn,new Kn,new Kn,new Kn,new Kn,new Kn,new Kn],ri=new Kn,oi=new ti,si=new Kn,ai=new Kn,ci=new Kn,li=new Kn,ui=new Kn,hi=new Kn,di=new Kn,pi=new Kn,fi=new Kn,mi=new Kn,gi=new ti;class vi{constructor(e,t){this.center=void 0!==e?e:new Kn,this.radius=void 0!==t?t:-1}one(){return(new this.constructor).copy(this)}ectsBox(e){return e.intersectsSphere(this)} yi=new Kn,bi=new Kn,xi=new Kn,wi=new Kn,_i=new Kn,Mi=new Kn,Si=new Kn;class Ei{constructor(e,t){this.origin=void 0!==e?e:new Kn,this.direction=void 0!==t?t:new Kn(0,0,-1)}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}{return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}class Ti{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}verset t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t){void 0===t&&(t=0);for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArrayconst Ai=new Kn,Pi=new Ti,Li=new Kn(0,0,0),Oi=new Kn(1,1,1),Ri=new Kn,Ci=new Kn,Ii=new Kn;class Ni{constructor(e=0,t=0,n=0,i=Ni.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}lone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrixls(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}oArray(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}onChange(e){return this._onChangeCallback=e,this}Ni.DefaultOrder="XYZ",Ni.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Di=new Ti,zi=new $n;et Bi=0;const Fi=new Kn,ki=new $n,ji=new Ti,Hi=new Kn,Gi=new Kn,Vi=new Kn,Wi=new $n,qi=new Kn(1,0,0),Xi=new Kn(0,1,0),Yi=new Kn(0,0,1),Zi={type:"added"},Ji={type:"removed"};i.DefaultUp=new Kn(0,1,0),$i.DefaultMatrixAutoUpdate=!0,$i.prototype=Object.assign(Object.create(Bn.prototype),{constructor:$i,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return ki.setFromAxisAngle(e,t),this.quaternion.multiply(ki),this},rotateOnWorldAxis:rotateX:function(e){return this.rotateOnAxis(qi,e)},rotateY:function(e){return this.rotateOnAxis(Xi,e)},rotateZ:function(e){return this.rotateOnAxis(Yi,e)},translateOnAxis:translateX:function(e){return this.translateOnAxis(qi,e)},translateY:function(e){return this.translateOnAxis(Xi,e)},translateZ:localToWorld:worldToLocal:lookAt:add:remove:attach:getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:getObjectByProperty:getWorldPosition:getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new $n),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gi,e,Vi),e},getWorldScale:getWorldDirection:raycast:function(){},traverse:traverseVisible:traverseAncestors:updateMatrix:updateMatrixWorld:updateWorldMatrix:toJSON:function(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};f(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),s=o(e.images),a=o(e.shapes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}},clone:copy:);const Ki=new Kn,Qi=new Kn,er=new Gn;class tr{constructor(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new Kn(1,0,0),this.constant=void 0!==t?t:0}set(e,t){return this.normal.copy(e),this.constant=t,this}ne(){return(new this.constructor).copy(this)}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}sectLinetersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}als(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}const nr=new Kn,ir=new Kn,rr=new Kn,or=new Kn,sr=new Kn,ar=new Kn,cr=new Kn,lr=new Kn,ur=new Kn,hr=new Kn;class dr{constructor(e,t,n){this.a=void 0!==e?e:new Kn,this.b=void 0!==t?t:new Kn,this.c=void 0!==n?n:new Kn}{return(new this.constructor).copy(this)}Normal(e){return dr.getNormal(this.a,this.b,this.c,e)}r={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fr={h:0,s:0,l:0},mr={h:0,s:0,l:0};ss br{constructor(e,t,n){return Object.defineProperty(this,"isColor",{value:!0}),void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}RGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSLtColorNamepy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinearopyLinearToGammaonvertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}opySRGBToLinear(e){return this.r=vr(e.r),this.g=vr(e.g),this.b=vr(e.b),this}onvertSRGBToLinear(){return this.copySRGBToLinear(this),this}yoArray.NAMES=pr,br.prototype.r=1,br.prototype.g=1,br.prototype.b=1;class xr{constructor(e,t,n,i,r,o){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new Kn,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new br,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}clone(){return(new this.constructor).copy(this)}copylet wr=0;.prototype=Object.assign(Object.create(Bn.prototype),{constructor:_r,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:setValues:toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};f(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==re&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==ee&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(_r.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Mr.prototype=Object.create(_r.prototype),Mr.prototype.constructor=Mr,Mr.prototype.isMeshBasicMaterial=!0,Mr.prototype.copy=const Sr=new Kn,Er=new Hn;unction Ar(e,t,n){Tr.call(this,new Int8Array(e),t,n)}function Pr(e,t,n){Tr.call(this,new Uint8Array(e),t,n)}function Lr(e,t,n){Tr.call(this,new Uint8ClampedArray(e),t,n)}function Or(e,t,n){Tr.call(this,new Int16Array(e),t,n)}function Rr(e,t,n){Tr.call(this,new Uint16Array(e),t,n)}function Cr(e,t,n){Tr.call(this,new Int32Array(e),t,n)}function Ir(e,t,n){Tr.call(this,new Uint32Array(e),t,n)}function Nr(e,t,n){Tr.call(this,new Float32Array(e),t,n)}bject.defineProperty(Tr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Tr.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new br),t[n++]=r.r,t[n++]=r.g,t[n++]=r.b}return this},copyVector2sArray:copyVector3sArray:copyVector4sArray:applyMatrix3:applyMatrix4:function(e){for(let t=0,n=this.count;t<n;t++)Sr.x=this.getX(t),Sr.y=this.getY(t),Sr.z=this.getZ(t),Sr.applyMatrix4(e),this.setXYZ(t,Sr.x,Sr.y,Sr.z);return this},applyNormalMatrix:function(e){for(let t=0,n=this.count;t<n;t++)Sr.x=this.getX(t),Sr.y=this.getY(t),Sr.z=this.getZ(t),Sr.applyNormalMatrix(e),this.setXYZ(t,Sr.x,Sr.y,Sr.z);return this},transformDirection:set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:setX:getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:setW:setXY:setXYZ:setXYZW:onUpload:function(e){return this.onUploadCallback=e,this},clone:toJSON:),Ar.prototype=Object.create(Tr.prototype),Ar.prototype.constructor=Ar,Pr.prototype=Object.create(Tr.prototype),Pr.prototype.constructor=Pr,Lr.prototype=Object.create(Tr.prototype),Lr.prototype.constructor=Lr,Or.prototype=Object.create(Tr.prototype),Or.prototype.constructor=Or,Rr.prototype=Object.create(Tr.prototype),Rr.prototype.constructor=Rr,Cr.prototype=Object.create(Tr.prototype),Cr.prototype.constructor=Cr,Ir.prototype=Object.create(Tr.prototype),Ir.prototype.constructor=Ir,Nr.prototype=Object.create(Tr.prototype),Nr.prototype.constructor=Nr,Dr.prototype=Object.create(Tr.prototype),Dr.prototype.constructor=Dr;class zr{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){const t=[];let n,i,r;const o=e.faces;for(i=0;i<o.length;i++){const e=o[i];e.materialIndex!==r&&(r=e.materialIndex,void 0!==n&&(n.count=3*i-n.start,t.push(n)),n={start:3*i,materialIndex:r})}void 0!==n&&(n.count=3*i-n.start,t.push(n)),this.groups=t}fromGeometry(e){const t=e.faces,n=e.vertices,i=e.faceVertexUvs,r=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,a=s.length;let c;if(a>0){c=[];for(let e=0;e<a;e++)c[e]={name:s[e].name,data:[]};this.morphTargets.position=c}const l=e.morphNormals,u=l.length;let h;if(u>0){h=[];for(let e=0;e<u;e++)h[e]={name:l[e].name,data:[]};this.morphTargets.normal=h}const d=e.skinIndices,p=e.skinWeights,f=d.length===n.length,m=p.length===n.length;n.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<t.length;g++){const e=t[g];this.vertices.push(n[e.a],n[e.b],n[e.c]);const v=e.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const t=e.normal;this.normals.push(t,t,t)}const y=e.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const t=e.color;this.colors.push(t,t,t)}if(!0===r){const e=i[0][g];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new Hn,new Hn,new Hn))}if(!0===o){const e=i[1][g];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new Hn,new Hn,new Hn))}for(let t=0;t<a;t++){const n=s[t].vertices;c[t].data.push(n[e.a],n[e.b],n[e.c])}for(let t=0;t<u;t++){const e=l[t].vertexNormals[g];h[t].data.push(e.a,e.b,e.c)}f&&this.skinIndices.push(d[e.a],d[e.b],d[e.c]),m&&this.skinWeights.push(p[e.a],p[e.b],p[e.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}et Br=1;const Fr=new Ti,kr=new $i,jr=new Kn,Hr=new ti,Gr=new ti,Vr=new Kn;r.prototype=Object.assign(Object.create(Bn.prototype),{constructor:Wr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:getAttribute:setAttribute:deleteAttribute:addGroup:clearGroups:setDrawRange:applyMatrix4:rotateX:function(e){return Fr.makeRotationX(e),this.applyMatrix4(Fr),this},rotateY:function(e){return Fr.makeRotationY(e),this.applyMatrix4(Fr),this},rotateZ:function(e){return Fr.makeRotationZ(e),this.applyMatrix4(Fr),this},translate:function(e,t,n){return Fr.makeTranslation(e,t,n),this.applyMatrix4(Fr),this},scale:function(e,t,n){return Fr.makeScale(e,t,n),this.applyMatrix4(Fr),this},lookAt:function(e){return kr.lookAt(e),kr.updateMatrix(),this.applyMatrix4(kr.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(jr).negate(),this.translate(jr.x,jr.y,jr.z),this},setFromObject:setFromPoints:updateFromObject:fromGeometry:fromDirectGeometry:function(e){const t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new Tr(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){const t=new Float32Array(3*e.normals.length);this.setAttribute("normal",new Tr(t,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const t=new Float32Array(3*e.colors.length);this.setAttribute("color",new Tr(t,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const t=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new Tr(t,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const t=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new Tr(t,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(const n in e.morphTargets){const t=[],i=e.morphTargets[n];for(let e=0,n=i.length;e<n;e++){const n=i[e],r=new Nr(3*n.data.length,3);r.name=n.name,t.push(r.copyVector3sArray(n.data))}this.morphAttributes[n]=t}if(e.skinIndices.length>0){const t=new Nr(4*e.skinIndices.length,4);this.setAttribute("skinIndex",t.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const t=new Nr(4*e.skinWeights.length,4);this.setAttribute("skinWeight",t.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:computeBoundingSphere:computeFaceNormals:function(){},computeVertexNormals:merge:normalizeNormals:toNonIndexed:toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const t=n[a],i=t.toJSON(e.data);""!==t.name&&(i.name=t.name),e.data.attributes[a]=i}const i={};let r=!1;for(const a in this.morphAttributes){const t=this.morphAttributes[a],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i],o=r.toJSON(e.data);""!==r.name&&(o.name=r.name),n.push(o)}n.length>0&&(i[a]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e},clone:copy:dispose:);const qr=new Ti,Xr=new Ei,Yr=new vi,Zr=new Kn,Jr=new Kn,$r=new Kn,Kr=new Kn,Qr=new Kn,eo=new Kn,to=new Kn,no=new Kn,io=new Kn,ro=new Hn,oo=new Hn,so=new Hn,ao=new Kn,co=new Kn;function lo(e,t){$i.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Wr,this.material=void 0!==t?t:new Mr,this.updateMorphTargets()}function uo(e,t,n,i,r,o,s,a){let c;if(c=t.side===te?i.intersectTriangle(s,o,r,!0,a):i.intersectTriangle(r,o,s,t.side!==ne,a),null===c)return null;co.copy(a),co.applyMatrix4(e.matrixWorld);const l=n.ray.origin.distanceTo(co);return l<n.near||l>n.far?null:{distance:l,point:co.clone(),object:e}}o.prototype=Object.assign(Object.create($i.prototype),{constructor:lo,isMesh:!0,copy:updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Yr.copy(n.boundingSphere),Yr.applyMatrix4(r),!1===e.ray.intersectsSphere(Yr))return;if(qr.getInverse(r),Xr.copy(e.ray).applyMatrix4(qr),null!==n.boundingBox&&!1===Xr.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const r=n.index,s=n.attributes.position,a=n.morphAttributes.position,c=n.morphTargetsRelative,l=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=i[p.materialIndex];for(let n=Math.max(p.start,d.start),i=Math.min(p.start+p.count,d.start+d.count);n<i;n+=3){const i=r.getX(n),h=r.getX(n+1),d=r.getX(n+2);o=ho(this,f,e,Xr,s,a,c,l,u,i,h,d),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=p.materialIndex,t.push(o))}}else for(let n=Math.max(0,d.start),p=Math.min(r.count,d.start+d.count);n<p;n+=3){const h=r.getX(n),d=r.getX(n+1),p=r.getX(n+2);o=ho(this,i,e,Xr,s,a,c,l,u,h,d,p),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(void 0!==s)if(Array.isArray(i))for(let n=0,p=h.length;n<p;n++){const r=h[n],p=i[r.materialIndex];for(let n=Math.max(r.start,d.start),i=Math.min(r.start+r.count,d.start+d.count);n<i;n+=3)o=ho(this,p,e,Xr,s,a,c,l,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,t.push(o))}else for(let n=Math.max(0,d.start),p=Math.min(s.count,d.start+d.count);n<p;n+=3)o=ho(this,i,e,Xr,s,a,c,l,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(n.isGeometry){const r=Array.isArray(i),s=n.vertices,a=n.faces;let c;const l=n.faceVertexUvs[0];l.length>0&&(c=l);for(let n=0,u=a.length;n<u;n++){const l=a[n],u=r?i[l.materialIndex]:i;if(void 0===u)continue;const h=s[l.a],d=s[l.b],p=s[l.c];if(o=uo(this,u,e,Xr,h,d,p,ao),o){if(c&&c[n]){const e=c[n];ro.copy(e[0]),oo.copy(e[1]),so.copy(e[2]),o.uv=dr.getUV(ao,h,d,p,ro,oo,so,new Hn)}o.face=l,o.faceIndex=n,t.push(o)}}}}});class po extends Wr{nst go={clone:fo,merge:mo};var vo="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",yo="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function bo(e){_r.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=vo,this.fragmentShader=yo,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}.prototype=Object.create(_r.prototype),bo.prototype.constructor=bo,bo.prototype.isShaderMaterial=!0,bo.prototype.copy=bo.prototype.toJSON=function(e){const t=_r.prototype.toJSON.call(this,e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t},xo.prototype=Object.assign(Object.create($i.prototype),{constructor:xo,isCamera:!0,copy:getWorldDirection:updateMatrixWorld:updateWorldMatrix:clone:function(){return(new this.constructor).copy(this)}}),wo.prototype=Object.assign(Object.create(xo.prototype),{constructor:wo,isPerspectiveCamera:!0,copy:setFocalLength:getFocalLength:getEffectiveFOV:getFilmWidth:getFilmHeight:setViewOffset:clearViewOffset:updateProjectionMatrix:function(){const e=this.near;let t=e*Math.tan(.5*jn.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/s,i*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:);const _o=90;function Mo(e,t,n){if($i.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new wo(_o,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Kn(1,0,0)),this.add(i);const r=new wo(_o,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Kn(-1,0,0)),this.add(r);const o=new wo(_o,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Kn(0,1,0)),this.add(o);const s=new wo(_o,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Kn(0,-1,0)),this.add(s);const a=new wo(_o,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Kn(0,0,1)),this.add(a);const c=new wo(_o,1,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Kn(0,0,-1)),this.add(c),this.update=this.clear=function(e,t,i,r){const o=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(n,s),e.clear(t,i,r);e.setRenderTarget(o)}}unction Eo(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),Zn.call(this,e,e,t),t=t||{},this.texture=new So(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}o.prototype=Object.create($i.prototype),Mo.prototype.constructor=Mo,So.prototype=Object.create(Xn.prototype),So.prototype.constructor=So,So.prototype.isCubeTexture=!0,Object.defineProperty(So.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),Eo.prototype=Object.create(Zn.prototype),Eo.prototype.constructor=Eo,Eo.prototype.isWebGLCubeRenderTarget=!0,Eo.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=vt,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",r="\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",o=new po(5,5,5),s=new bo({name:"CubemapFromEquirect",uniforms:fo(n),vertexShader:i,fragmentShader:r,side:te,blending:ie});s.uniforms.tEquirect.value=t;const a=new lo(o,s),c=t.minFilter;return t.minFilter===nt&&(t.minFilter=et),new Mo(1,10,this).update(e,a),t.minFilter=c,a.geometry.dispose(),a.material.dispose(),this},To.prototype=Object.create(Xn.prototype),To.prototype.constructor=To,To.prototype.isDataTexture=!0;const Ao=new vi,Po=new Kn;class Lo{constructor(e,t,n,i,r,o){this.planes=[void 0!==e?e:new tr,void 0!==t?t:new tr,void 0!==n?n:new tr,void 0!==i?i:new tr,void 0!==r?r:new tr,void 0!==o?o:new tr]}lone(){return(new this.constructor).copy(this)}n Ro(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:remove:update:function(t,r){if(t.isGLBufferAttribute){var o=i.get(t);return void((!o||o.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=i.get(t);void 0===s?i.set(t,t,r)):s.version<t.version&&(s.buffer,t,r),s.version=t.version)}}}class Co extends Wr{constructor(e,t,n,i){super(),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=(e=e||1)/2,o=(t=t||1)/2,s=Math.floor(n)||1,a=Math.floor(i)||1,c=s+1,l=a+1,u=e/s,h=t/a,d=[],p=[],f=[],m=[];for(let g=0;g<l;g++){const e=g*h-o;for(let t=0;t<c;t++){const n=t*u-r;p.push(n,-e,0),f.push(0,0,1),m.push(t/s),m.push(1-g/a)}}for(let g=0;g<a;g++)for(let e=0;e<s;e++){const t=e+c*g,n=e+c*(g+1),i=e+1+c*(g+1),r=e+1+c*g;d.push(t,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new Nr(p,3)),this.setAttribute("normal",new Nr(f,3)),this.setAttribute("uv",new Nr(m,2))}}const Io={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},No={common:{diffuse:{value:new br(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Gn},uv2Transform:{value:new Gn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Hn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new br(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new br(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Gn}},sprite:{diffuse:{value:new br(15658734)},opacity:{value:1},center:{value:new Hn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Gn}}},Do={basic:{uniforms:mo([No.common,No.specularmap,No.envmap,No.aomap,No.lightmap,No.fog]),vertexShader:Io.meshbasic_vert,fragmentShader:Io.meshbasic_frag},lambert:{uniforms:mo([No.common,No.specularmap,No.envmap,No.aomap,No.lightmap,No.emissivemap,No.fog,No.lights,{emissive:{value:new br(0)}}]),vertexShader:Io.meshlambert_vert,fragmentShader:Io.meshlambert_frag},phong:{uniforms:mo([No.common,No.specularmap,No.envmap,No.aomap,No.lightmap,No.emissivemap,No.bumpmap,No.normalmap,No.displacementmap,No.fog,No.lights,{emissive:{value:new br(0)},specular:{value:new br(1118481)},shininess:{value:30}}]),vertexShader:Io.meshphong_vert,fragmentShader:Io.meshphong_frag},standard:{uniforms:mo([No.common,No.envmap,No.aomap,No.lightmap,No.emissivemap,No.bumpmap,No.normalmap,No.displacementmap,No.roughnessmap,No.metalnessmap,No.fog,No.lights,{emissive:{value:new br(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Io.meshphysical_vert,fragmentShader:Io.meshphysical_frag},toon:{uniforms:mo([No.common,No.aomap,No.lightmap,No.emissivemap,No.bumpmap,No.normalmap,No.displacementmap,No.gradientmap,No.fog,No.lights,{emissive:{value:new br(0)}}]),vertexShader:Io.meshtoon_vert,fragmentShader:Io.meshtoon_frag},matcap:{uniforms:mo([No.common,No.bumpmap,No.normalmap,No.displacementmap,No.fog,{matcap:{value:null}}]),vertexShader:Io.meshmatcap_vert,fragmentShader:Io.meshmatcap_frag},points:{uniforms:mo([No.points,No.fog]),vertexShader:Io.points_vert,fragmentShader:Io.points_frag},dashed:{uniforms:mo([No.common,No.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Io.linedashed_vert,fragmentShader:Io.linedashed_frag},depth:{uniforms:mo([No.common,No.displacementmap]),vertexShader:Io.depth_vert,fragmentShader:Io.depth_frag},normal:{uniforms:mo([No.common,No.bumpmap,No.normalmap,No.displacementmap,{opacity:{value:1}}]),vertexShader:Io.normal_vert,fragmentShader:Io.normal_frag},sprite:{uniforms:mo([No.sprite,No.fog]),vertexShader:Io.sprite_vert,fragmentShader:Io.sprite_frag},background:{uniforms:{uvTransform:{value:new Gn},t2D:{value:null}},vertexShader:Io.background_vert,fragmentShader:Io.background_frag},cube:{uniforms:mo([No.envmap,{opacity:{value:1}}]),vertexShader:Io.cube_vert,fragmentShader:Io.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Io.equirect_vert,fragmentShader:Io.equirect_frag},distanceRGBA:{uniforms:mo([No.common,No.displacementmap,{referencePosition:{value:new Kn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Io.distanceRGBA_vert,fragmentShader:Io.distanceRGBA_frag},shadow:{uniforms:mo([No.lights,No.fog,{color:{value:new br(0)},opacity:{value:1}}]),vertexShader:Io.shadow_vert,fragmentShader:Io.shadow_frag}};function zo(e,t,n,i,r){const o=new br(0);let s,a,c=0,l=null,u=0,h=null;eturn{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),c=void 0!==t?t:1,d(o,c)},getClearAlpha:function(){return c},setClearAlpha:render:function(n,r,p,f){let m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=t.get(m));const g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?d(o,c):m&&m.isColor&&(d(m,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||m.mapping===qe)?(void 0===a&&(a=new lo(new po(1,1,1),new bo({name:"BackgroundCubeMaterial",uniforms:fo(Do.cube.uniforms),vertexShader:Do.cube.vertexShader,fragmentShader:Do.cube.fragmentShader,side:te,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(a)),m.isWebGLCubeRenderTarget&&(m=m.texture),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,l===m&&u===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,l=m,u=m.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===s&&(s=new lo(new Co(2,2),new bo({name:"BackgroundMaterial",uniforms:fo(Do.background.uniforms),vertexShader:Do.background.vertexShader,fragmentShader:Do.background.fragmentShader,side:ee,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:),i.update(s)),s.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),s.material.uniforms.uvTransform.value.copy(m.matrix),l===m&&u===m.version&&h===e.toneMapping||(s.material.needsUpdate=!0,l=m,u=m.version,h=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function Uo(e,t,n,i){const r=e.getParameter(34921),o=i.isWebGL2?null:t.get("OES_vertex_array_object"),s=i.isWebGL2||null!==o,a={},c=d(null);let l=c;function u(t){return i.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}tup:function(r,c,h,y,b){let x=!1;if(s){const t=y,h,c);l!==t&&(l=t,u(l.object)),x=y,b),x&&y,b)}else{const e=!0===c.wireframe;l.geometry===y.id&&l.program===h.id&&l.wireframe===e||(l.geometry=y.id,l.program=h.id,l.wireframe=e,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==b&&n.update(b,34963),x&&(r,c,h,y),null!==b&&e.bindBuffer(34963,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:releaseStatesOfGeometry:releaseStatesOfProgram:initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}unction Fo(e,t,n){let i;onst o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:"highp";const a=r(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const c=!0===n.logarithmicDepthBuffer,l=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),p=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=u>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;const n=t.get("EXT_texture_filter_anisotropic");return i=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,i},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}unction jo(e){let t=new WeakMap;eturn{get:function(i){if(i&&i.isTexture){const r=i.mapping;if(r===Ve||r===We){if(t.has(i))return n(t.get(i).texture,i.mapping);{const r=i.image;if(r&&r.height>0){const o=e.getRenderList(),s=e.getRenderTarget(),a=e.getRenderState(),c=new Eo(r.height/2);return c.fromEquirectangularTexture(e,i),t.set(i,c),e.setRenderTarget(s),e.setRenderList(o),e.setRenderState(a),n(c.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}unction Go(e,t,n,i){const r=new WeakMap,o=new WeakMap;function s(e){const a=e.target,c=r.get(a);null!==c.index&&t.remove(c.index);for(const n in c.attributes)t.remove(c.attributes[n]);a.removeEventListener("dispose",s),r.delete(a);const l=o.get(c);l&&(t.remove(l),o.delete(c)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}eturn{get:update:getWireframeAttribute:}tion Yo(e){const t={},n=new Float32Array(8),i=[];for(let r=0;r<8;r++)i[r]=[r,0];return{update:function(r,o,s,a){const c=r.morphTargetInfluences,l=void 0===c?0:c.length;let u=t[o.id];if(void 0===u){u=[];for(let e=0;e<l;e++)u[e]=[e,0];t[o.id]=u}for(let e=0;e<l;e++){const t=u[e];t[0]=e,t[1]=c[e]}u.sort(Xo);for(let e=0;e<8;e++)e<l&&u[e][1]?(i[e][0]=u[e][0],i[e][1]=u[e][1]):(i[e][0]=Number.MAX_SAFE_INTEGER,i[e][1]=0);i.sort(qo);const h=s.morphTargets&&o.morphAttributes.position,d=s.morphNormals&&o.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=i[e],r=t[0],s=t[1];r!==Number.MAX_SAFE_INTEGER&&s?(h&&o.getAttribute("morphTarget"+e)!==h[r]&&o.setAttribute("morphTarget"+e,h[r]),d&&o.getAttribute("morphNormal"+e)!==d[r]&&o.setAttribute("morphNormal"+e,d[r]),n[e]=s,p+=s):(h&&void 0!==o.getAttribute("morphTarget"+e)&&o.deleteAttribute("morphTarget"+e),d&&void 0!==o.getAttribute("morphNormal"+e)&&o.deleteAttribute("morphNormal"+e),n[e]=0)}const f=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",f),a.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function Zo(e,t,n,i){let r=new WeakMap;return{update:dispose:function(){r=new WeakMap}}}function Jo(e,t,n,i){Xn.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=$e,this.minFilter=$e,this.wrapR=Ze,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}o.physical={uniforms:mo([Do.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Hn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new br(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Io.meshphysical_vert,fragmentShader:Io.meshphysical_frag},Jo.prototype=Object.create(Xn.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isDataTexture2DArray=!0,$o.prototype=Object.create(Xn.prototype),$o.prototype.constructor=$o,$o.prototype.isDataTexture3D=!0;const Ko=new Xn,Qo=new Jo,es=new $o,ts=new So,ns=[],is=[],rs=new Float32Array(16),os=new Float32Array(9),ss=new Float32Array(4);tion hs(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}ction ms(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(cs(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ls(n,t)}else{if(cs(n,i))return;ss.set(i),e.uniformMatrix2fv(this.addr,!1,ss),ls(n,i)}}function gs(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(cs(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ls(n,t)}else{if(cs(n,i))return;os.set(i),e.uniformMatrix3fv(this.addr,!1,os),ls(n,i)}}unction ys(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||Ko,r)}function bs(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Qo,r)}function xs(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||es,r)}unction _s(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ms(e,t){const n=this.cache;cs(n,t)||(e.uniform2iv(this.addr,t),ls(n,t))}function Ss(e,t){const n=this.cache;cs(n,t)||(e.uniform3iv(this.addr,t),ls(n,t))}nction As(e,t){e.uniform1fv(this.addr,t)}function Ps(e,t){e.uniform1iv(this.addr,t)}function Ls(e,t){e.uniform2iv(this.addr,t)}function Os(e,t){e.uniform3iv(this.addr,t)}unction Cs(e,t){const n=as(t,this.size,2);e.uniform2fv(this.addr,n)}function Is(e,t){const n=as(t,this.size,3);e.uniform3fv(this.addr,n)}unction Ds(e,t){const n=as(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function zs(e,t){const n=as(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}unction Bs(e,t,n){const i=t.length,r=us(n,i);e.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)n.safeSetTexture2D(t[o]||Ko,r[o])}rototype.updateCache=Hs.prototype.setValue=const Gs=/([\w\d_]+)(\])?(\[|\.)?/g;rototype.setValue=qs.prototype.setOptional=qs.upload=qs.seqWithValue=let Ys=0;unction Js(e,t,n){const i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+e.getShaderSource(t))}ia=/^[ \t]*#include +<([\w\d./]+)>/gm;nst sa=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,aa=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;tion da(e,t,n,i){const r=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const c=n),l=n),u=n),h=n),d=e.gammaFactor>0?e.gammaFactor:1,p=n.isWebGL2?"":n),f=o),m=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(ea).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(ea).join("\n"),v.length>0&&(v+="\n")):(g=[ha(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ea).join("\n"),v=[p,ha(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ze?"#define TONE_MAPPING":"",n.toneMapping!==ze?Io.tonemapping_pars_fragment:"",n.toneMapping!==ze?Qs("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Io.encodings_pars_fragment,n.map?$s("mapTexelToLinear",n.mapEncoding):"",n.matcap?$s("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?$s("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?$s("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?$s("lightMapTexelToLinear",n.lightMapEncoding):"",Ks("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ea).join("\n")),s=ra(s),s=ta(s,n),s=na(s,n),a=ra(a),a=ta(a,n),a=na(a,n),s=ca(s),a=ca(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===Un?"":"out highp vec4 pc_fragColor;",n.glslVersion===Un?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+v+a,x=Xs(r,35633,y+g+s),w=Xs(r,35632,b);if(r.attachShader(m,x),r.attachShader(m,w),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(m).trim(),t=r.getShaderInfoLog(x).trim(),n=r.getShaderInfoLog(w).trim();let i=!0,o=!0;if(!1===r.getProgramParameter(m,35714)){i=!1;const t=Js(r,x,"vertex"),n=Js(r,w,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(m,35715),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(o=!1);o&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:n,prefix:v}})}let _,M;return r.deleteShader(x),r.deleteShader(w),this.getUniforms=this.getAttributes=this.destroy=this.name=n.shaderName,this.id=Ys++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}function pa(e,t,n,i,r,o){const s=[],a=i.isWebGL2,c=i.logarithmicDepthBuffer,l=i.floatVertexTextures,u=i.maxVertexUniforms,h=i.vertexTextures;let d=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];eturn{getParameters:function(r,s,f,g,v){const y=g.fog,b=r.isMeshStandardMaterial?g.environment:null,x=t.get(r.envMap||b),w=p[r.type],_=v.isSkinnedMesh?v):0;let M,S;if(null!==r.precision&&(d=i.getMaxPrecision(r.precision),d!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",d,"instead.")),w){const e=Do[w];M=e.vertexShader,S=e.fragmentShader}else M=r.vertexShader,S=r.fragmentShader;const E=e.getRenderTarget();return{isWebGL2:a,shaderID:w,shaderName:r.type,vertexShader:M,fragmentShader:S,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:d,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:h,outputEncoding:null!==E?m(E.texture):e.outputEncoding,map:!!r.map,mapEncoding:m(r.map),matcap:!!r.matcap,matcapEncoding:m(r.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(x.mapping===qe||x.mapping===Xe),lightMap:!!r.lightMap,lightMapEncoding:m(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:m(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===Cn,tangentSpaceNormalMap:r.normalMapType===Rn,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmissionMap:!!r.transmissionMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmissionMap||!r.displacementMap),fog:!!y,useFog:r.fog,fogExp2:y&&y.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:c,skinning:r.skinning&&_>0,maxBones:_,useVertexTexture:l,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:ze,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===ne,flipSided:r.side===te,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:getUniforms:acquireProgram:releaseProgram:programs:s}}tion ya(e){let t=new WeakMap;return{get:function(n,i){const r=t.get(n);let o;return void 0===r?(o=new va(e),t.set(n,new WeakMap),t.get(n).set(i,o)):(o=r.get(i),void 0===o&&(o=new va(e),r.set(i,o))),o},dispose:function(){t=new WeakMap}}}et xa=0;unction _a(){const e=new ba,t=),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let s=0;s<9;s++)n.probe.push(new Kn);const i=new Kn,r=new Ti,o=new Ti;return{setup:function(s,a,c){let l=0,u=0,h=0;for(let e=0;e<9;e++)n.probe[e].set(0,0,0);let d=0,p=0,f=0,m=0,g=0,v=0,y=0,b=0;const x=c.matrixWorldInverse;s.sort(wa);for(let _=0,M=s.length;_<M;_++){const a=s[_],c=a.color,w=a.intensity,M=a.distance,S=a.shadow&&a.shadow.map?a.shadow.map.texture:null;if(a.isAmbientLight)l+=c.r*w,u+=c.g*w,h+=c.b*w;else if(a.isLightProbe)for(let e=0;e<9;e++)n.probe[e].addScaledVector(a.sh.coefficients[e],w);else if(a.isDirectionalLight){const r=e.get(a);if(r.color.copy(a.color).multiplyScalar(a.intensity),r.direction.setFromMatrixPosition(a.matrixWorld),i.setFromMatrixPosition(a.target.matrixWorld),r.direction.sub(i),r.direction.transformDirection(x),a.castShadow){const e=a.shadow,i=t.get(a);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,n.directionalShadow[d]=i,n.directionalShadowMap[d]=S,n.directionalShadowMatrix[d]=a.shadow.matrix,v++}n.directional[d]=r,d++}else if(a.isSpotLight){const r=e.get(a);if(r.position.setFromMatrixPosition(a.matrixWorld),r.position.applyMatrix4(x),r.color.copy(c).multiplyScalar(w),r.distance=M,r.direction.setFromMatrixPosition(a.matrixWorld),i.setFromMatrixPosition(a.target.matrixWorld),r.direction.sub(i),r.direction.transformDirection(x),r.coneCos=Math.cos(a.angle),r.penumbraCos=Math.cos(a.angle*(1-a.penumbra)),r.decay=a.decay,a.castShadow){const e=a.shadow,i=t.get(a);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,n.spotShadow[f]=i,n.spotShadowMap[f]=S,n.spotShadowMatrix[f]=a.shadow.matrix,b++}n.spot[f]=r,f++}else if(a.isRectAreaLight){const t=e.get(a);t.color.copy(c).multiplyScalar(w),t.position.setFromMatrixPosition(a.matrixWorld),t.position.applyMatrix4(x),o.identity(),r.copy(a.matrixWorld),r.premultiply(x),o.extractRotation(r),t.halfWidth.set(.5*a.width,0,0),t.halfHeight.set(0,.5*a.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),n.rectArea[m]=t,m++}else if(a.isPointLight){const i=e.get(a);if(i.position.setFromMatrixPosition(a.matrixWorld),i.position.applyMatrix4(x),i.color.copy(a.color).multiplyScalar(a.intensity),i.distance=a.distance,i.decay=a.decay,a.castShadow){const e=a.shadow,i=t.get(a);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,n.pointShadow[p]=i,n.pointShadowMap[p]=S,n.pointShadowMatrix[p]=a.shadow.matrix,y++}n.point[p]=i,p++}else if(a.isHemisphereLight){const t=e.get(a);t.direction.setFromMatrixPosition(a.matrixWorld),t.direction.transformDirection(x),t.direction.normalize(),t.skyColor.copy(a.color).multiplyScalar(w),t.groundColor.copy(a.groundColor).multiplyScalar(w),n.hemi[g]=t,g++}}m>0&&(n.rectAreaLTC1=No.LTC_1,n.rectAreaLTC2=No.LTC_2),n.ambient[0]=l,n.ambient[1]=u,n.ambient[2]=h;const w=n.hash;w.directionalLength===d&&w.pointLength===p&&w.spotLength===f&&w.rectAreaLength===m&&w.hemiLength===g&&w.numDirectionalShadows===v&&w.numPointShadows===y&&w.numSpotShadows===b||(n.directional.length=d,n.spot.length=f,n.rectArea.length=m,n.point.length=p,n.hemi.length=g,n.directionalShadow.length=v,n.directionalShadowMap.length=v,n.pointShadow.length=y,n.pointShadowMap.length=y,n.spotShadow.length=b,n.spotShadowMap.length=b,n.directionalShadowMatrix.length=v,n.pointShadowMatrix.length=y,n.spotShadowMatrix.length=b,w.directionalLength=d,w.pointLength=p,w.spotLength=f,w.rectAreaLength=m,w.hemiLength=g,w.numDirectionalShadows=v,w.numPointShadows=y,w.numSpotShadows=b,n.version=xa++)},state:n}}unction Sa(){let e=new WeakMap;return{get:dispose:}.prototype=Object.create(_r.prototype),Ea.prototype.constructor=Ea,Ea.prototype.isMeshDepthMaterial=!0,Ea.prototype.copy=Ta.prototype=Object.create(_r.prototype),Ta.prototype.constructor=Ta,Ta.prototype.isMeshDistanceMaterial=!0,Ta.prototype.copy=var Aa="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",Pa="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function La(e,t,n){let i=new Lo;const r=new Hn,o=new Hn,s=new Yn,a=[],c=[],l={},u={0:te,1:ee,2:ne},h=new bo({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Hn},radius:{value:4}},vertexShader:Pa,fragmentShader:Aa}),d=h.clone();d.defines.HORIZONAL_PASS=1;const p=new Wr;p.setAttribute("position",new Tr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new lo(p,h),m=this;unction v(e,t,n){const i=e<<0|t<<1|n<<2;let r=a[i];return void 0===r&&(r=new Ea({depthPacking:On,morphTargets:e,skinning:t}),a[i]=r),r}unction b(t,n,i,r,o,s,a){let c=null,h=v,d=t.customDepthMaterial;if(!0===r.isPointLight&&(h=y,d=t.customDistanceMaterial),void 0===d){let e=!1;!0===i.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let r=!1;!0===t.isSkinnedMesh&&(!0===i.skinning?r=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),c=h(e,r,!0===t.isInstancedMesh)}else c=d;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const e=c.uuid,t=i.uuid;let n=l[e];void 0===n&&(n={},l[e]=n);let r=n[t];void 0===r&&(r=c.clone(),n[t]=r),c=r}return c.visible=i.visible,c.wireframe=i.wireframe,c.side=a===Q?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,!0===r.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(r.matrixWorld),c.nearDistance=o,c.farDistance=s),c}function x(n,r,o,s,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===Q)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let c=0,l=t.length;c<l;c++){const l=t[c],u=r[l.materialIndex];if(u&&u.visible){const t=b(n,i,u,s,o.near,o.far,a);e.renderBufferDirect(o,null,i,t,n,l)}}}else if(r.visible){const t=b(n,i,r,s,o.near,o.far,a);e.renderBufferDirect(o,null,i,t,n,null)}}const c=n.children;for(let e=0,t=c.length;e<t;e++)x(c[e],r,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=$,this.render=function(t,a,c){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),u=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(ie),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let p=0,f=t.length;p<f;p++){const l=t[p],u=l.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const h=u.getFrameExtents();if(r.multiply(h),o.copy(u.mapSize),(r.x>n||r.y>n)&&(r.x>n&&(o.x=Math.floor(n/h.x),r.x=o.x*h.x,u.mapSize.x=o.x),r.y>n&&(o.y=Math.floor(n/h.y),r.y=o.y*h.y,u.mapSize.y=o.y)),null===u.map&&!u.isPointLightShadow&&this.type===Q){const e={minFilter:et,magFilter:et,format:vt};u.map=new Zn(r.x,r.y,e),u.map.texture.name=l.name+".shadowMap",u.mapPass=new Zn(r.x,r.y,e),u.camera.updateProjectionMatrix()}if(null===u.map){const e={minFilter:$e,magFilter:$e,format:vt};u.map=new Zn(r.x,r.y,e),u.map.texture.name=l.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const f=u.getViewportCount();for(let e=0;e<f;e++){const t=u.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),d.viewport(s),u.updateMatrices(l,e),i=u.getFrustum(),x(a,c,u.camera,l,this.type)}u.isPointLightShadow||this.type!==Q||g(u,c),u.needsUpdate=!1}m.needsUpdate=!1,e.setRenderTarget(l,u,h)}}function Oa(e,t,n){const i=n.isWebGL2,r=new o=new s=new let a={},c=null,l=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,v=!1,y=null,b=null,x=null,w=null,_=null;const M=e.getParameter(35661);let S=!1,E=0;const T=e.getParameter(7938);-1!==T.indexOf("WebGL")?(E=parseFloat(/^WebGL\ ([0-9])/.exec(T)[1]),S=E>=1):-1!==T.indexOf("OpenGL ES")&&(E=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(T)[1]),S=E>=2);let A=null,P={};const L=new Yn,O=new Yn;onst C={};function I(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}[3553]=R(3553,3553,1),C[34067]=R(34067,34069,6),r.setClear(0,0,0,1),o.setClear(1),s.setClear(0),I(2929),o.setFunc(Pe),B(!1),F(Z),I(2884),U(ie);const D={[le]:32774,[ue]:32778,[he]:32779};if(i)D[de]=32775,D[pe]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(D[de]=e.MIN_EXT,D[pe]=e.MAX_EXT)}const z={[fe]:0,[me]:1,[ge]:768,[ye]:770,[Se]:776,[_e]:774,[xe]:772,[ve]:769,[be]:771,[Me]:775,[we]:773};n{buffers:{color:r,depth:o,stencil:s},enable:I,disable:N,useProgram:setBlending:U,setMaterial:setFlipSided:B,setCullFace:F,setLineWidth:setPolygonOffset:k,setScissorTest:activeTexture:j,bindTexture:unbindTexture:compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:scissor:function(t){!1===L.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),L.copy(t))},viewport:reset:}function Ra(e,t,n,i,r,o,s){const a=r.isWebGL2,c=r.maxTextures,l=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}nction T(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?function(t,i,r){if(6!==i.image.length)return;O(t,i),n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,i.flipY);const s=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),c=i.image[0]&&i.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=s||c?c?i.image[e].image:i.image[e]:g(i.image[e],!1,!0,l);const h=u[0],d=v(h)||a,p=o.convert(i.format),f=o.convert(i.type),m=x(i.internalFormat,p,f);let w;if(L(34067,i,d),s){for(let e=0;e<6;e++){w=u[e].mipmaps;for(let t=0;t<w.length;t++){const r=w[t];i.format!==vt&&i.format!==gt?null!==p?n.compressedTexImage2D(34069+e,t,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+e,t,m,r.width,r.height,0,p,f,r.data)}}t.__maxMipLevel=w.length-1}else{w=i.mipmaps;for(let e=0;e<6;e++)if(c){n.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,p,f,u[e].data);for(let t=0;t<w.length;t++){const i=w[t].image[e].image;n.texImage2D(34069+e,t+1,m,i.width,i.height,0,p,f,i.data)}}else{n.texImage2D(34069+e,0,m,p,f,u[e]);for(let t=0;t<w.length;t++){const i=w[t];n.texImage2D(34069+e,t+1,m,p,f,i.image[e])}}t.__maxMipLevel=w.length}y(i,d)&&b(34067,i,h.width,h.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(s,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,s.__webglTexture))}const A={[Ye]:10497,[Ze]:33071,[Je]:33648},P={[$e]:9728,[Ke]:9984,[Qe]:9986,[et]:9729,[tt]:9985,[nt]:9987};nction R(t,i,r){let s=3553;i.isDataTexture2DArray&&(s=35866),i.isDataTexture3D&&(s=32879),O(t,i),n.activeTexture(33984+r),n.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment);const c=i)&&!1===v(i.image),l=g(i.image,c,!1,u),h=v(l)||a,d=o.convert(i.format);let p,f=o.convert(i.type),m=x(i.internalFormat,d,f);L(s,i,h);const w=i.mipmaps;if(i.isDepthTexture)m=6402,a?m=i.type===lt?36012:i.type===ct?33190:i.type===ft?35056:33189:i.type===lt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===xt&&6402===m&&i.type!==st&&i.type!==ct&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=st,f=o.convert(i.type)),i.format===wt&&6402===m&&(m=34041,i.type!==ft&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=ft,f=o.convert(i.type))),n.texImage2D(3553,0,m,l.width,l.height,0,d,f,null);else if(i.isDataTexture)if(w.length>0&&h){for(let e=0,t=w.length;e<t;e++)p=w[e],n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,l.width,l.height,0,d,f,l.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(let e=0,t=w.length;e<t;e++)p=w[e],i.format!==vt&&i.format!==gt?null!==d?n.compressedTexImage2D(3553,e,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);t.__maxMipLevel=w.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,l.width,l.height,l.depth,0,d,f,l.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,l.width,l.height,l.depth,0,d,f,l.data),t.__maxMipLevel=0;else if(w.length>0&&h){for(let e=0,t=w.length;e<t;e++)p=w[e],n.texImage2D(3553,e,m,d,f,p);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,d,f,l),t.__maxMipLevel=0;y(i,h)&&b(s,i,l.width,l.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)} D=!1,z=!1;this.allocateTextureUnit=this.resetTextureUnits=this.setTexture2D=E,this.setTexture2DArray=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?R(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=this.setTextureCube=T,this.setupRenderTarget=function(t){const r=i.get(t),c=i.get(t.texture);t.addEventListener("dispose",M),c.__webglTexture=e.createTexture(),s.memory.textures++;const l=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultisampleRenderTarget,h=v(t)||a;if(!a||t.texture.format!==gt||t.texture.type!==lt&&t.texture.type!==ut||(t.texture.format=vt,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){r.__webglFramebuffer=[];for(let t=0;t<6;t++)r.__webglFramebuffer[t]=e.createFramebuffer()}else if(r.__webglFramebuffer=e.createFramebuffer(),u)if(a){r.__webglMultisampledFramebuffer=e.createFramebuffer(),r.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,r.__webglColorRenderbuffer);const n=o.convert(t.texture.format),i=o.convert(t.texture.type),s=x(t.texture.internalFormat,n,i),a=N(t);e.renderbufferStorageMultisample(36161,a,s,t.width,t.height),e.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(r.__webglDepthRenderbuffer=e.createRenderbuffer(),I(r.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(34067,c.__webglTexture),L(34067,t.texture,h);for(let e=0;e<6;e++)C(r.__webglFramebuffer[e],t,36064,34069+e);y(t.texture,h)&&b(34067,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,c.__webglTexture),L(3553,t.texture,h),C(r.__webglFramebuffer,t,36064,3553),y(t.texture,h)&&b(3553,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&function(t){const n=i.get(t),r=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!n.__webglFramebuffer,t)}else if(r){n.__webglDepthbuffer=[];for(let i=0;i<6;i++)e.bindFramebuffer(36160,n.__webglFramebuffer[i]),n.__webglDepthbuffer[i]=e.createRenderbuffer(),I(n.__webglDepthbuffer[i],t,!1)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),I(n.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const n=i.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);const r=t.width,o=t.height;let s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024),e.blitFramebuffer(0,0,r,o,0,0,r,o,s,9728),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),D=!0),e=e.texture),E(e,t)},this.safeSetTextureCube=function Ca(e,t,n){const i=n.isWebGL2;return{convert:function(e){let n;if(e===it)return 5121;if(e===ht)return 32819;if(e===dt)return 32820;if(e===pt)return 33635;if(e===rt)return 5120;if(e===ot)return 5122;if(e===st)return 5123;if(e===at)return 5124;if(e===ct)return 5125;if(e===lt)return 5126;if(e===ut)return i?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(e===mt)return 6406;if(e===gt)return 6407;if(e===vt)return 6408;if(e===yt)return 6409;if(e===bt)return 6410;if(e===xt)return 6402;if(e===wt)return 34041;if(e===_t)return 6403;if(e===Mt)return 36244;if(e===St)return 33319;if(e===Et)return 33320;if(e===Tt)return 36248;if(e===At)return 36249;if(e===Pt||e===Lt||e===Ot||e===Rt){if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(e===Pt)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Lt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Ot)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Rt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Ct||e===It||e===Nt||e===Dt){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(e===Ct)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===It)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Nt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Dt)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===zt)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===Ut||e===Bt)&&(n=t.get("WEBGL_compressed_texture_etc"),null!==n)){if(e===Ut)return n.COMPRESSED_RGB8_ETC2;if(e===Bt)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===Ft||e===kt||e===jt||e===Ht||e===Gt||e===Vt||e===Wt||e===qt||e===Xt||e===Yt||e===Zt||e===Jt||e===$t||e===Kt||e===en||e===tn||e===nn||e===rn||e===on||e===sn||e===an||e===cn||e===ln||e===un||e===hn||e===dn||e===pn||e===fn?(n=t.get("WEBGL_compressed_texture_astc"),null!==n?e:null):e===Qt?(n=t.get("EXT_texture_compression_bptc"),null!==n?e:null):e===ft?i?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}unction Na(){$i.call(this),this.type="Group"}unction za(e,t){const n=this;let i=null,r=1,o=null,s="local-floor",a=null;const c=[],l=new Map,u=new wo;u.layers.enable(1),u.viewport=new Yn;const h=new wo;h.layers.enable(2),h.viewport=new Yn;const d=[u,h],p=new Ia;p.layers.enable(1),p.layers.enable(2);let f=null,m=null;.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new Da,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new Da,c[e]=t),t.getGripSpace()},this.getHand=this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=this.getReferenceSpace=function(){return o},this.getSession=function(){return i},this.setSession=function(e){if(i=e,null!==i){i.addEventListener("select",g),i.addEventListener("selectstart",g),i.addEventListener("selectend",g),i.addEventListener("squeeze",g),i.addEventListener("squeezestart",g),i.addEventListener("squeezeend",g),i.addEventListener("end",v);const e=t.getContextAttributes();!0!==e.xrCompatible&&t.makeXRCompatible();const n={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:r},o=new XRWebGLLayer(i,t,n);i.updateRenderState({baseLayer:o}),i.requestReferenceSpace(s).then(y),i.addEventListener("inputsourceschange",b)}};const x=new Kn,w=new Kn;his.getCamera=function(e){p.near=h.near=u.near=e.near,p.far=h.far=u.far=e.far,f===p.near&&m===p.far||(i.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,m=p.far);const t=e.parent,n=p.cameras;_(p,t);for(let i=0;i<n.length;i++)_(n[i],t);e.matrixWorld.copy(p.matrixWorld);const r=e.children;for(let i=0,o=r.length;i<o;i++)r[i].updateMatrixWorld(!0);return 2===n.length?p,u,h):p.projectionMatrix.copy(u.projectionMatrix),p};let M=null;const S=new Oo;S.setAnimationLoop((function(t,n){if(a=n.getViewerPose(o),null!==a){const t=a.views,n=i.renderState.baseLayer;e.setFramebuffer(n.framebuffer);let r=!1;t.length!==p.cameras.length&&(p.cameras.length=0,r=!0);for(let e=0;e<t.length;e++){const i=t[e],o=n.getViewport(i),s=d[e];s.matrix.fromArray(i.transform.matrix),s.projectionMatrix.fromArray(i.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===e&&p.matrix.copy(s.matrix),!0===r&&p.cameras.push(s)}}const r=i.inputSources;for(let e=0;e<c.length;e++){const t=c[e],i=r[e];t.update(i,n,o)}M&&M(t,n)})),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}function Ua(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const i=e.get(n).envMap;if(i){t.envMap.value=i,t.flipEnvMap.value=i.isCubeTexture&&i._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const r=e.get(i).__maxMipLevel;void 0!==r&&(t.maxMipLevel.value=r)}let r,o;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(r=n.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===te&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===te&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:refreshMaterialUniforms:function(e,i,r,o){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===te&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===te&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===te&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===te&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===te&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,i):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===te&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===te&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),e,i)):i.isMeshDistanceMaterial?(t(e,i),e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===te&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===te&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(e,i),i.isLineDashedMaterial&&e,i)):i.isPointsMaterial?e,i,r,o):i.isSpriteMaterial?e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Ba(e){const t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,d=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=wn,this.physicallyCorrectLights=!1,this.toneMapping=ze,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const p=this;let f=!1,m=null,g=0,v=0,y=null,b=null,x=-1,w=null,_=null;const M=new Yn,S=new Yn;let E=null,T=t.width,A=t.height,P=1,L=null,O=null;const R=new Yn(0,0,T,A),C=new Yn(0,0,T,A);let I=!1;const N=new Lo;let D=!1,z=!1;const U=new Ti,B=new Kn,F={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};et j,H,G,V,W,q,X,Y,Z,J,$,K,Q,ee,te,ne,ie,re,oe,se,ae,ce=n;ry{const e={alpha:i,depth:r,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",pe,!1),t.addEventListener("webglcontextrestored",fe,!1),null===ce){const t=["webgl2","webgl","experimental-webgl"];if(!0===p.isWebGL1Renderer&&t.shift(),ce=le(t,e),null===ce)throw le(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ce.getShaderPrecisionFormat&&(ce.getShaderPrecisionFormat=}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ue(){j=new Ho(ce),H=new Fo(ce,j,e),!1===H.isWebGL2&&(j.get("WEBGL_depth_texture"),j.get("OES_texture_float"),j.get("OES_texture_half_float"),j.get("OES_texture_half_float_linear"),j.get("OES_standard_derivatives"),j.get("OES_element_index_uint"),j.get("OES_vertex_array_object"),j.get("ANGLE_instanced_arrays")),j.get("OES_texture_float_linear"),se=new Ca(ce,j,H),G=new Oa(ce,j,H),G.scissor(S.copy(C).multiplyScalar(P).floor()),G.viewport(M.copy(R).multiplyScalar(P).floor()),V=new Wo,W=new fa,q=new Ra(ce,j,G,W,H,se,V),X=new jo(p),Y=new Ro(ce,H),ae=new Uo(ce,j,Y,H),Z=new Go(ce,Y,V,ae),J=new Zo(ce,Z,Y,V),ie=new Yo(ce),te=new ko(W),$=new pa(p,X,j,H,ae,te),K=new Ua(W),Q=new ya(W),ee=new Sa,ne=new zo(p,X,G,J,a),re=new Bo(ce,j,V,H),oe=new Vo(ce,j,V,H),V.programs=$.programs,p.capabilities=H,p.extensions=j,p.properties=W,p.renderLists=Q,p.state=G,p.info=V}ue();const he=new za(p,ce);this.xr=he;const de=new La(p,J,H.maxTextureSize);.shadowMap=de,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const e=j.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=this.getPixelRatio=function(){return P},this.setPixelRatio=this.getSize=this.setSize=this.getDrawingBufferSize=this.setDrawingBufferSize=this.getCurrentViewport=this.getViewport=function(e){return e.copy(R)},this.setViewport=function(e,t,n,i){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,n,i),G.viewport(M.copy(R).multiplyScalar(P).floor())},this.getScissor=this.setScissor=this.getScissorTest=function(){return I},this.setScissorTest=this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){O=e},this.getClearColor=function(){return ne.getClearColor()},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=this.setClearAlpha=this.clear=this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=this.dispose=this.renderBufferImmediate=this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=F);const s=r.isMesh&&r.matrixWorld.determinant()<0,a=Me(e,t,i,r);G.setMaterial(i,s);let c=n.index;const l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;let u,h=1;!0===i.wireframe&&(c=Z.getWireframeAttribute(n),h=2),(i.morphTargets||i.morphNormals)&&ie.update(r,n,i,a),ae.setup(r,i,a,n,c);let d=re;null!==c&&(u=Y.get(c),d=oe,d.setIndex(u));const p=null!==c?c.count:l.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(f,g),b=Math.min(p,f+m,g+v)-1,x=Math.max(0,b-y+1);if(0!==x){if(r.isMesh)!0===i.wireframe?(G.setLineWidth(i.wireframeLinewidth*k()),d.setMode(1)):d.setMode(4);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),G.setLineWidth(e*k()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(y,x,r.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,x,e)}else d.render(y,x)}},this.compile=function(e,t){d=ee.get(e,t),d.init(),e.traverse((),d.setupLights(t);const n=new WeakMap;e.traverse(()};let ve=null;const ye=new Oo;unction xe(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,o=e.length;r<o;r++){const o=e[r],s=o.object,a=o.geometry,c=null===i?o.material:i,l=o.group;if(n.isArrayCamera){_=n;const e=n.cameras;for(let n=0,i=e.length;n<i;n++){const i=e[n];s.layers.test(i.layers)&&(G.viewport(M.copy(i.viewport)),d.setupLights(i),we(s,t,i,a,c,l))}}else _=null,we(s,t,n,a,c,l)}}unction _e(e,t,n){!0!==t.isScene&&(t=F);const i=W.get(e),r=d.state.lights,o=d.state.shadowsArray,s=r.state.version,a=$.getParameters(e,r.state,o,t,n),c=$.getProgramCacheKey(a);let l=i.program,u=!0;if(void 0===l)e.addEventListener("dispose",me);else if(l.cacheKey!==c)ge(e);else if(i.lightsStateVersion!==s)u=!1;else{if(void 0!==a.shaderID){const n=e.isMeshStandardMaterial?t.environment:null;return void(i.envMap=X.get(e.envMap||n))}u=!1}u&&(a.uniforms=$.getUniforms(e),e.onBeforeCompile(a,p),l=$.acquireProgram(a,c),i.program=l,i.uniforms=a.uniforms,i.outputEncoding=a.outputEncoding);const h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(i.numClippingPlanes=te.numPlanes,i.numIntersection=te.numIntersection,h.clippingPlanes=te.uniform),i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=X.get(e.envMap||i.environment),i.needsLights=e),i.lightsStateVersion=s,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const f=i.program.getUniforms(),m=qs.seqWithValue(f.seq,h);i.uniformsList=m}function Me(e,t,n,i){!0!==t.isScene&&(t=F),q.resetTextureUnits();const r=t.fog,o=n.isMeshStandardMaterial?t.environment:null,s=null===y?p.outputEncoding:y.texture.encoding,a=X.get(n.envMap||o),c=W.get(n),l=d.state.lights;if(!0===D&&(!0===z||e!==w)){const t=e===w&&n.id===x;te.setState(n,e,t)}n.version===c.__version?n.fog&&c.fog!==r||c.environment!==o||c.needsLights&&c.lightsStateVersion!==l.state.version?_e(n,t,i):void 0===c.numClippingPlanes||c.numClippingPlanes===te.numPlanes&&c.numIntersection===te.numIntersection?(c.outputEncoding!==s||c.envMap!==a)&&_e(n,t,i):_e(n,t,i):(_e(n,t,i),c.__version=n.version);let u=!1,h=!1,f=!1;const m=c.program,g=m.getUniforms(),v=c.uniforms;if(G.useProgram(m.program)&&(u=!0,h=!0,f=!0),n.id!==x&&(x=n.id,h=!0),u||w!==e){if(g.setValue(ce,"projectionMatrix",e.projectionMatrix),H.logarithmicDepthBuffer&&g.setValue(ce,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,h=!0,f=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=g.map.cameraPosition;void 0!==t&&t.setValue(ce,B.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&g.setValue(ce,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&g.setValue(ce,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){g.setOptional(ce,i,"bindMatrix"),g.setOptional(ce,i,"bindMatrixInverse");const e=i.skeleton;if(e){const t=e.bones;if(H.floatVertexTextures){if(void 0===e.boneTexture){let n=Math.sqrt(4*t.length);n=jn.ceilPowerOfTwo(n),n=Math.max(n,4);const i=new Float32Array(n*n*4);i.set(e.boneMatrices);const r=new To(i,n,n,vt,lt);e.boneMatrices=i,e.boneTexture=r,e.boneTextureSize=n}g.setValue(ce,"boneTexture",e.boneTexture,q),g.setValue(ce,"boneTextureSize",e.boneTextureSize)}else g.setOptional(ce,e,"boneMatrices")}}var b,_;return(h||c.receiveShadow!==i.receiveShadow)&&(c.receiveShadow=i.receiveShadow,g.setValue(ce,"receiveShadow",i.receiveShadow)),h&&(g.setValue(ce,"toneMappingExposure",p.toneMappingExposure),c.needsLights&&(_=f,(b=v).ambientLightColor.needsUpdate=_,b.lightProbe.needsUpdate=_,b.directionalLights.needsUpdate=_,b.directionalLightShadows.needsUpdate=_,b.pointLights.needsUpdate=_,b.pointLightShadows.needsUpdate=_,b.spotLights.needsUpdate=_,b.spotLightShadows.needsUpdate=_,b.rectAreaLights.needsUpdate=_,b.hemisphereLights.needsUpdate=_),r&&n.fog&&K.refreshFogUniforms(v,r),K.refreshMaterialUniforms(v,n,P,A),qs.upload(ce,c.uniformsList,v,q)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(qs.upload(ce,c.uniformsList,v,q),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&g.setValue(ce,"center",i.center),g.setValue(ce,"modelViewMatrix",i.modelViewMatrix),g.setValue(ce,"normalMatrix",i.normalMatrix),g.setValue(ce,"modelMatrix",i.matrixWorld),m}ye.setAnimationLoop((),"undefined"!=typeof window&&ye.setContext(window),this.setAnimationLoop=this.render=function(e,t){let n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===f)return;ae.resetDefaultState(),x=-1,w=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===he.enabled&&!0===he.isPresenting&&(t=he.getCamera(t)),!0===e.isScene&&e.onBeforeRender(p,e,t,n||y),d=ee.get(e,t),d.init(),U.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromProjectionMatrix(U),z=this.localClippingEnabled,D=te.init(this.clippingPlanes,z,t),h=Q.get(e,t),h.init(),be(e,t,0,p.sortObjects),h.finish(),!0===p.sortObjects&&h.sort(L,O),!0===D&&te.beginShadows();const r=d.state.shadowsArray;de.render(r,e,t),d.setupLights(t),!0===D&&te.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),ne.render(h,e,t,i);const o=h.opaque,s=h.transparent;o.length>0&&xe(o,e,t),s.length>0&&xe(s,e,t),!0===e.isScene&&e.onAfterRender(p,e,t),null!==y&&(q.updateRenderTargetMipmap(y),q.updateMultisampleRenderTarget(y)),G.buffers.depth.setTest(!0),G.buffers.depth.setMask(!0),G.buffers.color.setMask(!0),G.setPolygonOffset(!1),h=null,d=null},this.setFramebuffer=this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return v},this.getRenderList=function(){return h},this.setRenderList=function(e){h=e},this.getRenderState=function(){return d},this.setRenderState=this.getRenderTarget=function(){return y},this.setRenderTarget=function(e,t=0,n=0){y=e,g=t,v=n,e&&void 0===W.get(e).__webglFramebuffer&&q.setupRenderTarget(e);let i=m,r=!1;if(e){const n=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=n[t],r=!0):i=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:n,M.copy(e.viewport),S.copy(e.scissor),E=e.scissorTest}else M.copy(R).multiplyScalar(P).floor(),S.copy(C).multiplyScalar(P).floor(),E=I;if(b!==i&&(ce.bindFramebuffer(36160,i),b=i),G.viewport(M),G.scissor(S),G.setScissorTest(E),r){const i=W.get(e.texture);ce.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}},this.readRenderTargetPixels=function(e,t,n,i,r,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){let s=!1;a!==b&&(ce.bindFramebuffer(36160,a),s=!0);try{const s=e.texture,a=s.format,c=s.type;if(a!==vt&&se.convert(a)!==ce.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===it||se.convert(c)===ce.getParameter(35738)||c===lt&&(H.isWebGL2||j.get("OES_texture_float")||j.get("WEBGL_color_buffer_float"))||c===ut&&(H.isWebGL2?j.get("EXT_color_buffer_float"):j.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ce.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ce.readPixels(t,n,i,r,se.convert(a),se.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&ce.bindFramebuffer(36160,b)}}},this.copyFramebufferToTexture=this.copyTextureToTexture=this.initTexture="undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}a.prototype=Object.assign(Object.create(wo.prototype),{constructor:Ia,isArrayCamera:!0}),Na.prototype=Object.assign(Object.create($i.prototype),{constructor:Na,isGroup:!0}),Object.assign(Da.prototype,{constructor:Da,getHandSpace:getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Na,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:dispatchEvent:disconnect:update:function(e,t,n){let i=null,r=null,o=null;const s=this._targetRay,a=this._grip,c=this._hand;if(e)if(c&&e.hand){o=!0;for(let i=0;i<=window.XRHand.LITTLE_PHALANX_TIP;i++)if(e.hand[i]){const r=t.getJointPose(e.hand[i],n),o=c.joints[i];null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.jointRadius=r.radius),o.visible=null!==r;const s=c.joints[window.XRHand.INDEX_PHALANX_TIP],a=c.joints[window.XRHand.THUMB_PHALANX_TIP],l=s.position.distanceTo(a.position),u=.02,h=.005;c.inputState.pinching&&l>u+h?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&l<=u-h&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}}else null!==s&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale))),null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==s&&(s.visible=null!==i),null!==a&&(a.visible=null!==r),null!==c&&(c.visible=null!==o),this}}),Object.assign(za.prototype,Bn.prototype),Fa.prototype=Object.assign(Object.create(Ba.prototype),{constructor:Fa,isWebGL1Renderer:!0});class ka extends $i{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}ject.defineProperty(ja.prototype,"needsUpdate",{set:),Object.assign(ja.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:copyAt:set:clone:onUpload:toJSON:);const Ha=new Kn;unction Va(e){_r.call(this),this.type="SpriteMaterial",this.color=new br(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}let Wa;Object.defineProperties(Ga.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:}),Object.assign(Ga.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:setX:setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:getX:getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:setXY:setXYZ:setXYZW:clone:toJSON:),Va.prototype=Object.create(_r.prototype),Va.prototype.constructor=Va,Va.prototype.isSpriteMaterial=!0,Va.prototype.copy=function(e){return _r.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};const qa=new Kn,Xa=new Kn,Ya=new Kn,Za=new Hn,Ja=new Hn,$a=new Ti,Ka=new Kn,Qa=new Kn,ec=new Kn,tc=new Hn,nc=new Hn,ic=new Hn;.prototype=Object.assign(Object.create($i.prototype),{constructor:rc,isSprite:!0,raycast:copy:);const sc=new Kn,ac=new Kn;.prototype=Object.assign(Object.create($i.prototype),{constructor:cc,isLOD:!0,copy:function(e){$i.prototype.copy.call(this,e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:getObjectForDistance:raycast:update:toJSON:function(e){const t=$i.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const e=n[i];t.object.levels.push({object:e.object.uuid,distance:e.distance})}return t}}),lc.prototype=Object.assign(Object.create(lo.prototype),{constructor:lc,isSkinnedMesh:!0,copy:bind:pose:normalizeSkinWeights:updateMatrixWorld:boneTransform:function(){const e=new Kn,t=new Yn,n=new Yn,i=new Kn,r=new Ti;return ()});const uc=new Ti,hc=new Ti;ject.assign(dc.prototype,{calculateInverses:pose:update:function(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const i=e[r]?e[r].matrixWorld:hc;uc.multiplyMatrices(i,t[r]),uc.toArray(n,16*r)}void 0!==i&&(i.needsUpdate=!0)},clone:getBoneByName:dispose:),pc.prototype=Object.assign(Object.create($i.prototype),{constructor:pc,isBone:!0});const fc=new Ti,mc=new Ti,gc=[],vc=new lo;.prototype=Object.assign(Object.create(lo.prototype),{constructor:yc,isInstancedMesh:!0,copy:setColorAt:getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:setMatrixAt:updateMorphTargets:),bc.prototype=Object.create(_r.prototype),bc.prototype.constructor=bc,bc.prototype.isLineBasicMaterial=!0,bc.prototype.copy=const xc=new Kn,wc=new Kn,_c=new Ti,Mc=new Ei,Sc=new vi;c.prototype=Object.assign(Object.create($i.prototype),{constructor:Ec,isLine:!0,copy:function(e){return $i.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)xc.fromBufferAttribute(t,e-1),wc.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=xc.distanceTo(wc);e.setAttribute("lineDistance",new Nr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,n=e.lineDistances;n[0]=0;for(let e=1,i=t.length;e<i;e++)n[e]=n[e-1],n[e]+=t[e-1].distanceTo(t[e])}return this},raycast:function(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Sc.copy(n.boundingSphere),Sc.applyMatrix4(i),Sc.radius+=r,!1===e.ray.intersectsSphere(Sc))return;_c.getInverse(i),Mc.copy(e.ray).applyMatrix4(_c);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,a=new Kn,c=new Kn,l=new Kn,u=new Kn,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position;if(null!==i){const n=i.array;for(let i=0,o=n.length-1;i<o;i+=h){const o=n[i],h=n[i+1];if(a.fromBufferAttribute(r,o),c.fromBufferAttribute(r,h),Mc.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(u);d<e.near||d>e.far||t.push({distance:d,point:l.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else for(let n=0,o=r.count-1;n<o;n+=h){if(a.fromBufferAttribute(r,n),c.fromBufferAttribute(r,n+1),Mc.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const i=n.vertices,r=i.length;for(let n=0;n<r-1;n+=h){if(Mc.distanceSqToSegment(i[n],i[n+1],u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(u);r<e.near||r>e.far||t.push({distance:r,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Tc=new Kn,Ac=new Kn;function Pc(e,t){Ec.call(this,e,t),this.type="LineSegments"}.prototype=Object.assign(Object.create(Ec.prototype),{constructor:Pc,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)Tc.fromBufferAttribute(t,e),Ac.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Tc.distanceTo(Ac);e.setAttribute("lineDistance",new Nr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,n=e.lineDistances;for(let e=0,i=t.length;e<i;e+=2)Tc.copy(t[e]),Ac.copy(t[e+1]),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Tc.distanceTo(Ac)}return this}}),Lc.prototype=Object.assign(Object.create(Ec.prototype),{constructor:Lc,isLineLoop:!0}),Oc.prototype=Object.create(_r.prototype),Oc.prototype.constructor=Oc,Oc.prototype.isPointsMaterial=!0,Oc.prototype.copy=const Rc=new Ti,Cc=new Ei,Ic=new vi,Nc=new Kn;totype=Object.assign(Object.create($i.prototype),{constructor:Dc,isPoints:!0,copy:raycast:function(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ic.copy(n.boundingSphere),Ic.applyMatrix4(i),Ic.radius+=r,!1===e.ray.intersectsSphere(Ic))return;Rc.getInverse(i),Cc.copy(e.ray).applyMatrix4(Rc);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position;if(null!==r){const n=r.array;for(let r=0,a=n.length;r<a;r++){const a=n[r];Nc.fromBufferAttribute(o,a),zc(Nc,a,s,i,e,t,this)}}else for(let n=0,a=o.count;n<a;n++)Nc.fromBufferAttribute(o,n),zc(Nc,n,s,i,e,t,this)}else{const r=n.vertices;for(let n=0,o=r.length;n<o;n++)zc(r[n],n,s,i,e,t,this)}},updateMorphTargets:),Uc.prototype=Object.assign(Object.create(Xn.prototype),{constructor:Uc,isVideoTexture:!0,update:),Bc.prototype=Object.create(Xn.prototype),Bc.prototype.constructor=Bc,Bc.prototype.isCompressedTexture=!0,Fc.prototype=Object.create(Xn.prototype),Fc.prototype.constructor=Fc,Fc.prototype.isCanvasTexture=!0,kc.prototype=Object.create(Xn.prototype),kc.prototype.constructor=kc,kc.prototype.isDepthTexture=!0;let jc=0;const Hc=new Ti,Gc=new $i,Vc=new Kn;c.prototype=Object.assign(Object.create(Bn.prototype),{constructor:Wc,isGeometry:!0,applyMatrix4:function(e){const t=(new Gn).getNormalMatrix(e);for(let n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(e);for(let n=0,i=this.faces.length;n<i;n++){const e=this.faces[n];e.normal.applyMatrix3(t).normalize();for(let n=0,i=e.vertexNormals.length;n<i;n++)e.vertexNormals[n].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Hc.makeRotationX(e),this.applyMatrix4(Hc),this},rotateY:function(e){return Hc.makeRotationY(e),this.applyMatrix4(Hc),this},rotateZ:translate:function(e,t,n){return Hc.makeTranslation(e,t,n),this.applyMatrix4(Hc),this},scale:lookAt:fromBufferGeometry:function(e){const t=this,n=null!==e.index?e.index:void 0,i=e.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const r=i.position,o=i.normal,s=i.color,a=i.uv,c=i.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let h=0;h<r.count;h++)t.vertices.push((new Kn).fromBufferAttribute(r,h)),void 0!==s&&t.colors.push((new br).fromBufferAttribute(s,h));onst u=e.groups;if(u.length>0)for(let h=0;h<u.length;h++){const e=u[h],t=e.start;for(let i=t,r=t+e.count;i<r;i+=3)void 0!==n?l(n.getX(i),n.getX(i+1),n.getX(i+2),e.materialIndex):l(i,i+1,i+2,e.materialIndex)}else if(void 0!==n)for(let h=0;h<n.count;h+=3)l(n.getX(h),n.getX(h+1),n.getX(h+2));else for(let h=0;h<r.count;h+=3)l(h,h+1,h+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:normalize:computeFaceNormals:function(){const e=new Kn,t=new Kn;for(let n=0,i=this.faces.length;n<i;n++){const i=this.faces[n],r=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(r,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);const t=new Array(this.vertices.length);for(let n=0,i=this.vertices.length;n<i;n++)t[n]=new Kn;if(e){const e=new Kn,n=new Kn;for(let i=0,r=this.faces.length;i<r;i++){const r=this.faces[i],o=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c];e.subVectors(a,s),n.subVectors(o,s),e.cross(n),t[r.a].add(e),t[r.b].add(e),t[r.c].add(e)}}else{this.computeFaceNormals();for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let n=0,i=this.vertices.length;n<i;n++)t[n].normalize();for(let n=0,i=this.faces.length;n<i;n++){const e=this.faces[n],i=e.vertexNormals;3===i.length?(i[0].copy(t[e.a]),i[1].copy(t[e.b]),i[2].copy(t[e.c])):(i[0]=t[e.a].clone(),i[1]=t[e.b].clone(),i[2]=t[e.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:computeMorphNormals:function(){for(let t=0,n=this.faces.length;t<n;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,n=e.vertexNormals.length;t<n;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const e=new Wc;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const e=this.morphNormals[t].faceNormals,n=this.morphNormals[t].vertexNormals;for(let t=0,i=this.faces.length;t<i;t++){const t=new Kn,i={a:new Kn,b:new Kn,c:new Kn};e.push(t),n.push(i)}}const n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],i=n.faceNormals[e],r=n.vertexNormals[e];i.copy(t.normal),r.a.copy(t.vertexNormals[0]),r.b.copy(t.vertexNormals[1]),r.c.copy(t.vertexNormals[2])}}for(let t=0,n=this.faces.length;t<n;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ti),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:merge:function(e,t,n){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let i;const r=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,c=e.faces,l=this.colors,u=e.colors;void 0===n&&(n=0),void 0!==t&&(i=(new Gn).getNormalMatrix(t));for(let h=0,d=s.length;h<d;h++){const e=s[h].clone();void 0!==t&&e.applyMatrix4(t),o.push(e)}for(let h=0,d=u.length;h<d;h++)l.push(u[h].clone());for(let h=0,d=c.length;h<d;h++){const e=c[h];let t,o;const s=e.vertexNormals,l=e.vertexColors,u=new xr(e.a+r,e.b+r,e.c+r);u.normal.copy(e.normal),void 0!==i&&u.normal.applyMatrix3(i).normalize();for(let n=0,r=s.length;n<r;n++)t=s[n].clone(),void 0!==i&&t.applyMatrix3(i).normalize(),u.vertexNormals.push(t);u.color.copy(e.color);for(let n=0,i=l.length;n<i;n++)o=l[n],u.vertexColors.push(o.clone());u.materialIndex=e.materialIndex+n,a.push(u)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){const t=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(let e=0,n=t.length;e<n;e++){const n=t[e],i=[];for(let e=0,t=n.length;e<t;e++)i.push(n[e].clone());this.faceVertexUvs[h].push(i)}}},mergeMesh:mergeVertices:function(){const e={},t=[],n=[],i=Math.pow(10,4);for(let s=0,a=this.vertices.length;s<a;s++){const r=this.vertices[s],o=Math.round(r.x*i)+"_"+Math.round(r.y*i)+"_"+Math.round(r.z*i);void 0===e[o]?(e[o]=s,t.push(this.vertices[s]),n[s]=t.length-1):n[s]=n[e[o]]}const r=[];for(let s=0,a=this.faces.length;s<a;s++){const e=this.faces[s];e.a=n[e.a],e.b=n[e.b],e.c=n[e.c];const t=[e.a,e.b,e.c];for(let n=0;n<3;n++)if(t[n]===t[(n+1)%3]){r.push(s);break}}for(let s=r.length-1;s>=0;s--){const e=r[s];this.faces.splice(e,1);for(let t=0,n=this.faceVertexUvs.length;t<n;t++)this.faceVertexUvs[t].splice(e,1)}const o=this.vertices.length-t.length;return this.vertices=t,o},setFromPoints:sortFacesByMaterialIndex:function(){const e=this.faces,t=e.length;for(let s=0;s<t;s++)e[s]._id=s;e.sort(();const n=this.faceVertexUvs[0],i=this.faceVertexUvs[1];let r,o;n&&n.length===t&&(r=[]),i&&i.length===t&&(o=[]);for(let s=0;s<t;s++){const t=e[s]._id;r&&r.push(n[t]),o&&o.push(i[t])}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}const t=[];for(let p=0;p<this.vertices.length;p++){const e=this.vertices[p];t.push(e.x,e.y,e.z)}const n=[],i=[],r={},o=[],s={},a=[],c={};for(let p=0;p<this.faces.length;p++){const e=this.faces[p],t=!0,i=!1,r=void 0!==this.faceVertexUvs[0][p],o=e.normal.length()>0,s=e.vertexNormals.length>0,a=1!==e.color.r||1!==e.color.g||1!==e.color.b,c=e.vertexColors.length>0;let f=0;if(f=l(f,0,0),f=l(f,1,t),f=l(f,2,i),f=l(f,3,r),f=l(f,4,o),f=l(f,5,s),f=l(f,6,a),f=l(f,7,c),n.push(f),n.push(e.a,e.b,e.c),n.push(e.materialIndex),r){const e=this.faceVertexUvs[0][p];n.push(d(e[0]),d(e[1]),d(e[2]))}if(o&&n.push(u(e.normal)),s){const t=e.vertexNormals;n.push(u(t[0]),u(t[1]),u(t[2]))}if(a&&n.push(h(e.color)),c){const t=e.vertexColors;n.push(h(t[0]),h(t[1]),h(t[2]))}}rn e.data={},e.data.vertices=t,e.data.normals=i,o.length>0&&(e.data.colors=o),a.length>0&&(e.data.uvs=[a]),e.data.faces=n,e},clone:function(){return(new Wc).copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());const n=e.colors;for(let h=0,d=n.length;h<d;h++)this.colors.push(n[h].clone());const i=e.faces;for(let h=0,d=i.length;h<d;h++)this.faces.push(i[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){const t=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(let e=0,n=t.length;e<n;e++){const n=t[e],i=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];i.push(t.clone())}this.faceVertexUvs[h].push(i)}}const r=e.morphTargets;for(let h=0,d=r.length;h<d;h++){const e={};if(e.name=r[h].name,void 0!==r[h].vertices){e.vertices=[];for(let t=0,n=r[h].vertices.length;t<n;t++)e.vertices.push(r[h].vertices[t].clone())}if(void 0!==r[h].normals){e.normals=[];for(let t=0,n=r[h].normals.length;t<n;t++)e.normals.push(r[h].normals[t].clone())}this.morphTargets.push(e)}const o=e.morphNormals;for(let h=0,d=o.length;h<d;h++){const e={};if(void 0!==o[h].vertexNormals){e.vertexNormals=[];for(let t=0,n=o[h].vertexNormals.length;t<n;t++){const n=o[h].vertexNormals[t],i={};i.a=n.a.clone(),i.b=n.b.clone(),i.c=n.c.clone(),e.vertexNormals.push(i)}}if(void 0!==o[h].faceNormals){e.faceNormals=[];for(let t=0,n=o[h].faceNormals.length;t<n;t++)e.faceNormals.push(o[h].faceNormals[t].clone())}this.morphNormals.push(e)}const s=e.skinWeights;for(let h=0,d=s.length;h<d;h++)this.skinWeights.push(s[h].clone());const a=e.skinIndices;for(let h=0,d=a.length;h<d;h++)this.skinIndices.push(a[h].clone());const c=e.lineDistances;for(let h=0,d=c.length;h<d;h++)this.lineDistances.push(c[h]);const l=e.boundingBox;null!==l&&(this.boundingBox=l.clone());const u=e.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class qc extends Wc{new Kn,new Kn,new Kn,new dr;n el(e,t){return e.x-t.x}sClockWise:triangulateShape:function(e,t){const n=[],i=[],r=[];yl(e),bl(n,e);let o=e.length;t.forEach(yl);for(let a=0;a<t.length;a++)i.push(o),o+=t[a].length,bl(n,t[a]);const s=function(e,t,n){n=n||2;const i=t&&t.length,r=i?t[0]*n:e.length;let o=Xc(e,0,r,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,c,l,u,h,d,p;if(i&&(o=e,t,o,n)),e.length>80*n){a=l=e[0],c=u=e[1];for(let t=n;t<r;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<c&&(c=d),h>l&&(l=h),d>u&&(u=d);p=Math.max(l-a,u-c),p=0!==p?1/p:0}return Zc(o,s,n,a,c,p),s}(n,i);for(let a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}};ass xl extends Wr{constructor(e,t){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let s=0,a=e.length;s<a;s++)o(e[s]);his.setAttribute("position",new Nr(i,3)),this.setAttribute("uv",new Nr(r,2)),this.computeVertexNormals()}toJSON(){const e=Wr.prototype.toJSON.call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}const wl={generateTopUV:generateSideWallUV:;class _l extends Wc{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new xl(e,t)),this.mergeVertices()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}function Ml(e,t,n){Wr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};const i=[],r=[],o=[],s=[],a=1e-5,c=new Kn,l=new Kn,u=new Kn,h=new Kn,d=new Kn;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=t+1;for(let f=0;f<=n;f++){const i=f/n;for(let n=0;n<=t;n++){const p=n/t;e(p,i,l),r.push(l.x,l.y,l.z),p-a>=0?(e(p-a,i,u),h.subVectors(l,u)):(e(p+a,i,u),h.subVectors(u,l)),i-a>=0?(e(p,i-a,u),d.subVectors(l,u)):(e(p,i+a,u),d.subVectors(u,l)),c.crossVectors(h,d).normalize(),o.push(c.x,c.y,c.z),s.push(p,i)}}for(let f=0;f<n;f++)for(let e=0;e<t;e++){const t=f*p+e,n=f*p+e+1,r=(f+1)*p+e+1,o=(f+1)*p+e;i.push(t,n,o),i.push(n,r,o)}this.setIndex(i),this.setAttribute("position",new Nr(r,3)),this.setAttribute("normal",new Nr(o,3)),this.setAttribute("uv",new Nr(s,2))}l.prototype=Object.create(Wr.prototype),Ml.prototype.constructor=Ml,Sl.prototype=Object.create(Wc.prototype),Sl.prototype.constructor=Sl;class El extends Wc{constructor(e,t,n,i){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new Co(e,t,n,i)),this.mergeVertices()}}class Tl extends Wr{constructor(e,t){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;const n=[],i=[],r=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))c(e);else for(let l=0;l<e.length;l++)c(e[l]),this.addGroup(s,a,l),s+=a,a=0;his.setIndex(n),this.setAttribute("position",new Nr(i,3)),this.setAttribute("normal",new Nr(r,3)),this.setAttribute("uv",new Nr(o,2))}toJSON(){const e=Wr.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class Al extends Wc{constructor(e,t){super(),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Tl(e,t)),this.mergeVertices()}toJSONclass Pl extends Wr{constructor(e,t,n,i,r,o,s){super(),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;const a=Math.min(o+s,Math.PI);let c=0;const l=[],u=new Kn,h=new Kn,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const d=[],v=g/n;let y=0;0==g&&0==o?y=.5/t:g==n&&a==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(i+a*r)*Math.sin(o+v*s),u.y=e*Math.cos(o+v*s),u.z=e*Math.sin(i+a*r)*Math.sin(o+v*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),d.push(c++)}l.push(d)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=l[g][e+1],i=l[g][e],r=l[g+1][e],s=l[g+1][e+1];(0!==g||o>0)&&d.push(t,i,s),(g!==n-1||a<Math.PI)&&d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new Nr(p,3)),this.setAttribute("normal",new Nr(f,3)),this.setAttribute("uv",new Nr(m,2))}}class Ll extends Wc{constructor(e,t,n,i,r,o,s){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Pl(e,t,n,i,r,o,s)),this.mergeVertices()}}pe=Object.create(_r.prototype),Ol.prototype.constructor=Ol,Ol.prototype.isShadowMaterial=!0,Ol.prototype.copy=function(e){return _r.prototype.copy.call(this,e),this.color.copy(e.color),this},Rl.prototype=Object.create(bo.prototype),Rl.prototype.constructor=Rl,Rl.prototype.isRawShaderMaterial=!0,Cl.prototype=Object.create(_r.prototype),Cl.prototype.constructor=Cl,Cl.prototype.isMeshStandardMaterial=!0,Cl.prototype.copy=Il.prototype=Object.create(Cl.prototype),Il.prototype.constructor=Il,Il.prototype.isMeshPhysicalMaterial=!0,Il.prototype.copy=Nl.prototype=Object.create(_r.prototype),Nl.prototype.constructor=Nl,Nl.prototype.isMeshPhongMaterial=!0,Nl.prototype.copy=Dl.prototype=Object.create(_r.prototype),Dl.prototype.constructor=Dl,Dl.prototype.isMeshToonMaterial=!0,Dl.prototype.copy=zl.prototype=Object.create(_r.prototype),zl.prototype.constructor=zl,zl.prototype.isMeshNormalMaterial=!0,zl.prototype.copy=Ul.prototype=Object.create(_r.prototype),Ul.prototype.constructor=Ul,Ul.prototype.isMeshLambertMaterial=!0,Ul.prototype.copy=Bl.prototype=Object.create(_r.prototype),Bl.prototype.constructor=Bl,Bl.prototype.isMeshMatcapMaterial=!0,Bl.prototype.copy=Fl.prototype=Object.create(bc.prototype),Fl.prototype.constructor=Fl,Fl.prototype.isLineDashedMaterial=!0,Fl.prototype.copy=var kl=Object.freeze({__proto__:null,ShadowMaterial:Ol,SpriteMaterial:Va,RawShaderMaterial:Rl,ShaderMaterial:bo,PointsMaterial:Oc,MeshPhysicalMaterial:Il,MeshStandardMaterial:Cl,MeshPhongMaterial:Nl,MeshToonMaterial:Dl,MeshNormalMaterial:zl,MeshLambertMaterial:Ul,MeshDepthMaterial:Ea,MeshDistanceMaterial:Ta,MeshBasicMaterial:Mr,MeshMatcapMaterial:Bl,LineDashedMaterial:Fl,LineBasicMaterial:bc,Material:_r});const jl={arraySlice:convertArray:isTypedArray:getKeyframeOrder:sortedArray:flattenJSON:subclip:function(e,t,n,i,r){r=r||30;const o=e.clone();o.name=t;const s=[];for(let c=0;c<o.tracks.length;++c){const e=o.tracks[c],t=e.getValueSize(),a=[],l=[];for(let o=0;o<e.times.length;++o){const s=e.times[o]*r;if(!(s<n||s>=i)){a.push(e.times[o]);for(let n=0;n<t;++n)l.push(e.values[o*t+n])}}0!==a.length&&(e.times=jl.convertArray(a,e.times.constructor),e.values=jl.convertArray(l,e.values.constructor),s.push(e))}o.tracks=s;let a=1/0;for(let c=0;c<o.tracks.length;++c)a>o.tracks[c].times[0]&&(a=o.tracks[c].times[0]);for(let c=0;c<o.tracks.length;++c)o.tracks[c].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=e),(void 0===i||i<=0)&&(i=30);const r=n.tracks.length,o=t/i;for(let s=0;s<r;++s){const t=n.tracks[s],i=t.ValueTypeName;if("bool"===i||"string"===i)continue;const r=e.tracks.find(();if(void 0===r)continue;let a=0;const c=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let l=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);const h=t.times.length-1;let d;if(o<=t.times[0]){const e=a,n=c-a;d=jl.arraySlice(t.values,e,n)}else if(o>=t.times[h]){const e=h*c+a,n=e+c-a;d=jl.arraySlice(t.values,e,n)}else{const e=t.createInterpolant(),n=a,i=c-a;e.evaluate(o),d=jl.arraySlice(e.resultBuffer,n,i)}"quaternion"===i&&(new $n).fromArray(d).normalize().conjugate().toArray(d);const p=r.times.length;for(let e=0;e<p;++e){const t=e*u+l;if("quaternion"===i)$n.multiplyQuaternionsFlat(r.values,t,d,0,r.values,t);else{const e=u-2*l;for(let n=0;n<e;++n)r.values[t+n]-=d[n]}}}return e.blendMode=2501,e}};nction Vl(e,t,n,i){Hl.call(this,e,t,n,i)}function Wl(e,t,n,i){Hl.call(this,e,t,n,i)}nction Yl(e,t,n,i){ql.call(this,e,t,n,i)}function Zl(e,t,n,i){ql.call(this,e,t,n,i)}function Jl(e,t,n,i){Hl.call(this,e,t,n,i)}function $l(e,t,n,i){ql.call(this,e,t,n,i)}function Kl(e,t,n,i){ql.call(this,e,t,n,i)}unction eu(e,t,n,i){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.blendMode=void 0!==i?i:2500,this.uuid=jn.generateUUID(),this.duration<0&&this.resetDuration()}bject.assign(Hl.prototype,{evaluate:settings:null,DefaultSettings_:{},getSettings_:copySampleValue_:interpolate_:intervalChanged_:function(){}}),Object.assign(Hl.prototype,{beforeStart_:Hl.prototype.copySampleValue_,afterEnd_:Hl.prototype.copySampleValue_}),Gl.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Gl,DefaultSettings_:{endingStart:yn,endingEnd:yn},intervalChanged_:interpolate_:),Vl.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Vl,interpolate_:),Wl.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Wl,interpolate_:),Object.assign(ql,{toJSON:function(e){const t=e.constructor;let n;if(void 0!==t.toJSON)n=t.toJSON(e);else{n={name:e.name,times:jl.convertArray(e.times,Array),values:jl.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}}),Object.assign(ql.prototype,{constructor:ql,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:gn,InterpolantFactoryMethodDiscrete:function(e){return new Wl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Vl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Gl(this.times,this.values,this.getValueSize(),e)},setInterpolation:getInterpolation:getValueSize:shift:scale:trim:validate:optimize:clone:),Xl.prototype=Object.assign(Object.create(ql.prototype),{constructor:Xl,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:mn,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Yl.prototype=Object.assign(Object.create(ql.prototype),{constructor:Yl,ValueTypeName:"color"}),Zl.prototype=Object.assign(Object.create(ql.prototype),{constructor:Zl,ValueTypeName:"number"}),Jl.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Jl,interpolate_:),$l.prototype=Object.assign(Object.create(ql.prototype),{constructor:$l,ValueTypeName:"quaternion",DefaultInterpolation:gn,InterpolantFactoryMethodLinear:InterpolantFactoryMethodSmooth:void 0}),Kl.prototype=Object.assign(Object.create(ql.prototype),{constructor:Kl,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:mn,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ql.prototype=Object.assign(Object.create(ql.prototype),{constructor:Ql,ValueTypeName:"vector"}),Object.assign(eu,{parse:function(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let r=0,o=n.length;r!==o;++r)t.push(tu(n[r]).scale(i));return new eu(e.name,e.duration,t,e.blendMode)},toJSON:CreateFromMorphTargetSequence:function(e,t,n,i){const r=t.length,o=[];for(let s=0;s<r;s++){let e=[],a=[];e.push((s+r-1)%r,s,(s+1)%r),a.push(0,1,0);const c=jl.getKeyframeOrder(e);e=jl.sortedArray(e,1,c),a=jl.sortedArray(a,1,c),i||0!==e[0]||(e.push(r),a.push(a[0])),o.push(new Zl(".morphTargetInfluences["+t[s].name+"]",e,a).scale(1/n))}return new eu(e,-1,o)},findByName:CreateClipsFromMorphTargetSequences:function(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,a=e.length;s<a;s++){const t=e[s],n=t.name.match(r);if(n&&n.length>1){const e=n[1];let r=i[e];r||(i[e]=r=[]),r.push(t)}}const o=[];for(const s in i)o.push(eu.CreateFromMorphTargetSequence(s,i[s],t,n));return o},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=i=[],r=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const c=e.hierarchy||[];for(let l=0;l<c.length;l++){const e=c[l].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const r in t){const t=[],o=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),o.push(i.morphTarget===r?1:0)}i.push(new Zl(".morphTargetInfluence["+r+"]",t,o))}a=t.length*(o||1)}else{const r=".bones["+t[l].name+"]";n(Ql,r+".position",e,"pos",i),n($l,r+".quaternion",e,"rot",i),n(Ql,r+".scale",e,"scl",i)}}return 0===i.length?null:new eu(r,a,i,s)}}),Object.assign(eu.prototype,{resetDuration:trim:validate:optimize:clone:function(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new eu(this.name,this.duration,e,this.blendMode)}});const nu={enabled:!1,files:{},add:get:remove:clear:,iu=new function(e,t,n){const i=this;let r,o=!1,s=0,a=0;const c=[];this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.itemStart=this.itemEnd=this.itemError=this.resolveURL=this.setURLModifier=this.addHandler=this.removeHandler=this.getHandler=;bject.assign(ru.prototype,{load:function(){},loadAsync:parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const ou={};function su(e){ru.call(this,e)}function au(e){ru.call(this,e)}function cu(e){ru.call(this,e)}function lu(e){ru.call(this,e)}function uu(e){ru.call(this,e)}function hu(e){ru.call(this,e)}function du(e){ru.call(this,e)}rototype=Object.assign(Object.create(ru.prototype),{constructor:su,load:setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}}),au.prototype=Object.assign(Object.create(ru.prototype),{constructor:au,load:function(e,t,n,i){const r=this,o=new su(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)},parse:),cu.prototype=Object.assign(Object.create(ru.prototype),{constructor:cu,load:function(e,t,n,i){const r=this,o=[],s=new Bc;s.image=o;const a=new su(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let c=0;function l(l){a.load(e[l],(function(e){const n=r.parse(e,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},c+=1,6===c&&(1===n.mipmapCount&&(s.minFilter=et),s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,i)}if(Array.isArray(e))for(let u=0,h=e.length;u<h;++u)l(u);else a.load(e,(function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=et),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,i);return s}}),lu.prototype=Object.assign(Object.create(ru.prototype),{constructor:lu,load:),uu.prototype=Object.assign(Object.create(ru.prototype),{constructor:uu,load:),hu.prototype=Object.assign(Object.create(ru.prototype),{constructor:hu,load:function(e,t,n,i){const r=this,o=new To,s=new su(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(r.withCredentials),s.load(e,(,n,i),o}}),du.prototype=Object.assign(Object.create(ru.prototype),{constructor:du,load:),Object.assign(pu.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t},updateArcLengths:getUtoTmapping:getTangent:getTangentAt:computeFrenetFrames:function(e,t){const n=new Kn,i=[],r=[],o=[],s=new Kn,a=new Ti;for(let d=0;d<=e;d++){const t=d/e;i[d]=this.getTangentAt(t,new Kn),i[d].normalize()}r[0]=new Kn,o[0]=new Kn;let c=Number.MAX_VALUE;const l=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);l<=c&&(c=l,n.set(1,0,0)),u<=c&&(c=u,n.set(0,1,0)),h<=c&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),o[d]=o[d-1].clone(),s.crossVectors(i[d-1],i[d]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(jn.clamp(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(a.makeRotationAxis(s,e))}o[d].crossVectors(i[d],r[d])}if(!0===t){let t=Math.acos(jn.clamp(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:fromJSON:),fu.prototype=Object.create(pu.prototype),fu.prototype.constructor=fu,fu.prototype.isEllipseCurve=!0,fu.prototype.getPoint=fu.prototype.copy=function(e){return pu.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},fu.prototype.toJSON=fu.prototype.fromJSON=mu.prototype=Object.create(fu.prototype),mu.prototype.constructor=mu,mu.prototype.isArcCurve=!0;const vu=new Kn,yu=new gu,bu=new gu,xu=new gu;tion Eu(e,t,n,i){pu.call(this),this.type="CubicBezierCurve",this.v0=e||new Hn,this.v1=t||new Hn,this.v2=n||new Hn,this.v3=i||new Hn}unction Au(e,t){pu.call(this),this.type="LineCurve",this.v1=e||new Hn,this.v2=t||new Hn}unction Lu(e,t,n){pu.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Hn,this.v1=t||new Hn,this.v2=n||new Hn}.prototype=Object.create(pu.prototype),wu.prototype.constructor=wu,wu.prototype.isCatmullRomCurve3=!0,wu.prototype.getPoint=function(e,t){const n=t||new Kn,i=this.points,r=i.length,o=(r-(this.closed?0:1))*e;let s,a,c=Math.floor(o),l=o-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/r)+1)*r:0===l&&c===r-1&&(c=r-2,l=1),this.closed||c>0?s=i[(c-1)%r]:(vu.subVectors(i[0],i[1]).add(i[0]),s=vu);const u=i[c%r],h=i[(c+1)%r];if(this.closed||c+2<r?a=i[(c+2)%r]:(vu.subVectors(i[r-1],i[r-2]).add(i[r-1]),a=vu),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(s.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),yu.initNonuniformCatmullRom(s.x,u.x,h.x,a.x,t,n,i),bu.initNonuniformCatmullRom(s.y,u.y,h.y,a.y,t,n,i),xu.initNonuniformCatmullRom(s.z,u.z,h.z,a.z,t,n,i)}else"catmullrom"===this.curveType&&(yu.initCatmullRom(s.x,u.x,h.x,a.x,this.tension),bu.initCatmullRom(s.y,u.y,h.y,a.y,this.tension),xu.initCatmullRom(s.z,u.z,h.z,a.z,this.tension));return n.set(yu.calc(l),bu.calc(l),xu.calc(l)),n},wu.prototype.copy=wu.prototype.toJSON=wu.prototype.fromJSON=Eu.prototype=Object.create(pu.prototype),Eu.prototype.constructor=Eu,Eu.prototype.isCubicBezierCurve=!0,Eu.prototype.getPoint=Eu.prototype.copy=function(e){return pu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Eu.prototype.toJSON=function(){const e=pu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Eu.prototype.fromJSON=function(e){return pu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Tu.prototype=Object.create(pu.prototype),Tu.prototype.constructor=Tu,Tu.prototype.isCubicBezierCurve3=!0,Tu.prototype.getPoint=Tu.prototype.copy=function(e){return pu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Tu.prototype.toJSON=Tu.prototype.fromJSON=Au.prototype=Object.create(pu.prototype),Au.prototype.constructor=Au,Au.prototype.isLineCurve=!0,Au.prototype.getPoint=function(e,t){const n=t||new Hn;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Au.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Au.prototype.getTangent=Au.prototype.copy=function(e){return pu.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Au.prototype.toJSON=function(){const e=pu.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Au.prototype.fromJSON=function(e){return pu.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Pu.prototype=Object.create(pu.prototype),Pu.prototype.constructor=Pu,Pu.prototype.isLineCurve3=!0,Pu.prototype.getPoint=Pu.prototype.getPointAt=Pu.prototype.copy=function(e){return pu.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Pu.prototype.toJSON=Pu.prototype.fromJSON=Lu.prototype=Object.create(pu.prototype),Lu.prototype.constructor=Lu,Lu.prototype.isQuadraticBezierCurve=!0,Lu.prototype.getPoint=Lu.prototype.copy=function(e){return pu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Lu.prototype.toJSON=function(){const e=pu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Lu.prototype.fromJSON=function(e){return pu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ou.prototype=Object.create(pu.prototype),Ou.prototype.constructor=Ou,Ou.prototype.isQuadraticBezierCurve3=!0,Ou.prototype.getPoint=Ou.prototype.copy=function(e){return pu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ou.prototype.toJSON=Ou.prototype.fromJSON=Ru.prototype=Object.create(pu.prototype),Ru.prototype.constructor=Ru,Ru.prototype.isSplineCurve=!0,Ru.prototype.getPoint=Ru.prototype.copy=function(e){pu.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this},Ru.prototype.toJSON=Ru.prototype.fromJSON=var Cu=Object.freeze({__proto__:null,ArcCurve:mu,CatmullRomCurve3:wu,CubicBezierCurve:Eu,CubicBezierCurve3:Tu,EllipseCurve:fu,LineCurve:Au,LineCurve3:Pu,QuadraticBezierCurve:Lu,QuadraticBezierCurve3:Ou,SplineCurve:Ru});ction zu(e,t){$i.call(this),this.type="Light",this.color=new br(e),this.intensity=void 0!==t?t:1}qu(e,t){zu.call(this,e,t),this.type="AmbientLight"}u.prototype=Object.assign(Object.create(pu.prototype),{constructor:Iu,add:function(e){this.curves.push(e)},closePath:getPoint:getLength:updateArcLengths:getCurveLengths:getSpacedPoints:function(e){void 0===e&&(e=40);const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],s=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const i=a[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:toJSON:function(){const e=pu.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:),Nu.prototype=Object.assign(Object.create(Iu.prototype),{constructor:Nu,setFromPoints:moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:quadraticCurveTo:bezierCurveTo:splineThru:arc:absarc:ellipse:absellipse:copy:function(e){return Iu.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:fromJSON:function(e){return Iu.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Du.prototype=Object.assign(Object.create(Nu.prototype),{constructor:Du,getPointsHoles:extractPoints:copy:toJSON:fromJSON:),zu.prototype=Object.assign(Object.create($i.prototype),{constructor:zu,isLight:!0,copy:function(e){return $i.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:),Uu.prototype=Object.assign(Object.create(zu.prototype),{constructor:Uu,isHemisphereLight:!0,copy:function(e){return zu.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Bu.prototype,{_projScreenMatrix:new Ti,_lightPositionWorld:new Kn,_lookTarget:new Kn,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:clone:function(){return(new this.constructor).copy(this)},toJSON:),Fu.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Fu,isSpotLightShadow:!0,updateMatrices:),ku.prototype=Object.assign(Object.create(zu.prototype),{constructor:ku,isSpotLight:!0,copy:),ju.prototype=Object.assign(Object.create(Bu.prototype),{constructor:ju,isPointLightShadow:!0,updateMatrices:),Hu.prototype=Object.assign(Object.create(zu.prototype),{constructor:Hu,isPointLight:!0,copy:),Gu.prototype=Object.assign(Object.create(xo.prototype),{constructor:Gu,isOrthographicCamera:!0,copy:setViewOffset:clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,s=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:),Vu.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Vu,isDirectionalLightShadow:!0,updateMatrices:),Wu.prototype=Object.assign(Object.create(zu.prototype),{constructor:Wu,isDirectionalLight:!0,copy:),qu.prototype=Object.assign(Object.create(zu.prototype),{constructor:qu,isAmbientLight:!0}),Xu.prototype=Object.assign(Object.create(zu.prototype),{constructor:Xu,isRectAreaLight:!0,copy:function(e){return zu.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:);class Yu{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Kn)}aledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}e(){return(new this.constructor).copy(this)}fromArray(e,t){void 0===t&&(t=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}.prototype=Object.assign(Object.create(zu.prototype),{constructor:Zu,isLightProbe:!0,copy:fromJSON:toJSON:),Ju.prototype=Object.assign(Object.create(ru.prototype),{constructor:Ju,load:function(e,t,n,i){const r=this,o=new su(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)},parse:setTextures:function(e){return this.textures=e,this}});const $u=Ku=nction th(e){ru.call(this,e)}Qu.prototype=Object.assign(Object.create(Wr.prototype),{constructor:Qu,isInstancedBufferGeometry:!0,copy:function(e){return Wr.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e=Wr.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),eh.prototype=Object.assign(Object.create(Tr.prototype),{constructor:eh,isInstancedBufferAttribute:!0,copy:function(e){return Tr.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:),th.prototype=Object.assign(Object.create(ru.prototype),{constructor:th,load:parse:function(e){const t={},n={};onst r=e.isInstancedBufferGeometry?new Qu:new Wr,o=e.data.index;if(void 0!==o){const e=new nh[o.type](o.array);r.setIndex(new Tr(e,1))}const s=e.data.attributes;for(const u in s){const t=s[u];let n;if(t.isInterleavedBufferAttribute)n=new Ga(i(e.data,t.data),t.itemSize,t.offset,t.normalized);else{const e=new nh[t.type](t.array);n=new(t.isInstancedBufferAttribute?eh:Tr)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),r.setAttribute(u,n)}const a=e.data.morphAttributes;if(a)for(const u in a){const t=a[u],n=[];for(let r=0,o=t.length;r<o;r++){const o=t[r];let s;s=o.isInterleavedBufferAttribute?new Ga(i(e.data,o.data),o.itemSize,o.offset,o.normalized):new Tr(new nh[o.type](o.array),o.itemSize,o.normalized),void 0!==o.name&&(s.name=o.name),n.push(s)}r.morphAttributes[u]=n}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let u=0,h=c.length;u!==h;++u){const e=c[u];r.addGroup(e.start,e.count,e.materialIndex)}const l=e.data.boundingSphere;if(void 0!==l){const e=new Kn;void 0!==l.center&&e.fromArray(l.center),r.boundingSphere=new vi(e,l.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}});const nh={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};ction sh(e,t,n,i,r){const o=r.glyphs[e]||r.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".");const s=new rh;let a,c,l,u,h,d,p,f;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let r=0,o=e.length;r<o;)switch(e[r++]){case"m":a=e[r++]*t+n,c=e[r++]*t+i,s.moveTo(a,c);break;case"l":a=e[r++]*t+n,c=e[r++]*t+i,s.lineTo(a,c);break;case"q":l=e[r++]*t+n,u=e[r++]*t+i,h=e[r++]*t+n,d=e[r++]*t+i,s.quadraticCurveTo(h,d,l,u);break;case"b":l=e[r++]*t+n,u=e[r++]*t+i,h=e[r++]*t+n,d=e[r++]*t+i,p=e[r++]*t+n,f=e[r++]*t+i,s.bezierCurveTo(h,d,p,f,l,u)}}return{offsetX:o.ha*t,path:s}}function ah(e){ru.call(this,e)}let ch;ih.prototype=Object.assign(Object.create(ru.prototype),{constructor:ih,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:),Object.assign(rh.prototype,{moveTo:lineTo:quadraticCurveTo:bezierCurveTo:splineThru:toShapes:),Object.assign(oh.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);const n=[],i=function(e,t,n){const i=Array.from?Array.from(e):String(e).split(""),r=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,s=[];let a=0,c=0;for(let l=0;l<i.length;l++){const e=i[l];if("\n"===e)a=0,c-=o;else{const t=sh(e,r,a,c,n);a+=t.offsetX,s.push(t.path)}}return s}(e,t,this.data);for(let r=0,o=i.length;r<o;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}}),ah.prototype=Object.assign(Object.create(ru.prototype),{constructor:ah,load:parse:function(e){return new oh(e)}});function lh(e){ru.call(this,e)}.prototype=Object.assign(Object.create(ru.prototype),{constructor:lh,load:function(e,t,n,i){const r=this,o=new su(r.manager);o.setResponseType("arraybuffer"),o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);(void 0===ch&&(ch=new(window.AudioContext||window.webkitAudioContext)),ch).decodeAudioData(e,(function(e){t(e)}))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}}),uh.prototype=Object.assign(Object.create(Zu.prototype),{constructor:uh,isHemisphereLightProbe:!0,copy:function(e){return Zu.prototype.copy.call(this,e),this},toJSON:function(e){return Zu.prototype.toJSON.call(this,e)}}),hh.prototype=Object.assign(Object.create(Zu.prototype),{constructor:hh,isAmbientLightProbe:!0,copy:toJSON:);const dh=new Ti,ph=new Ti;Object.assign(prototype,{update:function(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),i=t.eyeSep/2,r=i*t.near/t.focus,o=t.near*Math.tan(jn.DEG2RAD*t.fov*.5)/t.zoom;let s,a;ph.elements[12]=-i,dh.elements[12]=i,s=-o*t.aspect+r,a=o*t.aspect+r,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*t.aspect-r,a=o*t.aspect-r,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(ph),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(dh)}});class fh{constructortartDeltabject.assign(mh.prototype,{accumulate:accumulateAdditive:apply:saveOriginalState:restoreOriginalState:_setAdditiveIdentityNumeric:_setAdditiveIdentityQuaternion:_setAdditiveIdentityOther:_select:_slerp:_slerpAdditive:_lerp:_lerpAdditive:);const gh="\\[\\]\\.:\\/",vh=new RegExp("["+gh+"]","g"),yh="[^"+gh+"]",bh="[^"+gh.replace("\\.","")+"]",xh=/((?:WC+[\/:])*)/.source.replace("WC",yh),wh=/(WCOD+)?/.source.replace("WCOD",bh),_h=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",yh),Mh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",yh),Sh=new RegExp("^"+xh+wh+_h+Mh+"$"),Eh=["material","materials","bones"];ject.assign(Th.prototype,{getValue:setValue:bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:),Object.assign(Ah,{Composite:Th,create:sanitizeNodeName:parseTrackName:findNode:),Object.assign(Ah.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0},,[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},,[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:bind:unbind:),Object.assign(Ah.prototype,{_getValue_unbound:Ah.prototype.getValue,_setValue_unbound:Ah.prototype.setValue}),Object.assign(prototype,{isAnimationObjectGroup:!0,add:remove:uncache:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,c=t[a];if(void 0!==c)if(delete t[a],c<r){const s=--r,a=e[s],l=--o,u=e[l];t[a.uuid]=c,e[c]=a,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[s],r=t[l];t[c]=i,t[s]=r,t.pop()}}else{const r=--o,s=e[r];t[s.uuid]=c,e[c]=s,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[c]=t[r],t.pop()}}}this.nCachedObjects_=r},subscribe_:unsubscribe_:);class Ph{constructor(e,t,n,i){this._mixer=e,this._clip=t,this._localRoot=n||null,this.blendMode=i||t.blendMode;const r=t.tracks,o=r.length,s=new Array(o),a={endingStart:yn,endingEnd:yn};for(let c=0;c!==o;++c){const e=r[c].createInterpolant(null);s[c]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}tiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}pFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}etEffectiveTimeScale(){return this._effectiveTimeScale}xer(){return this._mixer}getClip(){return this._clip}update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulate(i,s)}} Ih(e,t){return e.distance-t.distance}h.prototype=Object.assign(Object.create(Bn.prototype),{constructor:Lh,_bindAction:_activateAction:_deactivateAction:_initMemoryManager:_isActiveAction:_addInactiveAction:_removeInactiveAction:_removeInactiveBindingsForAction:_lendAction:function(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackAction:function(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_addInactiveBinding:_removeInactiveBinding:_lendBinding:_takeBackBinding:function(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_lendControlInterpolant:_takeBackControlInterpolant:_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:existingAction:stopAllAction:update:setTime:getRoot:function(){return this._root},uncacheClip:uncacheRoot:uncacheAction:),Oh.prototype=Object.assign(Object.create(ja.prototype),{constructor:Oh,isInstancedInterleavedBuffer:!0,copy:function(e){return ja.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:toJSON:),Object.defineProperty(Rh.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Rh.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(Ch.prototype,{set:setFromCamera:intersectObject:intersectObjects:);class Dh{one(){return(new this.constructor).copy(this)}FromCartesianCoordsconst zh=new Hn;h.prototype=Object.create($i.prototype),Uh.prototype.constructor=Uh,Uh.prototype.isImmediateRenderObject=!0;const Bh=new Kn,Fh=new Ti,kh=new Ti;onst Hh=new ti;r Wh,qh,Xh,Yh;pu.create=Object.assign(Iu.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:createGeometry:),Object.assign(Nu.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Object.create(wu.prototype),Object.create(wu.prototype),Vh.prototype=Object.create(wu.prototype),Object.assign(Vh.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),class extends Pc{constructor(e,t,n,i){e=e||10,t=t||10,n=new br(void 0!==n?n:4473924),i=new br(void 0!==i?i:8947848);const r=t/2,o=e/t,s=e/2,a=[],c=[];for(let u=0,h=0,d=-s;u<=t;u++,d+=o){a.push(-s,0,d,s,0,d),a.push(d,0,-s,d,0,s);const e=u===r?n:i;e.toArray(c,h),h+=3,e.toArray(c,h),h+=3,e.toArray(c,h),h+=3,e.toArray(c,h),h+=3}const l=new Wr;l.setAttribute("position",new Nr(a,3)),l.setAttribute("color",new Nr(c,3)),super(l,new bc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends Pc{constructor(e){const t=jh(e),n=new Wr,i=[],r=[],o=new br(0,0,1),s=new br(0,1,0);for(let a=0;a<t.length;a++){const e=t[a];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}n.setAttribute("position",new Nr(i,3)),n.setAttribute("color",new Nr(r,3)),super(n,new bc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");kh.getInverse(this.root.matrixWorld);for(let r=0,o=0;r<t.length;r++){const e=t[r];e.parent&&e.parent.isBone&&(Fh.multiplyMatrices(kh,e.matrixWorld),Bh.setFromMatrixPosition(Fh),i.setXYZ(o,Bh.x,Bh.y,Bh.z),Fh.multiplyMatrices(kh,e.parent.matrixWorld),Bh.setFromMatrixPosition(Fh),i.setXYZ(o+1,Bh.x,Bh.y,Bh.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(ru.prototype,{extractUrlBase:),ru.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(class{constructor(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new Hn(1/0,1/0),this.max=void 0!==t?t:new Hn(-1/0,-1/0)}(e){return this.min.copy(e.min),this.max.copy(e.max),this}ndByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}ct(e){return this.min.max(e.min),this.max.min(e.max),this}rototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(ti.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(vi.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Lo.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Object.assign(jn,{random16:nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),jn.floorPowerOfTwo(e)},nextPowerOfTwo:),Object.assign(Gn.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Ti.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:),tr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},$n.prototype.multiplyVector3=Object.assign(Ei.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(dr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(dr,{barycoordFromPoint:normal:),Object.assign(Du.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new _l(this,e)},makeGeometry:),Object.assign(Hn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Kn.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Yn.prototype,{fromAttribute:lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Wc.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign($i.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties($i.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(lo.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(lo.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(cc.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(dc.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),lc.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(pu.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),wo.prototype.setLens=Object.defineProperties(zu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Tr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===zn},set:}),Object.assign(Tr.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?zn:Dn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Wr.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:addDrawCall:clearDrawCalls:computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:),Object.defineProperties(Wr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Qu.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(Ch.prototype,{linePrecision:{get:set:}),Object.defineProperties(ja.prototype,{dynamic:{get:set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(ja.prototype,{setDynamic:setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(xl.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(ka.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(_r.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:,shading:{get:set:,stencilMask:{get:set:}),Object.defineProperties(Nl.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Il.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:}),Object.defineProperties(bo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Ba.prototype,{clearTarget:animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:enableScissorTest:initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Ba.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:,vr:{get:,gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:set:,toneMappingWhitePoint:{get:set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(La.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Zn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:set:}),Mo.prototype.updateCubeMap=Wn.crossOrigin=void 0,Wn.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new du;r.setCrossOrigin(this.crossOrigin);const o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},Wn.loadTextureCube=Wn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Wn.loadCompressedTextureCube="undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"121"}})),Wh||(Wh={})),qh||(qh={})),function(e){e.generate="generated",e.inherit="inherit"}(Xh||(Xh={})),Yh||(Yh={}));const Zh=.0393701;function Jh(e){return new Promise(((t,n)=>{const i=new Image;i.crossOrigin="Anonymous",i.onload=i.onerror=i.src=e}))}unction Kh(e,t){const n=$h(e.width,e.height),i=n.getContext("2d");return i.fillStyle=t,i.fillRect(0,0,e.width,e.height),n}function Qh(e,t,n,i){const r=$h(e.width,e.height),o=r.getContext("2d");return o.drawImage(e,0,0),o.globalCompositeOperation=n,"tile"===i?o.drawImage(t,0,0):o.drawImage(t,0,0,e.width,e.height),r}function ed(e){e.forEach((e=>{e.width=1,e.height=1;const t=e.getContext("2d");t&&t.clearRect(0,0,1,1)}))}function td(e,t,n,i){const r=t.width/(n.width*Zh),o=t.height/(n.height*Zh),s=i[e.sourceUrl],a=document.createElement("canvas");a.width=Math.max(s.naturalWidth*(r/e.dpi),1),a.height=Math.max(s.naturalHeight*(o/e.dpi),1);const c=a.getContext("2d");c.drawImage(s,0,0,a.width,a.height),e.overlayColor&&(c.globalCompositeOperation=Yh.overlay,c.fillStyle=`#${new br(e.overlayColor).getHexString()}`,c.fillRect(0,0,a.width,a.height));const l=$h(t.width,t.height),u=l.getContext("2d");return u.rect(0,0,t.width,t.height),u.fillStyle=u.createPattern(a,"repeat"),u.fill(),ed([a]),l}function nd(e,t){const n=new Xn(e);return n.needsUpdate=!0,n.anisotropy=4,t&&(n.repeat=new Hn(t,t),n.wrapS=Ye,n.wrapT=Ye),n}function id(e){return e.trim?{width:e.trim.bottomRightX-e.trim.topLeftX,height:e.trim.bottomRightY-e.trim.topLeftY}:e.fullBleed}function rd(e,t,n,i,r){const o=[e.sourceUrl,e.dpi,e.overlayColor,t.width,t.height,n.width,n.height].join("");return r[o]||(r[o]=td(e,t,n,i)),{key:o,canvas:r[o]}}function od(e,t,n,i,r,o){const s=[e.sourceUrl,e.dpi,e.overlayColor,t.width,t.height,n.width,n.height].join("");return r[s]||(r[s]=td(e,t,n,i)),o[s]||(o[s]=nd(r[s])),{key:s,texture:o[s]}}function sd(e,t,n,i){const r=[n.reflectionUrl,n.reflectionUrls,i].join("");if(!t[r]){const o=new So;o.format=gt;let s=i;if(void 0===s&&(s=n.reflectionUrl?new Array(6).fill(n.reflectionUrl):n.reflectionUrls),void 0===s)throw Error("No refection urls defined!");for(let t=0;t<6;t++)o.images[t]=e[s[t]];o.needsUpdate=!0,t[r]=o}return t[r]}const ad=new Ch;function cd(e,t){if(t.trim){const n=t.trim.bottomRightX-t.trim.topLeftX,i=t.trim.bottomRightY-t.trim.topLeftY;return{u:(e.x-t.trim.topLeftX)/n,v:1-(e.y-t.trim.topLeftY)/i}}return{u:e.x/t.fullBleed.width,v:1-e.y/t.fullBleed.height}}function ld(e,t,n,i,r,o){e.faceVertexUvs[0][2*t][0]=new Hn(n,o),e.faceVertexUvs[0][2*t][1]=new Hn(n,r),e.faceVertexUvs[0][2*t][2]=new Hn(i,o),e.faceVertexUvs[0][2*t+1][0]=new Hn(n,r),e.faceVertexUvs[0][2*t+1][1]=new Hn(i,r),e.faceVertexUvs[0][2*t+1][2]=new Hn(i,o)}unction hd(e){const t=Math.max(e.parameters.width,e.parameters.height,e.parameters.depth);ld(e,0,0,e.parameters.depth/t,0,e.parameters.height/t),ld(e,1,0,e.parameters.depth/t,0,e.parameters.height/t),ld(e,2,0,e.parameters.width/t,0,e.parameters.depth/t),ld(e,3,0,e.parameters.width/t,0,e.parameters.depth/t),ld(e,4,0,e.parameters.width/t,0,e.parameters.height/t),ld(e,5,0,e.parameters.width/t,0,e.parameters.height/t)}function dd(e,t,n,i){const r=e.faceVertexUvs;for(let o=0;o<r.length;o++)for(let e=0;e<r[o].length;e++)for(let s=0;s<r[o][e].length;s++)r[o][e][s].x=(r[o][e][s].x-i.x)/t,r[o][e][s].y=(r[o][e][s].y-i.y)/n}function pd(e,t,n){dd(e,t,n,new Hn)}function fd(e,t){const n=new Kn(0,1,0),i=e.faceVertexUvs;for(let r=0;r<i.length;r++)for(let o=0;o<i[r].length;o++){const s=e.faces[o].normal,a=Math.abs(s.dot(n))<.70710678;for(let e=0;e<i[r][o].length;e++)if(1===s.z||-1===s.z)i[r][o][e].x=i[r][o][e].x/t.width,i[r][o][e].y=i[r][o][e].y/t.height;else{const n=a?t.height:t.width;i[r][o][e].x=i[r][o][e].x/n,i[r][o][e].y=i[r][o][e].y/n}}}function md(e){e&&(e.children&&e.children.forEach((e=>md(e))),e instanceof lo&&(e.geometry instanceof Wc||e.geometry instanceof Wr)&&e.geometry.dispose())}function gd(e,t){t&&(t.children&&t.children.forEach((),t instanceof lo&&(e[t.uuid]=t))}unction yd(e,t,n,i=1){const r=new lo(new Ll(i,32,16),new Mr({color:n}));r.position.x=e.x,r.position.y=e.y,r.position.z=e.z,t.add(r)}function bd(e,t,n,i,r,o,s,a){e.position.applyMatrix4(o),t.position.applyMatrix4(o),n.position.applyMatrix4(o);const c=new dr(e.position,t.position,n.position),l=new Kn;c.getNormal(l);const u=function(e,t,n,i,r,o,s){const a=new Kn(e.u,e.v,0),c=new Kn(t.u,t.v,0),l=new Kn(n.u,n.v,0),u=new Kn(i,r,0),h=new dr(a,c,l),d=new Kn;return h.getUV(u,e.position,t.position,n.position,d),s&&(yd(e.position,o,16711680),yd(t.position,o,16711680),yd(n.position,o,16711680),yd(d,o,16776960,2.5)),d}(e,t,n,i,r,s,a);return a&&function(e,t,n,i){const r=new Ec((new Wr).setFromPoints([e,t]),new bc({color:3355443}));n.add(r)}(u,l.clone().multiplyScalar(10).add(u),s),{position:u,normal:l}}function xd(e,t,n,i,r,o){return n instanceof Wr?function(e,t,n,i,r,o){const s=n.getAttribute("uv"),a=n.getAttribute("position");if(n.index)for(let c=0;c<n.index.array.length;c+=3){const l=n.index.array[c],u=n.index.array[c+1],h=n.index.array[c+2],d=s.array[2*l],p=s.array[2*l+1],f=s.array[2*u],m=s.array[2*u+1],g=s.array[2*h],v=s.array[2*h+1],y=Math.min(d,f,g),b=Math.max(d,f,g),x=Math.min(p,m,v),w=Math.max(p,m,v);if(e>=y&&e<=b&&t>=x&&t<=w)return bd({position:new Kn(a.array[3*l],a.array[3*l+1],a.array[3*l+2]),u:d,v:p},{position:new Kn(a.array[3*u],a.array[3*u+1],a.array[3*u+2]),u:f,v:m},{position:new Kn(a.array[3*h],a.array[3*h+1],a.array[3*h+2]),u:g,v:v},e,t,i,r,o)}else for(let c=0;c<s.array.length;c+=6){const n=s.array[c],l=s.array[c+1],u=s.array[c+2],h=s.array[c+3],d=s.array[c+4],p=s.array[c+5],f=Math.min(n,u,d),m=Math.max(n,u,d),g=Math.min(l,h,p),v=Math.max(l,h,p);if(e>=f&&e<=m&&t>=g&&t<=v)return bd({position:new Kn(a.array[Math.round(1.5*c)],a.array[Math.round(1.5*c)+1],a.array[Math.round(1.5*c)+2]),u:n,v:l},{position:new Kn(a.array[Math.round(1.5*c)+3],a.array[Math.round(1.5*c)+4],a.array[Math.round(1.5*c)+5]),u:u,v:h},{position:new Kn(a.array[Math.round(1.5*c)+6],a.array[Math.round(1.5*c)+7],a.array[Math.round(1.5*c)+8]),u:d,v:p},e,t,i,r,o)}}(e,t,n,i,r,o):n instanceof Wc?function(e,t,n,i,r,o){for(let s=0;s<n.faces.length;s++){const a=n.faces[s],c=n.faceVertexUvs[0][s][0].x,l=n.faceVertexUvs[0][s][0].y,u=n.faceVertexUvs[0][s][1].x,h=n.faceVertexUvs[0][s][1].y,d=n.faceVertexUvs[0][s][2].x,p=n.faceVertexUvs[0][s][2].y,f=Math.min(c,u,d),m=Math.max(c,u,d),g=Math.min(l,h,p),v=Math.max(l,h,p);if(e>=f&&e<=m&&t>=g&&t<=v)return bd({position:n.vertices[a.a].clone(),u:c,v:l},{position:n.vertices[a.b].clone(),u:u,v:h},{position:n.vertices[a.c].clone(),u:d,v:p},e,t,i,r,o)}}(e,t,n,i,r,o):void 0}function wd(e){if(6!==e.length)throw new Error("Must provide 6 point light intensities!");const t=[],n=new Hu(16777215,e[0],500);n.position.set(0,0,300);const i=new Hu(16777215,e[1],500);i.position.set(0,0,-300);const r=new Hu(16777215,e[2],500);r.position.set(300,0,0);const o=new Hu(16777215,e[3],500);o.position.set(-300,0,0);const s=new Hu(16777215,e[4],500);s.position.set(0,-300,0);const a=new Hu(16777215,e[5],500);return a.position.set(0,300,0),t.push(n),t.push(i),t.push(r),t.push(o),t.push(s),t.push(a),t}const _d=.0071,Md=1e-4,Sd=2*Math.PI,Ed=.5*Math.PI,Td=200;var Ad=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};function Pd(e,t){return Ad(this,void 0,void 0,(function*(){const n=t.transitionState(e,{duration:Md});t.updateAnimations(1),yield n}))}function Ld(e,t,n,i){return Ad(this,void 0,void 0,(function*(){const r={},o=t.getCurrentState().id,s=t.getStates();for(const t of s)if(t.boundingBox){const e=Od(t.boundingBox,i);r[t.id]=(new ti).setFromObject(e)}else yield Pd(t.id,e),r[t.id]=(new ti).setFromObject(n);return yield Pd(o,e),r}))}function Od(e,t){const n=e.max.x-e.min.x,i=e.max.y-e.min.y,r=e.max.z-e.min.z,o=(e.max.x+e.min.x)/2,s=(e.max.y+e.min.y)/2,a=(e.max.z+e.min.z)/2,c=new qc(n,i,r);c.translate(o,s,a);const l=new lo(c,new Mr({color:65280}));return t&&(l.scale.multiplyScalar(t),l.position.multiplyScalar(t)),l}function Rd(e,t,n,i){let r=e/(i/2);return r<1?n/2*Math.pow(r,4)+t:(r-=2,-n/2*(Math.pow(r,4)-2)+t)}function Cd(e){const t=Math.log2(e);return Math.floor(t)===Math.ceil(t)}const Id="object"==typeof window&&navigator.vendor.match(/apple/i)&&!navigator.userAgent.match(/crios/i)&&!navigator.userAgent.match(/fxios/i)&&!navigator.userAgent.match(/Opera|OPT\//);var Nd=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};function Dd(e,t){return Nd(this,void 0,void 0,(function*(){yield Pd(e,t),t.scene.updateMatrixWorld()}))}function zd(e,t,n,i){var r;const o=new Kn(n.x*Td*1.5,n.y*Td*1.5,n.z*Td*1.5),s=function(e,t,n){return ad.set(e,t),ad.intersectObjects(n.children,!0)}(t.clone().add(o),new Kn(-n.x,-n.y,-n.z),i);return!!(s&&s.length>0)&&(null===(r=s[0])||void 0===r?void 0:r.object.uuid)===e}function Ud(e,t,n){if(t.geometry instanceof Wc){const i=t.geometry;if(i.faces.length>0&&i.faces[0].vertexNormals.length>0){const r=i.faces[0].vertexNormals[0].clone().transformDirection(t.matrixWorld),o=(new ti).setFromObject(t).getCenter(new Kn);if(zd(e,o,r,n))return r;const s=Math.PI/6,a=(new Dh).setFromVector3(r),c=a.phi,l=a.theta;for(let t=0;t<Ed;t+=s){a.phi=c+t;const i=(new Kn).setFromSpherical(a);if(zd(e,o,i,n))return i}for(let t=0;t>-Ed;t-=s){a.phi=c+t;const i=(new Kn).setFromSpherical(a);if(zd(e,o,i,n))return i}a.phi=c;for(let t=0;t<Ed;t+=s){a.theta=l+t;const i=(new Kn).setFromSpherical(a);if(zd(e,o,i,n))return i}for(let t=0;t>-Ed;t-=s){a.theta=l+t;const i=(new Kn).setFromSpherical(a);if(zd(e,o,i,n))return i}return}}}class Bd{constructor(e,t){var n;Object.defineProperty(this,"duration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"elapsedTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"geometry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialCenter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"translationOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resolveAnimation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"activeStatus",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"canceledStatus",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.duration=null!==(n=t.duration)&&void 0!==n?n:2,this.geometry=e;const i=t.initialBounds.getCenter(new Kn),r=t.targetBounds.getCenter(new Kn);this.translationOffset=new Kn(i.x-r.x,i.y-r.y,i.z-r.z),this.initialCenter=e.position.clone()}get isComplete(){return this.completed}get isCanceled(){return this.canceledStatus}resetMeshState(){this.activeStatus=!1,this.interpolateValues(this.duration),this.resolveAnimation&&this.resolveAnimation()}cancel(){this.activeStatus=!1,this.canceledStatus=!0,this.resetMeshState(),this.resolveAnimation&&this.resolveAnimation()}get isActive(){return this.activeStatus}update(e){this.isActive&&this.elapsedTime<this.duration&&(this.interpolateValues(this.elapsedTime),this.elapsedTime+=e),this.elapsedTime>=this.duration&&this.isActive&&(this.interpolateValues(this.duration),this.resolveAnimation&&this.resolveAnimation(),this.activeStatus=!1)}start(){return this.activeStatus=!0,new Promise((e=>{this.resolveAnimation=e}))}resume(){void 0!==this.resolveAnimation&&(this.activeStatus=!0)}stop(){this.activeStatus=!1}interpolateValues(e){this.geometry.position.x=Rd(e,this.initialCenter.x,this.translationOffset.x,this.duration),this.geometry.position.y=Rd(e,this.initialCenter.y,this.translationOffset.y,this.duration),this.geometry.position.z=Rd(e,this.initialCenter.z,this.translationOffset.z,this.duration)}}const Fd=-1,kd={type:"change"},jd={type:"start"},Hd={type:"end"},Gd=1e-6;class Vd extends Bn{constructor(e,t,n,i){var r,o,s,a,c,l,u,h;super(),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"domElement",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"window",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"target",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enableZoom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"minDistance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxDistance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enableRotate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotateSpeed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enablePan",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoRotate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoRotateSpeed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"minZoom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxZoom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scrollZoomSpeed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pinchZoomSpeed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"minPolarAngle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxPolarAngle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"minAzimuthAngle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxAzimuthAngle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mouseButtons",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enableDamping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dampingFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"overrideRotation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"overrideTheta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"overridePhi",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"spherical",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sphericalDelta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"target0",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"position0",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zoom0",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"panOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zoomChanged",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotateStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotateEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotateDelta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"panStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"panEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"panDelta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dollyStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dollyEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dollyDelta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateLastPosition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateQuat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateLastQuaternion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateQuatInverse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"panLeftV",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"panUpV",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"panInternalOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"minPanBounds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxPanBounds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onContextMenu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onMouseUp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onMouseDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onMouseMove",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onMouseWheel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onTouchStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onTouchEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onTouchMove",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mouseGestures",{enumerable:!0,configurable:!0,writable:!0,value:{leftClickDrag:"rotate",rightClickDrag:"pan",scroll:"zoom"}}),Object.defineProperty(this,"touchGestures",{enumerable:!0,configurable:!0,writable:!0,value:{singleFingerDrag:"rotate",twoFingerPinch:"zoom",threeFingerDrag:"pan"}}),this.camera=e,this.domElement=void 0!==t?t:document,this.window=void 0!==n?n:window,this.target=new Kn,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=null!==(o=null===(r=null==i?void 0:i.polarAngle)||void 0===r?void 0:r.min)&&void 0!==o?o:0,this.maxPolarAngle=null!==(a=null===(s=null==i?void 0:i.polarAngle)||void 0===s?void 0:s.max)&&void 0!==a?a:Math.PI,this.minAzimuthAngle=null!==(l=null===(c=null==i?void 0:i.azimuthAngle)||void 0===c?void 0:c.min)&&void 0!==l?l:-1/0,this.maxAzimuthAngle=null!==(h=null===(u=null==i?void 0:i.azimuthAngle)||void 0===u?void 0:u.max)&&void 0!==h?h:1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.scrollZoomSpeed=1,this.pinchZoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.autoRotate=!1,this.autoRotateSpeed=2,this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2},this.target0=this.target.clone(),this.position0=this.camera.position.clone(),this.zoom0=this.camera.zoom,this.updateOffset=new Kn,this.updateQuat=(new $n).setFromUnitVectors(e.up,new Kn(0,1,0)),this.updateQuatInverse=this.updateQuat.clone().inverse(),this.updateLastPosition=new Kn,this.updateLastQuaternion=new $n,this.state=Fd,this.scale=1,this.spherical=new Dh,this.sphericalDelta=new Dh,this.panOffset=new Kn,this.zoomChanged=!1,this.rotateStart=new Hn,this.rotateEnd=new Hn,this.rotateDelta=new Hn,this.panStart=new Hn,this.panEnd=new Hn,this.panDelta=new Hn,this.dollyStart=new Hn,this.dollyEnd=new Hn,this.dollyDelta=new Hn,this.panLeftV=new Kn,this.panUpV=new Kn,this.panInternalOffset=new Kn,this.overrideRotation=!1,this.overrideTheta=0,this.overridePhi=0,this.onMouseDown=e=>{if(e.preventDefault(),e.button===this.mouseButtons.ORBIT)"rotate"===this.mouseGestures.leftClickDrag&&this.enableRotate&&(this.rotateStart.set(e.clientX,e.clientY),this.state=0),"pan"===this.mouseGestures.leftClickDrag&&this.enablePan&&(this.panStart.set(e.clientX,e.clientY),this.state=2);else if(e.button===this.mouseButtons.ZOOM){if(!1===this.enableZoom)return;this.dollyStart.set(e.clientX,e.clientY),this.state=1}else if(e.button===this.mouseButtons.PAN){if(!1===this.enablePan)return;this.panStart.set(e.clientX,e.clientY),this.state=2}this.state!==Fd&&(document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1),this.dispatchEvent(jd))},this.onMouseMove=e=>{if(e.preventDefault(),0===this.state){if("rotate"===this.mouseGestures.leftClickDrag&&this.enableRotate){this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart);const t=this.domElement===document?this.domElement.body:this.domElement;this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight*this.rotateSpeed),this.rotateStart.copy(this.rotateEnd)}"pan"===this.mouseGestures.leftClickDrag&&this.enablePan&&(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)),this.update()}else if(1===this.state){if(!1===this.enableZoom)return;this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyIn(Math.pow(.95,this.scrollZoomSpeed)):this.dollyDelta.y<0&&this.dollyOut(Math.pow(.95,this.scrollZoomSpeed)),this.dollyStart.copy(this.dollyEnd),this.update()}else if(2===this.state){if(!1===this.enablePan)return;this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.update()}},this.onMouseUp=()=>{document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this.dispatchEvent(Hd),this.state=Fd},this.onMouseWheel=e=>{!1===this.enableZoom||this.state!==Fd&&0!==this.state||(e.preventDefault(),e.stopPropagation(),e.deltaY<0?this.dollyOut(Math.pow(.95,this.scrollZoomSpeed)):e.deltaY>0&&this.dollyIn(Math.pow(.95,this.scrollZoomSpeed)),this.update(),this.dispatchEvent(jd),this.dispatchEvent(Hd))},this.onTouchStart=e=>{switch(e.touches.length){case 1:"rotate"===this.touchGestures.singleFingerDrag&&this.enableRotate&&(this.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),this.state=3),"pan"===this.touchGestures.singleFingerDrag&&this.enablePan&&(this.panStart.set(e.touches[0].pageX,e.touches[0].pageY),this.state=5);break;case 2:{const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);if(!1===this.enableZoom)return;this.dollyStart.set(0,i),this.state=4;break}case 3:if(!1===this.enablePan)return;this.panStart.set(e.touches[0].pageX,e.touches[0].pageY),this.state=5;break;default:this.state=Fd}this.state!==Fd&&this.dispatchEvent(jd)},this.onTouchMove=e=>{e.preventDefault(),e.stopPropagation();const t=this.domElement===document?this.domElement.body:this.domElement;switch(e.touches.length){case 1:"rotate"===this.touchGestures.singleFingerDrag&&3===this.state&&this.enableRotate&&(this.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight*this.rotateSpeed),this.rotateStart.copy(this.rotateEnd),this.update()),"pan"===this.touchGestures.singleFingerDrag&&5===this.state&&this.enablePan&&(this.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),this.panDelta.subVectors(this.panEnd,this.panStart),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.update());break;case 2:{const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);if(!1===this.enableZoom||4!==this.state)return;this.dollyEnd.set(0,i),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(Math.pow(.95,this.pinchZoomSpeed)):this.dollyDelta.y<0&&this.dollyIn(Math.pow(.95,this.pinchZoomSpeed)),this.dollyStart.copy(this.dollyEnd),this.update();break}case 3:if(!1===this.enablePan)return;if(5!==this.state)return;this.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),this.panDelta.subVectors(this.panEnd,this.panStart),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.update();break;default:this.state=Fd}},this.onTouchEnd=()=>{this.dispatchEvent(Hd),this.state=Fd},this.onContextMenu=e=>{e.preventDefault()},this.domElement.addEventListener("contextmenu",this.onContextMenu,!1),this.domElement.addEventListener("mousedown",this.onMouseDown,!1),this.domElement.addEventListener("wheel",this.onMouseWheel,!1),this.domElement.addEventListener("touchstart",this.onTouchStart,!1),this.domElement.addEventListener("touchend",this.onTouchEnd,!1),this.domElement.addEventListener("touchmove",this.onTouchMove,!1),this.update()}update(){const{position:e}=this.camera;return this.updateOffset.copy(e).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.overrideRotation?(this.spherical.theta=this.overrideTheta,this.spherical.phi=this.overridePhi,this.overrideRotation=!1):(this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi),this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.minPanBounds&&this.maxPanBounds&&(this.target.x=Math.max(this.minPanBounds.x,Math.min(this.maxPanBounds.x,this.target.x)),this.target.y=Math.max(this.minPanBounds.y,Math.min(this.maxPanBounds.y,this.target.y)),this.target.z=Math.max(this.minPanBounds.z,Math.min(this.maxPanBounds.z,this.target.z))),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),e.copy(this.target).add(this.updateOffset),this.camera.lookAt(this.target),!0===this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.camera.position)>Gd||8*(1-this.updateLastQuaternion.dot(this.camera.quaternion))>Gd)&&(this.dispatchEvent(kd),this.updateLastPosition.copy(this.camera.position),this.updateLastQuaternion.copy(this.camera.quaternion),this.zoomChanged=!1,!0)}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){const n=this.domElement===document?this.domElement.body:this.domElement,{position:i}=this.camera;this.panInternalOffset.copy(i).sub(this.target);let r=this.panInternalOffset.length();r*=Math.tan(this.camera.fov/2*Math.PI/180),this.panLeft(2*e*r/n.clientHeight,this.camera.matrix),this.panUp(2*t*r/n.clientHeight,this.camera.matrix)}dollyIn(e){this.scale/=e}dollyOut(e){this.scale*=e}getAutoRotationAngle(){return 2*Math.PI/60/(60*this.autoRotateSpeed)}setTarget(e){this.target.copy(e)}setRadius(e){this.spherical.radius=e,this.scale=1}etPanBounds(e,t){this.minPanBounds=new Kn(e.x,e.y,e.z),this.maxPanBounds=new Kn(t.x,t.y,t.z)}otateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}getPolarAngle(){return this.overrideRotation?this.overridePhi:this.spherical.phi}etDirection(){const e=(new Kn).setFromSpherical(this.spherical).normalize();return new Kn(-e.x,-e.y,-e.z)}ispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("wheel",this.onMouseWheel,!1),this.domElement.removeEventListener("touchstart",this.onTouchStart,!1),this.domElement.removeEventListener("touchend",this.onTouchEnd,!1),this.domElement.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)}reset(){this.target.copy(this.target0),this.camera.position.copy(this.position0),this.camera.zoom=this.zoom0,this.camera.updateProjectionMatrix(),this.dispatchEvent(kd),this.update(),this.state=Fd}saveState(){this.target0.copy(this.target),this.position0.copy(this.camera.position),this.zoom0=this.camera.zoom}}const Wd={hoverStart:()=>{},hoverEnd:()=>{},hoverAnimate:invertXAxis:!1,invertYAxis:!1},qd={vertical:40,horizontal:45};class Xd extends Vd{constructor(e,t,n,i,r){super(e,t,void 0,r),Object.defineProperty(this,"_enableHover",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"hasInitialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fov",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"captureMouse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isClickDragging",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"hoverStartAzimuth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"hoverStartPolar",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hoverSettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onMouseEnterLocal",{enumerable:!0,configurable:!0,writable:!0,value:()=>{!this.isClickDragging&&this.hasInitialized&&(this.hoverSettings.hoverStart(),this.hoverStartAzimuth=this.getAzimuthalAngle(),this.hoverStartPolar=this.getPolarAngle(),this.captureMouse=!0)}}),Object.defineProperty(this,"onMouseLeaveLocal",{enumerable:!0,configurable:!0,writable:!0,value:()=>{!this.isClickDragging&&this.hasStartingPosition&&(this.captureMouse=!1,this.hoverSettings.hoverAnimate(this.hoverStartAzimuth||1,this.hoverStartPolar||1,Xd.RESET_CAMERA_DURATION),this.hoverSettings.hoverEnd())}}),Object.defineProperty(this,"onMouseMoveLocal",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(1&e.buttons||void 0===e.buttons&&1===e.which?this.isClickDragging=!0:this.isClickDragging=!1,!this.captureMouse||this.isClickDragging||!this.hasStartingPosition)return;const t=e.target,n=t.offsetWidth,i=t.offsetHeight;let r=(e.offsetX-n/2)/n*45,o=(e.offsetY-i/2)/i*(this.fov.vertical||1);this.hoverSettings.invertXAxis&&(r*=-1),this.hoverSettings.invertYAxis&&(o*=-1);const s=this.hoverStartAzimuth+r*(Math.PI/180),a=this.hoverStartPolar+o*(Math.PI/180);this.hoverSettings.hoverAnimate(s,a,Xd.HOVER_CAMERA_DURATION)}}),this.fov=Object.assign(Object.assign({},qd),n),this.hoverSettings=Object.assign(Object.assign({},Wd),i),this.captureMouse=!0,this.hasInitialized=!1;const o=this.update.bind(this);this.update=()=>{const e=o();return this.hasInitialized||(this.hoverStartAzimuth=this.getAzimuthalAngle(),this.hoverStartPolar=this.getPolarAngle(),this.hasInitialized=!0),e},this.hoverStartAzimuth=this.getAzimuthalAngle(),this.hoverStartPolar=this.getPolarAngle()}get hasStartingPosition(){return void 0!==this.hoverStartAzimuth&&void 0!==this.hoverStartPolar&&this.hasInitialized}get enableHover(){return this._enableHover}set enableHover(e){this._enableHover=e,e?(this.domElement.addEventListener("mouseenter",this.onMouseEnterLocal),this.domElement.addEventListener("mouseleave",this.onMouseLeaveLocal),this.domElement.addEventListener("mousemove",this.onMouseMoveLocal)):(this.domElement.removeEventListener("mouseenter",this.onMouseEnterLocal),this.domElement.removeEventListener("mouseleave",this.onMouseLeaveLocal),this.domElement.removeEventListener("mousemove",this.onMouseMoveLocal))}Object.defineProperty(Xd,"RESET_CAMERA_DURATION",{enumerable:!0,configurable:!0,writable:!0,value:.01}),Object.defineProperty(Xd,"HOVER_CAMERA_DURATION",{enumerable:!0,configurable:!0,writable:!0,value:.08});const Yd={panning:!1,hover:!1,invertXAxis:!1,invertYAxis:!1,minZoom:1,maxZoom:1,containerPadding:30};class Zd{constructor(e,{aspectRatio:t,domElement:n}){var i,r,o,s,a;Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"controls",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"minZoom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxZoom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialZoom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"containerPadding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastPosition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialOrbitRadius",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_requiresUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"focalPointAnimation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotationAnimation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zoomAnimation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"focalPointResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lookAtPromiseResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zoomPromiseResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{panning:c,hover:l,invertXAxis:u,invertYAxis:h,minZoom:d,maxZoom:p,containerPadding:f}=Object.assign(Object.assign({},Yd),e);this.camera=new wo(40,t,5,3e3);const m=null!==(i=e.initialOrientation)&&void 0!==i?i:{azimuthAngle:0,polarAngle:Math.PI/2};if(this.controls=new Xd(this.camera,n,{vertical:40},{invertXAxis:u,invertYAxis:h},e.orbitOptions),this.controls.setRotation(m.azimuthAngle,m.polarAngle),e.initialFocalPoint){const t=e.initialFocalPoint;this.controls.setTarget(new Kn(t.x,t.y,t.z))}this.controls.rotateSpeed=null!==(r=e.rotationSpeed)&&void 0!==r?r:.07,this.controls.enableDamping=!0,this.controls.dampingFactor=.1,this.controls.enableHover=l,this.controls.enableRotate=l,this.controls.enablePan=c,this.minZoom=d,this.maxZoom=p,this.initialZoom=null!==(o=e.initialZoom)&&void 0!==o?o:1,this.controls.scrollZoomSpeed=null!==(s=e.scrollZoomSpeed)&&void 0!==s?s:1,this.controls.pinchZoomSpeed=null!==(a=e.pinchZoomSpeed)&&void 0!==a?a:1,this.containerPadding=f,this.controls.enableZoom=this.minZoom!==this.maxZoom,this.lastPosition=new Kn,this._requiresUpdate=!0,this.rotationAnimation={animating:!1,duration:2,elapsedTime:0,target:{azimuthAngle:0,polarAngle:0},initial:{azimuthAngle:0,polarAngle:0},easingFunction:Rd},this.focalPointAnimation={animating:!1,elapsedTime:0,duration:2,initialPoint:new Kn,targetPoint:new Kn,easingFunction:Rd},this.zoomAnimation={animating:!1,elapsedTime:0,duration:.5,targetZoom:0,initialZoom:0,easingFunction:Rd},this.initialOrbitRadius=Td}get requiresUpdate(){return this._requiresUpdate}get zoomFactor(){return this.initialOrbitRadius/this.controls.getOrbitRadius()}initializeCamera(e){const t=this.calculateOrbitRadius(e);this.controls.setRadius(t*this.initialZoom),this.controls.setRadiusLimits(this.minZoom*t,this.maxZoom*t),this.initialOrbitRadius=t;const n=.2*this.containerPadding;this.controls.setPanBounds(new Kn(-.5*e.width-n,-.5*e.height-n,-.5*e.depth-n),new Kn(.5*e.width+n,.5*e.height+n,.5*e.depth+n))}resizeCamera(e){const t=this.calculateOrbitRadius(e),n=this.zoomFactor;this.controls.setRadius(t/n),this.controls.setRadiusLimits(this.minZoom*t,this.maxZoom*t),this.initialOrbitRadius=t}computeZoom(e){return this.calculateOrbitRadius(e)/this.initialOrbitRadius}adjustZoomFactor(e,t=.5,n=Rd){return e>0&&e>=this.minZoom&&e<=this.maxZoom?(this.zoomPromiseResolver&&this.zoomPromiseResolver(),this.zoomAnimation.elapsedTime=0,this.zoomAnimation.duration=t,this.zoomAnimation.initialZoom=this.controls.getOrbitRadius()/this.initialOrbitRadius,this.zoomAnimation.targetZoom=e,this.zoomAnimation.animating=!0,this.zoomAnimation.easingFunction=n,new Promise((e=>{this.zoomPromiseResolver=e}))):Promise.resolve()}set aspectRatio(e){const t=this.controls.getAzimuthalAngle(),n=this.controls.getPolarAngle(),i=this.controls.getOrbitRadius();this.camera.aspect=e,this.camera.updateProjectionMatrix(),this.controls.setRotation(t,n),this.controls.setRadius(i),this.controls.setRadiusLimits(i*this.minZoom,i*this.maxZoom)}update(e){if(this.focalPointAnimation.animating){const t=this.focalPointAnimation,n=t.easingFunction(t.elapsedTime,t.initialPoint.x,t.targetPoint.x-t.initialPoint.x,t.duration),i=t.easingFunction(t.elapsedTime,t.initialPoint.y,t.targetPoint.y-t.initialPoint.y,t.duration),r=t.easingFunction(t.elapsedTime,t.initialPoint.z,t.targetPoint.z-t.initialPoint.z,t.duration);this.controls.setTarget(new Kn(n,i,r)),t.elapsedTime+=e,t.elapsedTime>t.duration&&(t.animating=!1,this.controls.setTarget(t.targetPoint),this.focalPointResolver&&this.focalPointResolver(),this.focalPointResolver=void 0)}if(this.rotationAnimation.animating){let t=this.controls.getAzimuthalAngle(),n=this.controls.getPolarAngle();const i=this.rotationAnimation;t=this.rotationAnimation.easingFunction(i.elapsedTime,i.initial.azimuthAngle,i.target.azimuthAngle-i.initial.azimuthAngle,i.duration),n=this.rotationAnimation.easingFunction(i.elapsedTime,i.initial.polarAngle,i.target.polarAngle-i.initial.polarAngle,i.duration),i.elapsedTime+=e,i.elapsedTime>i.duration&&(t=i.target.azimuthAngle,n=i.target.polarAngle,i.animating=!1,this.lookAtPromiseResolver&&this.lookAtPromiseResolver(),this.lookAtPromiseResolver=void 0),this.controls.setRotation(t,n)}if(this.zoomAnimation.animating){const t=this.zoomAnimation;let n=t.easingFunction(t.elapsedTime,t.initialZoom,t.targetZoom-t.initialZoom,t.duration);t.elapsedTime+=e,t.elapsedTime>t.duration&&(n=t.targetZoom,t.animating=!1,this.zoomPromiseResolver&&this.zoomPromiseResolver(),this.zoomPromiseResolver=void 0),this.controls.setRadius(this.initialOrbitRadius*n)}this.controls.update(),this._requiresUpdate=this.lastPosition.distanceTo(this.camera.position)>Md,this.lastPosition=this.camera.position.clone()}lookAt(e,t=2,n=Rd){this.lookAtPromiseResolver&&this.lookAtPromiseResolver();const i=this.normalizeOrientation({azimuthAngle:this.controls.getAzimuthalAngle(),polarAngle:this.controls.getPolarAngle()}),r=this.normalizeOrientation(e),o=Math.abs(r.azimuthAngle-i.azimuthAngle),s=Math.abs(r.polarAngle-i.polarAngle);return o<Md&&s<Md?Promise.resolve():(o>Math.PI&&(r.azimuthAngle>i.azimuthAngle?i.azimuthAngle+=Sd:r.azimuthAngle+=Sd),s>Math.PI&&(r.polarAngle>i.polarAngle?i.polarAngle+=Sd:r.polarAngle+=Sd),this.rotationAnimation.elapsedTime=0,this.rotationAnimation.duration=t,this.rotationAnimation.initial=i,this.rotationAnimation.target=r,this.rotationAnimation.animating=!0,this.rotationAnimation.easingFunction=n,new Promise((e=>{this.lookAtPromiseResolver=e})))}focusOn(e,t=2,n=Rd){return this.focalPointResolver&&this.focalPointResolver(),this.focalPointAnimation.duration=t,this.focalPointAnimation.initialPoint=this.controls.target,this.focalPointAnimation.targetPoint=e,this.focalPointAnimation.easingFunction=n,this.focalPointAnimation.animating=!0,this.focalPointAnimation.elapsedTime=0,new Promise((e=>{this.focalPointResolver=e}))}dispose(){this.focalPointResolver&&this.focalPointResolver(),this.lookAtPromiseResolver&&this.lookAtPromiseResolver(),this.zoomPromiseResolver&&this.zoomPromiseResolver(),this.controls.dispose()}calculateOrbitRadius(e){const t=Math.PI/180*40,n=2*Math.atan(this.camera.aspect*Math.tan(t/2)),i=(e.height/2+this.containerPadding)/Math.tan(t/2),r=(e.width/2+this.containerPadding)/Math.tan(n/2),o=(e.depth/2+this.containerPadding)/Math.tan(t/2);return Math.max(i,r,o)}get threeJsCamera(){return this.camera}normalizeOrientation(e){let t=e.azimuthAngle%Sd,n=e.polarAngle%Sd;return t<0&&(t+=Sd),n<0&&(n+=Sd),{azimuthAngle:t,polarAngle:n}}}function Jd(e,t){return e.adjustRotation({azimuth:0,polar:Math.PI/2,duration:t})}function $d(e,t){return e.adjustRotation({azimuth:Math.PI,polar:Math.PI/2,duration:t})}var Kd=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};const Qd=({renderingInstructionsUrl:e,category:t,preserveAlpha:n,tenant:i,fullBleed:r,dimensions:o,page:s,channel:a,trim:c})=>{const l=new URLSearchParams;return l.append("instructions_uri",e),l.append("scene",(({fullBleed:e,dimensions:t,page:n,channel:i,trim:r={topLeftX:0,topLeftY:0,bottomRightX:e.width,bottomRightY:e.height}})=>{const o={width:t.width,height:t.height,page:n,channel:i,product:{bleed:e,trim:r}};return`https://cdn.scenes.documents.cimpress.io/v3/transient?data=${encodeURIComponent(JSON.stringify(o))}`})({fullBleed:r,dimensions:o,page:s,channel:a,trim:c})),n&&l.append("format","png"),!n&&l.append("format","jpg"),!n&&l.append("bgColor","FFFFFF"),t&&l.append("category",t),l.append("showerr","true"),`https://rendering.documents.cimpress.io/v2/${i}/preview?width=${o.width}&${l.toString()}`},ep=({tenant:e,category:t})=>{let n={};return{generateDocumentCanvases({surfaces:i,renderingInstructionsUrl:r,renderingInstructionsUrlOverrides:o=[]}){return Kd(this,void 0,void 0,(function*(){const s=i.map((n=>{var i,s,a;return{renderingUrl:Qd({renderingInstructionsUrl:null!==(s=null===(i=o.find(())||void 0===i?void 0:i.renderingInstructionsUrl)&&void 0!==s?s:r,dimensions:n.textureSize,page:n.page,fullBleed:n.fullBleed,category:t,preserveAlpha:null!==(a=n.preserveAlpha)&&void 0!==a&&a,tenant:e,channel:n.channel,trim:n.trim}),surface:n}})).map((({renderingUrl:e,surface:t})=>Kd(this,void 0,void 0,(function*(){var i;const r=yield Jh(e),o=`${t.page} ${null!==(i=t.channel)&&void 0!==i?i:"none"}`;n[o]||(n[o]=document.createElement("canvas"));const s=n[o],a=s.getContext("2d"),{width:c,height:l}=t.textureSize;return s.width=c,s.height=l,a.clearRect(0,0,c,l),a.drawImage(r,0,0,c,l),{surface:Object.assign(Object.assign({},t),{trim:void 0}),canvas:s}}))));return Promise.all(s)}))},dispose(){ed(Object.values(n)),n={}}}};class tp{constructor(e,t,n,i){Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preview",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"product",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastIntersection",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"CLICK_DISTANCE_THRESHOLD",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"mouseDownPosition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onMouseDown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.getIntersection(e)&&(this.mouseDownPosition=new Hn(e.clientX,e.clientY))}}),Object.defineProperty(this,"onMouseUp",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.getIntersection(e);if(t&&this.mouseDownPosition){const n=new Hn(e.clientX,e.clientY);this.mouseDownPosition.distanceTo(n)<this.CLICK_DISTANCE_THRESHOLD&&this.triggerEvents("click",t.surface,t.intersection)}this.mouseDownPosition=void 0}}),Object.defineProperty(this,"onMouseMove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,n,i;const r=this.getIntersection(e);this.lastIntersection&&(null===(t=this.lastIntersection)||void 0===t?void 0:t.intersection.object.id)!==(null===(n=null==r?void 0:r.intersection)||void 0===n?void 0:n.object.id)&&this.triggerEvents("mouseout",this.lastIntersection.surface,this.lastIntersection.intersection),r&&(null===(i=this.lastIntersection)||void 0===i?void 0:i.intersection.object.id)!==r.intersection.object.id&&this.triggerEvents("mousein",r.surface,r.intersection),r&&this.triggerEvents("mousemove",r.surface,r.intersection),this.lastIntersection=r}}),this.canvas=e,this.preview=t,this.scene=n,this.camera=i,this.eventMap={click:[],mousein:[],mouseout:[],mousemove:[],stateChange:[],cameraChange:[]},e.addEventListener("mousedown",this.onMouseDown,!1),e.addEventListener("mouseup",this.onMouseUp,!1),e.addEventListener("mousemove",this.onMouseMove,!1)}addListener(e,t){"stateChange"===e?this.eventMap.stateChange.push(t):"cameraChange"===e?this.eventMap.cameraChange.push(t):this.eventMap[e].push(t)}removeListener(e,t){let n=-1;n="stateChange"===e?this.eventMap.stateChange.indexOf(t):"cameraChange"===e?this.eventMap.cameraChange.indexOf(t):this.eventMap[e].indexOf(t),-1!==n?this.eventMap[e].splice(n,1):console.warn("Listener to remove can't be found",{type:e,listener:t,eventMap:this.eventMap})}setProduct(e){this.product=e}triggerStateChangeEvent(e){this.eventMap.stateChange.forEach((t=>t(e)))}triggerCameraChangeEvent(e){this.eventMap.cameraChange.forEach((t=>t(e)))}dispose(){this.canvas.removeEventListener("mousedown",this.onMouseDown,!1),this.canvas.removeEventListener("mouseup",this.onMouseUp,!1),this.canvas.removeEventListener("mousemove",this.onMouseMove,!1),this.lastIntersection=void 0,this.mouseDownPosition=void 0}getIntersection(e){const t=function(e,t,n){const i=n.getBoundingClientRect(),r=e-i.left,o=t-i.top;return new Hn(r/i.width*2-1,-o/i.height*2+1)}(e.clientX,e.clientY,this.canvas),n=(i=t,r=this.camera.threeJsCamera,o=this.scene,ad.setFromCamera(i,r),ad.intersectObjects(o.children,!0));var i,r,o;if(this.product&&n){const e=this.product.getSurfaceMapping();for(const t of n)if(e[t.object.uuid])return{surface:e[t.object.uuid],intersection:t}}}triggerEvents(e,t,n){const i={type:e,preview:this.preview,surfaceId:n.object.uuid,surface:t,position:this.getLocation(t,n),srcElement:this.canvas};this.eventMap[e].forEach((e=>e(i)))}getLocation(e,t){const n={x:0,y:0};if(e&&t.uv){const i={u:t.uv.x,v:t.uv.y},{x:r,y:o}=function(e,t){if(t.trim){const n=t.trim.bottomRightX-t.trim.topLeftX,i=t.trim.bottomRightY-t.trim.topLeftY,r=e.u*n+t.trim.topLeftX,o=(1-e.v)*i+t.trim.topLeftY;return new Hn(r,o)}const n=e.u*t.fullBleed.width,i=(1-e.v)*t.fullBleed.height;return new Hn(n,i)}(i,e);n.x=r,n.y=o}return{world:{x:t.point.x,y:t.point.y,z:t.point.z},surface:n}}}var np;!function(e){e[e.metallic=0]="metallic",e[e.raisedInk=1]="raisedInk",e[e.raisedFoilGold=2]="raisedFoilGold",e[e.raisedFoilSilver=3]="raisedFoilSilver",e[e.glitter=4]="glitter"}(np||(np={}));var ip=),rp="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,op=void 0!==n.g&&n.g.Math===Math?n.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),sp="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(op):ap=["top","right","bottom","left","width","height","size","weight"],cp="undefined"!=typeof MutationObserver,lp=),up=hp=dp=vp(0,0,0,0);r mp="undefined"!=typeof SVGGraphicsElement?r yp=),bp=xp=),wp="undefined"!=typeof WeakMap?new WeakMap:new ip,_p=["observe","unobserve","disconnect"].forEach(();var Mp=void 0!==op.ResizeObserver?op.ResizeObserver:_p;class Sp{constructor(e){if(Object.defineProperty(this,"environment",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"materialMap",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"hightLightMap",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"documentCanvases",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"tempCanvases",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"materialTextures",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"materialImages",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"materialCanvases",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"renderingOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.renderingOptions=e.renderingOptions,this.renderingOptions.minimumRenderSize&&!Cd(this.renderingOptions.minimumRenderSize))throw new Error("Minium render size must be a power of two!");if(this.renderingOptions.maximumRenderSize&&!Cd(this.renderingOptions.maximumRenderSize))throw new Error("Maximum render size must be a power of two!");this.environment=e.environment}getDocumentSurfaces(e){const t={},n=e.getSurfaceMapping();return Object.values(n).forEach((e=>{if(e.page){const n=`${e.page} none`;if(t[n]?(e.substrate.supportsTransparency||e.substrate.requiresDocumentTransparency)&&(t[n].preserveAlpha=!0):t[n]={page:e.page,fullBleed:e.fullBleed,trim:e.trim,textureSize:this.getTextureSize(e),preserveAlpha:e.substrate.supportsTransparency||e.substrate.requiresDocumentTransparency},e.finishes)for(const i of e.finishes){const n=`${e.page} ${i.channel}`;t[n]||(t[n]={page:e.page,channel:i.channel,fullBleed:e.fullBleed,trim:e.trim,textureSize:this.getTextureSize(e),preserveAlpha:!0})}}})),Object.values(t)}setDocumentCanvas(e,t){var n;const i=`${e.page} ${null!==(n=e.channel)&&void 0!==n?n:"none"}`;this.documentCanvases[i]||(this.documentCanvases[i]=document.createElement("canvas"));const r=this.documentCanvases[i].getContext("2d"),{width:o,height:s}=e.textureSize;if(this.documentCanvases[i].width=o,this.documentCanvases[i].height=s,r.clearRect(0,0,o,s),e.preserveAlpha||(r.fillStyle="white",r.fillRect(0,0,o,s)),e.trim){const n=e.trim.topLeftX/e.fullBleed.width*t.width,i=e.trim.topLeftY/e.fullBleed.height*t.height,a=(e.trim.bottomRightX-e.trim.topLeftX)/e.fullBleed.width*t.width,c=(e.trim.bottomRightY-e.trim.topLeftY)/e.fullBleed.height*t.height;r.drawImage(t,Math.floor(n),Math.floor(i),Math.floor(a),Math.floor(c),0,0,o,s)}else r.drawImage(t,0,0,o,s)}updateColor(e,t){if(!this.materialMap[e])return;const n=this.materialMap[e];n.color=t,n.needsUpdate=!0}restoreColor(e){if(!this.materialMap[e])return;const t=this.materialMap[e];t.color=this.hightLightMap[e].clone(),t.needsUpdate=!0}setWireframes(e){this.materialMap&&Object.values(this.materialMap).forEach(()}fetchMaterialTextures(e){return function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){const t=e.getSurfaceMapping(),n={};if(this.environment.reflectionUrl&&!n[this.environment.reflectionUrl]&&(n[this.environment.reflectionUrl]=Jh(this.environment.reflectionUrl)),this.environment.reflectionUrls)for(const e of this.environment.reflectionUrls)n[e]||(n[e]=Jh(e));Object.keys(t).forEach((e=>{const{substrate:i,finishes:r}=t[e];if(i.baseTexture&&!n[i.baseTexture.sourceUrl]&&(n[i.baseTexture.sourceUrl]=Jh(i.baseTexture.sourceUrl)),i.bumpTexture&&!n[i.bumpTexture.sourceUrl]&&(n[i.bumpTexture.sourceUrl]=Jh(i.bumpTexture.sourceUrl)),i.specularTexture&&!n[i.specularTexture.sourceUrl]&&(n[i.specularTexture.sourceUrl]=Jh(i.specularTexture.sourceUrl)),i.alphaTexture&&!n[i.alphaTexture.sourceUrl]&&(n[i.alphaTexture.sourceUrl]=Jh(i.alphaTexture.sourceUrl)),i.overlayTexture&&!n[i.overlayTexture.sourceUrl]&&(n[i.overlayTexture.sourceUrl]=Jh(i.overlayTexture.sourceUrl)),i.reflectionMapOverrideUrls)for(const t of i.reflectionMapOverrideUrls)n[t]||(n[t]=Jh(t));r&&r.forEach((e=>{if(e.baseTexture&&!n[e.baseTexture.sourceUrl]&&(n[e.baseTexture.sourceUrl]=Jh(e.baseTexture.sourceUrl)),e.specularTexture&&!n[e.specularTexture.sourceUrl]&&(n[e.specularTexture.sourceUrl]=Jh(e.specularTexture.sourceUrl)),e.alphaTexture&&!n[e.alphaTexture.sourceUrl]&&(n[e.alphaTexture.sourceUrl]=Jh(e.alphaTexture.sourceUrl)),e.reflectionMapOverrideUrls)for(const t of e.reflectionMapOverrideUrls)n[t]||(n[t]=Jh(t))}))}));const i=[];Object.keys(n).forEach((e=>{i.push(new Promise((t=>{n[e].then((n=>{this.materialImages[e]=n,t()}))})))})),yield Promise.all(i)}))}updateTextures(e,t){this.flushDocumentAssets();const n=e.getSurfaceMapping();this.buildMaterialMap(n,t),Object.keys(t).forEach((e=>{if(!this.materialMap[e])throw new Error(`No product surface was defined for mesh: ${e}`);{const n=this.materialMap[e];t[e].geometry.morphTargetsRelative&&(n.morphTargets=!0),t[e].material=n}}))}getTextureSize(e){var t,n;const i=e.fullBleed.width/e.fullBleed.height,r=null!==(t=this.renderingOptions.minimumRenderSize)&&void 0!==t?t:1024,o=null!==(n=this.renderingOptions.maximumRenderSize)&&void 0!==n?n:2048;let s,a;return i>1.5?(s=o,a=r):i>.5?(s=o,a=o):(a=o,s=r),{width:s,height:a}}dispose(){this.flushDocumentAssets(),ed([...Object.values(this.documentCanvases),...Object.values(this.materialCanvases)]),this.materialImages={},this.materialCanvases={}}flushDocumentAssets(){ed(Object.values(this.tempCanvases)),Object.values(this.materialTextures).forEach((),this.tempCanvases={},this.materialTextures={},this.materialMap={},this.hightLightMap={}}buildMaterialMap(e,t){Object.keys(e).forEach((n=>{const i=e[n];this.loadAndMapSubstrate(n,i,t),i.finishes&&i.finishes.forEach((e=>{const r=`${n}-${e.name}`;this.loadAndMapFinish(r,e,i,t)}))}))}loadAndMapSubstrate(e,t,n){var i;if(this.environment){const r=function(e,t,n,i,r,o,s,a,c){var l,u,h,d,p,f,m,g,v,y,b,x,w;const _=id(t),{substrate:M}=t,S=new Nl({shininess:M.shininess,emissive:null!==(l=M.emissive)&&void 0!==l?l:0,opacity:null!==(u=M.opacity)&&void 0!==u?u:1,transparent:!0});if(M.fullyTransparent)return S;M.supportsTransparency&&(S.depthWrite=!1,S.side=ne),M.side&&(M.side===Wh.front?S.side=ee:M.side===Wh.back?S.side=te:S.side=ne);const E=new br(M.color),T=null!==(h=M.baseColorMode)&&void 0!==h?h:Yh.normal;if(M.baseTexture){const{key:t}=rd(M.baseTexture,n,_,r,o),{key:i,canvas:l}=function(e,t,n,i){const r=`${n}-${e.r}-${e.g}-${e.b}-${t}`;if(i[r])return{key:r,canvas:i[r]};const o=`#${e.getHexString()}`,s=i[n];if(t===Yh.normal){const e=Kh({width:s.width,height:s.height},o);return i[r]=Qh(e,s,Yh.normal,"tile"),ed([e]),{key:r,canvas:i[r]}}if(t===Yh.multiply){if(1===e.r&&1===e.g&&1===e.b)return{key:n,canvas:s};const t=Kh({width:s.width,height:s.height},o);return i[r]=Qh(s,t,Yh.sourceIn,"tile"),ed([t]),{key:r,canvas:i[r]}}return{key:n,canvas:s}}(E,T,t,o);if(e){const t=`${e}-${i}-${null===(d=M.overlayTexture)||void 0===d?void 0:d.sourceUrl}`;if(!s[t]){const n=Qh(l,a[e],null!==(p=M.baseCompositeMode)&&void 0!==p?p:Yh.normal,"tile");if(M.overlayTexture){const e=Qh(n,r[M.overlayTexture.sourceUrl],null!==(f=M.overlayTexture.compositeMode)&&void 0!==f?f:Yh.normal,"stretch");c[t]=e,s[t]=nd(e)}else c[t]=n,s[t]=nd(n)}S.map=s[t]}else{const e=`${i}-${null===(m=M.overlayTexture)||void 0===m?void 0:m.sourceUrl}`;if(!s[e])if(M.overlayTexture){const t=Qh(l,r[M.overlayTexture.sourceUrl],null!==(g=M.overlayTexture.compositeMode)&&void 0!==g?g:Yh.normal,"stretch");s[e]=nd(t)}else s[e]=nd(l);S.map=s[e]}}else if(e){const t=`#${new br(M.color).getHexString()}`,i=`${e}-${t}-${null===(v=M.overlayTexture)||void 0===v?void 0:v.sourceUrl}`;if(!s[i]){const o=Kh(n,t),l=Qh(o,a[e],null!==(y=M.baseCompositeMode)&&void 0!==y?y:Yh.normal,"tile");if(M.overlayTexture){const e=Qh(l,r[M.overlayTexture.sourceUrl],null!==(b=M.overlayTexture.compositeMode)&&void 0!==b?b:Yh.normal,"stretch");c[i]=e,s[i]=nd(e)}else c[i]=l,s[i]=nd(l);ed([o])}S.map=s[i]}else if(S.color=E,S.side=ne,M.overlayTexture){const e=`#${new br(M.color).getHexString()}`,t=`${e}-${null===(x=M.overlayTexture)||void 0===x?void 0:x.sourceUrl}`;if(!s[t]){const i=Kh(n,e),o=Qh(i,r[M.overlayTexture.sourceUrl],null!==(w=M.overlayTexture.compositeMode)&&void 0!==w?w:Yh.normal,"stretch");s[t]=nd(o),ed([i])}S.map=s[t]}return M.reflectivity&&(S.reflectivity=M.reflectivity,S.envMap=sd(r,s,i,M.reflectionMapOverrideUrls)),M.bumpTexture&&M.bumpScale&&(S.bumpScale=M.bumpScale,S.bumpMap=od(M.bumpTexture,n,_,r,o,s).texture),M.specularTexture&&(S.specularMap=od(M.specularTexture,n,_,r,o,s).texture),M.alphaTexture&&(S.alphaMap=od(M.alphaTexture,n,_,r,o,s).texture),S}(t.page?`${t.page} none`:void 0,t,this.getTextureSize(t),this.environment,this.materialImages,this.materialCanvases,this.materialTextures,this.documentCanvases,this.tempCanvases);(null==n?void 0:n[e])instanceof lc&&(r.skinning=null!==(i=n[e].material.skinning)&&void 0!==i&&i),this.materialMap[e]=r.clone(),this.hightLightMap[e]=r.color.clone()}}loadAndMapFinish(e,t,n,i){var r,o;if(this.environment){if(!n.page)throw new Error(`A page number must exist in the surface map to show to show finish: '${t.channel}'!`);const s=`${n.page} none`,a=`${n.page} ${t.channel}`;if(!this.documentCanvases[s])throw new Error(`No document information exists for page ${n.page}!`);if(!this.documentCanvases[a])throw new Error(`No finish information exists on page ${n.page} for finish '${t.channel}'!`);const c=function(e,t,n,i,r,o,s,a,c,l,u){const h=id(i),d=new Nl({transparent:!0,shininess:n.shininess});n.reflectivity&&(d.reflectivity=n.reflectivity,d.envMap=sd(s,c,o,n.reflectionMapOverrideUrls));const p=`${e}-${t}-map`;if(!c[p]){let i=l[e];n.baseTexture&&(i=rd(n.baseTexture,r,h,s,a).canvas,n.baseCompositeMode!==Yh.normal&&(u[p]=Qh(i,l[e],n.baseCompositeMode,"tile"),i=u[p])),u[p]=Qh(i,l[t],Yh.mask,"tile"),c[p]=nd(u[p])}if(d.map=c[p],d.bumpScale=n.bumpScale,n.bumpMode===Xh.generate){const e=`${t}-bump`;c[e]||(c[e]=nd(l[t])),d.bumpMap=c[e]}else d.bumpMap=c[p];return n.specularTexture&&(d.specularMap=od(n.specularTexture,r,h,s,a,c).texture),n.alphaTexture&&(d.alphaMap=od(n.alphaTexture,r,h,s,a,c).texture),d}(s,a,t,n,this.getTextureSize(n),this.environment,this.materialImages,this.materialCanvases,this.materialTextures,this.documentCanvases,this.tempCanvases);(null==i?void 0:i[e])instanceof lc&&(c.skinning=null!==(r=i[e].material.skinning)&&void 0!==r&&r),this.materialMap[e]=c.clone(),this.hightLightMap[e]=c.color.clone(),(null==i?void 0:i[e])instanceof lc&&(c.skinning=null!==(o=i[e].material.skinning)&&void 0!==o&&o),this.materialMap[e]=c.clone(),this.hightLightMap[e]=c.color.clone()}}}var Ep=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};class Tp{constructor(e){var t,n,i;Object.defineProperty(this,"vortexProduct",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"productLoadingOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"environment",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"materialManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webGlOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"renderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rafId",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"canvasResizeObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"productRequiresUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"canvasRequiresUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"holdRenderForUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cameraOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"areaLights",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentGeometry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maximumGeometrySize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stateBounds",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"meshMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"normalizationFactor",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"clock",{enumerable:!0,configurable:!0,writable:!0,value:new fh}),Object.defineProperty(this,"animationManager",{enumerable:!0,configurable:!0,writable:!0,value:new q}),Object.defineProperty(this,"boundingBox",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"boxHelper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disposed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"renderLoop",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.clock.getDelta();this.renderFrame(e),this.rafId=requestAnimationFrame(this.renderLoop)}}),this.environment=e.environment,this.cameraOptions=e.cameraOptions,this.canvas=e.canvas;const r=e.canvas.getBoundingClientRect();this.materialManager=new Sp(e),this.webGlOptions=null!==(t=e.webGlOptions)&&void 0!==t?t:{preserveDrawingBuffer:!1};const{preserveDrawingBuffer:o}=this.webGlOptions;this.renderer=new Ba({antialias:!0,alpha:!0,canvas:this.canvas,preserveDrawingBuffer:o}),this.renderer.setPixelRatio(Math.max(2,devicePixelRatio)),this.renderer.setClearColor(0,0),this.camera=new Zd(this.cameraOptions,{aspectRatio:r.width/r.height,domElement:this.canvas}),this.scene=new ka,this.eventManager=new tp(this.canvas,this,this.scene,this.camera);const s=null!==(i=null===(n=this.environment.lightingOptions)||void 0===n?void 0:n.ambientIntensity)&&void 0!==i?i:1;this.scene.add(new qu(1118481,11.1504*s)),this.canvasResizeObserver=new Mp((e=>{if(0===e.length)return;const{width:t,height:n}=e[0].contentRect;this.camera.aspectRatio=t/n,this.renderer.setSize(t,n,!1),this.currentGeometry&&this.maximumGeometrySize&&(this.camera.resizeCamera(this.maximumGeometrySize),this.canvasRequiresUpdate=!0)}))}get product(){return this.vortexProduct}get getProductGeometry(){return this.currentGeometry}start(){const e=!!this.vortexProduct;if(e&&!this.rafId)this.renderLoop();else if(!e)throw new Error("Vortex it not initialized")}load(e,t,n){var i,r,o,s,a,c,l,u;return Ep(this,void 0,void 0,(function*(){this.holdRenderForUpdate=!0,!!this.vortexProduct&&(null===(i=this.vortexProduct)||void 0===i||i.dispose(),this.materialManager.dispose(),this.areaLights&&this.scene.remove(...this.areaLights),this.currentGeometry&&this.scene.remove(this.currentGeometry),this.productRequiresUpdate=!0),this.vortexProduct=e,this.productLoadingOptions=n,this.currentGeometry=yield this.loadGeometry(this.vortexProduct),this.scene.add(this.currentGeometry);const h=e.getCurrentState().boundingBox;h&&(this.boundingBox=Od(h,this.normalizationFactor)),this.webGlOptions.renderBoundingBox&&(this.boxHelper=new Gh(null!==(r=this.boundingBox)&&void 0!==r?r:this.currentGeometry,new br(0)),this.scene.add(this.boxHelper)),this.scene.updateMatrixWorld(),this.stateBounds=yield Ld(this,e,this.currentGeometry,this.normalizationFactor);const d=null!==(a=null===(s=null===(o=this.environment)||void 0===o?void 0:o.lightingOptions)||void 0===s?void 0:s.pointLightIntensity)&&void 0!==a?a:1,p=null!==(u=null===(l=null===(c=this.environment)||void 0===c?void 0:c.lightingOptions)||void 0===l?void 0:l.directionalLightIntensity)&&void 0!==u?u:1;this.areaLights=e.getAreaLights(d,p),this.scene.add(...this.areaLights),this.observeResize(),this.eventManager.setProduct(e),this.vortexProduct&&this.meshMap&&(yield function(e,t,n){var i,r;return Nd(this,void 0,void 0,(function*(){const o=e.getSurfaceMapping(),s=e.getCurrentState().id,a=e.getStates();for(const e of a)if(e.allowGeneratedFocalPoints){yield Dd(e.id,n);for(const s in o){const a=o[s];if(a.page)if(a.focalPoint){const{focalPoint:o}=a;if(null===(i=o.allowedStates)||void 0===i?void 0:i.includes(e.id))continue;{const i=Ud(s,t[s],n.scene);if(i){const t=o.cameraView,n=new Kn(-i.x,-i.y,-i.z);Math.abs(t.x-n.x)<Md&&Math.abs(t.y-n.y)<Md&&Math.abs(t.z-n.z)<Md&&(null===(r=o.allowedStates)||void 0===r||r.push(e.id))}}}else if(t[s]){const i=Ud(s,t[s],n.scene);i&&(a.focalPoint={cameraView:new Kn(-i.x,-i.y,-i.z),allowedStates:[e.id]})}}}yield Dd(s,n)}))}(this.vortexProduct,this.meshMap,this)),yield Promise.all([this.materialManager.fetchMaterialTextures(e),t(this.materialManager.getDocumentSurfaces(e)).then((e=>{e.forEach(()}))]),this.materialManager.updateTextures(e,this.meshMap),this.webGlOptions.renderWireframes&&this.materialManager.setWireframes(this.webGlOptions.renderWireframes),this.holdRenderForUpdate=!1,this.disposed&&this.dispose()}))}update(e){return Ep(this,void 0,void 0,(function*(){if(this.disposed)console.warn("update called on disposed preview");else{if(this.vortexProduct&&this.materialManager){const t=yield e(this.materialManager.getDocumentSurfaces(this.vortexProduct));for(const e of t)this.materialManager.setDocumentCanvas(e.surface,e.canvas)}this.disposed?this.dispose():(this.holdRenderForUpdate=!0,this.vortexProduct&&this.meshMap&&this.materialManager.updateTextures(this.vortexProduct,this.meshMap),this.productRequiresUpdate=!0,this.holdRenderForUpdate=!1)}}))}getCameraView(){return{focalPoint:{x:this.camera.controls.target.x,y:this.camera.controls.target.y,z:this.camera.controls.target.z},zoom:1/this.camera.zoomFactor,rotation:{azimuth:this.camera.controls.getAzimuthalAngle(),polar:this.camera.controls.getPolarAngle()}}}setMouseGesture(e,t){this.camera.controls.mouseGestures[e]=t}setTouchGesturedjustZoom({zoom:e,duration:t,easingFunction:n}){return this.camera.adjustZoomFactor(e,t,n)}adjustFocalPoint({point:e,duration:t,easingFunction:n}){return this.camera.focusOn(new Kn(e.x,e.y,e.z),t,n)}adjustRotation({azimuth:e,polar:t,duration:n,easingFunction:i}){return this.camera.lookAt({azimuthAngle:e,polarAngle:t},n,i)}updateWebGlOptions(e){var t;!this.webGlOptions.renderBoundingBox&&e.renderBoundingBox&&this.currentGeometry?(this.boxHelper||(this.boxHelper=new Gh(null!==(t=this.boundingBox)&&void 0!==t?t:this.currentGeometry,new br(0))),this.scene.add(this.boxHelper)):this.webGlOptions.renderBoundingBox&&!1===e.renderBoundingBox&&this.boxHelper&&this.scene.remove(this.boxHelper),this.webGlOptions=Object.assign(this.webGlOptions,e),void 0!==this.webGlOptions.renderWireframes&&this.materialManager.setWireframes(this.webGlOptions.renderWireframes),this.productRequiresUpdate=!0}addHighlight({surfaceId:e,color:t}){this.materialManager.updateColor(e,t?new br(t):new br(1,1,.3)),this.productRequiresUpdate=!0}removeHighlight({surfaceId:e}){this.materialManager.restoreColor(e),this.productRequiresUpdate=!0}addEventListener(e,t){this.eventManager.addListener(e,t)}ocusOnSurface({surfaceId:e,duration:t,easingFunction:n}){return Ep(this,void 0,void 0,(function*(){if(!this.vortexProduct)throw new Error("Vortex Product must be defined before a surface can be focused on!");const{focalPoint:i}=this.vortexProduct.getSurfaceMapping()[e];if(i){const{cameraView:e}=i,r=new Kn(-e.x,-e.y,-e.z),o=(new Dh).setFromVector3(r),s=this.lookAtAngle({azimuth:o.theta,polar:o.phi,duration:t,easingFunction:n});if(i.allowedStates&&i.allowedStates.length>0){const e=this.vortexProduct.getCurrentState();i.allowedStates.includes(e.id)||(yield this.transitionState(i.allowedStates[0]))}yield s}return Promise.resolve()}))}getDocumentView({location:e,page:t,debugVisual:n}){var i,r,o;if(this.vortexProduct&&this.meshMap){const s=this.vortexProduct.getSurfaceMapping();for(const a of Object.keys(s)){const c=s[a],l=this.meshMap[a];if(c.page&&c.page===t){const{u:t,v:s}=cd(e,c),{geometry:a}=l;if(a instanceof Wr||a instanceof Wc){const e=l.matrixWorld,a=xd(t,s,l.geometry,e,this.scene,null!=n&&n);if(a){const e=(null===(i=c.focalPoint)||void 0===i?void 0:i.cameraView)?new Kn(-c.focalPoint.cameraView.x,-c.focalPoint.cameraView.y,-c.focalPoint.cameraView.z):a.normal,t=(new Dh).setFromVector3(e);return{cameraViewFocus:{point:a.position,rotation:{azimuth:t.theta,polar:t.phi}},allowedStates:null!==(o=null===(r=c.focalPoint)||void 0===r?void 0:r.allowedStates)&&void 0!==o?o:[]}}}}}}}focusOnDocument({page:e,location:t,polarLock:n,duration:i,easingFunction:r,debugSpheres:o}){return Ep(this,void 0,void 0,(function*(){const s=this.getDocumentView({location:t,page:e,debugVisual:o});s&&(yield this.adjustRotation({azimuth:s.cameraViewFocus.rotation.azimuth,polar:n?Math.PI/2:s.cameraViewFocus.rotation.polar,duration:null!=i?i:2,easingFunction:r}))}))}lookAtAngle({azimuth:e,polar:t,duration:n,easingFunction:i}){return this.camera.lookAt({azimuthAngle:e,polarAngle:void 0!==t?t:Math.PI/2},n,i)}transitionState(e,t){var n,i,r,o,s,a,c,l,u;return Ep(this,void 0,void 0,(function*(){if(this.vortexProduct){const h=this.vortexProduct.getCurrentState();if(e===h.id)return Promise.resolve();const d=this.vortexProduct.getStates().find((t=>t.id===e));if(!d)throw new Error(`'${e}' not found on product!`);if(d.dependency||h.dependency){const p=null!==(s=null!==(r=null!==(n=null==t?void 0:t.duration)&&void 0!==n?n:null===(i=d.dependency)||void 0===i?void 0:i.animationDuration)&&void 0!==r?r:null===(o=h.dependency)||void 0===o?void 0:o.animationDuration)&&void 0!==s?s:1,f=null!==(a=null==t?void 0:t.centerGeometry)&&void 0!==a&&a,m=null!==(c=null==t?void 0:t.scaleToFitGeometry)&&void 0!==c&&c;return d.boundingBox?(this.boundingBox=Od(d.boundingBox,this.normalizationFactor),null===(l=this.boxHelper)||void 0===l||l.setFromObject(this.boundingBox)):(this.currentGeometry&&(null===(u=this.boxHelper)||void 0===u||u.setFromObject(this.currentGeometry)),this.boundingBox=void 0),yield this.changeStateRecursively(this.vortexProduct,h,d,p,f,m,null==t?void 0:t.targetOrientation),this.vortexProduct.setCurrentState(e),this.eventManager.triggerStateChangeEvent({preview:this,state:d}),Promise.resolve()}throw new Error(`Cannot change to '${e}' because '${h.id}' has no dependencies!`)}throw new Error("Cannot change state, no vortex product loaded!")}))}performAction(e){return Ep(this,void 0,void 0,(function*(){const t=[];if(this.animationManager.cleanAnimations(),void 0!==e.animation&&(t.push(e.animation.start()),this.pushAnimation(e.animation)),e.cameraOptions&&e.cameraOptions.targetOrientation&&t.push(this.adjustRotation({azimuth:e.cameraOptions.targetOrientation.azimuthAngle,polar:e.cameraOptions.targetOrientation.polarAngle,duration:e.cameraOptions.duration,easingFunction:e.cameraOptions.easingFunction})),e.cameraOptions&&e.cameraOptions.geometrySize){const n={width:e.cameraOptions.geometrySize.width*this.normalizationFactor,height:e.cameraOptions.geometrySize.height*this.normalizationFactor,depth:e.cameraOptions.geometrySize.depth*this.normalizationFactor},i=this.camera.computeZoom(n);t.push(this.camera.adjustZoomFactor(i,e.cameraOptions.duration))}if(e.modelOptions&&this.currentGeometry&&e.modelOptions.center){const n={duration:e.modelOptions.duration,initialBounds:e.modelOptions.center.initialBounds,targetBounds:e.modelOptions.center.targetBounds},i=new Bd(this.currentGeometry,n);t.push(i.start()),this.pushAnimation(i)}yield Promise.all(t)}))}dateBoundingBox(){var e,t;if(this.vortexProduct){const n=this.vortexProduct.getCurrentState();n.boundingBox?(this.boundingBox=Od(n.boundingBox,this.normalizationFactor),null===(e=this.boxHelper)||void 0===e||e.setFromObject(this.boundingBox)):this.currentGeometry&&(null===(t=this.boxHelper)||void 0===t||t.setFromObject(this.currentGeometry)),this.productRequiresUpdate=!0}}screenCapture(e="image/png"){this.holdRenderForUpdate=!0,this.renderer.render(this.scene,this.camera.threeJsCamera);const t=this.canvas.toDataURL(e);return this.holdRenderForUpdate=!1,t}renderFrame(e){var t,n,i,r,o;this.disposed?console.warn("Render called on a disposed preview!"):(this.camera.update(e),this.holdRenderForUpdate||(this.camera.requiresUpdate&&this.eventManager.triggerCameraChangeEvent({preview:this,cameraView:this.getCameraView()}),(this.camera.requiresUpdate||this.canvasRequiresUpdate||this.productRequiresUpdate||this.animationManager.requiresUpdate)&&(this.updateAnimations(e),this.renderer.render(this.scene,this.camera.threeJsCamera),(null===(i=null===(n=null===(t=this.environment)||void 0===t?void 0:t.shadowOptions)||void 0===n?void 0:n.canvasShadows)||void 0===i?void 0:i.enabled)&&function(e,t,n){var i,r,o,s,a,c;let l="";const u=null!==(i=t.softSpread)&&void 0!==i?i:2.5,h=null!==(r=t.hardSpread)&&void 0!==r?r:.5,d=null!==(o=t.hardOffset)&&void 0!==o?o:{x:0,y:.5};if(u>0){const i=e.offsetWidth*_d*u*n.zoomFactor;l+=Id?` drop-shadow(0px 0px ${(.5*i).toFixed(2)}px ${null!==(s=t.softColor)&&void 0!==s?s:"rgba(0,0,0,0.08)"})`:` drop-shadow(0px 0px ${i.toFixed(2)}px ${null!==(a=t.softColor)&&void 0!==a?a:"rgba(0,0,0,0.05)"})`}if(h>0&&!Id){const i=(e.offsetWidth*_d*h*n.zoomFactor).toFixed(2);l+=` drop-shadow(${(e.offsetWidth*_d*d.x*n.zoomFactor).toFixed(2)}px ${(e.offsetWidth*_d*d.y*n.zoomFactor).toFixed(2)}px ${i}px ${null!==(c=t.hardColor)&&void 0!==c?c:"rgba(0,0,0,0.04)"})`}e.style.filter=l}(this.canvas,this.environment.shadowOptions.canvasShadows,this.camera),this.vortexProduct&&this.vortexProduct.sync&&this.vortexProduct.sync({preview:this}),(null===(r=this.webGlOptions)||void 0===r?void 0:r.renderBoundingBox)&&(null===(o=this.boxHelper)||void 0===o||o.update()),this.productRequiresUpdate=!1,this.canvasRequiresUpdate=!1)))}dispose(){this.vortexProduct&&this.vortexProduct.dispose(),this.materialManager.dispose(),this.renderer.dispose(),this.canvasResizeObserver.disconnect(),this.eventManager.dispose(),this.camera.dispose(),cancelAnimationFrame(this.rafId),this.animationManager.cancelAnimations(),this.disposed=!0}observeResizeoadGeometry(e){var t,n,i,r;return Ep(this,void 0,void 0,(function*(){const o=yield e.getGeometry();this.meshMap=vd(o);const s=e.getStates(),a=e.getCurrentState().id,c=yield Ld(this,e,o);let l,u=0,h=new Kn;for(const e of s){const n=c[e.id].getSize(new Kn),i=n.x*n.y*n.z;i>u&&(u=i,h=n.clone()),(null===(t=this.productLoadingOptions)||void 0===t?void 0:t.scaleToInitialState)&&e.id===a&&(l=n.clone())}const d=Math.max(h.x,h.y,h.z),p=Td/d;return this.normalizationFactor=p,o.scale.multiplyScalar(p),o.position.multiplyScalar(p),this.maximumGeometrySize={width:(null!==(n=null==l?void 0:l.x)&&void 0!==n?n:h.x)*p,height:(null!==(i=null==l?void 0:l.y)&&void 0!==i?i:h.y)*p,depth:(null!==(r=null==l?void 0:l.z)&&void 0!==r?r:h.z)*p},this.camera.initializeCamera(this.maximumGeometrySize),o}))}createActionFromState(e,t,n,i,r,o,s,a){const c={id:n.id};if(n.dependency){const a=n.dependency.animationDirection===V.forward?V.backward:V.forward,l={animationId:n.dependency.animationId,direction:r?a:n.dependency.animationDirection,duration:i};if(c.animation=e.buildAnimation(l),o&&this.stateBounds[t.id]&&this.stateBounds[n.id]&&(c.modelOptions={duration:i,center:{initialBounds:r?this.stateBounds[n.id]:this.stateBounds[t.id],targetBounds:r?this.stateBounds[t.id]:this.stateBounds[n.id]}}),s&&this.stateBounds[t.id]&&this.stateBounds[n.id]){const e=(r?this.stateBounds[t.id]:this.stateBounds[n.id]).getSize(new Kn);c.cameraOptions={duration:i,geometrySize:{width:e.x/this.normalizationFactor,height:e.y/this.normalizationFactor,depth:e.z/this.normalizationFactor}}}}return a&&(c.cameraOptions?c.cameraOptions.targetOrientation=a:c.cameraOptions={duration:i,targetOrientation:a}),c}changeStateRecursively(e,t,n,i,r,o,s){var a,c;return Ep(this,void 0,void 0,(function*(){if(n.dependency&&n.dependency.stateId===t.id)return yield this.performAction(this.createActionFromState(e,t,n,i,!1,r,o,s)),n;if(t.dependency&&t.dependency.stateId===n.id)return yield this.performAction(this.createActionFromState(e,n,t,i,!0,r,o,s)),n;const l=e.getStates();let u=l.find((e=>{var t;return e.id===(null===(t=n.dependency)||void 0===t?void 0:t.stateId)}));if(!u||(null===(a=u.dependency)||void 0===a?void 0:a.stateId)!==n.id){let e=t;for(;;){const t=l.find(();if(!t)break;if((null===(c=t.dependency)||void 0===c?void 0:c.stateId)===n.id){u=t;break}e=t}}if(!u)throw new Error("Cannot find state stated in dependency");const h=yield this.changeStateRecursively(e,t,u,i,r,o,s);if(n.dependency&&n.dependency.stateId===h.id)return yield this.performAction(this.createActionFromState(e,t,n,i,!1,r,o,s)),n;if(h.dependency&&h.dependency.stateId===n.id)return yield this.performAction(this.createActionFromState(e,t,h,i,!0,r,o,s)),n;throw new Error("Did not play animation to move on to next state")}))}}const Ap=({partialCameraOptions:e,partialEnvironmentOptions:t,canvas:n})=>({cameraOptions:Object.assign(Object.assign({},{panning:!1,hover:!0,minZoom:.8,maxZoom:1.2,containerPadding:30}),e),environment:Object.assign(Object.assign(Object.assign({},{reflectionUrl:"https://vortex.documents.cimpress.io/environments/default/reflection.jpg",shadowOptions:{canvasShadows:{enabled:!0}}}),t),{shadowOptions:Object.assign(Object.assign({},{canvasShadows:{enabled:!0}}),{canvasShadows:Object.assign(Object.assign({},{enabled:!0}),null==t?void 0:t.canvasShadows)})}),renderingOptions:{},canvas:n});var Pp;!Pp||(Pp={}));var Lp="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};ar Rp={exports:{}},Cp=Ip=Cp,Np=Object.prototype.toString;function Dp(e){return"[object Array]"===Np.call(e)}p={isArray:Dp,isArrayBuffer:function(e){return"[object ArrayBuffer]"===Np.call(e)},isBuffer:isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:isString:function(e){return"string"==typeof e},isNumber:isObject:Up,isPlainObject:Bp,isUndefined:zp,isDate:function(e){return"[object Date]"===Np.call(e)},isFile:function(e){return"[object File]"===Np.call(e)},isBlob:isFunction:Fp,isStream:isURLSearchParams:isStandardBrowserEnv:forEach:kp,merge:extend:trim:stripBOM:,Hp=jp;ar Vp=Wp=jp;p.prototype.use=qp.prototype.eject=qp.prototype.forEach=var Xp,Yp,Zp,Jp,$p,Kp,Qp,ef,tf,nf,rf,of,sf,af,cf,lf,uf,hf,df=qp,pf=jp,ff=ar gf=jp,vf=yf=ff,bf={"Content-Type":"application/x-www-form-urlencoded"};ar wf,_f={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==_&&"[object process]"===Object.prototype.toString.call(_))&&(wf=function(){if(hf)return uf;hf=1;var e=jp,t=),n=function(){if(Kp)return $p;Kp=1;var e=jp;return $p=e.isStandardBrowserEnv()?{write:read:remove::{write:function(){},read:function(){return null},remove:function(){}},$p}(),i=Vp,r=function(){if(of)return rf;of=1;var e=ef?Qp:(ef=1,Qp=,t=nf?tf:(nf=1,tf=;return rf=(),o=function(){if(af)return sf;af=1;var e=jp,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return sf=sf}(),s=),a=mf();return uf=()),wf),transformRequest:[,transformResponse:[,timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:headers:{common:{Accept:"application/json, text/plain, */*"}}};gf.forEach(["delete","get","head"],(),gf.forEach(["post","put","patch"],();var Mf,Sf,Ef=_f,Tf=jp,Af=Ef;ar Lf=jp,Of=Rf=Pf(),Cf=Ef;ar Nf=jp,Df=zf={name:"axios",version:"0.21.4",description:"Promise based HTTP client for the browser and node.js",main:"index.js",scripts:{test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},repository:{type:"git",url:"https://github.com/axios/axios.git"},keywords:["xhr","http","ajax","promise","node"],author:"Matt Zabriskie",license:"MIT",bugs:{url:"https://github.com/axios/axios/issues"},homepage:"https://axios-http.com",devDependencies:{coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},browser:{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},jsdelivr:"dist/axios.min.js",unpkg:"dist/axios.min.js",typings:"./index.d.ts",dependencies:{"follow-redirects":"^1.14.0"},bundlesize:[{path:"./dist/axios.min.js",threshold:"5kB"}]},Uf={};["object","boolean","number","function","string","symbol"].forEach(();var Bf={},Ff=zf.version.split(".");f.transitional=var jf,Hf,Gf,Vf,Wf,qf,Xf,Yf,Zf={isOlderVersion:kf,assertOptions:validators:Uf},Jf=jp,$f=Vp,Kf=df,Qf=em=Df,tm=Zf,nm=tm.validators;.prototype.request=im.prototype.getUri=Jf.forEach(["delete","get","head","options"],(),Jf.forEach(["post","put","patch"],();var om=jp,sm=Cp,am=im,cm=Df;ar um=lm(Ef);um.Axios=am,um.create=um.Cancel=rm(),um.CancelToken=),um.isCancel=Pf(),um.all=function(e){return Promise.all(e)},um.spread=qf?Wf:(qf=1,Wf=,um.isAxiosError=Yf?Xf:(Yf=1,Xf=,Rp.exports=um,Rp.exports.default=um;var hm,dm=Op(Rp.exports);class pm{constructor(){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:"rectangular"})}buildFront(e){return new lo(new El(e.width,e.height))}buildBack(e){return new lo(new El(e.width,e.height))}buildBody(e){return new lo(new qc(e.width,e.height,e.depth))}}unction mm(e,t){return-e+t}function gm(e,t,n,i){const r=new Du;for(let o=0;o<e.length;o++){const s=e[o];switch(s.type){case hm.moveTo:r.moveTo(n(s.x,t.width),i(s.y,t.height));break;case hm.lineTo:r.lineTo(n(s.x,t.width),i(s.y,t.height));break;case hm.quadraticCurveTo:r.quadraticCurveTo(n(s.aCP1x,t.width),i(s.aCP1y,t.height),n(s.x,t.width),i(s.y,t.height));break;case hm.bezierCurveTo:r.bezierCurveTo(n(s.aCP1x,t.width),i(s.aCP1y,t.height),n(s.aCP2x,t.width),i(s.aCP2y,t.height),n(s.x,t.width),i(s.y,t.height));break;case hm.arcTo:r.absarc(s.x,s.y,s.radius,s.startAngle,s.endAngle,!1)}}return r}function vm(e,t,n,i){const r=gm(e.primary,t,n.x,n.y);return e.cutouts&&e.cutouts.forEach((e=>r.holes.push(gm(e,t,i.x,i.y)))),r}function ym(e,t){e.position.x=-.5*t.width,e.position.y=-.5*t.height,e.position.z=-.5*t.depth}!hm||(hm={}));class bm{onstructor(e){Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"customPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"curveSegments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=function(e){let t=0,n=0;for(let i=0;i<e.length;i++)e[i].x>t&&(t=e[i].x),e[i].y>n&&(n=e[i].y);return{width:t,height:n}}(e.primary),this.customPath=e,this.curveSegments=function(e){let t=0;return e.primary.forEach((e=>{e.type!==hm.quadraticCurveTo&&e.type!==hm.bezierCurveTo&&e.type!==hm.arcTo||t++})),e.cutouts&&e.cutouts.length>0&&e.cutouts.forEach((e=>{e.forEach((e=>{e.type!==hm.quadraticCurveTo&&e.type!==hm.bezierCurveTo&&e.type!==hm.arcTo||t++}))})),0===t?35:Math.max(8,Math.min(35,Math.round(180/t)))}(e)}buildFront(e){const t=vm(this.customPath,this.maxSize,{x:fm,y:mm},{x:fm,y:mm}),n=new Al(t,this.curveSegments);pd(n,e.width,e.height);const i=new lo(n);return ym(i,e),i}buildBack(e){const t=vm(this.customPath,this.maxSize,{x:mm,y:mm},{x:mm,y:mm}),n=new Al(t,this.curveSegments);pd(n,e.width,e.height);const i=new lo(n);return ym(i,e),i.position.x+=e.width,i}buildBody(e){const t={bevelEnabled:!1,depth:e.depth,curveSegments:this.curveSegments},n=vm(this.customPath,this.maxSize,{x:fm,y:mm},{x:fm,y:mm}),i=new lo(new _l(n,t));return fd(i.geometry,e),ym(i,e),i}}var xm;!xm||(xm={}));class wm{constructor(e){if(Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"flat sheet"}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"flatGeometry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initializedGeometry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"surfaceMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"LayerOffset",{enumerable:!0,configurable:!0,writable:!0,value:.1}),this.config=e,e.customPath?this.flatGeometry=new bm(e.customPath):this.flatGeometry=new pm,3!==this.config.substrates.length)throw new Error("The FlatSheetProductConfig must contain three substrates for the front, back, and body!");this.surfaceMapping={front:{substrate:Object.assign({},this.config.substrates[0]),finishes:this.config.finishes,fullBleed:this.config.fullBleed,trim:this.config.trim,page:1,focalPoint:{cameraView:new Kn(0,0,-1)}},body:{substrate:Object.assign({},this.config.substrates[1]),fullBleed:this.config.fullBleed},back:{substrate:Object.assign({},this.config.substrates[2]),fullBleed:this.config.fullBleed,trim:this.config.trim,page:2,focalPoint:{cameraView:new Kn(0,0,1)}}}}getGeometry(){return function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){this.initializedGeometry&&md(this.initializedGeometry);const e=this.getPhysicalSize();this.initializedGeometry=new Na;const t=this.flatGeometry.buildFront(e);if(t.uuid="front",t.position.z=.5*this.config.depth+this.LayerOffset,this.initializedGeometry.add(t),this.config.finishes){let t=2*this.LayerOffset;this.config.finishes.forEach((n=>{var i;const r=this.flatGeometry.buildFront(e);r.uuid=`front-${n.name}`,r.position.z=.5*this.config.depth+t,t+=this.LayerOffset,null===(i=this.initializedGeometry)||void 0===i||i.add(r)}))}const n=this.flatGeometry.buildBody(e);n.uuid="body",this.initializedGeometry.add(n);const i=this.flatGeometry.buildBack(e);return i.uuid="back",i.position.z=-.5*this.config.depth-this.LayerOffset,i.rotation.y=Math.PI,this.initializedGeometry.add(i),this.config.orientation===xm.Vertical&&this.initializedGeometry.rotateZ(Math.PI/2),this.resolveTransparency(),this.initializedGeometry}))}getSurfaceMapping(){return this.surfaceMapping}setProductSurface(e,t){if(!this.surfaceMapping[e])throw new Error(`'${e}' is not a surface on this flat sheet product`);this.surfaceMapping[e]=t,this.resolveTransparency()}getStatesetStates(e){}etCurrentState(e){}getAnimationIds(){return[]}etAreaLights(e,t){const n=[],i=new Wu(16777215,.12*t);i.position.set(0,0,200);const r=new Wu(16777215,.12*t);r.position.set(0,0,-200),n.push(i),n.push(r);const o=new Hu(16777215,.2625*e,500);o.position.set(0,0,300);const s=new Hu(16777215,.2625*e,500);return s.position.set(0,0,-300),n.push(o),n.push(s),n}preLoad(){return Promise.resolve()}dispose(){this.initializedGeometry&&(md(this.initializedGeometry),this.initializedGeometry=void 0)}getPhysicalSize(){return this.config.trim?{width:this.config.trim.bottomRightX-this.config.trim.topLeftX,height:this.config.trim.bottomRightY-this.config.trim.topLeftY,depth:this.config.depth}:{width:this.config.fullBleed.width,height:this.config.fullBleed.height,depth:this.config.depth}}resolveTransparency(){var e;if(this.initializedGeometry&&this.surfaceMapping&&this.surfaceMapping.front){const{substrate:t}=this.surfaceMapping.front,n=this.initializedGeometry.children.find((e=>"back"===e.uuid));n&&(n.visible=null===(e=!t.supportsTransparency)||void 0===e||e)}}}class _m{constructor(e,t,n){Object.defineProperty(this,"completionStatus",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"activeStatus",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"canceledStatus",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"elapsedTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"duration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"direction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"product",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"primarySectionSet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"foldStates",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"physicalSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resolveAnimation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.product=e,this.config=t,this.primarySectionSet=t.sectionSets[0],this.physicalSize=e.getPhysicalSize(),this.foldStates=this.generateFoldStates(n.sequenceId,t),this.duration=n.duration,this.direction=n.direction}get isComplete(){return this.completionStatus}get isActive(){return this.activeStatus}et isCanceled(){return this.canceledStatus}resetMeshState(){this.activeStatus=!1,this.interpolateValues(this.duration),this.resolveAnimation&&this.resolveAnimation()}update(e){this.isActive&&this.elapsedTime<this.duration&&(this.interpolateValues(this.elapsedTime),this.elapsedTime+=e),this.elapsedTime>=this.duration&&this.isActive&&(this.interpolateValues(this.duration),this.resolveAnimation&&this.resolveAnimation(),this.activeStatus=!1)}start(){return this.activeStatus=!0,new Promise(()}resume(){void 0!==this.resolveAnimation&&(this.activeStatus=!0)}ancel(){this.activeStatus=!1,this.canceledStatus=!0,this.resetMeshState(),this.resolveAnimation&&this.resolveAnimation()}getFoldSequence(e){for(let t=0;t<this.primarySectionSet.foldSequences.length;t++)if(this.primarySectionSet.foldSequences[t].id===e)return this.primarySectionSet.foldSequences[t];throw new Error(`Fold sequence '${e}' is not an available in the NFold Config!`)}getFold(e){for(let t=0;t<this.primarySectionSet.folds.length;t++)if(this.primarySectionSet.folds[t].id===e)return this.primarySectionSet.folds[t];throw new Error(`Fold '${e}' is not an available in the NFold Config!`)}getLastOperationById(e,t){let n,i=0;for(const r of t.operations)r.foldId===e&&r.endRatio>i&&(n=r,i=r.endRatio);if(void 0===n)throw new Error(`Fold operation '${e}' is not an available in the fold sequence '${t.id}'!`);return n}generateFoldStates(e,t){const n={},i=this.getFoldSequence(e);if(i.dependencyId){const e=this.getFoldSequence(i.dependencyId),t=this.groupOperationsByFold(i.operations);Object.keys(t).forEach((i=>{const r=this.getFold(i);n[r.childSectionId]=[];const o=t[i];for(let t=0;t<o.length;t++){let s;s=0===t?this.getLastOperationById(i,e):o[t-1],n[r.childSectionId].push({fold:r,startRatio:o[t].startRatio,endRatio:o[t].endRatio,startAngle:s.angle,endAngle:o[t].angle})}}))}else{const e=this.groupOperationsByFold(i.operations);Object.keys(e).forEach((t=>{const i=this.getFold(t);n[i.childSectionId]=[];const r=e[t];for(let e=0;e<r.length;e++){let t=0;e>0&&(t=r[e-1].angle),n[i.childSectionId].push({fold:i,startRatio:r[e].startRatio,endRatio:r[e].endRatio,startAngle:t,endAngle:r[e].angle})}}))}return n}groupOperationsByFold(e){const t={};for(const n of e)t[n.foldId]?t[n.foldId].push(n):t[n.foldId]=[n];return t}interpolateValues(e){const t=this.direction===V.forward?e/this.duration:1-e/this.duration,n=this.product.getSectionGroupMapping();Object.keys(n).forEach((e=>{if(this.foldStates[e]){const i=this.foldStates[e];for(let r=0;r<i.length;r++){const o=i[r];if(t<=o.startRatio)0===r&&this.foldSection(e,0,o,n);else if(t>=o.endRatio)r===i.length-1&&this.foldSection(e,1,o,n);else{const i=Rd(t-o.startRatio,0,1,o.endRatio-o.startRatio);this.foldSection(e,i,o,n)}}}}))}foldSection(e,t,n,i){const r=-.0174533*((n.endAngle-n.startAngle)*t+n.startAngle),o={x0:fm(n.fold.path.primary[0].x,this.physicalSize.width),y0:mm(n.fold.path.primary[0].y,this.physicalSize.height),x1:fm(n.fold.path.primary[1].x,this.physicalSize.width),y1:mm(n.fold.path.primary[1].y,this.physicalSize.height)};i[e].rotation.set(0,0,0),i[e].position.set(0,0,0);const s=new Kn(o.x1,o.y1,this.primarySectionSet.thickness),a=new Kn(o.x1-o.x0,o.y1-o.y0).normalize(),c=this.rotateVector(s,new Kn,new Ni);this.applyRotation(i[e],c,r,a)}rotateVector(e,t,n){let i=e.sub(t);return i=i.applyEuler(n),i=i.add(t),i}applyRotation(e,t,n,i){const r=new $n;return r.setFromAxisAngle(i,n),e.quaternion.multiplyQuaternions(r,e.quaternion),e.position.sub(t),e.position.applyQuaternion(r),e.position.add(t),e}}function Mm(e,t){for(let n=0;n<t.length;n++)if(t[n].id===e)return t[n];throw new Error(`Section id '${e}' is not defined in the NFold configuration!`)}const Sm=1e-4,Em=.02;class Tm{constructor(e){var t,n,i,r,o,s;Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"nfold"}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"primarySectionSet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"surfaceMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sectionGroupMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initializedGeometry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"physicalSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"productStates",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentLayerOffset",{enumerable:!0,configurable:!0,writable:!0,value:Em}),this.config=e,this.primarySectionSet=e.sectionSets[0],this.surfaceMapping={},this.sectionGroupMap={};const{fullBleed:a}=this.primarySectionSet,c=a.width-this.primarySectionSet.trim.bottomRightX,l=a.height-this.primarySectionSet.trim.bottomRightY;this.physicalSize={width:a.width-(this.primarySectionSet.trim.topLeftX+c),height:a.height-(this.primarySectionSet.trim.topLeftY+l),depth:this.primarySectionSet.thickness},this.productStates=[{id:"Unfolded"}];for(const h of this.primarySectionSet.foldSequences){const e={id:h.id,allowGeneratedFocalPoints:!0};h.dependencyId?e.dependency={stateId:h.dependencyId,animationId:h.id,animationDirection:V.forward,animationNames:{forward:null===(t=h.animationNames)||void 0===t?void 0:t.forward,backward:null===(n=h.animationNames)||void 0===n?void 0:n.backward}}:e.dependency={stateId:"Unfolded",animationId:h.id,animationDirection:V.forward,animationNames:{forward:null!==(r=null===(i=h.animationNames)||void 0===i?void 0:i.forward)&&void 0!==r?r:"Unfold",backward:null!==(s=null===(o=h.animationNames)||void 0===o?void 0:o.backward)&&void 0!==s?s:"Fold"}},this.productStates.push(e)}const u=this.productStates.find(();if(!u)throw new Error("Must have 'Folded' as a fold sequence");this.currentState=u}buildSectionMeshes(e){const t={width:this.physicalSize.width,height:this.physicalSize.height},n=[];return n.push(...this.buildFrontSection(e,t)),n.push(...this.buildSectionBody(e,t)),n.push(...this.buildSectionBack(e,t)),n}buildFrontSection(e,t){const n=new Al(vm(e.path,t,{x:fm,y:mm},{x:fm,y:mm}),15);dd(n,this.physicalSize.width,this.physicalSize.height,this.getContentOffset(e.frontSide));const i=[],r=new lo(n);if(r.uuid=`${e.id}:Front`,r.position.z=this.primarySectionSet.thickness+Em,i.push(r),this.surfaceMapping[r.uuid]={substrate:e.frontSide.substrate,fullBleed:this.primarySectionSet.fullBleed,trim:this.primarySectionSet.trim,page:e.frontSide.page,focalPoint:e.frontSide.focalPoint,finishes:e.frontSide.finishes},e.frontSide.finishes){let t=.04;for(const r of e.frontSide.finishes){const o=new lo(n);o.uuid=`${e.id}:Front-${r.name}`,o.position.z=this.primarySectionSet.thickness+t,i.push(o),t+=Em}}return i}buildSectionBody(e,t){const n=[];if(this.primarySectionSet.thickness>Sm){const i={bevelEnabled:!1,depth:this.primarySectionSet.thickness,curveSegments:15},r=new _l(vm(e.path,t,{x:fm,y:mm},{x:fm,y:mm}),i);fd(r,this.physicalSize);const o=new lo(r);o.uuid=`${e.id}:Body`,this.surfaceMapping[o.uuid]={substrate:e.bodySubstrate,fullBleed:this.primarySectionSet.fullBleed},n.push(o)}if(e.path.fills&&e.fillSubstrates){const i={bevelEnabled:!1,depth:Em,curveSegments:15};for(let r=0;r<e.path.fills.length;r++){const o=e.path.fills[r],s=new _l(gm(o,t,fm,mm),i);fd(s,this.physicalSize);const a=new lo(s);a.uuid=`${e.id}:Body Fill:${r}`,this.surfaceMapping[a.uuid]={substrate:e.fillSubstrates[r],fullBleed:this.primarySectionSet.fullBleed},n.push(a)}}return n}buildSectionBack(e,t){const n=new Al(vm(e.path,t,{x:mm,y:mm},{x:mm,y:mm}),15);dd(n,this.physicalSize.width,this.physicalSize.height,this.getContentOffset(e.backSide));const i=[],r=new lo(n);if(r.uuid=`${e.id}:Back`,i.push(r),r.position.z=-.02,r.position.x+=this.physicalSize.width,r.rotation.y=Math.PI,this.surfaceMapping[r.uuid]={substrate:e.backSide.substrate,fullBleed:this.primarySectionSet.fullBleed,trim:this.primarySectionSet.trim,page:e.backSide.page,focalPoint:e.backSide.focalPoint,finishes:e.backSide.finishes},e.backSide.finishes){let t=.04;for(const r of e.backSide.finishes){const o=new lo(n);o.uuid=`${e.id}:Back-${r.name}`,i.push(o),o.position.z=-t,o.position.x+=this.physicalSize.width,o.rotation.y=Math.PI,t+=Em}}return i}buildSectionGroup(e){const t=new Na;this.sectionGroupMap[e.id]=t;const n=this.buildSectionMeshes(e);t.add(...n);const i=this.getConnectedFolds(e.id);for(let r=0;r<i.length;r++){const e=Mm(i[r].childSectionId,this.primarySectionSet.sections);t.add(this.buildSectionGroup(e))}return t}getConnectedFolds(e){const t=[];for(let n=0;n<this.primarySectionSet.folds.length;n++){const i=this.primarySectionSet.folds[n];i.parentSectionId===e&&t.push(i)}return t}getContentOffset(e){return e.contentOffset?new Hn(e.contentOffset.x,e.contentOffset.y):new Hn}updateLayerOffset(e){var t;null===(t=this.initializedGeometry)||void 0===t||t.traverse((t=>{"Mesh"===t.type&&(t.uuid.indexOf("Back")>=0?t.position.z=-e:t.uuid.indexOf("Front")>=0&&(t.position.z=this.primarySectionSet.thickness+e))}))}getGeometry(){return function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){this.initializedGeometry&&md(this.initializedGeometry);const e=Mm(this.primarySectionSet.baseSectionId,this.primarySectionSet.sections),t=this.buildSectionGroup(e);if(this.primarySectionSet.rotationOffset){const{rotationOffset:e}=this.primarySectionSet;t.rotation.set(e.yaw,e.pitch,e.roll)}yield function(e,t){return Ad(this,void 0,void 0,(function*(){const e=t.buildAnimation({animationId:"Folded",direction:V.forward,duration:Md}),n=e.start();e.update(1),yield n}))}(0,this);const n=(new ti).setFromObject(t).getCenter(new Kn);return t.position.set(-n.x,-n.y,-n.z),t.updateMatrix(),this.initializedGeometry=new Na,this.initializedGeometry.add(t),this.initializedGeometry}))}getSurfaceMapping(){return this.surfaceMapping}setProductSurface(e,t){if(!this.surfaceMapping[e])throw new Error(`'${e}' is not a surface on this N-fold product`);this.surfaceMapping[e]=t}getSectionGroupMapping(){return this.sectionGroupMap}getPhysicalSize(){return this.physicalSize}getCurrentState(){return this.currentState}setCurrentState(e){const t=this.getStates().find(();if(!t)throw new Error(`'${e} is not a state defined in this product!`);this.currentState=t}tAnimationIds(){const e=[];return this.primarySectionSet.foldSequences.forEach((),e}buildAnimation(e){const t=this.primarySectionSet.foldSequences.find(();if(void 0===this.primarySectionSet.foldSequences||!t)throw new Error(`Fold sequence '${e.animationId}' is not an available in the NFold Config!`);const n={duration:e.duration,direction:e.direction,sequenceId:e.animationId};return new _m(this,this.config,n)}sync(e){const t=e.preview.camera.normalizedZoomFactor,n=t>1?.04*t:Em;Math.abs(this.currentLayerOffset-n)>Sm&&(this.updateLayerOffset(n),this.currentLayerOffset=n)}getAreaLights(e,t){return wd([.42*e,.42*e,.3885*e,.3885*e,.4515*e,.42*e])}ar Am=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};function Pm(e){return Am(this,void 0,void 0,(function*(){const t={},n=Object.keys(e.substrateUrlMap).map((n=>function(e,t){return Am(this,void 0,void 0,(function*(){const n=yield dm.get(t);if(n.status>=400)throw new Error(`Failed to fetch substrate '${e}' from '${t}'!`);return n.data}))}(n,e.substrateUrlMap[n]).then(()));return yield Promise.allSettled(n),t}))}function Lm(e){return Am(this,void 0,void 0,(function*(){const t={};if(!e.finishUrlMap)return t;const n=Object.keys(e.finishUrlMap).map((n=>Am(this,void 0,void 0,(function*(){e.finishUrlMap&&(t[n]=yield function(e,t){return Am(this,void 0,void 0,(function*(){const n=yield dm.get(t);if(n.status>=400)throw new Error(`Failed to fetch finish '${e}' from '${t}'!`);return n.data}))}(n,e.finishUrlMap[n]))}))));return yield Promise.allSettled(n),t}))}var Om,Rm=class Cm{constructor(e){Object.defineProperty(this,"_manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_path",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._manager=void 0!==e?e:iu}load(e,t,n=void 0,i=void 0){const r=new su(this._manager);r.setPath(this._path),r.load(e,(,n,i)}arse(e){let t=0;const n=new Ti,i=new Kn,r={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};function o(e,t){const n=[],{childNodes:i}=e;for(let r=0,o=i.length;r<o;r++){const e=i[r];e.nodeName===t&&n.push(e)}return n}function s(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=t[i];return n}function a(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=parseFloat(t[i]);return n}function c(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=parseInt(t[i]);return n}unction u(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function h(e){return void 0!==e?e.textContent:"Y_UP"}function d(e,t,n,i){const r=o(e,t)[0];if(void 0!==r){const e=o(r,n);for(let t=0;t<e.length;t++)i(e[t])}}function p(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function f(e){const t={id:e.id},n=r.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){onst n={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},{sources:i}=e,{vertexWeights:r}=e,{vcount:o}=r,{v:s}=r,a=r.inputs.JOINT.offset,c=r.inputs.WEIGHT.offset,l=e.sources[e.joints.inputs.JOINT],u=e.sources[e.joints.inputs.INV_BIND_MATRIX],h=i[r.inputs.WEIGHT.id].array;let d,p,f,m=0;for(d=0,f=o.length;d<f;d++){const e=o[d],i=[];for(p=0;p<e;p++){const e=s[m+a],t=h[s[m+c]];i.push({index:e,weight:t}),m+=2}for(i.sort(t),p=0;p<4;p++){const e=i[p];void 0!==e?(n.indices.array.push(e.index),n.weights.array.push(e.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}for(e.bindShapeMatrix?n.bindMatrix=(new Ti).fromArray(e.bindShapeMatrix).transpose():n.bindMatrix=(new Ti).identity(),d=0,f=l.array.length;d<f;d++){const e=l.array[d],t=(new Ti).fromArray(u.array,d*u.stride).transpose();n.joints.push({name:e,boneInverse:t})}return n}(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function m(e){const t={array:[],stride:3};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];let r;if(1===i.nodeType)switch(i.nodeName){case"float_array":t.array=a(i.textContent);break;case"Name_array":t.array=s(i.textContent);break;case"technique_common":r=o(i,"accessor")[0],void 0!==r&&(t.stride=parseInt(r.getAttribute("stride")))}}return t}function g(e){const t={};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];1===i.nodeType&&(t[i.getAttribute("semantic")]=l(i.getAttribute("source")))}return t}function v(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":const e=l(i.getAttribute("source")),n=i.getAttribute("semantic"),r=parseInt(i.getAttribute("offset")),o=parseInt(i.getAttribute("set")),s=o>0?n+o:n;t.inputs[s]={id:e,offset:r},t.stride=Math.max(t.stride,r+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=c(i.textContent);break;case"p":t.p=c(i.textContent)}}return t}function y(e){let t=0;for(let n=0,i=e.length;n<i;n++)!0===e[n].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function b(e,t,n,i){const r=e.p,{stride:o}=e,{vcount:s}=e,a=t.array,c=t.stride;function l(e){let t=r[e+n]*c;const o=t+c;for(;t<o;t++)i.push(a[t])}if(void 0!==e.vcount){let e=0;for(let t=0,n=s.length;t<n;t++){const n=s[t];if(4===n){const t=e+1*o,n=e+2*o,i=e+3*o;l(e+0*o),l(t),l(i),l(t),l(n),l(i)}else if(3===n){const t=e+1*o,n=e+2*o;l(e+0*o),l(t),l(n)}else if(n>4)for(let t=1,i=n-2;t<=i;t++){const n=e+o*t,i=e+o*(t+1);l(e+0*o),l(n),l(i)}e+=o*n}}else for(let u=0,h=r.length;u<h;u+=o)l(u)}function x(e,t,n){const i={},r={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},a={array:[],stride:0},c={array:[],stride:0},l=[],u=[],h=new Wr,d=[];let p=0;for(let f=0;f<e.length;f++){const i=e[f],{inputs:m}=i;let g=0;switch(i.type){case"lines":case"linestrips":g=2*i.count;break;case"triangles":g=3*i.count;break;case"polylist":for(let e=0;e<i.count;e++){const t=i.vcount[e];switch(t){case 3:g+=3;break;case 4:g+=6;break;default:g+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",i.type)}h.addGroup(p,g,f),p+=g,i.material&&d.push(i.material);for(const h in m){const d=m[h];switch(h){case"VERTEX":for(const h in n){const p=n[h];switch(h){case"POSITION":const n=r.array.length;if(b(i,t[p],d.offset,r.array),r.stride=t[p].stride,t.skinWeights&&t.skinIndices&&(b(i,t.skinIndices,d.offset,l),b(i,t.skinWeights,d.offset,u)),!1===i.hasUV&&!0===e.uvsNeedsFix){const e=(r.array.length-n)/r.stride;for(let t=0;t<e;t++)s.array.push(0,0)}break;case"NORMAL":b(i,t[p],d.offset,o.array),o.stride=t[p].stride;break;case"COLOR":b(i,t[p],d.offset,c.array),c.stride=t[p].stride;break;case"TEXCOORD":b(i,t[p],d.offset,s.array),s.stride=t[p].stride;break;case"TEXCOORD1":b(i,t[p],d.offset,a.array),s.stride=t[p].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',h)}}break;case"NORMAL":b(i,t[d.id],d.offset,o.array),o.stride=t[d.id].stride;break;case"COLOR":b(i,t[d.id],d.offset,c.array),c.stride=t[d.id].stride;break;case"TEXCOORD":b(i,t[d.id],d.offset,s.array),s.stride=t[d.id].stride;break;case"TEXCOORD1":b(i,t[d.id],d.offset,a.array),a.stride=t[d.id].stride}}}return r.array.length>0&&h.setAttribute("position",new Nr(r.array,r.stride)),o.array.length>0&&h.setAttribute("normal",new Nr(o.array,o.stride)),c.array.length>0&&h.setAttribute("color",new Nr(c.array,c.stride)),s.array.length>0&&h.setAttribute("uv",new Nr(s.array,s.stride)),a.array.length>0&&h.setAttribute("uv2",new Nr(a.array,a.stride)),l.length>0&&h.setAttribute("skinIndex",new Nr(l,4)),u.length>0&&h.setAttribute("skinWeight",new Nr(u,4)),i.data=h,i.type=e[0].type,i.materialKeys=d,i}function w(e){const t={},{sources:n}=e,{vertices:i}=e,{primitives:r}=e;if(0===r.length)return{};const o=function(e){const t={};for(let n=0;n<e.length;n++){const i=e[n];void 0===t[i.type]&&(t[i.type]=[]),t[i.type].push(i)}return t}(r);for(const s in o){const r=o[s];y(r),t[s]=x(r,n,i),t[s].data.name=e.name}return t}function _(e){return p(r.geometries[e],w)}function M(e){const t={id:l(e.getAttribute("url")),materials:{}};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if("bind_material"===i.nodeName){const e=i.getElementsByTagName("instance_material");for(let n=0;n<e.length;n++){const i=e[n],r=i.getAttribute("symbol"),o=i.getAttribute("target");t.materials[r]=l(o)}}}return t}function S(e){const t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new Ti,nodes:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let r=0;r<e.childNodes.length;r++){const o=e.childNodes[r];let s;if(1===o.nodeType)switch(o.nodeName){case"node":t.nodes.push(o.getAttribute("id")),S(o);break;case"instance_controller":t.instanceControllers.push(M(o));break;case"instance_geometry":t.instanceGeometries.push(M(o));break;case"instance_node":t.instanceNodes.push(l(o.getAttribute("url")));break;case"matrix":s=a(o.textContent),t.matrix.multiply(n.fromArray(s).transpose()),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"translate":s=a(o.textContent),i.fromArray(s),t.matrix.multiply(n.makeTranslation(i.x,i.y,i.z)),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"rotate":s=a(o.textContent);const e=s[3]*Math.PI/180;t.matrix.multiply(n.makeRotationAxis(i.fromArray(s),e)),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"scale":s=a(o.textContent),t.matrix.scale(i.fromArray(s)),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"extra":break;default:console.log(o)}}var o;return o=t.id,void 0!==r.nodes[o]?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):r.nodes[t.id]=t,t}const E=new Mr({color:16711935});function T(e){const t=[];for(const n in e){const i=e[n],r=E;let o;switch(n){case"lines":o=new Pc(i.data,r);break;case"linestrips":o=new Ec(i.data,r);break;case"triangles":case"polylist":o=new lo(i.data,r)}""===o.name&&i.data.name&&(o.uuid=i.data.name.replace("Mesh","")),t.push(o)}return t}function A(e){const t=[],{matrix:n}=e,{nodes:i}=e,{type:o}=e,{instanceControllers:s}=e,{instanceGeometries:a}=e,{instanceNodes:c}=e;for(let r=0,h=i.length;r<h;r++)t.push(P(i[r]));for(let h=0,d=s.length;h<d;h++){const e=T(_((l=s[h].id,p(r.controllers[l],f)).id));for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i)}}var l;for(let r=0,h=a.length;r<h;r++){const e=T(_(a[r].id));for(let n=0,i=e.length;n<i;n++)t.push(e[n])}for(let r=0,h=c.length;r<h;r++)t.push(P(c[r]).clone());let u;if(0===i.length&&1===t.length)u=t[0];else{u="JOINT"===o?new pc:new Na;for(let e=0;e<t.length;e++)u.add(t[e])}return""===u.name&&(u.name="JOINT"===o?e.sid:e.name,u.uuid=e.id),u.matrix.copy(n),u.matrix.decompose(u.position,u.quaternion,u.scale),u}unction L(e){const t=new Na;t.name=e.name;const{children:n}=e;for(let i=0;i<n.length;i++){const e=n[i];t.add(P(e.id))}return t}if(0===e.length)return{scene:new ka};const O=(new DOMParser).parseFromString(e,"application/xml"),R=o(O,"COLLADA")[0],C=O.getElementsByTagName("parsererror")[0];if(void 0!==C){const e=o(C,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const n=[e];for(;n.length;){const e=n.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",n.push.apply(n,e.childNodes))}return t.trim()}(C),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const I=function(e){return{unit:u(o(e,"unit")[0]),upAxis:h(o(e,"up_axis")[0])}}(o(R,"asset")[0]);d(R,"library_geometries","geometry",(function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=o(e,"mesh")[0];if(void 0!==n){for(let e=0;e<n.childNodes.length;e++){const i=n.childNodes[e];if(1!==i.nodeType)continue;const r=i.getAttribute("id");switch(i.nodeName){case"source":t.sources[r]=m(i);break;case"vertices":t.vertices=g(i);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",i.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(v(i));break;default:console.log(i)}}r.geometries[e.getAttribute("id")]=t}})),d(R,"library_visual_scenes","visual_scene",(function(e){const n={name:e.getAttribute("name"),children:[]};!function(e){const n=e.getElementsByTagName("node");for(let i=0;i<n.length;i++){const e=n[i];!1===e.hasAttribute("id")&&e.setAttribute("id","three_default_"+t++)}}(e);const i=o(e,"node");for(let t=0;t<i.length;t++)n.children.push(S(i[t]));r.visualScenes[e.getAttribute("id")]=n}));const N=function(e){return t=l(o(e,"instance_visual_scene")[0].getAttribute("url")),p(r.visualScenes[t],L);var t}(o(R,"scene")[0]);return"Z_UP"===I.upAxis&&N.quaternion.setFromEuler(new Ni(-Math.PI/2,0,0)),N.scale.multiplyScalar(I.unit),{library:r,scene:N}}}function Im(e,t){const n=Object.keys(e),i={};return n.forEach((n=>{const r={substrate:e[n].substrate,finishes:e[n].finishes,page:e[n].page,fullBleed:e[n].fullBleed||t,trim:e[n].trim,focalPoint:e[n].focalPoint};i[n]=r})),i}function Nm(e,t){const n=(new ti).setFromObject(t).getCenter(new Kn);return e&&(n.x-=e.x,n.y-=e.y,n.z-=e.z),t.position.set(-n.x,-n.y,-n.z),t.updateMatrix(),t}function Dm(e,t){e.children&&0!==e.children.length&&e.children.forEach((e=>{e instanceof lo&&t(e),Dm(e,t)}))}!Om||(Om={}));var zm,Um=function(){function e(e){ru.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.pluginCallbacks=[],this.register((function(e){return new s(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new a(e)})),this.register(()}.prototype=Object.assign(Object.create(ru.prototype),{constructor:e,load:function(e,t,n,i){var r,o=this;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Ku(e),this.manager.itemStart(e);var s=a=new su(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(,n,s)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},register:unregister:parse:function(e,t,r,s){var a,c={},u={};if("string"==typeof e)a=e;else if($u(new Uint8Array(e,0,4))===l){try{c[n.KHR_BINARY_GLTF]=new d(e)}catch(e){return void(s&&s(e))}a=c[n.KHR_BINARY_GLTF].content}else a=$u(new Uint8Array(e));var h=JSON.parse(a);if(void 0===h.asset||h.asset.version[0]<2)s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var m=new R(h,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader});m.fileLoader.setRequestHeader(this.requestHeader);for(var y=0;y<this.pluginCallbacks.length;y++){var b=this.pluginCallbacks[y](m);u[b.name]=b,c[b.name]=!0}if(h.extensionsUsed)for(y=0;y<h.extensionsUsed.length;++y){var x=h.extensionsUsed[y],w=h.extensionsRequired||[];switch(x){case n.KHR_MATERIALS_UNLIT:c[x]=new o;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:c[x]=new g;break;case n.KHR_DRACO_MESH_COMPRESSION:c[x]=new p(h,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:c[x]=new i(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:c[x]=new f;break;case n.KHR_MESH_QUANTIZATION:c[x]=new v;break;default:w.indexOf(x)>=0&&void 0===u[x]&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}m.setExtensions(c),m.setPlugins(u),m.parse(r,s)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function i(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=e}function r(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}unction s(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}function a(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,i=t.length;n<i;n++){var r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}},r.prototype._loadLight=function(e){var t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;var r,o=t.json,s=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],a=new br(16777215);void 0!==s.color&&a.fromArray(s.color);var c=void 0!==s.range?s.range:0;switch(s.type){case"directional":(r=new Wu(a)).target.position.set(0,0,-1),r.add(r.target);break;case"point":(r=new Hu(a)).distance=c;break;case"spot":(r=new ku(a)).distance=c,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,r.angle=s.spot.outerConeAngle,r.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+s.type+'".')}return r.position.set(0,0,0),r.decay=2,void 0!==s.intensity&&(r.intensity=s.intensity),r.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(r),t.cache.add(n,i),i},r.prototype.createNodeAttachment=o.prototype.getMaterialType=o.prototype.extendParams=function(e,t,n){var i=[];e.color=new br(1,1,1),e.opacity=1;var r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(i)},s.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Il:null},s.prototype.extendMaterialParams=a.prototype.getMaterialType=a.prototype.extendMaterialParams=c.prototype.loadTexture=function(e){var t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;var r=i.extensions[this.name],o=n.images[r.source],s=t.options.ktx2Loader;if(!s)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return t.loadTextureImage(e,o,s)};var l="glTF",u=12,h={JSON:1313821514,BIN:5130562};function d(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,u);if(this.header={magic:$u(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==l)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=new DataView(e,u),r=0;r<i.byteLength;){var o=i.getUint32(r,!0);r+=4;var s=i.getUint32(r,!0);if(r+=4,s===h.JSON){var a=new Uint8Array(e,u+r,o);this.content=$u(a)}else if(s===h.BIN){var c=u+r;this.body=e.slice(c,c+o)}r+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function p(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function f(){this.name=n.KHR_TEXTURE_TRANSFORM}function m(e){Cl.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new br).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:,glossiness:{get:function(){return s.glossiness.value},set:,glossinessMap:{get:function(){return s.glossinessMap.value},set:}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function g(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return m},extendParams:function(e,t,n){var i=t.extensions[this.name];e.color=new br(1,1,1),e.opacity=1;var r=[];if(Array.isArray(i.diffuseFactor)){var o=i.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new br(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new br(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var s=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",s)),r.push(n.assignTexture(e,"specularMap",s))}return Promise.all(r)},createMaterial:function(e){var t=new m(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=Rn,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function v(){this.name=n.KHR_MESH_QUANTIZATION}function y(e,t,n,i){Hl.call(this,e,t,n,i)}p.prototype.decodePrimitive=function(e,t){var n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,s={},a={},c={};for(var l in o){var u=M[l]||l.toLowerCase();s[u]=o[l]}for(l in e.attributes)if(u=M[l]||l.toLowerCase(),void 0!==o[l]){var h=n.accessors[e.attributes[l]],d=b[h.componentType];c[u]=d,a[u]=!0===h.normalized}return t.getDependency("bufferView",r).then(()},f.prototype.extendTexture=m.prototype=Object.create(Cl.prototype),m.prototype.constructor=m,m.prototype.copy=function(e){return Cl.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},y.prototype=Object.create(Hl.prototype),y.prototype.constructor=y,y.prototype.copySampleValue_=y.prototype.beforeStart_=y.prototype.copySampleValue_,y.prototype.afterEnd_=y.prototype.copySampleValue_,y.prototype.interpolate_=var b={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},x={9728:$e,9729:et,9984:Ke,9985:tt,9986:Qe,9987:nt},w={33071:Ze,33648:Je,10497:Ye},_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},M={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},S={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},E={CUBICSPLINE:void 0,LINEAR:gn,STEP:mn};function T(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}nction L(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length)for(e.morphTargetDictionary={},n=0,i=r.length;n<i;n++)e.morphTargetDictionary[r[n]]=n;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}unction R(e,n){this.json=e||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new ih(this.options.manager):this.textureLoader=new du(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new su(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function C(e,t,n){var i=t.attributes,r=[];or(var s in i){var a=M[s]||s.toLowerCase();a in e.attributes||r.push(o(i[s],a))}if(void 0!==t.indices&&!e.index){var c=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(c)}return P(e,t),function(e,t,n){var i=t.attributes,r=new ti;if(void 0!==i.POSITION){var o=(d=n.json.accessors[i.POSITION]).min,s=d.max;if(void 0!==o&&void 0!==s){r.set(new Kn(o[0],o[1],o[2]),new Kn(s[0],s[1],s[2]));var a=t.targets;if(void 0!==a){for(var c=new Kn,l=new Kn,u=0,h=a.length;u<h;u++){var d,p=a[u];void 0!==p.POSITION&&(o=(d=n.json.accessors[p.POSITION]).min,s=d.max,void 0!==o&&void 0!==s?(l.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),l.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),l.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),c.max(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}r.expandByVector(c)}e.boundingBox=r;var f=new vi;r.getCenter(f.center),f.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){for(var i=!1,r=!1,o=0,s=t.length;o<s&&(void 0!==(l=t[o]).POSITION&&(i=!0),void 0!==l.NORMAL&&(r=!0),!i||!r);o++);if(!i&&!r)return Promise.resolve(e);var a=[],c=[];for(o=0,s=t.length;o<s;o++){var l=t[o];if(i){var u=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):e.attributes.position;a.push(u)}r&&(u=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):e.attributes.normal,c.push(u))}return Promise.all([Promise.all(a),Promise.all(c)]).then((function(t){var n=t[0],o=t[1];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function I(e,t){var n=e.getIndex();if(null===n){var i=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<r.count;o++)i.push(o);e.setIndex(i),n=e.getIndex()}var s=n.count-2,a=[];if(2===t)for(o=1;o<=s;o++)a.push(n.getX(0)),a.push(n.getX(o)),a.push(n.getX(o+1));else for(o=0;o<s;o++)o%2==0?(a.push(n.getX(o)),a.push(n.getX(o+1)),a.push(n.getX(o+2))):(a.push(n.getX(o+2)),a.push(n.getX(o+1)),a.push(n.getX(o)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=e.clone();return c.setIndex(a),c}return R.prototype.setExtensions=function(e){this.extensions=e},R.prototype.setPlugins=function(e){this.plugins=e},R.prototype.parse=function(e,t){var n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var o={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};A(r,o,i),P(o,i),e(o)})).catch(t)},R.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],i=0,r=t.length;i<r;i++)for(var o=t[i].joints,s=0,a=o.length;s<a;s++)e[o[s]].isBone=!0;for(var c=0,l=e.length;c<l;c++){var u=e[c];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(n[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}},R.prototype._addNodeRef=R.prototype._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var i=n.clone();return i.name+="_instance_"+e.uses[t]++,i},R.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var i=e(t[n]);if(i)return i}},R.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],i=0;i<t.length;i++){var r=e(t[i]);r&&n.push(r)}return n},R.prototype.getDependency=function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i},R.prototype.getDependencies=R.prototype.loadBuffer=R.prototype.loadBufferView=R.prototype.loadAccessor=function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(e){var r,o=e[0],s=_[i.type],a=b[i.componentType],c=a.BYTES_PER_ELEMENT,l=c*s,u=i.byteOffset||0,h=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(h&&h!==l){var p=Math.floor(u/h),f="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+p+":"+i.count,m=t.cache.get(f);m||(m=new ja(new a(o,p*h,i.count*h/c),h/c),t.cache.add(f,m)),r=new Ga(m,s,u%h/c,d)}else r=new Tr(null===o?new a(i.count*s):new a(o,u,i.count*s),s,d);if(void 0!==i.sparse){var g=_.SCALAR,v=b[i.sparse.indices.componentType],y=i.sparse.indices.byteOffset||0,x=i.sparse.values.byteOffset||0,w=new v(e[1],y,i.sparse.count*g),M=new a(e[2],x,i.sparse.count*s);null!==o&&(r=new Tr(r.array.slice(),r.itemSize,r.normalized));for(var S=0,E=w.length;S<E;S++){var T=w[S];if(r.setX(T,M[S*s]),s>=2&&r.setY(T,M[S*s+1]),s>=3&&r.setZ(T,M[S*s+2]),s>=4&&r.setW(T,M[S*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return r}))},R.prototype.loadTexture=function(e){var t,i,r=this.json,o=this.options,s=r.textures[e],a=s.extensions||{};return(t=a[n.MSFT_TEXTURE_DDS]?r.images[a[n.MSFT_TEXTURE_DDS].source]:r.images[s.source]).uri&&(i=o.manager.getHandler(t.uri)),i||(i=a[n.MSFT_TEXTURE_DDS]?this.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,t,i)},R.prototype.loadTextureImage=function(e,t,n){var i=this,r=this.json,o=this.options,s=r.textures[e],a=self.URL||self.webkitURL,c=t.uri,l=!1,u=!0;return"image/jpeg"===t.mimeType&&(u=!1),void 0!==t.bufferView&&(c=i.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var n=new DataView(e,25,1).getUint8(0,!1);u=6===n||4===n||3===n}l=!0;var i=new Blob([e],{type:t.mimeType});return c=a.createObjectURL(i)}))),Promise.resolve(c).then((function(e){return new Promise((function(t,i){var r=t;!0===n.isImageBitmapLoader&&(r=,n.load(T(e,o.path),r,void 0,i)}))})).then((function(t){!0===l&&a.revokeObjectURL(c),t.flipY=!1,s.name&&(t.name=s.name),u||(t.format=gt);var n=(r.samplers||{})[s.sampler]||{};return t.magFilter=x[n.magFilter]||et,t.minFilter=x[n.minFilter]||nt,t.wrapS=w[n.wrapS]||Ye,t.wrapT=w[n.wrapT]||Ye,i.associations.set(t,{type:"textures",index:e}),t}))},R.prototype.assignTexture=function(e,t,i){var r=this;return this.getDependency("texture",i.index).then((function(o){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===t&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),r.extensions[n.KHR_TEXTURE_TRANSFORM]){var s=void 0!==i.extensions?i.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(s){var a=r.associations.get(o);o=r.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(o,s),r.associations.set(o,a)}}e[t]=o}))},R.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,i=void 0!==t.attributes.tangent,r=void 0!==t.attributes.color,o=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,a=Object.keys(t.morphAttributes).length>0,c=a&&void 0!==t.morphAttributes.normal;if(e.isPoints){var l="PointsMaterial:"+n.uuid,u=this.cache.get(l);u||(u=new Oc,_r.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(l,u)),n=u}else if(e.isLine){l="LineBasicMaterial:"+n.uuid;var h=this.cache.get(l);h||(h=new bc,_r.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(l,h)),n=h}if(i||r||o||s||a){l="ClonedMaterial:"+n.uuid+":",n.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),s&&(l+="skinning:"),i&&(l+="vertex-tangents:"),r&&(l+="vertex-colors:"),o&&(l+="flat-shading:"),a&&(l+="morph-targets:"),c&&(l+="morph-normals:");var d=this.cache.get(l);d||(d=n.clone(),s&&(d.skinning=!0),i&&(d.vertexTangents=!0),r&&(d.vertexColors=!0),o&&(d.flatShading=!0),a&&(d.morphTargets=!0),c&&(d.morphNormals=!0),this.cache.add(l,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),n.normalScale&&!i&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!i&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),e.material=n},R.prototype.getMaterialType=function(){return Cl},R.prototype.loadMaterial=function(e){var t,i=this,r=this.json,o=this.extensions,s=r.materials[e],a={},c=s.extensions||{},l=[];if(c[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(),l.push(u.extendParams(a,s,i))}else if(c[n.KHR_MATERIALS_UNLIT]){var h=o[n.KHR_MATERIALS_UNLIT];t=h.getMaterialType(),l.push(h.extendParams(a,s,i))}else{var d=s.pbrMetallicRoughness||{};if(a.color=new br(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){var p=d.baseColorFactor;a.color.fromArray(p),a.opacity=p[3]}void 0!==d.baseColorTexture&&l.push(i.assignTexture(a,"map",d.baseColorTexture)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(l.push(i.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),l.push(i.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll(()))}!0===s.doubleSided&&(a.side=ne);var f=s.alphaMode||"OPAQUE";return"BLEND"===f?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===f&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==Mr&&(l.push(i.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Hn(1,1),void 0!==s.normalTexture.scale&&a.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&t!==Mr&&(l.push(i.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==Mr&&(a.emissive=(new br).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==Mr&&l.push(i.assignTexture(a,"emissiveMap",s.emissiveTexture)),Promise.all(l).then((function(){var r;return r=t===m?o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new t(a),s.name&&(r.name=s.name),r.map&&(r.map.encoding=_n),r.emissiveMap&&(r.emissiveMap.encoding=_n),P(r,s),i.associations.set(r,{type:"materials",index:e}),s.extensions&&A(o,r,s),r}))},R.prototype.createUniqueName=function(e){for(var t=Ah.sanitizeNodeName(e||""),n=1;this.nodeNamesUsed[t];++n)t=e+"_"+n;return this.nodeNamesUsed[t]=!0,t},R.prototype.loadGeometries=function(e){var t=this,i=this.extensions,r=this.primitiveCache;or(var s,a,c=[],l=0,u=e.length;l<u;l++){var h,d=e[l],p=(void 0,(a=(s=d).extensions&&s.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+a.bufferView+":"+a.indices+":"+O(a.attributes):s.indices+":"+O(s.attributes)+":"+s.mode),f=r[p];f?c.push(f.promise):(h=d.extensions&&d.extensions[n.KHR_DRACO_MESH_COMPRESSION]?o(d):C(new Wr,d,t),r[p]={primitive:d,promise:h},c.push(h))}return Promise.all(c)},R.prototype.loadMesh=function(e){for(var t,n=this,i=this.json.meshes[e],r=i.primitives,o=[],s=0,a=r.length;s<a;s++){var c=void 0===r[s].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new Cl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ee})),t.DefaultMaterial):this.getDependency("material",r[s].material);o.push(c)}return o.push(n.loadGeometries(r)),Promise.all(o).then((function(t){for(var o=t.slice(0,t.length-1),s=t[t.length-1],a=[],c=0,l=s.length;c<l;c++){var u,h=s[c],d=r[c],p=o[c];if(4===d.mode||5===d.mode||6===d.mode||void 0===d.mode)!0!==(u=!0===i.isSkinnedMesh?new lc(h,p):new lo(h,p)).isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),5===d.mode?u.geometry=I(u.geometry,1):6===d.mode&&(u.geometry=I(u.geometry,2));else if(1===d.mode)u=new Pc(h,p);else if(3===d.mode)u=new Ec(h,p);else if(2===d.mode)u=new Lc(h,p);else{if(0!==d.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);u=new Dc(h,p)}Object.keys(u.geometry.morphAttributes).length>0&&L(u,i),u.name=n.createUniqueName(i.name||"mesh_"+e),u.uuid=i.name,c>0&&(u.uuid+=`_${c}`),s.length>1&&(u.name+="_"+c),P(u,i),n.assignFinalMaterial(u),a.push(u)}if(1===a.length)return a[0];var f=new Na;for(c=0,l=a.length;c<l;c++)f.add(a[c]);return f}))},R.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new wo(jn.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new Gu(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),P(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},R.prototype.loadSkin=R.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],i=[],r=[],o=[],s=[],a=0,c=t.channels.length;a<c;a++){var l=t.channels[a],u=t.samplers[l.sampler],h=l.target,d=void 0!==h.node?h.node:h.id,p=void 0!==t.parameters?t.parameters[u.input]:u.input,f=void 0!==t.parameters?t.parameters[u.output]:u.output;n.push(this.getDependency("node",d)),i.push(this.getDependency("accessor",p)),r.push(this.getDependency("accessor",f)),o.push(u),s.push(h)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(o),Promise.all(s)]).then((function(n){for(var i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],c=[],l=0,u=i.length;l<u;l++){var h=i[l],d=r[l],p=o[l],f=s[l],m=a[l];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,S[m.path]){case S.weights:g=Zl;break;case S.rotation:g=$l;break;default:g=Ql}var v=h.name?h.name:h.uuid,b=void 0!==f.interpolation?E[f.interpolation]:gn,x=[];S[m.path]===S.weights?h.traverse(():x.push(v);var w=p.array;if(p.normalized){var _;if(w.constructor===Int8Array)_=1/127;else if(w.constructor===Uint8Array)_=1/255;else if(w.constructor==Int16Array)_=1/32767;else{if(w.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");_=1/65535}for(var M=new Float32Array(w.length),T=0,A=w.length;T<A;T++)M[T]=w[T]*_;w=M}for(T=0,A=x.length;T<A;T++){var P=new g(x[T]+"."+S[m.path],d.array,w,b);"CUBICSPLINE"===f.interpolation&&(P.createInterpolant=P.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(P)}}}return new eu(t.name?t.name:"animation_"+e,void 0,c)}))},R.prototype.loadNode=function(e){var t,n=this.json,i=this.extensions,r=this,o=n.nodes[e],s=o.name?r.createUniqueName(o.name):"";return(t=[],void 0!==o.mesh&&t.push(r.getDependency("mesh",o.mesh).then(()),void 0!==o.camera&&t.push(r.getDependency("camera",o.camera).then(()),r._invokeAll(().forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var n;if((n=!0===o.isBone?new pc:t.length>1?new Na:1===t.length?t[0]:new $i)!==t[0])for(var a=0,c=t.length;a<c;a++)n.add(t[a]);if(o.name&&(n.userData.name=o.name,n.name=s,"Mesh"===n.type&&(n.uuid=o.name)),P(n,o),o.extensions&&A(i,n,o),void 0!==o.matrix){var l=new Ti;l.fromArray(o.matrix),n.applyMatrix4(l)}else void 0!==o.translation&&n.position.fromArray(o.translation),void 0!==o.rotation&&n.quaternion.fromArray(o.rotation),void 0!==o.scale&&n.scale.fromArray(o.scale);return r.associations.set(n,{type:"nodes",index:e}),n}))},R.prototype.loadScene=function(){function e(t,n,i,r){var o=i.nodes[t];return r.getDependency("node",t).then((function(e){return void 0===o.skin?e:r.getDependency("skin",o.skin).then(().then((function(n){return e.traverse((function(e){if(e.isMesh){for(var i=[],r=[],o=0,s=n.length;o<s;o++){var a=n[o];if(a){i.push(a);var c=new Ti;void 0!==t.inverseBindMatrices&&c.fromArray(t.inverseBindMatrices.array,16*o),r.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new dc(i,r),e.matrixWorld)}})),e}));var t})).then(()}return function(t){var n=this.json,i=this.extensions,r=this.json.scenes[t],o=new Na;r.name&&(o.name=this.createUniqueName(r.name)),P(o,r),r.extensions&&A(i,o,r);for(var s=r.nodes||[],a=[],c=0,l=s.length;c<l;c++)a.push(e(s[c],o,n,this));return Promise.all(a).then((function(){return o}))}}(),e}(),Bm=function(e){ru.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};Bm.prototype=Object.assign(Object.create(ru.prototype),{constructor:Bm,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,n,i){var r=new su(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{var n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(i)}),n,i)},decodeDracoFile:decodeGeometry:function(e,t){for(var n in t.attributeTypes){var i=t.attributeTypes[n];void 0!==i.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=i.name)}var r,o=JSON.stringify(t);if(Bm.taskCache.has(e)){var s=Bm.taskCache.get(e);if(s.key===o)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var a=this.workerNextTaskID++,c=e.byteLength,l=this._getWorker(a,c).then(().then(();return l.catch(().then((),Bm.taskCache.set(e,{key:o,promise:l}),l},_createGeometry:function(e){var t=new Wr;e.index&&t.setIndex(new Tr(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],r=i.name,o=i.array,s=i.itemSize;t.setAttribute(r,new Tr(o,s))}return t},_loadLibrary:preload:_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{var n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var i=Bm.DRACOWorker.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then((()=>{var n;return this.workerPool.length<this.workerLimit?((n=new Worker(this.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=this.workerPool.push(n)):this.workerPool.sort((),(n=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,n._taskLoad+=t,n}))},_releaseTask:debug:dispose:),Bm.DRACOWorker=function(){var e,t;nmessage=function(i){var r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise(();break;case"decode":var o=r.buffer,s=r.taskConfig;t.then((e=>{var t=e.draco,i=new t.Decoder,a=new t.DecoderBuffer;a.Init(new Int8Array(o),o.byteLength);try{var c=function(e,t,i,r){var o,s,a=r.attributeIDs,c=r.attributeTypes,l=t.GetEncodedGeometryType(i);if(l===e.TRIANGULAR_MESH)o=new e.Mesh,s=t.DecodeBufferToMesh(i,o);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,s=t.DecodeBufferToPointCloud(i,o)}if(!s.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var u={index:null,attributes:[]};for(var h in a){var d,p,f=self[c[h]];if(r.useUniqueIDs)p=a[h],d=t.GetAttributeByUniqueId(o,p);else{if(-1===(p=t.GetAttributeId(o,e[a[h]])))continue;d=t.GetAttribute(o,p)}u.attributes.push(n(e,t,o,h,f,d))}return l===e.TRIANGULAR_MESH&&(u.index=e,t,o)),e.destroy(o),u}(t,i,a,s),l=c.attributes.map(();c.index&&l.push(c.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:c},l)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}finally{t.destroy(a),t.destroy(i)}}))}}},Bm.taskCache=new WeakMap,Bm.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},Bm.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},Bm.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},Bm.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")},function(e){e[e.forwardImmediateBack=0]="forwardImmediateBack",e[e.forwardWaitForBack=1]="forwardWaitForBack"}(zm||(zm={}));class Fm{constructor(e,t,n,i){Object.defineProperty(this,"completionStatus",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"activeStatus",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"canceledStatus",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"myTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mixer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animationFinished",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mixer=e,this.animation=this.buildAnimation(e,t,n.duration),this.options=n,this.myTags=i||[],this.animationFinished=new Promise((e=>{this.mixer.addEventListener("finished",(()=>{this.completionStatus=!0,this.activeStatus=!1,e()}))}))}get isComplete(){return this.completionStatus}get isActive(){return this.activeStatus}get tags(){return this.myTags}get isCanceled(){return this.canceledStatus}pdate(e){this.mixer.update(e)}start(){return this.activeStatus=!0,this.options.direction===V.forward?this.playAnimationForward():this.playAnimationBackward(),this.animationFinished}ldAnimation(e,t,n){const i=e.clipAction(t);return void 0!==n&&i.setDuration(n),i.setLoop(2200,1),i.play(),i}playAnimationForward(){this.resetMeshState(),this.animation.setEffectiveTimeScale(Math.abs(this.animation.timeScale)),this.animation.clampWhenFinished=!0}playAnimationBackward(){0===this.animation.time&&(this.animation.time=this.animation.getClip().duration),this.resume(),this.animation.setEffectiveTimeScale(-Math.abs(this.animation.timeScale))}}class km{constructor(e){Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"custom model"}),Object.defineProperty(this,"modelUri",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotationOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"positionOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"surfaceMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dracoLoader",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animationClips",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mixer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"productStates",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"surfaceAliases",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.animationClips=[],this.modelUri=e.modelUri,this.rotationOffset=e.rotationOffset,this.positionOffset=e.positionOffset,this.dracoLoader=function(){const e=new Bm(iu);return e.setDecoderPath("https://vortex.documents.cimpress.io/draco/v3/"),e.setDecoderConfig({type:"js"}),e}(),e.modelStates&&e.modelStates.length>0?this.productStates=e.modelStates:this.productStates=[],this.currentState=this.productStates[0];const t={};Object.entries(e.productMapping).map((([e,n])=>t[e]=n.alias)),this.surfaceAliases=t;const n={};Object.entries(Im(e.productMapping,e.fullBleed)).forEach((([e,i])=>{var r;const o=null!==(r=t[e])&&void 0!==r?r:e;n[o]=i})),this.surfaceMapping=n}getGeometry(){return function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){if(this.meshGroup)return this.meshGroup;if(yield this.preLoad(),void 0===this.meshGroup)throw new Error("Failed to load model from uri");return this.meshGroup}))}getSurfaceMapping(){return this.surfaceMapping}setProductSurface(e,t){if(!this.surfaceMapping[e])throw new Error(`'${e}' is not a surface on this modeled product`);this.surfaceMapping[e]=Object.assign(Object.assign({},this.surfaceMapping[e]),t)}getAreaLights(e,t){return wd([.42*e,.42*e,.3885*e,.3885*e,.4515*e,.42*e])}getCurrentState(){return this.currentState}setStates(e){this.productStates=e}setCurrentState(e){const t=this.getStates().find((t=>t.id===e));if(!t)throw new Error(`'${e} is not a state defined in this product!`);this.currentState=t}getStates(){return this.productStates}getAnimationIds(){const e=[];return this.animationClips.forEach((t=>e.push(t.name))),e}buildAnimation(e){void 0===this.mixer&&(this.mixer=new Lh(this.meshGroup));const t=this.getAnimationClip(e.animationId),n={direction:e.direction,duration:e.duration};return new Fm(this.mixer,t,n)}getAnimationClip(e){let t;if(e){const n=this.animationClips.find((t=>t.name===e));if(!n)throw new Error(`Animation with name ${e} was not found`);t=n}else{if(!(this.animationClips.length>0))throw new Error("No animation was found");t=this.animationClips[0]}return t}preLoad(){if(void 0!==this.meshGroup)return Promise.resolve();const e=this.dracoLoader);return new Promise((t=>{e.load(this.modelUri,(e=>{this.rotationOffset&&e.scene.rotation.set(this.rotationOffset.yaw,this.rotationOffset.pitch,this.rotationOffset.roll),e.animations&&e.animations.forEach((),0===this.productStates.length&&(this.productStates.push({id:"Folded"}),this.animationClips.forEach((e=>{this.productStates.push({id:`${e.name}-forward`,dependency:{stateId:"Folded",animationId:e.name,animationDirection:V.forward}})})),this.currentState=this.productStates[0]),this.meshGroup=Nm(this.positionOffset,e.scene),Dm(this.meshGroup,(e=>{var t,n;const i=null!==(t=this.surfaceAliases[e.uuid])&&void 0!==t?t:e.uuid;if(e.uuid=i,this.surfaceMapping[i].finishes)for(const r of this.surfaceMapping[i].finishes){const t=e.clone();t.uuid=`${i}-${r.name}`,t.name=`${i}-${r.name}`,t.parent=e.parent,null===(n=e.parent)||void 0===n||n.children.push(t)}})),t()}))}))}var jm=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};class Hm{constructor(e){Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"custom model"}),Object.defineProperty(this,"modelUri",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotationOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"positionOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"surfaceMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"surfaceAliases",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modelUri=e.modelUri,this.rotationOffset=e.rotationOffset,this.positionOffset=e.positionOffset;const t={};Object.entries(e.productMapping).map((([e,n])=>t[e]=n.alias)),this.surfaceAliases=t;const n={};Object.entries(Im(e.productMapping,e.fullBleed)).forEach((([e,i])=>{var r;const o=null!==(r=t[e])&&void 0!==r?r:e;n[o]=i})),this.surfaceMapping=n}getGeometry(){return function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){if(this.meshGroup)return this.meshGroup;if(yield this.preLoad(),void 0===this.scene)throw new Error("Failed to load model from uri");return this.meshGroup=new Na,this.meshGroup.add(this.scene),Nm(this.positionOffset,this.meshGroup)}))}getSurfaceMapping(){return this.surfaceMapping}setProductSurface(e,t){if(!this.surfaceMapping[e])throw new Error(`'${e}' is not a surface on this modeled product`);this.surfaceMapping[e]=Object.assign(Object.assign({},this.surfaceMapping[e]),t)}getAreaLights(e,t){return wd([.42*e,.42*e,.3885*e,.3885*e,.4515*e,.42*e])}getStates(){return[{id:"default"}]}setStates(e){}getCurrentState(){return{id:"default"}}setCurrentState(e){}getAnimationIds(){return[]}buildAnimation(e){throw new Error("Method not implemented for Collda products.")}preLoad(){if(void 0!==this.scene)return Promise.resolve();const e=new Cm(iu);return new Promise((t=>{e.load(this.modelUri,(e=>{e&&e.scene||t(),this.scene=e.scene,this.rotationOffset&&e.scene.rotation.set(this.rotationOffset.yaw,this.rotationOffset.pitch,this.rotationOffset.roll),Dm(this.scene,(e=>{var t,n;const i=null!==(t=this.surfaceAliases[e.uuid])&&void 0!==t?t:e.uuid;if(e.uuid=i,this.surfaceMapping[i].finishes)for(const r of this.surfaceMapping[i].finishes){const t=e.clone();t.geometry=e.geometry.clone(),t.uuid=`${i}-${r.name}`,t.name=`${i}-${r.name}`,t.parent=e.parent,null===(n=e.parent)||void 0===n||n.children.push(t)}})),t()}))}))}dispose(){this.scene&&md(this.scene),this.scene=void 0,this.meshGroup=void 0}}var Gm=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};const Vm=Math.PI/180;function Wm(e){let t={yaw:0,pitch:0,roll:0};return e&&(t={yaw:e.yaw*Vm,pitch:e.pitch*Vm,roll:e.roll*Vm}),t}function qm(e,t,n,i){const r=2*t;for(let o=0;o<3;o++)e.faceVertexUvs[0][r][o].x/=n,e.faceVertexUvs[0][r][o].y/=i;for(let o=0;o<3;o++)e.faceVertexUvs[0][r+1][o].x/=n,e.faceVertexUvs[0][r+1][o].y/=i}function Xm(e,t,n){const i=new Du;i.moveTo(0,0),i.lineTo(t,t),i.lineTo(t,e-t),i.lineTo(0,e);const r=new _l(i,{bevelEnabled:!1,depth:n,curveSegments:1});return qm(r,0,e,e),qm(r,1,e,e),ld(r,3,0,n/e,0,1),ld(r,5,0,n/e,0,1),r}function Ym(e,t,n,i,r,o){const s=[],a=e.width+2*t+2*i,c=Xm(e.height+2*t+2*i,t,1.01*n),l=new lo(c);l.uuid=`${o}-left`,l.position.setX(.5*-e.width-(t+i)),l.position.setY(.5*-e.height-(t+i)),l.position.setZ(.5*-e.depth-r);const u=new lo(c);u.uuid=`${o}-right`,u.rotateZ(Math.PI),u.position.setX(.5*e.width+(t+i)),u.position.setY(.5*e.height+(t+i)),u.position.setZ(.5*-e.depth-r),s.push(l),s.push(u);const h=Xm(a,t,n),d=new lo(h);d.uuid=`${o}-top`,d.rotateZ(1.5*Math.PI),d.position.setX(.5*-e.width-(t+i)),d.position.setY(.5*e.height+(t+i)),d.position.setZ(.5*-e.depth-r);const p=new lo(h);return p.uuid=`${o}-bottom`,p.rotateZ(.5*Math.PI),p.position.setX(.5*e.width+(t+i)),p.position.setY(.5*-e.height-(t+i)),p.position.setZ(.5*-e.depth-r),s.push(d),s.push(p),s}class Zm{constructor(e){var t,n;Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"canvas print"}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initializedGeometry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"surfaceMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e;const{fabricSubstrate:i}=this.config,r=this.config.interiorOptions.frameOptions.substrate;if(this.surfaceMapping={front:{page:1,substrate:i,fullBleed:this.config.fullBleed,focalPoint:{cameraView:new Kn(0,0,-1)}},left:{page:1,substrate:i,fullBleed:this.config.fullBleed,focalPoint:{cameraView:new Kn(1,0,-.2).normalize()}},right:{page:1,substrate:i,fullBleed:this.config.fullBleed,focalPoint:{cameraView:new Kn(-1,0,-.2).normalize()}},top:{page:1,substrate:i,fullBleed:this.config.fullBleed,focalPoint:{cameraView:new Kn(0,-1,-.2).normalize()}},bottom:{page:1,substrate:i,fullBleed:this.config.fullBleed,focalPoint:{cameraView:new Kn(0,1,-.2).normalize()}}},this.surfaceMapping["back-center"]={substrate:i,fullBleed:this.config.fullBleed},this.surfaceMapping["back-left"]={substrate:i,fullBleed:this.config.fullBleed},this.surfaceMapping["back-right"]={substrate:i,fullBleed:this.config.fullBleed},this.surfaceMapping["back-top"]={substrate:i,fullBleed:this.config.fullBleed},this.surfaceMapping["back-bottom"]={substrate:i,fullBleed:this.config.fullBleed},this.surfaceMapping["interior-frame-left"]={substrate:r,fullBleed:this.config.fullBleed},this.surfaceMapping["interior-frame-right"]={substrate:r,fullBleed:this.config.fullBleed},this.surfaceMapping["interior-frame-top"]={substrate:r,fullBleed:this.config.fullBleed},this.surfaceMapping["interior-frame-bottom"]={substrate:r,fullBleed:this.config.fullBleed},null===(t=this.config.exteriorOptions)||void 0===t?void 0:t.cover){const e=this.config.exteriorOptions.cover;this.addCover(e.substrate,e.depth)}(null===(n=this.config.exteriorOptions)||void 0===n?void 0:n.frameOptions)&&this.addFrame(this.config.exteriorOptions.frameOptions)}getGeometry(){var e,t;return function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){this.initializedGeometry&&md(this.initializedGeometry);const n={width:this.config.fullBleed.width,height:this.config.fullBleed.height,depth:this.config.depth},i=this.computeOuterUVCoords(),r=this.computeInnerUVCoords(i);return this.initializedGeometry=new Na,this.initializedGeometry.add(...function(e,t,n){const i=[],r=new El(e.width,e.height);ud(r,t[0],t[2],t[1],t[3]);const o=new lo(r);o.uuid="front",o.position.setZ(e.depth/2),i.push(o);const s=new El(e.depth,e.height);ud(s,n[0],t[0],t[1],t[3]);const a=new lo(s);a.uuid="left",a.rotateY(-Math.PI/2),a.position.setX(-e.width/2),i.push(a);const c=new El(e.depth,e.height);ud(c,t[2],n[2],t[1],t[3]);const l=new lo(c);l.uuid="right",l.rotateY(Math.PI/2),l.position.setX(e.width/2),i.push(l);const u=new El(e.width,e.depth);ud(u,t[0],t[2],t[3],n[3]);const h=new lo(u);h.uuid="top",h.rotateX(-Math.PI/2),h.position.setY(e.height/2),i.push(h);const d=new El(e.width,e.depth);ud(d,t[0],t[2],n[1],t[1]);const p=new lo(d);return p.uuid="bottom",p.rotateX(Math.PI/2),p.position.setY(-e.height/2),i.push(p),i}(n,r,i)),this.initializedGeometry.add(...function(e,t,n){const i=[],r=new El(e.width,e.height);ud(r,t[0],t[2],t[1],t[3]);const o=new lo(r);o.uuid="back-center",o.rotateY(Math.PI),o.position.setZ(e.depth/2-.5),i.push(o);const s=new El(e.depth/3,e.height);ud(s,0,n[0],t[1],t[3]);const a=new lo(s);a.uuid="back-left",a.rotateY(Math.PI),a.position.setX(-e.width/2+e.depth/6),a.position.setZ(-e.depth/2-.01),i.push(a);const c=new El(e.depth/3,e.height);ud(c,n[2],1,t[1],t[3]);const l=new lo(c);l.uuid="back-right",l.rotateY(Math.PI),l.position.setX(e.width/2-e.depth/6),l.position.setZ(-e.depth/2-.01),i.push(l);const u=new El(e.width,e.depth/3);ud(u,t[2],t[0],1,n[3]);const h=new lo(u);h.uuid="back-top",h.rotateY(Math.PI),h.position.setY(e.height/2-e.depth/6),h.position.setZ(-e.depth/2),i.push(h);const d=new El(e.width,e.depth/3);ud(d,t[2],t[0],n[1],0);const p=new lo(d);return p.uuid="back-bottom",p.rotateY(Math.PI),p.position.setY(-e.height/2+e.depth/6),p.position.setZ(-e.depth/2),i.push(p),i}(n,r,i)),this.initializedGeometry.add(...this.buildInteriorFrame(n)),(null===(e=this.config.exteriorOptions)||void 0===e?void 0:e.cover)&&this.initializedGeometry.add(...this.buildExteriorCover(n,this.config.exteriorOptions.cover.depth)),(null===(t=this.config.exteriorOptions)||void 0===t?void 0:t.frameOptions)&&(this.initializedGeometry.add(...this.buildExteriorFrameInner(n,this.config.exteriorOptions.frameOptions)),this.initializedGeometry.add(...this.buildExteriorFrameOuter(n,this.config.exteriorOptions.frameOptions))),this.initializedGeometry}))}getSurfaceMapping(){return this.surfaceMapping}setProductSurface(e,t){if(!this.surfaceMapping[e])throw new Error(`'${e}' is not a surface on this canvas product`);this.surfaceMapping[e]=t}getStates(){return[{id:"default"}]}setStates(e){}getCurrentState(){return{id:"default"}}setCurrentState(e){}getAnimationIds(){return[]}buildAnimation(e){throw new Error("Method not implemented for Canvas products.")}getAreaLights(e,t){return wd([.42*e,.42*e,.42*e,.42*e,.3675*e,.3675*e])}preLoad(){return Promise.resolve()}dispose(){this.initializedGeometry&&(md(this.initializedGeometry),this.initializedGeometry=void 0)}addCover(e,t){this.config.exteriorOptions?this.config.exteriorOptions.cover={substrate:e,depth:t}:this.config.exteriorOptions={cover:{substrate:e,depth:t}},this.surfaceMapping.cover={substrate:e,fullBleed:this.config.fullBleed}}addFrame(e){this.config.exteriorOptions?this.config.exteriorOptions.frameOptions=e:this.config.exteriorOptions={frameOptions:e},this.surfaceMapping["exterior-frame-inner-left"]={substrate:e.substrate,fullBleed:this.config.fullBleed},this.surfaceMapping["exterior-frame-inner-right"]={substrate:e.substrate,fullBleed:this.config.fullBleed},this.surfaceMapping["exterior-frame-inner-top"]={substrate:e.substrate,fullBleed:this.config.fullBleed},this.surfaceMapping["exterior-frame-inner-bottom"]={substrate:e.substrate,fullBleed:this.config.fullBleed},this.surfaceMapping["exterior-frame-outer-left"]={substrate:e.substrate,fullBleed:this.config.fullBleed},this.surfaceMapping["exterior-frame-outer-right"]={substrate:e.substrate,fullBleed:this.config.fullBleed},this.surfaceMapping["exterior-frame-outer-top"]={substrate:e.substrate,fullBleed:this.config.fullBleed},this.surfaceMapping["exterior-frame-outer-bottom"]={substrate:e.substrate,fullBleed:this.config.fullBleed}}buildInteriorFrame(e){const{thickness:t}=this.config.interiorOptions.frameOptions;return Ym({width:.96*e.width-2*t,height:.96*e.height-2*t,depth:.9*e.depth},t,.9*e.depth,0,0,"interior-frame")}buildExteriorCover(e,t){const n=[],i=new qc(.99*e.width,.99*e.height,t);hd(i);const r=new lo(i);return r.uuid="cover",r.position.setZ(.5*-e.depth-.5*t),n.push(r),n}buildExteriorFrameInner(e,t){const n=[],i=new qc(t.inner.thickness,e.height+t.inner.thickness,t.inner.depth);hd(i);const r=new lo(i);r.uuid="exterior-frame-inner-left",r.position.setX(.5*-e.width),r.position.setZ(.5*-e.depth-.5*t.inner.depth);const o=new lo(i);o.uuid="exterior-frame-inner-right",o.position.setX(.5*e.width),o.position.setZ(.5*-e.depth-.5*t.inner.depth),n.push(r),n.push(o);const s=new qc(e.width,t.inner.thickness,t.inner.depth);hd(s);const a=new lo(s);a.uuid="exterior-frame-inner-top",a.position.setY(.5*e.height),a.position.setZ(.5*-e.depth-.5*t.inner.depth);const c=new lo(s);return c.uuid="exterior-frame-inner-bottom",c.position.setY(.5*-e.height),c.position.setZ(.5*-e.depth-.5*t.inner.depth),n.push(a),n.push(c),n}buildExteriorFrameOuter(e,t){const{thickness:n,depth:i}=t.outer;return Ym(e,n,i,.5*t.inner.thickness,t.inner.depth,"exterior-frame-outer")}computeOuterUVCoords(){if(this.config.trim){const{trim:e}=this.config;return[e.topLeftX/this.config.fullBleed.width,e.topLeftY/this.config.fullBleed.height,e.bottomRightX/this.config.fullBleed.width,e.bottomRightY/this.config.fullBleed.height]}return[0,0,1,1]}computeInnerUVCoords(e){const t=this.config.fullBleed.width+2*this.config.depth,n=this.config.fullBleed.height+2*this.config.depth,i=this.config.depth/t,r=this.config.depth/n;return[e[0]+i,e[1]+r,e[2]-i,e[3]-r]}}var Jm=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))},$m=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))},Km=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};function Qm(e){return Km(this,void 0,void 0,(function*(){switch(e.type){case Pp.flatSheet:return function(e){return Rm(this,void 0,void 0,(function*(){const{surfaceMapping:t}=e;if(!t.front||!t.body||!t.back)throw new Error("The FlatSheetProductConfig must contain three surfaces for front, body, and back!");const n=yield Pm(e),i=yield Lm(e),r=t.front.substrateId,o=t.body.substrateId,s=t.back.substrateId,a=[];if(e.finishUrlMap&&t.front.finishIds)for(let e=0;e<t.front.finishIds.length;e++){const n=t.front.finishIds[e];a.push(i[n])}const c=yield dm.get(e.productDataUrl);if(c.status>=400)throw new Error(`Failed to fetch FlatSheetData from '${e.productDataUrl}'!`);const l=c.data,u={substrates:[n[r],n[o],n[s]],finishes:a,fullBleed:l.fullBleed,trim:l.trim,depth:l.thickness,orientation:l.orientation,customPath:l.customPath};return new wm(u)}))}(e);case Pp.model:return function(e){return Gm(this,void 0,void 0,(function*(){const t=yield dm.get(e.productDataUrl);if(t.status>=400)throw new Error(`Failed to fetch ModelData from '${e.productDataUrl}'!`);const n=t.data,i=Object.keys(e.surfaceMapping),r={},o=yield Pm(e),s=yield Lm(e);for(const a of i){const t=e.surfaceMapping[a];if(!n.surfaceData[a])throw new Error(`The model data does not contain surface '${a}'!`);r[a]={page:t.page,substrate:o[t.substrateId],fullBleed:n.surfaceData[a].fullBleed,trim:n.surfaceData[a].trim,focalPoint:t.focalPoint,alias:n.surfaceData[a].alias},t.finishIds&&(r[a].finishes=t.finishIds.map(())}return function(e){var t;return jm(this,void 0,void 0,(function*(){if(e.type){if(e.type===Om.dae)return new Hm(e);if(e.type===Om.glb)return new km(e);throw new Error(`The model type: ${e.type} is not supported!`)}const n=yield fetch(e.modelUri,{method:"HEAD"});if(n.status>=400)throw new Error(`Failed to fetch the model asset at '${e.modelUri}'`);return(null===(t=n.headers.get("content-type"))||void 0===t?void 0:t.includes("binary"))?new km(e):new Hm(e)}))}({type:n.type,modelUri:n.modelUrl,productMapping:r,fullBleed:{width:0,height:0},rotationOffset:Wm(n.rotationOffset),positionOffset:n.positionOffset,modelStates:e.modelStates})}))}(e);case Pp.nFold:return function(e){var t,n;return $m(this,void 0,void 0,(function*(){const i=yield dm.get(e.productDataUrl);if(i.status>=400)throw new Error(`Failed to fetch NFoldData from '${e.productDataUrl}'!`);const r=i.data,o=[],s=yield Pm(e),a=yield Lm(e);for(const c of r.sectionSets){const i=[];for(const r of c.sections){const o=`${r.id}:Front`,c=`${r.id}:Body`,l=`${r.id}:Back`;if(!e.surfaceMapping[o]||!e.surfaceMapping[c]||!e.surfaceMapping[l])throw new Error("The surface mapping must contain three surfaces (front, body, and back) for section!");const u=e.surfaceMapping[o],h=e.surfaceMapping[c],d=e.surfaceMapping[l],p={id:r.id,path:r.path,frontSide:{page:u.page,contentOffset:null===(t=u.contentOptions)||void 0===t?void 0:t.offset,substrate:s[u.substrateId],focalPoint:u.focalPoint},backSide:{page:d.page,contentOffset:null===(n=d.contentOptions)||void 0===n?void 0:n.offset,substrate:s[d.substrateId],focalPoint:d.focalPoint},bodySubstrate:s[h.substrateId]};if(u.finishIds){p.frontSide.finishes=[];for(const e of u.finishIds)p.frontSide.finishes.push(a[e])}if(d.finishIds){p.backSide.finishes=[];for(const e of d.finishIds)p.backSide.finishes.push(a[e])}if(r.path.fills){p.fillSubstrates=[];for(let t=0;t<r.path.fills.length;t++){const n=`${r.id}:Body Fill:${t}`;if(!e.surfaceMapping[n])throw new Error(`The surface mapping must include '${n}' because the path has fill sections!`);const i=e.surfaceMapping[n];p.fillSubstrates.push(s[i.substrateId])}}i.push(p)}o.push({id:c.id,name:c.name,fullBleed:c.fullBleed,trim:c.trim,thickness:c.thickness,baseSectionId:c.baseSectionId,sections:i,folds:c.folds,foldSequences:c.foldSequences,rotationOffset:c.rotationOffset,positionOffset:c.positionOffset})}return new Tm({sectionSets:o})}))}(e);case Pp.canvasPrint:return function(e){var t,n,i,r,o,s;return Jm(this,void 0,void 0,(function*(){const a=yield dm.get(e.productDataUrl);if(a.status>=400)throw new Error(`Failed to fetch CanvasPrintData from '${e.productDataUrl}'!`);const c=a.data,l=yield Pm(e),{surfaceMapping:u}=e;if(!u.canvas||!u.interiorFrame)throw new Error("The surface mapping must contain surfaces for canvas and interiorFrame!");const h={fullBleed:c.fullBleed,trim:c.trim,depth:c.depth,fabricSubstrate:l[u.canvas.substrateId],interiorOptions:{frameOptions:{thickness:c.interiorOptions.frameOptions.thickness,substrate:l[u.interiorFrame.substrateId]}}};if(null===(t=c.exteriorOptions)||void 0===t?void 0:t.cover){if(!u.cover)throw new Error("The surface mapping is missing a cover!");h.exteriorOptions={cover:{substrate:l[u.cover.substrateId],depth:c.exteriorOptions.cover.depth}}}if(null===(n=c.exteriorOptions)||void 0===n?void 0:n.frameOptions){if(!u.exteriorFrame)throw new Error("The surface mapping is missing an exteriorFrame!");const e={substrate:l[u.exteriorFrame.substrateId],inner:{depth:null===(i=c.exteriorOptions)||void 0===i?void 0:i.frameOptions.inner.depth,thickness:null===(r=c.exteriorOptions)||void 0===r?void 0:r.frameOptions.inner.thickness},outer:{depth:null===(o=c.exteriorOptions)||void 0===o?void 0:o.frameOptions.outer.depth,thickness:null===(s=c.exteriorOptions)||void 0===s?void 0:s.frameOptions.outer.thickness}};h.exteriorOptions?h.exteriorOptions.frameOptions=e:h.exteriorOptions={frameOptions:e}}return new Zm(h)}))}(e);default:throw new Error(`Unsupported product type '${e.type}'!`)}}))}var eg=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};const tg=({productConfig:e})=>eg(void 0,void 0,void 0,(function*(){return"string"==typeof e?(t=e,eg(void 0,void 0,void 0,()):e.sku?function(e){return Km(this,void 0,void 0,(function*(){const t=JSON.stringify(e.attributes);let n=`https://cdn.previews.cimpress.io/v2/modelConfig?sku=${e.sku}&skuAttributes=${encodeURIComponent(t)}&tenantId=${e.tenant.id}&tenantType=${e.tenant.type}`;e.ignoreLinkedModels&&(n+=`&ignoreVortexModel=${e.ignoreLinkedModels}`),e.version&&(n+=`&version=${e.version}`);const i=yield dm.get(n);if(i.status>=400)throw new Error(`Failed to fetch vortex product config: '${JSON.stringify(i.data)}'!`);return i.data}))}(e):e;var t}));var ng=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};const ig=const rg=(0,i.createContext)({loadingModel:!1,updatingCanvas:!1,preview:void 0,vortexCanvasRef:(0,i.createRef)(),error:void 0});rg.Consumer;const og=class sg extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{hasError:!1}})}omponentDidCatch(e,t){this.props.onError(e,t)}function ag({user:e,productConfig:t,renderingInstructionsUrl:n,children:o,initializationOptions:s,cameraOptions:a,environmentOptions:c,onError:l,preserveCamera:u=!1,vortexDocumentAdapter:h}){const[d,p]=(0,i.useState)({updating:!1}),f=(0,i.useRef)(null),m=function(e,t){const[n,r]=(0,i.useState)();if((0,i.useEffect)((()=>{let n=!1;return tg({productConfig:e}).then((t=>{n||r({source:e,resolved:t})})).catch((i=>{var o,s,a;if(!n){const n=new Error(null!==(a=null===(s=null===(o=i.response)||void 0===o?void 0:o.data)||void 0===s?void 0:s.message)&&void 0!==a?a:i.message);r({source:e,error:n}),t(n)}})),),[e,t]),(null==n?void 0:n.source)===e)return{resolved:n.resolved,error:n.error}}(t,l),g=(0,i.useMemo)((()=>{if(f.current)return Ap({partialCameraOptions:a||{},partialEnvironmentOptions:c||{},canvas:f.current})}),[a,c,f.current]),v=(0,i.useCallback)((,[]),y=(0,i.useCallback)((e=>{p({updating:!1,error:e}),e&&l(e)}),[l]),{preview:b}=function({productConfig:e,productLoadingOptions:t,renderingInstructionsUrl:n,previewConfig:r,initializationOptions:o,onError:s,onAfterVortexUpdate:a,onBeforeVortexUpdate:c,preserveCamera:l,user:u,vortexDocumentAdapter:h}){const[d,p]=(0,i.useState)(),f=(0,i.useMemo)((,[u]),m=(0,i.useMemo)((()=>{let e;return{get:()=>(e||(e=function(){let e,t,n,i=!1,r=!1;return{syncWithVortex({previewConfig:o,productConfig:s,initializationOptions:a,onError:c,onAfterVortexUpdate:l,onBeforeVortexUpdate:u,preserveCamera:h,vortexDocumentAdapter:d}){return ng(this,void 0,void 0,(function*(){if(e=void 0,cancelAnimationFrame(t),!o||!s)return{preview:null==n?void 0:n.preview};if(i)return e={previewConfig:o,productConfig:s,initializationOptions:a,onError:c,onAfterVortexUpdate:l,onBeforeVortexUpdate:u,preserveCamera:h,vortexDocumentAdapter:d},{preview:null==n?void 0:n.preview};const p=()=>ng(this,void 0,void 0,(function*(){var e,t,i,r;if(n)try{n.preview.dispose(),n.vortexDocumentAdapter.dispose()}catch(e){console.warn("Error in preview.dispose()"),console.warn(e)}try{u();const c=new Tp(Object.assign({},o)),h=yield Qm(s);yield c.load(h,(e=>d.generateCanvases(e)),{scaleToInitialState:null==a?void 0:a.scaleToInitialState}),(null==a?void 0:a.cameraOrientation)&&c.adjustRotation({azimuth:a.cameraOrientation.azimuthAngle,polar:null!==(e=a.cameraOrientation.polarAngle)&&void 0!==e?e:Math.PI/2}),(null===(t=null==a?void 0:a.swivel)||void 0===t?void 0:t.enabled)&&function(e,t,n,i){const r={range:t,damping:null!=n&&n,tags:[]},o=new X(e.getProductGeometry,r);e.pushAnimation(o).start()}(c,null!==(i=a.swivel.range)&&void 0!==i?i:.6,null!==(r=a.swivel.damping)&&void 0!==r?r:.55),c.start(),l(),n={preview:c,previewConfig:o,productConfig:s,initializationOptions:a,vortexDocumentAdapter:d}}catch(e){c(e),l(e)}}));if(i=!0,ig(null==n?void 0:n.previewConfig,o)||ig(null==n?void 0:n.initializationOptions,a))yield p();else{if(!n)return console.log("syncWithVortex: ??"),{preview:void 0};if(ig(n.productConfig,s))if(h)try{u();const e=yield Qm(s);yield n.preview.load(e,(e=>d.generateCanvases(e)),{scaleToInitialState:null==a?void 0:a.scaleToInitialState}),l()}catch(e){c(e),l(e)}else yield p();else if(ig(n.vortexDocumentAdapter,d))try{u(),yield n.preview.update((),l()}catch(e){c(e),l(e)}n={preview:n.preview,previewConfig:o,productConfig:s,initializationOptions:a,vortexDocumentAdapter:d}}if(i=!1,r&&n)n.preview.dispose(),n.vortexDocumentAdapter.dispose();else if(e){const n=e;e=void 0,cancelAnimationFrame(t),t=requestAnimationFrame((()=>{r||i||this.syncWithVortex(n)}))}return{preview:null==n?void 0:n.preview}}))},dispose(){n&&(n.preview.dispose(),n.vortexDocumentAdapter.dispose(),e=void 0,cancelAnimationFrame(t)),r=!0}}}()),e),dispose:}),[]);return(0,i.useEffect)((()=>{let t=h;if(!t){if(!n)throw new Error("renderingInstructionsUrl should be defined when no vortexDocumentAdapte is provided");t={generateCanvases:dispose:}m.get().syncWithVortex({previewConfig:r,productConfig:e,initializationOptions:o,onBeforeVortexUpdate:c,onAfterVortexUpdate:a,onError:s,preserveCamera:l,vortexDocumentAdapter:t}).then(()}),[r,t,e,n,o,c,a,s,l,m,f,h]),(0,i.useEffect)((,[m]),{preview:d}}({previewConfig:g,initializationOptions:s,productConfig:null==m?void 0:m.resolved,onError:l,onBeforeVortexUpdate:v,onAfterVortexUpdate:y,renderingInstructionsUrl:n,preserveCamera:u,user:e,vortexDocumentAdapter:h}),x=!((null==m?void 0:m.resolved)&&b||(null==m?void 0:m.error)),w={vortexCanvasRef:f,preview:b,loadingModel:x,updatingCanvas:d.updating,error:(null==m?void 0:m.error)||d.error};return r().createElement(rg.Provider,{value:w},"function"==typeof o?o(w):o)}function cg(e){const{fallback:t,onError:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["fallback","onError"]);return r().createElement(sg,{fallback:t,onError:n},r().createElement(ag,Object.assign({},i,{onError:n})))}const lg=e=>{const{vortexCanvasRef:t}=og(),{children:n}=e,o=e,["children"]);return(0,i.useEffect)((()=>()=>{if(null==t?void 0:t.current){const e=t.current;e.width=1,e.height=1}}),[]),r().createElement("canvas",Object.assign({ref:t,style:{maxWidth:"100%",maxHeight:"100%",minWidth:"100%",minHeight:"100%"}},o),n)};function ug({cameraViews:e,animations:t,children:n}){var o;const{preview:s}=og(),[a,c]=(0,i.useState)(),l=null==s?void 0:s.product,[u,h]=(0,i.useState)(null==l?void 0:l.getCurrentState());(0,i.useEffect)((()=>{h(null==l?void 0:l.getCurrentState());const e=return null==s||s.addEventListener("stateChange",e),),[s,l]);const d=(null!==(o=null==l?void 0:l.getStates())&&void 0!==o?o:[]).map((e=>{var t,n,i,r,o;if(!u)return;if(e.id===u.id)return;let a;return u.dependency&&e.id===u.dependency.stateId&&(a=null!==(n=null===(t=u.dependency.animationNames)||void 0===t?void 0:t.forward)&&void 0!==n?n:u.dependency.stateId),e.dependency&&u.id===e.dependency.stateId&&(a=null!==(o=null===(r=null===(i=e.dependency)||void 0===i?void 0:i.animationNames)||void 0===r?void 0:r.backward)&&void 0!==o?o:e.id),a?{id:e.id,name:a,onAnimate(t){s&&(c(e.id),s.transitionState(e.id,{duration:null==t?void 0:t.animationDuration,scaleToFitGeometry:null==t?void 0:t.scaleToFitGeometry,centerGeometry:null==t?void 0:t.centerGeometry}).then((()=>{c(void 0)})).catch(())}}:void 0})).filter(Boolean),p=(e,t)=>{var n,i;s&&(c(e),"front"===e?Jd(s,null!==(n=null==t?void 0:t.animationDuration)&&void 0!==n?n:2).then((()=>c(void 0))):$d(s,null!==(i=null==t?void 0:t.animationDuration)&&void 0!==i?i:2).then(())},f={id:"front",name:"Front",onAnimate(e){p("front",e)}},m={id:"back",name:"Back",onAnimate,g=[];return s&&(e&&g.push(f),t&&g.push(...d),e&&g.push(m)),r().createElement(r().Fragment,null,n({actions:g,actionRunning:a}))}const hg={lookAtFront:Jd,lookAtBack:$d,lookAtLeft:function(e,t){return e.adjustRotation({azimuth:-Math.PI/2,polar:Math.PI/2,duration:t})},lookAtRight:function(e,t){return e.adjustRotation({azimuth:Math.PI/2,polar:Math.PI/2,duration:t})}};var dg={exports:{}};!function(e,t){var n="__lodash_hash_undefined__",i=1,r=2,o=9007199254740991,s="[object Arguments]",a="[object Array]",c="[object AsyncFunction]",l="[object Boolean]",u="[object Date]",h="[object Error]",d="[object Function]",p="[object GeneratorFunction]",f="[object Map]",m="[object Number]",g="[object Null]",v="[object Object]",y="[object Promise]",b="[object Proxy]",x="[object RegExp]",w="[object Set]",_="[object String]",M="[object Undefined]",S="[object WeakMap]",E="[object ArrayBuffer]",T="[object DataView]",A=/^\[object .+?Constructor\]$/,P=/^(?:0|[1-9]\d*)$/,L={};L["[object Float32Array]"]=L["[object Float64Array]"]=L["[object Int8Array]"]=L["[object Int16Array]"]=L["[object Int32Array]"]=L["[object Uint8Array]"]=L["[object Uint8ClampedArray]"]=L["[object Uint16Array]"]=L["[object Uint32Array]"]=!0,L[s]=L[a]=L[E]=L[l]=L[T]=L[u]=L[h]=L[d]=L[f]=L[m]=L[v]=L[x]=L[w]=L[_]=L[S]=!1;var O="object"==typeof Lp&&Lp&&Lp.Object===Object&&Lp,R="object"==typeof self&&self&&self.Object===Object&&self,C=O||R||Function("return this")(),I=t&&!t.nodeType&&t,N=I&&e&&!e.nodeType&&e,D=N&&N.exports===I,z=D&&O.process,U=),B=U&&U.isTypedArray; H,G,V,W=Array.prototype,q=Function.prototype,X=Object.prototype,Y=C["__core-js_shared__"],Z=q.toString,J=X.hasOwnProperty,$=(H=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||""))?"Symbol(src)_1."+H:"",K=X.toString,Q=RegExp("^"+Z.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ee=D?C.Buffer:void 0,te=C.Symbol,ne=C.Uint8Array,ie=X.propertyIsEnumerable,re=W.splice,oe=te?te.toStringTag:void 0,se=Object.getOwnPropertySymbols,ae=ee?ee.isBuffer:void 0,ce=(G=Object.keys,V=Object,,le=Ne(C,"DataView"),ue=Ne(C,"Map"),he=Ne(C,"Promise"),de=Ne(C,"Set"),pe=Ne(C,"WeakMap"),fe=Ne(Object,"create"),me=Be(le),ge=Be(ue),ve=Be(he),ye=Be(de),be=Be(pe),xe=te?te.prototype:void 0,we=xe?xe.valueOf:void 0;function _e(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Me(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}e.clear=_e.prototype.delete=_e.prototype.get=_e.prototype.has=_e.prototype.set=Me.prototype.clear=Me.prototype.delete=Me.prototype.get=Me.prototype.has=Me.prototype.set=Se.prototype.clear=Se.prototype.delete=Se.prototype.get=function(e){return Ie(this,e).get(e)},Se.prototype.has=Se.prototype.set=Ee.prototype.add=Ee.prototype.push=Ee.prototype.has=function(e){return this.__data__.has(e)},Te.prototype.clear=Te.prototype.delete=Te.prototype.get=function(e){return this.__data__.get(e)},Te.prototype.has=function(e){return this.__data__.has(e)},Te.prototype.set=var De=se?function(){return[]},ze=Pe;&&ze(new le(new ArrayBuffer(1)))!=T||ue&&ze(new ue)!=f||he&&ze(he.resolve())!=y||de&&ze(new de)!=w||pe&&ze(new pe)!=S)&&(ze=;var ke=Le(function(){return arguments}())?Le:je=Array.isArray,He=ae||function(){return!1};Xe=B?B):.exports=(dg,dg.exports);var pg=Op(dg.exports);const fg=e=>{const{mpv:t,isMobile:n,localizations:i,logger:o,trackingOptions:s,tenant:a}=e,{preview:c,loadingModel:u,updatingCanvas:h}=og(),d=i.vortexLoadingPreview,g={front:{actionOnClick:()=>{c&&hg.lookAtFront(c,2)},translation:i.vortexActionsFront},back:{actionOnClick:translation:i.vortexActionsBack},open:{actionOnClick:()=>{c&&(hg.lookAtFront(c,2),c.transitionState("Open",{centerGeometry:!0,duration:2,scaleToFitGeometry:!0}))},translation:i.vortexActionsOpen},folded:{actionOnClick:()=>{c&&(hg.lookAtFront(c,2),c.transitionState("Folded",{centerGeometry:!0,duration:2}))},translation:i.vortexActionsFolded},unfolded:{actionOnClick:()=>{c&&(hg.lookAtFront(c,2),c.transitionState("Unfolded",{centerGeometry:!0,duration:2,scaleToFitGeometry:!0}))},translation:i.vortexActionsUnfolded},close:{actionOnClick:()=>{c&&(hg.lookAtFront(c,2),c.transitionState("Close",{centerGeometry:!0,duration:2}))},translation:i.vortexActionsClose}};return r().createElement(r().Fragment,null,r().createElement(p.x,{className:n?"mobile-height":"desktop-canvas-height"},r().createElement(lg,null),(u||h)&&r().createElement("div",{className:"vortex-canvas-loader"},r().createElement(f.Ml,{accessibleText:d}))),r().createElement(l.h,{className:"vortex-actions-container"},r().createElement(ug,{cameraViews:!0,animations:!0},(e=>e.actions.map((e=>{const n=e.id.toLowerCase();return r().createElement(m.z,{key:n,size:"mini",onClick:()=>{g[n].actionOnClick(),(e=>{L.trackVortexHeroGalleryClicked(t,a,Object.assign(Object.assign({},s),S),`Vortex 3D model ${e} button clicked`,o)})(n)}},g[n].translation)}))))))};function"==typeof SuppressedError&&SuppressedError;var gg={exports:{}},vg=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}},yg=vg,bg=Object.prototype.toString;function xg(e){return"[object Array]"===bg.call(e)}function wg(e){return void 0===e}function _g(e){return null!==e&&"object"==typeof e}function Mg(e){if("[object Object]"!==bg.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function Sg(e){return"[object Function]"===bg.call(e)}function Eg(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),xg(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}var Tg={isArray:xg,isArrayBuffer:function(e){return"[object ArrayBuffer]"===bg.call(e)},isBuffer:function(e){return null!==e&&!wg(e)&&null!==e.constructor&&!wg(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:_g,isPlainObject:Mg,isUndefined:wg,isDate:function(e){return"[object Date]"===bg.call(e)},isFile:function(e){return"[object File]"===bg.call(e)},isBlob:function(e){return"[object Blob]"===bg.call(e)},isFunction:Sg,isStream:function(e){return _g(e)&&Sg(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:Eg,merge:function e(){var t={};function n(n,i){Mg(t[i])&&Mg(n)?t[i]=e(t[i],n):Mg(n)?t[i]=e({},n):xg(n)?t[i]=n.slice():t[i]=n}for(var i=0,r=arguments.length;i<r;i++)Eg(arguments[i],n);return t},extend:function(e,t,n){return Eg(t,(function(t,i){e[i]=n&&"function"==typeof t?yg(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}},Ag=Tg;function Pg(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Lg=function(e,t,n){if(!t)return e;var i;if(n)i=n(t);else if(Ag.isURLSearchParams(t))i=t.toString();else{var r=[];Ag.forEach(t,(function(e,t){null!=e&&(Ag.isArray(e)?t+="[]":e=[e],Ag.forEach(e,(function(e){Ag.isDate(e)?e=e.toISOString():Ag.isObject(e)&&(e=JSON.stringify(e)),r.push(Pg(t)+"="+Pg(e))})))})),i=r.join("&")}if(i){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e},Og=Tg;function Rg(){this.handlers=[]}Rg.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},Rg.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Rg.prototype.forEach=function(e){Og.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var Cg,Ig,Ng,Dg,zg,Ug,Bg,Fg,kg,jg,Hg,Gg,Vg,Wg,qg,Xg,Yg,Zg,Jg,$g,Kg,Qg,ev=Rg,tv=Tg,nv=function(e,t){tv.forEach(e,(function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])}))},iv=function rv(){if(Ig)return Cg;Ig=1;var e=iv;return Cg=function(t,n,i,r,o){var s=new Error(t);return e(s,n,i,r,o)}}unction sv(){if(Zg)return Yg;function e(e){this.message=e}return Zg=1,e.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},e.prototype.__CANCEL__=!0,Yg=e}function av(){if($g)return Jg;$g=1;var e=Tg,t=function(){if(Dg)return Ng;Dg=1;var e=rv();return Ng=function(t,n,i){var r=i.config.validateStatus;i.status&&r&&!r(i.status)?n(e("Request failed with status code "+i.status,i.config,null,i.request,i)):t(i)}}(),n=),i=Lg,r=ov(),o=),s=function(){if(Xg)return qg;Xg=1;var e=Tg;return qg=e.isStandardBrowserEnv()?function(){var t,n=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function r(e){var t=e;return n&&(i.setAttribute("href",t),t=i.href),i.setAttribute("href",t),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return t=r(window.location.href),function(n){var i=e.isString(n)?r(n):n;return i.protocol===t.protocol&&i.host===t.host}}():function(){return!0}}(),a=rv(),c=cv(),l=sv();return Jg=function cv(){if(Qg)return Kg;Qg=1;var e=Tg,t=nv,n=iv,i={"Content-Type":"application/x-www-form-urlencoded"};function r(t,n){!e.isUndefined(t)&&e.isUndefined(t["Content-Type"])&&(t["Content-Type"]=n)}var o={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:function(){var e;return("undefined"!=typeof XMLHttpRequest||void 0!==_&&"[object process]"===Object.prototype.toString.call(_))&&(e=av()),e}(),transformRequest:[function(n,i){return t(i,"Accept"),t(i,"Content-Type"),e.isFormData(n)||e.isArrayBuffer(n)||e.isBuffer(n)||e.isStream(n)||e.isFile(n)||e.isBlob(n)?n:e.isArrayBufferView(n)?n.buffer:e.isURLSearchParams(n)?(r(i,"application/x-www-form-urlencoded;charset=utf-8"),n.toString()):e.isObject(n)||i&&"application/json"===i["Content-Type"]?(r(i,"application/json"),function(t,n,i){if(e.isString(t))try{return(0,JSON.parse)(t),e.trim(t)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(t)}(n)):n}],transformResponse:[,timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};return e.forEach(["delete","get","head"],(function(e){o.headers[e]={}})),e.forEach(["post","put","patch"],(function(t){o.headers[t]=e.merge(i)})),Kg=o}var lv,uv,hv=Tg,dv=cv();function pv(){return uv?lv:(uv=1,lv=function(e){return!(!e||!e.__CANCEL__)})}var fv=Tg,mv=function(e,t,n){var i=this||dv;return hv.forEach(n,(function(n){e=n.call(i,e,t)})),e},gv=pv(),vv=cv(),yv=sv();ar xv,wv,_v=Tg,Mv=ar Ev=Sv().version,Tv={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){Tv[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var Av={};Tv.transitional=var Pv,Lv,Ov,Rv,Cv,Iv,Nv={assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var i=Object.keys(e),r=i.length;r-- >0;){var o=i[r],s=t[o];if(s){var a=e[o],c=void 0===a||s(a,o,e);if(!0!==c)throw new TypeError("option "+o+" must be "+c)}else if(!0!==n)throw Error("Unknown option "+o)}},validators:Tv},Dv=Tg,zv=Lg,Uv=ev,Bv=function(e){return bv(e),e.headers=e.headers||{},e.data=mv.call(e,e.data,e.headers,e.transformRequest),e.headers=fv.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),fv.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||vv.adapter)(e).then((function(t){return bv(e),t.data=mv.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return gv(t)||(bv(e),t&&t.response&&(t.response.data=mv.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},Fv=Mv,kv=Nv,jv=kv.validators;function Hv(e){this.defaults=e,this.interceptors={request:new Uv,response:new Uv}}Hv.prototype.request=Hv.prototype.getUri=function(e){return e=Fv(this.defaults,e),zv(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},Dv.forEach(["delete","get","head","options"],(function(e){Hv.prototype[e]=function(t,n){return this.request(Fv(n||{},{method:e,url:t,data:(n||{}).data}))}})),Dv.forEach(["post","put","patch"],(function(e){Hv.prototype[e]=function(t,n,i){return this.request(Fv(i||{},{method:e,url:t,data:n}))}}));var Gv=Tg,Vv=vg,Wv=Hv,qv=Mv,Xv=cv());Xv.Axios=Wv,Xv.Cancel=sv(),Xv.CancelToken=),Xv.isCancel=pv(),Xv.VERSION=Sv().version,Xv.all=function(e){return Promise.all(e)},Xv.spread=Rv?Ov:(Rv=1,Ov=function(e){return function(t){return e.apply(null,t)}}),Xv.isAxiosError=Iv?Cv:(Iv=1,Cv=function(e){return"object"==typeof e&&!0===e.isAxiosError}),gg.exports=Xv,gg.exports.default=Xv;var Yv=Op(gg.exports);function Zv(e,t,n,i){var r;400!==(null===(r=null==t?void 0:t.response)||void 0===r?void 0:r.status)?e.error(`${i} ${t.message}: ${n}`):e.warn(`${i} ${t.message}: ${n}`)}const Jv=e=>{const{handleError:t,isEnabled:n,mpv:o,locale:s,selections:a,selectCompatibleValue:c,auth:l,possibleConfiguration:u,logger:h,isMobile:d,localizations:p,trackingOptions:f,tenant:m,requestor:g}=e,{coreProductId:v,mpvId:y,version:b}=o,[x,w]=(0,i.useState)(""),[_,M]=(0,i.useState)(!1),S=`https://uds.documents.cimpress.io/v3/instructions:preview?documentUri=${encodeURIComponent("https://uds.documents.cimpress.io/v2/transient/doc-prep/document?document=lZJba9wwEIX%2Fi5531pIt%2BQalFErpvqQhoXf6MJZGuwbbMracbbukv73jZRMSKISiF0seHX2cc07iE01zGwZRi1RsxFvqKJITtcduJt4Hu%2FQ0RFGfxO0yebQ0i%2Fr7SezceiOtfK5zA1WTGtANSSh9lkOZlwV6Q6bJGxa9wp54WntjKpMrULbwoGWRAZZaglEVamXSsvSKpz%2B3Lh54XMlUj5EP3lO7PzCBMJeDXY%2F7C8b11A7x49Tx30OM41wnyTJ2Ad28dRf0eWvbfpxonrdtSJI79TCR8AMluZSgQsP4pUKoKo1ABq0n1VhL2R8l5etIAw7xFYucdeAiwCjXE921dPwfgicApsmUsq4Cx28Be%2BABDSkoGllSZhvrnH4B4MPU7tsBu9uwTJaec8zZlhY40hxBbbHH32HAI8OEPnlQekoGs50w2gM8XkossRcyd5B5kzIgsldGZ%2BDQFlVhUDeZZ4hvu8HRT1FLNiTMbTz36SS%2BMIs8J%2Fb18euldO9ZgtO9WvqGJlGrjbgJEVfFN8O%2BW2sk1was7bNrbVK2S6dVBdqVFZRNJiFPCS16Lb1U4v4Hr414F4Z4Q%2BMKF6Zfz23yYY3o32GNU3Di%2Fi8%3D")}`,[E,T]=(0,i.useState)(S);(0,i.useEffect)((()=>{n&&(c(u),_||M(!0))}),[n]),(0,i.useEffect)((()=>{l&&((e,t,n,i,r)=>mg(void 0,void 0,void 0,(function*(){const o=`https://gallery-content-api.cdn.vpsvc.com/api/v4/ProductPage/${e}/Config/Culture/${t.toLowerCase()}`,s=n.getAuthorizationHeader();if(s)try{const e={params:{requestor:r},headers:{authorization:s}},t=yield Yv.get(o,e);if(t.data)return t.data}catch(e){Zv(i,e,o,"Failed to get gallery config for product.")}})))(y,s,l,h,g).then(()}),[y,s,l]),(0,i.useEffect)((()=>{_&&pg(a,u)&&c(u),""!==x&&u&&l&&((e,t,n,i,r,o,s)=>mg(void 0,void 0,void 0,(function*(){const a=`https://gallery-content-query.cdn.vpsvc.com/api/v2/Galleries/${n}/Culture/${i}/Content`,c=r.getAuthorizationHeader();if(c)try{const n=1,i=Object.entries(t).map((e=>encodeURIComponent(`selectedOptions[${e[0]}]`)+"="+encodeURIComponent(e[1]))).join("&"),r=`${a}?limit=${n}&requestor=${s}&productVersion=${e}&${i}`,o={headers:{authorization:c}},l=yield Yv.get(r,o);if(l.data)return l.data}catch(e){Zv(o,e,a,"Failed to get gallery templates for product.")}})))(b,u,x,s,l,h,g).then((e=>{var t,n;const i=null===(n=null===(t=null==e?void 0:e.results)||void 0===t?void 0:t.content[0])||void 0===n?void 0:n.previewUrls;if(i&&((null==i?void 0:i.size2x)||(null==i?void 0:i.size1x))){const e=(null==i?void 0:i.size2x)||(null==i?void 0:i.size1x),t=(null==e?void 0:e.indexOf("renderingInstructionsUrl="))>=0?"renderingInstructionsUrl=":"instructions_uri=",n=null==e?void 0:e.split(t)[1];T(n)}})).catch(()}),[b,s,(e=>{const t=(0,i.useRef)(u);return pg(e,t.current)||(t.current=e),t.current})(u),x,l]);const A=(0,i.useMemo)((,[]),P=(0,i.useMemo)((()=>({sku:v,attributes:null!=a?a:{},version:b,tenant:A.tenant})),[v,b,A.tenant,a]);return r().createElement(cg,{user:A,productConfig:P,renderingInstructionsUrl:E,onError:t,fallback:null},r().createElement(fg,{mpv:o,isMobile:d,localizations:p,trackingOptions:f,tenant:m,logger:h}))},$v=e=>{const{heroGallery:t,mpv:n,tenant:o,locale:s,selectedReferentialImage:a,selections:c,studioDocumentUrl:l,canonicalDomain:u,isMobile:h,showSnackbarMessage:d,localizations:f,showReferentialImage:m,trackingOptions:x,logger:w,selectCompatibleValue:_,auth:M,possibleConfiguration:A,requestor:P}=e,{name:O,mpvId:R}=n,[C,I]=(0,i.useState)(0),[N,D]=(0,i.useState)(!1),[z,B]=(0,i.useState)(!1);(0,i.useMemo)((()=>{var e;D(E.includes(R)&&!(null===(e=T[s])||void 0===e?void 0:e.includes(R)))}),[R]);const{galleryMedia:V,thumbnailImages:W,thumbnailImageAltTexts:q,updatedHeroGallery:X}=(0,i.useMemo)((()=>{const e=[...t];if(l){const t=((e,t,n,i,r,o={})=>{if(e){const s=`https://instructions.documents.cimpress.io/v3/instructions:preview?documentUri=${e}`,a=`productVersion=${t.version}&previewInstructionsUri=${encodeURIComponent(s)}&purpose=design.studio.review&optionSelections=${encodeURIComponent(JSON.stringify(o))}&requester=${r}`,c=`https://lookup.previews.cimpress.io/api/v1/${n}-prod/${i}/product/${t.coreProductId}/defaultViewImage?${a}`;return{cloudinaryImage:{cloudinaryUrl:`${c}&width=1700`,mobileCloudinaryUrl:`${c}&width=767`,transformedCloudinaryUrl:"",smallCloudinaryUrl:`${c}&width=170`,smallTransformedCloudinaryUrl:"",alt:"shop-with-your-design"},altTextOverride:""}}return{cloudinaryImage:null,altTextOverride:""}})(l,n,o,s,P,c);e.push(t)}return a&&e.push(a),Object.assign(Object.assign({},(e=>{const{heroGallery:t,productName:n,heroAltTextWithTokens:i,heroThumbnailWithTokens:r,onThumbnailClick:o,tenant:s,canonicalDomain:a,studioDocumentUrl:c}=e,l=(null==t?void 0:t.filter((e=>U(e))))||[],u=F(l,n,s,a,i,c),{thumbnailImages:h,thumbnailImageAltTexts:d}=k(l,r,o);return{galleryMedia:u,thumbnailImages:h,thumbnailImageAltTexts:d}})({heroGallery:e,productName:O,tenant:o,canonicalDomain:u,heroAltTextWithTokens:f.heroGallery.heroDefaultAltText||"",heroThumbnailWithTokens:f.heroGallery.heroThumbnailAltText||"",onThumbnailClick(e,t){L.trackHeroGalleryThumbnailClicked(e+1,t,n,x,w)},studioDocumentUrl:l})),{updatedHeroGallery:e})}),[t,O,a,l,n,o,s,c]),Y=((e,t)=>{const n=null==e?void 0:e.find(();if(H(n)){const e=U(n);return r().createElement("picture",{key:"background-image"},r().createElement("source",{media:"(max-width: 767px)",srcSet:`${e} 768w`,sizes:"(max-width: 767px) 100vw"}),r().createElement("source",{srcSet:`${e} 1700w`}),r().createElement("img",{src:`${e}`,alt:n.description||""}))}return(null==n?void 0:n.cloudinaryImage)?r().createElement("picture",{key:"background-image"},r().createElement("source",{media:"(max-width: 767px)",srcSet:`${n.cloudinaryImage.mobileCloudinaryUrl} 768w`,sizes:"(max-width: 767px) 100vw"}),r().createElement("source",{srcSet:`${n.cloudinaryImage.cloudinaryUrl} 1700w`}),r().createElement("img",{src:n.cloudinaryImage.cloudinaryUrl,alt:j(t,n.altTextOverride)||""})):r().createElement(r().Fragment,null)})(t,f.heroGallery.heroImageAltTextPrefix||"");(0,i.useEffect)((()=>{const e=X.findIndex(();if(l&&e>=0)I(e);else if(m&&a){const e=V.length-1;I(e)}}),[l,m,V,a]);const Z=(0,i.useCallback)((()=>{B((),L.trackVortexHeroGalleryViewed(n,o,Object.assign(Object.assign({},x),S),"Vortex 3D toggle switched "+(z?"off":"on"),w)}),[z]),J=(0,i.useCallback)((()=>{const e=f.vortex.vortexLoadError||"";d(e,"error"),B(!1)}),[d]);return r().createElement(r().Fragment,null,N&&z?r().createElement(p.x,null,r().createElement(Jv,{handleError:J,isEnabled:z,mpv:n,locale:s,selections:c,selectCompatibleValue:_,auth:M,possibleConfiguration:A,logger:w,localizations:f.vortex,isMobile:h,trackingOptions:x,tenant:o,requestor:P}),r().createElement(G,{vortexEnabled:z,onRequestActivatedChange:isMobile:h,vortexToggleView:f.vortex.vortexToggleView})):r().createElement("div",{className:"position-relative"},r().createElement(g.v,{skin:"under",currentSlide:C,onSlideChange:mb:4,accessibleTextForDots:q,key:`thumbnails-hero-current-slide-${C}`},r().createElement(v.T,null,W),r().createElement(y.M,null,V),r().createElement(b.z,null,Y)),N&&r().createElement(G,{vortexEnabled:z,onRequestActivatedChange:Z,isMobile:h,vortexToggleView:f.vortex.vortexToggleView})))}}}]);
//# sourceMappingURL=4f1bc8b9-8f510a585acbc802df0a.js.map