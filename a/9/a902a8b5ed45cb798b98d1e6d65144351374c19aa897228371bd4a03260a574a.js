(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[751],{RPcB:function(e,t,n){"use strict";n.r(t),n.d(t,"getOdspWsetSharingHistory",(function(){return u})),n.d(t,"getNonOdspSharingHistory",(function(){return d})),n.d(t,"WSETFoundInPlaces",(function(){return f}));var r=n("pGv3"),o=n("LpbE"),s=n("RdgM"),i=n("Ito+"),a=n("a9wj"),c=n("VUbv");const l=(e,t)=>({getToken:e=>t.getToken(["https://substrate.office.com/Files.Read.All"],e),url:e,requestInit:{method:"GET",headers:{Prefer:'exchange.behavior="SubstrateFiles,OpenComplexTypeExtensions"'}},retryPolicy:o.b});async function u(e,t,n){const o={siteUrl:e.siteUrl,driveId:e.driveId,fileId:e.itemId},a=await Object(s.a)(t,o),u=l(`https://substrate.office.com/api/beta/me/workingsetfiles('SPOID:${a}')?$select=AllExtensions/SharingHistory&$filter=ItemProperties/Shared/LastSharedWithMailboxOwnerDateTime ne null and Visualization/Type eq 'Fluid'`,t),d=n?await Object(i.b)({...u,logger:n,nameForLogging:"FoundInPlaces"}):await Object(i.a)(u);return(await d.result.json().catch((e=>{n&&Object(r.b)(n,{eventName:c.a.WsetApiJsonParsingError,subErrorName:c.b.FluidLoopComponent},e)}))).AllExtensions}async function d(e,t,n){const o=await async function(e){const t=e.split("://");if(t.length<2)return"";const n=t[1],r=(new TextEncoder).encode(n);return"WL_"+function(e){let t="";for(const n of e)switch(n){case"+":t+="-";break;case"/":t+="_";break;case"=":t+="";break;default:t+=n}return t}(function(e){let t="";const n=new Uint8Array(e),r=n.byteLength;for(let e=0;e<r;e+=1)t+=String.fromCharCode(n[e]);return window.btoa(t)}(await async function(e){return await window.crypto.subtle.digest("SHA-256",e)}(r)))}(e);if(""===o)return{};const s=l(`https://substrate.office.com/api/beta/me/workingsetfiles?$select=AllExtensions/SharingHistory&$filter=ItemProperties/SharedFile/ExternalResourceId eq '${o}'`,t),a=n?await Object(i.b)({...s,logger:n,nameForLogging:"FoundInPlaces"}):await Object(i.a)(s),u=await a.result.json().catch((e=>{n&&Object(r.b)(n,{eventName:c.a.WsetApiJsonParsingError,subErrorName:c.b.FluidNonLoopComponent},e)}));return 0===u.value.length?{}:u.value[0].AllExtensions}class f{sync getFoundInPlaces(e){let{documentUrl:t}=e;return this.getFoundInPlacesInfo({documentUrl:t},this.tokenProvider,this.logger)}async getFoundInPlacesInfo(e,t,n){let{documentUrl:o}=e;const s={value:[]};if(void 0===o)return n&&Object(r.b)(n,{eventName:c.a.WsetApiUrlUndefinedError}),s;const i=await Object(a.d)(o);let l;l=i&&Object(a.e)(i)?await u(i,t,n):await d(o,t,n);const f=this.parseWsetApiResponse(l);return f.value.length>0?f:s}parseWsetApiResponse(e){const t=[],n=new Set;try{var o;null===(o=e.SharingHistory)||void 0===o||o.Instances.forEach((e=>{const r=`${e.ReferenceType},${e.Subject}`;""!==e.Subject&&n.has(r)||(t.push({AllExtensions:{SharingHistory:{Instances:[e]}}}),n.add(r))}))}catch(e){this.logger&&Object(r.b)(this.logger,{eventName:c.a.WsetResponseProcessingError},e)}return{value:t}}},RdgM:function(e,t,n){"use strict";n.d(t,"a",();var r=n("a9wj");async function o(e,t,n){const{siteUrl:o,driveId:s,fileId:i}=t,a=await Object(r.b)(e,o,s,i,n);if(!a)throw new Error("Failed to fetch file sharepoint ids");return function(e,t){const{siteId:n,webId:r,listId:o}=e;return`SPO_${function(e){return function(e){return e.replace(/(\+|\/|\=)/g,(e=>{if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError(`Unexpected match ${e} encountered in urlEncodeBase64String. Only +/= are to be replaced.`)}))}(window.btoa(e))}(`${n},${r},${o}`)}_${t}`}(a,i)}}}]);
//# sourceMappingURL=751.a7ca959baf279ba0d6fe.chunk.v7.js.map