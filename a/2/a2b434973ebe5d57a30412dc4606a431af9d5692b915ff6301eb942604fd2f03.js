"use strict";(self.webpackChunkphotobucket_web=self.webpackChunkphotobucket_web||[]).push([[6589],{55127:function(e,r,t){t.d(r,{Z:function(){return s}});var a=t(99881),n=t(46417);function s(e){return(0,n.jsx)(a.Z,{"data-test":"alert",elevation:6,variant:"filled",severity:e.severity,sx:{marginBottom:"12px",zIndex:100},children:e.children})}},65079:function(e,r,t){t.d(r,{Z:function(){return i}});var a=t(16031),n=t(55127),s=t(46417);function i(e){var r=e.error;if(!r)return null;var t=r.networkError,i=r.graphQLErrors;return(0,a.isEmpty)(i)?t?(0,s.jsx)(n.Z,{severity:"error",children:t.message}):null!==r&&void 0!==r&&r.networkError?(0,s.jsxs)(n.Z,{severity:"error",children:["Network Error: ",r.networkError.message]}):null:(0,s.jsx)(s.Fragment,{children:r.graphQLErrors.map((function(e){return(0,s.jsx)(n.Z,{severity:"error",children:e.message},"".concat(e.name,"-").concat(e.path))}))})}i.defaultProps={error:void 0}},36589:function(e,r,t){t.r(r),t.d(r,{default:);var a=t(4942),n=t(1413),s=t(15861),i=t(29439),o=t(64687),u=t.n(o),c=t(19860),l=t(83929),d=t(44758),p=t(90891),m=t(51767),f=t(90421),h=t(19655),g=t(44270),b=t(16031),x=t(36241),v=t(47313),w=t(58467),k=t(18248),Z=t(65079),y=t(39837),E=t(47371),I=t(45328),j=t(79894),P=t(92455),S=t(82638),C=t(51748),F=t(25258),T=t(94223),A=t(6007),R=t(51980),U=t(35587),_=t(36504),B=t(69616),q=t(55337),z=t(14640),L=t(26581),W=t(12661),D=t(47765),M=t(71992),G=t(24828),V=t(45866),N=t(46417),H="redirect_idp",O=/^[a-zA-Z]+[a-zA-Z0-9-_+]*[a-zA-Z0-9]$/,Q=/\S+@\S+\.\S+/;function Y(){var e,r=(0,c.Z)(),t=(0,w.TH)(),o=(0,v.useRef)(t.search),Y=(0,v.useState)({}),$=(0,i.Z)(Y,2),J=$[0],K=$[1],X=(0,v.useState)({}),ee=(0,i.Z)(X,2),re=ee[0],te=ee[1],ae=(0,v.useRef)(localStorage.getItem(H)||""),ne=(0,v.useState)(!1),se=(0,i.Z)(ne,2),ie=se[0],oe=se[1],ue=(0,v.useState)(!1),ce=(0,i.Z)(ue,2),le=ce[0],de=ce[1],pe=(0,v.useRef)(""),me=(0,v.useRef)(""),fe=(0,v.useState)(!1),he=(0,i.Z)(fe,2),ge=he[0],be=he[1],xe=(0,G.Z)(!0),ve=xe.bucketRegister,we=xe.mutation,ke=xe.results,Ze=(0,v.useRef)(we),ye=(0,v.useRef)(ve),Ee=(0,g.$C)((0,f.Mq)()),Ie=(0,M.Z)().init,je=(0,v.useRef)(Ie),Pe={isFirebaseAppleIdpEnabled:(0,m.useFlag)("isFirebaseAppleIdpEnabled"),isFirebaseGoogleIdpEnabled:(0,m.useFlag)("isFirebaseGoogleIdpEnabled"),isFirebaseFacebookIdpEnabled:(0,m.useFlag)("isFirebaseFacebookIdpEnabled"),isFirebaseMicrosoftIdpEnabled:(0,m.useFlag)("isFirebaseMicrosoftIdpEnabled"),isFirebasePaypalIdpEnabled:(0,m.useFlag)("isFirebasePaypalIdpEnabled")},Se=Object.values(Pe).filter((),Ce=(0,m.useFlag)("isFirebaseSsoEnabled")&&Se.length>0,Fe=function(){return de(!0)},Te=(0,v.useState)(!1),Ae=(0,i.Z)(Te,2),Re=Ae[0],Ue=Ae[1],_e=Be=function(){var e=(0,s.Z)(u().mark((function e(){var r,t,a,n,s,i,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,J.enterEmail){e.next=3;break}throw new f.ZR("auth/missing-email","You must enter your email to continue");case 3:return oe(!0),r=(0,g.V1)(Ee,"firebaseAddEmail"),e.next=7,r({email:J.enterEmail,idToken:me.current});case 7:if(t=e.sent,a=t.data,n=a.error,s=a.firebaseToken,!n){e.next=12;break}throw n;case 12:(0,h._p)((0,h.v0)(),s),e.next=28;break;case 15:e.prev=15,e.t0=e.catch(0),oe(!1),i=e.t0,e.t1=i.code,e.next="auth/email-taken"===e.t1?22:"auth/email-format"===e.t1?24:26;break;case 22:return o="An account with this email address already exists.",e.abrupt("break",27);case 24:return o="Invalid email format.",e.abrupt("break",27);case 26:o="There was an error setting your email address. If this issue persists, please reload the page and try again.";case 27:te({enterEmail:o});case 28:case"end":return e.stop()}}),e,null,[[0,15]])})));return (),qe=function(){var e=(0,s.Z)(u().mark((function e(r){var t,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(be(!0),r.providerId!==S.Z.PROVIDER_ID){e.next=7;break}return e.next=4,AppleID.auth.signIn().catch((function(){return be(!1)}));case 4:return(t=e.sent)&&t.authorization&&(a=(new S.Z).credential({idToken:t.authorization.id_token}),(0,h.sB)((0,h.v0)(),a)),e.abrupt("return");case 7:if(!x.isMobile){e.next=11;break}return window.localStorage.setItem(H,r.providerId),(0,h.F6)((0,h.v0)(),r),e.abrupt("return");case 11:ae.current=r.providerId,(0,h.rh)((0,h.v0)(),r);case 13:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),ze=function(){var e=(0,T.Z)(J.password,J.confirmPassword,J.username,J.email),r=J.username,t=J.email;if(!r)throw new Error("Username required");if(!t)throw new Error("Email required");if(!function(e){return e.length>=4&&e.length<=32&&O.test(e)}(r))throw new C.Z("Cannot contain special characters.","username");if(!t))throw new C.Z("Email format is invalid.","email");return{email:t,username:r.toLowerCase(),password:e}},Le=function(){var e=(0,s.Z)(u().mark((function e(r){var t,s,i,o,c,l,d,p,m,f,b,x,v,w,k;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===r||void 0===r||r.preventDefault(),e.prev=1,t=ze(),s=t.email,i=t.password,o=t.username,be(!0),c=(0,g.V1)(Ee,"firebaseRegister"),e.next=7,c({username:o,email:s,password:i});case 7:if(l=e.sent,d=l.data,p=d.error,m=d.firebaseToken,!p){e.next=12;break}throw p;case 12:(0,h._p)((0,h.v0)(),m),e.next=41;break;case 15:e.prev=15,e.t0=e.catch(1),f=e.t0,be(!1),(b=e.t0).errorInfo&&(x=b.errorInfo,v=x.code,w=x.message,f={name:v,code:v,message:w}),k=f,e.t1=f.code,e.next="auth/username-already-taken"===e.t1||"auth/invalid-identifier"===e.t1||"auth/uid-already-exists"===e.t1?25:"auth/email-already-taken"===e.t1?27:"InvalidParameterException"===e.t1||"InvalidPasswordException"===e.t1?29:"auth/invalid-username"===e.t1?32:"ConfirmPasswordException"===e.t1?34:"UsernameExistsException"===e.t1?36:"RequiredParameterException"===e.t1?38:40;break;case 25:return te({username:"An account with this username already exists"}),e.abrupt("break",41);case 27:return te({email:"An account with this email already exists"}),e.abrupt("break",41);case 29:return K((0,n.Z)((0,n.Z)({},J),{},{confirmPassword:""})),te({password:f.message}),e.abrupt("break",41);case 32:return te({username:"Can only contain alphanumeric characters."}),e.abrupt("break",41);case 34:return te({confirmPassword:f.message,password:f.message}),e.abrupt("break",41);case 36:return te({username:f.message}),e.abrupt("break",41);case 38:return te((0,a.Z)({},k.parameterName,f.message)),e.abrupt("break",41);case 40:te({general:f.message});case 41:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(r){return e.apply(this,arguments)}}(),We=function(e){var r=(0,n.Z)({},J),t=e.target.name;r[t]=e.target.value,K(r);var a=(0,n.Z)({},re);delete a[t],delete a.general,te(a)};return(0,v.useEffect)((function(){var e=new URLSearchParams(o.current),r="apple"===e.get("provider"),t=e.get("id_token");if(t&&r){var a=(new S.Z).credential({idToken:t});(0,h.sB)((0,h.v0)(),a).then(().catch(F.Z.error)}}),[]),(0,v.useEffect)((,[]),(0,v.useEffect)((function(){var e=localStorage.getItem(H);e&&(0,h.cx)((0,h.v0)()).then(function(){var r=(0,s.Z)(u().mark((function r(t){var a,n,s,i;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,t.user.getIdToken();case 4:if(n=r.sent,s={token:n},t.user.email){r.next=11;break}return pe.current=e,me.current=n,Fe(),r.abrupt("return");case 11:if(i=new URLSearchParams(o.current),!(null!==(a=i.get("invitationId"))&&void 0!==a?a:localStorage.getItem("_pb_invitationId"))){r.next=16;break}return ye.current(),r.abrupt("return");case 16:Ze.current({variables:s});case 17:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()).catch((function(r){var t,a=(0,P.UU)(e).getProvider(),n=null===(t=r.customData)||void 0===t?void 0:t.email;if("auth/account-exists-with-different-credential"===r.code){var s=n?" (".concat(n,")"):"";te({general:"An account exists with this email ".concat(s,". If you cannot access your account, try resetting your password.")})}F.Z.error({error:r,provider:a})})).finally(()}),[]),(0,v.useEffect)((function(){var e=(0,h.v0)().onAuthStateChanged(function(){var e=(0,s.Z)(u().mark((function e(r){var t,a,n,s,i,o,c,l,d,p,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,r.getIdToken();case 5:if(t=e.sent,a={token:t},r.email){e.next=12;break}return pe.current=ae.current,me.current=t,Fe(),e.abrupt("return");case 12:if(!localStorage.getItem("_pb_invitationId")){e.next=16;break}return ye.current(),e.abrupt("return");case 16:return e.next=18,Ze.current({variables:a});case 18:if(n=e.sent,s=n.errors,(0,b.isEmpty)(s)){e.next=22;break}throw new Error("Login attempt failed");case 22:e.next=41;break;case 24:if(e.prev=24,e.t0=e.catch(2),be(!1),i=(0,P.UU)(ae.current).getProvider(),o=e.t0,c=(0,k.Z)(),F.Z.error({uniqueErrorId:c,error:o}),"auth/popup-closed-by-user"!==o.code){e.next=33;break}return e.abrupt("return");case 33:if(!o.message.includes("account-exists-with-different-credential")){e.next=40;break}if(!(d=null===(l=o.customData)||void 0===l?void 0:l.email)){e.next=40;break}return p=d?" (".concat(d,")"):"",m=(0,P.UU)(i.providerId).name,te({general:"An account exists with this email".concat(p,". You can enable single click sign on with ").concat(m," under your account settings.")}),e.abrupt("return");case 40:te({general:"There was an error signing in or registering your account. Unique error id: ".concat(c)});case 41:return e.prev=41,localStorage.setItem(H,""),e.finish(41);case 44:case"end":return e.stop()}}),e,null,[[2,24,41,44]])})));return ());return ),[]),(0,N.jsxs)(A.Z,{onSubmit:Le,children:[(0,N.jsx)(V.Z,{}),(0,N.jsx)(y.Z,{title:"Create an Account"}),(0,N.jsx)(Z.Z,{error:ke.error}),(0,N.jsx)(R.Z,{error:re.enterEmail||"",loading:ie,open:le,email:J.enterEmail||"",attemptEmailChange:Be,handleClose:handleChange:We,providerName:(null===(e=(0,P.UU)(pe.current))||void 0===e?void 0:e.name)||""}),(0,N.jsx)(z.Z,{children:"Sign up"}),Ce&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(U.j,{children:P.Wj.map((function(e){var r=(0,P.UU)(e),t=r.featureFlagName,a=(0,r.getProvider)();return!1===Pe[t]?null:(0,N.jsx)(U.Z,{action:"Sign up with",disabled:ge,providerId:e,handleProvider:)}))}),(0,N.jsx)(q.Z,{variant:"fullWidth",orientation:"horizontal",flexItem:!0,children:"OR"})]}),(0,N.jsx)(_.uI,{title:"Error logging in",body:re.general}),(0,N.jsx)(I.Z,{sx:{mt:"18px"},htmlFor:"email",children:"Email"}),(0,N.jsx)(j.Z,{id:"email",autoFocus:!0,defaultValue:"","data-test":"email",disabled:ge,error:Boolean(re.email),fullWidth:!0,helperText:re.email,name:"email",onChange:We,required:!0,margin:"dense",placeholder:"name@gmail.com",type:"email",variant:"outlined"}),(0,N.jsx)(I.Z,{htmlFor:"username",children:"Username"}),(0,N.jsx)(j.Z,{id:"username","data-test":"username",disabled:ge,error:Boolean(re.username),fullWidth:!0,defaultValue:"",helperText:re.username,inputProps:{maxLength:32,minLength:4},margin:"dense",name:"username",onChange:We,placeholder:"Enter a username",required:!0,type:"text"}),(0,N.jsx)(I.Z,{htmlFor:"password",children:"Password"}),(0,N.jsx)(j.Z,{id:"password","data-test":"password",disabled:ge,error:Boolean(re.password),fullWidth:!0,helperText:re.password,margin:"dense",name:"password","data-sr-redact":!0,onChange:We,required:!0,type:Re?"text":"password",InputProps:{endAdornment:(0,N.jsx)(E.Z,{showPassword:Re,handleClickShowPassword:_e})},placeholder:""}),(0,N.jsx)(I.Z,{htmlFor:"confirmPassword",children:"Confirm password"}),(0,N.jsx)(j.Z,{"data-test":"confirmPassword",disabled:ge,error:Boolean(re.confirmPassword),fullWidth:!0,helperText:re.confirmPassword,margin:"dense",name:"confirmPassword",onChange:We,required:!0,type:Re?"text":"password",placeholder:"",InputProps:{endAdornment:(0,N.jsx)(E.Z,{showPassword:Re,handleClickShowPassword:_e})}}),(0,N.jsx)(l.Z,{disableTypography:!0,sx:{paddingTop:0,marginRight:0,marginBottom:"20px",alignItems:"flex-start",textAlign:"left",".MuiFormControlLabel-asterisk":{display:"none"},"&.MuiFormControlLabel-root":{color:r.palette.customGrey[600],flexGrow:0,fontSize:"16px",lineHeight:"1.25"}},control:(0,N.jsx)(d.Z,{required:!0,"aria-required":!0,disabled:ge,inputProps:{"aria-label":"Email consent checkbox"},size:"small",sx:{paddingTop:"1px",borderWidth:"1px"}}),label:"I agree to receive personalized emails about my account, feature\nannouncements, and offers."}),(0,N.jsx)(B.Z,{color:"primary","data-test":"submit",disabled:ge||ke.loading,fullWidth:!0,type:"submit",variant:"contained",children:"Sign up"}),(0,N.jsxs)(L.Z,{children:["Already have an account? ",(0,N.jsx)(D.Z,{"data-test":"already-have-an-account-button",to:"/auth/login".concat(t.search),children:"Sign in"})]}),(0,N.jsxs)(W.Z,{sx:{fontSize:"16px"},children:['By clicking "Sign up", you agree to our'," ",(0,N.jsx)(p.Z,{color:"#1C47CB","data-test":"terms-of-service",href:"/legal/terms-of-service",target:"_blank",underline:"always",children:"Terms of Use"})," ","and"," ",(0,N.jsx)(p.Z,{color:"#1C47CB","data-test":"privacy-policy",href:"/legal/privacy-policy",target:"_blank",underline:"always",children:"Privacy Policy"}),"."]}),(0,N.jsxs)(W.Z,{sx:{fontSize:"16px"},children:["This site is protected by reCAPTCHA and the Google"," ",(0,N.jsx)(p.Z,{style:{color:"#1C47CB"},href:"https://policies.google.com/privacy",underline:"always","data-test":"google-privacy",children:"Privacy Policy"})," ","and"," ",(0,N.jsx)(p.Z,{style:{color:"#1C47CB"},href:"https://policies.google.com/terms",underline:"always","data-test":"google-terms-of-service",children:"Terms of Service"})," ","apply."]})]})}}}]);