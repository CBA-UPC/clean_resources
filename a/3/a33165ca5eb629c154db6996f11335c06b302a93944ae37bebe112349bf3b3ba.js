!();var VSPLAYER_PUBLIC_EVENTS={GOT_CDN_PROVIDERS:"VSP_GOT_CDN_PROVIDERS",ON_PLAY_BTN_SHOWN:"VSP_ON_PLAY_BTN_SHOWN",PLAYING_EVENT:"VSP_PLAYING_EVENT",VIDEO_HIDDEN:"VSP_VIDEO_HIDDEN",MUTED_VIDEO:"VSP_MUTED_VIDEO",UNMUTED_VIDEO:"VSP_UNMUTED_VIDEO"},VSPLAYER_VIEW_EVENTS={AUDIO_ICON_CLICKED:"VSP_AUDIO_ICON_CLICKED",ADJUST_AUDIO_VOLUME:"VSP_ADJUST_AUDIO_VOLUME",PLAY_BTN_CLICKED:"VSP_PLAY_BTN_CLICKED",VIDEO_PLAYER_SELECTED:"VSP_VIDEO_PLAYER_SELECTED",ABR_SELECTED:"VSP_ABR_SELECTED",WHOLE_ROOM_CLICKED:"VSP_WHOLE_ROOM_CLICKED",PLAYER_SELECTION_INTERRUPTED:"VSP_PLAYER_SELECTION_INTERRUPTED"},VSPLAYER_MODEL_EVENTS={ON_ERROR:"VSP_ON_ERROR",VIDEO_ERROR:"VSP_VIDEO_ERROR",AUTOPLAY_FAILED:"VSP_AUTOPLAY_FAILED",VIDEO_PLAYING:"VSP_VIDEO_PLAYING",VIDEO_LOADING:"VSP_VIDEO_LOADING",VIDEO_METADATA:"VSP_VIDEO_METADATA",VIDEO_CANPLAYTHROUGH:"VSP_VIDEO_CANPLAYTHROUGH",WEBRTC_AVAILABLE_TRACKS:"VSP_WEBRTC_AVAILABLE_TRACKS",LLHLS_LEVELS_AVAILABLE:"VSP_LLHLS_LEVELS_AVAILABLE",HLS_LEVELS_AVAILABLE:"VSP_HLS_LEVELS_AVAILABLE",VIDEO_PAUSED:"VSP_VIDEO_PAUSED",BUFFER_START:"VSP_BUFFER_START",BUFFER_STOP:"VSP_BUFFER_STOP",SWITCH_STREAM_SUCCEEDED:"VSP_SWITCH_STREAM_SUCCEEDED",SWITCH_STREAM_STARTED:"VSP_SWITCH_STREAM_STARTED",SWITCH_STREAM_FAILED:"VSP_SWITCH_STREAM_FAILED",SWITCH_STREAM_LOADED:"VSP_SWITCH_STREAM_LOADED",STREAM_URL_BUILT:"VSP_STREAM_URL_BUILT",VID_VOLUME_CHANGED:"VSP_VID_VOLUME_CHANGED"},VSPlayerController={initialized:!1,currentPlayer:null,autoplay:!0,allPlayers:["hls","llhls","flash","webrtc"],logs:[],logsLimit:10,sendLogsWaitMS:5e3,isSendingLogs:!1,lastBuffer:null,init:function(e){if(Debug.print("VSPlayer.init()"),!this.initialized){if(this.players={hls:VSPlayerHlsModel},window.__isUsingWebrtc__&&(this.players.webrtc=VSPlayerWebRTCModel),window.__isUsingLLHls__&&(this.players.llhls=VSPlayerLLHlsModel),this.config=e,!(this.config&&0!==Object.keys(this.config).length&&this.config.envVars&&this.config.endpoints&&this.config.fns&&0!==Object.keys(this.config.fns).length))return Debug.print("VSPlayer: incorrect or missing config, unable to initialize: "+JSON.stringify(this.config)),void this.showMsg(Translator.getTranslation("videoPlayer","VIDEO_PLAYER_MISSING_CONFIG")||"Video Player: Incorrect or missing Config.");this.config.envVars.UAParser||(this.config.envVars.UAParser=(new UAParser).getResult()),this.userGroup=this.getUserGroup(this.config),this.checkNativeFullScreenSupport(),this.setAutoplayConstraints(),this.subscribeToComponentEvents(),VSPlayerView.init(),Object.keys(this.players).forEach((function(e){var t=VSPlayerController.players[e];"function"==typeof t.preInitConfig&&t.preInitConfig({resolutionsToExclude:VSPlayerController.resolutionsToExclude,getVideoResolution:VSPlayerController.getVideoResolution})})),this.initialized=!0}},getUserGroup:function(e){var t,r=this.getUniqueUserId(e);if(-1===r)return null;try{if(r%10==0)return(t=window.localStorage.getItem("userABGroup"))||(t=Math.random()>.5?"A":"B",window.localStorage.setItem("userABGroup",t)),t;t=null}catch(e){t=null}return t},getUniqueUserId:function(e){var t=e&&e.envVars&&e.envVars.USER;if(!t)return-1;var r=window.parseInt(t.id);return window.isNaN(r)||0===r?-1:r},subscribeToComponentEvents:function(){Debug.print("VSPlayer.subscribeToComponentEvents()"),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.VIDEO_ERROR,this.recoverVideo.bind(this)),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.ON_ERROR,this.onError.bind(this)),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.AUTOPLAY_FAILED,(function(e){VSPlayerController.onAutoPlayFailed(e.detail)})),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.VIDEO_PLAYING,this.onVideoPlaying.bind(this)),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.VIDEO_LOADING,this.onVideoLoading.bind(this)),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.VIDEO_METADATA,this.onVideoMetadata),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.VIDEO_CANPLAYTHROUGH,this.onVideoCanPlaythrough),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.WEBRTC_AVAILABLE_TRACKS,this.onWebrtcAvailableTracks.bind(this)),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.LLHLS_LEVELS_AVAILABLE,this.onLLHlsLevelsAvailable.bind(this)),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.HLS_LEVELS_AVAILABLE,this.onHlsLevelsAvailable.bind(this)),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.VIDEO_PAUSED,this.onVideoPaused),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.BUFFER_START,(function(e){VSPlayerController.onBufferStart(e.detail)})),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.VID_VOLUME_CHANGED,(function(e){VSPlayerController.onVidVolumeChanged(e.detail.isMuted)})),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.BUFFER_STOP,(function(e){VSPlayerController.onBufferStop(e.detail)})),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_SUCCEEDED,(function(e){VSPlayerController.onSwitchStreamSucceeded(e.detail)})),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_STARTED,(function(e){VSPlayerController.onSwitchStreamStarted(e.detail)})),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_LOADED,(function(e){VSPlayerController.onSwitchStreamLoaded(e.detail)})),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_FAILED,(),DOM.addEventListener(document,VSPLAYER_MODEL_EVENTS.STREAM_URL_BUILT,(function(e){VSPlayerController.onStreamUrlBuilt(e.detail.streamUrl)})),DOM.addEventListener(document,VSPLAYER_VIEW_EVENTS.AUDIO_ICON_CLICKED,this.onAudioIconClicked.bind(this)),DOM.addEventListener(document,VSPLAYER_VIEW_EVENTS.ADJUST_AUDIO_VOLUME,(function(e){VSPlayerController.adjustAudioVolume(e)})),DOM.addEventListener(document,VSPLAYER_VIEW_EVENTS.PLAY_BTN_CLICKED,(),DOM.addEventListener(document,VSPLAYER_VIEW_EVENTS.VIDEO_PLAYER_SELECTED,(function(e){VSPlayerController.changeVideoPlayer(e.detail.videoPlayer)})),DOM.addEventListener(document,VSPLAYER_VIEW_EVENTS.ABR_SELECTED,(),DOM.addEventListener(document,VSPLAYER_VIEW_EVENTS.PLAYER_SELECTION_INTERRUPTED,(),DOM.addEventListener(document,"visibilitychange",this.onBrowserTabVisibilityChng)},checkBrowserSupport:function(e){for(var t in Debug.print("VSPlayer.checkBrowserSupport("+e+")"),this.players){if(t===e)return this.players[t].verifyBrowserSupport(this.config.envVars.UAParser)}},resolutionsToExclude:function(e){var t=[1080],r=!1;return window.AppController&&window.AppController.Room&&window.AppController.Room.video_overlay_info&&(r=!0),VSPlayerController.config.envVars.USER.isInternal||r?[]:"function"==typeof e?e(t):t},getVideoResolution:function(e,t,r){var i;if(e=window.parseInt(e),t=window.parseInt(t),window.isNaN(e))throw new Error("w is not a number");if(window.isNaN(t))throw new Error("h is not a number");return i="landscape"===(e>=t?"landscape":"portrait")?t:e,r&&(i+="p"),i},checkNativeFullScreenSupport:function(){if(Debug.print("VSPlayer. checkNativeFullScreenSupport()"),document.fullscreenEnabled?this.isBrowserFullscreenSupported=!0:document.webkitFullscreenEnabled?(this.isBrowserFullscreenSupported=!0,this.fullscreenPrefix="webkit"):document.mozFullScreenEnabled?(this.isBrowserFullscreenSupported=!0,this.fullscreenPrefix="moz"):document.msFullscreenEnabled&&(this.isBrowserFullscreenSupported=!0,this.fullscreenPrefix="ms"),"ios"===this.config.envVars.USER.platform_name)for(var e in this.players)window.__isUsingMobileRehaul__||(this.players[e].enableControls=!0);window.__isUsingMobileRehaul__&&(this.isBrowserFullscreenSupported=!0)},enterNativeFullscreen:function(){if(Debug.print("VSPlayerController.enterNativeFullscreen()"),window.__isUsingMobileRehaul__){var e=VSPlayerController.currentPlayer&&VSPlayerController.currentPlayer.videoEl;if(!e)return;var t,r=!1;try{e.requestFullscreen?t=e.requestFullscreen():e.webkitRequestFullscreen?t=e.webkitRequestFullscreen():e.mozRequestFullScreen?t=e.mozRequestFullScreen():e.msRequestFullscreen?t=e.msRequestFullscreen():e.webkitEnterFullscreen?t=e.webkitEnterFullscreen():(console.log("failed to enter fullscreen: not supported"),r=!0)}catch(e){console.log("failed to enter fullscreen on execute",e),r=!0}return(t=t instanceof Promise?t:Promise.resolve()).catch((),void(r?(document.body.classList.add("vs-player-native-fullscreen-not-supported"),e.controls=!0):(document.body.classList.remove("vs-player-native-fullscreen-not-supported"),e.controls=!1))}VSPlayerController.isBrowserFullscreenSupported&&VSPlayerController.currentPlayer&&VSPlayerController.currentPlayer.enterNativeFullscreen(VSPlayerController.fullscreenPrefix)},setAutoplayConstraints:function(){Debug.print("VSPlayer.setAutoplayConstraints()");var e=this.config.envVars.UAParser.browser.name.toLowerCase(),t=Number(this.config.envVars.UAParser.browser.major);this.isSafariAbove11="safari"==e&&t>=11,"ios"==this.config.envVars.USER.platform_name.toLowerCase()&&(this.isOldVersionIOS=/OS [1-9]_\d(_\d)? like Mac OS X/i.test(navigator.userAgent)),this.browserTooOldForAutoPlay=!1,"ie"===e&&t<11||"safari"===e&&t<10||this.isOldVersionIOS||"chrome"===e&&t<53||"crios"===e&&t<53||-1!==navigator.userAgent.toLowerCase().indexOf("windows nt 6.0")||-1!==navigator.userAgent.toLowerCase().indexOf("windows nt 5")?this.browserTooOldForAutoPlay=!0:this.userCameFromSameDomain=-1!==document.referrer.indexOf(this.config.envVars.USER.sitekey)},configureRoomSettingsAndPrefs:function(e){Debug.print("VSPlayer.configureRoomSettingsAndPrefs()"),e.modelId&&(this.config.Room.MODEL.id=e.modelId,this.config.Room.modelName=e.modelName),this.config.Room.userPrefs||(this.config.Room.userPrefs=VSPlayerModel.getVideoSettings(),this.config.Room.userPrefs||(this.config.Room.userPrefs={}));var t=0!==this.config.envVars.USER.id?["hls","llhls","webrtc"]:["hls","llhls"];t.forEach((function(e){VSPlayerController.checkBrowserSupport(e)||t.splice(t.indexOf(e),1)})),this.basedPlayersPriority=t.slice(0);var r=VSPlayerModel.getBackUpPlayerCookie(this.config.Room.MODEL.id),i=VSPlayerModel.getPreferredPlayer();r?t=this.arrangePlayerPriority(t,r):i&&(t=this.arrangePlayerPriority(t,i)),this.config.Room.playersPriority=t,this.hideVideoPlayerIcons(this.config.Room.playersPriority);var n=!1;this.currentPlayer&&this.currentPlayer.name!==this.config.Room.playersPriority[0]&&(n=!0),this.currentPlayer&&!n||this.selectVideoPlayer(),VSPlayerView.updateCurrentPlayerIcon(this.currentPlayer.name),this.browserTooOldForAutoPlay&&(this.autoplay=!1,this.currentPlayer.updateAutoplay(!1)),this.shouldPlayerUnmute()?this.config.Room.userPrefs.volLevel?this.adjustAudioVolume(this.config.Room.userPrefs.volLevel):this.adjustAudioVolume(1):this.adjustAudioVolume(0),e.noAudioInUrl&&(this.config.Room.userPrefs.muteAudio=!0),("computer"!==this.config.envVars.USER.platform_type&&!document.hasFocus()&&document.hidden||e.browserTabOutOfFocus)&&(this.browserTabOutOfFocus=!0,DOM.addEventListener(window,"focus",(function e(){VSPlayerController.browserTabOutOfFocus=!1,DOM.removeEventListener(window,"focus",e),VSPlayerController.onPlayBtnClicked()})))},isTheBetterPlayer:function(e,t){var r=this.basedPlayersPriority.slice(0).reverse();return r.indexOf(e)>r.indexOf(t)},arrangePlayerPriority:function(e,t){for(var r=[],i=[],n=0;n<e.length;n++)e[n]===t||n>=e.indexOf(t)?r.push(e[n]):i.push(e[n]);return r.concat(i)},hideVideoPlayerIcons:function(e){Debug.print("VSPlayer.hideVideoPlayerIcons()"),Array.isArray(e)&&VSPlayerController.allPlayers.forEach((function(t){-1===e.indexOf(t)?VSPlayerView.hideVideoPlayerIcon(t):VSPlayerView.showVideoPlayerIcon(t)}))},selectVideoPlayer:function(e,t){Debug.print("VSPlayer.selectVideoPlayer()"),this.cdnIndex=0;let r=this;if(e){let e=this.basedPlayersPriority.filter(()[0];r.config.Room.playersPriority=this.arrangePlayerPriority(r.config.Room.playersPriority,e)}if(this.currentPlayer=this.players[this.config.Room.playersPriority[0]],e&&this.isTheBetterPlayer(this.currentPlayer.name,t)){var i=this.config.Room.MODEL.id,n=this.currentPlayer.name;VSPlayerModel.setBackUpPlayerCookie(i,n),this.config.envVars.USER.isInternal&&VSPlayerView.updateAllPlayerIconTooltips({failed:t,modelName:VSPlayerController.config.Room.modelName})}this.currentPlayer.initialized||this.currentPlayer.init(),Debug.print("VSPlayer currentPlayer.name: "+this.currentPlayer.name)},shouldPlayerUnmute:function(){if(this.config.Room.userPrefs&&this.config.Room.userPrefs.muteAudio)return!1;if(this.browserTooOldForAutoPlay)return!0;if(this.userCameFromSameDomain||this.userUnmuted)return!0;var e="computer"===this.config.envVars.USER.platform_type,t=this.config.envVars.UAParser.browser.name.toLowerCase(),r=Number(this.config.envVars.UAParser.browser.major),i="firefox"===t&&r>=66,n="chrome"===t&&r>=64||this.isSafariAbove11||i;return!(!e||n)},getCdnProviders:function(e,t,r,i){Debug.print("VSPlayer.getCdnProviders(), for player "+this.currentPlayer.name),e&&(this.config.endpoints.cdnProviders=e),t&&(this.config.videoOrigin.stream_host=t),r&&(this.config.videoOrigin.stream_key=r),i&&(this.config.videoAuthKey=i),this.currentPlayer&&this.currentPlayer.cdnAttempts++,this.videoProvidersHls=null,this.videoProvidersLLHls=null,VSPlayerLoggerController.ceeBlueLog("fetching signalling url from get-stream-urls.php"),VSPlayerModel.getCdnProviders(this.config.endpoints.cdnProviders).then(VSPlayerController.onGetCdnProvidersSuccess).catch(VSPlayerController.onGetCdnProvidersFail)},onGetCdnProvidersSuccess:function(e){Debug.print("VSPlayer.onGetCdnProvidersSuccess()"),VSPlayerController.announceGotCdnProviders(),VSPlayerController.parseCdnProviders(e),VSPlayerController.embedPerBusinessRules(!0)},onGetCdnProvidersFail:function(e){Debug.print("VSPlayer.onGetCdnProvidersFail()"),-1!==e.message.indexOf("timed out")?VSPlayerLoggerController.logToSystem(1053,"Video.type:"+VSPlayerController.currentPlayer.name+";model_id:;host:"+VSPlayerController.config.videoOrigin.stream_host+";user_id:"+VSPlayerController.config.envVars.USER.id):VSPlayerLoggerController.logToSystem(1054,encodeURIComponent(e)),VSPlayerController.recoverVideo()},parseCdnProviders:function(e){Debug.print("VSPlayer.parseCdnProviders(): "+JSON.stringify(e)),this.videoProvidersHls=e.hls,this.videoProvidersLLHls=e.llhls,this.videoProvidersWebrtc=e.webrtc,this.streamSettings=e.stream_settings;var t,r=this.config.Room.playersPriority.indexOf("webrtc");switch(this.videoProvidersWebrtc?-1===r&&this.config.Room.playersPriority.push("webrtc"):-1!==r&&this.config.Room.playersPriority.splice(r,1),this.hideVideoPlayerIcons(this.config.Room.playersPriority),this.cdnIndex=0,this.currentPlayer.name){case"hls":t=this.videoProvidersHls;break;case"llhls":t=this.videoProvidersLLHls;break;case"webrtc":t=[this.videoProvidersWebrtc]}t&&(this.currentCdnProvider=t[0],VSPlayerLoggerController.viewId&&VSPlayerLoggerController.reportVideoEventBQ("stream_end",JSON.stringify({reason:"switch_stream"})),this.generateViewId())},generateViewId:function(){Debug.print("VSPlayer.generateViewId()");var e=Number(this.config.envVars.USER.id),t=this.config.envVars.USER.id?e:"guest";VSPlayerLoggerController.viewId=(new Date).getTime().toString()+"-"+this.config.Room.MODEL.id.toString()+"-"+t+"-"+this.config.envVars.USER.nickname},announceGotCdnProviders:function(){DOM.dispatchEvent(document,VSPLAYER_PUBLIC_EVENTS.GOT_CDN_PROVIDERS,{tStamp:(new Date).getTime()})},embedPerBusinessRules:function(e){var t=VSPlayerController.config.fns.shouldVideoBeShownRN();Debug.print("VSPlayer.embedPerBusinessRules("+JSON.stringify(t)+")"),t.doEmbed||t.doShow&&e?(VSPlayerController.hide(),VSPlayerController.show()):t.doShow||VSPlayerController.hide()},show:function(e){if(Debug.print("VSPlayer.show()"),this.suppressPlayBtn=!1,this.browserTabOutOfFocus)return this.autoplay=!1,this.currentPlayer.updateAutoplay(!1),this.invokePlayBtnLogic();this.config.envVars.USER.isInternal&&"computer"!==this.config.envVars.USER.platform_type&&VSPlayerView.showCurrentPlayerName(this.currentPlayer.name),this.autoplay&&VSPlayerView.showLoadingSymbol(),this.initialStreamPlayback=!0;var t=this.config.fns.isVoyeurShow();if(t?VSPlayerView.disableAudio():(VSPlayerView.enableAudio(),this.config.Room.userPrefs.muteAudio?(VSPlayerView.updateMuteIcon("unmute"),VSPlayerView.updateVolumeSliderValue(0)):(VSPlayerView.updateMuteIcon("mute"),VSPlayerView.updateVolumeSliderValue(this.config.Room.userPrefs.volLevel?100*this.config.Room.userPrefs.volLevel:100))),this.doMute=this.config.Room.userPrefs.muteAudio,this.voyeurMuteOverride=t,this.currentCdnProvider){if(VSPlayerLoggerController.ceeBlueLog("signalling url received: "+(this.currentCdnProvider&&this.currentCdnProvider.url)),e||VSPlayerLoggerController.reportPlayEventBQ(),"webrtc"===this.currentPlayer.name?(VSPlayerWebrtcView.showAbrMenu(),VSPlayerView.showPlayer(this.currentPlayer.name)):"llhls"===this.currentPlayer.name?VSPlayerLLHlsView.showAbrMenu():"hls"===this.currentPlayer.name?VSPlayerHlsView.showAbrMenu():VSPlayerView.showPlayer(this.currentPlayer.name),e?this.config.Room.userPrefs.manualAbrSwitch=!0:delete this.config.Room.userPrefs.manualAbrSwitch,this.currentPlayer.show(this.currentCdnProvider,this.config.Room.userPrefs,t,this.config.videoAuthKey,{streamSettings:this.streamSettings}),window.AppController&&window.AppController.Room&&window.AppController.Room.video_overlay_info)try{this.showInternalVideoOverlayInfo()}catch(e){}var r=Math.floor(1e3*Math.random())+1;this.trackLoadTime=r<=50&&(new Date).getTime()}else Debug.print("VSPlayer.show() - no current cdn provider"),VSPlayerLoggerController.logToSystem(1055,"Video.type:"+VSPlayerController.currentPlayer.name+";host:"+VSPlayerController.config.videoOrigin.stream_host+";user_id:"+VSPlayerController.config.envVars.USER.id),"webrtc"===this.currentPlayer.name?(this.reportMissingWebrtcStream(),VSPlayerLoggerController.ceeBlueLog("missing signalling url from get-stream-urls.php"),this.killOffVideoType()):this.recoverVideo()},reportMissingWebrtcStream:function(){VSPlayerLoggerController.reportVideoEventBQ("missing_webrtc_stream_url")},hide:function(){Debug.print("VSPlayer.hide()"),VSPlayerView.hideLoadingSymbol(),VSPlayerView.hidePlayBtn(),this.doMute=!1,this.voyeurMuteOverride=!1,this.userTriggeredAbrSwitch=!1,this.suppressPlayBtn=!0,this.currentPlayer&&(this.currentPlayer.hide(),this.isBrowserFullscreenSupported&&this.currentPlayer.exitNativeFullScreen(this.fullscreenPrefix)),window.__isUsingWebrtc__&&(VSPlayerWebrtcView.disableAbrMenu(),VSPlayerWebrtcView.hideAbrMenu()),window.__isUsingLLHls__&&(VSPlayerLLHlsView.disableAbrMenu(),VSPlayerLLHlsView.hideAbrMenu()),VSPlayerHlsView.disableAbrMenu(),VSPlayerHlsView.hideAbrMenu(),VSPlayerView.hideAllPlayers(),this.announceVideoHidden(),this.streamUrl=null},onStreamUrlBuilt:function(e){Debug.print("VSPlayerController.onStreamUrlBuilt("+e+")"),this.streamUrl=e},onError:recoverVideo:function(e){if(Debug.print("VSPlayer.recoverVideo()"),this.config.fns.shouldVideoBeShownRN().doShow){this.recoveringVideo=!0,this.hide(),VSPlayerView.showLoadingSymbol(),"webrtc"===this.currentPlayer.name?VSPlayerWebrtcView.disableAbrMenu():"llhls"===this.currentPlayer.name?VSPlayerLLHlsView.disableAbrMenu():"hls"===this.currentPlayer.name&&VSPlayerHlsView.disableAbrMenu();var t=e&&e.detail&&(e.detail.ourCode||e.detail.playerOwnCode)?e.detail:null;if(t){var r="";try{r=JSON.stringify(e.detail)}catch(t){r=e.detail.details}Debug.print("VSPlayer.recoverVideo() with "+r),this.reportSingleStreamError(r)}if(this.useNextHost(),!this.currentCdnProvider)return Debug.print("VSPlayer: no more cdn providers in current batch"),this.currentPlayer.cdnAttempts<this.currentPlayer.maxCdnAttempts?(Debug.print("VSPlayer: Will fetch more providers"),t&&1===this.currentPlayer.cdnAttempts&&this.reportNextBatchError(t),this.recoverTimer&&null!=this.recoverTimer&&(clearTimeout(this.recoverTimer),this.recoverTimer=null),void(this.recoverTimer=setTimeout("VSPlayerController.getCdnProviders()",5e3))):(VSPlayerLoggerController.ceeBlueLog("maxed out signalling url fetch attempt.. killing webrtc"),void this.killOffVideoType());this.embedPerBusinessRules(!0)}},killOffVideoType:function(){Debug.print("VSPlayer.killOffVideoType()"),VSPlayerController.hide(),VSPlayerLoggerController.logToSystem(1635,"Video.type:"+this.currentPlayer.name+";host:"+this.config.videoOrigin.stream_host+";user_id:"+this.config.envVars.USER.id),Debug.print("VSPlayer: one type of player failed completely: "+(this.currentPlayer?this.currentPlayer.name:""));var e=this.config.Room.playersPriority.indexOf(this.currentPlayer.name);if(-1!==e&&this.config.Room.playersPriority.splice(e,1),VSPlayerLoggerController.reportVideoEventBQ("stream_end",JSON.stringify({reason:"failed to recover"})),this.config.Room.playersPriority.length>0)return Debug.print("VSPlayer: Video player "+this.currentPlayer.name+" has failed"),this.selectVideoPlayer(!0,this.currentPlayer.name),this.cdnIndex=-1,this.useNextHost(),void this.embedPerBusinessRules(!0);Debug.print("VSPlayer: Video in this room is dead"),this.onVideoInRoomIsDead()},useNextHost:function(){var e;switch(Debug.print("VSPlayer.useNextHost()"),this.currentPlayer.name){case"hls":e=this.videoProvidersHls?this.videoProvidersHls:null;break;case"llhls":e=this.videoProvidersLLHls?this.videoProvidersLLHls:null;break;case"webrtc":e=this.videoProvidersWebrtc?[this.videoProvidersWebrtc]:null}e&&this.cdnIndex+1<e.length?(this.cdnIndex++,this.currentCdnProvider=e[this.cdnIndex],this.generateViewId(),Debug.print("VSPlayer: using next video host: "+JSON.stringify(this.currentCdnProvider))):this.currentCdnProvider=null},onVideoInRoomIsDead:function(){Debug.print("VSPlayer.onVideoInRoomIsDead()"),this.hide(),this.showMsg(Translator.getTranslation("videoPlayer","VIDEO_PLAYER_CONNECTION_ERROR")||"We were unable to establish connection to a video feed in this room. Sorry for the inconvenience. Please refresh this page or try another room.")},onVideoPlaying:function(){Debug.print("VSPlayer.onVideoPlaying()"),VSPlayerView.showPlayer(this.currentPlayer.name),this.videoEverShown=!0,this.videoEverShownInThisRoom||(this.videoEverShownInThisRoom=!0,this.announcePlayingEvent()),this.recoveringVideo=!1,"webrtc"===this.currentPlayer.name?VSPlayerWebrtcView.enableAbrMenu():"llhls"===this.currentPlayer.name?VSPlayerLLHlsView.enableAbrMenu():"hls"===this.currentPlayer.name&&VSPlayerHlsView.enableAbrMenu(),VSPlayerView.hideLoadingSymbol(),this.initialStreamPlayback=!1,VSPlayerView.hidePlayBtn(),this.trackLoadTime&&(this.currentCdnProvider.name||"webrtc"!=this.currentPlayer.name||(this.currentCdnProvider.name="webrtc"),this.autoplay&&VSPlayerLoggerController.trackVideoLoadTime(this.currentCdnProvider.name,this.trackLoadTime),this.trackLoadTime=!1),this.browserTooOldForAutoPlay||this.autoplay||(this.autoplay=!0,this.currentPlayer.updateAutoplay(!0))},onVideoLoading:function(){Debug.print("VSPlayer.onVideoLoading()"),VSPlayerView.updateCurrentPlayerIcon(this.currentPlayer.name)},onVidVolumeChanged:function(e){var t=e?"unmute":"mute";VSPlayerView.updateMuteIcon(t)},onBufferStart:function(e){Debug.print("VSPlayer.onBufferStart("+JSON.stringify(e)+")"),e&&e.abr_profile&&(null!==VSPlayerController.lastBuffer&&(e.successive=!0),VSPlayerController.lastBuffer=window.Date.now(),VSPlayerLoggerController.reportVideoEventBQ("buffer_start",JSON.stringify(e)))},onBufferStop:function(e){if(Debug.print("VSPlayer.onBufferStop("+JSON.stringify(e)+")"),e&&e.abr_profile){if(null===VSPlayerController.lastBuffer&&(e.successive=!0),null!==VSPlayerController.lastBuffer){var t=window.Date.now()-VSPlayerController.lastBuffer;e.buffer_duration=t,VSPlayerController.lastBuffer=null}VSPlayerLoggerController.reportVideoEventBQ("buffer_stop",JSON.stringify(e))}},onVideoMetadata:function(){Debug.print("VSPlayer.onVideoMetadata()")},onVideoCanPlaythrough:onVideoPaused:function(){Debug.print("VSPlayer.onVideoPaused()"),VSPlayerController.suppressPlayBtn||VSPlayerController.invokePlayBtnLogic()},onAutoPlayFailed:function(e){if(Debug.print("VSPlayer.onAutoPlayFailed()"),!this.recoveringVideo&&this.config.fns.shouldVideoBeShownRN().doShow){var t="";for(var r in e)t+=r+":"+e[r]+";";t+="device:"+this.config.envVars.USER.platform_device+";browserName:"+this.config.envVars.UAParser.browser.name.toLowerCase()+";browserVersion:"+this.config.envVars.UAParser.browser.major+";muteAudio:"+this.config.Room.userPrefs.muteAudio+";userAgent:"+navigator.userAgent,"hls.js"===e.player?VSPlayerLoggerController.logToSystem(2106,t):"native hls"===e.player?VSPlayerLoggerController.logToSystem(2107,t):VSPlayerLoggerController.logToSystem(2105,t),Debug.print("VSPlayer.onAutoPlayFailed() muted: ",this.config.Room.userPrefs.muteAudio),this.config.Room.userPrefs.muteAudio?this.invokePlayBtnLogic():(VSPlayerView.hideLoadingSymbol(),this.config.Room.userPrefs.muteAudio=!0,"webrtc"===this.currentPlayer.name?(this.setVolume(),this.onVidVolumeChanged(this.config.Room.userPrefs.muteAudio),this.currentPlayer.callPlay()):this.embedPerBusinessRules(!0))}},onUserSelectedAbr:function(e){if(Debug.print("VSPlayer.onUserSelectedAbr("+e+")"),!VSPlayerController.recoveringVideo&&("webrtc"!=VSPlayerController.currentPlayer.name&&"hls"!=VSPlayerController.currentPlayer.name&&"llhls"!=VSPlayerController.currentPlayer.name&&VSPlayerController.currentPlayer.setABRPreference(e),VSPlayerController.config.fns.shouldVideoBeShownRN().doShow&&(VSPlayerController.userTriggeredAbrSwitch=!0,"webrtc"==VSPlayerController.currentPlayer.name||"llhls"==VSPlayerController.currentPlayer.name||"hls"==VSPlayerController.currentPlayer.name))){var t="auto"===e.toLowerCase();switch(t&&(VSPlayerController.userTriggeredAbrSwitch=!1),VSPlayerController.currentPlayer.name){case"webrtc":t||(VSPlayerWebrtcView.disableAbrMenu(),VSPlayerView.showLoadingSymbol());var r=VSPlayerWebRTCModel.selectedVideoTrack?VSPlayerWebRTCModel.selectedVideoTrack.label:"";VSPlayerWebrtcView.updateCurrentAbrLabel(r,t);break;case"llhls":t||VSPlayerLLHlsView.disableAbrMenu(),VSPlayerLLHlsView.updateCurrentAbrLabel(e,t);break;case"hls":t||VSPlayerHlsView.disableAbrMenu(),VSPlayerHlsView.updateCurrentAbrLabel(e,t)}VSPlayerController.currentPlayer.setABRPreference(e),"llhls"===VSPlayerController.currentPlayer.name&&Array.isArray(VSPlayerController.streamSettings)&&VSPlayerController.embedPerBusinessRules(!0)}},onSwitchStreamLoaded:onSwitchStreamStarted:function(e){VSPlayerController.currentPlayer.name,Debug.print("VSPlayer.onSwitchStreamStarted()");var t=VSPlayerController.userTriggeredAbrSwitch?"stream_switch_manual":"stream_switch_automatic";VSPlayerLoggerController.reportVideoEventBQ(t,JSON.stringify(e))},onSwitchStreamSucceeded:function(e){if(Debug.print("VSPlayer.onSwitchStreamSucceeded("+JSON.stringify(e)+")"),!VSPlayerController.recoveringVideo){if("equal"!=e.source&&"playerSetup"!=e.source){var t=e;t.isManual=!!VSPlayerController.userTriggeredAbrSwitch,t.playerStats=VSPlayerController.currentPlayer.getPlayerStats(),VSPlayerLoggerController.reportVideoEventBQ("stream_switch_success",JSON.stringify(t))}var r=e.abr_profile;"webrtc"===VSPlayerController.currentPlayer.name?(VSPlayerWebrtcView.enableAbrMenu(),VSPlayerWebrtcView.updateCurrentAbrLabel(r,e.auto)):"llhls"===VSPlayerController.currentPlayer.name?(VSPlayerLLHlsView.enableAbrMenu(),VSPlayerLLHlsView.updateCurrentAbrLabel(r,e.auto)):"hls"===VSPlayerController.currentPlayer.name&&(VSPlayerHlsView.enableAbrMenu(),VSPlayerHlsView.updateCurrentAbrLabel(r,e.auto)),VSPlayerController.userTriggeredAbrSwitch&&(VSPlayerController.userTriggeredAbrSwitch=!1,VSPlayerView.hideLoadingSymbol())}},onSwitchStreamFailed:function(e){if(Debug.print("VSPlayer.onSwitchStreamFailed()"),"llhls.js"===e.sourcePlayer){if(VSPlayerController.recoveringVideo)return;VSPlayerLoggerController.reportVideoEventBQ("stream_switch_fail",JSON.stringify(e)),VSPlayerController.userTriggeredAbrSwitch=!1,VSPlayerLLHlsView.enableAbrMenu(),VSPlayerView.hideLoadingSymbol()}else if("hls.js"===e.sourcePlayer){if(VSPlayerController.recoveringVideo)return;VSPlayerLoggerController.reportVideoEventBQ("stream_switch_fail",JSON.stringify(e)),VSPlayerController.userTriggeredAbrSwitch=!1,VSPlayerHlsView.enableAbrMenu(),VSPlayerView.hideLoadingSymbol()}else if("webrtc"===e.sourcePlayer){if(VSPlayerController.recoveringVideo)return;VSPlayerWebrtcView.enableAbrMenu(),VSPlayerLoggerController.reportVideoEventBQ("stream_switch_fail",JSON.stringify(e)),VSPlayerView.hideLoadingSymbol()}},onAudioIconClicked:function(e){switch(Debug.print("VSPlayer.onAudioIconClicked() with "+e.detail),e.detail){case"unmute":this.config.Room.userPrefs.volLevel?this.adjustAudioVolume(this.config.Room.userPrefs.volLevel):this.adjustAudioVolume(1),this.setUserUnmutedFlag(!0);break;case"mute":this.adjustAudioVolume(0)}},setUserUnmutedFlag:function(e){this.userUnmuted=e},adjustAudioVolume:function(e){Debug.print("VSPlayer.adjustAudioVolume("+JSON.stringify(e)+")");var t="object"==typeof e?e.detail.volLevel:e;0===t?(VSPlayerController.config.Room.userPrefs.muteAudio=!0,VSPlayerView.updateMuteIcon("unmute"),DOM.dispatchEvent(document,VSPLAYER_PUBLIC_EVENTS.MUTED_VIDEO)):(VSPlayerController.config.Room.userPrefs.muteAudio=!1,VSPlayerView.updateMuteIcon("mute"),DOM.dispatchEvent(document,VSPLAYER_PUBLIC_EVENTS.UNMUTED_VIDEO)),VSPlayerController.config.Room.userPrefs.volLevel=t,VSPlayerView.updateVolumeSliderValue(100*t),VSPlayerController.setVolume(),VSPlayerModel.setVideoSettings(VSPlayerController.config.Room.userPrefs)},onPlayBtnClicked:function(){Debug.print("VSPlayer.onPlayBtnClicked()"),VSPlayerController.browserTooOldForAutoPlay||(VSPlayerController.autoplay=!0,VSPlayerController.currentPlayer&&VSPlayerController.currentPlayer.updateAutoplay(!0)),VSPlayerController.embedPerBusinessRules(!0)},onBrowserTabVisibilityChng:function(){Debug.print("VSPlayer.onBrowserTabVisibilityChng()"),"computer"!==VSPlayerController.config.envVars.USER.platform_type?document.hidden?(VSPlayerController.browserTabOutOfFocus=!0,VSPlayerController.currentPlayer&&VSPlayerController.currentPlayer.callPause()):(VSPlayerController.browserTabOutOfFocus=!1,VSPlayerController.onPlayBtnClicked()):document.hidden||VSPlayerController.currentPlayer&&VSPlayerController.currentPlayer.videoEl&&VSPlayerController.currentPlayer.videoEl.muted&&(VSPlayerController.currentPlayer.videoEl.currentTime=0)},onWebrtcAvailableTracks:function(e){var t=e.detail.videoTracks.map((function(e){return e.label}));VSPlayerWebrtcView.configureAbrMenu(t,e.detail.autoAvailable)},logError:function(e){Debug.print("VSPlayerController.logError()");var t=VSPlayerController;if("hls.js"===(e=e||{}).player){let r=e.payload||{};if(t.logs.length>=t.logsLimit)return;if(t.logs.push({type:"error",payload:{player:e.player,protocol:e.protocol,detail:r.details,type:r.type,fatal:r.fatal}}),t.isSendingLogs)return;t.isSendingLogs=!0,window.clearTimeout(t.sendLogsTimer),t.sendLogsTimer=window.setTimeout((function(){t.sendLogs(t.logs),t.logs=[],t.isSendingLogs=!1}),t.sendLogsWaitMS)}},sendLogs:function(e){if(Array.isArray(e)&&!(e.length<=0)){var t={logs:e};VSPlayerLoggerController.reportVideoEventBQ("batch_logs",JSON.stringify(t))}},reportSingleStreamError:function(e){Debug.print("VSPlayer.reportSingleStreamError() with "+e);var t={},r=null;try{t=JSON.parse(e)}catch(e){r=e,t={playerOwnCode:"",details:"non-parseable error object",player_stats:""}}try{if(r)if("string"==typeof e)t.details="string err: "+e;else if(Array.isArray(e))t.details="err type: array";else if(null==e)t.details="err type: null";else if("object"==typeof e){var i=JSON.stringify(e);t.details="err type: object: "+i}else t.details="err type: "+typeof e}catch(e){r&&(t.details="err type: failed to stringify errString when typeof errString === 'object'","object"==typeof e&&(t.details+=" => catch err: "+e.message+" : "+e.name))}if(r&&"string"==typeof t.details&&"object"==typeof r&&(t.details+=" => catch err: "+r.message+" : "+r.name),this.config.fns.shouldVideoBeShownRN().doShow&&this.initialStreamPlayback){this.initialStreamPlayback=!1;var n={playerOwnCode:t.playerOwnCode,details:t.details,cdn_provider:VSPlayerController.currentCdnProvider,player_stats:t.player_stats};VSPlayerLoggerController.reportVideoEventBQ("stream_error",JSON.stringify(n))}},reportNextBatchError:function(e){try{Debug.print("VSPlayer.reportNextBatchError() with "+JSON.stringify(e))}catch(e){Debug.print("VSPlayer.reportNextBatchError()")}},showMsg:function(e,t){t=t||"error",Debug.print("VSPlayerController.showMsg("+e+")"),this.config&&this.config.fns&&this.config.fns.notifyFn(e,t)},reportJoinTime:invokePlayBtnLogic:function(){Debug.print("VSPlayer.invokePlayBtnLogic()"),VSPlayerController.announceJoinTimeTrackingCanceled(),VSPlayerController.config.fns.shouldVideoBeShownRN().doShow&&VSPlayerView.showPlayBtn(),VSPlayerView.hideLoadingSymbol()},announceJoinTimeTrackingCanceled:function(){Debug.print("VSPlayer.announceJoinTimeTrackingCanceled()"),DOM.dispatchEvent(document,VSPLAYER_PUBLIC_EVENTS.ON_PLAY_BTN_SHOWN)},announcePlayingEvent:function(){Debug.print("VSPlayer.announcePlayingEvent()"),DOM.dispatchEvent(document,VSPLAYER_PUBLIC_EVENTS.PLAYING_EVENT,{tStamp:(new Date).getTime()})},announceVideoHidden:changeVideoPlayer:function(e){Debug.print("VSPlayer.changeVideoPlayer()");var t=VSPlayerController;if(VSPlayerModel.setPreferredPlayer(e),VSPlayerModel.deleteBackUpPlayerCookie(this.config.Room.MODEL.id),window.__isUsingNoRefreshPlayerSwitch__){if(t.currentPlayer.name!==e){var r=t.config.Room.playersPriority;t.hide(),t.config.Room.playersPriority=this.arrangePlayerPriority(r,e),t.selectVideoPlayer(),this.cdnIndex=-1,this.useNextHost(),t.embedPerBusinessRules(!0)}}else location.reload()},setVolume:function(){Debug.print("VSPlayer.setVolume: "+JSON.stringify(this.config.Room.userPrefs)),this.currentPlayer.setVolume(this.config.Room.userPrefs)},removeExternalCodesForcedMuting:onLLHlsLevelsAvailable:function(e){var t=e.detail.sortedLevels,r=e.detail.hasAuto;Array.isArray(t)&&VSPlayerLLHlsView.configureAbrMenu(t.map((function(e){return e.resolutionString})),r)},onHlsLevelsAvailable:function(e){var t=e.detail.sortedLevels;Array.isArray(t)&&VSPlayerHlsView.configureAbrMenu(t.map((function(e){return e.resolutionString})),!0)},resetComponent:function(){if(Debug.print("VSPlayer.resetComponent()"),this.recoveringVideo=!1,this.videoEverShownInThisRoom=!1,this.currentCdnProvider=null,this.lastBuffer=null,this.cdnIndex=0,this.recoverTimer&&null!=this.recoverTimer&&(clearTimeout(this.recoverTimer),this.recoverTimer=null),this.players&&this.currentPlayer){for(var e in this.players)this.players[e].resetComponent();this.hide()}VSPlayerLoggerController.viewId=null,this.logs=[],window.clearTimeout(this.sendLogsTimer),this.sendLogsTimer=null,this.isSendingLogs=!1},showInternalVideoOverlayInfo:function(){if(this.currentCdnProvider.name){var e=document.querySelector(".chatroom-container #device .aspect-ratio-inner"),t={right:"25%",bottom:"30%"};if(e||(e=document.querySelector(".chatroom-container #device"),t={top:"10%","z-index":"4"}),e||(e=document.querySelector(".chatroom-container .aspect-ratio-inner"),t={right:"10%",bottom:"25%"}),!e)return;var r=document.createElement("div");r.classList.add("pre-processed-label","extra-info-internal");var i="";if(!window.AppController)return;if(!window.AppController.Room)return;if(!window.AppController.Room.video_overlay_info)return;var n=window.AppController.Room.video_overlay_info,o={IP_Country:n.country_by_ip?n.country_by_ip:"NA",Model_Country:n.country_by_record?n.country_by_record:"NA",Video_Server:n.video_server?n.video_server:"NA"};for(var a in o){i+="<div>"+a.replace("_"," ")+": "+o[a]+"</div>"}i+="<div>CDN: "+this.currentCdnProvider.name+"</div>",r.innerHTML=i;if(Object.assign(r.style,{position:"absolute","background-color":"rgba(112,28,28,0.7)",display:"inline-block",padding:"0px 5px","line-height":"22px","font-size":"9px",color:"rgba(255,255,255,0.7","text-transform":"capitalize"},t),e){var s=e.querySelector(".extra-info-internal");s&&s.parentElement.removeChild(s),e.insertAdjacentElement("beforeend",r)}}}},VSPlayerLoggerController={reportPlayEventBQ:function(){Debug.print("VSPlayerLogger.reportPlayEventBQ()");var e={date:"n/a",datetime:"n/a",view_id:"n/a",user_id:-1,user_type:"n/a",username:"n/a",screenname:"n/a",model_id:-1,model_name:"n/a",studio:"n/a",rank:"n/a",show_type:"n/a",event_type:"n/a",service:"n/a",url:"n/a",protocol:"n/a",package:"n/a",cdn:"n/a",cdn_pretty:"n/a",origin:"n/a",sitekey:"n/a",domain:"n/a",interface:"n/a",video_type:"n/a",device_platform_name:"n/a",device_platform_type:"n/a",device_os_name:"n/a",device_browser_name:"n/a",device_browser_version:"n/a",device_browser_engine:"n/a",device_user_agent:"n/a",ip_address:"n/a",country:"n/a",session_id:null,UDF01:null},t=VSPlayerController.config.fns.getDynamicDataForBQ();e.interface="computer"===VSPlayerController.config.envVars.USER.platform_type?"desktop":"mobile";var r=Number(VSPlayerController.config.envVars.USER.id);if(e.view_id=this.viewId,Debug.print("Videolog view_id: "+e.view_id),!e.view_id)return Debug.print("Videolog: No view id exists!");e.date=(new Date).toISOString().slice(0,10),e.datetime=(new Date).toISOString().slice(0,19),e.user_id=r,e.user_type=t.user_type,e.username=t.username,e.screenname=t.screenname,e.model_id=parseInt(VSPlayerController.config.Room.MODEL.id),e.model_name=t.model_name,e.rank=t.rank,e.service=t.service,e.url=document.location.href,e.cdn=VSPlayerController.currentCdnProvider&&VSPlayerController.currentCdnProvider.name||"none",e.cdn_pretty=VSPlayerController.currentCdnProvider&&VSPlayerController.currentCdnProvider.name||"none",e.origin=VSPlayerController.config.videoOrigin.stream_host||"none",e.sitekey=VSPlayerController.config.envVars.USER.sitekey,e.domain=t.domain,e.device_platform_name=VSPlayerController.config.envVars.UAParser.os.name.toLowerCase()||"none",e.device_os_name=VSPlayerController.config.envVars.UAParser.os.name.toLowerCase()+" "+VSPlayerController.config.envVars.UAParser.os.version,"computer"==VSPlayerController.config.envVars.USER.platform_type?e.device_platform_type="computer":e.device_platform_type="mobile",e.device_browser_name=VSPlayerController.config.envVars.UAParser.browser.name.toLowerCase()||"",e.device_browser_version=VSPlayerController.config.envVars.UAParser.browser.version||"",e.device_user_agent=navigator.userAgent,e.show_type=t.show_type,e.protocol=VSPlayerController.currentPlayer.name,e.package="hls"===VSPlayerController.currentPlayer.name&&Hls.isSupported()?"single":"abr_unknown",e.device_browser_engine=VSPlayerController.config.envVars.UAParser.engine.name||"none",e.video_type=t.video_type,e.studio=t.studio,e.event_type=t.event_type,e.ip_address=VSPlayerController.config.endpoints.tracking.userIp,e.country=t.country,e.session_id=t.session_id,e.UDF01=VSPlayerController.userGroup,this.reportToBQ("plays",e)},reportVideoEventBQ:function(e,t){Debug.print("VSPlayerLogger.reportVideoEventBQ()");var r={date:"n/a",datetime:"n/a",view_id:"n/a",event_type:"n/a",event_details:"n/a"};r.date=(new Date).toISOString().slice(0,10),r.datetime=(new Date).toISOString().slice(0,19),r.view_id=this.viewId||(new Date).getTime().toString()+"-no-view-id",r.event_type=e||"not passed",r.event_details=t||"",this.reportToBQ("play_events",r)},reportToBQ:function(e,t){if(Debug.print("VSPlayerLogger.report()"),t){var r={};r.data=t,r.dataset="video_system",r.schema=e;var i="undefined"!=typeof USER&&USER.bq_key?USER.bq_key:window.bq_key;if(i){var n=window.atob("aHR0cHM6Ly91cy1jZW50cmFsMS12c20tYmlnZGF0YS5jbG91ZGZ1bmN0aW9ucy5uZXQvYnFJbnNlcnRKUw==");r.key=i,VSPlayerLoggerModel.logDataBQ(n,r).then((function(e){Debug.print("VSPlayerLogger: Video logging data sent")})).catch((function(e){Debug.print("VSPlayerLogger: error reporting video data:"+JSON.stringify(e))}))}}},logToSystem:function(e,t){Debug.print("VSPlayerLogger.logToSystem()");var r=VSPlayerController.streamUrl?encodeURIComponent(VSPlayerController.streamUrl):null,i="club"===VSPlayerController.config.envVars.USER.sitekey?"/ws":"";i+="/chat/error.php?code="+e+"&server="+r+"&model_id="+VSPlayerController.config.Room.MODEL.id+"&nickname="+VSPlayerController.config.envVars.USER.nickname+"&token="+VSPlayerController.config.endpoints.tracking.userToken+"&ip="+VSPlayerController.config.endpoints.tracking.userIp+"&sitekey="+VSPlayerController.config.envVars.USER.sitekey+"&error_text="+encodeURIComponent(t),VSPlayerLoggerModel.report(i).then(().catch(()},trackVideoLoadTime:function(e,t){Debug.print("VSPlayerLogger.trackVideoLoadTime()");var r="";r=-1!==e.indexOf("edgecast")?"edgecast":-1!==e.indexOf("level3")?"level":"other";var i=(new Date).getTime(),n=(Math.round(i-t)/1e3).toString(),o=atob("L3dlYnNlcnZpY2VzL2JlYWNvbi5waHA/YWN0aW9uPXRpbWVfdG9fbG9hZF92aWRlbw==")+"&seconds="+n+"&provider="+r;VSPlayerLoggerModel.trackVideoLoadTime(o)},ceeBlueLog:function(e,t){if(t=null!=t?t:"",VSPlayerController.currentPlayer&&"webrtc"===VSPlayerController.currentPlayer.name){var r=new Date,i=r.getHours(),n=r.getMinutes(),o=r.getSeconds();i<10&&(i="0"+i),n<10&&(n="0"+n),o<10&&(o="0"+o);var a=i+":"+n+":"+o;console.log("@@ceeblue: ",e,t,a)}}},VSPlayerHlsModel={name:"hls",cdnAttempts:0,maxCdnAttempts:3,initialized:!1,networkUrl:"",isBrowserSupported:null,mediaErrorCodes:{1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},preInitConfig:function(e){e=e||{},this.resolutionsToExclude=e.resolutionsToExclude,this.getVideoResolution=e.getVideoResolution},init:function(){Debug.print("VSPlayerHlsModel.init()"),this.createVidEl(),this.initialized=!0,this.isDesktop="computer"===VSPlayerController.config.envVars.USER.platform_type,this.browserName=VSPlayerController.config.envVars.UAParser.browser.name.toLowerCase(),this.deviceOS=VSPlayerController.config.envVars.UAParser.os.name.toLowerCase(),this.onVideoResolutionChange=this.onVideoResolutionChange.bind(this)},useNativeHLS:function(){return!("safari"!==this.browserName||!this.isDesktop)||("ios"===this.deviceOs||("undefined"==typeof Hls||!Hls.isSupported()))},createVidEl:function(){Debug.print("VSPlayerHlsModel.createVidEl()"),this.videoEl=DOM.getElementById("hls-video"),this.videoEl||(this.videoEl=document.createElement("video"),this.videoEl.setAttribute("id","hls-video"),DOM.getElementById("hlsVideoContainer").appendChild(this.videoEl),this.enableControls?this.videoEl.setAttribute("controls","controls"):this.videoEl.removeAttribute("controls"),this.videoEl.setAttribute("autoplay","autoplay"),this.videoEl.setAttribute("playsinline","playsinline"),this.videoEl.setAttribute("webkit-playsinline","webkit-playsinline"))},verifyBrowserSupport:function(e){return Debug.print("VSPlayerHlsModel.verifyBrowserSupport()"),null!==this.isBrowserSupported?this.isBrowserSupported:(this.isBrowserSupported=!0,!0)},show:function(e,t,r,i,n){Debug.print("VSPlayerHlsModel.show()"),this.showConfig=n||{},this.streamSettings=Array.isArray(n.streamSettings)&&n.streamSettings.every(()&&n.streamSettings||[];var o=this,a=o.streamSettings.map((function(e){var t=o.getVideoResolution(e.width,e.height);return o.resolutionsToExclude().indexOf(t)>=0?e.height:-1})).filter((function(e){return-1!=e})).join(","),s=[];a.length>0&&s.push("exclude-variants="+a);var l=this.buildStreamUrl(e,s);if(l)if(Debug.print("VSPlayerHlsModel: showing hls player with "+l),t.muteAudio||r?this.videoEl.muted=!0:this.videoEl.muted=!1,this.addPlayerAgnosticEvListeners(),this.useNativeHLS())DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.HLS_LEVELS_AVAILABLE,{sortedLevels:[]}),VSPlayerHlsModel.videoEl.style.display="inline",this.addNativeHlsEventListeners(),this.videoEl.removeAttribute("src"),this.videoEl.load(),setTimeout((function(){VSPlayerHlsModel.videoEl.setAttribute("src",l),VSPlayerHlsModel.videoEl.load(),"autoplay"===VSPlayerHlsModel.videoEl.getAttribute("autoplay")?VSPlayerHlsModel.callPlay():VSPlayerHlsModel.videoEl.pause(),VSPlayerHlsModel.hlsType="hls-native"}),10);else{this.hls&&this.hls.detachMedia();var c={liveSyncDuration:8,liveDurationInfinity:1/0,liveMaxLatencyDuration:12,liveBackBufferLength:30,lowLatencyMode:!1};-1!==document.location.href.indexOf("/dev.")&&(c.debug=!0,(1021235==AppController.Room.config.performer.id&&41026406==AppController.Room.config.user.id||1021235==AppController.Room.config.performer.id&&12299431==AppController.Room.config.user.id)&&(c.enableWorker=!0,c.lowLatencyMode=!0,c.liveSyncDuration=1,c.liveMaxLatencyDuration=2,console.warn(c))),this.abrPreference=window.localStorage.getItem("vsABRpref")||"auto",this.hls=new Hls(c),this.assignPlayerInstanceEvListeners(this.hls,l),this.hls.attachMedia(this.videoEl),this.hlsType="hls-js"}else Debug.print("VSPlayerHlsModel.show(): could NOT define stream url")},hide:function(){Debug.print("VSPlayerHlsModel.hide()"),VSPlayerHlsModel.unsubscribeFromTimeUpdateEv(),VSPlayerHlsModel.clearSwitchLevelTimer(),this.removePlayerAgnosticEvListeners(),this.useNativeHLS()?(this.removeNativeHlsEventListeners(),this.videoEl.removeAttribute("src"),this.videoEl.load()):this.hls&&(this.hls.destroy(),this.hls=null)},setABRPreference:function(e){this.abrPreference=e,window.localStorage.setItem("vsABRpref",this.abrPreference);var t=this.mapQualityToLevelIndex(this.abrPreference);this.hls.loadLevel=t},mapQualityToLevelIndex:function(e){return"auto"===e?-1:function(){var t=parseInt(e),r=this.hls.levels.findIndex((function(e){return VSPlayerHlsModel.getVideoResolution(e.width,e.height)===t}));return r<0?this.hls.levels.length-1:r}.bind(this)()},addPlayerAgnosticEvListeners:function(){Debug.print("VSPlayerHlsModel.addPlayerAgnosticEvListeners()"),this.removePlayerAgnosticEvListeners(),DOM.addEventListener(this.videoEl,"playing",this.onVideoPlaying),DOM.addEventListener(this.videoEl,"pause",this.onVideoPaused),DOM.addEventListener(this.videoEl,"volumechange",this.onVolumeChange),DOM.addEventListener(this.videoEl,"loadstart",this.onVideoLoading),DOM.addEventListener(this.videoEl,"loadedmetadata",this.onVideoMetadata),DOM.addEventListener(this.videoEl,"canplaythrough",this.onVideoCanPlaythrough),DOM.addEventListener(this.videoEl,"resize",this.onVideoResolutionChange)},removePlayerAgnosticEvListeners:function(){Debug.print("VSPlayerHlsModel.removePlayerAgnosticEvListeners()"),DOM.removeEventListener(this.videoEl,"playing",this.onVideoPlaying),DOM.removeEventListener(this.videoEl,"pause",this.onVideoPaused),DOM.removeEventListener(this.videoEl,"volumechange",this.onVolumeChange),DOM.removeEventListener(this.videoEl,"loadstart",this.onVideoLoading),DOM.removeEventListener(this.videoEl,"loadedmetadata",this.onVideoMetadata),DOM.removeEventListener(this.videoEl,"canplaythrough",this.onVideoCanPlaythrough),DOM.removeEventListener(this.videoEl,"resize",this.onVideoResolutionChange)},removeNativeHlsEventListeners:function(){Debug.print("VSPlayerHlsModel.removeNativeHlsEventListeners()"),DOM.removeEventListener(this.videoEl,"error",this.onPlayerError),DOM.removeEventListener(this.videoEl,"waiting",this.onPlayerWaiting)},addNativeHlsEventListeners:function(){Debug.print("VSPlayerHlsModel.addNativeHlsEventListeners()"),this.removeNativeHlsEventListeners(),DOM.addEventListener(this.videoEl,"error",this.onPlayerError),DOM.addEventListener(this.videoEl,"waiting",this.onPlayerWaiting)},assignPlayerInstanceEvListeners:function(e,t){Debug.print("VSPlayerHlsModel.assignPlayerInstanceEvListeners()");e.on(Hls.Events.MEDIA_ATTACHED,(function(){Debug.print("VSPlayerHlsModel: Hls.Events.MEDIA_ATTACHED"),VSPlayerHlsModel.hls.loadSource(t),e.on(Hls.Events.MANIFEST_PARSED,(function(t,r){"autoplay"===VSPlayerHlsModel.videoEl.getAttribute("autoplay")?VSPlayerHlsModel.callPlay():VSPlayerHlsModel.videoEl.pause(),function(){Debug.print("VSPlayerHlsModel.handleUpdatedLevels()");var t=VSPlayerHlsModel.mapSortLevels(e.levels);DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.HLS_LEVELS_AVAILABLE,{sortedLevels:t})}()})),e.on(Hls.Events.LEVEL_SWITCHING,VSPlayerHlsModel.onSwitchStreamInit)})),e.on(Hls.Events.ERROR,(function(e,t){Debug.print("VSPlayerHlsModel: Hls.Events.ERROR:");try{Debug.print(JSON.stringify(t))}catch(e){}VSPlayerController.config.envVars.USER.isInternal&&console.log(t),Debug.print("VSPlayerHlsModel: hls player error: "+t.type),t.details===Hls.ErrorDetails.BUFFER_STALLED_ERROR&&(DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.BUFFER_START,{buffer_length:t.buffer,abr_profile:VSPlayerHlsModel.videoEl.videoHeight}),t.fatal||VSPlayerHlsModel.videoEl.addEventListener("timeupdate",VSPlayerHlsModel.onPlayerTimeUpdate,{once:!0})),t.fatal&&VSPlayerHlsModel.onPlayerError({type:t.type,details:t.details,fatal:t.fatal})}))},buildStreamUrl:function(e,t){Debug.print("VSPlayerHlsModel.buildStreamUrl()");var r=e.url,i=r.split("?"),n=i[0],o=i[1],a=o.split("&");return Array.isArray(t)&&(a=a.concat(t)),r=n+"?"+(o=a.join("&")),Debug.print("VSPlayerHlsModel.buildStreamUrl(): "+r),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.STREAM_URL_BUILT,{streamUrl:r}),(1021235==AppController.Room.config.performer.id&&41026406==AppController.Room.config.user.id||1021235==AppController.Room.config.performer.id&&12299431==AppController.Room.config.user.id)&&(r="https://video-gpu001-ll-tx.vs3.com/live/1021235-video-gpu001-ll-tx.vs3.com.f4v/1021235-video-gpu001-ll-tx.vs3.com.f4v/playlist_sfm4s.m3u8",console.warn(r)),r},onPlayerError:function(e){Debug.print("VSPlayerHlsModel.onPlayerError()");var t={};if(e.target&&e.target.error){var r=e.target,i=VSPlayerHlsModel.mediaErrorCodes[r.error.code]||"unknown error code";switch(t={type:i,details:i},r.error.code){case r.error.MEDIA_ERR_NETWORK:case r.error.MEDIA_ERR_DECODE:case r.error.MEDIA_ERR_SRC_NOT_SUPPORTED:t.fatal=!0}}else e.type&&e.details&&(t=e);t.fatal&&DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_ERROR,{playerOwnCode:!0,details:t,player_stats:VSPlayerHlsModel.getPlayerStats()})},onVideoPlaying:function(){VSPlayerHlsModel.cdnAttempts=0,DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_PLAYING)},onVideoLoading:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_LOADING)},onVideoMetadata:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_METADATA)},onVideoCanPlaythrough:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_CANPLAYTHROUGH)},onVideoResolutionChange:function(){Debug.print("VSPlayerHlsModel.onVideoResolutionChange()");var e=VSPlayerHlsModel.videoEl.videoWidth,t=VSPlayerHlsModel.videoEl.videoHeight;0==e&&0==t||DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_SUCCEEDED,{abr_profile:VSPlayerHlsModel.getVideoResolution(e,t,!0),auto:!this.hls||this.hls.autoLevelEnabled})},onPlayerWaiting:function(e){Debug.print("VSPlayerHlsModel.onPlayerWaiting()"),VSPlayerHlsModel.videoEl.addEventListener("timeupdate",VSPlayerHlsModel.onPlayerTimeUpdate,{once:!0}),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.BUFFER_START,{abr_profile:VSPlayerHlsModel.videoEl.videoHeight})},unsubscribeFromTimeUpdateEv:function(){Debug.print("VSPlayerHlsModel.unsubscribeFromTimeUpdateEv()"),VSPlayerHlsModel.videoEl&&VSPlayerHlsModel.videoEl.removeEventListener("timeupdate",VSPlayerHlsModel.onPlayerTimeUpdate)},onPlayerTimeUpdate:function(e){Debug.print("VSPlayerHlsModel.onPlayerTimeUpdate(): "+JSON.stringify(e)),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.BUFFER_STOP,{abr_profile:VSPlayerHlsModel.videoEl.videoHeight})},onVideoPaused:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_PAUSED)},onVolumeChange:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VID_VOLUME_CHANGED,{isMuted:this.muted})},setVolume:function(e){e.muteAudio?this.videoEl.muted=!0:this.videoEl.muted=!1,e.volLevel&&(this.videoEl.volume=e.volLevel)},callPlay:function(){if(this.videoEl){var e=this.videoEl.play();void 0!==e&&e.then((function(){})).catch(function(e){Debug.print("VSPlayerHlsModel: AUTOPLAY_FAILED");var t={player:this.useNativeHLS()?"native hls":"hls.js"};DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.AUTOPLAY_FAILED,t)}.bind(this))}},callPause:function(){Debug.print("VSPlayerHlsModel.callPause()"),this.videoEl&&this.videoEl.pause()},updateAutoplay:function(e){Debug.print("VSPlayerHlsModel.updateAutoplay("+e+")"),e?this.videoEl.setAttribute("autoplay","autoplay"):this.videoEl.removeAttribute("autoplay")},enterNativeFullscreen:function(e){if(Debug.print("VSPlayerHlsModel.enterNativeFullscreen()"),void 0!==this.videoEl.requestFullscreen&&"function"==typeof this.videoEl.requestFullscreen)this.videoEl.requestFullscreen();else if(e){var t=e+"RequestFullScreen";this.videoEl[t]()}},exitNativeFullScreen:function(e){if(document.fullscreen||document.webkitIsFullScreen||document.mozFullScreen)if(void 0!==document.exitFullscreen&&"function"==typeof document.exitFullscreen)document.exitFullscreen();else if("moz"===e)document.mozCancelFullScreen();else{if(e)document[e+"ExitFullscreen"]()}},getPlayerStats:function(){if(!this.useNativeHLS()){if(VSPlayerHlsModel.hls){var e=[];return VSPlayerHlsModel.hls.levels&&VSPlayerHlsModel.hls.levels.forEach((function(t){var r={};r.attrs=t.attrs,r.audioCodec=t.audioCodec,r.bitrate=t.bitrate,r.height=t.height,r.width=t.width,r.name=t.name,r.unknownCodecs=t.unknownCodecs,r.level=t.level,r.videoCodec=t.videoCodec,r.fragmentError=t.fragmentError,r.loadError=t.loadError,e.push(r)})),{player_type:"hls.js",bandwidthEstimate:VSPlayerHlsModel.hls.bandwidthEstimate,abr_levels:e,current_level:VSPlayerHlsModel.hls.currentLevel,auto_level_enabled:VSPlayerHlsModel.hls.autoLevelEnabled,networkUrl:VSPlayerHlsModel.networkUrl}}return{player_type:"hls.js",oops:"somehow VSPlayerHlsModel.hls is False"}}try{return{player_type:"native hls",current_time:VSPlayerHlsModel.videoEl.currentTime,buffered_start:VSPlayerHlsModel.videoEl.buffered&&VSPlayerHlsModel.videoEl.buffered.length>0&&VSPlayerHlsModel.videoEl.buffered.start(0)||"n/a",buffered_end:VSPlayerHlsModel.videoEl.buffered&&VSPlayerHlsModel.videoEl.buffered.length>0&&VSPlayerHlsModel.videoEl.buffered.end(0)||"n/a"}}catch(e){return{error:"encountered error on Native Hls trying to gather stats."}}},onSwitchStreamInit:function(e,t){try{Debug.print("VSPlayerHlsModel.onSwitchStreamInit("+JSON.stringify(t)+")")}catch(e){Debug.print('VSPlayerHlsModel.onSwitchStreamInit("circular reference")')}var r=VSPlayerHlsModel.getPlayerStats();r.target_entry={level:t.level,height:t.height,width:t.width},VSPlayerHlsModel.targetLevel=r.target_entry,DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_STARTED,{data:r}),VSPlayerHlsModel.switchLevelFailTimer=setTimeout((function(){VSPlayerHlsModel.onSwitchLevelFailed(VSPlayerHlsModel.targetLevel)}),5e3),VSPlayerHlsModel.hls.once(Hls.Events.LEVEL_LOADED,VSPlayerHlsModel.onLevelLoaded)},onLevelLoaded:function(e,t){Debug.print("VSPlayerHlsModel.onLevelLoaded()"),VSPlayerHlsModel.targetLevel&&(-1==VSPlayerHlsModel.targetLevel.level||VSPlayerHlsModel.targetLevel.level==t.level?VSPlayerHlsModel.onSwitchLevelSuccess():VSPlayerHlsModel.onSwitchLevelFailed(VSPlayerHlsModel.targetLevel),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_LOADED,{}))},mapSortLevels:function(e){var t=e.map((function(e){var t=VSPlayerHlsModel.getVideoResolution(e.width,e.height);return{height:e.height,width:e.width,bitrate:e.bitrate,resolution:t,resolutionString:t+"p"}}));return t.sort((function(e,t){return e.resolution-t.resolution})),t},onSwitchLevelSuccess:function(e,t){Debug.print("VSPlayerHlsModel.onSwitchLevelSuccess()"),VSPlayerHlsModel.clearSwitchLevelTimer()},clearSwitchLevelTimer:function(){clearTimeout(VSPlayerHlsModel.switchLevelFailTimer),VSPlayerHlsModel.switchLevelFailTimer=null,VSPlayerHlsModel.targetLevel=null},onSwitchLevelFailed:function(e){Debug.print("VSPlayerHlsModel.onSwitchLevelFailed()");var t=VSPlayerHlsModel.getPlayerStats();t.sourcePlayer="hls.js",t.target_entry=e,DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_FAILED,t),VSPlayerHlsModel.clearSwitchLevelTimer()},resetComponent:function(){Debug.print("VSPlayerHlsModel.resetComponent()"),this.cdnAttempts=0,this.networkUrl=""}},VSPlayerLLHlsModel={name:"llhls",cdnAttempts:0,maxCdnAttempts:3,initialized:!1,networkUrl:"",isBrowserSupported:null,mediaErrorCodes:{1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},preInitConfig:init:function(){Debug.print("VSPlayerLLHlsModelModel.init()"),this.createVidEl(),this.initialized=!0,this.isDesktop="computer"===VSPlayerController.config.envVars.USER.platform_type,this.browserName=VSPlayerController.config.envVars.UAParser.browser.name.toLowerCase(),this.deviceOS=VSPlayerController.config.envVars.UAParser.os.name.toLowerCase(),this.onVideoResolutionChange=this.onVideoResolutionChange.bind(this)},useNativeHLS:function(){return"undefined"==typeof Hls||!Hls.isSupported()},createVidEl:function(){Debug.print("VSPlayerLLHlsModel.createVidEl()"),this.videoEl=DOM.getElementById("hls-video"),this.videoEl||(this.videoEl=document.createElement("video"),this.videoEl.setAttribute("id","hls-video"),DOM.getElementById("hlsVideoContainer").appendChild(this.videoEl),this.enableControls?this.videoEl.setAttribute("controls","controls"):this.videoEl.removeAttribute("controls"),this.videoEl.setAttribute("autoplay","autoplay"),this.videoEl.setAttribute("playsinline","playsinline"),this.videoEl.setAttribute("webkit-playsinline","webkit-playsinline"))},verifyBrowserSupport:function(e){return Debug.print("VSPlayerLLHlsModel.verifyBrowserSupport()"),null!==this.isBrowserSupported?this.isBrowserSupported:(this.isBrowserSupported=!0,!0)},show:function(e,t,r,i,n){Debug.print("VSPlayerLLHlsModel.show()"),this.showConfig=n||{},this.streamSettings=window.__isUsingSingleVariantLLHLS__&&Array.isArray(n.streamSettings)&&n.streamSettings.every((function(e){return e.hasOwnProperty("height")}))&&n.streamSettings||null;var o=[],a=this;Array.isArray(this.streamSettings)&&(o=a.streamSettings.map((function(e){var t=a.getVideoResolution(e.width,e.height);return a.resolutionsToExclude().indexOf(t)>=0?e.height:-1})).filter((),this.streamSettings=this.streamSettings.filter((function(e){var t=a.getVideoResolution(e.width,e.height);return-1===a.resolutionsToExclude().indexOf(t)}))),this.abrPreference=window.localStorage.getItem("vsABRpref")||"720p",this.streamSettings&&(this.abrPreference=this.storedAbrPreference||"720p"),VSPlayerController.config.envVars.USER.isInternal&&(this.abrPreference=this.storedAbrPreference||"auto");var s=this.streamSettings&&this.streamSettings.find((function(e){var t=window.parseInt(a.abrPreference),r=a.getVideoResolution(e.width,e.height);return!isNaN(r)&&!isNaN(t)&&t===r})),l=[];s?l.push("variant="+s.height):this.abrPreference="auto",o.length>0&&l.push("exclude-variants="+o.join(",")),l.push("smart-age=true");var c=this.buildStreamUrl(e,i,l);if(c)if(Debug.print("VSPlayerLLHlsModel: showing LL-hls player with "+c),t.muteAudio||r?this.videoEl.muted=!0:this.videoEl.muted=!1,this.addPlayerAgnosticEvListeners(),this.useNativeHLS()){var d=[];Array.isArray(this.streamSettings)&&(d=VSPlayerLLHlsModel.mapSortLevels(this.streamSettings)),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.LLHLS_LEVELS_AVAILABLE,{sortedLevels:d,hasAuto:window.__isUsingMultiVariantLLHLS__}),VSPlayerLLHlsModel.videoEl.style.display="inline",this.addNativeHlsEventListeners(),this.videoEl.removeAttribute("src"),this.videoEl.load(),setTimeout((function(){VSPlayerLLHlsModel.videoEl.setAttribute("src",c),VSPlayerLLHlsModel.videoEl.load(),"autoplay"===VSPlayerLLHlsModel.videoEl.getAttribute("autoplay")?VSPlayerLLHlsModel.callPlay():VSPlayerLLHlsModel.videoEl.pause(),VSPlayerLLHlsModel.hlsType="hls-native"}),10)}else{this.hls&&this.hls.detachMedia();var u={backBufferLength:18,maxBufferLength:12,startFragPrefetch:!0,testBandwidth:!1,maxLoadingDelay:2,playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:3,retryDelayMs:1e3,maxRetryDelayMs:8e3}}}};u.playlistLoadPolicy.default.errorRetry.shouldRetry=function(e,t,r,i,n){return n||t<e.maxNumRetry},u.fragLoadPolicy={default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},u.fragLoadPolicy.default.errorRetry.shouldRetry=function(e,t,r,i,n){return n||t<e.maxNumRetry},-1!==document.location.href.indexOf("/dev.")&&(u.debug=!0),this.hls=new Hls(u),this.assignPlayerInstanceEvListeners(this.hls,c,this.streamSettings),this.hls.attachMedia(this.videoEl),this.hlsType="hls-js"}else Debug.print("VSPlayerLLHlsModel.show(): could NOT define stream url")},hide:function(){window.__HLSPlayerGlobalSizeFactor=null,Debug.print("VSPlayerLLHlsModel.hide()"),VSPlayerLLHlsModel.unsubscribeFromTimeUpdateEv(),VSPlayerLLHlsModel.clearSwitchLevelTimer(),VSPlayerLLHlsModel.clearPlaybackInterruptedTimer(),this.removePlayerAgnosticEvListeners(),this.useNativeHLS()?(this.removeNativeHlsEventListeners(),this.videoEl.removeAttribute("src"),this.videoEl.load()):this.hls&&(this.hls.destroy(),this.hls=null)},setABRPreference:function(e){if(this.abrPreference=e,this.storedAbrPreference=this.abrPreference,this.hls){var t=this.mapQualityToLevelIndex(this.abrPreference);this.hls.loadLevel=t}},mapQualityToLevelIndex:function(e){return"auto"===e?-1:function(){var t=parseInt(e),r=this.hls.levels.findIndex(();return r<0?this.hls.levels.length-1:r}.bind(this)()},addPlayerAgnosticEvListeners:function(){Debug.print("VSPlayerLLHlsModel.addPlayerAgnosticEvListeners()"),this.removePlayerAgnosticEvListeners(),DOM.addEventListener(this.videoEl,"playing",this.onVideoPlaying),DOM.addEventListener(this.videoEl,"pause",this.onVideoPaused),DOM.addEventListener(this.videoEl,"volumechange",this.onVolumeChange),DOM.addEventListener(this.videoEl,"loadstart",this.onVideoLoading),DOM.addEventListener(this.videoEl,"loadedmetadata",this.onVideoMetadata),DOM.addEventListener(this.videoEl,"canplaythrough",this.onVideoCanPlaythrough),DOM.addEventListener(this.videoEl,"resize",this.onVideoResolutionChange)},removePlayerAgnosticEvListeners:function(){Debug.print("VSPlayerLLHlsModel.removePlayerAgnosticEvListeners()"),DOM.removeEventListener(this.videoEl,"playing",this.onVideoPlaying),DOM.removeEventListener(this.videoEl,"pause",this.onVideoPaused),DOM.removeEventListener(this.videoEl,"volumechange",this.onVolumeChange),DOM.removeEventListener(this.videoEl,"loadstart",this.onVideoLoading),DOM.removeEventListener(this.videoEl,"loadedmetadata",this.onVideoMetadata),DOM.removeEventListener(this.videoEl,"canplaythrough",this.onVideoCanPlaythrough),DOM.removeEventListener(this.videoEl,"resize",this.onVideoResolutionChange)},removeNativeHlsEventListeners:function(){Debug.print("VSPlayerLLHlsModel.removeNativeHlsEventListeners()"),DOM.removeEventListener(this.videoEl,"error",this.onPlayerError),DOM.removeEventListener(this.videoEl,"waiting",this.onPlayerWaiting),DOM.removeEventListener(this.videoEl,"stalled",this.onPlayerStalled)},addNativeHlsEventListeners:function(){Debug.print("VSPlayerLLHlsModel.addNativeHlsEventListeners()"),this.removeNativeHlsEventListeners(),DOM.addEventListener(this.videoEl,"error",this.onPlayerError),DOM.addEventListener(this.videoEl,"waiting",this.onPlayerWaiting),DOM.addEventListener(this.videoEl,"stalled",this.onPlayerStalled)},assignPlayerInstanceEvListeners:function(e,t,r){Debug.print("VSPlayerLLHlsModel.assignPlayerInstanceEvListeners()"),e.on(Hls.Events.MEDIA_ATTACHED,(function(){Debug.print("VSPlayerLLHlsModel: Hls.Events.MEDIA_ATTACHED"),VSPlayerLLHlsModel.hls.loadSource(t),e.on(Hls.Events.MANIFEST_PARSED,(function(e,t){"autoplay"===VSPlayerLLHlsModel.videoEl.getAttribute("autoplay")?VSPlayerLLHlsModel.callPlay():VSPlayerLLHlsModel.videoEl.pause();var i=[];Array.isArray(r)&&(i=VSPlayerLLHlsModel.mapSortLevels(r)),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.LLHLS_LEVELS_AVAILABLE,{sortedLevels:i,hasAuto:window.__isUsingMultiVariantLLHLS__})})),e.on(Hls.Events.LEVEL_SWITCHING,VSPlayerLLHlsModel.onSwitchStreamInit)})),e.on(Hls.Events.ERROR,(function(e,t){Debug.print("VSPlayerLLHlsModel: Hls.Events.ERROR");try{Debug.print(JSON.stringify(t))}catch(e){}VSPlayerController.config.envVars.USER.isInternal&&console.log(t),t.details===Hls.ErrorDetails.BUFFER_STALLED_ERROR&&(DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.BUFFER_START,{buffer_length:t.buffer,abr_profile:VSPlayerLLHlsModel.videoEl.videoHeight}),t.fatal||VSPlayerLLHlsModel.videoEl.addEventListener("timeupdate",VSPlayerLLHlsModel.onPlayerTimeUpdate,{once:!0})),t.fatal?VSPlayerLLHlsModel.onPlayerError({type:t.type,details:t.details,fatal:t.fatal}):DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.ON_ERROR,{player:"hls.js",protocol:"llhls",payload:t})}))},buildStreamUrl:function(e,t,r){Debug.print("VSPlayerLLHlsModel.buildStreamUrl("+t+")");var i=e.url,n=i.split("?"),o=n[0],a=n[1],s=a.split("&").map(();return Array.isArray(r)&&(s=s.concat(r)),i=o+"?"+(a=s.join("&")),Debug.print("VSPlayerLLHlsModel.buildStreamUrl(): "+i),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.STREAM_URL_BUILT,{streamUrl:i}),i},onPlayerStalled:function(){Debug.print("VSPlayer.onPlayerStalled()"),VSPlayerLLHlsModel.startPlaybackInterruptedTimer()},onPlayerError:function(e){Debug.print("VSPlayerLLHlsModel.onPlayerError()"),VSPlayerLLHlsModel.clearPlaybackInterruptedTimer();var t={};if(e.target&&e.target.error){var r=e.target,i=VSPlayerLLHlsModel.mediaErrorCodes[r.error.code]||"unknown error code";switch(t={type:i,details:i},r.error.code){case r.error.MEDIA_ERR_NETWORK:case r.error.MEDIA_ERR_DECODE:case r.error.MEDIA_ERR_SRC_NOT_SUPPORTED:t.fatal=!0}}else e.type&&e.details&&(t=e);t.fatal&&DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_ERROR,{playerOwnCode:!0,details:t,player_stats:VSPlayerLLHlsModel.getPlayerStats()})},onVideoPlaying:function(){VSPlayerLLHlsModel.cdnAttempts=0,DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_PLAYING)},onVideoLoading:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_LOADING)},onVideoMetadata:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_METADATA)},onVideoCanPlaythrough:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_CANPLAYTHROUGH)},onVideoResolutionChange:function(){Debug.print("VSPlayerLLHlsModel.onVideoResolutionChange()");var e=VSPlayerLLHlsModel.videoEl.videoWidth,t=VSPlayerLLHlsModel.videoEl.videoHeight;if(0!=e||0!=t){var r=VSPlayerLLHlsModel;!Array.isArray(r.streamSettings)&&(!this.hls||this.hls.autoLevelEnabled),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_SUCCEEDED,{abr_profile:VSPlayerLLHlsModel.getVideoResolution(e,t,!0),auto:"auto"===this.abrPreference})}},onPlayerWaiting:function(e){Debug.print("VSPlayerLLHlsModel.onPlayerWaiting()"),VSPlayerLLHlsModel.startPlaybackInterruptedTimer(),VSPlayerLLHlsModel.videoEl.addEventListener("timeupdate",VSPlayerLLHlsModel.onPlayerTimeUpdate,{once:!0}),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.BUFFER_START,{abr_profile:VSPlayerLLHlsModel.videoEl.videoHeight})},startPlaybackInterruptedTimer:function(){Debug.print("VSPlayerLLHlsModel.startPlaybackInterruptedTimer()"),VSPlayerLLHlsModel.vidLoadedIntentionally=!1,VSPlayerLLHlsModel.timeUpdateSincePlayInterrupted||(VSPlayerLLHlsModel.timeUpdateSincePlayInterrupted=,VSPlayerLLHlsModel.videoEl.removeEventListener("timeupdate",VSPlayerLLHlsModel.timeUpdateSincePlayInterrupted),VSPlayerLLHlsModel.videoEl.addEventListener("timeupdate",VSPlayerLLHlsModel.timeUpdateSincePlayInterrupted,{once:!0}),null!==VSPlayerLLHlsModel.handlePlaybackInterrupted&&(Debug.print("VSPlayerLLHlsModel.startPlaybackInterruptedTimer(): timer not cleared, clearing first"),VSPlayerLLHlsModel.clearPlaybackInterruptedTimer()),VSPlayerLLHlsModel.handlePlaybackInterrupted=window.setTimeout(VSPlayerLLHlsModel.handlePlaybackInterruptedTimer,5500)},clearPlaybackInterruptedTimer:function(){Debug.print("VSPlayerLLHlsModel.clearPlaybackInterruptedTimer()"),window.clearTimeout(VSPlayerLLHlsModel.handlePlaybackInterrupted),VSPlayerLLHlsModel.handlePlaybackInterrupted=null},handlePlaybackInterruptedTimer:function(){Debug.print("VSPlayerLLHlsModel.handlePlaybackInterruptedTimer()"),VSPlayerLLHlsModel.videoEl.load(),VSPlayerLLHlsModel.vidLoadedIntentionally=!0,VSPlayerLLHlsModel.callPlay()},unsubscribeFromTimeUpdateEv:function(){Debug.print("VSPlayerLLHlsModel.unsubscribeFromTimeUpdateEv()"),VSPlayerLLHlsModel.videoEl&&VSPlayerLLHlsModel.videoEl.removeEventListener("timeupdate",VSPlayerLLHlsModel.onPlayerTimeUpdate)},onPlayerTimeUpdate:function(e){Debug.print("VSPlayerLLHlsModel.onPlayerTimeUpdate(): "+JSON.stringify(e)),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.BUFFER_STOP,{abr_profile:VSPlayerLLHlsModel.videoEl.videoHeight})},onVideoPaused:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_PAUSED)},onVolumeChange:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VID_VOLUME_CHANGED,{isMuted:this.muted})},setVolume:function(e){e.muteAudio?this.videoEl.muted=!0:this.videoEl.muted=!1,e.volLevel&&(this.videoEl.volume=e.volLevel)},callPlay:function(){if(Debug.print("VSPlayerLLHlsModel.callPlay()"),this.videoEl){var e=this.videoEl.play();void 0!==e&&e.then(().catch(function(e){if(VSPlayerLLHlsModel.vidLoadedIntentionally)return VSPlayerLLHlsModel.vidLoadedIntentionally=!1,void Debug.print("VSPlayerLLHlsModel","callPlay","intentionally failed");Debug.print("VSPlayerLLHlsModel","callPlay","failed "+e);var t={player:this.useNativeHLS()?"native hls":"hls.js"};DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.AUTOPLAY_FAILED,t)}.bind(this))}},callPause:updateAutoplay:function(e){Debug.print("VSPlayerLLHlsModel.updateAutoplay("+e+")"),e?this.videoEl.setAttribute("autoplay","autoplay"):this.videoEl.removeAttribute("autoplay")},enterNativeFullscreen:function(e){if(Debug.print("VSPlayerLLHlsModel.enterNativeFullscreen()"),void 0!==this.videoEl.requestFullscreen&&"function"==typeof this.videoEl.requestFullscreen)this.videoEl.requestFullscreen();else if(e){var t=e+"RequestFullScreen";this.videoEl[t]()}},exitNativeFullScreen:function(e){if(document.fullscreen||document.webkitIsFullScreen||document.mozFullScreen)if(void 0!==document.exitFullscreen&&"function"==typeof document.exitFullscreen)document.exitFullscreen();else if("moz"===e)document.mozCancelFullScreen();else{if(e)document[e+"ExitFullscreen"]()}},getPlayerStats:function(){if(!this.useNativeHLS()){if(VSPlayerLLHlsModel.hls){var e=[];return VSPlayerLLHlsModel.hls.levels&&VSPlayerLLHlsModel.hls.levels.forEach((function(t){var r={};r.attrs=t.attrs,r.audioCodec=t.audioCodec,r.bitrate=t.bitrate,r.height=t.height,r.width=t.width,r.name=t.name,r.unknownCodecs=t.unknownCodecs,r.level=t.level,r.videoCodec=t.videoCodec,r.fragmentError=t.fragmentError,r.loadError=t.loadError,e.push(r)})),{player_type:"hls.js (LL-HLS)",bandwidthEstimate:VSPlayerLLHlsModel.hls.bandwidthEstimate,abr_levels:e,current_level:VSPlayerLLHlsModel.hls.currentLevel,auto_level_enabled:VSPlayerLLHlsModel.hls.autoLevelEnabled,networkUrl:VSPlayerLLHlsModel.networkUrl}}return{player_type:"hls.js (LL-HLS)",oops:"somehow VSPlayerLLHlsModel.hls is False"}}try{return{player_type:"native hls (LL-HLS)",current_time:VSPlayerLLHlsModel.videoEl.currentTime,buffered_start:VSPlayerLLHlsModel.videoEl.buffered&&VSPlayerLLHlsModel.videoEl.buffered.length>0&&VSPlayerLLHlsModel.videoEl.buffered.start(0)||"n/a",buffered_end:VSPlayerLLHlsModel.videoEl.buffered&&VSPlayerLLHlsModel.videoEl.buffered.length>0&&VSPlayerLLHlsModel.videoEl.buffered.end(0)||"n/a"}}catch(e){return{error:"encountered error on Native LL-HLS trying to gather stats."}}},onSwitchStreamInit:function(e,t){try{Debug.print("VSPlayerLLHlsModel.onSwitchStreamInit("+JSON.stringify(t)+")")}catch(e){Debug.print('VSPlayerLLHlsModel.onSwitchStreamInit("circular reference")')}var r=VSPlayerLLHlsModel.getPlayerStats(),i={level:t.level,height:t.height,width:t.width};r.target_entry=i,VSPlayerLLHlsModel.targetLevel=i,DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_STARTED,{data:r}),VSPlayerLLHlsModel.switchLevelFailTimer=setTimeout((,5e3),VSPlayerLLHlsModel.hls.once(Hls.Events.LEVEL_LOADED,VSPlayerLLHlsModel.onLevelLoaded)},onLevelLoaded:function(e,t){Debug.print("VSPlayerLLHlsModel.onLevelLoaded()"),VSPlayerLLHlsModel.targetLevel&&(-1==VSPlayerLLHlsModel.targetLevel.level||VSPlayerLLHlsModel.targetLevel.level==t.level?VSPlayerLLHlsModel.onSwitchLevelSuccess():VSPlayerLLHlsModel.onSwitchLevelFailed(VSPlayerLLHlsModel.targetLevel),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_LOADED,{}))},mapSortLevels:function(e){var t=e.map((function(e){var t=VSPlayerLLHlsModel.getVideoResolution(e.width,e.height);return{height:e.height,width:e.width,bitrate:e.bitrate,resolution:t,resolutionString:t+"p"}}));return t.sort((),t},onSwitchLevelSuccess:clearSwitchLevelTimer:onSwitchLevelFailed:function(e){Debug.print("VSPlayerLLHlsModel.onSwitchLevelFailed()");var t=VSPlayerLLHlsModel.getPlayerStats();t.sourcePlayer="llhls.js",t.target_entry=e,DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_FAILED,t),VSPlayerLLHlsModel.clearSwitchLevelTimer()},resetComponent:function(){Debug.print("VSPlayerLLHlsModel.resetComponent()"),this.cdnAttempts=0,this.networkUrl="",this.storedAbrPreference=null}},VSPlayerLoggerModel={logDataBQ:function(e,t){return Debug.print("VSPlayerLogger.logData()"),new Promise(()},report:function(e){return Debug.print("VSPlayerLogger.report to "+e),new Promise((function(t,r){Ajax.fetch(e,{},5e3).then((function(e){return e.text()})).then((function(e){return t(e)})).catch(()}))},trackVideoLoadTime:,VSPlayerModel={getCdnProviders:function(e){return Debug.print("VSPlayerModel.getCdnProviders()"),new Promise((function(t,r){Ajax.fetch(e,{},1e4).then(().then((function(e){e=e.data,Object.keys(e.hls).length>0||Object.keys(e.llhls).length>0?t(e):r(new Error("Video providers were returned and parseable but there were "+Object.keys(e.hls).length+"hls providers, and "+Object.keys(e.llhls).length+"llhls providers."))})).catch((function(e){Debug.print("VideoModel","","Error fetching cdn providers: "+e),r(e)}))}))},getVideoSettings:function(){Debug.print("VSPlayerModel.setVideoSettings()");var e=Cookie.get("uvp")||null;return Debug.print("VSPlayerModel.userVideoPrefs: "+JSON.stringify(e)),e},setVideoSettings:function(e){Debug.print("VSPlayerModel.setVideoSettings("+JSON.stringify(e)+")");var t={};for(var r in e)"playersPriority"!==r&&(t[r]=e[r]);Cookie.set("uvp",t,2592e6)},setPreferredPlayer:function(e){Cookie.deleteCookie("preferredVidPlayer01","/live"),Cookie.set("preferredVidPlayer01",e,2592e6,"/")},getPreferredPlayer:function(e){return Cookie.get("preferredVidPlayer01")},generateBackUpPlayerCookieName:deleteBackUpPlayerCookie:function(e){var t=this.generateBackUpPlayerCookieName(e);Cookie.deleteCookie(t,"/")},setBackUpPlayerCookie:function(e,t){var r=this.generateBackUpPlayerCookieName(e);Cookie.deleteCookie(r,"/live"),Cookie.set(r,t,9e5,"/")},getBackUpPlayerCookie:,VSPlayerWebRTCModel={name:"webrtc",cdnAttempts:0,maxCdnAttempts:3,initialized:!1,networkUrl:"",isBrowserSupported:null,enableAutoABR:!0,init:function(){this.onPlayerError=this.onPlayerError.bind(this),this.initMonitor=this.initMonitor.bind(this),this.disableMonitor=this.disableMonitor.bind(this),this.resetMonitor=this.resetMonitor.bind(this),this.createVidEl(),this.initialized=!0},updateAutoplay:function(e){Debug.print("VSPlayerWebRTCModel.updateAutoplay("+e+")"),e?this.videoEl.setAttribute("autoplay","autoplay"):this.videoEl.removeAttribute("autoplay")},callPlay:function(){this.videoEl&&window.setTimeout(function(){var e=this.videoEl.play();void 0!==e&&e.then(function(){}.bind(this)).catch(function(e){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.AUTOPLAY_FAILED,{player:"webrtc"})}.bind(this))}.bind(this),0)},callPause:function(){this.videoEl&&this.videoEl.pause()},onPlayerError:function(e,t){var r;if(e.message)switch(e.message){case"stream_info_websocket_connection_error":r="Unable to establish websocket connection: not able to open ws to get Stream Information.";break;case"playback_websocket_connection_error":r="Unable to establish websocket connection: not able to open ws for Playback.";break;case"unable_to_create_peerConnection":r="Unable to create peer connection.";break;case"unable_to_create_offer":r="Unable to create offer.";break;case"set_description_error":r="Error setting local peer description.";break;case"set_remote_description_failed":r="Error setting remote peer description.";break;case"missing_sdp_answer":r="Unable to establish peer connection: Missing SDP.";break;case"stream_not_found":r="The stream is not found. Possibly incorrect connection data. If restarting this cam2cam session doesn't help, please contact customer support.";break;case"on_stop":r="The customer has ended their stream.";break;case"disconnected":case"closed":r="Connection has been interrupted, we are trying to recover it...";break;case"unparseable_stats_msg":break;case"empty_stream_info_meta":r="Thestreamisnotfound.Possiblyincorrectconnectiondata.Please try restarting this cam2cam session.";break;case"unparseable_webrtc_websocket_msg":this.playingBack||(r="Unable to parse server message and start playback.");break;default:r="NotReadableError"===e.name||"TrackStartError"===e.name||-1!==e.message.toLowerCase().indexOf("failed to allocate videosource")||-1!==e.message.toLowerCase().indexOf("concurrent mic process limit")?"Unable to allocate videosource: the camera/microphone may be in use in another process or program. Please close any programs that may be using your camera/microphone and click the cam2cam icon again.":(-1!==e.message.toLowerCase().indexOf("wsConnection.onerror")||e.message.toLowerCase().indexOf("server websocket connection fail"),e.message)}e.message&&("unparseable_stats_msg"==e.message||"unparseable_webrtc_websocket_msg"===e.message&&!VSPlayerWebRTCModel.playingBack)||DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_ERROR,{playerOwnCode:e.message,details:r,player_stats:VSPlayerWebRTCModel.getPlayerStats()})},setVolume:function(e){e.muteAudio?(this.videoEl.muted=!0,this.videoEl.setAttribute("muted","muted")):(this.videoEl.muted=!1,this.videoEl.removeAttribute("muted")),e.volLevel&&(this.videoEl.volume=e.volLevel)},startStreamSignalling:function(){this.streamSignalling=new StreamSignalling(this.signallingInfo.streamSignallingWsEndpoint),VSPlayerLoggerController.ceeBlueLog(this.signallingInfo.streamSignallingWsEndpoint+" connection initiated"),this.streamSignalling.addEventListener("onopen",function(){VSPlayerLoggerController.ceeBlueLog(this.signallingInfo.streamSignallingWsEndpoint+" opened"),this.streamSignalling.startStreamSignallingTimeout()}.bind(this)),this.streamSignalling.addEventListener("onavailabletrackschange",function(e){e=this.chooseOneVideoCodec(e),this.currentAvailableTracksRaw=e;var t=this.streamSignalling.parseForTracks(e);this.currentAvailableTracks=t,Debug.print("VSPlayerWebRTCModel","@@onavailabletrackschange",t),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.WEBRTC_AVAILABLE_TRACKS,{videoTracks:t.videoTracks,autoAvailable:VSPlayerWebRTCModel.enableAutoABR});var r=!!this.playbackSignalling,i=t.audioTracks.length>0&&t.videoTracks.length>0;if(!r&&i)this.streamSignalling.clearStreamSignallingTimeout(),this.startPlaybackSignalling();else if(r&&!i)return this.onPlayerError(new Error("empty_stream_info_meta"))}.bind(this)),this.streamSignalling.addEventListener("onerror",this.onPlayerError),this.streamSignalling.addEventListener("onavailableource=e}.bind(this)),this.streamSignalling.init()},startPlaybackSignalling:function(){this.playbackSignalling=new PlaybackSignalling(this.signallingInfo.playbackSignallingWsEndpoint),VSPlayerLoggerController.ceeBlueLog(this.signallingInfo.playbackSignallingWsEndpoint+" connection initiated"),this.playbackSignalling.addEventListener("onopen",function(){VSPlayerLoggerController.ceeBlueLog(this.signallingInfo.playbackSignallingWsEndpoint+" opened"),"auto"===this.abrPreference?(this.setABRPreference("auto"),this.setABRPreference(null,!0)):this.setABRPreference(this.abrPreference),this.startWebRtcConnectionManager()}.bind(this)),this.playbackSignalling.addEventListener("onanswer(e)}.bind(this)),this.playbackSignalling.addEventListener("onerror",this.onPlayerError),this.playbackSignalling.addEventListener("onselectedtrackchange",this.onSelectedTrackChange.bind(this)),this.playbackSignalling.init()},startWebRtcConnectionManager:function(){this.webRtcConnectionManager=new WebRtcConnectionManager,this.webRtcConnectionManager.addEventListener("onstream",this.onStream.bind(this)),this.webRtcConnectionManager.addEventListener("onoffersdprSDP(e)}.bind(this)),this.webRtcConnectionManager.addEventListener("onerror",this.onPlayerError),this.webRtcConnectionManager.init({videoEl:this.videoEl,msgSource:this.msgSource})},chooseOneVideoCodec:function(e){var t={};for(var r in e){var i=e[r],n="video"!=i.type,o="vp8"===i.codec.toLowerCase();(n||o)&&(t[r]=i)}return t},onSelectedTrackChange:function(e){var t,r,i={},n={};for(this.currentAvailableTracks.videoTracks.forEach((function(e){i[e.id]=e})),this.currentAvailableTracks.audioTracks.e.id]=e})),t=0;t<e.length;t++)if(r=e[t],i[r]){this.selectedVideoTrack=i[r];break}for(t=0;t<e.length;t++)if(r=e[t],n[r]){this.selectedAudioTrack=n[r];break}this.previousSelectedVideoTrack!=this.selectedVideoTrack&&this.onSwitchLevelSuccess(this.selectedVideoTrack.label,!!this.monitor),this.previousSelectedAudioTrack,this.selectedAudioTrack,this.monitor&&this.selectedVideoTrack&&this.monitor.setVideoTrackId(this.selectedVideoTrack.id),this.previousSelectedVideoTrack=this.selectedVideoTrack,this.previousSelectedAudioTrack=this.selectedAudioTrack},onStream:function(e){(VSPlayerLoggerController.ceeBlueLog("peer connection tracks: ",e),this.voyeurMuteOverride)&&e.getAudioTracks().forEach(function(t){e.removeTrack(t)}.bind(this));this.videoEl.srcObject=e,this.callPlay()},setPreferredCodecs:function(e){this.preferredCodecs={audio:this.currentAvailableTracks.audioTracks[0].id,video:this.currentAvailableTracks.videoTracks.reverse()[0].id},e&&(null!=e.video&&(this.preferredCodecs.video=e.video),null!=e.audio&&(this.preferredCodecs.audio=e.audio))},parseSignalingURL:function(e,t){var r=e,i=r.slice(0,r.indexOf("/webrtc")),n=r.slice(r.indexOf("+")),o=i+"/json_out"+n+".js",a=i+"/webrtc/out"+n;return t&&(o+="?id="+t,a+="?id="+t),{signalingUrl:e,streamId:n,access_token:t,wsHost:i,streamSignallingWsEndpoint:o,playbackSignallingWsEndpoint:a}},createVidEl:function(){if(!this.videoEl){this.videoEl=document.createElement("video"),this.videoEl.setAttribute("id","webrtc-video"),this.videoEl.setAttribute("playsinline","playsinline"),this.videoEl.setAttribute("muted","muted"),this.videoEl.setAttribute("autoplay","autoplay");var e=document.getElementById("webrtcVideoContainer");this.enableControls?this.videoEl.setAttribute("controls","controls"):this.videoEl.removeAttribute("controls"),e.appendChild(this.videoEl)}},verifyBrowserSupport:function(e){if(null!==this.isBrowserSupported)return this.isBrowserSupported;if("function"==typeof window.RTCPeerConnection){var t=e.browser.name.toLowerCase(),r=Number(e.browser.major),i="firefox"===t&&r<59,n="chrome"===t&&r<64,o=-1!==t.indexOf("edge")&&r<79,a="opera"===t&&r<51,s=(Array.isArray(window.__webrtcBrowserBlackList__)?window.__webrtcBrowserBlackList__:[]).some((function(e){return t===e[0]&&r===e[1]}));this.isBrowserSupported=!(i||n||o||a||s)}else this.isBrowserSupported=!1;return this.isBrowserSupported},show:function(e,t,r,i){this.voyeurMuteOverride=r||!1,t.muteAudio||this.voyeurMuteOverride?this.videoEl.muted=!0:this.videoEl.muted=!1,this.addPlayerAgnosticEvListeners(),VSPlayerWebRTCModel.enableAutoABR?this.abrPreference=window.localStorage.getItem("vsABRpref")||"auto":(this.abrPreference=window.localStorage.getItem("vsABRpref"),"auto"===this.abrPreference&&(this.abrPreference=null)),this.signallingInfo=this.parseSignalingURL(e.url,i),DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.STREAM_URL_BUILT,{streamUrl:this.signallingInfo.signalingUrl}),VSPlayerLoggerController.ceeBlueLog("access_key "+i),VSPlayerLoggerController.ceeBlueLog("stream websocket url "+this.signallingInfo.streamSignallingWsEndpoint),VSPlayerLoggerController.ceeBlueLog("playback websocket url "+this.signallingInfo.playbackSignallingWsEndpoint),this.startStreamSignalling()},hide:function(){this.removePlayerAgnosticEvListeners(),this.streamSignalling&&(this.streamSignalling.stop(),this.streamSignalling=null),this.playbackSignalling&&(this.playbackSignalling.stop(),this.playbackSignalling=null),this.webRtcConnectionManager&&(this.webRtcConnectionManager.stop(),this.webRtcConnectionManager=null);try{this.videoEl.srcObject=null}catch(e){this.videoEl.srcObject=""}this.playingBack=!1,this.stopMonitor()},startMonitor:function(){this.stopMonitor(),this.monitor=new WebRTCMonitorV2({videoEl:this.videoEl,getRacksRaw}.bind(this),requestTrack:function(e){var t=this.currentAvailableTracks.videoTracks===t.id}))[0];t&&this.setABRPreference(t.height,!0)}.bind(this)}),this.clearVideoElEventsForMonitor(),this.declareVideoElEventsForMonitor(),this.selectedVideoTrack&&(this.monitor.setVideoTrackId(this.selectedVideoTrack.id),this.initMonitor())},stoor=null},declareVideoElEventsForMonitor:function(){var e,t;for(t in e=["loadstart","play","playing"])this.videoEl.addEventListener(e[t],this.initMonitor);for(t in e=["loadeddata","pause","abort","emptied","ended"])this.videoEl.addEventListener(e[t],this.disableMonitor);for(t in e=["seeking","seeked","ratechange"])this.videoEl.addEventListener(e[t],this.resetMonitor)},clearVideoElEventsForMonitor:function(){var e,t;for(t in e=["loadstart","play","playing"])this.videoEl.removeEventListener(e[t],this.initMonitor);for(t in e=["loadeddata","pause","abort","emptied","ended"])this.videoEl.removeEventListener(e[t],this.disableMonitor);for(t in e=["seeking","seeked","ratechange"])this.videoEl.removeEventListener(e[t],this.resetMonitor)},initMonitor:function(){this.monitor&&this.monitor.init()},disableMonitor:function(){this.monitor&&this.monitor.destroy()},resereset()},setABRPreference:function(e,t){if("auto"===e)return this.startMonitor(),this.abrPreference="auto",void window.localStorage.setItem("vsABRpref",this.abrPreference);t||this.stopMonitor();var r=parseInt(e),i=null;if(this.currentAvailableTracks&&this.currentAvailableTracks.videoTracks)if(isNaN(r)){for(var n=null,o=0;o<this.currentAvailableTracks.videoTracks.length;o++){var a=this.currentAvailableTracks.videoTracks[o];(null==n||n.height>=a.height)&&(n=a)}n&&(i=n)}else i=this.currentAvailableTracks.videoTracksight==r}))[0];if(i){if(this.setPreferredCodecs({video:i.id}),this.playbackSignalling){var s=this.getPlayerStats();s.target_entry={quality:e},DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_STARTED,{data:s}),this.switchLevelFailTimer=window.semeout")}.bind(this),8e3),this.playbackSignalling.sendPreferredCodecs(this.preferredCodecs)}this.abrPreference=t?"auto":i.label,window.localStorage.setItem("vsABRpref",this.abrPreference)}},getPlaebrtc"}},resetComponent:function(){Debug.print("VSPlayerWebRTCModel.resetComponent()"),this.cdnAttempts=0,this.networkUrl=""},addPlayerAgnosticEvListeners:function(){Debug.print("VSPlayerWebRTCModel.addPlayerAgnosticEvListeners()"),this.removePlayerAgnosticEvListeners(),DOM.addEventListener(this.videoEl,"playing",this.onVideoPlaying),DOM.addEventListener(this.videoEl,"volumechange",this.onVolumeChange),DOM.addEventListener(this.videoEl,"pause",this.onVideoPaused),DOM.addEventListener(this.videoEl,"loadedmetadata",this.onVideoMetadata),DOM.addEventListener(this.videoEl,"canplaythrough",this.onVideoCanPlaythrough),DOM.addEventListener(this.videoEl,"loadstart",this.onVideoLoading)},onVideoPaused:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_PAUSED)},onVolumeChange:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VID_VOLUME_CHANGED,{isMuted:this.muted})},onVideoPlaying:function(){VSPlayerLoggerController.ceeBlueLog("playing."),VSPlayerWebRTCModel.cdnAttempts=0,VSPlayerWebRTCModel.playingBack=!0,DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_PLAYING)},onVideoLoading:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_LOADING)},onVideoMetadata:function(){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.VIDEO_METADATA)},onVideoCanPlaHROUGH)},removePlayerAgnosticEvListeners:function(){Debug.print("VSPlayerWebRTCModel.removePlayerAgnosticEvListeners()"),DOM.removeEventListener(this.videoEl,"playing",this.onVideoPlaying),DOM.removeEventListener(this.videoEl,"volumechange",this.onVolumeChange),DOM.removeEventListener(this.videoEl,"pause",this.onVideoPaused),DOM.removeEventListener(this.videoEl,"loadedmetadata",this.onVideoMetadata),DOM.removeEventListener(this.videoEl,"canplaythrough",this.onVideoCanPlaythrough),DOM.removeEventListener(this.videoEl,"loadstart",this.onVideoLoading)},enterNativeFullscreen:function(e){if(void 0!==this.videoEl.requestFullscreen&&"function"==typeof this.videoEl.requestFullscreen)this.videoEl.requestFullscreen();else if(e){var t=e+"RequestFullScreen";this.videoEl[t]()}},exitNativeFullScreen:function(e){if(document.fullscreen||document.webkitIsFullScreen||document.mozFullScreen)if(void 0!==document.exitFullscreen&&"function"==typeof document.exitFullscreen)document.exitFullscreen();else if("moz"===e)document.mozCancelFullScreen();else{if(e)document[e+"ExitFullscreen"]()}},onSwitchLevelSuccess:function(e,t){DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_SUCCEEDED,{abr_profile:e,auto:t}),this.clearSwitchLevelTimer()},clearSwitchLeel=null},onSwitchLevelFailed:function(e,t){var r=this.getPlayerStats();r.sourcePlayer=this.name,r.target_entry=e,r.cause=t||"",DOM.dispatchEvent(document,VSPLAYER_MODEL_EVENTS.SWITCH_STREAM_FAILED,r),this.clearSwitchLevelTimer()}};function decorateObserver(tch={})};e.prototype.addEventListener=function(e,r){t(this),Array.isArray(this.eventsToDispatch[e])?this.eventsToDispatch[e].push(r):this.eventsToDispatch[e]=[r]},e.prototype.removeEventListener=function(e,r){t(this),Array.isArray(this.eventsToDispatch[e])?this.eventsToDispatch[e]=this.eventsToDispatch[e]rn e!=r})):this.eventsToDispatch[e]=null},e.prototype.dispatchEvent=function(e,r){t(this),Array.isArray(this.eventsToDispatch[e])?this.eventsToDispatch[e].e){e(r)})):"function"==typeof this.eventsToDispatch[e]&&this.eventsToDispatch[e](r)}}function StreamSignalling(e){this.wsUrl=e}function WebRtcConnectionManager(){this.ignorePeerClosed=!1,this.offerConfig={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.eventLogs=[],this.maxEventwsUrl=e}function WebRTCMonitor(e){this.videoEl=e.videoEl,this.getRawTracks=e.getRawTracks,this.requestTrack=e.requestTrack,this.rand=100*Math.random()-1,this.delay=1,this.averagingSteps=20,this.vars={values:[],score:!1,active:!1},this.SCORE_UPDATE_EVENT="score_updated",this.PROTOCOL_CHANGE_EVENT="protocol_changed",this.MONITORING_WIDTH=8,this.QUALITY_SWITCH_UP_TIMEOUT=5,this.QUALITY_SWITCH_DOWN_TIMEOUT=5,this.QUALITY_SWITCH_CONNECTION_TIMEOUT=1,this.QUALITY_SWITCH_TIMEOUTS=[5,20,60,120,300,600],this.MIN_VALID_SCORE=.3,this.DEFAULT_PROTOCOL=["webrtc"],this.PROTOCOL_SWITCH_TIMEOUTS={webrtc:1},this.PROTOCOL_CHANGE_EVENT="protocol_name",this.qualitySwitchUpTimeout=0,this.qualitySwitchPreviousMode=null,this.qualitySwitchTimestamp=null,this.currentBitrateIndex=-1,this.SWITCH_MODE={UP:"UP",DOWN:"DOWN",INIT:"INIT"},this.trackIdListener=null}function WebRTCMonitorV2(e){this.videoEl=e.videoEl,this.getRawTracks=e.getRawTracks,this.requestTrack=e.requestTrack,this.rand=100*Math.random()-1,this.delay=1,this.averagingSteps=20,this.avgScore=1,this.vars={values:[],score:!1,scores:[1],active:!1},this.SCORE_UPDATE_EVENT="score_updated",this.PROTOCOL_CHANGE_EVENT="protocol_changed",this.MONITORING_WIDTH=8,this.QUALITY_SWITCH_UP_TIMEOUT=5,this.QUALITY_SWITCH_DOWN_TIMEOUT=5,this.QUALITY_SWITCH_CONNECTION_TIMEOUT=1,this.QUALITY_SWITCH_TIMEOUTS=[5,20,60,120,300,600],this.MIN_VALID_SCORE=.3,this.DEFAULT_PROTOCOL=["webrtc"],this.PROTOCOL_SWITCH_TIMEOUTS={webrtc:1},this.PROTOCOL_CHANGE_EVENT="protocol_name",this.qualitySwitchUpTimeout=0,this.qualitySwitchPreviousMode=null,this.qualitySwitchTimestamp=null,this.currentBitrateIndex=-1,this.count=0,this.networkConsistent=!1,this.SWITCH_MODE={UP:"UP",DOWN:"DOWN"},this.direction=this.SWITCH_MODE.UP,this.trackIdListener=null,this.runCount=0}decorateObserver(StreamSignalling),StreamSignalling.prototype.init=function(){try{this.ws=new WebSocket(this.wsUrl)}catch(e){return this.dispatchEvent("onerror",new Error("stream_info_websocket_connection_error"))}this.ws.onopen=this.onOpenHandler.bind(this),this.ws.onmessage=this.onMessageHandler.bind(this),this.ws.onerror=this.onErrorHandler.bind(this)},StreamSignalling.prototype.onOpenHandler=function(e){Debug.print("StreamSignalling","@@onOpenHandler","onopen"),this.dispatchEvent("onopen")},StreamSignalling.prototype.onMessageHandler=function(e){var t=null;Debug.print("StreamSignalling","@@onMessageHandler",e.data);try{t=JSON.parse(e.data)}catch(e){return this.dispatchEvent("onerror",new Error("unparseable_stats_msg"))}if(Array.isArray(t.source)&&(this.msgSource=t.source,this.dispatchEvent("onavailablesources",this.msgSource)),t.meta){var r=t.meta.tracks;this.dispatchEvent("onavailabletrackschange",r),VSPlayerLoggerController.ceeBlueLog("meta: ",t.meta)}else t.error&&VSPlayerLoggerController.ceeBlueLog("error: ",t.error)},StreamSignalling.prototype.onErrorHandler=function(e){Debug.print("StreamSignalling","@@onErrorHandler",e),this.dispatchEvent("onerror",e)},StreamSignalling.prototype.parseForTracks=function(e){var t=[],r=[];for(var i in e){var n=e[i];"video"===n.type?t.push({height:n.height,width:n.width,id:n.idx,codec:n.codec,label:n.height+"p",labelWithCodec:n.codec+": "+n.height+"p",caption:n.codec+": "+n.width+" x "+n.height+", bitrate: "+this.readableBitrate(8*n.bps)}):"audio"===n.type&&r.push({id:n.idx,codec:n.codec,label:n.codec,caption:n.codec+": "+n.channels+"ch "+n.rate+"Hz, , bitrate: "+this.readableBitrate(8*n.bps)})}return{videoTracks:t,audioTracks:r}},StreamSignalling.prototype.readableBitrate=function(e){if(0===e)return"";var t=Math.floor(Math.log(e)/Math.log(1e3));return 1*(e/Math.pow(1e3,t)).toFixed(1)+" "+["bps","kbps","mbps","gbps"][t]},StreamSignalling.prototype.startStreamSignallingTimeout=function(){this.signallingTimeout=window.setTimeout(function(){return Debug.print("StreamSignalling","@@startStreamSignallingTimeout","aborting"),this.dispatchEvent("onerror",new Error("stream_not_found"))}.bind(this),1e4)},StreamSignalling.prototype.clearStreamSignallingTimeout=function(){Debug.print("StreamSignalling","@@clearStreamSignallingTimeout","CLEAR"),window.clearTimeout(this.signallingTimeout),this.signallingTimeout=null},StreamSignalling.prototype.stop=function(){null!=this.ws&&(this.ws.onclose=null,this.ws.onmessage=null,this.ws.onerror=null,this.ws.close()),this.clearStreamSignallingTimeout()},decorateObserver(WebRtcConnectionManager),WebRtcConnectionManager.prototype.init=function(e){this.videoEl=e.videoEl;var t=null;e.msgSource&&(t={iceServers:[t=e.msgSource=e.typevers[0]}))[0]]});try{t?(this.peerConnection=new RTCPeerConnection(t),VSPlayerLoggerController.ceeBlueLog("peer connection started with config:",t)):this.peerConnection=new RTCPeerConnection}catch(e){return this.dispatchEvent("onerror",new Error("unable_to_create_peerConnection"))}this.peerConnection.oniceconnectionstatechange=this.onIceConnectionStateChangeHandler,this.peerConnection.ontrack=this.onTrackHandler.bind(this),this.peerConnection.addEventListener("negotiationion(e){})),this.createOffer()},WebRtcConnectionManager.prototype.onIceConnectionStateChangeHandler=function(e){switch(e.currentTarget.iceConnectionState){case"connected":case"completed":break;case"disconnected":case"failed":VSPlayerWebRTCModel.ignorePeerClosed||VSPlayerWebRTCModel.onPlayerError(new Error("disconnected ice"));break;case"closed":VSPlayerWebRTCModel.ignorePeerClosed?VSPlayerWebRTCModel.ignorePeerClosed=!1:VSPlayerWebRTCModel.onPlayerError(new Error("disconnected ice closed"))}},WebRtcConnectionManager.prototype.onTrackHandler=function(e){var t=e.streams[0];this.dispatchEvent("onstream",t)},WebRtcConnectionManager.prototype.createOffer=function(){VSPlayerLoggerController.ceeBlueLog("creating sdp offer: "),this.peerConnection.createOffer(this.offerConfig).then(this.onOfferCreatedHandler.bind(this)).catch(function(e){return this.dispatchEvent("onerror",new Error("unable_to_create_offer"))}.bind(this))},WebRtcConnectionManager.prototype.onOfferCreatedHandler=function(e){var t=e.sdp;this.peerConnection.setLocalDescription(e).then(function(e){this.dispatchEvent("onoffersdpcreated",t)}.bind(this)).catch(function(e){return this.dispatchEvent("onerror",new Error("set_description_error"))}.bind(this))},WebRtcConnectionManager.prototype.setSdpAnswer=function(e){var t=new RTCSessionDescription({type:"answer",sdp:e});this.peerConnection.setRemoteDescription(ccess")})).catch(function(t){return this.dispatchEvent("onerror",new Error("set_remote_description_failed"),e)}.bind(this))},WebRtcConnectionManager.prototype.setUpGetStatsInterval=function(){window.setInterval(function(){this.peerConnection.getStats(null).then((function(e){var t=[];e.forEach((function(e){t.push(e)}));var r={},i=t=e.type}))eturn!0}));for(var n in i.length,i){var o=i[n];r.sessionId=o.id,r.timestamp=o.timestamp,r.availableOutgoingBitrate=o.availableOutgoingBitrate,r.currentRoundTripTime=o.currentRoundTripTime,r.totalRoundTripTime=o.totalRoundTripTime,r.requestsReceived=o.requestsReceived,r.requestsSent=o.requestsSent,r.responsesReceived=o.responsesReceived,r.responsesSent=o.responsesSent,r.bytesSent=o.bytesSent,r.bytesReceived=o.bytesReceived;break}var a=JSON.stringify(r,void 0,2);Debug.print("GetStats: "+a),document.querySelector(".native-webrtc .stats-box").innerHTML=a}))}.bind(this),1e3)},WebRtcConnectionManager.prototype.clearGetStatsal=null},WebRtcConnectionManager.prototype.stop=function(){null!=this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null,this.ignorePeerClosed=!1)},decorateObserver(PlaybackSignalling),PlaybackSignalling.prototype.init=function(){try{this.ws=new WebSocket(this.wsUrl)}catch(e){return this.dispatchEvent("onerror",new Error("playback_websocket_connection_error"))}this.ws.onopen=this.onOpenHandler.bind(this),this.ws.onmessage=this.onMessageHandler.bind(this),this.ws.onerror=this.onErrorHandler.bind(this),this.ws.onclose=this.onCloseHandler.bind(this)},PlaybackSignalling.prototype.onOpenopen")},PlaybackSignalling.prototype.onMessageHandler=function(e){var t=null;try{t=JSON.parse(e.data)}catch(e){return this.dispatchEvent("onerror",new Error("unparseable_webrtc_websocket_msg"))}switch(t.type){case"on_answer_sdp":t.answer_sdp?this.dispatchEvent("onanswersdp",t.answer_sdp):this.dispatchEvent("onerror",new Error("missing_sdp_answer"));break;default:break;case"on_time":this.checkForSelectedTrackChanges(t);break;case"on_stop":this.ignorePeerClosed=!0,this.dispatchEvent("onerror",new Error("on_stop"))}},PlaybackSignalling.prototype.checkForSelectedTrackChanges=function(e){if(this.currentTrack=Array.isArray(this.currentTrack)?this.currentTrack:[-1,-1],this.currentTrack.length!=e.tracks.length)return this.currentTrack=e.tracks,void this.dispatchEvent("onselectedtrackchange",e.tracks);for(var t=0;t<e.tracks.length;t++)if(this.currentTrack.indexOf(e.tracks[t])<0){this.currentTrack=e.tracks,this.dispatchEvent("onselectedtrackchange",e.tracks);break}},PlaybackSignalling.prototype.onErroror",e)},PlaybackSignalling.prototype.onCloseHandler=function(e){this.ignorePeerClosed||this.dispatchEvent("onerror",new Error("disconnected playback ws"))},PlaybackSignalling.prototype.sendPreferredCodecs=function(e){var t={type:"tracks",video:e.video,audio:e.audio};this.ws.send(JSON.stringify(t))},PlaybackSignalling.prototype.sendOfferSDP=function(e){this.ws.send(JSON.stringify({type:"offer_sdp",offer_sdp:e}))},PlaybackSignalling.prototype.stop=function(){null!=this.ws&&(this.ws.onclose=null,this.ws.onmessage=null,this.ws.onerror=null,this.ws.close()),this.ws=null},WebRTCMonitor.prototype.threshold=function(){return.95},WebRTCMonitor.prototype.init=function(){this.vars.active||(this.vars.active=!0,this.repeat())},WebRTCMonitor.prototype.setVideoTrackId=function(e){this.videoTrackId=e,delete this.tracklist},WebRTCMonitor.prototype.destroy=function(){this.vars.active&&(window.clearTimeout(this.timer),this.timer=null,this.vars.values=[],this.vars.active=!1)},WebRTCMonitor.prototype.reset=function(){this.vars.active?this.vars.values=[]:this.init()},WebRTCMonitor.prototype.calcScore=function(){var e=this.vars.values;if(e.push(this.getValue()),e.length<=1)return!1;var t=this.valueToScore(e[0],e[e.length-1]);return e.length>this.averagingSteps&&e.shift(),t=Math.max(t,e[e.length-1].score),this.score=t,t},WebRTCMonitor.prototype.valueToScore=function(e,t){var r;return r=this.videoEl.playbackRate,(t.video-e.video)/(t.clock-e.clock)/r},WebRTCMonitor.prototype.getValue=function(){var e={clock:.001*(new Date).getTime(),video:this.videoEl.currentTime};return this.vars.values.length&&(e.score=this.valueToScore(this.vars.values[this.vars.values.length-1],e)),e},WebRTCMonitor.prototype.check=function(){var e=this.vars.valuescore>=0}))clock")})).slice(Math.max(this.vars.values.length-this.MONITORING_WIDTH,0));if(0!==e.length){var t=e[e.length-1].clock-e[0].clock;console.log("monitor: "+t);var e.score})),i=Math.min.apply(null,r),n=r.reduce((function(e,t){return e+t}))/r.length;if(t>=this.QUALITY_SWITCH_UP_TIMEOUT&&i>.8&&n>=1){if(this.qualitySwitchPreviousMode!==this.SWITCH_MODE.DOWN)return console.log("Monitor: => UP"),this.result=this.SWITCH_MODE.UP,!0;var o=.001*(Date.now()-this.qualitySwitchTimestamp);if(console.log("monitor quality: ",this.qualitySwitchTimestamp,o),o>=this.qualitySwitchUpTimeout)return console.log("Monitor: => UP"),this.result=this.SWITCH_MODE.UP,!0}return(this.qualitySwitchPreviousMode===this.SWITCH_MODE.UP&&t>=this.QUALITY_SWITCH_CONNECTION_TIMEOUT&&t<this.QUALITY_SWITCH_DOWN_TIMEOUT&&(i<=.6||n<=.96)||t>=this.QUALITY_SWITCH_DOWN_TIMEOUT&&(n<=.92||i<=.6))&&(console.log("Monitor: => DOWN"),this.result=this.SWITCH_MODE.DOWN,!0)}},WebRTCMonitor.prototype.decreaseQualityTimeout=function(){var e=this.QUALITY_SWITCH_TIMEOUTS.indexOf(this.qualitySwitchUpTimeout);e>0&&(this.qualitySwitchUpTimeout=this.QUALITY_SWITCH_TIMEOUTS[e-1])},WebRTCMonitor.prototype.action=function(){if(!this.hasOwnProperty("tracklist")){var e,t=VSPlayerUtil.tracks.parse(this.getRawTracks()),r=[];if(t&&t.video){if(r=Object.values(t.video),void 0===this.videoTrackId)return void console.error("Monitor: Action track selection impossible because the vide track is not chosen");if((e=r.findIndex(function(e){return("idx"in e?e.idx:e.trackid)===this.videoTrackId}.bind(this)))>=0){var i=r[e].codec;r=r.filter((function(e){return e.codec===i}))}r=VSPlayerUtil.array.multiSort(r,[["bps",-1]])}this.tracklist=r,void 0!==this.videoTrackId&&(e=r.findIndex(function(e){return("idx"in e?e.idx:e.trackid)===this.videoTrackId}.bind(this)))>=0&&(this.currentBitrateIndex=e)}if(this.hasOwnProperty("result")){if(0===this.tracklist.length)return console.log("Monitor: Video tracks are absent!"),void(this.currentBitrateIndex=-1);if(1!==this.tracklist.length){var n=this.tracklist.length-1;-1===this.currentBitrateIndex&&(this.currentBitrateIndex=n),this.result===this.SWITCH_MODE.UP?n=Math.max(this.currentBitrateIndex-1,0):this.result===this.SWITCH_MODE.DOWN&&(n=Math.min(this.currentBitrateIndex+1,this.tracklist.length-1));var o=.001*(Date.now()-this.qualitySwitchTimestamp);if(n!==this.currentBitrateIndex){if(this.result===this.SWITCH_MODE.DOWN&&(this.qualitySwitchPreviousMode===this.SWITCH_MODE.DOWN&&o>=2*this.QUALITY_SWITCH_DOWN_TIMEOUT&&this.decreaseQualityTimeout(),this.qualitySwitchPreviousMode===this.SWITCH_MODE.UP&&o<=2*this.QUALITY_SWITCH_DOWN_TIMEOUT)){var a=this.QUALITY_SWITCH_TIMEOUTS.indexOf(this.qualitySwitchUpTimeout)+1;a<this.QUALITY_SWITCH_TIMEOUTS.length&&(this.qualitySwitchUpTimeout=this.QUALITY_SWITCH_TIMEOUTS[a])}this.currentBitrateIndex=n,this.qualitySwitchTimestamp=Date.now(),this.qualitySwitchPreviousMode=this.result;var s=this.tracklist[this.currentBitrateIndex],l={video:"idx"in s?s.idx:s.trackid};this.requestTrack(l),this.reset(),delete this.result}else this.qualitySwitchPreviousMode===this.SWITCH_MODE.UP&&o>this.qualitySwitchUpTimeout&&this.decreaseQualityTimeout()}else this.currentBitrateIndex=0}else console.log("Monitor: No result saved, this should not happen!")},WebRTCMonitor.prototype.repeat=function(){if(!this.vars.active)return!1;this.timer=window.setTimeout(function(){var e=this.calcScore();console.log("monitor: rand",this.rand),!1!==e&&this.check(e)&&this.action(),this.repeat()}.bind(this),1e3*this.delay)},WebRTCMonitor.prototype.switchToNextProtocol=function(){},WebRTCMonitorV2.prototype.tturn.95},WebRTCMonitorV2.prototpeat())},WebRTCMonitorV2.prototype.setVideoTrackId=function(e){this.videoTrackId=e,delete this.tracklist},WebRTCMonitorV2.prototype.destroy=function(){this.vars.active&&(window.clearTimeout(this.timer),this.timer=null,this.vars.values=[],this.vars.active=!1)},WebRTCMonitorV2.prototype.reset=function(){this.vars.active?(this.vars.values=[],this.vars.scores=[1],this.networkConsistent=!1,this.count=0,this.direction=this.SWITCH_MODE.UP):this.init()},WebRTCMonitorV2.prototype.calcScore=function(){var e=this.vars.values,t=this.getValue();if(e.push(t),e.length<=1)return!1;var r=this.vars.scores;return t.clock&&t.score&&t.score>=0&&r.push(t.score),r.length>this.averagingSteps&&r.shift(),e.length>this.averagingSteps&&e.shift(),!0},WebRTCMonitorV2.prototype.valueToScore=function(e,t){var r;return r=this.videoEl.playbackRate,(t.video-e.video)/(t.clock-e.clock)/r},WebRTCMonitorV2.prototype.getValue=function(){var e={clock:.001*(new Date).getTime(),video:this.videoEl.currentTime};return this.vars.values.length&&(e.score=this.valueToScore(this.vars.values[this.vars.values.length-1],e)),e},WebRTCMonitorV2.prototype.check=function(){var e=this.vars.values.slice(Math.max(this.vars.values.length-this.MONITORING_WIDTH,0)),t=this.vars.scores.slice(Math.max(this.vars.scores.length-this.MONITORING_WIDTH,0));if(!(t.length<=0)){var r=Math.min.apply(null,t),i=turn e+t}))/t.length,n=this.vars.scores[this.vars.score.length-1]-this.vars.scores[this.vars.scores.length-2],o=!1;if(this.vars.scores[this.vars.scores.length-1]>=.85*i&&(o=!0),(n>=0||o)&&this.direction===this.SWITCH_MODE.UP?this.count+=1:n<0&&this.direction===this.SWITCH_MODE.UP?(this.count=0,this.direction="DOWN"):(n>=0||o)&&this.direction===this.SWITCH_MODE.DOWN?(this.count=0,this.direction="UP"):n<0&&this.direction===this.SWITCH_MODE.DOWN&&(this.count+=1),this.count>=3)return this.networkConsistent=!0,!0;this.networkConsistent=!1;var a=e[e.length-1].clock-e[0].clock;if(a>=this.QUALITY_SWITCH_UP_TIMEOUT&&r>.8&&i>=1){if(this.qualitySwitchPreviousMode!==this.SWITCH_MODE.DOWN)return Debug.print("Monitor: => UP"),this.result=this.SWITCH_MODE.UP,!0;var s=.001*(Date.now()-this.qualitySwitchTimestamp);if(Debug.print("monitor quality: ",this.qualitySwitchTimestamp,s),s>=this.qualitySwitchUpTimeout)return Debug.print("Monitor: => UP"),this.result=this.SWITCH_MODE.UP,!0}return(this.qualitySwitchPreviousMode===this.SWITCH_MODE.UP&&a>=this.QUALITY_SWITCH_CONNECTION_TIMEOUT&&a<this.QUALITY_SWITCH_DOWN_TIMEOUT&&(r<=.6||i<=.9)||a>=this.QUALITY_SWITCH_DOWN_TIMEOUT&&(i<=.92||r<=.6))&&(Debug.print("Monitor: => DOWN"),this.result=this.SWITCH_MODE.DOWN,!0)}},WebRTCMonitorV2.prototype.decreaseQualityTimeout=function(){var e=this.QUALITY_SWITCH_TIMEOUTS.indexOf(this.qualitySwitchUpTimeout);e>0&&(this.qualitySwitchUpTimeout=this.QUALITY_SWITCH_TIMEOUTS[e-1])},WebRTCMonitorV2.prototype.action=function(){if(!this.hasOwnProperty("tracklist")){var e,t=VSPlayerUtil.tracks.parse(this.getRawTracks()),r=[];if(t&&t.video){if(r=Object.values(t.video),void 0===this.videoTrackId)return void console.error("Monitor: Action track selection impossible because the vide track is not chosen");if((e=r.findIndex(function(e){return("idx"in e?e.idx:e.trackid)===this.videoTrackId}.bind(this)))>=0){var i=r[e].codec;r=rdec===i}))}r=VSPlayerUtil.array.multiSort(r,[["bps",-1]])}this.tracklist=r,void 0!==this.videoTrackId&&(e=r.findIndex(function(e){return("idx"in e?e.idx:e.trackid)===this.videoTrackId}.bind(this)))>=0&&(this.currentBitrateIndex=e)}if(this.hasOwnProperty("result")){if(0===this.tracklist.length)return Debug.print("Monitor: Video tracks are absent!"),void(this.currentBitrateIndex=-1);if(1!==this.tracklist.length){var n=this.tracklist.length-1;-1===this.currentBitrateIndex&&(this.currentBitrateIndex=n),this.result===this.SWITCH_MODE.UP?n=Math.max(this.currentBitrateIndex-1,0):this.result===this.SWITCH_MODE.DOWN&&(n=Math.min(this.currentBitrateIndex+1,this.tracklist.length-1));var o=.001*(Date.now()-this.qualitySwitchTimestamp);if(n!==this.currentBitrateIndex){if(this.result===this.SWITCH_MODE.DOWN&&(this.qualitySwitchPreviousMode===this.SWITCH_MODE.DOWN&&o>=2*this.QUALITY_SWITCH_DOWN_TIMEOUT&&this.decreaseQualityTimeout(),this.qualitySwitchPreviousMode===this.SWITCH_MODE.UP&&o<=2*this.QUALITY_SWITCH_DOWN_TIMEOUT)){var a=this.QUALITY_SWITCH_TIMEOUTS.indexOf(this.qualitySwitchUpTimeout)+1;a<this.QUALITY_SWITCH_TIMEOUTS.length&&(this.qualitySwitchUpTimeout=this.QUALITY_SWITCH_TIMEOUTS[a])}this.currentBitrateIndex=n,this.qualitySwitchTimestamp=Date.now(),this.qualitySwitchPreviousMode=this.result;var s=this.tracklist[this.currentBitrateIndex],l={video:"idx"in s?s.idx:s.trackid};this.requestTrack(l),this.reset(),delete this.result}else this.qualitySwitchPreviousMode===this.SWITCH_MODE.UP&&o>this.qualitySwitchUpTimeout&&this.decreaseQualityTimeout()}else this.currentBitrateIndex=0}else Debug.print("Monitor: No result saved, this should not happen!")},WebRTCMonitorV2.prototype.repeat=function(){if(!this.vars.active)return!1;this.timer=window.setTimeout(function(){var e=this.calcScore();!1!==e&&this.check(e)&&(!0===this.networkConsistent&&("UP"===this.direction?this.result=this.SWITCH_MODE.UP:"DOWN"===this.direction&&(this.result=this.SWITCH_MODE.DOWN)),this.action()),this.repeat()}.bind(this),1e3*this.delay)},WebRTCMonitorV2.prototype.switchToNexttion(){};var VSPlayerUtil={array:{is:function(e){return"isArray"in Array?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},multiSort:function(e,t){var r=function(e,t){return isNaN(e)||isNaN(t)?e.localeCompare(t):Math.sign(e-t)};if(!t.length)return e.sort(r);function i(e,t){function r(e,t,r){if(!(t in e))throw"Invalid sorting rule: "+JSON.stringify([t,r])+'. "'+t+'" is not a key of '+JSON.stringify(e);if("number"==typeof r&&t in e)return e[t]*r;var i=r.indexOf(e[t]);return i>=0?i:r.length}if("function"==typeof e)return e(t);if("object"==typeof e){if(e instanceof Array)return r(t,e[0],e[1]);for(var i in e)return r(t,i,e[i])}if(e in t)return t[e];throw"Invalid sorting rule: "+e+". This should be a function, object or key of "+JSON.stringify(t)+"."}return e.sort((function(e,n){var o=0;for(var a in t){var s=t[a];if(0!=(o=r(i(s,e),i(s,n))))break}return o})),e}},object:{extend:function(e,t,r){for(var i in t)r&&"object"==typeof t[i]&&!("nodeType"in t[i])?(i in e||(VSPlayerUtil.array.is(t[i])?e[i]=[]:e[i]={}),this.extend(e[i],t[i],!0)):e[i]=t[i];return e},keys:function(e,t){var r=[];for(var i in e)r.push(i);return t&&("function"!=typepare(t)})],e[i])}))),r},values:function(e,t){var r=this.keys(e,t),i=[];for(var n in r)i.push(e[r[n]]);return i}},tracks:{parse:function(e){var t,r,i={};for(t in e){var n=VSPlayerUtil.object.extend({},e[t]);"meta"==n.type&&(n.type=n.codec,n.codec="meta"),n.type in i||(i[n.type]={}),i[n.type]["idx"in n?n.idx:n.trackid]=n;var o={};for(r in n)switch(r){case"width":o[r]=n.width+""+n.height;break;case"bps":if("meta"==n.codec)continue;var a;if(n.bps>0)a=n.bps>131072?Math.round(n.bps/1024/1024*8)+"mbps":Math.round(n.bps/1024*8)+"kbps",o[r]=a;break;case"fpks":n.fpks>0&&(o[r]=n.fpks/1e3+"fps");break;case"channels":n.channels>0&&(o[r]=1==n.channels?"Mono":2==n.channels?"Stereo":"Surround ("+n.channels+"ch)");break;case"rate":o[r]=Math.round(n.rate)+"Khz";break;case"language":"Undetermined"!=n[r]&&(o[r]=n[r]);break;case"codec":if("meta"==n.codec)continue;o[r]=n[r]}n.describe=o}for(var s in i){var l=!1;for(t in i[s])if(l){if(VSPlayerUtil.object.keys(i[s]).length>1)for(r in i[s][t].describe)l[r]!=i[s][t].describe[r]&&delete l[r]}else l=VSPlayerUtil.object.extend({},i[s][t].describe);for(t in i[s]){var c={},d={};for(r in i[s][t].describe)r in l?d[r]=i[s][t].describe[r]:c[r]=i[s][t].describe[r];i[s][t].different=c,i[s][t].same=d;var u=VSPlayerUtil.object.values(c);i[s][t].displayName=u.length?u.join(", "):VSPlayerUtil.object.values(i[s][t].describe).join(" ")}var h={};for(t in i[s]){if(i[s][t].displayName in h){var p=1;for(t in i[s])i[s][t].different.trackid=p+")",i[s][t].displayName="Track "+p+" ("+i[s][t].displayName+")",p++;break}h[i[s][t].displayName]=1}}return i}}},VSPlayerHlsView={playerName:"hls",configureAbrMenu:function(e,t){this.configured||(this.onMobileAbrMenuChange=this.onMobileAbrMenuChange.bind(this),this.configured=!0),VSPlayerView.configureCommonAbrMenu({qualityList:e,autoAvailable:t,playerName:this.playerName,handleMenuChange:this.onMobileAbrMenuChange})},showAbrMenu:function(){VSPlayerView.showCommonAbrMenu({playerName:this.playerName})},hideAbrMenu:function(){VSPlayerView.hideCommonAbrMenu({playerName:this.playerName})},enableAbrMenu:function(){VSPlayerView.enableCommonAbrMenu({playerName:this.playerName})},onMobileAbrMenuChange:function(){VSPlayerView.onMobileCommonAbrMenuChange({playerName:this.playerName})},updateCurrentAbrLabel:function(e,t){VSPlayerView.updateCurrentCommonAbrLabel({label:e,auto:t,playerName:this.playerName})},disableAbrMenu:function(e){VSPlayerView.disableCommonAbrMenu({playerName:this.playerName})}},VSPlayerLLHlsView={playerName:"llhls",configureAbrMenu:function(e,t){this.configured||(this.onMobileAbrMenuChange=this.onMobileAbrMenuChange.bind(this),this.configured=!0),VSPlayerView.configureCommonAbrMenu({qualityList:e,autoAvailable:t,playerName:this.playerName,handleMenuChange:this.onMobileAbrMenuChange})},showAbrMenu:function(){VSPlayerView.showCommonAbrMenu({playerName:this.playerName})},hideAbrMenu:function(){VSPlayerView.hideCommonAbrMenu({playerName:this.playerName})},enableAbrMenu:function(){VSPlayerView.enableCommonAbrMenu({playerName:this.playerName})},onMobileAbrMenuChange:function(){VSPlayerView.onMobileCommonAbrMenuChange({playerName:this.playerName})},updateCurrentAbrLabel:function(e,t){VSPlayerView.updateCurrentCommonAbrLabel({label:e,auto:t,playerName:this.playerName})},disableAbrMenu:function(e){VSPlayerView.disableCommonAbrMenu({playerName:this.playerName})}},VSPlayerView={initialized:!1,qualityLimit:4e3,init:function(){Debug.print("VSPlayerView.init()"),this.initialized||(this.playBtn=DOM.getElementById("playButton"),this.audioIcon=DOM.getElementById("videoVolume"),window.__isUsingMobileRehaul__&&(this.muteIcon=DOM.getElementById("muteVolumeButton")),this.extraUnmuteBtn=DOM.getElementById("extraUnmuteBtn"),this.bodyTag=DOM.getElementById("bodyTag"),DOM.addEventListener(this.playBtn,"click",this.onPlayBtnClicked),DOM.addEventListener(this.audioIcon,"click",this.onAudioIconClicked.bind(this)),this.muteIcon&&DOM.addEventListener(this.muteIcon,"click",this.onAudioIconClicked.bind(this)),this.extraUnmuteBtn&&DOM.addEventListener(this.extraUnmuteBtn,"click",this.onExtraUnmuteIconClicked.bind(this)),this.mobileAudioControl=DOM.querySelectorAll(".toggle-audio input")[0],this.mobileAudioControl&&DOM.addEventListener(this.mobileAudioControl,"click",this.onAudioIconClicked.bind(this)),this.audioSlider=DOM.getElementById("volumeSliderRange"),this.desktopMuteBtn=DOM.getElementById("audioIcon"),this.audioSlider&&(DOM.addEventListener(this.audioSlider,"change",this.adjustAudioVolume.bind(this)),DOM.addEventListener(this.audioSlider,"input",this.adjustAudioVolume.bind(this))),this.desktopMuteBtn&&DOM.addEventListener(this.desktopMuteBtn,"click",this.onAudioIconClicked.bind(this)),DOM.querySelectorAll(".players-container .inner-icons").forEach((function(e){e&&"refreshOption"!==e.id&&DOM.addEventListener(elayer(t)}))})),this.vidToggleContainer=DOM.getElementsByClassName("toggle-player")[0],this.vidToggleContainer&&(this.mobileVidPlayerBtnHls=DOM.getElementsByClassName("hls-toggle",this.vidToggleContainer)[0],this.mobileVidPlayerBtnLLHls=DOM.getElementsByClassName("llhls-toggle",this.vidToggleContainer)[0],DOM.addEventListener(this.mobileVidPlayerBtnHls,"click",(function(){VSPlayerView.mobileVidPlayerBtnHls.classList.contains("disabled")||VSPlayerView.mobileVidPlayerBtnHls.classList.contains("active")||(this.additionalData&&this.additionalData.msgToShow?VSPlayerView.onPlayerSelectionInterrupted(this.additionalData.msgToShow,this.additionalData.msgType):(VSPlayerView.updateMobileVidPlayerToggle("hls"),VSPlayerView.changeVideoPlayer("hls")))})),this.mobileVidPlayerBtnLLHls&&DOM.addEventListener(this.mobileVidPlayerBtnLLHls,"click",(function(){VSPlayerView.mobileVidPlayerBtnLLHls.classList.contains("disabled")||VSPlayerView.mobileVidPlayerBtnLLHls.classList.contains("active")||(this.additionalData&&this.additionalData.msgToShow?VSPlayerView.onPlayerSelectionInterrupted(this.additionalData.msgToShow,this.additionalData.msgType):(VSPlayerView.updateMobileVidPlayerToggle("llhls"),VSPlayerView.changeVideoPlayer("llhls")))})),this.mobileVidPlayerBtnWebrtc=DOM.getElementsByClassName("web-rtc-toggle",this.vidToggleContainer)[0],this.mobileVidPlayerBtnWebrtc&&DOM.addEventListener(this.mobileVidPlayerBtnWebrtc,"click",(function(){VSPlayerView.mobileVidPlayerBtnWebrtc.classList.contains("disabled")||VSPlayerView.mobileVidPlayerBtnWebrtc.classList.contains("active")||(this.additionalData&&this.additionalData.msgToShow?VSPlayerView.onPlayerSelectionInterrupted(this.additionalData.msgToShow,this.additionalData.msgType):(VSPlayerView.updateMobileVidPlayerToggle("webrtc"),VSPlayerView.changeVideoPlayer("webrtc")))}))),this.hlsCont=DOM.getElementById("hlsVideoContainer"),this.webrtcCont=DOM.getElementById("webrtcVideoContainer"),this.chatRoomContainerEl=DOM.getElementById("roomInterface"),this.voyeurToolTipMessageEl=DOM.getElementsByClassName("voyeur-tool-tip-message")[0],this.audioIconEl=DOM.getElementsByClassName("audio-icon")[0],this.audioSubMenuContainerEl=DOM.getElementById("audioSubMenuContainer"),this.loadingSymbol=DOM.getElementById("loadingVideo"),this.initialized=!0)},changeVideoPlayer:function(e){DOM.dispatchEvent(document,VSPLAYER_VIEW_EVENTS.VIDEO_PLAYER_SELECTED,{videoPlayer:e})},onPlayerSelectionInterrupted:function(e,t){DOM.dispatchEvent(document,VSPLAYER_VIEW_EVENTS.PLAYER_SELECTION_INTERRUPTED,{msg:e,msgType:t})},onAudioIconClicked:function(){var e;e=this.audioIcon.classList.contains("show")?"unmute":"mute",DOM.dispatchEvent(document,VSPLAYER_VIEW_EVENTS.AUDIO_ICON_CLICKED,e)},onExtraUnmuteIcunmute")},adjustAudioVolume:function(){Debug.print("VSPlayerView.adjustAudioVolume(): "+this.audioSlider.value);var e=parseInt(this.audioSlider.value,10);e=0!=e?e/100:0,DOM.dispatchEvent(document,VSPLAYER_VIEW_EVENTS.ADJUST_AUDIO_VOLUME,{volLevel:e})},onPlayBtnClicked:function(){VSPlayerView.hidePlayBtn(),DOM.dispatchEvent(document,VSPLAYER_VIEW_EVENTS.PLAY_BTN_CLICKED),DOM.dispatchEvent(document,VSPLAYER_VIEW_EVENTS.AUDIO_ICON_CLICKED,"unmute")},showPlayer:function(e){switch(Debug.print("VSPlayerView.showPlayer("+e+")"),this.hlsCont.classList.remove("show"),this.webrtcCont&&this.webrtcCont.classList.remove("show"),e){case"hls":case"llhls":this.hlsCont.classList.add("show");break;case"webrtc":this.webrtcCont&&this.webrtcCont.classList.add("show")}},hideAllPlayers:function(){Debug.print("VSPlayerView.hideAllPlayers()"),this.hlsCont.classList.remove("show"),this.webrtcCont&&this.webrtcCont.classList.remove("show")},updateCurrentPlayerIcon:function(e){if(Debug.print("VSPlayerView.updateCurrentPlayerIcon("+e+")"),VSPlayerView.chatRoomContainerEl){var t=e+"-video-player";["hls-video-player","llhls-video-player","webrtc-video-player","flash-video-player"]emove(e)})),VSPlayerView.chatRoomContainerEl.classList.add(t)}VSPlayerView.updateMobileVidPlayerToggle(e)},updateAllPlayerIconTooltips:function(e){var t,r=(e=e||{}).failed,i=e.modelName,n=["webrtc","hls","llhls"],o={webrtc:"WebRTC",hls:"HLS",llhls:"Low-Latency HLS"},a=function(e,t){var r="";return Translator.getTranslation("videoPlayer","VIDEO_PLAYER_ERROR",[i,o[e]])?r+=Translator.getTranslation("videoPlayer","VIDEO_PLAYER_ERROR",[i,o[e]]):(r+="We are having trouble with "+i+"'s "+o[e]+" stream at the moment, <br>",r+="so we have switched to a different player for the next few minutes. <br>",r+="If you'd like to use this player again, please wait a few minutes before retrying. <br>"),t&&(r+='<span class="btn" onclick="VSPlayerController.changeVideoPlayer(\''+e+"')\">",r+=Translator.getTranslation("videoPlayer","VIDEO_PLAYER_TRY_ANYWAY",[o[e]])||`Try ${o[e]} anyway`,r+="</span>"),r};(t=document.querySelector(".sub-menu-container .players-container"))&&n.forEach((function(e){var i=t.querySelector(".switch-"+e+" .tip");if(i){var n="Switch to "+o[e]+" player";i.classList.remove("tooltip-long"),r===e&&(n=a(e),i.classList.add("tooltip-long")),i.innerHTML=n}})),function(){var e=document.querySelector(".toggle-player");e&&n.forEach((function(t){var i=e.querySelector("[data-player="+t+"]");if(i){var n=o[t];i.innerHTML=n,i.additionalData=null,r===t&&(i.additionalData={msgToShow:a(t,!0)})}}))}()},updateVolumeSlvalue=e)},updateMuteIcon:function(e){switch(Debug.print("VSPlayerView.updateMuteIcon to ("+e+")"),e){case"mute":this.audioIcon.classList.remove("show"),this.muteIcon&&this.muteIcon.classList.add("show"),this.mobileAudioControl&&(this.mobileAudioControl.checked=!1),this.desktopMuteBtn&&(this.desktopMuteBtn.classList.remove("icon-audio-off"),this.desktopMuteBtn.classList.add("icon-audio"),this.unmarkMute());break;case"unmute":this.audioIcon.classList.add("show"),this.muteIcon&&this.muteIcon.classList.remove("show"),this.mobileAudioControl&&(this.mobileAudioControl.checked=!0),this.desktopMuteBtn&&(this.desktopMuteBtn.classList.remove("icon-audio"),this.desktopMuteBtn.classList.add("icon-audio-off"),this.markMute())}},disableAudio:function(){Debug.print("VSPlayerView.disableAudio()"),this.desktopMuteBtn&&(this.updateMuteIcon("unmute"),this.voyeurToolTipMessageEl&&this.voyeurToolTipMessageEl.classList.remove("hide"),this.audioIconEl&&this.audioIconEl.classList.add("tooltip"),this.audioIconEl&&this.audioIconEl.classList.add("tip-top"),this.audioSubMenuContainerEl&&this.audioSubMenuContainerEl.classList.add("hide"))},enableAudio:function(){Debug.print("VSPlayerView.enableAudio()"),this.desktopMuteBtn&&(this.voyeurToolTipMessageEl&&this.voyeurToolTipMessageEl.classList.add("hide"),this.audioIconEl&&this.audioIconEl.classList.remove("tooltip"),this.audioIconEl&&this.audioIconEl.classList.remove("tip-top"),this.audioSubMenuContainerEl&&this.audioSubMenuContainerEl.classList.remove("hide"))},showVideoPlayerIcon:function(e){Debug.print("VSPlayerView.hideVideoPlayerIcon()");var t="switch-"+e,r=DOM.getElementsByClassName(t)[0];if(r&&r.classList.remove("hide"),VSPlayerView.vidToggleContainer){var i=VSPlayerView.vidToggleContainer.querySelector('[data-player="'+e+'"]');i&&i.classList.remove("hide")}},hideVideoPlayerIcon:function(e){Debug.print("VSPlayerView.hideVideoPlayerIcon()");var t="switch-"+e,r=DOM.getElementsByClassName(t)[0];if(r&&r.classList.add("hide"),VSPlayerView.vidToggleContainer){var i=VSPlayerView.vidToggleContainer.querySelector('[data-player="'+e+'"]');i&&i.classList.add("hide")}},showCurrentPlayerName:function(e){var t=DOM.getElementById("curPName"),r=" Internal user only: "+e;t?t.innerHTML=r:((t=document.createElement("span")).setAttribute("id","curPName"),t.innerHTML=r,t.style.position="absolute",t.style.top="50px",t.style.left="100px",t.style.zIndex="99999",this.audioIcon.parentNode.insertBefore(t,this.audioIcon))},markMute:function(){VSPlayerView.bodyTag.classList.add("video-muted")},u-muted")},showPlayBtn:function(){Debug.print("VSPlayerView.showPlayBtn()"),this.playBtnVisible=!0,this.playBtn.classList.add("show")},hidePlayBtn:function(){Debug.print("VSPlayerView.hidePlayBtn()"),this.playBtnVisible=!1,this.playBtn.classList.remove("show")},showLoadingSymbol:function(){this.loadingSymbol.classList.add("show")},hideLoad("show")},updateMobileVidPlayerToggle:function(e){Debug.print("VSPlayerView.updateMobileVidPlayerToggle("+e+")");var t=DOM.getElementsByClassName("toggle-player")[0];if(t){var r=DOM.getElementsByClassName("hls-toggle",t)[0],i=DOM.getElementsByClassName("llhls-toggle",t)[0],n=DOM.getElementsByClassName("web-rtc-toggle",t)[0];r.classList.remove("active"),i&&i.classList.remove("active"),n&&n.classList.remove("active"),"hls"===e?r.classList.add("active"):"llhls"===e?i.classList.add("active"):"webrtc"===e&&n&&n.classList.add("active")}},limitQualityLabel:function(e,t){if(void 0===t)return e;var r=parseInt(e);return isNaN(r)||r<=t?e:t+"p"},configureCommonAbrMenu:function(e){var t=e.qualityList,r=e.autoAvailable,i=e.playerName,n=e.handleMenuChange,o=DOM.getElementsByClassName(i+"-quality")[0],a=DOM.getElementsByClassName(i+"-quality-mobile")[0];if(o||a){var s=null;if(o?s=DOM.getElementsByClassName(i+"-quality-sub-menu")[0]:a&&(s=DOM.getElementById(i+"QualityMobileSelect")),s&&(s.innerHTML="",Array.isArray(t)&&(!(t.length<=0)||r))){var l=function(e){var t=VSPlayerView.limitQualityLabel(e,VSPlayerView.qualityLimit),r=e;if(o){var n=document.createElement("a");return n.href="javascript:;",n.classList.add("inner-icons"),n.setAttribute("data-q",r),n.innerHTML=t,DOM.addEventListener(n,"click",(function(){if(!DOM.getElementsByClassName(i+"-quality-sub-menu")[0].classList.contains("disabled")){var e=DOM.getElementsByClassName(i+"-quality-val")[0],t=!1,r=document.querySelector("."+i+"-quality-top span");r&&"auto"===r.innerHTML.toLowerCase()&&(t=!0),(e.innerHTML!==this.innerHTML||t)&&DOM.dispatchEvent(document,VSPLAYER_VIEW_EVENTS.ABR_SELECTED,{abr:this.getAttribute("data-q")})}})),n}if(a){var s=document.createElement("option");return s.value=t,s.text=t,s.setAttribute("data-q",r),s}},c=t.slicseInt(t)})).reverse();r&&c.unshift("auto");for(var d=[],u=0;u<c.length;u++){var h=l(c[u]);d.push(h)}dChild(e)})),a&&(DOM.removeEventListener(s,"change",n),DOM.addEventListener(s,"change",n))}}},showCommonAbrMenu:function(e){var t=e.playerName,r=DOM.getElementsByClassName(t+"-quality")[0]||DOM.getElementsByClassName(t+"-quality-mobile")[0];r&&r.classList.remove("hide")},hideCommonAbrMenu:function(e){var t=e.playerName,r=DOM.getElementsByClassName(t+"-quality")[0]||DOM.getElementsByClassName(t+"-quality-mobile")[0];r&&r.classList.add("hide")},enableCommonAbrMenu:function(e){var t=e.playerName,r=DOM.getElementsByClassName(t+"-quality")[0],i=DOM.getElementsByClassName(t+"-quality-mobile")[0];if(r||i){var n=null;r?n=DOM.getElementsByClassName(t+"-quality-sub-menu")[0]:i&&(n=DOM.getElementById(t+"QualityMobileSelect")),n&&n.classList.remove("disabled")}},onMobileCommonAbrMenuChange:function(e){var t=e.playerName,r=DOM.getElementById(t+"QualityMobileSelect");r.classList.contains("disabled")||DOM.dispatchEvent(document,VSPLAYER_VIEW_EVENTS.ABR_SELECTED,{abr:r.options[r.selectedIndex].getAttribute("data-q")})},updateCurrentCommonAbrLabel:function(e){var t=e.label,r=e.auto,i=e.playerName;t=VSPlayerView.limitQualityLabel(t,VSPlayerView.qualityLimit);var n=DOM.getElementsByClassName(i+"-quality-val")[0];if(n){var o=document.querySelector("."+i+"-quality-top");o&&(o.innerHTML=r?"<span>Auto</span>":"<span>Quality</span>"),"auto"!=t&&(n.innerHTML=t)}else{var a=DOM.getElementById(i+"QualityMobileSelect"),s=a.querySelector("option[value=auto]");a&&(r?(s&&(s.innerHTML="auto "+t),a.value="auto"):(s&&(s.innerHTML="auto"),a.value=t))}},disableCommonAbrMenu:function(e){var t=e.playerName,r=DOM.getElementsByClassName(t+"quality")[0],i=DOM.getElementsByClassName(t+"quality-mobile")[0];if(r||i){var n=null;r?n=DOM.getElementsByClassName(t+"-quality-sub-menu")[0]:i&&(n=DOM.getElementById(t+"QualityMobileSelect")),n&&n.classList.add("disabled")}}},VSPlayerWebrtcView={playerName:"webrtc",configureAbrMenu:function(e,t){this.configured||(this.onMobileAbrMenuChange=this.onMobileAbrMenuChange.bind(this),this.configured=!0),VSPlayerView.configureCommonAbrMenu({qualityList:e,autoAvailable:t,playerName:this.playerName,handleMenuChange:this.onMobileAbrMenuChange})},showAbrMenu:function(){VSPlayerView.showCommonAbrMenu({playerName:this.playerName})},hideAbrMenu:function(){VSPlayerView.hideCommonAbrMenu({playerName:this.playerName})},enableAbrMenu:function(){VSPlayerView.enableCommonAbrMenu({playerName:this.playerName})},onMobileAbrMerName})},updateCurrentAbrLabel:function(e,t){VSPlayerView.updateCurrentCommonAbrLabel({label:e,auto:t,playerName:this.playerName})},disableAbrMenu:function(e){VSPlayerView.disableCommonAbrMenu({playerName:this.playerName})}};