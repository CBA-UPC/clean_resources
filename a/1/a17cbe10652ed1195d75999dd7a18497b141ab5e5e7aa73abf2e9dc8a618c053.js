!{"./src/sw.js":
/*!*******************!*\
  !*** ./src/sw.js ***!
  \*******************/
/*! no static exports found */function(e,t){const r=["^/co"],n=[".js$",".css$",".json$"],a=["x-session-id"],s={PREFETCH_EXPIRATION_TTL_MS:3e5,SW_VERBOSE:!1};function i(...e){s.SW_VERBOSE&&console.log(...e)}function o(e,t,r){return new Request(e,{mode:"same-origin",headers:{"x-mtt-prefetch-gen":t,"x-mtt-prefetch-expires":r}})}async function c(e){const t=await fetch(e);return async function(e,t){try{const n=caches.open("mtt-sw-prefetch-v1"),a=caches.open("mtt-sw-swr-v1");var r=!1;if(200===e.status){const s=await async function(e){const t={"x-mtt-prefetch-expires":u()};return e.headers.forEach((e,r)=>{if("cache-control"===r){let r=e.split(",").map(e=>e.trim()),n=r.find(e=>e.match(/^max-age/g)),a=r.find(;n&&(n=n.split("="),2==n.length&&(n=parseInt(n[1]),n=isNaN(n)?0:1e3*n),t["swr-expired-but-stale"]=l(n)),a&&(a=a.split("="),2==a.length&&(a=parseInt(a[1]),a=isNaN(a)?0:1e3*a),t["swr-total-expiration"]=l(a))}t[r]=e}),new Response(await e.blob(),{status:e.status,statusText:e.statusText,headers:t})}(e);if("navigate"!==t.mode&&"text/html"===e.headers.get("Content-Type")){const e=o(t,0,u());await h(await n,e,s),r=!0,i("[sw] Cached response for "+t.url)}!function(e){const t=e.headers.get("Cache-Control")?e.headers.get("Cache-Control").split(",").map(:null;return!(!t||t.includes("must-revalidate")||t.includes("no-cache")||t.includes("max-age=0"))}(e)?i(`[sw] response is NOT cacheable ${t.url} + ${e.headers.get("Cache-Control")}`):(await h(await a,t,s),r=!0,i("[sw] SWR Cached response for "+t.url)),r||i(`[sw] response for ${t.url} not cached`)}}catch(e){i(`[sw] failed to cache response ${t.url} + ${e}`)}}(t.clone(),e),t}function u(){const e=(new Date).getTime()+s.PREFETCH_EXPIRATION_TTL_MS;return new Date(e).toUTCString()}function l(e){const t=(new Date).getTime()+e;return new Date(t).toUTCString()}function f(e){try{const t=new Request(e);for(const e of a)t.headers.has(e)&&t.headers.delete(e);return t}catch(t){return e}}async function d(e,t){return await e.match(f(t))}async function h(e,t,r){await e.put(f(t),r.clone())}function w(e,t){if(!e)return!1;const r=new URL(e).pathname.toLowerCase();return void 0!==t.find(}self.addEventListener("message",e=>{for(const t of Object.keys(s))if(t in e.data){const r=e.data[t];console.log(`[sw] setting ${t} to ${r}`),s[t]=r}}),self.addEventListener("activate",e=>{try{e.waitUntil(clients.claim())}catch(e){}}),self.addEventListener("install",,self.addEventListener("fetch",e=>{const t=e.request;if(!function(e){return"GET"===e.request.method&&!w(e.request.referrer,r)}(e))return void i("[sw] request is not eligible for caching "+t.url);return e.respondWith((async()=>{try{return await async function(e){const t=e.request;let a=null;"navigate"===e.request.mode&&(await async function(e){if(!e.request.referrer.startsWith(e.target.origin))return await caches.delete("mtt-sw-prefetch-v1"),void i("[sw] Dropping cache mtt-sw-prefetch-v1 since we're coming from another origin.");const t=await caches.open("mtt-sw-prefetch-v1"),r=await t.keys();for(const e of r){let r=e.headers.get("x-mtt-prefetch-gen");r=isNaN(r)?"2":parseInt(r)+1;const n=new Date(e.headers.get("x-mtt-prefetch-expires"));if(isNaN(n)||n<new Date||r>=2)i(`[sw] Deleting URL ${e.url} with gen ${r} and expiration ${n}`),await t.delete(e);else{const n=await d(t,e),a=e.headers.get("x-mtt-prefetch-expires"),s=o(e,r,a);await t.delete(e),await h(t,s,n),i(`[sw] Updating generation on ${e.url} to ${r}`)}}}(e),function(e){return"GET"===e.request.method&&e.target&&e.target.origin&&e.request.url.startsWith(e.target.origin)}(e)&&(a=await async function(e){const t=await caches.open("mtt-sw-prefetch-v1");let r=await d(t,e);if(r){if(!function(e){const t=new Date(e.headers.get("x-mtt-prefetch-expires"));return isNaN(t)||t<new Date}(r))return i("[sw] Retrieved from cache "+e.url),r;await t.delete(e),i("[sw] Expired from cache "+e.url)}return null}(t)));a||(a=await async function(e){const t=await caches.open("mtt-sw-swr-v1");let r=await d(t,e);if(r){const n=new Date,a=new Date(r.headers.get("swr-expired-but-stale")),s=new Date(r.headers.get("swr-total-expiration"));if(n<a)return i("[sw] Retrieved from cache "+e.url),r;if(n>a&&n<s)return c(e).catch(t=>i(`[sw] fetch handler failed to revalidate stale resource ${t} + ${e.url}`)),i("[sw] stale serve from cache "+e.url),r;await t.delete(e),i("[sw] Expired from cache "+e.url)}return null}(t));a||(a=await c(t));(function(e){return"GET"===e.request.method&&e.clientId&&"navigate"!==e.request.mode&&("no-cors"!==e.request.mode||e.request.url.startsWith(e.target.origin))&&!w(e.request.referrer,r)&&!w(e.request.url,n)})(e)&&async function(e,t,r){const n=t.headers.get("x-amz-meta-hint-domain"),a=(t.headers.get("x-amz-meta-shared-hint")||"").split(",").filter(e=>e&&""!==e).filter(,s=(t.headers.get("x-amz-meta-exclusive-hint")||"").split(",").filter(,i=t.headers.get("x-amz-meta-preload-worker");if(a.length>0||s.length>0){const t=await clients.get(r);t&&t.postMessage({type:"PREFETCH_HINTS",source:e,shared:a,exclusive:s,domain:n})}if(i){const e=await clients.get(r);e&&e.postMessage({type:"PREFETCH_WORKER_HINT",worker:i})}}(e.request.url,a,e.clientId);return a}(e)}catch(e){return fetch(t)}})())}),self.skipWaiting()}});
//# sourceMappingURL=sw.js.map