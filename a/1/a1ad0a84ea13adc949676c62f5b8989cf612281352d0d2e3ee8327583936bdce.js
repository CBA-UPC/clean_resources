// Copyright 2023 Source Defense LTD. All Rights Reserved. Build 1703765995713 c4dc4c07b0d318634cd08187324afefc800e038d
// Version 1.0.7.29 built at 2023-Dec-28 12:19:55.
"use strict";![function(t,e,r){function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}r.d(e,"d",function(){return i}),r.d(e,"b",function(){return u}),r.d(e,"a",function(){return s}),r.d(e,"c",function(){return f});var i=function(t){var e,r=0;for(e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return r.toString(32)},a=u=c="undefined"!==("undefined"==typeof navigator?"undefined":o(navigator))?navigator.userAgent.toLowerCase():"",s={safari:c.indexOf("safari")>-1&&-1===c.indexOf("chrome"),ie:c.indexOf("trident")>-1||c.indexOf("msie")>-1,ff:c.indexOf("trident")>-1||c.indexOf("firefox")>-1},f=,,function(t,e){t.exports={}},function(t,e,r){var n=r(10),o=r(0),i=r(30),a=r(14),u=r(35),c=r(36),s=r(37),f=r(1),l=r(4),p=r(49),v=r(20),h=r(95);t.exports},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var n="verbose,debug,info,warn,error,critical,fatal".split(","),o={},i="log",a=!1;try{a=!0}catch(t){}var u=function(){if(s){if(f>=c.length)return"break";l=c[f++]}else{if((f=c.next()).done)return"break";l=f.value}var t=l,e=console.hasOwnProperty(t)?t:i;i=e,o[t]=function(){var t;return a||(t=console)[e].apply(t,arguments)}},c=n,s=Array.isArray(c),f=0;for(c=s?c:c[Symbol.iterator]();;){var l;if("break"===u())break}var p=function(){function t(e,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.callback=r;var i=function(){if(u){if(c>=a.length)return"break";s=a[c++]}else{if((c=a.next()).done)return"break";s=c.value}var t=s;o[t]},a=n,u=Array.isArray(a),c=0;for(a=u?a:a[Symbol.iterator]();;){var s;if("break"===i())break}e=e||"critical",this.setLevel(e)}return function(t,e,n){e&&r(t.prototype,e),n&&r(t,n)}(t,[{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(o.hasOwnProperty(t)&&!(n.indexOf(t)<this.__loglevelByIndex)){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this.callback&&this.callback.apply(this,[t].concat(r)),o[t].apply(o,r)}}},{key:"setLevel",value:function(t){"string"!=typeof t&&(o.error("bad initializion of level of Logger with value ".concat(t,".")),t=""),t=t||"";var e=n.indexOf(t);this.__loglevelByIndex=Math.max(e,0)}}]),t}();p.logLevels(n),t.exports=p},function(t,e){t.exports=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resolve=null,this.reject=null,this.promise=new Promise)}},function(t,e,r){t.exports=r(0)},function(t,e,r){var n={};r.r(n),r.d(n,"setIgnoreCache",function(){return T}),r.d(n,"addUrlToUniqByType",function(){return R}),r.d(n,"init",function(){return M}),r.d(n,"saveEvent",function(){return z}),r.d(n,"deleteEvent",function(){return B}),r.d(n,"clearEvents",function(){return H}),r.d(n,"getAllEvents",function(){return F}),r.d(n,"getEventsCursor",function(){return N});var o=r(8),i={sending:{chunksize:1e5}}||{},a=Object(o.b)({sending:{mimimalTime:1e3,interval:3e4,chunksize:15e4,retries:4},db:{maxSize:25e3,threshold:100}},i),u=r(40),c=r.n(u);function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var f={index:/^\+{2}/,unique:/\^/,multiEntry:/\*/,any:/^[\^\*]+/},l="\n\t\tmultiHash: ++hash,timestamp;\n\t\tevents: ++hash,timestamp,eventData;\n\t".replace(/\s+/g,"").split(";").filter).map).reduce(function(t,e){var r=s(e,2),n=r[0],o=r[1],i={columns:[],index:[]},a=o=o.split(","),u=Array.isArray(a),c=0;for(a=u?a:a[Symbol.iterator]();;){var l;if(u){if(c>=a.length)break;l=a[c++]}else{if((c=a.next()).done)break;l=c.value}var p=l;if(f.index.test(p))i.index.push(p.replace(f.index,""));else{var v={unique:f.unique.test(p),multiEntry:f.multiEntry.test(p)};p=p.replace(f.any,""),i.columns.push([p,p,v])}}return t[n]=i,t},{});r(30);function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return rfunction d(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function y(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function g(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function m(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){g(i,n,o,a,u,"next",t)}function u(t){g(i,n,o,a,u,"throw",t)}a(void 0)})}unction"==typeof Symbol&&Symbol.asyncIterator&&(x.prototype[Symbol.asyncIterator]=function(){return this}),x.prototype.next=function(t){return this._invoke("next",t)},x.prototype.throw=function(t){return this._invoke("throw",t)},x.prototype.return;var k,S={cdn:"//services.sdiapi.com/reporter/1.0.7.29/",reportUrl:"//reports.sdiapi.com/service/viceEvent",quiteMode:!0,circuitBreaker:{numberOfMessages:650,inMilliseconds:5,delayInSeconds:180},eventsCache:{maximumHash:3e3},indexedDB:{version:3,lastSupportedVersion:3,multipleReports:[0,1,2,4,6,7,10],skipCache:[5,24,30],hashByKeysMultipleReports:["type","data","url","authority"],hashByKeysDefault:["data","url","type","scriptType","authority","pageView"],uniqByType:{5:["data","url","type","scriptType","authority","pageView","timestamp"],13:["type","data.url","siteId","sectionId","zoneId"],14:["type","data.parentSrc","data.childSrc","siteId","sectionId","zoneId"],24:["data","url","type","scriptType","authority","pageView","timestamp"],25:["data.eventType","data.reportType","accountId","siteId","data.st","data.target.xpath","data.key"],40:["scriptType","data.eventType","data.reportType","accountId","siteId","data.initiator","data.target.id","data.target.class","data.target.type","data.target.name","data.requestUrl","data.key"]}},workerConfig:{sending:{chunksize:1e5}}}||{},O=S.indexedDB||{},j=new Set(O.multipleReports),E=new Set(O.skipCache),_=0,T,R=function(){["14","40"].forEach(function(t){O.uniqByType[t].indexOf("url")>-1||O.uniqByType[t].push("url")})},P=null,A=(S.eventsCache||{}).maxHashStore,I=void 0===A?5e4:A,C=function(t){return new Promise(function(e,r){t.onsuccess=function(){e(t.result||t.target&&t.target.result)},t.onerror=function(t){r(t)}})},L=function(){var t(regeneratorRuntime.mark(function t(e){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=new c.a,e.onsuccess,e.onerror=function(t){r.reject(t)};case 3:return t.next=5,b(r.promise);case 5:if(n=t.sent){t.next=8;break}return t.abrupt("return");case 8:return r=new c.a,t.next=11,n;case 11:t.next=3;break;case 12:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),D=null,M=function(){var t=m(regeneratorRuntime.mark(function t(){var e,r,n,o,i,a,u,c,s=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]?s[0]:null,!D){t.next=3;break}return t.abrupt("return",D);case 3:if(e&&!P&&(P=e),r=null,n=O.lastSupportedVersion,o=void 0===n?0:n,i=O.version,u="source-defense-"+(a=void 0===i?1:i),(c=indexedDB.open(u,a)).onupgradeneeded=function(t){var e=t.target.result;if(t.oldVersion&&t.oldVersion<o){var n=indexedDB.deleteDatabase(u);r=C(n)}else{var i=function(t){var r=l[t],n=r.index,o=r.columns;n=1===n.length?n[0]:n;var i=e.createObjectStore(t,{keyPath:n});o.forEach)};for(var a in l)i(a)}},!r){t.next=15;break}return t.next=12,r;case 12:return t.next=14,M();case 14:return t.abrupt("return",t.sent);case 15:return t.next=17,C(c);case 17:return D=t.sent,t.next=20,V();case 20:return t.abrupt("return",D);case 21:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),z=function(){var t=m(regeneratorRuntime.mark(function t(e){var r,n,o,i,a,u,c,s,f=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=f.length>1&&void 0!==f[1]?f[1]:{},n=f.length>2&&void 0!==f[2]?f[2]:{},t.next=4,U(r);case 4:if(o=t.sent,!r||E.has(r.type)){t.next=11;break}return t.next=8,q(o);case 8:if(t.sent){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,M();case 13:return i=t.sent,a=i.transaction("events","readwrite").objectStore("events"),u=h({},n,{timestamp:e,eventData:r,hash:o}),c=a.add(u),t.next=19,C(c);case 19:return s=t.sent,t.abrupt("return",s);case 21:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),B=function(){var t=m(regeneratorRuntime.mark(function t(e){var r,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M();case 2:return r=t.sent,n=r.transaction("events","readwrite").objectStore("events"),o=n.delete(e),t.next=7,C(o);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),H=function(){var t=m(regeneratorRuntime.mark(function t(){var e,r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M();case 2:return e=t.sent,r=e.transaction("events","readwrite").objectStore("events"),n=r.clear(),t.next=7,C(n);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),F=function(){var t=m(regeneratorRuntime.mark(function t(){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M();case 2:return e=t.sent,r=e.transaction(["events"],"readwrite").objectStore("events"),t.next=6,C(r.getAll());case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),N=function(){var t=m(regeneratorRuntime.mark(function t(){var e,r,n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!o.a.safari){t.next=5;break}return t.next=3,F();case 3:return e=t.sent,t.abrupt("return",e.map(function(t){return{continue:function(){},delete,value:t}}));case 5:return t.next=7,M();case 7:return r=t.sent,n=r.transaction(["events"],"readwrite").objectStore("events"),t.next=11,L(n.index("timestamp").openCursor(null,"next"));case 11:return i=t.sent,t.abrupt("return",i);case 13:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();function W(t,e){for(var r=(e=(e=e.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),n=0,o=r.length;n<o;++n){var i=r[n];if(!(t&&"object"===p(t)&&i in t))return;t=t[i]}return t}var U=function(){var t=m(regeneratorRuntime.mark(function t(e){var r,n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("missing object! in the generate hash function.");case 2:return(r=O.uniqByType[e.type])||(r=j.has(e.type)?O.hashByKeysMultipleReports:O.hashByKeysDefault),n=[],r.map(function(t){var r;return(r=W(e,t))&&("data.childSrc"==t||"data.url"==t?n.push(Object(o.c)(r)||0):n.push(r||0)),t},{}),i=Object(o.d)(JSON.stringify(n)),k&&(i+=_++),t.abrupt("return",i);case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),q=function(){var t=m(regeneratorRuntime.mark(function t(e){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M();case 2:return r=t.sent,n=r.transaction(["multiHash"],"readwrite").objectStore("multiHash"),t.next=6,C(n.get(e));case 6:if(!t.sent){t.next=9;break}return t.abrupt("return",!1);case 9:return G(e),t.abrupt("return",!0);case 11:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),G=function(){var t=m(regeneratorRuntime.mark(function t(e){var r,n,o,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,M();case 3:return n=t.sent,o=n.transaction(["multiHash"],"readwrite").objectStore("multiHash"),i={timestamp:r,hash:e},a=o.add(i),t.prev=7,t.next=10,C(a);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(7),P&&P.error(t.t0);case 15:case"end":return t.stop()}},t,null,[[7,12]])}));return function(e){return t.apply(this,arguments)}}(),V=function(){var t=m(regeneratorRuntime.mark(function t(){var e,r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M();case 2:return e=t.sent,r=e.transaction(["multiHash"],"readwrite").objectStore("multiHash"),n=r.count(),t.next=7,C(n);case 7:if(t.t0=t.sent,t.t0){t.next=10;break}t.t0=0;case 10:t.t0>I&&K();case 12:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),K=function(){var t=m(regeneratorRuntime.mark(function t(){var e,r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M();case 2:return e=t.sent,r=e.transaction(["multiHash"],"readwrite").objectStore("multiHash"),n=r.clear(),t.next=7,C(n);case 7:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();function J(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var X=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.logger=e.logger,this.cleanupSet=new Set}return function(t,e,r){e&&Q(t.prototype,e),r&&Q(t,r)}(t,[{key:"aggregate",value},{key:"clean",value:function(){var t(regeneratorRuntime.mark(function t(){var e,r,n,o,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=this.cleanupSet,r=Array.isArray(e),n=0,e=r?e:e[Symbol.iterator]();case 1:if(!r){t.next=7;break}if(!(n>=e.length)){t.next=4;break}return t.abrupt("break",23);case 4:o=e[n++],t.next=11;break;case 7:if(!(n=e.next()).done){t.next=10;break}return t.abrupt("break",23);case 10:o=n.value;case 11:return i=o,t.prev=12,t.next=15,B(i);case 15:this.cleanupSet.delete(i),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(12),this.logger&&this.logger.critical("Cleaner: couldn't not delete event key:".concat(i,"."),t.t0);case 21:t.next=1;break;case 23:case"end":return t.stop()}},t,this,[[12,18]])}));return function(){return t.apply(this,arguments)}}()}]),t}();function Y(t){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Z(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function $(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){Z(i,n,o,a,u,"next",t)}function u(t){Z(i,n,o,a,u,"throw",t)}a(void 0)})}}function tt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)} it=.75*a.sending.chunksize-2,at={},ut=function(t){var e=t.value.eventData,r=e;return 24===e.type&&(r=function(t){var e=t,r="".concat(e.pageView,"_").concat(e.scriptType);if(at[r])at[r][e.data.type]?at[r][e.data.type]={count:at[r][e.data.type].count+1,len:at[r][e.data.type].len+e.data.length}:at[r][e.data.type]={count:1,len:e.data.length};else{var n={};n[e.data.type]={count:1,len:e.data.length},at[r]=n}return e.data.length=at[r][e.data.type].len,e.data.count=at[r][e.data.type].count,e}(r)),r},ct=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=et(this,nt(e).call(this,r))).__config=r,n.url=t||"",n.reportsArray=new Array,n.reportStringSize=0,n.currReportSize=0,n}return(e,X),function(t,e,r){e&&tt(t.prototype,e),r&&tt(t,r)}(e,[{key:"updateReportsTotalSize",value},{key:"check",value:function(t){var e=t.value.eventData;return this.currReportSize=JSON.stringify(e).length,this.reportStringSize+this.currReportSize<it}},{key:"aggregate",value:function(t){var r=!1,n=ut(t);if(this.reportStringSize+=this.currReportSize,!(this.reportStringSize<it))throw this.reportStringSize-=this.currReportSize,new Error("Reporter: could NOT aggregate.");24==n.type&&n.data.count>1&&(this.reportsArray=this.reportsArray.filter(function(t){return 24!==t.type||24===t.type&&(t.pageView!==n.pageView||t.data.type!==n.data.type)||(r=!0,!1)})),this.reportsArray.push(n),r&&this.updateReportsTotalSize(),rt(nt(e.prototype),"aggregate",this).call(this,t)}},{key:"send",value:function(){var t=$(regeneratorRuntime.mark(function t(){var e,r,n,o,i,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!=this.reportsArray.length){t.next=4;break}return t.next=3,this.clean();case 3:return t.abrupt("return");case 4:e=JSON.stringify(this.reportsArray),at={},r=null,n=a.sending.retries||1,o=btoa(unescape(encodeURIComponent(e))),i=this.url||"//reports.sdiapi.com/service/viceEvent",u=0;case 11:if(!(u<n)){t.next=25;break}return t.prev=12,t.next=15,st(i,o);case 15:return r=null,t.abrupt("break",25);case 19:t.prev=19,t.t0=t.catch(12),r=t.t0;case 22:u++,t.next=11;break;case 25:if(!r){t.next=27;break}throw r;case 27:return t.next=29,this.clean();case 29:case"end":return t.stop()}},t,this,[[12,19]])}));return function(){return t.apply(this,arguments)}}()}]),e}(),st=null;switch(!0){case"undefined"!==("undefined"==typeof fetch?"undefined":Y(fetch)):st=function(){var t=$(regeneratorRuntime.mark(function t(e,r){var n,o,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain"},body:r});case 3:if(n=t.sent,o=n.ok,i=n.status,a=n.statusText,o){t.next=7;break}throw new Error("#".concat(i,": ").concat(a));case 7:return t.abrupt("return");case 10:return t.prev=10,t.t0=t.catch(0),t.abrupt("return");case 13:case"end":return t.stop()}},t,null,[[0,10]])}));return}();break;case"undefined"!==("undefined"==typeof XMLHttpRequest?"undefined":Y(XMLHttpRequest)):st=function(t,e){return new Promise(function(r,n){var o=new XMLHttpRequest;o.open("POST",t,!0),o.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),o.onreadystatechange=function(){if(4===o.readyState){if(o.status>=200&&o.status<300)try{return r()}catch(t){return n(t)}n(new Error("#".concat(o.status,": ").concat(o.statusText," ")))}},o.send(e)}).catch)}}var ft=r(39),lt=r.n(ft),pt=r(75),vt=r.n(pt);function ht(t){return(ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dt(t){return function(t){if(Array.isArray(t))return t}(t)||gt(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function yt(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||gt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function gt(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function mt(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function bt(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){mt(i,n,o,a,u,"next",t)}function u(t){mt(i,n,o,a,u,"throw",t)}a(void 0)})}}function xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}var kt=Math.floor(1e4*Math.random()),St=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.logger=e.logger||new lt.a("verbose"),this.isReady=M(this.logger).then(function(){}),this.intervalHandler=new vt.a}return function(t,e,r){e&&xt(t.prototype,e),r&&xt(t,r)}(t,[{key:"handleEvent",value:function(){var t=bt(regeneratorRuntime.mark(function t(e){var r,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.digest(e.data);case 3:if((r=t.sent)&&r.length){t.next=6;break}return t.abrupt("return",[]);case 6:if(r=Array.isArray(r)?r:[r],n=lt.a.logLevels.indexOf(r[0]),!(r.length>1&&~n)){t.next=10;break}return t.abrupt("return",r);case 10:return t.abrupt("return",["verbose"].concat(yt(r)));case 13:return t.prev=13,t.t0=t.catch(0),o=t.t0.currentTarget&&t.t0.currentTarget.error&&t.t0.currentTarget.error.message,t.abrupt("return",["critical",o||t.t0.message||t.t0]);case 17:case"end":return t.stop()}},t,this,[[0,13]])}));return function(e){return t.apply(this,arguments)}}()},{key:"shouldSendReport",value:function(t,e){var r=e["type".concat(t)];return!r&&0!==r||kt<r}},{key:"setIntervalHandler",value:function(){return!!this.config.externalConfig.intervalHandler&&(!!this.config.externalConfig.intervalHandler.mimimalTime&&(!!this.config.externalConfig.intervalHandler.interval&&(this.intervalHandler.initIntervalHandler(this.config.externalConfig.intervalHandler.mimimalTime,this.config.externalConfig.intervalHandler.interval,Et.bind(this)),!0)))}},{key:"digest",value:function(){var t=bt(regeneratorRuntime.mark(function t(e){var r,o,i,u,c,s,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)){t.next=2;break}throw new Error("data is not an array.");case 2:if(r=dt(e),o=r[0],i=r[1],u=r[2],c=r.slice(3),"string"==typeof o){t.next=5;break}throw new Error("action must be a string.");case 5:if("number"==typeof i){t.next=7;break}throw new Error("invalid timestamp.");case 7:return t.next=9,this.isReady;case 9:t.t0=o,t.next="init"===t.t0?12:"clear-all-events"===t.t0?23:"immediate"===t.t0?26:"event"===t.t0?28:"force-interval"===t.t0?33:"ping"===t.t0?35:36;break;case 12:if(this.config.externalConfig){t.next=18;break}if("object"===ht(e[3])&&(this.config.reporterExternalConfig=e[3],null!=this.config.reporterExternalConfig.ignoreCache&&T(this.config.reporterExternalConfig.ignoreCache),this.config.reporterExternalConfig.addUrlCache&&R()),"object"!==ht(e[2])){t.next=18;break}if(this.config.externalConfig=e[2],!this.setIntervalHandler()){t.next=18;break}return t.abrupt("return",[]);case 18:return s=a.sending.mimimalTime,f=a.sending.interval,this.config.externalConfig&&this.config.externalConfig.intervalHandler&&(s=this.config.externalConfig.intervalHandler.mimimalTime||a.sending.mimimalTime,f=this.config.externalConfig.intervalHandler.interval||a.sending.interval),this.intervalHandler.initIntervalHandler(s,f,Et.bind(this)),t.abrupt("return",[]);case 23:return t.next=25,H();case 25:return t.abrupt("return",["events cleared",i,Date.now()]);case 26:return this.shouldSendReport(c[0].type,u)&&jt.apply(void 0,yt(c)),t.abrupt("return",["immediate event",i,Date.now()]);case 28:if(!this.shouldSendReport(c[0].type,u)){t.next=32;break}return t.next=31,z.apply(n,[i].concat(yt(c)));case 31:return t.abrupt("return",["events saved",i,Date.now()]);case 32:return t.abrupt("return",[]);case 33:return this.intervalHandler.forceTick(),t.abrupt("return",["iterval has been forced",i,Date.now()]);case 35:return t.abrupt("return",["verbose","pong",i,Date.now()]);case 36:return t.abrupt("return",[]);case 37:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}(),Ot=(e.a=St,function(){var t=bt(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("undefined"!==("undefined"==typeof navigator?"undefined":ht(navigator))||navigator.storage||navigator.storage.estimate){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,navigator.storage.estimate();case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}()),jt=function(){var t=bt(regeneratorRuntime.mark(function t(){var e,r,n,o,i=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=i.length>0&&void 0!==i[0]?i[0]:{},r=i.length>1&&void 0!==i[1]?i[1]:{},n=r.reportServer,(o=new ct(void 0===n?"":n)).aggregate({value:{eventData:e}}),o.send();case 6:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),Et=function(){var t=bt(regeneratorRuntime.mark(function t(){var e,r,n,i,u,c,s,f,l,p,v,h,d,y,g,m,b,x,w,k,S,O;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=(e="undefined"!==ht(this)&&this&&this.config)||{},r=!1,t.prev=3,n={},i=new X,t.next=8,N();case 8:u=t.sent,c=!0,s=!1,t.prev=11,l=wt(u);case 13:return t.next=15,l.next();case 15:return p=t.sent,c=p.done,t.next=19,p.value;case 19:if(v=t.sent,c){t.next=48;break}if(h=v){t.next=24;break}return t.abrupt("break",48);case 24:if(h.value&&h.value.eventData){t.next=28;break}return i.aggregate(h),h.continue(),t.abrupt("continue",45);case 28:if(d=h.value,y=d.timestamp,g=d.uuid,m=d.reportServer,b=void 0===m?"":m,!o.a.ie&&window.isWorker){t.next=38;break}if(x=Date.now()-864e5,g&&!(y<x)){t.next=35;break}return i.aggregate(h),h.continue(),t.abrupt("continue",45);case 35:if(h.value.uuid===e.uuid){t.next=38;break}return h.continue(),t.abrupt("continue",45);case 38:if(w=n[b]||new ct(b),n[b]=w,w.check(h)){t.next=43;break}return r=!0,t.abrupt("break",48);case 43:w.aggregate(h),h.continue();case 45:c=!0,t.next=13;break;case 48:t.next=54;break;case 50:t.prev=50,t.t0=t.catch(11),s=!0,f=t.t0;case 54:if(t.prev=54,t.prev=55,c||null==l.return){t.next=59;break}return t.next=59,l.return();case 59:if(t.prev=59,!s){t.next=62;break}throw f;case 62:return t.finish(59);case 63:return t.finish(54);case 64:return t.next=66,i.clean();case 66:t.t1=regeneratorRuntime.keys(n);case 67:if((t.t2=t.t1()).done){t.next=73;break}return k=t.t2.value,t.next=71,n[k].send();case 71:t.next=67;break;case 73:if(!r){t.next=79;break}return t.next=76,Ot();case 76:S=t.sent,(O=S&&S.usageDetails&&S.usageDetails.indexedDB)&&O<a.db.maxSize&&(r=!1);case 79:t.next=84;break;case 81:t.prev=81,t.t3=t.catch(3),this.logger.critical(t.t3);case 84:return t.abrupt("return",r?1:0);case 85:case"end":return t.stop()}},t,this,[[3,81],[11,50,54,64],[55,,59,63]])}));return function(){return t.apply(this,arguments)}}()},function(t,e,r){var n=r(7).f,o=r(31),i=r(38),a=r(21),u=r(37),c=r(36),s=r(67),f=r(70),l=r(6),p=r(35).fastKey,v=r(12),h=v.set,d=v.getterFor;t.exports={getConstructor,setStrong}},function(t,e,r){var n,o,i,a=r(69),u=r(9),c=r(3),s=r(2),f=r(17),l=s("iterator"),p=!1;[].keys&&("next"in(i=[].keys())?(o=a(a(i)))!==Object.prototype&&(n=o):p=!0),void 0==n&&(n={}),f||c(n,l)||u(n,l,function(){return this}),t.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:p}},function(t,e,r){var n=r(38),o=r(35).getWeakData,i=r(5),a=r(1),u=r(37),c=r(36),s=r(61),f=r(3),l=r(12),p=l.set,v=l.getterFor,h=s.find,d=s.findIndex,y=0,g,m,b;m.prototype={get,has,set,delete},t.exports={getConstructor}},function(t,e){function r(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function n(t){return function(){var e=this,n=arguments;return new Promise(function(o,i){var a=t.apply(e,n);function u(t){r(a,o,i,u,c,"next",t)}function c(t){r(a,o,i,u,c,"throw",t)}u(void 0)})}}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=function()return function(t,e,r){e&&o(t.prototype,e),r&&o(t,r)}(t,[{key:"initIntervalHandler",value:function(t,e,r){var o=this;if(this.minimum=0+t,this.maximum=0+e,!r||"[object Function]"!=={}.toString.call(r))throw new Error("IntervalHandler: no callback function");if(!(this.maximum>this.minimum))throw new Error("IntervalHandler: maximum can NOT be smaller than minimum.");this.callback=n(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.bind(o)();case 3:return e=t.sent,t.abrupt("return",e);case 7:t.prev=7,t.t0=t.catch(0),console.warn(t.t0);case 10:return t.abrupt("return",0);case 11:case"end":return t.stop()}},t,null,[[0,7]])})),this.__lastTick=Date.now(),this.setNextTick(0)}},{key:"setNextTick",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.__forceStop){clearTimeout(this.___timeout),e=Math.max(Math.min(e,1),0)||0;var r=(Math.max(this.maximum-this.minimum,0)||0)*(1-e)+this.minimum;r=Math.max(r,1),this.__nextTick=r+Date.now(),this.___timeout=setTimeout(function(){return t.tick()},r)}}},{key:"forceTick",value:function(){var t=n(regeneratorRuntime.mark(function t(){var e,r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.__forceStop){t.next=2;break}return t.abrupt("return");case 2:if(!this.__lastForceRun){t.next=5;break}return t.next=5,this.__lastForceRun;case 5:return e=n(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(r.___timeout),t.prev=1,t.next=4,r.callback();case 4:e=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),e=0;case 10:r.__lastTick=Date.now(),r.setNextTick(e);case 12:case"end":return t.stop()}},t,null,[[1,7]])}))(),this.__lastForceRun=e,t.next=9,e;case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"tick",value:function(){var t=n(regeneratorRuntime.mark(function t(){var e,r,n,o,i=this,a=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=a.length>0&&void 0!==a[0]&&a[0],!this.__forceStop){t.next=3;break}return t.abrupt("return");case 3:if(clearTimeout(this.___timeout),r=Date.now(),n=this.__lastTick+this.minimum,e&&(n=this.__nextTick),!(n>r)){t.next=11;break}return o=Math.min(n-r,1)||1,this.___timeout=setTimeout(function(){return i.tick()},o),t.abrupt("return");case 11:return t.next=13,this.forceTick();case 13:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"forceStop",value},{key:"forceStart",value}]),t}();t.exports=i},function(t,e,r){var n=r(77),o=(r.n(n),r(86)),i=(r.n(o),r(87)),a=(r.n(i),r(88)),u=(r.n(a),r(90)),c=(r.n(u),r(92)),s=(r.n(c),r(99)),f=(r.n(s),r(100)),l=(r.n(f),r(101)),p=(r.n(l),r(102)),v=(r.n(p),r(104)),h=(r.n(v),r(107)),d=(r.n(h),r(114));r.n(d)},function(t,e,r){r(48)("iterator")},function(t,e,r){var n=r(21),o=r(19),i=r(64),a=r(62),u=r(29),c=r(106),s=r(63);t.exports},function(t,e,r){var n=function(t){var e,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag".wrap=c;var f="suspendedStart",l="suspendedYield",p="executing",v="completed",h={};function d(){}function y(){}function g(){}var m={};m[i]=function(){return this};var b=Object.getPrototypeOf,x=b&&b(b(T([])));x&&x!==r&&n.call(x,i)&&(m=x);var w=g.prototype=d.prototype=Object.create(m)y.prototype=w.constructor=g,g.constructor=y,g[u]=y.displayName="GeneratorFunction",t.isGeneratorFunction,t.mark,t.awrap,k(S.prototype),S.prototype[a]=function(){return this},t.AsyncIterator=S,t.async,k(w),w[u]="Generator",w[i]=function(){return this},w.toString,t.keys,t.values=T,_.prototype={constructor:_,reset,stop,dispatchException,abrupt,complete,finish,catch,delegateYield},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e)function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(){function t(){var e=r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],3),n=e[0],o=e[1],i=e[2],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:console.error.bind(console);if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!n||!o||!i)throw new Error("missing/bad argument/s in the CircuitBreaker constructor.");this.messages=n,this.milliSeconds=o,this.delay=i,this.onCircuitBreak=a,this.messagesCount=0,this.thresholdReached=!1}return function(t,e,r){e&&n(t.prototype,e),r&&n(t,r)}(t,[{key:"messagesPerSecond",value},{key:"tick",value:function(){var t=this;if(this.thresholdReached)throw new Error("CircuitBreaker, threshold reached(!).");this.lastTick=this.lastTick||Date.now();var e=Date.now(),r=e-this.lastTick;this.messagesCount++,r>this.milliSeconds&&(this.messagesCount=0),this.lastTick=e,!this.thresholdReached&&this.messagesCount-1>this.messages&&(this.thresholdReached=!0,this.onCircuitBreak("off"),clearTimeout(this.__timeout),this.__timeout=setTimeout,1e3*this.delay))}},{key:"continue",value}]),t}();t.exports=o},function(t,e,r){var n,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply;n=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN|t.exports=u,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var c=10.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set}),u.init,u.prototype.setMaxListeners,u.prototype.getMaxListeners,u.prototype.emit,u.prototype.addListener=function(t,e){return l(this,t,e,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener,u.prototype.once=function(t,e){return s(e),this.on(t,p(this,t,e)),this},u.prototype.prependOnceListener,u.prototype.removeListener,u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners,u.prototype.listeners=function(t){return v(this,t,!0)},u.prototype.rawListeners,u.listenerCount,u.prototype.listenerCount=h,u.prototype.eventNames},function(t,e,r){r.r(e);r(76);var n=r(39),o=r.n(n),i=r(115),a=r.n(i),u=r(40),c=r.n(u),s=r(50),f=r(116),l=r(8)ion m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var b=[function(t){return k.apply(this,arguments)},function(t){return w.apply(this,arguments)}],x="//services.sdiapi.com/reporter/1.0.7.29/worker.js";function w(){return(w=g(regeneratorRuntime.mark(function t(e){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("serviceWorker"in window.navigator){t.next=2;break}throw new Error("no service worker");case 2:return t.next=4,navigator.serviceWorker.register(this.workerHref);case 4:return r=t.sent,t.next=7,navigator.serviceWorker.ready;case 7:navigator.serviceWorker.addEventListener("message",this.onMessage.bind(this)),n=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.length&&(r&&r.active&&r.active.postMessage?r.active.postMessage(e):navigator.serviceWorker.controller.postMessage(e))},e.on("post",n),window[Symbol("worker")]=navigator.serviceWorker.controller;case 11:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}function k(){return(k=g(regeneratorRuntime.mark(function t(e){var r,n,o,i,a,u,s,f,v,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("undefined"!==("undefined"==typeof SharedWorker?"undefined":p(SharedWorker))){t.next=2;break}throw new Error("no service worker");case 2:return r=new SharedWorker(this.workerHref),n=this.onMessage.bind(this),o=new c.a,r.port.onmessage=function(t){var e=t.data;if("connected"===e)return o.resolve(e),void(r.port.onmessage=n);o.reject(new Error("sharedWorkerStater > SharedWorker > no connected status."))},r.port.onerror,r.port.start(),t.next=10,o.promise;case 10:if(l.a.ff){t.next=36;break}return t.prev=11,t.next=14,navigator.serviceWorker.getRegistrations();case 14:i=t.sent,a=i,u=Array.isArray(a),s=0,a=u?a:a[Symbol.iterator]();case 16:if(!u){t.next=22;break}if(!(s>=a.length)){t.next=19;break}return t.abrupt("break",31);case 19:f=a[s++],t.next=26;break;case 22:if(!(s=a.next()).done){t.next=25;break}return t.abrupt("break",31);case 25:f=s.value;case 26:return v=f,t.next=29,v.unregister();case 29:t.next=16;break;case 31:t.next=36;break;case 33:t.prev=33,t.t0=t.catch(11),this.logger.critical(t.t0);case 36:h,e.on("post",h);case 38:case"end":return t.stop()}},t,this,[[11,33]])}))).apply(this,arguments)}function S(){return(S=g(regeneratorRuntime.mark(function t(e){var r,n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=new s.a(this.config),e.on("post",g(regeneratorRuntime.mark(function t(){var e,o,i,a,u=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e=u.length,o=new Array(e),i=0;i<e;i++)o[i]=u[i];return t.next=3,r.handleEvent({data:o});case 3:a=t.sent,n.onMessage({data:a});case 5:case"end":return t.stop()}},t)}))),r.intervalHandler.tick(!0);case 3:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}var O=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.logger,o=e.workerHref;this.logger=n,this.workerHref=o||x,this.config=e;var i=new f.EventEmitter,a=b.map).reduce,Promise.reject());a.then).catch),i.ready=a,this.emitter=i}return function(t,e,r){e&&m(t.prototype,e),r&&m(t,r)}(t,[{key:"post",value:function(){var t=g(regeneratorRuntime.mark(function t(){var e,r,n,o,i=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.emitter.ready;case 2:for(r=i.length,n=new Array(r),o=0;o<r;o++)n[o]=i[o];(e=this.emitter).emit.apply(e,["post"].concat(n));case 4:case"end":return t.stop()}},t,this)}));return}()},{key:"onMessage",value:function(t){var e,r=h(t.data),n=r[0],o=void 0===n?"":n,i=r.slice(1);this.logger[o]&&(e=this.logger)[o].apply(e,v(i))}}]),t}()r T={cdn:"//services.sdiapi.com/reporter/1.0.7.29/",reportUrl:"//reports.sdiapi.com/service/viceEvent",quiteMode:!0,circuitBreaker:{numberOfMessages:650,inMilliseconds:5,delayInSeconds:180},eventsCache:{maximumHash:3e3},indexedDB:{version:3,lastSupportedVersion:3,multipleReports:[0,1,2,4,6,7,10],skipCache:[5,24,30],hashByKeysMultipleReports:["type","data","url","authority"],hashByKeysDefault:["data","url","type","scriptType","authority","pageView"],uniqByType:{5:["data","url","type","scriptType","authority","pageView","timestamp"],13:["type","data.url","siteId","sectionId","zoneId"],14:["type","data.parentSrc","data.childSrc","siteId","sectionId","zoneId"],24:["data","url","type","scriptType","authority","pageView","timestamp"],25:["data.eventType","data.reportType","accountId","siteId","data.st","data.target.xpath","data.key"],40:["scriptType","data.eventType","data.reportType","accountId","siteId","data.initiator","data.target.id","data.target.class","data.target.type","data.target.name","data.requestUrl","data.key"]}},workerConfig:{sending:{chunksize:1e5}}}||{},R=T.circuitBreaker,P=T.reportUrl,A=[R.numberOfMessages||650,R.inMilliseconds||50,R.delayInSeconds||180],I={circuitBreaker:Symbol("circuit breaker"),circuitBreakerReportData:Symbol("circuit breaker data")},C=function(){function t(e){(this,t);var r=(e=e||{}).reporterExternalConfig||{},n=new o.a(e.log_level||"critical");if(this.logger=n,!e.uuid)throw new Error("Receiver: missing uuid");this.trafficPercentage=e.trafficPercentage||e.traficPercentage||{},void 0==this.trafficPercentage.type40&&(this.trafficPercentage.type40=0),this.uuid=e.uuid,this.__config=e,this.workerExternalConfig=e.workerExternalConfig||{},this.ReporterExternalConfig=e.reporterExternalConfig||{},this.reportServer=e.reportServer||P,this.baseLocation=e.baseLocation||window.location.href,this.circuitBreakerReport=null;var i=r.circuitBreaker?[r.circuitBreaker.numberOfMessages||A[0],r.circuitBreaker.inMilliseconds||A[1],r.circuitBreaker.delayInSeconds||A[2]]:A;this.circuitBreaker=new a.a(i,this.onCircuitBreaker.bind(this)),this.workerBinder=new O({},e,{logger:n,callback:this.onMessageFromWorker.bind(this)})),this.initWorker()}return(t,[{key:"onCircuitBreaker",value:function(t){"on"!==t?(this.digest(I.circuitBreaker,this.uuid,(new Date).getTime(),{}),this.logger.warn("Receiver > CircuitBreaker : has switched off")):this.logger.verbose("Receiver > CircuitBreaker : has switched  on")}},{key:"toBase64",value:function(t){if(!window.TextEncoder)return t;var e=(new window.TextEncoder).encode(t),r=String.fromCharCode.apply(String,e);return btoa(r)}},{key:"setDataForCircuitBreaker",value:function(t){this[I.circuitBreakerReportData]=this[I.circuitBreakerReportData]||t}},{key:"sendCircuitBreakerReport",value:function(){var t=this[I.circuitBreakerReportData];this.postToWorker("immediate",Date.now(),this.trafficPercentage,{data:{message:"circuitBreaker report"},pageView:t.pageView,type:20,url:this.baseLocation,timestamp:t.timestamp,timeView:t.timeView,timeZone:t.timeZone,accountId:t.accountId,sectionId:t.sectionId,siteId:t.siteId,zoneId:t.zoneId,buildTimestamp:t.buildTimestamp,scriptType:t.scriptType,authority:t.authority},{uuid:this.uuid,reportServer:this.reportServer})}},{key:"beforeUnload",value},{key:"onMessageFromWorker",value},{key:"postToWorker",value},{key:"digest",value:function(t,e,r,n){this.modifyReportContent(n);try{if(e!==this.uuid)throw new Error("Receiver: uuid miss matched.");switch(t){case"force-interval":case"clear-all-events":case"event":this.setDataForCircuitBreaker(n),this.circuitBreaker.tick();case"event-init":t="event";case"immediate":var o={uuid:e};this.__config.reportServer&&(o.reportServer=this.__config.reportServer);var i=[t,r,this.trafficPercentage,n,o];this.postToWorker.apply(this,i);break;case I.circuitBreaker:this.sendCircuitBreakerReport();break;case"ping":this.postToWorker(t,r);break;case"change-log-level":this.logger.setLevel(n);break;default:this.logger.error("Receiver: no such action (".concat(t,")."))}}catch(t){this.logger.warn(t)}}},{key:"initWorker",value:function(){var t=["init",0,this.workerExternalConfig,this.ReporterExternalConfig];this.postToWorker.apply(this,t)}},{key:"modifyReportContent",value:function(t){void 0==this.trafficPercentage["type"+t.type]?t.trafficPercentage=1e4:t.trafficPercentage=this.trafficPercentage["type"+t.type],this.ReporterExternalConfig.addUrlCache&&(t.addUrlCache=this.ReporterExternalConfig.addUrlCache)}},{key:"reInit",value}]),t}()var D=null;window.addEventListener("beforeunload");window.addEventListener("message",function(){var t,e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).data;if(Array.isArray(e)&&"string"==typeof e[0]){if("init"===e[0])return D&&D.reInit(),void(D=new C(e[1]));if(!D)throw new Error("no receiver!");(t=D).digest.apply(t,L(e))}})}])