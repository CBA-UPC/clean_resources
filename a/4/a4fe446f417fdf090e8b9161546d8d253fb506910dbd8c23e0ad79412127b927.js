import{createMarker as p,directive as t,NodePart as V,removeNodes as o,reparentNodes as N}from"../lit-html.js";const q=(t,o)=>{const l=t.startNode.parentNode;const i=o===undefined?t.endNode:o.startNode;const u=l.insertBefore(p(),i);l.insertBefore(p(),i);const N=new V(t.options);N.insertAfterNode(u);return N};const v=(part,value)=>{part.setValue(value);part.commit();return part};const C=(t,part,o)=>{const l=t.startNode.parentNode;const i=o?o.startNode:t.endNode;const u=part.endNode.nextSibling;if(u!==i){N(l,part.startNode,u,i)}};const D=const F=(list,start,end)=>{const map=new Map;for(let t=start;t<=end;t++){map.set(list[t],t)}return map};const G=new WeakMap;const H=new WeakMap;export const repeat=t((items,t,j)=>{let A;if(j===undefined){j=t}else if(t!==undefined){A=t}return t=>{if(!(t instanceof V)){throw new Error("repeat can only be used in text bindings")}const o=G.get(t)||[];const l=H.get(t)||[];const i=[];const u=[];const N=[];let index=0;for(const item of items){N[index]=A?A(item,index):index;u[index]=j(item,index);index++}let p;let h;let g=0;let m=o.length-1;let M=0;let k=u.length-1;while(g<=m&&M<=k){if(o[g]===null){g++}else if(o[m]===null){m--}else if(l[g]===N[M]){i[M]=v(o[g],u[M]);g++;M++}else if(l[m]===N[k]){i[k]=v(o[m],u[k]);m--;k--}else if(l[g]===N[k]){i[k]=v(o[g],u[k]);C(t,o[g],i[k+1]);g++;k--}else if(l[m]===N[M]){i[M]=v(o[m],u[M]);C(t,o[m],o[g]);m--;M++}else{if(p===undefined){p=F(N,M,k);h=F(l,g,m)}if(!p.has(l[g])){D(o[g]);g++}else if(!p.has(l[m])){D(o[m]);m--}else{const B=h.get(N[M]);const S=B!==undefined?o[B]:null;if(S===null){const W=q(t,o[g]);v(W,u[M]);i[M]=W}else{i[M]=v(S,u[M]);C(t,S,o[g]);o[B]=null}M++}}}while(M<=k){const W=q(t,i[k+1]);v(W,u[M]);i[M++]=W}while(g<=m){const S=o[g++];if(S!==null){D(S)}}G.set(t,i);H.set(t,N)}});