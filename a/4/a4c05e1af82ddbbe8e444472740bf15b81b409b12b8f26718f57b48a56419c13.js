!"undefined"!=typeof self?self:this,(function(){return {0:function(t,e,n){"use strict";n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return s})),n.d(e,"d",(function(){return u})),n.d(e,"g",(function(){return c})),n.d(e,"e",(function(){return a})),n.d(e,"f",(function(){return f}));var r=ar o=t.create,Object.create},1:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var r=function(){function e(){}return e.current=function(){var e="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==t?t:null;if(!e)throw new Error("Unsupported environment.");return e},e}()}).call(this,n(30))},12:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(0),i=function(){function t(t){void 0===t&&(t=o.create()),this.random=t,this._byteToHex=[];for(var e=this._byteToHex,n=0;n<256;++n)e[n]=(n+256).toString(16).substr(1)}return Object.defineProperty(t,"default",{get:enumerable:!1,configurable:!0}),t.prototype.next=function(){var t=this.random.next();return t[6]=15&t[6]|64,t[8]=63&t[8]|128,this.bytesToUuid(t)},t.prototype.bytesToUuid=function(t){var e=0,n=this._byteToHex;return n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]},t}(),o=function(){function t(){}return t.create=function(t){return void 0===t&&(t=!1),"undefined"!=typeof crypto&&crypto.getRandomValues&&!t?new s:new u},t}(),s=function(t){eturn Object(r.c)(e,t),e.prototype.next=function(){var t=new Uint8Array(16);return crypto.getRandomValues(t),t},e}(o),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._rnds=new Array(16),e}return Object(r.c)(e,t),e.prototype.next=function(){for(var t=0,e=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),this._rnds[t]=e>>>((3&t)<<3)&255;return this._rnds},e}(o)},129:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(23),i=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e=new r.a),this.loggers=t,this.state=e}return t.prototype.fatal=function(t,e,n){this.logger((function(r){return r.fatal(t,e,n)}))},t.prototype.error=function(t,e,n){this.logger(()},t.prototype.log=function(t,e){this.logger(()},t.prototype.replace=function(t){this.loggers.length=0;for(var e=t.length,n=0;n<e;n++)this.loggers.push(t[n])},t.prototype.logger=function(t){if(this.state.active())for(var e=this.loggers,n=e.length,r=0;r<n;r++)t(e[r])},t}()},13:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));var r,i={measurement:0,default:1,log:2};!function(t){t[t.measurement=0]="measurement",t[t.generic=1]="generic",t[t.log=2]="log"}(r||(r={}))},130:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(17);function i(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t||(t={}),Object(r.a)((,t,e),t}},17:function(t,e,n){"use strict";function r(t,e,n){for(var r=n.length,i=0;i<r;i++){var o=n[i];if(o)for(var s in o)o.hasOwnProperty(s)&&t(s,o[s])}}n.d(e,"a",(function(){return r}))},18:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return s}));var r=n(13);ar o={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function s(t,e){if("measurement"===t){var n=e.name;return delete e.name,n}if("log"===t){var r=o[e.level];return r="number"==typeof r?r:2,delete e.level,r.toString()}return t}},23:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(t){var e,n;this.config={debug:!1,logs:{}},t&&(this.config={debug:null!==(e=t.debug)&&void 0!==e?e:this.config.debug,logs:null!==(n=this.logs(t.logs))&&void 0!==n?n:this.config.logs})}return t.prototype.update=function(t){var e;this.config.debug=t.debug,this.config.logs=null!==(e=this.logs(t.logs))&&void 0!==e?e:this.config.logs},t.prototype.active=function(t){return!(null!=t&&!this.config.logs[t])&&this.config.debug},t.prototype.logs=function(t){return null==t?void 0:t.reduce((,{})},t}()},230:function(t,e,n){"use strict";n.r(e);var r,i=n(0),o={messages:[]},s=function(){function t(t){var e=this;this._func=t,this._executed=!1,this.execute=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e._executed||(e._result=e._func.apply(e,Object(i.f)([],Object(i.e)(t),!1)),e._executed=!0),e._result},this.executeOnce=this.execute}return Object.defineProperty(t.prototype,"executed",{get:function(){return this._executed},enumerable:!1,configurable:!0}),t}(),u=n(12),c=n(73),a=n(130),f=n(129),h=function(){eturn t.prototype.fatal=function(t,e,n){this._sender.postMessage({type:"log",log:{level:"fatal",message:this.prefix+t,error:e,data:n}})},t.prototype.error=function(t,e,n){this._sender.postMessage({type:"log",log:{level:"error",message:this.prefix+t,error:e,data:n}})},t.prototype.log=function(t,e){this._sender.postMessage({type:"log",log:{level:"log",message:this.prefix+t,data:e}})},t}(),l=function(){function t(){}return t.getIndexedDB=t.isSupported=t}(),d=function(){function t(){}return t.open=function(e,n,r,i){void 0===i&&(i=3);var o=l.getIndexedDB();return o?new Promise((function(s,u){var c=0,a=function(){try{!function(){c++;try{var i=o.open(e,n);i.onsuccess=function(e){var n=t.extractDb(i,e);n?s(n):u("Cannot receive db object. IndexedDb API is incompatible.")},i.onupgradeneeded=function(e){var n=t.extractDb(i,e);n?r(n):u("Cannot receive db object. IndexedDb API is incompatible.")},i.onerror=f,i.onblocked=function(){a()}}catch(t){f()}}()}catch(t){u(t.message)}},f=function(){if(c>=i)u("Error on opening IndexedDB '".concat(e,"'. Attempts count: ").concat(c,"."));else try{a()}catch(t){u(t)}};a()})):Promise.reject("Cannot instantiate IndexedDB factory.")},t.transaction=function(t,e,n){return new Promise((function(r,i){var o=t();o.transaction.oncomplete=o.transaction.onabort=o.transaction.onerror=e(o,n)}))},t.request=function(t,e){t.onsuccess=t.onerror=,t.addArray=function(e,n,r){var i=0,o=function(){if(i<n.length){var s=n[i];i++,t.request(e.add(s),o)}else r&&r()};o()},t.remove=function(t){var e=l.getIndexedDB();return function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:e=0,n.label=1;case 1:if(!(e<4))return[3,6];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,t()];case 3:return[2,n.sent()];case 4:return n.sent(),[3,5];case 5:return e++,[3,1];case 6:return[4,t()];case 7:return[2,n.sent()]}}))}))}((function(){return e?new Promise((function(n,r){var i=e.deleteDatabase(t);i.onsuccess=i.onerror=function(){r("Error on removing IndexedDB '".concat(t,"'"))},i.onblocked=)):Promise.reject("Cannot instantiate IndexedDB factory.")}))},t.extractDb=function(t,e){return t.result||e.target&&e.target.result},t}(),p=function(){function t(t){this._state=t}return t.prototype.fatal=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(r){switch(r.label){case 0:return t||e?[4,this.append("fatal",t,{error:e,data:n})]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.error=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(r){switch(r.label){case 0:return t||e?[4,this.append("error",t,{error:e,data:n})]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.log=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(n){switch(n.label){case 0:return t?[4,this.append("info",t,{data:e})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.append=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.database()];case 1:return(r=i.sent())&&this.active()?[4,d.transaction((function(){return r.transaction([t],"readwrite").objectStore(t)}),(,{type:t,message:e,error:n.error,data:n.data})]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},t.prototype.database=function(){var e;return Object(i.b)(this,void 0,void 0,(function(){var n,r=this;return Object(i.d)(this,(function(o){switch(o.label){case 0:return void 0===this._database&&this.active()?(n=this,[4,d.open(t.DbName,1,(function(t){var e,n;try{for(var r=Object(i.g)(["fatal","error","info"]),o=r.next();!o.done;o=r.next()){var s=o.value;t.objectStoreNames.contains(s)||t.createObjectStore(s,{keyPath:"id",autoIncrement:!0})}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}})).then((function(t){var e=return t.addEventListener("versionchange",e),t.addEventListener("close",e),t})).catch(()]):[3,2];case 1:n._database=o.sent(),o.label=2;case 2:return[2,null!==(e=this._database)&&void 0!==e?e:null]}}))}))},t.prototype.active=t.DbName="mcjs-logs",t}(),y=n(44),v=function(){function t(){}return t.load=function(e,n,r,i){if(r.forcePolyfills||"undefined"==typeof Promise||"undefined"==typeof Map||"undefined"==typeof Symbol){var o=void 0,s=r.polyfillsUrl||t.url(e,"/messaging-client-polyfills.js");try{o=e.importScripts(s)}catch(t){i.error("Error on loading polyfills from ".concat(s),t)}o&&"function"==typeof o.then?o.then(n):n()}else n()},t.url=function(t,e){var n=(t.location||"").toString();return Object(y.a)(n,e)},t}(),b=function(){function t(t){t&&"undefined"!=typeof XDomainRequest?this._xhr=new XDomainRequest:this._xhr=new XMLHttpRequest}return t.prototype.send=function(t){var e=this,n=this._xhr,r=t.type||"POST",i=t.body||"",o=t.url,s=t.timeout;return new Promise((function(t,u){n.open(r,o,!0),void 0!==s&&(n.timeout=s),e.subscribe(t,u,s),n.send(i)}))},t.prototype.subscribe=function(t,e,n){var r=this._xhr;r instanceof XMLHttpRequest?r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?t(r.responseText):e(r.responseText||r.responseType||"CORS problem"))}:(r.onload=r.onerror=function(){return e("XDomain CORS problem")},r.onprogress=function(){},r.ontimeout=n&&setTimeout((,n))},t}(),g=function(){function t(){}return t.prototype.send=function(t){if("undefined"!=typeof fetch)return this.fetch(t);var e=t.url.indexOf("://")>0||0===t.url.indexOf("//");return new b(e).send(t)},t.prototype.fetch=function(t){var e={body:t.body,method:t.type,credentials:t.credentials};return t.debugHeaders&&(e.headers=t.debugHeaders),fetch(t.url,e).then((function(t){var e=t.text();return t.status>=200&&t.status<300?e:e.then((function(t){return Promise.reject(t)}))})).catch((function(t){return t instanceof Error&&(t=t.message),Promise.reject(t)}))},t}(),_=function(){eturn Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),t.prototype.set=function(t,e){return this.has(t)||this._size++,this._data[t]=e},t.prototype.get=t.prototype.retrieve=function(t,e){var n=this._data[t];return void 0!==n?n:this.set(t,e())},t.prototype.delete=t.prototype.clear=t.prototype.forEach=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s,u;return Object(i.d)(this,(function(i){switch(i.label){case 0:for(r in e=this._data,n=[],e)n.push(r);o=0,i.label=1;case 1:return o<n.length?(s=n[o],e.hasOwnProperty(s)&&(u=t(e[s],s))instanceof Promise?[4,u]:[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},t.prototype.keys=function(){var t=this._data,e=new Array;for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},t.prototype.any=function(){var t=this._data;for(var e in t)if(t.hasOwnProperty(e))return t[e]},t.prototype.has=t}(),m=function(){this.maxMessageCount=15e3,this.maxEnqueueCount=300},w=function(){function t(t,e,n){void 0===n&&(n=null),this.queue=t,this._logger=e,this.config=new m,Object(a.a)(this.config,n)}return Object.defineProperty(t.prototype,"id",{get:function(){return this.queue.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this.queue.count},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.config.maxMessageCount},enumerable:!1,configurable:!0}),t.prototype.enqueue=function(t){var e=this.size-this.queue.count;if(!(e<=0)){var n=this.config.maxEnqueueCount;return t.length>n&&(this._logger.log("Exceed max enqueued count per request (".concat(n,"). Lost ").concat(t.length-n," messages.")),t=t.slice(0,n)),e<t.length&&(t=t.slice(0,e)),this.queue.enqueue(t)}},t.prototype.dequeue=t.prototype.destroy=function(){return this.queue.destroy()},t.prototype.dispose=t}(),j=function(){eturn Object.defineProperty(t.prototype,"count",{get:function(){return this._array.length},enumerable:!1,configurable:!0}),t.prototype.enqueue=function(t){var e;(e=this._array).push.apply(e,Object(i.f)([],Object(i.e)(t),!1))},t.prototype.clear=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this._array.length=0,[2]}))}))},t.prototype.dequeue=function(t){var e=this._array.length;return(t=Math.min(e,Math.max(t,0)))<=0?[]:this._array.splice(0,t)},t.prototype.destroy=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,()}))},t.prototype.dispose=function(){},t}(),O=function(){eturn t.create=function(e,n,r){return Object(i.b)(this,void 0,void 0,(function(){var o,s,u;return Object(i.d)(this,(function(i){switch(i.label){case 0:return o="mcjs:"+(n||e),[4,d.open(o,1,(function(e){e.objectStoreNames.contains(t.storageName)||e.createObjectStore(t.storageName,{autoIncrement:!0})}))];case 1:return s=i.sent(),u=new t(e,s),r?[4,u.clear()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2,u]}}))}))},Object.defineProperty(t.prototype,"count",{get:function(){return this._lastCount},enumerable:!1,configurable:!0}),t.prototype.enqueue=function(t){var e=this;return this.transaction((,void 0)},t.prototype.dequeue=function(t){var e=this;return this.transaction((function(n,r){var i=0;d.request(n.openCursor(),(function(o){o&&i<t?(r.push(o.value),o.delete(),i++,o.continue()):e.updateCount(n)}))}),new Array)},t.prototype.destroy=function(){return this.dispose(),d.remove(this._db.name)},t.prototype.dispose=function(){this._db.close()},t.prototype.clear=function(){return this.transaction((function(t){t.clear()}),void 0)},t.prototype.updateCount=function(t){var e=this;t.count().onsuccess=function(t){e._lastCount=+t.target.result}},t.prototype.open=function(e){return void 0===e&&(e="readwrite"),this._db.transaction([t.storageName],e).objectStore(t.storageName)},t.prototype.transaction=function(t,e){var n=this;return d.transaction((function(){return n.open()}),t,e)},t.storageName="messages",t}(),x=function(){function t(){}return Object.defineProperty(t,"localStorage",{get:function(){return void 0!==t._localStorage?t._localStorage:t._localStorage=t.local()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionStorage",{get:function(){return void 0!==t._sessionStorage?t._sessionStorage:t._sessionStorage=t.session()},enumerable:!1,configurable:!0}),t.local=function(){try{return"undefined"==typeof localStorage?null:(localStorage.getItem(""),localStorage)}catch(t){return null}},t.session=function(){try{return"undefined"==typeof sessionStorage?null:(sessionStorage.getItem(""),sessionStorage)}catch(t){return null}},t}(),S=function(){function t(t,e){this.queue=t,this.key=e}return t.parse=function(e){if(e&&0===e.indexOf(t.prefix,0)){var n=t.regex.queue.exec(e),r=t.regex.key.exec(e);if(n&&r){var i=new t(n[1],r[1]);return i._key=e,i}}return null},t.prototype.value=function(){return this._key||(this._key="".concat(t.prefix,"?q=").concat(encodeURIComponent(this.queue),"&k=").concat(encodeURIComponent(this.key)))},t.prefix="mcjs",t.regex={queue:/q=([\w-]+)/,key:/k=([\w-]+)/},t}(),I=function(){function t(t,e){this.queueId=t,this._storage=e}return t.prototype.length=function(){for(var t=0,e=this.keys();!e.next().done;)t++;return t},t.prototype.clear=function(){var t,e;try{for(var n=Object(i.g)(this.keys()),r=n.next();!r.done;r=n.next()){var o=r.value;this._storage.removeItem(o.value())}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t.prototype.has=function(t){var e=new S(this.queueId,t).value();return!!this._storage.getItem(e)},t.prototype.getItem=function(t){var e=new S(this.queueId,t).value(),n=this._storage.getItem(e);return this.toObject(n,e)},t.prototype.removeItem=function(t){var e=new S(this.queueId,t).value();this._storage.removeItem(e)},t.prototype.setItem=function(t,e){var n=new S(this.queueId,t).value(),r=JSON.stringify(e);try{return this._storage.setItem(n,r),!0}catch(t){return!1}},t.prototype.enumerate=function(){var t,e,n,r,o,s,u,c;return Object(i.d)(this,(function(a){switch(a.label){case 0:a.trys.push([0,5,6,7]),t=Object(i.g)(this.keys()),e=t.next(),a.label=1;case 1:return e.done?[3,4]:(n=e.value,r=n.value(),(o=this.toObject(this._storage.getItem(r),r))?[4,{value:o,key:n.key}]:[3,3]);case 2:a.sent(),a.label=3;case 3:return e=t.next(),[3,1];case 4:return[3,7];case 5:return s=a.sent(),u={error:s},[3,7];case 6:try{e&&!e.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 7:return[2]}}))},t.prototype.toObject=function(t,e){if(!t)return null;try{return JSON.parse(t)}catch(t){this._storage.removeItem(e)}return null},t.prototype.keys=function(){var t,e,n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:t=this._storage,e=new _,n=t.length-1,i.label=1;case 1:return n>=0?(n>=t.length&&(n=t.length-1),(r=t.key(n))?!(o=S.parse(r))||o.queue!==this.queueId||e.has(r)?[3,3]:(e.set(r,void 0),[4,o]):[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return n--,[3,1];case 4:return e.clear(),[2]}}))},t}(),q=function(){function t(t){this._storage=t,this._cache=new _,this._length=0,this._updateLength=!0}return t.prototype.length=function(){return this._updateLength&&(this._length=this._storage.length(),this._updateLength=!1),this._length},t.prototype.clear=t.prototype.has=function(t){return this._storage.has(t)},t.prototype.getItem=function(t){if(!this._storage.has(t))return this._cache.delete(t),null;var e=this._cache.get(t);return e||(e=this._storage.getItem(t),this._cache.set(t,e)),e},t.prototype.removeItem=function(t){this._storage.removeItem(t),this._cache.delete(t),this._updateLength=!0},t.prototype.setItem=function(t,e){var n=this._storage.setItem(t,e);return n&&(this._cache.set(t,e),this._updateLength=!0),n},t.prototype.enumerate=function(){var t,e,n,r,o,s,u,c,a,f,h,l,d;return Object(i.d)(this,(function(p){switch(p.label){case 0:p.trys.push([0,5,6,7]),t=Object(i.g)(this._cache.keys()),e=t.next(),p.label=1;case 1:return e.done?[3,4]:(c=e.value,(n=this.getItem(c))?[4,{key:c,value:n}]:[3,3]);case 2:p.sent(),p.label=3;case 3:return e=t.next(),[3,1];case 4:return[3,7];case 5:return r=p.sent(),f={error:r},[3,7];case 6:try{e&&!e.done&&(h=t.return)&&h.call(t)}finally{if(f)throw f.error}return[7];case 7:p.trys.push([7,12,13,14]),o=Object(i.g)(this._storage.enumerate()),s=o.next(),p.label=8;case 8:return s.done?[3,11]:(u=s.value,c=u.key,this._cache.has(c)?[3,10]:[4,u]);case 9:p.sent(),p.label=10;case 10:return s=o.next(),[3,8];case 11:return[3,14];case 12:return a=p.sent(),l={error:a},[3,14];case 13:try{s&&!s.done&&(d=o.return)&&d.call(o)}finally{if(l)throw l.error}return[7];case 14:return[2]}}))},t}(),k=function(){eturn t.create=function(e,n,r){void 0===r&&(r=!1);var i=x.localStorage;if(!i)return null;var o=new I((n||e)+"",i),s=new q(o);return r&&o.clear(),new t(e,s)},Object.defineProperty(t.prototype,"count",{get:function(){return this._memory.count+this._storage.length()},enumerable:!1,configurable:!0}),t.prototype.enqueue=function(t){var e,n;try{for(var r=Object(i.g)(t),o=r.next();!o.done;o=r.next()){var s=o.value,u=s.id;this._storage.setItem(u,s)||this._memory.enqueue([s])}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.clear=function(){this._storage.clear()},t.prototype.dequeue=function(t,e){var n,r,o,s,u=this._memory.dequeue(t);if(u.length>=t)return u;if(t-=u.length,!e){var c=this._storage,a=new Array,f=0;try{for(var h=Object(i.g)(c.enumerate()),l=h.next();!l.done;l=h.next()){var d=l.value,p=d.value;if(p&&(u.push(p),a.push(d.key),f++),f>=t)break}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}try{for(var y=Object(i.g)(a),v=y.next();!v.done;v=y.next()){var b=v.value;c.removeItem(b)}}catch(t){o={error:t}}finally{try{v&&!v.done&&(s=y.return)&&s.call(y)}finally{if(o)throw o.error}}}return u},t.prototype.destroy=t.prototype.dispose=function(){this._memory.dispose()},t}(),E=function(){function t(){}return t.prototype.audit=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,e.update((function(e){r={cid:e.statistic.clientId,uid:n.current.userId,qid:e.statistic.queueId,bi:e.statistic.batchIndex,tmc:e.statistic.totalMessageCount,trec:e.statistic.totalRequestErrorCount,qmc:e.state.queueMessageCount,qs:e.state.queueSize,rec:e.statistic.requestErrorCount,bmc:t.envelops.length},e.statistic.requestErrorCount=0}))];case 1:if(i.sent(),!r)throw new Error("Statistic was not filled.");return[2,r]}}))}))},t}(),P=function(){function t(){}return t.create=function(t,e){return new C(t?e:void 0)},t}(),C=function(){function t(t){this._sender=t}return t.prototype.start=function(t){return this._sender,new M},t}(),M=function(){function t(){}return t.prototype.dequeued=function(t){},t.prototype.sent=function(){},t.prototype.confirmed=t.prototype.ended=function(){},t}(),D=function(){function t(t){this._stats=t}return t.prototype.start=t}(),T=function(){function t(t){this.stats=t}return t.prototype.result=function(t){return this.stats.update((function(e){var n=e.statistic;t||(n.requestErrorCount++,n.totalRequestErrorCount++),n.lastSendingSuccess=t}))},t}(),N=function(){function t(t){this._connectors=t}return t.prototype.batch=function(t){this._connectors.sender.postMessage({type:"performance",report:{type:"batch",data:t}})},t.prototype.messages=function(t){this._connectors.sender.postMessage({type:"performance",report:{type:"messages",data:t}})},t}(),B=function(t,e){void 0===e&&(e=0),this.envelops=t,this.index=e,this.errorCount=0},L=A=function(){function t(t,e,n,r,i,o,s){void 0===s&&(s=null),this.queue=t,this._batchStorage=e,this._batchDropStrategy=n,this._auditProvider=r,this._auditor=i,this._context=o,this._config=new L,Object(a.a)(this._config,s)}return t.prototype.next=function(t){return void 0===t&&(t=!1),Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return e=this._auditor.start(this.queue),[4,this.batch(e.stats,t)];case 1:return(n=r.sent())?[2,new R(n,e,this._batchDropStrategy)]:[2,void 0]}}))}))},t.prototype.destroy=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return[4,this._batchStorage.destroy()];case 1:return t.sent(),[4,this.queue.destroy()];case 2:return t.sent(),[2]}}))}))},t.prototype.batch=function(t,e){var n=this;return this._batchStorage.append((function(){return Object(i.b)(n,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.queue.dequeue(this._config.batchSize,e)];case 1:return(n=i.sent()).length?[4,t.update((function(t){return new B(n,++t.statistic.batchIndex)}))]:[2,void 0];case 2:return r=i.sent(),o=r,[4,this._auditProvider.audit(r,t,this._context)];case 3:return o.audits=i.sent(),[2,r]}}))}))}),e)},t}(),R=function(){function t(t,e,n){this._consumption=t,this._auditor=e,this._batchDropStrategy=n}return Object.defineProperty(t.prototype,"batch",{get:function(){return this._consumption.batch},enumerable:!1,configurable:!0}),t.prototype.ack=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return[4,this._auditor.result(!0)];case 1:return t.sent(),[4,this._consumption.ack()];case 2:return t.sent(),[2]}}))}))},t.prototype.nack=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:return this.batch.errorCount++,[4,this._auditor.result(!1)];case 1:return e.sent(),[4,this._auditor.stats.read()];case 2:return t=e.sent(),this._batchDropStrategy.shouldBeDropped(t,this.batch)?[4,this._consumption.ack()]:[3,4];case 3:return e.sent(),[3,6];case 4:return[4,this._consumption.nack()];case 5:e.sent(),e.label=6;case 6:return[2]}}))}))},t}(),z=function(){this.fillThreshold=.6,this.attemptCount=2},J=function(){function t(t){this._config=new z,Object(a.a)(this._config,t)}return t.prototype.shouldBeDropped=function(t,e){var n=t.state,r=this._config;return e.errorCount>=r.attemptCount&&n.queueMessageCount/n.queueSize>r.fillThreshold},t}(),F=function(){function t(t,e,n){this.id=t,this._syncTime=e,this._db=n}return t.create=function(e,n,r,o){return Object(i.b)(this,void 0,void 0,(function(){var s,u;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,t.db(e,r)];case 1:return s=i.sent(),u=new t(e,n,s),o?[4,u.clear()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2,u]}}))}))},t.db=function(e,n){var r="mcjs-batch:"+(n||e);return d.open(r,1,(function(e){e.objectStoreNames.contains(t.storageName)||e.createObjectStore(t.storageName,{keyPath:"batch.index"})}))},t.prototype.append=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.read()];case 1:return(e=i.sent())?[3,4]:[4,t()];case 2:return(e=i.sent())?[4,this.save(e)]:[3,4];case 3:i.sent(),i.label=4;case 4:return e?(n=e.index,[2,{batch:e,ack:function(){return r.reset(n)},nack:function(){return r.avoidAccess(n)}}]):[2,void 0]}}))}))},t.prototype.clear=function(){return this.transaction((function(t){t.clear()}),void 0)},t.prototype.destroy=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this._db.close(),[2,d.remove(this._db.name).catch()]}))}))},t.prototype.reset=function(t){return this.remove(t)},t.prototype.read=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e=this;return Object(i.d)(this,(function(n){switch(n.label){case 0:if(this._recovery)return[2,this._recovery];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.transaction((function(t,n){d.request(t.openCursor(),(function(t){if(t){var r=t.value;if(r&&e.isNotBlocked(r)){try{t.update(r)}catch(t){e.error("Error on updating batch Db.",t)}n.batch=r.batch}else t.continue()}}))}),{batch:void 0})];case 2:return[2,n.sent().batch];case 3:return t=n.sent(),this.error("Error on reading.",t),[2,void 0];case 4:return[2]}}))}))},t.prototype.save=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.transaction((function(e){d.request(e.add({batch:t,lastAccess:+new Date}))}),void 0)];case 1:return n.sent(),[3,3];case 2:return e=n.sent(),this._recovery=t,this.error("Error on saving.",e),[3,3];case 3:return[2]}}))}))},t.prototype.remove=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:this._recovery&&this._recovery.index===t&&(this._recovery=void 0),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.transaction((,void 0)];case 2:return n.sent(),[3,4];case 3:return e=n.sent(),this.error("Error on removing.",e),[3,4];case 4:return[2]}}))}))},t.prototype.avoidAccess=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.transaction((function(e){d.request(e.get(t),(function(t){t&&(t.lastAccess=void 0,e.put(t))}))}),void 0)];case 1:return n.sent(),[3,3];case 2:return e=n.sent(),this.error("Error on access avoiding.",e),[3,3];case 3:return[2]}}))}))},t.prototype.open=function(e){return this._db.transaction([t.storageName],e).objectStore(t.storageName)},t.prototype.transaction=function(t,e,n){var r=this;return void 0===n&&(n="readwrite"),d.transaction((function(){return r.open(n)}),t,e)},t.prototype.isNotBlocked=function(t){if(this._syncTime){var e=+new Date;if(t.lastAccess&&Math.abs(e-t.lastAccess)<this._syncTime)return!1;t.lastAccess=e}return!0},t.prototype.error=function(t,e){this.logger&&this.logger.error("[IndexedDb BS]:"+t,e)},t.storageName="batch",t}(),U=function(){function t(t,e){this.key=t,this._storage=e}return t.create=function(e,n,r){if(x.localStorage){var i=new t("mcjs-batch:"+(n||e),x.localStorage);return r&&i.clear(),i}},t.prototype.append=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return(n=this._cache||(e?void 0:this.read()))?[3,2]:(r=this,[4,t()]);case 1:(n=r._cache=i.sent())&&!e&&this.save(n),i.label=2;case 2:return n?[2,{batch:n,ack:function(){o._cache=void 0,e||o.reset()},nack:function(){}}]:[2]}}))}))},t.prototype.clear=function(){this.reset()},t.prototype.destroy=function(){this.clear()},t.prototype.read=function(){try{var t=this._storage.getItem(this.key);if(t)try{return JSON.parse(t)}catch(t){this._storage.removeItem(this.key)}}catch(t){this.log("Error on reading",t)}},t.prototype.save=function(t){try{var e=JSON.stringify(t);this._storage.setItem(this.key,e)}catch(t){this.log("Error on saving",t)}},t.prototype.reset=function(){try{this._storage.removeItem(this.key)}catch(t){this.log("Error on reseting",t)}},t.prototype.log=function(t,e){this.logger&&this.logger.error("[LStorage BS]:"+t,e)},t}(),W=function(){function t(){}return t.prototype.append=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:return this._batch?[3,2]:(e=this,[4,t()]);case 1:e._batch=r.sent(),r.label=2;case 2:return this._batch?[2,{batch:this._batch,ack:nack:function(){}}]:[2,void 0]}}))}))},t.prototype.clear=t.prototype.destroy=function(){this.clear()},t}(),K=function(){function t(t){var e=this;this.pipes=t,this.queues=new _,t.forEach(()}return t.prototype.start=t.prototype.terminate=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return[2,this.pipes.forEach(()]}))}))},t}(),H=n(43),X=function(){function t(t){if(this.index=0,this._urls="string"==typeof t?[t]:Object(i.f)([],Object(i.e)(t),!1),0===this._urls.length)throw new Error("Urls for round robins have no values")}return Object.defineProperty(t.prototype,"current",{get:enumerable:!1,configurable:!0}),t.prototype.next=function(){this.index++,this.index>=this._urls.length&&(this.index=0)},t}(),Q=n(13),V=n(18),Y=n(1),G=n(36),$=function(){function t(){}return t.current=function(t){if(void 0===t&&(t=Y.a.current()),t[G.b]){var e=t[G.b];return delete t[G.b],this._workerType="emulated-service-worker",e}return this._workerType="service-worker",t},t.getWorkerType=function(){return this._workerType},t}(),Z=tt=function(){eturn t.prototype.seal=function(t){var e=t._meta;return delete t._meta,this.envelop(e,t)},t.prototype.envelop=function(t,e){var n=new Z(t.type);return n.id=this._guid.next(),n.timestamp=t.timestamp||this._time.now(),n.tabId=t.tabId,n.name=Object(V.a)(n.type,e),n.message=e,"measurement"!==t.type&&(n.webview_bridge_fallback_reason=t.webview_bridge_fallback_reason),n},t}(),et=function(){eturn t.prototype.validate=function(t){if(!this.url){var e="Url for FE Analytics Collector is not set";throw t.fatal(e),new Error(e)}},t}(),nt=function(){function t(t,e,n,r,i,o){this._ajax=t,this._timestamp=e,this._environment=i,this._context=o,this._config=new et,this._postman=new tt(u.a.default,this._timestamp),Object(a.a)(this._config,r),this._config.validate(n),this._serializer=new rt(i.apiKey),this._error=new it(i),this._baseUrls=new X(this._config.url)}return t.prototype.send=function(t){var e,n,r=this,i=this.serialize(t);try{n=this._ajax.send({type:"POST",url:this.url(),body:i,timeout:this._config.timeout,debugHeaders:this.headers(t),credentials:(null===(e=this._environment.experiment)||void 0===e?void 0:e.includeCredentialsWithFallback)?"include":"same-origin"})}catch(e){e instanceof Error&&this.addAdditionalLog(t,{level:"error",applicationName:"mcjs-worker",message:"Failed to send messages with credentials: ".concat(e.message),stackTrace:e.stack}),n=this._ajax.send({type:"POST",url:this.url(),body:this.serialize(t),timeout:this._config.timeout,debugHeaders:this.headers(t)})}return n.then((function(t){var e=r._error.parse(t);return e?Promise.reject(e):Promise.resolve()}),(function(t){r._baseUrls.next();var e=r._error.parse(t)||{message:t};return Promise.reject(e)}))},t.prototype.addAdditionalLog=function(t,e){var n={_meta:{timestamp:this._timestamp.now(),type:"log"}};Object(H.a)(n,e);var r=this._postman.seal(n);t.envelops.push(r)},t.prototype.serialize=function(t){var e,n,r=this.audit(t),o={messaging_client_worker_type:$.getWorkerType()};r+="\n\n".concat(JSON.stringify(o),"\n");try{for(var s=Object(i.g)(t.envelops),u=s.next();!u.done;u=s.next()){var c=u.value;r+=this._serializer.serialize(c)+"\n"}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return r},t.prototype.audit=t.prototype.headers=function(t){if(this._environment.debug){var e=this.tabs(t);if(e)return[["X-Requested-With",e]]}},t.prototype.tabs=function(t){var e,n,r={},o=!1;try{for(var s=Object(i.g)(t.envelops),u=s.next();!u.done;u=s.next()){var c=u.value,a=r[c.id]=c.tabId;o=o||!!a}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return o?JSON.stringify({tabs:r}):void 0},t.prototype.url=function(){var t="".concat(this._baseUrls.current,"/v2_1?p=js&v=").concat(encodeURIComponent("1.13.1"),"&t=").concat(this._timestamp.now());return this._context.current.sessionId&&(t+="&sid="+encodeURIComponent(this._context.current.sessionId)),this._environment.debug&&(t+="&debug=true"),t},t}(),rt=function(){function t(t){this._apiKey=t,this.valueFilter=function(t,e){if(!(null===e||"number"==typeof e&&isNaN(e)))return e}}return t.prototype.serialize=function(t){var e=new Array;return e.push((t.timestamp||0).toString()),e.push(this._apiKey),e.push(t.name),e.push(""),e.push(this.type(t)),e.push(t.id),e.push(JSON.stringify(Object(i.a)(Object(i.a)({},t.message),{webview_bridge_fallback_reason:t.webview_bridge_fallback_reason}),this.valueFilter)),e.join(",")},t.prototype.type=function(t){return Object(V.b)(t.type).toString()},t}(),it=function(){function t(t){this._environment=t}return t.prototype.parse=function(t){var e,n;if(this._environment.debug)try{var r=JSON.parse(t).errors;if(r&&r.length>0){var o=new Array;try{for(var s=Object(i.g)(r),u=s.next();!u.done;u=s.next()){var c=u.value;o.push({description:c.message,data:this.message(c.line),index:c.index-3,validations:c.validations,unvalidatedFields:c.unvalidatedFields})}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return{message:"Errors in messages were occurred.",errors:o}}}catch(t){}},t.prototype.message=function(t){if("string"==typeof t){var e=t.split(",",6);if(6===e.length){var n=t.match(/\{.*\}/),r=n?n[0]:void 0;return{name:e[2],type:Q.b[+e[4]],id:e[5],payload:this.payload(r)}}}},t.prototype.payload=function(t){if(!t)return"";try{return JSON.parse(t)}catch(e){return t}},t}(),ot=st=function(){function t(t,e){void 0===e&&(e=null),this._repo=t,this.config=e,this._config=new ot,Object(a.a)(this._config,e),this._lastFlushTime=this._config.flushTime}return t.prototype.duration=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,this._repo.read()];case 1:return(t=r.sent()).statistic.lastSendingSuccess?e=this._config.flushTime:(n=Math.max(t.statistic.requestErrorCount,1),e=Math.min(this._config.flushTime*n,this._config.maxFlushTime)),[2,this._lastFlushTime=e]}}))}))},t.prototype.syncTime=function(){return Math.max(20*this._lastFlushTime,this._config.maxFlushTime+5)},t}(),ut=n(27),ct=function(){function t(e,n){void 0===n&&(n=x.localStorage),this.taskId=e,this._storage=n,this._keys={x:"mcjs-mutex-x:"+e,y:"mcjs-mutex-y:"+e},this._storage&&!t.subscribed&&(t.subscribe(this._storage),t.subscribed=!0)}return t.prototype.capture=function(e){if(void 0===e&&(e=2e4),!this._storage||this._disposed)return!0;var n=this._storage,r=this._keys.x,i=this._keys.y,o=t.tabId,s=+new Date;n.setItem(r,o);var u=n.getItem(i),c=u?JSON.parse(u):null,a=c?Math.abs(s-c.time):NaN,f=!c||c.id===o||a>e;if(f){var h=JSON.stringify({id:o,time:s});n.setItem(i,h),t.allYKeys[this._keys.y]=!0}else t.allYKeys[this._keys.y]=!1;return this._isCaptured=f&&n.getItem(r)===o,this._isCaptured},t.prototype.dispose=function(){this._storage&&this._isCaptured&&!this._disposed&&(this._storage.removeItem(this._keys.y),this._isCaptured=!1,this._disposed=!0)},t.subscribe=t.releaseAll=function(e){var n=t.allYKeys;for(var r in n)n.hasOwnProperty(r)&&n[r]&&(e.removeItem(r),n[r]=!1)},t.tabId=u.a.default.next(),t.allYKeys={},t}();!r||(r={}));var at=function(){function t(t,e,n,r,i,o){void 0===o&&(o=new ct(t.queue.id+"-pipe")),this.batchBuilder=t,this.endpoint=e,this._flushTimeStrategy=n,this._logger=r,this._auditor=i,this._syncPoint=o,this._active=!0}return Object.defineProperty(t.prototype,"queueId",{get:enumerable:!1,configurable:!0}),t.prototype.start=function(){if(this._intervalId)throw new Error("Pipe already was started.");return this._intervalId={},this.subscribe(),this.schedule()},t.prototype.terminate=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this._active?(this.dispose(),[4,this.batchBuilder.destroy()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.dispose=function(){this._active&&(this._active=!1,this._intervalId&&(clearTimeout(this._intervalId),this._intervalId=void 0),this._syncPoint.dispose())},t.prototype.schedule=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e=this;return Object(i.d)(this,(function(n){switch(n.label){case 0:return this._active?[4,this._flushTimeStrategy.duration()]:[3,2];case 1:t=n.sent(),this._intervalId=setTimeout((function(){return Object(i.b)(e,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,3,4]),[4,this.flush()];case 1:return e.sent(),[3,4];case 2:return t=e.sent(),this._logger.error("[QID:".concat(this.queueId,"]: Error on flushing messages into the endpoint."),t),[3,4];case 3:return this.schedule(),[7];case 4:return[2]}}))}))}),t),n.label=2;case 2:return[2]}}))}))},t.prototype.subscribe=t.prototype.flush=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n,o,s,u=this;return Object(i.d)(this,(function(c){switch(c.label){case 0:return this._active?(t=this._auditor.start(this.batchBuilder.queue),e=!this._syncPoint.capture(this._flushTimeStrategy.syncTime()),[4,this.batchBuilder.next(e)]):[2];case 1:if(!(n=c.sent()))return[2];c.label=2;case 2:return c.trys.push([2,4,,6]),t.dequeued(n.batch),o=this.endpoint.send(n.batch).then((function(){return Object(i.b)(u,void 0,void 0,(function(){return Object(i.d)(this,(function(e){switch(e.label){case 0:return t.confirmed(r.Success),[4,n.ack()];case 1:return e.sent(),t.ended(),this._logger.log("[QID:".concat(this.queueId,"]: Batch ").concat(n.batch.index," was sent successfully."),{payload:n.batch}),[2]}}))}))})).catch((function(e){return Object(i.b)(u,void 0,void 0,(function(){var o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return o=e.errors?r.MessagesError:r.NetworkError,t.confirmed(o),o!==r.NetworkError?[3,2]:[4,n.nack()];case 1:return i.sent(),[3,4];case 2:return[4,n.ack()];case 3:i.sent(),i.label=4;case 4:return t.ended(),this._logger.error("[QID:".concat(this.queueId,"]: Batch ").concat(n.batch.index," was sent with error."),e,{payload:n.batch}),[2]}}))}))})),t.sent(),[4,o];case 3:return c.sent(),[3,6];case 4:return s=c.sent(),[4,n.nack()];case 5:throw c.sent(),s;case 6:return[2]}}))}))},t}(),ft=n(57),ht=function(){function t(t){this._connectors=t,this._sender=new ft.a("ajax",this._connectors.sender,this._connectors.receiver)}return t.prototype.send=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e=this;return Object(i.d)(this,(function(n){return[2,new Promise(()]}))}))},t}(),lt=function(){function t(t,e,n,r,i,o){this._connectors=t,this._config=e,this._environment=n,this._context=r,this._statsProvider=i,this._logger=o,this.auditSender=new N(this._connectors)}return t.prototype.build=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n,r,o,s,u;return Object(i.d)(this,(function(c){switch(c.label){case 0:t=new _,c.label=1;case 1:c.trys.push([1,7,8,9]),e=Object(i.g)(this._config.endpoints),n=e.next(),c.label=2;case 2:return n.done?[3,6]:(r=n.value,[4,this.pipes(r)]);case 3:return[4,c.sent().forEach(()];case 4:c.sent(),c.label=5;case 5:return n=e.next(),[3,2];case 6:return[3,9];case 7:return o=c.sent(),s={error:o},[3,9];case 8:try{n&&!n.done&&(u=e.return)&&u.call(e)}finally{if(s)throw s.error}return[7];case 9:return[2,new K(t)]}}))}))},t.prototype.pipes=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s,u,c,a,f,h,l,d,p,y,v,b,g,m;return Object(i.d)(this,(function(j){switch(j.label){case 0:e=this.endpoint(t),n=new _,r=P.create(this._environment.performanceAudit,new N(this._connectors)),o=new D(this._statsProvider),j.label=1;case 1:j.trys.push([1,7,8,9]),s=Object(i.g)(t.queues),u=s.next(),j.label=2;case 2:return u.done?[3,6]:(c=u.value,f=w.bind,[4,this.queue(c)]);case 3:return a=new(f.apply(w,[void 0,j.sent(),this._logger,c])),[4,this.batchStorage(c)];case 4:h=j.sent(),l=new E,d=new J(c),p=new A(a,h,d,l,o,this._context,c),y=new st(this._statsProvider.get(a),c),v=new at(p,e,y,this._logger,r),n.set(c.id,v),j.label=5;case 5:return u=s.next(),[3,2];case 6:return[3,9];case 7:return b=j.sent(),g={error:b},[3,9];case 8:try{u&&!u.done&&(m=s.return)&&m.call(s)}finally{if(g)throw g.error}return[7];case 9:return[2,n]}}))}))},t.prototype.batchStorage=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){return t.persistent?(e=1.5*(t.maxFlushTime||30),[2,F.create(t.id,e,t.name,t.reset).then((function(e){return e.logger=n._logger,n._logger.log("Created persistent batch storage for id ".concat(t.id)),e})).catch((function(e){n._logger.log("Creating IndexedDb for batch storage was failed: ".concat(e?e.toString():"unknown"));var r=U.create(t.id,t.name,t.reset);return r?(r.logger=n._logger,n._logger.log("Downgraded to local storage batch storage for id ".concat(t.id,".")),r):(n._logger.log("Downgraded to memory batch storage for id ".concat(t.id,".")),new W)}))]):(this._logger.log("Created memory batch storage for id ".concat(t.id)),[2,new W])}))}))},t.prototype.queue=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){return t.persistent?(e=k.create(t.id,t.name,t.reset))?(this._logger.log("Created Local Storage queue for id ".concat(t.id)),[2,e]):[2,O.create(t.id,t.name,t.reset).then((function(e){return n._logger.log("Created persistent queue for id ".concat(t.id)),e})).catch((function(){return n._logger.log("Downgraded to memory queue for id ".concat(t.id,".")),new j(t.id)}))]:(this._logger.log("Created memory queue for id ".concat(t.id)),[2,new j(t.id)])}))}))},t.prototype.endpoint=function(t){var e=t;return"fe-analytic-collector"!==t.type&&this._logger.error("Endpoint type '".concat(t.type,"' is not supported")),new nt(this.ajax(),new c.a,this._logger,e,this._environment,this._context)},t.prototype.ajax=function(){return this._environment.fakeMode?new ht(this._connectors):new g},t}(),dt=function(){eturn t.prototype.route=function(e){var n=this.findQueue(e)||t.default,r=this._queues.get(n);return!r&&this._queues.size>0&&(r=this._queues.any()),r},t.prototype.findQueue=function(t){var e,n,r=this._routes.get(t.type);if(!r||!r.length)return null;try{for(var o=Object(i.g)(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(!u.properties)return u.queue;if(this.isMatch(t.message,u.properties))return u.queue}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return null},t.prototype.isMatch=function(t,e,n){if(void 0===n&&(n=10),0===n)return!0;for(var r in e)if(e.hasOwnProperty(r)){var i=t[r],o=e[r];if("object"==typeof i&&"object"==typeof o){if(!this.isMatch(i,o,n-1))return!1}else if(t[r]!==e[r])return!1}return!0},t.default="default",t}(),pt=function(){function t(){}return t.createRoutes=function(e){var n,r,o=new _;try{for(var s=Object(i.g)(e.messages),u=s.next();!u.done;u=s.next()){var c=u.value,a=o.get(c.type);a?a.push(c):(a=[c],o.set(c.type,a))}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}var f=new _;return o.forEach((function(e,n){e=e.sort((),f.set(n,e)})),f},t.weight=function(t,e){if(void 0===e&&(e=10),!t||e<=0)return 0;var n=0;for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];"object"==typeof i?n+=this.weight(i,e-1):n++}return n},t}(),yt=function(){eturn t.prototype.send=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s,u,c,a,f,h,l,d,p,y,v,b,g=this;return Object(i.d)(this,(function(m){switch(m.label){case 0:e=this._performanceAuditor.started(),n=new _,r=function(t){var e=o._postmaster.seal(t),r=o._router.route(e);r&&n.retrieve(r.id,().envelops.push(e)},o=this;try{for(s=Object(i.g)(t),u=s.next();!u.done;u=s.next())c=u.value,r(c)}catch(t){p={error:t}}finally{try{u&&!u.done&&(y=s.return)&&y.call(s)}finally{if(p)throw p.error}}a=new Array,n.forEach((function(t,n){var r=t.envelops;a.push([t.queue.enqueue(r),g._statisticAuditor.enqueued(n,r)]),e.enqueued(n,r)})),m.label=1;case 1:m.trys.push([1,6,7,8]),f=Object(i.g)(a),h=f.next(),m.label=2;case 2:return h.done?[3,5]:function(t){var e,n;try{for(var r=Object(i.g)(t),o=r.next();!o.done;o=r.next())if(o.value instanceof Promise)return!0}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!1}(l=h.value)?[4,Promise.all(l)]:[3,4];case 3:m.sent(),m.label=4;case 4:return h=f.next(),[3,2];case 5:return[3,8];case 6:return d=m.sent(),v={error:d},[3,8];case 7:try{h&&!h.done&&(b=f.return)&&b.call(f)}finally{if(v)throw v.error}return[7];case 8:return e.completed(),[2]}}))}))},t}(),vt=function(){function t(){}return t.create=function(t,e){return new bt(t?e:void 0)},t}(),bt=function(){function t(t){this._sender=t}return t.prototype.started=function(){return this._sender,new gt},t}(),gt=function(){function t(){}return t.prototype.enqueued=t.prototype.completed=function(){},t}(),_t=function(){function t(t){this._pipeStorages=t}return t.prototype.enqueued=function(t,e){return this._pipeStorages.increment(t,{totalMessageCount:e.length})},t}(),mt=function(){eturn t.prototype.get=function(t){var e=this._dictionary;return e[t.id]||(e[t.id]=this.create(t))},t.prototype.create=function(t){var e={get queueMessageCount(){return t.count},get queueSize;return new wt(t.id,e,this._pipeStatsStorage)},t}(),wt=function(){eturn t.prototype.update=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return e=this._state,[4,this._pipeStatsStorage.update(this._queueId,(function(r){n=t({statistic:r,state:e})}))];case 1:return r.sent(),[2,n]}}))}))},t.prototype.read=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:return t=this._state,[4,this._pipeStatsStorage.read(this._queueId)];case 1:return[2,{statistic:e.sent(),state:t}]}}))}))},t}(),jt=function(){eturn t.create=function(e){return void 0===e&&(e="mcjs-counters"),Object(i.b)(this,void 0,void 0,(function(){var n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,d.open(e,1,(function(e){e.objectStoreNames.contains(t.PipeStatisticsStorage)||e.createObjectStore(t.PipeStatisticsStorage,{keyPath:"queueId",autoIncrement:!1}),e.objectStoreNames.contains(t.ClientStorage)||e.createObjectStore(t.ClientStorage,{keyPath:"id",autoIncrement:!1})}))];case 1:return n=i.sent(),[4,t.clientId(n)];case 2:return r=i.sent(),[2,new t(n,r)]}}))}))},t.clientId=function(e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return n=e.transaction([t.ClientStorage],"readwrite").objectStore(t.ClientStorage),[4,d.transaction((function(){return n}),(function(e,n){d.request(e.get("default"),(function(r){r||(r={id:"default",clientId:t.guid.next()},e.add(r)),n.clientId=r.clientId}))}),{clientId:""})];case 1:return[2,r.sent().clientId]}}))}))},t.prototype.update=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.transaction((function(i,o){d.request(i.get(t),(function(o){o=n=r._recovery[t]||o||r.newData(t),e(o),i.put(o)}))}),void 0,"readwrite")];case 1:return i.sent(),this._recovery[t]=void 0,[3,3];case 2:return i.sent(),n||(n=this.newData(t),e(n)),this._recovery[t]=n,[3,3];case 3:return[2]}}))}))},t.prototype.increment=function(t,e){return this.update(t,()},t.prototype.read=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.transaction((function(e,r){d.request(e.get(t),(function(e){r.stats=n._recovery[t]||e||n.newData(t)}))}),{stats:{}},"readonly")];case 1:return e=r.sent(),this._recovery[t]=void 0,[2,e.stats];case 2:return r.sent(),[2,this._recovery[t]=this.newData(t)];case 3:return[2]}}))}))},t.prototype.clear=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this._recovery={},[2,this.transaction((,void 0)]}))}))},t.prototype.dispose=t.prototype.destroy=function(){return this.dispose(),this._recovery={},d.remove(this._db.name)},t.prototype.newData=function(t){return{clientId:this._clientId,queueId:t,batchIndex:0,lastSendingSuccess:!0,requestErrorCount:0,totalMessageCount:0,totalRequestErrorCount:0}},t.prototype.open=function(e){return this._db.transaction([t.PipeStatisticsStorage],e).objectStore(t.PipeStatisticsStorage)},t.prototype.transaction=function(t,e,n){var r=this;return void 0===n&&(n="readwrite"),d.transaction((,t,e)},t.guid=u.a.default,t.PipeStatisticsStorage="pipe-statistics",t.ClientStorage="client",t}(),Ot=function(){eturn t.create=function(e){return void 0===e&&(e=x.localStorage),e?new t(e):null},t.prototype.clientId=function(){var e=t._clientKey,n=this._clientId||this._storage.getItem(e);if(!n){n=u.a.default.next();try{this._storage.setItem(e,n)}catch(t){}}return this._clientId=n},t.prototype.update=function(t,e){var n=this.key(t),r=this._recovery[n]||this.get(n)||this.new(t);this.updateIncrements(r),e(r),this.set(n,r)},t.prototype.read=function(t){var e=this.key(t),n=this._recovery[e]||this.get(e);return n||(n=this.new(t),this.set(e,n)),n},t.prototype.increment=t.prototype.clear=function(){for(var e=this._storage,n=0;n<e.length;n++){var r=e.key(n);r&&0===r.indexOf(t._prefix)&&(e.removeItem(r),this._recovery[r]=void 0)}e.removeItem(t._clientKey)},t.prototype.destroy=function(){this.clear()},t.prototype.dispose=function(){},t.prototype.key=t.prototype.keyNonBlocked=function(e){return t._notBlockedPrefix+e+"|"+Math.floor(1e5*Math.random())},t.prototype.new=function(t){return{clientId:this.clientId(),queueId:t,batchIndex:0,totalMessageCount:0,totalRequestErrorCount:0,requestErrorCount:0,lastSendingSuccess:!1}},t.prototype.get=function(t){var e=this._storage.getItem(t);if(!e)return null;try{var n=JSON.parse(e);return n&&(n.clientId=this.clientId()),n}catch(t){return null}},t.prototype.set=function(t,e){try{this._storage.setItem(t,JSON.stringify(e,()),this._recovery[t]=void 0}catch(n){this._recovery[t]=e}},t.prototype.incrementRegex=function(e){return this._regexp[e]||(this._regexp[e]=new RegExp("^".concat(t._notBlockedPrefix).concat(e,"\\|\\d+$")))},t.prototype.collect=function(t){var e,n,r,o,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:e=this._storage,n=this.incrementRegex(t),r=e.length-1,i.label=1;case 1:if(!(r>=0))return[3,7];if(!(o=e.key(r)))return[3,6];if(!n.test(o))return[3,6];i.label=2;case 2:return i.trys.push([2,5,,6]),s=e.getItem(o),e.removeItem(o),s?[4,JSON.parse(s)]:[3,4];case 3:i.sent(),i.label=4;case 4:return[3,6];case 5:return i.sent(),[3,6];case 6:return r--,[3,1];case 7:return[2]}}))},t.prototype.updateIncrements=function(t){var e,n,r=0;try{for(var o=Object(i.g)(this.collect(t.queueId)),s=o.next();!s.done;s=o.next()){var u=s.value;u.totalMessageCount&&(r+=u.totalMessageCount)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}t.totalMessageCount+=r},t._prefix="mcjs-stats:",t._notBlockedPrefix="mcjs-stats-nb:",t._clientKey="mcjs-stats-client",t}(),xt=function(){function t(){this.clientId=u.a.default.next(),this._dictionary={}}return t.prototype.update=t.prototype.increment=function(t,e){this.get(t).totalMessageCount+=e.totalMessageCount},t.prototype.read=t.prototype.clear=t.prototype.destroy=t.prototype.dispose=function(){},t.prototype.get=function(t){var e=this._dictionary;return e[t]||(e[t]={clientId:this.clientId,queueId:t,batchIndex:0,totalMessageCount:0,totalRequestErrorCount:0,requestErrorCount:0,lastSendingSuccess:!1})},t}(),St=function(){eturn t.prototype.update=function(t){if(t){var e=this.current;e.userId=this.cast(t.userId||e.userId),e.sessionId=this.cast(t.sessionId||e.sessionId)}},t.prototype.cast=function(t){if(null!=t)return t+""},t}(),It=qt=n(55),kt=n(54),Et=n(24),Pt=n(56),Ct=function(){eturn t.prototype.postMessage=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s,u;return Object(i.d)(this,(function(c){switch(c.label){case 0:return[4,this._clients()];case 1:if(0===(e=c.sent()).length)return[2,Promise.reject("Don't see any clients")];c.label=2;case 2:c.trys.push([2,7,8,9]),n=Object(i.g)(e),r=n.next(),c.label=3;case 3:return r.done?[3,6]:[4,r.value.postMessage(t)];case 4:c.sent(),c.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return o=c.sent(),s={error:o},[3,9];case 8:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 9:return[2]}}))}))},t}(),Mt=function(){function t(t,e){this.terminate=new kt.a;var n=this.getSender(t),r=this._receiver=new qt.a(t,e);this.connectors=new It(n,r),this._messages=new Et.a("messages",r),this._configuration=new Et.a("configuration",r),this._terminate=new Pt.a("terminate",n,r,this.terminate),this._environment=new Et.a("environment",r),this._context=new Et.a("context",r)}return Object.defineProperty(t.prototype,"messages",{get:function(){return this._messages.event},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"configuration",{get:function(){return this._configuration.event},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"environment",{get:function(){return this._environment.event},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:enumerable:!1,configurable:!0}),t.prototype.dispose=t.prototype.getSender=function(t){if("clients"in t){var e=t;return new Ct(()}return t},t}();!function(){var t=$.current(),e=new f.a([]),n=new Mt(t,e);e.replace([new h(n.connectors.sender),new p(e.state)]);var r=new St;t.addEventListener("install",();var l=new s((function(s,f){e.state.update(f),v.load(t,(function(){return Object(i.b)(void 0,void 0,void 0,(function(){var t,h,l,d,p,y,v,b,g,_;return Object(i.d)(this,(function(m){switch(m.label){case 0:return t=new tt(u.a.default,new c.a),(l=Ot.create())?[3,2]:[4,jt.create().catch(()];case 1:l=m.sent(),m.label=2;case 2:return d=new mt(h=l),r.update(f.context),[4,(p=new lt(n.connectors,s,f,r,d,e)).build()];case 3:return y=m.sent(),v=new dt(o,y.queues),b=vt.create(f.performanceAudit,p.auditSender),g=new _t(h),_=new yt(v,t,g,b),n.messages.subscribe((function(t){_.send(t.messages)})),[4,y.start()];case 4:return m.sent(),n.terminate.handler=function(){return Object(i.b)(void 0,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,,4,5]),[4,y.terminate()];case 1:return t.sent(),[4,h.clear()];case 2:return t.sent(),[4,h.dispose()];case 3:return t.sent(),[3,5];case 4:return n.dispose(),[7];case 5:return[2]}}))}))},n.environment.subscribe((function(t){Object(a.a)(f,t.environment),e.state.update(t.environment)})),n.context.subscribe((),e.log("Worker was started successfully."),[2]}}))}))}),f,e)}));n.configuration.subscribe((function(t){try{l.executed&&r.update(t.environment.context),l.executeOnce(t.configuration,t.environment)}catch(t){e.error(t)}}))}()},24:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(34),i=function(){function t(t,e){var n=this;this.type=t,this._receiver=e,this.event=new r.a,this._handler=e.addEventListener(t,this._handler)}return t.prototype.dispose=t}()},27:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){eturn t.addListener=function(e){switch(t.mode){case"pagehide":return window.addEventListener("pagehide",e),!0;case"unload":return window.addEventListener("unload",e),!0;default:return!1}},t.removeListener=function(e){switch(t.mode){case"pagehide":return window.removeEventListener("pagehide",e),!0;case"unload":return window.removeEventListener("unload",e),!0;default:return!1}},t.mode="undefined"!=typeof window?window.onpagehide||null===window.onpagehide?"pagehide":"unload":"none",t}()},30:34:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){eturn t.prototype.subscribe=function(t){var e=this;return"function"==typeof t&&(this.subscribed(t)<0&&this._listeners.push(t),this._buffer.length>0&&setTimeout(()),this},t.prototype.unsubscribe=function(t){for(var e=this.subscribed(t);e>=0;)this._listeners.splice(e,1),e=this.subscribed(t);return this},t.prototype.clear=function(){this._listeners.length=0,this._buffer.length=0},t.prototype.emit=function(t){var e=this._listeners.length;if(e>0)for(var n=0;n<e;n++)try{this._listeners[n](t)}catch(t){}else this._buffer.push(t)},t.prototype.redirect=function(t){return this.subscribe((),t},t.prototype.map=t.prototype.subscribed=t.prototype.flushBuffer=function(){var t=this._buffer.slice();this._buffer.length=0;for(var e=t.length,n=0;n<e;n++)this.emit(t[n])},t}()},36:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return s}));var r=n(1),i=function(){function t(e){if(void 0===e&&(e=r.a.current()),void 0===e.document)throw new Error("No DOM environment is not supported.");this.loadScript=return t.loadViaDom=function(t,e,n){var r=t.createElement("script");r.type="text/javascript",r.src=e,n&&(r.onload=n),(t.body||t.head).appendChild(r)},t}(),o="MessagingClient-PseudoWorker",s=function(){function t(t,e){void 0===e&&(e=new i);var n=this;this._listeners=[],this._buffer=[],this._global=window,this._pseudoWorker=this._global[o]=new u(t,e,{raiseEvent:),e.loadScript(t)}return Object.defineProperty(t.prototype,"pseudoWorker",{get:enumerable:!1,configurable:!0}),t.prototype.postMessage=t.prototype.addEventListener=function(t,e){var n=this;"message"===t&&(this._listeners.push(e),setTimeout((function(){if(n._buffer.length>0){for(var t=n._buffer.slice(),e=t.length,r=0;r<e;r++)n.raiseEvent(t[r]);n._buffer.length=0}})))},t.prototype.removeEventListener=function(t,e){var n=this._listeners.indexOf(e);n>-1&&this._listeners.splice(n,1)},t.prototype.terminate=function(){this._buffer.length=0,this._listeners.length=0,this._pseudoWorker.close()},t.prototype.raiseEvent=function(t){var e=this._listeners,n=e.length;if(n>0)for(var r=0;r<n;r++)(0,e[r])(t);else this._buffer.push(t)},t}(),u=function(){function t(t,e,n){this._scriptLoader=e,this._internal=n,this._listeners=[],this._buffer=[],this.location=t}return t.prototype.postMessage=function(t){var e=this;t=JSON.parse(JSON.stringify(t)),setTimeout(()},t.prototype.importScripts=function(){for(var t,e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i=n.length,o=n.length,s=function(){--o<=0&&(e=!0,t&&t())},u=0;u<i;u++)this._scriptLoader.loadScript(n[u],s);return{then:function(n){e?n():t=n}}},t.prototype.addEventListener=function(t,e){var n=this;"message"===t&&(this._listeners.push(e),setTimeout((function(){if(n._buffer.length){for(var t=n._buffer.slice(),e=t.length,r=0;r<e;r++)n.raiseEvent(t[r]);n._buffer.length=0}})))},t.prototype.removeEventListener=t.prototype.raiseEvent=function(t){if(this._listeners.length)for(var e=this._listeners.length,n=0;n<e;n++)this._listeners[n](t);else this._buffer.push(t)},t.prototype.close=t.prototype.skipWaiting=t}()},43:function(t,e,n){"use strict";n.d(e,"a",();var r=n(17);function i(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t||(t={}),Object(r.a)((,t,e),t}},44:function(t,e,n){"use strict";function r(t,e){if("/"===e[0])return e;var n=t.lastIndexOf("/");return n<0?"/"+e:t.substring(0,n+1)+e}n.d(e,"a",(function(){return r}))},54:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o}));var r=n(0),i=function(){function t(t,e){var n=this;this.def=t,this.handler=e,this.invoke=return t.prototype.stop=function(){this.handler=void 0},t}(),o=function(){function t(t){var e=this;this._handler=t,this._buffer=new Array,this.invoke=function(t){return e.handler?e.handler(t):new Promise(()}}return Object.defineProperty(t.prototype,"handler",{get:function(){return this._handler},set:enumerable:!1,configurable:!0}),t.prototype.stop=function(){this.handler=void 0},t.prototype.flushBuffer=function(){var t,e;if(this._handler&&this._buffer.length>0)try{for(var n=Object(r.g)(this._buffer),i=n.next();!i.done;i=n.next()){var o=i.value;o.resolve(this.invoke(o.request))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t}()},55:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(0),i=function(){function t(t,e){var n=this;this._receiver=t,this._logger=e,this._dic={},this._buffers={},this._handler=function(t){var e,i,o=t.data;if(o&&o.type){var s=n._dic[o.type];if(s)try{for(var u=Object(r.g)(s),c=u.next();!c.done;c=u.next()){var a=c.value;try{a(o)}catch(t){n._logger.error("Error on executing listener for message type ".concat(o.type),t)}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(e)throw e.error}}else(n._buffers[o.type]||(n._buffers[o.type]=[])).push(t)}},t.addEventListener("message",this._handler)}return t.prototype.addEventListener=function(t,e){(this._dic[t]=this._dic[t]||[]).push(e),this.flushBuffer(t)},t.prototype.removeEventListener=function(t,e){var n=this._dic[t];if(n){var r=n.indexOf(e);r>=0&&n.splice(r,1),0===n.length&&delete this._dic[t]}},t.prototype.dispose=function(){this._dic={},this._buffers={},this._receiver.removeEventListener("message",this._handler)},t.prototype.flushBuffer=function(t){var e=this,n=this._buffers[t];n&&0!==n.length&&setTimeout((function(){for(var t=n.length,r=0;r<t;r++)e._handler(n[r]);n.length=0}))},t}()},56:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(t,e,n,r){var i=this;this.type=t,this._sender=e,this._receiver=n,this._handler=r,this._response=function(t){var e=t.messageId,n=t.type;i.type===n&&(e?i.awaitResponse(n,t.request,e):i.riseEvent(n,t.request))},n.addEventListener(t,this._response)}return t.prototype.dispose=function(){this._receiver.removeEventListener(this.type,this._response),this._handler.stop()},t.prototype.awaitResponse=function(t,e,n){var r=this._sender;function i(e){var i="";null!=e&&(i=e instanceof Error?e.message:e.toString()),r.postMessage({type:t,messageId:n,error:{message:i}})}function o(e){r.postMessage({type:t,messageId:n,response:e})}try{var s=this._handler.invoke(e);"undefined"!=typeof Promise&&s instanceof Promise?s.then(o,i):o(s)}catch(t){i(t)}},t.prototype.riseEvent=function(t,e){try{this._handler.invoke(e)}catch(t){}},t}()},57:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(12),i=function(){function t(t,e,n){var i=this;this.type=t,this._sender=e,this._receiver=n,this._dictionary={},this._guid=r.a.default,this._response=function(t){var e=t.messageId;if(e){var n=i._dictionary[e];delete i._dictionary[e],n&&(t.error?"function"==typeof n.reject&&n.reject(t.error):"function"==typeof n.resolve&&n.resolve(t.response))}},n.addEventListener(t,this._response)}return t.prototype.send=function(t,e,n){var r=this._guid.next();this._dictionary[r]={resolve:e,reject:n};var i=this._sender.postMessage({type:this.type,messageId:r,request:t});i&&"function"==typeof i.catch&&i.catch(n)},t.prototype.dispose=t}()},73:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(){}return t.prototype.now=t}()}})}));