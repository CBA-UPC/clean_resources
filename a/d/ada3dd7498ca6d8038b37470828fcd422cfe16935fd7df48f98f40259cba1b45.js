![,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"extractBatch",(function(){return extractBatch})),__webpack_require__.d(__webpack_exports__,"request",(function(){return request})),__webpack_require__.d(__webpack_exports__,"successResponse",(function(){return successResponse})),__webpack_require__.d(__webpack_exports__,"errorResponse",(function(){return errorResponse})),__webpack_require__.d(__webpack_exports__,"post",(function(){return post})),__webpack_require__.d(__webpack_exports__,"listen",(function(){return listen})),__webpack_require__.d(__webpack_exports__,"postAndForget",(function(){return postAndForget}));var com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);const extractBatch=request=(from,msg,args)=>({batch:{kind:"request",from:from,msg:msg,args:args||[]}}),successResponse=(from,msg,result)=>({batch:{kind:"response",from:from,msg:msg,success:!0,result:result}}),errorResponse=(from,msg,error)=>({batch:{kind:"response",error:error?String(error):"Unknown Error",from:from,msg:msg,success:!1}});function post(from,to,msg,args){return new Promise((resolve,reject)=>{const channel=new MessageChannel;channel.port1.onmessage=e=>{const batch=extractBatch(e);batch&&"request"!==batch.kind?batch.success?resolve(batch.result):reject(batch.error):(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("message","("+from+")","invalid response",e),reject("Invalid response"))},to.postMessage(request(from,msg,args),"*",[channel.port2])})}const listen=(from,listener)=>window.addEventListener("message",e=>{const batch=extractBatch(e);null!=batch&&batch.from===from&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.debug("message","("+from+")","recieved",batch),listener(batch,e))}),postAndForget=(from,to,msg,args)=>to.postMessage(request(from,msg,args),"*")},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"LogLevel",(function(){return LogLevel})),__webpack_require__.d(__webpack_exports__,"Log",(function(){return Log}));var com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_config__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_helpers_window__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4);let LogLevel;!LogLevel||(LogLevel={}));const instance=new class{oadStorageSettings(){const safeWindow=Object(_helpers_window__WEBPACK_IMPORTED_MODULE_2__.default)();if(null!=safeWindow&&"object"==typeof safeWindow.localStorage){"1"===safeWindow.localStorage.getItem("com.batch.private.logger.listeners")&&this.addGlobalEventListeners();const rawLevel=safeWindow.localStorage.getItem("com.batch.private.logger.level");if(null!=rawLevel){const level=+rawLevel;level>=0&&level<=6&&(this.level=level)}try{const rawEnabledModules=safeWindow.localStorage.getItem("com.batch.private.logger.modules.enabled");if(rawEnabledModules){const enabledModules=JSON.parse(rawEnabledModules);Array.isArray(enabledModules)&&enabledModules.forEach(m=>{this.enableModule(m)})}const rawDisabledModules=safeWindow.localStorage.getItem("com.batch.private.logger.modules.disabled");if(rawDisabledModules){const disabledModules=JSON.parse(rawDisabledModules);Array.isArray(disabledModules)&&disabledModules.forEach(}}catch(_){}}}addGlobalEventListeners(){const safeWindow=Object(_helpers_window__WEBPACK_IMPORTED_MODULE_2__.default)();null!=safeWindow&&(safeWindow.addEventListener("___batchSDK___.logger.enableModule",e=>this.enableModule(e.module)),safeWindow.addEventListener("___batchSDK___.logger.disableModule",,safeWindow.addEventListener("___batchSDK___.logger.setLogLevel",)}enableModule(module){this.enabledModules.add(module.toLowerCase())}enableTunneling(to){this.tunnelingTo=to}roupMethod(){return console.group}blic(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];this.log(LogLevel.Public,"public",...args)}rror(module){for(var _len3=arguments.length,args=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)args[_key3-1]=arguments[_key3];this.log(LogLevel.Error,module,...args)}warn(module){for(var _len4=arguments.length,args=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++)args[_key4-1]=arguments[_key4];this.log(LogLevel.Warn,module,...args)}info(module){for(var _len5=arguments.length,args=new Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++)args[_key5-1]=arguments[_key5];this.log(LogLevel.Info,module,...args)}trace(module){for(var _len6=arguments.length,args=new Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++)args[_key6-1]=arguments[_key6];this.log(LogLevel.Trace,module,...args)}og(level,moduleName){for(var _len8=arguments.length,args=new Array(_len8>2?_len8-2:0),_key8=2;_key8<_len8;_key8++)args[_key8-2]=arguments[_key8];if(this.tunnelingTo){const a=[];args.forEach(,com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__.postAndForget(this.name,this.tunnelingTo,"log",[level,this.name+":"+moduleName,...a])}level!==LogLevel.Public&&level!==LogLevel.PublicError||(moduleName="public"),this.isModuleEnabled(moduleName)&&this.shouldLogForLevel(level)&&this.logMethodForLevel(level).apply(console,[this.formatPrefix(moduleName),"-",...args])}grouped(level,module,groupTitle,lines){if(this.isModuleEnabled(module)&&this.shouldLogForLevel(level)){groupTitle?this.getGroupMethod().apply(console,[this.formatPrefix(module),"-",groupTitle]):this.getGroupMethod().apply(console,[this.formatPrefix(module)]);const logMethod=this.logMethodForLevel(level);lines.forEach(,this.getGroupEndMethod().apply(console,[])}}},outerSafeWindow=Object(_helpers_window__WEBPACK_IMPORTED_MODULE_2__.default)();null!=outerSafeWindow&&outerSafeWindow.addEventListener("message",e=>{const batch=com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__.extractBatch(e);null!=batch&&"request"===batch.kind&&"log"===batch.msg&&batch.args&&instance.log(...batch.args)});const Log=instance},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"SDK_API_LVL",(function(){return SDK_API_LVL})),__webpack_require__.d(__webpack_exports__,"SDK_VERSION",(function(){return SDK_VERSION})),__webpack_require__.d(__webpack_exports__,"SDK_MAJOR_VERSION",(function(){return SDK_MAJOR_VERSION})),__webpack_require__.d(__webpack_exports__,"SDK_DISMISS_NOTIF_AFTER",(function(){return SDK_DISMISS_NOTIF_AFTER})),__webpack_require__.d(__webpack_exports__,"RETRY_MAX_ATTEMPTS",(function(){return RETRY_MAX_ATTEMPTS})),__webpack_require__.d(__webpack_exports__,"RETRY_MIN_INTERVAL_MS",(function(){return RETRY_MIN_INTERVAL_MS})),__webpack_require__.d(__webpack_exports__,"SSL_SCRIPT_URL",(function(){return SSL_SCRIPT_URL})),__webpack_require__.d(__webpack_exports__,"WS_URL",(function(){return WS_URL})),__webpack_require__.d(__webpack_exports__,"IS_DEV",(function(){return IS_DEV})),__webpack_require__.d(__webpack_exports__,"IS_TEST",(function(){return IS_TEST}));const SDK_API_LVL="1",SDK_VERSION="2.3.0",SDK_MAJOR_VERSION="2",SDK_DISMISS_NOTIF_AFTER=30,RETRY_MAX_ATTEMPTS=3,RETRY_MIN_INTERVAL_MS=1e3,SSL_SCRIPT_URL="via.batch.com",WS_URL="https://ws.batch.com/web",IS_DEV=!1,IS_TEST=!1},function(module,__webpack_exports__,__webpack_require__){"use strict";_webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return safeGetWindow}))},,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return Event}));var _helpers_uuid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8);class Event{constructor(name,params){if("string"!=typeof name)throw new Error("Error while constructing Event: 'name' is required and should be a string");if(this.id=Object(_helpers_uuid__WEBPACK_IMPORTED_MODULE_0__.default)(),this.name=name.toUpperCase(),this.date=new Date,null!=params&&"object"!=typeof params)throw new Error("Error while constructing Event: 'params' is optional but must be an object if provided");this.params=params||{}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return uuid}));const supportsPRNG=void 0!==self.crypto&&void 0!==self.crypto.getRandomValues;,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return EventTracker}));var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(11),_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),_webservice_event_tracker__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(12),_webservice_http_error__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(16);class EventTracker{constructor(dev,webserviceExecutor){this.dev=dev,this.buffer=[],this.webserviceExecutor=webserviceExecutor,this.attemptRunning=!1,this.lastForbiddenLog=0}track(event){this.buffer.push(event),this.debounceSend&&clearTimeout(this.debounceSend),this.debounceSend=self.setTimeout(0)}send(){let retryCount=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return!(0===retryCount&&this.attemptRunning||0===this.buffer.length)&&(this.attemptRunning=!0,this.webserviceExecutor.start(new _webservice_event_tracker__WEBPACK_IMPORTED_MODULE_3__.default(this.buffer)).then(()=>{this.attemptRunning=!1,this.buffer=[],this.send()}).catch(e=>{retryCount+=1,retryCount<_config__WEBPACK_IMPORTED_MODULE_0__.RETRY_MAX_ATTEMPTS?Object(_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_1__.Delay)(_config__WEBPACK_IMPORTED_MODULE_0__.RETRY_MIN_INTERVAL_MS).then(:(this.attemptRunning=!1,e instanceof _webservice_http_error__WEBPACK_IMPORTED_MODULE_4__.default&&(401===e.response.status||403===e.response.status)&&Date.now()-this.lastForbiddenLog>1e4&&this.logForbiddenError())}),!0)}},function(module,__webpack_exports__,__webpack_require__){"use strict";webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Delay",(function(){return Delay})),__webpack_require__.d(__webpack_exports__,"Timeout",(function(){return Timeout}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return EventTrackerWebservice}));var _base__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13);class EventTrackerWebservice extends _base__WEBPACK_IMPORTED_MODULE_0__.default{etQuery(){return{payload:this.events.map(e=>Object.assign({},e,{date:e.date.toISOString()}))}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return BaseWebservice}));var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(14),_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(15);st DefaultHeaderKeys=[_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.CustomIdentifier,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.UserRegion,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.UserLanguage,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.UserProfileVersion,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.InstallationID,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.SDKAPILevel,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezone,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezoneOffset,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceDate,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceLanguage],BaseURL=`${_config__WEBPACK_IMPORTED_MODULE_0__.WS_URL}/${_config__WEBPACK_IMPORTED_MODULE_0__.SDK_VERSION}/`;,function(module,__webpack_exports__,__webpack_require__){"use strict";let ProfileKeys;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ProfileKeys",(function(){return ProfileKeys})),ProfileKeys||(ProfileKeys={}))},function(module,__webpack_exports__,__webpack_require__){"use strict";let SystemKeys;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"SystemKeys",(function(){return SystemKeys})),function(SystemKeys){SystemKeys.SDKAPILevel="lvl",SystemKeys.DeviceTimezone="dtz",SystemKeys.DeviceTimezoneOffset="dtzo",SystemKeys.DeviceDate="da",SystemKeys.DeviceLanguage="dla"}(SystemKeys||(SystemKeys={}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return HttpError}));class HttpError extends Error{constructor(response,message){super(message||`Response not ok. Status text: "${response.statusText}"`),this.response=response}}},,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);const isNull=isBuffer=deepEqual=__webpack_exports__.default=deepEqual},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"allowedKeyByProvider",(function(){return allowedKeyByProvider})),__webpack_require__.d(__webpack_exports__,"keysByProvider",(function(){return keysByProvider}));var _keys_profile__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14),_keys_session__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24),_keys_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(15);onst allowedKeyByProvider={profile:getValuesArrayForStringEnum(_keys_profile__WEBPACK_IMPORTED_MODULE_0__.ProfileKeys),session:getValuesArrayForStringEnum(_keys_session__WEBPACK_IMPORTED_MODULE_1__.SessionKeys),system:getValuesArrayForStringEnum(_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys)},keysByProvider={profile:_keys_profile__WEBPACK_IMPORTED_MODULE_0__.ProfileKeys,session:_keys_session__WEBPACK_IMPORTED_MODULE_1__.SessionKeys,system:_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys}},function(module,__webpack_exports__,__webpack_require__){"use strict";let SessionKeys;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"SessionKeys",(function(){return SessionKeys})),SessionKeys||(SessionKeys={}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return ParameterStore}));var _helpers_deep_obj_compare__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_persistence_indexed_db__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26),_persistence_session__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(28),_keys__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(23),_profile_parameter_provider__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(29),_session_parameter_provider__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(30),_system_parameter_provider__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(31);let storeInstance=null;class ParameterStore{constructor(p){this.providers=p}getParameterValue(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.system.indexOf(key)?this.providers.system.getParameterForKey(key):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.getParameterForKey(key):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.session.indexOf(key)?this.providers.session.getParameterForKey(key):Promise.reject(`Cannot read ${key}: it is not a managed key`)}async setParameterValue(key,value){return void 0===value||null==value?Promise.reject(`Refusing to write null/unknown for ${key}. Use removeParameterValue to do so explicitly.`):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.setParameterForKey(key,value):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.session.indexOf(key)?(await this.providers.session.setParameterForKey(key,String(value)),value):Promise.reject(`Cannot set ${key}: it is not a managed key`)}removeParameterValue(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.removeParameterForKey(key):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.session.indexOf(key)?this.providers.session.removeParameterForKey(key):Promise.reject(`Cannot delete ${key}: it is not a managed key`)}setOrRemoveParameterValueIfChanged(key,value){const definedValue=void 0===value?null:value;return new Promise((resolve,reject)=>{this.getParameterValue(key).then(oldValue=>{Object(_helpers_deep_obj_compare__WEBPACK_IMPORTED_MODULE_0__.default)(oldValue,value)?resolve(!1):null==definedValue?this.removeParameterValue(key).then(()=>resolve(!0)).catch(reject):this.setParameterValue(key,value).then(.catch(reject)},error=>{reject(error)})})},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _batch_error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(27);const tableName="BatchKVData";let dbInstance=null;class IndexedDbPersistence{constructor(db){if(!(db instanceof IDBDatabase))throw new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default("Unable to setup indexed db");this.db=db}getData(key){return new Promise((resolve,reject)=>{const query=this.db.transaction([tableName]).objectStore(tableName).get(key);query.onerror=reject,query.onsuccess=event=>{const data=event.target.result;resolve(void 0===data?null:data.value)}})}setData(key,value){return new Promise((resolve,reject)=>{const query=this.db.transaction([tableName],"readwrite").objectStore(tableName).put({k:key,value:value});query.onerror=reject,query.onsuccess=)}removeData(key){return new Promise((resolve,reject)=>{const query=this.db.transaction([tableName],"readwrite").objectStore(tableName).delete(key);query.onerror=reject,query.onsuccess=)}static getInstance(){return new Promise((resolve,reject)=>{if(dbInstance instanceof IndexedDbPersistence)resolve(dbInstance);else{indexedDB||reject(new Error("IndexedDB not available"));const request=indexedDB.open("BatchWebPush",1);request.onerror=request.onsuccess=event=>{const db=event.target.result;dbInstance=new IndexedDbPersistence(db),resolve(dbInstance)},request.onupgradeneeded=event=>{event.target.result.createObjectStore(tableName,{keyPath:"k"})}}})}}__webpack_exports__.default=IndexedDbPersistence},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return BatchError}));,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _helpers_window__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4);const safeWindow=Object(_helpers_window__WEBPACK_IMPORTED_MODULE_0__.default)();__webpack_exports__.default=,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _batch_error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(27),_keys__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23);__webpack_exports__.default=class{constructor(storageProvider){this.storage=storageProvider}async getParameterForKey(key){if(-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.profile.indexOf(key)){const value=await this.storage.getData(key);return void 0===value?null:value}throw new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(`Cannot read ${key}: it is not a managed profile key`)}setParameterForKey(key,value){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.profile.indexOf(key)?this.storage.setData(key,value):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(`Cannot set ${key}: it is not a managed profile key`))}removeParameterForKey(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.profile.indexOf(key)?this.storage.removeData(key):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(key+" is not a managed profile key"))}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _batch_error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(27),_keys__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23);__webpack_exports__.default=class{sync getParameterForKey(key){if(-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.session.indexOf(key)){const value=await this.storage.getData("com.batch."+key);return void 0===value?null:value}throw new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(`Cannot read ${key}: it is not a managed session key`)}setParameterForKey(key,value){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.session.indexOf(key)?this.storage.setData("com.batch."+key,value):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(`Cannot set ${key}: it is not a managed session key`))}removeParameterForKey(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.session.indexOf(key)?(this.storage.removeData("com.batch."+key),Promise.resolve()):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(`Cannot delete ${key}: it is not a managed session key`))}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_batch_error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27),_keys_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(15);class SystemParameterProvider{getParameterForKey(key){return new Promise(resolve=>{switch(key){case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.SDKAPILevel:resolve(_config__WEBPACK_IMPORTED_MODULE_0__.SDK_API_LVL);break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezone:resolve(SystemParameterProvider.getTimezone()||"");break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezoneOffset:resolve((new Date).getTimezoneOffset().toString());break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceLanguage:{const navigator=self.navigator;resolve(null!=navigator?navigator.language:"")}break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceDate:resolve((new Date).toISOString());break;default:throw new _batch_error__WEBPACK_IMPORTED_MODULE_1__.default(key+" is not a managed system key")}})}__webpack_exports__.default=SystemParameterProvider},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return WebserviceExecutor}));var _logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_http_error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(16);class WebserviceExecutor{sync start(ws){if("undefined"==typeof fetch)return Promise.reject(new Error("fetch API isn't available"));const options={body:"",cache:"no-cache",credentials:"omit",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),method:"POST",mode:"cors"};this.devMode||"string"!=typeof this.authKey||options.headers.set("X-Batch-Auth",this.authKey),this.devMode&&options.headers.set("X-Batch-Dev","true"),this.referrer&&options.headers.set("X-Batch-Referer",this.referrer);try{const body=await ws.getBody(this.parameterStore);options.body=JSON.stringify(body);const URL=ws.getBaseURL()+"/"+this.apiKey;_logger__WEBPACK_IMPORTED_MODULE_0__.Log.grouped(_logger__WEBPACK_IMPORTED_MODULE_0__.LogLevel.Info,"WSExecutor","Calling WS",["URL: "+URL,body,options]);const response=await fetch(URL,options);if(!response.ok)throw new _http_error__WEBPACK_IMPORTED_MODULE_1__.default(response);return _logger__WEBPACK_IMPORTED_MODULE_0__.Log.grouped(_logger__WEBPACK_IMPORTED_MODULE_0__.LogLevel.Info,"WSExecutor","WS finished successfuly",["Status text: "+response.statusText]),!0}catch(error){throw _logger__WEBPACK_IMPORTED_MODULE_0__.Log.error("WSExecutor","Error while executing WS",error),error}}}},,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"urlBase64ToUint8Array",();const urlBase64ToUint8Array=,,,,,,,,,,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9),com_batch_shared_event_event_tracker__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10),com_batch_shared_helpers_push_helper__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(36),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2),com_batch_shared_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(14),com_batch_shared_parameters_parameter_store__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(25),com_batch_shared_webservice_executor__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(32),com_batch_shared_webservice_executor_stub__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(53),com_batch_worker_notification_receiver__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(54),_config__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(3);com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.name="ServiceWorker",(_config__WEBPACK_IMPORTED_MODULE_10__.IS_DEV||!0===self.batchSDK_enable_debug_logging)&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.level=com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.LogLevel.Debug,com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.enableModule("*"));const moduleName="ServiceWorker",getLastKnownGoodConfiguration=()=>com_batch_shared_parameters_parameter_store__WEBPACK_IMPORTED_MODULE_6__.default.getInstance().then(.then(config=>{if("object"!=typeof config)throw new Error("Last config is missing or is not an object");if(!config.apiKey)throw new Error("Configuration error: 'apiKey' is mandatory");if(!config.subdomain)throw new Error("Configuration error: 'subdomain' is mandatory");if(!config.authKey)throw new Error("Configuration error: 'authKey' is mandatory");return"boolean"!=typeof config.dev&&(config.dev=!1),config}),getEventTracker=messageEventReceived=self.handleBatchSDKEvent=(eventName,event)=>{switch(eventName){case"pushsubscriptionchange":return(event=>Promise.all([com_batch_shared_parameters_parameter_store__WEBPACK_IMPORTED_MODULE_6__.default.getInstance(),getLastKnownGoodConfiguration()]).then(async results=>{const db=results[0],config=results[1];let subOptions=null;if(event.oldSubscription&&event.oldSubscription.options)subOptions=event.oldSubscription.options;else if(config.vapidPublicKey){subOptions={applicationServerKey:Object(com_batch_shared_helpers_push_helper__WEBPACK_IMPORTED_MODULE_3__.urlBase64ToUint8Array)(config.vapidPublicKey),userVisibleOnly:!0}}else com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.error(moduleName,"No 'vapidPublicKey' found in config");if(subOptions){if(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.debug(moduleName,"Updating registration"),await db.getParameterValue(com_batch_shared_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_5__.ProfileKeys.Subscribed))try{const sub=await self.registration.pushManager.subscribe(subOptions);if(!sub)throw new Error("null subscription");{await db.setParameterValue(com_batch_shared_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_5__.ProfileKeys.Subscribed,!0),await db.setParameterValue(com_batch_shared_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_5__.ProfileKeys.Subscription,sub.toJSON());const eventTracker=await getEventTracker(),params={from_change_event:!0,token:{protocol:"WPP",subscription:sub}};config.internal&&config.internal.referrer&&(params.referrer=config.internal.referrer),eventTracker.track(new com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__.default(com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.Subscribed,params))}}catch(err){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.error(moduleName,"Could not update subscription: ",err)}else com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.info(moduleName,"Unable to update the subscription because the user has opt-out")}}).catch(err=>{com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.error(moduleName,"Could not handle pushsubscriptionchange: ",err)}))(event);case"install":self.skipWaiting();break;case"push":return(event=>Promise.resolve().then(()=>{com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.debug(moduleName,"Got a push event",event);let notificationPayload=null;try{if(!event.data)throw new Error("No event data");notificationPayload=event.data.json()}catch(err){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.debug(moduleName,"Notification has no valid JSON payload: not a Batch push")}return"object"==typeof notificationPayload&&com_batch_worker_notification_receiver__WEBPACK_IMPORTED_MODULE_9__.default.isBatchPushPayload(notificationPayload)?(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.info(moduleName,"Notification event is a Batch push",event),com_batch_worker_notification_receiver__WEBPACK_IMPORTED_MODULE_9__.default.getInstance(com_batch_shared_parameters_parameter_store__WEBPACK_IMPORTED_MODULE_6__.default.getInstance()).then(receiver=>{if(!receiver.shouldDisplayNotifications())return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.info(moduleName,"User is not registred",event),Promise.resolve();const notificationData=null!=notificationPayload?receiver.getNotificationData(notificationPayload):null;return notificationData?self.registration.showNotification(notificationData.title,notificationData.params).then(.catch(:(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.error(moduleName,"Failed to generate push notification data"),Promise.resolve())}).catch(err=>{com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.error(moduleName,"Error while displaying push:",err)})):(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.debug(moduleName,"Notification is not a Batch push"),Promise.resolve())}).catch(err=>{com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.error(moduleName,"Unexpected error while handling pushEvent",err)}))(event);case"notificationclick":return((event);case"message":messageEventReceived(event);break;default:com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.debug(moduleName,"Got an unhandled event",eventName)}return Promise.resolve()}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return StubWebserviceExecutor}));,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return NotificationReceiver}));var com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),com_batch_shared_notification_payload__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(55),com_batch_shared_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14);const moduleName="NotificationReceiver";class NotificationReceiver{atic isConfigValid(config){if(config){const{apiKey:apiKey,subdomain:subdomain,authKey:authKey}=config;return"string"==typeof apiKey&&"string"==typeof subdomain&&"string"==typeof authKey}return!1}tNotificationData(rawPayload){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.debug(moduleName,"Raw payload",rawPayload);try{let configSmallIcon,configIcon;this.lastKnownConfiguration&&"string"==typeof this.lastKnownConfiguration.smallIcon&&(configSmallIcon=this.lastKnownConfiguration.smallIcon),this.lastKnownConfiguration&&"string"==typeof this.lastKnownConfiguration.defaultIcon&&(configIcon=this.lastKnownConfiguration.defaultIcon);const p=new com_batch_shared_notification_payload__WEBPACK_IMPORTED_MODULE_3__.Payload(rawPayload),notificationData={params:{actions:p.getActions().map(,badge:p.getBadgeImageURL()||configSmallIcon,body:p.getBody(),data:rawPayload,icon:p.getIconURL()||configIcon,image:p.getImageURL(),renotify:p.shouldRenotify(),requireInteraction:p.requireInteraction()||!1,silent:p.isSilent(),tag:p.getTag()},title:p.getTitle()};return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.debug(moduleName,"Notification data",notificationData),notificationData}catch(err){return void com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.error(moduleName,"Error while creating the notification:",err)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Action",(function(){return Action})),__webpack_require__.d(__webpack_exports__,"Payload",(function(){return Payload}));webpack_exports__.default=Payload}]);