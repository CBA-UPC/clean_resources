import{H as m,Q as h,L as a,A as d,B as c,I as r,O as n,N as b,Z as u,J as C}from"./vendor_6ed58054_r24-02-0_b0_t240129-161140.js";import{a as E}from"./vuex.esm-bundler_aa359dca_r24-02-0_b0_t240129-161140.js";import{u as O}from"./csrGlobalStoreAppState_f9ff4bfa_r24-02-0_b0_t240129-161140.js";import{c as y,W as w,bt as g,R as v}from"./index_31ad23dc_r24-02-0_b0_t240129-161140.js";import{useCsrViewStoreUpdatePassword as f}from"./csrViewStoreUpdatePassword_df31b06e_r24-02-0_b0_t240129-161140.js";import{H as x}from"./HeadingContainer_bcedf16a_r24-02-0_b0_t240129-161140.js";import{T as L}from"./TextField_69ef4928_r24-02-0_b0_t240129-161140.js";import{B as $}from"./ButtonFilledAndLink_63b1b973_r24-02-0_b0_t240129-161140.js";import{S as I}from"./SvgIcon_e55bd28a_r24-02-0_b0_t240129-161140.js";import{m as F,n as N,c as R,o as V,p as A}from"./lsanalytics-login_d6e95fa1_r24-02-0_b0_t240129-161140.js";import{_ as q}from"./_plugin-vue_export-helper_c27b6911_r24-02-0_b0_t240129-161140.js";import"./VRawMarkup_119eefb5_r24-02-0_b0_t240129-161140.js";import"./ErrorMessages_003296c8_r24-02-0_b0_t240129-161140.js";import"./i18n_4b81f106_r24-02-0_b0_t240129-161140.js";const B={emits:["loginSuccess","closeModal"],components:{HeadingContainer:x,SvgIcon:I,TextField:L,ButtonAndLink:$},data(){return{passcode:"",passcodeVerified:!1,passcodeFailed:!1,requestOTPFailed:!1,passcodeExpired:!1}},mounted(){F()},computed:{...m(f,["passcodeEmail"]),...m(y,["logoName","paths"]),...E("auth",["loggedIn"]),modifiedLogoName(){return this.logoName==="dockers"?`${this.logoName}-logo`:(this.isRedTabGlobalEnabled||this.isRedTabEnabled)&&this.type===this.$_types.CHECKOUT_GATE?`${this.logoName}-horizontal`:this.logoName},headingTitle(){return this.loggedIn?this.$t("i18n.passcodeSignedInSuccessText"):this.$t("i18n.verifyPasscode")},errors(){return this.requestOTPFailed?[{$message:this.$t("i18n.passcodeFailedText")}]:this.passcodeFailed?[{$message:this.$t("i18n.incorrectPasscodeText")}]:this.passcodeExpired?[{$message:this.$t("i18n.passcodeExpiredText")}]:[]}},methods:{...h(f,["submitOTP","requestOTP"]),...h(O,["displayProgressSpinner","hideProgressSpinner"]),async verifyPasscode(){if(this.passcode=this.passcode.trim(),this.passcodeIsTrimmed()){this.$store.commit("userProfileState/updateState",{property:"passcode",value:this.passcode}),this.resetErrors();const e=await this.$store.dispatch("userProfileState/submitOTP",this.passcodeEmail);if(e){const{status:t,cartMerged:l,emailAlreadyExists:p,errorType:i}=e;if(t===w.SUCCESS){if(this.passcodeVerified=!0,N(),this.$emit("loginSuccess",l,p,!0),typeof window=="object"&&window.LSCO&&window.LSCO.dtos&&window.LSCO.dtos.globalData&&window.LSCO.dtos.globalData.customer){const s=window.LSCO.dtos.globalData.customer;R(this.passcodeEmail,s.auth_status,s.levi_id,s.city,s.state,s.adobe_id,"one-time sign-in link")}}else i===g.INCORRECT_PASSCODE?(V(),this.passcodeFailed=!0):i===g.EXPIRED_PASSCODE&&(this.passcodeExpired=!0)}}},async onLinkClick(){try{this.displayProgressSpinner(),this.resetErrors(),A();const e=await this.requestOTP(this.passcodeEmail);e!=null&&e.success||(this.requestOTPFailed=!0)}catch{this.requestOTPFailed=!0}finally{this.hideProgressSpinner()}},passcodeIsTrimmed(){return this.passcode===this.passcode.trim()},clickContinueShopping(){this.$route.name===v.REGISTER&&this.$router.push({path:this.paths.root}),this.$emit("closeModal")},resetErrors(){this.requestOTPFailed=!1,this.passcodeFailed=!1,this.passcodeExpired=!1}}},D={class:"passcode"},U={class:"passcode-header"},G={class:"icon-wrapper"},K={class:"passcode-body"},H=["aria-label"],M={key:1,class:"passcode-verified"},W=["aria-label"];function j(e,t,l,p,i,s){const S=a("SvgIcon"),T=a("heading-container"),_=a("TextField"),P=a("button-and-link"),k=a("svg-icon");return d(),c("div",D,[r("div",U,[n(T,{class:"passcode-heading-container",title:s.headingTitle,details:e.loggedIn?"":e.$t("i18n.passcodeSentSuccessText",{_email_:e.passcodeEmail})},{"content-above":b(()=>[r("div",G,[n(S,{name:s.modifiedLogoName,title:"Levis Red tab Logo",height:"56",width:"72"},null,8,["name"])])]),_:1},8,["title","details"])]),r("div",K,[e.loggedIn?(d(),c("section",M,[n(k,{name:"checkmark-circle",title:"Checkmark",height:"32px",width:"32px",class:"checkmark-icon"}),r("button",{class:"continue-shopping btn btn-default","aria-label":e.$t("i18n.continueShoppingTextForOTP"),onClick:t[2]||(t[2]=(...o)=>s.clickContinueShopping&&s.clickContinueShopping(...o)),onKeypress:t[3]||(t[3]=u((...o)=>s.clickContinueShopping&&s.clickContinueShopping(...o),["enter"]))},C(e.$t("i18n.continueShoppingTextForOTP")),41,W)])):(d(),c("form",{key:0,method:"POST",action:"javascript:void(0);","aria-label":e.$t("i18n.newPasscodeText"),onSubmit:t[1]||(t[1]=o=>s.verifyPasscode())},[n(_,{modelValue:i.passcode,"onUpdate:modelValue":t[0]||(t[0]=o=>i.passcode=o),"label-text":e.$t("i18n.enterPasscode"),name:e.$t("i18n.enterPasscode").toLowerCase(),errors:s.errors,placeholder:e.$t("i18n.enterPasscode")},null,8,["modelValue","label-text","name","errors","placeholder"]),n(P,{class:"passcode-button-n-link","button-text":e.$t("i18n.submitCTATextforOTP"),"link-text":e.$t("i18n.newPasscodeText"),disabled:!i.passcode.length,onLinkClick:s.onLinkClick,onKeyup:u(s.onLinkClick,["enter"])},null,8,["button-text","link-text","disabled","onLinkClick","onKeyup"])],40,H))])])}const de=q(B,[["render",j],["__scopeId","data-v-d4a08147"]]);export{de as default};
