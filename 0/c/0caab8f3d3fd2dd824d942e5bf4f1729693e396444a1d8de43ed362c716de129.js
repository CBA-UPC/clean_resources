/**
 * Name: App Manager
 * Version: v1.16.36
 * Built-on: 12/6/2023
 * Author: Freshapps
 * License: ISC
 */

(function(){"use strict";bal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},regeneratorRuntime$1={exports:{}},_typeof={exports:{}};!_typeof),regeneratorRuntime$1);var runtime=regeneratorRuntime$1.exports(),regenerator=runtime;try{regeneratorRuntime=runtime}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=runtime:Function("r","regeneratorRuntime = r")(runtime)}function ownKeys$8(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread$8(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$8(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$8(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var KNOWN_ENTITIES={"MarketplaceManager.adapter":["Promise","ajax","page","product","locations","accountID","domain","galleryURL"],"EventReceiver.adapter":["iframeId","type","eventHandler"]},LOCAL_APP_ID=123456789,UNDER_DEVELOPMENT_LABEL$1="[In-Dev] ";function generateId(){return Math.floor(Date.now()*Math.random()).toString(36)}function isValidURL(t){var e=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,})(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return!t||!!e.test(t)}function validate(t,e){if(!KNOWN_ENTITIES.hasOwnProperty(t))throw new Error('Unknown entity "'.concat(t,'"'));if(!e)throw new Error('Invalid adapter object "'.concat(JSON.stringify(e),'"'));KNOWN_ENTITIES[t].forEach((function(r){if(!e.hasOwnProperty(r)&&"galleryURL"!==r)throw new Error('Expected "'.concat(t,'" to contain "').concat(r,'"'));if("galleryURL"===r&&!isValidURL(e[r]))throw new Error('Invalid Gallery URL format : "'.concat(e[r],'"'))}))}function pick(t,e){return Object.keys(t).filter(().reduceRight((,{})}ction normalizeCLIResponse(t,e,r){if(!t.product[e])return[];var a=t.product[e].location;function n(t,e){Object.keys(t).forEach((function(a){var n=t[a];n.url="".concat(r,"://localhost:10001/iframe/").concat(e||n.url),n.icon_url="".concat(r,"://localhost:10001/iframe/").concat(n.icon)}))}var o={id:LOCAL_APP_ID,version_id:LOCAL_APP_ID,configs:t.configs,subscribed_modules:t.subscribed_modules,endpoint_urls:t.endpoint_urls,features:t.features,displayName:"".concat(UNDER_DEVELOPMENT_LABEL$1).concat(t.displayName),placeholders:a,oauthConfigsList:t.oauth_configs_list};return!1===t.isAuthorized?n(o.placeholders,"oauth/local-testing-oauth-msg.html"):n(o.placeholders),[o]}unction _checkProtocol(){return(_checkProtocol=_asyncToGenerator(regenerator.mark((function t(e){return regenerator.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e({type:"GET",url:"https://localhost:10001/web/assets/freshworks_logo.svg"}).then((function(){return"https"}),();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var BASE_16=16;function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=Math.random()*BASE_16|0;return("x"===t?e:3&e|8).toString(BASE_16)}))}unction getStringify(){return window.Prototype&&Object.toJSON||JSON.stringify}var JSON$1={stringify:getStringify(),parse:JSON.parse};function getDataPipeHeaders(t,e,r,a){return t.isEdgeAuth?{"X-REQUEST-ID":uuidv4(),"content-type":"application/json","http-mkp-domain":t.domain,"http-mkp-route":e,"http-mkp-extnid":r,"http-mkp-versionid":a,heimdall:!0}:{"X-REQUEST-ID":uuidv4(),"content-type":"application/json","MKP-APIKEY":t.apiKey,"MKP-AUTH-TOKEN":t.authToken,"X-CSRF-TOKEN":t.csrfToken,"MKP-EXTNID":r,"MKP-VERSIONID":a,"MKP-ROUTE":e}}var localOauthRedirectParams=function(t){var e=document.URL;return e+="".concat(e.split("?")[1]?"&":"?","product=").concat(t)},CONFIGS={freshdesk:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=live"),APP_LIST_WITH_TEST_VERSION:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=test,live"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:17e3,DATA:5e3,SCHEDULE:5e3,REQUEST:17e3,SMI:21500}}},freshservice:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=live"),APP_LIST_WITH_TEST_VERSION:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=test,live"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:t.isEdgeAuth?"".concat(t.domain,"/neomarketplace"):"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:17e3,DATA:5e3,SCHEDULE:5e3,REQUEST:17e3,SMI:21500}}},freshsales:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?\nproduct=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:17e3,DATA:5e3,SCHEDULE:5e3,REQUEST:17e3,SMI:21500}}},mags:function(t){return{urls:{DATA_PIPE:"".concat(t.domain,"/data-pipe"),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.hostProduct)},timeouts:{PROXY:17e3,DATA:5e3,SCHEDULE:5e3,REQUEST:17e3,SMI:21500}}},modules:function(t){return{urls:{LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:17e3,DATA:5e3,SCHEDULE:5e3,REQUEST:17e3,SMI:21500}}},freshchat:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true"),APP_LIST_WITH_TEST_VERSION:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=test,live"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:17e3,DATA:5e3,SCHEDULE:5e3,REQUEST:17e3,SMI:21500}}},freshcaller:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true"),APP_LIST_WITH_TEST_VERSION:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=test,live"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:17e3,DATA:5e3,SCHEDULE:5e3,REQUEST:17e3,SMI:21500}}},freshconnect:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true"),APP_LIST_WITH_TEST_VERSION:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=test,live"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:17e3,DATA:5e3,SCHEDULE:5e3,REQUEST:17e3,SMI:21500}}},freshteam:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true"),APP_LIST_WITH_TEST_VERSION:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=test,live"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:17e3,DATA:5e3,SCHEDULE:5e3,REQUEST:17e3,SMI:21500}}},freshworks_crm:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&bundle=").concat(t.bundleID,"&detailed=true&type=1,4,6&enabled=true"),APP_LIST_WITH_TEST_VERSION:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&bundle=").concat(t.bundleID,"&detailed=true&type=1,4,6&enabled=true&installation_types=test,live"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:17e3,DATA:5e3,SCHEDULE:5e3,REQUEST:17e3,SMI:21500}}}};function initialize(t){var e=t.product;if(!CONFIGS.hasOwnProperty(e))throw new Error('Unsupported product "'.concat(e,'"'));return CONFIGS[e](t)}ar ACTIVATE_TIMEOUT=1e3;nction getOAuthTokens(t){return JSON$1.parse(window.localStorage.getItem(getKey(t)))||{}}function hasOAuthTokens(t){return Object.keys(getOAuthTokens(t)).length>0}function setOAuthTokens(t,e){return window.localStorage.setItem(getKey(t),JSON$1.stringify(e))}unction appendAgentOauthName(t){var e=t.find(();return e?"&oauth=".concat(e.name):""}function getAuthorizeUrl(t,e){return t.isLocal?"".concat(t.protocol,"://").concat(e.urls.LOCAL_OAUTH_URL).concat(appendAgentOauthName(t.oauthConfigsList)):t.authorizeUrl}function getOAuthSrc(t,e){return t.isLocal?e.urls.LOCAL_AGENT_OAUTH_HTML:e.urls.AGENT_OAUTH_HTML}function onMessage(t,e,r){var a=e.instances.filter(();if("agent_oauth_handshake"===t.data.type&&a.length>0)return t.data.hasOwnProperty("error")?e.interface({method:"showNotify",options:{message:t.data.error.message,type:"danger"}}):"authorize"===t.data.method?window.open(getAuthorizeUrl(a[0],r),"","height=600,width=800"):void(t.data.hasOwnProperty("tokens")&&(setOAuthTokens(a[0],{tokens:t.data.tokens}),a.forEach((function(t){t.element.src=t.getSourceURL(),setTimeout((,ACTIVATE_TIMEOUT)}))))}var sandboxConfigsList=[{property:"allow-popups-to-escape-sandbox",accountID:["260911","1681221346"],appID:["16896","346765"]}],defaultSandboxAttribute="allow-scripts allow-forms allow-same-origin allow-popups allow-modals allow-downloads",defaultAllowAttribute="geolocation; camera; microphone; autoplay",allowConfigsList=[];function getPrivilegeAttributes(t,e,r){var a=[];return null==t||t.forEach((function(t){var n=t.accountID.includes(e),o=t.appID.includes(r);n&&o&&a.push(t.property)})),a}function sandboxConfigs(){var t=getPrivilegeAttributes.apply(null,arguments);return t&&t.length>0?"".concat(defaultSandboxAttribute," ").concat(t.join(" ")):"".concat(defaultSandboxAttribute)}function allowConfigs(){var t=getPrivilegeAttributes.apply(null,arguments);return t&&t.length>0?"".concat(defaultAllowAttribute,"; ").concat(t.join("; ")):"".concat(defaultAllowAttribute)}function ownKeys$7(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread$7(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$7(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$7(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var CUSTOM_IPARAM_API="CustomIparamAPI",CUSTOM_IPARAM$2="custom_iparam",SET_CONFIGS="getConfigs",APPLY_EVENT$1="custom_iparam.apply",CANCEL_EVENT$1="custom_iparam.cancel",SUBMIT_EVENT="custom_iparam.submit",LISTEN_EVENT="custom_iparam.listen",AppInstance=function(){function t(e,r,a,n){var o=this;return _classCallCheck(this,t),Object.assign(this,e),this.location=r,this.appDetails=e,this.instanceId=generateId(),this.locationDetails=n.locations[this.location],this.appMgrConfigs=initialize(n),this.listens=["app.activated","app.deactivated"],this.intercepts=[],this.adapter=this.getAdapter(n),this.services=_objectSpread$7({},a),this.handshakePromise=new n.Promise((),this.eventListenerSignal=new AbortController,this.constructIframe()}return _createClass(t,[{key:"postMessage",value:,{key:"getContext",value:function(){return{product:this.adapter.hostProduct||this.adapter.product,productContext:this.adapter.productContext,currentHost:this.appDetails.currentHost,page:this.adapter.page,location:this.location,settings:this.configs,account:{full_domain:this.adapter.domain}}}},{key:"getAdapter",value:function(t){return t.productContext?t:_objectSpread$7(_objectSpread$7({},t),{},{productContext:{url:t.domain,name:t.hostProduct||t.product}})}},{key:"getAppContext",value:,{key:"isCustomIparam",value:,{key:"onMessage",value:function(t){var e,r=this;if("iframe:loaded"===t.data.type)return this.handshake.resolve(),this.isCustomIparam()?this.services[CUSTOM_IPARAM_API].process({method:SET_CONFIGS,options:{configs:this.configs,productConfigs:this.productConfigs,isInstall:this.isInstall}},this.getAppContext()):void 0;if(null===(e=this.adapter.heapInstance.getHeap())||void 0===e||e.track("Platform Service Used",{service:t.data.service,versionId:this.appDetails.versionId,appId:this.appDetails.id,appName:this.appDetails.displayName,features:this.appDetails.features,location:this.location,appType:this.appDetails.appType}),"EventAPI"===t.data.service)return this.services[t.data.service].process(t.data,this.getAppContext());if(t.data.service===CUSTOM_IPARAM_API)return this.services[t.data.service].responseHandler(t.data);var a={service:t.data.service,uniqId:t.data.uniqId};this.services[t.data.service].process(t.data,this.getAppContext()).then((function(t){a.respData=t,r.postMessage(a)})).catch(()}},{key:"initializeChannel",value:function(){var t=this;this.channel=new MessageChannel,this.channel.port1.onmessage=function(e){return t.onMessage(e)}}},{key:"getSourceURL",value:function(){if(this.isCustomIparam()||!isAgentOAuthApp(this.appDetails)||hasOAuthTokens(this.appDetails))return this.url;var t,e={versionId:this.appDetails.versionId,product:this.adapter.product};return this.locationDetails.hasViewport||(e.showPopup=!0),"".concat(getOAuthSrc(this.appDetails,this.appMgrConfigs),"?").concat((t=e,Object.keys(t).map((function(e){return[].concat("".concat(e,"=").concat(encodeURIComponent(t[e]))).join("&")})).join("&")))}},{key:"constructIframe",value:function(){var t,e,r,a,n=this,o=document.createElement("iframe");return o.sandbox=sandboxConfigs(sandboxConfigsList,null===(t=this.adapter.accountID)||void 0===t?void 0:t.toString(),null===(e=this.appDetails.id)||void 0===e?void 0:e.toString()),o.allow=allowConfigs(allowConfigsList,null===(r=this.adapter.accountID)||void 0===r?void 0:r.toString(),null===(a=this.appDetails.id)||void 0===a?void 0:a.toString()),o.id=this.instanceId,o.src=this.getSourceURL(),o.addEventListener("load",(function(){n.initializeChannel(),o.contentWindow.postMessage({type:"iframe:handshake",instanceId:n.instanceId,services:Object.keys(n.services),context:n.getContext()},"*",[n.channel.port2])})),this.element=o,{id:this.id,element:this.element,appInstance:this,iconURL:this.iconURL,location:this.location,displayName:this.displayName,trigger:function(t){return t.type===SUBMIT_EVENT?n.submitCustomIparam():t.type===LISTEN_EVENT?n.listenEvent(t.callback):n.triggerAppEvent(t)},removeEvent:this.eventListenerSignal}}},{key:"triggerAppEvent",value:function(t){var e=this;return this.handshakePromise.then((function(){var r;null===(r=e.adapter.heapInstance.getHeap())||void 0===r||r.track("Event Sent to App",{isLifeCycleEvent:e.listens.includes(t.type),eventName:t.type,versionId:e.appDetails.versionId,appId:e.appDetails.id,appName:e.appDetails.displayName,features:e.appDetails.features,location:e.location,appType:e.appDetails.appType}),e.services.EventAPI.route(t,[e])}))}},{key:"submitCustomIparam",value:function(){var t=this,e=this.services[CUSTOM_IPARAM_API];return e.process({method:"validate"},this.getAppContext()).then((function(){return e.process({method:"postConfigs"},t.getAppContext())}))}},{key:"listenEvent",value:function(t){window.addEventListener(APPLY_EVENT$1,(,{signal:this.eventListenerSignal.signal}),window.addEventListener(CANCEL_EVENT$1,(,{signal:this.eventListenerSignal.signal})}}]),t}(),SANDBOX_VALUES=["allow-scripts","allow-downloads","allow-top-navigation","allow-popups","allow-modals","allow-same-origin","allow-forms"],galleryInstance=function(){eturn _createClass(t,[{key:"getGallery",value:function(t){var e=this,r=this.constructGalleryURL(t);return{iframeElement:this.constructIframeElement(r),redirectUrl:r,redirect:}},{key:"constructIframeElement",value:function(t){var e=document.createElement("iframe");e.setAttribute("src",t),e.setAttribute("class","marketplace-gallery-iframe");var r=SANDBOX_VALUES.join(" ");return e.setAttribute("sandbox",r),this.adapter.iframeID&&e.setAttribute("id",this.adapter.iframeID),e}},{key:"redirectToRoute",value:,{key:"constructGalleryURL",value:function(t){var e=this.constructBaseURL(),r="".concat(e,"/client/#/create-session?"),a=this.getQueryParams(t);return r="".concat(r).concat(a),!1===this.adapter.isFreshID&&(r=t.iframeURL),r}},{key:"constructBaseURL",value:function(){var t=this.adapter,e=t.tenant,r=t.account,a=t.region,n="staging"===a?"freshcloud.io":"freshworks.com",o="us"!==a?"-".concat(a):"";return"dev"===a?"https://app-gallery-fa-dev-staging.freshcloud.io":"https://".concat(e,"-").concat(r,".appgallery").concat(o,".").concat(n)}},{key:"getQueryParams",value:function(t){var e=this.adapter,r=e.locale,a=e.pod,n=e.isFreshID,o=t.encryptedParam,i=t.initialRoute,s=t.option,c=t.theme,u=[{key:"param",value:o},{key:"pod",value:a},{key:"route",value:i}];r&&u.push({key:"locale",value:r}),c&&u.push({key:"theme",value:c}),!1===n&&u.push({key:"freshID",value:n});var p=u.reduce((function(t,e,r){return 0===r?"".concat(e.key,"=").concat(e.value):"".concat(t,"&").concat(e.key,"=").concat(e.value)}),u[0]);if(s){var l=encodeURI(JSON.stringify(s)||"");p="".concat(p,"&option=").concat(l)}return p}}]),t}(),ApiToken=function(){function t(e){var r=this;if(_classCallCheck(this,t),t.instance)return t.instance;t.instance=this,this.timeOut=null,this.adapter=e,"function"==typeof this.adapter.getApiToken&&this.adapter.authentication&&(this.apiToken=this.adapter.authentication.api_token,this.refreshInterval=this.convertEpochToUTC(this.adapter.authentication.refresh_at),setTimeout((,this.getRefreshInterval()))}var e;return _createClass(t,[{key:"refreshApiToken",value:(e=_asyncToGenerator(regenerator.mark((function t(e){var r,a=this;return regenerator.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getApiToken();case 3:r=t.sent,this.apiToken=r.api_token,this.refreshInterval=this.convertEpochToUTC(r.refresh_at),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("getApiToken failed",t.t0);case 11:return t.prev=11,clearTimeout(this.timeOut),this.timeOut=setTimeout((,this.getRefreshInterval()),t.finish(11);case 15:case"end":return t.stop()}}),t,this,[[0,8,11,15]])}))),function(t){return e.apply(this,arguments)})},{key:"getRefreshInterval",value:function(){var t=this.refreshInterval-(new Date).getTime(),e=69e5;return t<e?e:t}},{key:"convertEpochToUTC",value:,{key:"getApiToken",value:function(){return this.apiToken}}]),t}(),Heap=function(){function t(e){var r=this;if(_classCallCheck(this,t),t.instance)return t.instance;t.instance=this,this.RETRY_LIMIT=50,this.heap=null,this.adapter=e,this.initHeapScript().then((function(){r.setHeapInstance()}))}return _createClass(t,[{key:"parseJwt",value:,{key:"setUserIdentity",value:function(){var t=this.parseJwt(this.adapter.authToken);if(t){var e,r=null==t||null===(e=t.user)||void 0===e?void 0:e.id;this.heap.identify(r)}}},{key:"setHeapInstance",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null===this.heap&&window.MarketplaceHeap?(this.heap=new window.MarketplaceHeap(getHeapProjectID()),this.heap.onHeapLoaded().then((function(){t.setUserIdentity(),t.heap.addUserProperties({product:t.adapter.product,page:t.adapter.page,accountDomain:t.adapter.domain,isAdmin:t.adapter.isAdmin})}))):e<this.RETRY_LIMIT&&this.setHeapInstance(e+1)}},{key:"initHeapScript",value:function(){return new Promise((function(t,e){if(0===document.querySelectorAll('[src="https://cdn.freshdev.io/assets/marketplace-heap.js"]').length){var r=document.createElement("script");r.type="text/javascript",r.onload=r.src="https://cdn.freshdev.io/assets/marketplace-heap.js",r.onerror=document.body.appendChild(r)}else t()}))}},{key:"getHeap",value:]),t}(),DataAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.isProductAPI=!1}return _createClass(t,[{key:"process",value:function(t,e){var r;if("currentHost"===t.options.attribute){var a={currentHost:e.app.currentHost};r=this.adapter.Promise.resolve(a)}else r=this.adapter.getAttribute(t.options.attribute);return r}}]),t}(),TIMEOUT_ERROR$1="Request timed out!",EventAPI=function(){eturn _createClass(t,[{key:"valid",value:function(t,e){var r=e?"interceptableEvents":"events";return this.adapter[r].includes(t)}},{key:"postMessage",value:function(t,e){var r=this;return new this.adapter.Promise((function(a,n){r.requests["".concat(e.uniqId).concat(t.instanceId)]={resolve:a,reject:n},r.gc(e.uniqId),t.postMessage(e)}))}},{key:"route",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.adapter.instances;if("app.derender"===t.type)return removeElement(this.adapter.instances,r[0]);var a={service:"EventAPI",data:t.data,event:t.type,uniqId:generateId()};r.filter((function(e){return e.listens.includes(t.type)})).forEach((function(t){return t.postMessage(a)})),a.isIntercept=!0;var n=r.filter(().map(();return this.adapter.Promise.all(n).then(()}},{key:"process",value:function(t,e){var r,a=this,n=t.method;if("intercept"===n)return r=a.requests["".concat(t.uniqId).concat(t.instanceId)],delete a.requests["".concat(t.uniqId).concat(t.instanceId)],t.error?r.reject(t.error.message):r.resolve();!function(){var r=t.options.event,o=!!t.options.intercept;if(a.valid(r,o)){var i=o?"intercepts":"listens";"off"===n?removeElement(e.app[i],r):"on"===n&&addElement(e.app[i],r)}}()}},{key:"gc",value:function(t){var e=this;setTimeout((function(){e.requests[t]&&(e.requests[t].reject({message:TIMEOUT_ERROR$1}),delete e.requests[t])}),this.adapter.interceptTimeout)}}]),t}();function ownKeys$6(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread$6(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$6(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$6(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var INVALID_KEY_MSG="Could not find an installation parameter that matches this key.",NO_CONFIGS_MSG="No installation parameters have been defined in iparams.json.",INVALID_KEY_TYPE_MSG="The key should be a non-empty string.",SECURE_IPARAM_MSG="Secure parameters cannot be retrieved. Use the Request APIs instead.",META="__meta",SECURE="secure",CUSTOM_IPARAM$1="custom_iparam",INVALID_METHOD$2="Method does not exist.",APPLY_EVENT="custom_iparam.apply",CANCEL_EVENT="custom_iparam.cancel",IparamAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e}return _createClass(t,[{key:"process",value:function(t,e){var r=this[t.method](t,e);return r.error?this.adapter.Promise.reject({message:r.error}):this.adapter.Promise.resolve(r)}},{key:"omitMeta",value:,{key:"getConfig",value:function(t,e){return"string"==typeof e&&e.length>0?t.hasOwnProperty(META)&&t[META].hasOwnProperty(SECURE)&&t[META][SECURE].includes(e)?{error:SECURE_IPARAM_MSG}:(t=this.omitMeta(t)).hasOwnProperty(e)?_defineProperty({},e,t[e]):{error:INVALID_KEY_MSG}:{error:INVALID_KEY_TYPE_MSG}}},{key:"get",value:function(t,e){var r=e.app.configs,a=t.options.attribute;return r?void 0===a?this.omitMeta(r):this.getConfig(r,a):{error:NO_CONFIGS_MSG}}},{key:"getState",value:function(t,e){return e.app.location===CUSTOM_IPARAM$1?e.app.state():{error:INVALID_METHOD$2}}},{key:"apply",value:function(t,e){if(e.app.location===CUSTOM_IPARAM$1){var r=new Event(APPLY_EVENT);return r.detail=t.options,window.dispatchEvent(r),{}}return{error:INVALID_METHOD$2}}},{key:"cancel",value:function(t,e){return e.app.location===CUSTOM_IPARAM$1?window.dispatchEvent(new Event(CANCEL_EVENT)):{error:INVALID_METHOD$2}}}]),t}(),md5$1={exports:{}};
/**
   * [js-md5]{@link https://github.com/emn178/js-md5}
   *
   * @namespace md5
   * @version 0.7.3
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   */
(function(module){(function(){var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=commonjsGlobal:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&module.exports,ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=,!ARRAY_BUFFER||!root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=;var createOutputMethod=createMethod=nodeWrap=d5.prototype.update=Md5.prototype.finalize=Md5.prototype.hash=Md5.prototype.hex=Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=var exports=createMethod();COMMON_JS?module.exports=exports:root.md5=exports})()})(md5$1);var md5=md5$1.exports,DEFAULT_TTL=6e5,DEFAULT_CACHE_KEY="mkp_cache_",MAX_RETRY=5,ClientCache=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DEFAULT_TTL,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DEFAULT_CACHE_KEY;_classCallCheck(this,t),this.default_ttl=e,this.cacheKeyPrefix=r}return _createClass(t,[{key:"getItem",value:function(t){var e=JSON.parse(window.sessionStorage.getItem(this.getHashedKey(t))||null);return e&&e.expires>Date.now()?e.data:null}},{key:"setItem",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.default_ttl,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:MAX_RETRY;try{window.sessionStorage.setItem(this.getHashedKey(t),JSON.stringify({expires:Date.now()+r,data:e}))}catch(o){var n=["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"];n.includes(o.name)&&a>=0&&(this.removeOldestItem(),this.setItem(t,e,r,a-1))}}},{key:"removeOldestItem",value:function(){var t=this.getAllItems(),e=Object.keys(t).sort((function(e,r){return JSON.parse(t[r]).expires-JSON.parse(t[e]).expires}));window.sessionStorage.removeItem(e[0])}},{key:"getHashedKey",value:function(t){return"".concat(this.cacheKeyPrefix).concat(t.versionId,"_").concat(md5(JSON.stringify(t)))}},{key:"getAllItems",value:function(){var t=this,e=JSON.parse(JSON.stringify(window.sessionStorage));return Object.keys(e).filter(().reduce((,{})}}]),t}();function ownKeys$5(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread$5(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$5(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$5(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var PROXY_ERROR_MSG="The URL should be a non-empty string.",INVALID_FEATURE="Invalid feature or feature not enabled.",TIMEOUT_ERR_MSG="Timeout error while processing the request.",SMI_ERROR_MSG="Attribute (methodName or methodParams) is of invalid type",TIMEOUT_STATUS=504,BAD_REQ_STATUS$1=400,REFRESH_ERROR_STATUS=210,ACCESS_TOKEN_EXPIRE_STATUS=401,RequestAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.configs=initialize(e),this.cacheManager=new ClientCache}return _createClass(t,[{key:"process",value:function(t,e){var r=t.options.feature;return void 0===r||"request"===r||e.app.features.indexOf(r)>-1?"oauth"===r&&e.app.isLocal?this.oauthHandler(e.app.protocol):"backend"===r?this.smiHandler(t,e):"request"===r?this.requestTemplateHandler(t,e):this.proxyHandler(t,e):this.adapter.Promise.reject({message:INVALID_FEATURE})}},{key:"isAgentOAuthRequest",value:function(t,e){return isAgentOAuthApp(e.app)&&t.data.isOAuth}},{key:"getRequestPayload",value:function(t,e){return Object.assign(t.options,"smi"!==t.mkpRoute&&this.isAgentOAuthRequest(t.options,e)?getOAuthTokens(e.app):{})}},{key:"isCacheEnabled",value:function(t){return("get"===t.options.data.method||"request"===t.mkpRoute)&&!!t.options.data.cache}},{key:"ajaxRequest",value:function(t,e){var r=this,a=null,n=this.isCacheEnabled(t);if(n){a={appId:t.appId,versionId:t.versionId,url:t.options.data.url,headers:t.options.data.headers,name:t.options.data.name,body:t.options.data.body,context:t.options.data.context};var o=this.cacheManager.getItem(a);if(o)return this.adapter.Promise.resolve(o)}var i={smi:this.configs.timeouts.SMI,proxy:this.configs.timeouts.PROXY,request:this.configs.timeouts.REQUEST,oauth:this.configs.timeouts.PROXY}[t.mkpRoute],s=this.getRequestPayload(t,e);return s=_objectSpread$5(_objectSpread$5({},s),{},{isInstall:this.adapter.isInstall}),this.adapter.ajax({url:t.isLocal?"".concat(e.app.protocol,"://").concat(this.configs.urls.LOCAL_DATA_PIPE):this.configs.urls.DATA_PIPE,type:"POST",timeout:i,data:JSON$1.stringify(s),headers:getDataPipeHeaders(this.adapter,t.mkpRoute,t.appId,t.versionId)}).then((function(e){return e&&e.status&&e.status>=BAD_REQ_STATUS$1?r.adapter.Promise.reject(e):(n&&r.cacheManager.setItem(a,e,t.options.data.ttl),r.adapter.Promise.resolve(e))}),(function(t){return 0===t.status&&"timeout"===t.statusText?r.adapter.Promise.reject({status:TIMEOUT_STATUS,headers:{},response:TIMEOUT_ERR_MSG}):r.adapter.Promise.reject(t.responseJSON||{status:t.status,headers:{},response:t.responseText})}))}},{key:"refreshRequest",value:function(t,e){var r=this,a=_objectSpread$5(_objectSpread$5({},t),{},{options:_objectSpread$5({},t.options)});return a.mkpRoute="oauth",a.options.action="refresh",this.ajaxRequest(a,e).then((function(a){return a&&a.status===REFRESH_ERROR_STATUS?r.adapter.Promise.reject(a):(r.isAgentOAuthRequest(t.options,e)&&a.hasOwnProperty("tokens")&&setOAuthTokens(e.app,{tokens:a.tokens}),r.adapter.Promise.resolve(a))}))}},{key:"proxyHandler",value:function(t,e){var r=this;return"string"!=typeof t.options.url?this.adapter.Promise.reject({status:BAD_REQ_STATUS$1,headers:{},response:PROXY_ERROR_MSG}):(t={mkpRoute:"proxy",options:{action:"execute",data:_objectSpread$5(_objectSpread$5({},t.options),{},{method:t.method,isInstall:this.adapter.isInstall})},isLocal:e.app.isLocal,appId:e.app.id,versionId:e.app.versionId},this.ajaxRequest(t,e).catch((function(a){return a&&a.status===ACCESS_TOKEN_EXPIRE_STATUS&&t.options.data.isOAuth?r.refreshRequest(t,e).then(():r.adapter.Promise.reject(a)})))}},{key:"oauthHandler",value:function(t){return location.href="".concat(t,"://").concat(this.configs.urls.LOCAL_OAUTH_REDIRECT),this.adapter.Promise.resolve({message:"success"})}},{key:"smiHandler",value:function(t,e){var r=t.options.methodName,a=t.options.methodParams;return"string"==typeof r&&a&&a.constructor===Object?(t={mkpRoute:"smi",options:{action:"invoke",methodName:r,methodParams:a,data:{isInstall:this.adapter.isInstall}},isLocal:e.app.isLocal,appId:e.app.id,versionId:e.app.versionId},this.ajaxRequest(t,e)):this.adapter.Promise.reject({message:SMI_ERROR_MSG,status:BAD_REQ_STATUS$1})}},{key:"requestTemplateHandler",value:function(t,e){var r=this;return t={mkpRoute:"request",options:{action:"execute",data:_objectSpread$5(_objectSpread$5({name:t.options.name},t.options.methodParams),{},{isInstall:this.adapter.isInstall,isOAuth:!0})},isLocal:e.app.isLocal,appId:e.app.id,versionId:e.app.versionId},this.ajaxRequest(t,e).then((function(a){return r.isAgentOAuthRequest(t.options,e)&&a.hasOwnProperty("tokens")&&(setOAuthTokens(e.app,{tokens:a.tokens}),delete a.tokens),r.adapter.Promise.resolve(a)}))}}]),t}();function ownKeys$4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread$4(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$4(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$4(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var findModalOf=function(t){return function(e){return e.parentId===t.instanceId}},findParentOf=findReceivers=function(t,e){return function(r){return e.includes(r.instanceId)&&r.id===t.id}},INVALID_METHOD$1="Method does not exist.",InstanceAPI=function(){eturn _createClass(t,[{key:"close",value:function(t,e){return this.adapter.interface({method:"closeInstance",options:{instanceId:e.app.instanceId}})}},{key:"resize",value:function(t,e){return this.adapter.interface({method:"resize",options:_objectSpread$4(_objectSpread$4({},t.options),{},{instanceId:e.app.instanceId})})}},{key:"get",value:function(t,e){var r=e.app,a=this.adapter.instances;return this.adapter.Promise.resolve(a.filter(().map(())}},{key:"send",value:function(t,e){var r=e.app,a=this.adapter.instances,n={service:t.service,data:t.options.message,event:"message"},o=null;return o=t.receiver&&0!==t.receiver.length?findReceivers(r,t.receiver):r.isModal?findParentOf(r):findModalOf(r),a.filter(o).forEach((function(t){return t.postMessage(n)})),this.adapter.Promise.resolve({})}},{key:"context",value:function(t,e){var r=e.app;return this.adapter.Promise.resolve({instanceId:r.instanceId,location:r.location,parentId:r.parentId,data:r.data||{}})}},{key:"process",value:function(t,e){return"function"==typeof this[t.method]?this[t.method](t,e):this.adapter.Promise.reject({message:INVALID_METHOD$1})}}]),t}();function ownKeys$3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread$3(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$3(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$3(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var TEMPLATE_MISSING="Missing required Parameter 'template'",OAUTH_TOKEN_REMOVE_SUCCESS="OAuth Tokens removed successfully",NO_TOKENS_FOUND="No OAuth tokens were found",InterfaceAPI=function(){eturn _createClass(t,[{key:"process",value:function(t,e){var r=e.app;if("resetOauth"===t.method)return hasOAuthTokens(r)?(clearOAuthTokens(r),this.adapter.Promise.resolve({message:OAUTH_TOKEN_REMOVE_SUCCESS})):this.adapter.Promise.reject({message:NO_TOKENS_FOUND});if(!this.adapter.overlays.includes(t.method))return this.adapter.interface(t);if(!t.options.hasOwnProperty("template"))return this.adapter.Promise.reject({message:TEMPLATE_MISSING});var a="".concat(r.url.substring(0,r.url.lastIndexOf("/")),"/").concat(t.options.template),n=new AppInstance(_objectSpread$3(_objectSpread$3({},r.appDetails),{},{url:a,data:t.options.data,parentId:r.instanceId,isModal:!0}),"overlay",r.services,{product:this.adapter.product,Promise:this.adapter.Promise,locations:this.adapter.locations,heapInstance:this.adapter.heapInstance,page:this.adapter.page,domain:this.adapter.domain,isAdmin:this.adapter.isAdmin});return this.adapter.instances.push(n.appInstance),this.adapter.interface(_objectSpread$3(_objectSpread$3({},t),{},{instance:n}))}}]),t}();function ownKeys$2(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread$2(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$2(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$2(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var DatastoreAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.configs=initialize(e)}return _createClass(t,[{key:"process",value:function(t,e){var r=this,a=e.app.isLocal?"".concat(e.app.protocol,"://").concat(this.configs.urls.LOCAL_DATA_PIPE):this.configs.urls.DATA_PIPE,n=t.options.route||"db";delete t.options.route;var o=_objectSpread$2(_objectSpread$2({},t.options),{},{action:t.method,isInstall:this.adapter.isInstall});return this.adapter.ajax({url:a,type:"POST",timeout:this.configs.timeouts.DATA,data:JSON$1.stringify(o),headers:getDataPipeHeaders(this.adapter,n,e.app.id,e.app.versionId)}).then((function(t){return r.adapter.Promise.resolve(t)}),(function(t){return r.adapter.Promise.reject(JSON$1.parse(t.responseText))}))}}]),t}();function ownKeys$1(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread$1(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$1(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var TIMEOUT_ERROR="Request timed out!",INVALID_METHOD="Invalid method provided.",UNEXPECTED_RESPONSE="Received unexpected response from client",VALID_METHODS=["getConfigs","postConfigs","validate"],SERVICE="CustomIparamAPI",VALIDATE="validate",TIMEOUT=15e3,CustomIparamAPI=function(){eturn _createClass(t,[{key:"process",value:function(t,e){var r=this;if(VALID_METHODS.indexOf(t.method)<0)return this.adapter.Promise.reject(INVALID_METHOD);var a=_objectSpread$1(_objectSpread$1({},t),{},{service:SERVICE,uniqId:generateId(),instanceId:e.app.instanceId});return new this.adapter.Promise((function(t,n){r.requests[a.uniqId]={resolve:t,reject:n},r.gc(a.uniqId),e.app.postMessage(a)}))}},{key:"responseHandler",value:function(t){if(this.requests[t.uniqId]){var e=this.requests[t.uniqId];return delete this.requests[t.uniqId],t.respData?t.method!==VALIDATE||t.respData.hasOwnProperty("isValid")&&t.respData.isValid?e.resolve(t.respData):e.reject(t.respData):e.reject({method:t.method,error:t.error})}return console.error("".concat(SERVICE," - ").concat(UNEXPECTED_RESPONSE),t)}},{key:"gc",value:function(t){var e=this;setTimeout((function(){e.requests[t]&&(e.requests[t].reject({message:TIMEOUT_ERROR}),delete e.requests[t])}),TIMEOUT)}}]),t}(),BAD_REQ_STATUS=400,ScheduleAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.configs=initialize(e)}return _createClass(t,[{key:"process",value:function(t,e){var r=this,a=e.app.isLocal?"".concat(e.app.protocol,"://").concat(this.configs.urls.LOCAL_DATA_PIPE):this.configs.urls.DATA_PIPE,n={schedule_params:t.options,action:t.method,account_full_domain:getHostName(this.adapter.domain),isInstall:this.adapter.isInstall};return this.adapter.ajax({url:a,type:"POST",timeout:this.configs.timeouts.SCHEDULE,data:JSON$1.stringify(n),headers:getDataPipeHeaders(this.adapter,"schedule",e.app.id,e.app.versionId)}).then((function(t){return t&&t.status&&t.status>=BAD_REQ_STATUS?r.adapter.Promise.reject(t):r.adapter.Promise.resolve(t)}),(function(t){return r.adapter.Promise.reject(t.response||t)}))}}]),t}();SERVICES={DataAPI:DataAPI,EventAPI:EventAPI,IparamAPI:IparamAPI,RequestAPI:RequestAPI,InstanceAPI:InstanceAPI,InterfaceAPI:InterfaceAPI,DataStoreAPI:DatastoreAPI,CustomIparamAPI:CustomIparamAPI,ScheduleAPI:ScheduleAPI},CUSTOM_IPARAM="custom_iparam",UNDER_DEVELOPMENT_LABEL="[In-Dev] ",MarketplaceManager=function(){function t(e){var r=this;_classCallCheck(this,t),validate("MarketplaceManager.adapter",e),this.configs=initialize(e),this.services={},this.channel="",this.isDev=-1!==window.location.search.indexOf("dev=true"),this.adapter=e,this.adapter.instances=[],this.adapter.theme=this.adapter.theme||"light",this.adapter.apiTokenInstance=new ApiToken(this.adapter),this.adapter.heapInstance=new Heap(this.adapter),Object.keys(SERVICES).forEach(();var a=new galleryInstance(this);return window.addEventListener("message",(function(t){"gallery:initialize"===t.data?a.channel=t.ports[0]:onMessage(t,r.adapter,r.configs)}),!1),this.adapter.page===CUSTOM_IPARAM?{createInstance:function(t){var a=pick(r.services,(),n=new AppInstance(_objectSpread(_objectSpread({},t),{},{protocol:t.protocol||"http",url:t.locations[CUSTOM_IPARAM].url,iconURL:t.locations[CUSTOM_IPARAM].icon_url,productConfigs:r.adapter.productConfigs,isInstall:r.adapter.isInstall}),CUSTOM_IPARAM,a,e);return r.adapter.instances.push(n.appInstance),n}}:{getApps:function(t){return r.getApps(t)},trigger:getMarketplaceViewerConfigs:getGallery:function(t){return a.getGallery(t)},getCollections:function(t){return r.getCollections(t)},getAppRecommendations:}var e;return _createClass(t,[{key:"getAppDetails",value:function(){return this.appDetails||(this.appDetails=this.adapter.Promise.all([this.makeCall(),this.makeCall(!0)]).then(flattenArray)),this.appDetails}},{key:"getCollections",value:function(t){var e="".concat(this.configs.urls.COLLECTION_APPS,"/").concat(t.name,"?account=").concat(this.adapter.accountID);return t.include&&(e+="&include=".concat(t.include)),this.adapter.ajax({method:"GET",headers:{"MKP-APIKEY":this.adapter.apiKey,accept:"application/json","X-CSRF-TOKEN":this.adapter.csrfToken,"MKP-AUTH-TOKEN":this.adapter.authToken},url:e})}},{key:"getAppRecommendations",value:function(t){var e="".concat(this.configs.urls.RECOMMENDATIONS_APPS,"?location=").concat(t);return this.adapter.ajax({method:"GET",headers:{Authorization:"Bearer ".concat(this.adapter.apiTokenInstance.getApiToken()),"Content-Type":"application/json"},url:e})}},{key:"getApps",value:function(t){var e=this;function r(e){return-1!==Object.keys(e.locations).indexOf(t.location)}if(!this.adapter.locations.hasOwnProperty(t.location))return this.adapter.Promise.resolve([]);return this.getAppDetails().then((function(a){var n,o=pick(e.services,(function(r,a){return!a.isProductAPI||e.adapter.locations[t.location].services.includes(r)})),i=a.filter(r).sort(t.sorter).map((function(r){return new AppInstance(_objectSpread(_objectSpread({},r),{},{url:r.locations[t.location].url,iconURL:r.locations[t.location].icon_url}),t.location,o,e.adapter)}));return(n=e.adapter.instances).push.apply(n,_toConsumableArray(i.map((function(t){return t.appInstance})))),i}))}},{key:"makeCall",value:(e=_asyncToGenerator(regenerator.mark((function e(r){var a,n,o,i,s=this;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||this.isDev){e.next=2;break}return e.abrupt("return",[]);case 2:if(a="",!r){e.next=7;break}return e.next=6,checkProtocol(this.adapter.ajax);case 6:a=e.sent;case 7:return n=function(e){return r&&(e=normalizeCLIResponse(e,s.adapter.product,a),s.adapter.interface({method:"showNotify",options:{message:'FDK serving local app "'.concat(e.map((),'"'),type:"info"}})),e.map((function(e){return{id:e.id,isLocal:!!r,protocol:a,features:e.features,versionId:e.version_id,appType:r?-1:e.app_type,currentHost:{subscribed_modules:e.subscribed_modules,endpoint_urls:e.endpoint_urls},configs:_classStaticPrivateMethodGet(t,t,_getAppConfigs).call(t,e),locations:_classStaticPrivateMethodGet(t,t,_getAppPlaceholders).call(t,e),displayName:_classStaticPrivateMethodGet(t,t,_getAppName).call(t,e),authorizeUrl:_classStaticPrivateMethodGet(t,t,_getAppAuthorizeURL).call(t,e),oauthConfigsList:_classStaticPrivateMethodGet(t,t,_getOauthConfigsList).call(t,e)}}))},o=i=function(){return s.isDev&&s.configs.urls.APP_LIST_WITH_TEST_VERSION?s.configs.urls.APP_LIST_WITH_TEST_VERSION:s.configs.urls.APP_LIST},e.abrupt("return",this.adapter.ajax({method:"GET",headers:{"MKP-APIKEY":this.adapter.apiKey,accept:"application/json","X-CSRF-TOKEN":this.adapter.csrfToken,"MKP-AUTH-TOKEN":this.adapter.authToken},url:r?"".concat(a,"://").concat(this.configs.urls.LOCAL_APP_LIST):i()}).then(n,o));case 11:case"end":return e.stop()}}),e,this)}))),},{key:"getMarketplaceViewerConfigs",value:function(){return{galleryURL:this.adapter.galleryURL,isAdmin:!!this.adapter.isAdmin,domain:this.adapter.domain,pod:this.adapter.pod,product:this.adapter.product,theme:this.adapter.theme}}}]),t}();function _getAppName(t){return"test"===(null==t?void 0:t.installation_type)?"".concat(UNDER_DEVELOPMENT_LABEL," ").concat(t.displayName||t.display_name):t.displayName||t.display_name}function _getAppConfigs(t){return t.configs||{}} GalleryEventReceiver=function(){function t(e){_classCallCheck(this,t),validate("EventReceiver.adapter",e),this.iframeId=e.iframeId,this.eventHandler="function"==typeof e.eventHandler?e.eventHandler:null,this.initialize()}return _createClass(t,[{key:"setupChannel",value:function(){this.channel||(this.channel=new MessageChannel,this.port=this.channel.port1,this.eventSource.contentWindow.postMessage("galleryIframe:port","*",[this.channel.port2]),this.port.addEventListener("message",this.onMessage.bind(this),!1),this.port.start())}},{key:"initialize",value:function(){var t=this;this.eventSource=document.getElementById(this.iframeId),this.eventSource&&this.eventSource.addEventListener&&this.eventSource.addEventListener("load",()}},{key:"onMessage",value:,{key:"postMessage",value:]),t}(),Manager=_createClass((function t(e){return _classCallCheck(this,t),"galleryEventExchange"===e.type?new GalleryEventReceiver(e):new MarketplaceManager(e)}));window.MarketplaceManager=Manager})();
