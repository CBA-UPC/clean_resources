var signal=function(){"use strict";var u=ee(;var e=setTimeout;pe.catch=o.prototype.then=o.prototype.finally=o.all=o.allSettled=o.resolve=o.reject=o.race=o._immediateFn="function"==typeof setImmediate?o._unhandledRejectionFn=var f=o,p=ar y=unction m(r,i){var n,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=i.call(r,a)}catch(t){e=[6,t],o=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var _="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};r w=v(g(function(t,e){var r;r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:_,t.exports=function(t){var x,I=t&&t.Promise||r.Promise,E=t&&t.XMLHttpRequest||r.XMLHttpRequest;return x=Object.create(r,{fetch:{value:void 0,writable:!0}}),function(a){var e,r,h=void 0!==x&&x||"undefined"!=typeof self&&self||void 0!==h&&h,i="URLSearchParams"in h,n="Symbol"in h&&"iterator"in Symbol,u="FileReader"in h&&"Blob"in h&&),o="FormData"in h,c="ArrayBuffer"in h;object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=ArrayBuffer.isView||,d.prototype.append=d.prototype.delete=d.prototype.get=d.prototype.has=d.prototype.set=d.prototype.forEach=d.prototype.keys=d.prototype.values=d.prototype.entries=n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];rototype.clone=_.call(g.prototype),_.call(b.prototype),b.prototype.clone=b.error=var A=[301,302,303,307,308];b.redirect=a.DOMException=h.DOMException;try{new a.DOMException}catch(t){a.DOMException=a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function C(i,s){return new I(function(n,t){var e=new g(i,s);if(e.signal&&e.signal.aborted)return t(new a.DOMException("Aborted","AbortError"));var o=new E;.onload=o.onerror=function(){setTimeout(function(){t(new TypeError("Network request failed"))},0)},o.ontimeout=o.onabort=o.open(e.method,e.url),!0),"include"===e.credentials?o.withCredentials=!0:"omit"===e.credentials&&(o.withCredentials=!1),"responseType"in o&&(u?o.responseType="blob":c&&e.headers.get("Content-Type")&&-1!==e.headers.get("Content-Type").indexOf("application/octet-stream")&&(o.responseType="arraybuffer")),!s||"object"!=typeof s.headers||s.headers instanceof d?e.headers.forEach(:Object.getOwnPropertyNames(s.headers).forEach(,e.signal&&(e.signal.addEventListener("abort",r),o.onreadystatechange=,o.send(void 0===e._bodyInit?null:e._bodyInit)})}C.polyfill=!0,h.fetch||(h.fetch=C,h.Headers=d,h.Request=g,h.Response=b),a.Headers=d,a.Request=g,a.Response=b,a.fetch=C,Object.defineProperty(a,"__esModule",{value:!0})}(e),{fetch:x.fetch,Headers:x.Headers,Request:x.Request,Response:x.Response,DOMException:x.DOMException}}}))({Promise:f}),b=w.fetch;w.Request,w.Response,w.Headers;var A,C=(t(x,A=Error),x);function x(t,e,r){void 0===r&&(r={});t=A.call(this,t)||this;return t.code=e,t.details=r,t.name="SignalError",t}var I=1/0,E="[object Symbol]",O=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,S=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,T="\\ud800-\\udfff",R="\\u2700-\\u27bf",B="a-z\\xdf-\\xf6\\xf8-\\xff",j="A-Z\\xc0-\\xd6\\xd8-\\xde",P="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",D="['’]",U="["+P+"]",q="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",z="\\d+",k="["+R+"]",N="["+B+"]",L="[^"+T+P+z+R+B+j+"]",M="(?:\\ud83c[\\udde6-\\uddff]){2}",F="[\\ud800-\\udbff][\\udc00-\\udfff]",V="["+j+"]",w="(?:"+N+"|"+L+")",P="(?:"+V+"|"+L+")",R="(?:['’](?:d|ll|m|re|s|t|ve))?",B="(?:['’](?:D|LL|M|RE|S|T|VE))?",j="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",L="[\\ufe0e\\ufe0f]?",j=L+j+("(?:\\u200d(?:"+["[^"+T+"]",M,F].join("|")+")"+L+j+")*"),j="(?:"+[k,M,F].join("|")+")"+j,G=RegExp(D,"g"),H=RegExp(q,"g"),J=RegExp([V+"?"+N+"+"+R+"(?="+[U,V,"$"].join("|")+")",P+"+"+B+"(?="+[U,V+w,"$"].join("|")+")",V+"?"+w+"+"+R,V+"+"+B,z,j].join("|"),"g"),Z=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,B="object"==typeof _&&_&&_.Object===Object&&_,z="object"==typeof self&&self&&self.Object===Object&&self,j=B||z||Function("return this")();var K,$=(K={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u",:"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"ss"},functiObject.prototype.toString,B=j.Symbol,z=B?B.prototype:void 0,X=z?z.toString:voidreturn t;if("symbol"==typeof(e=t)||function(t){return!!t&&"urn"0"==e&&1/t==-I?"-0":e}function tt(t){return null==t?"":Q(t)}function et(t){var e,r={};for(e in t)r[at(e)]=t[e];return r}function rt(){return Object.keys(ht).filter(function(t){return ht[t]})}function it(t,e){if(!e)return{currency:t,amount:0};var r=-1!==e.indexOf(".");return(e=Number(null===(e=e.match(/\d|\./g))||void 0===e?void 0:e.join(""))||0)%1!=0||r?e=Math.ceil(100*e):r||(e*=100),{currency:t,amount:e}}function nt(t){return void 0!==(t=null!=t?t:void 0)&&"string"!=typeof t}function ot(t){var a=t.baseUrl,h=t.token;return function(o,s){return void 0===o&&(o=""),void 0===s&&(s={}),u(void 0,void 0,void 0,function(){var r,i,n;return m(this,function(t){switch(t.label){case 0:return i=y({credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+h}},s),[4,b(""+("/"===(e=a).charAt(e.length-1)?e:e+"/")+o,i)];case 1:return[4,(n=t.sent()).json()];case 2:if(r=t.sent(),!n.okn.detail,i.message=g?t.toString():t)}var at=(Y=function(t,e,r){return t+(r?"_":"")+e.toLowerCase()},function(t){return function(t,e,r,i){var n=-1,o=t?t.length:0;for(i&&o&&(r=t[++n]);++n<o;)r=e(r,t[n]replace(S,$).replace(H,"")).replace(G,""),t=tt(t),void 0!==(e=r?undefined:e)?t.match(e)||[]:(function(t){return Z.test(t)}(t)?function(t){return t.match(J)||[]}:function(t){return t.match(O)||[]})(t)),Y,"");var e,r}),ht={collectionPageView:!0,orderCancelation:!0,orderCompletion:!0,orderRefund:!0,pageView:!0,productSearch:!0,productPageView:!0};function ut(){returne<arguments.length;e++)t[e]=arguments[e];try{return i.apply(this,t)}catch(t){st(t)}},r}}var ct,lt=(t(dt,ct=TypeError),dt);function dt(t){t=ct.call(this,t)||this;return t.name="SignalTypeError",t}var ft,peither a nameyt=(mt.prototype._encode=function(e){return Object.keys(e).map(function(t){return[t,e[t]]}).filter(function(t){return!!t[1]}).map(function(t){var e=t[0],t=t[1];return e+"="+encodeURIComponent(t)}).join("&")},mt.prototype._decode=function(t){return t.split("&").reduce(function(t,e){var r=e.split("="),e=r[0],r=r[1];return t[e]=decodeURIComponent(r),t},{v:""})},mt.createInstance=function(t){return new mt(t)},mt.prototype.support=function(){if(this.win.navigator.cookieEnabled&&"object"==typeof this.win.document&&"string"==typeof this.win.document.cookie){var t=At.NAMESPACE+"testcookie";if(this.win.document.cookie=t+"=supported",-1!==this.win.document.cookie.indexOf(t))return this.win.document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT",!0}return!1},mt.prototype.set=function(n,o,s){var a,h;return u(this,void 0,void 0,function(){var e,r,i;return m(this,function(t){return n&&(i=null===(a=null==s?void 0:s.expires)||void 0===a?void 0:a.toUTCString(),e=i?";expires="+i:"",r={v:o,t:null==s||!s.expires||null==s?void 0:s.ttl,e:null==s||!s.ttl||null===(h=s.expires)||void 0===h?void 0:h.getTime()},i=""+At.NAMESPACE+n,this.win.document.cookie=i+"="+encodeURIComponent(this._encode(r))+e+"; path=/"),[2]})})},mt.prototype.get=function(n){return u(this,void 0,void 0,function(){var e,r,i;return m(this,function(t){switch(t.label){case 0:if(!n)return[2];if(i=""+At.NAMESPACE+n,!(r=this.win.document.cookie.match(new RegExp(i+"=(.*?)(?:;|$)"))))return[3,5];t.label=1;case 1:return(t.trys.push([1,4,,5]),e=this._decode(decodeURIComponent(r[1])))?(i=e.e,r=e.t,i&&r?((i=new Date).setMilliseconds(r),i={ttl:r,expires:i},[4,this.set(n,e.v,i)]):[3,3]):[2];case 2:t.sent(),t.label=3;case 3:return[2,e.v];case 4:return t.sent(),[2,void 0];case 5:return[2,void 0]}})})},mt.prototype.remove=function(t){var e=new Date;return e.setTime(e.getTime()+-864e5),this.set(t,"",{expires:e})},mt.prototype.clearAll=function(){return u(this,void 0,void 0,function(){var e,r;return m(this,function(t){switch(t.label){case 0:e=0,r=function(t,e,r){void 0===r&&(r=";");for(var i=[],n=0,o=t.split(r);n<o.length;n++){var s=o[n].split("=")[0];s&&s.trim().startsWith(e)&&i.push(s.trim().replace(e,""))}return i}(this.win.document.cookie,At.NAMESPACE),t.label=1;case 1:return e<r.length?(r=r[e],[4:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},mt);function mt(t){void 0===t&&(t=window),this.win=t,this.name=ft.COOKIE}var _t=(vt.createInstance=function(t){return new vt(t)},vt.prototype.support=function(){var t=At.NAMESPACE+"testlocalstorage";try{return this.win.localStorage.setItem(t,"test"),this.win.localStorage.removeItem(t),!0}catch(t){return!1}},vt.prototype.set=function(i,n,o){return u(this,void 0,void 0,function(){var e,r;return m(this,function(t){return i&&(e=""+At.NAMESPACE+i,r={value:n,options:o},this.win.localStorage.setItem(e,JSON.stringify(r))),[2]})})},vt.prototype.get=function(o){return u(this,void 0,void 0,function(){var e,r,i,n;return m(this,function(t){switch(t.label){case 0:if(!o)return[2];if(e=""+At.NAMESPACE+o,!(e=this.win.localStorage.getItem(e)))return[2];t.label=1;case 1:return t.trys.push([1,6,,7]),r=JSON.parse(e),i=r.options,n=null==i?void 0:i.expires,i=null==i?void 0:i.ttl,n&&new Date>new Date(n)?[4,this.remove(o)]:[3,3];case 2:return t.sent(),[2,void 0];case 3:return n&&i?((n=new Date).setMilliseconds(i),n=y(y({},r.options),{expires:n}),[4,this.set(o,r.value,n)]):[3,5];case 4:t.sent(),t.label=5;case 5:return[2,r.value];case 6:return t.sent(),[2,void 0];case 7:return[2]}})})},vt.prototype.remove=function(r){return u(this,void 0,void 0,function(){var e;return m(this,function(t){return e=""+At.NAMESPACE+r,this.wiype.clearAll=function(){return u(this,void 0,void 0,function(){var e,r,i,n;return m(this,function(t){for(e=Object.keys(this.win.localStorage).filter(function(t){return t.startsWith(At.NAMESPACE)}),r=0,i=e;;return[2]})})},vt);function vt(t){void 0===t&&(t=window),this.win=t,this.n u(void 0,void 0,void 0,function(){return m(this,function(t){return[2,void 0]})pe.getDriver=function(){return this._driverInstance},Ct.createInstance=function(t,e){return Ct.instance=new Ct(t,e)},Ct.getInstance=function(){return Ct.instance||Ct.createInstance(),Ct.instance},Ct.prototype.set=function):gt()},Ct.prototype.gCt.prototype.remove=function(t){return this._driverInstance?this._driverInstance.remove(t):gt()},Ct.prototype.clearAll=function(){return this._driverInstance?this._driverInstance.clearAll():gt()},Ct.NAMESPACE=wt+"_",Ct);function Ct(t,e){void 0===t&&(t=window),void 0===e&&(e=bt),this.win=t,this._driverInstance=function(t,e){for(var r=0,i=t;]){a.label=s[2],a.opcontinue}e=i.call(r,a)}catch(t){e=[6,t],o=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}t.exports=function(){function t(){this._isRunning=!1,this.tasks=[]}return t.prototypeurn this._isRunning?[4,u(void(e=0),void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){return setTimeout(t,e)})];case 1:return[2,t.sent()]}})})]:[3,2];case 1:return t.sent(),[3,0];case 2:if(!(0<this.tasks.length))return[3,7];if(this._isRunning=!0,null==(i=this.tasks.shift()))return[3,6];r=i.action,i=i.onDone,i=void 0===i?function(){}:i,t.label=3;case 3:return t.trys.push([3,5,,6]),[4,r()];case 4:return n=t.sent(),i(void 0,n),[3,6];case 5:return n=t.sent(),i(n),[3,6];case 6:return[3,2];case 7:return this._isRunning=!1,[2]}var e})})},t.prototype.push=function(e){return u(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return this.tasks.push(e),[4,this._running()];case 1:return[2,t.sent()]}})})},t}()});(z=xt=xt||{}).PageView="tracking_website_page_view",z.OrderCompletion="tracking_commerce_order_completion",z.ProductPageView="tracking_commerce_product_page_view",z.ProductSearch="tracew="tracking_commerce_collection_page_view",z.OrderRefund="tracking_commerce_order_refund",z.OrderCancelation="tracking_commerce_order_cancelation";function Et(t){return!!t.referenceId||!!t.name}function Ot(e,t){if(null==t||!t.referenceId||n&&r.some(function(t){return!t.referenceId}))throw new lt("referenceId is required within product or product.variants");ireturn nt(t.price)}))throw n be a id 0:r.filter(function(t){return"string"==typeof t||Array.isArray(t)});if(null==r?void 0:r.filter(function(t){return"string"!=typeof t}).some(function(t){return t.some(function(t){return!Et(t)})}))throw new lt(pt);return y(y({},t),{variants:null===(t=t.variants)||void 0===t?void 0:t.map(function(t){return y(y({},t),{price:it(e;return y(y({},et(t)),{variants:null===(e=t.variants)||void 0===e?void 0:e.map(et),collections:null===(t=t.collections)||void 0===t?void 0:t.map(function(t){return"string"==typeof t?t:t.map(et)})})}function Tt(e,t){var r,i;if(null==t||!t.referenceId||null!==(r=t.items)&&voi}))throw new lt("referenceId is required within an order or order.items");if(nt(t.discount)||nt(t.subtotal)||null!==(i=t.items)&&void 0!==i&&i.some(function(t){return nt(t.discount)||nt(t.price)}))throw new lt("order.discount, order.subtotal or one of the items within the order has an invalid discount or price. Value must be a string");return y(y({},t),{items:null===(i=t.items)||void 0===i?void 0:i.map(function(t){return y(y({},t),{discount:it(e,t.discount),price:it(e,t.price)})}),discount:it(e,t.discount),subtotal:it(e,t.subtotal)})}var Rt=(Bt.prototype.constructRequest=function(t,e){if(r=t,-1===rt().indexOf(r))throw new lt(t+" is not a supported event type, see available types: "+rt().join(","));var r;switch(t){case"pageView":return this.pageViewRequest(e);case"orderCompletion":return this.orderCompletionRequest(e);case"productPageView":return this.productPageViewRequest(e);case"productSearch":return this.productSearchRequest(e);case"collectionPageView":return this.collectionPageViewRequest(e);case"orderRefund":return this.orderRefundRequest(e);case"orderCancelation":return this.orderCancelationRequest(e)}},Bt.prototype.pageViewRequest=function(o){return u(this,void 0,void 0,function(){var e,r,i,n;return m(this,function(t){switch(t.label){case 0:return e={url:window.location.href,title:window.document.title,referrer:window.document.referrer},[4,this.signal.getBrowserId()];case 1:return r=t.sent(),[4,this.signal.getSessionId()];case 2:return i=t.sent(),[4,It().get("identityId")];case 3:return n=t.sent(),n=y(y(y({},e),o||{}),{browserId:r,sessionId:i,identityId:n}),[2,{resource:xt.PageView,action:"create",params:et(n)}]}})})},Bt.prototype.orderCompletionRequest=function(o){var s;return u(this,void 0,void 0,function(){var e,r,i,n;return m(this,function(t){switch(t.label){case 0:return e=Tt(this.signal.currencyCode,null==o?void 0:o.order),[4,this.signal.getBrowserId()];case 1:return r=t.sent(),[4,this.signal.getSessionId()];case 2:return i=t.sent(),[4,It().get("identityId")];case 3:return n=t.sent(),n=y(y({},o||{}),{order:y(y({},et(e)),{items:null===(s=e.items)||void 0===s?void 0:s.map(et)}),browserId:r,sessionId:i,identityId:n}),[2,{resource:xt.OrderCompletion,action:"create",params:et(n)}]}})})},Bt.prototype.productPageViewRequest=function(s){return u(this,void 0,void 0,function(){var e,r,i,n,o;return m(this,function(t){switch(t.label){case 0:return e=Ot(this.signal.currencyCode,null==s?void 0:s.product),r={url:window.location.href,title:window.document.title,referrer:window.document.referrer},[4,this.signal.getBrowserId()];case 1:return i=t.sent(),[4,this.signal.getSessionId()];case 2:return n=t.sent(),[4,It().get("identityId")];case 3:return o=t.sent(),o=y(y(y({},r),s||{}),{product:St(e),browserId:i,sessionId:n,identityId:o}),[2,{action:"create",resource:xt.ProductPageView,params:et(o)}]}})})},Bt.prototype.productSearchRequest=function(s){var a;return u(this,void 0,void 0,function(witch(t.label){case 0:if(null==s||!s.query)throw new lt("query is required");return e=null===(a=null==s?void 0:s.products)||void 0===a?void 0:a.map(function(t){return Ot(o.signal.currencyCode,t)}),[4,this.signal.getBrowserId()];case 1:return r=t.sent(),[4,this.signal.getSessionId()];case 2:return i=t.sent(),[4,It().get("identityId")];case 3:return n=t.sent(),n=y(y({},s),{products:null==e?void 0:e.map(St),browserId:r,sessionId:i,identityId:n}),[2,{action:"create",resource:xt.ProductSearch,params:et(n)}]}})})},Bt.prototype.collectionPageViewRequest=function(o){var s;return u(this,void 0,void 0,function(){var e,r,i,n;return m(this,functi 0:if(!(null!=o&&o.breadcrumb||null!=o&&o.collection))throw new lt("breadcrumbs or collection is required");if(null!==(s=null==o?void 0:o.collection)&&void 0!==s&&s.some(function(t){return!Et(t)}))throw new lt(pt);return e={url:window.location.href,title:window.document.title,referrer:window.document.referrer},[4,this.signal.getBrowserId()];case 1:return r=t.sent(),[4,this.signal.getSessionId()];case 2:return i=t.sent(),[4,It().get("identityId")];case 3:return n=t.sent(),n=y(y(y({},e),o||{}),{collection:null===(s=null==o?void 0:o.collection)||void 0===s?void 0:s.map(et),browserId:r,sessionId:i,identityId:n}),[2,{action:"create",resource:xt.CollectionPageView,params:et(n)}]}})})},Bt.prototype.orderRefundRequest=function(o){var s;return u(this,void 0,void 0,function(){var e,r,i,n;return m(this,function(t){switch(t.label){case 0:return e=Tt(this.signal.currencyCode,null==o?void 0:o.order),[4,this.signal.getBrowserId()];case 1:return r=t.sent(),[4,this.signal.getSessionId()];case 2:return i=t.sent(),[4,It().get("identityId")];case 3:return n=t.sent(),n=y(y({},o||{}),{order:y(y({},et(e)),{items:null===(s=e.items)||void 0===s?void 0:s.map(et)}),browserId:r,sessionId:i,identityId:n}),[2,{action:"create",resource:xt.OrderRefund,params:et(n)}]}})})},Bt.prototype.orderCancelationRequest=function(o){var s;return u(this,void 0,void 0,function(){var e,r,i,n;return m(this,function(t){switch(t.label){case 0:return e=Tt(this.signal.currencyCode,null==o?void 0:o.order),[4,this.signal.getBrowserId()];case 1:return r=t.sent(),[4,this.signal.getSessionId()];case 2:return i=t.sent(),[4,It().get("identityId")];case 3:return n=t.sent(),n=y(y({},o|ms:null===(s=e.items)||void 0===s?void 0:s.map(et)}),browserId:r,sessionId:i,identityId:n}),[2,{action:"create",resource:xt.OrderCancelation,params:et(n)}]}})})},Bt);function Bt(t){this.signal=t}var jt=(Pt.prototype.push=function(t){this.calls.push(y(y({},t),{isCompleted:!1})),this.running||this._listen()},Pt.prototype.pushSync=function(t){this._process([y(y({},t),{isCompleted:!1})]),this.calls.push(y(y({},t),{isCompleted:!0}))},Pt.prototype..running=!0,setTimeout(function(){return u(t,void 0,void 0,function(){var e,r,i=this;return m(this,function(t){switch(t.label){case 0:if(0===(e=this.calls.filter(function(t){return!t.isCompleted}).slice(0,this.limit)).length)return this.running=!1,[2];t.label=1;case 1:return t.trys.push([1,6,,7]),this.onBatchProcess?[4,thi.sent(),[3,5];case 3:return[4,this._process(e)];case 4:t.sent(),t.label=5;case 5:return[3,7];case 6:return r=t.sent(),st(r),[3,7];case 7:return e.forEach(function(t){return i._markAsCompleted(t)}),this.onBatchDone(e.length),this._listen(),[2]}})})},this.timeout)},Pt.prototype._process=function(n){return u(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){casError("Signal instance is required");return[4,this.signal.getFetchInstance()(this.signal.version+"/batches",{method:"POST",body:JSON.stringify({batch:{requests:n.map(function(t){return t.request})}})})];case 1:return t.sent().batch.requests.forEach(function(t,e){var r=n[e];if(r.onDone)try{if("error"===tcode=t.result.code,i.detailsult.title,void r.onDone(i)}r.onDone(void 0,t.result)}catch(t){}}),[2]}})})},Pt.prototype._markAsCompleted=function(t){t.isCompleted=!0},Pt.prototype.setOnBatchDone=function(t){this.onBatchDone=t},Pt);function Pt(t,e){var r=void 0===t?{}:t,i=r.timeout,n=void 0===i?150:i,t=r.limit,i=void 0===t?5:t,t=r.onBat,e){return this._low=0|t,this._high=0|e,this}function n(t){return this._low=65535&t,this._high=t>>>16,this}function o(t,e){e=parseInt(t,e||10);return this._low=65535&e,this._high=e>>>16,this}var e;e=_,i(Math.pow(36,5)),i(Math.pow(16,7)),i(Math.pow(10,9)),i(Mathits=r,i.prototyppe.toString=function(t){return this.toNumber().toString(t||10)},i.prototype.add=function(t){var e=this._low+t._low,r=e>>>16;return r+=this._high+t._high,this._low=65535&e,this._high=65535&r,this},i.prototype.subtract=function(t){return this.add(t.clone().negate())},i.prototype.multiply=function(t){var e=this._high,r=this._low,i=t._high,n=t._low,o=r*n,t=o>>>16;return t+=e*n,t&=65535,t+=r*i,this._low=65535&o,this._high=65535&t,this},i.prototype.div=function(t){if(0==t._low&&0==t._high)throw Error("division by zero");if(0==t._high&&1==t._low)return this.remainder=new i(0),this;if(t.gt(this))return this.remainder=this.clone(),this._low=0,this._high=0,this;if(this.eq(t))return this.remainder=new i(0),this._low=1,this._high=0,this;for(var e=t.clone(),r=-1;!this.lt(e);)e.shiftLeft(1,!0),r++;for(this.rer.subtract(e),16<=r?this._high|=1<tion(){var t=1+(65535&~this._low);returls=i.prototype.eq=function(t){returnfunction(t){ret},i.prototype.lethis._high>t._hi_high|=t._high,t_high&=t._high,this},i.prototype.not=functi.prototype.shiftr=function(t){return 16<h=this._low<<t-16,this._low=0,e||(this._high&=65535)):16==t?(this._high=this._low,this._low=0):(this._high=this._high<<t|this._low>>16-t,this._low=this._low<<t&65535,e||(this._high&=65535)),this},i.prototype.rotateLeft=i.prototype.rotl=function(t){var e=(e=this._high<<16|this._low)<<t|e>>>32-t;return this._low=655Right=i.prototype.rotr=function(t){var e=(e=this._high<<his._a48=0;for(var r=h[e]||new a(Math.pow(e,5)),i=0,n=t.length;i<n;i+=5){var o=Math.min(5,n-i),s=parseInt(t.slice(i,i+o),e);this.multiply(o<5?new a(Math.pow(e,o)):r).add(new a(s))}return this}var e,(10,5)),2:a(Math.pow(rn this.toNumber{var e=this._a00+t._ais._a32+t._a32)>>>16;return n+=this._a48+t._a48,this._a00=65535&e,this._a16=65535&r,this._a32=65535&i,this._a48=65535&n,this},a.prototype.subtract=function(t){return this.add(t.clone().negate())},a.prototype.multiply=function(t){var e=this._a00,r=this._a16,i=this._a32,n=this._a48,o=t._a00,s=t._a16,a=t._a32,h=e*o,u=h>>>16,c=(u+=e*s)>>>16;u&=65535,c+=(u+=r*o)>>>16;var l=(c+=e*a)>>>16;return c&=65535,l+=(c+=r*s)>>>16,c&=65535,l+=(c+=i*o)>>>16,l+=e*t._a48,l&=65535,l+=r*a,l&=65535,l+=i*s,l&=65535,l+=n*o,this._a00=65535&h,this._a16=65535&u,this._a32=65535&c,this._a48=65535&l,this},a.prototype.div=function(t){if(0==t._a16&&0==t._a32&&0==t._a48){if(0==t._a00)throw Error("division by zero");if(1==t._a00)return this.remainder=new a(0),this}if(t.gt(this))return this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0,this;if(this.eq(t))return this.remainder=new a(0),this._a00=1,this._a16=0,this._a32=0,this._a48=0,this;for(var e=t.clone(),r=-1;!this.lt(e);)e.shiftLeft(1,!0),r++;for(this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0;0<=ion(){var t=1+(65535&~this._a00);r>>>16),this._a32=65535&t,this._a48=~thi.prototype.greaterThan=a.prototype.g},a.prototype.l2||!(this._a32>tturn this._a00|=turn this._a00&=._a16,this._a32^=t._a32,this._a48^=t._a48,this},a.prototype.not=function(){return this._a00=65535&~this._a00,this._a16=65535&~this._a16,this._a32=65535&~this._a32,this._a48=65535&~this._a48,this},a.prototype.shiftRight=a.prototype.shiftr=function(t){return 48<=(t%=64)?(this._a00=this._a48>>t-48,this._a16=0,this._a32=0,this._a48=0):32<=t?(t-=32,this._a00=65535&(this._a32>>t|this._a48<<16-t),this._a16=this._a48>>t&65535,this._a32=0,this._a48=0):16<=t?(t-=16,this._a00=65535&(this._a16>>t|this._a32<<16-t),this._a16=65535&(this._a32>>t|this._a48<<16-t),this._a32=this._a48>>t&65535,this._a48=0):(this._a00=65535&(this._a00>>t|this._a16<<16-t),this._a16=65535&(this._a16>>t|this._a32<<16-t),this._a32=65535&(this._a32>>t|this._a48<<16-t),this._a48=this._a48>>t&65535),this},a.prototype.shiftLeft=a.prototype.shiftl=function(t,e){return 48<=(t%=64)?(this._a48=this._a00<<t-48,this._a32=0,this._a16=0,this._a00=0):32<=t?(t-=32,this._a48=this._a16<<t|this._a00>>16-t,this._a32=this._a00<<t&65535,this._a16=0,this._a00=0):16<=t?(t-=16,this._a48=this._a32<<t|this._a16>>16-t,this._a32=65535&(this._a16<<t|this._a00>>16-t),this._a16=this._a00<<t&65535,this._a00=0):(this._a48=this._a48<<t|this._a32>>16-t,this._a32=65535&(this._a32<<t|this._a16>>16-t),this._a16=65535&(this._a16<<t|this._a00>>16-t),this._a00=this._a00<<t&65535),e||(this._a48&=65535),this},a.prototype.rotateLeft=a.prototype.rotl=function(t){if(0==(t%=64))return this;if(32<=t){var e=this._a00;if(this._a00=this._a32,this._a32=e,e=this._a48,this._a48=this._a16,this._a16=e,32==t)return this;t-=32}var r=this._a48<<16|this._a32,i=this._a16<<16|this._a00,e=r<<t|i>>>32-t,t=i<<t|r>>>32-t;return this._a00=65535&t,this._a16=t>>>16,this._a32=65535&e,this._a48=e>>>16,this},a.prototype.rotateRight=a.prototype.rotr=function(t){if(0==(t%=64))return this;if(32<=t){var e=this._a00;if(this._a00=this._a32,this._a32=e,e=this._a48,this._a48=this._a16,this._a16=e,32==t)return this>>>t|i<<32-t,t=i>>>t|r<<32-t;return this._a00=65535&t,this._a16=t>>>16,this._a32=65535&e,this._a48=e>>>16,this},a.prototype.clone=function(){return new a(this._a00,this._a16,this._a32,this._a48)},t.exports?t.exports=a:e.UINT64=a})},Dt=j.UINT32;Dt.prototype.xxh_update=function(t,e){var r=qt._low,i=t*r,n=i>>>16;n+=e*r,n&=65535,n+=t*qt._high;var o=this._low+(65535&i),e=o>>>16,t=(e+=this._high+(65535&n))<<16|65535&o,e=(t=t<<13|t>>>19)>>>16;n=(i=(o=65535&t)*(r=Ut._low))>>>16,n+=e*r,n&=65535,n+=o*Ut._high,this._low=65535&i,this._high=65535&n};var Ut=Dt("2654435761"),qt=Dt("2246822519"),zt=Dt("3266489917"),kt=Dt("668265263"),Nt=Dt("374761393");function Lt(){return 2==arguments.length?new Lt(arguments[1]).update(arguments[0]).digest():this instanceof Lt?void Mt.call(this,arguments[0]):new Lt(arguments[0])}function Mt(t){return this.seed=t instanceof Dt?t.clone():Dt(t),this.v1=this.seed.clone().add(Ut).add(qt),this.v2=this.seed.clone().add(qt),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(Ut),this.total_len=0,this.memsize=0,this.memory=null,this}Lt.prototype.init=Mt,Lt.prototype.update=function(t){var e,r="string"==typeof t;r&&(t=function(t){for(var e=[],r=0,i=t.length;r<i;r++){var n=t.charCodeAt(r);n<128?e.push(n):n<2048?e.push(192|n>>6,128|63&n):n<55296||57344<=n?e.push(224|n>>12,128|n>>6&63,128|63&n):(r++,n=65536+((1023&n)<<10|1023&t.charCodeAt(r)),e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return new Uint8Array(e)}(t),e=!(r=!1)),"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&(e=!0,t=new Uint8Array(t));var i=0,n=t.length,o=i+n;if(0==n)return this;if(this.total_len+=n,0==this.memsize&&(this.memory=r?"":new(e?Uint8Array:Buffer)(16)),this.memsize+n<16)return r?this.memory+=t:e?this.memory.set(t.subarray(0,n),this.memsize):t.copy(this.memory,this.memsize,0,n),this.memsize+=n,this;if(0<this.memsize&&(r?this.memory+=t.slice(0,16-this.memsize):e?this.memory.set(t.subarray(0,16-this.memsize),this.memsize):t.copy(this.memory,this.memsize,0,16-this.memsize),n=0,r?(this.v1.xxh_update(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2)),n+=4,this.v2.xxh_update(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2)),n+=4,this.v3.xxh_update(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2)),n+=4,this.v4.xxh_update(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2))):(this.v1.xxh_update(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2]),n+=4,this.v2.xxh_update(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2]),n+=4,this.v3.xxh_update(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2]),n+=4,this.v4.xxh_update(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2])),i+=16-this.memsize,this.memsize=0,r&&(this.memory="")),i<=o-16)for(var s=o-16;r?(this.v1.xxh_update(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2)),i+=4,this.v2.xxh_update(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2)),i+=4,this.v3.xxh_update(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2)),i+=4,this.v4.xxh_update(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2))):(this.v1.xxh_update(t[i+1]<<8|t[i],t[i+3]<<8|t[i+2]),i+=4,this.v2.xxh_update(t[i+1]<<8|t[i],t[i+3]<<8|t[i+2]),i+=4,this.v3.xxh_update(t[i+1]<<8|t[i],t[i+3]<<8|t[i+2]),i+=4,this.v4.xxh_update(t[i+1]<<8|t[i],t[iply(Nt)).rotl(11).multiply(Ut);return t=s.clone().shiftRight(15),s.xor(t).multiply(qt),t=s.clone().shiftRight(13),s.xor(t).multiply(zt),t=s.clone().shiftRight(16),s.xorhis.v1=this.seed.clone().add(Vt).add(Gt),this.v2=this.seed.clone().add(Gt),this.v3=t,128|63&n):n<55296||57344<=n?e.push(224|n>>12,128|n>>6&63,128|63&n):(r++,n=65536+((1023&n)<<10|1023&t.charCodeAt(r)),e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return new Uint8Array(e)}(t),e=!(r=!1)),"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&(e=!0,t=new Uint8Array(t));var i=0,n=t.length,o=i+n;if(0==n)return this;if(this.total_len+=n,0==this.memsize&&(this.memory=r?"":new(e?Uint8Array:Buffer)(32)),this.memsize+n<32)return r?this.memory+=t:e?this.memory.set(t.subarray(0,n),this.memsize):t.copy(this.memory,this.memsize,0,n),this.memsize+=n,this;if(0<this.memsize&&(r?this.memory+=t.slice(0,32-this.memsize):e?this.memory.set(t.subarray(0,32-this.memsize),this.memsize):t.copy(this.memory,this.memsize,0,32-this.memsize),n=0,s=r?(s=Ft(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2),this.memory.charCodeAt(n+5)<<8|this.memory.charCodeAt(n+4),this.memory.charCodeAt(n+7)<<8|this.memory.charCodeAt(n+6)),this.v1.add(s.multiply(Gt)).rotl(31).multiply(Vt),n+=8,s=Ft(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2),this.memory.charCodeAt(n+5)<<8|this.memory.charCodeAt(n+4),this.memory.charCodeAt(n+7)<<8|this.memory.charCodeAt(n+6)),this.v2.add(s.multiply(Gt)).rotl(31).multiply(Vt),n+=8,s=Ft(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2),this.memory.charCodeAt(n+5)<<8|this.memory.charCodeAt(n+4),this.memory.charCodeAt(n+7)<<8|this.memory.charCodeAt(n+6)),this.v3.add(s.multiply(Gt)).rotl(31).multiply(Vt),n+=8,Ft(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2),this.memory.charCodeAt(n+5)<<8|this.memory.charCodeAt(n+4),this.memory.charCodeAt(n+7)<<8|this.memory.charCodeAt(n+6))):(s=Ft(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2],this.memory[n+5]<<8|this.memory[n+4],this.memory[n+7]<<8|this.memory[n+6]),this.v1.add(s.multiply(Gt)).rotl(31).multiply(Vt),n+=8,s=Ft(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2],this.memory[n+5]<<8|this.memory[n+4],this.memory[n+7]<<8|this.memory[n+6]),this.v2.add(s.multiply(Gt)).rotl(31).multiply(Vt),n+=8,s=Ft(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2],this.memory[n+5]<<8|this.memory[n+4],this.memory[n+7]<<8|this.memory[n+6]),this.v3.add(s.multiply(Gt)).rotl(31).multiply(Vt),n+=8,Ft(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2],this.memory[n+5]<<8|this.memory[n+4],this.memory[n+7]<<8|this.memory[n+6])),this.v4.add(s.multiply(Gt)).rotl(31).multiply(Vt),i+=32-this.memsize,this.memsize=0,r&&(this.memory="")),i<=o-32){var s,a=o-32;do{}while(s=r?(s=Ft(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2),t.charCodeAt(i+5)<<8|t.charCodeAt(i+4),t.charCodeAt(i+7)<<8|t.charCodeAt(i+6)),this.v1.add(s.multiply(Gt)).rotl(31).multiply(Vt),i+=8,s=Ft(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2),t.charCodeAt(i+5)<<8|t.charCodeAt(i+4),t.charCodeAt(i+7)<<8|t.charCodeAt(i+6)),this.v2.add(s.multiply(Gt)).rotl(31).multiply(Vt),i+=8,s=Ft(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2),t.charCodeAt(i+5)<<8|t.charCodeAt(i+4),t.charCodeAt(i+7)<<8|t.charCodeAt(i+6)),this.v3.add(s.multiply(Gt)).rotl(31).multiply(Vt),i+=8,Ft(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2),t.charCodeAt(i+5)<<8|t.charCodeAt(i+4),t.charCodeAt(i+7)<<8|t.charCodeAt(i+6))):(s=Ft(t[i+1]<<8|t[i],t[i+3]<<8|t[i+2],t[i+5]<<8|t[i+4],t[i+7]<<8|t[i+6]),this.v1.add(s.multiply(Gt)).rotl(31).multiply(Vt),s=Ft(t[(i+=8)+1]<<8|t[i],t[i+3]<<8|t[i+2],t[i+5]<<8|t[i+4],t[i+7]<<8|t[i+6]),this.v2.add(s.multiply(Gt)).rotl(31).multiply(Vt),s=Ft(t[(i+=8)+1]<<8|t[i],t[i+3]<<8|t[i+2],t[i+5]<<8|t[i+4],t[i+7]<<8|t[i+6]),this.v3.add(s.multiply(Gt)).rotl(31).multiply(Vt),Ft(t[(i+=8)+1]<<8|t[i],t[i+3]<<8|t[i+2],t[i+5]<<8|t[i+4],t[i+7]<<8|t[i+6])),this.v4.add(s.multiply(Gt)).rotl(ply(Zt)).rotl(11).multiply(Vt);return e=t.clone().shiftRight(33),t.xor(e).multiply(Gt),e=t.clone().shiftRight(29),t.xor(e).multiply(Ht),e=t.clone().shiftRight(32),t.xor(e),this.init(this.seed),t};var Yt={h32:z,h64:Kt},Wt=new B,Xt=new B,Qt=(te.prototype.getBrowserId=function(){var t=this;return new f(function(i,n){return u(t,void 0,void 0,function(){var e,r=this;return m(this,function(t){switch(t.label){case 0:return e=function(){return u(r,void 0,void 0,function(){var e,r,i;return m(this,function(t){switch(t.label){case 0:return[4,It().get("browserId")];case 1:return(i=t.sent())?[2,i]:[4,this.getFetchInstance()(this.version+"/websites/browsers",{method:"POST",body:JSON.stringify({browser:{}})})];case 2:return e=t.sent().browser,r=new Date(1e3*e.expires_at),i=1e3*(e.expires_at-e.created_at),[4,It().set("browserId",e.id,{expires:r,ttl:i})];case 3:return t.sent(),[2,e.id]}})})},[4,Wt.push({action:e,onDone:function(t,e){if(t)return n(t);i(e)}})];case 1:return t.sent(),[2]}})})})},te.prototype.getSessionId=function(){var t=this;return new f(function(i,n){return u(t,void 0,void 0,function(){var e,r=this;return m(this,function(t){switch(t.label){case 0:return e=function(){return u(r,void 0,void 0,function(){var e,r,i;return m(this,function(t){switch(t.label){case 0:return[4,this.getBrowserId()];case 1:return i=t.sent(),[4,It().get("sessionId")];case 2:return(r=t.sent())?[2,r]:[4,this.getFetchInstance()(this.version+"/websites/sessions",{method:"POST",body:JSON.stringify({session:{browser_id:i}})})];case 3:return epires_at),i=1e3*(e.expires_at-e.created_at),[4,It().set("sessionId",e.id,{expires:r,ttl:i})];case 4:return t.sent(),[2,e.id]}})})},[4,Xt.push({action:e,onDone:function(t,e){if(t)return n(t);i(e)}})];case 1:return t.sent(),[2]}})})})},te.prototype._replayDelayedCalls=function(){for(var t=window[wt];t&&t.length;)try{var e=t.shift()||[],r=e[0],e=e.slice(1),r=this[r];r&&r.apply(this,e)}catch(t){}},te.prototype.init=function(t,e){var r=(e=void 0===e?{}:e).baseUrl,r=void 0===r?te.DEFAULT_BASE_URL:r,e=e.currencyCode,e=void 0===e?this.currencyCode:e;if(this.log("init method called"),"string"!=typeof t||!t)throw new lt("'CLIENT_TOKEN' is required and should be a string");if("string"!=typeof r||!r)throw new lt("'options.baseUrl' is required and should be a string or remove it from your options to use the default baseUrl");if("string"!=typeof e||!e)throw new lt("'options.currencyCode' is required and should be a string or remove it from your options to use the default currencyCode");if(3!==e.length)throw new lt("'options.currencyCode' must be 3 characters long");this.currencyCode=e.toUpperCase(),this._token=t,this._fetchInstance=ot({baseUrl:r,token:t}),this.browser(),this.session(),this.identity(),this.log("init method ran successfully")},te.prototype.browser=function(e){var r=this;this.log("browser method called"),this.getBrowserId().then(function(t){e&&e(t),r.log("browser method ran successfully with",t)}).catch(st)},te.prototype.session=function(e){var r=this;this.log("session method called"),this.getSessionId().then(function(t){e&&e(t),r.log("session method ran successfully with",t)}).catch(st)},te.prototype.identity=function(t,e){var r=this;this.log("identity method called");var i=function(t){for(var e={},r=["cp_rid","cp_cid","cp_src","cp_eea"],i=0,n=(t||window.location.search.substring(1)).split("&");i<n.length;i++){var o=n[i].split("="),s=o[0],o=o[1],s=s;-1===r.indexOf(s)||(e[s]=decodeURIComponent(o))}return e}(),n=i.cp_cid,o=i.cp_rid,i=i.cp_src,s=y({},t||{});if(s.referenceId=o||s.referenceId,s.contactId=n||s.contactId,s.source=i||s.source,null==s||!s.emailAddress||null!=s&&s.contactId||(i=null==s?void 0:s.emailAddress.trim().toLocaleLowerCase(),i=Yt.h64(i,0).toString(16),s.contactId=i),null==s||delete s.emailAddress,!s||!s.contactId&&!s.referenceId&&!s.emailAddress)return e&&e(void 0),void this.log("One of referenceId, emailAddress or contactId must be provided or be available as query string when creating an identity");var a=this.getFetchInstance();u(r,void 0,void 0,function(){var e,r,i;return m(this,function(t){switch(t.label){case 0:return[4,It().get("identityId")];case 1:return t.sent()?[2,void 0]:[4,this.getBrowserId()];case 2:return r=t.sent(),[4,this.getSessionId()];case 3:return i=t.sent(),[4,a(this.version+"/websites/identities",{method:"POST",body:JSON.stringify({identity:y(y({},et(s)),{browser_id:r,session_id:i})})})];case 4:return e=t.sent().identity,r=new Date(1e3*e.expires_at),i=1e3*(e.expires_at-e.created_at),[4,It().set("identityId",e.id,{expires:r,ttl:i})];case 5:return t.sent(),[2,e]}})an successfully with",t)}).catch(st)},te.prototype.forget=function(){var t=this;this.log("forget method called"),It().remove("identityId").then(function(){t.log("forget method ran successfully")}).catch(st)},te.prototype.event=function(r,t,i){var e,n,o=this;this.log("event batch method called for '"+r+"'"),"function"==typeof t?n=t:e=t,this._events.constructRequest(r,e).then(function(t){o._batchEventCalls.push({request:t,onDone:function(t,e){if(t)return st(t);t=n||i;t&&e&&t(e),o.log("event '"+r+"' method ran successfully")}})}).catch(st)},te.prototype.syncEvent=function(r,t,i){var e,n,o=this;this.log("sync event method called for '"+r+"'"),"function"==typeof t?n=t:e=t,this._events.constructRequest(r,e).then(function(t){o._batchEventCalls.pushSync({request:t,onDone:function(t,e){if(t)return st(t);t=n||i;t&&e&&t(e),o.log("event '"+r+"' method ran successfully")}})}).catch(st)},te.prototype.whoami=function(e){var r=this;this.log("whoami method called"),this.getFetchInstance()(this.version+"/whoami").then(function(t){t=t.whoami;e&&e(t),r.log("whoami method ran successfully with",t)}).catch(st)},te.prion(e){var r=this;thi("ping method ran successfully===t&&(t=!0),this._isDebugEnabled=t},te.prototype.getFetchInstance=function(){if(!this._fetchInstance)throw new C("You must call 'init' before using any othapply(console,function(){for(var t=0,e=0,r=argume;for(var i=Array(t),n=0,e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i}([wt],t))},te.prototype.updateStorageDriversOrder=function(t){At.createInstance(window,t)},te.prototype.updateBatchCallsConfiguration=function(t){this._batchEventCalls=new jt(t,this)},te.prototype._testUtils=function(){},te.DEFAULT_BASE_URL="https://track.coherentpath.com",r([ut()],te.prototype,"init",null),r([ut()],te.prototype,"identity",null),r([ut()],te.prototype,"whoami",null),r([ut()],te.prototype,"ping",null),t=!1,this.version="v1",this.currencyCode="USD",this._events=new Rt(this),this._batchEventCalls=new jt({},tion ee(nn n(t,e,f,i)}}ee(new Function);var re=new Qt;return It().getDriver()||Object.getOwnPropertyNames(Qt.prototype).filter(function(t){return"constructor"!==t}).forEach(function(t){re[t]=function(){}}),re}();
