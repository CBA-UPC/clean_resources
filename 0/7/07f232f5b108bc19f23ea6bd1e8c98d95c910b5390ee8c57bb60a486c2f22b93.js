/*! For license information please see 2a5ea3a4bbc655acee5fc4e2ab24251c-v2.js.LICENSE.txt */
(self.webpackChunksketchfab=self.webpackChunksketchfab||[]).push([[416],{UGpv:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i("QbBG"),n=i("zIYZ");const a=r.Z.extend({displayName:"PureComponent",shouldViewUpdate:)},"C/2N":(t,e,i)=>{"use strict";i.d(e,{ZP:()=>a});var r=function(t){var e=0;return t<.0031308?t>0&&(e=12.92*t):e=1.055*Math.pow(t,1/2.4)-.055,e},n=function(t){var e=0;return t<.04045?t>=0&&(e=t*(1/12.92)):e=Math.pow((t+.055)*(1/1.055),2.4),e};const a={linearToSrgb1:r,srgbToLinear1:n,linearToSrgb:function(t,e){var i=e||new Array(t.length);return i[0]=r(t[0]),i[1]=r(t[1]),i[2]=r(t[2]),i.length>3&&t.length>3&&(i[3]=t[3]),i},srgbToLinear:function(t,e){var i=e||new Array(t.length);return i[0]=n(t[0]),i[1]=n(t[1]),i[2]=n(t[2]),i.length>3&&t.length>3&&(i[3]=t[3]),i},encodeRGBM:function(t,e,i){i[3]=Math.min(1,Math.max(t[0]/e,i[1]/e,i[2]/e,1e-6)),i[3]=Math.ceil(255*i[3])/255;var r=1/(e*i[3]);return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i},decodeRGBM:function(t,e,i){var r=e*t[3];return i[0]=r*i[0],i[1]=r*i[1],i[2]=r*i[2],i},rgbToHex:function(t){var e=Math.round(255*t.r),i=Math.round(255*t.g);return"#"+(16777216|Math.round(255*t.b)|i<<8|e<<16).toString(16).substr(1)}}},"QG/p":(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i("lZH+"),n=i.n(r);function a(){var t={},e=new(n())(();return e.resolve=t.resolve,e.reject=t.reject,e.promise=e,e}},O56b:(t,e,i)=>{"use strict";i.d(e,{Z:()=>f});var r=i("T4DV"),n=i("Wuy/"),a=i("k46e"),s=i("X9mO"),o=i("Hjnd"),h=i.n(o),u=i("R4My"),c=i.n(u),l=i("jpNh"),_=function(t,e){if(Array.isArray(t))this.shortcuts=t||[];else{if(!(0,r.Z)(t))throw new Error("Shortcut manager needs a shortcut object to function");this.shortcutGroup=t,this.shortcuts=t.shortcuts||[]}this.options=e||{},this.handlers={},this.options=(0,n.Z)({},this.options,{listen:!1}),this.options.listen&&this.listen()},d=new(i.n(l)());d.stopCallback=function(t,e){return!((" "+e.className+" ").indexOf(" mousetrap ")>-1)&&("button"===document.activeElement.tagName.toLowerCase()||("INPUT"===e.tagName||"SELECT"===e.tagName||"TEXTAREA"===e.tagName||e.contentEditable&&"true"===e.contentEditable))},(0,a.Z)(_.prototype,c().Events),_.prototype.listen=function(t){void 0===t?this.shortcuts.forEach(this._listen.bind(this)):Array.isArray(t)?(this.shortcuts=this.shortcuts.concat(t),t.forEach(this._listen.bind(this))):this._listen(t)},_.prototype.stopListening=function(t){t.forEach(function(t){d.unbind(this._getShortcut(t).keyCombinations),delete this.handlers[t]}.bind(this))},_.prototype.getTitle=_.prototype.getShortcut=_.prototype.getShortDescriptionById=function(t){var e="";return this.shortcuts.forEach(function(i){i.id===t&&(e=this._formatKeyCombination(i.keyCombinations).replace("<br />",""))}.bind(this)),e},_.prototype.generateHelpSection=function(){var t=h()("<div />"),e=this.getTitle();return e&&t.append('<span class="title">'+e+"</span>"),this.shortcuts.filter(this._validate).forEach(function(e){e.name&&t.append("<b>"+e.name+"</b>"),t.append(this._formatKeyCombination(e.keyCombinations))}.bind(this)),t.html()||""},_.prototype.hasKeyCombination=function(t){var e=!1;return this.shortcuts.forEach((function(i){e||(Array.isArray(i.shortcuts)?i.shortcuts.forEach(():e=i.shortcuts===t)})),e},_.prototype._formatKeyCombination=function(t){return[].concat(t).map((function(t){return"<kbd>"+t+"</kbd>"})).join(" or ")+"<br />"},_.prototype._listen=function(t){this._validate(t)&&!this.handlers[t.id]&&(this.handlers[t.id]=this._notify.bind(this,t),d.bind(t.keyCombinations,this.handlers[t.id]))},_.prototype._getShortcut=_.prototype._validate=_.prototype._notify=const f=_},VHcI:"VKI/":(t,e,i)=>{"use strict";function r(t){var e=Array.prototype.slice.call(arguments,1),i=t.bind.apply(t,e);return i(),i}i.d(e,{Z:()=>r})},"QQD/":(t,e,i)=>{"use strict";var r=i("lZH+");i.n(r)().config({warnings:!1,longStackTraces:!1,cancellation:!0,monitoring:!1})},SM3V:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});const r=function(t){var e,i=window.WebKitBlobBuilder||window.MozBlobBuilder||window.BlobBuilder;e=t.split(",")[0].indexOf("base64")>=0?window.atob(t.split(",")[1]):window.decodeURI(t.split(",")[1]);for(var r,n=t.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(e.length),s=new Uint8Array(a),o=0;o<e.length;o++)s[o]=e.charCodeAt(o);if(void 0!==window.Blob)r=new Blob([s],{type:n});else if(void 0!==i){var h=new i;h.append(a),r=h.getBlob(n)}return r}},md6q:(t,e,i)=>{"use strict";function r(t){return(t=(t=(t=t.substring(t.lastIndexOf("/")+1)).split("."))[t.length>1?t.length-2:t.length-1]).split("_").pop().toLowerCase()}i.d(e,{Z:()=>r})},"2jst":(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var r=i("WGQk"),n=i("3XAv"),a="";(0,n.Z)()||(0,r.Z)()||(a+="?optimized=1");const s=function(t,e,i){var r="/i/models/"+e;if(t&&(r+="/"+t+a),i&&!window.prefetchedData[r])throw console.error("Missing prefetch "+r),new Error("Missing prefetch "+r);return r}},gAM8:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i("Hjnd"),n=i.n(r);function a(){n()(document).on("focus blur","*",(function(t){var e=n()(t.target).attr("id"),i=t.target===document.activeElement;void 0!==e&&n()("label[for]").filter((function(){return n()(this).attr("for")===e})).toggleClass("focused",i)})),n()(document).on("input","input, textarea",(function(t){n()(t.target).addClass("edited").toggleClass("empty",""===n()(t.target).val())})),n()(document).on("submit","form:not([action])",(),n()(document.documentElement).addClass("ready"),n()(document).on("keydown","form textarea",(function(t){t.ctrlKey&&13===t.keyCode&&n()(t.target).closest("form").submit()})),n()(document).on("click","a",(function(t){if(0!==(t.currentTarget!==t.target?n()(t.target).parentsUntil(t.currentTarget):n()()).addBack().filter("[data-action]").length){var e=n()(t.target).parents().filter("[href]");0!==e.length&&"#"!==e.eq(0).attr("href")||t.preventDefault()}})),n()(document).on("mousedown","label[for]",(function(t){if(t.target===t.currentTarget){var e=n()(t.currentTarget).attr("for"),i=document.getElementById(e);i&&i===document.activeElement&&t.preventDefault()}}))}},"+VSF":(t,e,i)=>{"use strict";i.d(e,{Z:()=>a,d:()=>n});var r=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&!navigator.userAgent.match("CriOS"),n=r&&navigator.userAgent.match("Version/15.0 Safari");const a=r},vrT6:(t,e,i)=>{"use strict";function r(t,e){var i,r,n=t.length,a=e.length,s=[];if(!n)return a;if(!a)return n;for(i=0;i<=n;i++)s[i]=[i];for(r=0;r<=a;r++)s[0][r]=r;for(r=1;r<=a;r++)for(i=1;i<=n;i++)t[i-1]===e[r-1]?s[i][r]=s[i-1][r-1]:s[i][r]=Math.min(s[i-1][r],s[i][r-1],s[i-1][r-1])+1;return s[n][a]}i.d(e,{Z:()=>r})},"57Pw":(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var r=i("mSEu"),n=i("g6dK"),a=i("+zma");const s={showPopup:function(){var t=a.n2.store.getState(),e=a.wl.authUser.canAccessFeature("ff_read_only_mode",t),i="?utm_source=website&utm_campaign=maintenance_error",s=new n.Z({title:e?"Maintenance":"Error",text:e?'Sketchfab is undergoing maintenance.<br>See: <a href="https://forum.sketchfab.com/t/sketchfab-operations/6678'.concat(i," target=_blank>Operations forum post</a>"):'An unknown error occurred. Please try again later or <a href="'.concat(r.Z.hosts.faq,"/requests/new").concat(i,'&type=website" target="_blank">contact our support team</a> if the problem persists.'),buttons:{ok:!0},safe:!0});return s.open().then((function(){s.close()})),s}}},u6Gu:(t,e,i)=>{"use strict";function r(){try{return parseInt(navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/)[1],10)}catch(t){console.error(t)}}function n(){try{return parseInt(navigator.userAgent.toLowerCase().match(/android\s([0-9\.]*)/i)[1],10)}catch(t){console.error(t)}}i.d(e,{X:()=>r,d:()=>n})},l5lH:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r=i("L0SH");const n=function t(e,i){var n,a,s=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,o=/(^[ ]*|[ ]*$)/g,h=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=/^0x[0-9a-f]+$/i,c=/^0/,l=_=l(e).slice(0,50).replace(o,"")||"",d=l(i).slice(0,50).replace(o,"")||"",f=_.replace(s,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=d.replace(s,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),g=parseInt(_.match(u))||1!==f.length&&_.match(h)&&Date.parse(_),m=parseInt(d.match(u))||g&&d.match(h)&&Date.parse(d)||null;if(m){if(g<m)return-1;if(g>m)return 1}for(var v=0,b=Math.max(f.length,p.length);v<b;v++){if(n=!(f[v]||"").match(c)&&parseFloat(f[v])||f[v]||0,a=!(p[v]||"").match(c)&&parseFloat(p[v])||p[v]||0,isNaN(n)!==isNaN(a))return isNaN(n)?1:-1;if((0,r.Z)(n)!==(0,r.Z)(a)&&(n+="",a+=""),n<a)return-1;if(n>a)return 1}return 0}},MPb8:()=>{var t=window.Image;delete window.Image,window.Image||(window.Image=t)},X2SH:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r,n=i("3XAv");window.requestAnimationFrame&&(r=(0,n.Z)()?function(){return 0}:window.requestAnimationFrame.bind(window));const a={get:function(){return r}}},V1mW:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r=i("L0SH");const n=function(){try{if("object"===("undefined"==typeof WebAssembly?"undefined":(0,r.Z)(WebAssembly))&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){}return!1}},Pev1:(t,e,i)=>{"use strict";i.d(e,{Z:()=>g});var r,n,a,s,o,h=i("u5PS"),u=i("GoyH"),c=i("6RPJ"),l=i("W40i"),_=i("CJNH"),d=i("pSxj"),f=i("IpZ9"),p=function(){c.Z.call(this),this._matrix=l._E.create(),this._position=l.R3.create(),this._matrixDirty=!0,this._scale=l.R3.fromValues(1,1,1),this._minimumScale=0,this._maximumScale=Number.MAX_VALUE,this._rotation=l.gf.create(),this._pivotPoint=l.R3.create(),this._autoScaleToScreen=!1,this._autoRotateToScreen=!1,this._cachedMatrix=l._E.create(),this._firstTimeToInitEyePoint=!0,this._autoScaleTransitionWidthRatio=.25,this._billboardAttribute=void 0,this._previousWidth=0,this._previousHeight=0,this._previousProjection=l._E.create(),this._previousModelView=l._E.create(),this._previousPosition=l.R3.create()};u.Z.createPrototypeNode(p,u.Z.objectInherit(c.Z.prototype,{getMatrix:function(){return this._matrix},setMatrix:function(t){this._matrix=t,this.dirtyBound()},setPosition:function(t){this._position=t,this._matrixDirty=!0,this.dirtyBound()},getPosition:function(){return this._position},setRotation:function(t){this._rotation=t,this._matrixDirty=!0,this.dirtyBound()},getRotation:function(){return this._rotation},setScale:function(t){this.setScaleFromVec3(l.R3.fromValues(t,t,t))},setScaleFromvec3:function(t){h.Z.warn("deprecated, use setScaleFromVec3"),this.setScaleFromVec3(t)},setScaleFromVec3:getScale:function(){return this._scale},setMinimumScale:function(t){this._minimumScale=t},getMinimumScale:function(){return this._minimumScale},setMaximumScale:function(t){this._maximumScale=t},getMaximumScale:function(){return this._maximumScale},setAutoScaleToScreen:function(t){this._autoScaleToScreen=t,this._matrixDirty=!0},getAutoScaleToScreen:function(){return this._autoScaleToScreen},setAutoRotateToScreen:function(t){this._autoRotateToScreen=t},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setAutoScaleTransitionWidthRatio:function(t){this._autoScaleTransitionWidthRatio=t},getAutoScaleTransitionWidthRatio:function(){return this._autoScaleTransitionWidthRatio},computeLocalToWorldMatrix:function(t){this._matrixDirty&&this.computeMatrix(),this.referenceFrame===d.Z.RELATIVE_RF?l._E.mul(t,t,this._matrix):l._E.copy(t,this._matrix)},computeMatrix:(s=l.R3.create(),o=l._E.create(),function(){this._matrixDirty&&(l._E.fromQuat(this._matrix,this._rotation),l._E.fromTranslation(o,this._position),l._E.mul(this._matrix,o,this._matrix),l._E.scale(this._matrix,this._matrix,this._scale),l._E.translate(this._matrix,this._matrix,l.R3.neg(s,this._pivotPoint)),this._matrixDirty=!1)}),computeWorldToLocalMatrix:function(){var t=l.R3.create(),e=l.gf.create(),i=l.R3.create(),r=l._E.create();return function(n){return(0!==this.scale[0]||0!==this.scale[1]||0!==this.scale[2])&&(i[0]=1/this._scale[0],i[1]=1/this._scale[1],i[2]=1/this._scale[2],this.referenceFrame===d.Z.RELATIVE_RF?(l._E.fromTranslation(r,l.R3.neg(t,this._position)),l._E.mul(n,r,n),l.gf.zeroRotation(this._rotation)||(l._E.fromQuat(r,l.gf.invert(e,this._rotation)),l._E.mul(n,r,n)),l._E.fromScaling(r,i),l._E.mul(n,r,n),l._E.fromTranslation(r,this._pivotPoint),l._E.mul(n,r,n)):(l._E.fromQuat(this._matrix,l.gf.invert(e,this._rotation)),l._E.translate(n,n,l.R3.neg(t,this._position)),l._E.fromScaling(r,i),l._E.mul(n,r,n),l._E.fromTranslation(r,this._pivotPoint),l._E.mul(n,r,n)),!0)}}(),computeBound:(a=l._E.create(),function(t){return this._autoScaleToScreen&&this._firstTimeToInitEyePoint?t:(f.Z.prototype.computeBound.call(this,t),t.valid()?(l._E.identity(a),this.computeLocalToWorldMatrix(a),t.transformMat4(t,a),t):t)}),accept:function(t){if(t.getVisitorType()===_.Z.CULL_VISITOR){var e=t.getViewport().width(),i=t.getViewport().height(),r=t.getCurrentProjectionMatrix(),n=t.getCurrentModelViewMatrix(),a=this._position,s=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(e!==this._previousWidth||i!==this._previousHeight?s=!0:l._E.exactEquals(r,this._previousProjection)&&l._E.exactEquals(n,this._previousModelView)&&l.R3.exactEquals(a,this._previousPosition)||(s=!0)),this._firstTimeToInitEyePoint=!1,s){if(this._autoScaleToScreen){var o=t.getViewport(),h=this.computePixelSizeVector(o,r,n),u=l.vh.fromValues(this._position[0],this._position[1],this._position[2],1),c=l.vh.dot(u,h),d=1/(c=.48/c);if(this._autoScaleTransitionWidthRatio>0){var p,g,m;if(this._minimumScale>0){var v=this._minimumScale,b=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);m=v+(g=1-2*(p=1/(4*(b-v)))*b)*g/(4*p),d<-g/(2*p)?d=this._minimumScale:d<b&&(d=m+g*d+p*(d*d))}if(this._maximumScale<Number.MAX_VALUE){var S=this._maximumScale,y=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);m=S+(g=1-2*(p=1/(4*(y-S)))*y)*g/(4*p),d>-g/(2*p)?d=this._maximumScale:d>y&&(d=m+g*d+p*(d*d))}}this.setScale(d)}if(this._autoRotateToScreen){var T=l.gf.create();l._E.getRotation(T,n),this.setRotation(l.gf.invert(T,T))}this._previousWidth=e,this._previousHeight=i,l.R3.copy(this._previousPosition,a),l._E.copy(this._previousProjection,r),l._E.copy(this._previousModelView,n)}}f.Z.prototype.accept.call(this,t)},computePixelSizeVector:(r=l.R3.create(),n=l.R3.create(),function(t,e,i){var a=e[0]*t.width()*.5,s=e[8]*t.width()*.5+e[11]*t.width()*.5;l.R3.set(r,i[0]*a+i[2]*s,i[4]*a+i[6]*s,i[8]*a+i[10]*s);var o=e[5]*t.height()*.5,h=e[9]*t.height()*.5+e[11]*t.height()*.5;l.R3.set(n,i[1]*o+i[2]*h,i[5]*o+i[6]*h,i[9]*o+i[10]*h);var u=e[11],c=e[15],_=l.vh.fromValues(i[2]*u,i[6]*u,i[10]*u,i[14]*u+i[15]*c),d=.7071067811/Math.sqrt(l.R3.sqrLen(r)+l.R3.sqrLen(n));return l.vh.scale(_,_,d),_})}),"osg","AutoTransform");const g=p},f7MS:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var r=i("GoyH"),n=i("WWMP"),a=function(t,e,i,r){n.Z.call(this),this._sourceFactor=a.DISABLE,this._destinationFactor=a.DISABLE,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,void 0!==t&&this.setSource(t),void 0!==e&&this.setDestination(e),void 0!==i&&this.setSourceAlpha(i),void 0!==r&&this.setDestinationAlpha(r)};a.DISABLE=-1,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,r.Z.createPrototypeStateAttribute(a,r.Z.objectInherit(n.Z.prototype,{attributeType:"BlendFunc",cloneType:function(){return new a},setSource:function(t){this.setSourceRGB(t),this.setSourceAlpha(t)},getSource:function(){return this._sourceFactor},setDestination:getDestination:function(){return this._destinationFactor},getSeparate:function(){return this._separate},checkSeparate:setSourceRGB:function(t){this._sourceFactor="string"==typeof t?a[t]:t,this._separate=this.checkSeparate()},getSourceRGB:function(){return this._sourceFactor},setSourceAlpha:function(t){this._sourceFactorAlpha="string"==typeof t?a[t]:t,this._separate=this.checkSeparate()},getSourceAlpha:function(){return this._sourceFactorAlpha},setDestinationRGB:function(t){this._destinationFactor="string"==typeof t?a[t]:t,this._separate=this.checkSeparate()},getDestinationRGB:function(){return this._destinationFactor},setDestinationAlpha:function(t){this._destinationFactorAlpha="string"==typeof t?a[t]:t,this._separate=this.checkSeparate()},getDestinationAlpha:function(){return this._destinationFactorAlpha},apply:function(t){t.applyBlendFunc(this)}}),"osg","BlendFunc");const s=a},k3oU:(t,e,i)=>{"use strict";i.d(e,{Z:()=>u});var r,n,a=i("u5PS"),s=i("GoyH"),o=i("W40i"),h=function(){this._min=o.R3.create(),this._max=o.R3.create(),this.init()};s.Z.createPrototypeObject(h,{init:function(){o.R3.copy(this._min,o.R3.INFINITY),o.R3.copy(this._max,o.R3.NEGATIVE_INFINITY)},volume:function(){var t=this._max[0]-this._min[0];return t*=this._max[1]-this._min[1],t*=this._max[2]-this._min[2]},copy:function(t){o.R3.copy(this._min,t._min),o.R3.copy(this._max,t._max)},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandByBoundingSphere:function(t){if(t.valid()){var e=this._max,i=this._min,r=t._radius,n=t._center[0],a=t._center[1],s=t._center[2];i[0]=Math.min(i[0],n-r),i[1]=Math.min(i[1],a-r),i[2]=Math.min(i[2],s-r),e[0]=Math.max(e[0],n+r),e[1]=Math.max(e[1],a+r),e[2]=Math.max(e[2],s+r)}},expandByvec3:function(t){a.Z.warn("deprecated, use expandByVec3"),this.expandByVec3(t)},expandByVec3:function(t){var e=this._min,i=this._max;e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),i[0]=Math.max(i[0],t[0]),i[1]=Math.max(i[1],t[1]),i[2]=Math.max(i[2],t[2])},expandByBoundingBox:function(t){if(t.valid()){var e=this._min,i=this._max,r=t._min,n=t._max;r[0]<e[0]&&(e[0]=r[0]),n[0]>i[0]&&(i[0]=n[0]),r[1]<e[1]&&(e[1]=r[1]),n[1]>i[1]&&(i[1]=n[1]),r[2]<e[2]&&(e[2]=r[2]),n[2]>i[2]&&(i[2]=n[2])}},center:function(t){var e=this._min,i=this._max;return t[0]=.5*(e[0]+i[0]),t[1]=.5*(e[1]+i[1]),t[2]=.5*(e[2]+i[2]),t},radius:radius2:function(){var t=this._min,e=this._max,i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return.25*(i*i+r*r+n*n)},getMin:function(){return this._min},getMax:function(){return this._max},setMin:function(t){return o.R3.copy(this._min,t),this},setMax:xMax:function(){return this._max[0]},yMax:function(){return this._max[1]},zMax:function(){return this._max[2]},xMin:function(){return this._min[0]},yMin:function(){return this._min[1]},zMin:function(){return this._min[2]},corner:function(t,e){return e[0]=1&t?this._max[0]:this._min[0],e[1]=2&t?this._max[1]:this._min[1],e[2]=4&t?this._max[2]:this._min[2],e},transformMat4:(r=o.R3.create(),n=o.R3.create(),function(t,e){var i=this.getMin(),a=this.getMax();o._E.getTranslation(r,e),o.R3.copy(n,r);for(var s=0;s<3;++s)for(var h=4*s,u=i[s],c=a[s],l=0;l<3;++l){var _=e[h+l],d=_*c,f=_*u;d<f?(r[l]+=d,n[l]+=f):(r[l]+=f,n[l]+=d)}var p=t.getMax(),g=t.getMin();return p[0]=n[0],p[1]=n[1],p[2]=n[2],g[0]=r[0],g[1]=r[1],g[2]=r[2],t})},"osg","BoundingBox");const u=h},bxht:(t,e,i)=>{"use strict";i.d(e,{Z:()=>_});var r,n,a,s,o=i("u5PS"),h=i("GoyH"),u=i("k3oU"),c=i("W40i"),l=function(){this._center=c.R3.create(),this._radius=-1};h.Z.createPrototypeObject(l,{init:function(){c.R3.init(this._center),this._radius=-1},valid:set:function(t,e){this._center=t,this._radius=e},center:function(){return this._center},radius:function(){return this._radius},radius2:volume:function(){var t=this._radius;return t*t*t*Math.PI*4/3},copy:function(t){this._radius=t._radius,c.R3.copy(this._center,t._center)},copyBoundingBox:function(t){t.center(this._center),this._radius=t.radius()},expandByBoundingBox:(a=c.R3.create(),s=new u.Z,function(t){if(t.valid())if(this.valid()){c.R3.copy(s._min,t._min),c.R3.copy(s._max,t._max);for(var e=0;e<8;e++)c.R3.sub(a,t.corner(e,a),this._center),c.R3.normalize(a,a),c.R3.scaleAndAdd(a,this._center,a,-this._radius),s.expandByVec3(a);s.center(this._center),this._radius=s.radius()}else this.copyBoundingBox(t)}),expandByvec3:expandByVec3:(n=c.R3.create(),function(t){if(this.valid()){c.R3.sub(n,t,this.center(n));var e=c.R3.length(n);if(e>this.radius()){var i=.5*(e-this.radius());this._center[0]+=n[0]*(i/e),this._center[1]+=n[1]*(i/e),this._center[2]+=n[2]*(i/e),this._radius+=i}}else this._center[0]=t[0],this._center[1]=t[1],this._center[2]=t[2],this._radius=0}),expandRadiusBySphere:function(t){if(t.valid())if(this.valid()){var e=c.R3.distance(this._center,t._center)+t._radius;e>this._radius&&(this._radius=e)}else c.R3.copy(this._center,t._center),this._radius=t._radius},expandByBoundingSphere:function(t){if(t.valid()){if(!this.valid())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t.radius());var e=c.R3.distance(t.center(),this.center());if(!(e+t.radius()<=this.radius())){if(e+this.radius()<=t.radius())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t._radius);var i=.5*(this.radius()+e+t.radius()),r=(i-this.radius())/e;this._center[0]+=(t._center[0]-this._center[0])*r,this._center[1]+=(t._center[1]-this._center[1])*r,this._center[2]+=(t._center[2]-this._center[2])*r,this._radius=i}}},contains:function(t){return!!this.valid()&&c.R3.sqrDist(this.center(),t)<=this.radius2()},intersects:function(t){if(!this.valid()||!t.valid())return!1;var e=this.radius()+t.radius();return c.R3.sqrDist(t.center(),this.center())<=e*e},transformMat4:(r=c.R3.create(),function(t,e){if(!this.valid())return t;t._center!==this._center&&(c.R3.copy(t._center,this._center),t._radius=this._radius);var i=t._center,n=t._radius;return c._E.getSqrScale(r,e),n*=Math.sqrt(Math.max(Math.max(r[0],r[1]),r[2])),t._radius=n,c.R3.transformMat4(i,i,e),t})},"osg","BoundingSphere");const _=l},UqX1:(t,e,i)=>{"use strict";i.d(e,{Z:()=>f});var r=i("u5PS"),n=i("GoyH"),a=i("iUVs"),s=i("/CZr"),o=i("6qT5"),h=i("W40i"),u=i("MQQR"),c=l=function(t,e,i){s.Z.call(this),this._instanceID=a.Z.getInstanceID(),this.dirty(),this._itemSize=i,this._target="string"==typeof t?l[t]:t,this._type=void 0,this._normalize=!1,e&&(void 0===e.byteLength&&(r.Z.warn("BufferArray with non typedArray elements is deprecated"),e=this._target===l.ELEMENT_ARRAY_BUFFER?new n.Z.Uint16Array(e):new n.Z.Float32Array(e)),this.setElements(e)),this._usage=l.STATIC_DRAW},_=d=h.R3.fromValues(_(.1,10),_(4.2,7.5),_(.7,1.5));l.randa=d,l.ELEMENT_ARRAY_BUFFER=34963,l.ARRAY_BUFFER=34962,l.STATIC_DRAW=35044,l.DYNAMIC_DRAW=35048,l.STREAM_DRAW=35040,l._sDeletedGLBufferArrayCache=new window.Map,l.deleteGLBufferArray=function(t,e){l._sDeletedGLBufferArrayCache.has(t)||l._sDeletedGLBufferArrayCache.set(t,[]),l._sDeletedGLBufferArrayCache.get(t).push(e)},l.flushDeletedGLBufferArrays=function(t,e){if(e<=0)return e;if(!l._sDeletedGLBufferArrayCache.has(t))return e;for(var i=0,r=o.Z.instance().tick(),n=l._sDeletedGLBufferArrayCache.get(t),a=n.length-1;a>=0&&i<e;a--)t.deleteBuffer(n[a]),n.splice(a,1),i=o.Z.instance().deltaS(r,o.Z.instance().tick());return e-i},l.flushAllDeletedGLBufferArrays=function(t){if(l._sDeletedGLBufferArrayCache.has(t))for(var e=l._sDeletedGLBufferArrayCache.get(t),i=e.length-1;i>=0;i--)t.deleteBuffer(e[i]),e.splice(i,1)},l.onLostContext=function(t){l._sDeletedGLBufferArrayCache.has(t)&&(l._sDeletedGLBufferArrayCache.get(t).length=0)},n.Z.createPrototypeObject(l,n.Z.objectInherit(s.Z.prototype,{setUsage:function(t){this._usage=t},getUsage:function(){return this._usage},getInstanceID:function(){return this._instanceID},setItemSize:function(t){this._itemSize=t},isValid:function(){return!!this._buffer||!(!this._elements||!this._elements.length)},invalidate:function(){this._buffer=void 0,this.dirty()},releaseGLObjects:function(){void 0!==this._buffer&&null!==this._buffer&&void 0!==this._gl&&(l.deleteGLBufferArray(this._gl,this._buffer),s.Z.removeObject(this._gl,this)),this.invalidate()},setNormalize:function(t){this._normalize=t},getNormalize:function(){return this._normalize},bind:function(t){this._gl||this.setGraphicContext(t);var e=this._target,i=this._buffer;i?t.bindBuffer(e,i):!i&&this._elements.length>0&&(this._buffer=t.createBuffer(),this._numItems=this._elements.length/this._itemSize,t.bindBuffer(e,this._buffer))},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},setElements:function(t){var e,i;this._elements=t,this._type=((e=t)instanceof n.Z.Float32Array&&(i=5126),e instanceof n.Z.Int16Array&&(i=5122),e instanceof n.Z.Uint16Array&&(i=5123),e instanceof n.Z.Int8Array&&(i=5120),e instanceof n.Z.Uint8Array&&(i=5121),e instanceof n.Z.Uint8ClampedArray&&(i=5121),e instanceof n.Z.Int32Array&&(i=5124),e instanceof n.Z.Uint32Array&&(i=5125),i),this._dirty=!0},getType:function(){return this._type},compile:function(t){if(this._dirty)return this._QTAN||this._QNOR?this._encodeDirection(t):this._QVS?this._encodeVertex(t):this._QUV?this._encodeUV(t):void this.compileGl(t)},compileGl:function(t){this._dirty&&(t.bufferData(this._target,this._elements,this._usage),this._dirty=!1)},getGlItemSize:function(){return this._glItemSize||this._itemSize},getGlType:function(){return this._glType||this._type},getGlNormalize:function(){return this._glNormalize||this._normalize},getElements:function(){return this._elements},computeMinMaxVertex:function(t,e,i){return this._minMaxVertex(t,e,i)},computeMinMaxUV:_minMaxVertex:function(t,e,i){for(var r=1/0,n=1/0,a=1/0,s=-1/0,o=-1/0,h=-1/0,u=this.getElements(),c=void 0===i?u.length:i,l=e||0;l<c;l+=3){var _=u[l],d=u[l+1],f=u[l+2];_<r&&(r=_),d<n&&(n=d),f<a&&(a=f),_>s&&(s=_),d>o&&(o=d),f>h&&(h=f)}return s<=r&&(s=.001),o<=n&&(o=.001),h<=a&&(h=.001),t.xmin=r,t.xmax=s,t.ymin=n,t.ymax=o,t.zmin=a,t.zmax=h,t},_minMaxUV:function(t,e,i){for(var r=1/0,n=1/0,a=-1/0,s=-1/0,o=this.getElements(),h=void 0===i?o.length:i,u=e||0;u<h;u+=2){var c=o[u],l=o[u+1];c<r&&(r=c),l<n&&(n=l),c>a&&(a=c),l>s&&(s=l)}return a<=r&&(a=.001),s<=n&&(s=.001),t.xmin=r,t.ymin=n,t.xmax=a,t.ymax=s,t},_compileHook:function(t,e,i,r){var n=this.getElements(),a=this.getItemSize(),s=this.getNormalize();this.setNormalize(i),this.setItemSize(e),this.setElements(t),this._glType=this.getType(),this._glItemSize=e,this._glNormalize=i,this.compileGl(r),this.setElements(n),this.setItemSize(a),this.setNormalize(s),this._dirty=!1},_encodeDirection:function(t){for(var e=this.getElements(),i=e.length,r=32767,n=this.getItemSize(),a=n-1,s=0,o=new Int16Array(a*i/n),h=(0,u.Z)().zoct,c=0;c<i;c+=n){var l=e[c],_=e[c+1],d=e[c+2],f=1/Math.sqrt(l*l+_*_+d*d);if(l*=f,_*=f,d*=f,h){var p=1/(Math.abs(l)+Math.abs(_)+Math.abs(d)),g=l*p,m=_*p,v=d*p,b=v>=0?g:(1-Math.abs(m))*(Math.sign(g)||1),S=v>=0?m:(1-Math.abs(g))*(Math.sign(m)||1);o[s]=r*b,o[s+1]=r*S}else if(d<=-.99999)o[s]=r*Math.sqrt(.5),o[s+1]=r*Math.sqrt(.5);else{var y=1/Math.sqrt(2*d+2);o[s]=r*l*y,o[s+1]=r*_*y}3===a&&(o[s+2]=r*e[c+3]),s+=a}this._compileHook(o,a,!0,t)},_encodeVertex:function(t){var e=this._QVS,i=this._QVT,r=this.getElements(),n=this._FQU||this._minMax&&this._minMax._FQU;n&&c("vFQU - "+this.getInstanceID());for(var a=(0,u.Z)().zq&&!n,s=a?65535:1,o=a?Uint16Array:Float32Array,h=1/(d[0]*e[0]),l=1/(d[1]*e[1]),_=1/(d[2]*e[2]),f=i[0],p=i[1],g=i[2],m=(0,u.Z)().zw,v=this.getItemSize(),b=m?4:3,S=r.length,y=new o(b*S/v),T=0,x=0;x<S;x+=v){var E=h*(r[x]-f),R=l*(r[x+1]-p),A=_*(r[x+2]-g);if(y[T]=s*E,y[T+1]=s*R,y[T+2]=s*A,m){var C=Math.min(y[T],y[T+1],y[T+2]);y[T]-=C,y[T+1]-=C,y[T+2]-=C,y[T+3]=C}T+=b}this._compileHook(y,b,a,t)},_encodeUV:function(t){var e=this._QUV,i=e[0],r=e[1],n=1/e[2],a=1/e[3],s=this.getElements(),o=s.length,u=0;if(Math.max(e[2],e[3])/65535>1/2048)return c("NoQUV - "+this.getInstanceID()),this.compileGl(t),void h.vh.set(e,0,0,1,1);var l=65535*n,_=65535*a,d=new Uint16Array(o);for(u=0;u<o;u+=2)d[u]=l*(s[u]-i),d[u+1]=_*(s[u+1]-r);this._compileHook(d,2,!0,t)}}),"osg","BufferArray");const f=l},eYxU:(t,e,i)=>{"use strict";i.d(e,{Z:()=>h});var r=i("UqX1"),n=function(t){this._initialBufferArray=void 0,this._bufferArray=void 0,t&&(this.setBufferArray(t),this.setInitialBufferArray(t))},a={setInitialBufferArray:function(t){this._initialBufferArray=t},getInitialBufferArray:function(){return this._initialBufferArray},setBufferArray:function(t){this._bufferArray=t.getBufferArray?t.getBufferArray():t},getBufferArray:function(){return this._bufferArray},getGlItemSize:function(){return this._bufferArray.getGlItemSize()},getGlType:function(){return this._bufferArray.getGlType()},getGlNormalize:function(){return this._bufferArray.getGlNormalize()}},s=for(var o in r.Z.prototype)a[o]=s(r.Z.prototype[o]);n.prototype=a;const h=n},W6eo:(t,e,i)=>{"use strict";i.d(e,{Z:()=>l});var r,n=i("GoyH"),a=i("6RPJ"),s=i("qlNd"),o=i("W40i"),h=i("5rJd"),u=i("pSxj"),c=function(){a.Z.call(this),s.Z.call(this),this.viewport=void 0,this._graphicContext=void 0,this._scissor=void 0,this.setClearColor(o.vh.fromValues(0,0,0,1)),this.setClearDepth(1),this.setClearMask(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),this.setViewMatrix(o._E.create()),this.setProjectionMatrix(o._E.create()),this.renderOrder=c.NESTED_RENDER,this.renderOrderNum=0,this._view=void 0,this._renderer=void 0,this._attachments={}};c.PRE_RENDER=0,c.NESTED_RENDER=1,c.POST_RENDER=2,c.COLOR_BUFFER_BIT=16384,c.DEPTH_BUFFER_BIT=256,c.STENCIL_BUFFER_BIT=1024,n.Z.createPrototypeNode(c,n.Z.objectInherit(s.Z.prototype,n.Z.objectInherit(a.Z.prototype,{getView:function(){return this._view},setView:function(t){this._view=t},getRenderer:function(){return this._renderer},setRenderer:function(t){this._renderer=t},setFinalDrawCallback:function(t){this._finalDrawCallback=t},getFinalDrawCallback:function(){return this._finalDrawCallback},setInitialDrawCallback:function(t){this._initialDrawCallback=t},getInitialDrawCallback:function(){return this._initialDrawCallback},getAttachments:function(){return this._attachments},setGraphicContext:function(t){this._graphicContext=t},getGraphicContext:function(){return this._graphicContext},setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setClearColor:function(t){this.clearColor=t},getClearColor:function(){return this.clearColor},setViewport:function(t){this.viewport=t,this.getOrCreateStateSet().setAttributeAndModes(t)},getViewport:function(){return this.viewport},setScissor:function(t){this._scissor=t,this.getOrCreateStateSet().setAttributeAndModes(this._scissor)},getScissor:function(){return this._scissor},setViewMatrix:function(t){this.modelviewMatrix=t},setViewMatrixAsLookAt:function(t,e,i){o._E.lookAt(this.getViewMatrix(),t,e,i)},setProjectionMatrix:function(t){this.projectionMatrix=t},setProjectionMatrixAsOrtho:function(t,e,i,r,n,a){o._E.ortho(this.getProjectionMatrix(),t,e,i,r,n,a)},isRenderToTextureCamera:function(){return window.Object.keys(this._attachments).length>0},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(t,e){this.renderOrder=t,this.renderOrderNum=e},getFrameBufferObject:function(){return this.frameBufferObject},setFrameBufferObject:function(t){this.frameBufferObject=t},detachAll:function(){this._attachments={},this.frameBufferObject&&this.frameBufferObject.dirty()},resetAttachments:function(){this.frameBufferObject&&(this.frameBufferObject.reset(),this.frameBufferObject=0),this._attachments={}},attachTexture:function(t,e,i){this.frameBufferObject&&this.frameBufferObject.dirty(),i||(i=h.Z.TEXTURE_2D),this._attachments[t]={attachment:t,texture:e,textureTarget:i}},attachRenderBuffer:function(t,e){this.frameBufferObject&&this.frameBufferObject.dirty(),this._attachments[t]={format:e,attachment:t}},computeLocalToWorldMatrix:function(t){return this.referenceFrame===u.Z.RELATIVE_RF?o._E.mul(t,t,this.modelviewMatrix):o._E.copy(t,this.modelviewMatrix),!0},computeWorldToLocalMatrix:(r=o._E.create(),function(t){return o._E.invert(r,this.modelviewMatrix),this.referenceFrame===u.Z.RELATIVE_RF?o._E.mul(t,r,t):o._E.copy(t,r),!0})})),"osg","Camera");const l=c},"t+pa":(t,e,i)=>{"use strict";i.d(e,{Z:()=>d});var r,n=i("k3oU"),a=i("6Szz"),s=i("W40i"),o=i("6RPJ"),h=i("CJNH"),u=i("GoyH"),c=i("bDLW"),l=i("cyFB"),_=function(t){h.Z.call(this,t),this._pooledMatrix=new l.Z(s._E.create),this._matrixStack=new c.Z,this._matrixStack.push(s._E.IDENTITY),this._bb=new n.Z};u.Z.createPrototypeObject(_,u.Z.objectInherit(h.Z.prototype,{reset:function(){this._pooledMatrix.reset(),this._matrixStack.reset(),this._matrixStack.push(s._E.IDENTITY),this._bb.init()},getBoundingBox:function(){return this._bb},applyTransform:function(t){var e=this._pooledMatrix.getOrCreateObject();s._E.copy(e,this._matrixStack.back()),t.computeLocalToWorldMatrix(e,this),this.pushMatrix(e),this.traverse(t),this.popMatrix()},apply:function(t){t instanceof o.Z?this.applyTransform(t):t instanceof a.Z?this.applyBoundingBox(t.getBoundingBox()):this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()},applyBoundingBox:(r=new n.Z,function(t){t.valid()&&(t.transformMat4(r,this._matrixStack.back()),this._bb.expandByBoundingBox(r))}),getMatrixStack:function(){return this._matrixStack}}),"osg","ComputeBoundsVisitor");const d=_},nbbV:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var r=i("GoyH"),n=i("WWMP"),a=function(t){n.Z.call(this),this.setMode(void 0!==t?t:a.BACK)};a.DISABLE=0,a.FRONT=1028,a.BACK=1029,a.FRONT_AND_BACK=1032,r.Z.createPrototypeStateAttribute(a,r.Z.objectInherit(n.Z.prototype,{attributeType:"CullFace",cloneType:function(){return new a},setMode:function(t){var e=t;"string"==typeof e&&(e=a[e]),this._mode=e},getMode:function(){return this._mode},apply:function(t){t.applyCullFace(this)}}),"osg","CullFace");const s=a},qlNd:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r=r.prototype={reset:function(){this._computeNearFar=!0,this._nearFarRatio=.005,this._enableFrustumCulling=!1,this._settingsSourceOverrider=this,this._LODScale=1,this._clampProjectionMatrixCallback=void 0},setCullSettings:setNearFarRatio:function(t){this._nearFarRatio=t},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(t){this._computeNearFar=t},getComputeNearFar:function(){return this._computeNearFar},setEnableFrustumCulling:function(t){this._enableFrustumCulling=t},getEnableFrustumCulling:function(){return this._enableFrustumCulling},getSettingSourceOverrider:function(){return this._settingsSourceOverrider},setClampProjectionMatrixCallback:function(t){this._clampProjectionMatrixCallback=t},getClampProjectionMatrixCallback:function(){return this._clampProjectionMatrixCallback},setLODScale:function(t){this._LODScale=t},getLODScale:function(){return this._LODScale}};const n=r},Mfw4:(t,e,i)=>{"use strict";i.d(e,{Z:()=>y});var r,n,a,s=i("GoyH"),o=i("bxht"),h=i("W6eo"),u=i("haRL"),c=i("qlNd"),l=i("IQqM"),_=i("W40i"),d=i("itLJ"),f=i("6RPJ"),p=i("pSxj"),g=i("bDLW"),m=i("cyFB"),v=i("gjC8"),b=function(){return new l.Z},S=function(){this._modelViewMatrixStack=new g.Z,this._projectionMatrixStack=new g.Z,this._viewportStack=new g.Z,this._cullingSetStack=new g.Z,this._frustumVolume=-1,this._bbCornerFar=0,this._bbCornerNear=0,this._pooledMatrix=new m.Z(_._E.create),this._pooledCullingSet=new m.Z(b),this._cameraIndexStack=new g.Z,this._cameraModelViewIndexStack=new g.Z,this._cameraMatrixInverse=new v.Z,this._cameraMatrixInverseRoot=void 0};s.Z.createPrototypeObject(S,s.Z.objectInherit(c.Z.prototype,{reset:function(){this._modelViewMatrixStack.reset(),this._projectionMatrixStack.reset(),this._cullingSetStack.reset(),this._pooledMatrix.reset(),this._pooledCullingSet.reset(),this._cameraModelViewIndexStack.reset(),this._cameraIndexStack.reset(),this._cameraMatrixInverse.reset(),this._cameraMatrixInverseRoot=void 0},getProjectionMatrixStack:function(){return this._projectionMatrixStack},getCurrentProjectionMatrix:function(){return this._projectionMatrixStack.back()},getCurrentModelViewMatrix:function(){return this._modelViewMatrixStack.back()},getCameraInverseMatrix:function(){if(!this._cameraIndexStack.getLength())return this._cameraMatrixInverseRoot;var t=this._cameraIndexStack.back(),e=this.getNodePath()[t].getInstanceID(),i=this._cameraMatrixInverse.getMap()[e];if(void 0===i){var r=this._cameraModelViewIndexStack.back(),n=this._modelViewMatrixStack.getArray()[r];i=this._pooledMatrix.getOrCreateObject(),_._E.invert(i,n),this._cameraMatrixInverse.set(e,i)}return i},getCurrentModelMatrix:function(){var t=this.getCameraInverseMatrix(),e=this._pooledMatrix.getOrCreateObject();return _._E.mul(e,t,this.getCurrentModelViewMatrix())},getCurrentViewMatrix:function(){var t=this._modelViewMatrixStack.getArray();return this._cameraIndexStack.getLength()?t[this._cameraModelViewIndexStack.back()]:t[0]},getViewport:function(){if(0!==this._viewportStack.getLength())return this._viewportStack.back()},getLookVectorLocal:function(t){var e=this.getCurrentModelViewMatrix();return _.R3.set(t,-e[2],-e[6],-e[10])},pushViewport:function(t){this._viewportStack.push(t)},popViewport:function(){this._viewportStack.pop()},getFrustumPlanes:(a=_._E.create(),function(t,e,i,r){_._E.mul(a,e,i);var n=!!r,s=t[0];s[0]=a[3]-a[0],s[1]=a[7]-a[4],s[2]=a[11]-a[8],s[3]=a[15]-a[12];var o=t[1];o[0]=a[3]+a[0],o[1]=a[7]+a[4],o[2]=a[11]+a[8],o[3]=a[15]+a[12];var h=t[2];h[0]=a[3]+a[1],h[1]=a[7]+a[5],h[2]=a[11]+a[9],h[3]=a[15]+a[13];var u=t[3];if(u[0]=a[3]-a[1],u[1]=a[7]-a[5],u[2]=a[11]-a[9],u[3]=a[15]-a[13],n){var c=t[4];c[0]=a[3]-a[2],c[1]=a[7]-a[6],c[2]=a[11]-a[10],c[3]=a[15]-a[14];var l=t[5];l[0]=a[3]+a[2],l[1]=a[7]+a[6],l[2]=a[11]+a[10],l[3]=a[15]+a[14]}for(var f=r?6:4,p=0;p<f;p++)d.Z.normalizeEquation(t[p])}),pushCullingSet:function(){var t=this._pooledCullingSet.getOrCreateObject();this._enableFrustumCulling&&(_._E.getFrustumPlanes(t.getFrustum().getPlanes(),this.getCurrentProjectionMatrix(),this.getCurrentModelViewMatrix(),!1),t.getFrustum().setupMask(4)),this._cullingSetStack.push(t)},popCullingSet:function(){return this._cullingSetStack.pop()},getCurrentCullingSet:function(){return this._cullingSetStack.back()},pushCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.pushCurrentMask()},popCurrentMask:isVerticesCulled:function(t){return!!this._enableFrustumCulling&&this.getCurrentCullingSet().isVerticesCulled(t)},isBoundingBoxCulled:function(t){return!!this._enableFrustumCulling&&(t.valid()&&this.getCurrentCullingSet().isBoundingBoxCulled(t))},isBoundingSphereCulled:function(t){return!!this._enableFrustumCulling&&(t.valid()&&this.getCurrentCullingSet().isBoundingSphereCulled(t))},isCulled:(n=new o.Z,function(t,e){if(!this._enableFrustumCulling)return!1;if(t.isCullingActive()){if(0===this.getCurrentCullingSet().getCurrentResultMask())return!1;var i=this._pooledMatrix.getOrCreateObject();_._E.identity(i);var r=e.length;return t instanceof f.Z&&r--,u.Z.computeLocalToWorld(e,!0,i,r),t.getBound().transformMat4(n,i),this.getCurrentCullingSet().isBoundingSphereCulled(n)}return this.getCurrentCullingSet().resetCullingMask(),!1}),pushModelViewMatrix:(r=_.R3.create(),function(t){var e=this.getNodePath(),i=e.length;if(i){var n=i-1;e[n].getTypeID()===h.Z.getTypeID()&&e[n].getReferenceFrame()===p.Z.ABSOLUTE_RF&&(this._cameraIndexStack.push(n),this._cameraModelViewIndexStack.push(this._modelViewMatrixStack.getLength()))}else{var a=this._pooledMatrix.getOrCreateObject();_._E.invert(a,t),this._cameraMatrixInverseRoot=a}this._modelViewMatrixStack.push(t),this.getLookVectorLocal(r),this._bbCornerFar=(r[0]>=0?1:0)|(r[1]>=0?2:0)|(r[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}),popModelViewMatrix:function(){var t=_.R3.create();return function(){var e=this.getNodePath().length-1;this._cameraIndexStack.getLength()&&e===this._cameraIndexStack.back()&&(this._cameraIndexStack.pop(),this._cameraModelViewIndexStack.pop()),this._modelViewMatrixStack.pop(),this._modelViewMatrixStack.getLength()?this.getLookVectorLocal(t):_.R3.set(t,0,0,-1),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),pushProjectionMatrix:function(t){this._projectionMatrixStack.push(t),this._frustumVolume=-1,this.pushCullingSet()},popProjectionMatrix:function(){this._projectionMatrixStack.pop(),this._frustumVolume=-1,this.popCullingSet()}}),"osg","CullStack");const y=S},"t5D/":(t,e,i)=>{"use strict";i.d(e,{Z:()=>V});var r,n,a=i("u5PS"),s=i("GoyH"),o=i("LElp"),h=i("CJNH"),u=i("qlNd"),c=i("Mfw4"),l=i("W40i"),_=i("rfV8"),d=i("Pev1"),f=i("WMIH"),p=i("Ln1o"),g=i("SHDx"),m=i("6Szz"),v=i("gtcU"),b=i("hLVw"),S=i("QtIg"),y=i("IpZ9"),T=i("oHbX"),x=i("YVjV"),E=i("+jyg"),R=i("W6eo"),A=i("pSxj"),C=i("11nE"),M=i("5Zr1"),I=i("igDg"),w=i("mixV"),N=i("bDLW"),P=i("cyFB"),Z=function(){return new v.Z},L=O=function(){h.Z.call(this,h.Z.TRAVERSE_ACTIVE_CHILDREN),u.Z.call(this),c.Z.call(this),this._rootStateGraph=void 0,this._currentStateGraph=void 0,this._currentRenderBin=void 0,this._currentRenderStage=void 0,this._rootRenderStage=void 0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this._camera=void 0,this._pooledLeaf=new P.Z(Z),this._pooledRenderStages={},this._pooledCullSettings=new P.Z(L),this._renderBinStack=new N.Z,this.visitorType=h.Z.CULL_VISITOR,this._identityMatrix=l._E.create(),this._renderer=void 0,this._renderStageType=S.Z,this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0};O.registerApplyFunction=g.Z.registerApplyFunction,O.getApplyFunction=g.Z.getApplyFunction,s.Z.createPrototypeObject(O,s.Z.objectInherit(c.Z.prototype,s.Z.objectInherit(h.Z.prototype,{applyFunctionArray:g.Z.applyFunctionArray,distance:function(t,e){return-(t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+e[14])},getComputedNear:function(){return this._computedNear},getComputedFar:function(){return this._computedFar},resetStats:handleCullCallbacksAndTraverse:function(t){var e=t.getCullCallback();e&&!e.cull(t,this)||this.traverse(t)},getCurrentCamera:updateCalculatedNearFar:(r=l.R3.create(),n=l.R3.create(),function(t,e){var i,a,s=e.getBoundingBox();if((i=this.distance(s.corner(this._bbCornerNear,r),t))>(a=this.distance(s.corner(this._bbCornerFar,n),t))){var o=i;i=a,a=o}return!(a<0||(i<this._computedNear&&(this._computedNear=i),a>this._computedFar&&(this._computedFar=a),0))}),setStateGraph:function(t){this._rootStateGraph=t,this._currentStateGraph=t},setRenderStage:function(t){this._rootRenderStage=t,this._currentRenderBin=t},setRenderer:function(t){this._renderer=t},getRenderer:function(){return this._renderer},reset:function(){for(var t in c.Z.prototype.reset.call(this),this._pooledLeaf.reset(),this._pooledCullSettings.reset(),this._pooledRenderStages)this._pooledRenderStages[t].reset();b.Z.reset(),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(t){this._currentRenderBin=t},addPositionedAttribute:function(t,e){var i=t||this._identityMatrix;this._currentRenderBin.getStage().addPositionAttribute(i,e)},pushStateSet:function(t){if(this._currentStateGraph=this._currentStateGraph.findOrInsert(t),void 0!==t.getBinName()){var e=this._renderBinStack,i=this._currentRenderBin;e.push(i),this._currentRenderBin=i.getStage().findOrInsert(t.getBinNumber(),t.getBinName())}},popStateSet:function(){var t=this._currentStateGraph,e=t.getStateSet();if(this._currentStateGraph=t.getParent(),void 0!==e.getBinName()){var i=this._renderBinStack;0===i.getLength()?this._currentRenderBin=this._currentRenderBin.getStage():this._currentRenderBin=i.pop()}},popProjectionMatrix:function(){if(!0===this._computeNearFar&&this._computedFar>=this._computedNear){var t=this.getCurrentProjectionMatrix();void 0!==this._clampProjectionMatrixCallback?this._clampProjectionMatrixCallback(t,this._computedNear,this._computedFar,this._nearFarRatio):this.clampProjectionMatrix(t,this._computedNear,this._computedFar,this._nearFarRatio)}c.Z.prototype.popProjectionMatrix.call(this)},clampProjectionMatrix:function(t,e,i,r,n){var s,o,h=1e-6;if(i<e-h)return a.Z.log("clampProjectionMatrix not applied, invalid depth range, znear = "+e+"  zfar = "+i,!1,!0),!1;if(i<e+h){var u=.5*(e+i);e=u-h,i=u+h}if(Math.abs(t[3])<h&&Math.abs(t[7])<h&&Math.abs(t[11])<h){var c=.02*(i-e);c<1&&(c=1),e=s=e-c,i=o=i+c,t[10]=-2/(o-s),t[14]=-(o+s)/(o-s)}else{var l=i*r;(s=.98*e)<l&&(s=l),e=s,i=o=1.02*i;var _=t[10],d=t[14],f=t[11],p=t[15],g=(-s*_+d)/(-s*f+p),m=(-o*_+d)/(-o*f+p),v=Math.abs(2/(g-m)),b=-(g+m)/2*v;t[2]=t[2]*v+t[3]*b,t[6]=t[6]*v+t[7]*b,t[10]=_*v+f*b,t[14]=d*v+p*b}return void 0!==n&&(n[0]=e,n[1]=i),!0},popCameraModelViewProjectionMatrix:function(){this.popModelViewMatrix(),this.popProjectionMatrix()},pushCameraModelViewProjectionMatrix:apply:function(t){this.applyFunctionArray[t.nodeTypeID].call(this,t)},createOrReuseRenderLeaf:function(){return this._pooledLeaf.getOrCreateObject()},createOrReuseRenderStage:function(t){var e=t?t.className():"RenderStage";if(!this._pooledRenderStages[e]){var i=t?t.constructor:S.Z;this._pooledRenderStages[e]=new P.Z((function(){return new i}))}return this._pooledRenderStages[e].getOrCreateObject().init()},postPushGeometry:function(t,e){var i,r;e instanceof M.Z?((r=e.getStateSetAnimation())&&t.pushStateSet(r),(i=e.getSourceGeometry())instanceof w.Z&&(r=i.getStateSetAnimation())&&t.pushStateSet(r)):e instanceof w.Z&&(r=e.getStateSetAnimation())&&t.pushStateSet(r)},prePopGeometry:function(t,e){if(e instanceof M.Z){var i=e.getSourceGeometry();i instanceof w.Z&&i.getStateSetAnimation()&&t.popStateSet(),e.getStateSetAnimation()&&t.popStateSet()}else e instanceof w.Z&&e.getStateSetAnimation()&&t.popStateSet()},pushLeaf:function(t,e){var i=this._currentStateGraph.getLeafs();i.getLength()||this._currentRenderBin.addStateGraph(this._currentStateGraph);var r=this.createOrReuseRenderLeaf();r.init(this._currentStateGraph,t,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelMatrix(),e),i.push(r)}})),"osg","CullVisitor");var F=function(t){if(this._numMatrixTransform++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=this._pooledMatrix.getOrCreateObject(),i=this.getCurrentModelViewMatrix();l._E.copy(e,i),t.computeLocalToWorldMatrix(e),this.pushModelViewMatrix(e);var r=t.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(t),r&&this.popStateSet(),this.popModelViewMatrix(),this.popCurrentMask()}},D=function(t){if(this._numNode++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=t.getStateSet();e&&this.pushStateSet(e),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet(),this.popCurrentMask()}},U=l.R3.create(),B=!1,k=function(t){this._numGeometry++;var e=this.getCurrentModelViewMatrix(),i=t.getBoundingBox(),r=i.valid();if(!this._computeNearFar||!r||this.updateCalculatedNearFar(e,t)){var n=t.getCullCallback();if(!n||n.cull(t,this)){var s=t.getStateSet();s&&this.pushStateSet(s),this.postPushGeometry(this,t);var h=0;r?(h=this.distance(i.center(U),e),o.Z.isNaN(h)?B||(a.Z.warn("warning geometry has a NaN depth, "+e+" center "+U),B=!0):this.pushLeaf(t,h)):this.pushLeaf(t,h),this.prePopGeometry(this,t),s&&this.popStateSet()}}};g.Z.registerApplyFunction(y.Z.nodeTypeID,D),g.Z.registerApplyFunction(x.Z.nodeTypeID,D),g.Z.registerApplyFunction(E.Z.nodeTypeID,D),g.Z.registerApplyFunction(R.Z.nodeTypeID,(function(t){this._numCamera++;var e=t.getStateSet();e&&this.pushStateSet(e);var i=this._pooledMatrix.getOrCreateObject(),r=this._pooledMatrix.getOrCreateObject();if(t.getReferenceFrame()===A.Z.RELATIVE_RF){var n=this.getCurrentProjectionMatrix();l._E.mul(r,n,t.getProjectionMatrix());var a=this.getCurrentModelViewMatrix();l._E.mul(i,a,t.getViewMatrix())}else l._E.copy(i,t.getViewMatrix()),l._E.copy(r,t.getProjectionMatrix());var s=this._computedNear,o=this._computedFar,h=this._pooledCullSettings.getOrCreateObject();if(h.reset(),h.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(t),h.getSettingSourceOverrider()===this&&h.getEnableFrustumCulling()&&this.setEnableFrustumCulling(!0),this.pushCameraModelViewProjectionMatrix(t,i,r),t.getViewport()&&this.pushViewport(t.getViewport()),t.getRenderOrder()===R.Z.NESTED_RENDER)this.handleCullCallbacksAndTraverse(t);else{var u=this.getCurrentRenderBin(),c=u.getStage(),_=this.createOrReuseRenderStage(this._rootRenderStage);_.setCamera(t),_.setClearDepth(t.getClearDepth()),_.setClearColor(t.getClearColor()),_.setClearMask(t.getClearMask());var d=t.getViewport()?t.getViewport():c.getViewport(),f=t.getScissor()?t.getScissor():c.getScissor();_.setViewport(d),_.setScissor(f),this.setCurrentRenderBin(_),this.handleCullCallbacksAndTraverse(t),this.setCurrentRenderBin(u),t.getRenderOrder()===R.Z.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(_,t.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(_,t.renderOrderNum)}this.popCameraModelViewProjectionMatrix(t),t.getViewport()&&this.popViewport(),this.setCullSettings(h),this._computedNear=s,this._computedFar=o,e&&this.popStateSet()})),g.Z.registerApplyFunction(_.Z.nodeTypeID,F),g.Z.registerApplyFunction(f.Z.nodeTypeID,(function(t){this._numProjection++;var e=this.getCurrentProjectionMatrix(),i=this._pooledMatrix.getOrCreateObject();l._E.mul(i,e,t.getProjectionMatrix()),this.pushProjectionMatrix(i);var r=t.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(t),r&&this.popStateSet(),this.popProjectionMatrix()})),g.Z.registerApplyFunction(m.Z.nodeTypeID,k),g.Z.registerApplyFunction(C.Z.nodeTypeID,F),g.Z.registerApplyFunction(I.Z.nodeTypeID,F),g.Z.registerApplyFunction(d.Z.nodeTypeID,F),g.Z.registerApplyFunction(T.Z.nodeTypeID,D),g.Z.registerApplyFunction(p.Z.nodeTypeID,(function(t){this._numLightSource++;var e=t.getStateSet();e&&this.pushStateSet(e);var i=t.getLight();i&&(t.getReferenceFrame()===A.Z.RELATIVE_RF?this.addPositionedAttribute(this.getCurrentModelViewMatrix(),i):this.addPositionedAttribute(null,i)),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet()})),g.Z.registerApplyFunction(M.Z.nodeTypeID,k),g.Z.registerApplyFunction(w.Z.nodeTypeID,k);const V=O},IQqM:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i("e0P+"),n=function(){this._mask=n.DEFAULT_CULLING,this._frustum=new r.Z};n.prototype={reset:setCullingMask:function(t){this._mask=t},getCullingMask:function(){return this._mask},setFrustum:function(t){this._frustum=t},getFrustum:function(){return this._frustum},getCurrentResultMask:function(){return this._frustum.getCurrentMask()},pushCurrentMask:function(){this._frustum.pushCurrentMask()},popCurrentMask:function(){this._frustum.popCurrentMask()},resetCullingMask:isBoundingBoxCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingBox(t))},isBoundingSphereCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingSphere(t))},isVerticesCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsVertices(t))}},n.NO_CULLING=0,n.VIEW_FRUSTUM_LEFT_CULLING=1,n.VIEW_FRUSTUM_RIGHT_CULLING=2,n.VIEW_FRUSTUM_TOP_CULLING=3,n.VIEW_FRUSTUM_BOTTOM_CULLING=4,n.NEAR_PLANE_CULLING=5,n.FAR_PLANE_CULLING=6,n.VIEW_FRUSTUM_SIDES_CULLING=n.VIEW_FRUSTUM_LEFT_CULLING|n.VIEW_FRUSTUM_RIGHT_CULLING|n.VIEW_FRUSTUM_BOTTOM_CULLING|n.VIEW_FRUSTUM_TOP_CULLING,n.VIEW_FRUSTUM_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING|n.NEAR_PLANE_CULLING|n.FAR_PLANE_CULLING,n.DEFAULT_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING,n.ENABLE_ALL_CULLING=n.VIEW_FRUSTUM_CULLING;const a=n},uRnn:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var r=i("GoyH"),n=i("WWMP"),a=function(t,e,i,r){n.Z.call(this),this._func=a.LESS,this._near=0,this._far=1,this._writeMask=!0,void 0!==t&&(this._func="string"==typeof t?a[t]:t),void 0!==e&&(this._near=e),void 0!==i&&(this._far=i),void 0!==r&&(this._writeMask=r)};a.DISABLE=0,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,r.Z.createPrototypeStateAttribute(a,r.Z.objectInherit(n.Z.prototype,{attributeType:"Depth",cloneType:function(){return new a},setRange:function(t,e){this._near=t,this._far=e},setWriteMask:function(t){this._writeMask=t},getWriteMask:function(){return this._writeMask},getFunc:function(){return this._func},apply:function(t){t.applyDepth(this)}}),"osg","Depth");const s=a},"Q/WO":(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r=function(t,e,i){this._mode=t,this._first=e,this._arrayLengths=i.slice(0)};r.prototype={draw:function(t){for(var e=t.getGraphicContext(),i=this._mode,r=this._first,n=this._arrayLengths,a=0,s=n.length;a<s;a++){var o=n[a];e.drawArrays(i,r,o),r+=o}},getMode:function(){return this._mode},getNumIndices:function(){for(var t=0,e=this._arrayLengths,i=0,r=e.length;i<r;i++)t+=e[i];return t},getCount:function(){return this.getNumIndices()},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(t){this._first=t}};const n=r},Z4fc:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i("907W"),n=function(t,e,i){this.mode=t,void 0!==t&&("string"==typeof t&&(t=r.Z[t]),this.mode=t),this.first=e,this.count=i};n.prototype={draw:function(t){0!==this.count&&t.getGraphicContext().drawArrays(this.mode,this.first,this.count)},getMode:function(){return this.mode},setCount:function(t){this.count=t},getCount:function(){return this.count},setFirst:function(t){this.first=t},getFirst:function(){return this.first},getNumIndices:function(){return this.count},index:;const a=n},"1PKS":(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var r=i("907W"),n=i("BvLe"),a=function(t,e){this.mode=r.Z.POINTS,void 0!==t&&("string"==typeof t&&(t=r.Z[t]),this.mode=t),this.count=0,this.offset=0,this.indices=e,this.uType=a.UNSIGNED_SHORT,void 0!==e&&this.setIndices(e)};a.UNSIGNED_BYTE=5121,a.UNSIGNED_SHORT=5123,a.UNSIGNED_INT=5125,a.prototype={getMode:function(){return this.mode},draw:function(t){0!==this.count&&(t.setIndexArray(this.indices),this.drawElements(t))},drawElements:function(t){t.getGraphicContext().drawElements(this.mode,this.count,this.uType,this.offset)},setIndices:function(t){var e=t.getElements();n.Z.instance().isWebGL2()&&(1===e.BYTES_PER_ELEMENT?-1!==e.indexOf(255)&&(t.setElements(new Uint16Array(e)),e=t.getElements()):2===e.BYTES_PER_ELEMENT?-1!==e.indexOf(65535)&&(t.setElements(new Uint32Array(e)),e=t.getElements()):4===e.BYTES_PER_ELEMENT&&-1!==e.indexOf(4294967295)&&console.error("primitives restart in a 32bits index buffer, unhandled")),this.indices=t,this.count=e.length;var i=e.BYTES_PER_ELEMENT;1===i?this.uType=a.UNSIGNED_BYTE:2===i?this.uType=a.UNSIGNED_SHORT:4===i&&(this.uType=a.UNSIGNED_INT)},getIndices:function(){return this.indices},setFirst:function(t){this.offset=t},getFirst:function(){return this.offset},setCount:function(t){this.count=t},getCount:function(){return this.count},getNumIndices:index:;const s=a},"lU+d":(t,e,i)=>{"use strict";i.d(e,{Z:()=>c});var r=i("u5PS"),n=i("GoyH"),a=i("/CZr"),s=i("WWMP"),o=i("6qT5"),h=i("BvLe"),u=function(){a.Z.call(this),s.Z.call(this),this._fbo=void 0,this._rbo=void 0,this._attachments=[],this._buffers=[],this._dirty=!0,this._hasMRT=h.Z.instance().getWebGLExtension("WEBGL_draw_buffers")};u.COLOR_ATTACHMENT0=36064,u.DEPTH_ATTACHMENT=36096,u.DEPTH_COMPONENT16=33189,u.DEPTH_COMPONENT24=33190,u.DEPTH_COMPONENT32F=36012,u._sDeletedGLFrameBufferCache=new window.Map,u.deleteGLFrameBuffer=function(t,e){u._sDeletedGLFrameBufferCache.has(t)||u._sDeletedGLFrameBufferCache.set(t,[]),u._sDeletedGLFrameBufferCache.get(t).push(e)},u.flushDeletedGLFrameBuffers=function(t,e){if(e<=0)return e;if(!u._sDeletedGLFrameBufferCache.has(t))return e;var i=u._sDeletedGLFrameBufferCache.get(t);if(0===i.length)return e;for(var r=0,n=o.Z.instance().tick(),a=i.length-1;a>=0&&r<e;a--)t.deleteFramebuffer(i[a]),i.splice(a,1),r=o.Z.instance().deltaS(n,o.Z.instance().tick());return e-r},u.flushAllDeletedGLFrameBuffers=function(t){if(u._sDeletedGLFrameBufferCache.has(t)){var e=u._sDeletedGLFrameBufferCache.get(t);if(0!==e.length)for(var i=e.length-1;i>=0;i--)t.deleteFramebuffer(e[i]),e.splice(i,1)}},u._sDeletedGLRenderBufferCache=new window.Map,u.deleteGLRenderBuffer=function(t,e){u._sDeletedGLRenderBufferCache.has(t)||u._sDeletedGLRenderBufferCache.set(t,[]),u._sDeletedGLRenderBufferCache.get(t).push(e)},u.flushDeletedGLRenderBuffers=function(t,e){if(e<=0)return e;if(!u._sDeletedGLRenderBufferCache.has(t))return e;for(var i=0,r=o.Z.instance().tick(),n=u._sDeletedGLRenderBufferCache.get(t),a=n.length-1;a>=0&&i<e;a--)t.deleteRenderbuffer(n[a]),n.splice(a,1),i=o.Z.instance().deltaS(r,o.Z.instance().tick());return e-i},u.flushAllDeletedGLRenderBuffers=function(t){if(u._sDeletedGLRenderBufferCache.has(t))for(var e=u._sDeletedGLRenderBufferCache.get(t),i=e.length-1;i>=0;i--)t.deleteRenderbuffer(e[i]),e.splice(i,1)},u.onLostContext=function(t){if(u._sDeletedGLFrameBufferCache.has(t)){var e=u._sDeletedGLFrameBufferCache.get(t);e.length=0,u._sDeletedGLRenderBufferCache.has(t)&&((e=u._sDeletedGLRenderBufferCache.get(t)).length=0)}},n.Z.createPrototypeStateAttribute(u,n.Z.objectInherit(a.Z.prototype,n.Z.objectInherit(s.Z.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new u},invalidate:function(){if(this._rbo&&this._attachments){for(var t=0,e=this._attachments.length;t<e;++t){var i=this._attachments[t];i.texture||(i.renderBufferObject=void 0)}this._rbo=void 0}this._fbo=void 0,this._buffers.length=0,this._dirty=!0},dirty:isDirty:function(){return this._dirty},setAttachment:function(t){this._attachments.push(t)},getAttachment:function(t){if(this._attachments)for(var e=0,i=this._attachments.length;e<i;++e){var r=this._attachments[e];if(r.attachment===t)return r}},releaseGLObjects:function(){void 0!==this._fbo&&void 0!==this._gl&&u.deleteGLFrameBuffer(this._gl,this._fbo),this._fbo=void 0,void 0!==this._rbo&&void 0!==this._gl&&u.deleteGLRenderBuffer(this._gl,this._rbo),this.invalidate()},_reportFrameBufferError:function(t){switch(t){case 36054:r.Z.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:r.Z.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:r.Z.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:r.Z.debug("FRAMEBUFFER_UNSUPPORTED");break;default:r.Z.debug("FRAMEBUFFER unknown error "+t.toString(16))}},reset:getFrameBufferObject:function(){return this._fbo},getRenderBufferObject:function(){return this._rbo},createFrameBufferObject:function(t){this.setGraphicContext(t.getGraphicContext()),this._fbo=this._gl.createFramebuffer()},setFrameBufferObject:function(t,e){this.setGraphicContext(t.getGraphicContext()),this._fbo=e},createRenderBuffer:function(t,e,i){var r=this._gl,n=r.createRenderbuffer();return r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),n},framebufferRenderBuffer:function(t,e){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,t,i.RENDERBUFFER,e)},framebufferTexture2D:function(t,e,i,r){var n=this._gl;if(t.applyTextureAttribute(1,r),r.isDirty()||!r.getTextureObject())return!1;var a=n.DRAW_FRAMEBUFFER||n.FRAMEBUFFER;return n.framebufferTexture2D(a,e,i,r.getTextureObject().id(),0),!0},bindFrameBufferObject:checkStatus:function(){var t=this._gl,e=t.checkFramebufferStatus(t.FRAMEBUFFER);e!==t.FRAMEBUFFER_COMPLETE&&this._reportFrameBufferError(e)},_checkAllowedSize:function(t,e){var i=h.Z.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE");return!(0===t||0===e||e>i||t>i)||(r.Z.error("width ("+t+") or height ("+t+') makes frame buffer not bindable. Max RenderBuffer is "'+i+'"'),!1)},apply:function(t){this._gl||this.setGraphicContext(t.getGraphicContext());var e=this._gl,i=this._attachments,n=i.length;if(0!==n||this._fbo){var a=0;if(!this.isDirty()){for(a=0;a<n;++a){var s=i[a].texture;s&&s.isDirty()&&t.applyTextureAttribute(1,s)}return e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),void(!0===r.Z.reportWebGLError&&this.checkStatus())}this._fbo||this.createFrameBufferObject(t),this.bindFrameBufferObject();var o=this._hasMRT?this._buffers:void 0,h=!1;for(a=0;a<n;++a){var u=i[a];if(u.texture){var c=u.texture;if(!this._checkAllowedSize(c.getWidth(),c.getHeight()))return void this.releaseGLObjects();if(this._hasMRT&&u.attachment>=e.COLOR_ATTACHMENT0&&u.attachment<=e.COLOR_ATTACHMENT15&&-1===o.indexOf(u.attachment)&&o.push(u.attachment),!this.framebufferTexture2D(t,u.attachment,u.textureTarget,c))return void this.releaseGLObjects()}else{if(!this._checkAllowedSize(u.width,u.height))return void this.releaseGLObjects();u.renderBufferObject?this._rbo=u.renderBufferObject:(this._rbo=this.createRenderBuffer(u.format,u.width,u.height),u.renderBufferObject=this._rbo),this.framebufferRenderBuffer(u.attachment,this._rbo),h=!0}}o&&o.length>0&&e.drawBuffers(o),this.checkStatus(),h&&e.bindRenderbuffer(e.RENDERBUFFER,null),this._dirty=!1}else e.bindFramebuffer(e.FRAMEBUFFER,null)}})),"osg","FrameBufferObject");const c=u},"p6+I":(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r=r.prototype={setReferenceTime:function(t){this._startSimulation=t},getReferenceTime:function(){return this._startSimulation},setSimulationTime:function(t){this._currentSimulation=t},getSimulationTime:function(){return this._currentSimulation},setDeltaTime:function(t){this._deltaTime=t},getDeltaTime:function(){return this._deltaTime},setFrameNumber:function(t){this._frame=t},getFrameNumber:function(){return this._frame}};const n=r},"/CZr":(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});i("u5PS");var r=function(){this._gl=void 0,this._onLostContextCallback=void 0};r.prototype={setGraphicContext:function(t){this._gl=t,r.addObject(this._gl,this)},getGraphicContext:function(){return this._gl},setLostContextCallback:function(t){this._onLostContextCallback=t},onLostContext:function(){this.invalidate&&"function"==typeof this.invalidate&&this.invalidate(),this._onLostContextCallback&&this._onLostContextCallback()}},r._sResourcesArrayCache=new window.Map,r.addObject=function(t,e){r._sResourcesArrayCache.has(t)||r._sResourcesArrayCache.set(t,[]);var i=r._sResourcesArrayCache.get(t);-1===i.indexOf(e)&&i.push(e)},r.removeObject=function(t,e){if(r._sResourcesArrayCache.has(t)){var i=r._sResourcesArrayCache.get(t),n=i.indexOf(e);-1!==n&&i.splice(n,1)}},r.onLostContext=function(t){if(r._sResourcesArrayCache.has(t))for(var e=r._sResourcesArrayCache.get(t),i=0,n=e.length;i<n;i++)e[i].onLostContext()};const n=r},uHj6:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});i("u5PS");var r=i("GoyH"),n=i("iUVs"),a=window.ImageBitmap||function(){},s=function(t){n.Z.call(this),this._imageObject=void 0,this._url=void 0,this._width=void 0,this._height=void 0,this._dirty=!0,this._mipmap=[],t&&this.setImage(t),this._isGreyscale=void 0};r.Z.createPrototypeObject(s,r.Z.objectInherit(n.Z.prototype,{dirty:isDirty:function(){return this._dirty},setDirty:function(t){this._dirty=t},getImage:getURL:function(){return this._url},setURL:function(t){this._url=t},useOrCreateImage:function(t){return t instanceof s==!1?new s(t):t},setImage:function(t){if(!this._url&&t&&(t.src||t.currentSrc)&&(this._url=t.src||t.currentSrc),this._mipmap.length=0,Array.isArray(t)){for(var e=0,i=t.length;e<i;e++)this._mipmap.push(this.useOrCreateImage(t[e]));this.setWidth(this._mipmap[0].getWidth()),this.setHeight(this._mipmap[0].getHeight())}else this._mipmap.push(t);this._imageObject=this._mipmap[0],this.dirty()},isCanvas:function(){return this.getImage()instanceof window.HTMLCanvasElement},isBitmap:isVideo:function(){return this.getImage()instanceof window.HTMLVideoElement},isImage:function(){return this.getImage()instanceof window.Image},isTypedArray:function(){var t=this.getImage();return t instanceof Uint8Array||t instanceof Float32Array||t instanceof Uint16Array},setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},getWidth:function(){var t=this.getImage();return this.isImage()?t.naturalWidth:this.isVideo()?t.videoWidth:this.isCanvas()||this.isBitmap()?t.width:this._width},getHeight:function(){var t=this.getImage();return this.isImage()?t.naturalHeight:this.isVideo()?t.videoHeight:this.isCanvas()||this.isBitmap()?t.height:this._height},isGreyscale:function(t){if(void 0!==this._isGreyscale)return this._isGreyscale;if(void 0!==this._imageObject&&this.isReady()&&void 0===this._isGreyscale){var e=this._imageObject;this.isCanvas()||(e=document.createElement("canvas"));var i,r,n=e.getContext("2d");e.width=this._imageObject.width,e.height=this._imageObject.height,n.drawImage(this._imageObject,0,0),t||(i=e.width,r=e.height),t>0&&(i=r=t=Math.min(Math.min(e.width,e.height),t));for(var a=!0,s=e.width/i,o=e.height/r,h=0;h<i;h++)for(var u=0;u<r;u++){var c=Math.floor(s*(h+.5)),l=Math.floor(o*(u+.5)),_=n.getImageData(c,l,1,1).data;if(_[0]!==_[1]||_[0]!==_[2]){a=!1;break}}this._isGreyscale=a}return this._isGreyscale},isReady:function(){if(this._imageObject&&this._imageObject instanceof s)return this._imageObject.isReady();if(this.isCanvas()||this.isTypedArray()||this.isBitmap())return!0;if(this.isImage()){var t=this.getImage();if(t.complete)return void 0===t.naturalWidth||0!==t.naturalWidth}if(this.isVideo()&&0!==this.getWidth())return!0;var e=this.getImage();return!!e.complete&&(void 0===e.naturalWidth||0!==e.naturalWidth)},getMipmap:function(){return this._mipmap},hasMipmap:release:function(){this._mipmap.length=0,this._imageObject=void 0}}),"osg","Image");const o=s},"2Vrk":(t,e,i)=>{"use strict";i.d(e,{Z:()=>h});var r=i("GoyH"),n=i("WWMP"),a=i("64xh"),s=i("W40i"),o=function(t,e){n.Z.call(this);var i=void 0!==t?t:0;this._ambient=s.vh.fromValues(.2,.2,.2,1),this._diffuse=s.vh.fromValues(.8,.8,.8,1),this._specular=s.vh.fromValues(.2,.2,.2,1),this._position=s.vh.fromValues(0,0,1,0),this._direction=s.R3.fromValues(0,0,-1),this._ground=s.vh.fromValues(.2,.2,.2,-1),this._spotCutoff=180,this._spotBlend=.01,this._attenuation=s.vh.fromValues(1,0,0,0),this._lightNumber=i,this._enable=!e,this._dirtyHash=!0,this._hash=""};o.DIRECTION="DIRECTION",o.SPOT="SPOT",o.POINT="POINT",o.HEMI="HEMI",o.uniforms={},r.Z.createPrototypeStateAttribute(o,r.Z.objectInherit(n.Z.prototype,{attributeType:"Light",cloneType:function(){return new o(this._lightNumber,!0)},getTypeMember:getUniformName:function(t){return"u"+this.getTypeMember()+"_"+t},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this.getLightType()+this.isEnabled().toString()},getOrCreateUniforms:function(){var t=o,e=this.getTypeMember();return t.uniforms[e]||(t.uniforms[e]={viewPosition:a.Z.createFloat4(this.getUniformName("viewPosition")),viewDirection:a.Z.createFloat3(this.getUniformName("viewDirection")),modelViewMatrix:a.Z.createMatrix4(this.getUniformName("modelViewMatrix")),modelViewNormalMatrix:a.Z.createMatrix3(this.getUniformName("modelViewNormalMatrix")),ambient:a.Z.createFloat4(this.getUniformName("ambient")),diffuse:a.Z.createFloat4(this.getUniformName("diffuse")),specular:a.Z.createFloat4(this.getUniformName("specular")),attenuation:a.Z.createFloat4(this.getUniformName("attenuation")),spotCutOff:a.Z.createFloat1(this.getUniformName("spotCutOff")),spotBlend:a.Z.createFloat1(this.getUniformName("spotBlend")),ground:a.Z.createFloat4(this.getUniformName("ground"))}),t.uniforms[e]},isEnabled:function(){return this._enable},setEnabled:function(t){this._enable=t,this._dirtyHash=!0},setAmbient:function(t){s.vh.copy(this._ambient,t)},getAmbient:function(){return this._ambient},setDiffuse:function(t){s.vh.copy(this._diffuse,t)},getDiffuse:function(){return this._diffuse},setSpecular:function(t){s.vh.copy(this._specular,t)},getSpecular:function(){return this._specular},setPosition:function(t){s.vh.copy(this._position,t)},getPosition:function(){return this._position},setDirection:function(t){s.R3.copy(this._direction,t)},getDirection:function(){return this._direction},setSpotCutoff:function(t){this._spotCutoff=t},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(t){this._spotBlend=t},getSpotBlend:function(){return this._spotBlend},setGround:function(t){s.R3.copy(this._ground,t)},getGround:function(){return this._ground},setConstantAttenuation:function(t){this._attenuation[0]=t},getConstantAttenuation:function(){return this._attenuation[0]},setLinearAttenuation:function(t){this._attenuation[1]=t},getLinearAttenuation:function(){return this._attenuation[1]},setQuadraticAttenuation:getQuadraticAttenuation:function(){return this._attenuation[2]},setLightType:function(t){return t===o.DIRECTION?this.setLightAsDirection():t===o.SPOT?this.setLightAsSpot():t===o.HEMI?this.setLightAsHemi():this.setLightAsPoint()},getLightType:function(){return this.isDirectionLight()?o.DIRECTION:this.isSpotLight()?o.SPOT:this.isHemiLight()?o.HEMI:o.POINT},setLightAsSpot:function(){s.vh.set(this._position,0,0,0,1),s.R3.set(this._direction,0,0,-1),this._ground[3]=-1,this._spotCutoff=90,this._dirtyHash=!0},setLightAsPoint:function(){s.vh.set(this._position,0,0,0,1),s.R3.set(this._direction,0,0,-1),this._ground[3]=-1,this._dirtyHash=!0},setLightAsDirection:function(){s.vh.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=-1,this._dirtyHash=!0},setLightAsHemi:function(){s.vh.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=1,this._dirtyHash=!0},setLightNumber:function(t){this._lightNumber=t,this._dirtyHash=!0},getLightNumber:function(){return this._lightNumber},isSpotLight:isDirectionLight:function(){return 0===this._position[3]&&-1===this._ground[3]},isHemiLight:applyPositionedUniform:function(t){var e=this.getOrCreateUniforms(),i=e.modelViewMatrix.getInternalArray(),r=e.modelViewNormalMatrix.getInternalArray(),n=e.viewPosition.getInternalArray(),a=e.viewDirection.getInternalArray();s._E.copy(i,t),s.wO.normalFromMat4(r,t),s.vh.transformMat4(n,this._position,i),s.R3.transformMat3(a,this._direction,r)},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();if(this.isSpotLight()){var e=Math.cos(this._spotCutoff*Math.PI/180);t.spotCutOff.setFloat(e),t.spotBlend.setFloat((1-e)*this._spotBlend)}this.isHemiLight()&&t.ground.setFloat4(this._ground),t.attenuation.setFloat4(this._attenuation),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.ambient.setFloat4(this._ambient)}}}),"osg","Light");const h=o},Ln1o:(t,e,i)=>{"use strict";i.d(e,{Z:()=>u});var r,n=i("GoyH"),a=i("IpZ9"),s=i("pSxj"),o=i("W40i"),h=function(){a.Z.call(this),this.setCullingActive(!1),this._light=void 0,this._referenceFrame=s.Z.RELATIVE_RF};n.Z.createPrototypeNode(h,n.Z.objectInherit(a.Z.prototype,{getLight:function(){return this._light},setLight:function(t){this._light=t},setReferenceFrame:function(t){this._referenceFrame=t},getReferenceFrame:function(){return this._referenceFrame},computeBoundingSphere:(r=o.R3.create(),function(t){if(a.Z.prototype.computeBoundingSphere.call(this,t),void 0!==this._light&&this._referenceFrame===s.Z.RELATIVE_RF){var e=this._light.getPosition();0!==e[3]&&t.expandByVec3(o.R3.scale(r,e,1/e[3]))}return t})}),"osg","LightSource");const u=h},oHbX:(t,e,i)=>{"use strict";i.d(e,{Z:()=>d});var r,n,a,s,o=i("GoyH"),h=i("IpZ9"),u=i("CJNH"),c=i("W40i"),l=i("bxht"),_=function(){h.Z.call(this),this._radius=-1,this._range=[],this._rangeMode=_.DISTANCE_FROM_EYE_POINT,this._userDefinedCenter=[],this._centerMode=_.USE_BOUNDING_SPHERE_CENTER};_.DISTANCE_FROM_EYE_POINT=0,_.PIXEL_SIZE_ON_SCREEN=1,_.USE_BOUNDING_SPHERE_CENTER=0,_.USER_DEFINED_CENTER=1,_.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED=2,o.Z.createPrototypeNode(_,o.Z.objectInherit(h.Z.prototype,{getRadius:function(){return this._radius},setRadius:function(t){this._radius=t},setCenter:function(t){this._centerMode!==_.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&(this._centerMode=_.USER_DEFINED_CENTER),this._userDefinedCenter=t},getCenter:function(){return this._centerMode===_.USER_DEFINED_CENTER||this._centerMode===_.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED?this._userDefinedCenter:this.getBound().center()},setCenterMode:function(t){this._centerMode=t},computeBoundingSphere:function(t){if(this._centerMode===_.USER_DEFINED_CENTER&&this._radius>=0)return t.set(this._userDefinedCenter,this._radius),t;if(this._centerMode===_.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&this._radius>=0){t.set(this._userDefinedCenter,this._radius);var e=new l.Z;return t.expandByBoundingSphere(h.Z.prototype.computeBoundingSphere.call(this,e)),t}return h.Z.prototype.computeBoundingSphere.call(this,t),t},projectBoundingSphere:(s=c.R3.create(),function(t,e,i){c.R3.transformMat4(s,t.center(),e);var r=t.radius2(),n=s[2]*s[2],a=c.R3.sqrLen(s);return-Math.PI*i*i*r*Math.sqrt(Math.abs((a-r)/(r-n)))/(r-n)}),setRangeMode:function(t){this._rangeMode=t},addChildNode:function(t){if(h.Z.prototype.addChild.call(this,t),this.children.length>this._range.length){var e=[],i=0;this._range.lenght>0&&(i=this._range[this._range.length-1][1]),e.push(c.K4.fromValues(i,i)),this._range.push(e)}return!0},addChild:function(t,e,i){if(h.Z.prototype.addChild.call(this,t),this.children.length>this._range.length){var r=[];r.push(c.K4.fromValues(e,e)),this._range.push(r)}return this._range[this.children.length-1][0]=e,this._range[this.children.length-1][1]=i,!0},traverse:(r=c.R3.create(),n=c.R3.create(),a=c._E.create(),function(t){switch(t.traversalMode){case u.Z.TRAVERSE_ALL_CHILDREN:for(var e=0;e<this.children.length;e++)this.children[e].accept(t);break;case u.Z.TRAVERSE_ACTIVE_CHILDREN:var i=0,s=t.getCurrentModelViewMatrix();if(c._E.invert(a,s),this._rangeMode===_.DISTANCE_FROM_EYE_POINT)c.R3.transformMat4(n,r,a),i=c.R3.distance(this.getBound().center(),n)*t.getLODScale();else{var o=t.getCurrentProjectionMatrix();i=(i=this.projectBoundingSphere(this.getBound(),s,o[0]))*t.getViewport().width()*t.getViewport().width()*.25/t.getLODScale()}var h=this.children.length;this._range.length<h&&(h=this._range.length);for(var l=0;l<h;++l)this._range[l][0]<=i&&i<this._range[l][1]&&this.children[l].accept(t)}})}),"osg","Lod");const d=_},P3GF:(t,e,i)=>{"use strict";i.d(e,{Z:()=>h});var r=i("GoyH"),n=i("WWMP"),a=i("W40i"),s=i("64xh"),o=function(){n.Z.call(this),this._ambient=a.vh.fromValues(.2,.2,.2,1),this._diffuse=a.vh.fromValues(.8,.8,.8,1),this._specular=a.vh.fromValues(0,0,0,1),this._emission=a.vh.fromValues(0,0,0,1),this._shininess=12.5};r.Z.createPrototypeStateAttribute(o,r.Z.objectInherit(n.Z.prototype,{attributeType:"Material",cloneType:function(){return new o},getParameterName:getOrCreateUniforms:function(){var t=o;return t.uniforms||(t.uniforms={ambient:s.Z.createFloat4("uMaterialAmbient"),diffuse:s.Z.createFloat4("uMaterialDiffuse"),specular:s.Z.createFloat4("uMaterialSpecular"),emission:s.Z.createFloat4("uMaterialEmission"),shininess:s.Z.createFloat1("uMaterialShininess")}),t.uniforms},setEmission:function(t){a.vh.copy(this._emission,t)},getEmission:function(){return this._emission},setAmbient:function(t){a.vh.copy(this._ambient,t)},getAmbient:function(){return this._ambient},setSpecular:function(t){a.vh.copy(this._specular,t)},getSpecular:function(){return this._specular},setDiffuse:function(t){a.vh.copy(this._diffuse,t)},getDiffuse:function(){return this._diffuse},setShininess:function(t){this._shininess=t},getShininess:function(){return this._shininess},setTransparency:function(t){this._diffuse[3]=1-t},getTransparency:function(){return this._diffuse[3]},apply:function(){var t=this.getOrCreateUniforms();t.ambient.setFloat4(this._ambient),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.emission.setFloat4(this._emission),t.shininess.setFloat(this._shininess)}}),"osg","Material");const h=o},rfV8:(t,e,i)=>{"use strict";i.d(e,{Z:()=>u});var r,n=i("GoyH"),a=i("W40i"),s=i("6RPJ"),o=i("pSxj"),h=function(){s.Z.call(this),this.matrix=a._E.create()};n.Z.createPrototypeNode(h,n.Z.objectInherit(s.Z.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(t){this.matrix=t,this.dirtyBound()},computeLocalToWorldMatrix:function(t){return this.referenceFrame===o.Z.RELATIVE_RF?a._E.mul(t,t,this.matrix):a._E.copy(t,this.matrix),!0},computeWorldToLocalMatrix:(r=a._E.create(),function(t){return a._E.invert(r,this.matrix),this.referenceFrame===o.Z.RELATIVE_RF?a._E.mul(t,r,t):a._E.copy(t,r),!0})}),"osg","MatrixTransform");const u=h},IpZ9:(t,e,i)=>{"use strict";i.d(e,{Z:()=>m});var r=i("GoyH"),n=i("iUVs"),a=i("k3oU"),s=i("bxht"),o=i("o4nZ"),h=i("CJNH"),u=i("W40i"),c=i("cyFB"),l=i("haRL"),_=i("pSxj"),d=function(){n.Z.call(this),this.children=[],this._parents=[],this.nodeMask=-1,this._boundingSphere=new s.Z,this._boundingSphereComputed=!1,this._boundingBox=new a.Z,this._boundingBoxComputed=!1,this._updateCallbacks=[],this._cullCallback=void 0,this._cullingActive=!0,this._numChildrenWithCullingDisabled=0,this._numChildrenRequiringUpdateTraversal=0,this._tmpBox=new a.Z},f=new c.Z(u._E.create),p=function(){var t=f.getOrCreateObject();return u._E.identity(t)},g=new s.Z;r.Z.createPrototypeNode(d,r.Z.objectInherit(n.Z.prototype,{getMinimumBound:function(){var t=this.getBoundingBox(),e=this.getBoundingSphere();return!t.valid()||e.volume()<t.volume()?e:(g.copyBoundingBox(t),g)},getOrCreateStateSet:function(){return this.stateset||this.setStateSet(new o.Z),this.stateset},getStateSet:function(){return this.stateset},accept:function(t){t.validNodeMask(this)&&(t.pushOntoNodePath(this),t.apply(this),t.popFromNodePath())},dirtyBound:function(){if(!0===this._boundingSphereComputed||!0===this._boundingBoxComputed){this._boundingSphereComputed=!1,this._boundingBoxComputed=!1;for(var t=this._parents,e=0,i=t.length;e<i;e++)t[e].dirtyBound()}},setNodeMask:function(t){this.nodeMask=t},getNodeMask:function(){return this.nodeMask},setStateSet:function(t){if(this.stateset!==t){var e=0;this.stateset&&(this.stateset.requiresUpdateTraversal()&&e--,this.stateset.removeParent(this)),t&&(t.addParent(this),t.requiresUpdateTraversal()&&++e),0!==e&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+e),this.stateset=t}},_updateNumChildrenRequeringUpdateTraversal:function(t){if(0===this._numChildrenRequiringUpdateTraversal&&this._parents.length)for(var e=0,i=this._parents.length;e<i;e++){var r=this._parents[e],n=r.getNumChildrenRequiringUpdateTraversal();r.setNumChildrenRequiringUpdateTraversal(n+t)}},setNumChildrenRequiringUpdateTraversal:function(t){if(this._numChildrenRequiringUpdateTraversal!==t){if(!this._updateCallbacks.length&&this._parents.length){var e=0;if(this._numChildrenRequiringUpdateTraversal>0&&--e,t>0&&++e,0!==e)for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r],s=a.getNumChildrenRequiringUpdateTraversal();a.setNumChildrenRequiringUpdateTraversal(s+e)}}this._numChildrenRequiringUpdateTraversal=t}},getNumChildrenRequiringUpdateTraversal:function(){return this._numChildrenRequiringUpdateTraversal},getUpdateCallback:addUpdateCallback:function(t){var e=Boolean(this._updateCallbacks.length);this._updateCallbacks.push(t),e||this._updateNumChildrenRequeringUpdateTraversal(1)},removeUpdateCallback:function(t){var e=this._updateCallbacks.indexOf(t);-1!==e&&(this._updateCallbacks.splice(e,1),this._updateCallbacks.length||this._updateNumChildrenRequeringUpdateTraversal(-1))},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(t){this._cullCallback=t},getCullCallback:function(){return this._cullCallback},hasChild:addChild:function(t){if(-1===this.children.indexOf(t))return this.children.push(t),t.addParent(this),this.dirtyBound(),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+1),(t.getNumChildrenWithCullingDisabled()>0||!1===t.getCullingActive())&&this.setNumChildrenWithCullingDisabled(this.getNumChildrenWithCullingDisabled()+1),t},getChildren:function(){return this.children},getNumChildren:function(){return this.children.length},getChild:function(t){return this.children[t]},getParents:function(){return this._parents},addParent:function(t){this._parents.push(t)},removeParent:removeChildren:function(){var t=this.children,e=t.length;if(e){for(var i=0,r=0;r<e;r++){var n=t[r];n.removeParent(this),(n.getNumChildrenRequiringUpdateTraversal()>0||n.getUpdateCallbackList().length)&&++i}t.length=0,i&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-i),this.dirtyBound()}},removeChild:function(t){var e=this.children,i=e.indexOf(t);-1!==i&&(t.removeParent(this),e.splice(i,1),this.dirtyBound(),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-1))},traverse:function(t){for(var e=this.children,i=0,r=e.length;i<r;i++){e[i].accept(t)}},ascend:function(t){for(var e=this._parents,i=0,r=e.length;i<r;i++){e[i].accept(t)}},getBoundingBox:function(){return this._boundingBoxComputed||(this.computeBoundingBox(this._boundingBox),this._boundingBoxComputed=!0),this._boundingBox},computeBoundingBox:function(t){var e=i("t+pa").Z,r=e.instance=e.instance||new e;return r.setNodeMaskOverride(-1),r.reset(),r.apply(this),t.copy(r.getBoundingBox()),t},getBoundingSphere:getBound:function(){return this._boundingSphereComputed||(this.computeBoundingSphere(this._boundingSphere),this._boundingSphereComputed=!0),this._boundingSphere},computeBoundingSphere:function(t){var e,i,r=this.children,n=r.length;if(t.init(),0===n)return t;var a=this._tmpBox;for(a.init(),i=0;i<n;i++)(e=r[i]).referenceFrame!==_.Z.ABSOLUTE_RF&&a.expandByBoundingSphere(e.getBound());if(!a.valid())return t;for(t.set(a.center(t.center()),0),i=0;i<n;i++)(e=r[i]).referenceFrame!==_.Z.ABSOLUTE_RF&&t.expandRadiusBySphere(e.getBound());return t},getWorldMatrices:function(){var t=function(){this.nodePaths=[],this.halt=void 0,h.Z.call(this,h.Z.TRAVERSE_PARENTS)};t.prototype=r.Z.objectInherit(h.Z.prototype,{reset:apply:function(t){0===t._parents.length||t===this.halt||t.referenceFrame===_.Z.ABSOLUTE_RF?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(t)}});var e=new t;return e.setNodeMaskOverride(-1),function(t,i){e.reset(),e.halt=t,this.accept(e);for(var r=[],n=i||u._E.create,a=0,s=e.nodePaths.length;a<s;a++){var o=e.nodePaths[a],h=n();0!==o.length&&l.Z.computeLocalToWorld(o,!0,h),r.push(h)}return r}}(),getWorldMatrix:function(t,e){var i=this.getWorldMatrices(t,p);return 0===i.length?u._E.identity(e):u._E.copy(e,i[0]),f.reset(),e},setCullingActive:function(t){if(this._cullingActive!==t){if(0===this._numChildrenWithCullingDisabled&&this._parents.length>0){var e=0;if(this._cullingActive||--e,t||++e,0!==e)for(var i=0,r=this._parents.length;i<r;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+e)}this._cullingActive=t}},getCullingActive:function(){return this._cullingActive},isCullingActive:function(){return 0===this._numChildrenWithCullingDisabled&&this._cullingActive&&this.getBound().valid()},setNumChildrenWithCullingDisabled:function(t){if(this._numChildrenWithCullingDisabled!==t){if(this._cullingActive&&this._parents.length>0){var e=0;if(this._numChildrenWithCullingDisabled>0&&--e,t>0&&++e,0!==e)for(var i=0,r=this._parents.length;i<r;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+e)}this._numChildrenWithCullingDisabled=t}},getNumChildrenWithCullingDisabled:function(){return this._numChildrenWithCullingDisabled},releaseGLObjects:),"osg","Node");const m=d},CJNH:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=function(t){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=t,void 0===t&&(this.traversalMode=r.TRAVERSE_ALL_CHILDREN),this.nodePath=[],this.visitorType=r.NODE_VISITOR,this._databaseRequestHandler=void 0,this._frameStamp=void 0,this.traverse=r._traversalFunctions[this.traversalMode],this.pushOntoNodePath=r._pushOntoNodePath[this.traversalMode],this.popFromNodePath=r._popFromNodePath[this.traversalMode]};r.TRAVERSE_PARENTS=1,r.TRAVERSE_ALL_CHILDREN=2,r.TRAVERSE_ACTIVE_CHILDREN=3,r.NODE_VISITOR=0,r.UPDATE_VISITOR=1,r.CULL_VISITOR=2;var n=function(t){t.traverse(this)};r._traversalFunctions=[void 0,function(t){t.ascend(this)},n,n];var a=function(t){this.nodePath.push(t)};r._pushOntoNodePath=[void 0,function(t){this.nodePath.unshift(t)},a,a];var s=function(){this.nodePath.pop()};r._popFromNodePath=[void 0,function(){return this.nodePath.shift()},s,s],r.prototype={reset:setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setNodeMaskOverride:function(t){this.nodeMaskOverride=t},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(t){this.traversalMask=t},getTraversalMask:function(){return this.traversalMask},getNodePath:function(){return this.nodePath},validNodeMask:function(t){var e=t.getNodeMask();return 0!=(this.traversalMask&(this.nodeMaskOverride|e))},apply:function(t){this.traverse(t)},getVisitorType:function(){return this.visitorType},setDatabaseRequestHandler:function(t){this._databaseRequestHandler=t},getDatabaseRequestHandler:function(){return this._databaseRequestHandler}};const o=r},iUVs:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var r=i("GoyH"),n=function(){this._name=void 0,this._userdata=void 0,this._instanceID=n.getInstanceID()};r.Z.createPrototypeObject(n,{cloneType:function(){return new(0,this.constructor)},getInstanceID:function(){return this._instanceID},setName:function(t){this._name=t},getName:function(){return this._name},setUserData:function(t){this._userdata=t},getUserData:function(){return this._userdata}},"osg","Object");var a=0;n.getInstanceID=const s=n},"bYH/":(t,e,i)=>{"use strict";i.d(e,{Z:()=>h});var r,n=i("u5PS"),a=i("GoyH"),s=i("MQQR"),o=function(){var t={antialias:!0,fullscreen:!0,enableFrustumCulling:!1,scrollwheel:!0,webgl2:(0,s.Z)().webgl2,powerPreference:"high-performance",shaderStats:!1,stats:!1};for(var e in t)this[e]=t[e]};o.getOptionsURL=function(){if(r)return r;if(r={},!window.location.search)return r;for(var t,e=[],i=window.location.search.slice(1).split("&"),a=0;a<i.length;a++){var s=(t=i[a].split("="))[0];e.push(s);var o=t[1];"0"!==o&&"false"!==o&&(void 0===o&&(o="1"),r[s]=o)}if(void 0!==r.log)switch(r.log.toLowerCase()){case"debug":n.Z.setNotifyLevel(n.Z.DEBUG);break;case"info":n.Z.setNotifyLevel(n.Z.INFO);break;case"notice":n.Z.setNotifyLevel(n.Z.NOTICE);break;case"warn":n.Z.setNotifyLevel(n.Z.WARN);break;case"error":n.Z.setNotifyLevel(n.Z.ERROR);break;case"html":var h=[],u=document.createElement("div"),c=document.createElement("pre");document.addEventListener("DOMContentLoaded",(function(){document.body.insertBefore(u,document.body.firstChild),u.appendChild(c)}));var l=function(t){h.unshift(t),c.innerHTML=h.join("\n")};u.style.overflow="hidden",u.style.position="absolute",u.style.zIndex="10000",u.style.height="100%",u.style.maxWidth="600px",u.style.pointerEvents="none",c.style.overflow="scroll",c.style.width="105%",c.style.height="100%",c.style.fontSize="10px",c.style.pointerEvents="none",["log","error","warn","info","debug"].forEach(()}return r},o.prototype={extend:get:getBoolean:function(t){var e=this.getString(t);if(e)return"false"!==e&&"0"!==e},getNumber:function(t){var e=this[t];if(e)return Number(e)},getString:function(t){if(void 0!==this[t])return this[t].toString()},extendWithOptionsURL:;const h=o},"+jyg":(t,e,i)=>{"use strict";i.d(e,{Z:()=>_});var r,n,a,s=i("GoyH"),o=i("oHbX"),h=i("CJNH"),u=i("W40i"),c=function(){o.Z.call(this),this._perRangeDataList=[],this._loading=!1,this._expiryTime=0,this._expiryFrame=0,this._centerMode=o.Z.USER_DEFINED_CENTER,this._frameNumberOfLastTraversal=0,this._databasePath="",this._numChildrenThatCannotBeExpired=0},l=function(){this.filename="",this.function=void 0,this.loaded=!1,this.timeStamp=0,this.frameNumber=0,this.frameNumberOfLastTraversal=0,this.dbrequest=void 0};s.Z.createPrototypeNode(c,s.Z.objectInherit(o.Z.prototype,{setRange:function(t,e,i){if(t>=this._range.length){var r=[];r.push([e,e]),this._range.push(r)}this._range[t][0]=e,this._range[t][1]=i},setExpiryTime:function(t){this._expiryTime=t},setDatabasePath:function(t){this._databasePath=t},getDatabasePath:function(){return this._databasePath},setFileName:function(t,e){if(t>=this._perRangeDataList.length){var i=new l;i.filename=e,this._perRangeDataList.push(i)}else this._perRangeDataList[t].filename=e},setFunction:function(t,e){if(t>=this._perRangeDataList.length){var i=new l;i.function=e,this._perRangeDataList.push(i)}else this._perRangeDataList[t].function=e},addChild:function(t,e,i){o.Z.prototype.addChild.call(this,t,e,i),this._perRangeDataList.push(new l)},addChildNode:function(t){o.Z.prototype.addChildNode.call(this,t)},setFrameNumberOfLastTraversal:function(t){this._frameNumberOfLastTraversal=t},getFrameNumberOfLastTraversal:function(){return this._frameNumberOfLastTraversal},setTimeStamp:function(t,e){this._perRangeDataList[t].timeStamp=e},setFrameNumber:setNumChildrenThatCannotBeExpired:function(t){this._numChildrenThatCannotBeExpired=t},getNumChildrenThatCannotBeExpired:function(){return this._numChildrenThatCannotBeExpired},getDatabaseRequest:removeExpiredChildren:function(t,e,i){if(!(this.children.length<=this._numChildrenThatCannotBeExpired)){var r,n,a=this.children.length-1;r=this._perRangeDataList[a].timeStamp+this._expiryTime,n=this._perRangeDataList[a].frameNumber+this._expiryFrame,r<t&&n<e&&(this._perRangeDataList[a].filename.length>0||void 0!==this._perRangeDataList[a].function)&&(i.push(this.children[a]),this.removeChild(this.children[a]),this._perRangeDataList[a].loaded=!1,void 0!==this._perRangeDataList[a].dbrequest&&(this._perRangeDataList[a].dbrequest._groupExpired=!0))}},traverse:(r=u.R3.create(),n=u.R3.create(),a=u._E.create(),function(t){var e=t.traversalMode,i=!1;switch(t.getVisitorType()===h.Z.CULL_VISITOR&&(this._frameNumberOfLastTraversal=t.getFrameStamp().getFrameNumber(),i=!0),e){case h.Z.TRAVERSE_ALL_CHILDREN:for(var s=0;s<this.children.length;s++)this.children[s].accept(t);break;case h.Z.TRAVERSE_ACTIVE_CHILDREN:var c=0,l=t.getCurrentModelViewMatrix();if(u._E.invert(a,l),this._rangeMode===o.Z.DISTANCE_FROM_EYE_POINT)u.R3.transformMat4(n,r,a),c=u.R3.distance(this.getBound().center(),n)*t.getLODScale();else{var _=t.getCurrentProjectionMatrix();(c=(c=this.projectBoundingSphere(this.getBound(),l,_[0]))*t.getViewport().width()*t.getViewport().width()*.25/t.getLODScale())<0&&(c=this._range[this._range.length-1][0])}for(var d=!1,f=-1,p=0;p<this._range.length;++p)this._range[p][0]<=c&&c<this._range[p][1]&&(p<this.children.length?(i&&(this._perRangeDataList[p].timeStamp=t.getFrameStamp().getSimulationTime(),this._perRangeDataList[p].frameNumber=t.getFrameStamp().getFrameNumber()),this.children[p].accept(t),f=p):d=!0);if(d){var g=this.children.length;if(g>0&&g-1!==f&&(i&&(this._perRangeDataList[g-1].timeStamp=t.getFrameStamp().getSimulationTime(),this._perRangeDataList[g-1].frameNumber=t.getFrameStamp().getFrameNumber()),this.children[g-1].accept(t)),g<this._perRangeDataList.length){var m=(this._range[g][0]-c)/(this._range[g][1]-this._range[g][0]);this._rangeMode===o.Z.PIXEL_SIZE_ON_SCREEN&&(m=-m);var v=t.nodePath[t.nodePath.length-1];if(!1===this._perRangeDataList[g].loaded){this._perRangeDataList[g].loaded=!0;var b=t.getDatabaseRequestHandler();this._perRangeDataList[g].dbrequest=b.requestNodeFile(this._perRangeDataList[g].function,this._databasePath+this._perRangeDataList[g].filename,v,t.getFrameStamp().getSimulationTime(),m)}else void 0!==this._perRangeDataList[g].dbrequest?(this._perRangeDataList[g].dbrequest._timeStamp=t.getFrameStamp().getSimulationTime(),this._perRangeDataList[g].dbrequest._priority=m):this._perRangeDataList[g].loaded=!1}}}})}),"osg","PagedLOD");const _=c},itLJ:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r,n=i("GoyH"),a=i("W40i"),s=n.Z.objectInherit(a.vh,{INSIDE:1,INTERSECT:2,OUTSIDE:3,transformProvidingInverse:function(){var t=s.create();return function(e,i){var r=e[0],n=e[1],a=e[2],o=e[3];return t[0]=i[0]*r+i[1]*n+i[2]*a+i[3]*o,t[1]=i[4]*r+i[5]*n+i[6]*a+i[7]*o,t[2]=i[8]*r+i[9]*n+i[10]*a+i[11]*o,t[3]=i[12]*r+i[13]*n+i[14]*a+i[15]*o,s.normalizeEquation(t),s.copy(t,e),e}},normalizeEquation:function(t){var e=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e},getNormal:setNormal:getDistance:setDistance:distanceToPlane:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]},intersectsOrContainsBoundingSphere:function(t,e){if(!e.valid())return s.OUTSIDE;var i=e.center(),r=e.radius(),n=this.distanceToPlane(t,i);return n<-r?s.OUTSIDE:n<=r?s.INTERSECT:s.INSIDE},instersectsBoundingSphere:function(t,e){return this.intersectsOrContainsBoundingSphere(t,e)===s.INTERSECT},intersectsOrContainsBoundingBox:(r=a.R3.create(),function(t,e){var i=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),n=7&~i;return this.distanceToPlane(t,e.corner(n,r))>0?s.INSIDE:this.distanceToPlane(t,e.corner(i,r))<0?s.OUTSIDE:s.INTERSECT}),intersectsBoundingBox:function(t,e,i){return this.intersectsOrContainsBoundingBox(t,e,i)===s.INTERSECT},intersectOrContainsVertices:function(t,e){for(var i=-1,r=0;r<e.length;r++){var n=this.distanceToPlane(t,e[r]);if(n<0){if(1===i)return s.INTERSECT;i=2}else{if(!(n>0))return s.INTERSECT;if(2===i)return s.INTERSECT;i=1}}return i>0?s.INSIDE:s.OUTSIDE},intersectVertices:function(t,e){return this.intersectOrContainsVertices(t,e)===s.INTERSECT}});const o=s},"e0P+":(t,e,i)=>{"use strict";i.d(e,{Z:()=>u});var r=i("iUVs"),n=i("itLJ"),a=i("GoyH"),s=i("W40i"),o=i("bDLW"),h=function(){this._clippingMask=0,this._planeList=[n.Z.create(),n.Z.create(),n.Z.create(),n.Z.create(),n.Z.create(),n.Z.create()],this._vertexList=[],this._maskStack=new o.Z,this._resultMask=0,this._maskStack.push(this._resultMask)};a.Z.createPrototypeObject(h,a.Z.objectInherit(r.Z.prototype,{getPlanes:function(){return this._planeList},setPlanes:function(t){this._planeList=t,this.setupMask()},clear:function(){if(this._clippingMask=0,this._planeList)for(var t=0,e=this._planeList.length;t<e;++t)n.Z.init(this._planeList[t]);this._vertexList=[],this.setupMask()},setToUnitFrustum:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this._planeList.length=0,this._planeList.push(s.vh.set(n.Z.create(),1,0,0,1)),this._planeList.push(s.vh.set(n.Z.create(),-1,0,0,1)),this._planeList.push(s.vh.set(n.Z.create(),0,1,0,1)),this._planeList.push(s.vh.set(n.Z.create(),0,-1,0,1)),t&&this._planeList.push(s.vh.set(n.Z.create(),0,0,1,1)),e&&this._planeList.push(s.vh.set(n.Z.create(),0,0,-1,1)),this.setupMask()},setToBoundingBox:function(t){this._planeList.length=0,this._planeList.push(s.vh.set(n.Z.create(),1,0,0,-t.getMin()[0])),this._planeList.push(s.vh.set(n.Z.create(),-1,0,0,t.getMax()[0])),this._planeList.push(s.vh.set(n.Z.create(),0,1,0,-t.getMin()[1])),this._planeList.push(s.vh.set(n.Z.create(),0,-1,0,t.getMax()[1])),this._planeList.push(s.vh.set(n.Z.create(),0,0,1,-t.getMin()[2])),this._planeList.push(s.vh.set(n.Z.create(),0,0,-1,t.getMax()[2])),this.setupMask()},setAndTransformProvidingInverse:function(t,e){this._referenceVertexList=t._referenceVertexList;var i=this._maskStack.getLength()-1,r=t._maskStack[i];if(0===r)return this._maskStack.getArray()[i]=0,this._resultMask=0,void(this._planeList.length=0);var a,s=1,o=0;for(a=0;a!==t._planeList.length;++a)r&s&&++o,s<<=1;this._planeList.length=o,this._resultMask=0,s=1;var h=0;for(a=0;a!==t._planeList.length;++a)r&s&&(this._planeList[h]=t._planeList[a],n.Z.transformProvidingInverse(this._planeList[h++],e),this._resultMask=this._resultMask<<1|1),s<<=1;this._maskStack.getArray()[i]=this._resultMask},voidset:add:empty:setReferenceVertexList:function(t){this._referenceVertexList=t},getReferenceVertexList:function(){return this._referenceVertexList},setupMask:function(t){this._resultMask=0;for(var e=void 0!==t?t:this._planeList.length,i=0;i<e;++i)this._resultMask=this._resultMask<<1|1;this._maskStack.reset(),this._maskStack.push(this._resultMask)},getCurrentMask:function(){return this._maskStack.back()},setResultMask:function(t){this._resultMask=t},getResultMask:function(){return this._resultMask},getMaskStack:function(){return this._maskStack},pushCurrentMask:popCurrentMask:function(){return this._maskStack.pop()},containsVertex:function(t){var e=this._maskStack.back();if(!e)return!0;for(var i=1,r=0;r<this._planeList.length;++r){if(e&i&&n.Z.distanceToPlane(this._planeList[r],t)<0)return!1;i<<=1}return!0},containsVertices:function(t){var e=this._maskStack.back();if(!e)return!0;this._resultMask=e;for(var i=0;i<t.length;++i){for(var r=t[i],a=!1,s=1,o=0;!a&&o<this._planeList.length;++o)e&s&&n.Z.distanceToPlane(this._planeList[o],r)<0&&(a=!0),s<<=1;if(!a)return!0}return!1},containsBoundingSphere:function(t){var e=this._maskStack.back();if(!e||!t.valid())return!0;this._resultMask=e;for(var i=1,r=0;r<this._planeList.length;++r){if(this._resultMask&i){var a=n.Z.intersectsOrContainsBoundingSphere(this._planeList[r],t);if(n.Z.OUTSIDE===a)return!1;n.Z.INSIDE===a&&(this._resultMask^=i)}i<<=1}return!0},containsBoundingBox:function(t){var e=this._maskStack.back();if(!e)return!0;this._resultMask=e;for(var i=1,r=0;r<this._planeList.length;++r){if(this._resultMask&i){var a=n.Z.intersectsOrContainsBoundingBox(this._planeList[r],t);if(n.Z.OUTSIDE===a)return!1;n.Z.INSIDE===a&&(this._resultMask^=i)}i<<=1}return!0},containsAllOfVertices:function(t){var e=this._maskStack.back();if(!e)return!1;this._resultMask=e;for(var i=1,r=0;r<this._planeList.length;++r){if(this._resultMask&i){if(n.Z.intersectsOrContainsVertices(this._planeList[r],t)<1)return!1;this._resultMask^=i}i<<=1}return!0},containsAllOfBoundingSphere:function(t){var e=this._maskStack.back();if(!e)return!1;this._resultMask=e;for(var i=1,r=0;r<this._planeList.length;++r){if(this._resultMask&i){if(n.Z.intersectsOrContainsBoundingSphere(this._planeList[r],t)<1)return!1;this._resultMask^=i}i<<=1}return!0},containsAllOfBoundingBox:function(t){var e=this._maskStack.back();if(!e)return!1;this._resultMask=e;for(var i=1,r=0;r<this._planeList.length;++r){if(this._resultMask&i){if(n.Z.intersectsOrContainsBoundingBox(this._planeList[r],t)<1)return!1;this._resultMask^=i}i<<=1}return!0},transformProvidingInverse:function(t){var e=this._maskStack.back();if(e){this._resultMask=e;for(var i=1,r=0;r<this._planeList.length;++r)e&i&&n.Z.transformProvidingInverse(this._planeList[r],t),i<<=1}}}),"osg","Polytope");const u=h},bDLW:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r=r.prototype={clean:reset:function(){this._length=0},getLength:function(){return this._length},getArray:function(){return this._pool},back:pop:function(){return this._length--,this._pool[this._length]},push:forEach:function(t){for(var e=0;e<this._length;e++)t(this._pool[e])}};const n=r},gjC8:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i("bDLW"),n=n.prototype={reset:function(){for(var t=this._keys.getArray(),e=this._keys.getLength(),i=0;i<e;i++){var r=t[i];this._map[r]=void 0}this._keys.reset()},set:hasKey:getMap:function(){return this._map},getKeys:function(){return this._keys},forEach:function(t){for(var e=this._keys.getArray(),i=this._keys.getLength(),r=0;r<i;r++){var n=e[r];t(n,this._map[n])}}};const a=n},cyFB:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r=r.prototype={clean:getLength:function(){return this._length},reset:getOrCreateObject:function(){var t;return this._length===this._pool.length?(t=this._createFunction(),this._pool.push(t)):t=this._pool[this._length],this._length++,t},forEach:function(t){for(var e=0;e<this._length;e++)t(this._pool[e])}};const n=r},"5pih":(t,e,i)=>{"use strict";i.d(e,{Z:()=>S});var r,n=i("GoyH"),a=i("u5PS"),s=i("bYH/"),o=i("/CZr"),h=i("WWMP"),u=i("w/Ui"),c=i("6qT5"),l=i("BvLe"),_=s.Z.getOptionsURL(),d=_.shaderStats?{}:void 0,f=_.forceSyncLink,p=new Uint8Array(4),g=function(t){t.flush(),t.finish(),t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,p)},m=/uniform\s+\w+\s+(\w+)((\s)?\[(.*?)\])?/g,v=/(in|attribute)\s+\w+\s+(\w+)\s*;/g,b=function(t,e){o.Z.call(this),h.Z.call(this),this._program=null,this._nullProgram=!0,this._vertex=void 0,this._fragment=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._activeUniforms=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,this._asyncCompilation=void 0,this._asyncLinkingExt=f?void 0:l.Z.instance().getWebGLExtension("KHR_parallel_shader_compile"),this._compileClean=void 0,t&&this.setVertexShader(t),e&&this.setFragmentShader(e),this._dirty=!0};b._sDeletedGLProgramCache=new window.Map,b.deleteGLProgram=function(t,e){b._sDeletedGLProgramCache.has(t)||b._sDeletedGLProgramCache.set(t,[]),b._sDeletedGLProgramCache.get(t).push(e)},b.flushDeletedGLPrograms=function(t,e){if(e<=0)return e;if(!b._sDeletedGLProgramCache.has(t))return e;for(var i=0,r=c.Z.instance().tick(),n=b._sDeletedGLProgramCache.get(t),a=n.length-1;a>=0&&i<e;a--)t.deleteProgram(n[a]),n.splice(a,1),i=c.Z.instance().deltaS(r,c.Z.instance().tick());return e-i},b.flushAllDeletedGLPrograms=function(t){if(b._sDeletedGLProgramCache.has(t))for(var e=b._sDeletedGLProgramCache.get(t),i=e.length-1;i>=0;i--)t.deleteProgram(e[i]),e.splice(i,1)},b.onLostContext=function(t){b._sDeletedGLProgramCache.has(t)&&(b._sDeletedGLProgramCache.get(t).length=0,this._asyncCompilation=void 0,this._asyncLinkingExt=f?void 0:l.Z.instance().getWebGLExtension("KHR_parallel_shader_compile"),this._compileClean=void 0)},n.Z.createPrototypeStateAttribute(b,n.Z.objectInherit(o.Z.prototype,n.Z.objectInherit(h.Z.prototype,{attributeType:"Program",cloneType:function(){return new b},setVertexShader:function(t){this._vertex=t,this._nullProgram=!1,t.setText(u.Z.processShader(t.getText()))},setFragmentShader:function(t){this._fragment=t,this._nullProgram=!1,t.setText(u.Z.processShader(t.getText()))},getVertexShader:function(){return this._vertex},getFragmentShader:function(){return this._fragment},getProgram:function(){return this._program},setActiveUniforms:function(t){this._activeUniforms=t},getActiveUniforms:function(){return this._activeUniforms},setForeignUniforms:function(t){this._foreignUniforms=t},getForeignUniforms:function(){return this._foreignUniforms},setUniformsCache:function(t){this._uniformsCache=t},getUniformsCache:function(){return this._uniformsCache},setAttributesCache:function(t){this._attributesCache=t},getAttributesCache:function(){return this._attributesCache},setTrackAttributes:function(t){this._trackAttributes=t},getTrackAttributes:function(){return this._trackAttributes},releaseGLObjects:function(){void 0!==this._vertex&&this._vertex.releaseGLObjects(),void 0!==this._fragment&&this._fragment.releaseGLObjects(),null!==this._program&&(void 0!==this._gl&&(b.deleteGLProgram(this._gl,this._program),o.Z.removeObject(this._gl,this)),this.invalidate())},dirty:function(){this._program=void 0},invalidate:function(){this._cacheUniformId=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,this._compileClean=void 0,this._program=void 0},_rebuildProgramFromSpector:function(t,e,i,r){this._dirty=!0,this._vertex.invalidate(),this._fragment.invalidate(),this.invalidate(),this._vertex.setText(t),this._fragment.setText(e),this._program=null,this._spectorOnCompiled=i,this._spectorOnError=r,this._compileClean=void 0},_onErrorToSpector:function(t){return!!this._spectorOnError&&(this._spectorOnError(t),!0)},_onCompilationToSpector:_bindProgramToSpector:function(){window&&window.spector&&!this._program.__SPECTOR_rebuildProgram&&(this._program.__SPECTOR_rebuildProgram=this._rebuildProgramFromSpector.bind(this))},_logDebugShaders:function(t,e){if("Failed to create D3D shaders.\n"===e){var i=void 0!==t.rawgl?t.rawgl:t;void 0!==i&&void 0===i.getExtension&&(i=i.getExtension("WEBGL_debug_shaders"))&&(a.Z.error(i.getTranslatedShaderSource(this._vertex.shader)),a.Z.error(i.getTranslatedShaderSource(this._fragment.shader)))}},_activateFailSafe:function(t){var e=t.createProgram();this._vertex.failSafe(t,this._vertex.getText()),this._fragment.failSafe(t,this._fragment.getText()),this._glAttachAndLink(t,e,this._vertex,this._fragment),a.Z.warn("FailSafe shader Activated "),this._program=e},_glAttachAndLink:function(t,e,i,r){t.attachShader(e,i.shader),t.attachShader(e,r.shader),t.linkProgram(e)},_glShaderCompile:function(t,e){e.shader||(d&&(e===this._vertex?d.vert=c.Z.tick():d.frag=c.Z.tick()),e.compile(t,r))},_glShaderCompilationResult:function(t,e){var i=e.getCompilationResult(t,r);return d&&(void 0===this._asyncCompilation&&g(t),e===this._vertex?d.vert=c.Z.tick()-d.vert:d.frag=c.Z.tick()-d.frag),i},compile:function(){var t=this._gl,e=this._fragment.getText(),i=this._vertex.getText();this._attributeMap=function(t){for(var e,i={};null!==(e=v.exec(t));)i[e[2]]=!0;return i}(i),this._uniformMap=function(t){for(var e,i={};null!==(e=m.exec(t));)i[e[1]]=!0;return i}(e+"\n"+i),this._glShaderCompile(t,this._vertex),this._glShaderCompile(t,this._fragment)},getShaderName:function(){if(this._shaderName)return this._shaderName;if(!this._fragment||!this._fragment.getText())return"";var t=this._fragment.getText().match(/^#define\s+SHADER_NAME\s+(.*)$/m);return this._shaderName=t&&t[1]?t[1]:"",this._shaderName},getCompilationResultAndLink:function(t){return!!this._compileClean||(d&&(d.vert=0,d.frag=0,d.link=0,d.total=0,void 0===this._asyncCompilation&&g(t),d.total=c.Z.tick(),a.Z.log(this.getShaderName()+" start"),a.Z.timeStamp(this.getShaderName()+" start")),this._compileClean=this._glShaderCompilationResult(t,this._vertex),this._compileClean=this._glShaderCompilationResult(t,this._fragment)&&this._compileClean,d&&(a.Z.log(this.getShaderName()+" compilation"),a.Z.timeStamp(this.getShaderName()+" compilation")),!!this._compileClean&&(this._program=t.createProgram(),this._attributeMap.Vertex&&t.bindAttribLocation(this._program,0,"Vertex"),this._glAttachAndLink(t,this._program,this._vertex,this._fragment),!0))},getAsyncLinkingStatus:function(){return this._asyncLinkingExt&&!0===this._gl.getProgramParameter(this._program,this._asyncLinkingExt.COMPLETION_STATUS_KHR)},getAsyncCompiling:function(){return this._asyncCompilation},_logShaderStats:function(t){if(void 0===this._asyncCompilation&&g(t),d.link=c.Z.tick()-d.link,d.link){d.total=c.Z.tick()-d.total,this._placeHolder&&(d.total=d.vert+d.frag+d.link);var e=(this._placeHolder?"Async":"")+this.getShaderName()+" - "+d.total.toFixed(2)+"ms";a.Z.group(e),a.Z.log("vertex : "+d.vert.toFixed(2)+"ms"),a.Z.log("fragment : "+d.frag.toFixed(2)+"ms"),a.Z.log("link : "+d.link.toFixed(2)+"ms"),a.Z.log("total : "+d.total.toFixed(2)+"ms"),a.Z.groupEnd(e)}},getLinkResult:function(t){if(this._compileClean){d&&(d.link=c.Z.tick(),a.Z.log(this.getShaderName()+" link"),a.Z.timeStamp(this.getShaderName()+" link"));var e=t.getProgramParameter(this._program,t.LINK_STATUS);if(d&&this._logShaderStats(t),e||t.isContextLost())this._onCompilationToSpector(this._program);else{var i=t.getProgramInfoLog(this._program);if(a.Z.errorFold(i,"can't link program\nvertex shader:\n"+this._vertex.text+"\n fragment shader:\n"+this._fragment.text),this._logDebugShaders(t,i),r&&r(this._vertex.text,this._fragment.text,i),this._compileClean=!1,this._onErrorToSpector(i))return!1}}return this._dirty=!1,this._asyncCompilation=-1,this._placeHolder=void 0,this._uniformsCache={},this._attributesCache={},this._compileClean?(this.cacheAttributeList(t,window.Object.keys(this._attributeMap)),this.cacheUniformList(t,window.Object.keys(this._uniformMap))):this._activateFailSafe(t),this._bindProgramToSpector(),this._compileClean},enableAsyncCompilation:apply:function(t){if(!this._nullProgram)if(this._gl||this.setGraphicContext(t.getGraphicContext()),!this._program||this._dirty)if(this._placeHolder)this._placeHolder.apply(t);else{if(this.compile(),!this.getCompilationResultAndLink(this._gl))return this._dirty=!1,this._asyncLinkingExt=void 0,void(this._asyncCompilation=-1);var e=this._asyncLinkingExt&&this.getAsyncLinkingStatus(),i=this.getShaderName().toLowerCase();if(e||!this._asyncLinkingExt||i&&(-1!==i.indexOf("packer")||-1!==i.indexOf("environment")||-1!==i.indexOf("hotspot")))return this.getLinkResult(this._gl),t.applyProgram(this._program),this._dirty=!1,this._asyncLinkingExt=void 0,void(this._asyncCompilation=-1);this._asyncCompilation=1}else t.applyProgram(this._program)},cacheUniformList:function(t,e){for(var i=this._uniformsCache,r=0,n=e.length;r<n;r++){var a=e[r],s=t.getUniformLocation(this._program,a);null!=s&&void 0===i[a]&&(i[a]=s)}},cacheAttributeList:function(t,e){for(var i=this._attributesCache,r=0,n=e.length;r<n;r++){var a=e[r],s=t.getAttribLocation(this._program,a);-1!==s&&void 0!==s&&void 0===i[a]&&(i[a]=s)}}})),"osg","Program"),b.registerErrorCallback=const S=b},WMIH:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=i("GoyH"),n=i("IpZ9"),a=i("W40i"),s=function(){n.Z.call(this),this.projection=a._E.create()};r.Z.createPrototypeNode(s,r.Z.objectInherit(n.Z.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(t){this.projection=t}}),"osg","Projection");const o=s},rsXr:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var r=i("GoyH"),n=i("WWMP"),a=function(t,e,i,r){n.Z.call(this),this._x=void 0!==t?t:-1,this._y=void 0!==e?e:-1,this._width=void 0!==i?i:-1,this._height=void 0!==r?r:-1};r.Z.createPrototypeStateAttribute(a,r.Z.objectInherit(n.Z.prototype,{attributeType:"Scissor",cloneType:setScissor:x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},apply:),"osg","Scissor");const s=a},"7itD":(t,e,i)=>{"use strict";i.d(e,{Z:()=>h});var r=i("u5PS"),n=i("GoyH"),a=i("6qT5"),s=i("/CZr"),o=function(t,e){s.Z.call(this);var i=t;"string"==typeof t&&(i=o[t]),this.type=i,this.setText(e)};o.VERTEX_SHADER=35633,o.FRAGMENT_SHADER=35632;o.VS_DBG="#define _DEBUG 1\n#ifdef _DEBUG\nattribute vec3 Vertex;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(void) {  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);}\n",o.FS_DBG="#define _DEBUG 1\n#ifdef _DEBUG\n precision lowp float; void main(void) { gl_FragColor = vec4(1.0, 0.6, 0.6, 1.0);}\n",o._sDeletedGLShaderCache=new window.Map,o.deleteGLShader=function(t,e){o._sDeletedGLShaderCache.has(t)||o._sDeletedGLShaderCache.set(t,[]),o._sDeletedGLShaderCache.get(t).push(e)},o.flushDeletedGLShaders=function(t,e){if(e<=0)return e;if(!o._sDeletedGLShaderCache.has(t))return e;for(var i=0,r=a.Z.instance().tick(),n=o._sDeletedGLShaderCache.get(t),s=n.length-1;s>=0&&i<e;s--)t.deleteShader(n[s]),n.splice(s,1),i=a.Z.instance().deltaS(r,a.Z.instance().tick());return e-i},o.flushAllDeletedGLShaders=function(t){if(o._sDeletedGLShaderCache.has(t))for(var e=o._sDeletedGLShaderCache.get(t),i=e.length-1;i>=0;i--)t.deleteShader(e[i]),e.splice(i,1)},o.onLostContext=function(t){o._sDeletedGLShaderCache.has(t)&&(o._sDeletedGLShaderCache.get(t).length=0)},n.Z.createPrototypeObject(o,n.Z.objectInherit(s.Z.prototype,{setText:function(t){this.text=t},getText:function(){return this.text},failSafe:function(t,e){this.shader=t.createShader(this.type);var i=e.match(/#define[\s]+SHADER_NAME[\s]+([\S]+)(\n|$)/);i=i?i[1]:"";var r=this.type===o.VERTEX_SHADER?o.VS_DBG:o.FS_DBG;r+="\n#define SHADER_NAME FailSafe"+i+"\n#else\n"+e+"\n#endif\n",t.shaderSource(this.shader,r),t.compileShader(this.shader)},processErrors:function(t,e){var i,n,a=/ERROR: [\d]+:([\d]+): (.+)/gim,s=e.split("\n"),o=s.length;if(0!==o)if(null===a.exec(t)&&(a=/Shader compilation errors\n\((\d+)\, \d+\): (.+)/gim),a.lastIndex=0,null!==a.exec(t))for(a.lastIndex=0;null!==(n=a.exec(t));){n.index===a.lastIndex&&a.lastIndex++;var h=parseInt(n[1],10);if(!(h>o)){r.Z.error("ERROR "+n[2]+" in line "+h);var u=Math.max(0,h-7),c=Math.max(0,h-2);for(i=u;i<=c;i++)r.Z.warn(s[i].replace(/^[ \t]+/g,""));for(c=Math.max(0,h-1),r.Z.error(s[c].replace(/^[ \t]+/g,"")),u=Math.min(o,h),c=Math.min(o,h+5),i=u;i<c;i++)r.Z.warn(s[i].replace(/^[ \t]+/g,""))}}else r.Z.error(t)},compile:function(t){this._gl||this.setGraphicContext(t),this.shader=t.createShader(this.type),t.shaderSource(this.shader,this.text),t.compileShader(this.shader)},getCompilationResult:function(t,e){if(t.isContextLost())return r.Z.error("can't compile shader, no context"),!1;if(!t.getShaderParameter(this.shader,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(this.shader);this.processErrors(i,this.text);for(var n=this.text.split("\n"),a="\n",s=0,o=n.length;s<o;++s)a+=s+" "+n[s]+"\n";return r.Z.errorFold("can't compile shader",a),e&&e(this.text,a,i),!1}return!0},releaseGLObjects:function(){void 0!==this._gl&&(o.deleteGLShader(this._gl,this.shader),s.Z.removeObject(this._gl,this)),this.invalidate()},invalidate:),"osg","Shader");const h=o},UAvO:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r=function(){this._globalDefault=void 0,this._lastApplied=void 0,this._changed=!1,this._values=[],this._back=void 0,this._length=0};r.prototype={getLength:function(){return this._length},push:function(t,e){var i;this._length===this._values.length?(i={object:t,value:e},this._values.push(i)):((i=this._values[this._length]).object=t,i.value=e),this._back=i,this._length++},pop:function(){if(this._length){var t=this._values;this._length--;var e=t[this._length];return this._back=this._length?t[this._length-1]:void 0,e}}};const n=r},bfff:(t,e,i)=>{"use strict";i.d(e,{Z:()=>E});var r=i("W40i"),n=i("u5PS"),a=i("iUVs"),s=i("5pih"),o=i("WWMP"),h=i("bDLW"),u=i("UAvO"),c=i("64xh"),l=i("GoyH"),_=i("BvLe"),d=i("uRnn"),f=i("f7MS"),p=i("nbbV"),g=function(){this._stateClearColor={buffer:{red:0,green:0,blue:0,alpha:0},state:{red:void 0,green:void 0,blue:void 0,alpha:void 0},changed:!0},this._stateClearDepth={buffer:{value:1},state:{value:void 0},changed:!0},this._stateDepthMask={state:{value:!0},buffer:{value:void 0},changed:!0},this._stateViewport={buffer:{x:0,y:0,width:640,height:480},state:{x:void 0,y:void 0,width:void 0,height:void 0},changed:!0},this._stateColorMask={buffer:{red:!0,green:!0,blue:!0,alpha:!0},state:{red:void 0,green:void 0,blue:void 0,alpha:void 0},changed:!0},this._stateScissor={buffer:{enable:!1,x:0,y:0,width:640,height:480},state:{enable:!1,x:void 0,y:void 0,width:void 0,height:void 0},changed:!0},this._stateDepth={buffer:{func:d.Z.LESS,enable:!1,near:0,far:1},state:{func:void 0,enable:!1,near:void 0,far:void 0},changed:!0},this._stateCullFace={buffer:{enable:!1,mode:p.Z.BACK},state:{enable:!1,mode:void 0},changed:!0},this._stateBlendFunc={buffer:{separate:!1,enable:!1,sourceFactor:f.Z.ONE,destinationFactor:f.Z.ZERO,sourceFactorAlpha:f.Z.ONE,destinationFactorAlpha:f.Z.ZERO},state:{separate:void 0,enable:!1,sourceFactor:void 0,destinationFactor:void 0,sourceFactorAlpha:void 0,destinationFactorAlpha:void 0},changed:!0}};g.prototype={clearColor:function(t){var e=this._stateClearColor,i=e.buffer,r=e.state;e.changed=!1,i.red=t[0],i.green=t[1],i.blue=t[2],i.alpha=t[3],r.red===t[0]&&r.green===t[1]&&r.blue===t[2]&&r.alpha===t[3]||(e.changed=!0)},applyClearColor:function(t){var e=this._stateClearColor,i=e.state,r=e.buffer;e.changed=!1,i.red=r.red,i.green=r.green,i.blue=r.blue,i.alpha=r.alpha,t.clearColor(i.red,i.green,i.blue,i.alpha)},clearDepth:function(t){var e=this._stateClearDepth,i=e.buffer,r=e.state;e.changed=!1,i.value=t,r.value!==t&&(e.changed=!0)},applyClearDepth:function(t){var e=this._stateClearDepth,i=e.buffer,r=e.state;e.changed=!1,r.value=i.value,t.clearDepth(r.value)},depthMask:function(t){var e=this._stateDepthMask,i=e.buffer,r=e.state;e.changed=!1,i.value=t,r.value!==t&&(e.changed=!0)},applyDepthMask:function(t){var e=this._stateDepthMask,i=e.buffer,r=e.state;e.changed=!1,r.value=i.value,t.depthMask(r.value)},applyViewportAttribute:viewport:function(t,e,i,r){var n=this._stateViewport,a=n.buffer,s=n.state;n.changed=!1,a.x=t,a.y=e,a.width=i,a.height=r,s.x===t&&s.y===e&&s.width===i&&s.height===r||(n.changed=!0)},applyViewport:function(t){var e=this._stateViewport,i=e.buffer,r=e.state;e.changed=!1,r.x=i.x,r.y=i.y,r.width=i.width,r.height=i.height,t.viewport(r.x,r.y,r.width,r.height)},applyColorMaskAttribute:function(t){var e=this._stateColorMask,i=e.buffer,r=e.state;e.changed=!1,i.red=t._red,i.green=t._green,i.blue=t._blue,i.alpha=t._alpha,r.red===t._red&&r.green===t._green&&r.blue===t._blue&&r.alpha===t._alpha||(e.changed=!0)},applyColorMask:function(t){var e=this._stateColorMask,i=e.buffer,r=e.state;e.changed=!1,r.red=i.red,r.green=i.green,r.blue=i.blue,r.alpha=i.alpha,t.colorMask(r.red,r.green,r.blue,r.alpha)},applyScissorAttribute:function(t){var e=-1!==t._x,i=this._stateScissor,r=i.buffer,n=i.state;i.changed=!1,r.enable=e,r.x=t._x,r.y=t._y,r.width=t._width,r.height=t._height,n.enable===e&&n.x===t._x&&n.y===t._y&&n.width===t._width&&n.height===t._height||(i.changed=!0)},applyScissor:function(t){var e=this._stateScissor,i=e.buffer,r=e.state;e.changed=!1,r.enable!==i.enable&&(r.enable=i.enable,r.enable?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)),r.enable&&(r.x===i.x&&r.y===i.y&&r.width===i.width&&r.height===i.height||(r.x=i.x,r.y=i.y,r.width=i.width,r.height=i.height,t.scissor(r.x,r.y,r.width,r.height)))},applyCullFaceAttribute:function(t){var e=this._stateCullFace,i=e.buffer,r=e.state,n=t._mode!==p.Z.DISABLE;e.changed=!1,i.enable=n,i.mode=t._mode,r.enable===n&&r.mode===t._mode||(e.changed=!0)},applyCullFace:function(t){var e=this._stateCullFace,i=e.buffer,r=e.state;e.changed=!1,r.enable!==i.enable&&(r.enable=i.enable,r.enable?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE)),r.enable&&r.mode!==i.mode&&(r.mode=i.mode,t.cullFace(r.mode))},applyDepthAttribute:function(t){var e=t._func!==d.Z.DISABLE,i=this._stateDepth,r=i.buffer,n=i.state;i.changed=!1,r.enable=e,r.func=t._func,r.far=t._far,r.near=t._near,n.enable===e&&n.func===t._func&&n.near===t._near&&n.far===t._far||(i.changed=!0),this.depthMask(t._writeMask)},applyDepth:function(t){var e=this._stateDepth,i=e.buffer,r=e.state;e.changed=!1,r.enable!==i.enable&&(r.enable=i.enable,r.enable?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)),r.enable&&(r.func!==i.func&&(r.func=i.func,t.depthFunc(r.func)),r.near===i.near&&r.far===i.far||(r.far=i.far,r.near=i.near,t.depthRange(r.near,r.far)))},applyBlendFuncAttribute:function(t){var e=this._stateBlendFunc,i=e.buffer,r=e.state,n=t._sourceFactor!==f.Z.DISABLE&&t._destinationFactor!==f.Z.DISABLE;e.changed=!1,i.enable=n,i.separate=t._separate,i.sourceFactor=t._sourceFactor,i.destinationFactor=t._destinationFactor,i.sourceFactorAlpha=t._sourceFactorAlpha,i.destinationFactorAlpha=t._destinationFactorAlpha,r.enable===n&&r.sourceFactor===t._sourceFactor&&r.destinationFactor===t._destinationFactor&&r.sourceFactorAlpha===t._sourceFactorAlpha&&r.destinationFactorAlpha===t._destinationFactorAlpha||(e.changed=!0)},applyBlendFunc:function(t){var e=this._stateBlendFunc,i=e.buffer,r=e.state;e.changed=!1,r.enable!==i.enable&&(r.enable=i.enable,r.enable?t.enable(t.BLEND):t.disable(t.BLEND)),r.enable&&(r.separate=i.separate,r.separate?r.sourceFactor===i.sourceFactor&&r.destinationFactor===i.destinationFactor&&r.sourceFactorAlpha===i.sourceFactorAlpha&&r.destinationFactorAlpha===i.destinationFactorAlpha||(r.sourceFactor=i.sourceFactor,r.destinationFactor=i.destinationFactor,r.sourceFactorAlpha=i.sourceFactorAlpha,r.destinationFactorAlpha=i.destinationFactorAlpha,t.blendFuncSeparate(r.sourceFactor,r.destinationFactor,r.sourceFactorAlpha,r.destinationFactorAlpha)):r.sourceFactor===i.sourceFactor&&r.destinationFactor===i.destinationFactor||(r.sourceFactor=i.sourceFactor,r.destinationFactor=i.destinationFactor,t.blendFunc(r.sourceFactor,r.destinationFactor)))},applyClearStates:function(t){this._stateDepthMask.changed&&this.applyDepthMask(t),this._stateScissor.changed&&this.applyScissor(t),this._stateClearColor.changed&&this.applyClearColor(t),this._stateClearDepth.changed&&this.applyClearDepth(t),this._stateColorMask.changed&&this.applyColorMask(t)},applyDrawStates:function(t){this._stateViewport.changed&&this.applyViewport(t),this._stateScissor.changed&&this.applyScissor(t),this._stateDepth.changed&&this.applyDepth(t),this._stateDepthMask.changed&&this.applyDepthMask(t),this._stateCullFace.changed&&this.applyCullFace(t),this._stateBlendFunc.changed&&this.applyBlendFunc(t),this._stateColorMask.changed&&this.applyColorMask(t)},clear:drawGeometry:;const m=g;var v,b,S,y,T=[void 0,function(t,e){return t[0]===e[0]||(e[0]=t[0],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]||(e[0]=t[0],e[1]=t[1],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],!1)}],x=function(t){a.Z.call(this),this._excludeUniforms={uProjectionMatrix:!0,uModelMatrix:!0,uViewMatrix:!0,uModelViewMatrix:!0,uModelNormalMatrix:!0,uModelViewNormalMatrix:!0,uArrayColorEnabled:!0},this._graphicContext=void 0,this._shaderGeneratorProxy=t,void 0===t&&console.break(),this._currentVAO=null,this._currentIndexVBO=null,this._stateSets=new h.Z,this._shaderGeneratorNames=new u.Z,this._uniforms={},this._textureAttributeArrayList=[],this._attributeArray=[],this._projectionMatrix=c.Z.createMatrix4(r._E.create(),"uProjectionMatrix"),this._modelMatrix=c.Z.createMatrix4(r._E.create(),"uModelMatrix"),this._viewMatrix=c.Z.createMatrix4(r._E.create(),"uViewMatrix"),this._modelViewMatrix=c.Z.createMatrix4(r._E.create(),"uModelViewMatrix"),this._modelNormalMatrix=c.Z.createMatrix3(r.wO.create(),"uModelNormalMatrix"),this._modelViewNormalMatrix=c.Z.createMatrix3(r.wO.create(),"uModelViewNormalMatrix");var e=new u.Z;e._globalDefault=c.Z.createFloat1(0,"uArrayColorEnabled"),this._uniforms.ArrayColorEnabled=e,this._previousColorAttribPair={},this._vertexAttribMap={},this._vertexAttribMap._disable=[],this._vertexAttribMap._keys=[],this._frameStamp=void 0,this._programCommonUniformsCache={},this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0,this._program=void 0;var i=new s.Z;this.applyAttribute(i),this._programType=l.Z.getOrCreateStateAttributeTypeMemberIndex(i),this._programAttribute=this._attributeArray[this._programType],this._numPushStateSet=0,this._numApply=0,this._programUniformCache=[],this._cacheUniformId=0,this._stateCache=new m,this.resetStats()};l.Z.createPrototypeObject(x,l.Z.objectInherit(a.Z.prototype,{getExcludeUniforms:function(){return this._excludeUniforms},resetCaches:function(){this._currentVAO=null,this._currentIndexVBO=null,this._previousColorAttribPair={},this._vertexAttribMap={},this._vertexAttribMap._disable=[],this._vertexAttribMap._keys=[],this._programCommonUniformsCache={}},applyColorMask:function(t){this._stateCache.applyColorMaskAttribute(t)},applyBlendFunc:function(t){this._stateCache.applyBlendFuncAttribute(t)},applyCullFace:function(t){this._stateCache.applyCullFaceAttribute(t)},applyDepth:function(t){this._stateCache.applyDepthAttribute(t)},applyViewport:function(t){this._stateCache.applyViewportAttribute(t)},applyScissor:function(t){this._stateCache.applyScissorAttribute(t)},viewport:depthMask:function(t){this._stateCache.depthMask(t)},clearDepth:function(t){this._stateCache.clearDepth(t)},clearColor:clear:function(t){this._stateCache.clear(this._graphicContext,t)},drawGeometry:getCacheUniformsApplyRenderLeaf:function(){return this._programCommonUniformsCache},setGraphicContext:function(t){this._graphicContext=t,this._extVAO=_.Z.instance(t).getWebGLExtension("OES_vertex_array_object")},getGraphicContext:function(){return this._graphicContext},getShaderGeneratorProxy:function(){return this._shaderGeneratorProxy},pushCheckOverride:function(t,e,i){var r=this._evaluateOverrideObjectOnStack(t,e,i);r!==e?t.push(r,t._back.value):t.push(e,i)},_evaluateOverrideObjectOnStack:function(t,e,i){var r=t._back;return 0===t._length?e:r.value&o.Z.OVERRIDE&&!(i&o.Z.PROTECTED)?r.object:e},pushStateSet:function(t){this._numPushStateSet++,this._stateSets.push(t),this.pushAttributeMap(this._attributeArray,t._attributeArray,t._activeAttribute);for(var e=t._textureAttributeArrayList,i=t._activeTextureAttributeUnit,r=t._activeTextureAttribute,n=0,a=i.length;n<a;n++){var s=i[n],o=e[s],h=this.getOrCreateTextureAttributeArray(s);this.pushAttributeMap(h,o,r)}t.hasUniform()&&this.pushUniformsList(this._uniforms,t.getUniformList());var u=t.getShaderGeneratorPair();u&&this.pushCheckOverride(this._shaderGeneratorNames,u.getShaderGeneratorName(),u.getValue())},getStateSetStackSize:insertStateSet:(S=new h.Z,y=S.getArray(),function(t,e){S.reset();for(var i=this.getStateSetStackSize();i>t;)S.push(this._stateSets.back()),this.popStateSet(),i--;this.pushStateSet(e);for(var r=S._length-1;r>=0;r--)this.pushStateSet(y[r])}),removeStateSet:function(){var t=new h.Z,e=t.getArray();return function(i){var r=this.getStateSetStackSize();if(i>=r)n.Z.warn("Warning State:removeStateSet "+i+" out of range");else{for(t.reset();r-1>i;)t.push(this._stateSets.back()),this.popStateSet(),r--;this.popStateSet();for(var a=t._length-1;a>=0;a--)this.pushStateSet(e[a])}}}(),resetCacheFrame:resetStats:applyProgram:function(t){this._program!==t&&(this._program=t,this.getGraphicContext().useProgram(t))},applyModelViewMatrix:(b=r.wO.create(),function(t,e){if(this._lastAppliedModelViewMatrix===t)return!1;var i,n=this.getLastProgramApplied().getUniformsCache(),a=this._modelViewMatrix,s=n.uModelViewMatrix,o=this.getGraphicContext();if(s&&(a.setMatrix4(t),a.apply(o,s)),this._lastAppliedModelViewMatrix){for(var h=this._lastAppliedModelViewMatrix,u=0;u<11;u++)if(t[u]!==h[u]){i=!0;break}}else i=!0;return i&&(a=this._modelViewNormalMatrix,(s=n.uModelViewNormalMatrix)&&(r.wO.normalFromMat4(b,t),a.setMatrix3(b),a.apply(o,s)),(s=n.uModelNormalMatrix)&&(r.wO.normalFromMat4(b,e),a.setMatrix3(b),a.apply(o,s))),this._lastAppliedModelViewMatrix=t,!0}),applyProjectionMatrix:function(t){if(this._lastAppliedProjectionMatrix!==t){this._lastAppliedProjectionMatrix=t;var e=this.getLastProgramApplied(),i=this._projectionMatrix,r=e.getUniformsCache()[i.getName()];r&&(i.setMatrix4(t),i.apply(this.getGraphicContext(),r))}},getCurrentShaderGeneratorStateSet:function(t){var e=this._programAttribute,i=t._attributeArray[this._programType];if(!(0!==e._length&&e._back.value!==o.Z.OFF||i&&i.getValue()!==o.Z.OFF)){var r,n=t.getShaderGeneratorPair(),a=this._shaderGeneratorNames;if(n){var s=n.getValue(),h=n.getShaderGeneratorName();r=this._evaluateOverrideObjectOnStack(this._shaderGeneratorNames,h,s)}else a._length&&(r=a._back.object);var u=r;return this._shaderGeneratorProxy.getShaderGenerator(u)}},_applyAttributeMapStateSet:function(t,e){for(var i=0,r=t.length>e.length?t.length:e.length;i<r;i++){var n,a=i,s=a<t.length?t[a]:void 0,o=a<e.length?e[a]:void 0,h=!!s,u=h&&s._changed;if(o||u){var c=o?o.getAttribute():void 0;if(h)if(c){var l=o.getValue();(n=this._evaluateOverrideObjectOnStack(s,c,l))!==c?s._changed&&(this._applyAttributeStack(n,s),s._changed=!1):this._applyAttributeStack(n,s)&&(s._changed=!0)}else s._length?(s._changed=!1,this._applyAttributeStack(s._back.object,s)):(s._changed=!1,this._applyAttributeStack(s._globalDefault,s));else(s=this._createAttributeStack(t,a,c.cloneType()))._changed=!0,this._applyAttributeStack(c,s)}}},_applyTextureAttributeMapListStateSet:function(t,e){for(var i,r,n,a=0;a<16;a++){var s=a;i=s<t.length?t[s]:void 0;var o=s<e.length?e[s]:void 0;if(i||o){r=n=0,i?(n=i.length,o&&(r=o.length)):(i=this.getOrCreateTextureAttributeArray(s),r=o.length);for(var h=n>r?n:r,u=0;u<h;u++){var c,l=u,_=l<n?i[l]:void 0,d=o&&l<o.length?o[l]:void 0,f=!!_,p=f&&_._changed;if(d||p){var g=d?d.getAttribute():void 0;if(f)if(g){var m=d.getValue();(c=this._evaluateOverrideObjectOnStack(_,g,m))!==g?_._changed&&(this._applyTextureAttribute(s,c,_),_._changed=!1):this._applyTextureAttribute(s,c,_)&&(_._changed=!0)}else _._length?(_._changed=!1,this._applyTextureAttribute(s,_._back.object,_)):(_._changed=!1,this._applyTextureAttribute(s,_._globalDefault,_));else c=d.getAttribute(),(_=this._createAttributeStack(i,l,c.cloneType()))._changed=!0,this._applyTextureAttribute(s,c,_)}}}}},applyStateSet:function(t){this._numApply++;var e,i=this.getLastProgramApplied();if(this._currentShaderGenerator=this.getCurrentShaderGeneratorStateSet(t),this._applyAttributeMapStateSet(this._attributeArray,t._attributeArray),this._applyTextureAttributeMapListStateSet(this._textureAttributeArrayList,t._textureAttributeArrayList),this._currentShaderGenerator){var r=this._currentShaderGenerator.getOrCreateProgram(this);this.applyAttribute(r),e=r,this._applyGeneratedProgramUniforms(r,t)}else e=this.getLastProgramApplied(),this._applyCustomProgramUniforms(e,t);i!==e&&(this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0)},popAllStateSets:popStateSet:function(){if(this._stateSets._length){var t=this._stateSets.pop();this.popAttributeMap(this._attributeArray,t._attributeArray,t._activeAttribute);for(var e=t._textureAttributeArrayList,i=t._activeTextureAttributeUnit,r=t._activeTextureAttribute,n=0,a=i.length;n<a;n++){var s=i[n],o=e[s],h=this._textureAttributeArrayList[s];this.popAttributeMap(h,o,r)}t.hasUniform()&&this.popUniformsList(this._uniforms,t.getUniformList()),t.getShaderGeneratorPair()&&this._shaderGeneratorNames.pop()}},_createAttributeStack:function(t,e,i){l.Z.arrayDense(e,t);var r=new u.Z;return r._globalDefault=i,t[e]=r,r},haveAppliedAttribute:function(t){if(t){var e=this._attributeArray,i=l.Z.getOrCreateStateAttributeTypeMemberIndex(t),r=i<e.length?e[i]:void 0;r||(r=this._createAttributeStack(e,i,t.cloneType())),r._lastApplied=t,r._changed=!0}},applyAttribute:function(t){var e=l.Z.getOrCreateStateAttributeTypeMemberIndex(t),i=this._attributeArray,r=e<i.length?i[e]:void 0;r||(r=this._createAttributeStack(i,e,t.cloneType())),r._changed=!0,this._applyAttributeStack(t,r)},_applyAttributeStack:function(t,e){return e._lastApplied!==t&&(t.apply&&t.apply(this),e._lastApplied=t,!0)},_applyTextureAttribute:function(t,e,i){if(i._lastApplied===e)return!1;if(i._lastApplied=e,!e.apply)return!0;var r=this.getGraphicContext();return r.activeTexture(r.TEXTURE0+t),e.apply(this,t),!0},applyTextureAttribute:function(t,e){var i=l.Z.getOrCreateTextureStateAttributeTypeMemberIndex(e),r=this.getOrCreateTextureAttributeArray(t),n=r[i];n||(n=this._createAttributeStack(r,i,e.cloneType())),n._changed=!0,this._applyTextureAttribute(t,e,n)},getLastProgramApplied:applyDefault:function(){this.popAllStateSets(),this._currentShaderGenerator=void 0,this.applyAttributeMap(this._attributeArray),this.applyTextureAttributeMapList(this._textureAttributeArrayList)},applyAttributeMap:function(t){for(var e,i=0,r=t.length;i<r;i++){var n;if(e=t[i])n=e._length?e._back.object:e._globalDefault,e._changed&&(e._lastApplied!==n&&(n.apply&&n.apply(this),e._lastApplied=n),e._changed=!1)}},pushUniformsList:function(t,e){var i,r;for(var n in e){var a=e[n];t[i=(r=a.getUniform()).getName()]||this._createAttributeStack(t,i,r),this.pushCheckOverride(t[i],r,a.getValue())}},popUniformsList:function(t,e){for(var i in e)t[i].pop()},applyTextureAttributeMapList:function(t){for(var e,i=this._graphicContext,r=0,n=t.length;r<n;r++)if(e=t[r])for(var a=0,s=e.length;a<s;a++){var o,h=e[a];if(h)o=h._length?h._back.object:h._globalDefault,h._changed&&(h._lastApplied!==o&&(i.activeTexture(i.TEXTURE0+r),o.apply(this,r),h._lastApplied=o),h._changed=!1)}},setGlobalDefaultAttribute:function(t){var e=l.Z.getOrCreateStateAttributeTypeMemberIndex(t);e>=this._attributeArray.length||!this._attributeArray[e]?this._createAttributeStack(this._attributeArray,e,t):this._attributeArray[e]._globalDefault=t},getGlobalDefaultAttribute:function(t){var e=this._attributeArray,i=l.Z.getIdFromTypeMember(t);if(!(void 0===i||i>=e.length))return e[i]?e[i]._globalDefault:void 0},setGlobalDefaultTextureAttribute:function(t,e){var i=this.getOrCreateTextureAttributeArray(t),r=l.Z.getOrCreateTextureStateAttributeTypeMemberIndex(e);r>=i.length||!i[r]?this._createAttributeStack(i,r,e):i[r]._globalDefault=e},getGlobalDefaultTextureAttribute:function(t,e){var i=this.getOrCreateTextureAttributeArray(t),r=l.Z.getTextureIdFromTypeMember(e);if(!(void 0===r||r>=i.length))return i[r]?i[r]._globalDefault:void 0},getOrCreateTextureAttributeArray:function(t){return l.Z.arrayDense(t,this._textureAttributeArrayList),this._textureAttributeArrayList[t]||(this._textureAttributeArrayList[t]=[]),this._textureAttributeArrayList[t]},pushAttributeMap:function(t,e,i){for(var r,n=e.length,a=t.length,s=0,o=i.length;s<o;s++){var h=i[s],u=h<n?e[h]:void 0,c=u.getAttribute();(r=h<a?t[h]:void 0)||(r=this._createAttributeStack(t,h,c.cloneType())),this.pushCheckOverride(r,c,u.getValue()),r._changed=!0}},popAttributeMap:function(t,e,i){for(var r=0,n=i.length;r<n;r++){var a=t[i[r]];a.pop(),a._changed=!0}},setIndexArray:function(t){var e=this._graphicContext;this._currentIndexVBO!==t&&(t.bind(e),this._currentIndexVBO=t),t.isDirty()&&t.compile(e)},lazyDisablingOfVertexAttributes:function(){for(var t=this._vertexAttribMap._keys,e=0,i=t.length;e<i;e++){var r=t[e];this._vertexAttribMap[r]&&(this._vertexAttribMap._disable[r]=!0)}},enableVertexColor:function(){var t=this._programAttribute._lastApplied;if(t.getUniformsCache().uArrayColorEnabled&&t.getAttributesCache().Color){var e=this._uniforms.ArrayColorEnabled._globalDefault;this._previousColorAttribPair[t.getInstanceID()]||(e.setFloat(1),e.apply(this.getGraphicContext(),t.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!0)}},disableVertexColor:function(){var t=this._programAttribute._lastApplied;if(t.getUniformsCache().uArrayColorEnabled&&t.getAttributesCache().Color){var e=this._uniforms.ArrayColorEnabled._globalDefault;this._previousColorAttribPair[t.getInstanceID()]&&(e.setFloat(0),e.apply(this.getGraphicContext(),t.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!1)}},applyDisablingOfVertexAttributes:function(){for(var t=this._vertexAttribMap._keys,e=0,i=t.length;e<i;e++)if(!0===this._vertexAttribMap._disable[t[e]]){var r=t[e];this._graphicContext.disableVertexAttribArray(r),this._vertexAttribMap._disable[r]=!1,this._vertexAttribMap[r]=!1}},clearVertexAttribCache:function(){for(var t=this._vertexAttribMap,e=t._keys,i=0,r=e.length;i<r;i++){var n=e[i];t[n]=void 0,t._disable[n]=!1}this._vertexAttribMap._disable.length=0,this._vertexAttribMap._keys.length=0},setVertexArrayObject:function(t){return this._currentVAO!==t&&(this._currentVAO=t,t?t.bind(this._graphicContext):(this._graphicContext.bindVertexArray(null),this.clearVertexAttribCache()),this._currentIndexVBO=void 0,!0)},setVertexAttribArray:function(t,e){var i=this._vertexAttribMap;i._disable[t]=!1;var r=this._graphicContext,n=!1;e.isDirty()&&(e.bind(r),e.compile(r),n=!0);var a=i[t];a!==e&&(n||e.bind(r),a||(r.enableVertexAttribArray(t),void 0===a&&i._keys.push(t)),i[t]=e,r.vertexAttribPointer(t,e.getGlItemSize(),e.getGlType(),e.getGlNormalize(),0,0))},_getActiveUniformsFromProgramAttributes:function(t,e){var i=this._attributeArray,r=t.getTrackAttributes().attributeKeys;if(r.length>0)for(var n=0,a=r.length;n<a;n++){var s=r[n],o=i[this.typeMember[s]];if(o){var h=o._globalDefault;if(h.getOrCreateUniforms){var u=h.getOrCreateUniforms();for(var c in u)e.push(u[c])}}}},_getActiveUniformsFromProgramTextureAttributes:function(t,e){var i=t.getTrackAttributes().textureAttributeKeys;if(i)for(var r=0,n=i.length;r<n;r++){var a=i[r];if(a){var s=this._textureAttributeArrayList[r];if(s)for(var o=0,h=a.length;o<h;o++){var u=s[a[o]];if(u){var c=u._globalDefault;if(c.getOrCreateUniforms){var l=c.getOrCreateUniforms();for(var _ in l)e.push(l[_])}}}}}},_cacheUniformsForCustomProgram:function(t,e){this._getActiveUniformsFromProgramAttributes(t,e),this._getActiveUniformsFromProgramTextureAttributes(t,e);for(var i=this._graphicContext,r={},n=0,a=e.length;n<a;n++){var s=e[n],o=s.getName(),h=i.getUniformLocation(t._program,o);null!=h&&(r[o]=s)}t.trackUniforms=r},_applyCustomProgramUniforms:(v=[],function(t,e){v.length=0,void 0!==t.getTrackAttributes()&&void 0===t.trackUniforms&&this._cacheUniformsForCustomProgram(t,v);var i,r,n=t.getUniformsCache(),a=this._uniforms;for(var s in t.trackUniforms&&(i=t.trackUniforms),n){var o=n[s],h=a[s],u=e&&e.uniforms[s];if(h||u)if(u){var c=e.uniforms[s],l=c.getValue(),_=c.getUniform();r=h?this._evaluateOverrideObjectOnStack(h,_,l):_}else r=h._length?h._back.object:h._globalDefault;else{if(void 0===i){this._checkErrorUniform(s);continue}r=i[s]}r.apply(this._graphicContext,o)}}),_checkErrorUniform:function(t){var e=t.substr(7);this._textureAttributeArrayList[e]&&t==="Texture"+e||this._excludeUniforms[t]||(this._excludeUniforms[t]=1,n.Z.error("Uniform not in the scene hierarchy : "+t))},_computeForeignUniforms:function(t,e){var i=[];for(var r in t){void 0!==t[r]&&void 0===e[r]&&(this._excludeUniforms[r]||i.push(r))}return i},_removeUniformsNotRequiredByProgram:function(t,e){if(e)for(var i in t){var r=e[i];null==r&&delete t[i]}},_cacheUniformsForGeneratedProgram:function(t){var e=t.getUniformsCache(),i=t.getActiveUniforms(),r=this._computeForeignUniforms(e,i);t.setForeignUniforms(r),this._removeUniformsNotRequiredByProgram(i,e)},_copyUniformEntry:function(t){var e,i=t.getInternalArray();return i.length<16&&(e=new i.constructor(i.length)),e},_initUniformCache:function(t){var e,i,r,n,a,s=t.getActiveUniforms(),o=t.getForeignUniforms(),h=this._uniforms,u=[],c=[];if(t._cacheUniformId=this._cacheUniformId++,this._programUniformCache[t._cacheUniformId]={},o.length)for(r=u,e=0,i=o.length;e<i;e++){var l=h[o[e]];l&&(a=l._globalDefault,n=this._copyUniformEntry(a),r.push(n))}for(var _ in s)a=s[_],n=this._copyUniformEntry(a),c.push(n);this._programUniformCache[t._cacheUniformId].foreign=u,this._programUniformCache[t._cacheUniformId].active=c},_checkCacheAndApplyUniform:function(t,e,i,r,n){var a,s=t.getInternalArray(),o=s.length;if(o<=4){var h=e[i];a=T[o](s,h)}else a=!1;if(!a){var u=r[n];t.apply(this._graphicContext,u)}},_applyGeneratedProgramUniforms:function(t,e){var i,r,n,a,s=this._uniforms,o=t.getForeignUniforms();if(!o){if(this._cacheUniformsForGeneratedProgram(t),o=t.getForeignUniforms(),e){var h=e.uniforms;for(a=0;a<o.length;a++)s[r=o[a]]||h[r]&&(i=h[r].getUniform(),this._createAttributeStack(s,r,i))}this._initUniformCache(t)}var u=t.getUniformsCache(),c=t.getActiveUniforms(),l=this._programUniformCache[t._cacheUniformId].active,_=this._programUniformCache[t._cacheUniformId].foreign,d=0;for(var f in c)i=c[f],this._checkCacheAndApplyUniform(i,l,d,u,f),d++;d=0;var p=o.length;for(a=0;a<p;a++){n=s[r=o[a]];var g=e&&e.uniforms[r];if(g||n){if(g){var m=e.uniforms[r],v=m.getValue(),b=m.getUniform();i=this._evaluateOverrideObjectOnStack(n,b,v)}else n._length?i=n._back.object:(i=n._globalDefault,this._checkErrorUniform(r));this._checkCacheAndApplyUniform(i,_,d,u,r),d++}else this._checkErrorUniform(r)}},_setStateSetsDrawID:function(t){for(var e=this._stateSets.getArray(),i=0,r=this._stateSets.length;i<r;i++)e[i].setDrawID(t)},_stateSetStackChanged:function(t,e){var i=this._stateSets.getArray(),r=this._stateSets.length;if(e!==r)return!0;for(var n=0;n<r;n++)if(t!==i[n].getDrawID())return!0;return!1}}),"osg","State");const E=x},WWMP:(t,e,i)=>{"use strict";i.d(e,{Z:);var r=i("GoyH"),n=i("iUVs"),a=r.Z.createPrototypeStateAttribute(a,r.Z.objectInherit(n.Z.prototype,{_attributeTypeIndex:void 0,getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(){},getHash:function(){return this.getType()}}),"osg","StateAttribute"),a.OFF=0,a.ON=1,a.OVERRIDE=2,a.PROTECTED=4,a.INHERIT=8,a.OVERRIDE_ON=a.OVERRIDE|a.ON;const s=a},nRYw:(t,e,i)=>{"use strict";i.d(e,{Z:()=>c});var r,n,a=i("GoyH"),s=i("bDLW"),o=i("gjC8"),h=i("cyFB"),u=function(){this._depth=0,this._children=new o.Z,this._leafs=new s.Z,this._stateset=void 0,this._parent=void 0};u.pooledStateGraph=new h.Z((function(){return new u})),u.statsNbMoveStateGraph=0,u.reset=a.Z.createPrototypeObject(u,{clean:function(){this._leafs.reset(),this._children.reset(),this._depth=0,this._stateset=void 0,this._parent=void 0},getStateSet:function(){return this._stateset},getLeafs:function(){return this._leafs},getParent:function(){return this._parent},findOrInsert:function(t){var e=t.getInstanceID(),i=this._children.getMap()[e];return i||((i=u.pooledStateGraph.getOrCreateObject()).clean(),i._parent=this,i._depth=this._depth+1,i._stateset=t,this._children.set(e,i)),i}},"osg","StateGraph"),u.moveStateGraph=(r=new s.Z,n=r.getArray(),function(t,e,i){u.statsNbMoveStateGraph++,r.reset();var a,s,o=i,h=e;if(o!==h&&void 0!==o)if(void 0!==h){if(h._parent===o._parent)return void 0!==h._stateset&&t.popStateSet(),void(void 0!==o._stateset&&t.pushStateSet(o._stateset));for(;h._depth>o._depth;)void 0!==h._stateset&&t.popStateSet(),h=h._parent;for(r.reset();o._depth>h._depth;)void 0!==o._stateset&&r.push(o._stateset),o=o._parent;for(;h!==o;)void 0!==h._stateset&&t.popStateSet(),h=h._parent,void 0!==o._stateset&&r.push(o._stateset),o=o._parent;for(a=r._length-1,s=0;a>=s;--a)t.pushStateSet(n[a])}else{do{void 0!==o._stateset&&r.push(o._stateset),o=o._parent}while(o);for(a=r._length-1,s=0;a>=s;--a)t.pushStateSet(n[a])}});const c=u},o4nZ:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=i("iUVs"),n=i("WWMP"),a=i("GoyH"),s=function(){r.Z.call(this),this._parents=[],this._attributeArray=[],this._textureAttributeArrayList=[],this._activeTextureAttributeUnit=[],this._activeAttribute=[],this._activeTextureAttribute=[],this._binName=void 0,this._binNumber=0,this._shaderGeneratorPair=null,this._updateCallbackList=[],this.uniforms={},this._hasUniform=!1,this._drawID=-1};(s.AttributePair=function(t,e){this._object=t,this._value=e}).prototype={getShaderGeneratorName:function(){return this._object},getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},a.Z.createPrototypeObject(s,a.Z.objectInherit(r.Z.prototype,{setDrawID:function(t){this._drawID=t},getDrawID:function(){return this._drawID},getAttributePair:addUniform:function(t,e){var i=void 0!==e?e:n.Z.ON,r=t.getName();this.uniforms[r]=this.getAttributePair(t,i),this._hasUniform=!0},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);-1!==e&&this._parents.splice(e,1)},removeUniform:removeUniformByName:function(t){delete this.uniforms[t],this._hasUniform=!!window.Object.keys(this.uniforms).length},hasUniform:function(){return this._hasUniform},getUniform:function(t){var e=this.uniforms;if(e[t])return e[t].getAttribute()},getUniformList:function(){return this.uniforms},setTextureAttributeAndModes:function(t,e,i){this._setTextureAttribute(t,this.getAttributePair(e,void 0!==i?i:n.Z.ON))},getNumTextureAttributeLists:function(){return this._textureAttributeArrayList.length},getTextureAttribute:function(t,e){var i=a.Z.getTextureIdFromTypeMember(e);if(void 0!==i&&this._hasTextureAttribute(t,i)){var r=this._textureAttributeArrayList[t];return r[i]?r[i].getAttribute():void 0}},removeTextureAttribute:function(t,e){var i=a.Z.getTextureIdFromTypeMember(e);void 0!==i&&this._hasTextureAttribute(t,i)&&(this._textureAttributeArrayList[t][i]=void 0,this._computeValidTextureUnit())},getAttribute:function(t){var e=a.Z.getIdFromTypeMember(t);if(void 0!==e&&this._hasAttribute(e))return this._attributeArray[e].getAttribute()},setAttributeAndModes:function(t,e){this._setAttribute(this.getAttributePair(t,void 0!==e?e:n.Z.ON))},setAttribute:removeAttribute:function(t){var e=a.Z.getIdFromTypeMember(t);this._hasAttribute(e)&&(this._attributeArray[e]=void 0,this._computeValidAttribute())},setRenderingHint:function(t){"OPAQUE_BIN"===t?this.setRenderBinDetails(0,"RenderBin"):"TRANSPARENT_BIN"===t?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},getUpdateCallbackList:function(){return this._updateCallbackList},removeUpdateCallback:function(t){var e=this._updateCallbackList.indexOf(t);if(-1!==e&&(this._updateCallbackList.splice(e,1),0===this._updateCallbackList.length))for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()-1)}},requiresUpdateTraversal:addUpdateCallback:function(t){var e=Boolean(this._updateCallbackList.length);if(this._updateCallbackList.push(t),!e)for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()+1)}},hasUpdateCallback:function(t){return-1!==this._updateCallbackList.indexOf(t)},setRenderBinDetails:function(t,e){this._binNumber=t,this._binName=e},getAttributeMap:function(){for(var t={},e=0,i=this._attributeArray.length;e<i;e++){var r=this._attributeArray[e];if(r)t[r.getAttribute().getTypeMember()]=r}return t},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(t){this._binNumber=t},setBinName:function(t){this._binName=t},getAttributeList:function(){for(var t=this._attributeArray,e=[],i=0,r=t.length;i<r;i++)t[i]&&e.push(t[i]);return e},setShaderGeneratorName:function(t,e){this._shaderGeneratorPair=this.getAttributePair(t,void 0!==e?e:n.Z.ON)},getShaderGeneratorPair:function(){return this._shaderGeneratorPair},getShaderGeneratorName:releaseGLObjects:function(){for(var t=0,e=this._textureAttributeArrayList.length;t<e;t++){var i=this.getTextureAttribute(t,"Texture");i&&i.releaseGLObjects()}for(var r=this.getAttributeList(),n=0,a=r.length;n<a;n++)r[n]._object.releaseGLObjects&&r[n]._object.releaseGLObjects()},_setTextureAttribute:function(t,e){a.Z.arrayDense(t,this._textureAttributeArrayList),this._textureAttributeArrayList[t]||(this._textureAttributeArrayList[t]=[]);var i=a.Z.getOrCreateTextureStateAttributeTypeMemberIndex(e.getAttribute());a.Z.arrayDense(i,this._textureAttributeArrayList[t]),this._textureAttributeArrayList[t][i]=e,this._computeValidTextureUnit()},_computeValidTextureUnit:function(){this._activeTextureAttributeUnit.length=0,this._activeTextureAttribute.length=0;for(var t=this._textureAttributeArrayList,e=0,i=t.length;e<i;e++){var r=t[e];if(r&&r.length){for(var n=!1,a=0,s=r.length;a<s;a++)r[a]&&(n=!0,-1===this._activeTextureAttribute.indexOf(a)&&this._activeTextureAttribute.push(a));n&&this._activeTextureAttributeUnit.push(e)}}},_computeValidAttribute:function(){this._activeAttribute.length=0;for(var t=this._attributeArray,e=0,i=t.length;e<i;e++)t[e]&&this._activeAttribute.push(e)},_setAttribute:function(t){var e=a.Z.getOrCreateStateAttributeTypeMemberIndex(t.getAttribute());a.Z.arrayDense(e,this._attributeArray),this._attributeArray[e]=t,this._computeValidAttribute()},_hasAttribute:function(t){return!(t>=this._attributeArray.length)&&!!this._attributeArray[t]},_hasTextureAttribute:function(t,e){return!(t>=this._textureAttributeArrayList.length||!this._textureAttributeArrayList[t])&&(!(e>=this._textureAttributeArrayList[t].length)&&!!this._textureAttributeArrayList[t][e])}}),"osg","StateSet");const o=s},YVjV:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=i("GoyH"),n=i("IpZ9"),a=i("CJNH"),s=r.Z.createPrototypeNode(s,r.Z.objectInherit(n.Z.prototype,{addChild:function(t,e){return n.Z.prototype.addChild.call(this,t),void 0===e&&(e=!0),this.children.length>this._values.length?this._values.push(e):this._values[this.children.length-1]=e,!0},setValue:function(t,e){t<this._values.length&&(this._values[t]=e)},getValue:function(t){if(t<this._values.length)return this._values[t]},setAllChildrenOff:function(){for(var t=0;t<this._values.length;++t)this._values[t]=!1},setAllChildrenOn:traverse:function(t){switch(t.traversalMode){case a.Z.TRAVERSE_ALL_CHILDREN:for(var e=0;e<this.children.length;++e)this.children[e].accept(t);break;case a.Z.TRAVERSE_ACTIVE_CHILDREN:var i=this.children.length;for(this._values.length<i&&(i=this._values.length),e=0;e<i;++e)!0===this._values[e]&&this.children[e].accept(t)}}}),"osg","Switch");const o=s},"5rJd":(t,e,i)=>{"use strict";i.d(e,{Z:()=>w});var r=i("u5PS"),n=i("GoyH"),a=i("WWMP"),s=i("64xh"),o=i("/CZr"),h=i("6qT5"),u=function(t,e,i,r){this._target=t,this._internalFormat=e,this._width=i,this._height=r,this._size=0,this.computeSize()};u.prototype={match:computeSize:function(){var t=i("5rJd").Z,e=0;switch(this._internalFormat){case 1:case t.ALPHA:case t.LUMINANCE:e=8;break;case t.LUMINANCE_ALPHA:case 2:e=16;break;case t.RGB:case 3:e=24;break;case t.RGBA:case 4:e=32}var r=Math.ceil(this._width*this._height*e)/8;this._target===t.TEXTURE_CUBE_MAP&&(r*=6),r+=r/3,this._size=r},getSize:function(){return this._size}},u.getHash=function(){var t=Array.prototype.slice.call(arguments),e="";return t.forEach((),e};var c=function(t,e,i){this._texture=t,this._id=e,this._textureSet=i};c.prototype={target:id:function(){return this._id},getTextureSet:function(){return this._textureSet},reset:bind:;var l=l.prototype={getProfile:function(){return this._profile},getUsedTextureObjects:function(){return this._usedTextureObjects},getOrphanedTextureObjects:function(){return this._orphanedTextureObjects},takeOrGenerate:function(t,e){var i;if(this._orphanedTextureObjects.length>0)return(i=this.takeFromOrphans())._texture=e,this._usedTextureObjects.push(i),i;var r=t.createTexture();return i=new c(e,r,this),this._usedTextureObjects.push(i),i},takeFromOrphans:orphan:function(t){var e=this._usedTextureObjects.indexOf(t);-1!==e&&(this._orphanedTextureObjects.push(this._usedTextureObjects[e]),this._usedTextureObjects.splice(e,1))},flushDeletedTextureObjects:function(t,e){if(e<=0)return e;var i,r=this._orphanedTextureObjects.length,n=0,a=h.Z.instance().tick();for(i=0;i<r&&n<e;i++)t.deleteTexture(this._orphanedTextureObjects[i].id()),this._orphanedTextureObjects[i].reset(),n=h.Z.instance().deltaS(a,h.Z.instance().tick());return this._orphanedTextureObjects.splice(0,i),e-n},flushAllDeletedTextureObjects:function(t){for(var e=this._orphanedTextureObjects.length,i=this.getProfile().getSize(),n=0,a=e;n<a;++n)t.deleteTexture(this._orphanedTextureObjects[n].id()),this._orphanedTextureObjects[n].reset();this._orphanedTextureObjects.length=0,r.Z.info("TextureManager: released "+e+" with "+e*i/1048576+" MB")},onLostContext:function(){var t,e;for(e=this._orphanedTextureObjects.length,t=0;t<e;++t)this._orphanedTextureObjects[t].reset();for(this._orphanedTextureObjects.length=0,e=this._usedTextureObjects.length,t=0;t<e;++t)this._usedTextureObjects[t].reset();this._usedTextureObjects.length=0}};var _=function(){this._textureSetMap={}};_.prototype={generateTextureObject:function(t,e,i,r,n,a){var s=u.getHash(i,r,n,a);return void 0===this._textureSetMap[s]&&(this._textureSetMap[s]=new l(new u(i,r,n,a))),this._textureSetMap[s].takeOrGenerate(t,e)},updateStats:function(t){var e=0,i=0;for(var r in this._textureSetMap){var n=this._textureSetMap[r].getProfile().getSize();e+=this._textureSetMap[r].getUsedTextureObjects().length*n,i+=this._textureSetMap[r].getOrphanedTextureObjects().length*n}var a=1048576;t.getCounter("textureused").set(e/a),t.getCounter("texturereserved").set(i/a),t.getCounter("texturetotal").set((e+i)/a)},reportStats:function(){var t=0;for(var e in this._textureSetMap){var i=this._textureSetMap[e].getProfile(),n=i.getSize()/1048576,a=this._textureSetMap[e].getUsedTextureObjects().length;t+=n*=a,r.Z.notice(String(n)+" MB with "+a+" texture of "+i._width+"x"+i._height+" "+i._internalFormat)}r.Z.notice(String(t)+" MB in total")},flushAllDeletedTextureObjects:function(t){for(var e in this._textureSetMap)this._textureSetMap[e].flushAllDeletedTextureObjects(t)},onLostContext:flushDeletedTextureObjects:function(t,e){var i=e;for(var r in this._textureSetMap)if((i=this._textureSetMap[r].flushDeletedTextureObjects(t,i))<=0)break;return i},releaseTextureObject:;const d=_;var f=i("BvLe");function p(t,e,i){var r=t.createShader(e);return delete t.shaderSource,t.shaderSource(r,i),delete t.compileShader,t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.log("ERROR TP: "+t.getShaderInfoLog(r)),null)}var g=null,m=null,v=null,b=void 0;function S(t){if(g)return g;(g={}).isWebGL2RenderingContext=window.WebGL2RenderingContext&&t instanceof WebGL2RenderingContext;(g.isWebGL2RenderingContext||void 0!==t.createVertexArray)&&(b=t.createVertexArray(),t.bindVertexArray(b));var e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1]),t.STATIC_DRAW);var i=t.createProgram(),r=p(t,t.VERTEX_SHADER,"attribute vec2 aVertex;\nvarying highp vec2 vTextureCoord;\n\nvoid main(void) {\n\tgl_Position = vec4(aVertex,0.0,1.0);\n\tvTextureCoord = aVertex*0.5+0.5;\n}\n"),n=p(t,t.FRAGMENT_SHADER,"varying highp vec2 vTextureCoord;precision highp int;uniform sampler2D uT;uniform highp ivec2 uS;uniform bool uY;uniform int uO;int f(int i,int u){int y=i/u;return i-y*u;}int i(int i,int t){if(i<t)return i;return t;}int u(int i,int u){if(i<u)return u;return i;}int f(int y,int t,int f){int x=i(y,t),n=u(y,t);if(f<x)return f*(f+1)/2;if(f<n)return x*(x+1)/2+x*(f-x);int r=f-n;return x*(x+1)/2+x*(n-x)+(x-1)*r-(r-1)*r/2;}int i(int y,int t,ivec2 x){int r=i(y,t),n=u(y,t),v=x.x+x.y;bool h=f(v,2)==0;if(v<r){if(h)return f(y,t,v)+v-x.y;return f(y,t,v)+x.y;}if(v<n){int s=t-x.y-1;if(y<t)s=r-(y-x.x);if(h)return f(y,t,v)+s;return f(y,t,v)+r-s-1;}int s=t-x.y-1,e=r+n-v-1;if(h)return f(y,t,v)+s;return f(y,t,v)+e-s-1;}ivec2 u(int y,int t,int x){int v=i(y,t),r=u(y,t);if(x<v*(v+1)/2){int n=(-1+int(1e-6+sqrt(float(8*x+1))))/2,h=x-f(y,t,n);bool s=f(n,2)==0;if(s)return ivec2(h,n-h);return ivec2(n-h,h);}if(x<v*(v+1)/2+v*(r-v)){x=x-v*(v+1)/2;int n=v+x/v,s=f(x,v);bool h=f(n,2)==0;int g=n-v+s+1,e=v-s-1,S=n-s,T=s;if(y>t){if(h)return ivec2(g,e);return ivec2(S,T);}if(h)return ivec2(T,S);return ivec2(e,g);}int n=v*(v-1)/2-(x-(v*(v+1)/2+v*(r-v)))-1,s=(-1+int(sqrt(float(8*n+1))))/2;n=r+v-s-2;int h=x-f(y,t,n);bool g=f(n,2)==0;int e=v+r-n-1;if(g)h=e-h-1;int S=n+h-y+1;return ivec2(n-S,S);}int f(ivec2 v){int y=uS.x/8,t=uS.y/8,x=i(y,t,ivec2(v.x/8,v.y/8)),n=f(x,4);v.x=f(v.x,8);v.y=f(v.y,8);ivec2 r=v;if(n==1)r.x=7-v.x;if(n==2)r.x=v.y,r.y=v.x;if(n==3)r.x=7-v.y,r.y=v.x;return x*64+r.x+r.y*8;}ivec2 i(int i){int x=uS.x,t=uS.y,v=x*t;if(i<0)i+=v;i=f(i,v);int y=x/8,n=t/8,h=i/64,r=i-h*64,s=r/8,S=r-s*8,e=f(h,4);ivec2 g=u(y,n,h),T=g*8;if(e==0)T.x+=S,T.y+=s;if(e==1)T.x+=7-S,T.y+=s;if(e==2)T.x+=s,T.y+=S;if(e==3)T.x+=s,T.y+=7-S;return T;}int t(ivec2 y,int i){int v=uS.x*uS.y,n=f(y)+i;if(n>v)n-=v;if(n<0)n+=v;if(n>v)return-1;if(n<0)return-2;return n;}void main(){ivec2 y=ivec2(gl_FragCoord);if(uY)y.y=uS.y-y.y-1;if(uO==-1){gl_FragColor=texture2D(uT,vec2(y)/vec2(uS));return;}int n=t(y,uO);if(n>=0)y=i(n),gl_FragColor=texture2D(uT,(vec2(y)+.5)/vec2(uS));else gl_FragColor=vec4(1.,0.,0.,1.);}");if(null===r||null===n)return null;if(t.attachShader(i,r),t.attachShader(i,n),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))return null;t.useProgram(i);var a={attribLocations:{vertex:t.getAttribLocation(i,"aVertex")},uniformLocations:{uSampler:t.getUniformLocation(i,"uT"),uSize:t.getUniformLocation(i,"uS"),uOffset:t.getUniformLocation(i,"uO"),uYFlipped:t.getUniformLocation(i,"uY")}};if(void 0!==b){var s=t.FLOAT;t.vertexAttribPointer(a.attribLocations.vertex,2,s,!1,0,0),t.enableVertexAttribArray(a.attribLocations.vertex)}return g.prepare=function(r,n,s,o,h,u,c,l){if(t.useProgram(i),t.activeTexture(h),t.bindTexture(t.TEXTURE_2D,n),t.uniform1i(a.uniformLocations.uOffset,o?-1:r),t.uniform1i(a.uniformLocations.uSampler,h-t.TEXTURE0),t.uniform1i(a.uniformLocations.uYFlipped,s),t.uniform2i(a.uniformLocations.uSize,c,l),void 0!==b)t.bindVertexArray(b);else{var _=t.FLOAT;t.bindBuffer(t.ARRAY_BUFFER,e),t.vertexAttribPointer(a.attribLocations.vertex,2,_,!1,0,0),t.enableVertexAttribArray(a.attribLocations.vertex)}t.disable(t.BLEND),t.disable(t.DEPTH_TEST),t.disable(t.SCISSOR_TEST),t.depthMask(!1),t.colorMask(!0,!0,!0,!0)},g.renderInto=function(e,i,r){t.drawArrays(t.TRIANGLES,0,6)},g}const y=function(t,e,i,r,n,a){var s=t.getParameter(t.ARRAY_BUFFER_BINDING),o=t.getParameter(t.CURRENT_PROGRAM),h=t.getParameter(t.FRAMEBUFFER_BINDING),u=t.isEnabled(t.BLEND),c=t.isEnabled(t.DEPTH_TEST),l=t.getParameter(t.VIEWPORT),_=t.isEnabled(t.SCISSOR_TEST),d=_?t.getParameter(t.SCISSOR_BOX):void 0,f=t.getParameter(t.ACTIVE_TEXTURE);f||(f=t.TEXTURE0);var p=void 0;void 0!==t.bindVertexArray&&(p=t.getParameter(t.VERTEX_ARRAY_BINDING));var g=t.getParameter(t.DEPTH_WRITEMASK),b=t.getParameter(t.COLOR_WRITEMASK),y=t.isEnabled(t.CULL_FACE),T=t.getParameter(t.CULL_FACE_MODE);t.disable(t.CULL_FACE);var x=i[5],E=x.width,R=x.height,A=S(t);return null===A?null:(e*=64,e%=E*R,m=t.createFramebuffer(),t.bindTexture(i[0],n),t.texImage2D(i[0],0,t.RGBA,E,R,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindFramebuffer(t.FRAMEBUFFER,m),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0),t.viewport(0,0,E,R),v=t.createTexture(),t.bindTexture(t.TEXTURE_2D,v),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAX_LEVEL,0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r?t.compressedTexImage2D.apply(t,i):t.texImage2D.apply(t,i),t.getError()!=t.OUT_OF_MEMORY&&(A.prepare(-e,v,a,!1,f,n,E,R),A.renderInto(n,E,R,n,E,R),t.deleteTexture(v),v=void 0,t.deleteFramebuffer(m),m=void 0,t.bindFramebuffer(t.FRAMEBUFFER,h),t.bindBuffer(t.ARRAY_BUFFER,s),t.useProgram(o),l&&t.viewport(l[0],l[1],l[2],l[3]),_?(t.enable(t.SCISSOR_TEST),t.scissor(d[0],d[1],d[2],d[3])):t.disable(t.SCISSOR_TEST),u?t.enable(t.BLEND):t.disable(t.BLEND),c?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),void 0!==p?t.bindVertexArray(p):void 0!==t.bindVertexArray&&t.bindVertexArray(null),null!==g&&t.depthMask(g),null!==b&&t.colorMask(b[0],b[1],b[2],b[3]),y?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),null!==T&&t.cullFace(T),t.activeTexture(f),t.bindTexture(i[0],n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAX_LEVEL,1e3),!0))};var T=i("uHj6"),x=window.ImageBitmap||function(){},E=function(t){return 0!==t&&(t&1+~t)===t},R=function(){a.Z.call(this),o.Z.call(this),this.setDefaultParameters(),this._dirty=!0,this._dirtyMipmap=!0,this._applyTexImage2DCallbacks=[],this._textureObject=void 0,this._textureNull=!0},A=function(t,e){var i=R[t];return void 0===i?(r.Z.warn("bad Texture enum argument "+t+"\nfallback to "+e),e):i};R.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,R.UNPACK_FLIP_Y_WEBGL=37440,R.BROWSER_DEFAULT_WEBGL=37444,R.NONE=0,R.DEPTH_COMPONENT=6402,R.DEPTH_COMPONENT16=33189,R.DEPTH_STENCIL=34041,R.DEPTH24_STENCIL8=35056,R.DEPTH_COMPONENT24=33190,R.DEPTH_COMPONENT32F=36012,R.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,R.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,R.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,R.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,R.COMPRESSED_RGB_ATC_WEBGL=35986,R.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987,R.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798,R.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,R.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,R.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,R.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,R.COMPRESSED_RGB_ETC1_WEBGL=36196,R.LINEAR=9729,R.NEAREST=9728,R.NEAREST_MIPMAP_NEAREST=9984,R.LINEAR_MIPMAP_NEAREST=9985,R.NEAREST_MIPMAP_LINEAR=9986,R.LINEAR_MIPMAP_LINEAR=9987,R.TEXTURE_MAX_ANISOTROPY_EXT=34046,R.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047,R.CLAMP_TO_EDGE=33071,R.REPEAT=10497,R.MIRRORED_REPEAT=33648,R.TEXTURE_2D=3553,R.TEXTURE_CUBE_MAP=34067,R.TEXTURE_BINDING_CUBE_MAP=34068,R.TEXTURE_CUBE_MAP_POSITIVE_X=34069,R.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,R.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,R.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,R.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,R.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,R.MAX_CUBE_MAP_TEXTURE_SIZE=34076,R.UNSIGNED_BYTE=5121,R.UNSIGNED_SHORT=5123,R.UNSIGNED_SHORT_4_4_4_4=32819,R.UNSIGNED_SHORT_5_5_5_1=32820,R.UNSIGNED_SHORT_5_6_5=33635,R.FLOAT=5126,R.HALF_FLOAT_OES=36193,R.HALF_FLOAT=5131,R.UNSIGNED_INT_10F_11F_11F_REV=35899,R.UNSIGNED_INT_24_8=34042,R.ALPHA=6406,R.RGB=6407,R.RGBA=6408,R.LUMINANCE=6409,R.LUMINANCE_ALPHA=6410,R.RED_INTEGER=36244,R.RGB_INTEGER=36248,R.RGBA_INTEGER=36249,R.RG_INTEGER=33320,R.RED=6403,R.R8=33321,R.R8UI=33330,R.RG8=33323,R.RG8UI=33336,R.RGB8=36758,R.RGB565=36194,R.RGB9_E5=35901,R.RGB8UI=36221,R.RGBA8=32856,R.RGB5_A1=32855,R.RGBA4=32854,R.RGBA8UI=36220,R.SRGB8_ALPHA8=35907,R.SRGB8=35905,R.R16F=33325,R.RG16F=33327,R.RGB16F=34843,R.RGBA16F=34842,R.R11F_G11F_B10F=35898,R.R32F=33326,R.RG32F=33328,R.RGB32F=34837,R.RGBA32F=34836;var C,M=((C={})[R.R8]=R.LUMINANCE,C[R.R8UI]=R.LUMINANCE,C[R.R16F]=R.LUMINANCE,C[R.R32F]=R.LUMINANCE,C[R.SRGB8]=R.LUMINANCE,C[R.RG8]=R.RGB,C[R.RG8UI]=R.RGB,C[R.RG16F]=R.RGB,C[R.RG32F]=R.RGB,C[R.RGB8]=R.RGB,C[R.RGB565]=R.RGB,C[R.RGB9_E5]=R.RGB,C[R.RGB8UI]=R.RGB,C[R.RGB5_A1]=R.RGB,C[R.RGB16F]=R.RGB,C[R.RGB32F]=R.RGB,C[R.RGBA8]=R.RGBA,C[R.R11F_G11F_B10F]=R.RGBA,C[R.RGBA16F]=R.RGBA,C[R.RGBA32F]=R.RGBA,C[R.SRGB8_ALPHA8]=R.RGBA,C),I=function(){var t={},e={},i={},r={},n={},a={};return t[R.FLOAT]=e,t[R.HALF_FLOAT]=t[R.HALF_FLOAT_OES]=i,t[R.UNSIGNED_SHORT]=r,t[R.UNSIGNED_INT]=n,t[R.UNSIGNED_INT_24_8]=a,i[R.LUMINANCE]=R.R16F,i[R.RGB]=R.RGB16F,i[R.RGBA]=R.RGBA16F,e[R.LUMINANCE]=R.R32F,e[R.RGB]=R.RGB32F,e[R.RGBA]=R.RGBA32F,r[R.DEPTH_COMPONENT]=R.DEPTH_COMPONENT16,n[R.DEPTH_COMPONENT]=R.DEPTH_COMPONENT32F,a[R.DEPTH_STENCIL]=R.DEPTH24_STENCIL8,t}();R._sTextureManager=new window.Map,R.getTextureManager=function(t){return R._sTextureManager.has(t)||R._sTextureManager.set(t,new d),R._sTextureManager.get(t)},R.getEnumFromString=function(t){var e=t;return"string"==typeof e&&(e=A(e,t)),e},n.Z.createPrototypeStateAttribute(R,n.Z.objectInherit(o.Z.prototype,n.Z.objectInherit(a.Z.prototype,{attributeType:"Texture",cloneType:function(){return new R},invalidate:function(){this._textureObject=void 0,this.dirty()},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},isTextureNull:function(){return this._textureNull},getOrCreateUniforms:function(t){if(void 0===R.uniforms&&(R.uniforms=[]),void 0===R.uniforms[t]){var e=this.getType()+t;R.uniforms[t]={texture:s.Z.createInt1(t,e)}}return R.uniforms[t]},setDefaultParameters:function(){this._image=void 0,this._magFilter=R.LINEAR,this._minFilter=R.LINEAR,this._maxAnisotropy=1,this._wrapS=R.CLAMP_TO_EDGE,this._wrapT=R.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this._internalFormat=void 0,this._dirtyMipmap=!0,this._textureTarget=R.TEXTURE_2D,this.setInternalFormatType(R.UNSIGNED_BYTE),this._isCompressed=!1,this._flipY=!0,this._colorSpaceConversion=R.NONE},setColorSpaceConversion:function(t){this._colorSpaceConversion=t},setFlipY:function(t){this._flipY=t},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(t,e){var i=f.Z.instance().getWebGLParameter("MAX_TEXTURE_SIZE");t===this._textureWidth&&e===this._textureHeight||this.dirty(),void 0!==t&&(t>i?(r.Z.error("width ("+t+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureWidth=i):this._textureWidth=t),void 0!==e&&(e>i?(r.Z.error("height ("+e+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureHeight=i):this._textureHeight=e),this._textureNull=!1},init:function(t){this._gl||this.setGraphicContext(t.getGraphicContext()),this._textureObject||(this._textureObject=R.getTextureManager(this._gl).generateTextureObject(this._gl,this,this._textureTarget,this._internalFormat,this._textureWidth,this._textureHeight),this.dirty(),this._dirtyTextureObject=!1,this._textureNull=!1)},addApplyTexImage2DCallback:removeApplyTexImage2DCallback:getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(){void 0!==this._textureObject&&null!==this._textureObject&&void 0!==this._gl&&(R.getTextureManager(this._gl).releaseTextureObject(this._textureObject),o.Z.removeObject(this._gl,this)),this.invalidate()},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},setWrapS:function(t){this._wrapS="string"==typeof t?A(t,R.CLAMP_TO_EDGE):t,this.dirtyTextureParameters()},setWrapT:function(t){this._wrapT="string"==typeof t?A(t,R.CLAMP_TO_EDGE):t,this.dirtyTextureParameters()},dirtyTextureParameters:dirtyTextureObject:getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMaxAnisotropy:function(t){this._maxAnisotropy=t,this.dirtyTextureParameters()},getMaxAnisotropy:function(){return this._maxAnisotropy},setMinFilter:function(t){this._minFilter="string"==typeof t?A(t,R.LINEAR):t,this.dirtyTextureParameters()},setMagFilter:function(t){this._magFilter="string"==typeof t?A(t,R.LINEAR):t,this.dirtyTextureParameters()},setImage:function(t,e){var i=t;(t instanceof window.Image||t instanceof HTMLCanvasElement||t instanceof x||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Float32Array)&&(i=new T.Z(t)),this._image=i,this.setImageFormat(e),i&&(i.getWidth&&i.getHeight?this.setTextureSize(i.getWidth(),i.getHeight()):i.width&&i.height&&this.setTextureSize(i.width,i.height)),this._textureNull=!1,this.dirty()},getImage:function(){return this._image},setImageFormat:function(t){var e=t;e?("string"==typeof e&&(e=R[e]),this._imageFormat=e):this._imageFormat=R.RGBA},setInternalFormatType:getInternalFormatType:function(){return this._type},setUnrefImageDataAfterApply:function(t){this._unrefImageDataAfterApply=t},checkIsCompressed:function(t){switch(t||this._internalFormat){case R.COMPRESSED_RGB_S3TC_DXT1_EXT:case R.COMPRESSED_RGBA_S3TC_DXT1_EXT:case R.COMPRESSED_RGBA_S3TC_DXT3_EXT:case R.COMPRESSED_RGBA_S3TC_DXT5_EXT:case R.COMPRESSED_RGB_ATC_WEBGL:case R.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:case R.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:case R.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case R.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case R.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:case R.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:case R.COMPRESSED_RGB_ETC1_WEBGL:return!0;default:return!1}},setInternalFormat:function(t){var e=t;e?("string"==typeof e&&(e=R[e]),this._isCompressed=this.checkIsCompressed(e)):(this._isCompressed=!1,e=R.RGBA),this._internalFormat=e},getInternalFormat:function(){return this._internalFormat},isDirtyMipmap:function(){return this._dirtyMipmap},dirtyMipmap:function(){this._dirtyMipmap=!0},applyFilterParameter:function(t,e){f.Z.instance().isWebGL2()||(E(this._textureWidth)&&E(this._textureHeight)||(this._wrapT=R.CLAMP_TO_EDGE,this._wrapS=R.CLAMP_TO_EDGE,this._minFilter!==R.LINEAR_MIPMAP_LINEAR&&this._minFilter!==R.LINEAR_MIPMAP_NEAREST||(this._minFilter=R.LINEAR)));if(t.texParameteri(e,t.TEXTURE_MAG_FILTER,this._magFilter),t.texParameteri(e,t.TEXTURE_MIN_FILTER,this._minFilter),this._maxAnisotropy>1&&R.ANISOTROPIC_SUPPORT_EXT){var i=this._maxAnisotropy<R.ANISOTROPIC_SUPPORT_MAX?this._maxAnisotropy:R.ANISOTROPIC_SUPPORT_MAX;t.texParameterf(e,R.TEXTURE_MAX_ANISOTROPY_EXT,i)}t.texParameteri(e,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(e,t.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(t,e){if(this._dirtyMipmap=!1,this.hasMipmapFilter()){var i=this._image;if(i&&i.hasMipmap())for(var r=this._getInternalFormatGL(),n=i.getMipmap(),a=1,s=n.length;a<s;a++){var o=n[a];this._isCompressed?this.applyTexImage2D(t,this._textureTarget,a,r,o.getWidth(),o.getHeight(),0,o.getImage()):this.applyTexImage2D(t,this._textureTarget,a,r,o.getWidth(),o.getHeight(),0,this._internalFormat,this._type,o.getImage())}else t.generateMipmap(e)}},hasMipmapFilter:applyTexImage2D:function(t){var e=Array.prototype.slice.call(arguments,1),i=0;this._textureObject&&this._textureObject._texture&&this._textureObject._texture._textureTarget===t.TEXTURE_2D&&7===e.length&&(i=e.pop()),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._colorSpaceConversion);var r=null;if(i){var n=this._textureObject._id;r=y(t,i,e,this._isCompressed,n,this._flipY)}!0!==r&&(t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this._flipY),this._isCompressed?t.compressedTexImage2D.apply(t,e):t.texImage2D.apply(t,e));var a=this._applyTexImage2DCallbacks.length;if(a>0)for(var s=0,o=a;s<o;s++)this._applyTexImage2DCallbacks[s].call(this)},computeTextureFormat:function(){this._internalFormat||(this._internalFormat=this._imageFormat||R.RGBA),this._imageFormat=this._internalFormat},applyImage:function(t){var e=this._getInternalFormatGL(),i=this._image||null,r=i&&i.getImage(),n=this._getTypeGL();this._isCompressed?this.applyTexImage2D(t,this._textureTarget,0,e,this._textureWidth,this._textureHeight,0,r):!r||i.isTypedArray()?this.applyTexImage2D(t,this._textureTarget,0,e,this._textureWidth,this._textureHeight,0,this._internalFormat,n,r):this.applyTexImage2D(t,this._textureTarget,0,e,this._internalFormat,n,r,i.pk),i&&i.setDirty(!1)},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1,this.setGraphicContext(e)),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{var i=this._image;if(void 0!==i)if(i.isReady()){this.computeTextureFormat();var r=i.getWidth()||this._textureWidth,n=i.getHeight()||this._textureHeight;this.setTextureSize(r,n),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyImage(e),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0),this._dirty=!1}else e.bindTexture(this._textureTarget,null);else 0!==this._textureHeight&&0!==this._textureWidth&&(this.computeTextureFormat(),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyImage(e),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._dirty=!1)}else this._textureObject.bind(e),void 0!==this._image&&this._image.isDirty()&&(this.applyImage(e),this.dirtyMipmap()),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget)},_getInternalFormatGL:function(){var t=this._internalFormat;if(!f.Z.instance().isWebGL2())return M[t]||t;var e=I[this._type];return e&&e[t]||t},_getTypeGL:function(){return this._type!==R.HALF_FLOAT||f.Z.instance().isWebGL2()?this._type:R.HALF_FLOAT_OES}})),"osg","Texture"),R.textureNull=new R,R.createFromImage=R.createFromCanvas=const w=R},"6qT5":(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=function(){var t=window||global;if(void 0===t.performance)return function(){return Date.now()};var e=t.performance.now||t.performance.mozNow||t.performance.msNow||t.performance.oNow||t.performance.webkitNow||return (),n=function(){};n.instance=function(){return n._instance||(n._instance=new n),n._instance},n.tick=r,n.prototype={deltaS:deltaM:tick:;const a=n},cnke:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var r=i("u5PS"),n=i("BvLe"),a=a.FRAME_COUNT=0,a.instance=function(t,e){return a._instance?t&&(a._instance.getContext()!==t||e)&&(a._instance.setContext(t),a._instance.reset(t)):a._instance=new a(t),a._instance},a.prototype={reset:function(t){if(t){var e=n.Z.instance(t).getDisjointTimerQuery();if(!e)return this;if(t.getQueryParameter||(t.getQueryParameter=e.getQueryObjectEXT.bind(e)),this._hasTimeElapsed=t.getQuery(e.TIME_ELAPSED_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,this._hasTimeStamp=t.getQuery(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,!this._hasTimeElapsed&&!this._hasTimeStamp)return this;this._hasTimeStamp||r.Z.debug("Warning: do not use interleaved GPU query"),this._ext=e,this._gl=t,this._enabled=!0}this._frameAverageCount=10,this._glQueries=[],this._queriesByID={},this._userQueries=[],this._queryCount=0,this._nbOpened=0},getContext:function(){return this._gl},setContext:function(t){this._gl=t},setFrameAverageCount:function(t){this._frameAverageCount=t},clearQueries:function(){for(var t=this._glQueries,e=0,i=t.length;e<i;++e){var r=t[e];this._gl.deleteQuery(r._pollingStartQuery),r._pollingEndQuery&&this._gl.deleteQuery(r)}this._userQueries.length=0,this._glQueries.length=0,this._queriesByID={}},supportTimeStamp:function(){return this._hasTimeStamp},enable:disable:function(){this._enabled=!1},isEnabled:function(){return this._enabled},setCallback:function(t){this._callback=t},createUserQuery:function(t){var e;return(e=this._hasTimeStamp?this.createGLQuery():{_startIndex:0,_endIndex:0})._id=t,e._frame=a.FRAME_COUNT,e._isOpened=!0,e._siblings=[],e},createGLQuery:function(){var t={_isWaiting:!1,_pollingStartQuery:void 0,_pollingEndQuery:void 0,_averageTimer:0,_resultCount:0};return this._hasTimeStamp&&(t._pollingEndQuery=this._gl.createQuery()),t._pollingStartQuery=this._gl.createQuery(),this._glQueries.push(t),t},getOrCreateLastGLQuery:function(){var t=this._glQueries[this._queryCount-1];return t||(t=this._glQueries[this._queryCount-1]=this.createGLQuery())},beginCurrentQuery:function(){if(0!==this._nbOpened){this._queryCount++;var t=this.getOrCreateLastGLQuery();t._isWaiting||this._gl.beginQuery(this._ext.TIME_ELAPSED_EXT,t._pollingStartQuery)}},endCurrentQuery:function(){0!==this._nbOpened&&(this.getOrCreateLastGLQuery()._isWaiting||this._gl.endQuery(this._ext.TIME_ELAPSED_EXT))},getAvailableQueryByID:function(t){var e=this._queriesByID[t];if(!e)return e=this._queriesByID[t]=this.createUserQuery(t),this._userQueries.push(e),e;if(e._frame===a.FRAME_COUNT){if(e._isOpened)return e;for(var i=e._siblings,r=0,n=i.length;r<n;++r){var s=i[r];if(s._frame!==a.FRAME_COUNT||s._isOpened)return s._frame=a.FRAME_COUNT,s}var o=this.createUserQuery();return i.push(o),o}return e._frame=a.FRAME_COUNT,e},start:function(t){if(this._enabled){var e=this.getAvailableQueryByID(t);e._isOpened=!0,this._hasTimeStamp?e._isWaiting||this._ext.queryCounterEXT(e._pollingStartQuery,this._ext.TIMESTAMP_EXT):(this.endCurrentQuery(),this._nbOpened++,e._startIndex=this._queryCount,this.beginCurrentQuery())}},end:function(t){if(this._enabled){var e=this.getAvailableQueryByID(t);e._isOpened=!1,this._hasTimeStamp?e._isWaiting||this._ext.queryCounterEXT(e._pollingEndQuery,this._ext.TIMESTAMP_EXT):(this.endCurrentQuery(),e._endIndex=this._queryCount,this._nbOpened--,this.beginCurrentQuery())}},computeQueryAverageTime:function(t){for(var e=0,i=this._glQueries,r=t._startIndex;r<t._endIndex;++r){var n=i[r]._averageTimer;if(n<0)return-1;e+=n}return e},computeFullAverageTime:function(t){var e=this.computeQueryAverageTime(t);if(e<0)return-1;for(var i=t._siblings,r=0,n=i.length;r<n;++r){var s=i[r];if(s._frame===a.FRAME_COUNT-1){var o=this.computeQueryAverageTime(s);if(o<0)return-1;e+=o}}return e},pollQueries:function(){if(a.FRAME_COUNT++,this._queryCount=0,this._nbOpened=0,this._enabled&&this._callback){var t,e=this._glQueries,i=e.length;if(this._gl.getParameter(this._ext.GPU_DISJOINT_EXT))for(t=0;t<i;++t)e[t]._isWaiting=!1;else{for(t=0;t<i;++t)this.pollQuery(e[t]);var r=this._userQueries,n=r.length;for(t=0;t<n;++t){var s=r[t],o=this.computeFullAverageTime(s);o>0&&this._callback(o,s._id)}}}},pollQuery:function(t){t._isWaiting=!1;var e,i=this._hasTimeStamp?t._pollingEndQuery:t._pollingStartQuery;if(!this._gl.getQueryParameter(i,this._gl.QUERY_RESULT_AVAILABLE))return t._isWaiting=!0,0;if(this._hasTimeStamp){var r=this._gl.getQueryParameter(t._pollingStartQuery,this._gl.QUERY_RESULT);e=this._gl.getQueryParameter(i,this._gl.QUERY_RESULT)-r}else e=this._gl.getQueryParameter(i,this._gl.QUERY_RESULT);return t._resultCount++,t._resultCount>this._frameAverageCount&&(t._averageTimer=0,t._resultCount=1),t._averageTimer=t._averageTimer+(e-t._averageTimer)/t._resultCount,t._averageTimer}};const s=a},"6RPJ":(t,e,i)=>{"use strict";i.d(e,{Z:()=>u});var r,n=i("GoyH"),a=i("IpZ9"),s=i("W40i"),o=i("pSxj"),h=function(){a.Z.call(this),this.referenceFrame=o.Z.RELATIVE_RF};n.Z.createPrototypeNode(h,n.Z.objectInherit(a.Z.prototype,{setReferenceFrame:function(t){this.referenceFrame=t},getReferenceFrame:function(){return this.referenceFrame},computeBoundingSphere:(r=s._E.create(),function(t){return a.Z.prototype.computeBoundingSphere.call(this,t),t.valid()?(s._E.identity(r),this.computeLocalToWorldMatrix(r),t.transformMat4(t,r),t):t})}),"osg","Transform");const u=h},"64xh":(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=i("u5PS"),n=function(t){this._data=void 0,this._transpose=!1,this._glCall="",this._cache=void 0,this._name=t,this._type=void 0,this._isMatrix=!1};n.isUniform=function(t){return"object"==typeof t&&window.Object.getPrototypeOf(t)===n.prototype},(n.prototype={getName:function(){return this._name},getType:function(){return this._type},apply:function(t,e){this._cache||(this._cache=t[this._glCall]),this._isMatrix?this._cache.call(t,e,this._transpose,this._data):this._cache.call(t,e,this._data)},setInternalArray:function(t){r.Z.warn("setInternalArray deprecated, please use getInternalArray instead: "+t.length),this._data=t},getInternalArray:function(){return this._data},setFloat:function(t){this._data[0]=t},setFloat1:function(t){this._data[0]=t[0]},setFloat2:function(t){this._data[0]=t[0],this._data[1]=t[1]},setFloat3:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2]},setFloat4:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3]},setFloat9:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8]},setFloat16:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8],this._data[9]=t[9],this._data[10]=t[10],this._data[11]=t[11],this._data[12]=t[12],this._data[13]=t[13],this._data[14]=t[14],this._data[15]=t[15]}}).setVec2=n.prototype.setFloat2,n.prototype.setVec3=n.prototype.setFloat3,n.prototype.setVec4=n.prototype.setFloat4,n.prototype.setMatrix4=n.prototype.setFloat16,n.prototype.setMatrix3=n.prototype.setFloat9,n.prototype.setInt=n.prototype.setFloat,n.prototype.setInt1=n.prototype.setFloat1,n.prototype.setInt2=n.prototype.setFloat2,n.prototype.setInt3=n.prototype.setFloat3,n.prototype.setInt4=n.prototype.setFloat4;var a=function(t,e,i,r,a,s){var o=e&&e.length?t:void 0,h=new n(void 0!==o?e:t);if(h._data=i,void 0!==o)if(o.length)for(var u=0,c=o.length;u<c;++u)h._data[u]=o[u];else h._data[0]=o;return h._glCall=r,h._type=a,h._isMatrix=!!s,h},s=function(t,e,i){return i&&!i.length?i:"string"!=typeof e?(e.length||1)/t:1};n.createFloat1=function(t,e){return a(t,e,new Float32Array(1*s(1,t,e)),"uniform1fv","float")},n.createFloat2=function(t,e){return a(t,e,new Float32Array(2*s(2,t,e)),"uniform2fv","vec2")},n.createFloat3=function(t,e){return a(t,e,new Float32Array(3*s(3,t,e)),"uniform3fv","vec3")},n.createFloat4=function(t,e){return a(t,e,new Float32Array(4*s(4,t,e)),"uniform4fv","vec4")},n.createInt1=function(t,e){return a(t,e,new Int32Array(1*s(1,t,e)),"uniform1iv","int")},n.createInt2=function(t,e){return a(t,e,new Int32Array(2*s(2,t,e)),"uniform2iv","vec2i")},n.createInt3=function(t,e){return a(t,e,new Int32Array(3*s(3,t,e)),"uniform3iv","vec3i")},n.createInt4=function(t,e){return a(t,e,new Int32Array(4*s(4,t,e)),"uniform4iv","vec4i")},n.createMatrix2=function(t,e){return a(t,e,function(t){for(var e=new Float32Array(4*t),i=0;i<e.length;i+=4)e[i]=e[i+3]=1;return e}(s(4,t,e)),"uniformMatrix2fv","mat2",!0)},n.createMatrix3=function(t,e){return a(t,e,function(t){for(var e=new Float32Array(9*t),i=0;i<e.length;i+=9)e[i]=e[i+4]=e[i+8]=1;return e}(s(9,t,e)),"uniformMatrix3fv","mat3",!0)},n.createMatrix4=function(t,e){return a(t,e,function(t){for(var e=new Float32Array(16*t),i=0;i<e.length;i+=16)e[i]=e[i+5]=e[i+10]=e[i+15]=1;return e}(s(16,t,e)),"uniformMatrix4fv","mat4",!0)},n.float=n.createFloatArray=n.createFloat=n.createFloat1,n.vec2=n.createFloat2Array=n.createFloat2,n.vec3=n.createFloat3Array=n.createFloat3,n.vec4=n.createFloat4Array=n.createFloat4,n.int=n.createIntArray=n.createInt=n.createInt1,n.vec2i=n.createInt2Array=n.createInt2,n.vec3i=n.createInt3Array=n.createInt3,n.vec4i=n.createInt4Array=n.createInt4,n.mat2=n.createMat2Array=n.createMat2=n.createMatrix2,n.mat3=n.createMat3Array=n.createMat3=n.createMatrix3,n.mat4=n.createMat4Array=n.createMat4=n.createMatrix4;const o=n},Qp64:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var r=i("GoyH"),n=i("CJNH"),a=function(){n.Z.call(this),this.visitorType=n.Z.UPDATE_VISITOR,this._numUpdateCallback=0};r.Z.createPrototypeObject(a,r.Z.objectInherit(n.Z.prototype,{resetStats:function(){this._numUpdateCallback=0},apply:function(t){var e=t.getStateSet();if(e&&e.requiresUpdateTraversal()){var i=e.getUpdateCallbackList(),r=i.length;if(r){this._numUpdateCallback+=r;for(var n=0,a=r;n<a;n++)i[n].update(e,this)}}for(var s=t.getUpdateCallbackList(),o=s.length,h=0;h<o;h++)if(this._numUpdateCallback++,!s[h].update(t,this))return;t.getNumChildrenRequiringUpdateTraversal()>0&&this.traverse(t)}}),"osg","NodeVisitor");const s=a},ojCs:(t,e,i)=>{"use strict";i.d(e,{Z:()=>h});var r=i("GoyH"),n=i("iUVs"),a=i("/CZr"),s=i("6qT5"),o=function(){a.Z.call(this),this._instanceID=n.Z.getInstanceID(),this._vaoObject=void 0,this.dirty()};o._sDeletedGLVertexArrayObjectCache=new window.Map,o.deleteGLVertexArrayObject=function(t,e){o._sDeletedGLVertexArrayObjectCache.has(t)||o._sDeletedGLVertexArrayObjectCache.set(t,[]),o._sDeletedGLVertexArrayObjectCache.get(t).push(e)},o.flushDeletedGLVertexArrayObjects=function(t,e){if(e<=0)return e;if(!o._sDeletedGLVertexArrayObjectCache.has(t))return e;for(var i=0,r=s.Z.instance().tick(),n=o._sDeletedGLVertexArrayObjectCache.get(t),a=n.length-1;a>=0&&i<e;a--)t.deleteVertexArray(n[a]),n.splice(a,1),i=s.Z.instance().deltaS(r,s.Z.instance().tick());return e-i},o.flushAllDeletedGLVertexArrayObjects=function(t){if(o._sDeletedGLVertexArrayObjectCache.has(t))for(var e=o._sDeletedGLVertexArrayObjectCache.get(t),i=e.length-1;i>=0;i--)t.deleteVertexArray(e[i]),e.splice(i,1)},o.onLostContext=function(t){o._sDeletedGLVertexArrayObjectCache.has(t)&&(o._sDeletedGLVertexArrayObjectCache.get(t).length=0)},r.Z.createPrototypeObject(o,r.Z.objectInherit(a.Z.prototype,{getInstanceID:function(){return this._instanceID},invalidate:releaseGLObjects:function(){void 0!==this._vaoObject&&void 0!==this._gl&&(o.deleteGLVertexArrayObject(this._gl,this._vaoObject),a.Z.removeObject(this._gl,this)),this.invalidate()},create:function(t){this._vaoObject=t.createVertexArray(),this._dirty=!1},bind:function(t){this._gl||this.setGraphicContext(t),this._vaoObject&&t.bindVertexArray(this._vaoObject)},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}}),"osg","VertexArrayObject");const h=o},Yy1w:(t,e,i)=>{"use strict";i.d(e,{Z:()=>c});var r,n,a,s=i("GoyH"),o=i("WWMP"),h=i("W40i"),u=function(t,e,i,r){o.Z.call(this),this._x=void 0!==t?t:0,this._y=void 0!==e?e:0,this._width=void 0!==i?i:800,this._height=void 0!==r?r:600};s.Z.createPrototypeStateAttribute(u,s.Z.objectInherit(o.Z.prototype,{attributeType:"Viewport",cloneType:function(){return new u},setViewport:function(t,e,i,r){this._x=t,this._y=e,this._width=i,this._height=r},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:(r=h._E.create(),n=h._E.create(),a=h.R3.create(),function(t){h._E.fromTranslation(r,h.R3.ONE),h._E.fromScaling(n,[.5*this._width,.5*this._height,.5]);var e=h._E.fromTranslation(t,h.R3.set(a,this._x,this._y,0));return h._E.mul(e,e,h._E.mul(n,n,r))}),apply:function(t){t.applyViewport(this)}}),"osg","Viewport");const c=u},BvLe:(t,e,i)=>{"use strict";i.d(e,{Z:()=>u});var r,n=i("u5PS"),a=i("F5Ms"),s=i("bYH/"),o=i("MQQR"),h=function(){r||(r=i("5rJd").Z),this._checkRTT={},this._webGLExtensions={},this._webGLParameters={},this._webGLShaderMaxInt="NONE",this._webGLShaderMaxFloat="NONE",this._bugsDB={},this._webGLPlatforms={},this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE=16,this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=16,this._webGLParameters.MAX_RENDERBUFFER_SIZE=1,this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_TEXTURE_SIZE=64,this._webGLParameters.MAX_VARYING_VECTORS=8,this._webGLParameters.MAX_VERTEX_ATTRIBS=8,this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0,this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS=128,this._webGLParameters.MAX_VIEWPORT_DIMS=[1,1],this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS=0,this._webGLParameters.MAX_SHADER_PRECISION_FLOAT="none",this._webGLParameters.MAX_SHADER_PRECISION_INT="none",this._gl=void 0};h.instance=function(t,e){if(!h._instance){var i,r=t;if(!r){"undefined"!=typeof window&&window.gli&&(i=window.gli.host.inspectContext,window.gli.host.inspectContext=!1);var o=document.createElement("canvas");o.width=32,o.height=32;var u=new s.Z;u.extend({antialias:!1}),u.extendWithOptionsURL(),r=a.Z.setupWebGL(o,u,(function(){})),this._webglTemporary=r}h._instance=new h,r?h._instance.init(r):n.Z.warn("no support for webgl context detected."),i&&(window.gli.host.inspectContext=i)}if(t){if(this._webglTemporary&&this._webglTemporary!==t){var c=r&&r.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._webglTemporary=null}(e||t!==this._webglTemporary)&&(h._instance.initContextDependant(t),this._webglTemporary=t)}return h._instance},h.prototype={getContext:function(){return this._gl},initContextDependant:function(t){this._gl=t,this._isGL2=void 0!==window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext,this.initWebGLExtensions(t),(0,o.Z)().webglUniforms&&(this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=64),this.hasLinearHalfFloatRTT(t),this.hasLinearFloatRTT(t),this.hasHalfFloatRTT(t),this.hasFloatRTT(t)},init:function(t){if(this.initWebGLParameters(t),this.initPlatformSupport(),this.initBugDB(t),this.initContextDependant(t),this._isGL2)for(var e=["OES_element_index_uint","EXT_sRGB","EXT_blend_minmax","EXT_frag_depth","WEBGL_depth_texture","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_vertex_array_object","WEBGL_draw_buffers","OES_fbo_render_mipmap","ANGLE_instanced_arrays"],i=h._instance.getWebGLExtensions(),r=function(){},n=0,a=e.length;n<a;n++)i[e[n]]=r},isWebGL2:function(){return this._isGL2},initBugDB:function(t){if(!this._isGL2){var e=this._webGLPlatforms,i=this._webGLParameters;if(e.Apple&&(i.UNMASKED_VENDOR_WEBGL&&-1===i.UNMASKED_VENDOR_WEBGL.indexOf("Intel")||(this._bugsDB.OES_standard_derivatives=!0)),t.getExtension("EXT_shader_texture_lod")){var r={type:"FRAGMENT_SHADER",text:["#version 100","#extension GL_EXT_shader_texture_lod : require","#ifdef GL_FRAGMENT_PRECISION_HIGH","  precision highp float;","#else"," precision mediump float;","#endif","uniform samplerCube uT0;","varying vec3 vC;","void main(void) {","  gl_FragColor = textureCubeLodEXT(uT0, vC, 1.0);","}"].join("\n")};this.checkShader(t,r.type,r.text)||(this._bugsDB.EXT_shader_texture_lod=!0)}}},checkShader:function(t,e,i){var r=e;"string"==typeof r&&(r=t[e]);var a=t.createShader(r);return t.shaderSource(a,i),t.compileShader(a),!(!t.getShaderParameter(a,t.COMPILE_STATUS)&&!t.isContextLost())||(n.Z.warn(t.getShaderInfoLog(a)),!1)},initPlatformSupport:function(){var t=this._webGLPlatforms;t.Apple=-1!==navigator.vendor.indexOf("Apple")||-1!==navigator.vendor.indexOf("OS X"),t.Mobile=/Mobi/.test(navigator.userAgent)||/ablet/.test(navigator.userAgent)},getWebGLPlatform:function(t){return this._webGLPlatforms[t]},getWebGLPlatforms:function(){return this._webGLPlatforms},getWebGLParameter:function(t){return this._webGLParameters[t]},getWebGLParameters:function(){return this._webGLParameters},getShaderMaxPrecisionFloat:function(){return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT},getShaderMaxPrecisionInt:function(){return this._webGLParameters.MAX_SHADER_PRECISION_INT},checkSupportRTT:function(t,e,i){if(this._isGL2)return!0;var n=e+","+i;if(void 0!==this._checkRTT[n])return this._checkRTT[n];if(!t)return!1;switch((0,o.Z)().webglRenderTexture){case"none":return!1;case"float":if(e===r.FLOAT&&i===r.LINEAR)return!1;break;case"half_float":if(e===r.FLOAT)return!1;if(i===r.LINEAR)return!1;break;case"half_float_linear":if(e===r.FLOAT)return!1}var a=t.RGBA,s=a;if(this._isGL2){if(e===r.FLOAT&&(s=t.RGBA32F,i!==r.LINEAR))return this._webGLExtensions.EXT_color_buffer_float;if(e===r.HALF_FLOAT_OES&&(s=t.RGBA16F,i!==r.LINEAR))return this._webGLExtensions.EXT_color_buffer_half_float}var h=t.createTexture();t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,s,5,5,0,a,e,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i);var u=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,u),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,h,0);var c=this._checkRTT[n]=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;if(c){t.clearColor(1,0,0,1),t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT);var l=new Float32Array(104);t.flush(),t.finish(),t.readPixels(0,0,5,5,t.RGBA,t.FLOAT,l),c=1===l[0]}return t.deleteTexture(h),t.deleteFramebuffer(u),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),c},hasLinearHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float_linear&&this.checkSupportRTT(t,r.HALF_FLOAT_OES,r.LINEAR)},hasLinearFloatRTT:function(t){return this._webGLExtensions.OES_texture_float_linear&&this.checkSupportRTT(t,r.FLOAT,r.LINEAR)},hasHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float&&this.checkSupportRTT(t,r.HALF_FLOAT_OES,r.NEAREST)},hasFloatRTT:function(t){return this._webGLExtensions.OES_texture_float&&this.checkSupportRTT(t,r.FLOAT,r.NEAREST)},queryPrecision:function(t,e,i){var r=t.getShaderPrecisionFormat(e,i);return!!r&&0!==r.precision},hasVAO:getDisjointTimerQuery:initWebGLParameters:function(t){if(t){for(var e=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","SHADING_LANGUAGE_VERSION","VERSION","VENDOR","RENDERER","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],i=this._webGLParameters,r=0,n=e.length;r<n;++r){var a=e[r];i[a]=t.getParameter(t[a])}this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_FLOAT)&&(i.MAX_SHADER_PRECISION_FLOAT="low"),this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_INT)?i.MAX_SHADER_PRECISION_INT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_INT)?i.MAX_SHADER_PRECISION_INT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_INT)&&(i.MAX_SHADER_PRECISION_INT="low");var s=t.getExtension("WEBGL_debug_renderer_info");s&&(i.UNMASKED_RENDERER_WEBGL=t.getParameter(s.UNMASKED_RENDERER_WEBGL),i.UNMASKED_VENDOR_WEBGL=t.getParameter(s.UNMASKED_VENDOR_WEBGL))}},applyExtension:function(t,e){var i=t.getExtension(e),r=e.split("_")[0],n="_"+r,a=new RegExp(r+"$"),s=new RegExp(n);for(var o in i){if("function"==typeof i[o]){var h=o.replace(a,"");void 0===t[h]&&(t[h]=i[o].bind(i))}else{var u=o.replace(s,"");void 0===t[u]&&(t[u]=i[o])}}},getWebGLExtension:function(t){return this._webGLExtensions[t]},getWebGLExtensions:function(){return this._webGLExtensions},_checkShader:function(t,e,i){var r=e;"string"==typeof r&&(r=t[e]);var n=t.createShader(r);return t.shaderSource(n,i),t.compileShader(n),!(!t.getShaderParameter(n,t.COMPILE_STATUS)&&!t.isContextLost())},_doubleCheckExtension:function(t,e){var i=["#version 100","#extension GL_%ext% : require","precision mediump float;","varying vec3 vColor;","void main() {","gl_FragColor = vec4(vColor, 1.0);","}"].join("\n");return this._checkShader(t,"FRAGMENT_SHADER",i.replace(/\%ext\%/g,e))},initWebGLExtensions:function(t,e){if(t){var i=e;if(void 0===i&&(i=!0),(0,o.Z)().webglExt){var n=t.getSupportedExtensions();if(n){for(var a=this._webGLExtensions,s=0,h=n.length;s<h;++s){var u=n[s];i&&this._bugsDB[u]||(a[u]=t.getExtension(u),this.applyExtension(t,u))}if(!this._isGL2){var c="EXT_shader_texture_lod";a[c]&&!this._doubleCheckExtension(t,c)&&delete a[c]}var l=this.getWebGLExtension("EXT_texture_filter_anisotropic");l&&(r.ANISOTROPIC_SUPPORT_EXT=!0,r.ANISOTROPIC_SUPPORT_MAX=t.getParameter(l.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}}else this._webGLExtensions={}}}};const u=h},haRL:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i("W40i"),n=i("pSxj");const a={computeLocalToWorld:function(t,e,i,a){var s=e,o=void 0!==a?a:t.length;void 0===s&&(s=!0);var h=i||r._E.create(),u=0;if(s){for(u=o-1;u>=0;u--){var c=t[u];if("Camera"===c.className()&&(c.getReferenceFrame()!==n.Z.RELATIVE_RF||0===c.getParents().length))break}u+=1}for(var l=u,_=o;l<_;l++){var d=t[l];d.computeLocalToWorldMatrix&&d.computeLocalToWorldMatrix(h)}return h}}},SHDx:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r=[];const n={applyFunctionArray:r,registerApplyFunction:getApplyFunction:function(t){return r[t]}}},W40i:(t,e,i)=>{"use strict";i.d(e,{sh:()=>n,wO:()=>T,_E:()=>y,gf:()=>x,K4:()=>v,R3:()=>b,vh:()=>S});var r=i("LElp"),n=i("F9s5");const a={ArrayType:Float64Array};n.glMatrix.setMatrixArrayType(a.ArrayType),n.glMatrix.EPSILON=1e-9;var s,o,h,u,c,l,_,d,f,p,g,m,v=n.vec2,b=n.vec3,S=n.vec4,y=n.mat4,T=n.mat3,x=n.quat;b.create32=function(){return new Float32Array(3)},b.create64=function(){return new Float64Array(3)},b.fromValues32=function(t,e,i){var r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r},b.fromValues64=b.init=b.transformMat4Rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2];return t[0]=i[0]*r+i[1]*n+i[2]*a,t[1]=i[4]*r+i[5]*n+i[6]*a,t[2]=i[8]*r+i[9]*n+i[10]*a,t},b.valid=function(t){return!r.Z.isNaN(t[0])&&(!r.Z.isNaN(t[1])&&!r.Z.isNaN(t[2]))},b.neg=b.negate,b.ZERO=b.create(),b.ONE=b.fromValues(1,1,1),b.INFINITY=b.fromValues(1/0,1/0,1/0),b.NEGATIVE_INFINITY=b.fromValues(-1/0,-1/0,-1/0),v.create32=function(){return new Float32Array(2)},v.create64=function(){return new Float64Array(2)},v.fromValues32=function(t,e){var i=new Float32Array(2);return i[0]=t,i[1]=e,i},v.fromValues64=function(t,e){var i=new Float64Array(2);return i[0]=t,i[1]=e,i},v.init=v.valid=function(t){return!r.Z.isNaN(t[0])&&!r.Z.isNaN(t[1])},v.ZERO=v.create(),v.ONE=v.fromValues(1,1),v.INFINITY=v.fromValues(1/0,1/0),v.NEGATIVE_INFINITY=v.fromValues(-1/0,-1/0),S.create32=function(){return new Float32Array(4)},S.create64=S.fromValues32=function(t,e,i,r){var n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},S.fromValues64=S.init=S.valid=function(t){return!r.Z.isNaN(t[0])&&(!r.Z.isNaN(t[1])&&(!r.Z.isNaN(t[2])&&!r.Z.isNaN(t[3])))},S.neg=S.negate,S.ZERO=S.create(),S.ONE=S.fromValues(1,1,1,1),S.INFINITY=S.fromValues(1/0,1/0,1/0,1/0),S.NEGATIVE_INFINITY=S.fromValues(-1/0,-1/0,-1/0,-1/0),x.IDENTITY=x.create(),x.zeroRotation=x.create32=function(){var t=new Float32Array(4);return t[3]=1,t},x.create64=function(){var t=new Float64Array(4);return t[3]=1,t},x.fromValues32=S.fromValues32,x.fromValues64=S.fromValues64,x.init=x.identity,x.nlerp=function(t,e,i,r){var n,a,s,o,h=e[0],u=e[1],c=e[2],l=e[3],_=i[0],d=i[1],f=i[2],p=i[3],g=1-r;h*_+u*d+c*f+l*p<0?(n=h*g-_*r,a=u*g-d*r,s=c*g-f*r,o=l*g-p*r):(n=h*g+_*r,a=u*g+d*r,s=c*g+f*r,o=l*g+p*r);var m=1/Math.sqrt(n*n+a*a+s*s+o*o);return t[0]=n*m,t[1]=a*m,t[2]=s*m,t[3]=o*m,t},T.IDENTITY=T.create(),T.create32=function(){var t=new Float32Array(9);return t[0]=t[4]=t[8]=1,t},T.create64=function(){var t=new Float64Array(9);return t[0]=t[4]=t[8]=1,t},y.IDENTITY=y.create(),y.create32=function(){var t=new Float32Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},y.create64=function(){var t=new Float64Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},y.setTranslation=function(t,e){return t[12]=e[0],t[13]=e[1],t[14]=e[2],t},y.getFrustum=function(t,e){var i,r,n,a,s,o;if(0!==e[3]||0!==e[7]||-1!==e[11]||0!==e[15])return!1;var h=e[14]/(e[10]-1),u=e[14]/(1+e[10]);return r=h*(e[8]-1)/e[0],i=h*(1+e[8])/e[0],n=h*(1+e[9])/e[5],a=h*(e[9]-1)/e[5],s=h,o=u,t.left=r,t.right=i,t.top=n,t.bottom=a,t.zNear=s,t.zFar=o,!0},y.getPerspective=(s={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0},function(t,e){return y.getFrustum(s,e)&&(t.fovy=180/Math.PI*(Math.atan(s.top/s.zNear)-Math.atan(s.bottom/s.zNear)),t.aspectRatio=(s.right-s.left)/(s.top-s.bottom)),t.zNear=s.zNear,t.zFar=s.zFar,t}),y.getLookAt=(o=y.create(),h=b.create(),u=b.fromValues(0,1,0),c=b.fromValues(0,0,-1),function(t,e,i,r,n){var a=void 0!==n?n:1;y.invert(o,r),y.getTranslation(t,o),b.transformMat4Rotate(i,u,r),b.transformMat4Rotate(e,c,r),b.normalize(e,e),b.add(e,b.scale(h,e,a),t)}),y.getFrustumPlanes=(l=y.create(),function(t,e,i,r){y.mul(l,e,i);var n=!!r,a=t[0];a[0]=l[3]-l[0],a[1]=l[7]-l[4],a[2]=l[11]-l[8],a[3]=l[15]-l[12];var s=t[1];s[0]=l[3]+l[0],s[1]=l[7]+l[4],s[2]=l[11]+l[8],s[3]=l[15]+l[12];var o=t[2];o[0]=l[3]+l[1],o[1]=l[7]+l[5],o[2]=l[11]+l[9],o[3]=l[15]+l[13];var h=t[3];h[0]=l[3]-l[1],h[1]=l[7]-l[5],h[2]=l[11]-l[9],h[3]=l[15]-l[13];var u=4;if(n){u=6;var c=t[4];c[0]=l[3]-l[2],c[1]=l[7]-l[6],c[2]=l[11]-l[10],c[3]=l[15]-l[14];var _=t[5];_[0]=l[3]+l[2],_[1]=l[7]+l[6],_[2]=l[11]+l[10],_[3]=l[15]+l[14]}for(var d=0;d<u;d++){var f=t[d],p=1/Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);f[0]*=p,f[1]*=p,f[2]*=p,f[3]*=p}}),y.infiniteFrustum=function(t,e,i,r,n,a){var s=2*a/(i-e),o=2*a/(n-r),h=(i+e)/(i-e),u=(n+r)/(n-r);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=h,t[9]=u,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=-2*a,t[15]=0,t},y.lookAtDirection=(_=b.create(),d=b.create(),f=b.create(),function(t,e,i,r){var n=i;return b.cross(_,n,r),b.normalize(_,_),b.cross(d,_,n),b.normalize(d,d),t[0]=_[0],t[1]=d[0],t[2]=-n[0],t[3]=0,t[4]=_[1],t[5]=d[1],t[6]=-n[1],t[7]=0,t[8]=_[2],t[9]=d[2],t[10]=-n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,y.translate(t,t,b.neg(f,e))}),y.getScale=(p=b.create(),g=b.create(),m=b.create(),function(t,e){return p[0]=e[0],p[1]=e[4],p[2]=e[8],g[0]=e[1],g[1]=e[5],g[2]=e[9],m[0]=e[2],m[1]=e[6],m[2]=e[10],t[0]=b.length(p),t[1]=b.length(g),t[2]=b.length(m),t}),y.getSqrScale=function(){var t=b.create(),e=b.create(),i=b.create();return function(r,n){return t[0]=n[0],t[1]=n[4],t[2]=n[8],e[0]=n[1],e[1]=n[5],e[2]=n[9],i[0]=n[2],i[1]=n[6],i[2]=n[10],r[0]=b.sqrLen(t),r[1]=b.sqrLen(e),r[2]=b.sqrLen(i),r}}();var E=y.rotate;y.rotate=function(t,e,i,r){return E(t,e,i,r)||y.identity(t)};var R=y.fromRotation;y.fromRotation=function(t,e,i){return R(t,e,i)||y.identity(t)}},LElp:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});const r={clamp:smoothStep:isNaN:},u5PS:(t,e,i)=>{"use strict";i.d(e,{Z:()=>d});var r={};function n(){var t=arguments[0];if(r.console&&!(t>r.currentNotifyLevel)){var e=arguments[1],i=Array.prototype.slice.call(arguments);i=i.splice(2,arguments.length),r.console[e].apply(r.console,i),r.traceLogCall&&t!==r.ERROR&&console.trace()}}function a(t,e,i,n){!r.console||t>r.currentNotifyLevel||(r.console.groupCollapsed&&r.console.groupCollapsed(i),r.console[e](n),r.traceLogCall&&t!==r.ERROR&&console.trace(),r.console.groupEnd&&r.console.groupEnd())}function s(t,e){return e?[t.slice(0,4),t.slice(4,8),t.slice(8,12),t.slice(12,16)]:[[t[0],t[4],t[8],t[12]],[t[1],t[5],t[9],t[13]],[t[2],t[6],t[10],t[14]],[t[3],t[7],t[11],t[15]]]}function o(t,e,i){t>r.currentNotifyLevel||r.console.table&&n("table",s(e,i))}function h(t,e,i,n){t>r.currentNotifyLevel||r.console.table&&a("table",e,s(i,n))}r.ALWAYS=0,r.FATAL=r.ERROR=1,r.WARN=2,r.NOTICE=r.LOG=3,r.INFO=4,r.DEBUG=5,r.currentNotifyLevel=r.LOG,r.console=window.console;for(var u=["error","warn","log","info","debug"],c=0;c<u.length;++c){var l=u[c],_=r[l.toUpperCase()];r[l]=n.bind(r,_,l),r[l+"Fold"]=a.bind(r,_,l),r[l+"Matrix"]=o.bind(r,_),r[l+"MatrixFold"]=h.bind(r,_)}r.group=n.bind(r,r.LOG,"group"),r.groupCollapsed=n.bind(r,r.LOG,"groupCollapsed"),r.groupEnd=r.console.groupEnd,r.notice=r.log,r.noticeFold=r.logFold,r.noticeMatrix=r.logMatrix,r.noticeMatrixFold=r.logMatrixFold,r.timeStamp=function(){},r.assert=function(t,e){void 0===this.console||t||this.console.assert(t,e)},r.setNotifyLevel=function(t,e){r.currentNotifyLevel=t,void 0!==e&&(r.traceLogCall=e)},r.getNotifyLevel=r.reportWebGLError=!1,r.setConsole=function(t){r.console=t},window.getElementsById=const d=r},"5naU":(t,e,i)=>{"use strict";i.d(e,{Z:()=>re});var r=i("Pev1"),n=i("GoyH"),a=i("WWMP"),s=n.Z.createPrototypeStateAttribute(s,n.Z.objectInherit(a.Z.prototype,{attributeType:"Billboard",cloneType:function(){return new s},setEnabled:function(t){this._attributeEnable=t},isEnabled:function(){return this._attributeEnable},apply:function(){}}),"osg","Billboard");const o=s;var h=i("W40i"),u=function(t){a.Z.call(this),this._constantColor=h.vh.create(),h.vh.set(this._constantColor,1,1,1,1),void 0!==t&&this.setConstantColor(t)};n.Z.createPrototypeStateAttribute(u,n.Z.objectInherit(a.Z.prototype,{attributeType:"BlendColor",cloneType:function(){return new u},setConstantColor:function(t){h.vh.copy(this._constantColor,t)},getConstantColor:function(){return this._constantColor},apply:function(t){t.getGraphicContext().blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3])}}),"osg","BlendColor");const c=u;var l=i("f7MS"),_=i("k3oU"),d=i("bxht"),f=i("UqX1"),p=i("eYxU"),g=i("W6eo"),m=function(t,e,i,r){a.Z.call(this),this._red=!0,this._green=!0,this._blue=!0,this._alpha=!0,void 0!==t&&void 0!==e&&void 0!==i&&this.setMask(t,e,i,r)};n.Z.createPrototypeStateAttribute(m,n.Z.objectInherit(a.Z.prototype,{attributeType:"ColorMask",cloneType:function(){return new m},setMask:function(t,e,i,r){this._red=!!t,this._green=!!e,this._blue=!!i,this._alpha=!!r},apply:function(t){t.applyColorMask(this)}}),"osg","ColorMask");const v=m;var b,S,y,T=i("t+pa"),x=i("haRL"),E=i("nbbV"),R=i("IQqM"),A=i("qlNd"),C=i("Mfw4"),M=i("t5D/"),I=i("uRnn"),w=i("Q/WO"),N=i("Z4fc"),P=i("1PKS"),Z=function(){this._radiusEquator=Z.WGS_84_RADIUS_EQUATOR,this._radiusPolar=Z.WGS_84_RADIUS_POLAR,this.computeCoefficients()};Z.WGS_84_RADIUS_EQUATOR=6378137,Z.WGS_84_RADIUS_POLAR=6356752.3142,Z.prototype={setRadiusEquator:function(t){this._radiusEquator=t,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(t){this._radiusPolar=t,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(t,e,i,r){var n=Math.sin(t),a=Math.cos(t),s=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*n*n),o=(s+i)*a*Math.cos(e),h=(s+i)*a*Math.sin(e),u=(s*(1-this._eccentricitySquared)+i)*n;return r[0]=o,r[1]=h,r[2]=u,r},convertXYZToLatLongHeight:function(t,e,i,r){var n=Math.sqrt(t*t+e*e),a=Math.atan2(i*this._radiusEquator,n*this._radiusPolar),s=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),o=Math.sin(a),h=Math.cos(a),u=Math.atan((i+s*this._radiusPolar*o*o*o)/(n-this._eccentricitySquared*this._radiusEquator*h*h*h)),c=Math.atan2(e,t),l=Math.sin(u),_=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*l*l),d=Math.cos(u);0===d&&(d=1);var f=n/d-_;return r[0]=u,r[1]=c,r[2]=f,r},computeLocalUpVector:function(t,e,i){var r,n,a=this.convertXYZToLatLongHeight(t,e,i,h.R3.create());return r=a[0],n=a[1],[Math.cos(n)*Math.cos(r),Math.sin(n)*Math.cos(r),Math.sin(r)]},isWGS84:computeCoefficients:function(){var t=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*t-t*t},computeLocalToWorldTransformFromLatLongHeight:function(t,e,i,r){var n=this.convertLatLongHeightToXYZ(t,e,i,r);return h._E.fromTranslation(r,n),this.computeCoordinateFrame(t,e,r),r},computeLocalToWorldTransformFromXYZ:function(t,e,i){var r=this.convertXYZToLatLongHeight(t,e,i,h.R3.create()),n=h._E.fromTranslation(h._E.create(),h.R3.fromValues(t,e,i));return this.computeCoordinateFrame(r[0],r[1],n),n},computeCoordinateFrame:(b=h.R3.create(),S=h.R3.create(),y=h.R3.create(),function(t,e,i){b[0]=Math.cos(e)*Math.cos(t),b[1]=Math.sin(e)*Math.cos(t),b[2]=Math.sin(t),S[0]=-Math.sin(e),S[1]=-Math.cos(e),h.R3.cross(y,b,S),h._E.set(i,S[0],S[1],S[2],0,y[0],y[1],y[2],0,b[0],b[1],b[2],0,0,0,0,1)})};const L=Z;var O=i("lU+d"),F=i("p6+I"),D=i("6Szz"),U=i("/CZr"),B=i("uHj6"),k=i("lZH+"),V=i.n(k),G=function(t){B.Z.call(this,t),this._canPlayDefered=void 0};G.PAUSE=0,G.PLAYING=1,n.Z.createPrototypeObject(G,n.Z.objectInherit(B.Z.prototype,{isDirty:setImage:function(t){B.Z.prototype.setImage.call(this,t),this._status=G.STOP,t.addEventListener("ended",bind(this),!0),this.dirty()},setLooping:function(t){this._imageObject.loop=t},play:function(){this._imageObject.play(),this._status=G.PLAYING},stop:function(){this._imageObject.pause(),this._status=G.PAUSE},whenReady:function(){if(!this._imageObject)return V().reject();var t=this;return new(V())((function(e){t._canPlayDefered||(t._canPlayDefered=e,t._imageObject.readyState>3?t._canPlayDefered(t):t._imageObject.addEventListener("canplaythrough",t._canPlayDefered.bind(t._canPlayDefered,t),!0))}))}}),"osg","ImageStream");const j=G;var W=i("Un/q"),H=i("907W"),z=i("u5PS"),q=function(t,e){this._bb=new _.Z,this._first=t,this._second=e,this._nodeRayStart=h.R3.create(),this._nodeRayEnd=h.R3.create()},X=function(){this._numVertexIndices=0};X.prototype={apply:function(t){t.getAttributes().Vertex&&(0,W.Z)(t,this)},operatorPoint:function(){this._numVertexIndices+=2},operatorLine:function(){this._numVertexIndices+=3},operatorTriangle:;var K=K.prototype={apply:function(t){t.getAttributes().Vertex&&(0,W.Z)(t,this)},operatorPoint:function(t){var e=this._buildKdTree._kdTree.getVertices(),i=3*t;this._buildKdTree._kdTree.addPoint(t),this._buildKdTree._primitiveIndices[this._numIndices]=this._numIndices;var r=this._buildKdTree._centers,n=3*this._numIndices;r[n]=e[i],r[n+1]=e[i+1],r[n+2]=e[i+2],this._numIndices++},operatorLine:function(t,e){if(t!==e){var i=this._buildKdTree._kdTree.getVertices(),r=3*t,n=3*e;this._buildKdTree._kdTree.addLine(t,e);var a=this._numIndices;this._buildKdTree._primitiveIndices[a]=a;var s=3*a,o=i[r],h=i[r+1],u=i[r+2],c=i[n],l=i[n+1],_=i[n+2],d=o<c?o:c,f=h<l?h:l,p=u<_?u:_,g=o>c?o:c,m=h>l?h:l,v=u>_?u:_,b=this._buildKdTree._centers;b[s]=.5*(d+g),b[s+1]=.5*(f+m),b[s+2]=.5*(p+v),this._numIndices++}},operatorTriangle:function(t,e,i){if(t!==e&&t!==i&&e!==i){var r=this._buildKdTree._kdTree.getVertices(),n=3*t,a=3*e,s=3*i;this._buildKdTree._kdTree.addTriangle(t,e,i);var o=this._numIndices;this._buildKdTree._primitiveIndices[o]=o;var h=3*o,u=r[n],c=r[n+1],l=r[n+2],_=r[a],d=r[a+1],f=r[a+2],p=r[s],g=r[s+1],m=r[s+2],v=u<_?u<p?u:p:_<p?_:p,b=c<d?c<g?c:g:d<g?d:g,S=l<f?l<m?l:m:f<m?f:m,y=u>_?u>p?u:p:_>p?_:p,T=c>d?c>g?c:g:d>g?d:g,x=l>f?l>m?l:m:f>m?f:m,E=this._buildKdTree._centers;E[h]=.5*(v+y),E[h+1]=.5*(b+T),E[h+2]=.5*(S+x),this._numIndices++}}};var Y=function(t){this._kdTree=t,this._bb=new _.Z,this._primitiveIndices=void 0,this._centers=void 0,this._axisOrder=h.R3.create(),this._stackLength=0};Y.prototype={build:function(t,e){var i=t._targetNumTrianglesPerLeaf,r=e.getVertexAttributeList().Vertex;if(!r)return!1;var n=r.getElements();if(!n)return!1;var a=n.length/3;if(a<i)return!1;this._bb.copy(e.getBoundingBox()),this._kdTree.setVertices(n),this.computeDivisions(t),t._numVerticesProcessed+=a;for(var s=0,o=e.getPrimitiveSetList(),h=o.length,u=0;u<h;u++){var c=o[u],l=c.getMode();l===H.Z.TRIANGLE_STRIP||l===H.Z.TRIANGLE_FAN?s+=3*Math.abs(c.getCount()-2):s+=3*c.getCount()}var d=new X(this);d.apply(e);var f=d._numVertexIndices;this._primitiveIndices=new Uint32Array(s/3),this._centers=new Float32Array(s),this._kdTree.setPrimitiveIndices(new Uint32Array(s));var p=a>65535?new Uint32Array(f):new Uint16Array(f);this._kdTree.setVertexIndices(p);var g=new K(this);g.apply(e);var m=this._kdTree.getPrimitiveIndices().slice(0,this._kdTree.getNumPrimitiveIndices());this._kdTree.setPrimitiveIndices(m);var v=this._kdTree.getVertexIndices().slice(0,this._kdTree.getNumVertexIndices());this._kdTree.setVertexIndices(v),this._primitiveIndices=this._primitiveIndices.slice(0,g._numIndices),this._centers=this._centers.slice(0,3*g._numIndices);var b=new q(-1,this._primitiveIndices.length);b._bb.copy(this._bb);var S=this._kdTree.addNode(b),y=new _.Z;y.copy(this._bb),this.divide(t,y,S,0);var T=this._kdTree.getPrimitiveIndices();for(h=this._primitiveIndices.length,u=0;u<h;++u)this._primitiveIndices[u]=T[this._primitiveIndices[u]];return this._kdTree.setPrimitiveIndices(this._primitiveIndices),this._kdTree.getNodes().length>0},computeDivisions:function(t){this._stackLength=t._maxNumLevels;var e=this._bb._max,i=this._bb._min,r=e[0]-i[0],n=e[1]-i[1],a=e[2]-i[2],s=this._axisOrder;s[0]=r>=n&&r>=a?0:n>=a?1:2,s[2]=r<n&&r<a?0:n<a?1:2;var o=s[0]+s[2];s[1]=3===o?0:2===o?1:2},divide:function(t,e,i,r){var n=this._kdTree,a=this._primitiveIndices,s=n.getNodes(),o=s[i],h=o._first,u=o._second,c=-h-1,l=c+u-1;if(!(r<this._stackLength&&h<0&&u>t._targetNumTrianglesPerLeaf))return h<0&&this.computeNodeBox(o,c,l),i;if(h>=0)return i;for(var _=this._axisOrder[r%3],d=.5*(e._min[_]+e._max[_]),f=0,p=0,g=!1,m=c,v=l,b=this._centers;m<v;){for(;m<v&&b[3*a[m]+_]<=d;)++m;for(;m<v&&b[3*a[v]+_]>d;)--v;if(m<v){var S=a[m];a[m]=a[v],a[v]=S,++m,--v}}m===v&&(b[3*a[m]+_]<=d?++m:--v),v-c<=-1?(f=0,p=i,g=!0):l-m<=-1?(f=i,p=0,g=!0):(f=n.addNode(new q(-c-1,v-c+1)),p=n.addNode(new q(-m-1,l-m+1)));var y=e._max[_];e._max[_]=d;var T=0!==f?this.divide(t,e,f,r+1):0;e._max[_]=y,y=e._min[_],e._min[_]=d;var x=0!==p?this.divide(t,e,p,r+1):0;if(e._min[_]=y,!g){o._first=T,o._second=x,g=!0;var E=o._bb;E.init(),0!==T&&E.expandByBoundingBox(s[T]._bb),0!==x&&E.expandByBoundingBox(s[x]._bb)}return i},computeNodeBox:function(t,e,i){for(var r=1/0,n=1/0,a=1/0,s=-1/0,o=-1/0,h=-1/0,u=this._kdTree.getVertexIndices(),c=this._kdTree.getPrimitiveIndices(),l=this._kdTree.getVertices(),_=e;_<=i;++_)for(var d=c[this._primitiveIndices[_]],f=u[d++],p=0;p<f;++p){var g=3*u[d++],m=l[g],v=l[g+1],b=l[g+2];m<r&&(r=m),v<n&&(n=v),b<a&&(a=b),m>s&&(s=m),v>o&&(o=v),b>h&&(h=b)}var S=1e-6,y=t._bb,T=y._min,x=y._max;T[0]=r-S,T[1]=n-S,T[2]=a-S,x[0]=s+S,x[1]=o+S,x[2]=h+S}};var Q=function(){this._vertices=null,this._kdNodes=[],this._primitiveIndices=void 0,this._vertexIndices=void 0,this._numVertexIndices=0,this._numPrimitiveIndices=0};n.Z.createPrototypeObject(Q,{getVertices:function(){return this._vertices},setVertices:function(t){this._vertices=t},getNumPrimitiveIndices:function(){return this._numPrimitiveIndices},getNumVertexIndices:function(){return this._numVertexIndices},setPrimitiveIndices:function(t){this._primitiveIndices=t},getPrimitiveIndices:function(){return this._primitiveIndices},setVertexIndices:function(t){this._vertexIndices=t},getVertexIndices:function(){return this._vertexIndices},getNodes:function(){return this._kdNodes},addPoint:function(t){var e=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=e,this._vertexIndices[this._numVertexIndices++]=1,this._vertexIndices[this._numVertexIndices++]=t},addLine:function(t,e){var i=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=i,this._vertexIndices[this._numVertexIndices++]=2,this._vertexIndices[this._numVertexIndices++]=t,this._vertexIndices[this._numVertexIndices++]=e},addTriangle:function(t,e,i){var r=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=r,this._vertexIndices[this._numVertexIndices++]=3,this._vertexIndices[this._numVertexIndices++]=t,this._vertexIndices[this._numVertexIndices++]=e,this._vertexIndices[this._numVertexIndices++]=i},addNode:build:function(t,e){return new Y(this).build(t,e)},_intersectFunctor:function(t,e){var i=-e._first-1,r=i+e._second,n=this._vertexIndices;t.setVertices(this._vertices),t.setPrimitiveIndex(i);for(var a=i;a<r;++a){var s=this._primitiveIndices[a],o=n[s++];3===o?t.operatorTriangle(n[s],n[s+1],n[s+2]):2===o?t.operatorLine(n[s],n[s+1]):1===o?t.operatorPoint(n[s]):z.Z.error("KdTree::intersect() unsupported vertices count :"+o)}},intersect:function(t,e){e._first<0?this._intersectFunctor(t,e):t.enter(e._bb)&&(e._first>0&&this.intersect(t,this._kdNodes[e._first]),e._second>0&&this.intersect(t,this._kdNodes[e._second]),t.leave())},intersectLineSegment:function(t,e,i,r){if(e._first<0)this._intersectFunctor(t,e);else{var n=e._nodeRayStart,a=e._nodeRayEnd;h.R3.copy(n,i),h.R3.copy(a,r);var s,o=this._kdNodes;e._first>0&&(s=o[e._first],t.enter(s._bb,n,a)&&this.intersectLineSegment(t,s,n,a)),e._second>0&&(h.R3.copy(n,i),h.R3.copy(a,r),s=o[e._second],t.enter(s._bb,n,a)&&this.intersectLineSegment(t,s,n,a))}}},"osg","KdTree");const J=Q;var $=i("CJNH"),tt=function(t){if($.Z.call(this),this._buildOptions={_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:20},t){var e=t._targetNumTrianglesPerLeaf,i=t._maxNumLevels;void 0!==e&&(this._buildOptions._targetNumTrianglesPerLeaf=e),void 0!==i&&(this._buildOptions._maxNumLevels=i)}};n.Z.createPrototypeObject(tt,n.Z.objectInherit($.Z.prototype,{apply:function(t){if(t.getShape&&void 0===t.getShape()){var e=new J;e.build(this._buildOptions,t)&&t.setShape(e)}this.traverse(t)}}),"osg","KdTreeBuilder");const et=tt;var it=i("2Vrk"),rt=i("Ln1o"),nt=function(t){a.Z.call(this),this.lineWidth=1,void 0!==t&&(this.lineWidth=t)};n.Z.createPrototypeStateAttribute(nt,n.Z.objectInherit(a.Z.prototype,{attributeType:"LineWidth",cloneType:function(){return new nt},apply:),"osg","LineWidth");const at=nt;var st=i("oHbX"),ot=i("P3GF"),ht=i("LElp"),ut=i("rfV8"),ct=i("cyFB"),lt=i("bDLW"),_t=i("gjC8"),dt=i("IpZ9"),ft=i("iUVs"),pt=i("bYH/"),gt=i("+jyg"),mt=i("e0P+"),vt=i("64xh"),bt=function(t){a.Z.call(this),this._enable=!t,this._pointSize=1,this._circleShape=!1,this._dirtyHash=!0,this._hash=""};n.Z.createPrototypeStateAttribute(bt,n.Z.objectInherit(a.Z.prototype,{attributeType:"PointSize",cloneType:function(){return new bt(!0)},setCircleShape:function(t){this._circleShape=t,this._dirtyHash=!0},isCircleShape:function(){return this._circleShape},setEnabled:function(t){this._enable=t,this._dirtyHash=!0},isEnabled:function(){return this._enable},setPointSize:function(t){this._pointSize=t},getOrCreateUniforms:function(){var t=bt;return t.uniforms||(t.uniforms={pointSize:vt.Z.createFloat(1,"uPointSize")}),t.uniforms},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+(this.isEnabled()?"1":"0")+(this._circleShape?"1":"0")},apply:function(){this._enable&&this.getOrCreateUniforms().pointSize.setFloat(this._pointSize)}}),"osg","PointSizeAttribute");const St=bt;var yt,Tt,xt,Et=i("itLJ"),Rt=[],At=[];Rt[H.Z.POINTS]=(yt=h.R3.create(),function(t,e,i,r,n){for(var a=t+e,s=t;s<a;++s){var o=3*i[s];yt[0]=n[o],yt[1]=n[o+1],yt[2]=n[o+2],r.operatorPoint(yt)}}),Rt[H.Z.LINES]=(Tt=h.R3.create(),xt=h.R3.create(),function(t,e,i,r,n){for(var a=t+e,s=t;s<a-1;s+=2){var o=3*i[s];Tt[0]=n[o],Tt[1]=n[o+1],Tt[2]=n[o+2],o=3*i[s+1],xt[0]=n[o],xt[1]=n[o+1],xt[2]=n[o+2],r.operatorLine(Tt,xt)}}),Rt[H.Z.LINE_STRIP]=function(){var t=h.R3.create(),e=h.R3.create();return function(i,r,n,a,s){for(var o=i+r,h=i;h<o-1;++h){var u=3*n[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*n[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],a.operatorLine(t,e)}}}(),Rt[H.Z.LINE_LOOP]=function(){var t=h.R3.create(),e=h.R3.create();return function(i,r,n,a,s){for(var o=i+r-1,h=i;h<o;++h){var u=3*n[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*n[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],a.operatorLine(t,e)}o=3*n[o],t[0]=s[o],t[1]=s[o+1],t[2]=s[o+2];var c=3*n[0];e[0]=s[c],e[1]=s[c+1],e[2]=s[c+2],a.operatorLine(t,e)}}(),Rt[H.Z.TRIANGLES]=function(){var t=h.R3.create(),e=h.R3.create(),i=h.R3.create();return function(r,n,a,s,o){for(var h=r+n,u=r;u<h;u+=3){var c=3*a[u];t[0]=o[c],t[1]=o[c+1],t[2]=o[c+2],c=3*a[u+1],e[0]=o[c],e[1]=o[c+1],e[2]=o[c+2],c=3*a[u+2],i[0]=o[c],i[1]=o[c+1],i[2]=o[c+2],s.operatorTriangle(t,e,i)}}}(),Rt[H.Z.TRIANGLE_STRIP]=function(){var t=h.R3.create(),e=h.R3.create(),i=h.R3.create();return function(r,n,a,s,o){for(var h=2,u=r;h<n;++h,++u){var c=3*a[u];t[0]=o[c],t[1]=o[c+1],t[2]=o[c+2],c=3*a[u+1],e[0]=o[c],e[1]=o[c+1],e[2]=o[c+2],c=3*a[u+2],i[0]=o[c],i[1]=o[c+1],i[2]=o[c+2],h%2?s.operatorTriangle(t,i,e):s.operatorTriangle(t,e,i)}}}(),Rt[H.Z.TRIANGLE_FAN]=function(){var t=h.R3.create(),e=h.R3.create(),i=h.R3.create();return function(r,n,a,s,o){for(var h=a[r],u=2,c=r+1;u<n;++u,++c){t[0]=o[h],t[1]=o[h+1],t[2]=o[h+2];var l=3*a[c];e[0]=o[l],e[1]=o[l+1],e[2]=o[l+2],l=3*a[c+1],i[0]=o[l],i[1]=o[l+1],i[2]=o[l+2],s.operatorTriangle(t,e,i)}}}(),At[H.Z.POINTS]=function(){var t=h.R3.create();return function(e,i,r,n){for(var a=e;a<e+i;++a){var s=3*a;t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],r.operatorPoint(t)}}}(),At[H.Z.LINES]=function(){var t=h.R3.create(),e=h.R3.create();return function(i,r,n,a){for(var s=i;s<i+r-1;s+=2){var o=3*s;t[0]=a[o],t[1]=a[o+1],t[2]=a[o+2],o=3*(s+1),e[0]=a[o],e[1]=a[o+1],e[2]=a[o+2],n.operatorLine(t,e)}}}(),At[H.Z.LINE_STRIP]=function(){var t=h.R3.create(),e=h.R3.create();return function(i,r,n,a){for(var s=i;s<i+r-1;++s){var o=3*s;t[0]=a[o],t[1]=a[o+1],t[2]=a[o+2],o=3*(s+1),e[0]=a[o],e[1]=a[o+1],e[2]=a[o+2],n.operatorLine(t,e)}}}(),At[H.Z.LINE_LOOP]=function(){var t=h.R3.create(),e=h.R3.create();return function(i,r,n,a){for(var s=i+r-1,o=i;o<s;++o){var h=3*o;t[0]=a[h],t[1]=a[h+1],t[2]=a[h+2],h=3*(o+1),e[0]=a[h],e[1]=a[h+1],e[2]=a[h+2],n.operatorLine(t,e)}s*=3,t[0]=a[s],t[1]=a[s+1],t[2]=a[s+2],i*=3,e[0]=a[i],e[1]=a[i+1],e[2]=a[i+2],n.operatorLine(t,e)}}(),At[H.Z.TRIANGLES]=function(){var t=h.R3.create(),e=h.R3.create(),i=h.R3.create();return function(r,n,a,s){for(var o=r;o<r+n;o+=3){var h=3*o;t[0]=s[h],t[1]=s[h+1],t[2]=s[h+2],h=3*(o+1),e[0]=s[h],e[1]=s[h+1],e[2]=s[h+2],h=3*(o+2),i[0]=s[h],i[1]=s[h+1],i[2]=s[h+2],a.operatorTriangle(t,e,i)}}}(),At[H.Z.TRIANGLE_STRIP]=function(){var t=h.R3.create(),e=h.R3.create(),i=h.R3.create();return function(r,n,a,s){for(var o=2,h=r;o<n;++o,++h){var u=3*h;t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*(h+1),e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],u=3*(h+2),i[0]=s[u],i[1]=s[u+1],i[2]=s[u+2],o%2?a.operatorTriangle(t,i,e):a.operatorTriangle(t,e,i)}}}(),At[H.Z.TRIANGLE_FAN]=function(){var t=h.R3.create(),e=h.R3.create(),i=h.R3.create();return function(r,n,a,s){for(var o=2,h=r+1;o<n;++o,++h){t[0]=s[r],t[1]=s[r+1],t[2]=s[r+2];var u=3*h;e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],u=3*(h+1),i[0]=s[u],i[1]=s[u+1],i[2]=s[u+2],a.operatorTriangle(t,e,i)}}}();const Ct=function(t,e,i){var r=t.getPrimitiveSetList();if(r)for(var n,a=r.length,s=0;s<a;s++){var o=r[s];if(o instanceof P.Z){if(n=Rt[o.getMode()]){var h=o.indices.getElements();n(o.getFirst()/h.BYTES_PER_ELEMENT,o.getCount(),h,e,i)}}else o instanceof N.Z&&(n=At[o.getMode()])&&n(o.getFirst(),o.getCount(),e,i)}};var Mt=i("5pih"),It=i("WMIH"),wt=i("hLVw"),Nt=i("gtcU"),Pt=i("QtIg"),Zt=i("7itD"),Lt=i("PNpA"),Ot=i("UAvO"),Ft=i("bfff"),Dt=i("nRYw"),Ut=i("o4nZ"),Bt=i("YVjV"),kt=i("5rJd"),Vt=function(){kt.Z.call(this),this._images={};for(var t=0;t<6;t++)this._images[kt.Z.TEXTURE_CUBE_MAP_POSITIVE_X+t]=new B.Z};n.Z.createPrototypeStateAttribute(Vt,n.Z.objectInherit(kt.Z.prototype,{setDefaultParameters:function(){kt.Z.prototype.setDefaultParameters.call(this),this._textureTarget=kt.Z.TEXTURE_CUBE_MAP,this._flipY=!1},invalidate:function(){kt.Z.prototype.invalidate.call(this);for(var t=kt.Z.TEXTURE_CUBE_MAP_POSITIVE_X;t<kt.Z.TEXTURE_CUBE_MAP_POSITIVE_X+6;t++){var e=this._images[t];this._images[kt.Z.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()&&e.dirty()}this.dirty()},cloneType:function(){return new Vt},setImage:function(t,e,i){var r=t;"string"==typeof r&&(r=kt.Z[r]),this._images[r].setImage(e,i),this.setImageFormat(i),this.setTextureSize(this._images[r].getWidth(),this._images[r].getHeight()),this._textureNull=!1,this.dirty()},getImage:initCubemapContent:function(t){var e=this._internalFormat;return this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),!0},generateMipmap:function(t,e){if(this.hasMipmapFilter()){if(this._images[kt.Z.TEXTURE_CUBE_MAP_POSITIVE_X].hasMipmap())for(var i=0;i<6;i++){var r=this._images[kt.Z.TEXTURE_CUBE_MAP_POSITIVE_X+i];r.hasMipmap()||z.Z.error("mipmap not set correctly for TextureCubemap");for(var n=this._internalFormat,a=1;a<r.getMipmap().length;a++){var s=r.getMipmap()[a].getWidth();this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,a,n,s,s,0,n,this._type,r.getMipmap()[a].getImage())}}else t.generateMipmap(e);this._dirtyMipmap=!1}},applyImageTarget:function(t,e,i){var r=this._images[i];return r.getImage()&&r.isReady()?r.isDirty()?(this.setTextureSize(r.getWidth(),r.getHeight()),r.setDirty(!1),r.isTypedArray()?this.applyTexImage2D(t,i,0,e,this._textureWidth,this._textureHeight,0,e,this._type,r.getImage()):this.applyTexImage2D(t,i,0,e,e,this._type,r.getImage()),!this._unrefImageDataAfterApply||this.hasMipmap()&&r.hasMipmap()||r.release(),1):1:0},initCubemapContentImage:function(t){var e=this._internalFormat,i=0;return i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_X),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_X),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Y),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Y),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Z),6===(i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Z))},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this.setGraphicContext(e)),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{this._textureObject||(this.computeTextureFormat(),this.init(t)),this._textureObject.bind(e),(this._images[kt.Z.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()?this.initCubemapContentImage(e):this.initCubemapContent(e))&&(this._dirty=!1,this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget))}else this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget)}}),"osg","TextureCubeMap");const Gt=Vt;var jt=i("6RPJ"),Wt=function(){},Ht=Wt.functorDrawElements=[],zt=Wt.functorDrawArrays=[];Ht[H.Z.TRIANGLES]=function(t,e,i,r){for(var n=t+e,a=t;a<n;a+=3)r(i[a],i[a+1],i[a+2])},Ht[H.Z.TRIANGLE_STRIP]=function(t,e,i,r){for(var n=2,a=t;n<e;++n,++a)n%2?r(i[a],i[a+2],i[a+1]):r(i[a],i[a+1],i[a+2])},Ht[H.Z.TRIANGLE_FAN]=function(t,e,i,r){for(var n=i[t],a=2,s=t+1;a<e;++a,++s)r(n,i[s],i[s+1])},zt[H.Z.TRIANGLES]=function(t,e,i){for(var r=2,n=t;r<e;r+=3,n+=3)i(n,n+1,n+2)},zt[H.Z.TRIANGLE_STRIP]=function(t,e,i){for(var r=2,n=t;r<e;++r,++n)r%2?i(n,n+2,n+1):i(n,n+1,n+2)},zt[H.Z.TRIANGLE_FAN]=function(t,e,i){for(var r=2,n=t+1;r<e;++r,++n)i(t,n,n+1)},Wt.prototype={init:function(t,e){this._geom=t,this._cb=e},apply:function(){var t=this._geom.getPrimitiveSetList();if(t)for(var e,i=this._cb,r=t.length,n=0;n<r;n++){var a=t[n];if(a instanceof P.Z){if(e=Ht[a.getMode()]){var s=a.indices.getElements();e(a.getFirst()/s.BYTES_PER_ELEMENT,a.getCount(),s,i)}}else a instanceof N.Z&&(e=zt[a.getMode()])&&e(a.getFirst(),a.getCount(),i)}}};const qt=Wt;var Xt=i("Qp64"),Kt=i("Yy1w"),Yt=i("rsXr"),Qt=i("pSxj"),Jt=i("6qT5"),$t=i("cnke"),te=i("ojCs"),ee=i("BvLe"),ie={};ie.AutoTransform=r.Z,ie.BillboardAttribute=o,ie.BlendColor=c,ie.BlendFunc=l.Z,ie.BoundingBox=_.Z,ie.BoundingSphere=d.Z,ie.BufferArray=f.Z,ie.BufferArrayProxy=p.Z,ie.ColorMask=v,ie.Camera=g.Z,ie.ColorMask=v,ie.ComputeBoundsVisitor=T.Z,n.Z.objectMix(ie,x.Z),ie.CullFace=E.Z,ie.CullingSet=R.Z,ie.CullSettings=A.Z,ie.CullStack=C.Z,ie.CullVisitor=M.Z,ie.Depth=I.Z,ie.DrawArrayLengths=w.Z,ie.DrawArrays=N.Z,ie.DrawElements=P.Z,ie.EllipsoidModel=L,ie.WGS_84_RADIUS_EQUATOR=L.WGS_84_RADIUS_EQUATOR,ie.WGS_84_RADIUS_POLAR=L.WGS_84_RADIUS_POLAR,ie.FrameBufferObject=O.Z,ie.FrameStamp=F.Z,ie.Geometry=D.Z,ie.GLObject=U.Z,ie.Image=B.Z,ie.ImageStream=j,ie.KdTree=J,ie.KdTreeBuilder=et,ie.Light=it.Z,ie.LightSource=rt.Z,ie.LineWidth=at,ie.Lod=st.Z,ie.Material=ot.Z,n.Z.objectMix(ie,ht.Z),ie.MatrixTransform=ut.Z,ie.PooledResource=ct.Z,ie.PooledArray=lt.Z,ie.PooledMap=_t.Z,ie.Node=dt.Z,ie.NodeVisitor=$.Z,n.Z.objectMix(ie,z.Z),ie.Object=ft.Z,ie.Options=pt.Z,ie.PagedLOD=gt.Z,ie.Plane=Et.Z,ie.PointSizeAttribute=St,ie.Polytope=mt.Z,ie.primitiveSet=H.Z,ie.primitiveFunctor=Ct,ie.primitiveIndexFunctor=W.Z,ie.Program=Mt.Z,ie.Projection=It.Z,ie.RenderBin=wt.Z,ie.RenderLeaf=Nt.Z,ie.RenderStage=Pt.Z,ie.Shader=Zt.Z,n.Z.objectMix(ie,Lt.Z),ie.StackObjectPairPool=Ot.Z,ie.State=Ft.Z,ie.StateAttribute=a.Z,ie.StateGraph=Dt.Z,ie.StateSet=Ut.Z,ie.Scissor=Yt.Z,ie.Switch=Bt.Z,ie.Texture=kt.Z,ie.TextureCubeMap=Gt,ie.Transform=jt.Z,ie.TriangleIndexFunctor=qt,ie.Uniform=vt.Z,ie.UpdateVisitor=Xt.Z,n.Z.objectMix(ie,n.Z),ie.Viewport=Kt.Z,ie.VertexArrayObject=te.Z,ie.vec2=h.sh.vec2,ie.vec3=h.sh.vec3,ie.vec4=h.sh.vec4,ie.quat=h.sh.quat,ie.mat3=h.sh.mat3,ie.mat4=h.sh.mat4,ie.Transform.RELATIVE_RF=Qt.Z.RELATIVE_RF,ie.Transform.ABSOLUTE_RF=Qt.Z.ABSOLUTE_RF,ie.Timer=Jt.Z,ie.TimerGPU=$t.Z,ie.WebGLCaps=ee.Z;const re=ie},tlSa:()=>{if(window.Set&&window.Map&&window.Uint8ClampedArray){if(Math.sign||(Math.sign=,Math.log2||(Math.log2=function(t){return Math.log(t)*Math.LOG2E}),Math.log10||(Math.log10=,String.prototype.endsWith||(String.prototype.endsWith=,String.prototype.startsWith||(String.prototype.startsWith=,!Float32Array.prototype.slice){var t=function(t,e){return new this.constructor(this.subarray(t,e))};Int8Array.prototype.slice=t,Uint8Array.prototype.slice=t,Uint8ClampedArray.prototype.slice=t,Int16Array.prototype.slice=t,Uint16Array.prototype.slice=t,Int32Array.prototype.slice=t,Uint32Array.prototype.slice=t,Float32Array.prototype.slice=t,Float64Array.prototype.slice=t}if(!new window.Set(["test"]).has("test")){var e=window.Set;window.Set=function(t){var i=new e;if(t)for(var r=0;r<t.length;++r)i.add(t[r]);return i}}if("object"==typeof window.Event){.prototype=window.Event.prototype,window.Event=i}}},"Un/q":(t,e,i)=>{"use strict";i.d(e,{Z:()=>h});var r=i("907W"),n=i("1PKS"),a=i("Z4fc"),s=[],o=[];s[r.Z.TRIANGLES]=function(t,e,i,r){for(var n=t+e,a=t;a<n;a+=3)r.operatorTriangle(i[a],i[a+1],i[a+2])},s[r.Z.TRIANGLE_STRIP]=function(t,e,i,r){for(var n=2,a=t;n<e;++n,++a)n%2?r.operatorTriangle(i[a],i[a+2],i[a+1]):r.operatorTriangle(i[a],i[a+1],i[a+2])},s[r.Z.TRIANGLE_FAN]=function(t,e,i,r){for(var n=i[t],a=2,s=t+1;a<e;++a,++s)r.operatorTriangle(n,i[s],i[s+1])},s[r.Z.POINTS]=function(t,e,i,r){for(var n=t+e,a=t;a<n;++a)r.operatorPoint(i[a])},s[r.Z.LINES]=function(t,e,i,r){for(var n=t+e,a=t;a<n;a+=2)r.operatorLine(i[a],i[a+1])},s[r.Z.LINE_STRIP]=function(t,e,i,r){for(var n=t+e,a=t;a<n;++a)r.operatorLine(i[a],i[a+1])},s[r.Z.LINE_LOOP]=function(t,e,i,r){for(var n=t+e,a=t;a<n;++a)r.operatorLine(i[a],i[a+1]);r.operatorLine(i[i.length-1],i[0])},o[r.Z.TRIANGLES]=function(t,e,i){for(var r=2,n=t;r<e;r+=3,n+=3)i.operatorTriangle(n,n+1,n+2)},o[r.Z.TRIANGLE_STRIP]=function(t,e,i){for(var r=2,n=t;r<e;++r,++n)r%2?i.operatorTriangle(n,n+2,n+1):i.operatorTriangle(n,n+1,n+2)},o[r.Z.TRIANGLE_FAN]=function(t,e,i){for(var r=2,n=t+1;r<e;++r,++n)i.operatorTriangle(t,n,n+1)},o[r.Z.POINTS]=function(t,e,i){for(var r=0,n=t;r<e;++r,++n)i.operatorPoint(n)},o[r.Z.LINES]=function(t,e,i){for(var r=1,n=t;r<e;r+=2,n+=2)i.operatorLine(n,n+1)},o[r.Z.LINE_STRIP]=function(t,e,i){for(var r=1,n=t;r<e;++r,++n)i.operatorLine(n,n+1)},o[r.Z.LINE_LOOP]=function(t,e,i){for(var r=1,n=t;r<e;++r,++n)i.operatorLine(n,n+1);i.operatorLine(t+e-1,t)};const h=function(t,e){var i=t.getPrimitiveSetList();if(i)for(var r,h=i.length,u=0;u<h;u++){var c=i[u];if(c instanceof n.Z){if(r=s[c.getMode()]){var l=c.indices.getElements();r(c.getFirst()/l.BYTES_PER_ELEMENT,c.getCount(),l,e)}}else c instanceof a.Z&&(r=o[c.getMode()])&&r(c.getFirst(),c.getCount(),e)}}},"907W":PNpA:(t,e,i)=>{"use strict";i.d(e,{Z:()=>p});var r=i("W40i"),n=i("UqX1"),a=i("6Szz"),s=i("907W"),o=i("Z4fc"),h=i("1PKS"),u=i("5pih"),c=i("7itD"),l=i("GoyH"),_=function(){var t=new a.Z,e=new l.Z.Float32Array([4,-1,-1,4,-1,-1]),i=new n.Z(n.Z.ARRAY_BUFFER,e,2);t.getAttributes().Vertex=i,t.getAttributes().TexCoord0=i;var r=new o.Z(s.Z.TRIANGLES,0,3);return t.getPrimitives().push(r),function(){return t}}(),d=function(t){void 0===t&&(t=1),void 0===d.getShader&&(d.getShader=function(){if(void 0===d.getShader.program){var t=["attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec4 vColor;","","void main(void) {","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0));","  vColor = Color;","}"].join("\n"),e=["varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"].join("\n"),i=new u.Z(new c.Z("VERTEX_SHADER",t),new c.Z("FRAGMENT_SHADER",e));d.getShader.program=i}return d.getShader.program});var e=new a.Z,i=new l.Z.Float32Array(18);i[3]=t,i[10]=t,i[17]=t;var r=new l.Z.Float32Array(24);r[0]=r[3]=1,r[4]=r[7]=1,r[9]=r[11]=1,r[13]=r[15]=1,r[18]=r[19]=1,r[22]=r[23]=1,e.getAttributes().Vertex=new n.Z(n.Z.ARRAY_BUFFER,i,3),e.getAttributes().Color=new n.Z(n.Z.ARRAY_BUFFER,r,4);var h=new o.Z(s.Z.LINES,0,6);return e.getPrimitives().push(h),e.getOrCreateStateSet().setAttributeAndModes(d.getShader()),e},f=function(t,e,i,u,c,_,d){t=t||1,u=void 0!==u?u:0,c=void 0!==c?c:2*Math.PI,_=void 0!==_?_:0,d=void 0!==d?d:Math.PI;for(var f=Math.max(3,Math.floor(e)||8),p=Math.max(2,Math.floor(i)||6),g=f*p/3>=65536,m=g?f*p*6:f*p*4,v=new l.Z.Float32Array(3*m),b=new l.Z.Float32Array(3*m),S=new l.Z.Float32Array(2*m),y=g?void 0:new l.Z.Uint16Array(f*p*6),T=0,x=0,E=new l.Z.Float32Array(3),R=new l.Z.Float32Array(3),A=new l.Z.Float32Array(3),C=new l.Z.Float32Array(3),M=new l.Z.Float32Array(3),I=new l.Z.Float32Array(3),w=new l.Z.Float32Array(3),N=new l.Z.Float32Array(3),P=new l.Z.Float32Array(2),Z=new l.Z.Float32Array(2),L=new l.Z.Float32Array(2),O=new l.Z.Float32Array(2),F=function(e,i,n,a,s){n[0]=-t*Math.cos(u+e*c)*Math.sin(_+i*d),n[1]=t*Math.cos(_+i*d),n[2]=t*Math.sin(u+e*c)*Math.sin(_+i*d),r.R3.normalize(a,n),s[0]=e,s[1]=1-i},D=0;D<p;D++)for(var U=0;U<f;U++){F((U+1)/f,D/p,E,M,P),F(U/f,D/p,R,I,Z),F(U/f,(D+1)/p,A,w,L),F((U+1)/f,(D+1)/p,C,N,O);var B=3*T;v[B]=E[0],v[B+1]=E[1],v[B+2]=E[2],v[B+3]=R[0],v[B+4]=R[1],v[B+5]=R[2],v[B+6]=A[0],v[B+7]=A[1],v[B+8]=A[2],b[B]=M[0],b[B+1]=M[1],b[B+2]=M[2],b[B+3]=I[0],b[B+4]=I[1],b[B+5]=I[2],b[B+6]=w[0],b[B+7]=w[1],b[B+8]=w[2];var k=2*T;if(S[k]=P[0],S[k+1]=P[1],S[k+2]=Z[0],S[k+3]=Z[1],S[k+4]=L[0],S[k+5]=L[1],T+=3,g)v[B=3*T]=E[0],v[B+1]=E[1],v[B+2]=E[2],v[B+3]=A[0],v[B+4]=A[1],v[B+5]=A[2],v[B+6]=C[0],v[B+7]=C[1],v[B+8]=C[2],b[B]=M[0],b[B+1]=M[1],b[B+2]=M[2],b[B+3]=w[0],b[B+4]=w[1],b[B+5]=w[2],b[B+6]=N[0],b[B+7]=N[1],b[B+8]=N[2],S[k=2*T]=P[0],S[k+1]=P[1],S[k+2]=L[0],S[k+3]=L[1],S[k+4]=O[0],S[k+5]=O[1],T+=3;else{v[B=3*T]=C[0],v[B+1]=C[1],v[B+2]=C[2],b[B]=N[0],b[B+1]=N[1],b[B+2]=N[2],S[k=2*T]=O[0],S[k+1]=O[1];var V=3*x,G=T-3;y[V]=G,y[V+1]=G+1,y[V+2]=G+2,y[V+3]=G,y[V+4]=G+2,y[V+5]=G+3,x+=2,T+=1}}var j=new a.Z;return j.getAttributes().Vertex=new n.Z("ARRAY_BUFFER",v,3),j.getAttributes().Normal=new n.Z("ARRAY_BUFFER",b,3),j.getAttributes().TexCoord0=new n.Z("ARRAY_BUFFER",S,2),g?j.getPrimitives().push(new o.Z(s.Z.TRIANGLES,0,v.length/3)):j.getPrimitives().push(new h.Z(s.Z.TRIANGLES,new n.Z("ELEMENT_ARRAY_BUFFER",y,1))),j};const p={createTexturedBoxGeometry:function(t,e,i,r,o,u){var c,_,d,f=void 0!==t?t:0,p=void 0!==e?e:0,g=void 0!==i?i:0,m=void 0!==r?r:1,v=void 0!==o?o:1,b=void 0!==u?u:1,S=new a.Z;c=m/2,_=v/2,d=b/2;var y=new l.Z.Float32Array(72),T=new l.Z.Float32Array(48),x=new l.Z.Float32Array(72);y[0]=f-c,y[1]=p-_,y[2]=g+d,x[0]=0,x[1]=-1,x[2]=0,T[0]=0,T[1]=1,y[3]=f-c,y[4]=p-_,y[5]=g-d,x[3]=0,x[4]=-1,x[5]=0,T[2]=0,T[3]=0,y[6]=f+c,y[7]=p-_,y[8]=g-d,x[6]=0,x[7]=-1,x[8]=0,T[4]=1,T[5]=0,y[9]=f+c,y[10]=p-_,y[11]=g+d,x[9]=0,x[10]=-1,x[11]=0,T[6]=1,T[7]=1,y[12]=f+c,y[13]=p+_,y[14]=g+d,x[12]=0,x[13]=1,x[14]=0,T[8]=0,T[9]=1,y[15]=f+c,y[16]=p+_,y[17]=g-d,x[15]=0,x[16]=1,x[17]=0,T[10]=0,T[11]=0,y[18]=f-c,y[19]=p+_,y[20]=g-d,x[18]=0,x[19]=1,x[20]=0,T[12]=1,T[13]=0,y[21]=f-c,y[22]=p+_,y[23]=g+d,x[21]=0,x[22]=1,x[23]=0,T[14]=1,T[15]=1,y[24]=f+c,y[25]=p-_,y[26]=g+d,x[24]=1,x[25]=0,x[26]=0,T[16]=0,T[17]=1,y[27]=f+c,y[28]=p-_,y[29]=g-d,x[27]=1,x[28]=0,x[29]=0,T[18]=0,T[19]=0,y[30]=f+c,y[31]=p+_,y[32]=g-d,x[30]=1,x[31]=0,x[32]=0,T[20]=1,T[21]=0,y[33]=f+c,y[34]=p+_,y[35]=g+d,x[33]=1,x[34]=0,x[35]=0,T[22]=1,T[23]=1,y[36]=f-c,y[37]=p+_,y[38]=g+d,x[36]=-1,x[37]=0,x[38]=0,T[24]=0,T[25]=1,y[39]=f-c,y[40]=p+_,y[41]=g-d,x[39]=-1,x[40]=0,x[41]=0,T[26]=0,T[27]=0,y[42]=f-c,y[43]=p-_,y[44]=g-d,x[42]=-1,x[43]=0,x[44]=0,T[28]=1,T[29]=0,y[45]=f-c,y[46]=p-_,y[47]=g+d,x[45]=-1,x[46]=0,x[47]=0,T[30]=1,T[31]=1,y[48]=f-c,y[49]=p+_,y[50]=g+d,x[48]=0,x[49]=0,x[50]=1,T[32]=0,T[33]=1,y[51]=f-c,y[52]=p-_,y[53]=g+d,x[51]=0,x[52]=0,x[53]=1,T[34]=0,T[35]=0,y[54]=f+c,y[55]=p-_,y[56]=g+d,x[54]=0,x[55]=0,x[56]=1,T[36]=1,T[37]=0,y[57]=f+c,y[58]=p+_,y[59]=g+d,x[57]=0,x[58]=0,x[59]=1,T[38]=1,T[39]=1,y[60]=f+c,y[61]=p+_,y[62]=g-d,x[60]=0,x[61]=0,x[62]=-1,T[40]=0,T[41]=1,y[63]=f+c,y[64]=p-_,y[65]=g-d,x[63]=0,x[64]=0,x[65]=-1,T[42]=0,T[43]=0,y[66]=f-c,y[67]=p-_,y[68]=g-d,x[66]=0,x[67]=0,x[68]=-1,T[44]=1,T[45]=0,y[69]=f-c,y[70]=p+_,y[71]=g-d,x[69]=0,x[70]=0,x[71]=-1,T[46]=1,T[47]=1;var E=new l.Z.Uint16Array(36);E[0]=0,E[1]=1,E[2]=2,E[3]=0,E[4]=2,E[5]=3,E[6]=4,E[7]=5,E[8]=6,E[9]=4,E[10]=6,E[11]=7,E[12]=8,E[13]=9,E[14]=10,E[15]=8,E[16]=10,E[17]=11,E[18]=12,E[19]=13,E[20]=14,E[21]=12,E[22]=14,E[23]=15,E[24]=16,E[25]=17,E[26]=18,E[27]=16,E[28]=18,E[29]=19,E[30]=20,E[31]=21,E[32]=22,E[33]=20,E[34]=22,E[35]=23,S.getAttributes().Vertex=new n.Z(n.Z.ARRAY_BUFFER,y,3),S.getAttributes().Normal=new n.Z(n.Z.ARRAY_BUFFER,x,3),S.getAttributes().TexCoord0=new n.Z(n.Z.ARRAY_BUFFER,T,2);var R=new h.Z(s.Z.TRIANGLES,new n.Z(n.Z.ELEMENT_ARRAY_BUFFER,E,1));return S.getPrimitives().push(R),S},createTexturedQuadGeometry:function(t,e,i,o,u,c,_,d,f,p,g,m,v){void 0===m&&void 0===v&&(m=p,v=g,p=0,g=0);var b=new a.Z,S=new l.Z.Float32Array(12);S[0]=t+_,S[1]=e+d,S[2]=i+f,S[3]=t,S[4]=e,S[5]=i,S[6]=t+o,S[7]=e+u,S[8]=i+c,S[9]=t+o+_,S[10]=e+u+d,S[11]=i+c+f,void 0===m&&(m=1),void 0===v&&(v=1);var y=new l.Z.Float32Array(8);y[0]=p,y[1]=v,y[2]=p,y[3]=g,y[4]=m,y[5]=g,y[6]=m,y[7]=v;var T=r.R3.fromValues(o,u,c);r.R3.cross(T,T,r.R3.fromValues(_,d,f)),r.R3.normalize(T,T);var x=new l.Z.Float32Array(12);x[0]=T[0],x[1]=T[1],x[2]=T[2],x[3]=T[0],x[4]=T[1],x[5]=T[2],x[6]=T[0],x[7]=T[1],x[8]=T[2],x[9]=T[0],x[10]=T[1],x[11]=T[2];var E=new l.Z.Uint16Array(6);E[0]=0,E[1]=1,E[2]=2,E[3]=0,E[4]=2,E[5]=3,b.getAttributes().Vertex=new n.Z(n.Z.ARRAY_BUFFER,S,3),b.getAttributes().Normal=new n.Z(n.Z.ARRAY_BUFFER,x,3),b.getAttributes().TexCoord0=new n.Z(n.Z.ARRAY_BUFFER,y,2);var R=new h.Z(s.Z.TRIANGLES,new n.Z(n.Z.ELEMENT_ARRAY_BUFFER,E,1));return b.getPrimitives().push(R),b},createTexturedSphereGeometry:f,createTexturedFullScreenFakeQuadGeometry:_,createAxisGeometry:d,createTexturedSphere:f,createGridGeometry:function(t,e,i,r,h,u,c,l,_,d,f){t=void 0!==t?t:-.5,e=void 0!==e?e:-.5,i=void 0!==i?i:0,r=void 0!==r?r:1,h=void 0!==h?h:0,u=void 0!==u?u:0,c=void 0!==c?c:0,l=void 0!==l?l:1,_=void 0!==_?_:0,d=void 0!==d?d:5,f=void 0!==f?f:d,d+=2,f+=2;var p=new a.Z,g=new Float32Array(2*(d+f)*3),m=0,v=0,b=r/(d-1),S=h/(d-1),y=u/(d-1),T=t+r+c,x=e+h+l,E=i+u+_;for(m=0;m<d;++m)g[v=6*m]=t+b*m,g[v+1]=e+S*m,g[v+2]=i+y*m,g[v+3]=T-b*(d-m-1),g[v+4]=x-S*(d-m-1),g[v+5]=E-y*(d-m-1);for(b=c/(f-1),S=l/(f-1),y=_/(f-1),m=0;m<f;++m)g[v=6*(d+m)]=t+b*m,g[v+1]=e+S*m,g[v+2]=i+y*m,g[v+3]=T-b*(f-m-1),g[v+4]=x-S*(f-m-1),g[v+5]=E-y*(f-m-1);p.getAttributes().Vertex=new n.Z(n.Z.ARRAY_BUFFER,g,3);var R=new o.Z(s.Z.LINES,0,2*(d+f));return p.getPrimitives().push(R),p},createBoundingBoxGeometry:function(t){var e=new a.Z,i=new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]);e.getAttributes().Vertex=new n.Z(n.Z.ARRAY_BUFFER,i,3),t||(t=[1,0,0,1]);for(var r=new l.Z.Float32Array(32),o=0;o<8;o++)for(var u=0;u<4;u++)r[3*o+u]=t[u];e.getAttributes().Color=new n.Z(n.Z.ARRAY_BUFFER,r,4);var c=new l.Z.Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);return e.getPrimitives().push(new h.Z(s.Z.LINES,new n.Z("ELEMENT_ARRAY_BUFFER",c,1))),e}}},pSxj:GoyH:(t,e,i)=>{"use strict";i.d(e,{Z:()=>g});var r=i("lZH+"),n=i.n(r),a=i("6qT5"),s=i("u5PS"),o={extend:function(){var t,e,i,r,n=window.Object.prototype.toString,a=window.Object.prototype.hasOwnProperty,s=h=o.isArray,u=function(t){if(!t||"[object Object]"!==n.call(t)||t.nodeType||t.setInterval)return!1;if(t.constructor&&!a.call(t,"constructor")&&!a.call(t.constructor.prototype,"isPrototypeOf"))return!1;var e;for(e in t);return void 0===e||a.call(t,e)},c=arguments[0]||{},l=1,_=arguments.length,d=!1;for("boolean"==typeof c&&(d=c,c=arguments[1]||{},l=2),"object"==typeof c||s(c)||(c={}),_===l&&(c=this,--l);l<_;l++)if(null!==(t=arguments[l]))for(e in t)if(i=c[e],c!==(r=t[e]))if(d&&r&&(u(r)||h(r))){var f=i&&(u(i)||h(i))?i:h(r)?[]:{};c[e]=o.extend(d,f,r)}else void 0!==r&&(c[e]=r);return c},objectInherit:function(t){.prototype=t;for(var i=new e,r=1;r<arguments.length;r++)o.objectMix(i,arguments[r],!1);return i},objectMix:function(t,e,i){for(var r in e)i&&t[r]||(t[r]=e[r]);return t},objectType:{}};o.objectType.type=0,o.arrayDense=function(t,e,i){var r=e.length;if(t>=r)for(var n=r;n<=t;n++)e.push(i?i():null)},o.objectLibraryClass=function(t,e,i){t.className=function(){return i},t.libraryName=function(){return e};var r=e+"::"+i;return t.libraryClassName=function(){return r},t},o.setTypeID=function(t){var e=t.prototype.libraryClassName(),i=o.generateId(o.objectType,e);t.typeID=t.prototype.typeID=i,t.getTypeID=t.prototype.getTypeID=function(){return i}},o.createPrototypeObject=function(t,e,i,r){e.hasOwnProperty("getTypeID")&&(e=o.objectInherit(e,{})),t.prototype=e,e.constructor=t,i&&r&&(o.objectLibraryClass(e,i,r),o.setTypeID(t))},o.generateId=function(t,e){if(void 0!==t[e])return s.Z.error(e+" is already defined, change class name or library name"),-1;var i=t.type;return t[i]=e,t[e]=i,t.type+=1,i},o.objectNodeType={},o.objectNodeType.type=0,o.setNodeTypeID=function(t){var e=t.prototype.libraryClassName(),i=o.generateId(o.objectNodeType,e);t.nodeTypeID=t.prototype.nodeTypeID=i,t.getNodeTypeID=t.prototype.getNodeTypeID=function(){return i}},o.createPrototypeNode=function(t,e,r,n){var a=i("SHDx").Z,s=e.nodeTypeID;if(o.createPrototypeObject(t,e,r,n),r&&n){o.setNodeTypeID(t);var h=t.nodeTypeID;o.arrayDense(h,a.applyFunctionArray),a.registerApplyFunction(h,a.getApplyFunction(s))}};var h=0,u=0,c={},l={},_=0,d={};o.getStateAttributeTypeNameToTypeId=function(){return d},o.createPrototypeStateAttribute=function(t,e,i,r){o.createPrototypeObject(t,e,i,r);var n=o.getOrCreateStateAttributeTypeId(t);t.prototype.attributeTypeId=n},o.getMaxStateAttributeTypeID=function(){return _},o.getOrCreateStateAttributeTypeId=function(t){var e=t.prototype.getType();if(d[e])return d[e];var i=_++;return d[e]=i,i},o.getOrCreateStateAttributeTypeMemberIndex=function(t){if(void 0!==t._attributeTypeIndex)return t._attributeTypeIndex;var e=t.getTypeMember();return t._attributeTypeIndex=o.getOrCreateStateAttributeTypeMemberIndexFromName(e),t._attributeTypeIndex},o.getOrCreateStateAttributeTypeMemberIndexFromName=function(t){var e=c[t];return void 0!==e||(e=h++,c[t]=e),e},o.getOrCreateTextureStateAttributeTypeMemberIndex=function(t){if(void 0!==t._attributeTypeIndex)return t._attributeTypeIndex;var e=t.getTypeMember();return t._attributeTypeIndex=o.getOrCreateTextureStateAttributeTypeMemberIndexFromName(e),t._attributeTypeIndex},o.getOrCreateTextureStateAttributeTypeMemberIndexFromName=function(t){var e=l[t];return void 0!==e||(e=u++,l[t]=e),e},o.getIdFromTypeMember=function(t){return c[t]},o.getTextureIdFromTypeMember=o.Int8Array=window.Int8Array,o.Uint8Array=window.Uint8Array,o.Uint8ClampedArray=window.Uint8ClampedArray,o.Int16Array=window.Int16Array,o.Uint16Array=window.Uint16Array,o.Int32Array=window.Int32Array,o.Uint32Array=window.Uint32Array,o.Float32Array=window.Float32Array,o.Float64Array=window.Float64Array;var f={},p={};o.logTime=(s.Z.console.time||function(t){f[t]=a.Z.instance().tick()}).bind(s.Z.console),o.logTimeEnd=(s.Z.console.timeEnd||function(t){if(void 0!==f[t]){var e=a.Z.instance().deltaM(f[t],a.Z.instance().tick());s.Z.log(t+": "+e+"ms"),f[t]=void 0}}).bind(s.Z.console),o.time=function(t,e){var i=e;void 0===i&&(i=s.Z.NOTICE),i>s.Z.getNotifyLevel()||(p[t]=1,o.logTime(t))},o.timeEnd=o.profile=(s.Z.console.profile||function(){}).bind(s.Z.console),o.profileEnd=(s.Z.console.profileEnd||function(){}).bind(s.Z.console),o.arrayUniq=function(t){for(var e=t.length,i={},r=[],n=0,a=0;a<e;a++){var s=t[a];1!==i[s]&&(i[s]=1,r[n++]=s)}return r},o.rejectObject=function(t,e){return e&&(t="Invalid json "+t+" "+Object.keys(e)),s.Z.warn(t),n().reject(t)},o.setStateAttributeConfig=function(t,e){t.stateAttributeConfig=e,e.attribute.forEach(o.getOrCreateStateAttributeTypeMemberIndexFromName),e.textureAttribute.forEach(o.getOrCreateTextureStateAttributeTypeMemberIndexFromName),t.validAttributeTypeMember=e.attribute,t.validTextureAttributeTypeMember=e.textureAttribute};const g=o},wLWJ:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=i("GoyH"),n=i("iUVs"),a=i("rfV8"),s=function(){n.Z.call(this)};s.checkPathIsAnimated=function(t){for(var e=0,i=t.length;e<i;++e){var r=t[e];if(r instanceof a.Z)for(var n=r.getUpdateCallbackList(),o=0,h=n.length;o<h;++o)if(n[o]instanceof s)return!0}return!1},r.Z.createPrototypeObject(s,r.Z.objectInherit(n.Z.prototype,{computeChannels:function(){},reset:function(){}}),"osgAnimation","AnimationUpdateCallback");const o=s},igDg:(t,e,i)=>{"use strict";i.d(e,{Z:()=>u});var r=i("GoyH"),n=i("W40i"),a=i("k3oU"),s=i("rfV8"),o=i("mix8"),h=function(t){void 0!==t&&this.setName(t),s.Z.call(this),this._invBindInSkeletonSpace=n._E.create(),this._boneInSkeletonSpace=n._E.create(),this._boneBoundingBox=new a.Z};r.Z.createPrototypeNode(h,r.Z.objectInherit(s.Z.prototype,{getOrCreateDebugColor:function(){return this._boneColor||(this.isSkinning()?this._boneColor=n.R3.fromValues(Math.random(),Math.random(),Math.random()):this._boneColor=n.R3.fromValues(.8,.8,.8)),this._boneColor},isSkinning:getBoneBoundingBox:function(){return this._boneBoundingBox},setBoneBoundingBox:function(t){this._boneBoundingBox=t},getMatrixInSkeletonSpace:function(){return this._boneInSkeletonSpace},getInvBindMatrixInSkeletonSpace:function(){return this._invBindInSkeletonSpace},setMatrixInSkeletonSpace:function(t){n._E.copy(this._boneInSkeletonSpace,t)},setInvBindMatrixInSkeletonSpace:function(t){n._E.copy(this._invBindInSkeletonSpace,t)},getBoneParent:function(){for(var t=this.getParents(),e=0,i=t.length;e<i;e++){if(t[e].getTypeID()===h.getTypeID())return t[e]}},setDefaultUpdateCallback:function(t){this.addUpdateCallback(new o.Z(void 0!==t?t:this.getName()))}}),"osgAnimation","Bone");const u=h},"5LU5":(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=i("GoyH"),n=i("WWMP"),a=i("64xh"),s=function(t,e){n.Z.call(this),this._nbTarget=t,this._enable=!e,this._targetNames={},this._hashNames="",this._hash="",this._dirtyHash=!0};s.uniforms={},r.Z.createPrototypeStateAttribute(s,r.Z.objectInherit(n.Z.prototype,{attributeType:"Morph",cloneType:function(){return new s(void 0,!0)},hasTarget:copyTargetNames:function(t){for(var e=this._targetNames,i="",r=e.length=t.length,n=0;n<r;++n){var a=t[n];e[a]=!0,i+=a}this._hashNames=i,this._dirtyHash=!0},getOrCreateUniforms:function(){var t=s,e=this.getNumTargets();return t.uniforms[e]||(t.uniforms[e]={uTargetWeights:a.Z.createFloat4("uTargetWeights")}),t.uniforms[e]},setNumTargets:function(t){this._nbTarget=t,this._dirtyHash=!0},getNumTargets:function(){return this._nbTarget},setTargetWeights:function(t){this._targetWeights=t},getTargetWeights:function(){return this._targetWeights},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this._hashNames+this.getNumTargets()+this.isEnabled()},apply:function(){this._enable&&this.getOrCreateUniforms().uTargetWeights.setFloat4(this._targetWeights)}}),"osgAnimation","MorphAttribute");const o=s},mixV:(t,e,i)=>{"use strict";i.d(e,{Z:()=>f});var r,n=i("GoyH"),a=i("eYxU"),s=i("u5PS"),o=i("W40i"),h=i("6Szz"),u=i("o4nZ"),c=i("5LU5"),l=i("WWMP"),_=i("k3oU"),d=function(){h.Z.call(this),this._shape=null,this._targets=[],this._stateSetAnimation=new u.Z,this._targetWeights=new Float32Array(d.MAX_MORPH_GPU),this._morphAttribute=void 0,this._morphTargetNames=void 0,this._maxMorphGPU=d.MAX_MORPH_GPU,this._isInitialized=!1};d.MAX_MORPH_GPU=4,n.Z.createPrototypeNode(d,n.Z.objectInherit(h.Z.prototype,{init:function(){return this._morphAttribute?(this._isInitialized=!0,!1):(this._morphAttribute=new c.Z(Math.min(this._maxMorphGPU,this.getMorphTargets().length)),this.getStateSetAnimation().setAttributeAndModes(this._morphAttribute,l.Z.ON),this._morphAttribute.setTargetWeights(this.getTargetsWeight()),this._targets[0]?(this._morphTargetNames=window.Object.keys(this._targets[0].getVertexAttributeList()),this._morphAttribute.copyTargetNames(this._morphTargetNames)):(this._morphTargetNames=[],s.Z.error("No Targets in the MorphGeometry !")),this._isInitialized=!0,!0)},getMaximumPossibleMorphGPU:function(){return this._maxMorphGPU},setMaximumPossibleMorphGPU:function(t){this._maxMorphGPU=t,this._isInitialized=!1,this._morphAttribute&&this._morphAttribute.setNumTargets(t)},getMorphTargetNames:function(){return this._morphTargetNames},getStateSetAnimation:function(){return this._stateSetAnimation},getMorphTargets:function(){return this._targets},isInitialized:function(){return this._isInitialized},getTargetsWeight:function(){return this._targetWeights},computeBoundingBox:(r=new _.Z,function(t){h.Z.prototype.computeBoundingBox.call(this,t);for(var e=0,i=this._targets.length;e<i;e++)t.expandByBoundingBox(this._targets[e].computeBoundingBox(r));return t}),mergeChildrenVertexAttributeList:function(){for(var t=0,e=this._targets.length;t<e;t++){var i=this._targets[t],r=i.getVertexAttributeList();for(var n in r){var s=r[n];s&&!s.getBufferArray&&(r[n]=new a.Z(s))}h.Z.appendVertexAttributeToList(i.getVertexAttributeList(),this.getVertexAttributeList(),t)}},_computeEffectiveSumWeights:function(){for(var t=0,e=this._targetWeights,i=0,r=e.length;i<r;++i){var n=e[i];Math.abs(n)<=d.EFFECTIVE_EPS||(t+=n)}var a=1e-5;return Math.abs(t)>a?t:t<0?-a:a},computeTransformedVertex:function(t,e){e=e||o.R3.create();var i=3*t,r=this._targetWeights,n=this.getVertexAttributeList(),a=n.Vertex.getElements(),s=1-this._computeEffectiveSumWeights();e[0]=s*a[i],e[1]=s*a[i+1],e[2]=s*a[i+2];for(var h=0,u=r.length;h<u;++h){var c=r[h];if(!(Math.abs(c)<=d.EFFECTIVE_EPS)){var l=n["Vertex_"+h].getElements();e[0]+=c*l[i],e[1]+=c*l[i+1],e[2]+=c*l[i+2]}}return e},computeTransformedVertices:function(){for(var t=this._targetWeights,e=this.getVertexAttributeList(),i=e.Vertex.getElements(),r=i.length,n=this._morphedVerts=this._morphedVerts||new Float32Array(r),a=1-this._computeEffectiveSumWeights(),s=0;s<r;++s)n[s]=a*i[s];for(var o=0,h=t.length;o<h;++o){var u=t[o];if(!(Math.abs(u)<=d.EFFECTIVE_EPS))for(var c=e["Vertex_"+o].getElements(),l=0;l<r;++l)n[l]+=u*c[l]}return n}}),"osgAnimation","MorphGeometry");const f=d},"5Zr1":(t,e,i)=>{"use strict";i.d(e,{Z:()=>w});var r=i("GoyH"),n=i("W40i"),a=i("6Szz"),s=i("u5PS"),o=i("PNpA"),h=i("o4nZ"),u=i("mixV"),c=i("iUVs"),l=i("CJNH"),_=i("11nE"),d=function(){l.Z.call(this,l.Z.TRAVERSE_PARENTS),this._root=void 0,this._pathToRoot=void 0};r.Z.createPrototypeObject(d,r.Z.objectInherit(l.Z.prototype,{apply:function(t){if(!this._root)return t.typeID===_.Z.typeID?(this._root=t,void(this._pathToRoot=this.nodePath.slice(1))):void this.traverse(t)}}),"osgAnimation","FindNearestParentSkeleton");const f=d;var p=function(){c.Z.call(this)};r.Z.createPrototypeObject(p,r.Z.objectInherit(c.Z.prototype,{init:function(t){var e=new f;t.getParents().length>1&&s.Z.warn("A RigGeometry should not have multi parent ( "+t.getName()+" )"),t.getParents()[0].accept(e),e._root?(t.setSkeleton(e._root),t.setPathToSkeleton(e._pathToRoot)):s.Z.warn("A RigGeometry did not find a parent skeleton for RigGeometry ( "+t.getName()+" )")},update:function(t){if(t&&"RigGeometry"!==t.className())return!0;var e=t;return e.getSkeleton()||0===e.getParents().length||this.init(e),!e.getSkeleton()||(e.getNeedToComputeMatrix()&&e.computeMatrixFromRootSkeleton(),e.update(),!0)}}),"osgAnimation","UpdateRigGeometry");const g=p;var m=i("WWMP"),v=i("4yGu"),b=i("igDg"),S=function(){l.Z.call(this,l.Z.TRAVERSE_ALL_CHILDREN),this._boneMap={}};r.Z.createPrototypeObject(S,r.Z.objectInherit(l.Z.prototype,{apply:function(t){if(t.typeID===b.Z.typeID){var e=t.getName();e?this._boneMap[e]=t:s.Z.warn("found Bone without name")}this.traverse(t)},getBoneMap:function(){return this._boneMap}}),"osgAnimation","CollectBoneVisitor");const y=S;var T,x=x.prototype={computeBonePalette:function(t,e){var i=this._bones;for(var r in t){var n=e[r],a=t[r];void 0!==n&&(i[n]=a)}return i},init:function(t){var e=new y;t.getSkeleton().accept(e);var i=e.getBoneMap();this.computeBonePalette(i,t._boneNameID);var r=3*this._bones.length,n=this._skinningAttribute=new v.Z;return n.setMatrixPalette(new Float32Array(4*r)),t.getStateSetAnimation().setAttributeAndModes(n,m.Z.ON),this._isInitialized=!0,!0},computeMatrixPalette:(T=n._E.create(),function(t,e){for(var i=this._bones,r=this._skinningAttribute.getMatrixPalette(),a=0,s=0,o=i.length;s<o;s++){var h=i[s],u=h.getInvBindMatrixInSkeletonSpace(),c=h.getMatrixInSkeletonSpace();n._E.mul(T,c,u),n._E.mul(T,e,T),n._E.mul(T,T,t),r[a++]=T[0],r[a++]=T[4],r[a++]=T[8],r[a++]=T[12],r[a++]=T[1],r[a++]=T[5],r[a++]=T[9],r[a++]=T[13],r[a++]=T[2],r[a++]=T[6],r[a++]=T[10],r[a++]=T[14]}}),update:function(t){this._isInitialized||this.init(t),this.computeMatrixPalette(t.getMatrixFromSkeletonToGeometry(),t.getInvMatrixFromSkeletonToGeometry())}};const E=x;var R=i("wLWJ"),A=i("haRL"),C=function(){a.Z.call(this),this._shape=null,this.addUpdateCallback(new g),this._root=void 0,this._pathToRoot=void 0,this._isAnimatedPath=!1,this._boneNameID={},this._matrixFromSkeletonToGeometry=n._E.create(),this._invMatrixFromSkeletonToGeometry=n._E.create(),this._rigTransformImplementation=new E,this._geometry=void 0,this._stateSetAnimation=new h.Z,this._needToComputeMatrix=!0},M=n.R3.create(),I=n.R3.create();r.Z.createPrototypeNode(C,r.Z.objectInherit(a.Z.prototype,{getStateSetAnimation:function(){return this._stateSetAnimation},getSkeleton:function(){return this._root},setSkeleton:function(t){this._root=t},setPathToSkeleton:function(t){this._pathToRoot=t,this._isAnimatedPath=R.Z.checkPathIsAnimated(t)},setNeedToComputeMatrix:function(t){this._needToComputeMatrix=t},getNeedToComputeMatrix:function(){return this._needToComputeMatrix},separateStaticBoxInGeometry:function(t,e){var i=this.getBoundingBox();if(i.valid()&&!this._staticGeomAdded){this._staticGeomAdded=!0,i.center(M),n.R3.sub(I,i.getMax(),i.getMin());var r=o.Z.createTexturedBoxGeometry(M[0],M[1],M[2],I[0],I[1],I[2]);r.setName("BoneBox"),r.setName("staticBoxOf:"+this.getName());for(var a=this.getParents(),s=0;s<a.length;++s)a[s].addChild(r);r.setCullCallback(t),r.setNodeMask(e),i.init(),this.getBoundingSphere().init()}},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex,i=this.getVertexAttributeList().Weights;if(e&&i&&e.getElements()&&e.getItemSize()>2){for(var r=i.getElements(),n=e.getElements(),a=e.getItemSize(),s=t.getMin(),o=t.getMax(),h=s[0],u=s[1],c=s[2],l=o[0],_=o[1],d=o[2],f=0,p=0,g=n.length;f<g;f+=a,p+=4)if(0===r[f]&&0===r[f+1]&&0===r[f+2]&&0===r[f+3]){var m=n[f],v=n[f+1],b=n[f+2];m<h&&(h=m),m>l&&(l=m),v<u&&(u=v),v>_&&(_=v),b<c&&(c=b),b>d&&(d=b)}s[0]=h,s[1]=u,s[2]=c,o[0]=l,o[1]=_,o[2]=d}return t},computeMatrixFromRootSkeleton:function(){this._root?(n._E.identity(this._matrixFromSkeletonToGeometry),A.Z.computeLocalToWorld(this._pathToRoot,!0,this._matrixFromSkeletonToGeometry),n._E.invert(this._invMatrixFromSkeletonToGeometry,this._matrixFromSkeletonToGeometry),this._isAnimatedPath||(this._needToComputeMatrix=!1)):s.Z.warn("Warning "+this.className()+".computeMatrixFromRootSkeleton if you have this message it means you miss to call buildTransformer( root ), or your RigGeometry ("+this.getName()+") is not attached to a Skeleton subgraph")},getMatrixFromSkeletonToGeometry:function(){return this._matrixFromSkeletonToGeometry},getInvMatrixFromSkeletonToGeometry:function(){return this._invMatrixFromSkeletonToGeometry},getSourceGeometry:function(){return this._geometry},setSourceGeometry:function(t){this._geometry=t},getBoneNameID:function(){return this._boneNameID},setBoneNameID:function(t){this._boneNameID=t},mergeChildrenVertexAttributeList:function(){this._geometry instanceof u.Z&&this._geometry.mergeChildrenVertexAttributeList();var t=this._geometry.getVertexAttributeList();a.Z.appendVertexAttributeToList(t,this.getVertexAttributeList())},mergeChildrenData:function(){this.mergeChildrenVertexAttributeList();var t=this._geometry.getPrimitiveSetList();this.getPrimitiveSetList().length=0;for(var e=0,i=t.length;e<i;e++)this.getPrimitiveSetList()[e]=t[e];this.getStateSet()&&console.error("A stateset in the rig is already present : "+this.getStateSet()),this.setStateSet(this._geometry.getStateSet())},update:computeTransformedVertex:function(t,e){e=e||n.R3.create();var i=this.getVertexAttributeList(),r=i.Weights.getElements(),a=i.Bones.getElements(),s=0,o=0,h=0;if(this._geometry.computeTransformedVertex)this._geometry.computeTransformedVertex(t,e),s=e[0],o=e[1],h=e[2];else{var u=i.Vertex.getElements();s=u[3*t],o=u[3*t+1],h=u[3*t+2]}for(var c=4*t,l=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),_=0,d=0,f=0,p=0,g=0,m=0,v=0,b=0,S=0,y=0,T=0,x=0,E=0,R=!1,A=0;A<4;++A){var C=r[c+A];if(0!==C){var M=12*a[c+A];_+=l[M+0]*C,p+=l[M+1]*C,v+=l[M+2]*C,y+=l[M+3]*C,d+=l[M+4]*C,g+=l[M+5]*C,b+=l[M+6]*C,T+=l[M+7]*C,f+=l[M+8]*C,m+=l[M+9]*C,S+=l[M+10]*C,x+=l[M+11]*C,E+=C,R=!0}}R||(e[0]=s,e[1]=o,e[2]=h);var I=1/E;return e[0]=(_*s+p*o+v*h+y)*I,e[1]=(d*s+g*o+b*h+T)*I,e[2]=(f*s+m*o+S*h+x)*I,e},computeTransformedVertices:function(){for(var t=this.getVertexAttributeList(),e=this._geometry.computeTransformedVertices?this._geometry.computeTransformedVertices():t.Vertex.getElements(),i=t.Weights.getElements(),r=t.Bones.getElements(),n=this._riggedVerts||new Float32Array(e.length),a=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),s=0,o=0,h=e.length;s<h;s+=3,o+=4){var u,c=0,l=0,_=0,d=0,f=0,p=0,g=0,m=0,v=0,b=0,S=0,y=0,T=0,x=!1,E=i[o];0!==E&&(c+=a[(u=12*r[o])+0]*E,d+=a[u+1]*E,g+=a[u+2]*E,b+=a[u+3]*E,l+=a[u+4]*E,f+=a[u+5]*E,m+=a[u+6]*E,S+=a[u+7]*E,_+=a[u+8]*E,p+=a[u+9]*E,v+=a[u+10]*E,y+=a[u+11]*E,T+=E,x=!0),0!==(E=i[o+1])&&(c+=a[(u=12*r[o+1])+0]*E,d+=a[u+1]*E,g+=a[u+2]*E,b+=a[u+3]*E,l+=a[u+4]*E,f+=a[u+5]*E,m+=a[u+6]*E,S+=a[u+7]*E,_+=a[u+8]*E,p+=a[u+9]*E,v+=a[u+10]*E,y+=a[u+11]*E,T+=E,x=!0),0!==(E=i[o+2])&&(c+=a[(u=12*r[o+2])+0]*E,d+=a[u+1]*E,g+=a[u+2]*E,b+=a[u+3]*E,l+=a[u+4]*E,f+=a[u+5]*E,m+=a[u+6]*E,S+=a[u+7]*E,_+=a[u+8]*E,p+=a[u+9]*E,v+=a[u+10]*E,y+=a[u+11]*E,T+=E,x=!0),0!==(E=i[o+3])&&(c+=a[(u=12*r[o+3])+0]*E,d+=a[u+1]*E,g+=a[u+2]*E,b+=a[u+3]*E,l+=a[u+4]*E,f+=a[u+5]*E,m+=a[u+6]*E,S+=a[u+7]*E,_+=a[u+8]*E,p+=a[u+9]*E,v+=a[u+10]*E,y+=a[u+11]*E,T+=E,x=!0);var R=e[s],A=e[s+1],C=e[s+2];if(x){var M=1/T;n[s]=(c*R+d*A+g*C+b)*M,n[s+1]=(l*R+f*A+m*C+S)*M,n[s+2]=(_*R+p*A+v*C+y)*M}else n[s]=R,n[s+1]=A,n[s+2]=C}return n}}),"osgAnimation","RigGeometry");const w=C},"11nE":(t,e,i)=>{"use strict";i.d(e,{Z:()=>_});var r=i("GoyH"),n=i("rfV8"),a=i("DZjg"),s=i("CJNH"),o=i("U5Vy"),h=i("igDg"),u=function(){s.Z.call(this,s.Z.TRAVERSE_ALL_CHILDREN)};r.Z.createPrototypeObject(u,r.Z.objectInherit(s.Z.prototype,{apply:function(t){if(t.getTypeID()===h.Z.getTypeID()){var e=t.getUpdateCallback();if(e instanceof o.Z){for(var i=e._stackedTransforms,r=0,n=i.length;r<n;r++){i[r].resetToDefaultValue()}e.computeChannels()}}this.traverse(t)}}),"osgAnimation","ResetRestPoseVisitor");var c=new u,l=function(){n.Z.call(this)};r.Z.createPrototypeNode(l,r.Z.objectInherit(n.Z.prototype,{setDefaultUpdateCallback:setRestPose:),"osgAnimation","Skeleton");const _=l},"4yGu":(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=i("GoyH"),n=i("WWMP"),a=i("64xh"),s=function(t,e){n.Z.call(this),this._enable=!t,this._boneUniformSize=e,this._dirtyHash=!0,this._hash=""};s.uniforms={},s.maxBoneUniformSize=1,s.maxBoneUniformAllowed=1/0,r.Z.createPrototypeStateAttribute(s,r.Z.objectInherit(n.Z.prototype,{attributeType:"Skinning",cloneType:function(){return new s(!0)},getBoneUniformSize:function(){return void 0!==this._boneUniformSize?this._boneUniformSize:s.maxBoneUniformSize},getOrCreateUniforms:function(){var t=s,e=this.getBoneUniformSize();return t.uniforms[e]||(t.uniforms[e]={uBones:a.Z.createFloat4Array("uBones",e)}),t.uniforms[e]},setMatrixPalette:function(t){this._matrixPalette=t,void 0===this._boneUniformSize&&(s.maxBoneUniformSize=Math.max(s.maxBoneUniformSize,t.length/4),s.maxBoneUniformSize=Math.min(s.maxBoneUniformAllowed,s.maxBoneUniformSize))},getMatrixPalette:function(){return this._matrixPalette},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!0,this._hash):this._hash},_computeInternalHash:apply:function(){this._enable&&this.getOrCreateUniforms().uBones.getInternalArray().set(this._matrixPalette)}}),"osgAnimation","SkinningAttribute");const o=s},mix8:(t,e,i)=>{"use strict";i.d(e,{Z:()=>u});var r=i("GoyH"),n=i("u5PS"),a=i("U5Vy"),s=i("W40i"),o=i("CJNH"),h=function(){a.Z.call(this)};r.Z.createPrototypeObject(h,r.Z.objectInherit(a.Z.prototype,{update:function(t,e){if(e.getVisitorType()===o.Z.UPDATE_VISITOR){if(t.className&&"Bone"!==t.className())return n.Z.warn("Warning: UpdateBone set on non-Bone object."),!1;var i=t;a.Z.prototype.update.call(this,t),i.setMatrix(i.getMatrix());var r=i.getMatrix(),h=i.getBoneParent();h?s._E.mul(i.getMatrixInSkeletonSpace(),h.getMatrixInSkeletonSpace(),r):i.setMatrixInSkeletonSpace(r)}return!0}}),"osgAnimation","UpdateBone");const u=h},U5Vy:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=i("GoyH"),n=i("W40i"),a=i("wLWJ"),s=function(){a.Z.call(this),this._stackedTransforms=[],this._matrix=n._E.create(),this._dirty=!1};r.Z.createPrototypeObject(s,r.Z.objectInherit(a.Z.prototype,{getStackedTransforms:function(){return this._stackedTransforms},setMatrix:function(t){n._E.copy(this._matrix,t),this._dirty=!0},getMatrix:function(){return this._matrix},computeChannels:function(){this._dirty=!0;var t=this._matrix;n._E.identity(t);for(var e=this._stackedTransforms,i=0,r=e.length;i<r;i++){e[i].applyToMatrix(t)}},reset:update:function(t){return n._E.copy(t.getMatrix(),this._matrix),this._dirty&&(t.dirtyBound(),this._dirty=!1),!0}}),"osgAnimation","UpdateMatrixTransform");const o=s},DZjg:(t,e,i)=>{"use strict";i.d(e,{Z:()=>l});var r=i("GoyH"),n=i("igDg"),a=i("CJNH"),s=i("u5PS"),o=i("iUVs"),h=function(){a.Z.call(this)};r.Z.createPrototypeObject(h,r.Z.objectInherit(a.Z.prototype,{apply:function(t){if(t.getTypeID()===n.Z.getTypeID()){for(var e=!1,i=t.getChildren(),r=0,a=t.getChildren().length;r<a;r++){if(i[r].getTypeID()===n.Z.getTypeID()){if(e)return void s.Z.warn("Warning: a Bone was found after a non-Bone child within a Skeleton. Children of a Bone must be ordered with all child Bones first for correct update order.")}else e=!0}this.traverse(t)}}}),"osgAnimation","ValidateSkeletonVisitor");var u=function(t,e){return(t instanceof n.Z?0:1)-(e instanceof n.Z?0:1)},c=function(){this._needValidate=!0};r.Z.createPrototypeObject(c,r.Z.objectInherit(o.Z.prototype,{needToValidate:function(){return this._needValidate},update:function(t,e){if(this._needValidate&&e.getVisitorType()===a.Z.UPDATE_VISITOR&&t.className&&"Skeleton"===t.className()){for(var i=new h,r=t.getChildren(),n=0,s=r.length;n<s;n++){r[n].accept(i)}r.sort(u),this._needValidate=!1}return!0}}),"osgAnimation","UpdateSkeleton");const l=c},LvhW:(t,e,i)=>{"use strict";i.d(e,{Z:()=>g});var r=i("lZH+"),n=i.n(r),a=i("GoyH"),s=i("CJNH"),o=i("+jyg"),h=i("6qT5"),u=function(){s.Z.call(this,s.Z.TRAVERSE_ALL_CHILDREN),this._activePagedLODList=void 0,this._frameNumber=0};a.Z.createPrototypeObject(u,a.Z.objectInherit(s.Z.prototype,{apply:function(t){t.getTypeID()===o.Z.getTypeID()&&(t.setFrameNumberOfLastTraversal(this._frameNumber),this._activePagedLODList.add(t)),this.traverse(t)},set:function(t,e){this._activePagedLODList=t,this._frameNumber=e}}),"osgDB","FindPagedLODsVisitor");var c=a.Z.createPrototypeObject(c,a.Z.objectInherit(s.Z.prototype,{apply:),"osgDB","ReleaseVisitor");var l=function(){s.Z.call(this,s.Z.TRAVERSE_ALL_CHILDREN),this._childrenList=[]};a.Z.createPrototypeObject(l,a.Z.objectInherit(s.Z.prototype,{apply:function(t){t.getTypeID()===o.Z.getTypeID()&&(this._childrenList.push(t),this._markRequestsExpired(t)),this.traverse(t)},removeExpiredChildrenAndFindPagedLODs:function(t,e,i,r){if(!t.children.length)return!1;var n=r.length;t.removeExpiredChildren(e,i,r);for(var a=n;a<r.length;a++)r[a].accept(this);return n!==r.length},_markRequestsExpired:function(t){for(var e,i=t._perRangeDataList.length,r=0;r<i;r++)void 0!==(e=t.getDatabaseRequest(r))&&(e._groupExpired=!0,e._loadedModel=null)},reset:function(){this._childrenList.length=0}}),"osgDB","ExpiredPagedLODVisitor");var _=function(t,e){return e._timeStamp-t._timeStamp},d=function(t,e){var i=t._timeStamp-e._timeStamp;return 0===i&&(i=t._priority-e._priority),i},f=function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._progressCallback=void 0,this._lastCB=!0,this._activePagedLODList=new Set,this._childrenToRemoveList=new Set,this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._releaseVisitor=new c,this._expiredPagedLODVisitor=new l,this._findPagedLODsVisitor=new u,this._targetMaximumNumberOfPagedLOD=75,this._elapsedTime=0,this._beginTime=0,this._availableTime=0},p=function(){this._loadedModel=void 0,this._group=void 0,this._url=void 0,this._function=void 0,this._timeStamp=0,this._groupExpired=!1,this._priority=0};a.Z.createPrototypeObject(f,{setTargetMaximumNumberOfPageLOD:function(t){this._targetMaximumNumberOfPagedLOD=t},getTargetMaximumNumberOfPageLOD:function(){return this._targetMaximumNumberOfPagedLOD},setAcceptNewDatabaseRequests:function(t){this._acceptNewRequests=t},getAcceptNewDatabaseRequests:function(){return this._acceptNewRequests},reset:function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._lastCB=!0,this._activePagedLODList.clear(),this._childrenToRemoveList.clear(),this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},updateSceneGraph:function(t){void 0!==this._progressCallback&&this.executeProgressCallback(),this.removeExpiredSubgraphs(t,.0025),this.takeRequests(),this.addLoadedDataToSceneGraph(t,.005)},executeProgressCallback:function(){this._pendingRequests.length>0||this._pendingNodes.length>0?(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!1):this._lastCB||(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!0)},setMaxRequestsPerFrame:function(t){this._maxRequestsPerFrame=t},getMaxRequestsPerFrame:function(){return this._maxRequestsPerFrame},getRequestListSize:setProgressCallback:function(t){this._progressCallback=t},addLoadedDataToSceneGraph:function(t,e){if(!this._pendingNodes.length||e<=0)return 0;var i=0,r=h.Z.instance().tick();this._pendingNodes.sort(_);for(var n=0;n<this._pendingNodes.length;n++){if(i>e)return 0;var a=this._pendingNodes.shift(),s=t.getFrameNumber(),o=t.getSimulationTime();if(!1===a._groupExpired){var u=a._group;u.setTimeStamp(u.children.length,o),u.setFrameNumber(u.children.length,s),u.addChildNode(a._loadedModel),this._activePagedLODList.has(u)?this.registerPagedLODs(a._loadedModel,s):this.registerPagedLODs(u,s)}else a._loadedModel=void 0,a=void 0;i=h.Z.instance().deltaS(r,h.Z.instance().tick())}return e-=i},isLoading:function(){return this._loading},registerPagedLODs:function(t,e){t&&(this._findPagedLODsVisitor.set(this._activePagedLODList,e),t.accept(this._findPagedLODsVisitor))},requestNodeFile:function(t,e,i,r,n){if(this._acceptNewRequests){var a=new p;return a._group=i,a._function=t,a._url=e,a._timeStamp=r,a._priority=n,this._pendingRequests.push(a),a}},takeRequests:function(){if(this._pendingRequests.length){var t=Math.min(this._maxRequestsPerFrame,this._pendingRequests.length);this._pendingRequests.sort(d);for(var e=0;e<t;e++)this._downloadingRequestsNumber++,this.processRequest(this._pendingRequests.shift())}},processRequest:function(t){this._loading=!0;var e=this;if(t._groupExpired)return e._downloadingRequestsNumber--,void(this._loading=!1);void 0!==t._function?this.loadNodeFromFunction(t._function,t._group).then((function(i){e._downloadingRequestsNumber--,t._loadedModel=i,e._pendingNodes.push(t),e._loading=!1})):""!==t._url&&this.loadNodeFromURL(t._url).then((function(i){e._downloadingRequestsNumber--,t._loadedModel=i,e._pendingNodes.push(t),e._loading=!1}))},loadNodeFromFunction:function(t,e){var i=t(e);return i?i&&i.then?i:n().resolve(i):n().reject()},loadNodeFromURL:releaseGLExpiredSubgraphs:function(t){return this._availableTime=t,!this._childrenToRemoveList.size||t<=0?0:(this._elapsedTime=0,this._beginTime=h.Z.instance().tick(),this._childrenToRemoveList.forEach(this._releaseExpiredSubgraphs,this),this._availableTime-=this._elapsedTime,this._availableTime)},_releaseExpiredSubgraphs:function(t){this._elapsedTime>this._availableTime||(this._childrenToRemoveList.delete(t),t.accept(this._releaseVisitor),t.removeChildren(),t=null,this._elapsedTime=h.Z.instance().deltaS(this._beginTime,h.Z.instance().tick()))},removeExpiredSubgraphs:function(t,e){if(0===t.getFrameNumber())return 0;var i=this._activePagedLODList.size-this._targetMaximumNumberOfPagedLOD,r=t.getSimulationTime()-.1,n=t.getFrameNumber()-1;return i>0&&(e=this.removeExpiredChildren(i,r,n,e)),e},removeExpiredChildren:function(t,e,i,r){var n=0,a=h.Z.instance().tick(),s=this,o=[],u=this._expiredPagedLODVisitor;return u.reset(),this._activePagedLODList.forEach((function(c){if(n>r)return 0;if(t<0)return r;if(i<c.getFrameNumberOfLastTraversal())return r;u.removeExpiredChildrenAndFindPagedLODs(c,e,i,o);for(var l=0;l<u._childrenList.length;l++)s._activePagedLODList.delete(u._childrenList[l]),t--;for(l=0;l<o.length;l++)s._childrenToRemoveList.add(o[l]);u._childrenList.length=0,o.length=0,n=h.Z.instance().deltaS(a,h.Z.instance().tick())})),r-=n}},"osgDB","DatabasePager");const g=f},RqNa:(t,e,i)=>{"use strict";i.d(e,{Z:()=>S});var r=i("lZH+"),n=i.n(r),a=i("GoyH"),s=i("I50a"),o=i("dPdN");const h={prefixURL:"",databasePath:"",progressXHRCallback:void 0,readNodeURL:void 0,readImageURL:void 0,readBinaryArrayURL:void 0,imageLoadingUsePromise:!0,imageOnload:void 0,imageCrossOrigin:void 0};var u,c=i("pwEu"),l=i("u5PS"),_=i("uHj6"),d=i("UqX1"),f=i("Z4fc"),p=i("Q/WO"),g=i("1PKS"),m=i("907W"),v=a.Z.rejectObject,b=function(t,e){this._json=t;var i=e;void 0===i&&(i={}),this._identifierMap=i,this._objectRegistry={},this._cacheReadObject={},this.setOptions(a.Z.objectMix({},h))};b.imageFallback||(b.imageFallback=((u=new window.Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",u)),b.prototype={clone:setOptions:function(t){this._defaultOptions=t},getOptions:function(){return this._defaultOptions},setProgressXHRCallback:function(t){this._defaultOptions.progressXHRCallback=t},setReadNodeURLCallback:function(t){this._defaultOptions.readNodeURL=t},registerObject:function(t,e){this._objectRegistry[t]=e},getJSON:function(){return this._json},setJSON:setPrefixURL:function(t){this._defaultOptions.prefixURL=t},getPrefixURL:function(){return this._defaultOptions.prefixURL},setDatabasePath:function(t){this._defaultOptions.databasePath=t},getDatabasePath:function(){return this._defaultOptions.databasePath},computeURL:function(t){return"string"==typeof this._defaultOptions.prefixURL&&this._defaultOptions.prefixURL.length>0?this._defaultOptions.prefixURL+t:t},requestFile:getObjectWrapper:function(t){if(this._objectRegistry[t])return new this._objectRegistry[t];for(var e=s.Z,i=t.split("."),r=0,n=i.length;r<n;r++){var a=e[i[r]];if(void 0===a)return;e=a}return this._objectRegistry[t]=e,new e},fetchImage:function(t,e,i){var r="data:image/",a=e.substring(0,r.length)===r,s=new window.Image;return!a&&i.imageCrossOrigin&&(s.crossOrigin=i.imageCrossOrigin),t.setURL(e),t.setImage(s),s.src=e,new(n())((function(r){s.onerror=function(){l.Z.warn("warning use white texture as fallback instead of "+e),t.setImage(b.imageFallback),r(t)},s.onload=function(){i.imageOnload&&i.imageOnload.call(t),r(t)}}))},readImageURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readImageURL)return e.readImageURL.call(this,t,e);"data:image"!==t.substr(0,10)&&(t=this.computeURL(t));var i=new _.Z;return this.fetchImage(i,t,e)},readNodeURL:function(t,e){var r=e;if(void 0===r&&(r=this._defaultOptions),r.readNodeURL)return r.readNodeURL.call(this,t,r);t=this.computeURL(t);var n=this;if(!(r=a.Z.objectMix({},r)).prefixURL){var s=n.getPrefixURL(),o=t.lastIndexOf("/");-1!==o&&(s=t.substring(0,o+1)),r.prefixURL=s}var h=i("Hiiq").Z,u=function(e){return h.parseSceneGraph(e,r).then((function(e){return l.Z.log("loaded "+t),e}))};return a.Z.time("osgjs.metric:Input.readNodeURL",l.Z.INFO),n.requestFile(t).then((function(e){var i;try{i=JSON.parse(e)}catch(e){l.Z.error("cant parse url "+t+" try to gunzip")}return i?u(i):n.requestFile(t,{responseType:"arraybuffer"}).then((function(t){var e,r,n=(r=e=t,c.Z.isGunzipBuffer(e)&&(r=c.Z.gunzip(e)),function(t){for(var e,i="",r=0,n=t.length;r<n;++r)i+="%"+((e=t[r].toString(16)).length<2?"0"+e:e);return decodeURIComponent(i)}(new Uint8Array(r)));return i=JSON.parse(n),u(i)})).catch((function(e){var i="cant read file "+t+" status "+e;return l.Z.error(i),i}))})).catch((function(e){var i="cant get file "+t+" status "+e;return l.Z.error(i),i})).finally((function(){a.Z.timeEnd("osgjs.metric:Input.readNodeURL")}))},_unzipTypedArray:function(t){var e=new Uint8Array(t);if(31===e[0]&&139===e[1]){var r=i("zpE6");return r||l.Z.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server"),new r.Gunzip(e).decompress().buffer}return t},readBinaryArrayURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readBinaryArrayURL)return e.readBinaryArrayURL.call(this,t,e);if(t=this.computeURL(t),void 0!==this._identifierMap[t])return this._identifierMap[t];var i=this.requestFile(t,{responseType:"arraybuffer",progress:this._defaultOptions.progressXHRCallback}),r=this;return this._identifierMap[t]=i.then((function(t){return r._unzipTypedArray(t)})),this._identifierMap[t]},initializeBufferArray:function(t,e,i,r){if(void 0===r&&(r=this.getOptions()),r.initializeBufferArray)return r.initializeBufferArray.call(this,t,e,i);var n=t.File;return this.readBinaryArrayURL(n).then((function(r){var n,s,o,h;o=new Uint8Array([18,52]),h=new Uint16Array(o.buffer),s="1234"===h[0].toString(16);var u=0;void 0!==t.Offset&&(u=t.Offset);var c=a.Z[e].BYTES_PER_ELEMENT,_=t.Size,d=i.getItemSize(),f=_*c*d;if(s){l.Z.log("big endian detected");var p=new(0,a.Z[e])(_*d),g=new DataView(r,u,f),m=0,v=p.length;if("Uint16Array"===e)for(;m<v;m++)p[m]=g.getUint16(m*c,!0);else if("Float32Array"===e)for(;m<v;m++)p[m]=g.getFloat32(m*c,!0);n=p,g=null}else n=new a.Z[e](r,u,d*_);return i.setElements(n),i}))},readBufferArray:function(t){var e,i,r=this.getJSON(),s=r.UniqueID;if(void 0!==s&&void 0!==(e=this._identifierMap[s]))return e;if(void 0===t&&(t=this.getOptions()),t.readBufferArray)return t.readBufferArray.call(this);if(!r.Elements&&!r.Array||!r.ItemSize||!r.Type)return v("BufferArray",r);if(r.Elements)i=n().resolve(new d.Z(d.Z[r.Type],r.Elements,r.ItemSize));else if(r.Array){var o,h,u=new d.Z(d.Z[r.Type]);if(u.setItemSize(r.ItemSize),r.Array.Float32Array?(o=r.Array.Float32Array,h="Float32Array"):r.Array.Uint16Array?(o=r.Array.Uint16Array,h="Uint16Array"):r.Array.Uint8Array&&(o=r.Array.Uint8Array,h="Uint8Array"),void 0===o)return v("Typed Array "+window.Object.keys(r.Array)[0]);o.File?i=this.initializeBufferArray(o,h,u):o.Elements&&(u.setElements(new a.Z[h](o.Elements)),i=n().resolve(u))}return void 0!==s&&(this._identifierMap[s]=i),i},readUserDataContainer:function(){var t,e=this.getJSON(),i=e.UniqueID;return void 0!==i&&void 0!==(t=this._identifierMap[i])?t.Values:(this._identifierMap[i]=e,e.Values)},readPrimitiveSet:function(){var t,e,i,r,a,s,o,h=this.getJSON(),u=h.DrawElementUShort||h.DrawElementUByte||h.DrawElementUInt||h.DrawElementsUShort||h.DrawElementsUByte||h.DrawElementsUInt,c=h.DrawArray||h.DrawArrays,l=h.DrawArrayLengths;if(u){if(void 0!==(t=u.UniqueID)&&void 0!==(e=this._identifierMap[t]))return e;a=u.Mode?m.Z[u.Mode]:m.Z.TRIANGLES,r=new g.Z(a),this.setJSON(u.Indices),i=this.readBufferArray().then((function(t){return r.setIndices(t),r})),this.setJSON(h)}else if(c){if(void 0!==(t=c.UniqueID)&&void 0!==(e=this._identifierMap[t]))return e;a=c.Mode||c.mode,s=void 0!==c.First?c.First:c.first,o=void 0!==c.Count?c.Count:c.count,r=new f.Z(m.Z[a],s,o),i=n().resolve(r)}else if(l){if(void 0!==(t=l.UniqueID)&&void 0!==(e=this._identifierMap[t]))return e;a=l.Mode,s=l.First;var _=l.ArrayLengths;r=new p.Z(m.Z[a],s,_),i=n().resolve(r)}else i=v("PrimitiveSet",h);return void 0!==t&&(this._identifierMap[t]=i),i},readObject:function(){var t=this.getJSON(),e=window.Object.keys(t),r=e[0];if(!r)return v("can't find property for object "+e);var n,a=t[r].UniqueID;if(void 0!==a&&void 0!==(n=this._identifierMap[a]))return n;var s=this.getObjectWrapper(r);if(!s)return v("can't instanciate object "+r);var o=i("Hiiq").Z.ObjectWrapper.serializers;if(this._cacheReadObject[r])o=this._cacheReadObject[r];else{for(var h=r.split("."),u=0,c=h.length;u<c;u++){var l=h[u],_=o[l];if(!_)return v("Unknown scope "+r+"("+l+")");o=_}this._cacheReadObject[r]=o}var d=o(this.setJSON(t[r]),s);return void 0!==a&&(this._identifierMap[a]=d,s._uniqueID=a),d}};const S=b},sSQ9:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i("u5PS"),n={instance:function(){return n._instance||(n._instance=n,n._instance.plugins=new window.Map),n._instance},addReaderWriter:function(t,e){void 0!==n.instance().plugins.get(t)&&r.Z.warn("the '"+t+"' plugin already exists"),n.instance().plugins.set(t,e)},getReaderWriterForExtension:;const a=n},dPdN:(t,e,i)=>{"use strict";i.d(e,{Z:()=>b});var r=i("lZH+"),n=i.n(r),a=i("Hiiq"),s=i("sSQ9"),o=i("1Xhw"),h=i("u5PS"),u=c=window.zip,l=new window.Map,_=function(t){return new(n())((function(e,i){var r=new window.Image;r.onerror=function(){i(r)},r.onload=function(){e(r)},r.src=t}))},d=function(t){var e=window.URL.createObjectURL(t),i=_(e);return i.finally((),i},f=function(t){return new(n())((function(e,i){var r=new window.FileReader;r.onerror=function(){i(r)},r.onload=r.readAsArrayBuffer(t)}))},p=g=m=function(t){var e=JSON.parse(t);return n().resolve(e)},v={createJSONFromURL:g,createArrayBufferFromURL:p,createArrayBufferFromBlob:f,createImageFromBlob:d,createImageFromURL:_,requestURI:o.Z,requestResource:function(t,e){var i=v.getExtension(t),r=v.getMimeType(i);if(e&&e.responseType?e.responseType.toLowerCase():void 0)return(0,o.Z)(t,e);if(r){if(r.match("image"))return _(t);if(r.match("binary"))return p(t);if(r.match("json"))return g(t);if(r.match("text"))return(0,o.Z)(t)}return(0,o.Z)(t)},resolveData:function(t,e){var i,r,a=v.getExtension(t),s=v.getMimeType(a);return s&&(s.match("image")?u(e)?i=_:e instanceof window.Blob&&(i=d):s.match("json")?i=u(r=e)&&(r)||r))?g:m:s.match("binary")&&(u(e)?i=p:e instanceof window.Blob&&(i=f))),i?i(e):n().resolve(e)},resolveFilesMap:function(t){var e=[];for(var i in t){var r=t[i],a=v.resolveData(i,r).then(bind(t,i));e.push(a)}return n().all(e).then((function(){return t}))},_unzipEntry:function(t){return new(n())((function(e){var i=t.filename,r=v.getExtension(i),n=v.getMimeType(r),a=c.BlobWriter;null===n.match("text")&&null===n.match("json")||(a=c.TextWriter),t.getData(new a(n),()}))},unzipBlob:function(t){return new(n())((function(e,i){var r={},a=[];c.createReader(new c.BlobReader(t),(function(t){t.getEntries((function(i){for(var s=0;s<i.length;s++)if(!i[s].directory){var o=v._unzipEntry(i[s]);o.then((),a.push(o)}n().all(a).then((function(){t.close(),v.resolveFilesMap(r).then(()}))}))}),()}))},unzip:function(t){if(!window.zip)return n().reject("missing deps to unzip, require https://github.com/gildas-lormeau/zip.js");if(u(t))return v.requestResource(t).then((function(t){var e=new window.Blob([t],{type:l.get("zip")});return v.unzipBlob(e)}));if(t instanceof window.Blob)return v.unzipBlob(t);if(t instanceof window.ArrayBuffer){var e=new window.Blob([t],{type:l.get("zip")});return v.unzipBlob(e)}return n().reject("cant unzip input")},readFileList:function(t){var e,i,r={},h=[];for(i=0;i<t.length;++i){var u=v.getExtension(t[i].name);void 0===s.Z.instance().getReaderWriterForExtension(u)&&"osgjs"!==u||(e=t[i].name);var c,l=v.getMimeType(u);c=l.match("image")?"blob":l.match("json")||l.match("text")?"string":"arraybuffer",h.push((0,o.Z)(t[i],{responseType:c}))}return n().all(h).then((function(n){for(i=0;i<n.length;++i)r[t[i].name]=n[i];return v.resolveFilesMap(r).then(()}))},getMimeType:function(t){return l.get(t)},getExtension:addMimeTypeForExtension:function(t,e){void 0!==l.has(t)&&h.Z.warn("the '"+t+"' already has a mimetype: "+l.get(t)),l.set(t,e)}};l.set("bin","application/octet-binary"),l.set("b3dm","application/octet-binary"),l.set("glb","application/octet-binary"),l.set("zip","application/octet-binary"),l.set("gz","application/octet-binary"),l.set("png","image/png"),l.set("jpg","image/jpeg"),l.set("jpeg","image/jpeg"),l.set("gif","image/gif"),l.set("json","application/json"),l.set("gltf","application/json"),l.set("osgjs","application/json"),l.set("txt","text/plain"),l.set("glsl","text/plain");const b=v},Hiiq:(t,e,i)=>{"use strict";i.d(e,{Z:()=>b});var r=i("u5PS"),n=i("GoyH"),a=i("64xh"),s=i("f7MS"),o=i("6Szz"),h=i("UqX1"),u=i("907W"),c=i("Z4fc"),l=i("1PKS"),_=i("o4nZ"),d=i("IpZ9"),f=i("W40i"),p=i("rfV8"),g=i("WMIH"),m=i("sSQ9"),v={ObjectWrapper:{}};v.ObjectWrapper.serializers={},v.readImage=function(t,e){return v.registry().readImageURL(t,e)},v.readImageURL=v.readImage,v.readBinaryArrayURL=v.readNodeURL=function(t,e){var i=t.substr(t.lastIndexOf(".")+1),r=m.Z.instance().getReaderWriterForExtension(i);return void 0!==r?r.readNodeURL(t,e):v.registry().readNodeURL(t,e)},v.registry=function(){var t=i("RqNa").Z;return void 0===v.registry._input&&(v.registry._input=new t),v.registry._input},v.parseSceneGraph=function(t,e){if(!(void 0!==t.Version&&t.Version>0)){n.Z.time("osgjs.metric:ReaderParser.parseSceneGraphDeprecated",r.Z.INFO);var i=v.parseSceneGraphDeprecated(t);return n.Z.timeEnd("osgjs.metric:ReaderParser.parseSceneGraphDeprecated",r.Z.INFO),i}var a;for(var s in n.Z.time("osgjs.metric:ReaderParser.parseSceneGraph",r.Z.INFO),t)if("Generator"!==s&&"Version"!==s){a=s;break}if(a){var o={};o[a]=t[a];var h=v.registry().clone();h.setJSON(o);var u=n.Z.objectMix(n.Z.objectMix({},v.registry().getOptions()),e||{});h.setOptions(u);var c=h.readObject();return n.Z.timeEnd("osgjs.metric:ReaderParser.parseSceneGraph",r.Z.INFO),c}r.Z.log("can't parse scenegraph "+t,r.Z.INFO)},v.parseSceneGraphDeprecated=function(t){var e,m=function(t,e){var i=e[t];return void 0===i&&(i=e[t.toLowerCase()]),i},b=function(t,e){var i=m("Name",e);i&&void 0!==t.setName&&t.setName(i)},S=function(t,e){var i=e.MagFilter||e.mag_filter||void 0;i&&t.setMagFilter(i);var n=e.MinFilter||e.min_filter||void 0;n&&t.setMinFilter(n);var a=e.WrapT||e.wrap_t||void 0;a&&t.setWrapT(a);var s=e.WrapS||e.wrap_s||void 0;s&&t.setWrapS(s);var o=m("File",e);v.readImage(o).then((function(e){t.setImage(e)})).catch((function(){r.Z.log("Can't read image")}))},y=t.children,T=t._primitives||t.primitives||t.Primitives||void 0,x=t._attributes||t.attributes||t.Attributes||void 0;if(T||x){var E=new o.Z;b(E,t),E.stateset=t.stateset,t=E;for(var R=0,A=T.length;R<A;R++){var C=T[R].mode;if(T[R].indices){var M=T[R].indices;M=new h.Z(h.Z[M.type],M.elements,M.itemSize),C=C?u.Z[C]:"TRIANGLES",E.getPrimitiveSetList().push(new l.Z(C,M))}else{C=u.Z[C];var I=T[R].first,w=T[R].count;E.getPrimitiveSetList().push(new c.Z(C,I,w))}}for(var N in x){var P=x[N];E.getVertexAttributeList()[N]=new h.Z(P.type,P.elements,P.itemSize)}}var Z=m("StateSet",t);if(Z){var L=new _.Z;!function(t,e){b(t,e);var n=m("Textures",e)||m("TextureAttributeList",e)||void 0;if(n)for(var o=0,h=n.length;o<h;o++)if(m("File",n[o])){var u=new(0,i("5rJd").Z);S(u,n[o]),t.setTextureAttributeAndModes(o,u),t.addUniform(a.Z.createInt1(o,"Texture"+o))}else r.Z.log("no texture on unit "+o+" skip it");var c=m("BlendFunc",e);if(c){var l=new s.Z;!function(t,e){b(t,e),t.setSourceRGB(e.SourceRGB),t.setSourceAlpha(e.SourceAlpha),t.setDestinationRGB(e.DestinationRGB),t.setDestinationAlpha(e.DestinationAlpha)}(l,c),t.setAttributeAndModes(l)}var _=m("Material",e);if(_){var d=new(0,i("P3GF").Z);!function(t,e){b(t,e),t.setAmbient(m("Ambient",e)),t.setDiffuse(m("Diffuse",e)),t.setEmission(m("Emission",e)),t.setSpecular(m("Specular",e)),t.setShininess(m("Shininess",e))}(d,_),t.setAttributeAndModes(d)}}(L,Z),t.stateset=L}var O=t.matrix||t.Matrix||void 0;O&&(e=new p.Z,b(e,t),n.Z.extend(e,t),f._E.copy(e.getMatrix(),O),t=e);var F=t.projection||t.Projection||void 0;if(F&&(e=new g.Z,b(e,t),n.Z.extend(e,t),f._E.copy(e.setProjectionMatrix(),F),t=e),void 0===t.typeID&&(e=new d.Z,b(e,t),n.Z.extend(e,t),t=e),y){t.children=[];for(var D=0,U=y.length;D<U;D++)t.addChild(v.parseSceneGraphDeprecated(y[D]))}return t};const b=v},"1Xhw":(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i("lZH+"),n=i.n(r);const a=function(t,e){return"string"==typeof t?function(t,e){return new(n())((function(i,r){var n=new XMLHttpRequest;n.open("GET",t,!0);var a=e&&e.responseType?e.responseType.toLowerCase():void 0;a&&(n.responseType=a),e&&e.progress&&n.addEventListener("progress",e.progress,!1),n.addEventListener("error",r,!1),n.addEventListener("load",(function(){"arraybuffer"===n.responseType||"blob"===n.responseType?i(n.response):i(n.responseText)})),n.send(null)}))}(t,e):function(t,e){return new(n())((function(i){var r=e&&e.responseType?e.responseType.toLowerCase():void 0,n=new window.FileReader;n.onload=r?"arraybuffer"===r?n.readAsArrayBuffer(t):"blob"===r?i(t):"string"===r?n.readAsText(t):n.readAsDataURL(t):n.readAsText(t)}))}(t,e)}},pwEu:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r=i("u5PS");const n={isGunzipBuffer:function(t){var e=new Uint8Array(t);return 31===e[0]&&139===e[1]},gunzip:function(t){var e=new Uint8Array(t),n=i("zpE6");return n||r.Z.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or get it at https://github.com/imaya/zlib.js/blob/master/bin/gunzip.min.js"),new n.Gunzip(e).decompress().buffer}}},I50a:X3yw:(t,e,i)=>{"use strict";i.d(e,{Z:()=>c});var r=function(t,e){return"core_"+e},n=a="(GL_EXT_shader_texture_lod|GL_OES_standard_derivatives|GL_EXT_draw_buffers|GL_EXT_frag_depth;)",s=new RegExp("#\\s*extension\\s+"+a+".*","g"),o=new RegExp(a,"g"),h=[],u=function(t,e){var i="glFragData_"+e;return h[e]="layout(location = "+e+") out vec4 "+i+";",i};const c=function(t,e){return t=function(t){return(t=t.replace(s,n)).replace(o,r)}(t=(t=(t=(t=t.replace(/attribute\s+/g,"in ")).replace(/varying\s+/g,e?"in ":"out ")).replace(/(texture2D|textureCube)\s*\(/g,"texture(")).replace(/(textureCubeLodEXT)\s*\(/g,"textureLod(")),e&&(h.length=0,t=t.replace(/gl_FragData\s*\[\s*(\d+)\s*\]/g,u),h.length||h.push("out vec4 glFragColor_0;"),t=(t=t.replace(/gl_FragColor/g,"glFragColor_0")).replace(/void\s+main\s*\(/g,h.join("\n")+"\nvoid main(")),t}},Kvhv:(t,e,i)=>{"use strict";i.d(e,{Z:()=>p});var r,n,a=i("GoyH"),s=i("u5PS"),o=i("5pih"),h=i("7itD"),u=u.prototype={setShaderCompiler:function(t){this._ShaderCompiler=t,t._validAttributeTypeMemberCache||this._computeStateAttributeCache(t)},getShaderCompiler:function(){return this._ShaderCompiler},filterAttributeTypes:function(t){return!(!t.isEnabled||t.isEnabled())},getActiveAttributeList:function(t,e){for(var i="",r=t._attributeArray,n=this._ShaderCompiler._validAttributeTypeMemberCache,a=0,s=n.length;a<s;a++){var o=n[a],h=o<r.length?r[o]:void 0;if(h){var u=h._lastApplied;u&&!this.filterAttributeTypes(u)&&(i+=u.getHash(),e.push(u))}}return i},getActiveAttributeListCache:function(t){for(var e="",i=this._ShaderCompiler._validAttributeTypeMemberCache,r=0,n=i.length;r<n;r++){var a=i[r],s=a<t._attributeArray.length?t._attributeArray[a]:void 0;if(s){var o=s._lastApplied;if(!o||this.filterAttributeTypes(o))continue;e+=s._lastApplied.getHash()}}return e},getActiveTextureAttributeListCache:function(t){for(var e="",i=this._ShaderCompiler._validTextureAttributeTypeMemberCache,r=t._textureAttributeArrayList,n=0;n<r.length;n++){var a=r[n];if(a)for(var s=a.length,o=0;o<i.length;o++){var h=i[o],u=h<s?a[h]:void 0;if(u){var c=u._lastApplied;if(!c||this.filterAttributeTypes(c)||c.isTextureNull())continue;e+=c.getHash()}}}return e},getActiveTextureAttributeList:function(t,e){var i,r,n="",a=t._textureAttributeArrayList,s=this._ShaderCompiler._validTextureAttributeTypeMemberCache;for(i=0,r=a.length;i<r;i++){var o=a[i];if(o){e[i]=[];for(var h=0,u=s.length;h<u;h++){var c=s[h],l=c<o.length?o[c]:void 0;if(l){var _=l._lastApplied;!_||this.filterAttributeTypes(_)||_.isTextureNull()||(n+=_.getHash(),e[i].push(_))}}}}return n},getActiveUniforms:function(t,e,i){for(var r={},n=0,a=e.length;n<a;n++){var s=e[n];if(s.getOrCreateUniforms){var o=s.getOrCreateUniforms();if(void 0!==o)for(var h in o){var u=o[h];r[u.getName()]=u}}}for(var c=0,l=i.length;c<l;c++){var _=i[c];if(_)for(var d=0,f=_.length;d<f;d++){var p=_[d].getOrCreateUniforms(c);for(var g in p){var m=p[g];r[m.getName()]=m}}}return r},_computeStateAttributeCache:function(t){var e,i,r,n,o,h=t.stateAttributeConfig.attribute||[],u=[];for(i=0,r=h.length;i<r;i++)e=h[i],void 0!==(o=a.Z.getIdFromTypeMember(e))&&(-1!==u.indexOf(o)?s.Z.warn("Compiler "+t.name+" contains duplicate attribute entry "+e+", check the Compiler configuration"):u.push(o));for(n=new Uint8Array(u),t._validAttributeTypeMemberCache=n,u=[],i=0,r=(h=t.stateAttributeConfig.textureAttribute||[]).length;i<r;i++)e=h[i],o=a.Z.getTextureIdFromTypeMember(e),-1!==u.indexOf(o)?s.Z.warn("Compiler "+t.name+" contains duplicate texture attribute entry "+e+", check the Compiler configuration"):u.push(o);n=new Uint8Array(u),t._validTextureAttributeTypeMemberCache=n},_createWaitingProgram:function(t,e,i){var r=new o.Z(new h.Z(h.Z.VERTEX_SHADER,"attribute vec3 Vertex;void main(void) {gl_Position = vec4(10.0,10.0,10.0,1.0);}\n"),new h.Z(h.Z.FRAGMENT_SHADER,"#define SHADER_NAME WaitSafe\nprecision lowp float; void main(void) { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);}\n"));return this.getActiveAttributeList(t,e),r.setActiveUniforms(this.getActiveUniforms(t,e,i)),r.generated=!0,r._asyncLinkingExt=void 0,r.apply(t),r},getOrCreateProgram:(r=[],n=[],function(t){var e=this.getActiveAttributeListCache(t)+this.getActiveTextureAttributeListCache(t),i=this._getProgram(e,t,n,r);return void 0!==i?i:this._createProgram(e,t,n,r)}),_getProgram:function(t){return this._cache[t]},_createProgram:function(t,e,i,r){i.length=0,r.length=0,this.getActiveAttributeList(e,i),this.getActiveTextureAttributeList(e,r);var n=new(0,this._ShaderCompiler)(i,r),a=n.createFragmentShader(),s=n.createVertexShader(),u=new o.Z(new h.Z(h.Z.VERTEX_SHADER,s),new h.Z(h.Z.FRAGMENT_SHADER,a));return u.hash=t,u.setActiveUniforms(this.getActiveUniforms(e,i,r)),u.generated=!0,this._cache[t]=u,u.apply(e),u},resetCache:;const c=u;var l=function(){return this._generators={},this.addShaderGenerator("default",new c),this};l.prototype={getShaderGenerator:function(t){if(!t)return this._generators.default;var e=this._generators[t];return e||(s.Z.error("ShaderGenerator "+t+" does not exist in ShaderGeneratorProxy"),this._generators.default)},addShaderGenerator:function(t,e){this._generators[t]=e}};const _=l;var d=i("w/Ui"),f={};f.ShaderGenerator=c,f.ShaderGeneratorProxy=_,f.shaderProcessor=d.Z;const p=f},"w/Ui":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var osg_notify__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("u5PS"),osg_WebGLCaps__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("BvLe"),viewer_getOptions__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("MQQR"),osgShader_gl2convert__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("X3yw"),shaderProcessor={},cbFilterDuplicate=shaderProcessor.getSortedUnique=var isStringInteger=getFinalDefinedValue=function(t,e){for(;t[e]&&e!==t[e];)e=t[e];return e},testIf=function(defines,line){if(line.startsWith("#ifdef"))return void 0!==defines[line.substr(7-line.length)];if(line.startsWith("#ifndef"))return void 0===defines[line.substr(8-line.length)];if(line.startsWith("#else"))return!0;for(var txt=line.match(/[#elif|#if]\s+(.*)/)[1],tokens=txt.split(/\b\d+\b|\W+|defined+/g),i=0;i<tokens.length;++i){var tok=tokens[i];if(tok){var value=getFinalDefinedValue(defines,defines[tok]);void 0===value||isStringInteger(value)||(value=!0),txt=txt.replace(tok,value)}}return eval("var defined = function(x) { return x !== undefined | 0; };\n"+txt)},processBranch=function(t,e,i,r){for(var n=[1],a=e;a<t.length;++a){var s=t[a].trim();if(s.startsWith("#endif"))n.length--;else if(s.startsWith("#el")){var o=n.length-1;0===n[o]?n[o]=testIf(i,s)?1:0:1===n[o]&&(n[o]=2)}else if(s.startsWith("#if"))n.push(testIf(i,s)?1:0);else{for(var h=!0,u=n.length;u--;)h=h&&1===n[u];if(h)if(s.startsWith("#"))if(s.startsWith("#extension"))r.push(s);else if(s.startsWith("#undef"))i[s.match(/#undef\s+(\w+)/)[1]]=void 0,r.push(s);else if(s.startsWith("#define")){var c=s.match(/#define\s+(\w+)\s*(.*)/);-1!==s.indexOf(c[1]+"(")?i[c[1]]={args:s.match(/\(.*?\)/)[0].match(/\w+/g),body:s.match(/\)(.*)/)[1]}:i[c[1]]=c[2]}else console.error("unknown preprocessor line: "+s);else r.push(s)}}},fixIndent=function(t){for(var e=(t=t.replace(/(\n\s*\n)+/g,"\n\n")).split("\n"),i="",r=0;r<e.length;++r){var n=e[r].trim(),a=-1!==n.indexOf("{"),s=-1!==n.indexOf("}");!a&&s&&(i=i.substr(4)),e[r]=i+n,a&&!s&&(i+="    ")}return e.join("\n")},cleanDeclarations=function(t,e){for(var i=0;i<e.length;++i)t=t.replace(e[i],""),e[i]=e[i].replace(/\s+/g," ").replace(/\s+;/,";");return t},handleVaryings=function(t){var e=t.match(/varying\s.*?;/g);if(!e)return t;t=cleanDeclarations(t,e),e=shaderProcessor.getSortedUnique(e);for(var i=0;i<e.length;++i)if(-1!==e[i].indexOf("vViewNormal;")){var r=e[0];e[0]=e[i],e[i]=r;break}return"\n"+e.join("\n")+"\n"+t},handleUniforms=function(t){var e=t.match(/uniform\s.*?;/g);return e?(t=cleanDeclarations(t,e),"\n"+(e=shaderProcessor.getSortedUnique(e)).join("\n")+"\n"+t):t},handleAttributes=function(t){var e=t.match(/attribute\s.*?;/g);if(!e)return t;t=cleanDeclarations(t,e),e=shaderProcessor.getSortedUnique(e);for(var i=0;i<e.length;++i)if(-1!==e[i].indexOf(" Vertex;")){e.unshift(e[i]),e.splice(i+1,1);break}return"\n"+e.join("\n")+"\n"+t},handlePrecision=function(t){var e=t.match(/precision\s+(high|low|medium)p\s+float\s*;/);return e?e[0]+"\n"+t.replace(e[0],""):"precision "+osg_WebGLCaps__WEBPACK_IMPORTED_MODULE_1__.Z.instance().getShaderMaxPrecisionFloat()+"p float;\n"+t},addExtensions=function(t){var e=t.match(/#extension\s(\w+)\s:\s(\w+)/g);if(!e)return t;e=shaderProcessor.getSortedUnique(e);for(var i=0;i<e.length;++i)t=t.replace(e[i],"");return e.join("\n")+"\n"+t},addVersion=function(t){return(osg_WebGLCaps__WEBPACK_IMPORTED_MODULE_1__.Z.instance().isWebGL2()?"#version 300 es\n":"#version 100\n")+t},hasVersion=cbUnroll=function(t,e,i){e=parseInt(e);for(var r="",n=0;n<e;++n)r+=i.replace(/%ID%/g,n);return r},unrollReplace=glslPreprocessShader=function(t){return window.glslesPreprocessor(t,{debugExperimental:!1,defines:[],doStats:!1,extensions:[],pruneComments:!0,logCounts:!1,minify:!1,output:0,preprocess:!0,profileTimeEach:!1,profileTimeGlobal:!1,pruneUnused:!0,pruneDefines:!0,replaceDefine:!0,optimize:!0,tabs:4,whitespace:!0})},extractArguments=function(t,e){for(var i=[""],r=0,n=e;n<t.length;++n){if("("===t[n])r++;else if(")"===t[n]){if(0===r)return[i,n+1];if(0===--r){i[i.length-1]+=t[n];continue}}","!==t[n]||0!==r?i[i.length-1]+=t[n]:i.push("")}},replaceRange=resolveDefineFunction=function(t,e,i){var r=new RegExp("\\b"+e+"\\b\\s*\\(","g"),n=t.match(r);if(!n)return t;for(var a=i.args,s=i.body,o=0;o<n.length;++o){var h=n[o],u=t.indexOf(h),c=u+h.length,l=extractArguments(t,c),_=l[0],d=s.replace(/\w+/g,(function(t){var e=a.indexOf(t);return-1!==e?_[e]:t}));t=replaceRange(t,u,l[1],d)}return t},resolveDefines=function(t,e){for(var i=Object.keys(e),r=0;r<i.length;++r){for(var n=i[r],a=e[n],s="object"==typeof a,o=!s&&new RegExp("\\b"+n+"\\b","g"),h=r+1;h<i.length;++h){var u=i[h],c=e[u];void 0!==c&&("object"==typeof c?c.body=s?resolveDefineFunction(c.body,n,a):c.body.replace(o,a):e[u]=s?resolveDefineFunction(c,n,a):c.replace(o,a))}t=s?resolveDefineFunction(t,n,a):t.replace(o,a)}return t},extensions=["EXT_shader_texture_lod","EXT_draw_buffers","EXT_frag_depth","OES_standard_derivatives"],getDefaultDefines=function(){for(var t={},e=osg_WebGLCaps__WEBPACK_IMPORTED_MODULE_1__.Z.instance(),i=e.getWebGLExtensions(),r=0;r<extensions.length;++r){var n=extensions[r];i[n]&&(t["GL_"+n]="GL_"+n)}return"high"===e.getShaderMaxPrecisionFloat()&&(t.GL_FRAGMENT_PRECISION_HIGH="GL_FRAGMENT_PRECISION_HIGH"),t},fastPreprocess=function(t){t=t.replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"");var e=getDefaultDefines(),i=[];return processBranch(t.split("\n"),0,e,i,!0),resolveDefines(i.join("\n"),e)},preprocess=function(t){var e=t.match("#define SHADER_NAME .*");return t=(0,viewer_getOptions__WEBPACK_IMPORTED_MODULE_2__.Z)().cleanShader&&window.glslesPreprocessor?glslPreprocessShader(t):fastPreprocess(t),e?e[0]+"\n"+t:t};shaderProcessor.processIncludes=function(t,e){return t.replace(/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,(function(t,i){var r=i.split(" ")[0].replace(/"/g,"");return-1!==e.indexOf(r)?"":(e.push(r),shaderProcessor.processIncludes(shaderProcessor.getShaderTextPure(r),e))}))},shaderProcessor.processShader=function(t){if(hasVersion(t))return t;var e=shaderProcessor.processIncludes(t,[]),i=-1===e.indexOf("gl_Position");return e=e.replace(/\\\n/g,""),e=unrollReplace(e),e=preprocess(e),e=handleVaryings(e),e=handleUniforms(e),e=handleAttributes(e),e=fixIndent(e),osg_WebGLCaps__WEBPACK_IMPORTED_MODULE_1__.Z.instance().isWebGL2()&&(e=(0,osgShader_gl2convert__WEBPACK_IMPORTED_MODULE_3__.Z)(e,i)),e=handlePrecision(e),e=addExtensions(e),e=addVersion(e)};var shadersText={};shaderProcessor.addShaders=function(t){for(var e in t)shadersText[e]&&console.warn("Shader already added : "+e),shadersText[e]=t[e]},shaderProcessor.hasShader=shaderProcessor.getShaderTextPure=function(t){var e=shadersText[t];return e||osg_notify__WEBPACK_IMPORTED_MODULE_0__.Z.error("shader file/text: "+t+" not registered"),e},shaderProcessor.getShader=const __WEBPACK_DEFAULT_EXPORT__=shaderProcessor},"9Aw2":(t,e,i)=>{"use strict";i.d(e,{Z:()=>p});var r=i("GoyH"),n=i("CJNH"),a=i("mixV"),s=function(t){n.Z.call(this,n.Z.TRAVERSE_ALL_CHILDREN),this._selectables=t,this._nodeList=[],this._linkList=[],this._uniqueNodes=new window.Set,this._uniqueEdges=new window.Set};r.Z.createPrototypeObject(s,r.Z.objectInherit(n.Z.prototype,{getColorFromClassName:function(t){switch(t){case"ShadowedScene":return"#3D3D3D";case"Camera":return"#AB7BCF";case"RenderBin":return"#59778B";case"LightSource":return"#53967D";case"RenderStage":return"#DDCC55";case"RenderLeaf":case"Geometry":return"#FFCC55";case"RigGeometry":return"#DD8800";case"MorphGeometry":return"#AA5500";case"MatrixTransform":return"#CE697E";case"StateSet":return"#0099FF";case"StateGraph":case"Skeleton":return"#96999E";case"Bone":return"#A9DEAA";case"Node":return"#FFFFFF";default:return"#FF00AA"}},createGraph:function(t){this.reset(),t.accept(this)},reset:function(){this._nodeList.length=0,this._linkList.length=0,this._uniqueNodes.clear(),this._uniqueEdges.clear()},apply:function(t){if(!t._isNormalDebug){if(this._uniqueNodes.has(t.getInstanceID())||(this._uniqueNodes.add(t.getInstanceID()),this._nodeList.push(t)),this.nodePath.length>=2){var e=this.nodePath[this.nodePath.length-2].getInstanceID(),i=t.getInstanceID(),r=e+"+"+i;this._uniqueEdges.has(r)||(this._linkList.push({parentNode:e,childrenNode:i}),this._uniqueEdges.add(r))}this.traverse(t)}},createMatrixGrid:function(t,e){var i="";return i+="<table><tr><td>"+e[0]+"</td>",i+="<td>"+e[4]+"</td>",i+="<td>"+e[8]+"</td>",i+="<td>"+e[12]+"</td></tr>",i+="<tr><td>"+e[1]+"</td>",i+="<td>"+e[5]+"</td>",i+="<td>"+e[9]+"</td>",i+="<td>"+e[13]+"</td></tr>",i+="<tr><td>"+e[2]+"</td>",i+="<td>"+e[6]+"</td>",i+="<td>"+e[10]+"</td>",i+="<td>"+e[14]+"</td></tr>",i+="<tr><td>"+e[3]+"</td>",i+="<td>"+e[7]+"</td>",i+="<td>"+e[11]+"</td>",i+="<td>"+e[15]+"</td></tr></table>"},getLabel:function(t){var e=t.className()+" ("+t.getInstanceID()+")";return t.getName&&t.getName()&&(e+="\n"+t.getName()),e},generateNode:function(t,e){var i="";e.getMatrix&&e.getMatrix()&&(i+="<br /><br />"+this.createMatrixGrid(e,e.getMatrix())),this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:this.getLabel(e),description:i,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateStateSet:function(t,e){var i=e.getStateSet(),r=i.getInstanceID(),n=this.getLabel(i);n+="\nNbTexture : "+i.getNumTextureAttributeLists(),t.hasNode(r)||(this._selectables.set(r.toString(),i),t.addNode(r,{label:n,style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"})),t.addEdge(null,e.getInstanceID(),r,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateSourceGeometry:function(t,e){var i=e.getSourceGeometry(),r=i.getInstanceID();this._selectables.set(r.toString(),i),t.addNode(r,{label:this.getLabel(i),style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"}),t.addEdge(null,e.getInstanceID(),r,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateNodeAndLink:function(t){for(var e=0,i=this._nodeList.length;e<i;e++){var r=this._nodeList[e];this.generateNode(t,r),r.getStateSet()&&this.generateStateSet(t,r),r.getSourceGeometry&&r.getSourceGeometry()instanceof a.Z&&this.generateSourceGeometry(t,r)}for(var n=0,s=this._linkList.length;n<s;n++)t.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}}),"osgUtil","DisplayGraphNode");const o=s;var h=i("hLVw"),u=function(t){this._selectables=t,this._nodeList=[],this._linkList=[],this._renderBinMap=new window.Map,this._renderBinStack=[],this._generatorID=0,this._refID=0,this._uniqueEdges=new window.Set};u.prototype={getColorFromClassName:o.prototype.getColorFromClassName,createGraph:reset:function(){this._renderBinMap.clear(),this._renderBinStack.length=0,this._generatorID=0,this._refID++,this._nodeList.length=0,this._linkList.length=0,this._uniqueEdges.clear()},apply:function(t){var e=t.getInstanceID();if(this._renderBinMap.has(e)||this._renderBinMap.set(e,t),this._renderBinStack.push(t),t.getPreRenderStageList)for(var i=t.getPreRenderStageList(),r=0,n=i.length;r<n;++r)this.apply(i[r].renderStage);if(this.registerNode(t),t.getPostRenderStageList)for(var a=t.getPostRenderStageList(),s=0,o=a.length;s<o;++s)this.apply(a[s].renderStage);this._renderBinStack.pop()},registerNode:function(t){var e=t.getInstanceID();if(this._nodeList.push(t),t._bins.forEach(bind(this)),t._leafs.length)for(var i=0,r=t._leafs.length;i<r;i++)this.createNodeAndSetID(e,t._leafs[i]);var n=this,a={},s=bind(a);if(t.getStateGraphList().forEach((function(t){n.createNodeAndSetID(e,t);var i=t._instanceID,r=t.getLeafs();a.stateGraphID=i,r.forEach(s)})),!(this._renderBinStack.length<2)){var o=this._renderBinStack[this._renderBinStack.length-2].getInstanceID();this.createLink(o,e)}},createLink:function(t,e){var i=t+"+"+e;this._uniqueEdges.has(i)||(this._linkList.push({parentNode:t,childrenNode:e}),this._uniqueEdges.add(i))},createNodeAndSetID:function(t,e){this._nodeList.push(e),(void 0===e._instanceID||e._instanceID<0&&e._refID!==this._refID)&&(e._instanceID=-1-this._generatorID++,e._refID=this._refID),this.createLink(t,e._instanceID)},generateRenderLeaf:function(t,e){var i=e._instanceID,r="RenderLeaf",n=e._geometry&&e._geometry.getName()?"\n"+e._geometry.getName():"Geometry",a=r+" ( "+e._instanceID+" )";a+="\n"+n+" ( "+e._geometry.getInstanceID()+" )",this._selectables.set(i.toString(),e),t.addNode(i,{label:a,description:"",style:"fill: "+this.getColorFromClassName(r)+";stroke-width: 0px;"})},generateStateGraph:function(t,e){var i=e._instanceID,r="StateGraph",n=r+" ( "+e._instanceID+" )";n+="\n"+e._leafs._length+" leafs",this._selectables.set(i.toString(),e),t.addNode(i,{label:n,description:"",style:"fill: "+this.getColorFromClassName(r)+";stroke-width: 0px;"})},generateRenderStage:function(t,e){var i=e.className()+" ( "+e._instanceID+" )";e.getName()&&(i+="\n"+e.getName()),i+="\nViewport ( "+e.getViewport().width()+" x "+e.getViewport().height()+" )",this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:i,description:"",style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateRenderBin:function(t,e){var i=e.className()+" ( "+e.getInstanceID()+" )";e.getName()&&(i+="\n"+e.getName());var r="";e.getSortMode()===h.Z.SORT_BACK_TO_FRONT&&(r="SortMode: BackToFront");var n="BinNumber: "+e.getBinNumber()+"\n"+r;this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:i,description:n,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateNodeAndLink:function(t){for(var e=0,i=this._nodeList.length;e<i;e++){var r=this._nodeList[e];r._geometry&&void 0!==r._depth?this.generateRenderLeaf(t,r):"StateGraph"===r.className()?this.generateStateGraph(t,r):"RenderStage"===r.className()?this.generateRenderStage(t,r):this.generateRenderBin(t,r)}for(var n=0,a=this._linkList.length;n<a;n++)t.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}};const c=u;var l,_=i("u5PS"),d=function(t){this.options=t;var e=document.createElement("style");e.type="text/css",e.innerHTML=[".osgDebugSimpleTooltip {","display: none;","position: absolute;","margin-left: 10px;","border-radius: 4px;","padding: 10px;","background: rgba(0,0,0,.9);","color: #ffffff;","}",".osgDebugSimpleTooltip:before {","content: ",";","position: absolute;","left: -10px;","top: 8px;","border: 10px solid transparent;","border-width: 10px 10px 10px 0;","border-right-color: rgba(0,0,0,.9);","}"].join("\n"),document.getElementsByTagName("head")[0].appendChild(e),this.el=document.createElement("div"),this.el.className="osgDebugSimpleTooltip",document.body.appendChild(this.el);for(var i=document.querySelectorAll(this.options.selector),r=0;r<i.length;r++)i[r].addEventListener("mouseover",this.showTooltip.bind(this),!1),i[r].addEventListener("mouseout",this.hideTooltip.bind(this),!1)};d.prototype={showTooltip:function(t){if(l){var e=t.currentTarget;this.el.innerHTML=e.getAttribute("title"),this.el.style.display="block",this.el.style.left=l(e).position().left+l(e).get(0).getBoundingClientRect().width+"px",this.el.style.top=l(e).position().top+"px"}},hideTooltip:;var f=function(){!function(){try{l=i("Hjnd")}catch(t){_.Z.warn("You will not be able to use osgUtil.DisplayGraph until you add jQuery in your page")}}(),l&&(this._selectables=new window.Map,this._graphNode=new o(this._selectables),this._graphRender=new c(this._selectables),this._displayNode=!0,this._displayRenderer=!1,this._cbSelect=void 0,this._focusedElement="graph",this._idToDomElement=new window.Map,this._$svg=l("<svg width=100% height=100%></svg>"),l("body").append(this._$svg),this._css=".node {text-align: center;cursor: pointer;}.node rect {stroke: #FFF;}.edgePath path {stroke: #FFF;fill: none;}table {text-align: right;}svg {position: absolute;left: 0px;top: 0px;}.osgDebugButton {position: absolute;left: 15px;top: 15px;z-index: 5;border: 0;background: #65a9d7;background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));background: -webkit-linear-gradient(top, #3e779d, #65a9d7);background: -moz-linear-gradient(top, #3e779d, #65a9d7);background: -ms-linear-gradient(top, #3e779d, #65a9d7);background: -o-linear-gradient(top, #3e779d, #65a9d7);padding: 5px 10px;-webkit-border-radius: 7px;-moz-border-radius: 7px;border-radius: 7px;-webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;-moz-box-shadow: rgba(0,0,0,1) 0 1px 0;box-shadow: rgba(0,0,0,1) 0 1px 0;text-shadow: rgba(0,0,0,.4) 0 1px 0;color: white;font-size: 15px;font-family: Helvetica, Arial, Sans-Serif;text-decoration: none;vertical-align: middle;}.osgDebugButton:hover {border-top-color: #28597a;background: #28597a;color: #ccc;}.osgDebugButton:active {border-top-color: #1b435e;background: #1b435e;}.osgDebugSimpleTooltip .osgDebugName {font-weight: bold;color: #60b1fc;margin: 0;}.osgDebugSimpleTooltip .osgDebugDescription {margin: 0;}")};f.instance=f.prototype={getColorFromClassName:o.prototype.getColorFromClassName,setCallbackSelect:function(t){this._cbSelect=t},reset:function(){l&&(this._selectables.clear(),this._$svg.empty(),this._focusedElement="scene",l(".osgDebugButton").hide())},setDisplayGraphRenderer:function(t){this._displayRenderer=t},createRenderGraph:function(t){this._graphRender.createGraph(t),this.displayGraph()},createGraph:function(t){l&&(this.reset(),this._displayNode=!!t,t&&this._graphNode.createGraph(t),this._displayRenderer?i("Pxgm").Z.debugGraph=!0:this.displayGraph())},displayGraph:function(){if(l)if(window.d3&&window.dagreD3)this._createGraphApply();else{var t=this._createGraphApply.bind(this);l.getScript("//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js").done(()}},_createGraphApply:function(){var t=new window.dagreD3.Digraph;this._displayNode&&this._graphNode.generateNodeAndLink(t),this._displayRenderer&&this._graphRender.generateNodeAndLink(t),this.injectStyleElement(),l(".osgDebugButton").show();var e=this.renderer=new window.dagreD3.Renderer,i=window.d3.select(this._$svg.get(0)).append("g"),r=e.zoom();e.zoom((function(t,e){var i=r(t,e);return i.scale(.75).event(e),i}));var n=this._idToDomElement,a=e.drawNodes();e.drawNodes((function(t,e){var i=a(t,e);return i.attr("title",(function(e){return n.set(e,this),i=e,r=t.node(e).description||"",'<p class="osgDebugName">'+i+'</p><pre class="osgDebugDescription">'+r+"</pre>";var i,r})),i})),e.run(t,i),this.tooltip=new d({selector:".node"}),l(".node").click(this.onNodeSelect.bind(this)),this.focusOnGraph()},selectNode:function(t){var e=t.getInstanceID(),i=this._idToDomElement.get(e);i&&l(i).click()},onNodeSelect:function(t){var e=t.currentTarget,i=l(e.getAttribute("title"))[0].innerHTML,r=this._selectables;this.lastNode&&(this.lastNode.style.fill=this.lastColor);var n=r.get(i);n&&(this.lastNode=e.childNodes[0],this.lastColor=this.lastNode.style.fill,e.childNodes[0].style.fill="#f00",window.activeNode=n,_.Z.info("window.activeNode is set with the node below !"),_.Z.log(window.activeNode),_.Z.log("\n"),this._cbSelect&&this._cbSelect(n))},focusOnScene:function(){l(".osgDebugButton").text("Access to the graph"),this._$svg.css("zIndex","-2"),this._focusedElement="scene"},focusOnGraph:function(){l(".osgDebugButton").text("Access to the scene"),this._$svg.css("zIndex","2"),l(".osgDebugSimpleTooltip").css("zIndex","3"),this._focusedElement="graph"},injectStyleElement:function(){if(!this._cssInjected){this._cssInjected=!0,l("body").append('<button class="osgDebugButton">Access to the scene</button>'),l(".osgDebugButton").click(bind(this));var t=document.createElement("style");t.type="text/css",t.innerHTML=this._css,document.getElementsByTagName("head")[0].appendChild(t)}}};const p=f},vXZK:(t,e,i)=>{"use strict";i.d(e,{Z:()=>h});var r,n=i("W40i"),a=i("Un/q"),s=i("E9Rp"),o=function(){this._hit=!1,this._primitiveIndex=0,this._vertices=void 0,this._geometry=void 0,this._intersectionVisitor=void 0,this._intersector=void 0,this._limitOneIntersection=!1,this._primitiveMask=s.Z.ALL_PRIMITIVES};o.Intersection=function(){this._nodePath=void 0,this._drawable=void 0,this._matrix=void 0,this._primitiveIndex=void 0,this._ratio=0,this._backface=!1,this._localIntersectionPoint=n.R3.create()},o.prototype={reset:setPrimitiveIndex:function(t){this._primitiveIndex=t},setGeometry:function(t){this._geometry=t,this._primitiveIndex=0,this._vertices=t.getAttributes().Vertex.getElements()},setVertices:function(t){this._vertices=t},setIntersectionVisitor:function(t){this._intersectionVisitor=t},setIntersector:function(t){this._intersector=t,this._primitiveMask=t.getPrimitiveMask();var e=t.getIntersectionLimit();this._limitOneIntersection=e===s.Z.LIMIT_ONE_PER_DRAWABLE||e===s.Z.LIMIT_ONE},setLimitOneIntersection:function(t){this._limitOneIntersection=t},leave:function(){},enter:function(){},initIntersection:function(t){return t._matrix=n._E.clone(this._intersectionVisitor.getModelMatrix()),t._nodePath=this._intersectionVisitor.getNodePath().slice(),t._primitiveIndex=this._primitiveIndex,t._drawable=this._geometry,this._intersector.getIntersections().push(t),this._hit=!0,t},intersectPoint:function(){},intersectLine:function(){},intersectTriangle:function(){},operatorPoint:(r=n.R3.create(),function(t){if(!(this._limitOneIntersection&&this._hit||0==(this._primitiveMask&s.Z.POINT_PRIMITIVES))){var e=this._vertices;n.R3.set(r,e[3*t],e[3*t+1],e[3*t+2]),this.intersectPoint(r,t),this._primitiveIndex++}}),operatorLine:function(){var t=n.R3.create(),e=n.R3.create();return function(i,r){if(!(this._limitOneIntersection&&this._hit||0==(this._primitiveMask&s.Z.LINE_PRIMITIVES))){var a=this._vertices;n.R3.set(t,a[3*i],a[3*i+1],a[3*i+2]),n.R3.set(e,a[3*r],a[3*r+1],a[3*r+2]),this.intersectLine(t,e,i,r),this._primitiveIndex++}}}(),operatorTriangle:function(){var t=n.R3.create(),e=n.R3.create(),i=n.R3.create();return function(r,a,o){if(!(this._limitOneIntersection&&this._hit||0==(this._primitiveMask&s.Z.TRIANGLE_PRIMITIVES))){var h=this._vertices;n.R3.set(t,h[3*r],h[3*r+1],h[3*r+2]),n.R3.set(e,h[3*a],h[3*a+1],h[3*a+2]),n.R3.set(i,h[3*o],h[3*o+1],h[3*o+2]),this.intersectTriangle(t,e,i,r,a,o),this._primitiveIndex++}}}(),apply:function(t){t.getAttributes().Vertex&&(0,a.Z)(t,this)}};const h=o},CtxI:(t,e,i)=>{"use strict";i.d(e,{Z:()=>l});var r,n=i("GoyH"),a=i("CJNH"),s=i("W40i"),o=i("cyFB"),h=i("bDLW"),u=i("pSxj"),c=function(){a.Z.call(this),this._intersector=void 0,this._projectionStack=new h.Z,this._modelStack=new h.Z,this._viewStack=new h.Z,this._windowStack=new h.Z,this._pooledMatrix=new o.Z(s._E.create),this.reset()};n.Z.createPrototypeObject(c,n.Z.objectInherit(a.Z.prototype,{reset:function(){this._pooledMatrix.reset(),this._viewStack.reset(),this._modelStack.reset(),this._projectionStack.reset(),this._windowStack.reset(),this._viewStack.push(s._E.IDENTITY),this._modelStack.push(s._E.IDENTITY),this._projectionStack.push(s._E.IDENTITY),this._windowStack.push(s._E.IDENTITY)},setIntersector:function(t){this._intersector=t},getIntersector:function(){return this._intersector},pushModelMatrix:function(t){this._modelStack.push(t)},getModelMatrix:function(){return this._modelStack.back()},popModelMatrix:function(){return this._modelStack.pop()},pushViewMatrix:function(t){this._viewStack.push(t)},getViewMatrix:function(){return this._viewStack.back()},popViewMatrix:function(){return this._viewStack.pop()},pushProjectionMatrix:function(t){this._projectionStack.push(t)},getProjectionMatrix:function(){return this._projectionStack.back()},popProjectionMatrix:function(){return this._projectionStack.pop()},pushWindowMatrix:function(t){this._windowStack.push(t)},pushWindowMatrixUsingViewport:function(t){this._windowStack.push(t.computeWindowMatrix(this._pooledMatrix.getOrCreateObject()))},getWindowMatrix:function(){return this._windowStack.back()},popWindowMatrix:function(){return this._windowStack.pop()},getTransformation:(r=s._E.create64(),function(){return s._E.copy(r,this.getWindowMatrix()),s._E.mul(r,r,this.getProjectionMatrix()),s._E.mul(r,r,this.getViewMatrix()),s._E.mul(r,r,this.getModelMatrix()),r}),enter:function(t){return this._intersector.enter(t)},apply:applyCamera:function(t){var e,i,r,n=t.getViewport();void 0!==n&&this.pushWindowMatrixUsingViewport(n),t.getReferenceFrame()===u.Z.RELATIVE_RF&&this.getViewMatrix()&&this.getProjectionMatrix()?(e=s._E.mul(this._pooledMatrix.getOrCreateObject(),this.getProjectionMatrix(),t.getProjectionMatrix()),i=this.getViewMatrix(),r=s._E.mul(this._pooledMatrix.getOrCreateObject(),this.getModelMatrix(),t.getViewMatrix())):(e=t.getProjectionMatrix(),i=t.getViewMatrix(),r=s._E.identity(this._pooledMatrix.getOrCreateObject())),this.pushProjectionMatrix(e),this.pushViewMatrix(i),this.pushModelMatrix(r),this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),this.popViewMatrix(),this.popProjectionMatrix(),void 0!==n&&this.popWindowMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())},applyNode:function(t){this.enter(t)&&(t.getPrimitiveSetList?this._intersector.intersect(this,t):t.traverse&&this.traverse(t))},applyTransform:function(t){if(this.enter(t)){if(t.getReferenceFrame()===u.Z.ABSOLUTE_RF){var e=this._pooledMatrix.getOrCreateObject();this.pushViewMatrix(s._E.identity(e)),this.pushModelMatrix(t.getMatrix())}else if(this._modelStack.getLength()>0){var i=s._E.copy(this._pooledMatrix.getOrCreateObject(),this.getModelMatrix());s._E.mul(i,i,t.getMatrix()),this.pushModelMatrix(i)}else this.pushModelMatrix(t.getMatrix());this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),t.getReferenceFrame()===u.Z.ABSOLUTE_RF&&this.popViewMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())}}}),"osgUtil","IntersectionVisitor");const l=c},"K/iW":(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i("E9Rp"),n=function(){this._intersections=[],this._primitiveMask=r.Z.ALL_PRIMITIVES,this._intersectionLimit=r.Z.NO_LIMIT};n.prototype={reset:function(){this._intersections.length=0},enter:function(t){return!this.reachedLimit()&&(!t.isCullingActive()||this.intersectNode(t))},intersectNode:function(t){return this.intersectBoundingSphere(t.getBoundingSphere())||this.intersectBoundingBox(t.getBoundingBox())},intersectBoundingSphere:function(){return!1},intersectBoundingBox:function(){return!1},getIntersections:function(){return this._intersections},setIntersectionLimit:function(t){this._intersectionLimit=t},getIntersectionLimit:function(){return this._intersectionLimit},setPrimitiveMask:function(t){this._primitiveMask=t},getPrimitiveMask:function(){return this._primitiveMask},reachedLimit:function(){return this._intersectionLimit===r.Z.LIMIT_ONE&&this._intersections.length>0},setCurrentTransformation:function(){},intersect:function(){}};const a=n},zACX:(t,e,i)=>{"use strict";i.d(e,{Z:()=>T});var r,n,a,s,o,h,u,c,l,_,d,f,p,g,m=i("GoyH"),v=i("W40i"),b=i("vXZK"),S=function(){b.Z.Intersection.call(this),this._localIntersectionNormal=v.R3.clone(v.R3.ONE),this._i1=-1,this._i2=-1,this._i3=-1,this._r1=0,this._r2=0,this._r3=0},y=function(){b.Z.call(this),this._threshold=0,this._d=v.R3.create(),this._length=0,this._invLength=0,this._start=v.R3.create(),this._end=v.R3.create(),this._dInvX=v.R3.create(),this._dInvY=v.R3.create(),this._dInvZ=v.R3.create(),this._hit=!1};m.Z.createPrototypeObject(y,m.Z.objectInherit(b.Z.prototype,{set:function(t,e,i){this._start=t,this._end=e,v.R3.sub(this._d,e,t),this._length=v.R3.length(this._d),this._invLength=0!==this._length?1/this._length:0,v.R3.scale(this._d,this._d,this._invLength),0!==this._d[0]&&v.R3.scale(this._dInvX,this._d,1/this._d[0]),0!==this._d[1]&&v.R3.scale(this._dInvY,this._d,1/this._d[1]),0!==this._d[2]&&v.R3.scale(this._dInvZ,this._d,1/this._d[2]),void 0!==i&&(this._threshold=i)},enter:function(t,e,i){var r=t._min,n=r[0],a=r[1],s=r[2],o=t._max,h=o[0],u=o[1],c=o[2],l=this._dInvX,_=this._dInvY,d=this._dInvZ;if(e[0]<=i[0]){if(i[0]<n)return!1;if(e[0]>h)return!1;e[0]<n&&v.R3.scaleAndAdd(e,e,l,n-e[0]),i[0]>h&&v.R3.scaleAndAdd(i,e,l,h-e[0])}else{if(e[0]<n)return!1;if(i[0]>h)return!1;i[0]<n&&v.R3.scaleAndAdd(i,e,l,n-e[0]),e[0]>h&&v.R3.scaleAndAdd(e,e,l,h-e[0])}if(e[1]<=i[1]){if(i[1]<a)return!1;if(e[1]>u)return!1;e[1]<a&&v.R3.scaleAndAdd(e,e,_,a-e[1]),i[1]>u&&v.R3.scaleAndAdd(i,e,_,u-e[1])}else{if(e[1]<a)return!1;if(i[1]>u)return!1;i[1]<a&&v.R3.scaleAndAdd(i,e,_,a-e[1]),e[1]>u&&v.R3.scaleAndAdd(e,e,_,u-e[1])}if(e[2]<=i[2]){if(i[2]<s)return!1;if(e[2]>c)return!1;e[2]<s&&v.R3.scaleAndAdd(e,e,d,s-e[2]),i[2]>c&&v.R3.scaleAndAdd(i,e,d,c-e[2])}else{if(e[2]<s)return!1;if(i[2]>c)return!1;i[2]<s&&v.R3.scaleAndAdd(i,e,d,s-e[2]),e[2]>c&&v.R3.scaleAndAdd(e,e,d,c-e[2])}return!0},intersectPoint:(p=v.R3.create(),g=v.R3.create(),function(t,e){var i=this._start;v.R3.sub(p,t,i),v.R3.sub(g,this._end,i);var r=v.R3.dot(p,g)*this._invLength*this._invLength;if(!((r<0?v.R3.sqrLen(p):r>1?v.R3.sqrDist(t,this._end):v.R3.sqrLen(v.R3.scaleAndAdd(p,p,g,-r)))>this._threshold*this._threshold)){var n=this.initIntersection(new S);n._i1=e,n._r1=1,v.R3.scaleAndAdd(n._localIntersectionPoint,i,g,r),n._ratio=r}}),intersectLine:(c=v.R3.create(),l=v.R3.create(),_=v.R3.create(),d=v.R3.create(),f=v.R3.create(),function(t,e,i,r){var n=1e-8;v.R3.sub(c,e,t),v.R3.sub(l,this._end,this._start),v.R3.sub(_,t,this._start);var a,s,o=v.R3.dot(c,c),h=v.R3.dot(c,l),u=v.R3.dot(l,l),p=v.R3.dot(c,_),g=v.R3.dot(l,_),m=o*u-h*h,b=m,y=m;m<n?(a=0,b=1,s=g,y=u):(s=o*g-h*p,(a=h*g-u*p)<0?(a=0,s=g,y=u):a>b&&(a=b,s=g+h,y=u)),s<0?(s=0,-p<0?a=0:-p>o?a=b:(a=-p,b=o)):s>y&&(s=y,-p+h<0?a=0:-p+h>o?a=b:(a=-p+h,b=o));var T=Math.abs(a)<n?0:a/b,x=Math.abs(s)<n?0:s/y;if(v.R3.scaleAndAdd(d,t,c,T),v.R3.scaleAndAdd(f,this._start,l,x),!(v.R3.sqrDist(d,f)>this._threshold*this._threshold)){var E=this.initIntersection(new S);E._i1=i,E._i2=r,E._r1=1-x,E._r2=x,v.R3.copy(E._localIntersectionPoint,f),E._ratio=x}}),intersectTriangle:(r=v.R3.create(),n=v.R3.create(),a=v.R3.create(),s=v.R3.create(),o=v.R3.create(),h=v.R3.create(),u=1e-20,function(t,e,i,c,l,_){var d=this._d;v.R3.sub(n,i,t),v.R3.sub(a,e,t),v.R3.cross(o,d,n);var f=v.R3.dot(o,a);if(!(f>-1e-20&&f<u)){var p=1/f;v.R3.sub(s,this._start,t);var g=v.R3.dot(o,s)*p;if(!(g<0||g>1)){v.R3.cross(h,s,a);var m=v.R3.dot(h,d)*p;if(!(m<0||g+m>1)){var b=v.R3.dot(h,n)*p;if(!(b<u||b>this._length)){var y=1-g-m,T=g,x=m,E=b*this._invLength,R=t[0]*y+e[0]*T+i[0]*x,A=t[1]*y+e[1]*T+i[1]*x,C=t[2]*y+e[2]*T+i[2]*x;v.R3.cross(r,a,n),v.R3.normalize(r,r);var M=this.initIntersection(new S);M._i1=c,M._i2=l,M._i3=_,M._r1=y,M._r2=T,M._r3=x,v.R3.set(M._localIntersectionPoint,R,A,C),v.R3.copy(M._localIntersectionNormal,r),M._ratio=E,M._backface=v._E.determinant(M._matrix)*f<0}}}}}),operatorPoint:function(t){this._threshold<=0||b.Z.prototype.operatorPoint.call(this,t)},operatorLine:function(t,e){this._threshold<=0||b.Z.prototype.operatorLine.call(this,t,e)}}),"osgUtil","LineSegmentIntersectFunctor");const T=y},XDCw:(t,e,i)=>{"use strict";i.d(e,{Z:()=>l});var r,n,a,s=i("GoyH"),o=i("W40i"),h=i("K/iW"),u=i("zACX"),c=function(){h.Z.call(this),this._start=o.R3.create(),this._iStart=o.R3.create(),this._end=o.R3.create(),this._iEnd=o.R3.create(),this._threshold=0,this._iThreshold=0};s.Z.createPrototypeObject(c,s.Z.objectInherit(h.Z.prototype,{set:function(t,e,i){o.R3.copy(this._start,t),o.R3.copy(this._iStart,t),o.R3.copy(this._end,e),o.R3.copy(this._iEnd,e),void 0!==i&&(this._threshold=this._iThreshold=i)},setStart:function(t){o.R3.copy(this._start,t),o.R3.copy(this._iStart,t)},setEnd:function(t){o.R3.copy(this._end,t),o.R3.copy(this._iEnd,t)},intersectNode:intersectBoundingSphere:(n=o.R3.create(),a=o.R3.create(),function(t){if(!t.valid())return!1;o.R3.sub(n,this._iStart,t.center());var e=o.R3.sqrLen(n)-t.radius2();if(e<=0)return!0;o.R3.sub(a,this._iEnd,this._iStart);var i=o.R3.sqrLen(a),r=2*o.R3.dot(n,a),s=r*r-4*i*e;if(s<0)return!1;var h=.5/i,u=(-r-(s=Math.sqrt(s)))*h,c=(-r+s)*h;return!(u<=0&&c<=0||u>1&&c>1)}),intersect:(r=new u.Z,function(t,e){r.setGeometry(e),r.setIntersectionVisitor(t),r.setIntersector(this),r.set(this._iStart,this._iEnd,this._iThreshold);var i=e.getShape();i?i.intersectLineSegment(r,i.getNodes()[0],this._iStart,this._iEnd,this._iThreshold):(e.computeTransformedVertices&&r.setVertices(e.computeTransformedVertices()),r.apply(e),r.reset())}),setCurrentTransformation:function(t){if(o._E.invert(t,t),this._threshold>0){var e=this._iStart;o._E.getScale(e,t);var i=e[0],r=e[1],n=e[2];this._iThreshold=this._threshold*(i>r?i>n?i:n:r>n?r:n)}o.R3.transformMat4(this._iStart,this._start,t),o.R3.transformMat4(this._iEnd,this._end,t)}}),"osgUtil","LineSegmentIntersector");const l=c},E9Rp:Pxgm:(t,e,i)=>{"use strict";i.d(e,{Z:()=>f});var r=i("GoyH"),n=i("qlNd"),a=i("t5D/"),s=i("iUVs"),o=i("QtIg"),h=i("bfff"),u=i("nRYw"),c=i("W40i"),l=i("Kvhv"),_=i("9Aw2"),d=function(t){s.Z.call(this),this._state=void 0,this._camera=t,this._renderStage=void 0,this._stateGraph=void 0,this._frameStamp=void 0,this._previousCullsettings=new n.Z,this.setDefaults()};d.debugGraph=!1,r.Z.createPrototypeObject(d,r.Z.objectInherit(s.Z.prototype,{setDefaults:function(){this._state=new h.Z(new l.Z.ShaderGeneratorProxy),this._cullVisitor=new a.Z,this._cullVisitor.setRenderer(this),this._stateGraph=new u.Z,this.getCamera().setClearColor(c.vh.create()),this.setRenderStage(new o.Z);var t=i("5naU").Z,e=this.getCamera().getOrCreateStateSet();e.setAttributeAndModes(new t.Material),e.setAttributeAndModes(new t.Depth),e.setAttributeAndModes(new t.BlendFunc),e.setAttributeAndModes(new t.CullFace)},getCullVisitor:function(){return this._cullVisitor},setCullVisitor:function(t){t&&!t.getRenderer()&&t.setRenderer(this),this._cullVisitor=t},setRenderStage:function(t){this._renderStage=t},getCamera:function(){return this._camera},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},getState:function(){return this._state},setState:function(t){this._state=t},setGraphicContext:function(t){this._state.setGraphicContext(t)},getGraphicContext:function(){return this._state.getGraphicContext()},cullAndDraw:cull:function(){var t=this.getCamera(),e=t.getView();this._cullVisitor.setFrameStamp(this._frameStamp),this._cullVisitor.resetStats(),u.Z.reset(),this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage),this._cullVisitor.pushStateSet(t.getStateSet()),this._previousCullsettings.reset(),this._previousCullsettings.setCullSettings(this._cullVisitor),this._cullVisitor.setCullSettings(t),this._previousCullsettings.getSettingSourceOverrider()===this._cullVisitor&&this._previousCullsettings.getEnableFrustumCulling()&&this._cullVisitor.setEnableFrustumCulling(!0),this._cullVisitor.pushCameraModelViewProjectionMatrix(t,t.getViewMatrix(),t.getProjectionMatrix()),t.getBound();var r=e.getLight(),n=i("OP54").Z;if(r)switch(e.getLightingMode()){case n.LightingMode.HEADLIGHT:this._cullVisitor.addPositionedAttribute(null,r);break;case n.LightingMode.SKY_LIGHT:this._cullVisitor.addPositionedAttribute(t.getViewMatrix(),r)}var a=t.getViewport(),s=t.getScissor();this._cullVisitor.pushViewport(a),this._renderStage.setClearDepth(t.getClearDepth()),this._renderStage.setClearColor(t.getClearColor()),this._renderStage.setClearMask(t.getClearMask()),this._renderStage.setViewport(a),this._renderStage.setScissor(s),this._cullVisitor.setDatabaseRequestHandler(this._camera.getView().getDatabasePager()),this._cullVisitor.handleCullCallbacksAndTraverse(t),this._cullVisitor.popCameraModelViewProjectionMatrix(t),this._cullVisitor.setCullSettings(this._previousCullsettings),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var t=this.getState();t.resetCacheFrame(),t.resetStats(),this._renderStage.setCamera(this._camera),this._renderStage.draw(t),d.debugGraph&&(_.Z.instance().createRenderGraph(this._renderStage),d.debugGraph=!1),this._renderStage.setCamera(void 0),t.applyDefault()}}),"osgViewer","Renderer");const f=d},"5ZWq":(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=i("GoyH"),n=i("iUVs"),a=i("LvhW"),s=function(){n.Z.call(this),this._databasePager=new a.Z,this._sceneData=void 0};r.Z.createPrototypeObject(s,r.Z.objectInherit(n.Z.prototype,{getSceneData:function(){return this._sceneData},setSceneData:function(t){this._sceneData=t},setDatabasePager:function(t){this._databasePager=t},getDatabasePager:function(){return this._databasePager},updateSceneGraph:function(t){this._databasePager&&this._databasePager.updateSceneGraph(t.getFrameStamp()),this._sceneData&&this._sceneData.accept(t)}}),"osgViewer","Scene");const o=s},OP54:(t,e,i)=>{"use strict";i.d(e,{Z:()=>A});var r,n,a,s=i("UqX1"),o=i("W6eo"),h=i("p6+I"),u=i("lU+d"),c=i("2Vrk"),l=i("W40i"),_=i("5rJd"),d=i("5pih"),f=i("7itD"),p=i("rsXr"),g=i("Yy1w"),m=i("ojCs"),v=i("BvLe"),b=i("CtxI"),S=i("XDCw"),y=i("Pxgm"),T=i("5ZWq"),x=i("9Aw2"),E=i("u5PS"),R=function(){this._camera=new o.Z,this._camera.setName("OSGJS camera"),this._scene=new T.Z,this._camera.setName("OSGJS Scene"),this._frameStamp=new h.Z,this._lightingMode=void 0,this._manipulator=void 0,this._canvasWidth=0,this._canvasHeight=0,this._requestContinousUpdate=!0,this._requestRedraw=!0,this.setLightingMode(R.LightingMode.HEADLIGHT);var t=this.createRenderer(this.getCamera());t.setFrameStamp(this._frameStamp),this.getCamera().setRenderer(t),this.getCamera().setView(this)};R.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},R.prototype={requestRedraw:function(){this._requestRedraw=!0},requestContinuousUpdate:function(t){this._requestContinousUpdate=t},createRenderer:setGraphicContext:function(t){this.getCamera().getRenderer().getState().setGraphicContext(t)},getGraphicContext:initWebGLCaps:computeCanvasSize:function(t){a||(window.ResizeObserver?((a=new ResizeObserver(()).observe(t),r=t.clientWidth,n=t.clientHeight):(r=t.clientWidth,n=t.clientHeight)),r<1&&(r=1),n<1&&(n=1);var e=this._devicePixelRatio,i=Math.floor(r*e),s=Math.floor(n*e),o=!1;return this._canvasWidth!==i&&(t.width=i,this._canvasWidth=i,o=!0),this._canvasHeight!==s&&(t.height=s,this._canvasHeight=s,o=!0),o},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this._canvasHeight},getCanvasClientWidth:function(){return Math.ceil(this._canvasWidth/this._devicePixelRatio)},getCanvasClientHeight:getCanvasPixelRatio:function(){return this._devicePixelRatio},setUpView:function(t,e){var i=window.devicePixelRatio||1,r=e.getNumber("overrideDevicePixelRatio"),n=e.getNumber("maxDevicePixelRatio")||-1;"number"==typeof r?i=r:-1!==n&&(i=Math.min(i,n)),this._devicePixelRatio=i,this.computeCanvasSize(t);var a=t.width,s=t.height,o=a/s;if(this._camera.setViewport(new g.Z(0,0,a,s)),this._camera.setScissor(new p.Z),this._camera.setGraphicContext(this.getGraphicContext()),l._E.lookAt(this._camera.getViewMatrix(),l.R3.fromValues(0,0,-10),l.R3.create(),l.R3.fromValues(0,1,0)),l._E.perspective(this._camera.getProjectionMatrix(),Math.PI/180*55,o,1,1e3),e&&e.enableFrustumCulling&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e&&e.debugGraph){var h=this.getCamera();x.Z.instance().refreshGraph=function(){var t=x.Z.instance();t.setDisplayGraphRenderer(!0),t.createGraph(h)},E.Z.log("to refresh the graphs type in the console:\nOSG.osgUtil.DisplayGraph.instance().refreshGraph()")}},computeIntersections:function(t,e,i){return void 0===i&&(i=-1),this._lsi?this._lsi.reset():this._lsi=new S.Z,this._origIntersect||(this._origIntersect=l.R3.create(),this._dstIntersect=l.R3.create()),this._lsi.set(l.R3.set(this._origIntersect,t,e,0),l.R3.set(this._dstIntersect,t,e,1)),this._iv?this._iv.reset():(this._iv=new b.Z,this._iv.setIntersector(this._lsi)),this._iv.setTraversalMask(i),this._camera.accept(this._iv),this._lsi.getIntersections()},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setSceneData:function(t){if(t!==this._scene.getSceneData()){this._scene.setSceneData(t);for(var e=this._camera.getChildren(),i=void 0,r=0,n=e.length;r<n;r++)if("osgStats"===e[r].getName()){i=e[r];break}this._camera.removeChildren(),this._camera.addChild(t),i&&this._camera.addChild(i)}},getSceneData:function(){return this._scene.getSceneData()},setDatabasePager:function(t){this._scene.setDatabasePager(t)},getDatabasePager:function(){return this._scene.getDatabasePager()},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(t){this._manipulator=t},getLight:function(){return this._light},setLight:function(t){this._light=t,this._lightingMode!==R.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndModes(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(t){this._lightingMode!==t&&(this._lightingMode=t,this._lightingMode!==R.LightingMode.NO_LIGHT?this._light||(this._light=new c.Z):this._light=void 0)},flushDeletedGLObjects:function(t){var e=this.getGraphicContext(),i=t;i=s.Z.flushDeletedGLBufferArrays(e,i),i=m.Z.flushDeletedGLVertexArrayObjects(e,i),i=_.Z.getTextureManager(e).flushDeletedTextureObjects(e,i),i=d.Z.flushDeletedGLPrograms(e,i),i=f.Z.flushDeletedGLShaders(e,i),i=u.Z.flushDeletedGLFrameBuffers(e,i),u.Z.flushDeletedGLRenderBuffers(e,i)},flushAllDeletedGLObjects:function(){var t=this.getGraphicContext();m.Z.flushAllDeletedGLVertexArrayObjects(t),s.Z.flushAllDeletedGLBufferArrays(t),_.Z.getTextureManager(t).flushAllDeletedTextureObjects(t),d.Z.flushAllDeletedGLPrograms(t),f.Z.flushAllDeletedGLShaders(t),u.Z.flushAllDeletedGLFrameBuffers(t),u.Z.flushAllDeletedGLRenderBuffers(t)}};const A=R},"Lz+S":(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var r={SCENE:"scene",MANIPULATORS:"scene.manipulators",ORBIT_MANIPULATOR:"scene.manipulators.orbit",ORBIT_MANIPULATOR_MOUSEKEYBOARD:"scene.manipulators.orbit.mousekeyboard",ORBIT_MANIPULATOR_RESETTOHOME:"scene.manipulators.orbit.mousekeyboard.home",ORBIT_MANIPULATOR_TOUCH:"scene.manipulators.orbit.touch",ORBIT_MANIPULATOR_WEBVR:"scene.manipulators.orbit.webvr",ORBIT_MANIPULATOR_DEVICEORIENTATION:"scene.manipulators.orbit.deviceorientation",ORBIT_MANIPULATOR_GAMEPAD:"scene.manipulators.orbit.gamepad",FPS_MANIPULATOR:"scene.manipulators.fps",FPS_MANIPULATOR_MOUSEKEYBOARD:"scene.manipulators.fps.mousekeyboard",FPS_MANIPULATOR_RESETTOHOME:"scene.manipulators.fps.mousekeyboard.home",FPS_MANIPULATOR_TOUCH:"scene.manipulators.fps.touch",FPS_MANIPULATOR_WEBVR:"scene.manipulators.fps.webvr",FPS_MANIPULATOR_DEVICEORIENTATION:"scene.manipulators.fps.deviceorientation",FPS_MANIPULATOR_GAMEPAD:"scene.manipulators.fps.gamepad",CAD_MANIPULATOR:"scene.manipulators.cad",CAD_MANIPULATOR_MOUSEKEYBOARD:"scene.manipulators.cad.mousekeyboard",CAD_MANIPULATOR_RESETTOHOME:"scene.manipulators.cad.mousekeyboard.home",CAD_MANIPULATOR_TOUCH:"scene.manipulators.cad.touch",NODE_GIZMO:"scene.nodegizmo",UI:"ui",STATS:"ui.stats"};const n=r},F5Ms:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r,n,a,s=(r=!0,n=function(t,e,i){for(var r=null,n=0;n<i.length;++n){try{r=t.getContext(i[n],e)}catch(t){}if(r)break}return r},{create3DContext:a=function(t,e){var i;if(e&&e.webgl2){if(r=!1,i=n(t,e,["webgl2","experimental-webgl2"]))return i;r=!0}return n(t,e,["webgl","experimental-webgl","webkit-3d","moz-webgl"])},setupWebGL:function(t,e,i){i=i||function(t){if(r){var e=document.getElementsByTagName("body")[0];if(e){var i=window.WebGLRenderingContext?'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>':'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>';t&&(i+="<br/><br/>Status: "+t),e.innerHTML=i)}}},t.addEventListener&&t.addEventListener("webglcontextcreationerror",(,!1);var n=a(t,e);return n||i(""),n}});window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||,window.cancelRequestAnimFrame||(window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout),Date.now||(Date.now=;const o=s},aa6s:(t,e,i)=>{"use strict";i.d(e,{I:()=>o,c:()=>h});var r=i("/c5M"),n=i("g6dK"),a=!0,s=0,o=function(t){a=t},h=function(t){var e,o,h,u,c,l,_,d,f;t.osg.Program.registerErrorCallback((function(p,g,m){if(a&&(!(!m||0===m.length)&&-1===m.indexOf("Internal linking error"))){e||(e=t.osg.WebGLCaps.instance(),o=e.getWebGLParameter("UNMASKED_RENDERER_WEBGL"),h=e.getWebGLParameter("UNMASKED_VENDOR_WEBGL"),u=e.getWebGLParameter("MAX_VARYING_VECTORS"),c=e.getWebGLParameter("MAX_VERTEX_ATTRIBS"),l=e.getWebGLParameter("MAX_FRAGMENT_UNIFORM_VECTORS"),_=e.getWebGLParameter("MAX_VERTEX_UNIFORM_VECTORS"),d=i("R2Pi"),f=d&&d.apple&&d.apple.device);var v="Shader Error: ";if(v+=m,!f)if(o&&(v+="\n"+o),h&&(v+="\n"+h),30!==u&&(v+="\nVarying: "+u),p&&(16!==c&&(v+="\nAttributes:"+c),4096!==_&&(v+="\nVertUnif:"+_)),1024!==l&&(v+="\nFragUnif:"+l),e.isWebGL2())v+="\nWebGL2";else{var b,S=e.getWebGLExtensions(),y=["EXT_shader_texture_lod","OES_standard_derivatives","OES_vertex_array_object","EXT_texture_filter_anisotropic"];for(b=0;b<y.length;b++){var T=y[b];S[T]&&(v+="\n"+T.substring(T.indexOf("_")+1))}for(var x=["hasLinearFloatRTT","hasLinearHalfFloatRTT","hasHalfFloatRTT","hasFloatRTT"];b<x.length;b++){var E=x[b];e[E]()&&(v+="\n"+E.substring(3))}}p&&(v+="\nVS\n"+p),g&&(v+="\nFS\n "+g);var R="errorLogs ";l<64&&(R="ultraLowGPU");var A={tags:{shaderErrors:R}};if(r.Z.client.captureMessage(v,A),++s>1){a=!1;var C=new n.Z({title:"3D/WebGL context error",text:"An error occurred while rendering the model. It might not look as expected.",safe:!0,buttons:{continue:!0,continueLabel:"OK",cancel:!1}});C.open().then(bind(this))}}}))}},aqzA:(t,e,i)=>{"use strict";i.d(e,{Z:()=>Ws});i("tlSa");var r=i("I50a"),n=i("5naU"),a=i("GoyH"),s=i("W40i");const o={Vec3:0,Quat:1,Float:2,FloatCubicBezier:3,Vec3CubicBezier:4,QuatSlerp:5,Matrix:6,Count:7};var h={InvalidTargetID:-1},u=function(t,e,i){return{type:t,id:h.InvalidTargetID,channels:[],value:e,defaultValue:i}};h.createQuatTarget=function(t){return u(o.Quat,s.gf.copy(s.gf.create(),t),s.gf.copy(s.gf.create(),t))},h.createVec3Target=function(t){return u(o.Vec3,s.R3.copy(s.R3.create(),t),s.R3.copy(s.R3.create(),t))},h.createFloatTarget=h.createMatrixTarget=function(t){return u(o.Matrix,s._E.copy(s._E.create(),t),s._E.copy(s._E.create(),t))};const c=h;var l={},_=function(t,e,i,r,n,a){var s=i[0],o=i[i.length-1];return a.start=s,a.keys=e,a.end=o,a.times=i,a.type=t,a.duration=o-s,a.target=r,a.name=n,a},d={create:function(){return 0}},f={create:function(){return s.R3.create32()}},p={create:,g=function(t,e){return{channel:e,value:t.create(),targetID:c.InvalidTargetID,weight:1,key:0,start:0,end:0}},m=function(t){return g(f,t)},v=function(t){return g(p,t)},b=function(t){return g(d,t)},S=function(t){return g(d,t)},y=l.createInstanceChannel=l.createInstanceVec3Channel=m,l.createInstanceQuatChannel=v,l.createInstanceQuatSlerpChannel=v,l.createInstanceFloatChannel=b,l.createInstanceFloatCubicBezierChannel=S,l.createInstanceVec3CubicBezierChannel=y,l.createVec3Channel=function(t,e,i,r,n){return _(o.Vec3,t,e,i,r,n||{})},l.createQuatChannel=function(t,e,i,r,n){return _(o.Quat,t,e,i,r,n||{})},l.createQuatSlerpChannel=function(t,e,i,r,n){return _(o.QuatSlerp,t,e,i,r,n||{})},l.createFloatChannel=function(t,e,i,r,n){return _(o.Float,t,e,i,r,n||{})},l.createFloatCubicBezierChannel=function(t,e,i,r,n){return _(o.FloatCubicBezier,t,e,i,r,n||{})},l.createVec3CubicBezierChannel=function(t,e,i,r,n){return _(o.Vec3CubicBezier,t,e,i,r,n||{})},l[o.Vec3]=m,l[o.Quat]=v,l[o.QuatSlerp]=v,l[o.Float]=b,l[o.FloatCubicBezier]=S,l[o.Vec3CubicBezier]=y,l.ChannelType=o;const T=l;var x=0,E=function(){};E.createAnimation=function(t,e){for(var i=1/0,r=-1/0,n=0;n<t.length;n++)i=Math.min(i,t[n].start),r=Math.max(r,t[n].end);var a=r-i,s=e||"animation"+x.toString();return x++,{channels:t,duration:a,name:s,start:i}},E.createInstanceAnimation=function(t){for(var e=[],i=0;i<t.channels.length;i++){var r=T.createInstanceChannel(t.channels[i]);e.push(r)}return{channels:e,duration:t.duration,start:0,name:t.name,firstKeyTime:t.start}};const R=E;var A,C,M,I,w,N,P=i("4yGu"),Z=i("wLWJ"),L=i("u5PS"),O=i("iUVs"),F=function(t,e,i){i[0]=e[t++],i[1]=e[t++],i[2]=e[t++]},D=function(t,e,i){i[0]=e[t++],i[1]=e[t++],i[2]=e[t++],i[3]=e[t++]},U=function(t,e){var i=e.channel,r=e.value,n=i.keys,a=i.times;if(t>=a[a.length-1])return e.key=0,void F(n.length-3,n,r);if(t<=a[0])return e.key=0,void F(0,n,r);var s=e.key;if(t>a[s])for(;a[s+1]<t;)s++;else if(t<a[s])for(;a[s]>t;)s--;var o=a[s],h=a[s+1],u=3*s,c=n[u++],l=n[u++],_=n[u++],d=n[u++],f=n[u++],p=n[u++],g=(t-o)/(h-o);r[0]=c+(d-c)*g,r[1]=l+(f-l)*g,r[2]=_+(p-_)*g,e.key=s},B=(A=s.gf.create32(),C=s.gf.create32(),function(t,e){var i=e.channel,r=e.value,n=i.keys,a=i.times;if(t>=a[a.length-1])return e.key=0,void D(n.length-4,n,r);if(t<=a[0])return e.key=0,void D(0,n,r);var o=e.key;if(t>a[o])for(;a[o+1]<t;)o++;else if(t<a[o])for(;a[o]>t;)o--;var h=a[o],u=a[o+1],c=4*o;A[0]=n[c++],A[1]=n[c++],A[2]=n[c++],A[3]=n[c++],C[0]=n[c++],C[1]=n[c++],C[2]=n[c++],C[3]=n[c++];var l=(t-h)/(u-h);s.gf.nlerp(r,A,C,l),e.key=o}),k=function(){var t=s.gf.create32(),e=s.gf.create32();return function(i,r){var n=r.channel,a=r.value,o=n.keys,h=n.times;if(i>=h[h.length-1])return r.key=0,void D(o.length-4,o,a);if(i<=h[0])return r.key=0,void D(0,o,a);var u=r.key;if(i>h[u])for(;h[u+1]<i;)u++;else if(i<h[u])for(;h[u]>i;)u--;var c=h[u],l=h[u+1],_=4*u;t[0]=o[_++],t[1]=o[_++],t[2]=o[_++],t[3]=o[_++],e[0]=o[_++],e[1]=o[_++],e[2]=o[_++],e[3]=o[_++];var d=(i-c)/(l-c);s.gf.slerp(a,t,e,d),r.key=u}}(),V=function(t,e){var i=e.channel,r=e.value,n=i.keys,a=i.times;if(t>=a[a.length-1])return e.key=0,void(e.value=n[n.length-1]);if(t<=a[0])return e.key=0,void(e.value=n[0]);var s=e.key;if(t>a[s])for(;a[s+1]<t;)s++;else if(t<a[s])for(;a[s]>t;)s--;var o=a[s],h=a[s+1],u=s,c=n[u++];r=c+(n[u++]-c)*((t-o)/(h-o)),e.key=s,e.value=r},G=function(t,e){var i=e.channel,r=e.value,n=i.keys,a=i.times;if(t>=a[a.length-1])return e.key=0,void(e.value=n[n.length-3]);if(t<=a[0])return e.key=0,void(e.value=n[0]);var s=e.key;if(t>a[s])for(;a[s+1]<t;)s++;else if(t<a[s])for(;a[s]>t;)s--;var o=(t-a[s])/(a[s+1]-a[s]),h=1-o,u=h*h,c=u*h,l=o*o,_=3*s;r=n[_]*c+n[_+1]*(3*o*u)+n[_+2]*(3*l*h)+n[_+3]*(l*o),e.key=s,e.value=r},j=(M=s.R3.create(),I=s.R3.create(),w=s.R3.create(),N=s.R3.create(),function(t,e){var i=e.channel,r=e.value,n=i.keys,a=i.times;if(t>=a[a.length-1])return e.key=0,void F(n.length-9,n,r);if(t<=a[0])return e.key=0,void F(0,n,r);var o=e.key;if(t>a[o])for(;a[o+1]<t;)o++;else if(t<a[o])for(;a[o]>t;)o--;var h=(t-a[o])/(a[o+1]-a[o]),u=1-h,c=u*u,l=c*u,_=h*h,d=9*o;s.R3.scale(M,s.R3.set(M,n[d++],n[d++],n[d++]),l),s.R3.scale(I,s.R3.set(I,n[d++],n[d++],n[d++]),3*h*c),s.R3.scale(w,s.R3.set(w,n[d++],n[d++],n[d++]),3*_*u),s.R3.scale(N,s.R3.set(N,n[d++],n[d++],n[d++]),_*h),r[0]=M[0]+I[0]+w[0]+N[0],r[1]=M[1]+I[1]+w[1]+N[1],r[2]=M[2]+I[2]+w[2]+N[2],e.key=o}),W=T.ChannelType,H={};H[W.Vec3]=U,H[W.Quat]=B,H[W.QuatSlerp]=k,H[W.Float]=V,H[W.FloatCubicBezier]=G,H[W.Vec3CubicBezier]=j,H.Vec3LerpInterpolator=U,H.QuatLerpInterpolator=B,H.QuatSlerpInterpolator=k,H.FloatLerpInterpolator=V,H.FloatCubicBezierInterpolator=G,H.Vec3CubicBezierInterpolator=j;const z=H;var q=i("CJNH"),X=function(){q.Z.call(this),this._animationUpdateCallback={}};a.Z.createPrototypeObject(X,a.Z.objectInherit(q.Z.prototype,{getAnimationUpdateCallbackMap:function(){return this._animationUpdateCallback},apply:function(t){for(var e=t.getUpdateCallbackList(),i=0,r=e.length;i<r;i++){var n=e[i];n instanceof Z.Z&&(this._animationUpdateCallback[n.getInstanceID()]=n)}this.traverse(t)}}),"osgAnimation","CollectAnimationUpdateCallbackVisitor");const K=X;var Y=i("UqX1"),Q=i("5Zr1"),J=i("mixV"),$=function(){Z.Z.call(this),this._targets=[],this._targetNames=[],this._morphs=[],this._weights=new Float32Array(J.Z.MAX_MORPH_GPU),this._indexMap=new Uint32Array(J.Z.MAX_MORPH_GPU),this._gpuMorphed=[],this._maxMorphGPU=-1},tt=a.Z.createPrototypeObject($,a.Z.objectInherit(Z.Z.prototype,{_initNode:function(t){var e;t instanceof J.Z?e=t:t instanceof Q.Z&&t.getSourceGeometry()instanceof J.Z&&(e=t.getSourceGeometry()),e&&e.getName()===this.getName()&&(e.isInitialized()||e.init(),this._morphs.push(e),this._maxMorphGPU=Math.min(this._maxMorphGPU,e.getMaximumPossibleMorphGPU()))},init:function(t){this._maxMorphGPU=J.Z.MAX_MORPH_GPU,this._morphs.length=0;var e=t.getChildren();if(e.length)for(var i=0,r=e.length;i<r;i++)this._initNode(e[i]);else this._initNode(t)},isInitialized:function(){var t=this._morphs,e=t.length;if(!e)return!1;for(var i=0;i<e;++i)if(!t[i].isInitialized())return!1;return!0},getNumTarget:function(){return this._targets.length},getTarget:function(t){return this._targets[t]},getTargetName:function(t){return this._targetNames[t]},addTarget:function(t,e){this._targets[e]=c.createFloatTarget(0),this._targetNames[e]=t},_remapBufferArrays:function(){for(var t=this._indexMap,e=this._morphs,i=0;i<this._maxMorphGPU;++i)for(var r="_"+i,n="_"+t[i],a=0,s=e.length;a<s;++a)for(var o=e[a],h=o.getVertexAttributeList(),u=o.getMorphTargetNames(),c=0,l=u.length;c<l;++c){var _=u[c];h[_+r].setBufferArray(h[_+n].getInitialBufferArray())}},_mergeExtraMorphTarget:function(t,e,i){var r=0,n=this._gpuMorphed,a=t[e],s=a.getElements().length,o=s/a.getItemSize(),h=a.getItemSize();a._cpuMorph=a._cpuMorph||new Y.Z(Y.Z.ARRAY_BUFFER,new Float32Array(s),h);var u=a._cpuMorph.getElements();for(r=0;r<s;++r)u[r]=0;for(var c=this._targets,l=0,_=c.length;l<_;++l)if(!0!==n[l]){var d=c[l].value;if(!(Math.abs(d)<=J.Z.EFFECTIVE_EPS)){d/=i;var f=t[e+"_"+l].getInitialBufferArray().getElements();for(r=0;r<o;++r){var p=r*h;u[p]+=d*f[p],u[p+1]+=d*f[p+1],u[p+2]+=d*f[p+2]}}}t[e+"_"+(this._maxMorphGPU-1)].setBufferArray(a._cpuMorph),a._cpuMorph.dirty()},_computeExtraWeightsSum:function(){for(var t=this._gpuMorphed,e=0,i=this._targets,r=0,n=i.length;r<n;++r)if(!0!==t[r]){var a=i[r].value;Math.abs(a)<=J.Z.EFFECTIVE_EPS||(e+=a)}var s=1e-5;return Math.abs(e)>s?e:e<0?-s:s},_morphBufferArrayCPU:function(){for(var t=this._weights[this._maxMorphGPU-1]=this._computeExtraWeightsSum(),e={},i=this._morphs,r=0,n=i.length;r<n;++r)for(var a=i[r],s=a.getVertexAttributeList(),o=a.getMorphTargetNames(),h=0,u=o.length;h<u;++h){var c=o[h],l=s[c];l&&!e[l.getInstanceID()]&&(e[l.getInstanceID()]=!0,this._mergeExtraMorphTarget(s,c,t))}},updateWeights:function(){if(0!==this._maxMorphGPU){var t=0,e=this._targets,i=e.length,r=this._weights;if(r[0]=r[1]=r[2]=r[3]=0,i<=this._maxMorphGPU)for(t=0;t<i;++t)r[t]=e[t].value;else{var n=this._indexMap;n[0]=n[1]=n[2]=n[3]=0;var a=this._gpuMorphed;for(a.length=i,t=0;t<i;++t)a[t]=!1;var s=e.slice(0).sort(tt);for(t=0;t<this._maxMorphGPU;++t){var o=e.indexOf(s[t]);a[o]=!0,n[t]=o,r[t]=s[t].value}var h=Math.abs(s[this._maxMorphGPU].value)>J.Z.EFFECTIVE_EPS;a[n[this._maxMorphGPU-1]]=!h,this._remapBufferArrays(),h&&this._morphBufferArrayCPU()}}},reset:function(){for(var t=this._targets,e=0,i=t.length;e<i;++e)t[e].value=t[e].defaultValue},update:function(t){this.isInitialized()||this.init(t),this.updateWeights();for(var e=this._weights,i=Math.min(this._maxMorphGPU,this._targets.length),r=this._morphs,n=0,a=r.length;n<a;++n)for(var s=r[n].getTargetsWeight(),o=0;o<i;o++)s[o]=e[o];return!0}}),"osgAnimation","UpdateMorph");const et=$;var it=i("mix8"),rt=i("U5Vy"),nt={lerp:init:function(){return 0},copy:create:,at=[];at[T.ChannelType.Float]=1,at[T.ChannelType.FloatCubicBezier]=1,at[T.ChannelType.Vec3]=3,at[T.ChannelType.Vec3CubicBezier]=3,at[T.ChannelType.Quat]=4,at[T.ChannelType.QuatSlerp]=4,at[T.ChannelType.Matrix]=16;var st=[];st.length=T.ChannelType.Count,st[T.ChannelType.Vec3]=s.R3,st[T.ChannelType.Quat]=s.gf,st[T.ChannelType.QuatSlerp]=s.gf,st[T.ChannelType.Float]=nt,st[T.ChannelType.FloatCubicBezier]=nt,st[T.ChannelType.Vec3CubicBezier]=s.R3,st[T.ChannelType.Matrix]=s._E;var ot=function(){O.Z.call(this),this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._targets=[],this._targetsMap={},this._targetsByTypes=[],this._targetsByTypes.length=T.ChannelType.Count;for(var t=0,e=this._targetsByTypes.length;t<e;t++)this._targetsByTypes[t]=[];this._activeAnimations={},this._activeAnimationList=[],this._activeChannelsByTypes=[],this._activeChannelsByTypes.length=T.ChannelType.Count;for(var i=0,r=this._activeChannelsByTypes.length;i<r;i++)this._activeChannelsByTypes[i]=[];this._animationsUpdateCallback={},this._animationsUpdateCallbackArray=[],this._animationsToRegister=[],this._pause=!1,this._dirty=!1,this._seekTime=-1};a.Z.createPrototypeObject(ot,a.Z.objectInherit(O.Z.prototype,{init:function(t){this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._resetTargets(),this._activeAnimations={},this._activeAnimationList.length=0;for(var e=0,i=this._activeChannelsByTypes.length;e<i;e++)this._activeChannelsByTypes[e].length=0;this._animationsUpdateCallback={},this._animationsUpdateCallbackArray.length=0,this._pause=!1,this._seekTime=-1,this.addAnimations(t)},addAnimations:function(t){var e=this._addAnimation(t);Array.prototype.push.apply(this._animationsToRegister,e),this._dirty=!0,this._registerAnimations()},update:function(t,e){this._dirty&&(this._findAnimationUpdateCallback(t),this._registerTargetFoundInAnimationCallback(),this._registerAnimations());var i=e.getFrameStamp().getSimulationTime();return-1!==this._seekTime&&(this._pauseTime=-this._seekTime+this._startTime+i),this._seekTime=-1,this._pause?this._pauseTime=i-this._simulationTime+this._startTime:this._simulationTime=this._startTime+(i-this._pauseTime),this.updateManager(this._simulationTime*this._timeFactor),!0},updateManager:function(t){this._processStartAnimation(t);for(var e=T.ChannelType.Count,i=0;i<e;i++){var r=this._activeChannelsByTypes[i];this._updateChannelsType(t,r,z[i])}for(var n=0;n<e;n++){var a=this._targetsByTypes[n];this._updateTargetType(a,st[n])}for(var s=0,o=this._animationsUpdateCallbackArray.length;s<o;s++){this._animationsUpdateCallbackArray[s].computeChannels()}this._removeFinishedAnimation(t)},togglePause:function(){this._pause=!this._pause,this._pause||(this._seekTime=this._simulationTime)},getSimulationTime:function(){return this._simulationTime},setSimulationTime:function(t){this._simulationTime=t},setSeekTime:function(t){this._simulationTime=t,this._seekTime=t},stopAnimation:function(t){for(var e=this._activeAnimationList,i=0,r=e.length;i<r;++i)if(e[i].name===t)return this._removeActiveChannels(this._instanceAnimations[t]),this._activeAnimations[t]=void 0,void e.splice(i,1)},stopAllAnimation:function(){for(var t=this._activeAnimationList,e=0,i=t.length;e<i;++e){var r=t[e].name;this._removeActiveChannels(this._instanceAnimations[r]),this._activeAnimations[r]=void 0}t.length=0},setTimeFactor:function(t){var e=t/this._timeFactor;this._startTime+=(this._simulationTime-this._simulationTime*e)/e,this._timeFactor=t,this._pause&&(this._simulationTime+=(this._simulationTime-this._simulationTime*e)/e)},getTimeFactor:function(){return this._timeFactor},isPlaying:function(t){return!!this._activeAnimations[t]},playAnimationObject:function(t){var e=this._instanceAnimations[t.name];e?this.isPlaying(t.name)||(e.priority=void 0===t.priority?0:t.priority,e.weight=void 0===t.weight?1:t.weight,e.loop=void 0===t.loop||t.loop,this._startAnimations[e.name]=e):L.Z.info("no animation "+t.name+" found")},playAnimation:function(t,e,i,r){var n;return n="object"==typeof t?t:{name:t,priority:i,weight:r,loop:e},this.playAnimationObject(n)},getAnimations:function(){return this._instanceAnimations},_registerAnimations:function(){if(this._targets.length){for(var t=0,e=this._animationsToRegister.length;t<e;t++){var i=this._animationsToRegister[t];this._registerInstanceAnimation(i)}this._animationsToRegister.length=0,this._dirty=!1}},_registerInstanceAnimation:function(t){for(var e=t.channels,i=0,r=e.length;i<r;i++){var n=e[i],a=n.channel.target+"."+n.channel.name;this._targetMap[a]?n.targetID=this._targetMap[a].id:L.Z.warn("registerInstanceAnimation did not find targetName ("+a+") in the scene graph")}return!0},_findAnimationUpdateCallback:function(t){var e=new K;t.accept(e),this._animationsUpdateCallback=e.getAnimationUpdateCallbackMap()},_registerTargetFoundInAnimationCallback:function(){this._resetTargets();var t,e,i=0,r=this._targetMap,n=this._targets,a=function(t,e){if(r[t])e!==r[t]&&L.Z.warn("detected differents target instance with the same name ("+t+")");else{r[t]=e,e.id=i++,n.push(e);var a=e.type;this._targetsByTypes[a].push(e)}}.bind(this);for(var s in this._animationsUpdateCallback){var o=this._animationsUpdateCallback[s];if(o instanceof rt.Z||o instanceof it.Z){var h=o.getStackedTransforms(),u=h.length;if(!u)continue;this._animationsUpdateCallbackArray.push(o);for(var c=0;c<u;c++){var l=h[c];t=l.getTarget(),e=l.getName(),a(o.getName()+"."+e,t,e)}}else if(o instanceof et){var _=o.getNumTarget();if(!_)continue;this._animationsUpdateCallbackArray.push(o);for(var d=0;d<_;d++)a((e=o.getTargetName(d))+"."+d,t=o.getTarget(d),e)}}},_addAnimation:function(t){for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i],a=n.name;if(!this._instanceAnimations[a]){var s=R.createInstanceAnimation(n);this._instanceAnimations[a]=s,e.push(s)}}return e},_addActiveChannels:function(t,e){for(var i=e.channels,r=0,n=i.length;r<n;r++){var a=i[r],s=a.channel.type;a.t=t,a.instanceAnimation=e;var o=a.targetID;o!==c.InvalidTargetID&&(this._activeChannelsByTypes[s].push(a),this._targets[o].channels.push(a))}},_removeActiveChannels:function(t){for(var e=t.channels,i=0,r=e.length;i<r;i++){var n=e[i],a=n.channel.type,s=n.targetID;if(s!==c.InvalidTargetID){var o=this._targets[s].channels,h=o.indexOf(n);o.splice(h,1);var u=this._activeChannelsByTypes[a],l=u.indexOf(n);u.splice(l,1)}}},_updateTargetType:function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i],a=n.channels,s=a.length;if(0===s)n.value=e.copy(n.value,n.defaultValue);else if(1===s)n.value=e.copy(n.value,a[0].value);else{n.value=e.init(n.value);for(var o=0,h=0,u=a.length;h<u;h++){var c=a[h],l=c.weight;if(0!==(o+=l)&&0!==l){var _=l/o;n.value=e.lerp(n.value,n.value,c.value,_)}}}}},_updateChannelsType:function(t,e,i){for(var r=0,n=e.length;r<n;r++){var a=e[r],s=a.instanceAnimation,o=s.loop,h=t-a.t;o&&s.duration>0&&(h<0?h=s.duration-Math.abs(h%s.duration):h%=s.duration),i(h+s.firstKeyTime,a)}},_removeFinishedAnimation:function(t){for(var e=this._activeAnimationList,i=0;i<e.length;){var r=e[i],n=r.name;t>r.end&&!1===r.loop?(this._removeActiveChannels(r),this._activeAnimations[n]=void 0,e.splice(i,1)):i++}},_addActiveAnimation:function(t,e){this._activeAnimations[e.name]=e;var i=this._instanceAnimations[e.name];i.start=t,i.end=t+i.duration,this._addActiveChannels(t,i),this._activeAnimationList.push(i)},_processStartAnimation:function(t){if(this._targets.length){var e;for(e in this._startAnimations){var i=this._startAnimations[e],r=i.name;this.isPlaying(r)||this._addActiveAnimation(t,i)}void 0!==e&&(this._startAnimations={})}},_resetTargets:function(){this._targetMap={},this._targets.length=0;for(var t=0,e=this._targetsByTypes.length;t<e;t++)this._targetsByTypes[t].length=0},resetUpdateCallbacks:resetAllStackedTransforms:function(){L.Z.warn("Uses resetUpdateCallback instead"),this.resetUpdateCallbacks()},setAnimationLerpEndStart:function(t,e){var i=t.channels;void 0===t.originalDuration&&(t.originalDuration=t.duration),t.duration=t.originalDuration+e;for(var r=t.firstKeyTime,n=t.originalDuration,a=0,s=i.length;a<s;++a){var o=i[a].channel;if(!(Math.abs(o.start-r)>.01||Math.abs(o.duration-n)>.01)){void 0===o.originalEnd&&(o.originalEnd=o.end),o.end=o.originalEnd+e;var h=at[o.type],u=o.times.buffer.byteLength/4;if(0===e)o.keys=new Float32Array(o.keys.buffer,0,(u-1)*h),o.times=new Float32Array(o.times.buffer,0,u-1);else{o.keys=new Float32Array(o.keys.buffer,0,u*h);for(var c=(u-1)*h,l=0;l<h;++l)o.keys[c+l]=o.keys[l];o.times=new Float32Array(o.times.buffer,0,u),o.times[u-1]=o.times[u-2]+e}}}}}),"osgAnimation","BasicAnimationManager"),ot.TypeToSize=at;const ht=ot;var ut=i("igDg");const ct={easeLinear:easeOutQuad:function(t){var e=t-1;return 1-e*e},easeInQuad:easeInOutQuad:function(t){var e=t-1,i=2*t;return i<1?t*i:1-e*e*2},easeOutCubic:function(t){var e=t-1;return 1+e*e*e},easeInCubic:easeInOutCubic:function(t){var e=t-1,i=2*t;return i<1?t*i*i:1+e*e*e*4},easeOutQuart:function(t){var e=t-1;return 1-e*e*e*e},easeInQuart:easeInOutQuart:function(t){var e=t-1,i=2*t;return i<1?t*i*i*i:1-e*e*e*e*8},easeOutQuintic:function(t){var e=t-1;return 1+e*e*e*e*e},easeInQuintic:easeInOutQuintic:function(t){var e=t-1,i=2*t;return i<1?t*i*i*i*i:1+e*e*e*e*e*16},easeOutSextic:function(t){var e=t-1;return 1-e*e*e*e*e*e},easeInSextic:function(t){return t*t*t*t*t*t},easeInOutSextic:function(t){var e=t-1,i=2*t;return i<1?t*i*i*i*i*i:1-e*e*e*e*e*e*32},easeOutSeptic:function(t){var e=t-1;return 1+e*e*e*e*e*e*e},easeInSeptic:function(t){return t*t*t*t*t*t*t},easeInOutSeptic:function(t){var e=t-1,i=2*t;return i<1?t*i*i*i*i*i*i:1+e*e*e*e*e*e*e*64},easeOutOctic:function(t){var e=t-1;return 1-e*e*e*e*e*e*e*e},easeInOctic:function(t){return t*t*t*t*t*t*t*t},easeInOutOctic:function(t){var e=t-1,i=2*t;return i<1?t*i*i*i*i*i*i*i:1-e*e*e*e*e*e*e*e*128},easeOutBack:function(t){var e=t-1,i=1.70158;return 1+e*e*(e*(i+1)+i)},easeInBack:function(t){var e=1.70158;return t*t*(t*(e+1)-e)},easeInOutBack:function(t){var e=t-1,i=2*t,r=2.5949095;return t<.5?t*i*(i*(r+1)-r):1+2*e*e*(2*e*(r+1)+r)},easeOutCircle:easeInCircle:easeInOutCircle:function(t){var e=t-1,i=2*t;return i<1?.5*(1-Math.sqrt(1-i*i)):.5*(Math.sqrt(1-4*e*e)+1)},easeOutElastic:function(t){return Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},easeInElastic:function(t){return-1*Math.pow(2,10*t)*Math.sin(2*(t-1-.075)*Math.PI/.3)},easeInOutElastic:function(t){return(t*=2)<1?1*Math.pow(2,10*t)*-.5*Math.sin(2*(t-1-.45)*Math.PI/.45):1*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-.45)*Math.PI/.45)*.5+1},easeOutBounce:easeInBounce:easeInOutBounce:function(t){var e;return t<.5?(e=!0,t=1-2*t):t=2*t-1,t<1/2.75?t*=7.5625*t:t=t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5}};var lt=i("5LU5"),_t=i("11nE"),dt=function(t,e){O.Z.call(this),this._target=c.createMatrixTarget(e||s._E.IDENTITY),t&&this.setName(t)};a.Z.createPrototypeObject(dt,a.Z.objectInherit(O.Z.prototype,{init:function(t){this.setMatrix(t),s._E.copy(this._target.defaultValue,t)},getTarget:function(){return this._target},getMatrix:function(){return this._target.value},setMatrix:function(t){s._E.copy(this._target.value,t)},resetToDefaultValue:function(){this.setMatrix(this._target.defaultValue)},applyToMatrix:function(t){s._E.mul(t,t,this._target.value)}}),"osgAnimation","StackedMatrix");const ft=dt;var pt,gt=s.gf.create(),mt=function(t,e){O.Z.call(this),this._target=c.createQuatTarget(e||gt),t&&this.setName(t)};a.Z.createPrototypeObject(mt,a.Z.objectInherit(O.Z.prototype,{init:function(t){this.setQuaternion(t),s.gf.copy(this._target.defaultValue,t)},setQuaternion:function(t){s.gf.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setQuaternion(this._target.defaultValue)},applyToMatrix:(pt=s._E.create(),function(t){var e=pt;s._E.fromQuat(e,this._target.value),s._E.mul(t,t,e)})}),"osgAnimation","StackedQuaternion");const vt=mt;var bt=function(t,e,i){O.Z.call(this),this._axis=s.R3.fromValues(0,0,1),e&&s.R3.copy(this._axis,e),this._target=c.createFloatTarget("number"==typeof i?i:0),t&&this.setName(t)};a.Z.createPrototypeObject(bt,a.Z.objectInherit(O.Z.prototype,{init:function(t,e){this.setAxis(t),this.setAngle(e),this._target.defaultValue=e},setAxis:function(t){s.R3.copy(this._axis,t)},setAngle:getTarget:function(){return this._target},resetToDefaultValue:function(){this.setAngle(this._target.defaultValue)},applyToMatrix:function(){var t=s._E.create(),e=s.gf.create();return function(i){var r=this._axis,n=e,a=t,o=this._target.value;s.gf.setAxisAngle(n,r,o),s._E.fromQuat(a,n),s._E.mul(i,i,a)}}()}),"osgAnimation","StackedRotateAxis");const St=bt;var yt=function(t,e){O.Z.call(this),this._target=c.createVec3Target(e||s.R3.ONE),t&&this.setName(t)};a.Z.createPrototypeObject(yt,a.Z.objectInherit(O.Z.prototype,{init:function(t){this.setScale(t),s.R3.copy(this._target.defaultValue,t)},setScale:function(t){s.R3.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setScale(this._target.defaultValue)},applyToMatrix:function(t){var e=this._target.value;s._E.scale(t,t,e)}}),"osgAnimation","StackedScale");const Tt=yt;var xt=function(t,e){O.Z.call(this),this._target=c.createVec3Target(e||s.R3.ZERO),t&&this.setName(t)};a.Z.createPrototypeObject(xt,a.Z.objectInherit(O.Z.prototype,{init:function(t){this.setTranslate(t),s.R3.copy(this._target.defaultValue,t)},setTranslate:getTarget:function(){return this._target},resetToDefaultValue:applyToMatrix:function(t){s._E.translate(t,t,this._target.value)}}),"osgAnimation","StackedTranslate");const Et=xt;var Rt=i("DZjg"),At={};a.Z.objectMix(At,ct),a.Z.objectMix(At,z),At.Animation=R,At.SkinningAttribute=P.Z,At.AnimationUpdateCallback=Z.Z,At.BasicAnimationManager=ht,At.Bone=ut.Z,At.Channel=T,At.CollectAnimationUpdateCallbackVisitor=K,At.MorphAttribute=lt.Z,At.MorphGeometry=J.Z,At.RigGeometry=Q.Z,At.Skeleton=_t.Z,At.StackedMatrix=ft,At.StackedQuaternion=vt,At.StackedRotateAxis=St,At.StackedScale=Tt,At.StackedTranslate=Et,At.UpdateBone=it.Z,At.UpdateMatrixTransform=rt.Z,At.UpdateMorph=et,At.UpdateSkeleton=Rt.Z;const Ct=At;var Mt=i("RqNa"),It=i("Hiiq"),wt=i("LvhW"),Nt=i("lZH+"),Pt=i.n(Nt),Zt=i("pSxj"),Lt=a.Z.rejectObject,Ot={Object:function(t,e){var i=t.getJSON();if(i.Name&&e.setName(i.Name),i.UserDataContainer){var r=t.setJSON(i.UserDataContainer).readUserDataContainer();void 0!==r&&e.setUserData(r)}return e},Node:function(t,e){var i=t.getJSON();Ot.Object(t,e);var r=[];if(i.UpdateCallbacks)for(var n=e.addUpdateCallback.bind(e),a=0,s=i.UpdateCallbacks.length;a<s;a++){var o=t.setJSON(i.UpdateCallbacks[a]).readObject();r.push(o),o.then(n)}if(i.StateSet){var h=t.setJSON(i.StateSet).readObject();r.push(h),h.then(e.setStateSet.bind(e))}var u=[];if(i.Children)for(var c=0,l=i.Children.length;c<l;c++)u.push(t.setJSON(i.Children[c]).readObject());return Pt().all(r).then((function(){return Pt().all(u).then((function(t){for(var i=t.length,r=0;r<i;r++)e.addChild(t[r]);return e}))}))},StateSet:function(t,e){var i=t.getJSON();Ot.Object(t,e),void 0!==i.RenderingHint&&e.setRenderingHint(i.RenderingHint);var r,n,a=[];if(void 0!==i.AttributeList)for(var s=0,o=i.AttributeList.length;s<o;s++)r=i.AttributeList[s],n=void 0,(n=t.setJSON(r).readObject()).isRejected()||(a.push(n),n.then(e.setAttributeAndModes.bind(e)));var h=function(i,r){var n=t.setJSON(r).readObject();n.isRejected()||(a.push(n),n.then(e.setTextureAttributeAndModes.bind(e,i)))};if(i.TextureAttributeList)for(var u=i.TextureAttributeList,c=0,l=u.length;c<l;c++)for(var _=u[c],d=0,f=_.length;d<f;d++)h(c,_[d]);return Pt().all(a).then((function(){return e}))},Material:function(t,e){var i=t.getJSON();return i.Diffuse&&i.Emission&&i.Specular&&void 0!==i.Shininess?(Ot.Object(t,e),e.setAmbient(i.Ambient),e.setDiffuse(i.Diffuse),e.setEmission(i.Emission),e.setSpecular(i.Specular),e.setShininess(i.Shininess),Pt().resolve(e)):Lt("Material",i)},BlendFunc:function(t,e){var i=t.getJSON();return i.SourceRGB&&i.SourceAlpha&&i.DestinationRGB&&i.DestinationAlpha?(Ot.Object(t,e),e.setSourceRGB(i.SourceRGB),e.setSourceAlpha(i.SourceAlpha),e.setDestinationRGB(i.DestinationRGB),e.setDestinationAlpha(i.DestinationAlpha),Pt().resolve(e)):Lt("BlendFunc",i)},CullFace:function(t,e){var i=t.getJSON();return void 0===i.Mode?Lt("CullFace",i):(Ot.Object(t,e),e.setMode(i.Mode),Pt().resolve(e))},BlendColor:function(t,e){var i=t.getJSON();return i.ConstantColor?(Ot.Object(t,e),e.setConstantColor(i.ConstantColor),Pt().resolve(e)):Lt("BlendColor",i)},Light:function(t,e){var i=t.getJSON();return i.Ambient&&i.Diffuse&&i.Direction&&i.Position&&i.Specular&&void 0!==i.LightNum&&void 0!==i.SpotCutoff&&void 0!==i.LinearAttenuation&&void 0!==i.ConstantAttenuation&&void 0!==i.QuadraticAttenuation?(Ot.Object(t,e),e.setAmbient(i.Ambient),e.setConstantAttenuation(i.ConstantAttenuation),e.setDiffuse(i.Diffuse),e.setDirection(i.Direction),e.setLightNumber(i.LightNum),e.setLinearAttenuation(i.LinearAttenuation),e.setPosition(i.Position),e.setQuadraticAttenuation(i.QuadraticAttenuation),e.setSpecular(i.Specular),e.setSpotCutoff(i.SpotCutoff),e.setSpotBlend(.01),void 0!==i.SpotExponent&&e.setSpotBlend(i.SpotExponent/128),Pt().resolve(e)):Lt("Light",i)},Texture:function(t,e){var i=t.getJSON();Ot.Object(t,e),i.MinFilter&&e.setMinFilter(i.MinFilter),i.MagFilter&&e.setMagFilter(i.MagFilter),i.WrapT&&e.setWrapT(i.WrapT),i.WrapS&&e.setWrapS(i.WrapS);var r=i.File;return void 0===r&&(r="no-image-provided"),t.readImageURL(r).then((function(t){return e.setImage(t),e}))},Projection:function(t,e){var i=t.getJSON();if(!i.Matrix)return Lt("Projection",i);var r=Ot.Node(t,e);return e.setMatrix(i.Matrix),r},MatrixTransform:function(t,e){var i=t.getJSON();if(!i.Matrix)return Lt("MatrixTransform",i);var r=Ot.Node(t,e);return e.setMatrix(i.Matrix),r},LightSource:function(t,e){var i=t.getJSON();if(!i.Light)return Lt("LightSource",i);var r=Ot.Node(t,e);return Pt().all([t.setJSON(i.Light).readObject(),r]).then((function(t){var r=t[0];return e.setLight(r),"ABSOLUTE_RF"===i.ReferenceFrame&&e.setReferenceFrame(Zt.Z.ABSOLUTE_RF),e}))},functionSortAttributes:function(t,e){return-1!==t.indexOf("TexCoord")&&-1!==e.indexOf("TexCoord")?parseInt(t.substr(8),10)-parseInt(e.substr(8),10):t<e?-1:t>e?1:0},Geometry:function(t,e){var i=t.getJSON();if(!i.VertexAttributeList)return Lt("Geometry",i);i.PrimitiveSetList=i.PrimitiveSetList||[];var r=[];r.push(Ot.Node(t,e));var n=e.getPrimitives(),a=n.push.bind(n),s=0,o=i.PrimitiveSetList.length;for(s=0;s<o;s++){var h=t.setJSON(i.PrimitiveSetList[s]).readPrimitiveSet();r.push(h),h.then(a)}var u=c=i.VertexAttributeList,l=window.Object.keys(c);for(l.sort(Ot.functionSortAttributes),o=l.length,s=0;s<o;s++){var _=l[s],d=t.setJSON(c[_]).readBufferArray();r.push(d),d.then(u.bind(e,_))}return Pt().all(r).then(()},PagedLOD:function(t,e){var i,r=t.getJSON();Ot.Object(t,e),"USE_BOUNDING_SPHERE_CENTER"===r.CenterMode?e.setCenterMode(0):"UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED"===r.CenterMode&&e.setCenterMode(2),e.setCenter([r.UserCenter[0],r.UserCenter[1],r.UserCenter[2]]),e.setRadius(r.UserCenter[3]),"PIXEL_SIZE_ON_SCREEN"===r.RangeMode&&e.setRangeMode(1);for(var n=r.RangeList,a=0;a<window.Object.keys(n).length;a++){var s=n[i="Range "+a];e.setRange(a,s[0],s[1])}for(n=r.RangeDataList,a=0;a<window.Object.keys(n).length;a++)i="File "+a,e.setFileName(a,n[i]);e.setDatabasePath(t.getDatabasePath());var o=[];if(r.Children)for(var h=0,u=r.Children.length;h<u;h++)o.push(t.setJSON(r.Children[h]).readObject());return Pt().all(o).then((function(t){var i=t.length;for(a=0;a<i;a++)e.addChildNode(t[a]);return e}))}};const Ft=Ot;var Dt=i("6Szz"),Ut=a.Z.rejectObject,Bt={},kt=function(){},Vt=It.Z.registry();Vt.registerObject("osgAnimation.Vec3LerpChannel",kt),Vt.registerObject("osgAnimation.FloatLerpChannel",kt),Vt.registerObject("osgAnimation.QuatSlerpChannel",kt),Vt.registerObject("osgAnimation.QuatLerpChannel",kt),Vt.registerObject("osgAnimation.FloatCubicBezierChannel",kt),Vt.registerObject("osgAnimation.Vec3CubicBezierChannel",kt),Vt.registerObject("osgAnimation.StackedMatrixElement",ft),Vt.registerObject("osgAnimation.StackedScaleElement",Tt),Bt.Animation=function(t){var e=t.getJSON();if(void 0===e.Name||!e.Channels||0===e.Channels.length)return Ut("Animation",e);for(var i=[],r=0,n=e.Channels.length;r<n;r++){var a=t.setJSON(e.Channels[r]).readObject();i.push(a)}return Pt().all(i).then(()},Bt.StandardVec3Channel=function(t,e,i){var r=t.getJSON();if(!(void 0!==r.TargetName&&r.KeyFrames&&r.Name&&r.KeyFrames.Time&&r.KeyFrames.Key&&3===r.KeyFrames.Key.length))return Ut("StandardVec3Channel",r);var n=t.setJSON(r.KeyFrames.Time).readBufferArray(),a=t.setJSON(r.KeyFrames.Key[0]).readBufferArray(),s=t.setJSON(r.KeyFrames.Key[1]).readBufferArray(),o=t.setJSON(r.KeyFrames.Key[2]).readBufferArray();return Pt().all([n,a,s,o]).then((function(t){for(var n=t[0].getElements(),a=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),h=n.length,u=new Float32Array(new ArrayBuffer(4*(h+1)*3),0,3*h),c=new Float32Array(new ArrayBuffer(4*(h+1)),0,h),l=0;l<h;l++){var _=3*l;c[l]=n[l],u[_++]=a[l],u[_++]=s[l],u[_]=o[l]}return i(u,c,r.TargetName,r.Name,e),e}))},Bt.StandardQuatChannel=function(t,e,i){var r=t.getJSON();if(!(void 0!==r.TargetName&&r.KeyFrames&&r.Name&&r.KeyFrames.Time&&r.KeyFrames.Key&&4===r.KeyFrames.Key.length))return Ut("StandardQuatChannel",r);var n=t.setJSON(r.KeyFrames.Time).readBufferArray(),a=t.setJSON(r.KeyFrames.Key[0]).readBufferArray(),s=t.setJSON(r.KeyFrames.Key[1]).readBufferArray(),o=t.setJSON(r.KeyFrames.Key[2]).readBufferArray(),h=t.setJSON(r.KeyFrames.Key[3]).readBufferArray();return Pt().all([n,a,s,o,h]).then((function(t){for(var n=t[0].getElements(),a=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),h=t[4].getElements(),u=n.length,c=new Float32Array(new ArrayBuffer(4*(u+1)*4),0,4*u),l=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),_=0;_<u;_++){var d=4*_;l[_]=n[_],c[d++]=a[_],c[d++]=s[_],c[d++]=o[_],c[d]=h[_]}return i(c,l,r.TargetName,r.Name,e),e}))},Bt.StandardFloatChannel=function(t,e,i){var r=t.getJSON();if(!(void 0!==r.TargetName&&r.KeyFrames&&r.Name&&r.KeyFrames.Time&&r.KeyFrames.Key))return Ut("StandardFloatChannel",r);var n=t.setJSON(r.KeyFrames.Time).readBufferArray(),a=t.setJSON(r.KeyFrames.Key).readBufferArray();return Pt().all([n,a]).then((function(t){for(var n=t[0].getElements(),a=t[1].getElements(),s=n.length,o=new Float32Array(new ArrayBuffer(4*(s+1)),0,s),h=new Float32Array(new ArrayBuffer(4*(s+1)),0,s),u=0;u<s;u++)h[u]=n[u],o[u]=a[u];return i(o,h,r.TargetName,r.Name,e),e}))},Bt.Vec3LerpChannel=function(t,e){return Bt.StandardVec3Channel(t,e,T.createVec3Channel)},Bt.QuatLerpChannel=function(t,e){return Bt.StandardQuatChannel(t,e,T.createQuatChannel)},Bt.QuatSlerpChannel=function(t,e){return Bt.StandardQuatChannel(t,e,T.createQuatChannel)},Bt.FloatLerpChannel=Bt.FloatCubicBezierChannel=function(t,e){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn))return Ut("FloatCubicBezierChannel",i);var r,n=[],a=window.Object.keys(i.KeyFrames);for(r=0;r<a.length;r++)n.push(t.setJSON(i.KeyFrames[a[r]]).readBufferArray());return Pt().all(n).then((function(t){var n=t[0].getElements(),a=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),h=o.length,u=new Float32Array(new ArrayBuffer(4*(h+1)*3),0,3*h),c=new Float32Array(new ArrayBuffer(4*(h+1)),0,h);for(r=0;r<h;r++){var l=3*r;c[r]=o[r],u[l++]=s[r],u[l++]=n[r],u[l]=a[r]}return T.createFloatCubicBezierChannel(u,c,i.TargetName,i.Name,e),e}))},Bt.Vec3CubicBezierChannel=function(t,e){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn&&3===i.KeyFrames.Position.length&&3===i.KeyFrames.ControlPointIn.length&&3===i.KeyFrames.ControlPointOut.length))return Ut("Vec3CubicBezierChannel",i);var r,n=[],a=window.Object.keys(i.KeyFrames);for(r=0;r<a.length;r++){var s=a[r],o=i.KeyFrames[s];"Time"!==s?(n.push(t.setJSON(o[0]).readBufferArray()),n.push(t.setJSON(o[1]).readBufferArray()),n.push(t.setJSON(o[2]).readBufferArray())):n.push(t.setJSON(o).readBufferArray())}return Pt().all(n).then((function(t){var n=t[0].getElements(),a=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),h=t[4].getElements(),u=t[5].getElements(),c=t[6].getElements(),l=t[7].getElements(),_=t[8].getElements(),d=t[9].getElements(),f=d.length,p=new Float32Array(new ArrayBuffer(4*(f+1)*9),0,9*f),g=new Float32Array(new ArrayBuffer(4*(f+1)),0,f);for(r=0;r<f;r++){var m=9*r;g[r]=d[r],p[m++]=c[r],p[m++]=l[r],p[m++]=_[r],p[m++]=n[r],p[m++]=a[r],p[m++]=s[r],p[m++]=o[r],p[m++]=h[r],p[m]=u[r]}return T.createVec3CubicBezierChannel(p,g,i.TargetName,i.Name,e),e}))},Bt.BasicAnimationManager=function(t,e){var i=t.getJSON();if(!i.Animations)return Ut("BasicAnimationManager",i);Ft.Object(t,e);for(var r=[],n=0,a=i.Animations.length;n<a;n++){var s=t.setJSON(i.Animations[n]).readObject();s.isRejected()?L.Z.warn("An Animation failed on the parsing!"):r.push(s)}return Pt().all(r).then(()},Bt.UpdateMatrixTransform=function(t,e){var i=t.getJSON();if(!i.StackedTransforms)return Ut("UpdateMatrixTransform",i);Ft.Object(t,e);var r,n,a=[];for(r=0,n=i.StackedTransforms.length;r<n;r++){var s=t.setJSON(i.StackedTransforms[r]).readObject();s.isRejected()?L.Z.warn("A stacked transforms failed on the parsing!"):a.push(s)}return Pt().all(a).then((function(t){var i=e.getStackedTransforms();for(r=0,n=t.length;r<n;r++)i.push(t[r]);return e.computeChannels(),e}))},Bt.StackedTranslate=function(t,e){var i=t.getJSON();return i.Name&&i.Translate?(Ft.Object(t,e),e.init(i.Translate),Pt().resolve(e)):Ut("StackedTranslate",i)},Bt.StackedQuaternion=function(t,e){var i=t.getJSON();return i.Name&&i.Quaternion?(Ft.Object(t,e),e.init(i.Quaternion),Pt().resolve(e)):Ut("StackedQuaternion",i)},Bt.StackedRotateAxis=function(t,e){var i=t.getJSON();return i.Axis&&void 0!==i.Angle?(Ft.Object(t,e),e.init(i.Axis,i.Angle),Pt().resolve(e)):Ut("StackedRotateAxis",i)},Bt.StackedMatrix=function(t,e){var i=t.getJSON();return i.Name&&i.Matrix?(Ft.Object(t,e),e.init(i.Matrix),Pt().resolve(e)):Ut("StackedMatrix",i)},Bt.StackedScale=function(t,e){var i=t.getJSON();return i.Name&&i.Scale?(Ft.Object(t,e),e.init(i.Scale),Pt().resolve(e)):Ut("StackedScale",i)},Bt.Bone=function(t,e){var i=t.getJSON();if(!i.InvBindMatrixInSkeletonSpace)return Ut("Bone",i);var r=Ft.MatrixTransform(t,e);if(e.setInvBindMatrixInSkeletonSpace(i.InvBindMatrixInSkeletonSpace),i.BoundingBox){var n=e.getBoneBoundingBox();n.setMax(i.BoundingBox.max),n.setMin(i.BoundingBox.min)}return r},Bt.UpdateBone=Bt.UpdateMatrixTransform,Bt.UpdateSkeleton=function(t,e){return Ft.Object(t,e),Pt().resolve(e)},Bt.Skeleton=Ft.MatrixTransform,Bt.RigGeometry=function(t,e){var i=t.getJSON();if(!i.SourceGeometry)return Ut("RigGeometry",i);i.BoneMap||L.Z.warn("No boneMap found in a RigGeometry !");var r=Ft.Geometry(t,e);e._boneNameID=i.BoneMap;var n,a=i.SourceGeometry["osg.Geometry"];return a?(t.setJSON(a),e.setSourceGeometry(new Dt.Z),n=Ft.Geometry(t,e.getSourceGeometry())):(a=i.SourceGeometry["osgAnimation.MorphGeometry"])?(t.setJSON(a),e.setSourceGeometry(new J.Z),n=Bt.MorphGeometry(t,e.getSourceGeometry())):L.Z.warn("SourceGeometry type no recognized"),void 0===e._uniqueID&&(e._uniqueID=a.UniqueID),Pt().all([r,n]).then(()},Bt.MorphGeometry=function(t,e){var i=t.getJSON();if(!i.MorphTargets)return Ut("MorphGeometry",i);var r=i.MorphTargets,n=[];n.push(Ft.Geometry(t,e));for(var a=0,s=r.length;a<s;a++)n.push(t.setJSON(r[a]).readObject());return Pt().all(n).then((function(t){for(var e=t[0],i=e.getMorphTargets(),r=1,n=t.length;r<n;r++)i.push(t[r]);return e.mergeChildrenVertexAttributeList(),e}))},Bt.UpdateMorph=function(t,e){var i=t.getJSON();if(!i.TargetMap)return Ut("UpdateMorph",i);Ft.Object(t,e);for(var r=window.Object.keys(i.TargetMap),n=0,a=r.length;n<a;n++){var s=r[n];e.addTarget(i.TargetMap[s],parseInt(s,10))}return Pt().resolve(e)},Bt.StackedMatrixElement=Bt.StackedMatrix,Bt.StackedScaleElement=Bt.StackedScale;const Gt=Bt;var jt=i("t5D/"),Wt=i("Pev1"),Ht=i("rfV8"),zt=i("PNpA"),qt=i("5rJd"),Xt=i("f7MS"),Kt=i("IpZ9"),Yt=function(t){Wt.Z.call(this),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._matrixTransform=new Ht.Z,this.addChild(this._matrixTransform),this._text="",void 0!==t&&(this._text=t),this._font="monospace",this._color=s.vh.fromValues(0,0,0,1),this._fillStyle="rgba( 0, 0, 0, 1 )",this._context.textAlign="center",this._textX=void 0,this._context.baseLine="middle",this._textY=void 0,this._characterSize=1,this._characterSizeMode=Yt.OBJECT_COORDS,this._fontSize=32,this._geometry=void 0,this._autoRotateToScreen=!1,this._position=s.R3.create(),this._layout=Yt.LEFT_TO_RIGHT,this._alignment=Yt.CENTER_CENTER,this._forcePowerOfTwo=!1,this._texture=new qt.Z,this.drawText(),this._dirty=!1,this._previousModelView=s._E.create()};Yt.OBJECT_COORDS=0,Yt.SCREEN_COORDS=1,Yt.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT=2,Yt.LEFT_TO_RIGHT="ltr",Yt.RIGHT_TO_LEFT="rtl",Yt.LEFT_TOP=0,Yt.LEFT_CENTER=1,Yt.LEFT_BOTTOM=2,Yt.CENTER_TOP=3,Yt.CENTER_CENTER=4,Yt.CENTER_BOTTOM=5,Yt.RIGHT_TOP=6,Yt.RIGHT_CENTER=7,Yt.RIGHT_BOTTOM=8,a.Z.createPrototypeNode(Yt,a.Z.objectInherit(Wt.Z.prototype,{drawText:function(){if(void 0!==this._geometry&&(this._matrixTransform.removeChild(this._geometry),this._geometry.releaseGLObjects()),this._text){this.setTextProperties(),this._canvas.width=this._context.measureText(this._text).width,this._canvas.height=2*this._fontSize,this._forcePowerOfTwo&&(this._canvas.width=this._nextPowerOfTwo(this._canvas.width),this._canvas.height=this._nextPowerOfTwo(this._canvas.height)),this.setTextProperties(),this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.fillText(this._text,this._textX,this._textY);var t=this._canvas.width/this._canvas.height,e=this._characterSize*t;this._geometry=zt.Z.createTexturedQuadGeometry(-e/2,-this._characterSize/2,0,e,0,0,0,this._characterSize,0),this._texture.setTextureSize(this._canvas.width,this._canvas.height),this._texture.setMinFilter("LINEAR"),this._texture.setMagFilter("LINEAR"),this._texture.setImage(this._canvas);var i=this._geometry.getOrCreateStateSet();i.setTextureAttributeAndModes(0,this._texture),i.setRenderingHint("TRANSPARENT_BIN"),i.setAttributeAndModes(new Xt.Z(Xt.Z.ONE,Xt.Z.ONE_MINUS_SRC_ALPHA)),this._matrixTransform.addChild(this._geometry),this.dirtyBound()}},setText:function(t){this._text=t,this._dirty=!0},getText:function(){return this._text},setFont:function(t){this._font=t,this._dirty=!0},setColor:function(t){this._color=t,this._fillStyle="rgba("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+","+t[3]+")",this._context.fillStyle=this._fillStyle,this._context.fillText(this._text,this._textX,this._textY)},getColor:function(){return this._color},setCharacterSize:function(t){this._characterSize=t,this._characterSizeMode!==Yt.OBJECT_COORDS&&(s._E.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this._characterSizeMode===Yt.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)),this._dirty=!0},getCharacterSize:function(){return this._characterSize},setCharacterSizeMode:function(t){this._characterSizeMode=t,this._characterSizeMode!==Yt.OBJECT_COORDS?(s._E.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this.setAutoScaleToScreen(!0),this.setMaximumScale(Number.MAX_VALUE),this._characterSizeMode===Yt.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)):(this._matrixTransform.setMatrix(s._E.create()),this.setAutoScaleToScreen(!1)),this._dirty=!0},getCharacterSizeMode:function(){return this._characterSizeMode},setFontResolution:function(t){this._fontSize=t,this._dirty=!0},getFontResolution:function(){return this._fontSize},setPosition:function(t){this._position=t,s._E.fromTranslation(this.getMatrix(),t)},getPosition:function(){return this._position},setTextProperties:function(){this._context.fillStyle=this._fillStyle,this._setAlignmentValues(this._alignment),this._context.font=this._fontSize+"px "+this._font,this._context.direction=this._layout},setAutoRotateToScreen:function(t){Wt.Z.prototype.setAutoRotateToScreen.call(this,t),this._dirty=!0},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setLayout:function(t){this._layout="string"==typeof t?Yt[t]:t,this._dirty=!0},getLayout:function(){return this._layout},setAlignment:function(t){this._alignment="string"==typeof t?Yt[t]:t,this._dirty=!0},getAlignment:function(){return this._alignment},accept:function(t){if(this._dirty&&(this.drawText(),this._dirty=!1),t.getVisitorType()===q.Z.CULL_VISITOR){var e=t.getViewport().width(),i=t.getViewport().height(),r=t.getCurrentProjectionMatrix(),n=t.getCurrentModelViewMatrix(),a=this._position,o=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(s._E.exactEquals(n,this._previousModelView)?e!==this._previousWidth||i!==this._previousHeight?o=!0:s._E.exactEquals(r,this._previousProjection)&&s.R3.exactEquals(a,this._previousPosition)||(o=!0):o=!0),this._firstTimeToInitEyePoint=!1,o){if(this._autoScaleToScreen){var h=t.getViewport(),u=this.computePixelSizeVector(h,r,n),c=s.vh.fromValues(this._position[0],this._position[1],this._position[2],1),l=s.vh.dot(c,u),_=1/(l=.48/l);if(this._autoScaleTransitionWidthRatio>0){var d,f,p;if(this._minimumScale>0){var g=this._minimumScale,m=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);p=g+(f=1-2*(d=1/(4*(m-g)))*m)*f/(4*d),_<-f/(2*d)?_=this._minimumScale:_<m&&(_=p+f*_+d*(_*_))}if(this._maximumScale<Number.MAX_VALUE){var v=this._maximumScale,b=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);p=v+(f=1-2*(d=1/(4*(b-v)))*b)*f/(4*d),_>-f/(2*d)?_=this._maximumScale:_>b&&(_=p+f*_+d*(_*_))}}this.setScale(_)}if(this._autoRotateToScreen){var S=s.gf.create(),y=t.getCurrentModelViewMatrix();s._E.getRotation(S,y),this.setRotation(s.gf.invert(S,S))}this._previousWidth=e,this._previousHeight=i,s.R3.copy(this._previousPosition,a),s._E.copy(this._previousProjection,r),s._E.copy(this._previousModelView,n)}}Kt.Z.prototype.accept.call(this,t)},_setAlignmentValues:function(t){switch(t){case Yt.LEFT_TOP:this._context.textAlign="left",this._textX=0,this._context.textBaseline="top",this._textY=0;break;case Yt.LEFT_CENTER:this._context.textAlign="left",this._textX=0,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case Yt.LEFT_BOTTOM:this._context.textAlign="left",this._textX=0,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case Yt.CENTER_TOP:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="top",this._textY=0;break;case Yt.CENTER_CENTER:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case Yt.CENTER_BOTTOM:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case Yt.RIGHT_TOP:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="top",this._textY=0;break;case Yt.RIGHT_CENTER:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case Yt.RIGHT_BOTTOM:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="bottom",this._textY=this._canvas.height}},setForcePowerOfTwo:function(t){this._forcePowerOfTwo=t},getForcePowerOfTwo:function(){return this._forcePowerOfTwo},_nextPowerOfTwo:function(t){var e=t;return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}}),"osgText","Text"),jt.Z.registerApplyFunction(Yt.nodeTypeID,jt.Z.getApplyFunction(Wt.Z.nodeTypeID));const Qt=Yt;var Jt={Text:function(t,e){var i=t.getJSON();if(!i.Text)return Pt().reject();var r=Ft.Node(t,e);if(e.setColor(i.Color),e.setText(i.Text),e.setAutoRotateToScreen(i.AutoRotateToScreen),e.setPosition(i.Position),e.setCharacterSize(i.CharacterSize),"VERTICAL"===i.Layout)return L.Z.error("Vertical Alignment not supported"),Pt().reject();var n=i.Alignment;return i.Alignment.indexOf("BASE_LINE")>-1&&("LEFT_BASE_LINE"===i.Alignment?n=Qt.LEFT_CENTER:"CENTER_BASE_LINE"===i.Alignment?n=Qt.CENTER_CENTER:"RIGHT_BASE_LINE"===i.Alignment?n=Qt.RIGHT_CENTER:"LEFT_BOTTOM_BASE_LINE"===i.Alignment?n=Qt.LEFT_BOTTOM:"CENTER_BOTTOM_BASE_LINE"===i.Alignment?n=Qt.CENTER_BOTTOM:"RIGHT_BOTTOM_BASE_LINE"===i.Alignment&&(n=Qt.RIGHT_BOTTOM)),e.setAlignment(n),e.setLayout(i.Layout),r}};const $t=Jt;var te=i("sSQ9"),ee=i("dPdN"),ie=i("1Xhw"),re=i("pwEu"),ne={};ne.Input=Mt.Z,a.Z.objectMix(ne,It.Z),ne.DatabasePager=wt.Z,ne.ObjectWrapper.serializers.osg=Ft,ne.ObjectWrapper.serializers.osgAnimation=Gt,ne.ObjectWrapper.serializers.osgText=$t,ne.Registry=te.Z,ne.fileHelper=ee.Z,ne.requestFile=ie.Z,a.Z.objectMix(ne,re.Z);const ae=ne;var se=i("8SXq"),oe=i.n(se),he=i("bxht"),ue=function(t){t&&(this._boundStrategy=t.boundStrategy,this.setInputManager(t.inputManager)),void 0===this._boundStrategy&&(this._boundStrategy=ue.COMPUTE_HOME_USING_SPHERE),this._controllerList={},this._inverseMatrix=s._E.create(),this._camera=void 0,this._node=void 0,this._frustum={},this._computeBoundNodeMaskOverride=-1,this._tmpSphere=new he.Z};ue.prototype={setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setNode:function(t){this._node=t},setComputeBoundNodeMaskOverride:function(t){this._computeBoundNodeMaskOverride=t},getComputeBoundNodeMaskOverride:function(){return this._computeBoundNodeMaskOverride},setInputManager:function(t){this._inputManager=t},getInputManager:function(){return this._inputManager},getHomeBoundingSphere:function(t){var e=this._node;if(e){var r=void 0!==t?t:this._boundStrategy;if(r&ue.COMPUTE_HOME_USING_BBOX){var n;if(-1===this._computeBoundNodeMaskOverride)n=e.getBoundingBox();else{var a=new(0,i("t+pa").Z);a.setNodeMaskOverride(this._computeBoundNodeMaskOverride),a.reset(),a.apply(e),n=a.getBoundingBox()}if(!n.valid())return e.getBoundingSphere();if(r&ue.COMPUTE_HOME_USING_SPHERE){var s=e.getBoundingSphere();if(s.valid()&&s.volume()<n.volume())return s}return this._tmpSphere.copyBoundingBox(n),this._tmpSphere}return e.getBoundingSphere()}},getHomeBound:getHomeDistance:function(t){var e=this._frustum,i=t.radius();if(this._camera&&s._E.getFrustum(e,this._camera.getProjectionMatrix())){var r=Math.abs(e.right-e.left)/e.zNear/2,n=Math.abs(e.top-e.bottom)/e.zNear/2;i/=Math.sin(Math.atan2(n<r?n:r,1))}else i*=1.5;return i},update:getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},ue.COMPUTE_HOME_USING_SPHERE=1,ue.COMPUTE_HOME_USING_BBOX=2;const ce=ue;var le=i("CtxI"),_e=i("XDCw"),de=i("e0P+"),fe=i("itLJ"),pe=i("K/iW"),ge=i("vXZK"),me=function(){ge.Z.Intersection.call(this),this._intersectionPoints=[],this._distance=0,this._maxDistance=0,this._numIntersectionPoints=0},ve=function(){ge.Z.call(this),this._src=[],this._dest=[],this._maxNumIntersectionsPoints=6};a.Z.createPrototypeObject(ve,a.Z.objectInherit(ge.Z.prototype,{reset:function(){ge.Z.prototype.reset.call(this),this._src=[],this._dest=[]},enter:function(t){return!!this._intersector.getPolytope().containsBoundingBox(t)&&(this._intersector.getPolytope().pushCurrentMask(),!0)},leave:addIntersection:function(){this._src=a.Z.arrayUniq(this._src);for(var t=this._src,e=s.R3.create(),i=-Number.MAX_VALUE,r=this._intersector._iReferencePlane,n=0;n<t.length;++n){s.R3.add(e,e,t[n]);var o=fe.Z.distanceToPlane(r,t[n]);o>i&&(i=o)}s.R3.scale(e,e,1/t.length);var h=this.initIntersection(new me);h._distance=fe.Z.distanceToPlane(r,e),h._maxDistance=i,s.R3.copy(h._localIntersectionPoint,e);var u=this._maxNumIntersectionsPoints;for(h._numIntersectionPoints=t.length<u?t.length:u,n=0;n<h._numIntersectionPoints;++n)h._intersectionPoints.push(s.R3.clone(this._src[n]))},contains:function(){var t=this._intersector.getPolytope(),e=t.getPlanes(),i=t.getCurrentMask();if(!i)return!0;for(var r=1,n=0;n<e.length;++n)if(i&0===r)r<<=1;else{this._dest=[];for(var a=e[n],o=this._src[0],h=fe.Z.distanceToPlane(a,o),u=1;u<this._src.length;++u){var c=this._src[u],l=fe.Z.distanceToPlane(a,c);if(h>=0&&this._dest.push(s.R3.clone(o)),h*l<0){var _=h/(h-l),d=s.R3.add(s.R3.create(),s.R3.scale(s.R3.create(),o,1-_),s.R3.scale(s.R3.create(),c,_));this._dest.push(d)}h=l,o=c}if(h>=0&&this._dest.push(s.R3.clone(o)),this._dest.length<=1)return!1;var f=this._src.slice();this._src=this._dest.slice(),this._dest=f}return!0},containsPoint:function(t){return!!this._intersector.getPolytope().containsVertex(t)&&(this._src=[],this._src[0]=t,!0)},containsLine:function(t,e){return this._src=[],this._src[0]=t,this._src[1]=e,this._src[2]=t,this.contains()},containsTriangle:function(t,e,i){return this._src=[],this._src[0]=t,this._src[1]=e,this._src[2]=i,this._src[3]=t,this.contains()},intersectPoint:intersectLine:intersectTriangle:),"osgUtil","PolytopeIntersectFunctor");const be=ve;var Se,ye=function(){pe.Z.call(this),this._index=0,this._polytope=new de.Z,this._iPolytope=new de.Z,this._referencePlane=s.vh.create(),this._iReferencePlane=s.vh.create()},Te=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3];t[0]=i[0]*r+i[1]*n+i[2]*a+i[3]*s,t[1]=i[4]*r+i[5]*n+i[6]*a+i[7]*s,t[2]=i[8]*r+i[9]*n+i[10]*a+i[11]*s,t[3]=i[12]*r+i[13]*n+i[14]*a+i[15]*s};a.Z.createPrototypeObject(ye,a.Z.objectInherit(pe.Z.prototype,{setPolytope:function(t){this._polytope.setPlanes(t);for(var e=[],i=0;i<t.length;++i){var r=t[i];e[i]=s.vh.copy(this._iPolytope.getPlanes()[i]||fe.Z.create(),r)}this._iPolytope.setPlanes(e),s.vh.copy(this._referencePlane,t[t.length-1]),s.vh.copy(this._iReferencePlane,this._referencePlane)},getPolytope:function(){return this._iPolytope},setPolytopeFromWindowCoordinates:function(t,e,i,r){this.setPolytope([s.vh.fromValues(1,0,0,-t),s.vh.fromValues(-1,0,0,i),s.vh.fromValues(0,1,0,-e),s.vh.fromValues(0,-1,0,r),s.vh.fromValues(0,0,1,0)])},intersectBoundingBox:function(t){return this._iPolytope.containsBoundingBox(t)},intersectBoundingSphere:intersect:(Se=new be,function(t,e){Se.setGeometry(e),Se.setIntersectionVisitor(t),Se.setIntersector(this);var i=e.getShape();i?i.intersect(Se,i.getNodes()[0]):(e.computeTransformedVertices&&Se.setVertices(e.computeTransformedVertices()),Se.apply(e)),Se.reset()}),setCurrentTransformation:function(t){for(var e=this._polytope.getPlanes(),i=this._iPolytope.getPlanes(),r=0,n=e.length;r<n;r++){var a=i[r]=i[r]||s.vh.create();Te(a,e[r],t),s.vh.scale(a,a,1/s.R3.len(a))}Te(this._iReferencePlane,this._referencePlane,t),s.vh.scale(this._iReferencePlane,this._iReferencePlane,1/s.R3.len(this._iReferencePlane))}}),"osgUtil","PolytopeIntersector");const xe=ye;var Ee=i("haRL"),Re=function(t){this._manipulator=t,this._enable=!0};Re.prototype={isEnabled:function(){return this._enable},setEnable:function(t){this._enable=t}};const Ae=Re;var Ce=i("LElp");const Me=0,Ie=1,we=2;var Ne=i("Lz+S"),Pe=function(t){Ae.call(this,t),this._zoomFactor=1,this.init()};a.Z.createPrototypeObject(Pe,a.Z.objectInherit(Ae.prototype,{init:function(){this._mode=void 0,this._inMotion=!1,this._initInputs(Ne.Z.ORBIT_MANIPULATOR_MOUSEKEYBOARD,Ne.Z.ORBIT_MANIPULATOR_RESETTOHOME)},_initInputs:function(t,e){var i=this._manipulator.getInputManager(),r=this.setMode.bind(this,Me,this._manipulator.getRotateInterpolator()),n=this.setMode.bind(this,Ie,this._manipulator.getPanInterpolator()),a=this.setMode.bind(this,we,this._manipulator.getZoomInterpolator());i.group(t).addMappings({move:"mousemove",startPan:["mousedown shift 0","mousedown 1","mousedown 2"],startZoom:["mousedown ctrl 0","mousedown ctrl 2"],startRotate:"mousedown 0 !shift !ctrl",stopMotion:["mouseup","mouseout","keyup a","keyup s","keyup d"],zoom:"wheel"},this),i.group(e).addMappings({reset:"keydown space"},this),i.group(t).addMappings({setRotationMode:"keydown a"},r),i.group(t).addMappings({setPanMode:"keydown d"},n),i.group(t).addMappings({setZoomMode:"keydown s"},a)},getMode:function(){return this._mode},setMode:function(t,e){this.getMode()!==t&&(this._mode=t,e.reset(),this._inMotion=!0)},setManipulator:function(t){this._manipulator=t},getZoomFactor:function(){return this._zoomFactor},setZoomFactor:function(t){this._zoomFactor=t},move:function(t){if(!1!==this._inMotion){var e=t.canvasX,i=-t.canvasY,r=this._manipulator;if(!1===Ce.Z.isNaN(e)&&!1===Ce.Z.isNaN(i)){var n=this.getMode();if(n===Me)r.getRotateInterpolator().setTarget(e,i);else if(n===Ie)r.getPanInterpolator().setTarget(e,i);else if(n===we){var a=r.getZoomInterpolator();a.isReset()&&(a.setStart(i),a.set(0));var s=i-a.getStart();a.setStart(i);var o=a.getTarget()[0];a.setTarget(o-s/20)}}}},startPan:function(t){var e=this._manipulator.getPanInterpolator();this.setMode(Ie,e),e.reset(),e.set(t.canvasX,-t.canvasY)},startRotate:function(t){var e=this._manipulator.getRotateInterpolator();this.setMode(Me,e),e.reset(),e.set(t.canvasX,-t.canvasY)},startZoom:function(t){var e=this._manipulator.getZoomInterpolator();this.setMode(we,e),e.setStart(-t.canvasY),e.set(0)},stopMotion:zoom:function(t){var e=t.deltaY/this._zoomFactor,i=this._manipulator,r=i.getZoomInterpolator().getTarget()[0]-e;i.getZoomInterpolator().setTarget(r)},reset:function(){this._manipulator.computeHomePosition()}}));const Ze=Pe;var Le=function(t){Ze.call(this,t),this._timer=!1};a.Z.createPrototypeObject(Le,a.Z.objectInherit(Ze.prototype,{_initInputs:function(){Ze.prototype._initInputs.call(this,Ne.Z.CAD_MANIPULATOR_MOUSEKEYBOARD,Ne.Z.CAD_MANIPULATOR_RESETTOHOME),this._manipulator.getInputManager().group(Ne.Z.CAD_MANIPULATOR_MOUSEKEYBOARD).addMappings({savePosition:"mousemove"},this)},zoom:function(t){var e=-t.deltaY/this._zoomFactor,i=this._manipulator,r=i.getZoomInterpolator().getTarget()[0]-e;if(i.getZoomInterpolator().setTarget(r),!1===this._timer){this._timer=!0;var n=this;this._timerRef&&clearTimeout(this._timerRef),this._timerRef=setTimeout((,200),i.computeIntersections(t.glX,t.glY)}},savePosition:setMode:function(t,e,i){this._inMotion||this._manipulator.computeIntersections(this._lastX,this._lastY),Ze.prototype.setMode.call(this,t,e,i)},center:function(t){var e=this._manipulator;e.getZoomInterpolator().set(0);var i=e.getZoomInterpolator().getTarget()[0]-10;e.getZoomInterpolator().setTarget(i),e.computeIntersections(t.glX,t.glY)}}));const Oe=Le;var Fe=function(t){Ae.call(this,t),this.init()};a.Z.createPrototypeObject(Fe,a.Z.objectInherit(Ae.prototype,{init:function(){this._panFactor=[],this._panFactor[0]=1,this._panFactor[1]=-this._panFactor[0],this._rotateFactor=[],this._rotateFactor[0]=.6,this._rotateFactor[1]=-this._rotateFactor[0],this._zoomFactor=5,this._lastScale=0,this._zooming=!1,this._dragStarted=!1,this._initInputs(Ne.Z.ORBIT_MANIPULATOR_TOUCH)},_initInputs:function(t){this._manipulator.getInputManager().group(t).addMappings({pinchEnd:"pinchend",pinchStart:"pinchstart",pinchInOut:["pinchin","pinchout"],startPan:["panstart 2"],startRotate:["panstart 1"],pan:["panmove 2"],rotate:["panmove 1"],endMotion:["touchend 2","touchcancel 2","touchend 1","touchcancel 1"]},this)},startPan:function(t){this._panning=!0,this.startMotion(this._manipulator.getPanInterpolator(),this._panFactor,t)},startRotate:function(t){this._rotating=!0,this.startMotion(this._manipulator.getRotateInterpolator(),this._rotateFactor,t)},pan:function(t){this._panning||(this.endMotion(),this.startPan(t)),this.move(this._manipulator.getPanInterpolator(),this._panFactor,t)},rotate:function(t){this._rotating||(this.endMotion(),this.startPan(t)),this.move(this._manipulator.getRotateInterpolator(),this._rotateFactor,t)},startMotion:function(t,e,i){if(!this._zooming){t.reset();var r=i.canvasX*e[0],n=i.canvasY*e[1];t.set(r,n)}},move:function(t,e,i){var r=i.canvasX*e[0],n=i.canvasY*e[1];t.setTarget(r,n)},endMotion:function(){(this._panning||this._rotating)&&(this._panning=!1,this._rotating=!1)},pinchStart:function(t){this._zooming=!0,this._lastScale=t.scale;var e=this._manipulator.getZoomInterpolator();e.reset(),e.set(this._lastScale)},pinchEnd:function(){this._zooming=!1},pinchInOut:function(t){if(this._zooming){var e=t.scale>this._lastScale?this._zoomFactor:3*this._zoomFactor,i=.5-Math.abs(t.velocity);e*=Ce.Z.smoothStep(0,.5,i);var r=(t.scale-this._lastScale)*e;this._lastScale=t.scale;var n=this._manipulator.getZoomInterpolator();n.setTarget(n.getTarget()[0]-r)}},setManipulator:function(t){this._manipulator=t}}));const De=Fe;var Ue=function(t){De.call(this,t),this._timer=!1};a.Z.createPrototypeObject(Ue,a.Z.objectInherit(De.prototype,{_initInputs:function(){De.prototype._initInputs.call(this,Ne.Z.CAD_MANIPULATOR_TOUCH)},startMotion:function(t,e,i){De.prototype.startMotion.call(this,t,e,i),this._manipulator.computeIntersections(i.glX,i.glY)}}));const Be=Ue;var ke=function(t,e){this._current=new Float32Array(t),this._target=new Float32Array(t),this._delta=new Float32Array(t),this._delay=void 0!==e?e:.15,this._reset=!1,this._start=0,this.reset()};ke.prototype={setDelay:function(t){this._delay=t},reset:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(t){for(var e=Math.min(1,this._delay*t*60),i=0,r=this._current.length;i<r;i++){var n=(this._target[i]-this._current[i])*e;this._delta[i]=n,this._current[i]+=n}return this._delta},set:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta},getStart:function(){return this._start},setStart:function(t){this._start=t}};const Ve=ke;var Ge,je,We,He,ze,qe,Xe,Ke,Ye,Qe,Je,$e,ti,ei,ii,ri,ni,ai,si,oi,hi,ui,ci,li,_i,di=i("E9Rp"),fi=function(t){ce.call(this,t),this._tmpHomePosition=s.R3.create(),this._intersectionVisitor=new le.Z,this._lineSegmentIntersector=new _e.Z,this._polytopeIntersector=void 0,this._usePolytopeIntersector=!1,this._primitiveMask=di.Z.ALL_PRIMITIVES,this.init()};(fi.Interpolator=function(){this._current=s.K4.create(),this._target=s.K4.create(),this._delta=s.K4.create(),this._reset=!1,this.reset(),this._width=void 0,this._height=void 0}).prototype={setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},reset:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(){var t,e;return t=void 0===this._width?0:(this._target[0]-this._current[0])/this._width,this._delta[0]=t,this._current[0]=this._target[0],e=void 0===this._height?0:(this._target[1]-this._current[1])/this._height,this._delta[1]=e,this._current[1]=this._target[1],this._delta},set:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},fi.AvailableControllerList=["StandardMouseKeyboard","Hammer"],fi.ControllerList=["StandardMouseKeyboard","Hammer"],a.Z.createPrototypeObject(fi,a.Z.objectInherit(ce.prototype,{init:function(){this._distance=25,this._target=s.R3.create(),this._upz=s.R3.fromValues(0,0,1),this._right=s.R3.fromValues(1,0,0),s.R3.init(this._target);var t=s._E.fromRotation(s._E.create(),-Math.PI,this._upz),e=s._E.fromRotation(s._E.create(),Math.PI/10,this._right);this._rotation=s._E.create(),s._E.mul(this._rotation,t,e),this._time=0,this._rotate=new fi.Interpolator,this._pan=new fi.Interpolator,this._zoom=new Ve(1),this._panFactor=1.5,this._rotateFactor=1,this._zoomFactor=1,this._inverseMatrix=s._E.create(),this._homeEye=void 0,this._homeCenter=void 0,this._homeUp=s.R3.fromValues(0,0,1),this._orientation=s.gf.create(),this._pivotPoint=s.R3.create(),this._eye=void 0,this._zoomDir=s.R3.create();var i=this;fi.ControllerList.forEach((function(t){void 0!==fi[t]&&(i._controllerList[t]?i._controllerList[t].init():i._controllerList[t]=new fi[t](i))}))},setViewer:function(t){this._viewer=t},reset:function(){this.init()},setEnable:function(t){this.getInputManager().setEnable(Ne.Z.CAD_MANIPULATOR,t)},setNode:function(t){this._node=t},setPivotPoint:setTarget:(_i=s.R3.create(),function(t){s.R3.copy(this._target,t),this.getEyePosition(_i),this._distance=s.R3.distance(t,_i)}),setEyePosition:function(t){s.R3.copy(this._eye,t),this._distance=s.R3.distance(this._target,t)},setHomePosition:computeHomePosition:(hi=s.R3.create(),ui=s.R3.create(),ci=s.R3.create(),li=s._E.create(),function(t){var e=this.getHomeBoundingSphere(t);if(e){this.setDistance(this.getHomeDistance(e)),this.setTarget(e.center()),this.setPivotPoint(e.center()),void 0===this._homeEye&&(this._homeEye=s.R3.create(),this.getEyePosition(this._homeEye)),void 0===this._homeCenter&&(this._homeCenter=s.R3.create(),s.R3.copy(this._homeCenter,e.center())),void 0===this._eye&&(this._eye=s.R3.create()),s.R3.copy(this._eye,this._homeEye),s.R3.copy(this._target,this._homeCenter),s.R3.copy(this._upz,this._homeUp),s._E.copy(li,this._rotation);var i=this._target,r=this._eye;s.R3.sub(hi,i,r),s.R3.normalize(hi,hi),s.R3.cross(ui,hi,this._upz),s.R3.normalize(ui,ui),s.R3.cross(ci,ui,hi),s.R3.normalize(ci,ci),li[0]=ui[0],li[1]=ci[0],li[2]=-hi[0],li[3]=0,li[4]=ui[1],li[5]=ci[1],li[6]=-hi[1],li[7]=0,li[8]=ui[2],li[9]=ci[2],li[10]=-hi[2],li[11]=0,li[12]=0,li[13]=0,li[14]=0,li[15]=1,s._E.getRotation(this._orientation,li),s.gf.invert(this._orientation,this._orientation)}}),setZoomFactor:function(t){this._zoomFactor=t},setRotateFactor:function(t){this._rotateFactor=t},setPanFactor:function(t){this._panFactor=t},setDistance:function(t){this._distance=t},setUsePolytopeIntersector:function(t){this._usePolytopeIntersector=t},getUsePolytopeIntersector:function(){return this._usePolytopeIntersector},getDistance:function(){return this._distance},zoom:function(t){this._distance=t},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getIntersectionVisitor:function(){return this._intersectionVisitor},getLineSegmentIntersector:function(){return this._lineSegmentIntersector},getOrCreatePolytopeIntersector:function(){return void 0===this._polytopeIntersector&&(this._polytopeIntersector=new xe,this._polytopeIntersector.setIntersectionLimit(di.Z.LIMIT_ONE_PER_DRAWABLE),this._polytopeIntersector.setPrimitiveMask(di.Z.POINT_PRIMITIVES|di.Z.LINE_PRIMITIVES)),this._polytopeIntersector},getTarget:function(t){return s.R3.copy(t,this._target),t},getEyePosition:function(t){void 0===this._eye?this.computeEyePosition(this._target,this._distance,t):s.R3.copy(t,this._eye)},computeEyePosition:(si=s.R3.create(),oi=s._E.create(),function(t,e,i){s._E.invert(oi,this._rotation),si[1]=e,s.R3.transformMat4(i,si,oi),s.R3.add(i,t,i)}),computePan:(ri=s.R3.create(),ni=s.R3.create(),ai=s.R3.create(),function(t,e,i){var r=s.R3.length(s.R3.sub(ai,this._eye,this._pivotPoint))/this._panFactor;r<10&&(r=10),ri[0]=t*r/2,ri[1]=e*r/2,ri[2]=0,s.R3.transformMat4(ni,ri,i),s.R3.add(this._eye,this._eye,ni)}),computeZoom:(ei=s.R3.create(),ii=s.R3.create(),function(t){var e=t*this._zoomFactor;s.R3.sub(ei,this._pivotPoint,this._eye),s.R3.add(this._eye,this._eye,s.R3.scale(ii,ei,e))}),computeRotation:(ze=s.R3.create(),qe=s.R3.create(),Xe=s.R3.create(),Ke=s.R3.create(),Ye=s.gf.create(),Qe=s.gf.create(),Je=s.gf.create(),$e=s.R3.create(),ti=s.R3.create(),function(t,e){s.R3.transformQuat(qe,this._right,this._orientation),s.R3.normalize(ze,qe),s.R3.sub(Xe,this._eye,this._pivotPoint);var i=s.R3.dot(ze,Xe);s.R3.sub(Ke,Xe,s.R3.scale(ti,ze,i));var r=s.R3.fromValues(-Ke[0],-Ke[1],0),n=Math.atan2(-Ke[2],s.R3.length(r));e=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,n+e))-n,s.gf.setAxisAngle(Ye,qe,e*this._rotateFactor),s.gf.setAxisAngle(Qe,this._upz,t*this._rotateFactor),s.gf.mul(Je,Qe,Ye),s.R3.transformQuat($e,Xe,Je),s.R3.add(this._eye,$e,this._pivotPoint),s.gf.mul(this._orientation,Qe,this._orientation),s.R3.transformQuat(qe,this._right,this._orientation),s.gf.setAxisAngle(Ye,qe,e*this._rotateFactor),s.gf.mul(this._orientation,Ye,this._orientation)}),update:(We=s._E.create(),He=s._E.create(),function(t){var e=t.getFrameStamp().getDeltaTime(),i=this._rotate.update();this.computeRotation(10*-i[0],10*i[1]),s._E.fromQuat(We,this._orientation);var r=this._pan.update();this.computePan(10*-r[0],10*-r[1],We),i=this._zoom.update(e),this.computeZoom(-i[0]/10),s._E.fromTranslation(He,this._eye),s._E.mul(this._inverseMatrix,He,We),s._E.invert(this._inverseMatrix,this._inverseMatrix)}),getInverseMatrix:function(){return this._inverseMatrix},computeIntersections:(Ge=[],je=s.R3.create(),function(t,e){var i,r,n=this._camera.getView(),a=this._camera,o=a.getViewport().width(),h=a.getViewport().height();if(this._rotate.setWidth(o),this._rotate.setHeight(h),this._pan.setWidth(o),this._pan.setHeight(h),0!=(this._primitiveMask&di.Z.TRIANGLE_PRIMITIVES)&&(Ge=n.computeIntersections(t,e)).length>0&&(i=Ge[0]._localIntersectionPoint,Ge[0]._nodePath.shift(),r=Ee.Z.computeLocalToWorld(Ge[0]._nodePath),s.R3.transformMat4(je,i,r),this.setPivotPoint(je)),0===Ge.length&&this._usePolytopeIntersector){var u=this.getOrCreatePolytopeIntersector();u.reset(),u.setPolytopeFromWindowCoordinates(t-5,e-5,t+5,e+5);var c=this._intersectionVisitor;c.setIntersector(u),n.getCamera().accept(c),(Ge=u.getIntersections()).sort((),Ge.length>0&&(i=Ge[0]._localIntersectionPoint,Ge[0]._nodePath.shift(),r=Ee.Z.computeLocalToWorld(Ge[0]._nodePath),s.R3.transformMat4(je,i,r),this.setPivotPoint(je))}}),getPositionRelativeToCanvas:function(){var t=s.K4.create(),e=s.K4.create();return function(i,r){var n=this._camera._graphicContext.canvas;this.getOffsetRect(n,t);var a=n.width/n.clientWidth,s=n.height/n.clientHeight;return e[0]=(i-t[1])*a,e[1]=(n.clientHeight-(r-t[0]))*s,e}}(),getCanvasCenter:function(){var t=s.K4.create(),e=s.K4.create();return function(){var i=this._camera.getGraphicContext().canvas;this.getOffsetRect(i,t);var r=i.width/i.clientWidth,n=i.height/i.clientHeight;return e[0]=i.clientWidth/2*r,e[1]=i.clientHeight/2*n,e}}(),getOffsetRect:function(t,e){var i=t.getBoundingClientRect(),r=document.body,n=document.documentElement,a=window.pageYOffset||n.scrollTop||r.scrollTop,s=window.pageXOffset||n.scrollLeft||r.scrollLeft,o=n.clientTop||r.clientTop||0,h=n.clientLeft||r.clientLeft||0,u=i.top+a-o,c=i.left+s-h;return e[0]=Math.round(u),e[1]=Math.round(c),e}}),"osgGA","CADManipulator"),fi.StandardMouseKeyboard=Oe,fi.Hammer=Be;const pi=fi;var gi,mi,vi=Math.PI/180,bi=function(t){Ae.call(this,t),this.init()};bi.computeQuaternion=(gi=s.gf.create(),mi=s.gf.fromValues(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(t,e,i){var r=e.alpha*vi,n=e.beta*vi,a=e.gamma*vi,o=i*vi;!function(t,e,i,r,n){var a=Math.cos(e/2),s=Math.cos(i/2),o=Math.cos(r/2),h=Math.sin(e/2),u=Math.sin(i/2),c=Math.sin(r/2);"XYZ"===n?(t[0]=h*s*o+a*u*c,t[1]=a*u*o-h*s*c,t[2]=a*s*c+h*u*o,t[3]=a*s*o-h*u*c):"YXZ"===n?(t[0]=h*s*o+a*u*c,t[1]=a*u*o-h*s*c,t[2]=a*s*c-h*u*o,t[3]=a*s*o+h*u*c):"ZXY"===n?(t[0]=h*s*o-a*u*c,t[1]=a*u*o+h*s*c,t[2]=a*s*c+h*u*o,t[3]=a*s*o-h*u*c):"ZYX"===n?(t[0]=h*s*o-a*u*c,t[1]=a*u*o+h*s*c,t[2]=a*s*c-h*u*o,t[3]=a*s*o+h*u*c):"YZX"===n?(t[0]=h*s*o+a*u*c,t[1]=a*u*o+h*s*c,t[2]=a*s*c-h*u*o,t[3]=a*s*o-h*u*c):"XZY"===n&&(t[0]=h*s*o-a*u*c,t[1]=a*u*o-h*s*c,t[2]=a*s*c+h*u*o,t[3]=a*s*o+h*u*c)}(t,n,r,-a,"YXZ");var h=-o/2;gi[1]=Math.sin(h),gi[3]=Math.cos(h),s.gf.mul(t,t,gi),s.gf.mul(t,t,mi);var u=t[1];return t[1]=-t[2],t[2]=u,t}),a.Z.createPrototypeObject(bi,a.Z.objectInherit(Ae.prototype,{init:function(){this._quat=s.gf.create(),this._pos=s.R3.create(),this._deviceOrientation=void 0,this._screenOrientation=void 0;var t=this._manipulator.getInputManager();t.group(Ne.Z.FPS_MANIPULATOR_DEVICEORIENTATION).addMappings({setDeviceOrientation:"deviceorientation",setScreenOrientation:"orientationchange"},this),t.setEnable(Ne.Z.FPS_MANIPULATOR_DEVICEORIENTATION,!1)},setDeviceOrientation:function(t){this._deviceOrientation||(this._deviceOrientation={}),this._deviceOrientation.alpha=t.alpha,this._deviceOrientation.beta=t.beta,this._deviceOrientation.gamma=t.gamma,t.screenOrientation?this.setScreenOrientation(t):this._update()},setScreenOrientation:function(t){this._screenOrientation=t.screenOrientation,this._update()},_update:function(){this._deviceOrientation&&this._screenOrientation&&(bi.computeQuaternion(this._quat,this._deviceOrientation,this._screenOrientation),this._manipulator.setPoseVR(this._quat,this._pos))}}));const Si=bi;var yi=function(t){De.call(this,t),this._timer=!1};a.Z.createPrototypeObject(yi,a.Z.objectInherit(De.prototype,{_initInputs:function(){De.prototype._initInputs.call(this,Ne.Z.FPS_MANIPULATOR_TOUCH)}}));const Ti=yi;s.gf.create(),s.R3.create();var xi=function(t){Ae.call(this,t),this.init()};a.Z.createPrototypeObject(xi,a.Z.objectInherit(Ae.prototype,{init:function(){this._pos=s.R3.create(),this._quat=s.gf.create();var t=this._manipulator.getInputManager();t.group(Ne.Z.FPS_MANIPULATOR_WEBVR).addMappings({update:"vrdisplayposechanged"},this),t.setEnable(Ne.Z.FPS_MANIPULATOR_WEBVR,!1)},update:function(t){var e=t.pose.transform.orientation;e&&(this._quat[0]=e.x,this._quat[1]=-e.z,this._quat[2]=e.y,this._quat[3]=e.w);var i=t.pose.transform.position;i&&(this._pos[0]=i.x*t.worldFactor,this._pos[1]=-i.z*t.worldFactor,this._pos[2]=i.y*t.worldFactor),this._manipulator.setPoseVR(this._quat,this._pos)}}));const Ei=xi;var Ri=function(t){Ae.call(this,t),this.init()};a.Z.createPrototypeObject(Ri,a.Z.objectInherit(Ae.prototype,{init:function(){this._delay=.15,this._stepFactor=1,this._looking=!1;var t=this._manipulator.getInputManager();t.group(Ne.Z.FPS_MANIPULATOR_MOUSEKEYBOARD).addMappings({startLookAt:"mousedown",lookAt:"mousemove",stopLookAt:["mouseup","mouseout"],goForward:["keydown w","keydown z","keydown ArrowUp"],goBackward:["keydown s","keydown ArrowDown"],goLeft:["keydown a","keydown q","keydown ArrowLeft"],goRight:["keydown d","keydown ArrowRight"],stopMoving:["keyup w","keyup z","keyup ArrowUp","keyup s","keyup ArrowDown"],stopStrafing:["keyup a","keyup q","keyup ArrowLeft","keyup d","keyup ArrowRight"],changeStepFactor:"wheel"},this),t.group(Ne.Z.FPS_MANIPULATOR_RESETTOHOME).addMappings({reset:"keydown space"},this)},setEnable:function(t){t||(this._buttonup=!0),Ae.prototype.setEnable.call(this,t)},setManipulator:stopLookAt:startLookAt:function(t){this._manipulator.getLookPositionInterpolator().set(t.canvasX,-t.canvasY),this._looking=!0},lookAt:function(t){this._looking&&(this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(t.canvasX,-t.canvasY))},changeStepFactor:function(t){this._stepFactor=Math.min(Math.max(.001,this._stepFactor+.01*t.deltaY),4),this._manipulator.setStepFactor(this._stepFactor)},reset:goForward:function(){this._manipulator.getForwardInterpolator().setDelay(this._delay),this._manipulator.getForwardInterpolator().setTarget(1)},goBackward:function(){this._manipulator.getForwardInterpolator().setDelay(this._delay),this._manipulator.getForwardInterpolator().setTarget(-1)},goLeft:function(){this._manipulator.getSideInterpolator().setDelay(this._delay),this._manipulator.getSideInterpolator().setTarget(-1)},goRight:function(){this._manipulator.getSideInterpolator().setDelay(this._delay),this._manipulator.getSideInterpolator().setTarget(1)},stopMoving:function(){this._manipulator.getForwardInterpolator().setDelay(this._delay),this._manipulator.getForwardInterpolator().setTarget(0)},stopStrafing:function(){this._manipulator.getSideInterpolator().setDelay(this._delay),this._manipulator.getSideInterpolator().setTarget(0)}}));const Ai=Ri;var Ci,Mi=function(t){ce.call(this,t),this.init()};Mi.AvailableControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],Mi.ControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],a.Z.createPrototypeObject(Mi,a.Z.objectInherit(ce.prototype,{computeHomePosition:function(t){var e=this.getHomeBoundingSphere(t);if(e&&e.valid()){this._distance=this.getHomeDistance(e);var i=e.center();s.R3.scale(this._eye,this._direction,-this._distance),s.R3.add(this._eye,i,this._eye),this.setTarget(i)}},init:function(){this._direction=s.R3.fromValues(0,1,0),this._eye=s.R3.fromValues(0,25,10),this._up=s.R3.fromValues(0,0,1),this._roll=0,this._distance=1,this._forward=new Ve(1),this._side=new Ve(1),this._lookPosition=new Ve(2),this._pan=new Ve(2),this._zoom=new Ve(1),this._stepFactor=1,this._angleVertical=0,this._angleHorizontal=0,this._tmpGetTargetDir=s.R3.create(),this._vrEnable=!1,this._vrRot=s.gf.create(),this._vrPos=s.R3.create(),this._vrTrans=s.R3.create();var t=this;this._controllerList={},Mi.ControllerList.forEach((function(e){void 0!==Mi[e]&&(t._controllerList[e]?t._controllerList[e].init():t._controllerList[e]=new Mi[e](t))}))},setDelay:getEyePosition:function(t){return t[0]=this._eye[0],t[1]=this._eye[1],t[2]=this._eye[2],t},setEyePosition:function(t){return this._eye[0]=t[0],this._eye[1]=t[1],this._eye[2]=t[2],this},getTarget:function(t){var e=s.R3.scale(this._tmpGetTargetDir,this._direction,this._distance);return s.R3.add(t,this._eye,e),t},setRoll:function(t){this._roll=t},setEnable:function(t){this.getInputManager().setEnable(Ne.Z.FPS_MANIPULATOR,t)},setTarget:function(t){var e=this._tmpGetTargetDir;s.R3.sub(e,t,this._eye),e[2]=0,s.R3.normalize(e,e),this._angleHorizontal=Math.acos(e[1]),e[0]<0&&(this._angleHorizontal=-this._angleHorizontal),s.R3.sub(e,t,this._eye),s.R3.normalize(e,e),this._angleVertical=-Math.asin(e[2]),s.R3.copy(this._direction,e)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getForwardInterpolator:function(){return this._forward},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getRotateInterpolator:function(){return this._lookPosition},computeRotation:function(){var t=s._E.create(),e=s._E.create(),i=s.R3.fromValues(1,0,0),r=s.R3.fromValues(0,1,0),n=s.R3.fromValues(0,0,1),a=.5*Math.PI;return function(o,h){this._angleVertical+=.01*h,this._angleHorizontal-=.01*o,this._angleVertical>a?this._angleVertical=a:this._angleVertical<-a&&(this._angleVertical=-a),this._vrEnable?(s.R3.transformQuat(this._direction,r,this._vrRot),s.R3.normalize(this._direction,this._direction),s.R3.transformQuat(this._up,n,this._vrRot)):(s._E.fromRotation(t,-this._angleVertical,i),s._E.fromRotation(e,-this._angleHorizontal,n),s._E.mul(e,e,t),s.R3.transformMat4(this._direction,r,e),s.R3.normalize(this._direction,this._direction),s.R3.transformMat4(this._up,n,e))}}(),reset:function(){this.init()},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},setStepFactor:function(t){this._stepFactor=t},computePosition:(Ci=s.K4.create(),function(t){this._forward.update(t),this._side.update(t);var e=this._distance<.001?.001:this._distance,i=this._camera.getProjectionMatrix(),r=1===i[15]?1:2/i[5];Ci[0]=this._forward.getCurrent()[0],Ci[1]=this._side.getCurrent()[0];var n=s.K4.sqrLen(Ci);n>1&&s.K4.scale(Ci,Ci,1/Math.sqrt(n));var a=this._pan.update(t),o=this._zoom.update(t),h=this._stepFactor*e*r*t,u=this._stepFactor*e*r*.005;this.moveForward(Ci[0]*h-o[0]*u*20),this.strafe(Ci[1]*h-a[0]*u),this.strafeVertical(-a[1]*u),this._vrEnable&&(s.R3.add(this._eye,this._eye,this._vrTrans),s.R3.init(this._vrTrans))}),update:function(){var t=s.R3.create(),e=s._E.create(),i=s.R3.create();return function(r){var n=r.getFrameStamp().getDeltaTime(),a=this._lookPosition.update(n);this.computeRotation(.5*-a[0],.5*-a[1]),this.computePosition(n),s.R3.add(t,this._eye,this._direction),0!==this._roll?(s._E.identity(e),s._E.rotate(e,e,this._roll,this._direction),s.R3.transformMat4(i,this._up,e),s._E.lookAt(this._inverseMatrix,this._eye,t,i)):s._E.lookAt(this._inverseMatrix,this._eye,t,this._up),this._vrEnable=!1}}(),setPoseVR:function(t,e){this._vrEnable=!0,s.gf.copy(this._vrRot,t),s.R3.sub(this._vrTrans,e,this._vrPos),s.R3.copy(this._vrPos,e)},moveForward:function(){var t=s.R3.create();return function(e){s.R3.normalize(t,this._direction),s.R3.scale(t,t,e),s.R3.add(this._eye,this._eye,t)}}(),strafe:function(){var t=s.R3.create();return function(e){s.R3.cross(t,this._direction,this._up),s.R3.normalize(t,t),s.R3.scale(t,t,e),s.R3.add(this._eye,this._eye,t)}}(),strafeVertical:function(){var t=s.R3.create();return function(e){s.R3.normalize(t,this._up),s.R3.scale(t,t,e),s.R3.add(this._eye,this._eye,t)}}()}),"osgGA","FirstPersonManipulator"),Mi.DeviceOrientation=Si,Mi.Hammer=Ti,Mi.WebVR=Ei,Mi.StandardMouseKeyboard=Ai;const Ii=Mi;var wi=function(t){Ae.call(this,t),this.init()};a.Z.createPrototypeObject(wi,a.Z.objectInherit(Ae.prototype,{init:function(){this._quat=s.gf.create(),this._pos=s.R3.create(),this._deviceOrientation=void 0,this._screenOrientation=void 0;var t=this._manipulator.getInputManager();t.group(Ne.Z.ORBIT_MANIPULATOR_DEVICEORIENTATION).addMappings({setDeviceOrientation:"deviceorientation",setScreenOrientation:"orientationchange"},this),t.setEnable(Ne.Z.ORBIT_MANIPULATOR_DEVICEORIENTATION,!1)},setDeviceOrientation:function(t){this._deviceOrientation||(this._deviceOrientation={}),this._deviceOrientation.alpha=t.alpha,this._deviceOrientation.beta=t.beta,this._deviceOrientation.gamma=t.gamma,t.screenOrientation?this.setScreenOrientation(t):this._update()},setScreenOrientation:_update:function(){this._deviceOrientation&&this._screenOrientation&&(Si.computeQuaternion(this._quat,this._deviceOrientation,this._screenOrientation),this._manipulator.setPoseVR(this._quat,this._pos))}}));const Ni=wi;var Pi=function(t){Ae.call(this,t),this.init()};a.Z.createPrototypeObject(Pi,a.Z.objectInherit(Ae.prototype,{init:function(){this._delay=.15,this._zoomFactor=.5,this._rotateFactor=5,this._panFactor=10,this._rotate=this._manipulator.getRotateInterpolator(),this._zoom=this._manipulator.getZoomInterpolator(),this._pan=this._manipulator.getPanInterpolator(),this._rotate.setDelay(this._delay),this._zoom.setDelay(this._delay),this._pan.setDelay(this._delay);var t=this._manipulator.getInputManager();t.group(Ne.Z.ORBIT_MANIPULATOR_GAMEPAD).addMappings({addZoom:"axis 3",addRotateX:"axis 0",addRotateY:"axis 1"},this),t.group(Ne.Z.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panUp:"buttonvalue 12"},this.pan.bind(this,s.K4.fromValues(0,1))),t.group(Ne.Z.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panDown:"buttonvalue 13"},this.pan.bind(this,s.K4.fromValues(0,-1))),t.group(Ne.Z.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panLeft:"buttonvalue 14"},this.pan.bind(this,s.K4.fromValues(1,0))),t.group(Ne.Z.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panRight:"buttonvalue 15"},this.pan.bind(this,s.K4.fromValues(-1,0)))},pan:function(t){var e=this._pan.getTarget();this._pan.setTarget(e[0]-t[0]*this._panFactor,e[1]+t[1]*this._panFactor)},addZoom:function(t){this._zoom.addTarget(-t.value*this._zoomFactor)},addRotateX:function(t){this._rotate.addTarget(-t.value*this._rotateFactor)},addRotateY:function(t){this._rotate.addTarget(0,t.value*this._rotateFactor)}}));const Zi=Pi;var Li=s.gf.create(),Oi=s.R3.create(),Fi=a.Z.createPrototypeObject(Fi,a.Z.objectInherit(Ae.prototype,{init:function(){this._pos=s.R3.create(),this._quat=s.gf.create();var t=this._manipulator.getInputManager();t.group(Ne.Z.ORBIT_MANIPULATOR_WEBVR).addMappings({update:"vrdisplayposechanged"},this),t.setEnable(Ne.Z.ORBIT_MANIPULATOR_WEBVR,!1)},update:function(t){var e=t.pose.orientation;e&&(t.sitToStandMatrix&&(e=s._E.getRotation(Li,t.sitToStandMatrix),s.gf.mul(e,e,t.pose.orientation)),this._quat[0]=e[0],this._quat[1]=-e[2],this._quat[2]=e[1],this._quat[3]=e[3]);var i=t.pose.position;i&&(t.sitToStandMatrix&&(i=s.R3.transformMat4(Oi,i,t.sitToStandMatrix)),this._pos[0]=i[0]*t.worldFactor,this._pos[1]=-i[2]*t.worldFactor,this._pos[2]=i[1]*t.worldFactor),this._manipulator.setPoseVR(this._quat,this._pos)}}));const Di=Fi;var Ui=function(t){ce.call(this,t),this._homePosition=s.R3.create(),this._frustum={},this.init()};Ui.AvailableControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"],Ui.ControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"];var Bi,ki,Vi,Gi,ji=2*Math.PI,Wi=function(t,e){return t<e+1e-5},Hi=1e-4,zi=1/0;a.Z.createPrototypeObject(Ui,a.Z.objectInherit(ce.prototype,{init:function(){this._distance=25,this._target=s.R3.create(),this._upz=s.R3.fromValues(0,0,1),this._roll=0,s.R3.init(this._target);var t=s._E.fromRotation(s._E.create(),-Math.PI,this._upz),e=s._E.fromRotation(s._E.create(),Math.PI/10,s.R3.fromValues(1,0,0));this._rotation=s._E.create(),s._E.mul(this._rotation,t,e),this._time=0,this._vrMatrix=s._E.create(),this._rotate=new Ve(2),this._pan=new Ve(2),this._zoom=new Ve(1),this._minSpeed=1e-4,this._scaleMouseMotion=1,this._inverseMatrix=s._E.create(),this._autoPushTarget=!0,this._limitPitchUp=.5*Math.PI*.9,this._limitPitchDown=-this._limitPitchUp,this._limitYawLeft=-Math.PI,this._limitYawRight=-this._limitYawLeft,this._limitZoomIn=Hi,this._limitZoomOut=zi,this._constrainYaw=!1,this._constrainPitch=!1,this._constrainYaw=!1,this._constrainZoom=!1,this._panFactor=.002,this._rotationFactor=.1,this._zoomFactor=.1;var i=this;Ui.ControllerList.forEach((function(t){void 0!==Ui[t]&&(i._controllerList[t]?i._controllerList[t].init():i._controllerList[t]=new Ui[t](i))}))},setZoomFactor:function(t){this._zoomFactor=.1*t},setRotationFactor:function(t){this._rotationFactor=.1*t},setPanFactor:setLimitPitchUp:function(t){this._limitPitchUp=t},setLimitPitchDown:function(t){this._limitPitchDown=t},setLimitYawLeft:function(t){this._limitYawLeft=t,this._constrainYaw=!0},setLimitYawRight:function(t){this._limitYawRight=t,this._constrainYaw=!0},setLimitZoomOut:function(t){this._limitZoomOut=t,this._constrainZoom=!0},setLimitZoomIn:setConstrainPitch:function(t){this._constrainPitch=t,this._previousPitch=void 0},isConstrainPitch:function(){return this._constrainPitch},setConstrainYaw:isConstrainYaw:function(){return this._constrainYaw},setConstrainZoom:isConstrainZoom:setDelay:reset:setTarget:function(t){s.R3.copy(this._target,t);var e=s.R3.create();this.getEyePosition(e),this._distance=s.R3.distance(t,e)},setEyePosition:function(){var t=s.R3.create(),e=s.R3.create(),i=s.R3.create();return function(r){var n=this._rotation,a=this._target;s.R3.sub(t,r,a),s.R3.normalize(t,t),s.R3.cross(e,t,this._upz),s.R3.normalize(e,e),s.R3.cross(i,e,t),s.R3.normalize(i,i),n[0]=e[0],n[1]=t[0],n[2]=i[0],n[3]=0,n[4]=e[1],n[5]=t[1],n[6]=i[1],n[7]=0,n[8]=e[2],n[9]=t[2],n[10]=i[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this._distance=s.R3.distance(a,r)}}(),setEnable:function(t){this.getInputManager().setEnable(Ne.Z.ORBIT_MANIPULATOR,t)},computeHomePosition:function(t){var e=this.getHomeBoundingSphere(t);e&&e.valid()&&(this.setDistance(this.getHomeDistance(e)),this.setTarget(e.center()))},getHomePosition:function(){if(void 0!==this._node){var t=this._target,e=this.getDistance();this.computeEyePosition(t,e,this._homePosition)}return this._homePosition},setMinSpeed:function(t){this._minSpeed=t},getMinSpeed:function(){return this._minSpeed},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},getSpeedFactor:computePan:(ki=s._E.create(),Vi=s.R3.create(),Gi=s.R3.create(),function(t,e){var i=this._camera.getProjectionMatrix(),r=1===i[15]?1:2/i[5],n=this.getSpeedFactor()*r;e*=n,t*=n,s._E.invert(ki,this._rotation),Vi[0]=ki[0],Vi[1]=ki[1],Vi[2]=ki[2],s.R3.normalize(Vi,Vi),Gi[0]=ki[8],Gi[1]=ki[9],Gi[2]=ki[10],s.R3.normalize(Gi,Gi),s.R3.scale(Vi,Vi,-t),s.R3.scale(Gi,Gi,e),s.R3.add(this._target,this._target,Vi),s.R3.add(this._target,this._target,Gi)}),computeRotation:(Bi=s.R3.fromValues(1,0,0),function(t,e){var i=Math.atan(-this._rotation[6]/this._rotation[5]);isNaN(i)&&(i=0);var r=this._computePitch(i,e),n=t/10,a=Math.atan2(this._rotation[4],this._rotation[0]),o=this._computeYaw(a,n);s._E.fromRotation(this._rotation,-r,Bi),s._E.rotate(this._rotation,this._rotation,-o,this._upz)}),_computePitch:function(t,e){var i=t+e/10;return Math.min(Math.max(i,this._limitPitchDown),this._limitPitchUp)},_computeYaw:function(t,e){var i=t+e,r=this._limitYawLeft,n=this._limitYawRight;if(this._constrainYaw){if(n<r&&(i>Math.PI&&(t-=ji,i-=ji),i<-Math.PI&&(t+=ji,i+=ji)),0===e){(r>n?i<r&&i>n:i<r||i>n)&&(i=Math.abs(i-r)>Math.abs(i-n)?n:r)}e>0&&Wi(t,n)&&i>n?i=n:e<0&&Wi(r,t)&&i<r&&(i=r)}return i},computeZoom:function(t){this.zoom(t)},setAutoPushTarget:function(t){this._autoPushTarget=t},zoom:function(){var t=s.R3.create();return function(e){var i=this._distance+this.getSpeedFactor()*(e-1);this._autoPushTarget&&i<this._limitZoomIn&&(s.R3.sub(t,this._target,this.getEyePosition(t)),s.R3.normalize(t,t),s.R3.scale(t,t,this._limitZoomIn-i),s.R3.add(this._target,this._target,t));var r=this._constrainZoom?this._limitZoomIn:Hi,n=this._constrainZoom?this._limitZoomOut:zi;this._distance=Math.max(r,Math.min(n,i))}}(),setRoll:function(t){this._roll=t},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:getEyePosition:function(t){return this.computeEyePosition(this._target,this._distance,t),t},computeEyePosition:function(){var t=s.R3.create(),e=s._E.create();return function(i,r,n){s._E.invert(e,this._rotation),t[1]=r,s.R3.transformMat4(n,t,e),s.R3.add(n,i,n)}}(),update:function(){var t=s.R3.create(),e=s._E.create(),i=s.R3.create();return function(r){var n,a=r.getFrameStamp().getDeltaTime();n=this._rotate.update(a),this.computeRotation(-n[0]*this._rotationFactor*this._scaleMouseMotion,-n[1]*this._rotationFactor*this._scaleMouseMotion),n=this._pan.update(a),this.computePan(-n[0]*this._panFactor,-n[1]*this._panFactor),n=this._zoom.update(a),this.computeZoom(1+n[0]*this._zoomFactor);var o=this._target,h=this._distance;s._E.invert(this._inverseMatrix,this._rotation),s._E.mul(this._inverseMatrix,this._vrMatrix,this._inverseMatrix),s.R3.set(t,0,h,0),s.R3.transformMat4(t,t,this._inverseMatrix),0!==this._roll?(s._E.identity(e),s.R3.sub(i,t,o),s._E.rotate(e,e,this._roll,i),s.R3.transformMat4(i,this._upz,e),s._E.lookAt(this._inverseMatrix,s.R3.add(t,o,t),o,i)):s._E.lookAt(this._inverseMatrix,s.R3.add(t,o,t),o,this._upz)}}(),setPoseVR:function(t){s._E.fromQuat(this._vrMatrix,t)}}),"osgGA","OrbitManipulator"),Ui.DeviceOrientation=Ni,Ui.GamePad=Zi,Ui.Hammer=De,Ui.WebVR=Di,Ui.StandardMouseKeyboard=Ze;const qi=Ui;var Xi=Xi.prototype={getCamera:function(){return this.getCurrentManipulator().getCamera()},setCamera:function(t){for(var e=this.getManipulatorList(),i=0,r=e.length;i<r;++i)e[i].setCamera(t)},update:function(t){var e=this.getCurrentManipulator();if(void 0!==e)return e.update(t)},getInputManager:function(){return this._inputManager},setEnable:getNode:setNode:function(t){for(var e=this.getManipulatorList(),i=0,r=e.length;i<r;++i)e[i].setNode(t)},getControllerList:getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(t){this._manipulatorList.push(t),void 0===this._currentManipulator&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(t){this._currentManipulator=t},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:reset:computeHomePosition:function(t){var e=this.getCurrentManipulator();void 0!==e&&e.computeHomePosition(t)},getInverseMatrix:function(){var t=this.getCurrentManipulator();if(void 0!==t)return t.getInverseMatrix()},getHomeBound:function(t){return L.Z.warn("Please use getHomeBoundingSphere instead"),this.getHomeBoundingSphere(t)},getHomeBoundingSphere:function(t){return this.getCurrentManipulator().getHomeBoundingSphere(t)},getHomeDistance:;const Ki=Xi;var Yi={};oe().NO_MOUSEEVENTS=!0,Yi.CADManipulator=pi,Yi.getCADManipulatorStandardMouseKeyboardController=function(){return Oe},Yi.getCADManipulatorHammerController=function(){return Be},Yi.FirstPersonManipulator=Ii,Yi.getFirstPersonDeviceOrientationController=function(){return Si},Yi.getFirstPersonManipulatorHammerController=function(){return Ti},Yi.getFirstPersonStandardMouseKeyboardControllerClass=function(){return Ai},Yi.getFirstPersonWebVRControllerClass=function(){return Ei},Yi.Manipulator=ce,Yi.OrbitManipulator=qi,Yi.getOrbitManipulatorDeviceOrientationController=function(){return Ni},Yi.getOrbitManipulatorGamePadController=function(){return Zi},Yi.getOrbitManipulatorHammerController=function(){return De},Yi.getOrbitManipulatorStandardMouseKeyboardController=function(){return Ze},Yi.getOrbitManipulatorWebVRController=function(){return Di},Yi.SwitchManipulator=Ki,Yi.OrbitManipulator.Rotate=Me,Yi.OrbitManipulator.Pan=Ie,Yi.OrbitManipulator.Zoom=we,Yi.Controller=Ae;const Qi=Yi;var Ji=i("nbbV"),$i=i("uRnn"),tr=i("64xh"),er=i("o4nZ"),ir=i("W6eo"),rr=i("lU+d"),nr=i("Yy1w"),ar=i("5pih"),sr=i("7itD"),or=i("w/Ui"),hr=function(){Kt.Z.call(this),this._feedbackSwapped=!1,this._syncFeedbackUniforms=!1,this._syncOnNextFrame=!1,this._lastXratio=1,this._lastYratio=1,this._xViewportRatio=1,this._yViewportRatio=1,this._xTextureRatio=1,this._yTextureRatio=1,this._finalPassUpScaleToScreen=!0,this._methodWrapUV=0,this._thresholdWrapUV=1,this._texInfos=void 0,this._screenWidth=this._screenHeight=0,this._feedbackData={},this._cameras=[],this._stateSets=[],this._textureUniforms=[],this._programs={},this._externalTextures={},this._internalPasses=[],this._textures={},this._userTextures={},this._currentPoolIndex=0,this._texturePool={},this._firstTexture="",this._offScreen=!1;var t=this.getOrCreateStateSet();t.setAttributeAndModes(new $i.Z($i.Z.DISABLE)),t.setAttributeAndModes(new Ji.Z(Ji.Z.BACK)),this.setCullCallback(this)};hr.VertexShader=["attribute vec3 Vertex;","void main(void) {","    gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","}","","#define SHADER_NAME %name%",""].join("\n"),hr.FragmentShader=["uniform float uRGBMRange;","vec2 gTexCoord;","%uniforms%","",'#pragma include "utils/functions.glsl"',"","%header%","","%texturesColorSpace%","","%functionBodies%","","void main(void) {","    gTexCoord = gl_FragCoord.xy / uTextureOutputSize.xy;","    vec4 color = %firstFunc%(%firstArg%);","    %optionalFuncs%","    %colorSpaces%","    gl_FragColor = color;","}","","#define SHADER_NAME %name%",""].join("\n"),a.Z.createPrototypeObject(hr,a.Z.objectInherit(Kt.Z.prototype,{setOffscreen:function(t){this._offScreen=t},clear:function(){for(var t in this._textures={},this._internalPasses.length=0,this._firstTexture="",this._texturePool)this._texturePool[t].usage=-1;this._feedbackData={},this._cameras.length=0,this._stateSets.length=0,this._textureUniforms.length=0,this.removeChildren()},clearShaderCache:function(){this._programs={}},getGlobalXRatio:function(){return this._xViewportRatio*this._xTextureRatio},getGlobalYRatio:function(){return this._yViewportRatio*this._yTextureRatio},setFinalPassUpScaleToScreen:function(t){this._finalPassUpScaleToScreen=t},_enforceFromInputParameter:function(t,e){var i=e.name,r=this._textures[i],n=this._textures[i+"FeedbackTexture"],a=e[t];void 0!==a&&(void 0!==r[t]&&r[t]!==a&&console.error("Mismatch on parameter "+t+" : "+i),r[t]=a,n&&(n[t]=a))},_updatePassInfoFromInputs:function(t,e,i){var r=this._textures[e],n=i.srgb;i.srgb=void 0;for(var a=0;a<t.textures.length;a++){var s=t.textures[a];this._renameTextureAlias(s,e,i.name);var o=s.name;if(!this._externalTextures[o]){this._usages[o]=(this._usages[o]||0)+1;var h=s.srgb;this._enforceFromInputParameter("filter",s),this._enforceFromInputParameter("rgbm",s),this._enforceFromInputParameter("srgb",s);var u=this._textures[o];if(!u){var c=o.substring(0,o.indexOf("FeedbackTexture"));u=this._textures[c]}void 0!==n&&void 0!==h&&n!==h&&(u.encodeSRGB=!0),this._setInferredParameter("rgbmInferred","rgbm",r,u),this._setInferredParameter("srgbInferred","srgb",r,u)}}void 0===i.srgb&&(i.srgb=void 0===r.srgb?r.srgbInferred:r.srgb)},_setInferredParameter:function(t,e,i,r){void 0===i[t]&&(i[t]=void 0===r[e]?r[t]:r[e])},_createTextureOut:function(t,e,i){var r={srgb:t.out.srgb,rgbm:t.out.rgbm,filter:t.out.filter,type:t.out.type},n=t.out.type!==qt.Z.UNSIGNED_BYTE;return void 0===r.rgbm&&(i||n)&&(r.rgbm=!1),void 0===r.srgb&&(i?r.srgb=!0:(r.rgbm||n)&&(r.srgb=!1)),r},_processUserPasses:function(t){t=this._internalPasses.concat(t);for(var e=this._preprocessUserPasses(t),i=e.length,r=[],n={name:this._firstTexture,srgb:void 0},a={},s=0;s<i;s++){var o=e[s],h=s===i-1;if(h||!this._collapsePasses(o,e[s+1])){var u=o.out.name,c="%next"===u;c&&(a[u=o.funcs.join("_")]?u+=a[u]++:a[u]=1);var l=this._createTextureOut(o,u,h);this._textures[u]=l,this._updatePassInfoFromInputs(o,u,n),o.feedbackLoop&&(this._textures[u+"FeedbackTexture"]={srgb:l.srgb,rgbm:l.rgbm,srgbInferred:l.srgbInferred,rgbmInferred:l.rgbmInferred,filter:l.filter}),c&&(n.name=u,o.out.name=u),r.push(o)}else e.splice(s+1,1),i--,s--}return r},_hasFreeTexture:function(t,e,i){if(t===i.name&&this._texturePool[t])return t;if(!i.immuable)for(var r in this._texturePool){var n=this._texturePool[r];if(n.reusable&&(!(n.usage>0)&&n.texture.divisor===i.divisor&&n.texture.getInternalFormatType()===i.type)){if(-1===n.usage)return n.texture.getMinFilter()!==e&&(n.texture.setMinFilter(e),n.texture.setMagFilter(e)),r;if(n.texture.getMinFilter()===e)return r}}},_setOrCreateTextureKey:function(t,e,i){var r="linear"===this._textures[e].filter?qt.Z.LINEAR:qt.Z.NEAREST,n=this._hasFreeTexture(e,r,i);if(n)return this._texturePool[n].usage=t,void(this._textures[e].key=n);n=i.immuable?e:"key"+this._currentPoolIndex++,this._texturePool[n]={usage:t,texture:this._createTexture(e,i.divisor,i.type,r),immuable:i.immuable,reusable:i.reusable},-1===i.divisor&&(this._texturePool[n].width=i.width,this._texturePool[n].height=i.height),this._textures[e].key=n},_addStateSet:function(t,e){for(var i=0;i<t.funcs.length;i++){var r=t.funcs[i].name;this._stateSets[r]=e}},_addTextureToStateSet:function(t,e,i,r,n){e.addUniform(tr.Z.createInt1(i,t.uniformName));var a,s=t.name;if(void 0!==this._textures[s]){var o=this._textures[s].key;a=this._texturePool[o].texture}else a=this._externalTextures[s];if(this._addTextureUniforms(t.uniformName,a,e,r,n),"TexturePrevious"===t.uniformName)return i;e.setTextureAttributeAndModes(i,a)},_getUniformName:function(t){return"u"+t[0].toUpperCase()+t.slice(1)},_addTextureUniforms:function(t,e,i,r,n){var a=this._getUniformName(t),s=tr.Z.createFloat2(a+"Size"),o=tr.Z.createFloat2(a+"Ratio");i.addUniform(s),i.addUniform(o),r.push(s),r.push(o),this._textureUniforms.push({size:s,ratio:o,texture:e,isFeedback:!!n})},_checkInferredParameters:function(){for(var t in this._textures){var e=this._textures[t];void 0===e.srgb&&(e.srgb=e.srgbInferred),void 0===e.rgbm&&(e.rgbm=e.rgbmInferred)}},_buildPass:function(t,e){var i=e[t],r=i.out.name;this._setOrCreateTextureKey(this._usages[r],r,i.out);var n=i.out.name+"FeedbackTexture";if(i.feedbackLoop&&this._setOrCreateTextureKey(this._usages[n],n,i.out),i.funcs.length){var a,s=new er.Z;for(this._addStateSet(i,s),a=0;a<i.uniforms.length;a++)s.addUniform(i.uniforms[a]);var o=[],h=void 0;for(a=0;a<i.textures.length;a++){var u=i.textures[a],c=u.name===n;if(!c&&!this._externalTextures[u.name]){var l=this._textures[u.name].key;this._texturePool[l].usage--}var _=this._addTextureToStateSet(u,s,a,o,c);if(void 0!==_&&(h=_),void 0!==this._feedbackData[u.name]){var d={stateSet:s,textureUnit:a};this._feedbackData[u.name].nextPasses.push(d)}}var f=void 0;if(t!==e.length-1||this._offScreen){var p=this._textures[r].key;f=this._texturePool[p].texture}this._addTextureUniforms("TextureOutput",f,s,o),s.setAttributeAndModes(this._createProgram(i,o)),i.feedbackLoop?this._feedbackData[r]=this._createFeedbackLoopCameras(r,s,f,h):this.addChild(this._createCamera(r,s,f))}else{var g=this._textures[r].key;this._userTextures[r]=this._texturePool[g].texture}},_buildGraphFromPasses:function(t){for(var e=0;e<t.length;e++)this._buildPass(e,t)},build:function(t){this._usages={};var e=this._processUserPasses(t);this._checkInferredParameters(e),this._buildGraphFromPasses(e),this.resize(this._screenWidth,this._screenHeight)},_createFeedbackLoopCameras:function(t,e,i,r){var n=this._textures[t+"FeedbackTexture"].key,a=this._texturePool[n].texture,s=new Kt.Z;s.setStateSet(e);var o=this._createFeedbackLoopCamera(t,i,a,r),h=this._createFeedbackLoopCamera(t+"FeedbackTexture",a,i,r);h.setNodeMask(0),s.addChild(o),s.addChild(h),this.addChild(s);var u={};return u.camera1=o,u.camera2=h,u.texture1=i,u.texture2=a,u.nextPasses=[],u},_createFeedbackLoopCamera:function(t,e,i,r){var n=new er.Z;n.setTextureAttributeAndModes(r,i);var a=this._createCamera(t,n,e);return a.setStateSet(n),a},_createCamera:function(t,e,i){var r=new ir.Z;r.setName(t),r.setStateSet(e),r.setClearMask(0),r.setReferenceFrame(Zt.Z.ABSOLUTE_RF),i&&(r.setRenderOrder(ir.Z.PRE_RENDER,0),r.attachTexture(rr.Z.COLOR_ATTACHMENT0,i)),r.setViewport(new nr.Z);var n=zt.Z.createTexturedFullScreenFakeQuadGeometry();return n.setName("composer layer"),r.addChild(n),this._cameras.push(r),r},swapFeedbackLoopTextures:function(t){for(var e in this._feedbackData){var i=this._feedbackData[e];i.camera1.setNodeMask(t?-1:0),i.camera2.setNodeMask(t?0:-1);for(var r=t?i.texture1:i.texture2,n=0;n<i.nextPasses.length;n++){var a=i.nextPasses[n];a.stateSet.setTextureAttributeAndModes(a.textureUnit,r)}}this._feedbackSwapped=!0},_createFuncFromUserData:function(t){var e="string"==typeof t?{name:t,file:t+".glsl"}:t;return e.toString=function(){return this.name},e},_createTextureInfoFromUserData:function(t){var e={name:"",uniformName:"",rgbm:void 0,srgb:void 0,filter:void 0};return"string"==typeof t?e.name=t:(e.name=t.name,t.uniformName&&(e.uniformName=t.uniformName),void 0!==t.rgbm&&(e.rgbm=t.rgbm),void 0!==t.srgb&&(e.srgb=t.srgb),void 0!==t.filter&&(e.filter=t.filter)),e},_preprocessUserPasses:function(t){for(var e=[],i=0;i<t.length;i++){var r=t[i],n={funcs:[]};if(r.func&&n.funcs.push(this._createFuncFromUserData(r.func)),n.textures=[],n.feedbackLoop=!1,void 0!==r.textures){Array.isArray(r.textures)||(r.textures=[r.textures]);for(var a=0;a<r.textures.length;a++){var s=this._createTextureInfoFromUserData(r.textures[a]);"%previous"===s.name&&(n.feedbackLoop=!0),n.textures.push(s)}}"string"==typeof r.header?n.header=[r.header]:n.header=r.header||[],void 0!==r.uniforms?Array.isArray(r.uniforms)?n.uniforms=r.uniforms:n.uniforms=[r.uniforms]:n.uniforms=[],n.out=r.out,n.out.divisor=n.out.divisor||1,n.out.type=n.out.type||qt.Z.UNSIGNED_BYTE,void 0===n.out.immuable&&(n.out.immuable=!1),void 0===n.out.reusable&&(n.out.reusable=!0),(n.feedbackLoop||-1===n.out.divisor)&&(n.out.immuable=!0,n.out.reusable=!1),n.collapsible=r.collapsible||!1,e.push(n)}return e},_canBeCollapsed:function(t,e){return t.funcs.length&&e.collapsible&&"%next"===t.out.name&&t.out.divisor===e.out.divisor&&t.out.width==t.out.width&&t.out.height==t.out.height},_collapsePasses:function(t,e){return!!this._canBeCollapsed(t,e)&&(t.funcs=t.funcs.concat(e.funcs),t.header=t.header.concat(e.header),t.textures=this._mergeWithoutDuplicates(t.textures,e.textures,(),t.uniforms=this._mergeWithoutDuplicates(t.uniforms,e.uniforms,(),!0)},_renameTextureAlias:function(t,e,i){"%last"===t.name?(t.name=i,t.uniformName=t.uniformName||"TextureInput"):"%previous"===t.name?(t.name=e+"FeedbackTexture",t.uniformName=t.uniformName||"TexturePrevious"):t.uniformName||(t.uniformName=t.name)},_createTexture:function(t,e,i,r){var n=new qt.Z;return n.setTextureSize(1,1),n.setInternalFormatType(i),n.setInternalFormat(qt.Z.RGBA),n.setMinFilter(r),n.setMagFilter(r),n.divisor=e,n.setName(t),n},_computeHashFromPass:function(t){for(var e="",i=0;i<t.funcs.length;i++)e+=t.funcs[i].name+"_"+t.funcs[i].file+"_";for(t.header&&(e+=t.header.join("_")),i=0;i<t.textures.length;i++)e+=!!t.textures[i].rgbm+"_"+!!t.textures[i].srgb+"_";return e+=!!t.out.encodeSRGB+"_",e+=!!this._textures[t.out.name].rgbm+"_"},_writeDeclarations:function(t,e,i,r){var n,a="uniform sampler2D TextureInput;\n";for(n=0;n<i.length;n++){a+="uniform sampler2D "+(i[n].uniformName||i[n].name)+";\n"}for(n=0;n<e.length;n++){var s=e[n];a+="uniform "+s.getType()+" "+s.getName()+";\n"}return t=t.replace("%uniforms%",a),r&&(t=t.replace("%header%",r.join("\n"))),t},setMethodWrapUV:function(t,e){void 0!==t&&(this._methodWrapUV=t),void 0!==e&&(this._thresholdWrapUV=e),this._texInfos=void 0},_getInfos:function(){if(this._texInfos)return this._texInfos;var t="texture2D(%tex, (uv) * %ratio)",e="texture2D(%tex, (floor((uv) * %size) + 0.5) * %ratio / %size, -99999.0)",i="texture2D(%tex, (uv) * %ratio)",r=this._thresholdWrapUV.toExponential();if(1===this._methodWrapUV){var n="min(uv, 1.0 - "+r+" / %size.xy)";t=t.replace(/(uv)/g,n),e=e.replace(/(uv)/g,n),i=i.replace(/(uv)/g,n)}else if(2===this._methodWrapUV){var a="step((uv).x, 1.0 - "+r+" / %size.x) *";t=(a+="step((uv).y, 1.0 - "+r+" / %size.y) * ")+t,e=a+e,i=a+i}return this._texInfos={TEXTURE_2D:{signature:"TEXTURE_2D_%tex(uv)",body:t},TEXTURE_2D_NEAREST:{signature:"TEXTURE_2D_NEAREST_%tex(uv)",body:e},TEXTURE_2D_BIAS:{signature:"TEXTURE_2D_BIAS_%tex(uv, bias)",body:i}},this._texInfos},_extractTextures:function(t){var e=this._getInfos(),i=t.match(/TEXTURE_2D(?:_BIAS|_NEAREST)?_\w+\(/g);if(!i)return{};for(var r={},n=0;n<i.length;n++){var a=i[n].match(/((TEXTURE_2D(?:_BIAS|_NEAREST)?)_(\w+))\(/),s=e[a[2]];r[a[1]]={name:a[3],signature:s.signature,body:s.body}}return r},_writeFunctionBodies:function(t,e,i,r){for(var n=[],a="",s={},o=0;o<e.length;o++){a+=or.Z.getShaderTextPure(e[o].file)+"\n"}a=or.Z.processIncludes(a,["utils/functions.glsl"]);var h=this._extractTextures(a);if(r){var u=this._getInfos().TEXTURE_2D;h.TEXTURE_2D_TextureInput={name:"TextureInput",signature:u.signature,body:u.body}}for(var c in h)if(!s[c]){s[c]=!0;for(var l=h[c],_=l.name,d=!1,f=0;f<i.length;f++){var p=i[f];if(p.uniformName===_){var g=this._textures[p.name];if(g&&g.rgbm){d=g.rgbm;break}}}var m=l.body;d&&(m="vec4(decodeRGBM("+m+", uRGBMRange), 1.0)"),m="#define "+l.signature+" ("+m+")";var v=this._getUniformName(_);m=(m=(m=m.replace(/%size/g,v+"Size")).replace(/%ratio/g,v+"Ratio")).replace(/%tex/g,_),n.push(m)}return(t=t.replace("%texturesColorSpace%",n.join("\n"))).replace("%functionBodies%",a.replace(/\\\n/g,""))},_writeMainFunction:function(t,e,i,r){var n=i?"TEXTURE_2D_TextureInput(gTexCoord)":"";t=(t=t.replace("%firstFunc%",e[0].name)).replace("%firstArg%",n);for(var a="",s=1;s<e.length;s++)a+="\tcolor = "+e[s].name+"(color);\n";(t=t.replace("%optionalFuncs%",a),!0===this._textures[r].encodeSRGB)?a="\tcolor.rgb = "+(this._textures[r].srgb?"linearTosRGB":"sRGBToLinear")+"(color.rgb);\n":a="";return this._textures[r].rgbm?a+="\tcolor = encodeRGBM(color.rgb, uRGBMRange);":a+="",t.replace("%colorSpaces%",a)},_removeDuplicatedUniforms:function(t){for(var e=t.split("\n"),i={},r=e.length,n=0;n<r;n++){var a=e[n].match(/uniform(?:\s+){1,}\w+(?:\s+){1,}(\w+)/);if(null!==a){var s=a[1];void 0!==i[s]?(e.splice(n,1),r--,n--):i[s]=!0}}return e.join("\n")},_createProgram:function(t,e){var i=this._computeHashFromPass(t);if(void 0!==this._programs[i])return this._programs[i];var r=this._writeDeclarations(hr.FragmentShader,e,t.textures,t.header);r=this._writeFunctionBodies(r,t.funcs,t.textures,t.collapsible),r=(r=this._writeMainFunction(r,t.funcs,t.collapsible,t.out.name)).replace("%name%",t.out.name),r=this._removeDuplicatedUniforms(r);var n=hr.VertexShader.replace("%name%",t.out.name),a=new ar.Z(new sr.Z(sr.Z.VERTEX_SHADER,n),new sr.Z(sr.Z.FRAGMENT_SHADER,r));return a._asyncLinkingExt=void 0,this._programs[i]=a,a},resize:function(t,e){for(var i in this.setScreenSize(t,e),this._texturePool){var r=this._texturePool[i].texture;void 0===this._texturePool[i].width?r.setTextureSize(this._getTextureSize(t,r.divisor),this._getTextureSize(e,r.divisor)):r.setTextureSize(this._texturePool[i].width,this._texturePool[i].height)}this.resizeRatio()},resizeRatio:function(t,e,i,r){void 0!==t&&(this._xViewportRatio=t),void 0!==e&&(this._yViewportRatio=e),void 0!==i&&(this._xTextureRatio=i),void 0!==r&&(this._yTextureRatio=r),this._resizeViewports(),this._resizeTextureUniforms()},_resizeViewports:function(){for(var t=this.getGlobalXRatio(),e=this.getGlobalYRatio(),i=this._cameras,r=0;r<i.length;++r){var n=i[r],a=1;if(n.isRenderToTextureCamera())a=n.getAttachments()[rr.Z.COLOR_ATTACHMENT0].texture.divisor;if(r===i.length-1&&this._finalPassUpScaleToScreen&&(t=this._xViewportRatio,e=this._yViewportRatio),-1!==a){var s=this._getTextureSize(this._screenWidth,a/t),o=this._getTextureSize(this._screenHeight,a/e);n.getViewport().setViewport(0,0,s,o)}}},_resizeTextureUniforms:function(){var t=this.getGlobalXRatio(),e=this.getGlobalYRatio(),i=this._finalPassUpScaleToScreen?this._xViewportRatio:t,r=this._finalPassUpScaleToScreen?this._yViewportRatio:e;this._syncFeedbackUniforms=!0;for(var n=this._textureUniforms,a=0;a<n.length;++a){var s=n[a],o=s.size.getInternalArray(),h=s.ratio.getInternalArray();if(!s.isFeedback||!o[0]){h[0]=t,h[1]=e;var u=s.texture;u?!u.divisor||u.divisor<0?(o[0]=u.getWidth(),o[1]=u.getHeight(),h[0]=h[1]=1):(o[0]=t*u.getWidth(),o[1]=e*u.getHeight()):(o[0]=this._screenWidth*i,o[1]=this._screenHeight*r)}}},_resizeFeedbackTextureUniforms:function(){for(var t=this._lastXratio,e=this._lastYratio,i=this._textureUniforms,r=0;r<i.length;++r){var n=i[r];if(n.isFeedback){var a=n.size.getInternalArray(),s=n.ratio.getInternalArray(),o=n.texture;s[0]=t,s[1]=e,a[0]=t*o.getWidth(),a[1]=e*o.getHeight()}}},cull:function(){return this._syncOnNextFrame&&(this._resizeFeedbackTextureUniforms(),this._syncOnNextFrame=!1),this._syncFeedbackUniforms&&this._feedbackSwapped&&(this._syncFeedbackUniforms=!1,this._syncOnNextFrame=!0,this._lastXratio=this.getGlobalXRatio(),this._lastYratio=this.getGlobalYRatio()),this._feedbackSwapped=!1,!0},_mergeWithoutDuplicates:function(t,e,i){for(var r=0;r<e.length;r++){for(var n=e[r],a=!0,s=0;s<t.length;s++)if(i(t[s],n)){a=!1;break}a&&t.push(n)}return t},_getTextureSize:function(t,e){return Math.max(1,Math.round(t/e))},setScreenSize:function(t,e){this._screenWidth=t,this._screenHeight=e},addInternalTexture:function(t){this._internalPasses.push({out:{name:t.name,divisor:t.divisor,type:t.type,filter:t.filter,srgb:t.srgb,rgbm:t.rgbm,immuable:t.immuable,reusable:t.reusable}})},addExternalTexture:setInputTexture:function(t){this._firstTexture=t},getCameras:function(){return this._cameras},getStateSetPass:function(t){return this._stateSets[t]},getInternalTexture:function(t){return this._userTextures[t]}}),"osgUtil","ComposerPostProcess");const ur=hr;var cr=function(t,e){var i,r;e?(i=e[0],r=e[1]):(i=t[14]/(t[10]-1),r=t[14]/(1+t[10]));var n=i*(t[8]-1)/t[0],a=i*(1+t[8])/t[0],s=i*(1+t[9])/t[5],o=i*(t[9]-1)/t[5],h=r*(t[8]-1)/t[0],u=r*(1+t[8])/t[0],c=r*(1+t[9])/t[5],l=r*(t[9]-1)/t[5],_=this.getAttributes().Vertex,d=_.getElements();d[0]=n,d[1]=o,d[2]=-i,d[3]=a,d[4]=o,d[5]=-i,d[6]=a,d[7]=s,d[8]=-i,d[9]=n,d[10]=s,d[11]=-i,d[12]=h,d[13]=l,d[14]=-r,d[15]=u,d[16]=l,d[17]=-r,d[18]=u,d[19]=c,d[20]=-r,d[21]=h,d[22]=c,d[23]=-r,_.dirty()};const lr={createDebugFrustumGeometry:function(){var t=zt.Z.createBoundingBoxGeometry();return t.updateGeometry=cr,t}};var _r=i("Z4fc"),dr=i("907W"),fr=i("4rHk"),pr=function(){q.Z.call(this),this._unifScale=tr.Z.createFloat(1,"uScale");var t=this._normalStateSet=new er.Z;t.addUniform(tr.Z.createFloat3(s.R3.fromValues(1,0,0),"uColorDebug")),t.addUniform(this._unifScale),t.setAttributeAndModes(new $i.Z($i.Z.NEVER)),t.setShaderGeneratorName("debugNormal"),t.setRenderBinDetails(fr.Z.DEBUG,"RenderBin");var e=this._tangentStateSet=new er.Z;e.addUniform(tr.Z.createFloat3(s.R3.fromValues(0,1,0),"uColorDebug")),e.addUniform(this._unifScale),e.setAttributeAndModes(new $i.Z($i.Z.NEVER)),e.setShaderGeneratorName("debugTangent"),e.setRenderBinDetails(fr.Z.DEBUG,"RenderBin")};a.Z.createPrototypeObject(pr,a.Z.objectInherit(q.Z.prototype,{setScale:function(t){this._unifScale.setFloat(t)},testCreateNormalVisitor:setTangentVisibility:function(t,e){this._tangentStateSet.setAttributeAndModes(new $i.Z(t?$i.Z.LESS:$i.Z.NEVER)),this.testCreateNormalVisitor(e)},setNormalVisibility:function(t,e){this._normalStateSet.setAttributeAndModes(new $i.Z(t?$i.Z.LESS:$i.Z.NEVER)),this.testCreateNormalVisitor(e)},apply:function(t){if(!(t instanceof Dt.Z&&t.getCullCallback()||t._isVisitedNormalDebug)){if(t._isVisitedNormalDebug=!0,t instanceof Dt.Z)return this._createDebugGeom(t,"Normal",this._normalStateSet),void this._createDebugGeom(t,"Tangent",this._tangentStateSet);this.traverse(t);for(var e=t.getUpdateCallbackList(),i=0,r=e.length;i<r;++i)e[i]instanceof et&&e[i].init(t)}},_createDoubleOffsetArray:function(t){for(var e=new Float32Array(2*t),i=0;i<t;++i)e[2*i]=1;return new Y.Z(Y.Z.ARRAY_BUFFER,e,1)},_createDoubledBufferArray:function(t){t.getInitialBufferArray&&(t=t.getInitialBufferArray());for(var e=t.getItemSize(),i=t.getElements(),r=i.length/e,n=new(0,i.constructor)(2*i.length),a=0;a<r;++a)for(var s=a*e,o=2*s,h=0;h<e;++h)n[o+h]=n[o+h+e]=i[s+h];return new Y.Z(Y.Z.ARRAY_BUFFER,n,e)},_addMorphTargets:function(t,e,i){var r=e.getMorphTargets();e.setName(t.getName());for(var n=t.getMorphTargets(),a=0,s=n.length;a<s;++a){var o=n[a],h=o.getVertexAttributeList(),u=new Dt.Z;u.setName(o.getName());var c=u.getVertexAttributeList();c.Vertex=this._createDoubledBufferArray(h.Vertex),h[i]&&(c[i]=this._createDoubledBufferArray(h[i])),r.push(u)}return e.mergeChildrenVertexAttributeList(),e},_createDebugGeom:function(t,e,i){var r=t.getAttributes(),n=r[e];if(n){var a=r.Vertex;if(a){var s;t instanceof J.Z?s=t:t.getSourceGeometry&&t.getSourceGeometry()instanceof J.Z&&(s=t.getSourceGeometry());var o,h=a.getElements().length/a.getItemSize(),u=s?new J.Z:new Dt.Z;if(u.getAttributes().Vertex=this._createDoubledBufferArray(a),u.getAttributes().Offset=this._createDoubleOffsetArray(h),u.getAttributes()[e]=this._createDoubledBufferArray(n),u.getPrimitives().push(new _r.Z(dr.Z.LINES,0,2*h)),s&&this._addMorphTargets(s,u,e),t instanceof Q.Z){var c=new Q.Z;c.setSourceGeometry(u),c.getVertexAttributeList().Bones=this._createDoubledBufferArray(r.Bones),c.getVertexAttributeList().Weights=this._createDoubledBufferArray(r.Weights),c._rigTransformImplementation=t._rigTransformImplementation,c._stateSetAnimation=t._stateSetAnimation,c.mergeChildrenData(),o=c}else o=u;var l=t.getParents(),_=l.length;o._isVisitedNormalDebug=!0,o._isNormalDebug=!0,o.setStateSet(i),o.nodeMask=-49;for(var d=0;d<_;++d)l[d].addChild(o);return o}}}}),"osgUtil","DisplayNormalVisitor");const gr=pr;var mr=i("/c5M"),vr=function(){q.Z.call(this),this._debugColor=!0,this._debugSkinning=!1,this._stCenter=new er.Z,this._stCenter.setShaderGeneratorName("debugGeometry")};a.Z.createPrototypeObject(vr,a.Z.objectInherit(q.Z.prototype,{setGeometryDebug:function(t){this._stCenter.setAttributeAndModes(new $i.Z($i.Z.ALWAYS)),this._debugColor=!0,this._debugSkinning=!1,this.apply(t)},setSkinningDebug:function(t){this._stCenter.setAttributeAndModes(new $i.Z($i.Z.NEVER)),this._debugColor=!1,this._debugSkinning=!0,this._boneIndexErrors=[],this.apply(t),this._boneIndexErrors.length&&this._warnBonesIndex()},disableDebug:function(t){(this._debugColor||this._debugSkinning)&&(this._stCenter.setAttributeAndModes(new $i.Z($i.Z.NEVER)),this._debugColor=!1,this._debugSkinning=!1,this.apply(t))},_debugCenterGeometry:function(t,e){var i=t.getBound(),r=new Float32Array(18),n=.1*i.radius();r[0]=n,r[3]=-n,r[7]=n,r[10]=-n,r[14]=n,r[17]=-n;var a=new Dt.Z;a.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,r,3);var o=new _r.Z(dr.Z.LINES,0,6);a.getPrimitives().push(o);var h=new Ht.Z,u=i.center();h.getMatrix()[12]=u[0],h.getMatrix()[13]=u[1],h.getMatrix()[14]=u[2],h.addChild(a),this.nodePath[this.nodePath.length-2].addChild(h),e=s.R3.fromValues(.8*e[0],.8*e[1],.8*e[2]),a.getOrCreateStateSet().addUniform(tr.Z.createFloat3(e,"uColorDebug")),h.setStateSet(this._stCenter),h._isCenterDebug=!0},_warnBonesIndex:function(){for(var t="Couldn't find bones. Indices: ",e="",i=0;i<this._boneIndexErrors.length&&i<10;i++){var r=this._boneIndexErrors[i];t+=r.index+", ",e+=r.boneNum+", "}mr.Z.client.captureMessage(t+" respectively reference bone nums: "+e)},_debugRigGeometry:function(t){var e=t.getVertexAttributeList();if(!e.BonesColor){for(var i=e.Bones.getElements(),r=e.Weights.getElements(),n=t._rigTransformImplementation._bones,a=i.length/4,s=new Float32Array(3*a),o=0;o<a;++o){for(var h=4*o,u=!1,c=h;c<h+4;c++)i[c]>n.length&&(this._boneIndexErrors.push({index:c,boneNum:i[c]}),u=!0);if(!u){var l=n[i[h]].getOrCreateDebugColor(),_=n[i[h+1]].getOrCreateDebugColor(),d=n[i[h+2]].getOrCreateDebugColor(),f=n[i[h+3]].getOrCreateDebugColor(),p=r[h],g=r[h+1],m=r[h+2],v=r[h+3],b=3*o;s[b]=p*l[0]+g*_[0]+m*d[0]+v*f[0],s[b+1]=p*l[1]+g*_[1]+m*d[1]+v*f[1],s[b+2]=p*l[2]+g*_[2]+m*d[2]+v*f[2]}}e.BonesColor=new Y.Z(Y.Z.ARRAY_BUFFER,s,3)}},_debugGeometry:function(t){var e=this._debugColor,i=this._debugSkinning&&t instanceof Q.Z;if(e||i){void 0===t._originalStateSet&&(t._originalStateSet=t.getStateSet()||null);var r=new er.Z;if(r.setRenderBinDetails(fr.Z.DEBUG,"RenderBin"),t.setStateSet(r),i)return r.setShaderGeneratorName("debugSkinning"),void this._debugRigGeometry(t);var n=s.R3.fromValues(Math.random(),Math.random(),Math.random());r.addUniform(tr.Z.createFloat3(n,"uColorDebug")),r.setShaderGeneratorName("debugGeometry"),this._debugCenterGeometry(t,n)}else void 0!==t._originalStateSet&&t.setStateSet(t._originalStateSet||void 0)},apply:function(t){t._isBoneBox||t._isSkeleton||t._isNormalDebug||t._isCenterDebug||(t instanceof Dt.Z&&this._debugGeometry(t),this.traverse(t))}}),"osgUtil","GeometryColorDebugVisitor");const br=vr;var Sr,yr,Tr,xr=i("9Aw2"),Er=i("zACX"),Rr=i("1PKS"),Ar=function(){if(Sr)return Sr;var t="#define SHADER_NAME GizmoLine3D",e=["attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;",t,"","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=["uniform vec4 uColor;",t,"","void main(void) {","  gl_FragColor = uColor;","}"].join("\n");return Sr=new ar.Z(new sr.Z(sr.Z.VERTEX_SHADER,e),new sr.Z(sr.Z.FRAGMENT_SHADER,i))},Cr=function(t,e){var i=t?.5*t:.5,r=e?.5*e:.5,n=new Dt.Z,a=new Float32Array(12);a[0]=-i,a[1]=-r,a[3]=i,a[4]=-r,a[6]=-i,a[7]=r,a[9]=i,a[10]=r,n.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,a,3);var s=new _r.Z(dr.Z.TRIANGLE_STRIP,0,4);return n.getOrCreateStateSet().setAttributeAndModes(Ar()),n.getPrimitives().push(s),n},Mr={createCircleGeometry:function(t,e,i){for(var r=new Dt.Z,n=new Float32Array(3*t),a=i||2*Math.PI,s=0;s<t;++s){var o=3*s,h=a*s/t;n[o]=Math.cos(h)*e,n[o+1]=Math.sin(h)*e}r.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,n,3);var u=new _r.Z(dr.Z.LINE_STRIP,0,t);return r.getOrCreateStateSet().setAttributeAndModes(Ar()),r.getPrimitives().push(u),r},createCylinderGeometry:function(t,e,i,r,n,a,s){var o=void 0!==t?t:1,h=void 0!==e?e:1,u=void 0!==i?i:5,c=void 0!==r?r:32,l=void 0!==n?n:1,_=void 0===a||a,d=void 0===s||s,f=.5*u,p=(l+1)*(c+1),g=l*c*2;(_=_&&o>0)&&(p+=1,g+=c),(d=d&&h>0)&&(p+=1,g+=c);var m,v=new Dt.Z,b=new Float32Array(3*p),S=new Uint16Array(3*g),y=0,T=0,x=0,E=0;for(x=0;x<=l;x++){var R=x/l,A=R*(h-o)+o;for(E=0;E<=c;E++){var C=E/c;b[T=3*y]=A*Math.sin(C*Math.PI*2),b[T+1]=A*Math.cos(C*Math.PI*2),b[T+2]=-R*u+f,y++}}for(y=0,E=0;E<c;E++)for(x=0;x<l;x++)S[T=6*y]=(c+1)*x+E,S[T+1]=S[T+3]=(c+1)*(x+1)+E,S[T+2]=S[T+5]=(c+1)*x+E+1,S[T+4]=(c+1)*(x+1)+E+1,y++;if(y*=2,_)for(b[3*(m=(d?b.length-6:b.length-3)/3)+2]=f,E=0;E<c;E++)S[T=3*y]=E,S[T+1]=E+1,S[T+2]=m,y++;if(d){b[3*(m=(b.length-3)/3)+2]=-f;var M=(c+1)*x;for(E=0;E<c;E++)S[T=3*y]=M+E+1,S[T+1]=M+E,S[T+2]=m,y++}return v.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,b,3),v.getOrCreateStateSet().setAttributeAndModes(Ar()),v.getPrimitives().push(new Rr.Z(dr.Z.TRIANGLES,new Y.Z(Y.Z.ELEMENT_ARRAY_BUFFER,S,1))),v},createTorusGeometry:function(t,e,i,r,n){var a=void 0!==t?t:1,s=void 0!==e?e:.2,o=void 0!==i?i:6,h=void 0!==r?r:64,u=void 0!==n?n:2*Math.PI,c=(o+1)*(h+1),l=o*h*2,_=new Dt.Z,d=new Float32Array(3*c),f=new Uint16Array(3*l);u=u||2*Math.PI;var p=0,g=0,m=0,v=0;for(v=0;v<=o;++v)for(m=0;m<=h;++m){var b=m/h*u,S=v/o*Math.PI*2;d[g=3*p]=(a+s*Math.cos(S))*Math.cos(b),d[g+1]=(a+s*Math.cos(S))*Math.sin(b),d[g+2]=s*Math.sin(S),p++}for(p=0,v=1;v<=o;++v)for(m=1;m<=h;++m)f[g=6*p]=(h+1)*v+m-1,f[g+1]=f[g+3]=(h+1)*(v-1)+m-1,f[g+2]=f[g+5]=(h+1)*v+m,f[g+4]=(h+1)*(v-1)+m,p++;return _.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,d,3),_.getOrCreateStateSet().setAttributeAndModes(Ar()),_.getPrimitives().push(new Rr.Z(dr.Z.TRIANGLES,new Y.Z(Y.Z.ELEMENT_ARRAY_BUFFER,f,1))),_}};Mr.createDebugLineGeometry=function(){var t=new Dt.Z;t.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,new Float32Array(4),2);var e=new _r.Z(dr.Z.LINES,0,2);return t.getPrimitives().push(e),t.getOrCreateStateSet().setAttributeAndModes(function(){if(yr)return yr;var t="#define SHADER_NAME GizmoLine2D",e=["attribute vec2 Vertex;",t,"","void main(void) {","  gl_Position = vec4(Vertex, 0.0, 1.0);","}"].join("\n"),i=[t,"","void main(void) {","  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","}"].join("\n");return yr=new ar.Z(new sr.Z(sr.Z.VERTEX_SHADER,e),new sr.Z(sr.Z.FRAGMENT_SHADER,i))}()),t},Mr.createPlaneGeometry=Cr,Mr.createQuadCircleGeometry=function(){var t=Cr();return t.getOrCreateStateSet().setAttributeAndModes(function(){if(Tr)return Tr;var t="#define SHADER_NAME GizmoQuadCircle",e=["attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","varying vec3 vViewVertex;",t,"","void main(void) {","  vViewVertex = Vertex;","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=["uniform float uAngle;","uniform vec3 uBase;","varying vec3 vViewVertex;","const float PI = 3.14159265358979323846264;","const float PI2 = PI * 2.0;",t,"","void main(void) {","  if(length(vViewVertex) > 0.5)","    discard;","  vec3 vn = normalize(vViewVertex);","  float angle = atan(uBase.y * vn.x - uBase.x * vn.y, dot(uBase, vn));","  if(angle > 0.0) {","    if(uAngle >= 0.0 && angle > uAngle) discard;","    if(uAngle < -PI && angle < uAngle + PI2) discard;","    if(uAngle < 0.0 && uAngle > -PI) discard;","  }","  if(angle < 0.0) {","    if(uAngle <= 0.0 && angle < uAngle) discard;","    if(uAngle > PI && angle > uAngle - PI2) discard;","    if(uAngle > 0.0 && uAngle < PI) discard;","  }","  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.5);","}"].join("\n");return Tr=new ar.Z(new sr.Z(sr.Z.VERTEX_SHADER,e),new sr.Z(sr.Z.FRAGMENT_SHADER,i))}()),t},Mr.resetPrograms=Mr.getOrCreateShader=Ar;const Ir=Mr;var wr=function(){};wr.prototype={cull:function(){return!1}};var Nr=new Xt.Z(Xt.Z.SRC_ALPHA,Xt.Z.ONE_MINUS_SRC_ALPHA),Pr=function(t){this._testPlane=t,this._inter=s.R3.create(),_e.Z.call(this)};a.Z.createPrototypeObject(Pr,a.Z.objectInherit(_e.Z.prototype,{setTestPlane:function(t){this._testPlane=t},getTranslateDistance:function(){return this._inter},enter:function(){var t=s.R3.create(),e=s.R3.create();return function(i){if(void 0===i._nbAxis)return!0;if(s.R3.init(t),t[i._nbAxis]=1,this._testPlane){var r=s.R3.dot(this._iStart,t),n=s.R3.dot(this._iEnd,t);if(r===n)return!1;var a=-r/(n-r);this._inter[0]=this._iStart[0]+(this._iEnd[0]-this._iStart[0])*a,this._inter[1]=this._iStart[1]+(this._iEnd[1]-this._iStart[1])*a,this._inter[2]=this._iStart[2]+(this._iEnd[2]-this._iStart[2])*a}else{s.R3.normalize(e,s.R3.sub(e,this._iEnd,this._iStart));var o=-s.R3.dot(e,t),h=s.R3.dot(this._iStart,e),u=Math.abs(1-o*o),c=-s.R3.dot(this._iStart,t);s.R3.init(this._inter),this._inter[i._nbAxis]=(o*h-c)/u}return!1}}(),intersectTriangle:function(){},intersectLine:function(){},intersectPoint:function(){}}),"osgUtil","LineCustomIntersector");var Zr=s._E.create(),Lr=function(t){Ht.Z.call(this),this._tmask=1,this._autoInsertMT=!1,this._correctPivotOnAutoInsert=!1,this._viewer=t,this._canvas=t.getGraphicContext().canvas,this._rotateNode=new Ht.Z,this._translateNode=new Ht.Z,this._planeNode=new Ht.Z,this._rotateInLocal=!0,this._translateInLocal=!0,this._showAngle=new Ht.Z,this._downCanvasCoord=s.K4.create(),this._hoverNode=null,this._keepHoverColor=s.vh.create(),this._isEditing=!1,this._editLineOrigin=s.R3.create(),this._editLineDirection=s.R3.create(),this._editOffset=s.R3.create(),this._editLocal=s._E.create(),this._editWorldTrans=s._E.create(),this._editWorldScaleRot=s._E.create(),this._editInvWorldScaleRot=s._E.create(),this._debugNode=new Kt.Z,this._lastDistToEye=0,this._attachedNode=null,this._pivotOffset=s.R3.create(),this.attachToNode(null),this._lsi=new Pr,this._origIntersect=s.R3.create(),this._dstIntersect=s.R3.create(),this._iv=new le.Z,this._iv.setIntersector(this._lsi),this.init()};Lr.NO_PICK=1,Lr.PICK_ARC_X=2,Lr.PICK_ARC_Y=4,Lr.PICK_ARC_Z=8,Lr.PICK_ARROW_X=16,Lr.PICK_ARROW_Y=32,Lr.PICK_ARROW_Z=64,Lr.PICK_PLANE_X=128,Lr.PICK_PLANE_Y=256,Lr.PICK_PLANE_Z=512,Lr.NO_FULL_CIRCLE=1024,Lr.CORRECT_PIVOT=2048,Lr.PICK_GIZMO=(Lr.PICK_ARC=Lr.PICK_ARC_X|Lr.PICK_ARC_Y|Lr.PICK_ARC_Z)|(Lr.PICK_ARROW=Lr.PICK_ARROW_X|Lr.PICK_ARROW_Y|Lr.PICK_ARROW_Z)|(Lr.PICK_PLANE=Lr.PICK_PLANE_X|Lr.PICK_PLANE_Y|Lr.PICK_PLANE_Z);var Or,Fr,Dr,Ur,Br,kr,Vr,Gr,jr,Wr,Hr=function(){q.Z.call(this,q.Z.TRAVERSE_PARENTS),this._editableNode=null};a.Z.createPrototypeObject(Hr,a.Z.objectInherit(q.Z.prototype,{reset:function(){q.Z.prototype.reset.call(this),this._editableNode=null},getEditableNode:function(){return this._editableNode},apply:function(t){if(!this._editableNode){var e=t.editMask;e&&e&Lr.PICK_GIZMO?this._editableNode=t:this.traverse(t)}}})),a.Z.createPrototypeNode(Lr,a.Z.objectInherit(Ht.Z.prototype,{setRotateInLocal:function(t){this._rotateInLocal=t},setTranslateInLocal:function(t){this._translateInLocal=t},setTraversalMask:function(t){this._tmask=t},setAutoMatrixTransformInsertion:function(t){this._autoInsertMT=t},setCorrectPivotOnAutoInsert:function(t){this._correctPivotOnAutoInsert=t},isEditing:function(){return this._isEditing},getAttachedNode:function(){return this._attachedNode},init:function(){this.getOrCreateStateSet().setAttributeAndModes(new $i.Z($i.Z.DISABLE)),this.getOrCreateStateSet().setAttributeAndModes(new Ji.Z(Ji.Z.DISABLE)),this.addUpdateCallback(this),this.addChild(this.initNodeTranslate()),this.addChild(this.initNodeTranslatePlane()),this.addChild(this.initNodeRotate()),this._debugNode&&(this._debugNode.addChild(Ir.createDebugLineGeometry()),this.addChild(this._debugNode),this._debugNode.setNodeMask(0));var t=this._viewer.getInputManager();t.group(Ne.Z.NODE_GIZMO).addMappings({onMouseMove:"mousemove",onMouseDown:"mousedown",onMouseUp:["mouseup","mouseout"]},this),t.setPriority(Ne.Z.NODE_GIZMO,t.getHigherPriority(Ne.Z.MANIPULATORS))},_insertEditNode:function(t,e){var i=new Ht.Z;return i.editMask=Lr.PICK_GIZMO,this._correctPivotOnAutoInsert&&(i.editMask|=Lr.CORRECT_PIVOT),t.addChild(i),t.removeChild(e),i.addChild(e),i._isInserted=!0,i},_findEditNodeFromNodePath:function(t){if(!t)return null;var e=t[t.length-1];if(e.editMask)return e;if(!this._autoInsertMT){for(var i=t.length-1;i>=0;--i){var r=t[i].editMask;if(r&&r&Lr.PICK_GIZMO)return t[i]}return null}var n=t[t.length-2];return n.editMask?n:this._insertEditNode(n,e)},_findEditNodeFromNode:function(t){if(!t)return null;if(t.editMask)return t;if(this._autoInsertMT){for(var e=t.getParents(),i=0;i<e.length;++i){var r=e[i].editMask;if(r&&r&Lr.PICK_GIZMO)return e[i]}return this._insertEditNode(e[0],t)}return this._getEditNodeVisitor?this._getEditNodeVisitor.reset():this._getEditNodeVisitor=new Hr,t.accept(this._getEditNodeVisitor),this._getEditNodeVisitor.getEditableNode()},attachToNodePath:function(t){var e=this._findEditNodeFromNodePath(t);this._attachEditNode(e,t&&t[t.length-1])},attachToNode:_attachEditNode:function(t,e){this._attachedNode=t,t&&e&&e!==t&&t.editMask&Lr.CORRECT_PIVOT&&s.R3.copy(this._pivotOffset,e.getBoundingSphere().center()),this.updateGizmoMask()},updateGizmoMask:function(){if(!this._attachedNode)return s.R3.init(this._pivotOffset),void this.setNodeMask(0);var t=this._attachedNode.editMask;this.setNodeMask(t&Lr.PICK_GIZMO?Lr.NO_PICK:0),this._translateNode.setNodeMask(t&Lr.PICK_ARROW?Lr.PICK_ARROW:0),this._rotateNode.setNodeMask(t&Lr.PICK_ARC?Lr.PICK_ARC:0),this._planeNode.setNodeMask(t&Lr.PICK_PLANE?Lr.PICK_PLANE:0);var e=this._translateNode.getChildren();e[0].setNodeMask(t&Lr.PICK_ARROW_X?Lr.PICK_ARROW_X:0),e[1].setNodeMask(t&Lr.PICK_ARROW_Y?Lr.PICK_ARROW_Y:0),e[2].setNodeMask(t&Lr.PICK_ARROW_Z?Lr.PICK_ARROW_Z:0);var i=this._rotateNode.getChildren();i[0].setNodeMask(t&Lr.NO_FULL_CIRCLE?0:Lr.NO_PICK),i[1].setNodeMask(t&Lr.PICK_ARC_X?Lr.PICK_ARC_X:0),i[2].setNodeMask(t&Lr.PICK_ARC_Y?Lr.PICK_ARC_Y:0),i[3].setNodeMask(t&Lr.PICK_ARC_Z?Lr.PICK_ARC_Z:0);var r=this._planeNode.getChildren();r[0].setNodeMask(t&Lr.PICK_PLANE_X?Lr.PICK_PLANE_X:0),r[1].setNodeMask(t&Lr.PICK_PLANE_Y?Lr.PICK_PLANE_Y:0),r[2].setNodeMask(t&Lr.PICK_PLANE_Z?Lr.PICK_PLANE_Z:0)},onNodeHovered:(Wr=s.vh.fromValues(1,1,0,1),function(t){if(this._hoverNode&&this._hoverNode.getStateSet().getUniform("uColor").setFloat4(this._keepHoverColor),t){for(var e=t._nodePath,i=e.length-1,r=e[i];void 0===r._nbAxis;){if(0===i)return;r=e[--i]}var n=r.getStateSet().getUniform("uColor");this._hoverNode=r,s.vh.copy(this._keepHoverColor,n.getInternalArray()),n.setFloat4(Wr)}else this._hoverNode=null}),initNodeRotate:function(){var t=Ir.createTorusGeometry(1,.01,6,64,2*Math.PI),e=Ir.createTorusGeometry(1,.01,6,64,Math.PI),i=Ir.createTorusGeometry(1,.1,6,64,Math.PI),r=new Ht.Z,n=new Ht.Z,a=new Ht.Z,o=new Ht.Z;n._nbAxis=0,a._nbAxis=1,o._nbAxis=2;var h=new Kt.Z;h.setCullCallback(new wr),h.addChild(i),t.setNodeMask(Lr.NO_PICK),e.setNodeMask(Lr.NO_PICK),n.setNodeMask(Lr.PICK_ARC_X),a.setNodeMask(Lr.PICK_ARC_Y),o.setNodeMask(Lr.PICK_ARC_Z),r.addChild(t),n.addChild(e),a.addChild(e),o.addChild(e),n.addChild(h),a.addChild(h),o.addChild(h),r.getOrCreateStateSet().addUniform(tr.Z.createFloat4(s.vh.fromValues(.2,.2,.2,1),"uColor")),n.getOrCreateStateSet().addUniform(tr.Z.createFloat4(s.vh.fromValues(1,0,0,1),"uColor")),a.getOrCreateStateSet().addUniform(tr.Z.createFloat4(s.vh.fromValues(0,1,0,1),"uColor")),o.getOrCreateStateSet().addUniform(tr.Z.createFloat4(s.vh.fromValues(0,0,1,1),"uColor"));var u=this._showAngle;u.getOrCreateStateSet().setAttributeAndModes(Nr),u.setNodeMask(0),u.getOrCreateStateSet().addUniform(tr.Z.createFloat3(s.R3.fromValues(1,0,0),"uBase")),u.getOrCreateStateSet().addUniform(tr.Z.createFloat(0,"uAngle")),u.addChild(Ir.createQuadCircleGeometry());var c=this._rotateNode;return c.setNodeMask(Lr.PICK_ARC),c.addChild(r),c.addChild(n),c.addChild(a),c.addChild(o),c.addChild(u),c},initNodeTranslate:function(){var t=1.5,e=1.3*1.1,i=new Ht.Z;s._E.fromTranslation(i.getMatrix(),s.R3.fromValues(0,0,1.65)),i.addChild(Ir.createCylinderGeometry(0,.07,.3,32,1,!0,!0));var r=new Ht.Z;s._E.fromTranslation(r.getMatrix(),s.R3.fromValues(0,0,.75)),r.addChild(Ir.createCylinderGeometry(.01,.01,t,32,1,!0,!0));var n=new Kt.Z;n.addChild(r),n.addChild(i);var a=Ir.createCylinderGeometry(.1,.1,e,32,1,!0,!0),o=new Ht.Z,h=new Ht.Z,u=new Ht.Z;o._nbAxis=0,h._nbAxis=1,u._nbAxis=2,s._E.fromRotation(o.getMatrix(),.5*Math.PI,s.R3.fromValues(0,1,0)),s._E.fromRotation(h.getMatrix(),.5*-Math.PI,s.R3.fromValues(1,0,0));var c=new Ht.Z;c.setCullCallback(new wr),s._E.fromTranslation(c.getMatrix(),s.R3.fromValues(0,0,1.215)),c.addChild(a),n.setNodeMask(Lr.NO_PICK),o.setNodeMask(Lr.PICK_ARROW_X),h.setNodeMask(Lr.PICK_ARROW_Y),u.setNodeMask(Lr.PICK_ARROW_Z),o.addChild(n),h.addChild(n),u.addChild(n),o.addChild(c),h.addChild(c),u.addChild(c),o.getOrCreateStateSet().addUniform(tr.Z.createFloat4(s.vh.fromValues(1,0,0,1),"uColor")),h.getOrCreateStateSet().addUniform(tr.Z.createFloat4(s.vh.fromValues(0,1,0,1),"uColor")),u.getOrCreateStateSet().addUniform(tr.Z.createFloat4(s.vh.fromValues(0,0,1,1),"uColor"));var l=this._translateNode;return l.setNodeMask(Lr.PICK_ARROW),l.addChild(o),l.addChild(h),l.addChild(u),l},initNodeTranslatePlane:function(){var t=new Ht.Z;s._E.fromTranslation(t.getMatrix(),s.R3.fromValues(.5,.5,0)),s._E.mul(t.getMatrix(),s._E.fromScaling(s._E.create(),s.R3.fromValues(.5,.5,1)),t.getMatrix()),t.addChild(Ir.createPlaneGeometry());var e=new Ht.Z,i=new Ht.Z,r=new Ht.Z;e._nbAxis=0,i._nbAxis=1,r._nbAxis=2,s._E.fromRotation(e.getMatrix(),.5*-Math.PI,s.R3.fromValues(0,1,0)),s._E.fromRotation(i.getMatrix(),.5*Math.PI,s.R3.fromValues(1,0,0)),e.setNodeMask(Lr.PICK_PLANE_X),i.setNodeMask(Lr.PICK_PLANE_Y),r.setNodeMask(Lr.PICK_PLANE_Z),e.addChild(t),i.addChild(t),r.addChild(t),e.getOrCreateStateSet().addUniform(tr.Z.createFloat4(s.vh.fromValues(1,0,0,.3),"uColor")),i.getOrCreateStateSet().addUniform(tr.Z.createFloat4(s.vh.fromValues(0,1,0,.3),"uColor")),r.getOrCreateStateSet().addUniform(tr.Z.createFloat4(s.vh.fromValues(0,0,1,.3),"uColor"));var n=this._planeNode;return n.setNodeMask(Lr.PICK_PLANE),n.getOrCreateStateSet().setAttributeAndModes(Nr),n.addChild(e),n.addChild(i),n.addChild(r),n},updateArcRotation:(Vr=s.gf.create(),Gr=s.gf.setAxisAngle(s.gf.create(),[0,1,0],.5*-Math.PI),jr=s.gf.setAxisAngle(s.gf.create(),[1,0,0],.5*-Math.PI),function(t){var e=this._rotateNode.getChildren();Vr[0]=-t[1],Vr[1]=t[0],Vr[2]=0,Vr[3]=1+t[2],s.gf.normalize(Vr,Vr),s._E.fromQuat(e[0].getMatrix(),Vr),s.gf.setAxisAngle(Vr,[1,0,0],Math.atan2(t[2],t[1])),s.gf.mul(Vr,Vr,Gr),s._E.fromQuat(e[1].getMatrix(),Vr),s.gf.setAxisAngle(Vr,[0,1,0],Math.atan2(-t[0],-t[2])),s.gf.mul(Vr,Vr,jr),s._E.fromQuat(e[2].getMatrix(),Vr),s.gf.setAxisAngle(Vr,[0,0,1],Math.atan2(-t[0],t[1])),s._E.fromQuat(e[3].getMatrix(),Vr),e[1].dirtyBound(),e[2].dirtyBound(),e[3].dirtyBound()}),getTransformType:function(t){for(var e=t;e.getParents().length>0;){var i=e.referenceFrame;if(void 0!==i&&i===Zt.Z.ABSOLUTE_RF)return Zt.Z.ABSOLUTE_RF;e=e.getParents()[0]}return Zt.Z.RELATIVE_RF},getAttachedNodeWorldMatrix:function(){var t=this._attachedNode.getWorldMatrix(void 0,Zr);return s._E.translate(t,t,this._pivotOffset)},update:(Dr=s.R3.create(),Ur=s.R3.create(),Br=s.R3.create(),kr=s._E.create(),function(){if(this._attachedNode){var t=this.getTransformType(this._attachedNode);this.setReferenceFrame(t),this.setCullingActive(t===Zt.Z.RELATIVE_RF);var e=this.getAttachedNodeWorldMatrix();s._E.getTranslation(Ur,e);var i=3;if(t===Zt.Z.ABSOLUTE_RF)Dr[0]=Dr[1]=Dr[2]=0;else{var r=this._viewer.getCamera().getProjectionMatrix(),n=.023*this._canvas.clientWidth*r[0];this._viewer.getManipulator().getEyePosition(Dr),this._lastDistToEye=this._isEditing?this._lastDistToEye:s.R3.distance(Ur,Dr),i*=this._lastDistToEye/n}var a=this.getMatrix();if(s._E.fromTranslation(a,Ur),s.R3.set(Br,i,i,i),s._E.mul(a,a,s._E.fromScaling(kr,Br)),s.R3.sub(Dr,Dr,Ur),s.R3.normalize(Dr,Dr),this._rotateInLocal||this._translateInLocal){s._E.getScale(Br,e);var o=s._E.fromScaling(kr,Br);s._E.invert(o,o);var h=s._E.mul(e,e,o);h[12]=h[13]=h[14]=0,this._translateInLocal&&(s._E.copy(this._translateNode.getMatrix(),h),s._E.copy(this._planeNode.getMatrix(),h)),this._rotateInLocal&&(s._E.copy(this._rotateNode.getMatrix(),h),s._E.invert(h,h),s.R3.transformMat4(Dr,Dr,h))}else s._E.identity(this._rotateNode.getMatrix());this.updateArcRotation(Dr),this._rotateNode.dirtyBound(),this._translateNode.dirtyBound(),this._planeNode.dirtyBound(),this._isEditing&&s._E.copy(this._showAngle.getMatrix(),this._hoverNode.getMatrix())}}),computeNearestIntersection:(Fr=function(t,e){return t._ratio-e._ratio},function(t,e){var i=this._viewer,r=this._canvas,n=t.canvasX*(i._canvasWidth/r.clientWidth),a=(r.clientHeight-t.canvasY)*(i._canvasHeight/r.clientHeight),s=this._viewer.computeIntersections(n,a,e);if(0!==s.length)return s.sort(Fr),s[0]}),setOnlyGizmoPicking:function(){this._viewer.getCamera().addChild(this),this._viewer.getSceneData().setNodeMask(0),this.setNodeMask(-1)},setOnlyScenePicking:function(){this._viewer.getCamera().removeChild(this),this._viewer.getSceneData().setNodeMask(-1),this.setNodeMask(Lr.NO_PICK)},pickGizmo:function(t,e){this.setOnlyGizmoPicking();var i=this.computeNearestIntersection(t,e);return this.setOnlyScenePicking(),i},getCanvasPositionFromWorldPoint:(Or=s._E.create(),function(t,e){var i=this._viewer.getCamera(),r=e;i.getViewport()?i.getViewport().computeWindowMatrix(Or):s._E.identity(Or),s._E.mul(Or,Or,i.getProjectionMatrix()),this.getReferenceFrame()===Zt.Z.RELATIVE_RF&&s._E.mul(Or,Or,i.getViewMatrix()),s.R3.transformMat4(r,t,Or);var n=this._viewer,a=this._canvas;return r[0]=r[0]/(n._canvasWidth/a.clientWidth),r[1]=a.clientHeight-r[1]/(n._canvasHeight/a.clientHeight),r}),onMouseDown:function(t){if(s.K4.set(this._downCanvasCoord,t.canvasX,t.canvasY),this._hoverNode&&this._attachedNode){this._viewer.setEnableManipulator(!1),this.saveEditMatrices();var e=this._hoverNode.getParents()[0].getNodeMask();this._isEditing=!0,e&Lr.PICK_ARC?(this._translateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startRotateEdit(t)):e&Lr.PICK_ARROW?(this._rotateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startTranslateEdit(t)):e&Lr.PICK_PLANE&&(this._rotateNode.setNodeMask(0),this._translateNode.setNodeMask(0),this.startPlaneEdit(t))}},saveEditMatrices:function(){s._E.copy(this._editLocal,this._attachedNode.getMatrix());var t=this.getAttachedNodeWorldMatrix();s._E.fromTranslation(this._editWorldTrans,s.R3.fromValues(t[12],t[13],t[14])),s._E.copy(this._editWorldScaleRot,t),this._editWorldScaleRot[12]=this._editWorldScaleRot[13]=this._editWorldScaleRot[14]=0,s._E.invert(this._editInvWorldScaleRot,this._editWorldScaleRot)},startRotateEdit:function(t){var e=this._rotateNode.getWorldMatrix(void 0,Zr),i=s.R3.create();s.R3.transformMat4(i,i,e),this.getCanvasPositionFromWorldPoint(i,i);var r=this.pickGizmo(t,this._hoverNode.getNodeMask()|Lr.PICK_ARC);if(r){var n=0===this._hoverNode._nbAxis?-1:1,a=s.R3.create();a[0]=n*r._localIntersectionPoint[1],a[1]=-n*r._localIntersectionPoint[0],a[2]=r._localIntersectionPoint[2];var o=s.R3.create();s.R3.transformMat4(o,a,this._hoverNode.getMatrix()),s.R3.transformMat4(o,o,e),this.getCanvasPositionFromWorldPoint(o,o);var h=this._editLineDirection;s.K4.sub(h,o,i),s.K4.normalize(h,h),this._showAngle.setNodeMask(Lr.NO_PICK),r._localIntersectionPoint[2]=0;var u=this._showAngle.getStateSet();u.getUniform("uAngle").setFloat(0),u.getUniform("uBase").setVec3(s.R3.normalize(r._localIntersectionPoint,r._localIntersectionPoint)),this._editLineOrigin[0]=t.canvasX,this._editLineOrigin[1]=t.canvasY}},startTranslateEdit:function(t){var e=this._editLineOrigin,i=this._editLineDirection,r=this._translateNode.getWorldMatrix(void 0,Zr);s._E.getTranslation(e,r),s.R3.init(i),i[this._hoverNode._nbAxis]=1,this._translateInLocal&&(s.R3.transformMat4(i,i,this._editWorldScaleRot),s.R3.normalize(i,i)),s.R3.add(i,e,i),this.getCanvasPositionFromWorldPoint(e,e),this.getCanvasPositionFromWorldPoint(i,i),s.K4.sub(i,i,e),s.K4.normalize(i,i);var n=this._editOffset;s.K4.set(n,t.canvasX,t.canvasY),s.K4.sub(n,n,e)},startPlaneEdit:function(t){var e=this._editLineOrigin,i=this._planeNode.getWorldMatrix(void 0,Zr);s._E.getTranslation(e,i),this.getCanvasPositionFromWorldPoint(e,e);var r=this._editOffset;s.K4.set(r,t.canvasX,t.canvasY),s.K4.sub(r,r,e)},drawLineCanvasDebug:function(t,e,i,r){this._debugNode.setNodeMask(Lr.NO_PICK);var n=this._debugNode.getChildren()[0].getAttributes().Vertex;n.getElements()[0]=t/this._canvas.clientWidth*2-1,n.getElements()[1]=(this._canvas.clientHeight-e)/this._canvas.clientHeight*2-1,n.getElements()[2]=i/this._canvas.clientWidth*2-1,n.getElements()[3]=(this._canvas.clientHeight-r)/this._canvas.clientHeight*2-1,n.dirty()},pickAndSelect:function(t){this.setNodeMask(0);var e=this.computeNearestIntersection(t,this._tmask);this.attachToNodePath(e?e._nodePath:e)},onMouseUp:function(t){this._viewer.setEnableManipulator(!0),this._debugNode&&this._debugNode.setNodeMask(0);var e=s.K4.fromValues(t.canvasX,t.canvasY);0===s.K4.distance(e,this._downCanvasCoord)&&this.pickAndSelect(t),this._showAngle.setNodeMask(0),this._isEditing=!1,this._hoverNode&&this.updateGizmoMask()},onMouseMove:function(t){if(this._attachedNode){var e;if(!1===this._isEditing)return e=this.pickGizmo(t,Lr.PICK_GIZMO),void this.onNodeHovered(e);if(this._hoverNode){var i=this._hoverNode.getParents()[0];i===this._rotateNode?this.updateRotateEdit(t):i===this._translateNode?this.updateTranslateEdit(t):i===this._planeNode&&this.updatePlaneEdit(t)}}},updateRotateEdit:function(){var t=s._E.create(),e=s.K4.create(),i=s.R3.fromValues(1,0,0),r=s.R3.fromValues(0,1,0),n=s.R3.fromValues(0,0,1),a=s.R3.create();return function(o){var h=this._editLineOrigin,u=this._editLineDirection;s.K4.set(e,o.canvasX,o.canvasY),s.K4.sub(e,e,h);var c=s.K4.dot(e,u);if(this._debugNode){var l=h[0],_=h[1];this.drawLineCanvasDebug(l,_,l+u[0]*c,_+u[1]*c)}var d=7*c/Math.min(this._canvas.clientWidth,this._canvas.clientHeight);d%=2*Math.PI;var f=this._hoverNode._nbAxis;0===f?s._E.fromRotation(t,-d,i):1===f?s._E.fromRotation(t,-d,r):2===f&&s._E.fromRotation(t,-d,n),this._showAngle.getOrCreateStateSet().getUniform("uAngle").setFloat(0===f?-d:d),this._rotateInLocal||(s._E.mul(t,this._editInvWorldScaleRot,t),s._E.mul(t,t,this._editWorldScaleRot));var p=this._attachedNode.getMatrix();s._E.translate(p,this._editLocal,this._pivotOffset),s._E.mul(p,p,t),s._E.translate(p,p,s.R3.negate(a,this._pivotOffset)),this._attachedNode.dirtyBound()}}(),updateTranslateEdit:function(){var t=s.K4.create(),e=s.R3.create();return function(i){var r=this._editLineOrigin,n=this._editLineDirection;s.K4.set(t,i.canvasX,i.canvasY),s.K4.sub(t,t,r),s.K4.sub(t,t,this._editOffset);var a=s.K4.dot(t,n);t[0]=r[0]+n[0]*a,t[1]=r[1]+n[1]*a,this._debugNode&&this.drawLineCanvasDebug(r[0],r[1],t[0],t[1]);var o=this._viewer,h=this._canvas,u=t[0]*(o._canvasWidth/h.clientWidth),c=(h.clientHeight-t[1])*(o._canvasHeight/h.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!1),this._lsi.set(s.R3.set(this._origIntersect,u,c,0),s.R3.set(this._dstIntersect,u,c,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),s._E.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){s._E.getScale(e,this._editInvWorldScaleRot);var l=this._lsi.getTranslateDistance();s.R3.mul(e,e,l)}else s.R3.transformMat4(e,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);s._E.translate(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}(),updatePlaneEdit:function(){var t=s.K4.create(),e=s.R3.create();return function(i){s.K4.set(t,i.canvasX,i.canvasY),s.K4.sub(t,t,this._editOffset);var r=this._viewer,n=this._canvas,a=t[0]*(r._canvasWidth/n.clientWidth),o=(n.clientHeight-t[1])*(r._canvasHeight/n.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!0),this._lsi.set(s.R3.set(this._origIntersect,a,o,0),s.R3.set(this._dstIntersect,a,o,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),s._E.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){s._E.getScale(e,this._editInvWorldScaleRot);var h=this._lsi.getTranslateDistance();s.R3.mul(e,e,h)}else s.R3.transformMat4(e,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);s._E.translate(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}()}),"osgUtil","NodeGizmo");const zr=Lr;var qr,Xr,Kr,Yr=function(){ge.Z.Intersection.call(this),this._localIntersectionNormal=s.R3.clone(s.R3.ONE),this._i1=-1,this._i2=-1,this._i3=-1,this._r1=0,this._r2=0,this._r3=0},Qr=function(){ge.Z.apply(this),this._center=void 0,this._radius=0};a.Z.createPrototypeObject(Qr,a.Z.objectInherit(ge.Z.prototype,{set:function(t,e){this._center=t,this._radius=e},enter:function(t){for(var e=this._radius*this._radius,i=0,r=t.getMin(),n=t.getMax(),a=0,s=0;s<3;s++)this._center[s]<r[s]?i+=(a=this._center[s]-r[s])*a:this._center[s]>n[s]&&(i+=(a=this._center[s]-n[s])*a);return i<=e},intersectPoint:function(t,e){var i=s.R3.sqrDist(t,this._center);if(!(i>this._radius*this._radius)){var r=this.initIntersection(new Yr);r._i1=e,r._r1=1,s.R3.copy(r._localIntersectionPoint,t),r._ratio=Math.sqrt(i)/this._radius}},intersectLine:function(){var t=s.R3.create(),e=s.R3.create();return function(i,r,n,a){s.R3.sub(t,this._center,i),s.R3.sub(e,r,i);var o=s.R3.dot(t,e)/s.R3.sqrLen(e),h=1;if(!((h=o<0?s.R3.sqrLen(t):o>1?s.R3.sqrDist(this._center,r):s.R3.sqrLen(s.R3.scaleAndAdd(t,t,e,-o)))>this._radius*this._radius)){var u=this.initIntersection(new Yr);u._i1=n,u._i2=a,u._r1=1-o,u._r2=o,s.R3.scaleAndAdd(u._localIntersectionPoint,i,e,o),u._ratio=Math.sqrt(h)/this._radius}}}(),intersectTriangle:(qr=s.R3.create(),Xr=s.R3.create(),Kr=s.R3.create(),function(t,e,i,r,n,a){if(!this._limitOneIntersection||!this._hit){s.R3.sub(qr,e,t),s.R3.sub(Xr,i,t);var o=s.R3.sqrLen(qr),h=s.R3.dot(qr,Xr),u=s.R3.sqrLen(Xr);s.R3.sub(Kr,t,this._center);var c=s.R3.dot(Kr,qr),l=s.R3.dot(Kr,Xr),_=s.R3.sqrLen(Kr),d=Math.abs(o*u-h*h);if(!(d<1e-10)){var f,p,g,m,v,b=h*l-u*c,S=h*c-o*l,y=4;if(b+S<=d)if(b<0)S<0?(y=4,c<0?(S=0,-c>=o?(b=1,f=o+2*c+_):f=c*(b=-c/o)+_):(b=0,l>=0?(S=0,f=_):-l>=u?(S=1,f=u+2*l+_):f=l*(S=-l/u)+_)):(y=3,b=0,l>=0?(S=0,f=_):-l>=u?(S=1,f=u+2*l+_):f=l*(S=-l/u)+_);else if(S<0)y=5,S=0,c>=0?(b=0,f=_):-c>=o?(b=1,f=o+2*c+_):f=c*(b=-c/o)+_;else{y=0;var T=1/d;f=(b*=T)*(o*b+h*(S*=T)+2*c)+S*(h*b+u*S+2*l)+_}else b<0?(y=2,(g=u+l)>(p=h+c)?(m=g-p)>=(v=o-2*h+u)?(b=1,S=0,f=o+2*c+_):f=(b=m/v)*(o*b+h*(S=1-b)+2*c)+S*(h*b+u*S+2*l)+_:(b=0,g<=0?(S=1,f=u+2*l+_):l>=0?(S=0,f=_):f=l*(S=-l/u)+_)):S<0?(y=6,(g=o+c)>(p=h+l)?(m=g-p)>=(v=o-2*h+u)?(S=1,b=0,f=u+2*l+_):f=(b=1-(S=m/v))*(o*b+h*S+2*c)+S*(h*b+u*S+2*l)+_:(S=0,g<=0?(b=1,f=o+2*c+_):c>=0?(b=0,f=_):f=c*(b=-c/o)+_)):(y=1,(m=u+l-h-c)<=0?(b=0,S=1,f=u+2*l+_):m>=(v=o-2*h+u)?(b=1,S=0,f=o+2*c+_):f=(b=m/v)*(o*b+h*(S=1-b)+2*c)+S*(h*b+u*S+2*l)+_);if(!(f>this._radius*this._radius)){var x=s.R3.create(),E=this.initIntersection(new Yr);E._i1=r,E._i2=n,E._i3=a,E._r1=1-b-S,E._r2=b,E._r3=S;var R=E._localIntersectionPoint;s.R3.scaleAndAdd(R,s.R3.scaleAndAdd(R,t,qr,b),Xr,S),s.R3.cross(E._localIntersectionNormal,qr,Xr),s.R3.normalize(x,E._localIntersectionNormal),E._ratio=Math.sqrt(f)/this._radius,E._zone=y}}}})}),"osgUtil","SphereIntersectFunctor");const Jr=Qr;var $r=function(){pe.Z.call(this),this._center=s.R3.create(),this._iCenter=s.R3.create(),this._radius=1,this._iRadius=1};a.Z.createPrototypeObject($r,a.Z.objectInherit(pe.Z.prototype,{set:function(t,e){s.R3.copy(this._center,t),s.R3.copy(this._iCenter,t),this._radius=this._iRadius=e,this.reset()},setCenter:function(t){s.R3.copy(this._center,t),s.R3.copy(this._iCenter,t)},setRadius:intersectNode:function(t){return this.intersectBoundingSphere(t.getBoundingSphere())},intersectBoundingSphere:function(t){if(!t.valid())return!1;var e=this._iRadius+t.radius();return s.R3.sqrDist(t.center(),this._iCenter)<=e*e},intersect:function(){var t=new Jr;return function(e,i){t.setGeometry(i),t.setIntersectionVisitor(e),t.setIntersector(this),t.set(this._iCenter,this._iRadius);var r=i.getShape();r?r.intersect(t,r.getNodes()[0]):(i.computeTransformedVertices&&t.setVertices(i.computeTransformedVertices()),t.apply(i)),t.reset()}}(),setCurrentTransformation:function(){var t=s.R3.create();return function(e){s._E.invert(e,e),s.R3.transformMat4(this._iCenter,this._center,e),s._E.getScale(t,e);var i=t[0],r=t[1],n=t[2],a=i>r?i>n?i:n:r>n?r:n;this._iRadius=this._radius*a}}()}),"osgUtil","SphereIntersector");const tn=$r;var en=function(){q.Z.call(this),this._T=void 0,this._B=void 0,this._N=void 0,this._texCoordUnit=0};a.Z.createPrototypeObject(en,a.Z.objectInherit(q.Z.prototype,{apply:function(t){t.getTypeID()===Dt.Z.getTypeID()?this.generate(t,this._texCoordUnit):this.traverse(t)},setTexCoordUnit:function(t){this._texCoordUnit=t},computePrimitiveSet:function(t,e){if(e.getIndices){var i,r=e.getNumIndices(),n=t.getAttributes().Vertex,a=t.getAttributes().Normal,s=t.getAttributes()["TexCoord"+this._texCoordUnit];if(e.getMode()===dr.Z.TRIANGLES)for(i=0;i<r;i+=3)this.compute(e,n,a,s,i,i+1,i+2);else if(e.getMode()===dr.Z.TRIANGLE_STRIP)for(i=0;i<r-2;++i)i%2==0?this.compute(e,n,a,s,i,i+1,i+2):this.compute(e,n,a,s,i+1,i,i+2)}},generate:function(t,e){if(this._texCoordUnit=e,void 0===this._texCoordUnit&&(this._texCoordUnit=0),t.getAttributes()["TexCoord"+this._texCoordUnit]){var i=t.getAttributes().Vertex.getElements().length;this._T=new a.Z.Float32Array(i),this._B=new a.Z.Float32Array(i),this._N=new a.Z.Float32Array(i),t.getPrimitiveSetList().forEach((,this);for(var r=i/3,n=new a.Z.Float32Array(4*r),o=s.R3.create(),h=s.R3.create(),u=s.R3.create(),c=0;c<r;c++){var l=this._T.subarray(3*c,3*c+3),_=this._N.subarray(3*c,3*c+3),d=this._B.subarray(3*c,3*c+3);s.R3.normalize(_,_);var f=s.R3.dot(_,l);s.R3.scale(h,_,f),s.R3.sub(o,l,h),s.R3.normalize(u,o),s.R3.cross(o,_,l);var p=s.R3.dot(o,d);p=p<0?-1:0,n[4*c]=u[0],n[4*c+1]=u[1],n[4*c+2]=u[2],n[4*c+3]=p}t.getAttributes().Normal.setElements(this._N),t.getAttributes().Tangent=new Y.Z("ARRAY_BUFFER",n,4)}},compute:function(t,e,i,r,n,a,o){var h,u,c=t.index(n),l=t.index(a),_=t.index(o),d=e.getElements().subarray(3*c,3*c+3),f=e.getElements().subarray(3*l,3*l+3),p=e.getElements().subarray(3*_,3*_+3),g=i.getElements().subarray(3*c,3*c+3),m=i.getElements().subarray(3*l,3*l+3),v=i.getElements().subarray(3*_,3*_+3),b=r.getElements().subarray(2*c,2*c+2),S=r.getElements().subarray(2*l,2*l+2),y=r.getElements().subarray(2*_,2*_+2),T=s.R3.create(),x=s.R3.create(),E=s.R3.create(),R=s.R3.create(),A=s.R3.create(),C=s.R3.create(),M=s.R3.create(),I=s.R3.create(),w=s.R3.create();s.R3.set(I,f[0]-d[0],S[0]-b[0],S[1]-b[1]),s.R3.set(w,p[0]-d[0],y[0]-b[0],y[1]-b[1]),s.R3.cross(T,I,w),0!==T[0]&&(s.R3.normalize(T,T),u=-T[1]/T[0],h=-T[2]/T[0],A[0]+=u,x[0]+=h,C[0]+=u,E[0]+=h,M[0]+=u,R[0]+=h),s.R3.set(I,f[1]-d[1],S[0]-b[0],S[1]-b[1]),s.R3.set(w,p[1]-d[1],y[0]-b[0],y[1]-b[1]),s.R3.cross(T,I,w),0!==T[0]&&(s.R3.normalize(T,T),u=-T[1]/T[0],h=-T[2]/T[0],A[1]+=u,x[1]+=h,C[1]+=u,E[1]+=h,M[1]+=u,R[1]+=h),s.R3.set(I,f[2]-d[2],S[0]-b[0],S[1]-b[1]),s.R3.set(w,p[2]-d[2],y[0]-b[0],y[1]-b[1]),s.R3.cross(T,I,w),0!==T[0]&&(s.R3.normalize(T,T),u=-T[1]/T[0],h=-T[2]/T[0],A[2]+=u,x[2]+=h,C[2]+=u,E[2]+=h,M[2]+=u,R[2]+=h);var N,P,Z,L=s.R3.create(),O=s.R3.create();s.R3.cross(L,g,A),s.R3.cross(O,L,g),N=this._T.subarray(3*c,3*c+3),s.R3.add(N,O,N),s.R3.cross(L,x,g),s.R3.cross(O,g,L),P=this._B.subarray(3*c,3*c+3),s.R3.add(P,O,P),s.R3.cross(L,m,C),s.R3.cross(O,L,m),N=this._T.subarray(3*l,3*l+3),s.R3.add(N,O,N),s.R3.cross(L,E,m),s.R3.cross(O,m,L),P=this._B.subarray(3*l,3*l+3),s.R3.add(P,O,P),s.R3.cross(L,v,M),s.R3.cross(O,L,v),N=this._T.subarray(3*_,3*_+3),s.R3.add(N,O,N),s.R3.cross(L,R,v),s.R3.cross(O,v,L),P=this._B.subarray(3*_,3*_+3),s.R3.add(P,O,P),Z=this._N.subarray(3*c,3*c+3),s.R3.add(Z,g,Z),Z=this._N.subarray(3*l,3*l+3),s.R3.add(Z,m,Z),Z=this._N.subarray(3*_,3*_+3),s.R3.add(Z,v,Z)}}),"osgUtil","TangentSpaceGenerator");const rn=en;var nn=i("6RPJ"),an=i("BvLe"),sn={},on=on.prototype={update:function(){var t=this._canvas,e=t.width,i=t.height;if(e!==this._width||i!==this._height){this._root.removeChildren();var r=this._hmdConfig;r&&r.isCardboard&&(r.hResolution=e,r.vResolution=i),this._width=e,this._height=i,sn.createScene(this._viewer,this._rttScene,r,this._root)}return!0}};var hn=function(t,e){this._rootView=t,this._offsetView=e};hn.prototype={update:function(t){var e=t.getViewMatrix();return s._E.mul(e,this._offsetView,this._rootView),!0}};var un=function(t){var e=new qt.Z;return e.setTextureSize(t[0],t[1]),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},cn=function(t,e,i,r,n,a){var o=new ir.Z,h=e[0],u=e[1],c=i[0],l=i[1];!0===r?t?o.setViewport(new nr.Z(0,0,c/2,l)):o.setViewport(new nr.Z(c/2,0,c/2,l)):t?o.setViewport(new nr.Z(.5*c-h,.5*(l-u),h,u)):o.setViewport(new nr.Z(.5*c,.5*(l-u),h,u)),s._E.ortho(o.getProjectionMatrix(),-.5,.5,-.5,.5,-5,5),o.setRenderOrder(ir.Z.NESTED_RENDER,0),o.setReferenceFrame(nn.Z.ABSOLUTE_RF);var _,d=o.getOrCreateStateSet();return d.setTextureAttributeAndModes(0,n),d.setAttributeAndModes((_=["uniform vec2 uScale;","uniform vec2 uScaleIn;","uniform vec2 uLensCenter;","uniform vec4 uHmdWarpParam;","uniform vec4 uChromAbParam;","uniform sampler2D Texture0;","varying vec2 vTexCoord0;","void main(void) {","  vec2 uv = (vTexCoord0 * 2.0) - 1.0;","  vec2 theta = (uv - uLensCenter) * uScaleIn;","  float rSq = theta.x * theta.x + theta.y * theta.y;","  vec2 rvector = theta * (uHmdWarpParam.x + uHmdWarpParam.y * rSq + uHmdWarpParam.z * rSq * rSq + uHmdWarpParam.w * rSq * rSq * rSq);","  vec2 rBlue = rvector * (uChromAbParam.z + uChromAbParam.w * rSq);","  vec2 tcBlue = (uLensCenter + uScale * rBlue);","  tcBlue = (tcBlue + 1.0) * 0.5;","  if (any(bvec2(clamp(tcBlue, vec2(0.0, 0.0), vec2(1.0, 1.0)) - tcBlue))) {","    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","    return;","  }","  vec2 tcGreen = uLensCenter + uScale * rvector;","  tcGreen = (tcGreen + 1.0) * 0.5;","  vec2 rRed = rvector * (uChromAbParam.x + uChromAbParam.y * rSq);","  vec2 tcRed = uLensCenter + uScale * rRed;","  tcRed = (tcRed + 1.0) * 0.5;","  gl_FragColor = vec4(texture2D(Texture0, tcRed).r, texture2D(Texture0, tcGreen).g, texture2D(Texture0, tcBlue).b, 1);","}",""].join("\n"),new ar.Z(new sr.Z(sr.Z.VERTEX_SHADER,["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","  vTexCoord0 = Vertex.xy;","}","","#define SHADER_NAME VRpostProcessing",""].join("\n")),new sr.Z(sr.Z.FRAGMENT_SHADER,_)))),d.addUniform(tr.Z.createFloat2(a.scale,"uScale")),d.addUniform(tr.Z.createFloat2(a.scaleIn,"uScaleIn")),d.addUniform(tr.Z.createFloat2(t?a.lensCenterLeft:a.lensCenterRight,"uLensCenter")),d.addUniform(tr.Z.createFloat4(a.hmdWarpParam,"uHmdWarpParam")),d.addUniform(tr.Z.createFloat4(a.chromAbParam,"uChromAbParam")),o},ln=function(t,e){var i=new ir.Z;return i.setName("rtt camera"),i.setViewport(new nr.Z(0,0,t.getWidth(),t.getHeight())),i.setProjectionMatrix(e),i.setClearColor(s.vh.fromValues(.3,.3,.3,0)),i.setRenderOrder(ir.Z.POST_RENDER,0),i.attachTexture(rr.Z.COLOR_ATTACHMENT0,t),i.attachRenderBuffer(rr.Z.DEPTH_ATTACHMENT,an.Z.instance().isWebGL2()?rr.Z.DEPTH_COMPONENT24:rr.Z.DEPTH_COMPONENT16),i.setReferenceFrame(nn.Z.ABSOLUTE_RF),i};sn.createScene=function(t,e,i,r,n){var a=sn.getDefaultConfig(i),o=s.K4.fromValues(.5*a.hResolution,a.vResolution),h=s.K4.fromValues(.5*a.hResolution,a.vResolution),u=t.getCamera().getViewport(),c=s.K4.fromValues(u.width(),u.height()),l=t.getGraphicContext().canvas;a.isCardboard&&(c[0]=l.width,c[1]=l.height);var _={},d={};!function(t,e,i,r){var n=e.hResolution/(2*e.vResolution),a=-1-4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,o=e.distortionK[0]+e.distortionK[1]*Math.pow(a,2)+e.distortionK[2]*Math.pow(a,4)+e.distortionK[3]*Math.pow(a,6),h=180/Math.PI*2*Math.atan2(e.vScreenSize*o,2*e.eyeToScreenDistance),u=s._E.perspective(s._E.create(),Math.PI/180*h,n,.3,1e4),c=4*(.25*e.hScreenSize-.5*e.interpupillaryDistance)/e.hScreenSize,l=4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,_=s._E.create(),d=s._E.create();r.projectionLeft=s._E.mul(_,s._E.fromTranslation(_,s.R3.fromValues(c,0,0)),u),r.projectionRight=s._E.mul(d,s._E.fromTranslation(d,s.R3.fromValues(-c,0,0)),u),r.viewLeft=s._E.fromTranslation(s._E.create(),s.R3.fromValues(t*e.interpupillaryDistance*.5,0,0)),r.viewRight=s._E.fromTranslation(s._E.create(),s.R3.fromValues(-t*e.interpupillaryDistance*.5,0,0)),i.lensCenterLeft=s.K4.fromValues(l,0),i.lensCenterRight=s.K4.fromValues(-l,0),i.hmdWarpParam=e.distortionK,i.chromAbParam=e.chromaAbParameter,i.scaleIn=s.K4.fromValues(1,1/n),i.scale=s.K4.fromValues(1/o,1*n/o)}(void 0!==n?n:1,a,_,d);var f=t.getCamera().getViewMatrix(),p=r||new Kt.Z;p.addUpdateCallback(new on(t,e,i,p,l));var g=un(o),m=ln(g,d.projectionLeft),v=cn(!0,h,c,a.isCardboard,g,_);m.addUpdateCallback(new hn(f,d.viewLeft));var b=un(o),S=ln(b,d.projectionRight),y=cn(!1,h,c,a.isCardboard,b,_);return S.addUpdateCallback(new hn(f,d.viewRight)),m.addChild(e),S.addChild(e),v.addChild(zt.Z.createTexturedFullScreenFakeQuadGeometry()),y.addChild(zt.Z.createTexturedFullScreenFakeQuadGeometry()),p.addChild(m),p.addChild(S),p.addChild(v),p.addChild(y),p},sn.getDefaultConfig=function(t){var e={hResolution:1920,vResolution:1080,hScreenSize:.1296,vScreenSize:.0729,interpupillaryDistance:.064,lensSeparationDistance:.0635,eyeToScreenDistance:.04,distortionK:s.vh.fromValues(1,.22,.13,.02),chromaAbParameter:s.vh.fromValues(.996,-.004,1.014,0),isCardboard:!1};return 2===t||void 0===t?e:1===t?(e.hResolution=1280,e.vResolution=800,e.hScreenSize=.14976,e.vScreenSize=.0936,e.lensSeparationDistance=.064,e.eyeToScreenDistance=.041,e.distortionK=s.vh.fromValues(1,.22,.24,0),e):(void 0!==t.hResolution&&(e.hResolution=t.hResolution),void 0!==t.vResolution&&(e.vResolution=t.vResolution),void 0!==t.hScreenSize&&(e.hScreenSize=t.hScreenSize),void 0!==t.vScreenSize&&(e.vScreenSize=t.vScreenSize),void 0!==t.interpupillaryDistance&&(e.interpupillaryDistance=t.interpupillaryDistance),void 0!==t.lensSeparationDistance&&(e.lensSeparationDistance=t.lensSeparationDistance),void 0!==t.eyeToScreenDistance&&(e.eyeToScreenDistance=t.eyeToScreenDistance),void 0!==t.distortionK&&(e.distortionK=t.distortionK),void 0!==t.chromaAbParameter&&(e.chromaAbParameter=t.chromaAbParameter),void 0!==t.isCardboard&&(e.isCardboard=t.isCardboard),e)};const _n=sn;var dn=function(t,e){this._rootView=t,this._offsetView=e};dn.prototype={update:function(t){var e=t.getViewMatrix();return s._E.mul(e,this._offsetView,this._rootView),!0}};var fn=function(t){var e=new qt.Z;return e.setTextureSize(t.width,t.height),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},pn=function(t,e,i){var r=new ir.Z;r.setViewport(i),r.setRenderOrder(ir.Z.NESTED_RENDER,0),r.setReferenceFrame(nn.Z.ABSOLUTE_RF),s._E.ortho(r.getProjectionMatrix(),0,1,0,1,-5,5);var n,a=r.getOrCreateStateSet();return a.addUniform(tr.Z.createInt(0,"TextureLeft")),a.addUniform(tr.Z.createInt(1,"TextureRight")),a.setTextureAttributeAndModes(0,t),a.setTextureAttributeAndModes(1,e),a.setAttributeAndModes((n=["varying vec2 vTexCoord0;","uniform sampler2D TextureLeft;","uniform sampler2D TextureRight;","void main() {","   if (vTexCoord0.x < 0.5)","       gl_FragColor = texture2D(TextureLeft, vec2(vTexCoord0.x * 2.0, vTexCoord0.y));","   else","       gl_FragColor = texture2D(TextureRight, vec2(vTexCoord0.x * 2.0 - 1.0, vTexCoord0.y));","}"].join("\n"),new ar.Z(new sr.Z(sr.Z.VERTEX_SHADER,["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","  vTexCoord0 = Vertex.xy;","}","","#define SHADER_NAME VRpostProcessing",""].join("\n")),new sr.Z(sr.Z.FRAGMENT_SHADER,n)))),r.addChild(zt.Z.createTexturedFullScreenFakeQuadGeometry()),r},gn=function(t,e){var i=new ir.Z;return i.setName("rtt camera"),i.setViewport(new nr.Z(0,0,t.getWidth(),t.getHeight())),i.setProjectionMatrix(e),i.setClearColor(s.vh.fromValues(.3,.3,.3,0)),i.setRenderOrder(ir.Z.POST_RENDER,0),i.attachTexture(rr.Z.COLOR_ATTACHMENT0,t),i.attachRenderBuffer(rr.Z.DEPTH_ATTACHMENT,rr.Z.DEPTH_COMPONENT16),i.setReferenceFrame(nn.Z.ABSOLUTE_RF),i},mn={createScene:function(t,e,i,r,n){var a=r||new Kt.Z;return i.requestAnimationFrame((function(){var r=void 0!==n?n:1,o=i.getEyeParameters("left"),h=i.getEyeParameters("right"),u=new window.VRFrameData;i.getFrameData(u);var c=s._E.fromTranslation(s._E.create(),s.R3.fromValues(-r*o.offset[0],o.offset[1],o.offset[2])),l=s._E.fromTranslation(s._E.create(),s.R3.fromValues(-r*h.offset[0],h.offset[1],h.offset[2])),_={width:Math.max(o.renderWidth,h.renderWidth),height:Math.max(o.renderHeight,h.renderHeight)},d=fn(_),f=fn(_),p=gn(d,u.leftProjectionMatrix),g=gn(f,u.rightProjectionMatrix),m=t.getCamera().getViewMatrix();p.addUpdateCallback(new dn(m,c)),g.addUpdateCallback(new dn(m,l));var v=pn(d,f,t.getCamera().getViewport());p.addChild(e),g.addChild(e),a.addChild(p),a.addChild(g),a.addChild(v)})),a}};const vn=mn;var bn={};bn.ComposerPostProcess=ur,a.Z.objectMix(bn,lr),bn.DelayInterpolator=Ve,bn.DisplayNormalVisitor=gr,bn.DisplayGeometryVisitor=br,bn.DisplayGraph=xr.Z,bn.IntersectFunctor=ge.Z,bn.Intersector=pe.Z,bn.IntersectionVisitor=le.Z,bn.LineSegmentIntersector=_e.Z,bn.LineSegmentIntersectFunctor=Er.Z,bn.NodeGizmo=zr,bn.GizmoGeometry=Ir,bn.WebVRCustom=_n,bn.PolytopeIntersector=xe,bn.PolytopeIntersectFunctor=be,bn.SphereIntersector=tn,bn.TangentSpaceGenerator=rn,bn.WebVR=vn,bn.NO_LIMIT=di.Z.NO_LIMIT,bn.LIMIT_ONE_PER_DRAWABLE=di.Z.LIMIT_ONE_PER_DRAWABLE,bn.LIMIT_ONE=di.Z.LIMIT_ONE,bn.POINT_PRIMITIVES=di.Z.POINT_PRIMITIVES,bn.LINE_PRIMITIVES=di.Z.LINE_PRIMITIVES,bn.TRIANGLE_PRIMITIVES=di.Z.TRIANGLE_PRIMITIVES,bn.ALL_PRIMITIVES=di.Z.ALL_PRIMITIVES;const Sn=bn;var yn=i("Pxgm"),Tn=i("OP54"),xn=i("bYH/"),En=i("6qT5"),Rn=i("cnke"),An=i("Qp64"),Cn=i("/CZr"),Mn=i("ojCs"),In=i("F5Ms"),wn=function(){var t=function(t){window.console&&window.console.error?window.console.error(t):t)},e={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},i=null,r=null;function n(t){if(null==i)for(var e in i={},r={},t)"number"==typeof t[e]&&(i[t[e]]=e,r[e]=t[e])}function a(){if(null==i)throw"WebGLDebugUtils.init(ctx) not called"}function s(t){a();var e=i[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function o(t,i,n,a){var o;if(void 0!==(o=e[t])&&(void 0!==(o=o[i])&&o[n])){if("object"==typeof o[n]&&void 0!==o[n].enumBitwiseOr){for(var h=o[n].enumBitwiseOr,u=0,c=[],l=0;l<h.length;++l){var _=r[h[l]];0!=(a&_)&&(u|=_,c.push(s(_)))}return u===a?c.join(" | "):s(a)}return s(a)}return null===a?"null":void 0===a?"undefined":a.toString()}function h(t,e,i){t.__defineGetter__(i,(function(){return e[i]})),t.__defineSetter__(i,(function(t){e[i]=t}))}function u(t){var e=!!t.createTransformFeedback;e&&t.bindVertexArray(null);var i=t.getParameter(t.MAX_VERTEX_ATTRIBS),r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r);for(var n=0;n<i;++n)t.disableVertexAttribArray(n),t.vertexAttribPointer(n,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(n,0),e&&t.vertexAttribDivisor(n,0);t.deleteBuffer(r);var a=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(n=0;n<a;++n)t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null),e&&(t.bindTexture(t.TEXTURE_2D_ARRAY,null),t.bindTexture(t.TEXTURE_3D,null),t.bindSampler(n,null));if(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e){t.drawBuffers([t.BACK]),t.readBuffer(t.BACK),t.bindBuffer(t.COPY_READ_BUFFER,null),t.bindBuffer(t.COPY_WRITE_BUFFER,null),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),t.bindBuffer(t.PIXEL_UNPACK_BUFFER,null);var s=t.getParameter(t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(n=0;n<s;++n)t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,n,null);var o=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);for(n=0;n<o;++n)t.bindBufferBase(t.UNIFORM_BUFFER,n,null);t.disable(t.RASTERIZER_DISCARD),t.pixelStorei(t.UNPACK_IMAGE_HEIGHT,0),t.pixelStorei(t.UNPACK_SKIP_IMAGES,0),t.pixelStorei(t.UNPACK_ROW_LENGTH,0),t.pixelStorei(t.UNPACK_SKIP_ROWS,0),t.pixelStorei(t.UNPACK_SKIP_PIXELS,0),t.pixelStorei(t.PACK_ROW_LENGTH,0),t.pixelStorei(t.PACK_SKIP_ROWS,0),t.pixelStorei(t.PACK_SKIP_PIXELS,0),t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT,t.DONT_CARE)}for(;t.getError(););}return{init:n,mightBeEnum:function(t){return a(),void 0!==i[t]},glEnumToString:s,glFunctionArgToString:o,glFunctionArgsToString:function(t,e){for(var i="",r=e.length,n=0;n<r;++n)i+=(0==n?"":", ")+o(t,r,n,e[n]);return i},makeDebugContext:function e(i,r,a,u){u=u||i,n(i),r=r||function(e,i,r){for(var n="",a=r.length,h=0;h<a;++h)n+=(0==h?"":", ")+o(i,a,h,r[h]);t("WebGL error "+s(e)+" in "+i+"("+n+")")};var c={};function l(t,e){return function(){a&&a(e,arguments);var i=t[e].apply(t,arguments),n=u.getError();return 0!=n&&(c[n]=!0,r(n,e,arguments)),i}}var _={};for(var d in i)if("function"==typeof i[d])if("getExtension"!=d)_[d]=l(i,d);else{var f=l(i,d);_[d]=function(){var t=f.apply(i,arguments);return t?e(t,r,a,u):null}}else h(_,i,d);return _.getError=function(){for(var t in c)if(c.hasOwnProperty(t)&&c[t])return c[t]=!1,t;return i.NO_ERROR},_},makeLostContextSimulatingCanvas:function(t){var e,i,r=[],n=[],a={},s=1,o=!1,c=[],l=0,_=0,d=!1,f=0,p={};function g(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}t.getContext=function(r){return function(){var n=r.apply(t,arguments);if(n instanceof WebGLRenderingContext||window.WebGL2RenderingContext&&n instanceof WebGL2RenderingContext){if(n!=e){if(e)throw"got different context";i=window.WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,a=T(e=n)}return a}return n}}(t.getContext);var m=function(t){r.push(g(t))},v=function b(){++_,o||l==_&&t.loseContext()}function S(t,e){var i=t[e];return function(){if(b(),!o){var e=i.apply(t,arguments);return e}}}function y(t){return{statusMessage:t,preventDefault:}return function(t){var e=t.addEventListener;t.addEventListener=function(i,r,n){switch(i){case"webglcontextlost":m(r);break;case"webglcontextrestored":v(r);break;default:e.apply(t,arguments)}}}(t),t.loseContext=function(){if(!o){for(o=!0,l=0,++s;e.getError(););!function(){for(var t=Object.keys(p),e=0;e<t.length;++e)delete p[t[e]]}(),p[e.CONTEXT_LOST_WEBGL]=!0;var i=y("context lost"),n=r.slice();setTimeout((function(){for(var e=0;e<n.length;++e)n[e](i);f>=0&&setTimeout((function(){t.restoreContext()}),f)}),0)}},t.restoreContext=function(){o&&n.length&&setTimeout((function(){if(!d)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var t=0;t<c.length;++t){var r=c[t];r instanceof WebGLBuffer?e.deleteBuffer(r):r instanceof WebGLFramebuffer?e.deleteFramebuffer(r):r instanceof WebGLProgram?e.deleteProgram(r):r instanceof WebGLRenderbuffer?e.deleteRenderbuffer(r):r instanceof WebGLShader?e.deleteShader(r):r instanceof WebGLTexture?e.deleteTexture(r):i&&(r instanceof WebGLQuery?e.deleteQuery(r):r instanceof WebGLSampler?e.deleteSampler(r):r instanceof WebGLSync?e.deleteSync(r):r instanceof WebGLTransformFeedback?e.deleteTransformFeedback(r):r instanceof WebGLVertexArrayObject&&e.deleteVertexArray(r))}}(),u(e),o=!1,_=0,d=!1;for(var t=n.slice(),r=y("context restored"),a=0;a<t.length;++a)t[a](r)}),0)},t.loseContextInNCalls=function(t){if(o)throw"You can not ask a lost contet to be lost";l=_+t},t.getNumCalls=function(){return _},t.setRestoreTimeout=function(t){f=t},t;function T(t){for(var r in t)"function"==typeof t[r]?a[r]=S(t,r):h(a,t,r);a.getError=function(){if(b(),!o)for(;t=e.getError();)p[t]=!0;for(var t in p)if(p[t])return delete p[t],t;return a.NO_ERROR};var n=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];i&&n.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var u=0;u<n.length;++u){var l=n[u];a[l]=function(e){return function(){if(b(),o)return null;var i=e.apply(t,arguments);return i.__webglDebugContextLostId__=s,c.push(i),i}}(t[l])}var _=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];i&&_.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(u=0;u<_.length;++u){l=_[u];a[l]=function(e){return function(){return b(),o?null:e.apply(t,arguments)}}(a[l])}var d=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];i&&d.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(u=0;u<d.length;++u){l=d[u];a[l]=function(e){return function(){return b(),!o&&e.apply(t,arguments)}}(a[l])}return a.checkFramebufferStatus=function(e){return function(){return b(),o?a.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(a.checkFramebufferStatus),a.getAttribLocation=function(e){return function(){return b(),o?-1:e.apply(t,arguments)}}(a.getAttribLocation),a.getVertexAttribOffset=function(e){return function(){return b(),o?0:e.apply(t,arguments)}}(a.getVertexAttribOffset),a.isContextLost=function(){return o},i&&(a.getFragDataLocation=function(e){return function(){return b(),o?-1:e.apply(t,arguments)}}(a.getFragDataLocation),a.clientWaitSync=function(e){return function(){return b(),o?a.WAIT_FAILED:e.apply(t,arguments)}}(a.clientWaitSync),a.getUniformBlockIndex=function(e){return function(){return b(),o?a.INVALID_INDEX:e.apply(t,arguments)}}(a.getUniformBlockIndex)),a}},resetToInitialState:u}}();const Nn=wn;var Pn=function(){this._values=new Float32Array(Pn.maxGraphValue),this._index=0,this._maxValue=0,this._x=0,this._y=0};Pn.maxGraphValue=120,Pn.prototype={getIndex:function(){return this._index},getValues:function(){return this._values},setDisplayPosition:function(t,e){this._x=t,this._y=e},getX:function(){return this._x},getY:function(){return this._y},addValue:function(t,e){var i=this._index;this._maxValue=t>this._maxValue?t:this._maxValue,this._maxValue*=.99,this._values[i]=t/(1.1*this._maxValue),e&&(this._values[i]+=e),this._index=(this._index+1)%Pn.maxGraphValue}};const Zn=Pn;var Ln=function(){this._usageHint=Y.Z.DYNAMIC_DRAW;this._nbVertexes=0,this._maxNbVertexes=0,this._captionNbVertexes=0,this._valuesNbVertexes=0,this._graphsNbVertexes=0,this.resize(6560)};Ln.backgroundColor=10,Ln.redColor=7,Ln.greyColor=4,Ln.whiteColor=1,a.Z.createPrototypeObject(Ln,{getGeometry:function(){return this._geometry},generateBackground:function(t,e,i,r){var n=this._vertexes;this._nbVertexes+=4,n[0]=t,n[1]=e,n[2]=0,n[3]=Ln.backgroundColor;var a=t+i,s=e+r;n[4]=t,n[5]=s,n[6]=0,n[7]=Ln.backgroundColor,n[8]=a,n[9]=s,n[10]=0,n[11]=Ln.backgroundColor,n[12]=a,n[13]=e,n[14]=0,n[15]=Ln.backgroundColor},generateCharacter:function(t,e,i,r,n,a,s){var o=this._vertexes,h=this._nbVertexes;this._nbVertexes+=4;var u=4*h;o[u++]=t,o[u++]=e,o[u++]=n,o[u++]=-(0+s);var c=t+i,l=e+r;o[u++]=t,o[u++]=l,o[u++]=n,o[u++]=-(1+s),o[u++]=c,o[u++]=l,o[u++]=a,o[u++]=-(1+s),o[u++]=c,o[u++]=e,o[u++]=a,o[u++]=-(0+s)},generateText:function(t,e,i,r,n){var a=i.length;this._nbVertexes+4*a>=this._maxNbVertexes&&this.resize(2*this._maxNbVertexes);for(var s=r._characterSizeUV,o=r._characterWidth,h=r._characterHeight,u=0;u<a;u++){var c=i.charCodeAt(u),l=r.getCharacterUV(c);this.generateCharacter(t,e,o,h,l,l+s,n),t+=o}return a*o},generateGraph:function(t,e){this._nbVertexes+2*Zn.maxGraphValue>=this._maxNbVertexes&&this.resize(2*this._maxNbVertexes);var i=this._vertexes,r=this._nbVertexes,n=t.getValues(),a=n.length,s=t.getIndex(),o=t.getX(),h=t.getY();this._nbVertexes+=2*a;for(var u=0;u<a;u++){var c=4*(r+2*u),l=n[(s+u)%a],_=Ln.greyColor;l>=Ln.redColor&&(_=Ln.redColor,l-=Ln.redColor),l>1&&(l=1),(l*=e)<1&&(l=1),i[c]=o+2*u,i[c+1]=h,i[c+2]=0,i[c+3]=_,i[c+4]=o+2*u,i[c+5]=h+l,i[c+6]=0,i[c+7]=_}},resize:function(t){L.Z.log("resize buffer to "+t),this._maxNbVertexes=t;var e=new Float32Array(4*t);this._vertexes&&e.set(this._vertexes),this._vertexes=e;var i=Math.ceil(t/4);this._indexes=new Uint16Array(6*i);for(var r=0,n=0;r<i;r++)this._indexes[n++]=4*r+0,this._indexes[n++]=4*r+1,this._indexes[n++]=4*r+3,this._indexes[n++]=4*r+3,this._indexes[n++]=4*r+1,this._indexes[n++]=4*r+2;if(this._geometry)return this._geometry.getAttributes().Vertex.setElements(this._vertexes),void this._characterPrimitive.getIndices().setElements(this._indexes);this._geometry=new Dt.Z,this._geometry.setName("osgStats-Stats"),this._geometry.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,this._vertexes,4,!0);var a=new Y.Z(Y.Z.ELEMENT_ARRAY_BUFFER,this._indexes,1);this._geometry.getAttributes().Vertex.setUsage(this._usageHint);var s=new Rr.Z(dr.Z.TRIANGLES,a);this._characterPrimitive=s,this._geometry.getPrimitives().push(this._characterPrimitive);var o=new _r.Z(dr.Z.LINES,0,0);this._graphPrimitive=o,this._geometry.getPrimitives().push(this._graphPrimitive)},update:function(){var t=this._captionNbVertexes+this._valuesNbVertexes;this._characterPrimitive.setCount(t/4*6),this._graphPrimitive.setCount(this._graphsNbVertexes),this._graphPrimitive.setFirst(t),this._geometry.getAttributes().Vertex.dirty()},resetCaptions:function(){this._nbVertexes=0,this._captionNbVertexes=0},resetValues:captionsEnd:valuesEnd:graphsEnd:function(){this._graphsNbVertexes=this._nbVertexes-(this._valuesNbVertexes+this._captionNbVertexes)},getCharacterPrimitive:function(){return this._characterPrimitive},getGraphPrimitive:function(){return this._graphPrimitive},getNbVertexes:function(){return this._nbVertexes}});const On=Ln;var Fn=window.performance,Dn=function(t){this._caption=t.caption,this._accumValue=0,this._accumSamples=0,this._accumStart=0,this._value=0,this._averageValue=0,this._time=0,this._avgMs=0,this._over=t.over>0?t.over:0,this._below=t.below>0?t.below:0,this._graph=!!t.graph,t.average&&(this._avgMs=t.avgMs?t.avgMs:1e3),this._display=!1};a.Z.createPrototypeObject(Dn,{isDisplayable:function(){return this._display},setDisplayable:function(t){this._display=t},getOver:function(){return this._over},getBelow:function(){return this._below},getGraph:function(){return this._graph},getAverageMs:function(){return this._avgMs},getAverageValue:function(){return this._averageValue},getValue:function(){return this._value},average:function(t){if(this._avgMs){this._accumValue+=t,this._accumSamples++;var e=Fn.now();e-this._accumStart>this._avgMs&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=e,this._accumSamples=0)}},start:end:function(){this._value=Fn.now()-this._time,this.average(this._value)},set:function(t){this._display=!0,this._value=t,this.average(t)},tick:function(){this.end(),this.start()},frame:function(){var t=Fn.now()-this._time;this.set(1e3/t),this.start()}});const Un=Dn;var Bn=function(){this._canvas=void 0,this._characterHeight=0,this._characterWidth=0,this._fontSize=16,this._fontFamily="Source Code Pro",this._characterFirstCode=" ".charCodeAt(),this._characterLastCode="z".charCodeAt(),this._characterSizeUV=0,this._backgroundColor="rgba(0,0,0,0.0)",this._createCanvas()};a.Z.createPrototypeObject(Bn,{setFontSize:function(t){this._fontSize=t},getCharacterWidth:function(){return this._characterWidth},getCharacterHeight:function(){return this._characterHeight},getCanvas:function(){return this._promise},getCharacterUV:function(t){return(t-this._characterFirstCode)*this._characterSizeUV},_fillCanvas:function(t,e){var i=e+"px",r=function(t){var e=document.getElementsByTagName("body")[0],i=document.createElement("div"),r=document.createTextNode("M");i.appendChild(r),i.setAttribute("style",t),e.appendChild(i);var n=i.offsetHeight;return e.removeChild(i),n}("font-family: "+t+"; font-size: "+i+";");L.Z.debug(t+" "+i+" ==> "+r+" pixels high."),this._characterHeight=Math.ceil(r);var n=e+"px '"+t+"'",a=document.createElement("canvas"),s=a.getContext("2d");this._canvas=a,s.font=n,s.textBaseline="middle",this._characterWidth=s.measureText(" ").width,this._characterWidth=Math.ceil(this._characterWidth);var o=this._characterLastCode-this._characterFirstCode+1;L.Z.info("Stats character size "+this._characterWidth+" x "+this._characterHeight+" texture width "+this._characterWidth*o),a.width=Math.ceil(this._characterWidth*o),a.height=this._characterHeight,this._characterSizeUV=this._characterWidth/a.width,s.font=n,s.textBaseline="middle",s.fillStyle="rgb(255,255,255)";for(var h=this._characterFirstCode,u=0;h<=this._characterLastCode;h++,u++){var c=String.fromCharCode(h),l=u*this._characterWidth,_=this._characterHeight/2;s.fillText(c,l,_)}return a},_createCanvas:function(){var t;this._promise=(t=this._fontFamily,new(Pt())((function(e,i){window.WebFontConfig={google:{families:[t+":200"]},active:inactive:;var r=document.createElement("script"),n=document.scripts[0];r.src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js",r.async=!0,r.onerror=n.parentNode.insertBefore(r,n)}))).then(bind(this)).catch(bind(this))}});const kn=Bn;var Vn,Gn,jn,Wn,Hn,zn=i("k3oU"),qn=32768,Xn=function(t,e){this._captionsBuffer=void 0,this._valuesBuffer=void 0,this._dirtyCaptions=!0,this._dirtyValues=!0,this._viewer=t,this._labelMaxWidth=0,this._viewport=t.getCamera().getViewport(),this._node=void 0,this._text=void 0,this._offsetGroup=void 0,this._counters={},this._groups={},this._updates=[],this._displayableCounters={},this._x=0,this._y=0,this._width=0,this._height=0,this._maxCaptionTextLength=32,this._lineFactor=1.1,this._displayFilter=[],this._backgroundWidth=0,this._backgroundHeight=0,this._bufferStats=new On,this._historyGraph={},this._graphToDisplay=[],this._valuesMaxWidth=72,this._showGraph=!1,this._backgroundPicking=zt.Z.createTexturedQuadGeometry(0,0,0,10,0,0,0,10,0),this._backgroundPicking.setName("osgStats-Background-picking"),this._dragStop=s.K4.create(),this._dragStart=s.K4.create(),this._startTransformation=s._E.create(),this._init(e)};a.Z.createPrototypeObject(Xn,{getCounter:function(t){return this._counters[t]||(this._counters[t]=new Un({caption:t,average:!0})),this._counters[t]},getBufferStats:function(){return this._bufferStats},addConfig:function(t){if(!t.init||t.init()){for(var e in t.values){var i=t.values[e],r=new Un(i);this._counters[e]=r}if(t.groups)for(var n=0;n<t.groups.length;n++){var a=t.groups[n],s={caption:a.caption,values:a.values,textCursorY:new Float32Array(a.values.length)},o=a.name?a.name:a.caption;this._groups[o]=s}t.update&&this._updates.push(t.update)}},reset:function(){this._bufferStats.resetCaptions(),this._bufferStats.resetValues(),this._dirtyCaptions=!0,this._dirtyValue=!0,this._bufferStats.resize(this._bufferStats._maxNbVertexes)},update:function(){for(var t=0;t<this._updates.length;t++)this._updates[t](this);this._dirtyValues=!0,(this._checkViewportChanged()||this._checkCounterDisplayableChanged())&&(this._dirtyCaptions=!0),this._dirtyCaptions&&(this._bufferStats.resetCaptions(),this._generateCaptions(),this._dirtyCaptions=!1),this._dirtyValues&&(this._bufferStats.resetValues(),this._generateValues(),this._dirtyValues=!1)},getNode:function(){return this._node},setShowFilter:function(t){this._dirtyCaptions=!0,t?this._displayFilter=t.slice():this._displayFilter.length=0},_init:function(t){var e=new ir.Z;e.setRenderOrder(ir.Z.POST_RENDER,0),e.setReferenceFrame(nn.Z.ABSOLUTE_RF),e.setClearMask(0);var i=new Ht.Z;i.setName("StatsNode"),i.addChild(this._backgroundPicking),this._nodeTransform=i,this._backgroundPicking.setNodeMask(0),e.addChild(i),e.setName("osgStats"),e.setViewport(this._viewport),this._node=e,this._text=new kn;var r=12;if(t){var n=t.getString("statsFilter");if(n){var a=n.split(";");this.setShowFilter(a)}var s=t.getNumber("statsFontSize");void 0!==s&&(r=s),this._showGraph=t.getBoolean("statsShowGraph")}var o,h,u=new qt.Z;u.setMinFilter(qt.Z.NEAREST),u.setMagFilter(qt.Z.NEAREST),this._text.setFontSize(r*this._viewer.getCanvasPixelRatio()),this._text.getCanvas().then(function(t){this._dirtyCaptions=!0;var e=this._bufferStats.getGeometry();e.setNodeMask(-32769),i.addChild(e),u.setImage(t),e.setBound(new zn.Z)}.bind(this)),i.getOrCreateStateSet().setAttributeAndModes((o=["attribute vec4 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec2 vTexCoord0;","","void main(void) {","  vTexCoord0 = Vertex.zw;","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xy,0.0, 1.0));","}"].join("\n"),h=["#define SHADER_NAME STATS","varying vec2 vTexCoord0;","uniform sampler2D Texture0;","void main(void) {","  vec4 color = vec4(1.0);","  vec2 uv =  vTexCoord0;","  int isText = 0;","  if ( uv.y < 0.0 ) {","     isText = 1;","     uv.y = -uv.y;","  }","  if ( uv.y >= "+(On.backgroundColor-1).toFixed(1)+" ) {","     color = vec4(0.0,0.0,0.0,0.5);","     uv.y -= "+On.backgroundColor.toFixed(1)+";","  } else if ( uv.y >= "+(On.redColor-1).toFixed(1)+" ) {","     color = vec4(1.0,0.0,0.0,1.0);","     uv.y -= "+On.redColor.toFixed(1)+";","  } else if ( uv.y == "+(On.greyColor-1).toFixed(1)+" ) {","     color = vec4(0.5,0.5,0.5,1.0);","     uv.y -= "+On.greyColor.toFixed(1)+";","  } else {","     uv.y -= "+On.whiteColor.toFixed(1)+";","  }","  if ( isText == 1 ) {","     color *= texture2D( Texture0, uv.xy);","  }","  gl_FragColor = color;","}"].join("\n"),new ar.Z(new sr.Z("VERTEX_SHADER",o),new sr.Z("FRAGMENT_SHADER",h)))),i.getOrCreateStateSet().setAttributeAndModes(new Ji.Z(Ji.Z.DISABLE));var c=new Xt.Z("SRC_ALPHA","ONE_MINUS_SRC_ALPHA");i.getOrCreateStateSet().setAttributeAndModes(c),i.getOrCreateStateSet().setAttributeAndModes(new $i.Z($i.Z.DISABLE)),i.getOrCreateStateSet().setTextureAttributeAndModes(0,u);var l=this._viewer.getGraphicContext().canvas;this._canvas=l;var _=this._viewer.getInputManager();_.group(Ne.Z.STATS).addMappings({onMouseMove:["mousemove","touchmove"],onMouseDown:["mousedown","touchstart"],onMouseUp:["mouseup","mouseout","touchend","touchcancel"]},this),_.setPriority(Ne.Z.STATS,_.getHigherPriority(Ne.Z.SCENE))},onMouseDown:function(t){var e=this.computeNearestIntersection(t);this._onStats=!!e.length,this._onStats&&(this._viewer.getInputManager().setEnable(Ne.Z.SCENE,!1),s._E.copy(this._startTransformation,this._nodeTransform.getMatrix()),s.K4.set(this._dragStart,t.canvasX,t.canvasY),this._dragStop[1]=this._dragStart[1])},onMouseMove:(Hn=s.R3.create(),function(t){if(this._onStats){s.K4.set(this._dragStop,t.canvasX,t.canvasY);var e=this._dragStop[1]-this._dragStart[1];s._E.translate(this._nodeTransform.getMatrix(),this._startTransformation,s.R3.set(Hn,0,-e,0))}}),onMouseUp:function(){this._viewer.getInputManager().setEnable(Ne.Z.SCENE,!0),this._onStats=!1},computeNearestIntersection:(Vn=new _e.Z,Gn=s.R3.create(),jn=s.R3.create(),Wn=new le.Z,Wn.setIntersector(Vn),function(t){var e=t.glX,i=t.glY;Vn.reset(),Vn.set(s.R3.set(Gn,e,i,0),s.R3.set(jn,e,i,1)),Wn.reset(),this._backgroundPicking.setNodeMask(qn),Wn.setTraversalMask(qn),this._node.accept(Wn);var r=Vn.getIntersections();return this._backgroundPicking.setNodeMask(0),r}),_updateBackgroundPicking:function(t,e,i,r){var n=this._backgroundPicking.getVertexAttributeList().Vertex.getElements();n[0]=t,n[1]=e+r,n[3]=t,n[4]=e,n[6]=t+i,n[7]=e,n[9]=t+i,n[10]=e+r,this._backgroundPicking.getVertexAttributeList().Vertex.dirty(),this._backgroundPicking.dirtyBound()},_generateCaptions:function(){var t=this._text.getCharacterHeight(),e=0,i=this._viewport.height()-t;this._labelMaxWidth=0,this._bufferStats.generateBackground(0,this._viewport.height()-this._backgroundHeight,this._backgroundWidth,this._backgroundHeight),this._updateBackgroundPicking(0,this._viewport.height()-this._backgroundHeight,this._backgroundWidth,this._backgroundHeight);var r=this._displayFilter;for(var n in this._groups)if(!n||!r.length||-1!==r.indexOf(n)){var a=this._groups[n],s="--- "+a.caption+" ---",o=this._bufferStats.generateText(e,i,s,this._text,On.whiteColor);this._labelMaxWidth=Math.max(o,this._labelMaxWidth),e=0,i-=this._lineFactor*t;for(var h=0;h<a.values.length;h++){var u=a.values[h],c=this._counters[u];if(c&&c.isDisplayable()){a.textCursorY[h]=i;for(var l=c._caption,_=l.length/this._maxCaptionTextLength,d=0;d<_;d++){var f=d*this._maxCaptionTextLength,p=l.substr(f,this._maxCaptionTextLength);o=this._bufferStats.generateText(e,i,p,this._text,On.whiteColor),this._labelMaxWidth=Math.max(o,this._labelMaxWidth),i-=t,e=0}}}i-=t}this._bufferStats.captionsEnd()},_generateValues:function(){var t,e=this._text.getCharacterWidth(),i=this._labelMaxWidth+2*e,r=this._valuesMaxWidth+2*e,n=this._text.getCharacterHeight(),a=i,s=this._displayFilter,o=0;for(var h in this._groups)if(!h||!s.length||-1!==s.indexOf(h)){var u=this._groups[h];a=i;for(var c=0;c<u.values.length;c++){var l=u.values[c],_=this._counters[l];if(_&&_.isDisplayable()){var d,f=_.getAverageMs()?_.getAverageValue():_.getValue();d=Number.isInteger(f)?f.toString():f.toFixed(2),t=u.textCursorY[c];var p=On.whiteColor,g=_.getOver(),m=_.getBelow();0!==g?p=f>g?On.redColor:p:0!==m&&(p=f<m?On.redColor:p);var v=this._bufferStats.generateText(a,t,d,this._text,p);o=Math.max(v,o),this._showGraph&&_._graph&&(this._historyGraph[l]||(this._historyGraph[l]=new Zn),this._graphToDisplay.push(this._historyGraph[l]),this._historyGraph[l].setDisplayPosition(i+r,t),this._historyGraph[l].addValue(f,p)),a=i}}}this._bufferStats.valuesEnd(),this._valuesMaxWidth=o;for(var b=0;b<this._graphToDisplay.length;b++){var S=this._graphToDisplay[b];this._bufferStats.generateGraph(S,n-2)}var y=i+r;this._graphToDisplay.length&&(y+=2*Zn.maxGraphValue+1);var T=this._viewport.height()-t;this._backgroundWidth===y&&this._backgroundHeight===T||(this._backgroundWidth=y,this._backgroundHeight=T,this._dirtyCaptions=!0),this._graphToDisplay.length=0,this._bufferStats.graphsEnd(),this._bufferStats.update()},_checkCounterDisplayableChanged:function(){var t=!1;for(var e in this._counters){var i=this._counters[e];this._displayableCounters[e]!==i.isDisplayable()&&(this._displayableCounters[e]=i.isDisplayable(),t=!0)}return t},_checkViewportChanged:function(){var t=this._viewport.x(),e=this._viewport.y(),i=this._viewport.width(),r=this._viewport.height();if(t!==this._x||e!==this._y||i!==this._width||r!==this._height){this._x=t,this._y=e,this._width=i,this._height=r;var n=this._node;return s._E.ortho(n.getProjectionMatrix(),this._x,this._width,this._y,this._height,-5,5),!0}return!1}});const Kn=Xn;const Yn={values:{frame:{caption:"Total frame time",over:16,average:!0,graph:!0,max:4},stats:{caption:"stats",over:1,graph:!0},fps:{caption:"Framerate (FPS)",below:30,average:!0},raf:{caption:"Time since last rAF",average:!0,avgMs:500},update:{caption:"update",average:!0,graph:!0},cull:{caption:"cull",average:!0,graph:!0,max:16},render:{caption:"render",average:!0,graph:!0},readPixels:{caption:"readPixels",average:!0,graph:!0},glframe:{caption:"glframe",average:!0,graph:!0},textureused:{caption:"texture used"},texturereserved:{caption:"texture reserved"},texturetotal:{caption:"texture total"},pushstateset:{caption:"num pushStateSet"},applyStateSet:{caption:"num applyStateSet"},updatecallback:{caption:"num updateCallback"},cullcamera:{caption:"camera"},cullmatrixtransform:{caption:"matrixTransform"},cullprojection:{caption:"projection"},cullnode:{caption:"node"},culllightsource:{caption:"lightSource"},cullgeometry:{caption:"geometry"}},groups:[{name:"framerate",caption:"Framerate",values:["fps","raf"]},{name:"frameBudget",caption:"Frame Budget",base:"frame",values:["frame","update","cull","render","glframe","stats"]},{name:"sceneGraph",caption:"Scene Graph ",values:["pushstateset","updatecallback","applyStateSet"]},{name:"cullVisitor",caption:"Cull",values:["cullnode","cullmatrixtransform","cullcamera","culllighsource","cullprojection","cullgeometry"]},{name:"texture",caption:"Texture Memory",values:["texturereserved","textureused","texturetotal"]},{name:"readback",caption:"gpu read back",values:["readpixels"]}]};var Qn=[window.WebGLRenderingContext,window.WebGL2RenderingContext],Jn=$n=0,ta=0,ea=0,ia=0,ra=0,na=0,aa=0,sa=0,oa=0,ha=0;const ua={values:{glDrawCalls:{caption:"drawCalls"},glDrawElements:{caption:"drawElements"},glDrawArrays:{caption:"drawArrays"},glBindTexture:{caption:"bindTexture"},glUseProgram:{caption:"useProgram"},glFaces:{caption:"totalFaces"},glVertices:{caption:"totalVertices"},glPoints:{caption:"totalPoints"},statsFaces:{caption:"statsFaces"},statsVertices:{caption:"statsVertices"},statsLines:{caption:"statsLines"}},groups:[{name:"webgl",caption:"WebGL",values:["glDrawCalls","glDrawElements","glDrawArrays","glUseProgram","glBindTexture","glFaces","glVertices","glPoints","statsVertices","statsFaces","statsLines"]}],update:function(t){var e=t.getBufferStats(),i=e.getNbVertexes(),r=e.getCharacterPrimitive(),n=e.getGraphPrimitive();ta-=1,n.getCount()&&($n-=1),aa-=2,ea-=1,ra-=r.getCount()+n.getCount(),ia-=r.getCount()/3,sa=i,oa=r.getCount()/3,ha=n.getCount()/2,t.getCounter("glDrawCalls").set(ta+$n),t.getCounter("glDrawElements").set(ta),t.getCounter("glDrawArrays").set($n),t.getCounter("glBindTexture").set(aa),t.getCounter("glUseProgram").set(ea),t.getCounter("glFaces").set(ia),t.getCounter("glVertices").set(ra),t.getCounter("glPoints").set(na),t.getCounter("statsVertices").set(sa),t.getCounter("statsFaces").set(oa),t.getCounter("statsLines").set(ha),sa=0,oa=0,ha=0,$n=0,ta=0,ea=0,ia=0,ra=0,na=0,aa=0}.bind(void 0),init:function(){for(var t=!1,e=0;e<Qn.length;e++){var i=Qn[e];i&&(t=!0,i.prototype.drawArrays=Jn(i.prototype.drawArrays,(function(){$n++,arguments[0]===this.POINTS?na+=arguments[2]:ra+=arguments[2]})),i.prototype.drawElements=Jn(i.prototype.drawElements,(function(){ta++,ia+=arguments[1]/3,ra+=arguments[1]})),i.prototype.useProgram=Jn(i.prototype.useProgram,(function(){ea++})),i.prototype.bindTexture=Jn(i.prototype.bindTexture,())}return t}};var ca=void 0,la=Math.log(1024),_a=function(t){var e=Math.floor(Math.log(t)/la);return 0===t&&(e=1),Math.round(100*t/Math.pow(1024,e))/100};const da={values:{browserMemory:{caption:"Used Memory",average:!0,avgMs:1e3},browserMemoryTotal:{caption:"Total Memory"}},groups:[{name:"browser",caption:"Browser",values:["browserMemory","browserMemoryTotal"]}],update:function(t){var e=0,i=0;ca&&(e=_a(ca.usedJSHeapSize),i=_a(ca.totalJSHeapSize)),t.getCounter("browserMemory").set(e),t.getCounter("browserMemoryTotal").set(i)},init:function(){return window.performance&&window.performance.memory&&(ca=window.performance.memory),ca&&0!==ca.totalJSHeapSize||L.Z.warn("Stats will not report memory, not supported by your browse"),!!ca}};var fa=["shift","alt","ctrl","meta"],pa=function(t,e){this._enabled=!0,this._name=e,this._mask=[],this._events={},this._mappings={},this._inputManager=t,this._boundCallback=this._collectNativeEvents.bind(this),this._priority=10,this._hasSources=!1};pa.prototype={addMappings:function(t,e){for(var i in t)t[this._name+":"+i]=t[i],delete t[i];this._inputManager.addMappings(t,e)},_collectNativeEvents:function(t){if(this._enabled&&!this._mask.length){var e=this._mappings[t.type];if(e)for(var i=0;i<e.length;i++){var r=e[i];if(!r._source.isEventRegistered||r._source.isEventRegistered(t,r._parsedEvent)){if(r._source.populateEvent(t,r),r._nativeEvents||(r._nativeEvents=[]),!r._nativeEvents.length){var n=this._inputManager._queues[r._priority];n||(n=[],this._inputManager._queues[r._priority]=n),n.push(r)}r._nativeEvents.push(t)}}}},_addEvent:function(t,e){var i,r=this._name+":"+e,n=!1,a=this._mappings[t.name];a?i=this._findEvent(a,r,t.raw):(a=[],this._mappings[t.name]=a,n=!0);var s=this._events[e];s||(s=[],this._events[e]=s),i||(i=new Event(r),a.push(i),s.push(i)),i._parsedEvent=t,i._priority=10;var o=this._inputManager._getSource(t.name);o&&(this._enabled&&n&&o.setEnable(t.name,this._boundCallback,!0),this._hasSources=!0,i._source=o)},_findEvent:function(t,e,i){for(var r=0;r<t.length;r++){var n=t[r];if(n.type===e&&n._parsedEvent.raw===i)return n}},_setEnable:function(t){for(var e in this._enabled=t,this._mappings){var i=this._mappings[e][0];i._source&&i._source.setEnable(e,this._boundCallback,t)}}};var ga=function(){this._groups={},this._sources=[],this._queues=[],this._queues[10]=[],this._callbacks={},this._params={},this._maskedGroups=[],window.dumpInputGroups=this._dumpInputGroups.bind(this),window.dumpEventSequence=this._dumpEventSequence.bind(this)};ga.prototype={registerInputSource:function(t){if(!t.setEnable||!t.supportsEvent||!t.getName)throw"Invalid input target "+JSON.stringify(t);this._sources.push(t),t.setInputManager(this)},getInputSource:function(t){for(var e=0;e<this._sources.length;e++){var i=this._sources[e];if(i.getName()===t)return i}},addMappings:function(t,e){for(var i in t){var r=t[i],n=i.split(":");if(2!==n.length)throw"Mapping should be of the form 'group:methodName': ['nativeevent1, 'nativeevent2',...] ";var a,s,o=this._getOrCreateGroup(n[0]),h=n[1];if(e)if("object"==typeof e){if(!(a=e[h])||"function"!=typeof a)throw"Cannot find method "+h+" on "+e;a=a.bind(e)}else{if("function"!=typeof e)throw"Invalid listener "+e;a=e}if("string"==typeof r)s=this._parseNativeEvent(r),o._addEvent(s,h);else for(var u=0;u<r.length;u++){var c=r[u];s=this._parseNativeEvent(c),o._addEvent(s,h)}this._callbacks[o._name+":"+h]=a}},grou},setEnable:function(t,e){var i,r=this._groups[t];for(var n in r&&r._setEnable(e),this._groups)if(r=this._groups[n],e){if((i=r._mask.indexOf(t))>=0){for(;i>=0;)r._mask.splice(i,1),i=r._mask.indexOf(t);for(i=this._maskedGroups.indexOf(t);i>=0;)this._maskedGroups.splice(i,1),i=this._maskedGroups.indexOf(t)}}else 0===(i=r._name.indexOf(t))&&"."===r._name[i+t.length]&&(r._mask.push(t),this._maskedGroups.push(t));if(!e)for(var a=0;a<this._queues.length;a++){var s=this._queues[a];if(s)for(var o=s.length-1;o>=0;o--){var h=s[o];h.type.indexOf(t)>=0&&(s.splice(o,1),h._nativeEvents.length=0)}}},setPriority:function(t,e){var i=t.split(":");if(e<0)throw"priority must be a positive number";var r,n,a=this._groups[i[0]];if(a&&i[1]){for(r=a._events[i[1]],n=0;n<r.length;n++)r[n]._priority=e;a._priority>e&&(a._priority=e)}else for(var s in this._groups)if((a=this._groups[s])._name.indexOf(t)>=0)for(var o in a._events)for(r=a._events[o],n=0;n<r.length;n++)r[n]._priority=e},getHigherPriority:function(t){var e=10;for(var i in this._groups){var r=this._groups[i];r._name.indexOf(t)>=0&&r._priority<e&&(e=r._priority)}return e>0?e-1:0},getParam:function(t){return this._params[t]},setParam:function(t,e){this._params[t]=e},cleanup:function(){for(var t in this._groups){this._groups[t]._setEnable(!1)}},_parseNativeEvent:function(t){var e,i=t.split(" "),r={};for(r.name=i[0],e=1;e<i.length;e++){var n=i[e],a=!0;0===n.indexOf("!")&&(a=!1,n=n.substring(1,n.length)),fa.indexOf(n)>=0?r[n]=a:r.action=n.toLowerCase()}if(r.action)for(e=0;e<fa.length;e++){var s=fa[e];0===r.action.indexOf(s)&&(r[s]=!0)}return 0===r.name.indexOf("key")&&!r.action&&i.length>1&&(r.action=i[i.length-1]),r.raw=t,r},_getOrCreateGroup:function(t){var e=this._groups[t];if(!e){e=new pa(this,t),this._groups[t]=e;for(var i=0;i<this._maskedGroups.length;i++){var r=this._maskedGroups[i];0===t.indexOf(r)&&e._mask.push(r)}}return e},update:function(t){var e;for(e=0;e<this._sources.length;e++){var i=this._sources[e];i.poll&&i.poll(t)}for(e=0;e<this._queues.length;e++){var r=this._queues[e];if(r){for(var n=0;n<r.length;n++){var a=r[n];this._callbacks[a.type](a),a._nativeEvents.length=0}r.length=0}}},_getSource:function(t){for(var e=0;e<this._sources.length;e++){var i=this._sources[e];if(i.supportsEvent(t))return i}},_dumpInputGroups:function(t,e){for(var i in!0===t&&(e=t,t=void 0),this._groups)if(!(t&&i.indexOf(t)<0)){var r=this._groups[i],n=r._enabled&&!r._mask.length&&r._hasSources;if(!e||n){for(var a in L.Z.groupCollapsed("%c"+i+(n?" (enabled)":" (disabled)"),n?"":"color: #888888"),L.Z.log("enabled:",r._enabled),L.Z.log("masks:",r._mask),L.Z.log("input sources:",r._hasSources),L.Z.group("events"),r._events){L.Z.groupCollapsed(a);for(var s=r._events[a],o=0;o<s.length;o++){var h=s[o],u="%c"+h._parsedEvent.raw+" ("+(h._source?h._source.getName():"unknown source")+")",c=h._source?"":"color: #888888";L.Z.log(u,c)}L.Z.groupCollapsed("function"),L.Z.log(this._callbacks[r._name+":"+a]),L.Z.groupEnd(),L.Z.groupEnd()}L.Z.groupEnd(),L.Z.groupEnd()}}},_dumpEventSequence:function(t,e){var i,r=[];for(var n in!0===t&&(e=t,t=void 0),this._groups){var a=this._groups[n];if(i=a._enabled&&!a._mask.length&&a._hasSources,!e||i)for(var s in a._events){var o=a._events[s],h=r[o[0]._priority];h||(h=[],r[o[0]._priority]=h);for(var u=0;u<o.length;u++){var c=o[u];(!t||t&&c._parsedEvent.raw.indexOf(t)>=0)&&h.push({name:c.type,group:a._name,on:c._parsedEvent.raw,enabled:a._enabled&&!a._mask.length&&!!c._source,source:c._source?"("+c._source.getName()+")":"(unknown source)"})}}}for(var l=0;l<r.length;l++){var _=r[l];if(_){var d;L.Z.group("priority "+l);for(var f=0;f<_.length;f++){var p=_[f];if(0!==f&&d!==p.name&&L.Z.groupEnd(),d!==p.name){var g=this._groups[p.group];i=g._enabled&&!g._mask.length&&g._hasSources,L.Z.groupCollapsed("%c"+p.name,i?"":"color:#888888")}d=p.name,L.Z.groupCollapsed("%c"+p.on+" "+p.source,p.enabled?"":"color:#888888"),L.Z.log(this._callbacks[p.name]),L.Z.groupEnd()}L.Z.groupEnd(),L.Z.groupEnd()}}}};const ma=ga;var v};va.prototype={supportsEvent:function(t){for(var e=0;e<this._supportedEvents.length;e++){var i=this._supportedEvents[e];if(0===t.indexOf(i))return!0}return!1},setInputManager:function(t){this._inputManager=t}};const ba=va;var Sa=0===navigator.platform.indexOf("Mac")?-1:-3,ya=function(t,e){ba.call(this,t),this._defaultRatio=s.K4.fromValues(1,1),this._supportedEvents=["click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup"],e&&!1===e.scrollwheel||this._supportedEvents.push("wheel")};a.Z.createPrototypeObject(ya,a.Z.objectInherit(ba.prototype,{getName:function(){return"Mouse"},setEnable:function(t,e,i){i?this._target.addEventListener(t,e):this._target.removeEventListener(t,e)},populateEvent:function(t,e){e.canvasX=void 0===t.offsetX?t.layerX:t.offsetX,e.canvasY=void 0===t.offsetY?t.layerY:t.offsetY;var i=this._inputManager.getParam("pixelRatio");i||(i=this._defaultRatio),e.glX=e.canvasX*i[0],e.glY=(this._target.clientHeight-e.canvasY)*i[1],e.clientX=t.clientX,e.clientY=t.clientY,e.screenX=t.screenX,e.screenX=t.screenX,e.pageX=t.pageX,e.pageY=t.pageY,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.altKey=t.altKey,e.metaKey=t.metaKey,e.button=t.button,e.buttons=t.buttons,"wheel"===t.type&&(void 0!==t.wheelDelta?e.deltaY=t.wheelDelta/120:1===t.deltaMode?e.deltaY=t.deltaY/Sa:e.deltaY=t.deltaY/(10*Sa),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaZ=t.deltaZ)},isEventRegistered:function(t,e){return(!e.action||t.button===parseInt(e.action))&&((void 0===e.ctrl||t.ctrlKey===e.ctrl)&&((void 0===e.shift||t.shiftKey===e.shift)&&((void 0===e.alt||t.altKey===e.alt)&&((void 0===e.meta||t.metaKey===e.meta)&&(t.preventDefault(),!0)))))}}),"osgViewer","InputSourceMouse");const Ta=ya;var xa=function(t){ba.call(this,t),this._supportedEvents=["keydown","keyup","keypress"]};a.Z.createPrototypeObject(xa,a.Z.objectInherit(ba.prototype,{getName:function(){return"Keyboard"},setEnabl},populateEvent:function(t,e){e.key=t.key,e.keyCode=t.keyCode,e.code=t.code,e.location=t.location,e.repeat=t.repeat,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.altKey=t.altKey,e.metaKey=t.metaKey},isEventRegistered:function(t,e){return!e.action||(t.key?t.key.toLowerCase()===e.action&&((void 0===e.ctrl||t.ctrlKey===e.ctrl)&&((void 0===e.shift||t.shiftKey===e.shift)&&((void 0===e.alt||t.altKey===e.alt)&&((void 0===e.meta||t.metaKey===e.meta)&&(t.preventDefault(),!0))))):void 0)}}),"osgViewer","InputSourceKeyboard");const Ea=xa;var Ra=i("R2Pi"),Aa=function(t,e){ba.call(this),this._supportedEvents=["vrsupported","vrpolyfilled","vrdisplayposechanged","vrdisplayconnected","vrdisplaynotfound","vrdisplaydisconnected"],this._callbacks={},this._events={};for(var i=0;i<this._supportedEvents.length;i++){var r=this._supportedEvents[i],n=new Event(r);this._events[r]=n}this._nbCallbacks=0,this._pollInterval=e&&void 0!==e.pollInterval?e.pollInterval:3e3};a.Z.createPrototypeObject(Aa,a.Z.objectInherit(ba.prototype,{getName:function(){return"WebVR"},setEnable:function(t,e,i){var r=this._callbacks[t];r||(r=[],this._callbacks[t]=r);var n=r.indexOf(e);i?n<0&&(r.push(e),this._nbCallbacks++,this._schedulePolling()):n>=0&&(r.splice(n,1),this._nbCallbacks--,this._nbCallbacks||this._cancelPolling())},populateEvent:function(t,e){e.pose=t.pose,e.worldFactor=this._inputManager.getParam("worldFactor"),e.worldFactor||(e.worldFactor=1)},_schedulePolling:function(){this._pollInterval>0&&void 0===this._pollingTimeout&&(this._pollingTimeout=setInterval(this.pollHeadset.bind(this),this._pollInterval))},_cancelPollin},pollHeadset:function(){if(!navigator.xr||!navigator.xr.isSessionSupported){if(navigator.getVRDisplays||Ra.default.any){if(this._vrPolyfillLoaded)return Pt().reject("VR not supported");var t=this._events.vrsupported;this._dispatchEvent(t,this._callbacks.vrsupported);var e=this._events.vrpolyfilled;this._dispatchEvent(e,this._callbacks.vrpolyfilled)}return Pt().resolve()}var i=this._events.vrsupported;this._dispatchEvent(i,this._callbacks.vrsupported);var r=this;return navigator.xr.isSessionSupported("immersive-vr").then(function(t){if(!t){if(this._vrReady){var e=r._events.vrdisplaydisconnected;this._dispatchEvent(e,r._callbacks.vrdisplaydisconnected)}return this._vrReady=!1,this.triggerNotFoundEvent(),Pt().reject("Immersive-vr session not supported")}if(!r._vrReady)return L.Z.log("Found a VR display"),r._vrReady=!0,i=r._events.vrdisplayconnected,this._dispatchEvent(i,r._callbacks.vrdisplayconnected),Pt().resolve()}.bind(this)).catch(function(t){return this._vrReady=!1,this.triggerNotFoundEvent(),L.Z.warn(t),Pt().reject(t)}.bind(this))},triggerNotFoundEvent:function(){if(!(this._pollInterval>0)){var t=this._events.vrdisplaynotfound;this._dispatchEvent(t,this._callbacks.vrdisplaynotfound)}},setPollInterval:function(t){this._pollInterval=t},_dispatchEvent:function(t,e){if(e)for(var i=0;i<e.length;i++){(0,e[i])(t)}},poll:function(t){if(this._vrReady&&t.frame){var e=this._callbacks.vrdisplayposechanged;if(e&&e.length){var i=t.frame.getViewerPose(t.xrReferenceSpace);if(i){var r=this._events.vrdisplayposechanged;r.pose=i,this._dispatchEvent(r,e)}}}}}),"osgViewer","InputSourceVR");const Ca=Aa;var Ma=function(){ba.call(this),this._target=window,this._supportedEvents=["buttondown","buttonup","buttonvalue","axis","gamepadconnected","gamepaddisconnected"],this._callbacks={},this._nbCallbacks=0,this._gamePadState=[],this._valueThreshold=.05,window.addEventListener("gamepadconnected",function(t){this._newGamePad(t.gamepad),this._onConnectionStateChange(t,"gamepadconnected")}.bind(this)),window.addEventListener("gamepaddisconnected",function(t){this._previousState[t.gamepad.index]=void 0,this._onConnectionStateChange(t,"gamepaddisconnected")}.bind(this))};a.Z.createPrototypeObject(Ma,a.Z.objectInherit(ba.prototype,{getName:function(){return"GamePad"},setEnable:function(t,e,i){var r=this._callbacks[t];r||(r=[],this._callbacks[t]=r);var n=r.indexOf(e);i?n<0&&(r.push(e),this._nbCallbacks++):n>=0&&(r.splice(n,1),this._nbCallbacks--)},_onConnectionStateChang},_newGamePad:function(t){var e,i={buttons:[]};for(i._buttonEvents=[],i._axisEvents=[],e=0;e<t.buttons.length;e++)i._buttonEvents[e]={buttondown:this._initEvent("buttondown",e,t.index,"button"),buttonup:this._initEvent("buttonup",e,t.index,"button"),buttonvalue:this._initEvent("buttonvalue",e,t.index,"button")};for(e=0;e<t.axes.length;e++)i._axisEvents[e]={axis:this._initEvent("axis",e,t.index,"axis")};this._gamePadState[t.index]=i},setValueThreshold:function(t){this._valueThreshold=t},_initEvent:function(t,e,i,r){var n=new Event(t);return n[r]=e,n.gamepadIndex=i,n},populateEvent:function(t,e){e.gamepadIndex=t.gamepadIndex,void 0!==t.button&&(e.button=t.button,e.value=t.value),void 0!==t.axis&&(e.axis=t.axis,e.value=t.value)},isEventRegistered:function(t,e){if(!e.action)return!0;var i=parseInt(e.action);return(void 0===t.button||t.button===i)&&(void 0===t.axis||t.axis===i)},_fireCallback},poll:function(){if(this._nbCallbacks){var t=navigator.getGamepads();if(t)for(var e=0;e<t.length;e++){var i=t[e];if(i){var r=this._gamePadState[e];if(r){var n=this._callbacks.buttondown,a=this._callbacks.buttonup,s=this._callbacks.buttonvalue;if(n||a||s)for(var o=0;o<i.buttons.length;o++){var h=i.buttons[o],u=r._buttonEvents[o].buttondown;u.value=h.value;var c=r._buttonEvents[o].buttonup;if(c.value=h.value,h.pressed&&!r.buttons[o]&&(n&&n.length&&this._fireCallbacks(n,u),r.buttons[o]=h.pressed),!h.pressed&&r.buttons[o]&&(a&&a.length&&this._fireCallbacks(a,c),r.buttons[o]=!1),h.pressed&&s&&s.length){var l=r._buttonEvents[o].buttonvalue;l.value=h.value,Math.abs(h.value)>=this._valueThreshold&&this._fireCallbacks(s,l)}}var _=this._callbacks.axis;if(_)for(o=0;o<i.axes.length;o++){var d=i.axes[o],f=r._axisEvents[o].axis;f.value=d,Math.abs(d)>=this._valueThreshold&&this._fireCallbacks(_,f)}}}}}}}),"osgViewer","InputSourceGamePad");const Ia=Ma;var wa=function(){ba.call(this),this._target=window,this._callbacks=[],this._nbCallbacks=0,this._event=new Event("deviceorientation"),this._supportedEvents=["deviceorientation","orientationchange"],this._update=this.onDeviceOrientation.bind(this)};a.Z.createPrototypeObject(wa,a.Z.objectInherit(ba.prototype,{getName:function(){return"DeviceOrientation"},setEnable:function(t,e,i){if("orientationchange"!==t){var r=this._callbacks,n=r.indexOf(e);i?n<0&&(r.push(e),this._nbCallbacks++):n>=0&&(r.splice(n,1),this._nbCallbacks--),1===this._nbCallbacks&&window.addEventListener(t,this._update),0===this._nbCallbacks&&window.removeEventListener(t,this._update)}else i?this._target.addEventListener(t,e):this._target.removeEventListener(t,e)},onDeviceOrientatio},populateEven},isEventRegistered:function(t){if("deviceorientation"===t.type){if(null===t.alpha||void 0===t.alpha)return!1}else if(null===window.orientation||void 0===window.orientation)return!1;return!0},poll:function(){if(this._nbCallbacks)for(var t=0;t<this._callbacks.length;t++)this._callbacks[t](this._event)}}),"osgViewer","InputSourceDeviceOrientation");const Na=wa;var Pa=function(t){ba.call(this,t),this._defaultRatio=s.K4.fromValues(1,1),this._hammerEvents=["pan","pinch","press","rotate","swipe","doubletap","doubletap2fingers","singletap"],this._supportedEvents=["touchstart","touchend","touchcancel","touchmove"],this._hammer=new(oe().Manager)(t),this._hammer.add(new(oe().Pan)),this._hammer.add(new(oe().Pinch)),this._hammer.get("pan").set({threshold:0,pointers:0});var e=this._hammer.get("pinch");e.set({threshold:.1,enable:!1}),e.recognizeWith(this._hammer.get("pan")),this._hammer.add(new(oe().Tap)({event:"doubletap",pointers:1,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),this._hammer.add(new(oe().Tap)({event:"doubletap2fingers",pointers:2,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),this._hammer.add(new(oe().Tap)({event:"singletap",pointers:1,taps:1,time:250,interval:450,threshold:5,posThreshold:20}))};a.Z.createPrototypeObject(Pa,a.Z.objectInherit(ba.prototype,{getName:function(){return"TouchScreen"},setEnable:function(t,e,i){this._isNativeEvent(t)?i?this._target.addEventListener(t,e,{passive:!0}):this._target.removeEventListener(t,e,{passive:!0}):(t.indexOf("pinch")>=0&&i&&this._hammer.get("pinch").set({enable:!0}),i?this._hammer.on(t,e):this._hammer.off(t,e))},populateEvent:function(t,e){if(this._isNativeEvent(t.type)){e.canvasX=e.canvasY=0;for(var i=t.touches.length?t.touches:t.changedTouches,r=i.length,n=0;n<r;++n)e.canvasX+=i[n].clientX/r,e.canvasY+=i[n].clientY/r;e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.altKey=t.altKey,e.metaKey=t.metaKey,e.pointers=t.touches}else e.canvasX=t.center.x,e.canvasY=t.center.y,e.scale=t.scale,e.rotation=t.rotation,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaTime=t.deltaTime,e.direction=t.direction,e.offsetDirection=t.offsetDirection,e.pointers=t.pointers,e.velocity=t.velocity;var a=this._target.getBoundingClientRect();e.canvasX+=-a.left,e.canvasY+=-a.top;var s=this._inputManager.getParam("pixelRatio");s||(s=this._defaultRatio),e.glX=e.canvasX*s[0],e.glY=(this._target.clientHeight-e.canvasY)*s[1]},_isNativeEven},isEventRegistered:function(t,e){if(t.pointerType&&"touch"!==t.pointerType)return!1;if(!e.action)return!0;if(isNaN(e.action))throw"touch action should be a number representing the number of touches";var i=t.pointers;i||(i=t.touches);var r=parseInt(e.action);if("touchend"===t.type||"touchcancel"===t.type){if(i.length>=r)return!1}else if(i.length!==r)return!1;return!0},supportsEvent:function(t){var e=ba.prototype.supportsEvent.call(this,t);if(e)return e;for(var i=0;i<this._hammerEvents.length;i++){var r=this._hammerEvents[i];if(0===t.indexOf(r))return!0}return!1},getHammer:function(){return this._hammer}}),"osgViewer","InputSourceTouchScreen");const Za=Pa;var La=i("hLVw"),Oa=i("QtIg"),Fa=i("nRYw"),Da=i("MQQR"),Ua=i("+VSF"),Ba="ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,ka=function(t,e,i){Tn.Z.call(this),this._startTick=En.Z.instance().tick(),this._stats=void 0,this._running=!1,this._canvas=t;var r=this.initOptions(e),n=this.initWebGLContext(t,r,i);if(!n)throw"No WebGL implementation found";this._updateVisitor=new An.Z,this.setUpView(n.canvas,r),this.initInputManager(r,t),this.initStats(r,t),this._vrSession=null,this._vrSupported=!1,this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._options=r,this._contextLost=!1,this._forceRestoreContext=!0,this.renderBinded=this.render.bind(this)};a.Z.createPrototypeObject(ka,a.Z.objectInherit(Tn.Z.prototype,{initInputManager:function(t,e){var i=new ma;this._inputManager=i,this._initInputSource(Ta,"Mouse",e,t),this._initInputSource(Ea,"Keyboard",document,t),Ba&&this._initInputSource(Za,"TouchScreen",e,t),this._initInputSource(Ca,"WebVR",void 0,t),this._initInputSource(Na,"DeviceOrientation",void 0,t),navigator.getGamepads&&this._initInputSource(Ia,"GamePad",void 0,t),i.addMappings({"viewer.internals:vrSupported":"vrsupported"},function(){this.setVRSupported(!0)}.bind(this)),i.addMappings({"viewer.internals:hmdConnect":"vrdisplayconnected"},function(){this.setVRReady(!0)}.bind(this)),i.addMappings({"viewer.internals:hmdConnectPolyfill":"vrpolyfilled"}.bind(this)),i.setParam("pixelRatio",[this._devicePixelRatio,this._devicePixelRatio])},_initInputSource:function(t,e,i,r){var n=r.InputSources?r.InputSources[e]:void 0;if(n){if(!1!==n.enable){var a=n.sourceElement||i;this._inputManager.registerInputSource(new t(a,n))}}else this._inputManager.registerInputSource(new t(i))},getInputManager:function(){return this._inputManager},initOptions:function(t){var e=new xn.Z;return t&&e.extend(t),e.extendWithOptionsURL(),!0===e.getBoolean("traceLogCall")&&(L.Z.traceLogCall=!0),!0===e.getBoolean("enableFrustumCulling")&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e.xrCompatible=!Ua.d,e},initWebGLContext:function(t,e,i){e.get("SimulateWebGLLostContext")&&((t=Nn.makeLostContextSimulatingCanvas(t)).loseContextInNCalls(e.get("SimulateWebGLLostContext")),this._canvas=t);var r=In.Z.setupWebGL(t,e,i);return t.addEventListener("webglcontextlost",function(t){this.contextLost(),!1!==this._forceRestoreContext&&t.preventDefault()}.bind(this),!1),t.addEventListener("webglcontextrestored",function(){this.contextRestored()}.bind(this),!1),(L.Z.reportWebGLError||e.get("reportWebGLError"))&&(r=Nn.makeDebugContext(r)),this.initWebGLCaps(r),this.setGraphicContext(r),r},setContextLostCallback:function(t){this._contextLostCallback=t,this._contextLost&&(this._forceRestoreContext=t())},setContextRestoreCallback:function(t){this._contextRestoreCallback=t},contextLost:function(){L.Z.log("webgl context lost"),this._contextLostCallback&&(this._forceRestoreContext=this._contextLostCallback()),this._contextLost=!0,window.cancelAnimationFrame(this._requestID)},contextRestored:function(){!1!==this._forceRestoreContext?(this.restoreContext(),L.Z.log("webgl context restored")):L.Z.log("webgl context restore not supported - please reload the page - ")},restoreContext:function(){var t=this.getGraphicContext();sr.Z.onLostContext(t),ar.Z.onLostContext(t),Y.Z.onLostContext(t),Mn.Z.onLostContext(t),rr.Z.onLostContext(t),qt.Z.getTextureManager(t).onLostContext(t),Cn.Z.onLostContext(t),this.getCamera().getRenderer().getState().resetCaches(),this.initWebGLCaps(t,!0),this.setGraphicContext(t),Rn.Z.instance(this.getGraphicContext(),!0),this._stats&&this._stats.reset(),this._contextLost=!1,this._requestRedraw=!0,this._contextRestoreCallback&&this._contextRestoreCallback(t),this._runImplementation()},init:function(){},getUpdateVisitor:function(){return this._updateVisitor},getStat},initStats:function(t){var e=Rn.Z.instance(this.getGraphicContext());t.getBoolean("stats")?(this._stats=new Kn(this,t),this._stats.addConfig(Yn),this._stats.addConfig(ua),this._stats.addConfig(da),this.getCamera().addChild(this._stats.getNode()),e.setCallback(this.callbackTimerGPU.bind(this))):e.disable()},callbackTimerGPU:function(t,e){this._stats&&this._stats.getCounter(e).set(t/1e6)},getViewerStats:function(){return this._stats},renderingTraversal:function(){if(this.getState()._frameStamp=this._frameStamp,this.getScene().getSceneData()&&this.getScene().getSceneData().getBound(),this.getCamera()){var t=this._stats,e=Rn.Z.instance(this.getGraphicContext()),i=this.getCamera().getRenderer();if(t&&t.getCounter("cull").start(),i.cull(),t&&t.getCounter("cull").end(),e.pollQueries(),e.start("glframe"),t&&t.getCounter("render").start(),i.draw(),t&&t.getCounter("render").end(),e.end("glframe"),t){var r=i.getCullVisitor();t.getCounter("cullcamera").set(r._numCamera),t.getCounter("cullmatrixtransform").set(r._numMatrixTransform),t.getCounter("cullprojection").set(r._numProjection),t.getCounter("cullnode").set(r._numNode),t.getCounter("culllightsource").set(r._numLightSource),t.getCounter("cullgeometry").set(r._numGeometry),t.getCounter("pushstateset").set(i.getState()._numPushStateSet),t.getCounter("applyStateSet").set(i.getState()._numApply)}}},updateTraversal:function(){var t=this._stats;t&&t.getCounter("update").start(),this._updateVisitor.resetStats(),this.getScene().updateSceneGraph(this._updateVisitor),t&&t.getCounter("updatecallback").set(this._updateVisitor._numUpdateCallback),this.getDatabasePager().releaseGLExpiredSubgraphs(.005),this.flushDeletedGLObjects(.005),t&&t.getCounter("update").end()},advance:function(t){var e=t;void 0===e&&(e=Number.MAX_VALUE);var i=this._frameStamp,r=i.getFrameNumber();i.setFrameNumber(r+1);var n=En.Z.instance().deltaS(this._startTick,En.Z.instance().tick());i.setReferenceTime(n);var a=i.getSimulationTime();i.setSimulationTime(e===Number.MAX_VALUE?n:e),i.setDeltaTime(i.getSimulationTime()-a)},beginFrame:function(){var t=this._stats;t&&(t.getCounter("frame").start(),t.getCounter("raf").tick(),t.getCounter("fps").frame())},endFrame:function(){this._stats&&(qt.Z.getTextureManager(this.getGraphicContext()).updateStats(this._stats),this._stats.getCounter("stats").start(),this._stats.update(),this._stats.getCounter("stats").end(),this._stats.getCounter("frame").end())},checkNeedToDoFram},frame:function(t,e){if(!this._contextLost){this.beginFrame(),this.advance();var i=this.updateViewport(),r={};this._vrSession&&(r.frame=e,r.xrReferenceSpace=this._xrReferenceSpace,this._xrFrame=e),this._inputManager.update(r),this._updateVisitor.setFrameStamp(this.getFrameStamp()),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),s._E.copy(this.getCamera().getViewMatrix(),this.getManipulator().getInverseMatrix())),(this.checkNeedToDoFrame()||i)&&(this._requestRedraw=!1,this.updateTraversal(),this.renderingTraversal()),this.endFrame()}},stop:function(){this._running=!1},isRunning:function(){return this._running},render:function(t,e){this.isRunning()&&(this._requestID=this._requestAnimationFrame(this.renderBinded),this.frame(t,e))},_runImplementation:function(){this.render()},ru},setVRSupported:function(t){t&&console.log("Webxr, is supported!"),this._vrSupported=!!t},setVRReady:function(t){t&&console.log("Found the VR DISPLAY"),this._vRReady=!!t},isVRSupported:function(){return this._vrSupported},setVRPolyfilled:function(t){console.log("Webxr supported through polyfill"),this._vrPolyfilled=!!t},getVRSession:function(){return this._vrSession},getXRPose:function(t){if(this._xrFrame)return this._xrFrame.getPose(t,this._xrReferenceSpace)},needsVRPolyFil},loadWebxrPolyFill:function(){return i.e(5332).the}.bind(null,i)).catch(i.oe).then(function(){return new window.WebXRPolyfill.default,this._vrPolyfillLoaded=!0,this.getInputManager().getInputSource("WebVR").pollHeadset().the}.bind(this)).catch(function(t){return this.setVRSupported(!1),this.setVRReady(!1),Pt().reject(t)}.bind(this))}.bind(this))},_getVRPixelRatio:function(t){return(0,Da.Z)().vrScaleRtt>0?(0,Da.Z)().maxDevicePixelRatio:window.XRWebGLLayer.getNativeFramebufferScaleFactor(t)},setPresentVR:function(t){if(!this.isVRSupported())return L.Z.warn("VR not supported by the browser!"),Pt().reject("VR not supported by the browser!");if(!this._vRReady)return L.Z.log("VR headset not plugged in or immersive session not supported!"),Pt().reject("VR headset not plugged in or immersive session not supported!");var e,i=function(t){return this._xrReferenceSpace=t,window.cancelAnimationFrame(this._requestID),this._requestAnimationFrame=this._vrSession.requestAnimationFrame.bind(this._vrSession),this._requestID=this._requestAnimationFrame(this.renderBinded),this.getCamera().frameBufferObject=new rr.Z,this.getCamera().frameBufferObject.setFrameBufferObject(this,e.framebuffer),this._vrSession}.bind(this),r=function(t){this._vrSession=t;var r=1/this._getVRPixelRatio(t);return e=new window.XRWebGLLayer(this._vrSession,this.getGraphicContext(),{framebufferScaleFactor:r}),this._vrSession.updateRenderState({baseLayer:e}),t.requestReferenceSpace("local").then(i).catch((function(t){return t}))}.bind(this);if(t)return this._vrSession?Pt().resolve(this._vrSession):navigator.xr.requestSession("immersive-vr").then(r).catch((function(t){return console.log(t),t}));if(this._vrSession){this._vrSession.cancelAnimationFrame(this._requestID),this.getCamera().frameBufferObject=new rr.Z,this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._requestID=this._requestAnimationFrame(this.renderBinded);var n=this._vrSession.end();return this._vrSession=void 0,n}},setupManipulator:function(t){void 0===t&&(t=new qi({inputManager:this._inputManager})),void 0!==t.setNode?t.setNode(this.getSceneData()):t.view=this,t.setCamera(this.getCamera()),this.setManipulator(t)},updateViewport:function(){var t=this.getGraphicContext().canvas;if(!this.computeCanvasSize(t))return!1;var e=this.getCamera(),i=e.getViewport(),r=i.width(),n=i.height(),a=t.width/r,o=t.height/n,h=a/o;return i.setViewport(Math.round(i.x()*a),Math.round(i.y()*o),Math.round(i.width()*a),Math.round(i.height()*o)),1!==h&&s._E.mul(e.getProjectionMatrix(),e.getProjectionMatrix(),s._E.fromScaling(s._E.create(),[1/h,1,1])),!0},setManipulator:function(t){this.setEnableManipulator(!1),t.getCamera()||t.setCamera(this.getCamera()),t.setEnable(!0),Tn.Z.prototype.setManipulator.call(this,t)},setEnableManipulato},dispose:function(){La.Z.clean(),Oa.Z.clean(),Fa.Z.pooledStateGraph.clean()}}),"osgViewer","Viewer");const Va=ka;var Ga=i("5ZWq"),ja={};ja.Renderer=yn.Z,ja.View=Tn.Z,ja.Viewer=Va,ja.Scene=Ga.Z,ja.InputGroups=Ne.Z;const Wa=ja;var Ha=i("Kvhv"),za=i("WWMP"),qa=function(t,e){za.Z.call(this),this._enable=!t,this._shadowReceiveAttribute=e,this._dirtyHash=!0,this._hash=""};a.Z.createPrototypeStateAttribute(qa,a.Z.objectInherit(za.Z.prototype,{attributeType:"ShadowCast",cloneTyp},setReceiveAttribute:function(t){this._shadowReceiveAttribute=t},getReceiveAttribute:function(){return this._shadowReceiveAttribute},getDefines:function(){return this._shadowReceiveAttribute.getDefines()},_computeInternalHash:function(){return"ShadowCast"+this._enable+this._shadowReceiveAttribute.getPrecision()},getHash:function(){return this._shadowReceiveAttribute&&this._shadowReceiveAttribute._dirtyHash&&(this._receiveAttributeDirty=!0),this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},isEnabled:function(){return this._enable}}),"osgShadow","ShadowCastAttribute");const Xa=qa;var Ka=i("2Vrk"),Ya=i("Ln1o"),Qa=function(t){q.Z.call(this),this._noCastMask=t,this._nodeList=[]};a.Z.createPrototypeObject(Qa,a.Z.objectInherit(q.Z.prototype,{rese},removeNodeFromCasting:function(t){var e=t.getNodeMask();-1===e?(e=this._noCastMask,t.setNodeMask(e),this._nodeList.push(t)):0!=(e&~this._noCastMask)&&(t.setNodeMask(e|this._noCastMask),this._nodeList.push(t))},apply:function(t){var e=t.getStateSet();if(e){var i=e.getAttribute("BlendFunc");if(void 0!==i&&i.getSource()!==Xt.Z.DISABLE){var r=e.getAttribute("Depth");if(r&&(r.getFunc()===$i.Z.DISABLE||!1===r.getWriteMask()))return void this.removeNodeFromCasting(t)}}t.getTypeID()!==Ka.Z.typeID&&t.getTypeID()!==Ya.Z.typeID?t.getTypeID()===ir.Z.typeID&&t.isRenderToTextureCamera()?this.removeNodeFromCasting(t):this.traverse(t):this.removeNodeFromCasting(t)},setNoCastMask:function(t){this._noCastMask=t},restore:function(){for(var t=0,e=this._nodeList.length;t<e;t++){var i=this._nodeList[t],r=i.getNodeMask();r===this._noCastMask?i.setNodeMask(-1):i.setNodeMask(r&~this._noCastMask)}}}),"osgShadow","ShadowCasterVisitor");const Ja=Qa;var $a,ts=i("cyFB"),es=i("bDLW"),is=function(){q.Z.call(this,q.Z.TRAVERSE_ALL_CHILDREN),this._pooledMatrix=new ts.Z(s._E.create),this._matrixStack=new es.Z,this._matrixStack.push(s._E.IDENTITY),this._bb=new zn.Z,this._bs=new he.Z};a.Z.createPrototypeObject(is,a.Z.objectInherit(q.Z.prototype,{reset:function(t,e,i,r,n){this.setTraversalMask(t),this._cameraFrustum=i,this._lightFrustum=n,this.getCameraPlaneMaskForLightNear(e,i,r?6:4),this._pooledMatrix.reset(),this._matrixStack.reset(),this._matrixStack.push(s._E.IDENTITY),this._bb.init()},getBoundingBox:function(){return this._bb},getCameraPlaneMaskForLightNear:function(t,e,i){var r,n=1,a=15;for(r=0;r<i;++r)a=a<<1|1;var s=e.getPlanes();for(r=0;r<i;++r)fe.Z.distanceToPlane(s[r],t)<0&&(a^=n),n<<=1;return this._cameraPlaneMaskedByLightNear=a,e.setResultMask(a),e.pushCurrentMask(a),a},applyTransform:function(t){var e=this._pooledMatrix.getOrCreateObject();s._E.copy(e,this._matrixStack.back()),t.computeLocalToWorldMatrix(e,this);var i=this._bs;t.getBound().transformMat4(this._bs,e),(0===this._cameraFrustum.getCurrentMask()||this._cameraFrustum.containsBoundingSphere(i))&&(0===this._lightFrustum.getCurrentMask()||this._lightFrustum.containsBoundingSphere(i))&&(this._cameraFrustum.pushCurrentMask(),this._lightFrustum.pushCurrentMask(),this.pushMatrix(e),this.traverse(t),this._cameraFrustum.popCurrentMask(),this._lightFrustum.popCurrentMask(),this.popMatrix())},applyBoundingBox:($a=new zn.Z,function(t){var e=this._matrixStack.back();s._E.exactEquals(e,s._E.IDENTITY)?this._bb.expandByBoundingBox(t):t.valid()&&(t.transformMat4($a,e),this._bb.expandByBoundingBox($a))}),apply:function(t){var e=t.getTypeID();if(t instanceof Ht.Z)this.applyTransform(t);else if(e!==Dt.Z.getTypeID())e===ir.Z.getTypeID()||Ka.Z.getTypeID(),this.traverse(t);else{var i=this._bs;if(t.getBound().transformMat4(i,this._matrixStack.back()),0!==this._cameraFrustum.getCurrentMask()&&!this._cameraFrustum.containsBoundingSphere(i))return;if(0!==this._lightFrustum.getCurrentMask()&&!this._lightFrustum.containsBoundingSphere(i))return;this.applyBoundingBox(t.getBoundingBox())}},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()}}),"osgShadow","ComputeMultiFrustumBoundsVisitor");const rs=is;var ns=function(t,e){za.Z.call(this),this._lightNumber=t,this._bias=.001,this._normalBias=void 0,this._precision="UNSIGNED_BYTE",this._kernelSizePCF=void 0,this._fakePCF=!0,this._jitterOffset="none",this._enable=!e,this._isAtlasTexture=!1,this._dirtyHash=!0,this._hash=""};ns.uniforms={},a.Z.createPrototypeStateAttribute(ns,a.Z.objectInherit(za.Z.prototype,{attributeType:"ShadowReceive",cloneTyp},getTypeMembe},getLightNumber:function(){return this._lightNumber},getUniformName:function(t){return"u"+(this.getType()+this.getLightNumber().toString())+"_"+t},getAtlas:function(){return this._isAtlasTexture},setAtlas:function(t){this._isAtlasTexture=t},setBias:function(t){this._bias=t},getBias:function(){return this._bias},setNormalBias:function(t){this._normalBias=t},getNormalBias:function(){return this._normalBias},setJitterOffset:function(t){this._jitterOffset=t},getJitterOffset:function(){return this._jitterOffset},getKernelSizePCF:function(){return this._kernelSizePCF},setKernelSizePCF:function(t){this._kernelSizePCF=t,this._dirtyHash=!0},setPrecision:function(t){this._precision=t,this._dirtyHash=!0},getPrecision:function(){return this._precision},setLightNumber:function(t){this._lightNumber=t,this._dirtyHash=!0},getOrCreateUniforms:function(){var t=ns,e=this.getTypeMember();return t.uniforms[e]||(t.uniforms[e]={bias:tr.Z.createFloat(this.getUniformName("bias")),normalBias:tr.Z.createFloat(this.getUniformName("normalBias"))}),t.uniforms[e]},getDefines:function(){var t=[];switch(this.getKernelSizePCF()){case"4Tap(16texFetch)":t.push("#define _PCFx4");break;case"9Tap(36texFetch)":t.push("#define _PCFx9");break;case"16Tap(64texFetch)":t.push("#define _PCFx25");break;default:t.push("#define _PCFx1")}return"UNSIGNED_BYTE"!==this.getPrecision()&&t.push("#define _FLOATTEX"),this.getAtlas()&&t.push("#define _ATLAS_SHADOW"),this.getNormalBias()&&t.push("#define _NORMAL_OFFSET"),"none"!==this.getJitterOffset()&&t.push("#define _JITTER_OFFSET"),t},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.normalBias.setFloat(this._normalBias),t.bias.setFloat(this._bias)}},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHas}}),"osgShadow","ShadowReceiveAttribute");const as=ns;var ss=function(){O.Z.call(this),this._shadowedScene=void 0,this._dirty=!1,this._continuousUpdate=!0,this._needRedraw=!0};a.Z.createPrototypeObject(ss,a.Z.objectInherit(O.Z.prototype,{dirty:function(){this._dirty=!0},getShadowedScene:function(){return this._shadowedScene},setContinuousUpdate:function(t){this._continuousUpdate=t},isContinuousUpdate:function(){return this._continuousUpdate},needRedraw:function(){return this._needRedraw},requestRedraw:function(){this._needRedraw=!0},setShadowedScene:function(t){this._shadowedScene=t},init:function(){L.Z.log("No ShadowTechnique activated: normal rendering activated")},valid:function(){return!1},updateShadowTechnique:function(){},cullShadowCasting:function(){},cleanSceneGrap}}),"osgShadow","ShadowTechnique");const os=ss;var hs=function(){qt.Z.call(this),this._uniforms={},this._mapSize=s.vh.create(),this._renderSize=s.K4.create(),this._lightNumber=-1,this._dirtyHash=!0,this._hash=""};hs.uniforms={},a.Z.createPrototypeStateAttribute(hs,a.Z.objectInherit(qt.Z.prototype,{cloneType:function(){return new hs},invalidat},hasLightNumbe},setLightNumber:function(t){this._lightNumber=t,this._dirtyHash=!0},getLightNumber:function(){return this._lightNumber},getUniformName:function(t){return"u"+("Shadow_"+this.getType()+this._lightNumber.toString())+"_"+t},setInternalFormatType:function(t){qt.Z.prototype.setInternalFormatType.call(this,t),this._dirtyHash=!0},getOrCreateUniforms:function(t){var e=hs;if(L.Z.assert(void 0!==t),L.Z.assert(-1!==this._lightNumber),void 0!==e.uniforms[t])return e.uniforms[t];var i=e.uniforms[t]={ViewRight:tr.Z.createFloat4(this.getUniformName("viewRight")),ViewUp:tr.Z.createFloat4(this.getUniformName("viewUp")),ViewLook:tr.Z.createFloat4(this.getUniformName("viewLook")),Projection:tr.Z.createFloat3(this.getUniformName("projection")),DepthRange:tr.Z.createFloat2(this.getUniformName("depthRange")),MapSize:tr.Z.createFloat4(this.getUniformName("mapSize")),RenderSize:tr.Z.createFloat2(this.getUniformName("renderSize"))},r="Texture"+t,n=tr.Z.createInt1(t,r);return i[r]=n,e.uniforms[t]},setViewMatrix:function(t){this._viewMatrix=t},setProjection:function(t){this._projection=t},setDepthRange:function(t){this._depthRange=t},setTextureSize:function(t,e){qt.Z.prototype.setTextureSize.call(this,t,e),this.dirty(),this._mapSize[0]=t,this._mapSize[1]=e,this._mapSize[2]=1/t,this._mapSize[3]=1/e,this._renderSize[0]=1/t,this._renderSize[1]=1/e},_updateViewMatrixUniforms:function(t,e,i,r){var n,a=t;(n=e.getInternalArray())[0]=a[0],n[1]=a[4],n[2]=a[8],n[3]=a[12],(n=i.getInternalArray())[0]=a[1],n[1]=a[5],n[2]=a[9],n[3]=a[13],(n=r.getInternalArray())[0]=a[2],n[1]=a[6],n[2]=a[10],n[3]=a[14]},apply:function(t,e){if(qt.Z.prototype.apply.call(this,t,e),-1!==this._lightNumber){var i=this.getOrCreateUniforms(e);this._updateViewMatrixUniforms(this._viewMatrix,i.ViewRight,i.ViewUp,i.ViewLook),i.Projection.setFloat3(this._projection),i.DepthRange.setFloat2(this._depthRange),i.MapSize.setFloat4(this._mapSize),i.RenderSize.setFloat2(this._renderSize)}},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+"_"+this._lightNumber+"_"+this._type}}),"osgShadow","ShadowTexture");const us=hs;var cs=i("rsXr"),ls=function(t){this._shadowTechnique=t};a.Z.createPrototypeObject(ls,{cull:function(t,e){this._shadowTechnique.getShadowedScene().nodeTraverse(e);var i=e.getCurrentCullingSet(),r=e.getCurrentProjectionMatrix(),n=e.getComputedNear(),a=e.getComputedFar();return n===1/0&&a===-1/0?(this._shadowTechnique.markSceneAsNoShadow(),!1):(s._E.getFrustumPlanes(i.getFrustum().getPlanes(),r,e.getCurrentModelViewMatrix(),!1),i.getFrustum().setupMask(6),this._shadowTechnique.setLightFrustum(i.getFrustum(),n,a),!1)}},"osgShadow","CameraCullCallback");var _s=function(t,e){os.call(this),this._projectionMatrix=s._E.create(),this._projection=s.R3.create(),this._viewMatrix=s._E.create(),this._lightNumberArrayIndex=-1,this._lightUp=s.R3.fromValues(0,0,1),this._light=t.light,this._cameraShadow=new ir.Z,this._cameraShadow.setCullCallback(new ls(this)),this._cameraShadow.setRenderOrder(ir.Z.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(nn.Z.ABSOLUTE_RF),this._cameraShadow.setClearColor(s.vh.fromValues(1,1,1,1)),e?this._texture=e:(this._texture=new us,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0),this._textureSize=256;var i=tr.Z.createFloat2("RenderSize");this._texelSizeUniform=tr.Z.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=i.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._receivingStateset=void 0,this._casterStateSet=new er.Z,this._casterStateSet.addUniform(tr.Z.createFloat1(0,"exponent0")),this._casterStateSet.addUniform(tr.Z.createFloat1(0,"exponent1")),this._casterStateSet.addUniform(tr.Z.createFloat1(.005,"bias")),this._casterStateSet.addUniform(this._texelSizeUniform),this._casterStateSet.addUniform(i),this._casterStateSet.setAttributeAndModes(new $i.Z($i.Z.LESS),za.Z.ON|za.Z.OVERRIDE),this._casterStateSet.setAttributeAndModes(new Xt.Z,za.Z.ON|za.Z.OVERRIDE),this._shadowReceiveAttribute=new as(this._light.getLightNumber()),this._casterStateSet.setAttributeAndModes(this._shadowReceiveAttribute,za.Z.ON|za.Z.OVERRIDE),this._shadowCastShaderGeneratorName="ShadowCast";var r=tr.Z.createFloat4("uShadowDepthRange");this._casterStateSet.addUniform(r),this._depthRange=r.getInternalArray(),this._depthRange[0]=.001,this._depthRange[1]=1e3,this._worldLightPos=s.vh.create(),this._worldLightPos[3]=0,this._worldLightDir=s.vh.create(),this._worldLightDir[3]=1,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,this._tmpVec=s.R3.create(),this._tmpVecBis=s.R3.create(),this._tmpVecTercio=s.R3.create(),this._tmpMatrix=s._E.create(),t&&this.setShadowSettings(t),this._infiniteFrustum=!0;var n=new Xa(!1,this._shadowReceiveAttribute);this._casterStateSet.setAttributeAndModes(n,za.Z.ON|za.Z.OVERRIDE),this._casterStateSet.setShaderGeneratorName(this._shadowCastShaderGeneratorName,za.Z.OVERRIDE|za.Z.ON),this._debug=!1};a.Z.createPrototypeObject(_s,a.Z.objectInherit(os.prototype,{getDepthRange:function(){return this._depthRange},setLightFrustum:function(t,e,i){this._lightFrustum=t,this._depthRange[0]=e,this._depthRange[1]=i,this.nearFarBounding(),this._debug&&(this._debugGeomFrustum.updateGeometry(this._projectionMatrix,this._depthRange),s._E.invert(this._debugNodeFrustum.getMatrix(),this._viewMatrix))},getCamera:function(){return this._cameraShadow},getTexture:function(){return this._texture},isDirty:function(){return this._dirty},setTextureUnitBas},setShadowSettings:function(t){t&&(this._light=t.light,this._shadowCastShaderGeneratorName=t.getShadowCastShaderGeneratorName(),this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),this.setLight(this._light),this.setTextureSize(t.textureSize),this.setTexturePrecision(t.textureType),this.setKernelSizePCF(t.kernelSizePCF),this.setBias(t.bias),this.setNormalBias(t.normalBias))},setCastsShadowDrawTraversalMask:function(t){this._castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this._castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},getNormalBias:function(){return this._shadowReceiveAttribute.getNormalBias()},setNormalBias:function(t){this._shadowReceiveAttribute.setNormalBias(t)},getJitterOffset:function(){return this._shadowReceiveAttribute.getJitterOffset()},setJitterOffset:function(t){this._shadowReceiveAttribute.setJitterOffset(t)},getBias:function(){return this._shadowReceiveAttribute.getBias()},setBias:function(t){this._shadowReceiveAttribute.setBias(t),this._casterStateSet.getUniformList().bias.getUniform().setFloat(t)},getKernelSizePCF:function(){return this._shadowReceiveAttribute.getKernelSizePCF()},setKernelSizePCF:function(t){this._shadowReceiveAttribute.setKernelSizePCF(t)},setShadowedScene:function(t){os.prototype.setShadowedScene.call(this,t),this._receivingStateset=this._shadowedScene.getReceivingStateSet(),this.dirty()},checkLightNumber:function(){var t=this._light.getLightNumber();this._shadowReceiveAttribute.getLightNumber()!==t&&this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),this._texture&&!this._texture.hasLightNumber(t)&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())},_rebindFbo:function(){this._cameraShadow.detachAll(),this._cameraShadow.attachTexture(rr.Z.COLOR_ATTACHMENT0,this._texture),this._cameraShadow.attachRenderBuffer(rr.Z.DEPTH_ATTACHMENT,rr.Z.DEPTH_COMPONENT16)},init:function(t,e,i){if(this._shadowedScene){this._needRedraw=!0,this.checkLightNumber();var r=this._light.getLightNumber();t?(this._texture=t,this._lightNumberArrayIndex=e,this._textureUnit=i,this._shadowReceiveAttribute.setAtlas(!0)):(this.initTexture(),this._rebindFbo(),this._textureUnit=this._textureUnitBase+r,this._texture.setLightNumber(r),this._texture.setName("ShadowTexture"+this._textureUnit),this._shadowReceiveAttribute.setAtlas(!1)),this._cameraShadow.setName("light_shadow_camera"+this._light.getName()),this._shadowReceiveAttribute.setLightNumber(r);var n=za.Z.OVERRIDE|za.Z.ON;this._receivingStateset.setAttributeAndModes(this._shadowReceiveAttribute,n),this._preventTextureBindingDuringShadowCasting(),this._casterStateSet.setTextureAttributeAndModes(this._textureUnit,qt.Z.textureNull,za.Z.PROTECTED),this._receivingStateset.setTextureAttributeAndModes(this._textureUnit,this._texture,n),this._dirty=!1}},_preventTextureBindingDuringShadowCasting:function(){for(var t=an.Z.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS"),e=0;e<t;e++)this._casterStateSet.setTextureAttributeAndModes(e,qt.Z.textureNull,za.Z.OVERRIDE|za.Z.ON)},valid:function(){return!0},updateShadowTechnique:function(t,e,i){var r=this._cameraShadow,n=this._texture;if(r&&n){var a=r.getViewport();if(a||(a=new nr.Z,r.setViewport(a)),e){var s=r.getScissor();s||(s=new cs.Z(e[0],e[1],e[2],e[3]),r.setScissor(s)),a.x()===e[0]&&a.y()===e[1]&&a.width()===e[2]&&a.height()===e[3]||(r.setFrameBufferObject(i),a.setViewport(e[0],e[1],e[2],e[3]),s.setScissor(e[0],e[1],e[2],e[3]))}else a.width()===n.getWidth()&&a.height()===n.getHeight()||(this._rebindFbo(),a.setViewport(0,0,n.getWidth(),n.getHeight()))}},updateShadowTechni},setTextureFiltering:function(){var t;switch(this.getTexturePrecision()){case"HALF_FLOAT":t=qt.Z.HALF_FLOAT;break;case"FLOAT":t=qt.Z.FLOAT;break;default:t=qt.Z.UNSIGNED_BYTE}this._texture.setInternalFormatType(t),this._texture.setMinFilter(qt.Z.NEAREST),this._texture.setMagFilter(qt.Z.NEAREST),this._textureMagFilter=qt.Z.NEAREST,this._textureMinFilter=qt.Z.NEAREST},initTexture:function(){var t;this._dirty&&(this._texture||(this._texture=new us,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize,t=qt.Z.RGBA,this.setTextureFiltering(),this._texture.setInternalFormat(t),this._texture.setWrapS(qt.Z.CLAMP_TO_EDGE),this._texture.setWrapT(qt.Z.CLAMP_TO_EDGE),this._texture.dirty())},setTexturePrecision:function(t){t!==this._shadowReceiveAttribute.getPrecision()&&(this._shadowReceiveAttribute.setPrecision(t),this.dirty())},getTexturePrecision:function(){return this._shadowReceiveAttribute.getPrecision()},setTextureSiz},getCasterStateSet:function(){return this._casterStateSet},setLight:function(t){t&&t!==this._light&&(this._light=t,this.dirty())},getUp:function(t){return Math.abs(s.R3.dot(this._lightUp,t))>=1&&(1===this._lightUp[0]?(this._lightUp[0]=0,this._lightUp[1]=1,this._lightUp[2]=0):(this._lightUp[0]=1,this._lightUp[1]=0,this._lightUp[2]=0)),this._lightUp},nearFarBounding:function(){var t=this._depthRange[0],e=this._depthRange[1],i=_s.EPSILON;e<t-i?(this._emptyCasterScene=!0,e=1,t=i):t<i&&(t=i),this._depthRange[0]=t,this._depthRange[1]=e},makePerspectiveFromBoundingBox:function(t,e,i,r,n,a){var o=t.center(this._tmpVec),h=t.radius(),u=_s.EPSILON,c=u,l=1;this._radius=h;var _=s.R3.distance(o,i);_<=h?(c=u,l=_+h):(c=_-h,l=_+h),this._depthRange[0]=c,this._depthRange[1]=l,this.nearFarBounding();var d=this._depthRange[0]*Math.tan(e*Math.PI/180),f=d=d>h?h:d,p=-f,g=d,m=-g,v=this.getUp(r);this._infiniteFrustum?s._E.infiniteFrustum(a,m,g,p,f,this._depthRange[0]):s._E.frustum(a,m,g,p,f,this._depthRange[0],this._depthRange[1]),this._projection[0]=this._projectionMatrix[0],this._projection[1]=this._projectionMatrix[5],this._projection[2]=0,s._E.lookAtDirection(n,i,r,v)},makeOrthoFromBoundingBox:function(t,e,i,r){var n=t.center(this._tmpVecTercio),a=t.radius(),o=a+a,h=1e-4,u=o+1e-4,c=this._tmpVec;s.R3.scaleAndAdd(c,n,e,-o);(h=a)<.001*(u+=a)&&(h=.001*u);var l,_,d=this.getUp(e);s._E.lookAtDirection(i,c,e,d),l=_=a,s._E.ortho(r,-l,l,-_,_,h,u),this._projection[0]=l,this._projection[1]=_,this._projection[2]=1,this._depthRange[0]=h,this._depthRange[1]=u},aimShadowCastingCamera:function(t,e){var i=this._light;if(i){var r=this._cameraShadow,n=this._worldLightPos,a=this._worldLightDir;s._E.copy(this._projectionMatrix,r.getProjectionMatrix()),s._E.copy(this._viewMatrix,r.getViewMatrix());for(var o,h=this._projectionMatrix,u=this._viewMatrix,c=t.getCurrentRenderBin().getPositionedAttribute(),l=c.getArray(),_=0;_<c.getLength();_++){var d=l[_],f=d[1],p=d[0];if(f===i){o=p;break}}if(void 0===o)return L.Z.warn("light isnt inside children of shadowedScene Node"),void(this._emptyCasterScene=!0);var g=this._tmpMatrix;if(s._E.invert(g,t.getCurrentModelViewMatrix()),this._light.isDirectionLight())s.vh.transformMat4(n,i.getPosition(),o),s.vh.transformMat4(n,n,g),s.R3.scale(n,n,-1),s.R3.normalize(n,n),this.makeOrthoFromBoundingBox(e,n,u,h),this._debug&&s._E.invert(this._debugNodeFrustum.getMatrix(),u);else{s._E.mul(this._tmpMatrix,g,o);var m=this._tmpMatrix;s.R3.transformMat4(n,i.getPosition(),m),m[12]=0,m[13]=0,m[14]=0,s._E.invert(m,m),s._E.transpose(m,m),s.R3.copy(a,i.getDirection()),s.vh.transformMat4(a,a,m),s.R3.normalize(a,a),this.makePerspectiveFromBoundingBox(e,i.getSpotCutoff(),n,a,u,h)}s._E.copy(r.getProjectionMatrix(),this._projectionMatrix),s._E.copy(r.getViewMatrix(),this._viewMatrix)}else this._emptyCasterScene=!0},frameShadowCastingFrustum:function(t){this._infiniteFrustum||jt.Z.prototype.clampProjectionMatrix(this._projectionMatrix,this._depthRange[0],this._depthRange[1],t.getNearFarRatio(),this._depthRange);var e=this._cameraShadow;s._E.copy(e.getProjectionMatrix(),this._projectionMatrix),s._E.copy(e.getViewMatrix(),this._viewMatrix),this.setShadowUniformsReceive(!1)},setShadowUniformsReceive:function(t){if(t&&s.K4.set(this._depthRange,0,0),-1!==this._lightNumberArrayIndex){var e=this._light.getLightNumber();this._texture.setViewMatrix(e,this._viewMatrix),this._texture.setProjection(e,this._projection),this._texture.setDepthRange(e,this._depthRange)}else this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjection(this._projection),this._texture.setDepthRange(this._depthRange)},markSceneAsNoShado},cullShadowCasting:function(t,e){if(this._debug){var i=e.getMin(),r=e.getMax();e.center(this._tmpVec);var n=this._debugNodeSceneCast.getMatrix();s._E.fromScaling(n,[r[0]-i[0],r[1]-i[1],r[2]-i[2],1]),s._E.setTranslation(n,this._tmpVec)}if(this._emptyCasterScene=!1,this.aimShadowCastingCamera(t,e),this._emptyCasterScene)this.markSceneAsNoShadow();else{var a=t.getTraversalMask();t.setTraversalMask(this._castsShadowDrawTraversalMask),t.pushStateSet(this._casterStateSet),this._cameraShadow.setEnableFrustumCulling(!0),this._cameraShadow.setComputeNearFar(!0),this._debug&&this._debugNode.accept(t),this._cameraShadow.accept(t),this.nearFarBounding(),this.frameShadowCastingFrustum(t),this._cameraShadow.setComputeNearFar(!1),t.popStateSet(),t.setTraversalMask(a),this._needRedraw=!1}},cleanReceivingStateSet:function(t){if(this._receivingStateset){if(this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),t)return;this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())}},cleanSceneGraph:function(t){this._needRedraw=!0,this.cleanReceivingStateSet(t),this._texture=void 0,this._shadowedScene=void 0},setDebug:function(t){t&&!this._debug&&(this._debugNode||(this._debugGeomFrustum=lr.createDebugFrustumGeometry(),this._debugGeomSceneCast=zt.Z.createBoundingBoxGeometry(),this._debugGeomSceneCast.getPrimitives()[0].mode=dr.Z.LINES,this._debugNode=new Ht.Z,this._debugNodeFrustum=new Ht.Z,this._debugNodeSceneCast=new Ht.Z,this._debugNodeFrustum.addChild(this._debugGeomFrustum),this._debugNodeSceneCast.addChild(this._debugGeomSceneCast),this._debugNode.addChild(this._debugNodeFrustum),this._debugNode.addChild(this._debugNodeSceneCast))),this._debug=t},getDebug:function(){return this._debug},getLightNumber:function(){return this._light.getLightNumber()},getLight:function(){return this._light}}),"osgShadow","ShadowMap"),_s.EPSILON=.005;const ds=_s;var fs=function(){qt.Z.call(this),this._uniforms={},this._lightNumberArray=[],this._viewMatrices=[],this._projection=[],this._depthRanges=[],this._mapSizes=[],this._renderSize=s.K4.create(),this._dirtyHash=!0,this._hash=""};fs.uniforms={},a.Z.createPrototypeStateAttribute(fs,a.Z.objectInherit(qt.Z.prototype,{cloneType:function(){return new fs},getLightNumberArray:function(){return this._lightNumberArray},hasLightNumbe},setLightNumberArray:function(t){this._lightNumberArray=t,this._dirtyHash=!0},getUniformName:function(t,e){return"u"+("Shadow_"+this.getType()+t.toString())+"_"+e},setInternalFormatType:function(t){qt.Z.prototype.setInternalFormatType.call(this,t),this._dirtyHash=!0},createUniforms:function(t,e){e["ViewRight_"+t]=tr.Z.createFloat4(this.getUniformName(t,"viewRight")),e["ViewUp_"+t]=tr.Z.createFloat4(this.getUniformName(t,"viewUp")),e["ViewLook_"+t]=tr.Z.createFloat4(this.getUniformName(t,"viewLook")),e["Projection_"+t]=tr.Z.createFloat3(this.getUniformName(t,"projection")),e["DepthRange_"+t]=tr.Z.createFloat2(this.getUniformName(t,"depthRange")),e["MapSize_"+t]=tr.Z.createFloat4(this.getUniformName(t,"mapSize")),e["RenderSize_"+t]=e.RenderSize},getOrCreateUniforms:function(t){var e=fs;if(L.Z.assert(void 0!==t||0!==this._lightNumberArray.length),void 0!==e.uniforms[t])return e.uniforms[t];var i=e.uniforms[t]={},r=tr.Z.createFloat2(this.getUniformName(0,"renderSize"));i.RenderSize=r;for(var n=0,a=this._lightNumberArray.length;n<a;n++)this.createUniforms(this._lightNumberArray[n],i);var s="Texture"+t,o=tr.Z.createInt1(t,s);return i[s]=o,e.uniforms[t]},setViewMatrix:function(t,e){this._viewMatrices[t]=e},setProjection:function(t,e){this._projection[t]=e},setDepthRange:function(t,e){this._depthRanges[t]=e},setLightShadowMapSize:function(t,e){this._mapSizes[t]=e},apply:function(t,e){if(qt.Z.prototype.apply.call(this,t,e),0!==this._lightNumberArray.length){for(var i=this.getOrCreateUniforms(e),r=0,n=this._lightNumberArray.length;r<n;r++){var a=this._lightNumberArray[r];i["ViewRight_"+a]||this.createUniforms(a,i),us.prototype._updateViewMatrixUniforms.call(this,this._viewMatrices[a],i["ViewRight_"+a],i["ViewUp_"+a],i["ViewLook_"+a]),i["Projection_"+a].setFloat3(this._projection[a]),i["DepthRange_"+a].setFloat2(this._depthRanges[a]),i["MapSize_"+a].setFloat4(this._mapSizes[a])}i.RenderSize.setFloat2(this._renderSize)}},setTextureSize:function(t,e){this._renderSize[0]=1/t,this._renderSize[1]=1/e,qt.Z.prototype.setTextureSize.call(this,t,e),this.dirty()},_computeInternalHash:function(){for(var t=this.getTypeMember(),e=0,i=this._lightNumberArray.length;e<i;e++)t+="_"+this._lightNumberArray[e];return t+="_"+this._type},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash}}),"osgShadow","ShadowTextureAtlas");const ps=fs;var gs=function(t){this._lights=[],this._shadowMaps=[],this._viewportDimension=[],os.apply(this,arguments),this._shadowSettings=t,this._texture=new ps,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0,this._textureSize=1024,this._shadowMapSize=256,this._receivingStateset=void 0,t&&(this.setShadowSettings(t),t.atlasSize&&(this._textureSize=t.atlasSize),t.textureSize&&(this._shadowMapSize=t.textureSize)),this._texelSizeUniform=tr.Z.createFloat1(1/this._textureSize,"texelSize");var e=tr.Z.createFloat2("RenderSize");this._renderSize=e.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize,this._cameraClear=new ir.Z,this._cameraClear.setName("shadowAtlasCameraClear"),this._cameraClear.setRenderOrder(ir.Z.PRE_RENDER,0),this._cameraClear.setClearColor(s.vh.fromValues(1,1,1,1)),this._cameraClear.setFrameBufferObject(new rr.Z),this._cameraClear.setClearMask(0)};a.Z.createPrototypeObject(gs,a.Z.objectInherit(os.prototype,{getTexture:function(){return this._texture},isDirty:function(t){if(void 0!==t)return this._shadowMaps[t].isDirty();for(var e=0,i=this._shadowMaps.length;e<i;e++)if(this._shadowMaps[e].isDirty())return!0;return!1},setTextureUnitBase:function(t){this._textureUnitBase=t,this._textureUnit=t;for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setTextureUnitBase(t)},setShadowSettings:function(t){if(t){this._shadowSettings=t;for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setShadowSettings(t);this.setTextureSize(t.textureSize),this.setTexturePrecision(t.textureType)}},setCastsShadowDrawTraversalMask:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setCastsShadowDrawTraversalMask(t)},getCastsShadowDrawTraversalMask:function(t){return void 0!==t?this._shadowMaps[t].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},setCastsShadowBoundsTraversalMask:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setCastsShadowBoundsTraversalMask(t)},getCastsShadowBoundsTraversalMask:function(t){return void 0!==t?this._shadowMaps[t].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},getNormalBias:function(t){return void 0!==t?this._shadowMaps[t].getNormalBias():0!==this._shadowMaps.length?this._shadowMaps[0].getNormalBias():void 0},setNormalBias:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setNormalBias(t)},getBias:function(t){return void 0!==t?this._shadowMaps[t].getBias():0!==this._shadowMaps.length?this._shadowMaps[0].getBias():void 0},setBias:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setBias(t)},getKernelSizePCF:function(t){return void 0!==t?this._shadowMaps[t].getKernelSizePCF():1!==this._shadowMaps.length?this._shadowMaps[0].getKernelSizePCF():void 0},setKernelSizePCF:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setKernelSizePCF(t)},setShadowedScene:function(t){os.prototype.setShadowedScene.call(this,t),this._receivingStateset=this._shadowedScene.getReceivingStateSet();for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setShadowedScene(t)},setTexturePrecisio},getTexturePrecision:function(t){return void 0!==t?this._shadowMaps[t].getTexturePrecision():1!==this._shadowMaps.length?this._shadowMaps[0].getTexturePrecision():void 0},setTextureSize:function(t){t!==this._textureSize&&(this._shadowMapSize=t,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize,this.dirty())},getShadowMa},addLight:function(t){if(!t||-1!==this._lights.indexOf(t))return L.Z.warn("no light or light already added"),-1;if(this._lights.length!==this._numShadowWidth*this._numShadowHeight){this._lights.push(t),this._shadowSettings.setLight(t);var e=new ds(this._shadowSettings,this._texture);return this._shadowMaps.push(e),this._shadowedScene&&e.setShadowedScene(this._shadowedScene),this.recomputeViewports(),e}L.Z.warn("can't allocate shadow for light "+t.getLightNumber()+" ShadowAtlas already full ")},init:function(){if(this._shadowedScene){this.initTexture();for(var t=[],e=0;e<this._lights.length;e++)t.push(this._lights[e].getLightNumber());this._texture.setLightNumberArray(t),this._textureUnit=this._textureUnitBase,this._texture.setName("ShadowTexture"+this._textureUnit);var i=tr.Z.createFloat2("RenderSize");this._texelSizeUniform=tr.Z.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=i.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this.recomputeViewports();for(var r=0,n=this._shadowMaps.length;r<n;r++){var a=this._shadowMaps[r];this._shadowedScene||(this._shadowedScene=a.getShadowedScene(this._shadowedScene)),this._shadowedScene&&a.setShadowedScene(this._shadowedScene),a.init(this._texture,r,this._textureUnitBase)}}},recomputeViewports:function(){for(var t=this._shadowMaps.length,e=t>2?Math.sqrt(2*Math.ceil(t/2)):t,i=e,r=this._textureSize/i,n=this._textureSize/e,a=this._textureSize/r,o=this._textureSize/n,h=0;h<t;h++){var u=this._shadowMaps[h],c=r*(h%a),l=n*Math.floor(h/o);this._viewportDimension.length<=h?this._viewportDimension.push(s.vh.fromValues(c,l,r,n)):s.vh.set(this._viewportDimension[h],c,l,r,n),this._texture.setLightShadowMapSize(this._lights[h].getLightNumber(),this._viewportDimension[h]),u.dirty()}},vali},updateCameraClear:function(){var t=this._cameraClear,e=this._texture;if(t&&e){var i=t.getViewport();i||(i=new nr.Z,t.setViewport(i)),i.width()===e.getWidth()&&i.height()===e.getHeight()||(t.detachAll(),t.attachTexture(rr.Z.COLOR_ATTACHMENT0,e),t.attachRenderBuffer(rr.Z.DEPTH_ATTACHMENT,rr.Z.DEPTH_COMPONENT16),t.getViewport().setViewport(0,0,e.getWidth(),e.getHeight()))}},updateShadowTechnique:function(t){this.updateCameraClear();for(var e=this._cameraClear.getFrameBufferObject(),i=0,r=this._shadowMaps.length;i<r;i++)this._shadowMaps[i].updateShadowTechnique(t,this._viewportDimension[i],e)},initTexture:function(){var t;this._dirty&&(this._texture||(this._texture=new ps,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize,t=qt.Z.RGBA,ds.prototype.setTextureFiltering.call(this),this._texture.setInternalFormat(t),this._texture.setWrapS(qt.Z.CLAMP_TO_EDGE),this._texture.setWrapT(qt.Z.CLAMP_TO_EDGE),this._texture.dirty())},cullShadowCasting:function(t,e){this._cameraClear.accept(t);for(var i=0,r=this._shadowMaps.length;i<r;i++){var n=this._shadowMaps[i];(n.isContinuousUpdate()||n.needRedraw())&&n.cullShadowCasting(t,e)}},isContinuousUpdate:function(){for(var t=0,e=this._shadowMaps.length;t<e;t++)if(this._shadowMaps[t].isContinuousUpdate())return!0;return!1},needRedraw:function(){for(var t=0,e=this._shadowMaps.length;t<e;t++)if(this._shadowMaps[t].needRedraw())return!0;return!1},removeShadowMap:function(t){if(this._shadowMaps.length>0){var e=this._shadowMaps.indexOf(t);if(-1!==e){this._shadowMaps[e].valid()&&this._shadowMaps[e].cleanSceneGraph(!0),this._shadowMaps.splice(e,1);var i=this._texture.getLightNumberArray();-1!==(e=i.indexOf(t.getLightNumber()))&&i.splice(e,1);var r=t.getLight();-1!==(e=this._lights.indexOf(r))&&this._lights.splice(e,1),this._viewportDimension.length>e&&this._viewportDimension.splice(e,1),this.recomputeViewports()}}},addShadowMap:function(t){if(!(this._shadowMaps.length>0&&-1!==this._shadowMaps.indexOf(t))){this._shadowMaps.push(t);var e=t.getLight();-1===this._lights.indexOf(e)&&this._lights.push(e),this._shadowedScene&&t.setShadowedScene(this._shadowedScene);var i=this._texture.getLightNumberArray();-1===i.indexOf(t.getLightNumber())&&i.push(e.getLightNumber()),this.recomputeViewports()}},cleanReceivingStateSet:function(){if(this._receivingStateset){this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember());for(var t=0,e=this._shadowMaps.length;t<e;t++)this._shadowMaps[t].cleanReceivingStateSet()}},cleanSceneGrap},setDebug:function(t,e){if(e)this._shadowMaps[e].setDebug(t);else for(var i=0,r=this._shadowMaps.length;i<r;i++)this._shadowMaps[i].setDebug(t)},markSceneAsNoShado}}),"osgShadow","ShadowMapAtlas");const ms=gs;var vs=function(t){this.castsShadowDrawTraversalMask=4294967295,this.castsShadowBoundsTraversalMask=4294967295,this.textureSize=1024,this.textureType="UNSIGNED_BYTE",this.textureFormat=qt.Z.RGBA,this.shadowProjection="fov",this.fov=50,this.kernelSizePCF="4Tap(4texFetch)",this.bias=.005,this.normalBias=void 0,this.shadowCastShaderGeneratorName="ShadowCast",a.Z.objectMix(this,t)};vs.kernelSizeList=["1Tap(4texFetch)","4Tap(16texFetch)","9Tap(36texFetch)","16Tap(64texFetch)"],vs.prototype={setCastsShadowDrawTraversalMask:function(t){this.castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this.castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this.castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this.castsShadowBoundsTraversalMask},setLight:function(t){this.light=t},getLight:function(){return this.light},setTextureSize:function(t){this.textureSize=t},getTextureSize:function(){return this.textureSize},setTextureType:function(t){this.textureType=t},getTextureType:function(){return this.textureType},setTextureFormat:function(t){this.textureFormat=t},getTextureFormat:function(){return this.textureFormat},setShadowCastShaderGeneratorName:function(t){this.shadowCastShaderGeneratorName=t},getShadowCastShaderGeneratorName:function(){return this.shadowCastShaderGeneratorName}};const bs=vs;var Ss=i("t+pa"),ys=function(t){Kt.Z.call(this),this._shadowTechniques=[],this._optimizedFrustum=!1,this._frustumReceivers=[s.vh.create(),s.vh.create(),s.vh.create(),s.vh.create(),s.vh.create(),s.vh.create()],this._tmpMat=s._E.create(),this._receivingStateset=new er.Z,this._computeBoundsVisitor=new Ss.Z,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,t&&this.setShadowSettings(t)};a.Z.createPrototypeNode(ys,a.Z.objectInherit(Kt.Z.prototype,{getReceivingStateSet:function(){return this._receivingStateset},getShadowTechniques:function(){return this._shadowTechniques},addShadowTechnique:function(t){this._shadowTechniques.length>0&&-1!==this._shadowTechniques.indexOf(t)||(this._shadowTechniques.push(t),t.valid()&&(t.setShadowedScene(this),t.dirty()))},removeShadowTechnique:function(t){if(this._shadowTechniques.length>0){var e=this._shadowTechniques.indexOf(t);-1!==e&&(this._shadowTechniques[e].valid()&&this._shadowTechniques[e].cleanSceneGraph(),this._shadowTechniques.splice(e,1))}},cleanSceneGraph:function(){for(var t=0,e=this._shadowTechniques.length;t<e;t++)this._shadowTechniques[t]&&this._shadowTechniques[t].valid()&&this._shadowTechniques[t].cleanSceneGraph()},dirt},nodeTravers},setShadowSettings:function(t){this._settings=t,this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),!1!==t.userShadowCasterVisitor&&(this._removeNodesNeverCastingVisitor=t.userShadowCasterVisitor||new Ja(this._castsShadowTraversalMask))},setCastsShadowDrawTraversalMask:function(t){this._castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this._castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},computeShadowedSceneBounds:function(){return this._removeNodesNeverCastingVisitor&&(this._removeNodesNeverCastingVisitor.setNoCastMask(~(this._castsShadowBoundsTraversalMask|this._castsShadowDrawTraversalMask)),this._removeNodesNeverCastingVisitor.reset(),this.accept(this._removeNodesNeverCastingVisitor)),this._computeBoundsVisitor.setTraversalMask(this._castsShadowBoundsTraversalMask),this._computeBoundsVisitor.reset(),this.accept(this._computeBoundsVisitor),!!this._computeBoundsVisitor.getBoundingBox().valid()||(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore(),!1)},traverse:function(t){if(t.getVisitorType()===q.Z.CULL_VISITOR){var e,i,r=this._shadowTechniques.length;r&&t.pushStateSet(this._receivingStateset),this.nodeTraverse(t),r&&t.popStateSet();var n=!1;for(e=0;e<r;e++)(i=this._shadowTechniques[e])&&i.valid()&&(i.isDirty()&&(n=!0,i.init()),(i.isContinuousUpdate()||i.needRedraw())&&(n=!0));if(!n)return;if(!this.computeShadowedSceneBounds(t)){for(e=0;e<r;e++)(i=this._shadowTechniques[e]).markSceneAsNoShadow();return}var a=this._computeBoundsVisitor.getBoundingBox(),s=t.getCurrentModelMatrix();for(a.transformMat4(a,s),e=0;e<r;e++)((i=this._shadowTechniques[e]).isContinuousUpdate()||i.needRedraw())&&(i.updateShadowTechnique(t),i.cullShadowCasting(t,a));this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore()}else this.nodeTraverse(t)}}),"osgShadow","ShadowedScene"),jt.Z.registerApplyFunction(ys.nodeTypeID,jt.Z.getApplyFunction(Kt.Z.nodeTypeID));const Ts=ys;var xs={};xs.ShadowCastAttribute=Xa,xs.ShadowReceiveAttribute=as,xs.ShadowCasterVisitor=Ja,xs.ShadowFrustumIntersection=rs,xs.ShadowMap=ds,xs.ShadowMapAtlas=ms,xs.ShadowedScene=Ts,xs.ShadowSettings=bs,xs.ShadowTechnique=os,xs.ShadowTexture=us,xs.ShadowTextureAtlas=ps;const Es=xs;const Rs={Stats:Kn,BufferStats:On,Graph:Zn,TextGenerator:kn,Counter:Un,defaultStats:Yn,browserStats:da,glStats:ua};var As={};As.Text=Qt;const Cs=As;var Ms={};Ms.osg=Ft,Ms.osgAnimation=Gt,Ms.osgText=$t;const Is=Ms;var ws=i("uHj6"),Ns=T.createQuatChannel,Ps=T.createVec3Channel,Zs=T.createFloatChannel,Ls=function(){this._filesMap=void 0,this._loadedFiles=void 0,this._bufferViewCache=void 0,this._basicAnimationManager=void 0,this._visitedNodes=void 0,this._animatedNodes=void 0,this._bones=void 0,this._skeletonToInfluenceMap=void 0,this._inputImgReader=void 0,this._localPath="",this._extensions=[],this._nodeAnimationTypes=void 0,this.init()};Ls.WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ls.TYPE_TABLE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ls.ATTRIBUTE_OSGJS_TABLE={POSITION:"Vertex",NORMAL:"Normal",TANGENT:"Tangent",TEXCOORD_0:"TexCoord0",TEXCOORD_1:"TexCoord1",TEXCOORD_2:"TexCoord2",TEXCOORD_3:"TexCoord3",TEXCOORD_4:"TexCoord4",TEXCOORD_5:"TexCoord5",TEXCOORD_6:"TexCoord6",TEXCOORD_7:"TexCoord7",TEXCOORD_8:"TexCoord8",TEXCOORD_9:"TexCoord9",TEXCOORD_10:"TexCoord10",TEXCOORD_11:"TexCoord11",TEXCOORD_12:"TexCoord12",TEXCOORD_13:"TexCoord13",TEXCOORD_14:"TexCoord14",TEXCOORD_15:"TexCoord15",COLOR_0:"Color",JOINTS_0:"Bones",WEIGHTS_0:"Weights"},Ls.TEXTURE_FORMAT={6406:qt.Z.ALPHA,6407:qt.Z.RGB,6408:qt.Z.RGBA,6409:qt.Z.LUMINANCE,6410:qt.Z.LUMINANCE_ALPHA},Ls.TYPE_CHANNEL_PATH={translation:{VEC3:Ps},scale:{VEC3:Ps},rotation:{VEC4:Ns},weights:{SCALAR:Zs}},Ls.TYPE_STACKED_TRANSFORMS={translation:Et,scale:Tt,rotation:vt},Ls.PBR_SPEC_EXT="KHR_materials_pbrSpecularGlossiness",Ls.PBR_SPEC_MODE="PBR_specular_glossiness",Ls.PBR_METAL_MODE="PBR_metal_roughness",Ls.ALBEDO_TEXTURE_UNIT=2,Ls.DIFFUSE_TEXTURE_UNIT=2,Ls.SPECULAR_GLOSSINESS_TEXTURE_UNIT=3,Ls.METALLIC_ROUGHNESS_TEXTURE_UNIT=3,Ls.SPECULAR_TEXTURE_UNIT=4,Ls.NORMAL_TEXTURE_UNIT=5,Ls.AO_TEXTURE_UNIT=6,Ls.EMISSIVE_TEXTURE_UNIT=7,Ls.ALBEDO_UNIFORM="albedoMap",Ls.METALLIC_ROUGHNESS_UNIFORM="metallicRoughnessMap",Ls.SPECULAR_UNIFORM="specularMap",Ls.NORMAL_UNIFORM="normalMap",Ls.AO_UNIFORM="aoMap",Ls.EMISSIVE_UNIFORM="emissiveMap",Ls.prototype={init:function(){this._glTFJSON=void 0,this._nodeAnimationTypes=[],this._bufferViewCache={},this._basicAnimationManager=void 0,this._localPath="",this._visitedNodes={},this._animatedNodes={},this._bones={},this._skeletonToInfluenceMap={},this._stateSetMap={},this._filesMap={},this._inputReader=new Mt.Z,this._rootStateSet=new er.Z,this._defaultBlendFunc=new Xt.Z,this._transparentBlendFunc=new Xt.Z("SRC_ALPHA","ONE_MINUS_SRC_ALPHA"),this._defaultCullFace=new Ji.Z,this._doubleSideCullFace=new Ji.Z(Ji.Z.DISABLE)},_preProcessNodes:function(){for(var t,e=this._gltfJSON.nodes,i=this._gltfJSON.meshes,r=0;r<e.length;r++){var n=e[r];t=n.name||"",t+="_"+r.toString(),n.osgjsNodeName=t;var a=n.children;if(a)for(var s=0;s<a.length;s++){e[a[s]].parent=r}}for(var o=0;o<i.length;o++){var h=i[o];t=h.name||"",t+="_"+o.toString(),h.osgjsNodeName=t}},loadBuffers:Pt().method((function(){for(var t=[],e=this._gltfJSON.buffers,i=0;i<e.length;i++){var r=e[i];t.push(this.loadURI(r.uri,{responseType:"arraybuffer"}).then})))}return Pt().all(t)})),loadBufferViews:function(){for(var t=this._gltfJSON.buffers,e=this._gltfJSON.bufferViews,i=0;i<e.length;i++){var r=e[i],n=t[r.buffer],a=r.byteLength||0,s=r.byteOffset||0;r.data=n.data.slice(s,s+a)}},loadAccessors:function(){for(var t=this._gltfJSON.bufferViews,e=this._gltfJSON.accessors,i=0;i<e.length;i++){var r,n=e[i],a=t[n.bufferView],s=Ls.TYPE_TABLE[n.type],o=Ls.WEBGL_COMPONENT_TYPES[n.componentType],h=o.BYTES_PER_ELEMENT*s,u=a.byteStride,c=!0===n.normalized;if(u&&u!==h)L.Z.warn("GLTF interleaved accessors not supported");else{var l=new o(a.data,n.byteOffset,n.count*s);(r=new Y.Z(void 0,l,s)).setNormalize(c)}n.data=r}},_computeNodeMatrix:function(t){var e;if(t.matrix)e=s._E.clone(t.matrix);else if(t.translation||t.rotation||t.scale){var i=s._E.IDENTITY,r=s._E.IDENTITY,n=s._E.IDENTITY;t.translation&&(i=s._E.fromTranslation(s._E.create(),t.translation)),t.rotation&&(r=s._E.fromQuat(s._E.create(),t.rotation)),t.scale&&(n=s._E.fromScaling(s._E.create(),t.scale)),e=s._E.create(),s._E.multiply(e,r,n),s._E.multiply(e,i,e)}return e},loadNodes:function(){for(var t=this._gltfJSON.nodes,e=this._gltfJSON.skins,i=this._gltfJSON.meshes,r=0;r<t.length;r++){var n=t[r];if(!n.usedAsBone){if(void 0!==n.skin){var a=e[n.skin],s=a.osgjsNode;a.osgjsNodeAttached||(n.osgjsNode=s,a.osgjsNodeAttached=r);var o=i[n.mesh];o.osgjsGeometry.setBoneNameID(a.osgjsBoneMapID),s.addChild(o.osgjsGeometry)}else(n.matrix||n.translation||n.rotation||n.scale)&&(n.osgjsNode=this._createMatrixTransform(r)),void 0!==n.mesh&&(n.osgjsNode?n.osgjsNode.addChild(i[n.mesh].osgjsGeometry):n.osgjsNode=i[n.mesh].osgjsGeometry),n.osgjsNode||(n.osgjsNode=new Kt.Z);n.name&&n.osgjsNode.setName(n.name)}}},_linkNodes:function(t){var e=this._gltfJSON.nodes,i=t.children;if(i)for(var r=0;r<i.length;r++){var n=e[i[r]];if(!n.usedAsBone){var a=n.osgjsNode;a&&!t.osgjsNode.hasChild(a)&&(t.osgjsNode.addChild(a),this._linkNodes(n))}}},loadSkins:function(){var t=this._gltfJSON.skins;if(t)for(var e=0;e<t.length;e++)this._processSkin(e)},loadScenes:function(){var t=this._gltfJSON.nodes,e=this._gltfJSON.scenes;this._osgjsScene=[];for(var i=0;i<e.length;i++){for(var r=e[i].nodes,n=[],a=0;a<r.length;a++){var s=t[r[a]];this._linkNodes(s),n.push(s.osgjsNode)}var o=n[0];if(n.length>1){o=new Kt.Z;for(var h=0;h<n.length;h++)o.addChild(n[h])}this._osgjsScene.push(o)}},_assignGeometryAttributes:function(t,e,i){var r=this._gltfJSON.accessors;for(var n in e){var a=r[e[n]],s=Ls.ATTRIBUTE_OSGJS_TABLE[n];void 0!==i&&(s+="_"+i.toString()),t.getVertexAttributeList()[s]=a.data,a.data._target=Y.Z.ARRAY_BUFFER}},_assignGeometryPrimitives:function(t,e){var i=this._gltfJSON.accessors[e.indices];i.data._target=Y.Z.ELEMENT_ARRAY_BUFFER;var r=void 0!==e.mode?e.mode:dr.Z.TRIANGLES,n=new Rr.Z(r,i.data);t.getPrimitiveSetList().push(n)},_getMorphTargetName:function(t,e){return t.osgjsNodeName+"_target_"+e.toString()},_computeAbsoluteMorphData:function(t,e){var i=this._gltfJSON.accessors;for(var r in e){var n=i[e[r]];if(!n.morphAbsoluteComputed){n.morphAbsoluteComputed=!0;for(var a=i[t[r]].data.getElements(),s=n.data.getElements(),o=a.length,h=0;h<o;h++)s[h]+=a[h]}}},_processMorphGeometry:function(t,e){var i=t.primitives[e],r=new J.Z,n=new et;n.setName(t.osgjsNodeName),r.setName(t.osgjsNodeName);for(var a=0;a<i.targets.length;a++){this._computeAbsoluteMorphData(i.attributes,i.targets[a]);var s=this._getMorphTargetName(t,a),o=new Dt.Z;o.setName(s),n.addTarget(s,a),this._assignGeometryAttributes(o,i.targets[a]),r.getMorphTargets().push(o)}this._assignGeometryAttributes(r,i.attributes),this._assignGeometryPrimitives(r,i),r.mergeChildrenVertexAttributeList(),t.osgjsMorphGeometry=r,t.osgjsUpdateMorph=n},loadMeshes:function(){for(var t=this._gltfJSON.meshes,e=this._gltfJSON.materials,i=0;i<t.length;i++){for(var r=t[i],n=r.name,a=[],s=0;s<r.primitives.length;s++){var o=void 0,h=r.primitives[s],u=void 0;if(h.targets&&h.targets.length&&(this._processMorphGeometry(r,s),o=r.osgjsMorphGeometry,u=r.osgjsUpdateMorph),h.attributes.JOINTS_0){var c=new Q.Z;o||(o=new Dt.Z,this._assignGeometryAttributes(o,h.attributes),this._assignGeometryPrimitives(o,h));var l=new zn.Z;o.computeBoundingBox(l),c.setBound(l),c.setSourceGeometry(o),c.mergeChildrenData(),o=c}o||(o=new Dt.Z,this._assignGeometryAttributes(o,h.attributes),this._assignGeometryPrimitives(o,h)),n&&o.setName(n),u&&o.addUpdateCallback(u);var _=e[h.material].osgjsStateSet;o.setStateSet(_),o.setUserData(_.getUserData()),a.push(o)}if(a.length>1){for(var d=new Kt.Z,f=0;f<a.length;f++)d.addChild(a[f]);o=d}r.osgjsGeometry=o}},loadImages:function(){var t=this._gltfJSON.images;if(!t)return Pt().resolve();for(var e=[],i=0;i<t.length;i++){var r=t[i],n=window.decodeURI(r.uri),a=this.loadURI(n).then(function(t){var e=new ws.Z;e.setImage(t),this.osgjsImage=e}.bind(r));e.push(a)}return Pt().all(e)},_texture:function(t){var e=this._gltfJSON.textures,i=this._gltfJSON.images,r=e[t.index],n=i[r.source];if(r.osgjsTexture)return r.osgjsTexture;var a=new qt.Z;if(r.osgjsTexture=a,a.setFlipY(!1),a.setWrapS("REPEAT"),a.setWrapT("REPEAT"),n.osgjsImage){var s=Ls.TEXTURE_FORMAT[r.format];a.setImage(n.osgjsImage,s)}return a},_pbrMetallicRoughnessTextureUniforms:function(){var t=this._rootStateSet;if(!t.getUniformList()[Ls.ALBEDO_UNIFORM]){var e=tr.Z.createInt(Ls.ALBEDO_TEXTURE_UNIT,Ls.ALBEDO_UNIFORM),i=tr.Z.createInt(Ls.METALLIC_ROUGHNESS_TEXTURE_UNIT,Ls.METALLIC_ROUGHNESS_UNIFORM);t.addUniform(e),t.addUniform(i)}},_pbrMetallicRoughness:function(t,e){var i;if(e.setUserData({pbrWorklow:Ls.PBR_METAL_MODE}),this._pbrMetallicRoughnessTextureUniforms(),t.baseColorTexture)i=this._texture(t.baseColorTexture),e.setTextureAttributeAndModes(Ls.ALBEDO_TEXTURE_UNIT,i);else if(t.baseColorFactor){var r=tr.Z.createFloat4(t.baseColorFactor,"uBaseColorFactor");e.addUniform(r)}if(void 0!==t.metallicFactor){var n=tr.Z.createFloat1(t.metallicFactor,"uMetallicFactor");e.addUniform(n)}if(void 0!==t.roughnessFactor){var a=tr.Z.createFloat1(t.roughnessFactor,"uRoughnessFactor");e.addUniform(a)}t.metallicRoughnessTexture&&(i=this._texture(t.metallicRoughnessTexture),e.setTextureAttributeAndModes(Ls.METALLIC_ROUGHNESS_TEXTURE_UNIT,i))},_KHR_materials_pbrSpecularGlossinessTextureUniforms:function(){if(!this._extensions.KHR_materials_pbrSpecularGlossinessTextureUniforms){this._extensions.KHR_materials_pbrSpecularGlossinessTextureUniforms=!0;var t=this._rootStateSet,e=tr.Z.createInt(Ls.DIFFUSE_TEXTURE_UNIT,Ls.ALBEDO_UNIFORM),i=tr.Z.createInt(Ls.SPECULAR_GLOSSINESS_TEXTURE_UNIT,Ls.METALLIC_ROUGHNESS_UNIFORM),r=tr.Z.createInt(Ls.SPECULAR_TEXTURE_UNIT,Ls.SPECULAR_UNIFORM);t.addUniform(e),t.addUniform(i),t.addUniform(r)}},_KHR_materials_pbrSpecularGlossiness:function(t,e){var i,r;if(e.setUserData({pbrWorklow:Ls.PBR_SPEC_MODE}),this._KHR_materials_pbrSpecularGlossinessTextureUniforms(),t.diffuseTexture?(i=this._texture(t.diffuseTexture),e.setTextureAttributeAndModes(Ls.DIFFUSE_TEXTURE_UNIT,i)):t.diffuseFactor&&(r=tr.Z.createFloat4(t.diffuseFactor,"uBaseColorFactor"),e.addUniform(r)),t.specularFactor&&(r=tr.Z.createFloat3(t.specularFactor,"uSpecularFactor"),e.addUniform(r)),void 0!==t.glossinessFactor){var n=tr.Z.createFloat(t.glossinessFactor,"uGlossinessFactor");e.addUniform(n)}t.specularGlossinessTexture&&(i=this._texture(t.specularGlossinessTexture),e.setTextureAttributeAndModes(Ls.SPECULAR_GLOSSINESS_TEXTURE_UNIT,i))},loadMaterials:function(){var t=this._gltfJSON.materials,e=!1,i=!1,r=this._rootStateSet;r.addUniform(tr.Z.createInt(Ls.EMISSIVE_TEXTURE_UNIT,Ls.EMISSIVE_UNIFORM)),r.addUniform(tr.Z.createInt(Ls.AO_TEXTURE_UNIT,Ls.AO_UNIFORM)),r.addUniform(tr.Z.createInt(Ls.NORMAL_TEXTURE_UNIT,Ls.NORMAL_UNIFORM)),r.addUniform(tr.Z.createFloat3(s.R3.ZERO,"uEmissiveFactor"));for(var n=0;n<t.length;n++){var a,o=t[n],h=new er.Z;o.osgjsStateSet=h,o.pbrMetallicRoughness?this._pbrMetallicRoughness(o.pbrMetallicRoughness,h):o.extensions.KHR_materials_pbrSpecularGlossiness&&this._KHR_materials_pbrSpecularGlossiness(o.extensions.KHR_materials_pbrSpecularGlossiness,h),o.normalTexture&&(a=this._texture(o.normalTexture),h.setTextureAttributeAndModes(Ls.NORMAL_TEXTURE_UNIT,a)),o.occlusionTexture&&(a=this._texture(o.occlusionTexture),h.setTextureAttributeAndModes(Ls.AO_TEXTURE_UNIT,a)),o.emissiveTexture&&(a=this._texture(o.emissiveTexture),h.setTextureAttributeAndModes(Ls.EMISSIVE_TEXTURE_UNIT,a)),o.emissiveFactor&&h.addUniform(tr.Z.createFloat3(o.emissiveFactor,"uEmissiveFactor")),"BLEND"===o.alphaMode&&(e=!0,h.setAttributeAndModes(this._transparentBlendFunc),h.setRenderingHint("TRANSPARENT_BIN")),o.doubleSided&&(i=!0,h.setAttributeAndModes(this._doubleSideCullFace))}e&&r.setAttributeAndModes(this._defaultBlendFunc),i&&r.setAttributeAndModes(this._defaultCullFace)},_createBone:function(t){var e=this._gltfJSON.nodes[t];e.usedAsBone=!0;var i=this._nodeAnimationTypes,r=new ut.Z,n=e.osgjsNodeName;r.setName(n);var a=this._computeNodeMatrix(e)||s._E.IDENTITY;r.setMatrix(a);var o=new it.Z;if(o.setName(r.getName()),r.addUpdateCallback(o),i[t]){var h=o.getStackedTransforms();for(var u in i[t]){var c=new(0,Ls.TYPE_STACKED_TRANSFORMS[u])(u);h.push(c)}}return o.setMatrix(a),r},_createMatrixTransform:function(t){var e=this._gltfJSON.nodes[t],i=this._nodeAnimationTypes,r=new Ht.Z,n=e.osgjsNodeName;r.setName(n);var a=this._computeNodeMatrix(e)||s._E.IDENTITY;if(r.setMatrix(a),i[t]){var o=new rt.Z;o.setName(r.getName()),r.addUpdateCallback(o),o.setMatrix(a);var h=o.getStackedTransforms();for(var u in i[t]){var c=new(0,Ls.TYPE_STACKED_TRANSFORMS[u])(u);h.push(c)}}return r},_processSkin:function(t){var e,i=this._gltfJSON.skins,r=this._gltfJSON.nodes,n=i[t],a=n.joints;void 0!==n.inverseBindMatrices&&(e=this._gltfJSON.accessors[n.inverseBindMatrices].data.getElements().buffer);var s,o=new _t.Z;n.osgjsNode=o,o.setName("skin ID "+t);for(var h,u={},c={},l=0;l<a.length;l++){if(s=a[l],h=this._createBone(s),void 0!==n.inverseBindMatrices){var _=new Float32Array(e,16*l*4,16);h.setInvBindMatrixInSkeletonSpace(_)}u[s]=h,c[h.getName()]=l}for(var d in n.osgjsBoneMapID=c,u){var f=r[d].parent;if(h=u[d],void 0===f||-1===a.indexOf(f))o.addChild(h);else u[f].addChild(h)}},loadAnimations:function(){var t=this._gltfJSON.animations;if(t){for(var e=this._gltfJSON.accessors,i=this._nodeAnimationTypes,r=this._gltfJSON.nodes,n=this._gltfJSON.meshes,a=[],s=0;s<t.length;s++){for(var o=t[s].channels,h=t[s].samplers,u=[],c=0;c<o.length;c++){var l=o[c],_=h[l.sampler],d=e[_.input].data.getElements(),f=e[_.output],p=f.data.getElements(),g=l.target,m=Ls.TYPE_CHANNEL_PATH[g.path][f.type],v=void 0!==g.node?g.node:g.id,b=r[v],S=g.path,y=r[v].osgjsNodeName;if("weights"===S)for(var T=n[b.mesh],x=T.primitives[0].targets.length,E=d.length,A=0;A<x;A++){for(var C=new Float32Array(E),M=0;M<E;M++)C[M]=p[M*x+A];y=this._getMorphTargetName(T,A),u.push(m(C,d,y,A))}else u.push(m(p,d,y,S));i[v]||(i[v]={}),i[v][S]=!0}var I="animation-"+s.toString();a.push(R.createAnimation(u,I))}var w=new ht;w.init(a),this._animationManager=w}},loadURI:Pt().method((function(t,e){if("data:"===t.substr(0,5))retur}(t);var i=this._filesMap[t];return void 0!==i?i:ee.Z.requestURI(t,e)})),readNodeURL:function(t,e){var i=this;if(this.init(),e&&void 0!==e.filesMap&&Object.keys(e.filesMap).length>0){this._filesMap=e.filesMap;var r=this._filesMap[t];return this.readJSON(r,t)}var n=t.lastIndexOf("/");return this._localPath=-1===n?"":t.substr(0,n+1),ee.Z.requestURI(t).then}))},readJSON:Pt().method((function(t,e){return this._gltfJSON=t,Pt().all([this.loadBuffers(),this.loadImages()]).then(function(){this.loadBufferViews(),this.loadAccessors(),this._preProcessNodes(),this.loadMaterials(),this.loadMeshes(),this.loadAnimations(),this.loadSkins(),this.loadNodes(),this.loadScenes();var t=new Ht.Z;return t.addChild(this._osgjsScene[0]),t.setName(e),this._animationManager&&t.addUpdateCallback(this._animationManager),t.setStateSet(this._rootStateSet),t}.bind(this))}))},te.Z.instance().addReaderWriter("gltf",new Ls);const Os=Ls;var Fs=window.JSZip,Ds=function(){this._options=void 0,this._filesMap={},this._fileName=""};Ds.prototype={readNodeURL:function(t,e){if(void 0===Fs)return L.Z.error("You need to add JSZip as a dependency"),Pt().reject(this);L.Z.log("starting to read: "+t);var i=this;if(e&&void 0!==e.filesMap&&void 0!==e.filesMap[t]){var r=e.filesMap[t];return this.readZipFile(r).then((function(){return i._fileName?It.Z.readNodeURL(i._fileName,{filesMap:i._filesMap}):Pt().reject(i)}))}return ee.Z.requestURI(t,{responseType:"blob"}).then((function(t){i.readZipFile(t).then}))}))},readZipFile:function(t){ee.Z.unzip(t).then(function(t){for(var e in t){var i=ee.Z.getExtension(e);if(void 0!==te.Z.instance().getReaderWriterForExtension(i)||"osgjs"===i){this._fileName=e;break}}}.bind(this))}},te.Z.instance().addReaderWriter("zip",new Ds);const Us=Ds;var Bs={};Bs.ReaderWriterGLTF=Os,Bs.ReaderWriterZIP=Us;const ks=Bs;var Vs=i("aa6s"),Gs=r.Z;Gs.osg=n.Z,Gs.osgAnimation=Ct,Gs.osgDB=ae,Gs.osgGA=Qi,Gs.osgUtil=Sn,Gs.osgViewer=Wa,Gs.osgShader=Ha.Z,Gs.osgShadow=Es,Gs.osgStats=Rs,Gs.osgText=Cs,Gs.osgWrappers=Is,Gs.osgPlugins=ks,Gs.InputGroups=Wa.InputGroups,Gs.globalify=function(){window.osg=Gs.osg,window.osgAnimation=Gs.osgAnimation,window.osgDB=Gs.osgDB,window.osgGA=Gs.osgGA,window.osgUtil=Gs.osgUtil,window.osgViewer=Gs.osgViewer,window.osgShader=Gs.osgShader,window.osgShadow=Gs.osgShadow,window.osgStats=Gs.osgStats,window.osgText=Gs.osgText,window.osgWrappers=Gs.osgWrappers,window.osgPlugins=Gs.osgPlugins,window.InputGroups=Gs.InputGroups},(0,Vs.c)(Gs);const js=Gs;(0,i("6y3v").Z)(),J.Z.EFFECTIVE_EPS=(0,Da.Z)().morphEpsilon;const Ws=js},ppE}}]);