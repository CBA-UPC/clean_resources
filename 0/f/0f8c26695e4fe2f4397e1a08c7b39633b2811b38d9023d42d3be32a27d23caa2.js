!function(t,n,e){"use strict";function r(){"loading"!==n.readyState?i():t.addEventListener?t.addEventListener("DOMContentLoaded",i):t.attachEvent("onload",i)}function i(){t.removeEventListener?t.removeEventListener("DOMContentLoaded",r):t.detachEvent("onload",r);var e=n.getElementsByTagName("script"),i=[],a={};"undefined"!=typeof _ipc&&_ipc instanceof Array&&(i=_ipc.slice(0));for(var c=0;c<=e.length-1;c++)e[c].constructor===HTMLScriptElement&&e[c].className.match(/(\s|^)idio-recommendations(\s|$)/)&&(a="undefined"==typeof _ipc||_ipc instanceof Array?{}:Object.create(_ipc),a.tag=e[c],i.push(a));o(i)}function o(t){for(var n=0;n<=t.length-1;n++)a(t[n])}function a(t){void 0===t.tag&&(t.tag=n.body);var e=p(t),r=void 0!==e.finish,i=r?"check"+k:"r"+k,o=t.tag===n.body,a=m(e,i);if(r){var u=l(t.tag,e.complete,e.finish?function(t){return t&&d(n.body,["https://api.idio.co/1.0","/recommendations/"+t,"?pending=false","&_method=patch","&key="+e.api_key].join("")),o}:o);idio[i]=c(t,a,e.finish,e.error,u)}else idio[i]=g(t,a,e.complete,e.error);k++,d(t.tag.parentNode,a[0])}function c(t,n,e,r,i){var o=t.tag.parentNode,a=e;return function(e,c){u(c,n,o)&&(200!=c&&(a=r,e={}),a&&a(e,c,s(t),i))}}function u(t,n,e){return 404!=t&&204!=t||!(n.length>1)||(n.shift(),e&&d(e,n[0]),!1)}function f(t,e,r){if(w){var i="/users/idio_visitor_id:"+w,o="recommendationIdCallback"+k;k++;for(var a="https://api.idio.co/1.0"+i+"/recommendations?_method=post&callback=idio."+o+"&key="+t.api_key,c=b(),u=0;u<c.length;u++)a+="&session[]="+encodeURIComponent(c[u]);idio[o]=function(t,n){201==n?e(t.recommendation_id):r()},d(n.body,a)}}function s(t){return function(n){f(t,function(t){for(var e=[],r=n.length-1;r>=0;r--){var i=x(n[r].getAttribute("href"));e.push(i),n[r].setAttribute("href","https://a.idio.co/r?a=consume_decision&q="+t+"&u="+encodeURIComponent(i))}v({a:"update_decision",q:t,du:e})},}}function l(t,n,e){return function(r,i,o){var a=y.compile(o),c=h(t,a,r,e);return n&&n(c,i),c}}function h(t,e,r,i){for(var o=n.createElement("div"),a=t.attributes,c=a.length-1,u=t.parentNode;c>=0;c--)"class"==a[c].name?o.className=a[c].value:"disabled"!=a[c].name&&o.setAttribute(a[c].name,a[c].value);return o.innerHTML=e.render(r),("function"==typeof i?i(r.recommendation_id):i)||(u.insertBefore(o,t),u.removeChild(t)),o}function p(t){var n=void 0!==t.tag&&t.tag,e={};if(!1!==n)for(var r,i={},o=n.attributes,a=o.length-1,c={"fallback-section":"fallback","api-key":"api_key","fallback-filter":"fallback_filter"};a>=0;a--)(i=o[a].name.split("data-")[1])&&(e[i in c?c[i]:i]=o[a].value);for(r in t)r in e||(e[r]=t[r]);return e}function g(t,n,e,r){var i=y.compile(t.tag.innerHTML),o=e,a=t.tag.parentNode;return function(e,c){if(u(c,n,a)){200!=c&&(o=r,e={});var f=h(t.tag,i,e);o&&o(f,c)}}}function d(t,e){var r=n.createElement("script");r.src=e,t.appendChild(r)}function v(t){var n=[];for(var e in t)if(t.hasOwnProperty(e))if("[object Array]"===Object.prototype.toString.call(t[e]))for(var r=0;r<t[e].length;r++)n.push(e+"[]="+encodeURIComponent(t[e][r]));else n.push(e+"="+encodeURIComponent(t[e]));var i="https://a.idio.co/ia.gif?";i+=n.join("&");var o=new Image(1,1);return o.setAttribute("src",i),o}function m(t,n){var e=[];return e.unshift(_(t,n)),w&&e.unshift(_(t,n,w)),e}function _(t,n,e){var r=null,i=e?"/users/idio_visitor_id:"+e:"",o=t.fallback?"section:"+t.fallback:"",a=t.section?"section:"+t.section:"";r=e?t.filter?t.filter:a:t.fallback_filter||o||a,r=r?"/_filter?query="+encodeURIComponent(r)+"&":"?";for(var c=["https://api.idio.co/1.0"+i+"/content"+r+"include_topics","callback=idio."+n,"key="+t.api_key],u=b(),f=0;f<u.length;f++)c.push("session[]="+encodeURIComponent(u[f]));return"?"!==r&&c.push("_method=post"),t.rpp&&c.push("rpp="+t.rpp),t.page&&c.push("page="+t.page),t.finish&&c.push("record=pending"),e&&o&&c.push("no_fallback"),c.join("&")}function b(){if(b.cache)return b.cache;for(var e=[t.location.href],r=n.getElementsByTagName("link"),i=0;i<r.length;i++)"canonical"===r[i].rel&&e.push(r[i].href);return b.cache=e,e}function x(t){var e=n.createElement("div");return e.innerHTML="<a></a>",e.firstChild.href=t,e.innerHTML=e.innerHTML,e.firstChild.href}!function(t,n,e){function r(t,n){var e=new i(t),r=e.get()||["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,];return e.set(r[0],n),r}function i(t){this.name=t,this.pattern=RegExp("(^|;)\\s*"+t+"=([^;]*)","g")}function o(t,n){var e,r=[];for(e in t)"_"!==e&&t.hasOwnProperty(e)&&(r=r.concat(n(e)));return r}function a(t,n){this._="//a.idio.co/"+t+"?",this.merge(n)}or(var u,f=e.hostname,s=[""];u=f.indexOf(".",u)+1;)s.push(";domain=."+f.substr(u));var l=i.prototype;l.get=function(){for(var t,e=[];t=this.pattern.exec(n.cookie);)t[2]&&e.push(t[2]);return e.sort(),e.length?e:null},l.set=function(t,e){for(var r=s.length;r;)n.cookie=this.name+"=;expires="+new Date(0).toGMTString()+s[--r]+";path=/";for(r=s.length;r;)n.cookie=this.name+"="+t+";expires="+new Date(+new Date+36e5*e).toGMTString()+s[--r]+";path=/",this.get()&&(r=0)};var h=decodeURIComponent,p=encodeURIComponent;(l=a.prototype).merge=function(t){var n=this;o(t,},l.toString=function(){var t=this;return t.merge({l:Math.floor((new Date).getTime()),z:Math.random()}),t._+o(t,function n(e,r,i){var a=(r||t)[e],e=i?i+"["+e+"]":e;return"object"==typeof a?o(a,:p(e)+"="+p(a)}).join("&")},c.prototype.push=function(){for(var t=arguments,n=0,e=t.length;n<e;n++)try{g[t[n].shift()].apply(null,t[n])}catch(t){}};var g={track:function(t,n){var r;t&&((r=new a("ia.gif",v)).a=t,r.u=n||e.href,(new Image).src=r+"")},user:function(t,n){v.x[t]=(v.x[t]||[]).concat(n)}},d={client:"c",delivery:"d",content:"e",group:"g",goal:"g",metadata:"m",userinfo:"b"};if(o(d,function(t){g[t]=),!t._iaq||t._iaq.pop){var v={r:n.referrer,s:r("is",.5)[0],x:{idio_visitor_id:r("iv",17520)}},m=new i("_madid").get();m&&(v.x.epi_device_id=m);for(var _,b,x=e.search.substr(1).split("&"),y=x.length;0<y--;)b=h((_=x[y].split("="))[1]),(_=h(_[0]).match(/^it(e|o|q|x\[(\w+)])$/))&&(_[2]?v.x[_[2]]=[b]:v[_[1]]=b);var k=t._iaq||[];(t._iaq=new c).push.apply(null,k)}}(t,n,location);/**
* @preserve Copyright 2012 Twitter, Inc.
* @license http://www.apache.org/licenses/LICENSE-2.0.txt
*/
var y={};(function(t,n){Template=t.Template.prototype={r:v:r,t:e,render:ri:rp:rs:s:d:function(t,n,e,r){var i=t.split("."),o=this.f(i[0],n,e,r),a=null;if("."===t&&s(n[n.length-2]))return n[n.length-1];for(var c=1;c<i.length;c++)o&&"object"==typeof o&&i[c]in o?(a=o,o=o[i[c]]):o="";return!(r&&!o)&&(!r&&"function"==typeof o&&(n.push(a),o=this.lv(o,n,e),n.pop()),o)},f:function(t,n,e,r){for(var i=!1,o=null,a=!1,c=n.length-1;c>=0;c--)if((o=n[c])&&"object"==typeof o&&t in o){i=o[t],a=!0;break}return a?(!r&&"function"==typeof i&&(i=this.lv(i,n,e)),i):!r&&""},ho:function(t,n,e,r,i){var o=this.c,a=this.options;a.delimiters=i;var r=t.call(n,r);return r=null==r?String(r):r.toString(),this.b(o.compile(r,a).render(n,e)),!1},b:fl:ls:function(t,n,e,r,i,o,a){var c=n[n.length-1],u=null;if(!r&&this.c&&t.length>0)return this.ho(t,c,e,this.text.substring(i,o),a);if("function"==typeof(u=t.call(c))){if(r)return!0;if(this.c)return this.ho(u,c,e,this.text.substring(i,o),a)}return u},lv:;var i=/&/g,o=/</g,a=/>/g,c=/\'/g,u=/\"/g,f=/[&<>\"\']/,s=Array.isArray||)(y),function(t){ction i(t,n,e,r){for(var c=[],u=null,f=null;t.length>0;)if(f=t.shift(),"#"==f.tag||"^"==f.tag||o(f,r))e.push(f),f.nodes=i(t,f.tag,e,r),c.push(f);else{if("/"==f.tag){if(0===e.length)throw new Error("Closing tag without opener: /"+f.n);if(u=e.pop(),f.n!=u.n&&!a(f.n,u.n,r))throw new Error("Nesting error: "+u.n+" vs. "+f.n);return u.end=f.i,c}c.push(f)}if(e.length>0)throw new Error("missing closing tag: "+e.pop().n);return c}tion f(t){for(var n="",e=0,r=t.length;e<r;e++){var i=t[e].tag;"#"==i?n+=s(t[e].nodes,t[e].n,u(t[e].n),t[e].i,t[e].end,t[e].otag+" "+t[e].ctag):"^"==i?n+=l(t[e].nodes,t[e].n,u(t[e].n)):"<"==i||">"==i?n+=h(t[e]):"{"==i||"&"==i?n+=p(t[e].n,u(t[e].n)):"\n"==i?n+=d('"\\n"'+(t.length-1==e?"":" + i")):"_v"==i?n+=g(t[e].n,u(t[e].n)):void 0===i&&(n+=d('"'+c(t[e])+'"'))}return n}ction p(t,n){return"_.b(_.t(_."+n+'("'+c(t)+'",c,p,0)));'}r v=/\S/,m=/\"/g,_=/\n/g,b=/\r/g,x=/\\/g,y={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};t.scan=function(t,i){unction a(){for(var t=!0,n=m;n<p.length;n++)if(!(t=p[n].tag&&y[p[n].tag]<y._v||!p[n].tag&&null===p[n].match(v)))return!1;return t}function c(t,n){if(o(),t&&a())for(var e,r=m;r<p.length;r++)p[r].tag||((e=p[r+1])&&">"==e.tag&&(e.indent=p[r].toString()),p.splice(r,1));else n||p.push({tag:"\n"});g=!1,m=p.length}var u=t.length,f=0,s=null,l=null,h="",p=[],g=!1,d=0,m=0,_="{{",b="}}";for(i&&(i=i.split(" "),_=i[0],b=i[1]),d=0;d<u;d++)0==f?r(_,t,d)?(--d,o(),f=1):"\n"==t.charAt(d)?c(g):h+=t.charAt(d):1==f?(d+=_.length-1,l=y[t.charAt(d+1)],s=l?t.charAt(d+1):"_v","="==s?(d=function(t,n){var r="="+b,i=t.indexOf(r,n),o=e(t.substring(t.indexOf("=",n)+1,i)).split(" ");return _=o[0],b=o[1],i+r.length-1}(t,d),f=0):(l&&d++,f=2),g=d):r(b,t,d)?(p.push({tag:s,n:e(h),otag:_,ctag:b,i:"/"==s?g-b.length:d+_.length}),h="",d+=b.length-1,f=0,"{"==s&&("}}"==b?d++:n(p[p.length-1]))):h+=t.charAt(d);return c(g,!0),p},t.generate=t.parse=t.cache={},t.compile=function(t,n){n=n||{};var e=t+"||"+!!n.asString,r=this.cache[e];return r||(r=this.generate(this.parse(this.scan(t,n.delimiters),t,n),t,n),this.cache[e]=r)}}(y);var k=0,w=n.cookie.match(/(?:^|;)\s*iv=([^;]+)/),w=w?w[1]:null;(t.idio=t.idio||{}).render=i,t.idio.load=o,r()}(window,document);
