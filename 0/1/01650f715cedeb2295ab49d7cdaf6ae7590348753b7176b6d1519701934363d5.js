(function(){window.recoConstructor=function(attrs){var Identify,arrayToParam,basicQuery,btConvInt,buildParam,common_queries,cookie,enc,fact,groupMatchedKey,idOnParamHeavier,idOnParamSimple,identify,isArrayNative,joinVal,name,objectToParam,queryAssemble,randobet,reqBcon,reqRecConst,reqRecScr,reqRecVal,reqRecommend,utic;Identify=function(){Identify.DEFAULT_IDENTIFY_CONFIG={name:"__sna_s1d",size:30};function Identify(value,name){if(name==null){name=Identify.DEFAULT_IDENTIFY_CONFIG.name}this.value=value;this.name=name}Identify.prototype._findCookie=Identify.prototype._findLocalStorage=Identify.prototype._getStock=function(index){var size;index=index+Identify.DEFAULT_IDENTIFY_CONFIG.name.length+1;size=document.cookie.indexOf(";",index);if(size===-1){size=document.cookie.length}return unescape(document.cookie.substring(index,size))};Identify.prototype._writeLocalStorage=Identify.prototype._writeCookie=function(){return document.cookie=this.name+"="+escape(this.value)+"; path=/; expires="+new Date("Mon, 31 Dec 2029 23:59:59 GMT").toUTCString()};Identify.prototype.write=function(){var localStorageIdentify,stockPlace;stockPlace=this._findCookie();localStorageIdentify=this._findLocalStorage();if(stockPlace!==-1){this.value=this.value||this._getStock(stockPlace)}else if(localStorageIdentify){this.value=this.value||localStorageIdentify}else{this.value=this.value||randobet(Identify.DEFAULT_IDENTIFY_CONFIG.size)}this._writeLocalStorage();this._writeCookie();return this.value};return Identify}();randobet=function(n){var a,i,j,ref,s;a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";a=a.split("");s="";for(i=j=1,ref=n;1<=ref?j<=ref:j>=ref;i=1<=ref?++j:--j){s+=a[Math.floor(Math.random()*a.length)]}return s};isArrayNative=utic=function(value,parent_key){var href,uticv;href=window.location.href;href=href.replace(/^http[s]*:\/\//,"");if(value===1){href=href.replace(/index\.(html?|php|cgi)(\?.*)?$/,"$2")}if(parent_key){uticv="&"+parent_key+"[utic]="+value}else{uticv="&utic="+value}return encodeURIComponent(href)+uticv+"&"};enc=function(str){return encodeURIComponent(str)};arrayToParam=function(array,subkey){var i,j,len,q,val;q="";for(i=j=0,len=array.length;j<len;i=++j){val=array[i];q+=buildParam(val,i,subkey)}return q};objectToParam=function(obj,subkey){var key,q,val;q="";for(key in obj){val=obj[key];q+=buildParam(val,key,subkey)}return q};buildParam=function(val,key,subkey){var childkey,q;q="";childkey=subkey+"["+key+"]";if(isArrayNative(val)){return q+=arrayToParam(val,childkey)}else if(typeof val==="object"){return q+=objectToParam(val,childkey)}else{q+=childkey+"="+enc(val)+"&";if(subkey==="utic"){q+=key+"[id]="+utic(val)}return q}};idOnParamSimple=function(obj,common){var item,items,j,l,len,len1,queryKey,queryStrings,val;queryStrings={};queryKey="";if(isArrayNative(obj)){queryKey=common.k;queryStrings[queryKey]={str:queryAssemble({},common)};for(j=0,len=obj.length;j<len;j++){val=obj[j];queryStrings[queryKey].str+="id[]="+enc(val)+"&"}}else if(obj.utic!=null){queryKey=obj.k||common.k;if(queryStrings[queryKey]==null){queryStrings[queryKey]={str:queryAssemble(obj,common)}}queryStrings[queryKey].str+="id[]="+utic(obj.utic)}else if(obj.items!=null){items=obj.items;for(l=0,len1=items.length;l<len1;l++){item=items[l];queryKey=item.k||common.k;if(queryStrings[queryKey]==null){queryStrings[queryKey]={str:queryAssemble(item,common)}}if(item.utic){queryStrings[queryKey].str+="id[]="+utic(item.utic)}else{queryStrings[queryKey].str+="id[]="+enc(item.id)+"&"}}}return queryStrings};idOnParamHeavier=function(obj,common){var content,hashKey,hashVal,i,j,l,len,len1,objStrings,objVal,objkey,queryKey,queryStrings,type,val;queryStrings={};queryKey="";if(isArrayNative(obj)){queryKey=common.k;if(queryStrings[queryKey]==null){queryStrings[queryKey]=queryAssemble({},common)}for(i=j=0,len=obj.length;j<len;i=++j){val=obj[i];type=typeof val;if(type==="string"||type==="number"){queryStrings[queryKey]+="items["+i+"][id]="+enc(val)+"&"}else{queryStrings[queryKey]+=objectToParam(val,i)}}}else if(typeof obj==="object"){for(hashKey in obj){hashVal=obj[hashKey];if(isArrayNative(hashVal)){objStrings={};for(l=0,len1=hashVal.length;l<len1;l++){content=hashVal[l];queryKey=content.k||common.k;if(objStrings[queryKey]==null){objStrings[queryKey]=[]}objStrings[queryKey].push(content)}for(objkey in objStrings){objVal=objStrings[objkey];if(queryStrings[objkey]==null){queryStrings[objkey]=queryAssemble({k:objkey},common)}delete objVal.k;queryStrings[queryKey]+=arrayToParam(objVal,"items")}}else if(typeof hashVal==="object"){queryStrings[queryKey]+=objectToParam(hashVal,hashKey)}else{queryKey=obj.k||common.k;if(queryStrings[queryKey]==null){queryStrings[qsk]=queryAssemble(obj,common)}delete obj.k;if(hashKey==="utic"){queryStrings[queryKey]+="items[u][id]="+utic(hashVal,"items[u]")}else{queryStrings[queryKey]+=hashKey+"="+hashVal+"&"}}}}return queryStrings};groupMatchedKey=function(group,key,regex){var groupKey,groupVal,params,q;q="";params={};for(groupKey in group){groupVal=group[groupKey];if(typeof groupVal==="string"&&groupKey.search(regex)===-1){q+=groupKey+"="+groupVal+"&"}else{params[groupKey]=groupVal}}return q+objectToParam(params,key)};basicQuery=function(q,stamp){return q+="stamp="+stamp+"&ref="+enc(document.referrer)+"&"};fact=queryAssemble=function(attrs,commonParams){var commonKey,commonVal,param,query;query="";param="";for(commonKey in commonParams){commonVal=commonParams[commonKey];if(attrs[commonKey]!=null){param=attrs[commonKey]}else{param=commonVal}query+=commonKey+"="+param+"&"}return query};reqBcon=function(bAttrs,common){var assebmled,atterKey,atterVal,body,div,dummyImg,i,imgs,j,key,len,queries,query,queryStrings,ref,results,stamp,stampLeft,url,val;queries=[];imgs=[];i=0;if(bAttrs==null){return}queries[i]={};if(bAttrs.basic!=null){stamp=(new Date).getTime();stampLeft=void 0;queryStrings=idOnParamSimple(bAttrs.basic,common);for(key in queryStrings){query=queryStrings[key];queries[i]={act:"basic",qst:basicQuery(query.str,stamp)};i+=1}delete bAttrs.basic}if(bAttrs.heavy!=null){queryStrings=idOnParamSimple(bAttrs.heavy,common);for(key in queryStrings){query=queryStrings[key];queries[i]={act:"heavy",qst:query.str};i+=1}delete bAttrs.heavy}if(bAttrs.heavier!=null){queryStrings=idOnParamHeavier(bAttrs.heavier,common);for(key in queryStrings){query=queryStrings[key];queries[i]={act:"heavier",qst:query};i+=1}delete bAttrs.heavier}if(bAttrs.user!=null){assebmled=queryAssemble(bAttrs.user,common);delete bAttrs.user.k;queryStrings=assebmled+groupMatchedKey(bAttrs.user,"user",/^[eaui]\d+$/);queries[i]={act:"user",qst:queryStrings};i+=1;delete bAttrs.user}if(bAttrs.events!=null){assebmled=queryAssemble(bAttrs.events,common);delete bAttrs.events.k;queryStrings=assebmled+groupMatchedKey(bAttrs.events,"events",/^\d+$/);queries[i]={act:"events",qst:queryStrings};i+=1;delete bAttrs.events}if(bAttrs.query!=null){queries[i].qst="ref="+enc(document.referrer)+"&";queryStrings="";ref=bAttrs.query;for(key in ref){val=ref[key];if(typeof val==="string"){queryStrings+=key+"="+val+"&"}else{queryStrings+=objectToParam(val,key)}}queries[i]={act:"query",qst:queryStrings};queries[i].qst+=queryAssemble(bAttrs.query,common);delete bAttrs.query;i+=1}for(atterKey in bAttrs){atterVal=bAttrs[atterKey];queryStrings="";for(key in atterVal){val=atterVal[key];if(typeof val==="string"){queryStrings+=key+"="+val+"&"}else{queryStrings+=objectToParam(val,key)}}queries[i]={act:atterKey,qst:queryStrings};queries[i].qst+=queryAssemble(atterKey,common);i+=1}results=[];for(j=0,len=queries.length;j<len;j++){query=queries[j];url="https://"+__snahost+"/api/bcon/"+fact(query.act)+"?";div=document.createElement("div");div.style.display="none";dummyImg=new Image(0,0);dummyImg.src=url+query.qst.replace(/&$/,"");div.appendChild(dummyImg);body=document.getElementsByTagName("body").item(0);results.push(body.appendChild(div))}return results};btConvInt=function(str){var map;map={basic:1,heavy:2,heavier:3};return map[str]||1};joinVal=function(obj,key,prefix){var ret;if(key==="bcon_type"){return ret="bt"+prefix+btConvInt(obj)+"&"}else if(key==="id"){return ret=key+prefix+enc(obj)+"&"}else{return ret=key+prefix+obj+"&"}};reqRecVal=function(obj,key){var j,len,prefix,ret,val;ret="";if(isArrayNative(obj)){prefix="[]=";for(j=0,len=obj.length;j<len;j++){val=obj[j];if(val==="utic"){ret+="id"+prefix+utic(obj)}else{ret+=joinVal(val,key,prefix)}}return ret}else{prefix="=";if(obj==="utic"){ret+="id"+prefix+utic(obj)}return ret+=joinVal(obj,key,prefix)}};reqRecConst=function(obj,act,common,i,target_ids,charsets){var key,qs,val;qs={};qs.qst="";qs.act=act;if(!obj.target_id){target_ids[i]=act}else{target_ids[i]=obj.target_id}if(!obj.charset){charsets[i]=null}else{charsets[i]=obj.charset}for(key in obj){val=obj[key];qs.qst+=reqRecVal(val,key)}qs.qst+=queryAssemble(obj,common);if(act==="rule"||act==="kw"){qs.qst+="ref="+enc(document.referrer)+"&"}return qs};reqRecScr=function(queries,target_ids,charsets){var cookie,i,identify,results,script,target,url;i=0;identify=new Identify;cookie=identify.write();results=[];while(i<queries.length){url="https://"+__snahost+"/api/recommend/"+queries[i].act+"?";script=document.createElement("script");script.setAttribute("type","text/javascript");script.setAttribute("charset",charsets[i]);script.setAttribute("src",(url+queries[i].qst).replace(/&$/,""));target=document.getElementById(target_ids[i]);target.appendChild(script);results.push(i++)}return results};reqRecommend=function(rAttrs,common){var attrKey,attrVal,charsets,i,j,len,queries,target_ids,val;queries=[];target_ids=[];charsets=[];i=0;for(attrKey in rAttrs){attrVal=rAttrs[attrKey];if(isArrayNative(attrVal)){for(i=j=0,len=attrVal.length;j<len;i=++j){val=attrVal[i];queries[i]=reqRecConst(val,attrKey,common,i,target_ids,charsets);i+=1}}else{queries[i]=reqRecConst(attrVal,attrKey,common,i,target_ids,charsets);i++}}if(window.addEventListener){return window.addEventListener("load",function(){return reqRecScr(queries,target_ids,charsets)},false)}else{return window.attachEvent("onload",}};common_queries={};for(name in attrs){if(name!=="bcon"&&name!=="recommend"){common_queries[name]=attrs[name]}}if(attrs.cid!=null){identify=new Identify(attrs.cid)}else{identify=new Identify}cookie=identify.write();common_queries.cid=cookie;reqBcon(attrs.bcon,common_queries);reqRecommend(attrs.recommend,common_queries);window.apiSetCtr=return window.apiSetCtrWithQst=function(item_code,tmpl,link,k,qst){var body,div,dummyImg,item_url,notilyParty,ontimeOut,r_num;item_url=link.href;dummyImg=new Image(0,0);r_num=Math.floor(Math.random()*1e4);identify=new Identify;cookie=identify.write();notilyParty="https://"+__snahost+"/api/recommend/set_ctr/?cid="+cookie+"&id="+item_code+"&tmpl="+tmpl+"&k="+k+"&r="+r_num;if(qst!=null){notilyParty+=qst}dummyImg.src=notilyParty;if(recoConstructer.debug===true){div=document.createElement("div");div.style.display="none";div.append(dummyImg);body=document.getElementsByTagName("body").item(0);body.appendChild(div);return}ontimeOut=setTimeout(function(){dummyImg=null;return location.href=item_url},5e3);dummyImg.onload=function(){location.href=item_url;return clearTimeout(ontimeOut)};return dummyImg.onerror=};window.recoConstructer=window.__snahost=window.__snahost||"re.veritrans.co.jp"}).call(this);