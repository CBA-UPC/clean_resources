"use strict";(window.webpackChunkNRBA=window.webpackChunkNRBA||[]).push([[317],{6112:(e,r,t)=>{t.r(r),t.d(r,{Aggregate:()=>j});var n=/([a-z0-9]+)$/i;function a(e){if(e){var r=e.match(n);return r?r[1]:void 0}}var s=t(4917),i=/^\n+|\n+$/g;function o(e){return function(e){var r;if(e.length>100){var t=e.length-100;r=e.slice(0,50).join("\n"),r+="\n< ...truncated "+t+" lines... >\n",r+=e.slice(-50).join("\n")}else r=e.join("\n");return r}(e).replace(i,"")}var c=!1,u=/function (.+?)\s*\(/,h=/^\s*at (?:((?:\[object object\])?(?:[^(]*\([^)]*\))*[^()]*(?: \[as \S+\])?) )?\(?((?:file|http|https|chrome-extension):.*?)?:(\d+)(?::(\d+))?\)?\s*$/i,d=/^\s*(?:(\S*|global code)(?:\(.*?\))?@)?((?:file|http|https|chrome|safari-extension).*?):(\d+)(?::(\d+))?\s*$/i,l=/^\s*at .+ \(eval at \S+ \((?:(?:file|http|https):[^)]+)?\)(?:, [^:]*:\d+:\d+)?\)$/i,g=/^\s*at Function code \(Function code:\d+:\d+\)\s*/i;function f(e){var r=null;try{if(r=function(e){if(!e.stack)return null;var r=e.stack.split("\n").reduce(m,{frames:[],stackLines:[],wrapperSeen:!1});return r.frames.length?{mode:"stack",name:e.name||v(e),message:e.message,stackString:o(r.stackLines),frames:r.frames}:null}(e),r)return r}catch(e){c}try{if(r=function(e){if(!("line"in e))return null;var r=e.name||v(e);if(!e.sourceURL)return{mode:"sourceline",name:r,message:e.message,stackString:v(e)+": "+e.message+"\n    in evaluated code",frames:[{func:"evaluated code"}]};var t=r+": "+e.message+"\n    at "+e.sourceURL;e.line&&(t+=":"+e.line,e.column&&(t+=":"+e.column));return{mode:"sourceline",name:r,message:e.message,stackString:t,frames:[{url:e.sourceURL,line:e.line,column:e.column}]}}(e),r)return r}catch(e){c}try{if(r=function(e){var r=e.name||v(e);return r?{mode:"nameonly",name:r,message:e.message,stackString:r+": "+e.message,frames:[]}:null}(e),r)return r}catch(e){c}return{mode:"failed",stackString:"",frames:[]}}function m(e,r){var t,n=function(e){var r=e.match(d);r||(r=e.match(h));if(r)return{url:r[2],func:"Anonymous function"!==r[1]&&"global code"!==r[1]&&r[1]||null,line:+r[3],column:r[4]?+r[4]:null};if(e.match(l)||e.match(g)||"anonymous"===e)return{func:"evaluated code"}}(r);return n?((t=n.func)&&t.indexOf("nrWrapper")>=0?e.wrapperSeen=!0:e.stackLines.push(r),e.wrapperSeen||e.frames.push(n),e):(e.stackLines.push(r),e)}function v(e){var r=u.exec(String(e.constructor));return r&&r.length>1?r[1]:"unknown"}function p(e){var r=0;if(!e||!e.length)return r;for(var t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r}var k=t(4045),S=t(6875),I=t(2438),b=t(9252),_=t(7022),y=t(27),C=t(2053),w=t(2374),D=t(5330),N=t(8322),P=t(4329),R=t(2325);class j extends D.m{static featureName=N.t;constructor(e,r){var t;super(e,r,N.t),t=this,this.stackReported={},this.pageviewReported={},this.errorCache={},this.currentBody,this.errorOnPage=!1,this.ee.on("interactionSaved",(e=>this.onInteractionSaved(e))),this.ee.on("interactionDiscarded",(e=>this.onInteractionDiscarded(e))),(0,k.X)("err",(function(){return t.storeError(...arguments)}),this.featureName,this.ee),(0,k.X)("ierr",(function(){return t.storeError(...arguments)}),this.featureName,this.ee);const n=(0,y.Mt)(this.agentIdentifier,"jserrors.harvestTimeSeconds")||10,a=new S.o("jserrors",{onFinished:function(){return t.onHarvestFinished(...arguments)}},this);a.harvest.on("jserrors",(function(){return t.onHarvestStarted(...arguments)})),this.ee.on("drain-".concat(this.featureName),(()=>{this.blocked||a.startTimer(n)})),(0,k.X)("block-err",(()=>{this.blocked=!0,a.stopTimer(!0)}),this.featureName,this.ee),(0,P.L)(this.agentIdentifier,this.featureName)}onHarvestStarted(e){var r=this.aggregator.take(["err","ierr","xhr"]);e.retry&&(this.currentBody=r);var t={body:r,qs:{}},n=(0,I.P)((0,y.OP)(this.agentIdentifier).releaseIds);return"{}"!==n&&(t.qs.ri=n),r&&r.err&&r.err.length&&!this.errorOnPage&&(t.qs.pve="1",this.errorOnPage=!0),t}onHarvestFinished(e){e.retry&&this.currentBody&&((0,_.D)(this.currentBody,((e,r)=>{for(var t=0;t<r.length;t++){var n=r[t],a=this.getBucketName(n.params,n.custom);this.aggregator.merge(e,a,n.metrics,n.params,n.custom)}})),this.currentBody=null)}nameHash(e){return p("".concat(e.exceptionClass,"_").concat(e.message,"_").concat(e.stack_trace||e.browser_stack_hash))}getBucketName(e,r){return this.nameHash(e)+":"+p((0,I.P)(r))}canonicalizeURL(e,r){if("string"!=typeof e)return"";var t=(0,s.f)(e);return t===r?"<inline>":t}buildCanonicalStackString(e,r){for(var t="",n=0;n<e.frames.length;n++){var s=e.frames[n],i=a(s.func);t&&(t+="\n"),i&&(t+=i+"@"),"string"==typeof s.url&&(t+=s.url),s.line&&(t+=":"+s.line)}return t}canonicalizeStackURLs(e){for(var r=(0,s.f)((0,y.OP)(this.agentIdentifier).origin),t=0;t<e.frames.length;t++){var n=e.frames[t],a=n.url,i=this.canonicalizeURL(a,r);i&&i!==n.url&&(n.url=i,e.stackString=e.stackString.split(a).join(i))}return e}storeError(e,r,t,n){r=r||(0,C.z)();const a=(0,y.OP)(this.agentIdentifier);let s;if(!t&&a.onerror&&(s=a.onerror(e),s&&("string"!=typeof s.group||!s.group.length)))return;var i=this.canonicalizeStackURLs(f(e));const o={stackHash:p(this.buildCanonicalStackString(i)),exceptionClass:i.name,request_uri:w._A?.location.pathname};i.message&&(o.message=""+i.message),s?.group&&(o.errorGroup=s.group);var c,u=p("".concat(i.name,"_").concat(i.message,"_").concat(i.stackString));this.stackReported[u]?o.browser_stack_hash=p(i.stackString):(this.stackReported[u]=!0,o.stack_trace=(c=i.stackString).length>65530?c.substr(0,65530):c),o.releaseIds=(0,I.P)(a.releaseIds),this.pageviewReported[u]||(o.pageview=1,this.pageviewReported[u]=!0);var h=t?"ierr":"err",d={time:r};if((0,b.p)("errorAgg",[h,u,o,d],void 0,R.D.sessionTrace,this.ee),(0,b.p)("errorAgg",[h,u,o,d],void 0,R.D.spa,this.ee),!this.blocked)if(null!=o._interactionId)this.errorCache[o._interactionId]=this.errorCache[o._interactionId]||[],this.errorCache[o._interactionId].push([h,u,o,d,g,n]);else{var l={},g=(0,y.C5)(this.agentIdentifier).jsAttributes;(0,_.D)(g,v),n&&(0,_.D)(n,v);var m=u+":"+p((0,I.P)(l));this.aggregator.store(h,m,o,d,l)}function v(e,r){l[e]=r&&"object"==typeof r?(0,I.P)(r):r}}onInteractionSaved(e){this.errorCache[e.id]&&!this.blocked&&(this.errorCache[e.id].forEach((r=>{var t={},n=r[4],a=r[5];(0,_.D)(n,o),(0,_.D)(e.root.attrs.custom,o),(0,_.D)(a,o);var s=r[2];s.browserInteractionId=e.root.attrs.id,delete s._interactionId,s._interactionNodeId&&(s.parentNodeId=s._interactionNodeId.toString(),delete s._interactionNodeId);var i=r[1]+e.root.attrs.id+":"+p((0,I.P)(t));function o(e,r){t[e]=r&&"object"==typeof r?(0,I.P)(r):r}this.aggregator.store(r[0],i,s,r[3],t)})),delete this.errorCache[e.id])}onInteractionDiscarded(e){this.errorCache&&this.errorCache[e.id]&&!this.blocked&&(this.errorCache[e.id].forEach((r=>{var t={},n=r[4],a=r[5];(0,_.D)(n,o),(0,_.D)(e.root.attrs.custom,o),(0,_.D)(a,o);var s=r[2];delete s._interactionId,delete s._interactionNodeId;var i=r[1]+":"+p((0,I.P)(t));function o(e,r){t[e]=r&&"object"==typeof r?(0,I.P)(r):r}this.aggregator.store(r[0],i,r[2],r[3],t)})),delete this.errorCache[e.id])}}},8322:(e,r,t)=>{t.d(r,{A:()=>a,t:()=>n});const n=t(2325).D.jserrors,a="nr@seenError"}}]);