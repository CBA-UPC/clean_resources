(()=>{ window.UBT_LOADTIMES = (window.UBT_LOADTIMES||0) + 1;if(window.UBT_LOADTIMES >1){console.log("UBT_LOADTIMES:"+window.UBT_LOADTIMES);return;}var e={1434:(e,t)=>{"use strict";var r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";t.Z=function(e){try{var t=Math.random().toString(16).slice(-4);if(e<=4)return t.slice(0,e);for(var n="",i=0;i<e-t.length;i++){var o=Math.ceil(Math.random()*(r.length-1));n+=r[o]}return t+n}catch(e){console.error("genRandomStr error.",e)}}},3434:(e,t)=>{"use strict";var r,n;t.Z=(r=16384,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",function(e){var t=[];e=unescape(encodeURIComponent(e));for(var i=0;i<e.length;i++)t.push(e.charCodeAt(i));return function(e){var t=[],i=[],o=-1,s=0,a=0,c=0,u=0,l=[];y(19);for(var d=0;d<e.length&&a<e.length;d+=r)d>0&&(i=i.slice(r)),p();return-1!=o&&v(),2==u?(m(c<<4&63),65==n.length&&(m(64),m(64))):4==u&&(m(c<<2&63),65==n.length&&m(64)),l.join("");function p(){for(var n=f(d+32768,e.length),c=f(n,e.length-3+1);a<n;a++){var u=0,l=0;if(a<c){var p=h();if(a>=s)for(var m=t[p]-1;130!=u&&m>=0&&m>=a-r;){var b=g(m);b>=3&&b>u&&(l=a-m-(u=b)),m=i[m-d]}i[a-d]=t[p]-1,t[p]=a+1}if(u>=3){for(s=a+u,-1!=o&&(v(),o=-1),y(u-3);l>127;)y(255&(127&l|128)),l>>=7;y(l)}else a>=s&&-1==o&&(o=a)}}unction h(){for(var t=0,r=a;r<a+3;r++)t*=16777619,t^=e[r];return 16383&t}function g(t){var r,n,i=f(t+130,a);for(r=t,n=a;r<i&&n<e.length&&e[r]==e[n];r++,n++);return r-t}function v(){for(var t=o;t<a;t+=127){var r=f(127,a-t);y(255&-r);for(var n=t;n<a&&n<t+r;n++)y(e[n])}}function y(e){var t=c<<6-u;m(63&(t|=(c=255&e)>>(u+=2))),u>=6&&m(63&(t=c>>(u-=6)))}(t)})},9662:6077:9670:1318:3658:206:4326:648:9920:8880:9114:8052:3072:5117:9781:4154:317:7207:8113:7392:748:1060:5392:2914:2109:7293:2104:4374:6916:6530:5668:1702:5005:8044:8173:7854:2597:3501:4664:8361:9587:2788:8340:9909:3157:614:4705:8554:111:1913:2190:6244:6339:4758:6277:3070:1236:8006:5181:(e,t)=>{t.f=Object.getOwnPropertySymbols},7976:6324:5296:7674:2140:3887:2626:4488:6200:5465:2309:,6293,1400,5656,9303,7466,7908,7593,4948,1694,1340,6330,9711,3307,3353,4811,5112,9191,7658,541,1703,8862},t={}r.d,r.g(),r.o,r.r,(()=>{"use strict";var e={};r.r(e),r.d(e,{FORCE_EXEC_TAG:()=>j,JSONParse_Safe:()=>k,TTAG:()=>B,compareVersion:()=>x,convertRadix:()=>O,decodeURI:()=>C,divideTaskExec:()=>M,fnWithLimit:()=>P,getDateStr:()=>A,promisify:()=>N,throttle:()=>L,transformLocalValue:()=>U,typeOf});const t={client:{},webClient:{},miniAppClient:{},mini:{},clientType:"",clientInfo:{},watcher:{}}8862),r(7658);let s({});const a=classwatch(e,t){if(t=Array.isArray(t)?t:[t],this.triggeredMap.has(e)){let r=this.triggeredMap.get(e);t.forEach())}else if(this.watchingMap.has(e)){let r=this.watchingMap.get(e)||[];r.push(...t),this.watchingMap.set(e,r)}else this.watchingMap.set(e,t)}trigger(...e){let t=Array.prototype.shift.call(arguments),r=this.watchingMap.get(t);if(this.triggeredMap.set(t,arguments),!r||0===r.length)return!1;for(let e,t=0;e=r[t++];)e.apply(this,arguments);this.watchingMap.delete(t)}getTriggeredVal(e){if(this.triggeredMap.has(e)){let t=this.triggeredMap.get(e);if(null!=t)return Array.from(t)[0]}return null};var c,u,l;r(1703);const d=null===(c="1.1.76             ")?void 0:c.replace(/(\s*$)/,""),p=null===(u="76486/27038        ")?void 0:u.replace(/(\s*$)/,""),f={enterTs:Date.now(),instMap:new Map,curInst:null,version:d,summary:{resouceSize:parseInt(p.split("/")[0])||0,gzipSize:parseInt(p.split("/")[1])||0},setInst:function(e,t){try{if(f.curInst=t,f.instMap.size>=5){let e=f.instMap.keys().next().value;f.instMap.delete(e)}f.instMap.set(e,t)}catch(e){pe.printError("setInst err.",e)}},registerTime:0},h=[],g=f.summary;g.tag={sdkVersion:f.version,npmVersion:(null===(l=f.ubtCom)||void 0===l?void 0:l.version)||""};const v=f,y={UBT_LASTVIEW:"UBT_LASTVIEW",BFA_LS:"UBT_BFA",OLD_MINI_BFA_LS:"CTRIP_UBT_M",UBT:"UBTPending",BFA_COOKIE:"_bfa",VID_COOKIE:"UBT_VID",UBT_DESERTED:"UBT_DESERTED",UBT_UNHANDLED:"UBT_UNHANDLED",UBT_MAGNET:"UBT_MAGNET",UBT_CID:"UBT_CID",UBT_CONFIG:"UBT_CONFIG"},m={BFA:/^1\.\d+\..{3,12}\.1\.\d+\.\d+\.\d+\.\d+\..+$/,VID:/^\d{10,13}\.[a-zA-Z0-9]{3,12}$/,UBT_LSKEY:new RegExp("^"+y.UBT+"_.+$","g"),TEST_ENV:/(\.qa\.nt\.)|(localhost|172\.16|127\.0|10\.15|10\.32)|(\.uat\.)|(\.fws\.)|(\.fat\d*\.)|(\.tripqate\.)|(\.(beta|dev)\.qunar\.)/i,TRIP:/\.trip/gi,INTRANET:/\.ctripcorp\./gi,MOBILE:/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i,TRIP_APP:/(ibuctrip)|(trip\.com_ctripwireless)/i,CTRIP_APP:/ctripwireless/i,UBTC:/^ubtc_([a-zA-Z](_?[a-zA-Z0-9]{1,20}){0,3})$/,PAGE_ID:/^[a-zA-Z0-9_]{1,50}$/},b=3456e7,w=18e5,S=3e5,T=1e4,E=30,I=["o_page_render_check","http_request_perf"],_={repeatErrorDuration:6e4,multiSendIntervalTime:1e3,logReportIt:2e3,multiSendMaxCount:50,fpVersion:"*",tcpSwitch:!1,processChunkCount:20,requestConcurrenceMaxCount:20,mpStoreMaxCount:50,storageMaxSize:2097152}function O(e,t){return null==e?0:("number"==typeof e&&(e=e.toString()),parseInt(e,t))}function R(e){switch(Object.prototype.toString.call(e)){case"[object Number]":return isNaN(e)?ye.NaN:ye.Number;case"[object Boolean]":return ye.Boolean;case"[object String]":return ye.String;case"[object Array]":return ye.Array;case"[object Object]":return ye.Object;case"[object Undefined]":return ye.Undefined;case"[object RegExp]":return ye.RegExp;case"[object Error]":return ye.Error;case"[object Function]":return ye.Function;default:return ye.Unknown}}function k(e,t=null){try{if(!e)return t;let r=JSON.parse(e);return t&&Object.prototype.toString.call(t)!=Object.prototype.toString.call(r)?t:r}catch(e){return t}}function A(){return(new Date).toLocaleDateString("zh-cn").replace(/\//g,"")}function P(e,t=1){return function(){let r=1;return(...n)=>{n[0]&&1==n[0].stop&&(r=t+1),r++>t||e(...n)}}()}function x(e,t){try{if(!e||!t)return-1;let r=e.split("."),n=t.split(".");for(let e=0;e<=2;e++){let t=(r[e].match(/^\d+/g)||[])[0]||0,i=(n[e].match(/^\d+/g)||[])[0]||0;if(t>i)return 1;if(t<i)return-1}return 0}catch(r){return pe.reportError(`compareVersion error.sv:${e},cv:${t}`,r),-1}}function L(e,t){let r,n=!1;const i=()=>{null==r?n=!1:(e(...r),r=null,setTimeout(i,t))};return(...o)=>{let s=o[o.length-1]===j;s&&o.pop(),s||!n?(n=!0,e(...o),setTimeout(i,t)):r=o}}const B={DECODE:1,MAP:2,JSONPARSE:3};function U(e,t=0){return null==e||null==e?null:((t&B.DECODE)==B.DECODE&&(e=C(e)),(t&B.MAP)==B.MAP&&(e=function(e){let t={},r=e.split("&")||[];for(let e=0;e<r.length;e++){let n=r[e].split("=");n.length>1&&(t[n[0]]=n[1])}return t||{}}(e)),(t&B.JSONPARSE)==B.JSONPARSE&&(e=k(e)),e)}function M(e,t,r,n,i){!function o(){try{let s=0;if(e&&e.length>0){let n=e[0];for(;n&&s<=t;)r(n),s++,e.shift(),n=e[0]}i&&i(),e&&e.length>0?setTimeout(),0):n&&n()}catch(e){pe.reportError("unitTask error.",e)}}()}function N(e){return function(...t){let r=e(...t);return Promise.resolve(r)}}const j="force-exec";var D=r(1434);const $=function(){let e="";return function(t){return e||(e=t.isProd?t.isTrip?"https://www.trip.com":t.isLAN?"//apigateway.ctripcorp.com":t.isIPV6?"//upgrade-m.ctrip.com":"//m.ctrip.com":"//gateway.m.fws.qa.nt.ctripcorp.com")}}();function V(e,t){return t||!e.isProd?"//s.uat.qa.nt.ctripcorp.com":e.isTrip?"//ubt-sin.tripcdn.com":"//s.c-ctrip.com"}function F(e){return e.isProd?e.isTrip?"//webresource.tripcdn.com":"//webresource.c-ctrip.com":e.isTrip?"//webresource.english.uat.qa.nt.ctripcorp.com":"//webresource.uat.qa.nt.ctripcorp.com"}function K(e,t=!1){return!e.isFile&&"mini"!=e.clientType||t?"":"https:"}function G(e){const t=$(e);return`${K(e,t.indexOf("http")>0)}${t}/restapi/soa2/18088/getAppConfig.json`}function q(e){return`${K(e)}${$(e)}/restapi/soa2/12538/createClientId`}function z(e,t){return`${K(e)}${V(e,t)}/bf.gif`}const J={context:["pid","vid","sid","pvid","version","appId","deviceImei","deviceMac","env","clientId","url","fromPage","fromPvid","fromSid","screenWidth","screenHeight","cookieLength","cookieCount","storageLength","lang","engine","referrer","appInfo","devicePixelRatio","other","idc","rid","fp","ffp","trafficSource","newVisitor","newSession"],user:["userId","abTest","corpid","duid"],business:["allianceId","allianceSid","allianceOuid","allianceCreateTime","sourceId","orderId","productId","innerOuId","innerSid","pushCode","attrs"],ubtList:["seq","triggerTs","type","subType","data"]},W={[s.ERROR]:"error",[s.USER_BLOCK]:"ub",[s.TRACE]:"tiled_tl",[s.DEV_TRACE]:"tiled_tl",[s.PRIVATE_TRACE]:"pr_t"};var Q=r(3434);async function Z(e,r){let n=JSON.stringify({d:e}),i=function(e,t){return`${K(e)}${V(e,t)}/bee/collect`}(t.clientInfo,r);try{if(t.clientInfo.isSupportSendBeacon&&t.client.reportBySendBeacon)return t.client.reportBySendBeacon(n,i)}catch(e){t.clientInfo.isSupportSendBeacon=!1}let o=await t.client.request({body:n,url:i},T);return o.success&&200==o.data.status?{success:!0}:{success:!1,message:"postReport Faild."}}async function H(e,r,n){try{pe.log4Checking({tag:"report",data:e,ts:Date.now()}),!n&&t.client.reportMagenet&&t.client.reportMagenet());let i=function(e){let t={};for(const r in e){let n=[],i=e[r],o=J[r];o?(Array.isArray(i)?i.forEach((e=>{let t=[];o.forEach(((r,n)=>{t[n]=e[r]})),n.push(t)})):o.forEach()),t[r]=n):t[r]=i}return t}(e);if(i.sendTs=Date.now(),"tcp"==r&&t.client.reportByTcp)return t.client.reportByTcp(i);let o=`ac=b&d=${(0,Q.Z)(JSON.stringify(i))}`;return"single"==r?async function(e,r){return await t.client.imgRequest({body:e,headers:{"Content-Type":"image/gif"},url:z(t.clientInfo,r)})}(o,n):Z(`f00${i.sendTs}!m1Legacy!${o}`,n)}catch(e){return pe.reportError("send error.",e),{success:!1,message:null==e?void 0:e.message}}}class X{static getIntance(){return this._instance||(this._instance=new X),this._instancepush(e,t){try{if(t.type==s.PV||e.pvSend)return this.send(e,t),!0;var r;if(this.pendingPushQ.has(e)&&Array.isArray(this.pendingPushQ.get(e)))null===(r=this.pendingPushQ.get(e))||void 0===r||r.push(t);else this.pendingPushQ.set(e,[t]);return!0}catch(t){return pe.reportError("multiSender push error.",t,e.instKey),!1}}async send(e,t){let r=`${e.instKey}_${t.seq}`;if(this.sendingCount>=_.requestConcurrenceMaxCount)return this.pendingSendQ.set(r,[e,t]),!0;this.pendingSendQ.has(r)&&this.pendingSendQ.delete(r),this.sendingCount++;let n=await H({ubtList:[t],...e.getCommon()},"single");return this.completeSend(e,t,n),n.success}async completeSend(e,t,r){if(this.sendingCount--,t.type==s.PV&&null!=r&&r.success&&(e.pvSend=!0,this.pendingPushQ.has(e))){let t=this.pendingPushQ.get(e)||[];await Promise.all(t.map())),this.pendingPushQ.set(e,[])}let n=Array.from(this.pendingSendQ.values())[0];if(n){const[e,t]=n;await this.send(e,t)}}start(){}close(){}restart(){}}const Y=X,{JSONParse_Safe:ee}=e,te="pv";class reush(e,r){try{if(!t.client.checkLsPush())return this.senderReplacer=this.senderReplacer||Y.getIntance(),this.senderReplacer.push(e,r);let n=e.instKey,i=e.getCommon(),o=r.type==s.PV,a=`${y.UBT}_${n}`,c=o?te:r.seq+"",u=t.client.getLs(a,!0);u&&u.ubts?u.ubts[c]=r:u={common:i,ubts:{[c]:r}};let l=JSON.stringify(u);return this.usedSize=l.length,t.client.setLs(a,l),(o||Object.keys(u.ubts||{}).length>=_.multiSendMaxCount)&&this.send(new Map([[a,u]])),!0}catch(t){return pe.reportError("multiSender push error.",t,e.instKey),!1}}beforeSend(e,r){if(!e||!r||0==r.length)return;r.forEach((t=>this.sendingKeys.add(`${e}_${t}`)));let n=t.client.getLs(e,!0);if(n){let i=n.ubts||{};r.forEach()),0==Object.keys(i).length?t.client.removeLs(e):t.client.setLs(e,JSON.stringify(n)),this.usedSize=JSON.stringify(n).length}}completeSend(e,t){e&&t&&0!=t.length&&t.forEach((t=>{if(this.sendingKeys.delete(`${e}_${t}`),t==te){let t=e.split("_")[1],r=v.instMap.get(t);r&&(r.pvSend=!0)}}))}getNextSendingItems(e){let r=new Map;try{let e=0,n=!1;return t.client.iterateLsKeys((i=>{if(!i||!m.UBT_LSKEY.test(i))return;let o=ee(t.client.getLs(i)),s=(null==o?void 0:o.ubts)||{};o&&s&&0!=Object.keys(s).length||t.client.removeLs(i);let a={};if(!n)for(const t in s){if(e>=_.multiSendMaxCount)break;this.sendingKeys.has(`${i}_${t}`)||(a[t]=s[t],t!=te&&(n=!0,e++))}!(te in s)||te in a||this.sendingKeys.has(`${i}_${te}`)||(a[te]=s[te]),Object.keys(a).length>0&&r.set(i,{common:o.common,ubts:a})})),r}catch(t){return pe.reportError("getNextSendingItems error.",t,e),null}}async send(e){let t=[];return e.forEach(((e,r)=>{let n=e.ubts||{};te in n&&(t.push({lsKey:r,subKeys:[te],request:{...e.common,ubtList:[n[te]]}}),delete n[te]),Object.keys(n).length>0&&t.push({lsKey:r,subKeys:Object.keys(n),request:{...e.common,ubtList:Object.values(n)}})})),await Promise.all(t.map((async({lsKey:e,subKeys:t,request:r})=>{this.beforeSend(e,t);let n=await H(r,"multi");n&&n.success&&this.completeSend(e,t)}))),!0}scheduleSend(e,t){try{let r=this.getNextSendingItems(e);return r&&r.size>0&&(this.send(r),t&&this.scheduleSend(e,!0)),this.scheduleSend.bind(this)}catch(e){pe.reportError("scheduleSend error.",e)}}start(e){return!!t.clientInfo.isSupportLS&&(null!=this.timer||(this.timer=setInterval(this.scheduleSend.call(this,e),_.multiSendIntervalTime)),!0)}close(e){t.clientInfo.isSupportLS&&null!=this.timer&&(clearInterval(this.timer),this.scheduleSend(e,!0))}const ne=re;const ie=class{constructor(e){o(this,"updateSessionTs",L((()=>{let e=t.client.readBfa();this.bfa&&e.id==this.bfa.id&&e.sid==this.bfa.sid&&e.pvid==this.bfa.pvid&&(this.bfa.session_ts=Date.now(),t.client.writeBfa(this,!0))}),2e3));try{t.client.refreshClientEnv(),pe.log4Checking({tag:"new ubt",data:e}),this.props=e,be.ubtPropsCheck(e),this.cacheGroupKey=e.cacheGroupKey,this.appId=e.appId,this.business=e.business||{},this.pageId=this.verifyPageId(e.pageId,this.business),this.initSettings(e.settings),this.isTimeout4waitingFields=!1,this.reportedErrorSet=new Set,this.pendingQueue=[],this.beginTs=e.registerTs||Date.now(),this.instKey=e.instKey,this.nextSeqNum=1,this.sender=t.clientInfo.isSupportLS&&this.sendSetting.isMultiSend?ne.getIntance():Y.getIntance(),this.init(),de.handleBfRegisterReq(this.instKey)}catch(t){var r;this.initInstFailed=!0,pe.printError("init error.",t,{tag:"Ubt.constructor err",data:{props:e,err:t.stack}}),this.clearErrorTimer&&clearInterval(this.clearErrorTimer),null!==(r=this.sender)&&void 0!==r&&r.timer&&clearInterval(this.sender.timer)}}initSettings(e){var t,r,n,i;e=e||{},this.sendSetting={waitingFields:null!==(t=e.waitingFields)&&void 0!==t?t:[],isMultiSend:null===(r=e.isMultiSend)||void 0===r||r,waitingTimes:null!==(n=e.waitingTimes)&&void 0!==n?n:1e4,bizTokenKeys:null!==(i=e.bizTokenKeys)&&void 0!==i?i:[],urlMaxLength:e.urlMaxLength||600,referrerMaxLength:e.referrerMaxLength||500,abTestMaxLength:e.abTestMaxLength||512}}verifyPageId(e,t){return e&&!m.PAGE_ID.test(e)?(pe.printError("PageId is invalid. PageId must contain a maximum of 50 uppercase and lowercase letters, digits, or underscores."),t.invalidPageId=e,"default_pageId"):e}refreshPv(){this.beginTs=Date.now(),this.init(!1)}init(e=!0){this.setBfa(),this.setCommon(),this.instKey||(this.instKey=this.genInstKey()),v.setInst(this.instKey,this),e&&this.initOnlyOnce(),this.send({type:s.PV},this.beginTs),this.sendFPMetric()}initOnlyOnce(){this.startClearErrorTimer(),this.sendSetting.waitingFields&&this.sendSetting.waitingFields.length>0&&setTimeout(),this.sendSetting.waitingTimes),this.sender.start(this.instKey)}startClearErrorTimer(){try{this.clearErrorTimer&&clearInterval(this.clearErrorTimer),this.clearErrorTimer=setInterval(),_.repeatErrorDuration)}catch(e){pe.reportError("startClearErrorTimer error.",e,this.instKey)}}genInstKey(){let e=this.common.context.vid.split(".")[1];return`${this.beginTs}_${e}`set(e){try{let{pageId:r,...n}=e;if(r){let e=this.verifyPageId(r,this.business);this.pageId=e,this.bfa.pageId=e,t.client.writeBfa(this)}return Object.assign(this.business,n),this.setCommon(),this.readyCheck(),{success:!0,readyStatus:this.readyStatus}}catch(e){return pe.reportError("UBT.set error.",e,this.instKey),{success:!1,message:null==e?void 0:e.message}}}send(e,r){try{if(this.updateSessionTs(),!e)throw new fe("send request is empty !");let{type:n,data:i}=e;if(r=r||(new Date).getTime(),t.client.distinctErr&&be.isUbtErrorData(n,i)&&this.isRepeatError(i))return{success:!1,message:"error repeat."};be.stringifySendData(e),be.validateSendRequest(e);let o={seq:this.seqNum_autoAdd,type:n==s.USER_BLOCK?s.ERROR:n,subType:W[n],triggerTs:r,data:be.transformUbtData(e)};return this.pendingQueue.push(o),this.readyCheck(),{success:!0,readyStatus:this.readyStatus}}catch(e){return pe.reportError("send error.",e,this.instKey),{success:!1,message:null==e?void 0:e.message}}readyCheck(){let e=!0;if(this.pageId){if(!this.readyStatus&&!this.isTimeout4waitingFields){let t=Array.from(new Set([...this.sendSetting.waitingFields||[]]));for(let r=0;r<t.length;r++){const n=t[r];if(void 0===this.business[n]){e=!1;break}}}}else e=!1;return this.readyStatus=e,e&&this.handleReady(),e}async handleReady(){await t.client.bindClientInfo(this),t.clientInfo.tcpReady?H({...this.common,ubtList:this.pendingQueue},"tcp"):this.pendingQueue.forEach()),this.pendingQueue=[]}isRepeatError(e){if(this.clearErrorTimer){var t=[e.category,e.message,e.file,e.line,e.column].toString();if(this.reportedErrorSet.has(t))return!0;this.reportedErrorSet.add(t)}return!1}sendFPMetric(){let e=this;de.get({name:"afp",handleResolve:t=>{t&&e.send({type:s.METRIC,key:"bbz_ubt_fp",data:{tag:t}})}})}setCommon(){this.common={context:{},business:{},user:{}};try{var e,r,n,i;let o={pid:this.pageId,vid:this.bfa.vid,sid:this.bfa.sid,pvid:this.bfa.pvid,version:`${v.version}${t.client.sdkVerSuffix||""}`,appId:this.appId,fromPage:null===(e=this.lastView)||void 0===e?void 0:e.pageId,fromPvid:null===(r=this.lastView)||void 0===r?void 0:r.pvid,fromSid:null===(n=this.lastView)||void 0===n?void 0:n.sid,trafficSource:t.client.getTrafficSource(this),newVisitor:1==this.bfa.sid,newSession:1==this.bfa.pvid},{orderId:s,productId:a,loginName:c,url:u,isBack:l,refer:d,abTest:p,...f}=this.business,h={enterTs:v.enterTs,...f||{}};null!==(i=v.ubtCom)&&void 0!==i&&i.symbol&&(h.npmVersion=v.ubtCom.version,h.npmEnterTs=v.ubtCom.enterTs),v.tcpReady&&(h.webVid=this.bfa.vid),"mini"==t.clientType&&(h.miniAppId=t.mini.appId),this.common={context:o,business:{orderId:s,productId:a,attrs:h},user:{userId:c}},t.client.bindClientInfo(this)}catch(e){pe.reportError("setCommon error.",e,this.instKey)}}setBfa(){let e=this.bfa=t.client.readBfa(),r=e.genVid();this.lastView="function"==typeof t.client.readLastView?t.client.readLastView(this):e,r||(r=t.clientInfo.vid),r&&m.VID.test(r)||(r=be.genVidVal());let n=r.split(".");if(Object.assign(e,{vid:r,vid_ts:parseInt(n[0]),id:n[1]}),e.sid&&e.pvid){this.beginTs-e.session_ts>w?(e.sid++,e.pvid=1):e.pvid++,e.lastSession_ts=e.session_ts,e.session_ts=this.beginTs}else e.lastSession_ts=this.beginTs,e.session_ts=this.beginTs,e.sid=1,e.pvid=1;return e.pageId=this.pageId,t.client.writeBfa(this),t.client.writeVID(r),e}},oe="unknown",{fnWithLimit:se,divideTaskExec:ae}=e,ce={success:!0},ue=e=>({success:!1,message:null==e?void 0:e.message});class le{static findUbtInst(e,t){var r;if(e)return v.instMap.get(e);if(t){return Array.from(v.instMap.values()).find())}return null!==(r=v.curInst)&&void 0!==r&&r.cacheGroupKey?void 0:v.curInst}static ubtApiPush(e,t){try{if("boolean"==typeof e)return ce;if(pe.log4Checking({tag:"push req",data:e}),!e||!e.type||!e.data)throw new fe("Invalid push data.");let{type:r,data:n,pvId:i,triggerTs:o,context:s,cacheGroupKey:a}=e;if(function(e,t){return"register"==t}(0,r)){let e=n;return i&&(e.instKey=i),o&&(e.registerTs=o),s&&(e.context=s),e.cacheGroupKey=a,le.register(e)}if(function(e,t){return"get"==t}(0,r))return le.get(n,i);if(function(e,t){return"send"==t}(0,r))return le.sendPush(n,i,o,t,a);if(0,r))return le.setPush(n,i,t,a)}catch(e){pe.reportError("Push error.",e)}}static handleBfRegisterReq(e){t.client.handleAfterRegister&&t.client.handleAfterRegister();let r=[];e!=oe&&r.push(le.BF_REGISTER_MAP.get(oe)),r.push(le.BF_REGISTER_MAP.get(e));for(let e=0;e<r.length;e++){const t=r[e];t&&0!=t.length&&ae(t,_.processChunkCount,))}}static handleBfClientReadyReq(){ae(le.BF_CLIENTREADY_REQS,_.processChunkCount,))}static register(e){try{if(e.instKey){if(v.instMap.has(e.instKey))return e.instKey}else e.instKey=(0,D.Z)(6);return le.pushCheck({data:e,type:"register"})?("mini"==t.clientType&&(e.appId=e.appId||t.mini.appId),new ie(e),e.instKey):e.instKey}catch(e){pe.printError("register err.",e)}}static get(e,r){let{name:n,timeout:i,sync:o,handleResolve:s,handleReject:a}=e||{};try{if(!n)return;"function"!=typeof s&&(o=!0);let c,u=e.name+("bfa"==e.name&&r?`_${r}`:"");if(o)return t.watcher.getTriggeredVal(u);let l=se(s),d=setTimeout((()=>{"function"==typeof a?(a("get timeout."),l({stop:!0})):l(null)}),null!=i?i:5e3);c,t.watcher.watch(u,c)}catch(e){pe.reportError("get error",e,r),a?a(e):s&&s(null)}}static send(e,t){return this.sendPush(e,t)static sendPush(e,t,r,n,i){try{if(e.samle){if(Math.floor(100*Math.random())+1>e.samle)return ce}return r=r||Date.now(),le.invokeInstApi({type:"send",data:e,pvId:t,triggerTs:r,cacheGroupKey:i},n),ce}catch(e){return ue(e)}}static setPush(e,t,r,n){try{return le.invokeInstApi({type:"set",data:e,pvId:t,cacheGroupKey:n},r),ce}catch(e){return ue(e)}}static pushCheck(e){return!!t.client.clientReady||(le.BF_CLIENTREADY_REQS.push(e),!1)}static invokeInstApi(e,t){var r;if(!le.pushCheck(e))return;let{type:n,data:i,pvId:o,triggerTs:s,cacheGroupKey:a}=e,c=le.findUbtInst(o,a),u=e.pvId||oe,l=!c||!(null===(r=le.BF_REGISTER_MAP.get(u))||void 0===r||!r.length)&&!t;if(l){var d,p;if(le.BF_REGISTER_MAP.has(u)&&Array.isArray(le.BF_REGISTER_MAP.get(u)))null===(p=le.BF_REGISTER_MAP.get(u))||void 0===p||p.push(e);else le.BF_REGISTER_MAP.set(u,[e]);null===(d=le.BF_REGISTER_MAP.get(u))||void 0===d||d.push(e)}else"function"==typeof c[n]?c[n](i,s):pe.printError("invokeInstApi error",new fe(`inst:${!!c},type:${n},bufferReq:${l}`))}}o(le,"BF_CLIENTREADY_REQS",[]),o(le,"BF_REGISTER_MAP",new Map);const de=le;class pe{static printInfo(e){console.info(`[UBT INFO] ${e}`)static printError(e,t,r){console.error(`[UBT ERROR] ${e}`,t),r&&pe.log4Checking(r)}static reportReqFail(e,t){de.send({type:s.DEV_TRACE,key:"bbz_ubt_req_fail",data:e},t)}static reportError(e,t,r){try{pe.log4Checking({tag:"error",data:`${e}-${null==t?void 0:t.stack}`}),t instanceof he||console.error(`[UBT ERROR] ${e}`,t),pe.errStacks.push(t.stack);let n=pe.errStacks.length;n>pe.ERR_STACK_SIZE&&(pe.errStacks=pe.errStacks.slice(n-pe.ERR_STACK_SIZE,n));let i="ExceptionError";t instanceof fe?i="ValidationError":t instanceof he&&(i="IgnorableError"),pe.errStacks.filter()).length>=pe.LOOP_LIMIT_MAX||pe.sendErrorUbt({name:e||(null==t?void 0:t.name),stack:null==t?void 0:t.stack,message:`${e}\n ${null==t?void 0:t.message}`,extendedField:{errType:i}},"error",r)}catch(e){pe.printError("reportError error.",t)}}static sendErrorUbt(e,r,n){let i={from:"framework",catcher:`auto_${v.version}_${r}`,...null==e?void 0:e.extendedField};"mini"==t.clientType&&(i.appId=t.mini.mcdAppId),de.send({type:s.ERROR,data:{...e,category:t.client.errCategory,framework:"normal",extendedField:i}},n)}static switchChecking(){try{let e=_.checkConfigs;if(!e||0==e.length)return;pe.checkConfig=e.find((({urlRegex:e})=>e&&new RegExp(e).test(t.client.getUrl()))),pe.checkConfig&&(pe.checkId=(0,D.Z)(6))}catch(e){pe.reportError("Log.switchChecking err.",e)}}static log4Checking(e,t=!0){if(!t||pe.checkConfig)try{var r,n;e.data=k(JSON.stringify(e.data));let i=(null===(r=pe.checkConfig)||void 0===r?void 0:r.tags)||[],o=(null===(n=pe.checkConfig)||void 0===n?void 0:n.keys)||[];if(i.length>0&&!i.includes(e.tag))return;if("report"==e.tag){let t=e.data||{},r=[];if(o.length>0){if((t.ubtList||[]).forEach((e=>{var t;(e.type==s.PV||o.includes(null===(t=e.data)||void 0===t?void 0:t.key))&&r.push(e)})),0==r.length)return;t.ubtList=r}}if(e.ts||(e.ts=Date.now()),h.push(e),!t)return;let a=h.length>=50;pe.reportChecking(a?j:null)}catch(e){pe.printError("log4Checking err",e)}}}o(pe,"LOOP_LIMIT_MAX",5),o(pe,"ERR_STACK_SIZE",10),o(pe,"errStacks",[]),o(pe,"checkConfig",null),o(pe,"checkId",""),o(pe,"reportChecking",L((async()=>{let e=h.length;if(pe.checkConfig&&0!=e)try{let{bfa:r}=v.curInst||{},n=function(e){let t=K(e);return e.isProd?e.isTrip?`${t}//www.trip.com/restapi/soa2/25894/json/reportUbtLog`:`${t}//m.ctrip.com/restapi/soa2/25894/json/reportUbtLog`:`${t}//m.uat.ctripqa.com/restapi/soa2/25894/reportUbtLog`}(t.clientInfo),i=JSON.stringify({id:pe.checkId,page:pe.checkConfig.pageId,bfa:r,logs:h,client:t.clientInfo});await t.client.request({url:n,method:"POST",body:i}),h.splice(0,e)}catch(t){pe.printError("reportCheckingLog err",t),h.splice(0,e)}}),100));class fe extends Error{constructor(e){super(e)}class ge{constructor(){o(this,"clientReady",!1),o(this,"lsStatus",[new Set,0]),o(this,"distinctErr",!0),this.watcher=new a}handleClientReadbeforeOpLs(e,t,r){let n=this.lsStatus,i=this.getLs(t);"s"==e?n[0].add(t):n[0].delete(t),null==r&&(r=""),null==i&&(i="");let o="string"==typeof r?r:JSON.stringify(r),s="string"==typeof i?i:JSON.stringify(i);n[1]+=o.length-s.length}setVid(){let e=this.readVid();if(!e){e=this.readBfa().genVid(),e||(e=be.genVidVal()),this.writeVID(e)}return pe.log4Checking({tag:"setVid",data:{vid:e}},!1),this.watcher.trigger("vid",e),this.clientInfo.vid=e}triggerBfa(e){if(!e||!e.bfa)return;let{bfa:t,instKey:r}=e;[`bfa_${r}`,"bfa"].forEach((e=>{this.watcher.trigger(e,{vid:t.vid,sid:t.sid,pvid:t.pvid,pageId:t.pageId})}))}}let ve({}),ye({});const{typeOf:me}=e;const be={refreshUbtConfigLs:async function(){let e={appId:"5278",categoryList:["ubtconfig"],head:{appid:"5278",cid:t.clientInfo.vid,cver:"000.001",sid:"8892"}},{success:r,data:n}=await t.client.request({body:JSON.stringify(e),url:G(t.clientInfo)});if(r){var i;let e=null===(i=((null==n?void 0:n.configList)||[])[0])||void 0===i?void 0:i.configContent;if(!e)return;t.client.setLs(y.UBT_CONFIG,e)}},setUbtConfig:function(e){e&&(pe.log4Checking({tag:"set config",data:e},!1),Object.assign(_,e),t.clientInfo.tcpReady=t.clientInfo.tcpReady&&_.tcpSwitch)},genVidVal:function(){return`${Date.now()}.${(0,D.Z)(12)}`},isUbtErrorData:function(e,t){return e==s.ERROR},ubtPropsCheck:function(e){if(!e||!e.appId)throw new fe("appId is required !");let{appId:r,settings:n}=e;if("web"==t.clientType&&"number"!=typeof r&&isNaN(parseInt(r)))throw new fe("appId must be a number !");if(null!=n&&n.waitingFields&&!Array.isArray(n.waitingFields))throw new fe("waitingFields must be type of string[] !")},validateSendRequest:function(e){let{type:t,key:r,data:n}=e,i=[...Object.values(s)],o=`${t}-${r}`;if(!i.includes(t))throw new fe(`${o}: Unsupported sending type: ${t}! The supported types include ${i.join(", ")}.`);if(r&&!["number","string"].includes(typeof r))throw new fe(`${o}: key supports only number or string. `);let a=me(n);if(t==s.PV||a!=ye.Null&&a!=ye.Undefined||(e.data="")(t)){if(null!=n&&n.value&&!function(e){let t=me(e=e||0);if(t==ye.Number)return!0;if(t==ye.Object){let t=Object.keys(e);for(let r=0;r<t.length;r++)(r>=E||me(e[t[r]])!=ye.Number)&&delete e[t[r]];return!0}return!1}(n.value))throw new fe(`${o}: illegal metric value.Value:${JSON.stringify(n)}`);if(null!=n&&n.tag&&!function(e,t,r){t=t||!1;let n=Object.keys(t);for(let e=0;e<n.length;e++){let i=n[e],o=t[i],s=me(o);(!I.includes(i)&&e>=r||![ye.String,ye.Boolean,ye.Number].includes(s))&&delete t[i]}return!0}(0,n.tag,30))throw new fe(`${o}: illegal metric tag.`)}if(JSON.stringify(n||"").length>51200){let t=e.data=`${o}: data is too long. The maximum data size is 50KB.`;pe.printError(t)}return!0},stringifySendData:function(e){let{data:t,type:r}=e;if(r==s.METRIC)return;if(!t||me(t)!=ye.Object)return;let n={};for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){let r=t[e];switch(typeof r){case"undefined":case"symbol":case"function":break;case"object":let t;"extendedField"==e&&(console.log("extendedField"),t=(e,t)=>e&&"string"!=typeof t?JSON.stringify(t):t),n[e]=JSON.stringify(r,t);break;default:n[e]=r}}e.data=n},transformUbtData:function(e){let{type:r,key:n,data:i}=e,o={},a=me(i);if(a==ye.Null||a==ye.Undefined)return null;let c=a==ye.Object?i:{data:i};switch(r){case s.TRACE:case s.DEV_TRACE:"mini"==t.clientType&&(c.applet_scene=t.mini.scene),o={key:n,val:c};break;case s.PRIVATE_TRACE:o={key:n,val:i};break;case s.METRIC:o={name:n,tags:i.tag,value:i.value};break;case s.EXPOSURE:o={key:n,data:i};break;default:o={key:n,...c},r==s.ERROR&&(!o.ownerOrgId&&o.organizationId&&(o.ownerOrgId=o.organizationId),o.category=t.client.errCategory)}return o}},we=window.UBT_BIZCONFIG||{};function Se(){let e=Date.now();if(g.fpSwitch=1,"0"==_.fpVersion){let e=t.webClient.getCookie("UBT_FP");if(!e){e=`${(0,D.Z)(6)}-${(0,D.Z)(6)}-${(0,D.Z)(6)}`,t.webClient.setCookie("UBT_FP",e,864e5)}return v.fp=e,void t.watcher.trigger("fp",v.fp)}window.document.addEventListener("cfp_loaded",(()=>{g.fpTime=Date.now()-e;try{let e=window.cfp.toString();R(e)!=ye.Object&&(e={});let{browserId:r,secStr:n}=e;v.fp=r,v.ffp=n,t.watcher.trigger("fp",r),t.watcher.trigger("ffp",n),t.watcher.trigger("afp",{fp:r,ffp:n})}catch(e){pe.reportError("listen c_sec_loaded error.",e)}})),t.webClient.loadScript(function(e,t){return`${K(e)}${F(e)}/ares2/train/csec/${t}/default/sec/c-sec.js`}(t.clientInfo,_.fpVersion))}const Te={loadModules:function(){try{let{isLoadFP:e,isLoadMarketing:r,isLoadRMS:n}=we;!1!==e&&Se(),!1!==n&&t.webClient.loadScript(function(e){return`${K(e)}${F(e)}/ares2/risk/ubtrms/*/default/${e.isOnline?"rms":"mrms"}.js`}(t.clientInfo)),setTimeout((()=>{t.clientInfo.isTrip||!1===r||t.webClient.loadScript(function(e){let t=K(e);return e.isOnline?`${t}//webresource.c-ctrip.com/ResUnionOnline/R1/remarketing/js/remarketing.js`:`${t}//webresource.c-ctrip.com/ResUnionOnline/R7/common/h5Redirect.js`}(t.clientInfo))}),0)}catch(e){pe.reportError("loadModules err.",e)}}};class Ee{static initConsole(){window.UBT_DEV={cdata(){var e;let r=null==v||null===(e=v.curInst)||void 0===e?void 0:e.bfa,{vid:n,sid:i,pvid:o}=r||{};if(n&&i&&o){let e=`${Ee.CDATA_URL}/${n}/${i}/${o}${t.clientInfo.isProd?"":"?env=fws"}`;window.open(e,"_blank")}return n},magnet(){var e;let t=null==v||null===(e=v.curInst)||void 0===e?void 0:e.bfa,{vid:r}=t||{};if(r){let e=`${Ee.MONITOR_URL}?id=${r}&type=vid`;window.open(e,"_blank")}return r},get bfa(){var e;return(null==v||null===(e=v.curInst)||void 0===e?void 0:e.bfa)||{}},get vi}}static async switchMagnet(){try{let e,{magnetKey:r,magnetOn:n}=t.webClient.getUrlSearchObject()||{};if(r&&"true"===n&&(e=await Ee.connectMagnet(r)),"false"===n&&(e=!1,Ee.disconnectMagnet(r)),null==e){let n=t.webClient.getCookie(y.UBT_MAGNET);!n||r&&r!=n||(e=!0)}v.magnetSwitch=e}catch(e){pe.reportError("switchMagnet error.",e)}}static inMagnetDebug(){if(!v.magnetSwitch)return!1;let e=t.webClient.getCookie(y.UBT_MAGNET);return v.magnetSwitch=!!e,v.magnetSwitch}static updateMagnetMaxAge(){let e=t.webClient.getCookie(y.UBT_MAGNET);e&&t.webClient.setCookie(y.UBT_MAGNET,e,S)}static async connectMagnet(e){try{t.webClient.setCookie(y.UBT_MAGNET,e,S);let r=`${Ee.MAGNET_SVC_URL}/${e}?type=debugOn`,n=await fetch(r,{headers:{"Content-Type":"application/json;charset=UTF-8"},method:"POST",body:JSON.stringify({debug:!0,vid:t.clientInfo.vid,meta:{sdkver:v.version}})});if(200==n.status){return!0===(await n.json()).success}return!1}catch(e){return pe.reportError("connectMagnet error.",e),!1}}o(Ee,"MONITOR_URL","http://magnet.mobile.uat.qa.nt.ctripcorp.com/monitor"),o(Ee,"MAGNET_SVC_URL","//magnet.mobile.uat.qa.nt.ctripcorp.com/web/access"),o(Ee,"CDATA_URL","https://mpaas.ctripcorp.com/cdataV2/session");const Ie=Ee,_e=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n?]+)/im;class Ce{static start(){var e,t;if(this.nameRule=(null===(e=_.perfConfig)||void 0===e?void 0:e.nameRule)||{},0==Object.keys(this.nameRule).length||0==(null===(t=_.perfConfig)||void 0===t?void 0:t.sample))return;let r=performance.getEntriesByType("resource");this.pushResourceTiming(r||[]),this.observeResource()}static observeResource(){if(this.observed)return;new PerformanceObserver((e=>{let t=e.getEntries();t&&this.pushResourceTiming(t)})).observe({entryTypes:["resource"]}),this.observed=!0}static triggerReporstatic pushResourceTiming(e,t){var r;if(null==e||e.forEach((e=>{this.checkName(e.name)&&this.UBT_TIMINGS.push({name:e.name,dnsTime:e.domainLookupEnd-e.domainLookupStart,totalTime:e.responseEnd-(e.redirectStart||e.fetchStart),requestTime:e.responseEnd-e.requestStart,tcpTime:e.connectEnd-e.connectStart,redirectTime:e.redirectEnd-e.redirectStart})})),0==this.UBT_TIMINGS.length)return;let n=this.lastReportTs?3e3-(Date.now()-this.lastReportTs):0;if(!(t||n<=0))return void(this.nextExecTimer||(this.nextExecTimer=window.setTimeout(),n)));let i=v.instMap.keys().next().value;de.send({type:s.METRIC,key:"bbz_perf_resource_timing",data:{tag:{timings:JSON.stringify(this.UBT_TIMINGS)}},samle:null===(r=_.perfConfig)||void 0===r?void 0:r.sample},i),this.lastReportTs=Date.now(),this.UBT_TIMINGS=[]}static checkName(e){if(!e)return!1;let t=e.match(_e);if(!t)return!1;let r=t[1],n=(null==r?void 0:r.split("."))||[],i=n.splice(-2).join(".")||"",o=n.join(".")||"";return i in this.nameRule&&-1!=this.nameRule[i].indexOf(o)}}o(Ce,"UBT_TIMINGS",[]),o(Ce,"nameRule",{});const Oe=Ce,Re={start_point:null,start_touch:!1,moving:!1};function ke(e){try{if(!e||!e.reason)return;let t=e.reason,r="string"==typeof t?null:function(e){var t;if(!e)return;let r=e.split("\n"),n=r[r.length-1];n=null===(t=n)||void 0===t?void 0:t.substring(n.indexOf("(")+1,n.indexOf(")"));let i=n.split(":");return i.length<3?void 0:{column:i.pop(),line:i.pop(),file:i.join(":")}}(null==t?void 0:t.stack),n={name:t.message||t,message:t.message||t,stack:null==t?void 0:t.stack,line:null==r?void 0:r.line,column:null==r?void 0:r.column,file:null==r?void 0:r.file};pe.sendErrorUbt(n,"rejection")}catch(e){pe.reportError("handleRejection error.",e)}}function Ae(e,t,r,n,i){try{var o;let s={name:(null==i?void 0:i.name)||(null==e?void 0:e.message)||e,stack:(null==i?void 0:i.stack)||(null==e||null===(o=e.error)||void 0===o?void 0:o.stack),message:(null==i?void 0:i.message)||(null==e?void 0:e.message),line:r||(null==e?void 0:e.lineno),column:n||(null==e?void 0:e.colno),file:t||(null==e?void 0:e.file)};pe.log4Checking({tag:"error-listener",data:s}),pe.sendErrorUbt(s,"error")}catch(i){pe.reportError("handleError error.",i)}}function Pe(e,t){let r=0;if("DIV"==t&&(e.attributes["page-url"]||e.getAttribute("page-url")))return"";if(e.parentNode){let t=e.parentNode.firstChild;for(;t&&t!=e;)1==t.nodeType&&t.tagName==e.tagName&&r++,t=t.nextSibling}return r>0?"["+ ++r+"]":""}function xe(e){try{if(!e||!e.target)return;let n=e.target,i=window.document.documentElement,o=window.document.body;if(n&&1==n.nodeType&&n.nodeName&&n.getBoundingClientRect){var t,r;let a,c,u=n.nodeName.toUpperCase(),l=n.getBoundingClientRect(),d="",p=Math.max(i.scrollLeft,o.scrollLeft),f=Math.max(i.scrollTop,o.scrollTop),h=(null===(t=Re.start_point)||void 0===t?void 0:t.pageX)||e.pageX||0,g=(null===(r=Re.start_point)||void 0===r?void 0:r.pageY)||e.pageY||0,v=O((i.clientWidth||o.clientWidth)/2,10);if("SELECT"==u&&g-l.top-f<0?(d+="[@x='"+O(h+l.left+p-v,10)+"'][@y='"+O(g+l.top,10)+"']",a=h,c=g-f):(d+="[@x='"+(h-v)+"'][@y='"+g+"']",a=O(h-l.left-p,10)||0,c=O(g-l.top-f,10)||0),a>=0&&c>=0&&a<=screen.width+p){d+="[@rx='"+a+"']",d+="[@ry='"+c+"']";let e=function(e){let t,r=[],n=0;for(;e&&9!=e.nodeType;){if(1==e.nodeType){let i=(e.nodeName||"").toUpperCase(),o=e.id||"",s=i+Pe(e,i);o&&"function"==typeof o.indexOf&&-1==o.indexOf("client_id_viewport")&&(s+="[@id='"+o+"']"),t=e.getAttribute("data-ubt-key"),t&&(s+="[@cid='"+t+"']"),r[n++]=s}e=e.parentNode}return r.length>2?r.reverse().join("/"):""}(n);e&&de.send({type:s.ACTION,data:{xpath:e+d,action:"click"}})}}}catch(e){pe.reportError("handleClick error.",e)}}function Le(e){Re.start_point=e.touches&&e.touches[0]||e,Re.moving=!1,Re.start_touch=!0}function Be(e){if(Re.start_touch){var t,r;let n=e.touches&&e.touches[0]||e,i=0,o=0;i=Math.abs(n.pageX-((null===(t=Re.start_point)||void 0===t?void 0:t.pageX)||0)),o=Math.abs(n.pageY-((null===(r=Re.start_point)||void 0===r?void 0:r.pageY)||0)),Re.moving=!(i<6||o<6)}}function Ue(e){!Re.moving&&Re.start_touch&&xe(e),Re.start_touch=!1,Re.start_point=null}function Me(){var e;_.switchBackWvPv&&v.curInst&&(!we.isOpenBackWvPv&&(_.backWvPvBlackList||[]).includes(v.curInst.appId+"")||null===(e=v.curInst)||void 0===e||e.refreshPv())}const Ne={init:function(){window.addEventListener("error",Ae),window.addEventListener("unhandledrejection",ke);let e="ontouchstart"in window,r=e?"touchstart":"mousedown",n=e?"touchmove":"mousemove",i=e?"touchend":"mouseup";window.document.addEventListener(r,Le,!0),window.document.addEventListener(n,Be,!0),window.document.addEventListener(i,Ue,!0),window.document.addEventListener("visibilitychange",(e=>{"visible"===window.document.visibilityState&&v.curInst&&t.webClient.writeLastView(v.curInst)})),window.addEventListener("beforeunload",)),"undefined"!=typeof CtripEventListener&&"function"==typeof CtripEventListener.addHybridEventListener&&CtripEventListener.addHybridEventListener("onPageDidAppear",Me)}};r(541);const je=window.UBT_COMP||{},De={_trace:s.TRACE,_tracklog:s.TRACE,_devTrace:s.DEV_TRACE,_privateTrace:s.PRIVATE_TRACE,_exposure:s.EXPOSURE,_trackMetric:s.METRIC,_trackMatrix:s.METRIC,_trackError:s.ERROR,_trackUserBlock:s.USER_BLOCK};function $e(){1==v.instMap.size&&setTimeout((()=>{!function(){window.__bfi=window.__bfi||[];const e=window.__bfi;g.init_old_counts=e.length,M(e,_.processChunkCount,Ve,)),window.$_bf=window.$_bf||{},window.$_bf._getStatus=function(){let e=v.curInst;if(!e)return{};let{context:t,user:r}=(null==e?void 0:e.getCommon())||{};return{vid:null==t?void 0:t.vid,sid:null==t?void 0:t.sid,pvid:null==t?void 0:t.pvid,abtest:null==r?void 0:r.abTest,pid:e.pageId,pv:e.pvSend}}}()}),0)}function Ve(e){pe.log4Checking({tag:"old push",data:e});try{let[t,...r]=e;if(["_getFullPV","_getStatus","_getFP","_getPageid"].includes(t)){let e,n=r[0],i="function"==typeof n;switch(t){case"_getFullPV":return de.get({name:"bfa",handleResolve:function(e){i&&n(e?`${e.vid}.${e.sid}.${e.pvid}`:"")}});case"_getStatus":return de.get({name:"bfa",handleResolve:function(e){i&&n(e?{vid:e.vid,sid:e.sid,pvid:e.pvid,pid:e.pageId}:{})}});case"_getPageid":return de.get({name:"bfa",handleResolve:function(e){i&&n(!1,null==e?void 0:e.pageId)}});case"_getFP":let e=r[1];return de.get({name:"fp",handleResolve:function(t){if(!i)return;let r="";t&&(r=`a${encodeURIComponent(t)}`),e?n(JSON.stringify({fp:t,sfp:r})):n(t,r,t)}})}return void(n&&"function"==typeof n&&n(e))}let n=v.curInst;if(!n)return;let i=De[t];if(!i)return;let o,a="",c=null;switch(i){case s.TRACE:case s.DEV_TRACE:case s.PRIVATE_TRACE:case s.EXPOSURE:a=r.shift(),o=r[0],c=r[1];break;case s.METRIC:if("_trackMetric"==t){let e=r[0]||{};a=e.name,o={tag:e.tag,value:e.value}}else"_trackMatrix"==t&&(a=r[0],o={tag:r[1],value:r[2]},c=r[4]);break;case s.ERROR:case s.USER_BLOCK:o=r[0],c=r[1];break;default:throw new fe("unsupported old push: "+JSON.stringify(e))}n.send({type:i,key:a,data:o}),"function"==typeof c&&c()}catch(e){pe.reportError("Old api push error.",e)}}let Fe=!1;function Ke(){Fe||window.UBT_LEAVING_TAG||(Fe=!0,pe.log4Checking({tag:"consumer init",data:je}),je&&je.symbol&&x(je.version,"1.1.1")<=0&&(pe.printWarn(`@ctrip/ubt-web版本较低为: ${je.version}，请尽早升级至新版: >1.3.x`),function(){window.UBT_CTOR=ie;let e=t.webClient.getLs(y.UBT_DESERTED,!0)||[],{insts:r}=je,n=[...e,...r||[]];n&&0!=n.length&&(n.forEach((e=>{let{props:t,registerTs:r,requestQ:n,instKey:i}=e,o=new ie({...t,registerTs:r,instKey:i});$e(),e.realInst=o,n.forEach((e=>{let{name:t,data:r,triggerTs:n}=e;o[t](r,n),e.hasReceived=!0}))})),t.webClient.removeLs(y.UBT_DESERTED),je.insts=[])}()),async function(){try{if(window.UBT_API=window.UBT_API||[],R(window.UBT_API)!=ye.Array)return;window.UBT_API_TEMP={push:de.ubtApiPush};let e=t.webClient.getLs(y.UBT_UNHANDLED,!0)||[];R(e)==ye.Array&&window.UBT_API.unshift(...e);let r=window.UBT_API;g.init_new_counts=r.length,M(r,_.processChunkCount,de.ubtApiPush,(()=>{delete window.UBT_API_TEMP,window.UBT_API.push=de.ubtApiPush,window.UBT_API.rewrited=!0}),(()=>{try{if(0==e.length)return;e.splice(0,_.processChunkCount),t.webClient.setLs(y.UBT_UNHANDLED,JSON.stringify(e))}catch(e){pe.printError("afterUnitTaskCb error.",e)}}))}catch(e){pe.reportError("ProcessUbtApi error.",e)}}())}v.consumer=Ke;const Ge={init:Ke,handleAfterRegister:$e};class qe{constructor(e){if).forEach((t=>{this[t]=e[t]})),e.vid&&!e.id)){let t=e.vid.split(".");this.vid_ts=parseInt(t[0]),this.id=t[1]}}genBfaVal(){return`1.${this.vid_ts}.${this.id}.1.${this.lastSession_ts}.${this.session_ts}.${this.sid}.${this.pvid}.${this.pageId||0}`}genVid(){return this.vid?this.vid:this.vid_ts&&this.id?this.vid=`${this.vid_ts}.${this.id}`:void 0}static parse(e,t="cookie"){let r;try{if(!e)return new qe;if("cookie"==t){let t=e.split(".")||[];m.BFA.test(e)&&t.length>6&&(r={vid_ts:parseInt(t[1]),id:t[2],lastSession_ts:parseInt(t[4]),session_ts:parseInt(t[5]),sid:parseInt(t[6]),pvid:parseInt(t[7]),pageId:t[8]})}else{let t=k(e,{});t.vid&&t.sid&&t.pvid&&(r=t)}let n=new qe(r);return n.genVid(),n}catch(e){return pe.reportError("BFA parse error.",e),new qe}}}const ze=qe,Je="ab_testing_tracker";const We=class extends ge{constructor(){super(),o(this,"errCategory",window.__NEXT_DATA__&&"string"==typeof window.__NEXT_DATA__.version?"Nfes-error":"Web-error"),o(this,"clientType","web"),this.init()}async init(){try{"undefined"!=typeof window&&(window.UBT_GLOBAL=v,v.ubtCom=window.UBT_COMP);let e=Date.now();await this.setClientInfo(),pe.log4Checking({tag:"sdk init"},!1),window.UBT_API=window.UBT_API||[],await Ie.switchMagnet(),this.initUbtConfig();let t=Date.now();pe.switchChecking(),Te.loadModules(),Ne.init(),Ge.init(),Oe.start(),Ie.initConsole();let r=Date.now();g.microTime=r-t,this.handleClientReady();let n=Date.now();g.macroTime=n-e}catch(e){ster()}refreshClientEnv(){}initUbtConfig(){try{var e;let t=null===(e=window.UBT_COMP)||void 0===e?void 0:e.ubtConfig;t?v.summary.prefetchConfig=1:(t=this.getLs("UBT_CONFIG",!0),be.refreshUbtConfigLs()),t&&be.setUbtConfig(t)}catch(e){pe.reportErro.business.trafficSource||""}async setClientInfo(){let e=this.checkLsSupport(),t=this.getRootDomain();const{location:r,navigator:n}=window,i=null==n?void 0:n.userAgent,o=n&&n.javaEnabled()?1:0,s=m.CTRIP_APP.test(i),a=m.TRIP_APP.test(i),c=!m.MOBILE.test(i),u=null!=we.isLAN?!!we.isLAN:m.INTRANET.test(r.href),l=r.protocol,d="https:"!=l&&"http:"!=l;let p=null!=we.isOverseas?we.isOverseas:m.TRIP.test(r.host);const f=null!=we.isProd?we.isProd:!m.TEST_ENV.test(r.host),h=/\.uat\./.test(r.host),g=!!window.__ubt_ipv6;let v;v=c?ve.Online:s||a||d?ve.hybrid:ve.H5;let y={clientType:this.clientType,javaEnable:o,isCtripApp:s,isTripApp:a,isOnline:c,isFile:d,webType:v,isSupportLS:e,rootDomain:t,isTrip:p,isProd:f,isUat:h,isLAN:u,isIPV6:g,protocol:l,tcpReady:"undefined"!=typeof CtripBusiness&&"function"==typeof CtripBusiness.app_track_UBT_JS_log_V2};return y.isSupportSendBeacon=this.checkIsSupportSendBeacon(y),this.clientInfo=y,this.initLsStatus(),this.sdkVerSuffix="/new/"+(p?"t":"c"),this.syncCwxParams(),this.setVid(),await this.setClientIds(),this.clientInfo}async bindClientInfo(e){let{common:t,sendSetting:r}=e;try{var n,i,o,s,a,c,u;let l=this.getLocals(r)||{},d={storageLength:this.clientInfo.isSupportLS?null===(n=localStorage)||void 0===n?void 0:n.length:0,env:this.clientInfo.webType,clientId:this.clientID,lang:(navigator&&navigator.language?navigator.language:"").toLowerCase(),screenWidth:screen.width,screenHeight:screen.height,url:null===(i=(null===(o=e.props.context)||void 0===o?void 0:o.url)||this.getUrl())||void 0===i?void 0:i.substring(0,r.urlMaxLength),referrer:null===(s=(null===(a=e.props.context)||void 0===a?void 0:a.referrer)||this.getReferrer())||void 0===s?void 0:s.substring(0,r.urlMaxLength),devicePixelRatio:window.devicePixelRatio||1,cookieLength:document.cookie.length,cookieCount:(document.cookie.match(/[^=]+=[^;]*;?/g)||[]).length,rid:null===(c=window.__NEXT_DATA__)||void 0===c?void 0:c.rootMessageId};Object.assign(t.context,l.context,d),Object.assign(t.business,l.business),Object.assign(t.user,{...l.user,userId:t.user.userId||(null===(u=l.user)||void 0===u?void 0:u.userId)});let p=t.business.attrs.bizTokens||[];p.length>0&&!t.user.duid&&(t.user.duid=p[0]);let f=this.getBizTokens(r.bizTokenKeys);Object.assign(t.business.attrs,{bizTokens:f,eid:l.eid},l.ubtc)}catch(e){pe.reportError("bindClientInfo error.",e)}}readLastView(e){let t=this.getLs(y.UBT_LASTVIEW,!0);if(!t)return;let r=Array.from(v.instMap.keys()),n=r.indexOf(e.instKey),i=n>=0?n-1:r.length-1,o=i>=0&&r[i]==t.instKey,s=`${t.host}${t.path}`;if(o||document.referrer.indexOf(s)>=0)return t;let a=t.fromPage;return a&&document.referrer.indexOf(`${null==a?void 0:a.host}${null==a?void 0:a.path}`)>=0&&t.pageId==e.pageId?t.fromPage:void 0}writeLastView(e){try{let t=e.lastView,r={...e.bfa,host:location.host,path:location.pathname,instKey:e.instKey};if(t){let{fromPage:e,...n}=t;r.fromPage=n}this.setLs(y.UBT_LASTVIEW,JSON.stringify(r))}catch(t){pe.reportError("writeLahis.getCookie(y.VID_COOKIE)}writeVID(e){this.setCookie(y.VID_COOKIE,e||"")}readBfa(){let e=null,t=this.getCookie(y.BFA_COOKIE);if(e=ze.parse(t),!e.id){let t=this.getLs(y.BFA_LS);e=ze.parse(t,"ls")}return e}writeBfa(e,t){this.setCookie(y.BFA_COOKIE,e.bfa.genBfaVal()),this.setLs(y.BFA_LS,JSON.stringify(e.bfa)),t||(this.writeLastView(e),this.triggerBfa(e))}reportMagenet(e){this.clientInfo.isProd&&Ie.inMagnetDebug()&&(e(),Ie.updateMagnetMaxAge())}reportByTcp(e){return CtripBusiness.app_track_UBT_JS_log_V2("ubt_js_sdk_v2",e),{success:!0}}reportBySendBeacon(e,t){let r=new Blob([e],{type:"application/json"});return{success:navigator.sendBeacon(t,r)}}syncCwxParams(){try{if(this.clientInfo.isOnline)return;let e=this.getUrlSearchObject("_cwxobj");if(!e)return;let t=k(decodeURIComponent(e));if(null==t||!t.cid)return;t.cid&&t.cid.length>20&&(t.cid=t.cid.slice(0,20)),this.setLs("UBT_FROM_CWX",JSON.stringify({appid:t.appid,cid:t.cid,personalRecommendSwitch:t.personalRecommendSwitch,localRecommendSwitch:t.localRecommendSwitch,marketSwitch:t.marketSwitch})),window.__nfesGlobalDatas||(this.setLs("GUID",t.cid||""),this.setCookie("GUID",t.cid))}catch(e){pe.reportError("syncCwxParams error.",e)}}async request(e,t){try{const r=new Abt&&setTimeout((()=>r.abort()),t);let n={headers:{"Content-Type":"application/json",Accept:"application/json",...e.headers},method:e.method||"POST",body:e.body,signal:r.signal},i=await fetch(e.url,n),o=await i.json(),s=200==i.status&&i.ok;return{success:s,[s?"data":"message"]:o}}catch(t){return pe.reportReqFail({message:t.message,url:e.url,stack:t.stack}),{success:!1,message:`${null==t?void 0:t.stack}`}}}async imgRequest(e){return new Promise(((t,r)=>{try{let r=new Image;r.referrerPolicy="no-referrer"=function(){t({success:!0})},r.onerror=function(n,i,o,s,a){r.onload=r.onerror=null,t({success:!1,message:`imageReport failed.event: ${n}, error: ${a}`}),pe.reportReqFail({message:null==a?void 0:a.message,url:e.url,stack:null==a?void 0:a.stack})},r.src=`${e.url}?${e.body}`}catch(e){r(e)}}))}async setClientIds(){return new Promise(et t=setTimeout((()=>{e(!1)}),100);try{let r="";if(r=(this.getLs("UBT_FROM_CWX",!0)||{}).cid,g.cid_from=3,!r){g.cid_from=2;let e=this.getCookie("GUID"),t=this.getLs("GUID");r=e||t}r||delete g.cid_from,g.cid_type=r?/{|"|:/g.test(r||"")?2:1:0,this.clientID=r,clearTimeout(t),this.watcher.trigger("cid",r),e(!0)}catch(e){pe.reportError("setClientIds error.",e)}}))}async createCid(e,t=0){try{let r,n={head:{appid:"700062"},appId:"700062",platformCode:1,deviceId:e},i=await this.request({body:JSON.stringify(n),url:q(this.clientInfo)});return i.success&&i.data&&(r=i.data.clientId),!r&&t<3?this.createCid(e,t++):(t>0&&(g.retryCreateCidTimes=t),r)}catch(r){return this.createCid(e,t++)}}getLocals(e,t){if(this.locals&&!t)return this.locals;try{var r,n,i,o,s;let t=(this.clientInfo.isProd?"PRO":this.clientInfo.isUat?"UAT":"FAT")+"_Servers_Eid",a=this.multiGetCookie([["Session",B.MAP],["CtripUserInfo",B.MAP],["StartCity_Pkg",B.MAP],["Union",B.MAP],["login_uid"],["weduid"],["corpid"],["bid"],["DUID"],["BDUID"],["Servers_Eid"],[t]]),c=this.batchGetLs([["SOURCEID"],["USER",B.JSONPARSE],["CINFO",B.JSONPARSE]]),u=a.Session||{},l=a.CtripUserInfo||{},d=(a.StartCity_Pkg,a.Union||{}),p=a.login_uid,f=a.DUID||window.ubt_duid||l.U||"",h=p;if(!f&&!h){let e=c.USER;if(e&&e.value){let t=e.value;h=t.LoginName||t.UserName,f=t.UserID}}let g=d;g||(g=this.getLs("UNION",!0));let v=k(g.exmktID)||{},y=this.getUrlSearchObject(),m=this.getOther(),b=this.getAppInfo(c.CINFO),w=this.getIdc(),S={eid:a[t]||a.Servers_Eid,ubtc:this.readUbtc(),context:{engine:null!==(r=u.SmartLinkCode)&&void 0!==r?r:"",other:JSON.stringify(m),appInfo:b,idc:w},user:{corpid:a.corpid,duid:"we.ctrip.com"==location.hostname?a.weduid:f,userId:h,abTest:this.getABtest(e.abTestMaxLength)},business:{allianceId:null!==(n=g.AllianceID)&&void 0!==n?n:"",allianceSid:null!==(i=g.SID)&&void 0!==i?i:"",allianceOuid:null!==(o=g.OUID)&&void 0!==o?o:"",allianceCreatetime:null!==(s=g.createtime)&&void 0!==s?s:"",sourceId:c.SOURCEID,innerSid:v.innersid||y.innersid,innerOuid:v.innerouid||y.innerouid,pushCode:v.pushcode||y.pushcode}};return this.locals=S}catch(e){pe.reportError("getLocals error.",e)}}readUbtc(){let e={},t=this.getCookieAll();for(const r in t)m.UBTC.test(r)&&(e[r.substring(5)]=t[r]);return e}getBizTokens(e){if(!e||0==e.length)return[];e.length>3&&(e=e.slice(0,3));let multiGetCookie(e.map((e=>[e])))||{};return Object.values(t).filter((e=>!["",null,void 0].includes(e)))}getAppInfo(e){let t={version:(null==e?void 0:e.internalVersion)||"",ver:null==e?void 0:e.version,net:(null==e?void 0:e.networkStatus)||"None",platform:(null==e?void 0:e.platform)||""};return JSON.stringify(t)}getIdc(){let e="";try{let t=document.documentElement;e=t.dataset&&t.dataset.idc||t.getAttribute("data-idc")||""}catch(e){pe.reportError("getIdc error.",e)}return(e+"").substring(0,30)}getOther(){let e="";if("object"==typeof window.Lizard){let t=window.Lizard;e=t.selfCollection||t.version||""}let t={fef_name:"",fef_ver:"",rg:this.getCookie("_RSG",""),lang:document.documentElement.getAttribute("lang")||""};return this.clientInfo.isOnline?t.lizard=e:(t.tz=-(new Date).getTimezoneOffset(),t.dt=outerHeight-innerHeight>160||outerWidth-innerWidth>160),t}getABtest(e){try{let t="",r="",n=document.getElementById(Je),i=[];for(;n;){let e=n.value;/;$/.test(e)||(e+=";"),r+=e,i.push(n),n.removeAttribute("id"),n.removeAttribute("name"),n=document.getElementById(Je)}for(let e=0;e<i.length;e++)i[e].setAttribute("id",Je);let o=location.hash;if(o.indexOf("abtest=")>=0){let e=o.replace(/.*(abtest=)/i,"").replace(/#.*/i,"");r+=decodeURIComponent(e)}return e&&e>0?r.substring(0,e):t}catch(e){return pe.reportError("getABtest error.",e),""}}getReferrer(){let e="";e=document&&document.referrer;try{!e&&opener&&(e=opener.location&&opener.locattUrl(){return location.href}setCookie(e,t,r=b){let n=this.clientInfo.rootDomain?`;domain=${this.clientInfo.rootDomain}`:"",i="";if(r>=0){i=`;expires=${new Date((new Date).getTime()+r).toUTCString()}`}return document.cookie=`${e}=${encodeURIComponent(t)}${n};path=/${i}`,!0}getCookie(e,t,r){let n=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),i=document.cookie.match(n),o=t||"";return i&&(o=r?decodeURI(i[2]):i[2]),o}checkLsPush(){if(!this.clientInfo.isSupportLS)return!1;let[,e]=this.lsStatus;return e<4194304}initLsStatus(e="B"){if(!this.clientInfo.isSupportLS)return this.lsStatus=[new Set,0];let t=0,r=new Set;for(const e in localStorage)if(Object.prototype.hasOwnProperty.call(localStorage,e)){let n=localStorage.getItem(e);null!==n&&(r.add(e),t+=n?n.length:0)}return"KB"==e&&(t=Math.ceil(t/1024)),"MB"==e&&(t=Math.ceil(t/1024)),this.lsStatus=[r,t]}setLs(e,t){this.clientInfo.isSupportLS&&(this.beforeOpLs("s",e,t),window.localStorage.setItem(e,t))}removeLs(e){this.clientInfo.isSupportLS&&(this.beforeOpLs("r",e),window.localStorage.removeItem(e))}getLs(e,t){if(!this.clientInfo.isSupportLS)return;let r=window.localStorage.getItem(e);return t?k(r):r}iterateLsKeys(e){let t=localStorage.length;for(let r=0;r<t;r++){const t=localStorage.key(r);t&&e(t)}}batchGetLs(e){let t={};if(!this.clientInfo.isSupportLS)return t;let r=window.localStorage;return e.forEach((([e,n])=>{let i=r[e];i=U(i,n),t[e]=i})),t}checkLsSupport(){if(Storage&&localStorage){try{localStorage.setItem("store_test","1"),localStorage.getItem("store_test"),localStorage.removeItem("store_test")}catch(e){return!1}return!0}return!1}getUrlSearchObject(e){let t=document.location.search.replace("?",""),r=this.mapQuerys2Object(t)||{};return e?r[e]:r}mapQuerys2Object(e){let t={},r=e.split("&")||[];for(let e=0;e<r.length;e++){let n=r[e].split("=");n.length>1&&(t[n[0]]=n[1])}return t||{}}checkIsSupportSendBeacon(e){return"object"==typeof navigator&&"function"==typeof navigator.sendBeacon&&(e.isTripApp||e.isCtripApp||"undefined"==typeof CtripBusiness)&&!e.isFile&&-1==navigator.userAgent.indexOf("tripPal")&&-1==navigator.userAgent.indexOf("AliApp")&&!/CBP(IOS)?_Wireless/i.test(navigator.userAgent)}multiGetCookie(e){let t={},r=this.getCookieAll();return e.forEach((([e,n])=>{let i=r[e];i=U(i,n),t[e]=i})),t}getCookieAll(){let e=document.cookie;if(!e)return{};let t={};return e.split("; ").forEach((e=>{let r=e.indexOf("="),n=e.substring(0,r),i=e.substring(r+1);t[n]=i})),t}removeCookie(e){let t=this.getRootDomain();document.cookie=`${e}=;domain=${t};expires=Thu, 01 Jan 1970 00:00:01 GMT;`}getRootDomain(){let e="",t="_bfp=cookie",r=location.hostname.split(".");for(let n=r.length-1;n>=0;n--)if(e="."+r.slice(n).join("."),document.cookie=`${t};domain=${e};`,document.cookie.indexOf(t)>-1)return document.cookie=`${t.split("=")[0]}=;domain=${e};expires=Thu, 01 Jan 1970 00:00:01 GMT;`,e;return e}async loadScript(e,t,r=!0){if(!e)return;let n=!1,i=document.createElement("script");i.type="text/javascript",i.async=!0,i.setAttribute("crossorigin","anonymous"),i.onload=i.onreadystatechange=function(e){n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(this.onload=this.onreadystatechange=null,n=!0,t&&t(e))},r&&(e=e+"?v="+A()),i.src=e;let o=document.getElementsByTagName("body")[0];null==o||o.appendChild(i)}};t.client=t.webClient=new We,t.clientType=t.client.clientType,t.clientInfo=t.client.clientInfo,t.watcher=t.client.watcher})()})();