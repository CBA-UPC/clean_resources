!"Fingerprint2",this,function(){"use strict";var e=return e.prototype={extend:get:customEntropyFunction:userAgentKey:function(e){return this.options.excludeUserAgent||e.push({key:"user_agent",value:this.getUserAgent()}),e},getUserAgent:languageKey:colorDepthKey:pixelRatioKey:function(e){return this.options.excludePixelRatio||e.push({key:"pixel_ratio",value:this.getPixelRatio()}),e},getPixelRatio:screenResolutionKey:function(e){return this.options.excludeScreenResolution?e:this.getScreenResolution(e)},getScreenResolution:availableScreenResolutionKey:getAvailableScreenResolution:timezoneOffsetKey:sessionStorageKey:function(e){return!this.options.excludeSessionStorage&&this.hasSessionStorage()&&e.push({key:"session_storage",value:1}),e},localStorageKey:function(e){return!this.options.excludeSessionStorage&&this.hasLocalStorage()&&e.push({key:"local_storage",value:1}),e},indexedDbKey:addBehaviorKey:openDatabaseKey:cpuClassKey:function(e){return this.options.excludeCpuClass||e.push({key:"cpu_class",value:this.getNavigatorCpuClass()}),e},platformKey:function(e){return this.options.excludePlatform||e.push({key:"navigator_platform",value:this.getNavigatorPlatform()}),e},doNotTrackKey:function(e){return this.options.excludeDoNotTrack||e.push({key:"do_not_track",value:this.getDoNotTrack()}),e},canvasKey:webglKey:adBlockKey:function(e){return this.options.excludeAdBlock||e.push({key:"adblock",value:this.getAdBlock()}),e},hasLiedLanguagesKey:function(e){return this.options.excludeHasLiedLanguages||e.push({key:"has_lied_languages",value:this.getHasLiedLanguages()}),e},hasLiedResolutionKey:function(e){return this.options.excludeHasLiedResolution||e.push({key:"has_lied_resolution",value:this.getHasLiedResolution()}),e},hasLiedOsKey:function(e){return this.options.excludeHasLiedOs||e.push({key:"has_lied_os",value:this.getHasLiedOs()}),e},hasLiedBrowserKey:function(e){return this.options.excludeHasLiedBrowser||e.push({key:"has_lied_browser",value:this.getHasLiedBrowser()}),e},fontsKey:flashFontsKey:jsFontsKey:pluginsKey:getRegularPlugins:getIEPlugins:pluginsShouldBeSorted:touchSupportKey:function(e){return this.options.excludeTouchSupport||e.push({key:"touch_support",value:this.getTouchSupport()}),e},hardwareConcurrencyKey:hasSessionStorage:function(){try{return!!window.sessionStorage}catch(e){return!0}},hasLocalStorage:function(){try{return!!window.localStorage}catch(e){return!0}},hasIndexedDB:getHardwareConcurrency:function(){return navigator.hardwareConcurrency?navigator.hardwareConcurrency:"unknown"},getNavigatorCpuClass:function(){return navigator.cpuClass?navigator.cpuClass:"unknown"},getNavigatorPlatform:getDoNotTrack:getTouchSupport:getCanvasFp:"~")},getWe"~")},getAdrn t},getHasLiedLangrn!1},getHasLiedResolight},getHasLiedOs:function(){var e,t=navigator.userAgent.toLowerCase(),n=navigator.oscpu,r=navigator.platform.toLowerCase();e=t.indexOf("windows phone")>=0?"Windows Phone":t.indexOf("win")>=0?"Windows":t.indexOf("android")>=0?"Android":t.indexOf("linux")>=0?"Linux":t.indexOf("iphone")>=0||t.indexOf("ipad")>=0?"iOS":t.indexOf("mac")>=0?"Mac":"Other";var i;if(i="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,i&&"Windows Phone"!==e&&"Android"!==e&&"iOS"!==e&&"Other"!==e)return!0;if("undefined"!=typeof n){if(n=n.toLowerCase(),n.indexOf("win")>=0&&"Windows"!==e&&"Windows Phone"!==e)return!0;if(n.indexOf("linux")>=0&&"Linux"!==e&&"Android"!==e)return!0;if(n.indexOf("mac")>=0&&"Mac"!==e&&"iOS"!==e)return!0;if(0===n.indexOf("win")&&0===n.indexOf("linux")&&n.indexOf("mac")>=0&&"other"!==e)return!0}return r.indexOf("win")>=0&&"Windows"!==e&&"Windows Phone"!==e||(r.indexOf("linux")>=0||r.indexOf("android")>=0||r.indexOf("pike")>=0)&&"Linux"!==e&&"Android"!==e||(r.indexOf("mac")>=0||r.indexOf("ipad")>=0||r.indexOf("ipod")>=0||r.indexOf("iphone")>=0)&&"Mac"!==e&&"iOS"!==e||0===r.indexOf("win")&&0===r.indexOf("linux")&&r.indexOf("mac")>=0&&"other"!==e||"undefined"==typeof navigator.plugins&&"Windows"!==e&&"Windows Phone"!==e},getHasLiedBr==e)},isCanvasSuppd"))},isWebGlSupp&!!e}nt))},hasSwfObjectLject},hasMinFlashInst.0")},addFlashDid(e)},loadSwfAndDetect,{})},getWebglCl),t}turn),r)},x[3]]},x64Mul[3]]},x6-t])},x64Left2,0]},x[1]]},x6>1])},x64ha(-8)}},e.VERSION="1.5.1",e}),function(e){function t(){var e=/(?=.*(chrome)).*/i.test(navigator.userAgent)&&navigator.storage&&navigator.storage.estimate;e&&navigator.storage.estimate().then(function(e){return e.quota<12e7?Promise.resolve(!0):Promise.resolve(!1)})}function n(){if(e.webkitRequestFileSystem)return e.webkitRequestFileSystem(e.TEMPORARY,1,s,o),!0}function r(){if("MozAppearance"in document.documentElement.style&&!navigator.serviceWorker)return!0}function i(){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){try{e.openDatabase(null,null,null,null)}catch(t){o()}try{localStorage.length?s():(localStorage.x=1,localStorage.removeItem("x"),s())}catch(t){navigator.cookieEnabled?o():s()}return!0}}function a(){if(!e.indexedDB&&(e.PointerEvent||e.MSPointerEvent))return o(),!0}var o,s;e.isPrivateWB=function(e,l){o=e||function(){}n(){},t()||n()||r()||i()||a()||s()}}(window);var Weizenbock=Weizenbock||{availableEvents:["pixelSuccess","pixelError","weizenbockError"],_events:{},on:function(e,t){this.availableEvents.indexOf(e)!==-1&&"function"==typeof t&&(void 0===this._events[e]&&(this._events[e]=new Array),this._events[e].push(t))}};!function(){function debug(){if("active"==dmode)for(var e=0;e<arguments.length;++e)console.log("Weizenbock:",arguments[e])}function randomString(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");e||(e=Math.floor(Math.random()*t.length));for(var n="",r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function getFingerPrint(e){var t=getCookie("wbfp2");return document.cookie="wbfp=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",t?(debug("Fingerprint loaded"),e(t)):void(new Fingerprint2).get(function(t,n){var r=null;try{r=localStorage.getItem("wbfprnd")}catch(i){}if(r)debug("RND loaded");else{r=randomString(12),debug("RND generated");try{localStorage.setItem("wbfprnd",r)}catch(i){}}return t+=r,document.cookie="wbfp2="+t+"; expires=Thu, 18 Dec 2050 12:00:00 UTC; path=/",debug("Fingerprint generated"),e(t)})}function getPixel(e,t){return new Promise(function(n,r){var i=new XMLHttpRequest;i.open("POST",e),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.oxt))},i.onr"))},i.send(t)})}function getCookie(e){var t="; "+document.cookie,n=t.split("; "+e+"=");return 2==n.length&&n.pop().split(";").shift()}function extend(){for(var erop]},n=0;n<arguments.length;n++)t(arguments[n]);return e}function getNewFingerPrintRand(e,t,n){"boolean"!=typeof n&&(n=!1);var r=getCookie(t);if(r)return debug(t+" loaded"),e(r);var i=null;if(n)try{i=localStorage.getItem(t)}catch(a){}if(i)debug("RND "+t+" loaded");else if(i=randomString(36),debug("RND "+t+" generated"),n)try{localStorage.setItem(t,i)}catch(a){}return document.cookie=t+"="+i+"; expires=Thu, 18 Dec 2050 12:00:00 UTC; path=/",debug("Fingerprint "+t+" generated"),e(i)}function execEvent(e,t){Weizenbock._events[e]&&Weizenbock._events[e].length>0?Weizenbock._events[e].fos,t)}):debug("No actions for event: "+e)}var dmode="off",eventCookieName="wbad";debug("Initializated"),window.addEventListener("pageshow",function(){debug("DOM Ready");var incognito=new Promise(function(e,t){isPrivateWB(function(){e(!1)})}),browserFP=new Prt)})}),browserFPRand=new Promise(function(e,t){getNewFingerPrintRand(function(t){e(t)},"wbnfpr",!1)}),browserFPRandAcid=new Promise(function(e,t){getNewFingerPrine(t)},"wbnfpra",!0)}),adBloquer=new Promise(function(e,t){var n="https://mt-wzb.clarin.com".replace(/[\.\:\-\/\\\s]+/g,"").toLowerCase()+"_canRunAds";wind(!t)};var r=document.createElement("script");r.setAttribute("async",!0),r.setAttribute("src","https://mt-wzb.clarin.com/weizenbock/amazon/js/ads.js"),r.setAttribute("onerror","window['"+n+"'](false)"),document.getElementsByTagName("head")[0].appendChild(r)}),domParameters=new Promise(function(e,t){var n={},r=document.getElementById("wb_meter");if(r){for(var i,a=0,o=r.attributes,s=o.length;a<s;a++){var i=o[a];"wbsession"!=i.nodeName||""!=i.nodeValue&&"null"!=i.nodeValue||(i.nodeValue="anonymous"),"id"!=i.nodeName&&(n[i.nodeName]=i.nodeValue)}delete n.jwt,e(n)}else t("Invalid parameters")}),jwt=new Promise(function(e,t){if(null==localStorage.getItem("wads_userProfile"))return void e("");var n=document.querySelector("#wb_meter"),r=0,i=10;if(n)var a=setInterval(function(){var t=n.getAttribute("jwt");r++,debug("Intento "+r+" de conseguir el jwt"),null!=t&&""!=t?(debug("Se consiguiÃ³ el jwt: ",t),clearInterval(a),e("anonymous"==t?"":t)):r>=i&&(e(""),debug("No se pudo conseguir el jwt"),clearInterval(a))},250);else t("Invalid parameters")}),getParametersFromClientFuntion=new Promise(function(e,t){var n={};if("function"==typeof weizenbockParameters){debug("Getting params from function");try{n=weizenbockParameters()}catch(r){return t(r)}}return e(n)});Promise.all([browserFP,incognito,adBloquer,domParameters,getParametersFromClientFuntion,browserFPRand,browserFPRandAcid,jwt]).then(function(values){var args={};console.log("JWT: ",values),args.jwt=values[7],args.wbnfpr=values[5],args.wbnfpra=values[6],args.wbfp=values[0],args.wbprv=values[1],args.wbadb=values[2],args.wbuid=getCookie("__WASID")||"anonymous",args.wbref=document.referrer||"direct",args.url=encodeURIComponent(window.location.href||document.URL);var url="https://mt-wzb.clarin.com/weizenbock/pixel.fingerprint.gif";args.pagegroups="";var _data=extend(args,values[3],values[4]),postArgs=[];for(_prop in _data)postArgs.push(_prop+"="+_data[_prop]);getPixel(url,postArgs.join("&")).then(function(response){var _resp=JSON.parse(response);if(debug("Pixel Success!"),debug("User status -> "+_resp.status),debug("Status rule -> "+_resp.ruleName),"denied"==_resp.status){var cookieValues=[_resp.ruleId,_resp.operationId,_data.apikey];document.cookie=eventCookieName+"="+cookieValues.join(".:.")+"; path=/",eval(_resp.action)}execEvent("pixelSuccess",[_resp])},function(e){console.error("Weizenbock Failed!",e),execEvent("pixelError",[e])})},function(e){debug("Failed"),execEvent("weizenbockError",[e])})},!1),Weizenbock.callEvent=function(e){var t="https://mt-wzb.clarin.com/weizenbock/pixel.event.gif",n=getCookie(eventCookieName);if(!n)return debug("No action related. Event Failed!"),!1;var r=["action="+e,"ruleId="+n.split(".:.")[0],"operationId="+n.split(".:.")[1],"apikey="+n.split(".:.")[2]];getPixel(t,r.join("&")).then(function(e){debug("Pixel Succeed!")})},Weizenbock.whenAvailable=function(e,t){if("object"!=typeof e||"function"!=typeof t)return void debug("Bad parameters in function 'whenAvailable1'");if(e.intent=e.intent||1,e.retries=e.retries||100,e.interval=e.interval||10,!e.name)return void debug("Bad parameters in function 'whenAvailable'");var n=e.interval;window.setTimeout(function(){return e.intent>e.retries?void console.error("Weizenbock: "+e.name+" is never available"):void(window[e.name]?t(window[e.name],e):(e.intent++,window.setTimeout(arguments.callee,n)))},n)}}();