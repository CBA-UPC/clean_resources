!{0:20:function(e,t,n){let i=n(0);const o="amp-web-push-subscription-state",r="amp-web-push-subscribe",s="amp-web-push-unsubscribe",a=new URL(self.location).searchParams.get("subscribersSiteId"),c="undefined"!=typeof siteLanguage?siteLanguage:null;unction l(e){u((function(t){var n=t.transaction(["user"],"readwrite").objectStore("user");n.get("web-push").onsuccess=function(o){var r=o.target.result;if(r&&(r.id&&"granted"===r.permission&&r.permission!==Notification.permission||e)){let e={uuid:r.uuid,subscriber_uuid:r.subscriber_uuid};i.logUnsubscribe(e),r.permission=Notification.permission,n.put(r),t.close()}}}))}function d(e){self.registration.pushManager.getSubscription().then((function(t){t?u((function(n){var o=n.transaction(["user"],"readwrite").objectStore("user");o.get("web-push").onsuccess=function(r){let s=r.target.result,a=e;a.id="web-push",a.permission="granted",a.subscription=t.toJSON(),a.subscriber_uuid=a.subscriber_uuid||s.subscriber_uuid,o.put(a),n.close();let c={service:e.service,token:i.getTokenFromEndpoint(t.endpoint),uuid:e.uuid,vendor:e.vendor,subscription_json:e.subscription,metaData:e.metaData||s.metaData,subscriber_uuid:e.subscriber_uuid||s.subscriber_uuid};i.logSubscribe(c)}})):(subscribeOptions={userVisibleOnly:!0,applicationServerKey:i.urlBase64ToUint8Array(e.vapidPublicKey)},self.registration.pushManager.subscribe(subscribeOptions).then(().catch(())}))}function g(e){return(e=e||{}).data.data=e.data,"string"==typeof e.data.actions&&(e.data.actions=JSON.parse(e.data.actions)),e.data.icon=e.data.icon||"",e.data.badge=e.data.badge||e.data.icon||"",self.registration.showNotification(e.data.title,e.data)}function f(e,t){self.clients.matchAll().then(n=>{for(let i=0;i<n.length;i++){n[i].postMessage({command:e,payload:t})}})}function p(e,t){u((function(n){n.transaction(["user"],"readwrite").objectStore("user").get("web-push").onsuccess=function(o){let r=o.target.result;n.close();const s=`https://odb.outbrain.com/utils/platforms?widgetJSId=PN_1&key=LEGIO5IAI5M75LQ286L7LLHP4&idx=0&format=vjnc&cors=true&portalUrl=${r.site_url||self.location.origin}&lang=${c||r.language||"en"}&extid=${r.uuid}&extid2=${e}&api_user_id=${r.subscriber_uuid}`;i.fetch(s,{credentials:"include"}).then((function(e){!function(e,t){const n=e.documents;if(!n.count>0)return;const i=n.doc[0];if(!i.source_name)return;let o={data:{title:`Sponsored - [${i.source_display_name||i.source_name}]`,body:i.content||"",icon:i.thumbnail.url,target_url:i.url,image:i.thumbnail.url,uuid:t,tag:t,requireInteraction:!0}};Promise.all([g(o),b(i.pixels),m(e.viewability_actions&&e.viewability_actions.reportServed)])}(e.response,t)}))}}))}function b(e){!e&&!e>0||e.forEach(}function m(e){(e||"string"==typeof e)&&fetch(e,{mode:"no-cors"})}self.addEventListener("install",(),self.addEventListener("activate",(function(e){e.waitUntil(self.clients.claim().then(())})),self.addEventListener("message",(function(e){switch(e.data.command){case o:return void function(){let e=null;self.registration.pushManager.getSubscription().then(.then(t=>{if(null==t)f(o,!1);else{f(o,!!e&&"granted"===t)}})}();case r:return void self.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:"BMZD6yIrbCTqDSNJ4qD3YuI4pa5p0qDPSIsD7PyLPBQPA2SgTQgprPZZHspwF2A4MrK0xZ9uQjFnVhH5RJUkIMQ"}).then(()=>{d({vapidPublicKey:"BMZD6yIrbCTqDSNJ4qD3YuI4pa5p0qDPSIsD7PyLPBQPA2SgTQgprPZZHspwF2A4MrK0xZ9uQjFnVhH5RJUkIMQ",service:"webpush",uuid:a,vendor:"2"}),f(r,null)});case s:return void self.registration.pushManager.getSubscription().then(.then(}try{var t=JSON.parse(e.data);"granted"===t.permission&&d(t),"denied"===t.permission&&l(),"ad-push-demo"===t.command&&p("demo","demo")}catch(e){console.log("Error in parsing message data",e)}})),self.addEventListener("push",(function(e){let t=e.data.json();"subscribers-ad"==t.source?e.waitUntil(Promise.all([p(t.data.tag,t.data.uuid),i.track("received",0,t.data.uuid)])):e.waitUntil(Promise.all([g(t),i.track("received",0,t.data.uuid)]))})),self.addEventListener("notificationclose",(function(e){let t=e.notification.data&&e.notification.data.uuid;e.waitUntil(i.track("closed",0,t))})),self.addEventListener("notificationclick",(function(e){e.notification.close();let t=e.notification.data&&e.notification.data.uuid,n=e.notification.data&&e.notification.data.target_url,o=Promise.resolve();e.action&&""!==e.action?(n=e.action,o=clients.openWindow(e.action)):n&&(o=clients.openWindow(n)),e.waitUntil(Promise.all([o,i.track("clicked",0,t,{url:n})]))}))}});