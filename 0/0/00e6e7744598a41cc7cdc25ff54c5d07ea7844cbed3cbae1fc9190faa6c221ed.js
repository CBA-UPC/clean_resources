(self.webpackChunk_kambi_micro_frontend_app_router=self.webpackChunk_kambi_micro_frontend_app_router||[]).push([[9154],{38513:(t,e,r)=>{"use strict";r.d(e,{tr:()=>k,OT:()=>f,Jk:()=>A,Lf:()=>tt,ip:()=>Q,_j:()=>W,IX:);var s=r(22205),i=r.n(s),o=r(7298);class n{static get extend(){return o.Model.extend}render(){throw"ComponentBase->render needs to be over-ridden"}i()(n.prototype,o.Events);var c=r(73955),h=r.n(c);const a=[];let u={};const d={producers:a,producerClassForKey(t){const{key:e}=t;if(0===a.length)throw"There are no producers registered - register producers through the ProducerManager";const r=u[e];if(!r)throw(t=>`No producer found for subscription ${t}!`)(e);return r},producerForKeyregister(t){if(-1===a.indexOf(t)){a.push(t);const e=t.prototype.PRODUCTION_KEY,{key:r}=e;if(u[r])throw((r);return u[r]=t}},reset:()=>(a.length=0,u={})};const l=p={registerProducersproducerForKey:subscribe(t,e,r,s={}){const i=new l(t,r,s);this.producerForKey(e).addComponent(i)},unsubscribeunsubscribeAll(t){d.producers.forEach(()}},b=p;const f=class{static get extend(){return o.Model.extend}constructor(){this.id=`ComponentViewModel_${h()()}`}ubscribear g=r(66073),v=r.n(g),m=r(63105),y=r.n(m),S=r(39693),_=r.n(S),w=r(53632),P=r.n(w),I=r(35161),T=r.n(I),C=r(18446),E=r.n(C),F=r(82569),O=r.n(F),R=r(64721),x=r.n(R);const D=class{constructor(t,e,r,s){this._window=t,this.service=r,this.name=e,this.subscribers=s,this.pollingInterval=void 0,this.lastPollTime=void 0,this.timeout=void 0,this.params=this.getParams(),this.restart()}restart(){let t,e=!(void 0===this.lastPollTime||null===this.lastPollTime);if(this.pollingInterval=this.getPollingInterval(),e){const e=this._window.Date.now()-this.lastPollTime;t=Math.max(this.pollingInterval-e,0)}else t=0;this.setupNextFetch(t)}stop(){this._window.clearTimeout(this.timeout),this.timeout=void 0,this.subscribers=void 0,this.params=void 0,this.service.removeChannel(this)}setupNextFetch(t=this.pollingInterval){this._window.clearTimeout(this.timeout),this.timeout=this._window.setTimeout((()=>{this.lastPollTime=this._window.Date.now(),this.service.fetch(this.params),this.cullImmediateRequests(),this.subscribers&&(this.pollingInterval>0?this.setupNextFetch():this.timeout=void 0)}),t)}addSubscription(t){x()(this.subscribers,t)||(this.subscribers.push(t),this.onSubscriptionsChanged())}removeSubscription(t){x()(this.subscribers,t)&&(this.subscribers=O()(this.subscribers,t),0===this.subscribers.length?this.stop():this.onSubscriptionsChanged())}onSubscriptionsChanged(){const t=this.getParams(),e=!E()(t,this.params),r=this.params;this.params=t;let s=!1;e&&(s=this.service.shouldFetchOnParamsUpdate(this.params,r,this.name)),s?(this.lastPollTime=void 0,this.restart()):this.getPollingInterval()!==this.pollingInterval&&this.restart()}getPollingInterval(){let t;t=this.service.isSocketConnected()?T()(this.subscribers,(t=>t.pollingInterval)):T()(this.subscribers,();const e=P()(t);return e===1/0?0:e}getParams(){let t=T()(this.subscribers,();return t=_()(t),this.service.consolidateParams(t,this.name)}cullImmediateRequests(){let t=y()(this.subscribers,();v()(t,(),this.pollingInterval=this.getPollingInterval()}};class M{static get extend(){return o.Model.extend}constructor(t=window){const e=this;this.channels={},this._window=t,this._socketConnected=!1,this.Model=o.Model.extend({sync:urlparse),this.onFetchSuccess=this.onFetchSuccess.bind(this),this.onFetchError=this.onFetchError.bind(this),this.onPostSuccess=this.onPostSuccess.bind(this),this.onPostError=this.onPostError.bind(this),this.onPutSuccess=this.onPutSuccess.bind(this),this.onPutError=this.onPutError.bind(this),this.onDeleteSuccess=this.onDeleteSuccess.bind(this),this.onDeleteError=this.onDeleteError.bind(this)}socketUp(){this._socketConnected=!0,this.restartChannels()}socketDown(){this._socketConnected=!1,this.restartChannels()}isSocketConnected(){return this._socketConnected}restartChannels(){for(let t in this.channels){if(!this.channels.hasOwnProperty(t))continue;const e=this.channels[t];e.pollingInterval!==e.getPollingInterval()&&e.onSubscriptionsChanged()}}consolidateParams(t){return t[0]}channelForParams(t){return JSON.stringify(t)||"{}"}shouldFetchOnParamsUpdate(){return!0}onFetchSuccess(){}onFetchError(){}onPostSuccess(){}onPostError(){}onPutSuccess(){}onPutError(){}onDeleteSuccess(){}onDeleteError(){}sync(t,e,r){return o.Model.prototype.sync.call(e,t,e,r)}urlarseemoveChannel(t){delete this.channels[t.name]}addSubscription(t){switch(t.method||"GET"){case"GET":return this.addGetSubscription(t);case"POST":return this.post(t.postParams);case"PUT":return this.put(t.putParams);case"DELETE":return this.delete(t.deleteParams)}}addGetSubscription(t){const e=this.channelForParams(t.params),r=this.channels[e];r?r.addSubscription(t):this.channels[e]=new D(this._window,e,this,[t])}removeSubscription(t){if(t){const e=this.channelForParams(t.params),r=this.channels[e];r&&r.removeSubscription(t)}}getModelInstanceropagateResponse(t,e){return this.trigger(t,e)}fetch(t){return this.getModelInstance(t).fetch({success:this.onFetchSuccess,error:this.onFetchError})}post(t){return this.getModelInstance(t).save(void 0,{success:this.onPostSuccess,error:this.onPostError})}put(t){const e=this.getModelInstance(t);if(!e.get("id"))throw"PUT requests must have an id specified in putParams";return e.save(void 0,{success:this.onPutSuccess,error:this.onPutError})}delete(t){return this.getModelInstance(t).destroy({success:this.onDeleteSuccess,error:this.onDeleteError})}}i()(M.prototype,o.Events);const k=M;const A=class{constructor(t=window){this.channels={},this._window=t,this._socketConnected=!1,this.onFetchSuccess=this.onFetchSuccess.bind(this),this.onFetchError=this.onFetchError.bind(this)}socketUp(){this._socketConnected=!0,this.restartChannels()}sSocketConnected(){return this._socketConnected}restartChannels(){for(let t in this.channels){if(!this.channels.hasOwnProperty(t))continue;const e=this.channels[t];e.pollingInterval!==e.getPollingInterval()&&e.onSubscriptionsChanged()}}ouldFetchOnParamsUpdate(){return!0}onFetchSuccess(){}onFetchError(){}url(){}parse(){}dChannelSubscription(t){const e=this.channelForParams(t.params),r=this.channels[e];r?r.addSubscription(t):this.channels[e]=new D(this._window,e,this,[t])}removeSubscription(t){if(t){const e=this.channelForParams(t.params),r=this.channels[e];r&&r.removeSubscription(t)}}getHeaderstch(t){const e=this.url(),r=this.getHeaders(t),s=JSON.stringify(this.getBody(t));return this._window.fetch(e,{method:"POST",headers:r,body:s}).then((t=>{if(t.ok)return t.json();throw new Error(`Fetch error status: ${t.status} url: ${t.url}`)})).then((e=>(this.parse(e,{params:t}),this.onFetchSuccess(e)))).catch(()}};var N=r(3674),j=r.n(N),U=r(44908),Y=r.n(U),K=r(16693),z=r.n(K),Z=r(1469),$=r.n(Z),G=r(23493),J=r.n(G),B=r(91966),L=r.n(B),V=r(52628),H=r.n(V);class q extends o.Collection{get REPOSITORY_DIFF(){return"repository_diff"}get REPOSITORY_ADD(){return"repository_add"}get REPOSITORY_CHANGE(){return"repository_change"}onstructor(...t){super(...t),this._onAdd=this._onAdd.bind(this),this._onChange=this._onChange.bind(this),this._onRemove=this._onRemove.bind(this),this._triggerUpdates=this._triggerUpdates.bind(this)}initialize(){super.initialize(...arguments),this.cid=this.cid||h()("c"),this._throttledAddedModels={},this._throttledChangedModels={},this._throttledRemovedModels={},this._throttledTriggerUpdates=J()(this._triggerUpdates,100,{leading:!1}),this.addThrottledListeners()}etByIds(t){const e=[];for(let r=0;r<t.length;r++){let s=t[r];e.push(this.get(s))}return e}onAll(t,e){switch(t){case"add":this._onAdd(e);break;case"change":this._onChange(e);break;case"remove":this._onRemove(e)}this._throttledTriggerUpdates()}_onAdd(t){this._throttledAddedModels[t.id]=t}_onChange(t){this._throttledChangedModels[t.id]=t}throttledAdd(){const t=q.prototype.REPOSITORY_ADD,e=H()(this._throttledAddedModels);return this._throttledAddedModels={},this._throttledEvent(t,e,t)}_throttledChange(){const t=q.prototype.REPOSITORY_CHANGE,e=H()(this._throttledChangedModels);return this._throttledChangedModels={},this._throttledEvent(t,e,t)}_throttledRemove(){const t=q.prototype.REPOSITORY_REMOVE,e=H()(this._throttledRemovedModels);return this._throttledRemovedModels={},this._throttledEvent(t,e,t)}_throttledEvent(t,e,r){return e.length>0&&this.trigger(t,e,r),e}_throttledDiff(t,e,r){const s=q.prototype.REPOSITORY_DIFF;if(t.length||e.length||r.length){t=L()(t,r);const i=Y()(t.concat(e)),o=Object.freeze({added:Object.freeze(t),changed:Object.freeze(e),removed:Object.freeze(r),consolidated:Object.freeze(i)});this.trigger(s,o,s)}}_triggerUpdates(){this._throttledDiff(this._throttledAdd(),this._throttledChange(),this._throttledRemove())}}const W=q;class X{t PRODUCTION_KEY(t){this._productionKey=t}get repositories(){return this._repositories||[]}set repositories(t){this._repositories=t}et decorators(t){this._decorators=t}constructor(){this.onDiffInRepository=this.onDiffInRepository.bind(this),this.registeredComponents={},this.produceData=J()(this.produceDataSync,100),this._isSubscribedToRepositories=!1}getInstance(){return null!==this.instance&&void 0!==this.instance||(this.instance=new this.constructor),this.instance}addComponent(t){const e=this.registeredComponents[t.id];null==e?(this.registeredComponents[t.id]=t,this.subscribe(t.options),this._isSubscribedToRepositories||(this.subscribeToRepositories(),this._isSubscribedToRepositories=!0)):console.warn("Error when adding component to producer: a component with the same id already exists")}removeComponent(t){const e=this.registeredComponents[t];if(e){this.unsubscribe(e.options),delete this.registeredComponents[e.id];let t=!0;for(let e in this.registeredComponents)if(this.registeredComponents.hasOwnProperty(e)){t=!1;break}t&&(this.unsubscribeFromRepositories(),this._isSubscribedToRepositories=!1)}}subscribeToRepositories(){this.repositories.forEach((t=>{if(t instanceof W)this.subscribeToRepository(t);else{if(!(t.repository instanceof W&&"string"==typeof t.callback))throw"unexpected format of producer repositories definition";this.subscribeToRepository(t.repository,this[t.callback])}}))}unsubscribeFromRepositories(){this.repositories.forEach((t=>{t instanceof W?this.unsubscribeFromRepository(t):t.repository instanceof W&&"string"==typeof t.callback&&this.unsubscribeFromRepository(t.repository)}))}subscribeToRepository(t,e){e||(e=,this.listenTo(t,W.prototype.REPOSITORY_DIFF,e)}ubscribe(){this.produceDataSync()}oduce(t){t=this.decorate(t);for(let e in this.registeredComponents)if(this.registeredComponents.hasOwnProperty(e)){this.registeredComponents[e].callback(t)}}currentData(){}unsubscribe(){}decorate(t){for(let e=0;e<this.decorators.length;e++){(0,this.decorators[e])(t)}return t}odelsToJSONxtend(t,e){for(let r in e)if(e.hasOwnProperty(r)){let s=e[r];t[r]=s}return t}i()(X.prototype,o.Events);const Q=X;const tt=class extends Q{et idType(t){this._idType=t}constructor(){super(...arguments),this.updatedIds=[],this.subscriptions={}}subscribe(t){const e=this.idForOptions(t);if(!this.isIdOfValidType(e))throw`expected the subscription key to be a ${this.idType} but got a ${typeof e}`;return this.subscriptions[e]?this.subscriptions[e].push(t):(this.subscriptions[e]=[t],this.onAddedSubscriptionsForId(e)),this.produceDataSync(e)}isIdOfValidType(t){return typeof t===this.idType}onDiffInRepository(t,e){const r=e=>{const r=this.idForModel(e,t);return $()(r)?y()(r,this.hasId.bind(this)):this.hasId(r)?r:void 0},s=T()(e.added,r),i=T()(e.removed,r),o=T()(e.changed,(e=>{if(this.shouldPropagateModelChange(e,t)){let r=this.idForModel(e,t);if($()(r))return y()(r,this.hasId.bind(this));if(this.hasId(r))return r}}));let n=z()([s,i,o],2);n=_()(n),this.produceDataForIds(n)}produceDataForIds(t=this.allIds()){return this.updatedIds=Y()(this.updatedIds.concat(t)),this.produceData()}allIds(){let t=j()(this.subscriptions);return"number"===this.idType&&(t=T()(t,()),t}produceDataSync(t){if(t)return this.produce([t]);if(this.updatedIds.length>0){let t=this.updatedIds.slice();return this.updatedIds.length=0,this.produce(t)}}unsubscribe(t){const e=this.idForOptions(t),r=this.subscriptions[e];if(r){const s=r.indexOf(t);-1!==s&&(r.splice(s,1),0===r.length&&(delete this.subscriptions[e],this.onRemovedSubscriptionsForId(e)))}else console.warn("Error when unsubscribing from producer: no matching subscription found")}produce(t){let e;const r=Object.assign({},this.registeredComponents);t.forEach((t=>{e=this.currentData(t)||{},e.id=t,e=this.decorate(e),v()(r,(r=>{if(this.registeredComponents.hasOwnProperty(r.id)&&t===this.idForOptions(r.options))return r.callback(e)}))}))}currentData(){}hasId(t){return!(null===this.subscriptions[t]||void 0===this.subscriptions[t])}dForModel(t){return t.id}nAddedSubscriptionsForId(){};const et=class extends W{dSubscriptionToService(t,e){t.addSubscription(e)}ddSubscription(t,e){this.services[t]&&this.addSubscriptionToService(this.services[t],e)}removeSubscription(t,e){this.services[t]&&this.removeSubscriptionFromService(this.services[t],e)}}},18760:87501:81589:13064:34990:97636:44745:33718:82359:71601:83326:84870:27072:53985:(t,e,r)=>{r(9736)("flatMap")},67694:634:45652:23593:39693:23279:16693:(t,e,r)=>{var s=r(21078),i=r(40554);t.exports=,50308:7771:23493:44908:90864:(t,e,r)=>{"use strict";.d(e,{Z:()=>s})},1519:86033:72346:(t,e,r)=>{"use strict";r.d(e,{Z:()=>i});var s=r(90864);,13092:64572:]);
//# sourceMappingURL=kambi-chunk-9154.1539dc2ef6ca4f589e1a.js.map