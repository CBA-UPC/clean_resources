/*! For license information please see vendors~sharepointnotificationservice.3cb7a3f82b645d4a9abc.chunk.v7.js.LICENSE.txt */
(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[663],{RdgM:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r("a9wj");async function i(e,t,r){const{siteUrl:i,driveId:o,fileId:s}=t,a=await Object(n.b)(e,i,o,s,r);if(!a)throw new Error("Failed to fetch file sharepoint ids");return function(e,t){const{siteId:r,webId:n,listId:i}=e;return`SPO_${function(e){return function(e){return e.replace(/(\+|\/|\=)/g,(e=>{if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError(`Unexpected match ${e} encountered in urlEncodeBase64String. Only +/= are to be replaced.`)}))}(window.btoa(e))}(`${r},${n},${i}`)}_${t}`}(a,s)}},VrTk:function(e,t,r){"use strict";r.r(t),r.d(t,"SharepointNotificationService",(function(){return dn}));var n=r("A3AF"),i=r("Wx5u"),o=r("uIjv");const s=["facetCodes","statusCode","innerMostErrorCode","sprequestguid"];function a(e){const t=/[A-Z0-9._%`'+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/gi;return Object.getOwnPropertyNames(e).map((r=>{if(-1===r.toLowerCase().indexOf("message")&&-1===r.toLowerCase().indexOf("error")&&-1===r.toLowerCase().indexOf("stack")&&!1===s.includes(r))return;let n=e[r];void 0!==n&&"string"==typeof n&&(n=n.toString().replace(t,"scrubbed_email"),e[r]=function(e){return e.replace(/(https:\/\/)(\w)+(.sharepoint.com|-my.sharepoint.com|.sharepoint-df.com)/,"(redacted)").replace(/(https:\/\/)(dev.loop.microsoft.com|df.loop.microsoft.com|loop.microsoft.com|preview.loop.microsoft.com|loop.cloud.microsoft|loop.cloud-dev.microsoft)(\/p\/)([a-zA-Z0-9%]+)/,"(redacted)")}(n.toString()))})),e}function c(e,t,r){r&&u(t,r);const n=a(t);e.send({...n,category:i.b.Error}),r&&r.isUserImpacting&&d(e,n)}function d(e,t){var r,n;let s=e;const a=`${null===(r=(n=s).getNamespace)||void 0===r?void 0:r.call(n)}_${t.eventName}`;s=new o.a("ContainerSession",e),s.send({...t,errorAction:a,category:i.b.Error})}function u(e,t){!function(e,t){var r;const n="object"==typeof e&&null!==e;function i(t){if(!n)return;const r=e[t];return"string"==typeof r?r:void 0}t.errorMessage=null!==(r=i("message"))&&void 0!==r?r:String(e),t.errorName=i("name"),t.stack=i("stack"),t.errorType=i("errorType"),t.errorInstanceId=i("errorInstanceId"),t.isUserImpacting=function(t){if(!n)return;const r=e.isUserImpacting;return"boolean"==typeof r?r:void 0}(),s.forEach((r=>{const n=e[r];n&&(t[r]="object"==typeof n?JSON.stringify(n):n)}))}(t,e),e.message=e.message?`${e.message}\n${e.errorMessage}`:e.errorMessage,void 0===e.stack&&(e.stack=function(){let e=(new Error).stack;if(!e)try{throw new Error}catch(t){e=t.stack}return e}())}new Set,new Set,new Map([["Automation",1],["SyntheticTraffic",1],["Local",1],["Staging",1],["Dogfood",.1],["Preview",.1],["Microsoft",.01],["Production",.001],["GCC",0],["GCC-High",0],["DoD",0]]);const l=new Set;class p{static start(e,t,r){const n=new p(e,t,r);return l.add(n),n}markSubActivityStart(e){this.subActivities[e]={startTime:performance.now(),startTimeSinceEpoch:Date.now()},this.addUserTiming&&performance.mark(this.getSubActivityName(e,"start"))}markSubActivityEnd(e,t){const r=this.subActivities[e];if(!r)return;if(this.addUserTiming){const t=this.getSubActivityName(e,"end");performance.mark(t),performance.measure(e,this.getSubActivityName(e,"start"),t)}const n={[`durationMs_${e}`]:Math.round(performance.now()-r.startTime)};this.logSubactivityStartTimes&&(n[`startTime_${e}`]=r.startTimeSinceEpoch),this.additionalPropsToLog={...n,...this.additionalPropsToLog,...t}}setResult(e,t,r,n){this.logActivityResult(e,t,r,null==n?void 0:n.skipLogging,void 0,null==n?void 0:n.sampleEvent)}cancel(e,t,r){this.logActivityResult(e,t,r,!1,!0)}addAdditionalProps(e){this.additionalPropsToLog={...this.additionalPropsToLog,...e}}dispose(){this.cancel();const e=e=>performance.clearMarks(e),t=e=>performance.clearMeasures(e);if(this.addUserTiming){e(this.activityStartName),e(this.activityEndName),this.cachedMeasureName&&t(this.cachedMeasureName);for(const r in this.subActivities)e(this.getSubActivityName(r,"start")),e(this.getSubActivityName(r,"end")),t(r)}}logActivityResult(e,t,r,n,o,s){if(this.hasAlreadyResolved)return;this.hasAlreadyResolved=!0,this.addUserTiming&&performance.mark(this.activityEndName);const c=performance.now(),p=Math.round(c-this.startTime);if(this.isAPerformanceMetric&&((function(){return window._pageTimings||(window._pageTimings={})}())[this.activityName]=p),this.logger&&!n){const n={eventName:this.activityName,startTime:this.startTimeSinceEpoch,durationMs:p,succeeded:e,sampleEvent:s,resultType:o?i.a.Cancelled:e?i.a.Success:i.a.Failure,...this.additionalPropsToLog,...t};!function(e,t,r){r&&u(t,r),t.resultType||void 0===t.succeeded||(t.resultType=t.succeeded?i.a.Success:i.a.Failure);const n=a(t);e.send({...n,category:i.b.Activity}),t.resultType===i.a.Failure&&r&&r.isUserImpacting&&d(e,n)}(this.logger,n,r)}this.logger=void 0,l.delete(this),this.addUserTiming&&performance.measure(this.generateMeasureName(e),this.activityStartName,this.activityEndName)}generateMeasureName(e){return this.cachedMeasureName=`${this.activityName}${!1===e?"-FAILED":""}-${this.identifier}`,this.cachedMeasureName}getSubActivityName(e,t){return`${e}-${t}-${this.identifier}`}constructor(e,t,r){var i;this.activityName=e,this.logger=t,this.isAPerformanceMetric=!1,this.additionalPropsToLog=null==r?void 0:r.additionalPropsToLog,this.addUserTiming=null==r?void 0:r.addUserTiming,this.isAPerformanceMetric=(null==r?void 0:r.isAPerformanceMetric)||!1,this.logSubactivityStartTimes=null===(i=null==r?void 0:r.logSubactivityStartTimes)||void 0===i||i,this.subActivities={},this.identifier=Object(n.a)(),this.activityStartName=`${this.activityName}-start-${this.identifier}`,this.activityEndName=`${this.activityName}-end-${this.identifier}`,this.addUserTiming&&performance.mark(this.activityStartName),this.startTime=performance.now(),this.startTimeSinceEpoch=Date.now()}}var f=r("a9wj");const m="writeToFacetJsonObject";function h(e){return null!=e}function v(e,t,r){return h(t)?Array.isArray(t)?k(t,r,((t,r)=>v(e,t,r))):function(e,t){return(t|=0)<e.Min?e.Min:t>e.Max?e.Max:t}(e,t):null}v.bind(null,{Min:-128,Max:127}),v.bind(null,{Min:0,Max:255}),v.bind(null,{Min:-32768,Max:32767}),v.bind(null,{Min:0,Max:65535});const g=v.bind(null,{Min:-2147483648,Max:2147483647}),I=v.bind(null,{Min:0,Max:4294967295});v.bind(null,{Min:Number.MIN_SAFE_INTEGER,Max:Number.MAX_SAFE_INTEGER}),v.bind(null,{Min:0,Max:Number.MAX_SAFE_INTEGER});const y=function(e,t){return h(e)?Array.isArray(e)?k(e,t,y):e:null},C=function(e,t){return h(e)?Array.isArray(e)?k(e,t,C):h(e)&&""!==e?e:null:null},A=function(e,t){return h(e)?Array.isArray(e)?k(e,t,A):C(e.toISOString(),t):null},P=new Date(0);class T{constructor(e){this.value=e}static createNew(){return new T("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})))}toString(){return this.value}}T.Empty=new T("00000000-0000-0000-0000-000000000000");const w=function(e,t){return h(e)?Array.isArray(e)?k(e,t,w):e!==T.Empty?C(e.toString(),t):null:null},S=T.Empty;function b(e){return function(e){return null!==e&&["number","string","boolean","object"].indexOf(typeof e)>=0}(e)&&!Array.isArray(e)}function N(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function x(e){if(N(e)){const t={};for(const r in e)t[r]=x(e[r]);return t}if(Array.isArray(e)){const t=[];for(let r=0;r<e.length;++r){let n=e[r];b(n)&&t.push(n)}return t}return e}const O=function(e,t){return h(e)?Array.isArray(e)?k(e,t,O):x(e):null},R=function(e,t){return h(e)?Array.isArray(e)?k(e,t,R):C(e.toString(),t):null};function E(e){const t=[];for(let r=0;r<e;++r)t.push(r);return t}function M(e){return Object.keys(e).sort(((t,r)=>e[t]-e[r]))}function D(e,t,r,n){if(!h(e))return null;if(Array.isArray(e))return k(e,n,((e,n)=>D(e,t,r,n)));if(8&n)return I(e,n);const i=Math.min(t.length,r.length);for(let o=0;o<i;++o)if(t[o]===e)return C(r[o],n);return C(e.toString(),n)}function U(e,t,r,n){if(!h(e))return null;if(Array.isArray(e))return k(e,n,((e,n)=>U(e,t,r,n)));if(8&n)return I(e,n);const i=[],o=Math.min(t.length,r.length);for(let n=0;n<o;++n){const o=t[n];if(e&o&&(i.push(r[n]),(e&=~o)<1))break}return e>0&&i.push(e.toString()),C(i.length<1?"None":i.join(","),n)}function k(e,t,r){if(!h(e)||e.length<1)return null;const n=[];for(const i of e){const e=r(i,t);h(e)&&!Array.isArray(e)&&n.push(e)}return n}new class{constructor(e=0,t=0,r=0,n=0){this.Major=e,this.Minor=t,this.Build=r,this.Revision=n}toString(){let e=this.Major+"."+this.Minor;return(this.Build>0||this.Revision>0)&&(e+="."+this.Build,this.Revision>0&&(e+="."+this.Revision)),e}};const j=function(e,t=0){return 16777215&t|(255&e)<<24|4},F=function(e){return(-16777216&e)>>24};class L{constructor(){this.artifacts=new Map,this.parent=L.current,L.current=this}static getOrCreateArtifact(e,t){for(let e=L.current;e;e=e.parent){const r=e.artifacts.get(t);if(r)return r}const r=e();return h(L.current)&&L.current.artifacts.set(t,r),r}exit(){L.current=this.parent}}L.current=null;const J=function(e,t){return h(e)?Array.isArray(e)?k(e,t,J):e.toJsonValue(t):null},$=function(e,t,r){return h(e)?Array.isArray(e)?k(e,t,((e,t)=>$(e,t,r))):(1&t||4&t||e.TypeName!=r||(t|=1),e.toJsonValue(t)):null};function _(e,t,r,n){if(h(r))for(const t of r){let r=e[t];N(r)||(e[t]=r={}),e=r}h(n)&&(e[t]=n)}class B{update(e){}toJsonValue(e){const t=function(e,t){return 1&t||4&t?{}:2&t?{__metadata:{type:e}}:{__type:e}}(this.TypeName,e);return this.processJsonObject(t,e,this.writeToJsonObject,this.writeToFacetJsonObject),t}toFacetJsonValue(e,t=0){return this.toJsonValue(j(e,t))}toJson(e=0){return JSON.stringify(this.toJsonValue(e))}toFacetJson(e,t=0){return this.toJson(j(e,t))}writeToJsonObject(e,t){}[m](e,t){}processJsonObject(e,t,r,n){!function(e,t){try{t()}finally{e.exit()}}(new L,(()=>{4&t?n.call(this,e,t):r.call(this,e,t)}))}}class V extends B{constructor(){super(...arguments),this.TypeClassification=2}}class W{static getOrCreate(){return L.getOrCreateArtifact(W.create,W.artifactId)}static getPersonIndex(e){return h(e)?W.findPerson(e):null}static addPerson(e,...t){if(h(e)){let r=W.findAndUpdatePerson(e);h(r)||(r=new at,W.updatePerson(r,e),W.getOrCreate().push(r));for(const e of t)h(r.Roles)?r.Roles.indexOf(e)<0&&r.Roles.push(e):r.Roles=[e]}}static addPeople(e,...t){if(h(e))for(const r of e)W.addPerson(r,...t)}static create(){return[]}static findAndUpdatePerson(e){const t=W.findPerson(e);if(t>=0){const r=W.getOrCreate()[t];return W.updatePerson(r,e),r}return null}static findPerson(e){const t=W.getOrCreate();for(var r=0;r<t.length;++r){const n=t[r];if(h(n.Provider)&&""!==n.Provider){if(n.Provider===e.Provider&&n.Id===e.Id)return r;if(h(e.Provider)&&""!==e.Provider)continue}if(h(n.Email)&&""!==n.Email){if(n.Email===e.Email)return r;if(h(e.Email)&&""!==e.Email)continue}if(h(n.Name)&&""!==n.Name&&n.Name===e.Name)return r}return-1}static updatePerson(e,t){h(e.Provider)&&""!==e.Provider||(e.Provider=t.Provider,e.Id=t.Id),h(e.Email)&&""!==e.Email||(e.Email=t.Email),h(e.Name)&&""!==e.Name||(e.Name=t.Name)}}W.artifactId=Symbol();class G{static convertToArray(e,t){const r=W.getOrCreate();return t instanceof zt?(W.addPerson(t.Creator,"Creator","InThread"),W.addPeople(t.AnchorCreators,"AnchorCreator"),W.addPerson(t.ParentAuthor,"RepliedTo","InThread"),W.addPeople(t.Participants,"InThread"),W.addPerson(t.TaskCreator,"TaskCreator"),W.addPeople(t.TaskAssignees,"ExistingAssignee"),G.processCommentPreview(t.Preview),r):t instanceof Xt?(W.addPerson(t.Creator,"Creator"),W.addPeople(t.AnchorCreators,"AnchorCreator"),W.addPerson(t.TaskCreator,"TaskCreator"),W.addPeople(t.TaskAssignees,"ExistingAssignee"),G.processCommentPreview(t.Preview),r):t instanceof Ht?(W.addPerson(t.Creator,"Creator"),W.addPerson(t.Mentionee,"Mentioned"),W.addPerson(t.TaskCreator,"TaskCreator"),W.addPeople(t.TaskAssignees,"ExistingAssignee"),G.processCommentPreview(t.CommentPreview),r):t instanceof jt?(W.addPerson(t.Creator,"Creator"),W.addPerson(t.Mentionee,"Mentioned"),r):t instanceof Qt?(W.addPerson(t.Creator,"Creator"),W.addPerson(t.CommentThreadCreator,"CommentThreadCreator"),W.addPeople(t.Assignees,"NewAssignee"),G.processCommentPreview(t.CommentPreview),r):t instanceof er?(W.addPerson(t.Creator,"Creator"),W.addPerson(t.TaskCreator,"TaskCreator"),W.addPeople(t.Assignees,"ExistingAssignee"),W.addPeople(t.NewAssignees,"NewAssignee"),G.processCommentPreview(t.CommentPreview),r):t instanceof Yt?(W.addPerson(t.Creator,"Creator"),W.addPerson(t.TaskCreator,"TaskCreator"),W.addPeople(t.Assignees,"ExistingAssignee"),G.processCommentPreview(t.CommentPreview),r):t instanceof tr?(W.addPerson(t.Creator,"Creator"),W.addPerson(t.TaskCreator,"TaskCreator"),W.addPeople(t.Assignees,"Assignee"),W.addPeople(t.PreviousAssignees,"PreviousAssignee"),r):t instanceof rr?(W.addPerson(t.Creator,"Creator"),r):t instanceof ir?(W.addPerson(t.Creator,"Creator"),W.addPerson(t.CommentCreator,"CommentCreator"),W.addPerson(t.LatestReactor,"LatestReactor"),r):t instanceof sr?(W.addPerson(t.Creator,"Creator"),W.addPeople(t.NudgedUsers,"NudgedUser"),r):t instanceof ar?(W.addPerson(t.Creator,"Creator"),W.addPeople(t.Mentionees,"Mentioned"),r):t instanceof or?(W.addPerson(t.Creator,"Creator"),W.addPerson(t.LatestReactor,"LatestReactor"),W.addPeople(t.TargetActors,"TargetActor"),r):t instanceof cr?(W.addPerson(t.Creator,"Creator"),W.addPeople(t.Actors,"Actor"),r):r}static processCommentPreview(e){if(h(e))if(G.processPreviewFragment(e.Anchor,"AnchorCreator"),e instanceof Kt){if(G.processPreviewFragment(e.Comment,"CommentCreator","InThread"),G.processPreviewFragment(e.RootComment,"RepliedTo","InThread"),h(e.RecentComments))for(const t of e.RecentComments)G.processPreviewFragment(t,"InThread")}else G.processPreviewFragment(e.Comment,"CommentCreator")}static processPreviewFragment(e,...t){h(e)&&W.addPerson(e.Creator,...t)}}function K(e){let t=e.TypeName,r="";const n=t.lastIndexOf(".");return n>=0&&(r=t.substring(0,n),t=t.substring(n+1)),"Common"===r?t:r+t}const q="Name",H="Email",X="Provider",z="PictureUrl",Z="User",Q="Unknown",Y="File",ee="Windows",te="Android",re="Linux",ne="tvOS",ie="TenantId",oe="DriveItemId",se="ItemId",ae="Unspecified",ce="Count",de="CustomerContent",ue="EUII",le="Completed",pe="InProgress",fe="RawProvider",me="RawIdKind",he="SourceApp",ve="SourcePlatform",ge="SourceSessionId",Ie="ActivitySource",ye="CustomProperties",Ce="Application",Ae="AppName",Pe="SourceAppVersion",Te="Device",we="SourceAppContext",Se="NotifiedInBand",be="SuppressSendToSubstrate",Ne="ContentId",xe="Data",Oe="NavigationId",Re="StartTime",Ee="Status",Me="Item",De="NotStarted",Ue="Title",ke="DueDate",je="Priority",Fe="CommentThreadId",Le="Common.CommentPreview",Je="ThreadLength",$e="RootComment",_e="RecentComments",Be="Revisions",Ve="CommentThreadIsTask",We="CommentPreview",Ge="Preview",Ke="CommentPreviewAbsenceReason",qe="PreviewAbsenceReason",He="TaskCreatedDate",Xe="LatestEmoji",ze="EmojiCounts",Ze="LatestReaction",Qe="ReactionCounts",Ye="TargetPreview",et="TotalReactorCount",tt="NudgeEmoji",rt="MessagePreview",nt="StatusLabel",it="PreviousState",ot="ActivityCompliance",st=Object.assign;class at extends B{constructor(){super(),this.TypeName="Unified.Person"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,"Id",null,C(this.Id,t)),_(e,q,null,C(this.Name,t)),_(e,H,null,C(this.Email,t)),_(e,X,null,C(this[X],t)),_(e,z,null,C(this[z],t)),_(e,"Roles",null,C(this.Roles,t)))}}!function(e){E(2),M(e)}({[Z]:0,System:1});const ct={AAD:0,MSA:1},dt=function(e){const t=E(2),r=M(e);return(e,n)=>D(e,t,(e=>r)(),n)}(ct),ut={[Q]:0,EXO:1,SPO:2,OXO:3,MileIQ:4,AFS:5,Teams:6,Stream:7,ODB:8,MicrosoftPowerBI:9,Yammer:10},lt=function(e){const t=E(11),r=M(e);return(e,n)=>D(e,t,(e=>r)(),n)}(ut),pt=(function(e){E(4),M(e)}({[Q]:0,Message:1,[Y]:2,Calendar:3}),{[Q]:0,[ee]:1,[te]:2,iOS:3,MacOS:4,[re]:5,[ne]:6}),ft=function(e){const t=E(7),r=M(e);return(e,n)=>D(e,t,(e=>r)(),n)}(pt);class mt extends B{constructor(){super(),this.TypeName="SIGS.Actor",this.IdKind=0}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);2!==r&&3!==r||(_(e,"ActorIdType",null,dt(this.IdKind,t)),_(e,"ActorId",null,C(this.Id,t)),_(e,"AadTenantId",null,C(this.TenantId,t)),_(e,"ActorType",null,C(Z,t)))}}class ht extends B{[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);2!==r&&3!==r||_(e,"Url",null,C(this.Url,t))}}class vt extends ht{constructor(){super(),this.TypeName="SIGS.GraphDocumentInfo"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);2!==r&&3!==r||(_(e,"DriveId",null,C(this.DriveId,t)),_(e,oe,null,C(this[oe],t)))}}class gt extends vt{constructor(){super(),this.TypeName="SIGS.SharePointDocumentInfo"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);2!==r&&3!==r||(_(e,"SiteUrl",null,C(this.SiteUrl,t)),_(e,ie,null,w(this.TenantId,t)),_(e,"SiteId",null,w(this.SiteId,t)),_(e,"WebId",null,w(this.WebId,t)),_(e,"ListId",null,w(this.ListId,t)),_(e,se,null,w(this.ItemId,t)))}}const It={[Q]:0,Word:1,Excel:2,PowerPoint:3,Outlook:4,OneNote:5,FluidApp:6,Visio:7,Planner:8,Whiteboard:9},yt=function(e){const t=E(10),r=M(e);return(e,n)=>D(e,t,(e=>r)(),n)}(It),Ct={[Q]:0,Win32:1,WinRT:2,[te]:3,Mac:4,iOS:5,Web:6,Server:7,[ee]:8,[re]:9,[ne]:10},At=function(e){const t=E(11),r=M(e);return(e,n)=>D(e,t,(e=>r)(),n)}(Ct),Pt=(function(e){E(3),M(e)}({[ae]:0,EditSession:1,PreExisting:2}),{Create:0,Update:1,Delete:2}),Tt=function(e){const t=E(3),r=M(e);return(e,n)=>D(e,t,(e=>r)(),n)}(Pt),wt={[Q]:0,LiveId:1,OrgId:2,ActiveDirectory:3,ADAL:4,SSPI:5,OAuth2:6,Badger:7,[ce]:8},St=function(e){const t=E(9),r=M(e);return(e,n)=>D(e,t,(e=>r)(),n)}(wt),bt={OID:0,PUID:1,CID:2,Self:3},Nt=function(e){const t=E(4),r=M(e);return(e,n)=>D(e,t,(e=>r)(),n)}(bt),xt=function(e){const t=E(12),r=M(e),n=[[r[0],"AccessControl",r[2],r[3],r[4],r[5],r[6],r[7],r[8],"SystemMetaData",r[10],r[11]]],i=new Map([[2,n[0]],[3,n[0]]]);return(e,n)=>D(e,t,(e=>4&e?(e=>{var t;return null!==(t=i.get(e))&&void 0!==t?t:r})(F(e)):r)(n),n)}({[ae]:0,AccessControlData:1,[de]:2,[ue]:3,SupportData:4,AccountData:5,PublicPersonalData:6,EUPI:7,OII:8,SystemMetadata:9,PublicNonPersonalData:10,[ce]:11}),Ot=function(e){const t=E(3),r=M(e);return(e,n)=>D(e,t,(e=>r)(),n)}({[le]:0,[pe]:1,CompletedMissingStart:2});class Rt extends B{constructor(){super(),this.TypeName="Base.UserInfo"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);2!==r&&3!==r||(_(e,"Id",null,C(this.Id,t)),_(e,q,null,C(this.Name,t)),_(e,H,null,C(this.Email,t)),_(e,X,null,C(this[X],t)),_(e,ie,null,C(this.TenantId,t)),_(e,fe,null,St(this[fe],t)),_(e,"RawId",null,C(this.RawId,t)),_(e,me,null,Nt(this[me],t)))}}class Et extends V{constructor(){super(),st(this,{Id:S,Created:P,Finalized:P,Observed:P,[he]:0,[ve]:0,[ge]:S})}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,"Id",null,w(this.Id,t)),_(e,"Timestamp",null,A(this.Created,t)),_(e,"AppSessionId",[Ie],w(this[ge],t))),3===r&&_(e,"SignalInstanceId",["PreprocessorOptions"],w(this.Id,t)),2!==r&&3!==r||(_(e,"ActorDetails",[ye],J(this.Creator,1|t)),_(e,Ae,[Ce],yt(this[he],t)),_(e,"AppVer",[Ce],R(this[Pe],t)),_(e,"Platform",[ye,"DeviceDetails"],At(this[ve],t)),_(e,"OsVer",[Te],R(this.SourcePlatformVersion,t)),_(e,"DeviceId",[Te],C(this.SourceDeviceId,t)),_(e,"UserAgent",[Te],C(this.SourceUserAgent,t)),_(e,"ClientIp",[Te],C(this.SourceIpAddress,t)),_(e,"Context",[ye,"ApplicationDetails"],O(this[we],t)),_(e,Se,[ye],y(this[Se],t))),0===r&&(_(e,"HostTimestamp",null,A(this.Observed,t)),_(e,Ae,[Ie],yt(this[he],t)),_(e,"AppVersion",[Ie],R(this[Pe],t)),_(e,"AppPlatform",[Ie],At(this[ve],t)),_(e,"AppContext",[Ie],O(this[we],t)),_(e,Se,null,y(this[Se],t)))}}class Mt extends Et{[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0===r&&_(e,be,null,y(this[be],t)),0!==r&&1!==r||(_(e,"Type",null,C(class{static convertTo(e,t){return K(t)}}.convertTo({},this),t)),_(e,"People",null,J(G.convertToArray({},this),1|t)))}}class Dt extends Mt{}class Ut extends Dt{constructor(){super(),this.ContentOrigin=0}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,Ne,[xe],C(this[Ne],t)),_(e,Oe,[xe],C(this[Oe],t)))}}class kt extends Ut{constructor(){super(),this.Action=0}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||_(e,"ContentAction",[xe],Tt(this.Action,t))}}class jt extends kt{}class Ft extends Et{constructor(){super(),this[Re]=P,this.EndTime=P}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);2!==r&&3!==r||(_(e,Re,null,A(this[Re],t)),_(e,"EndTime",null,A(this.EndTime,t)),_(e,Ee,null,Ot(this.Status,t)),_(e,"CV",null,C(this.CorrelationVector,t)),_(e,"Locale",null,C(this.Locale,t)),_(e,"Workload",[Ce],lt(this.AppWorkload,t)),_(e,se,[Me],C(this.ItemId,t)),_(e,"ContainerType",[Me],C(this.ItemContainerKind,t)),_(e,"ContainerId",[Me],C(this.ItemContainerId,t)),_(e,"ContainerTypeId",[ye],C(this.CustomContainerTypeId,t)),_(e,"SignalType",null,C(class{static convertTo(e,t){if(t instanceof Lt&&h(t.Data)){const e="Office"+K(t.Data);return t.Data instanceof kt?e+Tt(t.Data.Action,0):e}return K(t)}}.convertTo({},this),t)),_(e,"Actor",null,J(class{static convertTo(e,t){var r;if(!h(t)||!h(t.Creator)||!h(t.Creator.RawId)&&t.Creator.RawIdKind!=bt.Self)return null;const n=new mt,i=t.Creator.RawProvider==wt.LiveId,o=null!==(r=t.Creator.RawId)&&void 0!==r?r:"";return n.IdKind=i?ct.MSA:ct.AAD,n.TenantId=t.Creator.TenantId,n.Id=h(t.Creator.RawIdKind)?t.Creator.RawIdKind==bt.OID?i?"OID:"+o:o:t.Creator.RawIdKind==bt.PUID?i?o:"PUID:"+o:t.Creator.RawIdKind==bt.CID?"CID:"+o:"Self":i?"CID:"+o:o,n}}.convertTo({},this),1|t)),_(e,"Os",[Te],ft(class{static convertTo(e,t){switch(t.SourcePlatform){case Ct.Win32:case Ct.WinRT:case Ct.Windows:return pt.Windows;case Ct.Android:return pt.Android;case Ct.Mac:return pt.MacOS;case Ct.iOS:return pt.iOS;case Ct.Linux:return pt.Linux;case Ct.tvOS:return pt.tvOS;default:return pt.Unknown}}}.convertTo({DefaultValue:0},this),t)),_(e,"Compliance",null,xt(class{static convertTo(e,t){return t.TypeClassification}}.convertTo({DefaultValue:0},this),t)),_(e,"AadAppId",[Ce],C(class{static convertTo(e,t){return t instanceof Lt&&h(t.Data)&&h(t.Data.SourceAppId)?t.Data.SourceAppId.toString():h(t.SourceAppId)?t.SourceAppId.toString():"3d9f2b8c-fab8-4011-a098-2652bdd0b55d"}}.convertTo({},this),t)),_(e,"ItemType",[Me],C(Y,t)))}}class Lt extends Ft{[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);2!==r&&3!==r||(_(e,"FileDetails",[ye],$(this.DocumentInfo,-2&t,"SIGS.DocumentInfo")),_(e,"ActivityDetails",[ye],$(this.Data,-2&j(1,t),"Base.NormalActivity")))}}const Jt={UnsupportedClient:0,ProtectedDocument:1,Unnecessary:2},$t=function(e){const t=E(3),r=M(e),n=[["Unsupported_Client","Encrypted","NotNeeded"]],i=new Map([[0,n[0]],[1,n[0]]]);return(e,n)=>D(e,t,(e=>4&e?(e=>{var t;return null!==(t=i.get(e))&&void 0!==t?t:r})(F(e)):r)(n),n)}(Jt),_t=function(e){const t=E(3),r=M(e);return(e,n)=>D(e,t,(e=>r)(),n)}({[De]:0,[pe]:1,[le]:2}),Bt=function(e){const t=E(4),r=M({Urgent:0,Important:1,Medium:2,Low:3});return(e,n)=>D(e,t,(e=>r)(),n)}(),Vt=function(e){const t=function(e){const t=[];for(let e=0;e<5;++e)t.push(1<<e);return t}(),r=function(e){return Object.keys(e).filter((e=>"None"!==e)).sort(((t,r)=>e[t]-e[r]))}(e);return(e,n)=>U(e,t,(e=>r)(),n)}({None:0,Assignees:1,[Ue]:2,[ke]:4,[Ee]:8,[je]:16}),Wt=function(e){const t=E(1),r=M({Like:0});return(e,n)=>D(e,t,(e=>r)(),n)}();(function(e){E(3),M(e)})({[Q]:0,Local:1,Sharepoint:2}),function(e){E(4),M(e)}({[Q]:0,ReuseFile:1,SmartLookup:2,TellMe:3}),function(e){E(4),M({Slide:0,Table:1,Image:2,Other:3})}(),function(e){E(6),M(e)}({[De]:0,[pe]:1,ReadyForReview:2,[le]:3,Blocked:4,Custom:5});class Gt extends B{constructor(){super(),this.TypeName=Le}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,"LocationText",null,C(this.Location,t)),_(e,"Anchor",null,J(this.Anchor,1|t)),_(e,"Comment",null,J(this.Comment,1|t)),_(e,Fe,null,C(this.ThreadId,t)),_(e,"Options",null,$(this.Options,-2&t,"Common.PreviewOptions")))}}class Kt extends Gt{constructor(){super(),this.TypeName="Common.CommentReplyPreview",this[Je]=0}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,$e,null,J(this[$e],1|t)),_(e,_e,null,J(this[_e],1|t)),_(e,"ThreadCommentCount",null,g(this[Je],t)))}}class qt extends Dt{constructor(){super(),this.TypeName="Common.RevisionSet",this.TypeClassification=3}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||_(e,Be,[xe],C(class{static convertToArray(e,t){if(h(t)){const e=[];for(const r of t)h(r)&&e.push(r.RevisionID);return e}return null}}.convertToArray({},this[Be]),t))}}class Ht extends jt{constructor(){super(),this.TypeName="Common.Mention"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,"ParentContentId",[xe],C(this.CommentContentId,t)),_(e,Fe,[xe],C(this[Fe],t)),_(e,Ve,[xe],y(this[Ve],t)),_(e,Ge,null,$(this[We],-2&t,Le)),_(e,qe,[xe],$t(this[Ke],t)))}}class Xt extends kt{constructor(){super(),this.TypeName="Common.Comment"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,Fe,[xe],C(this.ThreadId,t)),_(e,Ve,[xe],y(this.ThreadIsTask,t)),_(e,Ge,null,$(this.Preview,-2&t,Le)),_(e,qe,[xe],$t(this[qe],t)))}}class zt extends Xt{constructor(){super(),this.TypeName="Common.CommentReply"}}class Zt extends Dt{[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,Fe,[xe],C(this[Fe],t)),_(e,Oe,[xe],C(this[Oe],t)),_(e,Ge,null,$(this[We],-2&t,Le)),_(e,qe,[xe],$t(this[Ke],t)))}}class Qt extends Zt{constructor(){super(),this.TypeName="Common.TaskCreation"}}class Yt extends Zt{}class er extends Yt{constructor(){super(),this.TypeName="Common.TaskReassignment"}}class tr extends kt{constructor(){super(),this.TypeName="Common.CanvasTask"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,Ue,[xe],C(this.Title,t)),_(e,He,[xe],A(this[He],t)),_(e,ke,[xe],A(this.DueDate,t)),_(e,Ee,[xe],_t(this.Status,t)),_(e,je,[xe],Bt(this.Priority,t)),_(e,"Updates",[xe],Vt(this.Updates,t)))}}class rr extends Dt{}class nr extends Ut{[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,Xe,[xe],C(this[Xe],t)),_(e,ze,[xe],J(this[ze],1|t)))}}class ir extends nr{constructor(){super(),this.TypeName="Common.CommentReactionUpdate"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,Ze,[xe],Wt(this[Ze],t)),_(e,Qe,[xe],J(this[Qe],1|t)))}}class or extends nr{constructor(){super(),this.TypeName="Common.TargetedReactionUpdate"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,"TargetId",[xe],C(this.TargetId,t)),_(e,Ye,[xe],O(this[Ye],t)),_(e,et,[xe],I(this[et],t)))}}class sr extends kt{constructor(){super(),this.TypeName="Common.Nudge"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,tt,[xe],C(this[tt],t)),_(e,rt,[xe],O(this[rt],t)))}}class ar extends kt{constructor(){super(),this.TypeName="Common.Recap"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||_(e,"Content",["Recap"],O(this.Content,t))}}class cr extends kt{constructor(){super(),this.TypeName="Common.StatusLabel"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,"State",[nt],J(this.State,1|t)),_(e,it,[nt],J(this[it],1|t)),_(e,rt,[nt],O(this[rt],t)))}}class dr extends Lt{constructor(){super(),this.TypeName="Common.ActivitySignalWithoutContent",this.TypeClassification=3}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);2!==r&&3!==r||_(e,ot,[ye],C(ue,t))}}class ur extends Lt{constructor(){super(),this.TypeName="Common.ActivitySignalWithContent"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);2!==r&&3!==r||_(e,ot,[ye],C(de,t))}}class lr extends B{constructor(){super(),this.TypeName="Vroom.WrappedActivity",this.Id=S}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||(_(e,"Id",null,w(this.Id,t)),_(e,"activity",null,$(this.Activity,-2&t,"Base.Activity")))}}class pr extends B{constructor(){super(),this.TypeName="Vroom.PatchStreamPayload"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);0!==r&&1!==r||_(e,"value",null,J(this.Activities,1|t))}}class fr extends B{constructor(){super(),this.TypeName="Transport.PreprocessorPayload"}[m](e,t){super.writeToFacetJsonObject(e,t);var r=F(t);2!==r&&3!==r||_(e,"activities",null,$(this.Signals,-2&t,"Base.ActivitySignal"))}}!function(e){E(11),M(e)}({Success:0,UnknownError:1,BadRequest:2,AccessDenied:3,SignalTypeNotFound:4,SignalAlreadyExists:5,Disabled:6,InternalError:7,Throttled:8,ServiceUnavailable:9,[Q]:10});class mr{get NamespaceLogger(){return this}get PersistedProperties(){return this}get Disposable(){return this.disposable}addPersistedProperties(e){this.persistedProperties={...this.persistedProperties,...e}}getPersistedProperties(){var e,t,r;return{...null===(e=this.logger)||void 0===e||null===(t=e.PersistedProperties)||void 0===t||null===(r=t.getPersistedProperties)||void 0===r?void 0:r.call(t),...this.persistedProperties}}send(e){this.sendWithNamespace(e,this.namespace)}sendWithNamespace(e,t){var r;null===(r=this.logger)||void 0===r||r.sendWithNamespace({...this.persistedProperties,...e},t)}dispose(){this.logger=null}getNamespace(){return this.namespace}constructor(e,t,r){if(this.namespace=e,this.disposable={get Disposable(){return this},dispose:async()=>{this.logger=null}},t instanceof mr){const e={...t.persistedProperties,...r};this.logger=t.logger,this.persistedProperties=e}else this.logger=t,this.persistedProperties=r}}var hr=r("RdgM"),vr=r("kxAM"),gr=r("LpbE"),Ir=r("Ito+"),yr=r("aFvx"),Cr=r("graM"),Ar=r("5+n6");function Pr(e,t){const r=Er(e,"Pipelines."+t.TypeName,function(e){return e instanceof jt||e instanceof qt||e instanceof Zt?1:2}(t));return t instanceof kt&&t.Action!==Pt.Create?t instanceof jt&&t.Action!==Pt.Delete?0:function(e,...t){let r=e;for(const e of t)r&=~e;return r}(r,1):r}function Tr(e,t,r){return Er(e,t,r)}function wr(e){return Mr(e)&&"string"==typeof e.code&&Dr(e.message)&&Ur(e["@onedrive.errorReasonForTelemetry"])}function Sr(e){return Mr(e)&&wr(e.error)}function br(e){return Mr(e)&&"string"==typeof e.Id&&Dr(e.ServerId)&&Dr(e.Message)&&Ur(e.Status)&&(void 0===e.Error||wr(e.Error))}function Nr(e){return Mr(e)&&kr(e.Status,0,"Success")&&void 0===e.Error}function xr(e){return Mr(e)&&"string"==typeof e.Id&&Ur(e.Status)&&Dr(e.Message)}function Or(e){return Mr(e)&&kr(e.Status,0,"Success")}function Rr(e,t,r,i){const{siteUrl:o,siteId:s,webId:a,listId:c,listItemUniqueId:d}=r,u=function(e,t){if(e){if("Enterprise"===e.tokenProvider.identityType&&e.tenantId)return`SPO:SPO_${t.siteId}@SPO_${e.tenantId}`;if("Consumer"===e.tokenProvider.identityType)return e.rosterId}}(e,r),l=new gt;l.SiteUrl=o,l.TenantId=null!=e&&e.tenantId?new T(e.tenantId):void 0,l.SiteId=new T(s),l.WebId=new T(a),l.ListId=new T(c),l.ItemId=new T(d);const p=function(e){return 2===e.TypeClassification?new ur:new dr}(i);return i.SignalId||(i.SignalId=new T(Object(n.a)())),p.Id=i.SignalId,p.Creator=i.Creator,p.SourceApp=i.SourceApp,p.SourceAppVersion=i.SourceAppVersion,p.SourcePlatform=i.SourcePlatform,p.SourcePlatformVersion=i.SourcePlatformVersion,p.SourceDeviceId=i.SourceDeviceId,p.SourceUserAgent=i.SourceUserAgent,p.SourceIpAddress=i.SourceIpAddress,p.SourceAppContext=i.SourceAppContext,p.NotifiedInBand=i.NotifiedInBand,p.StartTime=i.Created,p.EndTime=i.Created,p.ItemId=t,p.Data=i,p.DocumentInfo=l,p.AppWorkload=ut.SPO,p.ItemContainerId=u,p.CustomContainerTypeId=null==e?void 0:e.containerTypeId,p}function Er(e,t,r){return Object(Ar.a)("ActivityTransport."+t,r,null==e?void 0:e.settingsProvider)}function Mr(e){return"object"==typeof e&&null!==e}function Dr(e){return void 0===e||"string"==typeof e}function Ur(e){return void 0===e||"number"==typeof e||"string"==typeof e}function kr(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return void 0===e||r.includes(e)}!function(...e){let t=0;for(const r of e)t|=r}(1,2);const jr="OutgoingActivity",Fr="ActivityResult";function Lr(e,t,r,n,i){const o=Br(Fr,t,Pr(e,t));o.TryCount=r.tries.length;const s=r.result.headers.get("SPRequestGuid");if(s&&(o.RequestId=s),o.Status=r.result.status,o.Success=!1,n){const e=function(e,t){const r=t.toLowerCase();return e.value.find((e=>e.Id.toLowerCase()===r))}(n,t.Id.toString());e&&(o.Success=!(e.Error||e.Status&&"Success"!==e.Status),e.Error?o.Error=e.Error.code:o.Success||(o.Error=e.Status),e.ServerId&&(o.ServerId=e.ServerId))}else i&&(o.Error=i.error.code);return o}function Jr(e,t,r,n,i){let o,s;t instanceof Lt&&h(t.Data)?(o=Vr(Fr,t,Pr(e,t.Data)),s=t.Data.Id):(o=_r(Fr,t),s=t.Id),o.TryCount=r.tries.length;const a=r.result.headers.get("Request-Id");if(a&&(o.RequestId=a),o.Status=r.result.status,o.Success=!1,n){const e=function(e,t){const r=t.toLowerCase();return e.find((e=>e.Id.toLowerCase()===r))}(n,s.toString());e&&(o.Success=!e.Status||"Success"===e.Status,o.Success||(o.Error=e.Status,e.Message&&(o.Message=e.Message)))}else i&&(o.Error=i.error.code);return o}function $r(e,t,r){const n=_r(Fr,e);n.TryCount=t.tries.length;const i=t.result.headers.get("Request-Id");return i&&(n.RequestId=i),n.Status=t.result.status,n.Success=t.result.ok,r&&(n.Error=r.error.code),n}function _r(e,t){return Wr(e,t)}function Br(e,t,r){const n=Wr(e,t);return n.Pipelines=r,n}function Vr(e,t,r){let n;return h(t.Data)?(n=Br(e,t.Data,r),n.ActivitySignalId=t.Id.toString()):n=_r(e,t),n}function Wr(e,t){const r={eventName:e,category:"Generic",TypeName:t.TypeName,ActivityId:t.Id.toString(),Age:new Date(Date.now()).valueOf()-t.Created.valueOf()};return t instanceof kt&&(r.Action=t.Action),t instanceof Xt&&(r.HasParent=t instanceof zt&&h(t.ParentAuthor),r.HasPreview=h(t.Preview),h(t.PreviewAbsenceReason)&&(r.PreviewAbsenceReason=t.PreviewAbsenceReason)),(t instanceof Ht||t instanceof Zt)&&(r.HasPreview=h(t.CommentPreview),h(t.CommentPreviewAbsenceReason)&&(r.PreviewAbsenceReason=t.CommentPreviewAbsenceReason)),r}async function Gr(e,t){const r=e.logger?{...e,logger:new mr("ActivityTransport",e.logger)}:e;t.forEach(Yr.bind(null,r));const n=await async function(e,t){const r=[];for await(const n of async function*(e,t){const r=await async function(e){if(qr(e))try{return await Object(hr.a)(e.tokenProvider,e)}catch(e){return}}(e),n=await async function(e){if(!qr(e))return;const{siteUrl:t,driveId:r,fileId:n}=e;try{return await Object(f.b)(e.tokenProvider,t,r,n)}catch(e){return}}(e);for(const a of t)if(r&&rn(a)){var i;const t=_r(jr,a);null===(i=e.logger)||void 0===i||i.send(t),yield a}else if(tn(a)){const t=Pr(e,a);if(1&t){var o;const r=Br(jr,a,t);null===(o=e.logger)||void 0===o||o.send(r),yield a}if(r&&n&&2&t){var s;const i=Rr(e,r,n,a),o=Vr(jr,i,t);null===(s=e.logger)||void 0===s||s.send(o),yield i,a.SuppressSendToSubstrate=!0}}}(e,t))r.push(n);return r}(r,t);return(await Promise.all([zr(r,n.filter(tn)),Zr(r,n.filter(rn))])).every((e=>e))}class Kr{constructor(e,t,r){this.provider=e,this.kind=t,this.id=r}}function qr(e){var t,r,n;return!!(null!==(t=e.senderIdentity)&&void 0!==t&&t.oid||null!==(r=e.senderIdentity)&&void 0!==r&&r.puid||Hr(e)&&null!==(n=e.senderIdentity)&&void 0!==n&&n.cid)}function Hr(e){return Tr(e,"EnableCidSupport",!0)}function Xr(e){return Tr(e,"UseInstrumentedAuthorizedFetchWithRetry",!0)}async function zr(e,t){var r;if(t.length<1)return!0;const n=new pr;n.Activities=t.map(en);const i=Object(vr.a)(e.siteUrl),o={getToken:t=>{const r={...t,siteUrl:e.siteUrl,driveId:e.driveId,itemId:e.fileId};return e.tokenProvider.getToken([`${i}/files.readwrite.all`],r)},url:`${i}/_api/v2.1/drives/${e.driveId}/items/${e.fileId}/office_activityStream`,tenantId:null===(r=e.senderIdentity)||void 0===r?void 0:r.tenantId,requestInit:{method:"PATCH",headers:{"Content-Type":"application/json"},body:n.toFacetJson(0)},retryPolicy:gr.b,tokenPolicy:Object(gr.a)(e.tokenProvider)},s=Xr(e)&&e.logger?await Object(Ir.b)({...o,logger:e.logger,nameForLogging:"SendActivitiesToHost"}):await Object(Ir.a)(o),a=await s.result.json();return function(e,t,r,n){const i=r.result.ok&&function(e){return Mr(e)&&Array.isArray(e.value)&&e.value.every(br)}(n)?n:void 0,o=!r.result.ok&&Sr(n)?n:void 0;for(const n of t){var s;const t=Lr(e,n,r,i,o);null===(s=e.logger)||void 0===s||s.send(t)}}(e,t,s,a),s.result.ok&&function(e){return Mr(e)&&Array.isArray(e.value)&&e.value.every(Nr)}(a)}async function Zr(e,t){if(t.length<1)return!0;try{return(await Promise.all(t.map(Qr.bind(null,e)))).every((e=>e))}catch(e){return!1}}async function Qr(e,t){var r;if(!function(e){return h(e.Creator)&&h(e.Creator.RawIdKind)}(t))return!1;let n,i,o;const s=function(e){var t;switch(null===(t=e.environment)||void 0===t?void 0:t.audience){case"GCC":return"https://substrate.office365.us";case"GCC-High":case"DoD":return"https://substrate-dod.office365.us";default:return"https://substrate.office.com"}}(e),a=t instanceof Lt;if(a){n=`${s}/signalpreprocessor/v1/office`;const e=new fr;e.Signals=[t],i=e,o=3}else n=`${s}/api/v2.0/me/signals`,i=t,o=2;const c={getToken:t=>e.tokenProvider.getToken([`${s}/Signals-Internal.ReadWrite`],t),url:n,tenantId:null===(r=e.senderIdentity)||void 0===r?void 0:r.tenantId,requestInit:{method:"POST",headers:{"Content-Type":"application/json",Prefer:'exchange.behavior="SignalAccessV2,OpenComplexTypeExtensions"',"X-SignalInstanceId":t.Id.toString(),"X-AnchorMailbox":e.senderIdentity.upn},body:i.toFacetJson(o)},retryPolicy:{maxRetries:2,backoffFn:Object(yr.b)(500),filter:Object(Cr.c)([429,500])}},d=Xr(e)&&e.logger?await Object(Ir.b)({...c,logger:e.logger,nameForLogging:"SendSignalToSubstrate"}):await Object(Ir.a)(c),u=await d.result.json();return function(e,t,r,n,i){const o=!r.result.ok&&Sr(n)?n:void 0;if(i){const i=r.result.ok&&function(e){return Array.isArray(e)&&e.every(xr)}(n)?n:void 0;for(const n of t){var s;const t=Jr(e,n,r,i,o);null===(s=e.logger)||void 0===s||s.send(t)}}else for(const n of t){var a;const t=$r(n,r,o);null===(a=e.logger)||void 0===a||a.send(t);break}}(e,[t],d,u,a),a?d.result.ok&&function(e){return Array.isArray(e)&&e.every(Or)}(u):d.result.ok}function Yr(e,t){if(e.senderIdentity&&!t.Creator)if(Hr(e)){const{provider:r,kind:n,id:i}=function(e,t){const{LiveId:r,ADAL:n}=wt,{OID:i,PUID:o,CID:s}=bt,{oid:a,puid:c,cid:d}=t;if("Consumer"===e.identityType)return c?new Kr(r,o,c):d?new Kr(r,s,d):a?new Kr(r,i,a):new Kr(r);const u="Enterprise"===e.identityType?n:void 0;return a?new Kr(u,i,a):c?new Kr(u,o,c):d?new Kr(u,s,d):new Kr(u)}(e.tokenProvider,e.senderIdentity);t.Creator=new Rt,t.Creator.Id=i,t.Creator.Name=e.senderIdentity.name,t.Creator.Email=e.senderIdentity.upn,t.Creator.TenantId=e.senderIdentity.tenantId,t.Creator.RawProvider=r,t.Creator.RawId=t.Creator.Id,t.Creator.RawIdKind=n}else t.Creator=new Rt,t.Creator.Id=function(e){var t,r,n;return"Consumer"===e.tokenProvider.identityType&&null!==(t=e.senderIdentity)&&void 0!==t&&t.puid?e.senderIdentity.puid:null!==(r=e.senderIdentity)&&void 0!==r&&r.oid?e.senderIdentity.oid:null!==(n=e.senderIdentity)&&void 0!==n&&n.puid?e.senderIdentity.puid:void 0}(e),t.Creator.Name=e.senderIdentity.name,t.Creator.Email=e.senderIdentity.upn,t.Creator.TenantId=e.senderIdentity.tenantId,t.Creator.RawProvider=function(e){return"Consumer"===e.tokenProvider.identityType?wt.LiveId:"Enterprise"===e.tokenProvider.identityType?wt.ADAL:void 0}(e),t.Creator.RawId=t.Creator.Id,t.Creator.RawIdKind=function(e){var t,r,n;return"Consumer"===e.tokenProvider.identityType&&null!==(t=e.senderIdentity)&&void 0!==t&&t.puid?bt.PUID:null!==(r=e.senderIdentity)&&void 0!==r&&r.oid?bt.OID:null!==(n=e.senderIdentity)&&void 0!==n&&n.puid?bt.PUID:void 0}(e)}function en(e){const t=new lr;return t.Activity=e,t.Id=e.Id,t}function tn(e){return e instanceof Mt}function rn(e){return e instanceof Ft}var nn=r("KlUR");function on(e){return e instanceof ArrayBuffer||"object"==typeof e&&null!==e&&"number"==typeof e.byteLength&&"function"==typeof e.slice&&void 0===e.byteOffset&&void 0===e.buffer}class sn extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return nn.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,r){if("string"==typeof e)return sn.fromString(e,t);if(null!==e&&"object"==typeof e&&on(e.buffer))return sn.fromArrayBuffer(e.buffer,e.byteOffset,e.byteLength);if(on(e))return sn.fromArrayBuffer(e,t,r);throw new TypeError("Input value was neither a string nor an ArrayBuffer.")}static fromArrayBuffer(e,t,r){const n=null!=t?t:0,i=null!=r?r:e.byteLength-n;if(n<0||n>e.byteLength||i<0||i+n>e.byteLength)throw new RangeError("Invalid range specified.");return new sn(e,n,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),r=nn.toByteArray(t);return new sn(r.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new sn(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}function an(e){return Object(Ar.a)("share.isResolvedUrlUsedForLocator",!0,e)}const cn="GetDocumentInfoError";class dn{get NotificationService(){return this}async notifyAtMention(e,t,r){const{siteUrl:n,driveId:i,fileId:o}=this.props;return this.sendNotification(e,t,r,"NotifyAtMention",{siteUrl:n,driveId:i,itemId:o,dataStorePath:t})}async queueAtMentionNotification(e){let{recipient:t,atMentionId:r,contentId:n,navigationPath:o,resolvedUrl:s,threadId:d}=e;const{siteUrl:u,driveId:l,fileId:p,appName:m,logger:h}=this.props,v={itemId:p,driveId:l,siteUrl:u},g=an(this.props.settingsProvider)?((e,t,r)=>{var n;if(!t)return r&&function(e,t){const r=a(t);e.send({...r,category:i.b.Generic})}(r,{eventName:cn}),e;if(!Object(f.e)(t)){const t=new Error("Invalid file information: ResolvedUrl is not of the expected ODSP type");return r&&c(r,{eventName:cn},t),e}return{driveId:t.driveId,siteUrl:t.siteUrl,itemId:t.itemId,containerPackageName:null===(n=t.codeHint)||void 0===n?void 0:n.containerPackageName}})(v,s,h):v;let I,y;if(s&&Object(f.e)(s)){var C,A,P;const e={siteUrl:s.siteUrl,driveId:s.driveId,itemId:s.itemId};I=null===(C=s.codeHint)||void 0===C?void 0:C.containerPackageName,y=an(this.props.settingsProvider)&&((e,t)=>{const{siteUrl:r,driveId:n,itemId:i}=t,o=new URL(r).hostname,{siteUrl:s,driveId:a,itemId:c}=e;return o!==new URL(s).hostname||n!==a||i!==c})(v,e)?void 0:await(null===(A=(P=this.props).getFileContext)||void 0===A?void 0:A.call(P,s,n))}const T={...g,dataStorePath:n,containerPackageName:I,appName:m,context:y};return an(this.props.settingsProvider)&&s&&!Object(f.e)(s)&&(T.dataStorePath="",h&&c(h,{eventName:"NonODSPResolvedUrl"})),this.sendNotification(t.userPrincipalName,n,o,"QueueAtMentionNotification",T,r,d,s)}getAppContext(e){let t,r;if(e)try{t={fluidComponents:JSON.parse(e)}}catch(e){r=e}return{appContext:t,appContextError:r}}async notifyOfficeActivityStream(e,t,r,i,o,s,a){const{correlationId:c}=this.props,d=an(this.props.settingsProvider)?{...this.props,fileId:i.itemId,driveId:i.driveId,siteUrl:i.siteUrl}:{...this.props},u=function(e,t){return function(e){const t=new URL(e.siteUrl);let r=`s=${encodeURIComponent(t.pathname)}&d=${encodeURIComponent(e.driveId)}&f=${encodeURIComponent(e.itemId)}&c=${encodeURIComponent(e.dataStorePath)}&fluid=1`;return e.appName&&(r+=`&a=${encodeURIComponent(e.appName)}`),e.containerPackageName&&(r+=`&p=${encodeURIComponent(e.containerPackageName)}`),e.fileVersion&&(r+=`&v=${encodeURIComponent(e.fileVersion)}`),e.context&&(r+=`&x=${encodeURIComponent(e.context)}`),(e=>sn.from(e,"utf8").toString("base64"))(r)}(e)}(i),l=new Ht;return l.Id=new T(Object(n.a)()),l.Created=l.Observed=new Date,l.SourceApp=It.FluidApp,l.SourcePlatform=Ct.Web,l.SourceSessionId=c?new T(c):S,l.SourceAppContext=o,l.ContentId=null!=s?s:t,l.NavigationId=u,l.CommentThreadId=a,l.Action=Pt.Create,l.Mentionee=new Rt,l.Mentionee.Email=e,l.CommentPreviewAbsenceReason=Jt.UnsupportedClient,r.addAdditionalProps({activityId:l.Id.toString(),contentId:l.ContentId}),await Gr(d,[l])}async sendNotification(e,t,r,n,i,o,s,a){const{getHostAppContext:c}=this.props,d=p.start("NotifyOfficeActivityStream",this.props.logger);if(!e)return d.setResult(!1,{navigationPath:r.length>0,entryPoint:n,errorType:"MissingAuthorInformation"}),!1;const{appContext:u,appContextError:l}=c?{appContext:c(a)}:this.getAppContext(r);try{const a=await this.notifyOfficeActivityStream(e,t,d,i,u,o,s);return d.setResult(a&&!l,{appContextSent:!!u,notifyActivity:a,navigationPath:r.length>0,entryPoint:n,...l&&{errorType:"AppContextError"}},l),a}catch(e){return d.setResult(!1,{appContextSent:!!u,notifyActivity:!1,navigationPath:r.length>0,entryPoint:n,errorType:"NotificationActivityStreamError"},e),!1}}constructor(e){if(this.props=e,!this.props.fileId||!this.props.driveId||!this.props.siteUrl)throw new Error("Invalid file information: fileId, driveId or siteUrl might be missing")}}}}]);
//# sourceMappingURL=vendors~sharepointnotificationservice.3cb7a3f82b645d4a9abc.chunk.v7.js.map