import{M as Fe,g as Ae,u as He}from"./entry.a7cea746.js";import{u as pe,bs as fe,ay as ge,Q as Oe,P as Me,aa as Ge,az as Qe,bd as Q,b0 as je,aE as We,aA as Ce,as as ye,b4 as Ye,aD as Je,bu as me,dA as Ke,dB as Xe,dC as Ze,dD as et,dE as tt,a5 as at,N as lt}from"./itinerary-entities.5f897bcd.js";import{l as _e,c as p,r as Z,G as o,P as d,z as t,R as Ue,Y as f,x as _,I as P,H as h,F as k,a7 as se,a6 as ee,a as j,Q as y,$ as I,W as st,an as $e,ao as Ee,w as ot,q as it,a3 as nt}from"./graphql.5cf3693b.js";import{F as Ie}from"./FreezeCard.4449bf65.js";import{B as rt}from"./BoxRadio.942f0b7e.js";import{u as ut}from"./useTutorial.34e7d475.js";import{M as le}from"./MrAccordion.d68da565.js";import{am as ve}from"./service-client.4862e840.js";import"./itinerary-modules.2ea32123.js";import"./SegmentView.f9955577.js";import"./RouteView.94d5f105.js";const ct=S=>($e("data-v-03000533"),S=S(),Ee(),S),dt=ct(()=>f("div",{class:"title"}," هر بلیط هواپیما تا حداکثر مبلغ انتخاب شده‌ی زیر برای شما رزرو می‌شود. ",-1)),mt={class:"radio-content"},vt={class:"select-all-box"},pt={key:0,class:"cards-accordion"},ft=_e({__name:"TheAutoReserveTypeItem",setup(S){const L=pe(),V=fe(),{selectedPackages:x,prices:T,flightPrices:z,currentSelectedFlightPrice:m}=ge(V),w=Oe(),r=p(()=>(w==null?void 0:w.getFeatureFlag("flight-auto-reserve-order"))||"control"),A=Z(!1),F=p(()=>r.value==="items-first"&&R.value.length>5),q=p(()=>r.value==="items-first"?R.value.slice(0,5):R.value),R=p(()=>L.autoReservableList.map((l,g)=>({itineraryPackage:l,selected:V.selectedPackages.some(c=>Me(c.autoReserveDemandParams).isEqual(l.autoReserveDemandParams)),order:l===V.preSelectPackage?-1:g})).sort((l,g)=>l.order-g.order)),te=p(()=>{var l;return((l=T.value)==null?void 0:l.canRequestExtraPayment)??!1}),M=p(()=>R.value.length===x.value.length),H=p(()=>!!x.value.length&&!M.value),ae=p(()=>te.value?z.value.map((l,g)=>({label:l.title||"",description:`تا مبلغ ${Ge(l.adultPrice||0,{includeUnit:!1})}`,subtitle:l.description||"",value:l,height:"120px",recommended:l.recommended,fullwidth:g+1===z.value.length&&g%2===0}))||[]:[]);function oe(){M.value?x.value=[]:x.value=R.value.map(l=>l.itineraryPackage)}const C=(l,g)=>{V.toggleAutoReservePackage({reservePackage:l,active:g})};function W(l){requestAnimationFrame(()=>{l.style.height||(l.style.height="0px"),l.style.display=null})}function ie(l){requestAnimationFrame(()=>{requestAnimationFrame(()=>{l.style.height=`${l.scrollHeight}px`})})}function ne(l){l.style.height=null}function D(l){requestAnimationFrame(()=>{l.style.height||(l.style.height=`${l.offsetHeight}px`)})}function re(l){requestAnimationFrame(()=>{requestAnimationFrame(()=>{l.style.height="0px"})})}function be(l){l.style.height=null}return(l,g)=>(o(),d(k,null,[t(te)?(o(),d("div",{key:0,class:Ue(["extra-price",{first:t(r)==="control"}])},[dt,f("div",mt,[_(Fe,{items:[{message:"در صورت موفق بودن رزرو خودکار، تنها هزینه‌ی بلیط از مبلغ پرداختی شما کسر خواهد شد و مابقی هزینه ‌به حساب شما بازگردانده می‌شود."}]},null,8,["items"]),_(rt,{modelValue:t(m),"onUpdate:modelValue":g[0]||(g[0]=c=>j(m)?m.value=c:null),options:t(ae)},{description:P(({option:c})=>{var $;return[($=c.value)!=null&&$.isCustomPrice?(o(),h(Qe,{key:0,"model-value":c.value.adultPrice,"onUpdate:modelValue":[N=>c.value.adultPrice=N,N=>{c.value.adultPrice=Number(N??0),c.value.childPrice=Number(N??0),c.value.infantPrice=Number(N??0)}],style:{"margin-top":"16px"},type:"money",placeholder:"مبلغ دلخواه (تومانءء)",required:"","hide-description":""},null,8,["model-value","onUpdate:modelValue"])):(o(),d(k,{key:1},[se(ee(c.description),1)],64))]}),_:1},8,["modelValue","options"])])],2)):y("",!0),f("div",{class:Ue(["cards-wrapper",{first:t(r)==="items-first"}])},[f("div",vt,[_(Q,{"model-value":t(M),label:"انتخاب همه",intermediate:t(H),"onUpdate:modelValue":oe},null,8,["model-value","intermediate"])]),(o(!0),d(k,null,I(t(q),c=>(o(),h(Ie,{key:c.itineraryPackage.key,"model-value":c.selected,package:c.itineraryPackage,"is-auto-reserve":"","onUpdate:modelValue":$=>C(c.itineraryPackage,$)},null,8,["model-value","package","onUpdate:modelValue"]))),128)),_(st,{"enter-active-class":"enter-active","leave-active-class":"leave-active",onAfterEnter:ne,onAfterLeave:be,onBeforeEnter:W,onBeforeLeave:D,onEnter:ie,onLeave:re},{default:P(()=>[t(F)&&t(A)?(o(),d("div",pt,[(o(!0),d(k,null,I(t(R).slice(5),c=>(o(),h(Ie,{key:c.itineraryPackage.key,"model-value":c.selected,package:c.itineraryPackage,"is-auto-reserve":"","onUpdate:modelValue":$=>C(c.itineraryPackage,$)},null,8,["model-value","package","onUpdate:modelValue"]))),128))])):y("",!0)]),_:1}),t(F)?(o(),h(Ce,{key:0,size:"medium",type:"transparent","left-icon":t(A)?t(je):t(We),onClick:g[1]||(g[1]=c=>A.value=!t(A))},{default:P(()=>[se(" مشاهده همه سفرهای قابل انتخاب ")]),_:1},8,["left-icon"])):y("",!0)],2)],64))}});const gt=ye(ft,[["__scopeId","data-v-03000533"]]),he=S=>($e("data-v-2fbfe154"),S=S(),Ee(),S),yt={class:"box"},_t=he(()=>f("span",{class:"title"}," زمان مدنظر برای حرکت اتوبوس از مبدأ را مشخص کنید. ",-1)),ht={key:0,class:"times"},bt={class:"label-group"},kt={class:"items-box"},Tt={key:1,class:"custom-selection"},Rt=he(()=>f("span",{class:"sub"},"از",-1)),St=he(()=>f("span",{class:"sub"},"تا",-1)),xt={class:"title"},Pt={key:0,class:"terminals"},Vt={class:"city-title"},At={key:1,class:"terminals"},Ut={class:"city-title"},It={class:"checkboxes"},Ft={key:0,class:"badges"},Mt={class:"checkboxes columns"},Ct={key:0,class:"badges"},$t={class:"checkboxes column"},Et=_e({__name:"TheAutoReserveTypeRoute",setup(S){const L=fe(),V=pe(),{toggleCarrierCode:x,toggleVehicleType:T,clearFilters:z}=L,{prices:m,carrierTitle:w,routeDemand:r,vehicleTypeTitle:A,selectedCarrierCodes:F,selectedVehicleTypes:q,selectedSeatType:R,selectedPackages:te,originCode:M,destinationCode:H}=ge(L),{isMobileSize:ae}=Ye(),oe=p(()=>F.value.length||q.value.length||R.value!==ve.NUMBER_1||M.value||H.value);function C(e,a){return e.from===a.from&&e.to===a.to}function W(e){return e.items.map(a=>a.value).every(a=>{var s,u;return(u=(s=r.value.departureSplitTimes)==null?void 0:s.timeRanges)==null?void 0:u.find(i=>C(i,a))})}function ie(e){return!W(e)&&e.items.map(a=>a.value).some(a=>{var s,u;return(u=(s=r.value.departureSplitTimes)==null?void 0:s.timeRanges)==null?void 0:u.find(i=>C(i,a))})}const ne=[{label:"فرقی نمی‌کند (کل روز)",value:"no-selection"},{label:"انتخاب بازه‌های زمانی مشخص",value:"fixed-selection"},{label:"انتخاب بازه‌ی زمانی دلخواه",value:"custom-selection"}],D=Z("fixed-selection");ot(D,e=>{O.value=void 0,E.value=void 0,e==="no-selection"?r.value.departureSplitTimes.timeRanges=[{from:"00:00",to:"23:59"}]:r.value.departureSplitTimes.timeRanges=[]});function re(){const e=[];for(let a=0;a<24;a++)for(let s=0;s<4;s++)e.push(`${`${a}`.padStart(2,"0")}:${`${s*15}`.padStart(2,"0")}`);return e.push("23:59"),e}const l=re().map(e=>({label:e,id:e})),g=l.slice(0,-1),c=p(()=>l.filter(e=>{const{value:a}=O;if(!a)return!1;const[s,u]=e.id.split(":"),[i,b]=a.split(":");if(+s<+i)return!1;switch(b){case"00":return+u>0||+s>+i;case"15":return+u>15||+s>+i;case"30":return+u>30||+s>+i;default:return+s>+i}})),$=p(()=>{var e,a;return[{label:"فرقی نمی‌کند (تمام پایانه‌ها)",value:""}].concat(((a=(e=m.value)==null?void 0:e.alternativeOrigins)==null?void 0:a.map(s=>({value:s.id||"",label:s.title||""})))||[])}),N=p(()=>{var e,a;return[{label:"فرقی نمی‌کند (تمام پایانه‌ها)",value:""}].concat(((a=(e=m.value)==null?void 0:e.alternativeDestinations)==null?void 0:a.map(s=>({value:s.id||"",label:s.title||""})))||[])}),O=Z(),E=Z(),ue=p({get(){return l.find(e=>e.id===O.value)},set(e){e!=null&&e.id&&(O.value=e==null?void 0:e.id,E.value&&E.value<e.id&&(E.value=c.value[0].id),e&&E.value&&(r.value.departureSplitTimes.timeRanges=[{to:E.value,from:e.id}]))}}),ce=p({get(){return l.find(e=>e.id===E.value)},set(e){E.value=e==null?void 0:e.id,e&&O.value&&(r.value.departureSplitTimes.timeRanges=[{from:O.value,to:e.id}])}}),Be=[{label:"بامداد",icon:Ke,items:[{label:"00:00 تا 02:00",value:{from:"00:00",to:"02:00"}},{label:"02:00 تا 04:00",value:{from:"02:00",to:"04:00"}},{label:"04:00 تا 06:00",value:{from:"04:00",to:"06:00"}}]},{label:"صبح",icon:Xe,items:[{label:"06:00 تا 08:00",value:{from:"06:00",to:"08:00"}},{label:"08:00 تا 10:00",value:{from:"08:00",to:"10:00"}},{label:"10:00 تا 12:00",value:{from:"10:00",to:"12:00"}}]},{label:"بعد از ظهر",icon:Ze,items:[{label:"12:00 تا 14:00",value:{from:"12:00",to:"14:00"}},{label:"14:00 تا 16:00",value:{from:"14:00",to:"16:00"}},{label:"16:00 تا 18:00",value:{from:"16:00",to:"18:00"}}]},{label:"شب",icon:et,items:[{label:"18:00 تا 20:00",value:{from:"18:00",to:"20:00"}},{label:"20:00 تا 22:00",value:{from:"20:00",to:"22:00"}},{label:"22:00 تا 24:00",value:{from:"22:00",to:"23:59"}}]}],we=[{label:"همه",value:ve.NUMBER_1},{label:"تک صندلی",value:ve.NUMBER_0}];function qe(e){var s,u;const a=e.items.map(i=>i.value);if(W(e))r.value.departureSplitTimes.timeRanges=(u=(s=r.value.departureSplitTimes)==null?void 0:s.timeRanges)==null?void 0:u.filter(i=>!a.find(b=>C(b,i)));else{const i=new tt().setCompareFn(C).addAll(a).addAll(r.value.departureSplitTimes.timeRanges).toArray();r.value.departureSplitTimes.timeRanges=Array.from(i)}}function De(e,a){var s,u,i,b,U,Y;if(a)(u=(s=r.value.departureSplitTimes)==null?void 0:s.timeRanges)==null||u.push(e);else{const J=((b=(i=r.value.departureSplitTimes)==null?void 0:i.timeRanges)==null?void 0:b.indexOf(e))??-1;J!==-1&&((Y=(U=r.value.departureSplitTimes)==null?void 0:U.timeRanges)==null||Y.splice(J,1))}}const Ne=p(()=>{var a,s,u,i;const[e]=te.value;return e?(a=e.segments)==null?void 0:a[0]:(i=(u=(s=V.autoReservableList)==null?void 0:s[0])==null?void 0:u.segments)==null?void 0:i[0]}),ke=p(()=>{var e,a;return(a=(e=Ne.value)==null?void 0:e.digest)==null?void 0:a[0]}),Le=p(()=>{var s,u,i,b;const e=ae.value?1:2,a=((b=(i=(u=(s=m.value)==null?void 0:s.vehicleTypes)==null?void 0:u.filter(U=>q.value.includes(U.id||"")))==null?void 0:i.slice(0,e))==null?void 0:b.map(({title:U})=>U||""))||[];return q.value.length>e&&a.push("..."),a}),ze=p(()=>{var s,u;const e=ae.value?1:2,a=((u=(s=m.value)==null?void 0:s.carriers)==null?void 0:u.filter(i=>F.value.includes(i.id||"")).slice(0,e).map(({title:i})=>i||""))||[];return F.value.length>e&&a.push("..."),a}),Te=Z();return ut({container:Te,title:"فیلترهای بیشتر",id:"auto-reserve-route-more-filters",text:"از این قسمت می‌توانید فیلترهای بیشتری برای سفر اعمال کنید."}),(e,a)=>{var s,u,i,b,U,Y,J,Re,Se,xe,Pe,Ve;return o(),d(k,null,[f("div",yt,[_t,(o(),d(k,null,I(ne,n=>f("div",{key:n.value,class:"radio-types"},[_(Q,{"model-value":t(D)===n.value,"is-radio":"","radio-name":"time-type",label:n.label,"onUpdate:modelValue":v=>D.value=n.value},null,8,["model-value","label","onUpdate:modelValue"]),n.value===t(D)&&n.value==="fixed-selection"?(o(),d("div",ht,[(o(),d(k,null,I(Be,v=>f("div",{key:v.label,class:"radio-box"},[f("div",bt,[_(Je,{size:"small",icon:v.icon},null,8,["icon"]),_(Q,{label:v.label,"model-value":W(v),intermediate:ie(v),"onUpdate:modelValue":B=>qe(v)},null,8,["label","model-value","intermediate","onUpdate:modelValue"])]),f("div",kt,[(o(!0),d(k,null,I(v.items,B=>{var K,X;return o(),h(Q,{key:B.label,label:B.label,"model-value":!!((X=(K=t(r).departureSplitTimes)==null?void 0:K.timeRanges)!=null&&X.find(G=>C(G,B.value))),"onUpdate:modelValue":G=>De(B.value,G)},null,8,["label","model-value","onUpdate:modelValue"])}),128))])])),64))])):y("",!0),n.value===t(D)&&n.value==="custom-selection"?(o(),d("div",Tt,[Rt,_(Ae,{modelValue:t(ue),"onUpdate:modelValue":a[0]||(a[0]=v=>j(ue)?ue.value=v:null),placeholder:"ساعت","hide-description":"",options:t(g)},null,8,["modelValue","options"]),St,_(Ae,{modelValue:t(ce),"onUpdate:modelValue":a[1]||(a[1]=v=>j(ce)?ce.value=v:null),placeholder:"ساعت","hide-description":"","empty-list-message":"ابتدای بازه را مشخص کنید.",options:t(c)},null,8,["modelValue","options"])])):y("",!0)])),64))]),(u=(s=t(m))==null?void 0:s.vehicleTypes)!=null&&u.length||(b=(i=t(m))==null?void 0:i.carriers)!=null&&b.length?(o(),d("div",{key:0,ref_key:"root",ref:Te,class:"box"},[f("span",xt,[se(" سایر فیلترها "),t(oe)?(o(),h(Ce,{key:0,type:"transparent",size:"medium",onClick:t(z)},{default:P(()=>[se(" حذف فیلترها ")]),_:1},8,["onClick"])):y("",!0)]),_(Fe,{items:[{message:"با اعمال فیلترهای بیشتر، شانس شما برای رزرو خودکار موفق کاهش پیدا می‌کند."}]},null,8,["items"]),(Y=(U=t(m))==null?void 0:U.alternativeOrigins)!=null&&Y.length||(Re=(J=t(m))==null?void 0:J.alternativeDestinations)!=null&&Re.length?(o(),h(le,{key:0,title:"پایانه مبدأ و مقصد"},{default:P(()=>{var n,v,B,K,X,G;return[(v=(n=t(m))==null?void 0:n.alternativeOrigins)!=null&&v.length?(o(),d("div",Pt,[f("span",Vt," پایانه مبدأ ("+ee((B=t(ke))==null?void 0:B.originCityName)+") ",1),_(me,{modelValue:t(M),"onUpdate:modelValue":a[2]||(a[2]=de=>j(M)?M.value=de:null),name:"origin-terminals",radios:t($)},null,8,["modelValue","radios"])])):y("",!0),(X=(K=t(m))==null?void 0:K.alternativeDestinations)!=null&&X.length?(o(),d("div",At,[f("span",Ut," پایانه مقصد ("+ee((G=t(ke))==null?void 0:G.destinationCityName)+") ",1),_(me,{modelValue:t(H),"onUpdate:modelValue":a[3]||(a[3]=de=>j(H)?H.value=de:null),name:"destination-terminals",radios:t(N)},null,8,["modelValue","radios"])])):y("",!0)]}),_:1})):y("",!0),(xe=(Se=t(m))==null?void 0:Se.vehicleTypes)!=null&&xe.length?(o(),h(le,{key:1,title:`نوع ${t(A)}`},{"title-append":P(()=>[t(q).length?(o(),d("div",Ft,[(o(!0),d(k,null,I(t(Le),n=>(o(),d("div",{key:n,class:"badge"},ee(n),1))),128))])):y("",!0)]),default:P(()=>[f("div",It,[(o(!0),d(k,null,I(t(m).vehicleTypes||[],n=>(o(),h(Q,{key:n.id||"",label:n.title||"","model-value":t(q).includes(n.id||""),"onUpdate:modelValue":v=>t(T)(n.id||"",v)},null,8,["label","model-value","onUpdate:modelValue"]))),128))])]),_:1},8,["title"])):y("",!0),(Ve=(Pe=t(m))==null?void 0:Pe.carriers)!=null&&Ve.length?(o(),h(le,{key:2,title:`شرکت ${t(w)}`},{"title-append":P(()=>[t(F).length?(o(),d("div",Ct,[(o(!0),d(k,null,I(t(ze),n=>(o(),d("div",{key:n,class:"badge"},ee(n),1))),128))])):y("",!0)]),default:P(()=>[f("div",Mt,[(o(!0),d(k,null,I(t(m).carriers||[],n=>(o(),h(Q,{key:n.id||"",label:n.title||"",class:"checkbox","model-value":t(F).includes(n.id||""),"onUpdate:modelValue":v=>t(x)(n.id||"",v)},null,8,["label","model-value","onUpdate:modelValue"]))),128))])]),_:1},8,["title"])):y("",!0),_(le,{title:"نوع صندلی"},{default:P(()=>[f("div",$t,[_(me,{modelValue:t(R),"onUpdate:modelValue":a[4]||(a[4]=n=>j(R)?R.value=n:null),name:"seatTypes",row:"",radios:we},null,8,["modelValue"])])]),_:1})],512)):y("",!0)],64)}}});const Bt=ye(Et,[["__scopeId","data-v-2fbfe154"]]),wt={class:"auto-root"},qt=_e({__name:"index",setup(S,{expose:L}){const{handleException:V}=He(),x=pe(),T=fe(),{requestType:z}=ge(T),m=p(()=>x.autoReservableList.map(r=>({itineraryPackage:r,selected:T.selectedPackages.some(A=>Me(A.autoReserveDemandParams).isEqual(r.autoReserveDemandParams)),order:r===T.preSelectPackage?-1:void 0}))),w=()=>{try{T.saveSession(),at().setItineraryPackagesAndDepartureTime([T.selectedPackages[0]||x.autoReservableList[0]]),lt().selectedPackages=[T.selectedPackages[0]||x.autoReservableList[0]],nt().push("/reserve/form")}catch(r){V(r)}};return it(async()=>{if(scroll({top:0,behavior:"smooth"}),m.value.length===0){history.back();return}try{await T.getAutoReservePrice()}catch(r){await V(r),history.back()}}),L({proceed:w}),(r,A)=>(o(),d("div",wt,[t(z)==="item"?(o(),h(gt,{key:0})):(o(),h(Bt,{key:1}))]))}});const Jt=ye(qt,[["__scopeId","data-v-cb7c9f69"]]);export{Jt as default};
