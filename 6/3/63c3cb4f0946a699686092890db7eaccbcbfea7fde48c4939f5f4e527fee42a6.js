"use strict";(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[2019],{30127:function(t,e,r){r.d(e,{AN:function(){return i},oE:function(){return a},v3:function(){return u}});var n=o=function(t){return t.webkitGetAsEntry&&t.webkitGetAsEntry()||t.getAsEntry&&t.getAsEntry()},i=function(t){return".ds_store"===(t.name||t.fname||"").toLowerCase()},s=function(t){return new Promise((function(e,r){var n=[],o=[],s=0;!function t(a){s++,a.createReader().readEntries((function(r){var u=r.filter(();0===u.length?n.push(a):u.forEach((),0===--s&&e({dirs:n,files:o})}),r)}(t)}))},a=u=function(t){return new Promise((function(e,r){if(t))s(o(t)).then(e).catch(r);else{var a=o(t);e({dirs:[],files:i(a)?[]:[a]})}}))}},22019:function(t,e,r){r.r(e),r.d(e,{default:);var n=r(15861),o=r(42982),i=r(87757),s=r.n(i),a=r(78684),u=r(81274),c=r(74300),p=r(79835),l=r(30127),f=r(58731),d=r(7018),h=r.n(d),m=r(27060);r y=["All","Mine","Enterprise","Device","Secret","Team","EntSpace","Group"],$=["All","Mine","Secret","Team","Enterprise","EntSpace","Group","Latest","Share","Tags"],D={name:"DropZone",componentName:"PlupDrop",data:function(){return{isDropenInner:!1,isDropenOuter:!1,targetList:[],target:{key:"",rect:null,cssText:"",element:null},processing:!1,dragInfo:{files:[],types:[]},files:null,$tooltip:null}},mixins:[a.Z],computed:{tooltipsPermission:function(){return this.$tooltip.getters.tooltipsPermission},isSecretExpired:isEnt:function(){return this.$store.state.company.currentView.isEnt&&this.$store.state.company.entspaceid},isAreaMask:function(){if(this.$store.state.ui.useNewLayout)return!0;var t=this.getAreaMaskRouteName();return!!t&&("Enterprise"!==t||0!==Number(this.$route.params.tid))},currentPathName:function(){if(["Latest","Tags","Sharing","Share","EntGroups","Groups","Trash","Groups"].includes(this.$route.name))return this.$t("constant_MY_CLOUD_NEW_LAYOUT");var t=this.$store.state.file.path;return this.$t(t&&t.length&&t[t.length-1].text||"")},tips:function(){var t=this.$t("c_tooltips_PlupDrop2");return this.isAreaMask?t+this.$t("c_tooltips_PlupDrop0"):this.isEnt?t+this.$t("c_tooltips_PlupDrop6"):t+this.$t("c_tooltips_PlupDrop1")}},watch:{"target.cssText":function(t){var e=this;this.$store.state.ui.useNewLayout&&this.$nextTick((function(){e.$refs.dropzoneInner&&(e.$refs.dropzoneInner.style.cssText=t)}))}},methods:{afterTooltipLoad:function(){this.$tooltip=this.$parent.$refs.tooltips.$tooltip,this.setDefaultPath(),this.dragInfo.files.length&&this.controlDragPermission()},getAreaMaskRouteName:function(){var t=this;return[].concat(y).find(()},handleOuterDragleave:function(t){this.processing=!1,this.setTarget(),this.hideDropZone(t)},eventDocDragenter:function(t){var e=t.dataTransfer.types;~(0,o.Z)(e).indexOf("Files")&&this.handleDragenter(t)},setTargetList:function(){var t=(0,o.Z)(Array.from(document.querySelectorAll(".aside-menu .menu-list-item[data-key^=folder_], .aside-menu .menu-list-item[data-key^=group_], .aside-menu .menu-list-item[data-key=All]"))),e=document.querySelector(".manager-container-main");e&&$.includes(this.$route.name)&&t.push(e);var r=[];t.forEach((function(t){var e=t.getAttribute("data-key");!e&&t.classList.contains("manager-container-main")&&(e="doc-list"),e&&r.push({key:e,rect:t.getBoundingClientRect(),element:t})})),this.targetList=r},getAreaMaskRect:function(){if(this.$store.state.ui.useNewLayout)return this.target.rect;var t=this.getAreaMaskRouteName();if("Enterprise"!==t&&"Group"!==t||0===Number(this.$route.params.tid)){var e=document.querySelector("#drive-file-container").getBoundingClientRect();return{width:e.width+42,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left-42,x:e.x,y:e.y}}var r=document.querySelector("#team-file-container-filelist-wrapper").getBoundingClientRect();return{width:r.width,height:r.height,top:r.top,right:r.right,bottom:r.bottom,left:r.left,x:r.x,y:r.y}},computeUploaderStyle:function(){var t=this,e=this.getAreaMaskRect();if(e){var r=e.width,n=e.right,o=e.left,i=e.top;this.$nextTick((function(){t.$refs.dropzoneInner&&(t.$store.state.ui.useNewLayout?t.$refs.dropzoneInner.style.cssText="\n            width: ".concat(r,"px;\n            top: ").concat(i,"px;\n            right: ").concat(n,"px;\n            bottom: 0px;\n            left: ").concat(o,"px;\n          "):t.$refs.dropzoneInner.style.cssText="\n            width: ".concat(r,"px;\n            top: 56px;\n            right: ").concat(n,"px;\n            bottom: 0px;\n            left: ").concat(o,"px;\n          "))}))}},getCompany:function(){var t=this.$route.params.cid,e=this.$store.state.company.joinedCompanies.find(();return t&&e},hideDropzoneByOtherPanels:function(t){var e=document.getElementById("k-jingxiaomeng"),r=document.querySelectorAll(".el-popover.el-popper.member-card-popover")||[];(e&&e.contains(t.target)||r&&Array.from(r).some(())&&this.hideDropZone()},setDefaultPath:function(){var t=this.$store.state,e=t.team,r=t.route,n=t.file,o=t.company,i=r.params,s=i.tid,a=i.fid,u=s||e.myCloud.id,c=a||0;if("Secret"===r.name){var p=n.target.split("_");u=p[0],c=p[1]||"0"}"Device"===r.name&&(u=this.$store.state.team.myUpload.id),this.isEnt&&"Enterprise"!==r.name&&(u=o.entspaceid||u),"Backup"===r.name&&(u=s),this.setPath(u,c,e.current.name)},handleDragenter:function(t){this.$store.state.ui.useNewLayout?this.dispatch("Container","loadTooltips",this.afterTooltipLoad):this.dispatch("DriveContainerRoot","loadTooltips",this.afterTooltipLoad),this.processing=!0;var e=this.$store.state,r=e.team,n=e.route;this.setTargetList(),/^\/(auto|view\/)/g.test(n.path)||"read_member"===r.current.user_role&&!["Team"].includes(this.$route.name)||["EntHelper"].includes(this.$route.name)||(this.showDropZone(t),this.isAreaMask&&this.computeUploaderStyle(),this.hideDropzoneByOtherPanels(t))},isMouseOutAvariableArea:function(t,e,r){var n=t.clientY||t.pageY,o=t.clientX||t.pageX;return r=Object.assign({top:0,right:0,bottom:0,left:0},r),n<e.top-r.top||o>e.right+r.right||n>e.bottom+r.bottom||o<e.left-r.left},handleUploaderFilterDrop:function(t){var e=this.getAreaMaskRect();if(this.isAreaMask&&(!e||this.isMouseOutAvariableArea(t,e)))return t.preventDefault(),t.stopPropagation(),void this.hideDropZone()},getDragFiles:function(t){var e=(t.items?Array.from(t.items):[]).filter((function(t){return(0,l.oE)(t)})).map(();return Promise.all(e).then((function(t){var e=[],r=[];return t.forEach((function(t){e.push.apply(e,(0,o.Z)(t.dirs)),r.push.apply(r,(0,o.Z)(t.files))})),{dirs:e,files:r}}))},controlDragPermission:function(t,e){var r=this;return(0,n.Z)(s().mark((function n(){var o,i,a,l,d,h,v,y,$,D,k,x,w,b,E,A,L;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=[],i=t&&t.dataTransfer||r.dragInfo,a=g(i.types);try{for(a.s();!(l=a.n()).done;)d=l.value,o.push(d),r.dragInfo.types=o}catch(t){a.e(t)}finally{a.f()}if(h=r.$store.state.route.name,v=[],t)for($ in y=t.dataTransfer.files)$&&"File"===Object.prototype.toString.call(y[$]).slice(8,-1)&&(v.push(y[$]),r.files=v);else v=r.files;if(r.$store.state.ui.useNewLayout&&r.target.key&&"doc-list"!==r.target.key?(D=r.$store.getters.findMenus([r.target.key])[0],k=D.parentGroupId&&D.parentGroupId!==D.groupId,x=D.type===m.hd.group,r.setPath(D.groupId,k||x?0:D.sourceId,x?D.text:"")):r.setDefaultPath(),n.prev=8,!t){n.next=15;break}return n.next=12,r.getDragFiles(t.dataTransfer);case 12:n.t0=n.sent,n.next=16;break;case 15:n.t0=r.dragInfo;case 16:if(w=n.t0,b=w.dirs,E=w.files,r.dragInfo.dirs=b,r.dragInfo.files=E,r.$parent.$refs.tooltips){n.next=25;break}return n.abrupt("return");case 25:r.$tooltip=r.$parent.$refs.tooltips.$tooltip;case 26:r.$tooltip.dispatch(u.Ge,{dirs:b,hasFile:!!E.length}),n.next=31;break;case 29:n.prev=29,n.t1=n.catch(8);case 31:if(r.$tooltip.commit(u.o9,{way:"drag",type:"none",position:"others"}),r.processing=!1,r.hideDropZone(),!~[].concat(o).indexOf("Files")){n.next=63;break}if(!r.isSecretExpired){n.next=40;break}return t&&t.stopPropagation(),t&&t.preventDefault(),"Secret"===h&&t&&r.dialog("preventUpload",{useNewLayout:r.$store.state.ui.useNewLayout}),n.abrupt("return");case 40:if(A=v.filter((function(t){var e=(0,p.getExtName)(t.name);return c.M8.includes(e)&&t.size<=c.xb})),!(!e&&A&&A.length>0)){n.next=62;break}return t&&t.stopPropagation(),t&&t.preventDefault(),n.next=46,r.$tooltip.dispatch(u.Io);case 46:if(!n.sent){n.next=60;break}return n.prev=48,n.next=51,r.askExcelToAS(v,A);case 51:L=n.sent,r.$tooltip.commit(u.ge,L),r.controlDragPermission(void 0,!0),n.next=58;break;case 56:n.prev=56,n.t2=n.catch(48);case 58:n.next=61;break;case 60:r.controlDragPermission(void 0,!0);case 61:return n.abrupt("return");case 62:r.tooltipsPermission?t||setTimeout((function(){r.$tooltip.dispatch(u.su,{path:{},files:v})}),500):(t&&t.preventDefault(),t&&t.stopPropagation(),r.processPermissionFn(v));case 63:r.target&&r.target.element&&r.target.element.classList.remove(f.p);case 64:case"end":return n.stop()}}),n,null,[[8,29],[48,56]])})))()},askExcelToAS:function(t,e){var r=this;return new Promise((function(n,o){r.dialog("excelToAS",{useNewLayout:r.$store.state.ui.useNewLayout,config:r.$tooltip.getters.excelToASConfig,fileList:t,excelList:e,beforeCloseFun:function(t,e){"ok"===e&&n("ksheet"===t.current),o()}})}))},processPermissionFn:function(t){var e,r=this;this.$tooltip.commit(u.lQ,1990),this.dialog("Finder",{tit:this.$t("c_tooltips_PlupDrop5"),onCommit:(e=(0,n.Z)(s().mark((function e(n){var o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.groupid,i=n.id,e.next=3,r.$tooltip.dispatch(u.Pd,{selected:n});case 3:e.sent&&r.$tooltip.dispatch(u.su,{path:{groupid:o,parentid:i},files:t});case 5:case"end":return e.stop()}}),e)}))),})},hideDropZone:function(){this.$parent.$refs.tooltips&&this.$parent.$refs.tooltips.onHideDrop(),this.isAreaMask&&this.isDropenInner&&this.$refs.dropzoneInner&&(this.$refs.dropzoneInner.style.cssText=""),this.isDropenInner=!1,this.isDropenOuter=!1},showDropZone:setPath:function(t,e,r){this.$tooltip&&this.$tooltip.dispatch(u.Im,{path:{groupid:t,parentid:e||0,groupName:r,isNewVersion:!1,company:this.getCompany()}})},cancelDefaultEvent:setTarget:function(t){var e=t?{key:t.key,rect:t.rect,cssText:"width: ".concat(t.rect.width,"px; left: ").concat(t.rect.left,"px; top: ").concat(t.rect.top,"px; height: ").concat(t.rect.height,"px;"),element:t.element}:{key:"",rect:null,cssText:"",element:null};e.element!==this.target.element&&(this.target.element&&this.target.element.classList.remove(f.p),e.element&&e.element.classList.add(f.p)),this.target=e},handleTarget:function(t){if(this.processing){var e=t.clientX,r=t.clientY,n=this.targetList.find((function(t){return t.rect&&t.rect.left<=e&&e<=t.rect.left+t.rect.width&&t.rect.top<=r&&r<=t.rect.top+t.rect.height}));this.setTarget(n)}}},created:mounted:function(){var t=this;document.getElementById("app").appendChild(this.$refs.uploaderWrapper);var e=h().ask("Upload.file.visible",{position:"drag",user:this.$store.state.user,route:this.$route},!0),r=h().ask("Upload.folder.visible",{position:"drag",user:this.$store.state.user,route:this.$route},!0);(e||r)&&document.addEventListener("dragenter",this.eventDocDragenter),document.addEventListener("dragenter",this.cancelDefaultEvent),document.addEventListener("dragover",this.cancelDefaultEvent),document.addEventListener("drop",this.cancelDefaultEvent);var n=!this.$ua.ie&&"Safari"!==this.$ua.browser;if(n||this.$store.state.ui.useNewLayout){var o=function(e){if(e.preventDefault(),t.$store.state.ui.useNewLayout&&t.handleTarget(e),t.isAreaMask&&n)if(t.$store.state.ui.useNewLayout)e.dataTransfer.dropEffect=t.target.key?"copy":"none";else{var r=t.getAreaMaskRect();t.isMouseOutAvariableArea(e,r)?e.dataTransfer.dropEffect="none":e.dataTransfer.dropEffect="copy"}};document.addEventListener("dragover",o),this.$once("hook:beforeDestroy",()}var i=s=document.addEventListener("mouseenter",s),window.addEventListener("resize",i),this.$once("hook:beforeDestroy",()},beforeDestroy:,k=D,x=(0,r(51900).Z)(k,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"uploaderWrapper",staticClass:"uploader-dropzone__wrapper",class:[t.isAreaMask?"area":"full"],on:{click:function(e){return e.stopPropagation(),t.hideDropZone.apply(null,arguments)}}},[!t.isDropenInner||t.$store.state.ui.useNewLayout&&!t.target.key?t._e():r("div",{ref:"dropzoneInner",staticClass:"dropzone-inner",class:{"has-tip":t.$store.state.ui.useNewLayout&&"doc-list"===t.target.key}},[t.$store.state.ui.useNewLayout&&"doc-list"===t.target.key?r("div",{staticClass:"uploader-info"},[r("UploadFormatIcon",{attrs:{size:"24"}}),r("div",{staticClass:"uploader-info__text"},[t._v(t._s(t.$t("c_tooltips_uploaded_to",[t.currentPathName])))])],1):t.$store.state.ui.useNewLayout?t._e():r("p",{staticClass:"uploader-tip"},[t._v(" "+t._s(t.tips))])]),r("div",{directives:[{name:"show",rawName:"v-show",value:t.isDropenOuter,expression:"isDropenOuter"}],staticClass:"dropzone-outer",on:{dragenter:dragleave:},[r("div",{staticClass:"content",on:{"!drop":},[r("div",{ref:"uploader",staticClass:"drive-uploader",attrs:{id:"uploader-dropzone"}},[t.isAreaMask?r("div",{staticClass:"uploader-filter",on:{drop:t.handleUploaderFilterDrop}}):t._e()])])])])}),[],!1,null,"0a69e179",null),w=x.exports}}]);
