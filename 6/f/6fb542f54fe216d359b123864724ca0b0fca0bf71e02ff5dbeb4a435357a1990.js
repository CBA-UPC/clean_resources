/*! For license information please see createnewmodule.adf6a03f5b23fd9f422f.chunk.v7.js.LICENSE.txt */
(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[165],{psR6:function(e,t,n){"use strict";n.r(t),n.d(t,"createNewFluidFile",(function(){return I})),n.d(t,"createNewContainerOnExistingFile",();var r=n("he5V"),a=n("1bkS"),o=n("Unhj"),i=n("V0Op"),s=n("DX81"),c=n("Tvsg"),l=n("hpQ0"),d=n("f/DM"),p=n("KqdK"),h=n("kWwJ"),u=n("A3AF"),b=n("HJ7Z"),f=n("DLbW"),m=n("Xou4"),y=n("7/yF"),w=n("Ls0c"),O=n("Qkn4");function g(e,t){const n=e.tree[".protocol"],r=Object(f.b)(n).sequenceNumber,a=new Map,o=j(e,a);return o.id=t,{snapshotTree:o,blobs:a,ops:[],sequenceNumber:r,latestSequenceNumber:r}}function j(e,t){const n={blobs:{},trees:{},unreferenced:e.unreferenced},r=Object.keys(e.tree);for(const a of r){const r=e.tree[a];switch(r.type){case b.a.Tree:n.trees[a]=j(r,t);break;case b.a.Blob:{const e="string"==typeof r.content?Object(m.e)(r.content,"utf8"):r.content,o=Object(u.a)();n.blobs[a]=o,t.set(o,e);break}case b.a.Handle:case b.a.Attachment:throw new Error(`No ${r.type} should be present for detached summary!`);default:Object(y.a)(r,`Unknown tree type ${r.type}`)}}return n}function v(e){var t;if(!Object(f.d)(e))throw new Error("App and protocol summary required for create new path!!");const n=e.tree[".app"],r=e.tree[".protocol"],a=Object(f.b)(r),o={type:b.a.Blob,content:JSON.stringify(a)};return r.tree.attributes=o,{entries:null!==(t=k({type:b.a.Tree,tree:{".protocol":r,".app":n}}).entries)&&void 0!==t?t:[],message:"app",sequenceNumber:a.sequenceNumber,type:"container"}}function k(e){var t;const n={type:"tree",entries:[]},r=Object.keys(e.tree);for(const a of r){const r=e.tree[a];let o,i;switch(r.type){case b.a.Tree:o=k(r),i=r.unreferenced;break;case b.a.Blob:o={type:"blob",content:"string"==typeof r.content?r.content:Object(m.b)(r.content,"base64"),encoding:"string"==typeof r.content?"utf-8":"base64"};break;case b.a.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error(`Unknown tree type ${r.type}`)}const s={path:encodeURIComponent(a),type:Object(w.g)(r),value:o,unreferenced:i};null===(t=n.entries)||void 0===t||t.push(s)}return n}async function T(e){const{containerSnapshot:t,getStorageToken:n,logger:r,initialUrl:a,forceAccessTokenViaAuthorizationHeader:i,epochTracker:s,telemetryName:d,fetchType:p,validateResponseCallback:h}=e;return Object(l.i)((async e=>{const b=await n(e,d);return o.b.timedExecAsync(r,{eventName:d},(async n=>{const o=JSON.stringify(t);let f,m,y=!1;const w=Object(u.a)();let g=`--${w}\r\n`;if(g+=`Authorization: Bearer ${b}\r\n`,g+="X-HTTP-Method-Override: POST\r\n",g+="Content-Type: application/json\r\n",g+="_post: 1\r\n",g+=`\r\n${o}\r\n`,g+=`\r\n--${w}--`,g.length<=l.l){const e=new URL(a);e.searchParams.set("ump","1"),f=e.href,m={"Content-Type":`multipart/form-data;boundary=${w}`},y=!0}else{const e=Object(c.a)(a,b,i);f=e.url,m=Object.assign(Object.assign({},e.headers),{"Content-Type":"application/json"}),g=o}const j=await Object(O.a)((async()=>s.fetchAndParseAsJSON(f,{body:g,headers:m,method:"POST"},p,y)),d,r);return null==h||h(j.content),n.end(Object.assign({headers:0!==Object.keys(m).length||void 0,attempts:e.refresh?2:1},j.propsToLog)),j.content}))}))}var $=n("FiVw"),N=n("1Z3m");async function I(e,t,n,u,b,f,m,y,w,j,k){if(((t.filename))throw new a.f("Invalid filename for createNew",i.a.invalidFileNameError,{driverVersion:$.a});let I,S,C="";if(void 0===u)I=await async function(e,t,n,r,i){const d=t.filePath?encodeURIComponent(`/${t.filePath}`):"",h=encodeURIComponent(`${t.filename}.tmp`),u=`${Object(p.a)(Object(l.h)(t.siteUrl))}/drives/${t.driveId}/items/root:/${d}/${h}:/content?@name.conflictBehavior=rename&select=id,name,parentReference`;return Object(l.i)((async t=>{const l=await e(t,"CreateNewFile");return o.b.timedExecAsync(n,{eventName:"createNewEmptyFile"},(async e=>{const{url:t,headers:o}=Object(c.a)(u,l,i);o["Content-Type"]="application/json";const d=await Object(O.a)((async()=>r.fetchAndParseAsJSON(t,{body:void 0,headers:o,method:"PUT"},"createFile")),"createFile",n),p=d.content;if(!p||!p.id)throw new a.f("ODSP CreateFile call returned no item ID (for empty file)",s.a.incorrectServerResponse,{driverVersion:$.a});return e.end(Object.assign({headers:0!==Object.keys(o).length||void 0},d.propsToLog)),p.id}),{end:!0,cancel:"error"})}))}(e,t,n,b,y);else{const r=await async function(e,t,n,r,o,i){const c=t.filePath?encodeURIComponent(`/${t.filePath}`):"",d=encodeURIComponent(t.filename),h=`${Object(p.a)(Object(l.h)(t.siteUrl))}/drives/${t.driveId}/items/root:${c}/${d}`,u=v(r),b=Object(l.a)(t.createLinkType);return T({containerSnapshot:u,getStorageToken:e,logger:n,initialUrl:`${h}:/opStream/snapshots/snapshot${b?`?${b}`:""}`,forceAccessTokenViaAuthorizationHeader:i,epochTracker:o,telemetryName:"CreateNewFile",fetchType:"createFile",validateResponseCallback:e=>{if(!e||!e.itemId)throw new a.f("ODSP CreateFile call returned no item ID",s.a.incorrectServerResponse,{driverVersion:$.a})}})}(e,t,n,u,b,y);I=r.itemId,C=r.id,S=function(e,t,n,r){if(!e)return;let a;if(n){const{sharing:n}=t;if(!n)return;a={createLink:{type:e,link:n.sharingLink?Object.assign({scope:n.sharingLink.scope,role:n.sharingLink.type,webUrl:n.sharingLink.webUrl},n.sharingLink):void 0,error:n.error,shareId:n.shareId}}}else if(r){const{sharing:n,sharingLink:r,sharingLinkErrorReason:o}=t;if(!r&&!o)return;a={createLink:{type:e,link:r,error:o,shareId:null==n?void 0:n.shareId}}}return a}(t.createLinkType,r,j,k)}const U=Object(d.a)(Object.assign(Object.assign({},t),{itemId:I,dataStorePath:"/"})),A=new h.a,L=await A.resolve({url:U,headers:{[N.a.isClpCompliantApp]:w}});if(f.docId=L.hashedDocumentId,f.resolvedUrl=L,L.shareLinkInfo=S,void 0!==u&&m){Object(r.a)(void 0!==C,515);const e=g(u,C);await b.put(Object(l.b)(L),e)}return L}var S=n("7Oo1");async function C(e,t,n,r,a,o,i,s,c){if(void 0===r)throw new S.a("createNewSummary must exist to create a new container");const u=`${Object(p.a)(Object(l.h)(t.siteUrl))}/drives/${t.driveId}/items/${t.itemId}`,b=v(r),f=`${u}/opStream/snapshots/snapshot`,{id:m}=await T({containerSnapshot:b,getStorageToken:e,logger:n,initialUrl:f,forceAccessTokenViaAuthorizationHeader:s,epochTracker:a,telemetryName:"CreateNewContainerOnExistingFile",fetchType:"uploadSummary"}),y=Object(d.a)(Object.assign(Object.assign({},t),{dataStorePath:"/"})),w=new h.a,O=await w.resolve({url:y,headers:{[N.a.isClpCompliantApp]:c}});if(o.docId=O.hashedDocumentId,o.resolvedUrl=O,i){const e=g(r,m);await a.put(Object(l.b)(O),e)}return O}}}]);
//# sourceMappingURL=createnewmodule.adf6a03f5b23fd9f422f.chunk.v7.js.map