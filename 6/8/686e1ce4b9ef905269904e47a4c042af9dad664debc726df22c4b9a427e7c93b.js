"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5507],{55507:function(e,r,n){n.d(r,{o:function(){return H}});var t=n(92809),o=n(67294),i=n(11163),c=n(9008),a=n(36184),u=n(95158),s=n(30266),f=n(809),l=n.n(f),d=n(36378),p=n(17673),v=n(4658),b=n(36523);function h(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function y(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?h(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var g=function(){var e=(0,s.Z)(l().mark((function e(r){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/api","/viewer",n=y(y({},r),{},{storeType:(0,b.KH)()}),e.abrupt("return",(0,v.M)({baseUrl:"/api",endpoint:"/viewer",params:n}));case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),m=function(){var e=(0,s.Z)(l().mark((function e(r){var n,t,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="https://viewer.bookpass.auone.jp",(0,d.Z)(n)){e.next=3;break}throw new Error("invalid env file. check env file and viewer variables.");case 3:return e.next=5,g(r);case 5:if(!(t=e.sent).errorPattern){e.next=8;break}return e.abrupt("return",{errorPattern:t.errorPattern});case 8:return o=(0,p.stringify)({uuid:t.uuid,iid:t.iid,auth_token:t.authToken}),e.abrupt("return",{url:new URL("/viewer/open?".concat(o),n)});case 10:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),O=n(91423),k=n(90870),w=n(90178),j=n(23497),P=n(33641),Z=n(98855),x=n(76625),S=n(38783),I=n(13666),U=n(1087),T=n(49360),E=n(77756),D=n(43013),C=n(24068),M=n(35944);function V(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function q(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?V(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var H=function(e){var r,n=(0,i.useRouter)(),t=(0,o.useState)(void 0),s=t[0],f=t[1],l=(0,o.useMemo)((,[n.query]),d=(0,O.Wv)(null===l||void 0===l?void 0:l.os),p=(0,o.useCallback)((function(){return f(d)}),[d]),v=(0,j.uw)().osVersion,b=(0,Z.WI)(),h=(0,a.Pc)();if(n.isReady&&!l)throw new k.S(400);var y=(0,S.Wq)({aid:null===l||void 0===l?void 0:l.iid,includePrivate:!0}),g=y.data,V=y.error;(0,o.useEffect)((,[V,p]);var H=(0,I.QN)(g),R=null!==(r=null===l||void 0===l?void 0:l.storeUrl)&&void 0!==r?r:null!==l&&void 0!==l&&l.os?(0,O.xy)(null===l||void 0===l?void 0:l.os,v):void 0,W=(0,O.mg)({aid:null===l||void 0===l?void 0:l.iid,storeUrl:R,sample:null===l||void 0===l?void 0:l.sample,originUrl:b,mobileOs:null===l||void 0===l?void 0:l.os,encryptedVtkt:e.encryptedVtkt,ivHexString:e.ivHexString}),z=function(){var e=(0,Z.zY)(),r=(0,C.kd)().trackingId,n=(0,C.Vk)().trackingId;return(0,o.useMemo)((function(){var t,o;if(!((0,T.Z)(e)||(0,T.Z)(r)||(0,T.Z)(n))){var i=e.location.hostname,c=e.document.referrer;return{trackingId:r,blTrackingId:n,deviceId:(0,E.Z)(!1),domain:i,referrer:c,cs:null!==(t=null===(o=(0,D.nS)())||void 0===o?void 0:o.value)&&void 0!==t?t:""}}}),[e,r,n])}(),B=(0,o.useMemo)((function(){return l&&R&&W&&z?q(q({},l),{},{storeUrl:R,recommendUrl:W},z):void 0}),[l,R,W,z]),N=(0,o.useCallback)((function(){return f({headingText:"\u95b2\u89a7\u53ef\u80fd\u53f0\u6570\u3092\u8d85\u3048\u3066\u3044\u307e\u3059",message:"\u95b2\u89a7\u53ef\u80fd\u53f0\u6570\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002\n\u300c\u6a5f\u5668\u8a8d\u8a3c\u767b\u9332\u89e3\u9664\u300d\u304b\u3089\u8a8d\u8a3c\u767b\u9332\u3092\u89e3\u9664\u3059\u308b\u3053\u3068\u3067\u65b0\u3057\u3044\u6a5f\u5668\u3092\u3054\u5229\u7528\u3044\u305f\u3060\u3051\u307e\u3059\u3002",buttonText:"\u6a5f\u5668\u8a8d\u8a3c\u767b\u9332\u89e3\u9664\u3078",onClick:function(){return location.replace(x.V.mypage.registered_devices.$url().pathname)}})}),[]),_=(0,o.useCallback)((function(e){return f({headingText:"\u8a66\u3057\u8aad\u307f\u4e0d\u53ef\u4f5c\u54c1\u3067\u3059",message:"\u3053\u306e\u4f5c\u54c1\u306f\u8a66\u3057\u8aad\u307f\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u3054\u4e86\u627f\u304f\u3060\u3055\u3044\u3002",buttonText:"\u623b\u308b",onClick:e?function(){return location.replace(e)}:void 0})}),[]),A=(0,o.useCallback)((function(e){return f({headingText:"\u305f\u3060\u3044\u307e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u4e2d\u3067\u3059",message:"\u3054\u8ff7\u60d1\u3092\u304a\u304b\u3051\u3057\u7533\u3057\u8a33\u3054\u3056\u3044\u307e\u305b\u3093\u3002\n\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u4f5c\u696d\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u4eca\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u3002",buttonText:"\u623b\u308b",onClick:e?void 0})}),[]);return(0,o.useEffect)((function(){B&&H&&h.initialized&&m(B).then((function(e){var r=B.storeUrl;"overLimitOnNumberOfTerminals"===e.errorPattern?N():"notExistsSample"===e.errorPattern?_(r):"viewerMaintenance"===e.errorPattern?A(r):e.url?location.replace(e.url.toString()):p()})).catch(()}),[B,H,p,_,N,A,h.initialized]),s?(0,M.tZ)(M.HY,{children:(0,M.tZ)(P.ErrorPage,{hideTitle:!s.headingText,title:s.headingText,message:s.message,disableLogoLink:!(null===l||void 0===l||!l.os),hideButton:!s.onClick,isNoIndex:!0,onClick:s.onClick,buttonText:s.buttonText})}):(0,M.BX)(M.HY,{children:[(0,M.tZ)(c.default,{children:(0,U.Md)(!0)}),(0,M.tZ)(w.a,{})]})}},90870:function(e,r,n){n.d(r,{S:function(){return l}});var t=n(68216),o=n(14695),i=n(91077),c=n(18184),a=n(92953),u=n(12564),s=n(92809);ar l=function(e){(0,i.Z)(n,e);var r=f(n);function n(e,i){var c;return(0,t.Z)(this,n),c=r.call(this,i),(0,s.Z)((0,o.Z)(c),"statusCode",500),c.name="PageError",c.statusCode=e,c}return n}((0,u.Z)(Error))},38783:function(e,r,n){n.d(r,{FP:function(){return b},hV:function(){return h},kH:function(){return g},Bw:function(){return m},U3:function(){return O},Wq:function(){return k}});var t=n(91164),o=n(30266),i=n(92809),c=n(809),a=n.n(c),u=n(16430),s=n(82899),f=n(55259),l=n(14505),d=["data","error"];function p(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function v(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?p(Object(n),!0).forEach((function(r){(0,i.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var b="/itemdetail/",h=25,y={isXLThumbnail:1},g=function(e){var r=e.aids,n=e.includePrivate,t=e.coupon;if(r.length>h)throw new Error("The number of designated AIDs exceeds 25.");return(0,u.B)({endpoint:b,params:v(v({},y),{},{aid:r.join(","),state:n?1:0,coupon:t?1:0})})},m=function(e){var r=(0,l.fd)(Math.ceil(e.length/h));return Promise.all(r.map((function(r){return g({includePrivate:!0,aids:e.slice(r*h,(r+1)*h)})})))},O=function(){var e=(0,o.Z)(a().mark((function e(r){var n,t,o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.aid,t=r.includePrivate,o=r.coupon,e.next=3,g({aids:[n],includePrivate:t,coupon:o});case 3:if(!((i=e.sent).itemInfo&&i.itemInfo.length>=1)){e.next=8;break}return e.abrupt("return",i.itemInfo[0]);case 8:throw new s.L(404);case 9:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),k=function(e,r){var n=(0,f.V)((function(){return e.aid?b+JSON.stringify(e):null}),(,{fallbackData:r});return v({data:n.data,error:n.error},(0,t.Z)(n,d))}},30781:function(e,r,n){n.d(r,{jG:function(){return d},wI:function(){return p},G5:function(){return v},sf:function(){return b},mH:function(){return y},XA:function(){return m},oE:function(){return O}});var t=n(80129),o=n.n(t),i=n(27771),c=n(49360),a=n(23497),u=n(9076),s=n(4658),f=n(47123),l=n(98855),d=p="bookpass://",v="bookpass://launch",b=10,h=function(e,r){var n=(0,a.dz)(),t="".concat(e,"?url=").concat(encodeURIComponent(location.href)).concat(r?"&".concat(r):"");return t=null!==n&&void 0!==n&&n.isAndroid&&null!==n&&void 0!==n&&n.isChrome?"".concat("intent://").concat(t,"#Intent;package=com.kddi.android.lismobookstore;scheme=bookpass;end;"):"".concat(p).concat(t)},y=function(e){var r,n={aids:(0,i.Z)(e.aid)?e.aid.join(","):e.aid};return(0,s.M)({baseUrl:"/",endpoint:"/api/is_download",params:(0,f.A)(n),config:{headers:{"x-vtkt":null!==(r=e.vtkt)&&void 0!==r?r:""}}}).catch((function(e){throw(0,u.PW)("warn",e),e}))},g=function(e,r,n){var t=(0,a.dz)();if(null!==t&&void 0!==t&&t.isIOS())"undefined"!==typeof top&&null!==top?top.location.href=e():(0,u.PW)("warn","Failed to ".concat(n,", 'top' is not defined."));else{var o=(0,l.Jj)();(0,c.Z)(o)?(0,u.PW)("warn","Failed to ".concat(n,", 'window' is not defined.")):o.location.href=r()}},m=function(e){var r={};(0,i.Z)(e)?(r.dllist=e.join(":"),r.cnt=e.length.toString()):r.aid=e;var n=o().stringify(r);g((function(){return d()+"/addqueueapp?".concat(n)}),(,"download request")},O=function(){g((,(,"open bookshelf")}},16430:function(e,r,n){n.d(r,{B:function(){return l}});var t=n(92809),o=n(30266),i=n(809),c=n.n(i),a=n(36378),u=n(4658);r l=function(){var e=(0,o.Z)(c().mark((function e(r){var n,t,o,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.endpoint,t=r.params,o=r.config,i="https://universal-proxy.bookpass.auone.jp/item/4.0/front",s="c03116c3a79dda5b1b28d8819cd5216f",(0,a.Z)(i)&&(0,a.Z)(s)){e.next=5;break}throw new Error("invalid env file.");case 5:return e.abrupt("return",(0,u.M)({baseUrl:i,endpoint:n,params:f({accessKey:s},t),config:o}));case 6:case"end":return e.stop()}}),e)})));return ()},95158:function(e,r,n){n.d(r,{m:function(){return c}});var t=n(36378),o=n(27771),i=n(36523),c=function(e){if(e.iid&&(0,t.Z)(e.iid)&&(e.storeUrl&&(0,t.Z)(e.storeUrl)||e.os)&&(!e.storeType||Object.values(i.vz).includes(e.storeType))){var r=function(e){return(0,t.Z)(e.os)?e.os:(0,o.Z)(e.os)?e.os[0]:void 0}(e);if(!r||"ios"===r||"android"===r)return{iid:e.iid,sample:e.sample,storeUrl:e.storeUrl,recommendUrl:e.recommendUrl,storeType:e.storeType,os:r,vtkt:e.vtkt,safeSearch:e.safeSearch?"true"===e.safeSearch:void 0,trackingId:e.trackingId,blTrackingId:e.blTrackingId,deviceId:e.deviceId,domain:e.domain,cs:e.cs,referrer:e.referrer}}}},91423:function(e,r,n){n.d(r,{xy:function(){return l},mg:function(){return d},Wv:function(){return p}});var t=n(67294),o=n(49360),i=n(17673),c=n(10297),a=n(24068),u=n(30781),s=n(98855),f=n(76625),l=function(e,r){return"android"===e?u.wI+"bookshelf":Number(r)<u.sf?u.G5:(0,u.jG)()+"/launchapp"},d=function(e){var r=e.aid,n=e.storeUrl,o=e.sample,u=e.originUrl,s=e.mobileOs,f=e.encryptedVtkt,l=e.ivHexString,d=(0,c.h)(),p=d.initialized,v=d.safeSearch,b=(0,a.kd)().trackingId;return(0,t.useMemo)((function(){if(p&&r&&n&&u&&b)return function(e){var r=e.aid,n=e.storeUrl,t=e.sample,o=e.originUrl,c=e.mobileOs,a=e.encryptedVtkt,u=e.ivHexString,s=e.safeSearch,f=e.trackingId;return"".concat(o,"/viewer/").concat("ios"===c||"android"===c?"apps/":"","finished?").concat((0,i.stringify)({iid:r,storeUrl:n,sample:t,key1:a,key2:u,safeSearch:s,trackingId:f}))}({aid:r,storeUrl:n,sample:o,originUrl:u,mobileOs:s,encryptedVtkt:f,ivHexString:l,safeSearch:v,trackingId:b})}),[r,n,o,u,s,f,l,p,v,b])},p=function(e){return(0,t.useMemo)((function(){return function(e){return{message:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u305f\u3081\u3001\u30d3\u30e5\u30fc\u30a2\u3092\u8d77\u52d5\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3057\u3070\u3089\u304f\u6642\u9593\u3092\u304a\u3044\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u30a2\u30af\u30bb\u30b9\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u89e3\u6d88\u3057\u306a\u3044\u5834\u5408\u306f\u304a\u624b\u6570\u3067\u3059\u304c\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044\u3002",buttonText:"\u304a\u554f\u3044\u5408\u308f\u305b\u3078",onClick:function(){location.replace((0,s.q4)(f.V.help.faq.$url({query:e,hash:"contact"})))}}}(function(e){return(0,o.Z)(e)?{}:"ios"===e?{iosApp:"1"}:{androidApp:"1"}}(e))}),[e])}},91164:]);