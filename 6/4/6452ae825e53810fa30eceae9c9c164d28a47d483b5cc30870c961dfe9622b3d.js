(self.webpackChunkdouyin_live_v2=self.webpackChunkdouyin_live_v2||[]).push([[1755],{11755:function(e){"undefined"!=typeof self&&self,e.exports=[function(e,t,r){"use strict";var n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:o=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e)},s=Number.isNaN||.exports=a,e.exports.once=(a.EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;nction f(e,t,r,n){var i,o;return u(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener||r),i=e._events),o=i[t]),void 0===o?(o=i[t]=r,++e._eventsCount):("function"==typeof o?o=i[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),0<(i=l(e))&&o.length>i&&!o.warned&&(o.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=o.length,console)),e}function h(e,t,r){return(t=(function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}).bind(e={fired:!1,wrapFn:void 0,target:e,type:t,listener:r})).listener=r,e.wrapFn=t}function p(e,t,r){return void 0===(e=e._events)?[]:void 0===(e=e[t])?[]:"function"==typeof e?r?[e.listener||e]:[e]:r?e):y(e,e.length)}ect.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:),a.init=a.prototype.setMaxListeners=a.prototype.getMaxListeners=a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){if((s=0<t.length?t[0]:s)instanceof Error)throw s;throw(n=Error("Unhandled error."+(s?" ("+s.message+")":""))).context=s,n}var s=o[e];if(void 0===s)return!1;if("function"==typeof s)i(s,this,t);else for(var a=s.length,c=y(s,a),r=0;r<a;++r)i(c[r],this,t);return!0},a.prototype.on=a.prototype.addListener=function(e,t){return f(this,e,t,!1)},a.prototype.prependListener=a.prototype.once=function(e,t){return u(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=a.prototype.off=a.prototype.removeListener=function(e,t){var r,n,i,o,s;if(u(t),void 0===(n=this._events)||void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;0<=o;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.removeAllListeners=function(e){var t,r=this._events;if(void 0===r)return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){for(var n,i=Object.keys(r),o=0;o<i.length;++o)"removeListener"!==(n=i[o])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(o=t.length-1;0<=o;o--)this.removeListener(e,t[o]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=a.listenerCount=a.prototype.listenerCount=d,a.prototype.eventNames=,function(e,t,r){(function(t){e.exports=function(){"use strict";function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,r){return e(r={path:t,exports:{},require:,r.exports),r.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self;var n=r(function(e,t){var r,n,i,o,s,a,c,u,l,f,h,p,d;e.exports=r||(n=Math,i=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),a=(s=(o={}).lib={}).Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=s.WordArray=a.extend({init:toString:function(e){return(e||l).stringify(this)},concat:clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=n.ceil(t/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,r=[],i=function(e){var t=987654321;return function(){var r=((t=36969*(65535&t)+(t>>16)&4294967295)<<16)+(e=18e3*(65535&e)+(e>>16)&4294967295)&4294967295;return r/=4294967296,(r+=.5)*(n.random()>.5?1:-1)}},o=0;o<e;o+=4){var s=i(4294967296*(t||n.random()));t=987654071*s(),r.push(4294967296*s()|0)}return new c.init(r,e)}}),l=(u=o.enc={}).Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new c.init(r,t/2)}},f=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(r,t)}},h=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},p=s.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,r=t.words,i=t.sigBytes,o=this.blockSize,s=i/(4*o),a=(s=e?n.ceil(s):n.max((0|s)-this._minBufferSize,0))*o,u=n.min(4*a,i);if(a){for(var l=0;l<a;l+=o)this._doProcessBlock(r,l);var f=r.splice(0,a);t.sigBytes-=u}return new c.init(f,u)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),s.Hasher=p.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new d.HMAC.init(e,r).finalize(t)}}}),d=o.algo={},o)}),i=r(function(e,t){var r,i,o,s,a,c,u,l,f;e.exports=(r=Math,o=(i=n.lib).WordArray,s=i.Hasher,a=n.algo,c=[],u=[],),l=[],f=a.SHA256=s.extend({_doReset:function(){this._hash=new o.init(c.slice(0))},_doProcessBlock:_doFinalize:clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),n.SHA256=s._createHelper(f),n.HmacSHA256=s._createHmacHelper(f),n.SHA256)}),o=(r(function(e,t){var r,i;e.exports=(r=n.lib.Base,i=n.enc.Utf8,void(n.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),a=o.words,c=s.words,u=0;u<r;u++)a[u]^=1549556828,c[u]^=909522486;o.sigBytes=s.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))}),r(),s={hmac:sha256:,a=["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id"],c="aws4_request",u=l=return function(){var t,r;function n(e,t,r){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,n),this.request=e,this.request.headers=e.headers||{},this.serviceName=t,r=r||{},this.signatureCache="boolean"!=typeof r.signatureCache||r.signatureCache,this.operation=r.operation,this.signatureVersion=r.signatureVersion}return t=[{key:"addAuthorization",value:,{key:"addHeaders",value:function(e,t){this.request.headers["X-Amz-Date"]=t,e.sessionToken&&(this.request.headers["x-amz-security-token"]=e.sessionToken),this.request.body&&(this.request.headers["X-Amz-Content-Sha256"]=s.sha256(JSON.stringify(this.request.body)).toString())}},{key:"authorization",value:function(e,t){var r=[],n=this.credentialString(t);return r.push("".concat("AWS4-HMAC-SHA256"," Credential=").concat(e.accessKeyId,"/").concat(n)),r.push("SignedHeaders=".concat(this.signedHeaders())),r.push("Signature=".concat(this.signature(e,t))),r.join(", ")}},{key:"signature",value:function(e,t){var r=this.getSigningKey(e,t.substr(0,8),this.request.region,this.serviceName,this.signatureCache);return s.hmac(r,this.stringToSign(t),"hex")}},{key:"stringToSign",value:,{key:"canonicalString",value:,{key:"canonicalHeaders",value:function(){var e=this,t=[];Object.keys(this.request.headers).forEach(,t.sort(;var r=[];return t.forEach(function(t){var n=t[0].toLowerCase();if(e.isSignableHeader(n)){var i=t[1];if(null==i||"function"!=typeof i.toString)throw Error("Header ".concat(n," contains invalid value"));r.push("".concat(n,":").concat(e.canonicalHeaderValues(i.toString())))}}),r.join("\n")}},{key:"canonicalHeaderValues",value:,{key:"signedHeaders",value:,{key:"credentialString",value:,{key:"hexEncodedHash",value:,{key:"hexEncodedBodyHash",value:function(){return this.request.headers["X-Amz-Content-Sha256"]?this.request.headers["X-Amz-Content-Sha256"]:this.request.body?this.hexEncodedHash(l(this.request.body)):this.hexEncodedHash("")}},{key:"isSignableHeader",value:function(e){return 0===e.toLowerCase().indexOf("x-amz-")||0>a.indexOf(e)}},{key:"iso8601",value:,{key:"getSigningKey",value:function(e,t,r,n){var i=s.hmac("AWS4".concat(e.secretAccessKey),t),o=s.hmac(i,r),a=s.hmac(o,n);return s.hmac(a,c)}},{key:"createScope",value:],e(n.prototype,t),r&&e(n,r),n}()}()}).call(this,r(7))},function(e,t,r){var n,i,o,s,a,c,u,l,f,h,p,d,y;e.exports=y||(n=Math,i=Object.create||),a=(s=(o={}).lib={}).Base={extend:create:init:function(){},mixIn:clone:,c=s.WordArray=a.extend({init:toString:concat:clamp:clone:random:function(e){for(var t,r=[],i=function(e){var e=e,t=987654321;return ,o=0;o<e;o+=4){var s=i(4294967296*(t||n.random()));t=987654071*s(),r.push(4294967296*s()|0)}return new c.init(r,e)}}),l=(u=o.enc={}).Hex={stringify:parse:,f=u.Latin1={stringify:parse:,h=u.Utf8={stringify:parse:,p=s.BufferedBlockAlgorithm=a.extend({reset:_append:_process:clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),s.Hasher=p.extend({cfg:a.extend(),init:reset:update:finalize:blockSize:16,_createHelper:_createHmacHelper:),d=o.algo={},o)},function(e,t,r){var n;e.exports=(n=r(3),function(e){var t=n.lib,r=t.WordArray,i=t.Hasher,o=n.algo,s=[],a=[];(();var c=[],u=o.SHA256=i.extend({_doReset:_doProcessBlock:_doFinalize:clone:);n.SHA256=i._createHelper(u),n.HmacSHA256=i._createHmacHelper(u)}(Math),n.SHA256)},function(e,t,r){"use strict";r.r(t),r.d(t,"default",;var t=r(0),n=r.n(t),i={debug:!1,region:"cn",initUploadFileUrl:"{tosDomain}/{oid}?uploads",uploadChunkedUrl:"{tosDomain}/{oid}?partNumber={number}&uploadID={uploadId}",uploadMergeUrl:"{tosDomain}/{oid}?uploadID={uploadId}",getUploadListUrl:"{tosDomain}/{oid}?uploadID={uploadId}",directUploadFileUrl:"{tosDomain}/{oid}",external:{},getSliceFunc:null,uploadSliceCount:3,retryUploadTime:2,retryProcess:!0,retryProcessTime:3,retryTaskTime:2,progressMonitorTime:10,progressMonitorSpeed:50,schema:"https",replace:{}},o=tion l(e){for(var t=0,r=0,n=(e+="").length,i=0;i<n;i++)(0x7fffffffffff<(t=31*t+e.charCodeAt(r++))||t<-140737488355328)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t}var f,h,p=),d=(h=+Date.now()+Number((""+Math.random()).slice(2,8)),(t={exports:{}}).exports=),t.exports),y=function(){eturn e.prototype.setItem=e.prototype.getItem=e.prototype.removeItem=e.prototype.getCookie=function(e){this.getItem(e)},e.prototype.setCookie=function(e,t){this.setItem(e,t)},e}(),g={getItem:function(e){try{var t=localStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(e){}return r||{}}catch(e){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,r)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:setCookie:isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},m={getItem:setItem:removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e){this.getItem(e)},setCookie:isSupportSession:)},v=),b=function(){eturn e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,r=document.referrer,n=r?c(r).hostname:"",i=u(window.location.href),o=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web",i=(this.utm=function(e,t,r,n){var i=new v(!1),o=new v(!1,"session"),s=e?"_tea_utm_cache_"+e:"_tea_utm_cache",a=e?"_$utm_from_url_"+e:"_$utm_from_url",c={},u=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],l={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var f,h,p=!1;for(f in l)l[f]&&(-1!==u.indexOf(f)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[f]=l[f]):c[f]=l[f],p=!0);p?(o.setItem(a,"1"),i.setCookie(s,JSON.stringify(c),n,r)):(h=i.getCookie(s,r))&&(c=JSON.parse(h)),o.getItem(a)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return l}return c}(this.appid,i,this.domain,this.cookie_expire),this.browser()),s=this.os();return{browser:i.browser,browser_version:i.browser_version,platform:o,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:r,referrer_host:n,utm:this.utm,latest_data:this.last(r,n)}},e.prototype.last=function(e,t){var r="",n="",i="",o=location.hostname,s=!1;return e&&t&&o!==t&&(n=t,s=!0,(o=u(r=e)).keyword&&(i=o.keyword)),{$latest_referrer:r,$latest_referrer_host:n,$latest_search_keyword:i,isLast:s}},e.prototype.browser=function(){var e,t="",r=""+parseFloat(this.appVersion),n=this.userAgent;return -1!==n.indexOf("Edge")||-1!==n.indexOf("Edg")?(t="Microsoft Edge",r=-1!==n.indexOf("Edge")?(e=n.indexOf("Edge"),n.substring(e+5)):(e=n.indexOf("Edg"),n.substring(e+4))):-1!==(e=n.indexOf("MSIE"))?(t="Microsoft Internet Explorer",r=n.substring(e+5)):-1!==(e=n.indexOf("Lark"))?(t="Lark",r=n.substring(e+5,e+11)):-1!==(e=n.indexOf("MetaSr"))?(t="sougoubrowser",r=n.substring(e+7,e+10)):-1!==n.indexOf("MQQBrowser")||-1!==n.indexOf("QQBrowser")?(t="qqbrowser",-1!==n.indexOf("MQQBrowser")?(e=n.indexOf("MQQBrowser"),r=n.substring(e+11,e+15)):-1!==n.indexOf("QQBrowser")&&(e=n.indexOf("QQBrowser"),r=n.substring(e+10,e+17))):-1!==n.indexOf("Chrome")?-1!==(e=n.indexOf("MicroMessenger"))?(t="weixin",r=n.substring(e+15,e+20)):-1!==(e=n.indexOf("360"))?(t="360browser",r=n.substring(n.indexOf("Chrome")+7)):-1!==n.indexOf("baidubrowser")||-1!==n.indexOf("BIDUBrowser")?(-1!==n.indexOf("baidubrowser")?(e=n.indexOf("baidubrowser"),r=n.substring(e+13,e+16)):-1!==n.indexOf("BIDUBrowser")&&(e=n.indexOf("BIDUBrowser"),r=n.substring(e+12,e+15)),t="baidubrowser"):-1!==(e=n.indexOf("xiaomi"))?r=-1!==n.indexOf("openlanguagexiaomi")?(t="openlanguage xiaomi",n.substring(e+7,e+13)):(t="xiaomi",n.substring(e-7,e-1)):-1!==(e=n.indexOf("TTWebView"))?(t="TTWebView",r=n.substring(e+10,e+23)):-1===(e=n.indexOf("Chrome"))&&-1===(e=n.indexOf("Chrome"))||(t="Chrome",r=n.substring(e+7)):-1!==n.indexOf("Safari")?-1!==(e=n.indexOf("QQ"))?(t="qqbrowser",r=n.substring(e+10,e+16)):-1!==(e=n.indexOf("Safari"))&&(t="Safari",r=n.substring(e+7),-1!==(e=n.indexOf("Version"))&&(r=n.substring(e+8))):-1!==(e=n.indexOf("Firefox"))?(t="Firefox",r=n.substring(e+8)):-1!==(e=n.indexOf("MicroMessenger"))?(t="weixin",r=n.substring(e+15,e+20)):-1!==(e=n.indexOf("QQ"))&&(t="qqbrowser",r=n.substring(e+3,e+8)),{browser:t,browser_version:r=-1!==(n=(r=-1!==(n=(r=-1!==(n=r.indexOf(";"))?r.substring(0,n):r).indexOf(" "))?r.substring(0,n):r).indexOf(")"))?r.substring(0,n):r}},e.prototype.os=function(){for(var e,t,r="",n="",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],o=0;o<i.length;o++){var s=i[o];if(s.r.test(this.userAgent)){"Mac OS X"===(r=s.s)&&this.isNewIpad()&&(r="iOS");break}}itch(/Windows/.test(r)&&(n=a(/Windows (.*)/,r),r="windows"),r){case"Mac OS X":n=c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),r="mac";break;case"Android":n=t=(t=a(/Android ([\.\_\d]+)/,e=this.userAgent))?t:a(/Android\/([\.\_\d]+)/,e),r="android";break;case"iOS":n=this.isNewIpad()?c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(n=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?n[1]+"."+n[2]+"."+(0|n[3]):"",r="ios"}return{os_name:r,os_version:n}},e.prototype.getDeviceModel=e.prototype.isNewIpad=e}(),_={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"},w="5.0.23_3",k=void 0,t=(new Date).getTimezoneOffset(),S=parseInt(""+-t/60,10),x=60*t,O=function(){function e(e){this.is_first_time=!0,this.configPersist=!1,this.initConfig=e;var t=new b(e.app_id,e.cookie_domain||"",e.cookie_expire||6048e5).init(),r="__tea_cache_first_"+e.app_id;this.configKey="__tea_cache_config_"+e.app_id,this.sessionStorage=new v(!1,"session"),this.localStorage=new v(!1,"local"),e.configPersist&&(this.configPersist=!0,this.storage=1===e.configPersist?this.sessionStorage:this.localStorage),this.localStorage.getItem(r)?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(r,"1")),this.envInfo={user:{user_unique_id:k,user_type:k,user_id:k,user_is_auth:k,user_is_login:k,device_id:k,web_id:k,ip_addr_id:k},header:{app_id:k,app_name:k,app_install_id:k,install_id:k,app_package:k,app_channel:k,app_version:k,os_name:t.os_name,os_version:t.os_version,device_model:t.device_model,ab_client:k,traffic_type:k,client_ip:k,device_brand:k,os_api:k,access:k,language:t.language,region:k,app_language:k,app_region:k,ab_version:k,creative_id:t.utm.creative_id,ad_id:t.utm.ad_id,campaign_id:t.utm.campaign_id,log_type:k,rnd:k,platform:t.platform,sdk_version:w,sdk_lib:"js",province:k,city:k,timezone:S,tz_offset:x,tz_name:k,sim_region:k,carrier:k,resolution:t.screen_width+"x"+t.screen_height,browser:t.browser,browser_version:t.browser_version,referrer:t.referrer,referrer_host:t.referrer_host,width:t.screen_width,height:t.screen_height,screen_width:t.screen_width,screen_height:t.screen_height,utm_term:t.utm.utm_term,utm_content:t.utm.utm_content,utm_source:t.utm.utm_source,utm_medium:t.utm.utm_medium,utm_campaign:t.utm.utm_campaign,tracer_data:JSON.stringify(t.utm.tracer_data),custom:{},wechat_unionid:k,wechat_openid:k}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.initDomain()}return e.prototype.initDomain=function(){var e=this.initConfig.channel_domain;e?this.domain=e:(e=this.initConfig.channel,this.domain=function(e,t){if("string"==typeof e&&"number"==typeof t){for(var r=[],n=String.fromCharCode((t=t<=25?t:t%25)+97),i=e.split(n),o=0;o<i.length;o++){var s=64^+parseInt(i[o],t),s=String.fromCharCode(s);r.push(s)}return r.join("")}}(_[e],25))},e.prototype.setDomain=function(e){this.domain=e},e.prototype.getDomain=function(){return this.domain},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.initConfig.report_url||"/list";break;case"webid":t="/webid";break;case"tobid":t="/tobid"}return e="",this.initConfig.caller&&(e="?sdk_version="+w+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+e},e.prototype.set=function(e){var t=this;Object.keys(e).forEach(function(r){var n,i,s;void 0!==e[r]&&null!==e[r]||t.delete(r),"evtParams"===r?t.evtParams=o({},t.evtParams||{},e.evtParams||{}):"_staging_flag"===r?t.evtParams=o({},t.evtParams||{},{_staging_flag:e._staging_flag}):"reportErrorCallback"===r&&"function"==typeof e[r]?t.reportErrorCallback=e[r]:(s=i="",-1<r.indexOf(".")&&(i=(n=r.split("."))[0],s=n[1]),i?"user"===i||"header"===i?t.envInfo[i][s]=e[r]:t.envInfo.header.custom[s]=e[r]:t.envInfo.user.hasOwnProperty(r)?-1<["user_type","ip_addr_id"].indexOf(r)?t.envInfo.user[r]=e[r]&&Number(e[r]):-1<["user_id","web_id","user_unique_id"].indexOf(r)?t.envInfo.user[r]=e[r]&&String(e[r]):-1<["user_is_auth","user_is_login"].indexOf(r)?t.envInfo.user[r]=!!e[r]:"device_id"===r&&(t.envInfo.user[r]=e[r]):t.envInfo.header.hasOwnProperty(r)?t.envInfo.header[r]=e[r]:t.envInfo.header.custom[r]=e[r])})},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:this.envInfo.user.hasOwnProperty(e)?this.envInfo.user[e]:this.envInfo.header.hasOwnProperty(e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){}},e.prototype.setStore=function(e){try{if(!this.configPersist)return;var t,r=this.storage.getItem(this.configKey)||{};r&&Object.keys(e).length&&(t=Object.assign(e,r),this.storage.setItem(this.configKey,t))}catch(e){}},e.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey);return e&&Object.keys(e).length?e:null}catch(e){return null}},e.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey);t&&t.hasOwnProperty(e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){}},e}(),C=function(){eturn e.prototype.info=function(e){this.isLog},e.prototype.warn=function(e){this.isLog},e.prototype.error=e.prototype.throw=function(e){throw this.error(this.name),Error(e)},e}(),T=((f=L=L||{}).Init="init",f.Config="config",f.Start="start",f.Ready="ready",f.TokenComplete="token-complete",f.TokenStorage="token-storage",f.TokenFetch="token-fetch",f.TokenError="token-error",f.ConfigUuid="config-uuid",f.ConfigWebId="config-webid",f.ConfigDomain="config-domain",f.CustomWebId="custom-webid",f.TokenChange="token-change",f.TokenReset="token-reset",f.ConfigTransform="config-transform",f.EnvTransform="env-transform",f.SessionReset="session-reset",f.SessionResetTime="session-reset-time",f.Event="event",f.Events="events",f.EventNow="event-now",f.CleanEvents="clean-events",f.BeconEvent="becon-event",f.SubmitBefore="submit-before",f.SubmitScuess="submit-scuess",f.SubmitAfter="submit-after",f.SubmitError="submit-error",f.SubmitVerify="submit-verify",f.Stay="stay",f.ResetStay="reset-stay",f.StayReady="stay-ready",f.SetStay="set-stay",f.RouteChange="route-change",f.RouteReady="route-ready",f.Ab="ab",f.AbVar="ab-var",f.AbAllVars="ab-all-vars",f.AbConfig="ab-config",f.AbExternalVersion="ab-external-version",f.AbVersionChangeOn="ab-version-change-on",f.AbVersionChangeOff="ab-version-change-off",f.AbOpenLayer="ab-open-layer",f.AbCloseLayer="ab-close-layer",f.AbReady="ab-ready",f.AbComplete="ab-complete",f.Profile="profile",f.ProfileSet="profile-set",f.ProfileSetOnce="profile-set-once",f.ProfileUnset="profile-unset",f.ProfileIncrement="profile-increment",f.ProfileAppend="profile-append",f.ProfileClear="profile-clear",f.Autotrack="autotrack",f.AutotrackReady="autotrack-ready",f.CepReady="cep-ready",f.TracerReady="tracer-ready",L),I=function(){ar t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&!!AppLogBridge}catch(e){return!1}},t.bridgeReady=function(){var e=this;return new Promise(function(t,r){try{e.bridgeInject()?AppLogBridge.hasStarted(:r(!1)}catch(e){r(!1)}})},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach(}catch(e){}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){}},t.setHeaderInfo=t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){}},t.reportPv=t.onEventV3=t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){}},t.profileAppend=e}(),j={XHR_ON:500,TIMEOUT:5005};function P(e,t,r,n,i,o,s,a){try{var c=new XMLHttpRequest;c.open(a||"POST",""+e,!0),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),s&&c.setRequestHeader("X-MCS-AppKey",""+s),n&&(c.withCredentials=!0),c.onload=r&&(c.timeout=r,c.ontimeout=,c.onerror=c.send(JSON.stringify(t))}catch(e){}}function D(e,t,r,n){try{var i=e.match(/\/v\d\//),o=i?i[0]:-1!==e.indexOf("/v1/")?"/v1/":"/v2/",s=e.split(o)[0];if(!s)return void n(e,t,B);t.forEach(function(i){var i=function(e){var t,r="";for(t in e)e.hasOwnProperty(t)&&void 0!==e[t]&&(r+="&"+t+"="+encodeURIComponent(JSON.stringify(e[t])));return"&"===r[0]?r.slice(1):r}(i),o=new Image(1,1);o.onload=o.onerror=function(){o=null,n&&n(e,t,z)},o.src=s+"/gif?"+i})}catch(r){n&&n(e,t,F,r.message)}}function A(e,t,r,n,i,o,s){var a=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===a.indexOf("MSIE 8.0")&&-1===a.indexOf("MSIE 9.0")){if(s)return window.navigator&&window.navigator.sendBeacon?window.navigator.sendBeacon(e,JSON.stringify(t))?i():o(e,t,4003):D(e,t,i,o)}else D(e,t,i,o);P(e,t,r,n,i,o)}function E(){return(().replace(/-/g,"").slice(0,19)}ar B=4001,z=4e3,F=4002,R=function(){eturn e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.cacheStorgae=new v(!0),this.localStorage=new v(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.collect.on(T.Ready,function(){r.reportAll(!1)}),this.collect.on(T.ConfigDomain,,this.collect.on(T.Event,function(e){r.event(e)}),this.collect.on(T.BeconEvent,function(e){r.beconEvent(e)}),this.collect.on(T.CleanEvents,function(){r.reportAll(!1)}),this.linster()},e.prototype.linster=e.prototype.reportAll=e.prototype.event=function(e){var t=this;try{var r,n=s(e,this.cacheStorgae.getItem(this.eventKey)||[]);this.cacheStorgae.setItem(this.eventKey,n),this.reportTimeout&&clearTimeout(this.reportTimeout),n.length>=this.maxReport?this.report(!1):(r=this.reportTime,this.reportTimeout=setTimeout(r))}catch(e){}},e.prototype.beconEvent=e.prototype.reportBecon=e.prototype.report=e.prototype.sliceEvent=e.prototype.merge=function(e){var t=this,r=this.configManager.get(),n=r.header,i=r.user,s=(n.custom=JSON.stringify(n.custom),this.configManager.get("evtParams")),r=e.map(function(e){Object.keys(s).length&&(e.params=o({},s,e.params));var r=t.localStorage.getItem(t.abKey);return r&&r.uuid&&r.uuid===i.user_unique_id&&t.configManager.getAbVersion()&&(e.ab_sdk_version=t.configManager.getAbVersion()),e.session_id=t.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}),e=JSON.parse(JSON.stringify({events:r,user:i,header:n})),r=(e.local_time=Math.floor(Date.now()/1e3),e.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,[]);return r.push(e),r},e.prototype.split=e.prototype.send=function(e,t){var r=this;e.length&&e.forEach(function(e){try{var n=JSON.parse(JSON.stringify(e)),i=(r.config.filter&&(n=r.config.filter(n)),r.collect.eventFilter&&n&&(n=r.collect.eventFilter(n)),n||e);r.collect.emit(T.SubmitBefore,i),r.collect.emit(T.SubmitVerify,i),A(r.reportUrl,i,r.timeout,r.enable_ttwebid,function(e,t){e&&0!==e.e?r.collect.emit(T.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}):r.collect.emit(T.SubmitScuess,{eventData:t,res:e})},function(e,t){r.configManager.get("reportErrorCallback")(e,t),r.collect.emit(T.SubmitError,{type:"f_net",eventData:e,errorCode:t})},t),r.collect.emit(T.SubmitAfter,i)}catch(e){}})},e}(),M=function(){eturn e.prototype.apply=e.prototype.checkStorage=function(){var e,t=this;this.enableCookie?(e=this.storage.getCookie(this.tokenKey,this.cookieDomain),this.cacheToken=e&&"string"==typeof e?JSON.parse(e):{}):this.cacheToken=this.storage.getItem(this.tokenKey)||{},this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(T.CustomWebId,:this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=e.prototype.checkEnv=function(){var e,t;return -1!==window.navigator.userAgent.indexOf("miniProgram")&&!(!(e=u(window.location.href))||!e.Web_ID)&&(t=this.configManager.get("user_unique_id"),this.complete({web_id:""+e.Web_ID,env_uuid:t}),!0)},e.prototype.remoteWebid=function(){var e=this;P(this.configManager.getUrl("webid"),{app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""},3e3,!1,function(t){t&&0===t.e?e.complete({web_id:e.configManager.get("web_id")||t.web_id,user_unique_id:e.configManager.get("user_unique_id")||t.web_id}):e.collect.emit(T.TokenError)},},e.prototype.complete=e.prototype.completeTtWid=e.prototype.setUuid=function(e){var t,r;e?(e=String(e),t=this.configManager.get("user_unique_id"),r=this.cacheToken&&this.cacheToken.user_unique_id,e===t&&e===r||(this.configManager.set({user_unique_id:e}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=e,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(T.TokenChange,"uuid"),this.collect.emit(T.SessionReset))):this.clearUuid()},e.prototype.clearUuid=e.prototype.setWebId=e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=e.prototype.getTobId=function(){var e=this,t=this.configManager.getUrl("tobid");return new Promise(function(r){P(t,{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id")},3e4,e.enable_ttwebid,function(){r("")})})},e}(),H=function(){function e(){}return e.prototype.apply=e.prototype.updateSessionIdTime=e.prototype.setSessionId=e.prototype.getSessionId=e.prototype.resetExpTime=e.prototype.resetSessionId=e.prototype.checkEXp=e}(),N={autotrack:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/route.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},cep:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/cep.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/cep.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/cep.js"},object:"LogCep"},tracer:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"}},t=function(){function e(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.sdkReady=!1,this.adapters={},this.name=e,this.hook=new p,this.logger=new C(e),this.remotePlugin=new Map,this.Types=T,this.adapters.fetch=P,this.adapters.storage=v}return e.usePlugin=e.prototype.usePlugin=e.prototype.init=function(t){var r,n=this;this.inited||t&&a(t)&&t.app_id&&"number"==typeof(r=t.app_id)&&!isNaN(r)&&(t.app_key&&"string"!=typeof t.app_key||(t.channel_domain||-1!==["cn","sg","va"].indexOf(t.channel)||(t.channel="cn"),this.appBridge=new I(t.Native),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new O(t),this.initConfig=t,this.bridgeReport||(this.configManager.set({app_id:t.app_id}),this.eventManager=new R,this.tokenManager=new M,this.sessionManager=new H,Promise.all([new Promise(function(e){n.once(T.TokenComplete,function(){e(!0)})}),new Promise(]).then(function(){try{e.plugins.reduce(n.pluginInstances)}catch(e){}n.sdkReady=!0,n.emit(T.Ready);try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){}t.disable_auto_pv||n.pageView(),n.on(T.TokenChange,,n.on(T.TokenReset,function(){}),n.on(T.RouteChange,}),this.tokenManager.apply(this,t),this.eventManager.apply(this,t),this.sessionManager.apply(this,t),this.emit(T.Init)),this.inited=!0))},e.prototype.config=function(e){var t,r;this.inited?e&&a(e)?this.bridgeReport?this.appBridge.setConfig(e):(e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv),t=o({},e),this.initConfig&&this.initConfig.configPersist&&((r=this.configManager.getStore())&&(t=Object.assign(r,e)),this.configManager.setStore(e)),t.web_id,t.user_unique_id,r=function(e,t){var r={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)0>t.indexOf(i[n])&&(r[i[n]]=e[i[n]]);return r}(t,["web_id","user_unique_id"]),t.hasOwnProperty("web_id")&&this.emit(T.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(T.ConfigUuid,t.user_unique_id),this.configManager.set(r)):this.logger.warn("config params is error, please check"):this.logger.warn("config must be use after function init")},e.prototype.setDomain=e.prototype.getConfig=function(e){return this.configManager.get(e)},e.prototype.send=e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(T.Start))},e.prototype.event=function(e,t){var r=this;try{if(this.initConfig&&this.initConfig.disable_track_event)return;var n=[];Array.isArray(e)?e.forEach(:n.push(this.processEvent(e,t)),this.bridgeReport?n.forEach(:n.length&&(this.emit(T.Event,n),this.emit(T.SessionResetTime))}catch(e){}},e.prototype.beconEvent=function(e,t){var r;this.initConfig&&this.initConfig.disable_track_event||Array.isArray(e)||((r=[]).push(this.processEvent(e,t||{})),r.length&&(this.emit(T.BeconEvent,r),this.emit(T.SessionResetTime)))},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{var r=e,n=(/^event\./.test(e)&&(r=e.slice(6)),t),i=void((n="object"!=typeof n?{}:n).profile?delete n.profile:n.event_index=h+=1);return n.local_ms?(i=n.local_ms,delete n.local_ms):i=+new Date,{event:r,params:n,local_time_ms:i,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(r){return{event:e,params:t}}},e.prototype.filterEvent=e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=e.prototype.set=function(e){this.hook.set(e)},e.prototype.pageView=e.prototype.predefinePageView=e.prototype.clearEventCache=e.prototype.setWebIDviaUnionID=function(e){var t;e&&(t=l(e),this.config({web_id:""+t,wechat_unionid:e}),this.emit(T.CustomWebId))},e.prototype.setWebIDviaOpenID=function(e){var t;e&&(t=l(e),this.config({web_id:""+t,wechat_openid:e}),this.emit(T.CustomWebId))},e.prototype.resetStayDuration=function(e,t,r){this.emit(T.ResetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:r=void 0===r?"":r},T.Stay)},e.prototype.resetStayParams=e.prototype.getToken=function(e,t){function r(t){var r;s||(s=!0,r=i.configManager.get().user,t&&(r.tobid=t,r["diss".split("").reverse().join("")]=t),e(o({},r)))}function n(){i.tokenManager.getTobId().then(}var i=this,s=!1;this.sdkReady?n():(t&&setTimeout(function(){r()},t),this.on(T.Ready,)},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(T.ProfileSet,e,T.Profile)},e.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(T.ProfileSetOnce,e,T.Profile)},e.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(T.ProfileIncrement,e,T.Profile)},e.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(T.ProfileUnset,e,T.Profile)},e.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(T.ProfileAppend,e,T.Profile)},e.prototype.setExternalAbVersion=e.prototype.getVar=e.prototype.getABconfig=e.prototype.getAbSdkVersion=e.prototype.onAbSdkVersionChange=e.prototype.offAbSdkVersionChange=function(e){this.emit(T.AbVersionChangeOff,e,T.Ab)},e.prototype.openOverlayer=function(){this.emit(T.AbOpenLayer,"",T.Ab)},e.prototype.closeOverlayer=e.prototype.getAllVars=e.prototype.autoInitializationRangers=function(e){var t=e.app_id,r=e.channel,n=e.onTokenReady,e=_[r]+"/webid",i=new v(!1),o="__tea_cache_tokens_"+t;(r=i.getItem(o))&&r.web_id?n(r.web_id):A(e,{app_key:"",app_id:t,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,function(e){e&&0===e.e?(n(e.web_id),e={web_id:e.web_id,user_unique_id:e.web_id,timestamp:Date.now()},i.setItem(o,e)):n("")},!0)},e.prototype.destoryInstace=e.plugins=[],e}(),L=function(){function e(){}return e.prototype.apply=function(e,t){var r=this,n=e.adapters.fetch;t.event_verify_url&&"string"==typeof t.event_verify_url&&(this.url=t.event_verify_url+"/v1/list_test",this.url&&(t=e.Types,e.on(t.SubmitBefore,))},e}(),q=function(){function e(){}return e.prototype.apply=function(e,t){var r=this,t=(this.collect=e,this.config=t,this.duration=6e4,this.reportUrl=e.configManager.getDomain()+"/profile/list",e.Types),e=e.adapters.fetch;this.fetch=e,this.cache={},this.collect.on(t.ProfileSet,function(e){r.setProfile(e)}),this.collect.on(t.ProfileSetOnce,function(e){r.setOnceProfile(e)}),this.collect.on(t.ProfileUnset,function(e){r.unsetProfile(e)}),this.collect.on(t.ProfileIncrement,function(e){r.incrementProfile(e)}),this.collect.on(t.ProfileAppend,function(e){r.appendProfile(e)}),this.collect.on(t.ProfileClear,,this.ready(t.Profile)},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var r=this.collect.hook._hooksCache[e];if(Object.keys(r).length)for(var n in r)!n)}},e.prototype.report=function(e,t){void 0===t&&(t={});try{if(this.config.disable_track_event)return;var r=[],n=(r.push(this.collect.processEvent(e,t)),this.collect.eventManager.merge(r));this.fetch(this.reportUrl,n)}catch(e){}},e.prototype.setProfile=function(e){(e=this.formatParams(e))&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set",o({},e,{profile:!0})))},e.prototype.setOnceProfile=function(e){(e=this.formatParams(e,!0))&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set_once",o({},e,{profile:!0})))},e.prototype.incrementProfile=function(e){e&&this.report("__profile_increment",o({},e,{profile:!0}))},e.prototype.unsetProfile=function(e){var t;e&&((t={})[e]="1",this.report("__profile_unset",o({},t,{profile:!0})))},e.prototype.appendProfile=function(e){if(e){var t,r={};for(t in e)("string"==typeof e[t]||"Array"===Object.prototype.toString.call(e[t]).slice(8,-1))&&(r[t]=e[t]);Object.keys(r).length&&this.report("__profile_append",o({},r,{profile:!0}))}},e.prototype.pushCache=e.prototype.formatParams=function(e,t){var r=this;void 0===t&&(t=!1);try{if(!e||"[object Object]"!==Object.prototype.toString.call(e))return;var n,i={};for(n in e)("string"==typeof e[n]||"number"==typeof e[n]||"Array"===Object.prototype.toString.call(e[n]).slice(8,-1))&&(i[n]=e[n]);var o=Object.keys(i);if(!o.length)return;var s=Date.now();return o.filter(.reduce({})}catch(e){}},e.prototype.compare=e.prototype.clone=e.prototype.unReady=function(){},e}(),K=function(){function e(){var e=this;this.setInterval=function(){var t,r,n,i;e.clearIntervalFunc=(t=function(){e.isSessionhasEvent&&e.endCurrentSession()},r=e.sessionInterval,void 0===t&&(t=function(){}),void 0===r&&(r=1e3),n=Date.now()+r,i=window.setTimeout(r),},this.clearInterval=return e.prototype.apply=e.prototype.endCurrentSession=e.prototype.process=e}(),W=function(){function e(){}return e.prototype.apply=function(e,t){var r,n=this;this.collect=e,this.config=t,this.config.channel_domain||(r=e.adapters.fetch,this.fetch=r,t.disable_track_event||t.disable_sdk_monitor||(this.url=e.configManager.getUrl("event"),r=this.collect.Types,this.collect.on(r.Ready,,this.collect.on(r.SubmitError,))},e.prototype.sdkOnload=e.prototype.sdkError=function(e,t){var r=this;try{var n=e[0],i=n.user,o=n.header,s=[],a=(e.forEach(,{events:s.map(,user:{user_unique_id:i.user_unique_id},header:{}});setTimeout(16)}catch(e){}},e}(),V=function(){eturn e.prototype.apply=function(e,t){var r=this,t=(this.collector=e,this.config=t,e.adapters.storage);this.cacheStorgae=new t(!1,"session"),this.eventStorage=[],this.collector.on("submit-verify",,this.checkCache()},e.prototype.checkCache=function(){var e=this,t=(this.verifyCookieKey="__applog_verify_set_"+this.config.app_id,this.cacheStorgae.getCookie(this.verifyCookieKey),this.cacheStorgae.getItem(this.verifyCookieKey)),r=(this.sign=t&&t.sign||"",this.origin=t&&t.origin||"*",setTimeout(function(){e.cleanVerify(),clearTimeout(r),e.collector.off("submit-verify")},this.waitTime));window.addEventListener("message",function(t){t&&t.data&&"simulator:verify"===t.data.type&&(clearTimeout(r),e.receMessage(t))},!0)},e.prototype.receMessage=function(e){var t;this.cleanStatus||(t=e.data,this.verifyReady=!0,this.sign=t.sign,this.origin=e.origin,this.cacheStorgae.setItem(this.verifyCookieKey,JSON.stringify({sign:t.sign,origin:e.origin})),this.eventStorage.length&&this.postVerify(this.eventStorage,t.sign,e.origin))},e.prototype.eventStore=function(e){this.cleanStatus||(this.verifyReady?this.postVerify(e,this.sign,this.origin):this.eventStorage.push(e))},e.prototype.cleanVerify=e.prototype.postVerify=function(e,t,r){try{var n=[],i=(Array.isArray(e)?e.forEach(function(e){n.push(e)}):n.push(e),{type:"simulator:verify:event",sign:t,pageUrl:window.location.href,events:n});(window.opener||window.parent).postMessage(i,r)}catch(e){}},e}(),J="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null,G=function(){eturn e.prototype.apply=e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach(function(t,r){var n,i;"sdk"===t?N.hasOwnProperty(r)&&(n=N[r].object,i=N[r].src[e.channel]+"?query="+Date.now(),e.exist(r,n,i)):"object"==typeof t&&(t.src?e.exist(r,t.call,t.src):e.process(r,t.instance,"INSTANCE"))})}catch(e){}},e.prototype.exist=function(e,t,r){var n=this;J[t]?this.process(e,J[t]):this.loadPlugin(e,r,function(){})},e.prototype.process=function(e,t,r){try{var n;r?(n=new t).apply&&n.apply(this.collect,this.config):t&&t(this.collect,this.config)}catch(e){}},e.prototype.loadPlugin=function(e,t,r,n){var i=this;try{var o=document.createElement("script");o.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(r),o.onerror=o.onload=document.getElementsByTagName("head")[0].appendChild(o)}catch(e){}},e}(),G=(t.usePlugin(G,"extend"),t.usePlugin(V,"verify"),t.usePlugin(L,"et"),t.usePlugin(q,"profile"),t.usePlugin(K,"heartbeat"),t.usePlugin(W,"monitor"),new t("default")),Q=G,X={browserError:1e3,crc32:1e3,preUpload:1001,initUploadID:1002,process:1003,fileMerge:1004,complete:1005},$="video",Z="image",Y="object",ee={video:"video_upload",image:"image_upload",object:"object_upload"},et="imagex",er={cn:"cn-north-1",us:"us-east-1",sg:"ap-singapore-1","cn-north-1":"cn-north-1","us-east-1":"us-east-1","ap-singapore-1":"ap-singapore-1",boe:"boe",boei18n:"boei18n","US-TTP":"US-TTP"},en={"cn-north-1":"https://vod.bytedanceapi.com","us-east-1":"https://vod.us-east-1.bytedanceapi.com","ap-singapore-1":"https://vod.ap-singapore-1.bytedanceapi.com"},ei={"cn-north-1":"https://open.bytedanceapi.com","us-east-1":"https://open.us-east-1.bytedanceapi.com","ap-singapore-1":"https://open.ap-singapore-1.bytedanceapi.com"},eo={"cn-north-1":"https://imagex.bytedanceapi.com","us-east-1":"https://imagex.us-east-1.bytedanceapi.com","ap-singapore-1":"https://imagex.ap-singapore-1.bytedanceapi.com"},es={"cn-north-1":"https://open.bytedanceapi.com","us-east-1":"https://imagex-us-east-1.bytevcloudapi.com","ap-singapore-1":"https://imagex-ap-singapore-1.bytevcloudapi.com"};function ea(){return(ea=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ec(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var eu=function(){var e,t;function r(e,t){switch(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),this.options=e,this.context=t,this.teaLog=Q,this.tea_app_id=2562,this.tea_channel="cn",this.options.region){case"us":case"us-east-1":case"gcp":case"US-TTP":this.tea_app_id=2643,this.tea_channel="va";break;case"sg":case"ap-singapore-1":this.tea_app_id=2643,this.tea_channel="sg";break;default:this.tea_app_id=2562,this.tea_channel="cn"}this.teaLog.init({app_id:this.tea_app_id,channel:this.tea_channel,log:!1,disable_sdk_monitor:!0,disable_auto_pv:!0}),this.teaLog.config({evtParams:{sdk_version:"1.1.10",line_app_id:this.options.appId},user_unique_id:this.options.userId}),this.teaLog.start()}return e=[{key:"send",value:function(e){var t=this.context,r=e.key,t=t.tasks[r],n=X[e.stage]||999,t=e.fileType||t.fileType,i=e.fileSize||0,o={log_type:ee[t],stage:n,fk:r,fs:i,req:e.req,res:e.res,ts:Math.round(Date.now()/1e3),sst:e.stageStartTime,set:e.stageEndTime,dur:e.duration,tdur:e.totalDuration,durs:e.duration/1e3,tdurs:e.totalDuration/1e3},r=e.type,r="error"===r||"retry"===r?r:n,s="".concat("image"===t?"image":"video","_")+r;switch(n){case 1e3:this.teaLog.event(s,ea({},o,{type:e.type,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,crc32Array:e.crc32Array,isDirect:e.isDirect})}));break;case 1001:this.teaLog.event(s,ea({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,err:e.extra&&e.extra.error,msg:e.extra&&e.extra.message,sig:e.signature,stk:e.proxyStsToken})}));break;case 1002:this.teaLog.event(s,ea({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,upid:e.uploadID})}));break;case 1003:e.isAllFinish||e.isDirect||(delete o.sst,delete o.set,delete o.dur),this.teaLog.event(s,ea({},o,{type:e.type,oid:e.oid,errc:e.extra&&e.extra.errorCode,upload_host:e.tosDomain,af:e.isAllFinish,cst:e.crc32StartTime,cet:e.crc32EndTime,cdur:e.crc32Duration,slst:e.sliceStartTime,slet:e.sliceEndTime,sldurs:e.sliceDuration&&e.sliceDuration/1e3,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,si:e.sliceIndex,af:e.isAllFinish})}));break;case 1004:default:this.teaLog.event(s,ea({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message})}));break;case 1005:this.teaLog.event(s,ea({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,speed:Math.round(i/(e.totalDuration/1e3)/1024),ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,err:e.extra&&e.extra.error,msg:e.extra&&e.extra.message,vid:e.uploadResult&&e.uploadResult.Vid})}))}}},{key:"console",value:}],ec(r.prototype,e),t&&ec(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}(),V=r(5),el=r.n(V),L=r(4),ef=r.n(L),eh={urlTemplate:function(e,t){var r;return Object.keys(t=t||{}).forEach(function(n){r=RegExp("{".concat(n,"}"),"g"),e=e.replace(r,t[n])}),e},toQueryString:supportChunked:supportXhr:supportCrc32:function(){var e=window.FileReader&&window.FileReader.prototype.readAsBinaryString;return"undefined"!=typeof Int32Array&&e&&(blob.slice||blob.webkitSlice||blob.mozSlice)},storage:function(e){var t=e,e={removeItem:setItem:getItem:clear:;try{if(window.localStorage)return window.localStorage.setItem("",""),window.localStorage}catch(e){}return e},noop:function(){},getUnique:getFileSliceLength:function(e,t){var r=e.size;return t&&"function"==typeof t?2097152>t(r)?2097152:t(r)||r:209715200<r?10485760:r<=209715200&&2097152<=r?5242880:e.size},getFileSuffix:fileSlice:getPathByURL:crypto:{hmac:sha256:,date:{iso8601:,Buffer:Uint8Array,generateKey:,ep={crc32:dec2hex:;function ed(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ey=function(){var e,t;function r(e,t,n,i){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,r),this.file=e,this.successProcess=n,this.failProcess=i,this.sliceLength=t,this.retryTime=0,this.fileSize=e.size,this.crc32Array=[]}return e=[{key:"start",value:,{key:"readFileCrc32",value:function(e){var t=this,r=this.sliceLength,n=e.slice||e.webkitSlice||e.mozSlice,i=new FileReader,o=0,s=0,a=0;(function c(){s<e.size&&(s=Math.min(o+r,e.size),104857600<e.size&&e.size-s<=5242880&&(s=e.size)),i.readAsArrayBuffer(n.call(e,o,s)),i.onload=function(r){r=r.target.result,a=ep.crc32(r,0),t.crc32Array.push({start:o,end:s,crc32:ep.dec2hex(a),buffer:r}),(o=s)<e.size?c():t.success(t.crc32Array)}})()}},{key:"success",value:,{key:"fail",value:],ed(r.prototype,e),t&&ed(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}(),eg="The format of stsToken is incorrect.";function em(){return(em=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ev(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function eb(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var e_=function(){var e,t;function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,r),this.context=e.context,this.key=e.key,this.isDirect=e.isDirect,this.isImageBatchUpload=e.isImageBatchUpload,this.file=e.file,this.type=(this.isImageBatchUpload?this.file[0]:this.file).type||"",this.sliceLength=eh.getFileSliceLength(this.file,t.getSliceFunc),this.config=t}return e=[{key:"start",value:,{key:"crc32",value:function(e,t){var r=this;this.isImageBatchUpload?function(){for(var t=e.length,n=[],i=0;i<t;i++)new ey(e[i],e[i].size,function(e){n.push(e[0]),n.length===t&&r.success(n)},function(e){r.fail(e)}).start()}():e&&e.size&&!(e.size<=0)?this.isDirect?new ey(e,e.size,function(e){r.success(e)},function(e){r.fail({errorCode:1000003,message:"get crc32 error: ".concat(e&&e.message)})}).start():this.sliceFile(e,t,function(e){r.success(e)},function(e){r.fail(e)}):this.fail({errorCode:1000003,message:"There is a problem with the input file or fileSize."})}},{key:"sliceFile",value:function(e,t,r,n){for(var i=[],o=e.size,s=e.slice||e.webkitSlice||e.mozSlice,a=0,c=0,u=0;c<o;)c=Math.min(a+t,o),i.push({start:a,end:c=104857600<o&&o-c<=5242880?o:c,crc32:0}),a=c;try{!function t(a){var c=new FileReader,l=i[a].start,f=i[a].end;c.readAsArrayBuffer(s.call(e,l,f)),c.onload=function(e){e=e.target.result,u=ep.dec2hex(ep.crc32(e,0)),i[a].crc32=u,f===o?r(i):t(i.length-1)},c.onerror=function(e){var t=e.target.error.name,e=e.target.error.message;n({crc32Array:i,errorCode:1000003,message:t+": "+e})}}(0)}catch(e){n({message:e&&e.toString()})}}},{key:"getCrc32Key",value:function(e,t){var r;return(t="[object Array]"===Object.prototype.toString.call(t)?r=t)||r)||function(e,t){if(e){if("string"==typeof e)return ev(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ev(e,t):void 0}}(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}():[t]).push(e[0].crc32,e[e.length-1].crc32),t.join("_")}},{key:"success",value:function(e){var t=this.context,r=this.key,n=[],i=[];if(this.isImageBatchUpload)for(var o=0;o<this.file.length;o++)n.push(this.file[o].size),i.push(this.file[o].name);else n=this.file.size,i=this.file.name;var s=this.getCrc32Key(e,n),t=t.tasks[r];t&&this.successProcess(em(t,{key:r,crc32Array:e,crc32Key:s,sdkVersion:"1.1.10",sliceLength:this.sliceLength,extra:{message:"get crc32 success"},stage:"crc32",type:"success",fileSize:n,fileName:i,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st,isDirect:this.isDirect,isImageBatchUpload:this.isImageBatchUpload}))}},{key:"fail",value:function(e){var t=this.context,r=this.key,n=e&&e.message?e.message:"get crc32 error",i=e&&e.errorCode,e=e&&e.crc32Array,t=em(t.tasks[r],{crc32Array:e,extra:{message:n,errorCode:i},type:"error",stage:"crc32",stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st});this.failProcess(t)}}],eb(r.prototype,e),t&&eb(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}();function ew(e){return(ew="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ek(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function eS(e,t){return(eS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function ex(e){return(ex=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var eO=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eS(e,t)}(o,n.a);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=ex(o);return function(e,t){if(t&&("object"===ew(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=ex(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(){var e;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this)).xhr=new XMLHttpRequest,e._data=null,e}return t=[{key:"_ajax",value:,{key:"send",value:,{key:"sendAsBinary",value:,{key:"sendAsFormData",value:,{key:"sendAsCustom",value:,{key:"abort",value:,{key:"getResponse",value:function(){return this.xhr.response}},{key:"getText",value:,{key:"getJson",value:],ek(o.prototype,t),r&&ek(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}(),q=r(1),eC=r.n(q),eT={checkFile:function(){},checkStsToken:checkServiceName:function(e,t){if(e===$)return"vod";if(e===Z)return et;if(e===Y){if(t.objectConfig&&t.objectConfig.spaceName)return"vod";if(t.objectConfig&&t.objectConfig.serviceId)return et;if(t.videoConfig&&t.videoConfig.spaceName)return"vod";if(t.imageConfig&&t.imageConfig.serviceId)return et}return"vod"}};function eI(e){return(eI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ej(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function eP(){return(eP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function eD(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function eA(e,t){return(eA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function eE(e){return(eE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var eU=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eA(e,t)}(o,n.a);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=eE(o);return function(e,t){if(t&&("object"===eI(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=eE(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).options=e,r.config=t,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.systemTimeGap=0,r.retryTime=t.retryTaskTime||2,r.hasRetryTime=0,r.isImageBatchUpload=!!r.options.isImageBatchUpload,r.isDirect=r.options.isDirect,r}return t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this._st=Date.now(),t=(r=this.uploaderCtx._getCache(this.currFileCtx.crc32Key))?JSON.parse(r):{},!this.isDirect&&t.oid&&(t.uploadID||t.UploadID)?this.resumeFromCache(t):this.startPreUpload()}},{key:"startPreUpload",value:function(){var e=this,t=er[this.config.region],r=new eO,n=(r.on("complete",function(t){if(t.response)try{var r,n,i,o,s,a,c,u,l,f,h,p,d=JSON.parse(t.response);d.ResponseMetadata.Error?e.fail({xhr:t,errorCode:d.ResponseMetadata.Error.CodeN,error:d.ResponseMetadata.Error.Code,message:d.ResponseMetadata.Error.Message}):(r=eT.checkServiceName(e.options.type,e.config),n=d.Result,o=(i=r===et?n.UploadAddress:n.InnerUploadAddress.UploadNodes[0]).StoreInfos,s=i.UploadHosts,a=i.SessionKey,u=void 0===(c=i.UploadHeader)?{}:c,l=r===et?s[0]:i.UploadHost,f=[],h=[],e.isImageBatchUpload&&1<o.length?o.forEach(:(f=o[0].Auth,h=o[0].StoreUri),p=eP(e.currFileCtx,{key:e.options.key,useBackupDomain:e.uploaderCtx.useBackupDomain,signature:f,type:"success",extra:{message:"prepare upload success"},stage:"preUpload",oid:h,systemTimeGap:e.systemTimeGap,tosDomain:"".concat(e.config.schema,"://").concat(l),xhr:t,UploadHeader:u,SessionKey:a,UploadID:o[0].UploadID,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration}),e.successProcess&&e.successProcess(p))}catch(r){e.fail({error:"catch error: ".concat(r.toString()),xhr:t})}else e.fail({error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t})}),r.on("error",function(t){var r;e.uploaderCtx.useBackupDomain?(r={error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t},t.response&&(t=JSON.parse(t.response)).ResponseMetadata&&t.ResponseMetadata.Error&&(r.errorCode=t.ResponseMetadata.Error.CodeN,r.error=t.ResponseMetadata.Error.Code,r.message=t.ResponseMetadata.Error.Message),e.fail(r)):(e.hasRetryTime<e.retryTime-1?e.hasRetryTime++:e.uploaderCtx.useBackupDomain=!0,e.startPreUpload())}),""),i={},o=this.uploaderCtx.useBackupDomain,s=eT.checkServiceName(this.options.type,this.config),o=(s===et&&(n=this.config.imageHost||(o?es:eo)[t],i={Action:"ApplyImageUpload",Version:"2018-08-01"},this.options.type===Z&&(this.config.imageConfig&&this.config.imageConfig.serviceId?i.ServiceId=this.config.imageConfig.serviceId:i.SpaceName=this.config.videoConfig&&this.config.videoConfig.spaceName),this.options.type===Y&&(i.ServiceId=this.config.objectConfig&&this.config.objectConfig.serviceId||this.config.imageConfig&&this.config.imageConfig.serviceId),this.currFileCtx.fileSize&&1<this.currFileCtx.fileSize.length&&(i.UploadNum=this.currFileCtx.fileSize.length),this.options.storeKey&&(a=this.options.storeKey,"[object Array]"===Object.prototype.toString.call(a)?i.StoreKeys=a:"[object String]"===Object.prototype.toString.call(a)&&(i.StoreKeys=[a]))),"vod"===s&&(a=this.config.videoConfig&&this.config.videoConfig.spaceName,this.options.type===Y&&this.config.objectConfig&&this.config.objectConfig.spaceName&&(a=this.config.objectConfig.spaceName),n=this.config.videoHost||(o?ei:en)[t],i={Action:"ApplyUploadInner",Version:"2020-11-19",SpaceName:a,FileType:this.options.type,IsInner:1},this.currFileCtx.fileSize&&(i.FileSize=this.currFileCtx.fileSize),this.config.enOID&&(i.EnOID=1),this.config.testHost&&(i.TestHost=this.config.testHost)),this.config.useFileExtension&&this.currFileCtx.fileName&&(this.options.type===Y||this.options.type===Z)&&(o=this.currFileCtx.fileName,(a=eh.getFileSuffix(o))&&(i.FileExtension=a)),this.config.accountId&&(i["X-Account-Id"]=this.config.accountId),(this.options.type===Z||this.options.type===Y)&&this.config.bizType&&(i.BizType=this.config.bizType,i.AppID=this.config.appId,i.UserID=this.config.userId),this.config.openExperiment&&(i.app_id=this.config.appId,i.user_id=this.config.userId),i.s=Math.random().toString(36).substr(2),this.options.fileSize&&(i.fileSize=this.options.fileSize),this.currFileCtx.proxyStsToken||this.config.stsToken),a=eh.toQueryString(i),c=o.AccessKeyID,u=o.AccessKeyId,l=o.SecretAccessKey,f=o.SessionToken,o=o.CurrentTime,a={method:"GET",url:"".concat(n,"?").concat(a),timeout:this.config.gatewayTimeout||3e4,region:t,params:i,pathname:eh.getPathByURL(n)},t=new eC.a(a,s),i=(this.config.useServerCurrentTime&&6e4<Math.abs(new Date(o)-new Date)&&(this.systemTimeGap=new Date(o)-new Date),this.systemTimeGap?new Date((new Date).getTime()+this.systemTimeGap):new Date);t.addAuthorization({accessKeyId:u||c,secretAccessKey:l,sessionToken:f},i),r.send(a)}},{key:"resumeFromCache",value:function(e){var t=this,r=this.options.key,n=new eO,i=(n.on("complete",function(n){try{var i,o,s,a=JSON.parse(n.response);0===a.success&&0<a.payload.partList.length?(i=t.confirmCache(a.payload.partList),o=e.hasMerge?5:i.isAllFinished?4:3,s=eP(t.currFileCtx,e,{key:r,xhr:n,extra:{message:"prepare upload from cache success"},stage:"preUpload",type:"success",percent:0,cacheTask:o,proxyStsToken:t.options.stsToken,currentTask:1,status:1,isBreak:1,crc32Array:i.crc32Array,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st,totalDuration:Date.now()-t._st+t.currFileCtx.totalDuration}),t.successProcess&&t.successProcess(s)):t.startPreUpload()}catch(e){t.startPreUpload()}}),n.on("error",,this.config.userId);n.send({method:"get",url:eh.urlTemplate(this.config.getUploadListUrl,{tosDomain:e.tosDomain,oid:e.oid,uploadId:e.uploadID||e.UploadID}),headers:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ej(Object(r),!0).forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ej(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({Authorization:e.signature,"X-Storage-U":encodeURIComponent(i)},e.UploadHeader),timeout:3e4})}},{key:"confirmCache",value:function(e){var t=this.currFileCtx.crc32Array,r={},n=(e.forEach(,!0),e=t.map(;return{isAllFinished:n,crc32Array:e}}},{key:"fail",value:function(e){var t=e.xhr,r=e.errorCode||1001e3,n="prepare upload error: UNKNOWN",n=(t&&(n=0===t.status?"prepare upload error: NETERROR":e.message||"prepare upload error: ".concat(t.status)),eP(this.currFileCtx,{extra:{message:n,error:e.error,errorCode:r},type:"error",stage:"preUpload",xhr:t,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration}));this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(n)}}],eD(o.prototype,t),r&&eD(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function eB(e){return(eB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ez(){return(ez=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function eF(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function eR(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function eM(e,t){return(eM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function eH(e){return(eH=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var eN=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eM(e,t)}(o,n.a);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=eH(o);return function(e,t){if(t&&("object"===eB(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=eH(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).options=e,r.config=t,r.transport=new eO,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.eventInit(),r}return t=[{key:"initUpload",value:function(){var e=this.options.context,t=this.options.key,r={oid:e.tasks[t].oid,tosDomain:e.tasks[t].tosDomain},r=eh.urlTemplate(this.config.initUploadFileUrl,r),n=this.config.userId;this.transport.send({method:"post",url:r,headers:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eF(Object(r),!0).forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eF(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({Authorization:e.tasks[t].signature,"X-Storage-U":encodeURIComponent(n)},this.currFileCtx.UploadHeader),timeout:3e4})}},{key:"start",value:function(e,t,r){this.successProcess=t,this.failProcess=r,this._st=Date.now(),this.initUpload()}},{key:"eventInit",value:function(){var e=this;this.transport.on("complete",function(t){try{var r,n=JSON.parse(t.response),i=n.payload.uploadID;0===n.success&&i?(r=ez(e.currFileCtx,{UploadID:i,percent:0,type:"success",extra:{message:"init upload id success"},stage:"initUploadID",xhr:t,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration}),e.successProcess(r)):e.fail({error:"fail! res.success: ".concat(n.success,", uploadId:").concat(i),xhr:t})}catch(r){e.fail({error:"catch error: ".concat(JSON.stringify(r)),xhr:t})}}),this.transport.on("error",}},{key:"fail",value:function(e){var t=this.options.context,r=this.options.key,t=ez(t.tasks[r],{extra:{message:"init upload id error, ".concat(e.error),errorCode:1002e3},type:"error",stage:"initUploadID",xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration});this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(t)}}],eR(o.prototype,t),r&&eR(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function eL(e){return(eL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eq(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function eK(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eq(Object(r),!0).forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eq(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function eW(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function eV(e,t){return(eV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function eJ(e){return(eJ=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var eG=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eV(e,t)}(o,n.a);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=eJ(o);return function(e,t){if(t&&("object"===eL(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=eJ(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e){var t,r=e.sliceItem,n=e.crc32,s=e.url,a=e.signature,c=e.uploadHeader,u=e.userId,l=e.retryTime,f=e.timeout,e=e.method,e=void 0===e?"put":e;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).fileSlice=r,t.crc32=n,t.uploadUrl=s,t.uploadHeader=c,t.signature=a,t.userId=u,t.retryTime=l||0,t.method=e,t.retryCount=0,t.timeout=f||18e5,t.ready=!1,t.cancel=!1,t.transport=new eO,t.eventInit(),t}return t=[{key:"upload",value:function(e,t){this.isParamsValid()&&(this._st=Date.now(),this.transport&&this.transport.send({method:this.method,url:this.uploadUrl,headers:eK({Authorization:this.signature,"Content-CRC32":this.crc32,"X-Storage-U":encodeURIComponent(this.userId)},this.uploadHeader),file:this.fileSlice,binary:1,timeout:this.timeout}),e&&this.emit("retry",t))}},{key:"isParamsValid",value:,{key:"eventInit",value:function(){var e=this;this.transport.on("complete",function(t){e.success(t)}),this.transport.on("error",function(t){e.fail(t)}),this.transport.on("progress",function(t){e.process(t)})}},{key:"success",value:,{key:"fail",value:function(e){var t=this;if(!this.cancel){var r={crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength,xhr:e,sliceStartTime:this._st,sliceEndTime:Date.now(),sliceDuration:Date.now()-this._st};if(e&&401===e.status)this.emit("error",eK({message:"slice upload failed: UNAUTHORIZED"},r));else{var n="slice upload failed: UNKNOWN";if(e&&(n=e.status?"slice upload failed: ".concat(e.status):"slice upload failed: NETERROR"),this.retryCount<this.retryTime)return setTimeout(1e3),void this.retryCount++;this.emit("error",eK({message:n},r))}}}},{key:"process",value:,{key:"abort",value:,{key:"destroy",value:],eW(o.prototype,t),r&&eW(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}(),K=r(2),eQ=r.n(K);function eX(e){return(eX="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e$(){return(e$=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}unction eY(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e1(e,t){return(e1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function e0(e){return(e0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var e2=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e1(e,t)}(o,n.a);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=e0(o);return function(e,t){if(t&&("object"===eX(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=e0(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).file=e.file,t.context=e.context,t.key=e.key,t.config=r,t.finishArr=[],t.errorLength=0,t.finishSize=0,t.retryUploadTime=Number(r.retryUploadTime)||2,t.progressMonitorTime=Number(r.progressMonitorTime)||10,t.progressMonitorSpeed=Number(r.progressMonitorSpeed)||50,t.uploadSliceCount=Number(r.uploadSliceCount)||3,t.realtimeSpeedInterval=Number(r.realtimeSpeedInterval)||5,t.processRetry=0,t.lastFinishSize=-1,t.lastProcessPercent=-1,t.lastIntervalSize=-1,t.lastCalculateSpeedTime=-1,t.lastCalculateSpeedSize=0,t.uploadHandlers={},t}return t=[{key:"start",value:,{key:"initWorker",value:function(){var e,t=this;this.worker||(e=this.crc32Array,this.worker=new eQ.a,this.worker.onmessage=function(r){var n,r=n=r.data)||n,4)||n,4)||),i=r[0],o=r[1],s=r[2],r=r[3],a=(new Date).getTime(),c=e[s];c.crc32=o,c.crc32StartTime=r,c.crc32EndTime=a,c.crc32Duration=a-r,t.upload(c,i,s)})}},{key:"read",value:,{key:"threadUpload",value:,{key:"stop",value:,{key:"setProgressMonitor",value:,{key:"clearMonitor",value:,{key:"upload",value:function(e,t,r){var n=this,i=e.crc32,o=(this.context._saveTask(this.key,{crc32Array:this.crc32Array}),{number:r+1,uploadId:this.currentCtx.UploadID||this.currentCtx.uploadID,oid:this.currentCtx.oid,tosDomain:this.currentCtx.tosDomain}),o=eh.urlTemplate(this.config.uploadChunkedUrl,o),s=this.config.userId,a=this.config.uploadHttpMethod||"put",c=this.config.uploadTimeout,t=(this.config.clientEncrypt||(t=eh.fileSlice(this.file,e.start,e.end)),new eG({sliceItem:t,crc32:i,url:o,signature:this.currentCtx.signature,uploadHeader:this.currentCtx.UploadHeader,userId:s,method:a,retryTime:this.retryUploadTime,timeout:c}));t.on("complete",function(t){1===n.currentCtx.status&&(t.start=e.start,t.crc32StartTime=e.crc32StartTime,t.crc32EndTime=e.crc32EndTime,t.crc32Duration=e.crc32Duration,t.index=r,n.fileSliceSuccess(t))}),t.on("error",,t.on("progress",function(t){1===n.currentCtx.status&&(t.start=e.start,t.index=r,n.process(t))}),t.on("retry",,t.upload(),this.uploadHandlers[r]=t}},{key:"success",value:function(e){this.finishArr=[];var t=Date.now()-this._st,t=this._uploadSize/t,t=e$(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"upload all success"},speed:t,xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._lastSaveTime+this.currentCtx.totalDuration,isAllFinish:!0});this.worker&&this.worker.terminate(),this.successProcess(t)}},{key:"fail",value:,{key:"retry",value:,{key:"fileSliceSuccess",value:function(e){var t,r=e.index,n=Date.now(),i=(-1===this.finishArr.indexOf(e.start)&&this.finishArr.push(e.start),this.crc32Array[r].finished=!0,this.crc32Array[r].speed=e.speed,{message:"slice upload success"});if(e.xhr&&(t=e.xhr,i.currentUrl=t.currentUrl||"",e$(this.currentCtx,{req:{url:t.currentUrl,param:t.params},res:{status:t.status,body:t.responseText,header:t.getAllResponseHeaders()}}),delete e.xhr),this.context.logger.send(e$(this.currentCtx,{stage:"process",type:"success",sliceIndex:r,extra:i,totalDuration:n-this._lastSaveTime+this.currentCtx.totalDuration,sliceStartTime:e.sliceStartTime,sliceEndTime:e.sliceEndTime,sliceDuration:e.sliceDuration,crc32StartTime:e.crc32StartTime,crc32EndTime:e.crc32EndTime,crc32Duration:e.crc32Duration})),this._lastSaveTime=n,this.context._saveTask(this.key),this.uploading.splice(this.uploading.indexOf(r),1),this.uploadHandlers[r]&&delete this.uploadHandlers[r],this.finishArr.length>=this.crc32Array.length)return this.stop(),void this.success(e.xhr);this.threadUpload()}},{key:"getFinishSize",value:,{key:"process",value:function(e){var t=this.currentCtx.realtimeSpeed||0,r=this.currentCtx.fileSize,n=(this.finishSize=this.getFinishSize(this.crc32Array,e),this.finishSize>this.lastFinishSize&&((e=new Date).getTime()-this.lastCalculateSpeedTime>1e3*this.realtimeSpeedInterval&&(i=e.getTime()-this.lastCalculateSpeedTime,t=Math.floor((n=this.finishSize-this.lastCalculateSpeedSize)/i),this.lastCalculateSpeedTime=e.getTime(),this.lastCalculateSpeedSize=this.finishSize),this.lastFinishSize=this.finishSize),Math.floor(this.finishSize/r*1e4)/100||0),i=e$(this.currentCtx,{stage:"process",percent:n,realtimeSpeed:t});n>this.lastProcessPercent&&100!==n&&(this.lastProcessPercent=n,this.context._broadcast("progress",i))}},{key:"errorFormat",value:function(e){var t=this.currentCtx.totalDuration,r=Date.now()-this._st,n=e.index,i=e.crc32?{message:e.message,data:e.crc32,size:e.size}:e.extra,i=(i.errorCode=i.errorCode||1003e3,e$(this.currentCtx,{extra:i,sliceIndex:n,stage:"process",req:{},res:{},totalDuration:r+t,sliceStartTime:e.sliceStartTime,sliceEndTime:e.sliceEndTime,sliceDuration:e.sliceDuration,crc32StartTime:e.crc32StartTime,crc32EndTime:e.crc32EndTime,crc32Duration:e.crc32Duration}));return e.xhr&&(n=e.xhr,i.req={url:e.xhr.currentUrl},i.res={status:n.status,body:n.responseText,header:n.getAllResponseHeaders()},delete e.xhr),i}}],eY(o.prototype,t),r&&eY(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function e3(e){return(e3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e4(){return(e4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function e5(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function e6(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e8(e,t){return(e8=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function e7(e){return(e7=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var e9=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e8(e,t)}(o,n.a);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=e7(o);return function(e,t){if(t&&("object"===e3(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=e7(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).options=e,r.config=t,r.transport=new eO,r.eventInit(),r.errorCount=0,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r}return t=[{key:"mergeFile",value:function(){for(var e={oid:this.currFileCtx.oid,uploadId:this.currFileCtx.UploadID||this.currFileCtx.uploadID,tosDomain:this.currFileCtx.tosDomain},t=this.currFileCtx.crc32Array,r="",n=0;n<t.length;n++)r=(r?"".concat(r,","):"").concat(n+1,":").concat(t[n].crc32);var e=eh.urlTemplate(this.config.uploadMergeUrl,e),i=this.config.userId,i={Authorization:this.currFileCtx.signature,"X-Storage-U":encodeURIComponent(i)},this.currFileCtx.UploadHeader);this.config.clientEncrypt&&(i["x-upload-encryption-mode"]=2,i["x-upload-encryption-key"]=btoa(this.currFileCtx.clientEncryptKey)),this.transport.send({method:"post",url:e,headers:i,custom:r})}},{key:"start",value:,{key:"eventInit",value:function(){var e=this,t=this.options.stage;this.transport.on("complete",function(r){try{var n=JSON.parse(r.response);0===n.success&&n.payload.key?(e4(e.currFileCtx,{stage:t,type:"success",hasMerge:!0,extra:{message:"merge file success"},xhr:r,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration}),e.successProcess(e.currFileCtx)):e.fail({error:"fail! result.success:".concat(n.success),xhr:r})}catch(t){e.fail({error:"response parse error: ".concat(JSON.stringify(t)),xhr:r})}}),this.transport.on("error",}},{key:"getProcessIndex",value:,{key:"fail",value:function(e){e=e4(this.currFileCtx,{extra:{message:"merge file error, ".concat(e.error),errorCode:1004e3},type:"error",stage:this.options.stage,xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration}),this.failProcess(e)}}],e6(o.prototype,t),r&&e6(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(){return(tt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function tr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tn(e,t){return(tn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function ti(e){return(ti=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var to=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tn(e,t)}(o,n.a);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=ti(o);return function(e,t){if(t&&("object"===te(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=ti(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).options=e,t.file=e.file,t.context=e.context,t.key=e.key,t.config=r,t.finishArr=[],t.errorLength=0,t.finishSize=0,t.retryUploadTime=0,t.processRetry=0,t.lastFinishSize=-1,t.lastProcessPercent=-1,t.lastIntervalSize=-1,t}return t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this.currentCtx=this.context.tasks[this.key],this.crc32Array=this.context.tasks[this.key].crc32Array,this._uploadSize=this.file.size,this._st=Date.now(),this.upload()}},{key:"stop",value:,{key:"upload",value:function(){for(var e=this,t=this.crc32Array.length,r=0,n=0,i=0;i<t;i++){var o=this.crc32Array[i],s=o.buffer,o=o.crc32,a=this.currentCtx.oid,c=this.currentCtx.signature,a={oid:"[object Array]"===Object.prototype.toString.call(a)?a[i]:a,tosDomain:this.currentCtx.tosDomain},a=eh.urlTemplate(this.config.directUploadFileUrl,a),u=this.config.userId,l=this.config.uploadHttpMethod||"put",f=this.config.uploadTimeout,s=new eG({sliceItem:s,crc32:o,url:a,signature:"[object Array]"===Object.prototype.toString.call(c)?c[i]:c,uploadHeader:this.currentCtx.UploadHeader,userId:u,retryTime:this.retryUploadTime,method:l,timeout:f});s.on("complete",function(i){n+ ++r===t&&e.success(i.xhr)}),s.on("error",function(r){++n===t&&e.fail(r.xhr)}),s.on("progress",,s.upload(),this.uploader=s}}},{key:"success",value:function(e){this.finishArr=[];var t=Date.now()-this._st,t=this._uploadSize/t,t=tt(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"direct upload success"},speed:t,xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration});this.successProcess(t)}},{key:"fail",value:function(e){e=tt(this.currentCtx,{extra:{message:"direct upload error: ".concat(e.errText),errorCode:1003e3},type:"error",stage:"process",xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration}),this.failProcess(e)}},{key:"process",value:function(e){var t=this.currentCtx.fileSize,e=(this.finishSize=e.loaded,this.finishSize>this.lastFinishSize&&(this.lastFinishSize=this.finishSize),Math.floor(this.finishSize/t*1e4)/100||0),t=tt(this.currentCtx,{stage:"process",percent:e});e>this.lastProcessPercent&&100!==e&&(this.lastProcessPercent=e,this.context._broadcast("progress",t))}}],tr(o.prototype,t),r&&tr(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function ts(e){return(ts="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ta(){return(ta=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function tc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tu(e,t){return(tu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tl(e){return(tl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tf=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tu(e,t)}(o,n.a);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tl(o);return function(e,t){if(t&&("object"===ts(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=tl(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).options=e,t.file=e.file,t.context=e.context,t.key=e.key,t.config=r,t.errorLength=0,t.retryUploadTime=Number(r.retryUploadTime)||2,t.maxUploadSliceCount=Number(r.uploadSliceCount)||5,t.uploadQueue=[],t.crc32Array=[],t.uploadSliceCount=0,t.isCalcCrc32=!1,t.isFileReading=!1,t.hasStarted=!1,t.hasCompleteUpload=!1,t}return t=[{key:"start",value:,{key:"initWorker",value:,{key:"addStreamSlice",value:function(e){var t=this,r=e.fileSlice,n=e.index,e=(this.isFileReading=!0,new FileReader);e.readAsArrayBuffer(r),e.onload=},{key:"completeStreamUpload",value:,{key:"startUploadQueue",value:,{key:"startCrc32Queue",value:,{key:"upload",value:function(e){var t=this,r=e.sliceItem,n=e.index,e=e.crc32,i=this.currentCtx.signature,o={number:n+1,uploadId:this.currentCtx.UploadID||this.currentCtx.uploadID,oid:this.currentCtx.oid,tosDomain:this.currentCtx.tosDomain},o=eh.urlTemplate(this.config.uploadChunkedUrl,o),s=this.config.userId,r=new eG({sliceItem:r,crc32:e,url:o,signature:i,uploadHeader:this.currentCtx.UploadHeader,userId:s,retryTime:this.retryUploadTime,method:"put",timeout:this.config.uploadTimeout});r.on("complete",function(e){1===t.currentCtx.status&&(e.index=n,t.fileSliceSuccess(e))}),r.on("error",,r.upload()}},{key:"fileSliceSuccess",value:,{key:"success",value:,{key:"fail",value:function(e){var t=e.index,e=ta(this.currentCtx,{extra:{message:"stream slice upload error"},type:"error",stage:"process",xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration,sliceIndex:t});this.context.logger.send(ta({},e)),this.context._broadcast("error",e)}}],tc(o.prototype,t),r&&tc(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function th(e){return(th="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tp(){return(tp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}nction tg(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tm(e,t){return(tm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tv(e){return(tv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tb=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tm(e,t)}(o,n.a);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tv(o);return function(e,t){if(t&&("object"===th(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=tv(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).options=e,r.config=t,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.isImageBatchUpload=!!r.options.isImageBatchUpload,r.transport=new eO,r.eventInit(),r}return t=[{key:"commitUpload",value:function(){var e,t,r=this.options.key,r=this.options.context.tasks[r],n=er[this.config.region],i="",o={},s=this.uploaderCtx.useBackupDomain,a=eT.checkServiceName(this.options.type,this.config),c=(a===et&&(i=this.config.imageHost||(s?es:eo)[n],o={Action:"CommitImageUpload",Version:"2018-08-01",SessionKey:r.SessionKey},this.options.type===Z&&(this.config.imageConfig&&this.config.imageConfig.serviceId?o.ServiceId=this.config.imageConfig.serviceId:o.SpaceName=this.config.videoConfig&&this.config.videoConfig.spaceName,Array.isArray(c=this.config.imageConfig&&this.config.imageConfig.processAction)&&0<c.length&&((e={SessionKey:r.SessionKey,Functions:[]}).Functions=c,t=JSON.stringify(e)),this.config.skipMeta&&(o.SkipMeta=!0)),this.options.type===Y&&(o.ServiceId=this.config.objectConfig&&this.config.objectConfig.serviceId||this.config.imageConfig&&this.config.imageConfig.serviceId)),"vod"===a&&(c=this.config.videoConfig&&this.config.videoConfig.spaceName,this.options.type===Y&&this.config.objectConfig&&this.config.objectConfig.spaceName&&(c=this.config.objectConfig.spaceName),i=this.config.videoHost||(s?ei:en)[n],o={Action:"CommitUploadInner",Version:"2020-11-19",SpaceName:c},e={SessionKey:r.SessionKey,Functions:[]},s=this.config.videoConfig&&this.config.videoConfig.processAction,this.options.type===Y&&this.config.objectConfig&&this.config.objectConfig.processAction&&(s=this.config.objectConfig.processAction),Array.isArray(s)&&0<s.length&&(e.Functions=s),(this.config.videoConfig&&this.config.videoConfig.callbackArgs||this.options.callbackArgs)&&(e.CallbackArgs=this.options.callbackArgs||this.config.videoConfig.callbackArgs),this.options.type===$&&this.config.skipDownload&&(o.SkipDownload=!0),t=JSON.stringify(e)),this.config.accountId&&(o["X-Account-Id"]=this.config.accountId),eh.toQueryString(o)),s=this.currFileCtx.proxyStsToken||this.config.stsToken,u=s.AccessKeyID,l=s.AccessKeyId,f=s.SecretAccessKey,s=s.SessionToken,c={method:"POST",url:"".concat(i,"?").concat(c),timeout:this.config.gatewayTimeout||3e4,region:n,params:o,headers:{},pathname:eh.getPathByURL(i)},n=(e?(c.custom=t,c.body=e):(c.custom="none",c.headers["Content-Type"]="application/json"),new eC.a(c,a)),o=r.systemTimeGap,i=o?new Date((new Date).getTime()+o):new Date;n.addAuthorization({accessKeyId:l||u,secretAccessKey:f,sessionToken:s},i),this.transport.send(c)}},{key:"start",value:function(e,t,r){this.successProcess=t,this.failProcess=r,this._st=Date.now();try{this.commitUpload()}catch(e){this.fail({error:"catch error: ".concat(e.toString())})}}},{key:"eventInit",value:function(){var e=this;this.transport.on("complete",function(t){try{var r,n,i,o,s,a,c=JSON.parse(t.response);c.ResponseMetadata.Error?e.fail({xhr:t,errorCode:c.ResponseMetadata.Error.CodeN,error:c.ResponseMetadata.Error.Code,message:c.ResponseMetadata.Error.Message}):(r=eT.checkServiceName(e.options.type,e.config),n=c.Result,i={},r===et?e.isImageBatchUpload?(o=n.Results,s=n.PluginResult||[],o.forEach(,i=o):tp(i=n.Results[0],n.PluginResult&&n.PluginResult[0]):i=n.Results[0],a=tp(e.currFileCtx,{stage:"complete",type:"success",percent:100,extra:{message:"upload successful"},uploadResult:i,xhr:t,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration}),e.successProcess&&e.successProcess(a))}catch(r){e.fail({error:"catch error: ".concat(r.toString()),xhr:t})}}),this.transport.on("error",}},{key:"fail",value:function(e){var t=this.options.context,r=this.options.key,n=e.xhr,i=e.errorCode||1005e3,o="prepare upload error: UNKNOWN",t=(n&&(o=0===n.status?"prepare upload error: NETERROR":e.message||"prepare upload error: ".concat(n.status)),tp(t.tasks[r],{extra:{message:o,error:e.error,errorCode:i},type:"error",stage:"complete",xhr:n,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration}));this.failProcess(t)}}],tg(o.prototype,t),r&&tg(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function t_(e){return(t_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tw(){return(tw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function tk(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tS(e,t){return(tS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tx(e){return(tx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tO=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tS(e,t)}(o,n.a);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tx(o);return function(e,t){if(t&&("object"===t_(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=tx(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0,s=3<arguments.length?arguments[3]:void 0;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,e)).tasks=e,t.config=r,t.key=s,t.uploaderCtx=n,t.current=0,t.length=t.tasks.length,t.taskError={},t.uploadList=[],t.retryTaskTime=r.retryTaskTime||2,t}return t=[{key:"start",value:function(){var e=this.tasks.shift();e&&(this.current=e.index,this.execTask(e))}},{key:"execTask",value:function(e){var t,r,n=this,i=e.key,o=this.uploaderCtx,s=o.tasks[i];s&&(t=s.cacheTask,r=o.taskList[i].length,t&&0<e.index&&e.index<t?this.start():(s.currentTask=e.index,1===s.status&&e&&e.func.call(e.context,e.arg,function(t){var s;o.taskList[i]&&((s=o.taskList[i][e.index+1])&&0!==e.index?o._saveTask(i,{currentTask:s.index,stage:s.stage}):e.index===r-1&&o._removeTaskCache(i),0<n.tasks.length?n.start():o._queueSuccess(i),n.success(t))},function(t){var r;t.xhr&&400<=t.xhr.status?n.fail(t):!n.taskError[i]||n.taskError[i]<n.retryTaskTime?(n.taskError[i]?n.taskError[i]++:n.taskError[i]=1,r=n.errorFormat(t,!0),n.uploaderCtx.logger.send(r),n.execTask(e)):(t.key=i,n.fail(t))})))}},{key:"addTask",value:,{key:"success",value:function(e){var t;e.xhr&&(t=e.xhr,e.req={url:t.currentUrl,param:t.params},e.res={status:t.status,header:t.getAllResponseHeaders(),body:t.responseText},delete e.xhr),tw(e,{type:"success"});try{this.uploaderCtx._broadcast(e.stage,e)}catch(e){}this.uploaderCtx.logger.send(e)}},{key:"fail",value:function(e){var t=this.uploaderCtx,r=e.key,e=this.errorFormat(e);try{t._broadcast("error",e)}catch(e){}t.tasks[r].isBreak?t._cancel(r):t._pause(r),t.logger.send(e)}},{key:"cancel",value:function(e){var t,r;e||(e=this.key,t=this.uploaderCtx.tasks[e].currentTask,this.uploaderCtx.taskList[e].forEach(,this.tasks=[],r&&3===r.index&&r.context.stop(),this.uploaderCtx._removeTaskCache(e))}},{key:"restart",value:,{key:"errorFormat",value:function(e,t){var r,t={type:t?"retry":"error"};return e.xhr&&(r=e.xhr,e.req={url:r.currentUrl,param:r.params},e.res={status:r.status,header:r.getAllResponseHeaders(),body:r.responseText},e.extra&&(e.extra.req=e.req,e.extra.res=e.res),delete e.xhr),tw(e,t)}}],tk(o.prototype,t),r&&tk(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();=function(){!s,n.a);var e,t,r,o=(e=),function(){var t,r=tD(s);return this,e?(t=tD(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function s(e){var t;return this,s),(t=o.call(this,e)).config=tT({},i),t._mergeOptions(t.config,e),t.tasks={},t.taskList={},t.cache={},t.storage=eh.storage(tP(t)),t.logger=t.config.noLog?{send::new eu(t.config,tP(t)),t}return t=[{key:"_mergeOptions",value:,{key:"_setCache",value:,{key:"_getCache",value:,{key:"_removeCache",value:,{key:"_addTask",value:,{key:"_broadcast",value:function(e,t){var r=this.tasks[t.key].status;if(1===r||0===r)try{this.emit(e,t)}catch(e){if(!(r=!("[object Error]"!==Object.prototype.toString.call(e)))||"Error"===e.name)throw e}}},{key:"_addCrc32ProcessTask",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=r.isDirect,r=r.isImageBatchUpload,e=new e_({file:e.file,context:this,key:t,isDirect:n,isImageBatchUpload:void 0!==r&&r},this.config),n={context:e,func:e.start,arg:{},key:t,index:0,stage:"crc32"};this._addTask(t,n)}},{key:"_addPreUploadTask",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=r.isDirect,r=r.isImageBatchUpload,n={file:e.file,stsToken:e.stsToken,context:this,type:e.type||$,preUploadUriParams:e.preUploadUriParams||{},storeKey:e.storeKey,key:t,isDirect:n,isImageBatchUpload:void 0!==r&&r,fileSize:e.fileSize||null},r=new eU(n,this.config),e={context:r,func:r.start,arg:{},key:t,index:1,stage:"preUpload"};this._addTask(t,e)}},{key:"_addDirectUploadTask",value:function(e,t){var r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).isImageBatchUpload,e=new to({file:e.file,context:this,key:t,isImageBatchUpload:void 0!==r&&r},this.config),r={context:e,func:e.start,arg:{},key:t,index:3,stage:"process"};this._addTask(t,r)}},{key:"_addInitUploadIDTask",value:function(e,t){e={context:e=new eN({file:e.file,context:this,key:t},this.config),func:e.start,arg:{},key:t,index:2,stage:"initUploadID"},this._addTask(t,e)}},{key:"_addUploadProcessTask",value:,{key:"_addStreamUploadTask",value:,{key:"_mergeFileTask",value:,{key:"_getMetaInfoTask",value:function(e,t){var r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).isImageBatchUpload,e={file:e.file,context:this,data:e.data,type:e.type||$,callbackArgs:e.callbackArgs,key:t,isImageBatchUpload:void 0!==r&&r},r=new tb(e,this.config),e={context:r,func:r.start,arg:{},key:t,index:5,stage:"complete"};this._addTask(t,e)}},{key:"_addAllUploadProcess",value:function(e,t){var r=e.type===Z&&"[object Array]"===Object.prototype.toString.call(e.file),n=(this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||$,this.tasks[t].fileSize=e.file&&e.file.size,this.tasks[t].proxyStsToken=e.stsToken,e.file.size<=eh.getFileSliceLength(e.file)||r);this._addCrc32ProcessTask(e,t,{isDirect:n,isImageBatchUpload:r}),this._addPreUploadTask(e,t,{isDirect:n,isImageBatchUpload:r}),n?this._addDirectUploadTask(e,t,{isImageBatchUpload:r}):(this._addInitUploadIDTask(e,t),this._addUploadProcessTask(e,t),this._mergeFileTask(e,t)),this._getMetaInfoTask(e,t,{isImageBatchUpload:r})}},{key:"_addAllUploadProcessClientEncrypt",value:,{key:"_createClientEncryptTask",value:function(e){var t=eh.getUnique("file");return this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||$,this.tasks[t].fileSize=e.file&&e.file.size,this.tasks[t].proxyStsToken=e.stsToken,this.tasks[t].clientEncryptKey=eh.generateKey(16),this._addCrc32ProcessTask(e,t,{isDirect:!1,isImageBatchUpload:!1}),this._addPreUploadTask(e,t,{isDirect:!1,isImageBatchUpload:!1}),this._addInitUploadIDTask(e,t),this._addUploadProcessTask(e,t),this._mergeFileTask(e,t),this._getMetaInfoTask(e,t,{isImageBatchUpload:!1}),t}},{key:"_addAllStreamUploadProcess",value:function(e,t){this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||$,this.tasks[t].proxyStsToken=e.stsToken,this._addPreUploadTask(e,t),this._addStreamUploadTask(e,t),this._mergeFileTask(e,t),this._getMetaInfoTask(e,t)}},{key:"_addStreamSlice",value:,{key:"_completeStreamUpload",value:,{key:"_run",value:function(e){var t=this.tasks,r=navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/);if(r&&r[1]&&9>=Number(r[1]))return this._broadcast("error",tT(t[e],{key:e,status:0,stage:"browserError",extra:{message:"cannot support the browser below ie10"},type:"error"})),this.logger.send(t[e]),void this._cancel(e);t[e]&&(3===t[e].status?this._restart(e):(r=new Date,t[e].startTime=r.getTime(),t[e].task&&1!==t[e].status&&t[e].task.tasks.length&&(t[e].status=1,this.logger.send(tT({},t[e],{extra:{message:"start upload"},type:"start",key:e})),t[e].task.start())))}},{key:"_restart",value:function(e){var t,r,n=this,i=this.tasks;i[e]&&(t=i[e].task,r=i[e].currentTask||0,this.taskList[e].forEach(,t&&1!==i[e].status&&t.tasks.length&&(i[e].status=1,t.restart()))}},{key:"_cancel",value:function(e){var t=this.tasks;t[e]&&(t[e].status=2,t[e].task.cancel(),delete this.taskList[e])}},{key:"_pause",value:function(e){var t=this.tasks;t[e]&&(t[e].status=3,t[e].task.cancel(!0),this._saveTask(e))}},{key:"_removeTaskCache",value:function(e){var t=this.tasks;t[e]&&(t=t[e].crc32Key)&&this._removeCache(t)}},{key:"_saveTask",value:function(e,t){(t=(e=tT({},this.tasks[e],t||{})).crc32Key)&&(delete e.task,delete e.xhr,delete e.crc32Array,this._setCache(t,JSON.stringify(e)))}},{key:"_queueSuccess",value:function(e){var t,r=this.tasks;r[e]&&(t=new Date,r[e].endTime=t.getTime(),r[e].time=r[e].endTime-r[e].startTime,r[e].status=0,this.taskList[e]=[])}},{key:"_removeFile",value:,{key:"_batchAction",value:function(e){Object.keys(this.tasks).forEach(}},{key:"_refreshSTSToken",value:function(e){var t=this,r=this.tasks;Object.keys(r).forEach(function(n){var n=r[n],i=tT({},n,{proxyStsToken:e}),o=(n.proxyStsToken=e,i.crc32Key);o&&(delete i.task,delete i.xhr,delete i.crc32Array,n.proxyStsToken=e,t._setCache(o,JSON.stringify(i)))})}},{key:"_setOption",value:,{key:"_getOption",value:,{key:"_userCancel",value:,{key:"_userPause",value:],tI(s.prototype,t),r&&tI(s,r),Object.defineProperty(s,"prototype",{writable:!1}),s}();function tE(e){return(tE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tU(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tB(e,t){return(tB=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tz(e){return(tz=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tF=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tB(e,t)}(i,tA);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tz(i);return function(e,t){if(t&&("object"===tE(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=tz(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});eturn t=[{key:"start",value:function(e){this.abort=!1,e?this._run(e):this._batchAction(this._run.bind(this))}},{key:"addFile",value:function(e){var t;return e&&eT.checkStsToken(e.stsToken)?e.file&&this.config.clientEncrypt?this._addAllUploadProcessClientEncrypt(e):e.file?(t=eh.getUnique("file"),this._addAllUploadProcess(e,t),t):null:(this.emit("error",{extra:{message:eg,errorCode:1000002}}),null)}},{key:"addImageFile",value:function(e){var t;return e&&eT.checkStsToken(e.stsToken)?e.file?(e.type=e.type||Z,t=eh.getUnique("file"),this._addAllUploadProcess(e,t),t):null:(this.emit("error",{extra:{message:eg,errorCode:1000002}}),null)}},{key:"addStreamUploadTask",value:function(e){if(!e||!eT.checkStsToken(e.stsToken))return this.emit("error",{extra:{message:eg,errorCode:1000002}}),null;var t=eh.getUnique("file");return this._addAllStreamUploadProcess(e,t),t}},{key:"addStreamSlice",value:,{key:"completeStreamUpload",value:function(){this._completeStreamUpload()}},{key:"removeFile",value:,{key:"cancel",value:function(e){e?this._userCancel(e):this._batchAction(this._userCancel.bind(this))}},{key:"pause",value:function(e){this._userPause(e)}},{key:"restart",value:,{key:"refreshSTSToken",value:function(e){this._refreshSTSToken(e)}},{key:"setOption",value:function(e){this._setOption(e)}},{key:"getOption",value:function(e){return this._getOption(e)}}],tU(i.prototype,t),r&&tU(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}()}]).default}}]);