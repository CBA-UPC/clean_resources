/*! @metadata nano: 4.7.4-ea85bb55 (2023-11-14T14:25:26+08:00) */
!self,(function(){return function(){var __webpack_modules__={41028:45813:92847:function(e){"use strict";.exports=t,t.verbose=!1},36474:63967:91688:60638:37848:function(e,t){"use strict";var r=t,n=r.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=r.normalize=r.resolve=,65399:85885:53680:75276:function(e,t){"use strict";var r;function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t,i){if(!i||n(i.value)!==r.typeOfFunction)throw new TypeError("Only methods can be decorated with @bind. <"+t+"> is not a method!");return{configurable:r.boolTrue,get:}((r||(r={})),t.ak=i,t.ZP=i},35878:59680:60689:84461:27249:function(e,t,r){r(99138);var n=r(70853);e.exports=n("Array","findIndex")},54883:function(e,t,r){r(93281);var n=r(70853);e.exports=n("Array","find")},17979:74032:function(e,t,r){r(64911);var n=r(70853);e.exports=n("Array","includes")},9385:function(e,t,r){r(65734),r(2966),r(98720),r(98231);var n=r(92982);e.exports=n.Map},17729:28258:16143:function(e,t,r){r(51176);var n=r(70853);e.exports=n("String","endsWith")},17230:function(e,t,r){r(76298);var n=r(70853);e.exports=n("String","includes")},43461:28883:function(e,t,r){r(2966),r(44885),r(98231);var n=r(92982);e.exports=n.WeakMap},38363:99916:28394:99007:78517:35279:3603:18840:45831:32057:95068:31223:6856:78228:38365:6059:88518:25341:82213:91351:18874:83370:60111:4487:37319:11625:77359:81741:64645:85415:26914:62591:16742:45844:70853:15496:97802:34782:72299:19222:98119:95384:38707:30194:38004:61817:59550:37127:79231:96547:32574:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var i=r(38004),o=r(98521),a=r(30194),s=r(20825).f,u=r(75010),c=r(72299),l=u("meta"),d=0,f=Object.isExtensible||function(){return!0},p=h=e.exports={REQUIRED:!1,fastKey:getWeakData:onFreeze:;i[l]=!0},25993:92542:46335:11683:98521:38:function(e){e.exports=!1},57761:1432:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var i=r(35279),o=r(92542),a=r(81588),s=r(19222),u=r(95384),c=r(67281),l=e.exports=,67281:6036:46986:function(e){e.exports={}},9155:53533:46724:83548:26793:27818:43649:20825:9475:86669:31315:48026:81341:49231:20812:48402:10386:8022:92982:function(e,t,r){var n=r(38707);e.exports=n},63959:15605:53833:55242:35237:18507:62594:60898:28308:,44418,90107,62642,39118,17439,81588,18375,79501,39008,75010,37831,44969,99138:function(e,t,r){"use strict";var n=r(97802),i=r(32057).findIndex,o=r(99007),a=r(31223),s="findIndex",u=!0,c=a(s);s in[]&&Array(1)[s]((function(){u=!1})),n({target:"Array",proto:!0,forced:u||!c},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o(s)},93281,20246,64911,20690,65734:function(e,t,r){"use strict";var n=r(91351),i=r(25341);e.exports=n("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),i)},69937,2966,56469,51176,76298,98720,36228,44885,88502,59910,98231,26565,13052:function(e,t,r){var n=r(27249);e.exports=n},91021:function(e,t,r){var n=r(54883);e.exports=n},22545:function(e,t,r){var n=r(17979);e.exports=n},6331:function(e,t,r){var n=r(74032);e.exports=n},99452:function(e,t,r){r(59910),r(98231);var n=r(20690),i=r(3603);e.exports={keys:n.keys,values:n.values,entries:n.entries,iterator:n.values,forEach:i}},78959:function(e,t,r){var n=r(9385);e.exports=n},41090:function(e,t,r){var n=r(17729);e.exports=n},
42101:function(e,t,r){var n=r(43653);e.exports=n},89426:function(e,t,r){var n=r(28258);e.exports=n},17618:function(e,t,r){var n=r(16143);e.exports=n},91277:function(e,t,r){var n=r(17230);e.exports=n},8249:function(e,t,r){var n=r(43461);e.exports=n},96713:function(e,t,r){var n=r(28883);e.exports=n},50913,43653,61369,36975:function(e){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,n,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(n)for(var s=0;s<this.length;s++){var u=this[s][0];null!=u&&(a[u]=!0)}for(var c=0;c<e.length;c++){var l=[].concat(e[c]);n&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),r&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=r):l[2]=r),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),t.push(l))}},t}},61506,50104:function(e){"use strict";e.exports=function(e){return e[1]}},73787:function(e,t,r){var n,i,o;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}o=function(){"use strict";var e=6e4,t=36e5,r="millisecond",n="second",i="minute",o="hour",s="day",u="week",c="month",l="quarter",d="year",f="date",p="Invalid Date",h=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal},g,v={s:g,z,m,a,p,u},_="en",E={};E[_]=m;var b,S,T,w=v;w.l=S,w.i=b,w.w;var A(),R=A.prototype;return T.prototype=R,[["$ms",r],["$s",n],["$m",i],["$H",o],["$W",s],["$M",c],["$y",d],["$D",f]].forEach()),T.extend,T.locale=S,T.isDayjs=b,T.unix,T.en=E[_],T.Ls=E,T.p={},T},"object"==a(t)?e.exports=o():void 0===(i="function"==typeof(n=o)?n.call(t,r,t,e):n)||(e.exports=i)},27096:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var i=r(13519)(),o=r(96893),a=i&&o("%Object.defineProperty%",!0);if(a)try{a({},"a",{value:1})}catch(e){a=!1}var s=o("%SyntaxError%"),u=o("%TypeError%"),c=r(45527);e.exports},77208:function(e){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}var r,n="object"===("undefined"==typeof Reflect?"undefined":t(Reflect))?Reflect:null,i=n&&"function"==typeof n.apply?n.apply;r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN|e.exports=a,e.exports.once,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10efineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set}),a.init,a.prototype.setMaxListeners,a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit,a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener,a.prototype.once=function(e,t){return u(t),this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener,a.prototype.removeListener,a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners,a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners,a.listenerCount,a.prototype.listenerCount=h,a.prototype.eventNames},43147,64585,96893:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var i,o=SyntaxError,a=Function,s=TypeError,u,c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var l,d=c():l,f=r(90554)(),p=r(68599)(),h=Object.getPrototypeOf||(p?function(e){return e.__proto__}:null),y={},m="undefined"!=typeof Uint8Array&&h?h(Uint8Array):i,g={"%AggregateError%":"undefined"==typeof AggregateError?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?i:ArrayBuffer,"%ArrayIteratorPrototype%":f&&h?h([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":y,"%AsyncGenerator%":y,"%AsyncGeneratorFunction%":y,"%AsyncIteratorPrototype%":y,"%Atomics%":"undefined"==typeof Atomics?i:Atomics,"%BigInt%":"undefined"==typeof BigInt?i:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?i:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?i:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?i:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?i:FinalizationRegistry,"%Function%":a,"%GeneratorFunction%":y,"%Int8Array%":"undefined"==typeof Int8Array?i:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?i:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":f&&h?h(h([][Symbol.iterator]())):i,"%JSON%":"object"===("undefined"==typeof JSON?"undefined":n(JSON))?JSON:i,"%Map%":"undefined"==typeof Map?i:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&f&&h?h((new Map)[Symbol.iterator]()):i,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?i:Promise,"%Proxy%":"undefined"==typeof Proxy?i:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?i:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?i:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&f&&h?h((new Set)[Symbol.iterator]()):i,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":f&&h?h(""[Symbol.iterator]()):i,"%Symbol%":f?Symbol:i,"%SyntaxError%":o,"%ThrowTypeError%":d,"%TypedArray%":m,"%TypeError%":s,"%Uint8Array%":"undefined"==typeof Uint8Array?i:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?i:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?i:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?i:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?i:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?i:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?i:WeakSet};if(h)try{null.error}catch(e){var v=h(h(e));g["%Error.prototype%"]=v}var _,E={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],
"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=r(64585),S=r(68916),T=b.call(Function.call,Array.prototype.concat),w=b.call(Function.apply,Array.prototype.splice),A=b.call(Function.call,String.prototype.replace),R=b.call(Function.call,String.prototype.slice),P=b.call(Function.call,RegExp.prototype.exec),D=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,O=/\\(\\)?/g,I;e.exports},45527,13519,68599,90554,24317,68916,65180,60428,77165:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}r.d(t,{EH:function(){return Ft},Fl:function(){return Ne},LO:function(){return De},U5:function(){return jt},ZN:function(){return ur},aD:function(){return kt},gx:function(){return lr},hz:function(){return Gt},jQ:function(){return zt},p6:function(){return Q},rC:function(){return Er},vP:function(){return jr},z:function(){return xt}})var o={}var s=Object.assign,u=Object.getOwnPropertyDescriptor,c=Object.defineProperty,l=Object.prototype,d=[];Object.freeze(d);var f={};Object.freeze(f);var p="undefined"!=typeof Proxy,h=Object.toString()ar g=function(){};function v(e){return"function"==typeof ection T(e,t,r){c(e,t,{enumerable:!1,writable:!0,configurable:!0,value:r})unction R(e){return e instanceof Map}function P(e){return e instanceof Set}var D=void 0!==Object.getOwnPropertySymbols;var O="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:D:Object.getOwnPropertyNamesar N=Object.getOwnPropertyDescriptors|;function k(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(o=i.key,a=void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===n(a)?a:String(a)),i)}var o,a}function L(e,t,r){return t&&k(e.prototype,t),r&&k(e,r),Object.defineProperty(e,"prototype",{writable:!1}),eunction F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return nvar V=Symbol("mobx-stored-annotations")ar q=Symbol("mobx administration"),W(),K=A("Atom",W)var Q={identity,structural,default,shallow}ar J="override";function X(e,t){return{annotationType_:e,options_:t,make_:$,extend_:ee}nction re(e,t){return{annotationType_:e,options_:t,make_:ne,extend_:ie}nction ae(e,t){return{annotationType_:e,options_:t,make_:se,extend_:ue}}function se(e,t,r){return null===this.extend_(e,t,r,!1)?0:1 fe="true",pe=he()r ge={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0}Object.freeze(ge);var _e=ce("observable"),Ee=ce("observable.ref",{enhancer:Z}),be=ce("observable.shallow",{enhancer}),Se=ce("observable.struct",{enhancer}),Te=H(_e)function Ae(e,t,r){if(!_(t))return or(e)?e:b(e)?De.object(e,t,r):Array.isArray(e)?De.array(e,t):R(e)?De.map(e,t):P(e)?De.set(e,t):"object"===n(e)&&null!==e?e:De.box(e,t);G(e,t,_e)}s(Ae,Te);var Re,Pe,De=s(Ae,{box,array,map:function(e,t){var r=ve(t);return new jr(e,we(r),r.name)},set,object,ref:H(Ee),shallow:H(be),deep:Te,struct:H(Se)}),Oe="computed",Ie=ae(Oe),Ce=ae("computed.struct",{equals:Q.structural}),Ne;Object.assign(Ne,Ie),Ne.struct=H(Ce);var ke,Le=0,xe=1,Me=null!=(Re=null==(Pe=u((function(){}),"name"))?void 0:Pe.configurable)&&Re,Fe={value:"action",configurable:!0,writable:!1,enumerable:!1}nction Ve(e){var t=dt.allowStateChanges;return dt.allowStateChanges=e,t}function He(e){dt.allowStateChanges=e}ke=Symbol.toPrimitive;var Ge,qe(W),We=A("ObservableValue",qe);Ge=Symbol.toPrimitive;var Ke,Ye,Qe(),ze=A("ComputedValue",Qe);!function(e){e[e.NOT_TRACKING_=-1]="NOT_TRACKING_",e[e.UP_TO_DATE_=0]="UP_TO_DATE_",e[e.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",e[e.STALE_=2]="STALE_"}(Ke||(Ke={})),function(e){e[e.NONE=0]="NONE",e[e.LOG=1]="LOG",e[e.BREAK=2]="BREAK"}(Ye||(Ye={}));var Zeunction $e(e){ction it(e){dt.trackingDerivation=er ut,ct=!0,lt=!1,dt()();var Et=100,bt=function(e){return e()}ar wt=A("Reaction",_t);var At="action",Rt="autoAction",Pt="<unnamed action>",Dt=X(At),Ot=X("action.bound",{bound:!0}),It=X(Rt,{autoAction:!0}),Ct=X("autoAction.bound",{autoAction:!0,bound:!0})var kt=Nt(!1)
;Object.assign(kt,Dt);var Lt=Nt(!0)ject.assign(Lt,It),kt.bound=H(Ot),Lt.bound=H(Ct);var Ut=function(e){return e()}ar Vt="onBO",Ht="onBUO";function Gt(e,t,r){return Wt(Vt,e,t,r)ar Kt="never",Yt="always",Qt="observed"ar Jt=0Xt.prototype=Object.create(Error.prototype);var $t=re("flow"),er=re("flow.bound",{bound:!0}),tr=Object.assign(),$t)tion sr(e,t){if(null==e||"object"!==n(e)||e instanceof Date||!or(e))return e;if(We(e)||ze(e))return sr(e.get(),t);if(t.has(e))return t.get(e);if(Lr(e)){var r=ar(t,e,new Array(e.length));return e.forEach()),r}if(qr(e)){var o=ar(t,e,new Set);return e.forEach((function(e){o.add(sr(e,t))})),o}if(Vr(e)){var a=ar(t,e,new Map);return e.forEach()),a}var s=ar(t,e,{});return(e).forEach()),sunction lr(e,t,r){return 1===arguments.length||t&&"object"===n(t)(e,t):dr(e,t,r||{})function fr(e){return e[q]}tr.bound=H(er);var pr={has:function(e,t){return fr(e).has_(t)},get,set,deleteProperty,defineProperty,ownKeys,preventExtensions};function hr(e){return void 0!==e.interceptors_&&e.interceptors_.length>0}function yr(e,t){var r=e.interceptors_||(e.interceptors_=[]);return r.push(t),m((function(){var e=r.indexOf(t);-1!==e&&r.splice(e,1)}))br="splice",Sr="update",Tr={get,set:function(e,t,r){var i=e[q];return"length"===t&&i.setArrayLength_(r),"symbol"===n(t)||isNaN(t)?e[t]=r:i.set_(parseInt(t),r),!0},preventExtensions:function(){i(15)}},wr()var Rr={clear,replace,toJSON:function(){return this.slice()},splice,spliceWithArray,push,pop,shift,unshift,reverse,sort,remove}"concat",Dr),Pr("flat",Dr),Pr("includes",Dr),Pr("indexOf",Dr),Pr("join",Dr),Pr("lastIndexOf",Dr),Pr("slice",Dr),Pr("toString",Dr),Pr("toLocaleString",Dr),Pr("every",Or),Pr("filter",Or),Pr("find",Or),Pr("findIndex",Or),Pr("flatMap",Or),Pr("forEach",Or),Pr("map",Or),Pr("some",Or),Pr("reduce",Ir),Pr("reduceRight",Ir);var Cr,Nr,kr=A("ObservableArrayAdministration",wr)var xr={},Mr="add",Fr="delete";Cr=Symbol.iterator,Nr=Symbol.toStringTag;var Ur,Br,jr(),Vr=A("ObservableMap",jr);var Hr={};Ur=Symbol.iterator,Br=Symbol.toStringTag;var Gr(),qr=A("ObservableSet",Gr),Wr=Object.create(null),Kr="remove",Yr()var zr=A("ObservableObjectAdministration",Yr) en,tn,rn=sn(0),nn=0,on=function(){};en=on,tn=Array.prototype,Object.setPrototypeOf?Object.setPrototypeOf(en.prototype,tn):void 0!==en.prototype.__proto__?en.prototype.__proto__=tn:en.prototype=tn;var an(on,Symbol.toStringTag,Symbol.iterator)ction dn(e,t){if("object"===n(e)&&null!==e){if(Lr(e))return void 0!==t&&i(23),e[q].atom_;if(qr(e))return e.atom_;if(Vr(e)){if(void 0===t)return e.keysAtom_;var r=e.data_.get(t)||e.hasMap_.get(t);return r||i(25,t,pn(e)),r}if(Jr(e)){if(!t)return i(26);var o=e[q].values_.get(t);return o||i(27,t,pn(e)),o}if(K(e)||ze(e)||wt(e))return e}else if(v(e)&&wt(e[q]))return e[q];i(28)bject.entries(Rr).forEach()),cn(1e3);var hn=l.toStringfunction mn(e,t,r,i,o){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var a=n(e);if("function"!==a&&"object"!==a&&"object"!=n(t))return!1;var s=hn.call(e);if(s!==hn.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return"undefined"!=typeof Symbol&&Symbol.valueOf.call(e)===Symbol.valueOf.call(t);case"[object Map]":case"[object Set]":r>=0&&r++}e=gn(e),t=gn(t);var u="[object Array]"===s;if(!u){if("object"!=n(e)||"object"!=n(t))return!1;var c=e.constructor,l=t.constructor;if(c!==l&&!(v(c)&&c instanceof c&&v(l)&&l instanceof l)&&"constructor"in e&&"constructor"in t)return!1}if(0===r)return!1;r<0&&(r=-1),o=o||[];for(var d=(i=i||[]).length;d--;)if(i[d]===e)return o[d]===t;if(i.push(e),o.push(t),u){if((d=e.length)!==t.length)return!1;for(;d--;)if(!mn(e[d],t[d],r-1,i,o))return!1}else{var f,p=Object.keys(e);if(d=p.length,Object.keys(t).length!==d)return!1;for(;d--;)if(!C(t,f=p[d])||!mn(e[f],t[f],r-1,i,o))return!1}return i.pop(),o.pop(),!0Symbol","Map","Set"].forEach()),"object"===("undefined"==typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__?"undefined":n(__MOBX_DEVTOOLS_GLOBAL_HOOK__))&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy,extras:{getDebugName:pn},$mobx:q})},16017:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var i="function"==typeof Map&&Map.prototype,o=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,a=i&&o&&"function"==typeof o.get?o.get:null,s=i&&Map.prototype.forEach,u="function"==typeof Set&&Set.prototype,c=Object.getOwnPropertyDescriptor&&u?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=u&&c&&"function"==typeof c.get?c.get:null,d=u&&Set.prototype.forEach,f="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,p="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,h="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,y=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,v=String.prototype.match,_=String.prototype.slice,E=String.prototype.replace,b=String.prototype.toUpperCase,S=String.prototype.toLowerCase,T=RegExp.prototype.test,w=Array.prototype.concat,A=Array.prototype.join,R=Array.prototype.slice,P=Math.floor,D="function"==typeof BigInt?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,I="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?Symbol.prototype.toString:null,C="function"==typeof Symbol&&"object"===n(Symbol.iterator),N="function"==typeof Symbol&&Symbol.toStringTag&&(n(Symbol.toStringTag)===C||"symbol")?Symbol.toStringTag:null,k=Object.prototype.propertyIsEnumerable,L=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null)var M=r(39087),F=M.custom,U=G(F)?F:nullunction V(e){return!("[object Array]"!==K(e)||N&&"object"===n(e)&&N in e).exports;var q=Object.prototype.hasOwnProperty|function K(e){return m.call(e):function(e,t,r){"use strict";var n;function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var o;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}var s=setTimeoutfunction c(){totype.catch,l.prototype.then,l.prototype.finally=n,l.all,l.allSettled=o,l.resolve,l.reject,l.race,l._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}|,l._unhandledRejectionFn;var g=l,v();"function"!=typeof v.Promise?v.Promise=g:v.Promise.prototype.finally?v.Promise.allSettled||(v.Promise.allSettled=o):v.Promise.prototype.finally=n},45748,94549:function(e){"use strict";e.exports=n;var t,r=/\/|\./n("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),n("duration",{Duration:t={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),n("timestamp",{Timestamp:t}),n("empty",{Empty:{fields:{}}}),n("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),n("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),n("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),n.get=function(e){return n[e]||null}},81216,13603,11676,33651:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}e.exports=s;var i=r(75141);((s.prototype=Object.create(i.prototype)).constructor=s).className="Enum";var o=r(55533),a=r(6720);function s(e,t,r,o,a){if(i.call(this,e,r),t&&"object"!==n(t))throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=o,this.comments=a||{},this.reserved=void 0,t)for(var s=Object.keys(t),u=0;u<s.length;++u)"number"==typeof t[s[u]]&&(this.valuesById[this.values[s[u]]=t[s[u]]]=s[u])}s.fromJSON,s.prototype.toJSON,s.prototype.add,s.prototype.remove,s.prototype.isReservedId=function(e){return o.isReservedId(this.reserved,e)},s.prototype.isReservedName=function(e){return o.isReservedName(this.reserved,e)}},35352:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}e.exports=l;var i=r(75141);((l.prototype=Object.create(i.prototype)).constructor=l).className="Field";var o,a=r(33651),s=r(69439),u=r(6720),c=/^required|optional|repeated$/l.fromJSON,Object.defineProperty(l.prototype,"packed",{get}),l.prototype.setOption,l.prototype.toJSON,l.prototype.resolve,l.d=function(e,t,r,i){return"function"==typeof t?t=u.decorateType(t).name:t&&"object"===n(t)&&(t=u.decorateEnum(t).name)},l._configure=function(e){o=e}},13959,9465,62773,48796:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}e.exports=s;var i=r(35352);((s.prototype=Object.create(i.prototype)).constructor=s).className="MapField";var o=r(69439),a=r(6720)s.fromJSON,s.prototype.toJSON,s.prototype.resolve,s.d=function(e,t,r){return"function"==typeof r?r=a.decorateType(r).name:r&&"object"===n(r)&&(r=a.decorateEnum(r).name)}},38610,86897,55533,75141:function(e,t,r){"use strict";e.exports=o,o.className="ReflectionObject";var n,i=r(6720)Object.defineProperties(o.prototype,{root:{get},fullName:{get}}),o.prototype.toJSON,o.prototype.onAdd,o.prototype.onRemove,o.prototype.resolve,o.prototype.getOption,o.prototype.setOption,o.prototype.setOptions,o.prototype.toString,o._configure=function(e){n=e}},50175,15984,78755,71899,80173,81675,10450:function(e,t,r){"use strict";t.Service=r(70085)},70085,55154,36823:function(e){"use strict";e.exports=d;var t=/[\s{}=;:[\],'"()<>]/g,r=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,n=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,i=/^ *[*/]+ */,o=/^\s*\*?\/*/,a=/\n/g,s=/\s/,u=/\\(.?)/g,c={0:"\0",r:"\r",n:"\n",t:"\t"}.unescape=l},63126,69439,6720,64163,
89188:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var i=t.asPromise=r(41028),i.base64=r(45813),i.EventEmitter=r(36474),i.float=r(91688),i.inquire=r(60638),i.utf8=r(85885),i.pool=r(65399),i.LongBits=r(64163),i.global="undefined"!=typeof window&&window||void 0!==r.g&&r.g||"undefined"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isNode=Boolean(i.global.process&&i.global.process.versions&&i.global.process.versions.node),i.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},i.isString,i.isObject,i.isset=i.isSet,i.Buffer(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer,i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash,i.longFromHash,i.merge=o,i.lcFirst,i.newError=a,i.ProtocolError=a("ProtocolError"),i.oneOfGetter,i.oneOfSetter,i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure},51117,79667,29897,88263,80305,52135,17689,93833:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var i=r(45937),o=r(39627),a=r(80305),s=Object.prototype.hasOwnProperty,u={brackets,comma:"comma",indices,repeat:function(e){return e}},c=Array.isArray,l=String.prototype.split,d=Array.prototype.push,f,p=Date.prototype.toISOString,h=a.default,y={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,format:h,formatter:a.formatters[h],indices:!1,serializeDate:function(e){return p.call(e)},skipNulls:!1,strictNullHandling:!1},m={},g;e.exports},39627,82695,45937,15418:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}r.d(t,{CR:function(){return f},Jh:function(){return l},XA:function(){return d},ZT:function(){return o},_T:function(){return s},cy:function(){return h},ev:function(){return p},gn:function(){return u},mG:function(){return c},pi:function(){return a}});var ivar aect.createect.create},91332:function(e,t,r){var n,i,o,u;function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}e=r.nmd(e),window,u=function(){return([function(e,t,r){"use strict";var n=function(){var e=void 0,t=[],r={},n={}urn e={extend,reset:function(){t.length=0},getSingletonInstance:i,setSingletonInstance,getSingletonFactory:function(e){var n=o(e.__dashjs_factory_name,r);return n||(n,r[e.__dashjs_factory_name]=n),n},getSingletonFactoryByName:function(e){return o(e,r)},updateSingletonFactory:function(e,t){a(e,t,r)},getClassFactory,getClassFactoryByName:function(e){return o(e,n)},updateClassFactory}}();t.a=n},function(e,t,r){var n={parseBuffer,addBoxProcessor,createFile,createBox,createFullBox,Utils:{}};n.Utils.dataViewToString,n.Utils.utf8ToByteArray,n.Utils.appendBox=function(e,t,r){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==r)if(null!=r){var n,i=-1;if("number"==typeof r)i=r;else{if("string"==typeof r)n=r;else{if("object"!=c(r)||!r.type)return void e.boxes.push(t);n=r.type}for(var o=0;o<e.boxes.length;o++)if(n===e.boxes[o].type){i=o+1;break}}e.boxes.splice(i,0,t)}else e.boxes.push(t)},t.parseBuffer=n.parseBuffer,t.addBoxProcessor=n.addBoxProcessor,t.createFile=n.createFile,t.createBox=n.createBox,t.createFullBox=n.createFullBox,t.Utils=n.Utils,n.Cursor;var i;i.prototype.fetch,i.prototype.fetchAll,
i.prototype.parse,i._sweep,i.prototype.write,i.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)};var o;o.parse,o.create,o.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],o.prototype._boxProcessors={},o.prototype._procField,o.prototype._procFieldArray,o.prototype._procFullBox,o.prototype._procEntries,o.prototype._procSubEntries,o.prototype._procEntryField,o.prototype._procSubBoxes,o.prototype._readField,o.prototype._readInt,o.prototype._readUint,o.prototype._readString,o.prototype._readTemplate,o.prototype._readTerminatedString,o.prototype._readData,o.prototype._readUTF8String,o.prototype._parseBox,o.prototype._parseFullBox,o.prototype._parseContainerBox,o.prototype.append,o.prototype.getLength,o.prototype.write,o.prototype._writeInt,o.prototype._writeUint,o.prototype._writeString,o.prototype._writeTerminatedString,o.prototype._writeTemplate,
o.prototype._writeData,o.prototype._writeUTF8String,o.prototype._writeField,o.prototype._boxProcessors.avc1=o.prototype._boxProcessors.avc2=o.prototype._boxProcessors.avc3=o.prototype._boxProcessors.avc4=o.prototype._boxProcessors.hvc1=o.prototype._boxProcessors.hev1=o.prototype._boxProcessors.encv,o.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},o.prototype._boxProcessors.elst,o.prototype._boxProcessors.emsg,o.prototype._boxProcessors.free=o.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},o.prototype._boxProcessors.frma,o.prototype._boxProcessors.ftyp=o.prototype._boxProcessors.styp,o.prototype._boxProcessors.hdlr,o.prototype._boxProcessors.mdat,o.prototype._boxProcessors.mdhd,o.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},o.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},o.prototype._boxProcessors.mfro,o.prototype._boxProcessors.mp4a=o.prototype._boxProcessors.enca,o.prototype._boxProcessors.mvhd,o.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},o.prototype._boxProcessors.pssh,o.prototype._boxProcessors.schm,o.prototype._boxProcessors.sdtp,o.prototype._boxProcessors.sidx,o.prototype._boxProcessors.smhd,o.prototype._boxProcessors.ssix,o.prototype._boxProcessors.stsd,o.prototype._boxProcessors.subs,o.prototype._boxProcessors.tenc,o.prototype._boxProcessors.tfdt,o.prototype._boxProcessors.tfhd,o.prototype._boxProcessors.tfra,o.prototype._boxProcessors.tkhd,o.prototype._boxProcessors.trex,o.prototype._boxProcessors.trun,o.prototype._boxProcessors["url "]=o.prototype._boxProcessors["urn "],o.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},o.prototype._boxProcessors.vmhd,o.prototype._boxProcessors.vttC,o.prototype._boxProcessors.vtte=function(){}},function(e,t,r){"use strict";var n,i,o,a,s,u,c,l;Object.defineProperty(t,"__esModule",{value:!0}),t.DISABLE_LOADER_TYPE=t.SPECIAL_AUDIO_TYPE=t.USER_CODEC_PREFER_TYPE=t.FILTER_VIDEO_URL_REASON=t.VIDEO_CODEC_ID=t.VIDEO_QN=t.ERROR_CODE=t.DOLBY_AUDIO_QN=t.DEFAULT_FAWKES_CONFIG=t.FLAC_QN=t.STRING=t.ERROR=t.EVENTS=void 0,t.EVENTS={SCRIPT_LOADED:"scripLoaded",VIDEO_INFO:"videoInfo",WARNING:"warning",AST_IN_FUTURE:"astInFuture",BUFFER_EMPTY:"bufferStalled",BUFFER_LOADED:"bufferLoaded",BUFFER_LEVEL_STATE_CHANGED:"bufferStateChanged",ERROR:"error",FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted",FRAGMENT_LOADING_HEADER_RECEIVED:"fragmentLoadingHeaderReceived",FRAGMENT_LOADING_PROGRESS:"fragmentLoadingProgress",FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",FRAGMENT_LOADING_ABANDONED:"fragmentLoadingAbandoned",FRAGMENT_LOADED_ERROR:"fragmentLoadedError",FRAGMENT_P2P_LOAD_INFO:"fragmentP2pLoadInfo",CDN_LOAD_INFO:"cdnLoadInfo",PCDN_LOADED_ERROR:"pcdnLoadedError",LOG:"log",MANIFEST_LOADED:"manifestLoaded",METRICS_CHANGED:"metricsChanged",METRIC_CHANGED:"metricChanged",METRIC_ADDED:"metricAdded",METRIC_UPDATED:"metricUpdated",PERIOD_SWITCH_COMPLETED:"periodSwitchCompleted",PERIOD_SWITCH_STARTED:"periodSwitchStarted",QUALITY_CHANGE_REQUESTED:"qualityChangeRequested",QUALITY_CHANGE_RENDERED:"qualityChangeRendered",TRACK_CHANGE_RENDERED:"trackChangeRendered",SOURCE_INITIALIZED:"sourceInitialized",STREAM_INITIALIZED:"streamInitialized",STREAM_TEARDOWN_COMPLETE:"streamTeardownComplete",TEXT_TRACKS_ADDED:"allTextTracksAdded",TEXT_TRACK_ADDED:"textTrackAdded",TTML_PARSED:"ttmlParsed",TTML_TO_PARSE:"ttmlToParse",CAN_PLAY:"canPlay",PLAYBACK_ENDED:"playbackEnded",PLAYBACK_ERROR:"playbackError",PLAYBACK_NOT_ALLOWED:"playbackNotAllowed",PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",PLAYBACK_PAUSED:"playbackPaused",PLAYBACK_PLAYING:"playbackPlaying",PLAYBACK_PROGRESS:"playbackProgress",PLAYBACK_RATE_CHANGED:"playbackRateChanged",PLAYBACK_SEEKED:"playbackSeeked",PLAYBACK_SEEKING:"playbackSeeking",PLAYBACK_SEEK_ASKED:"playbackSeekAsked",PLAYBACK_STARTED:"playbackStarted",PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",PLAYBACK_WAITING:"playbackWaiting",MANIFEST_VALIDITY_CHANGED:"manifestValidityChanged",KEY_ADDED:"public_keyAdded",KEY_ERROR:"public_keyError",KEY_MESSAGE:"public_keyMessage",KEY_SESSION_CLOSED:"public_keySessionClosed",KEY_SESSION_CREATED:"public_keySessionCreated",KEY_SESSION_REMOVED:"public_keySessionRemoved",KEY_STATUSES_CHANGED:"public_keyStatusesChanged",KEY_SYSTEM_ACCESS_COMPLETE:"public_keySystemAccessComplete",KEY_SYSTEM_SELECTED:"public_keySystemSelected",LICENSE_REQUEST_COMPLETE:"public_licenseRequestComplete",PROTECTION_CREATED:"public_protectioncreated",PROTECTION_DESTROYED:"public_protectiondestroyed",DELAY_TO_APPEND_TO_BUFFER:"delayToAppendBuffer",QUALITY_CHANGE_DOWNLOADED:"qualityChangeDownloaded",QUOTA_EXCEEDED:"quotaExceeded",GET_NEXT_FRAGMENT:"getNextFragment",APPENDING_NEXT_SOURCE:"appendingNextSource",APPENDED_NEXT_SOURCE:"appendedNextSource",APPENDED_NEXT_SOURCE_DURATION_CHANGED:"appendedNextSourceDurationChanged",START_OFFSET_TIME_WARNING:"startOffsetTimeWarning",BUFFERING_OPTIMIZATION:"buffering_optimization",QUALITY_CHANGE_ABNORMAL:"qualityChangeAbnormal",SWITCH_AUDIO_TRACK_REQUEST:"switchAudioTrackRequest",SWITCH_AUDIO_TRACK_RENDERED:"switchAudioTrackRendered",REQUEST_RETRYED:"requestRetryed",PREDICT_SEEK:"predictSeek",JUMP_MEDIA_GAP:"jumpMediaGap"},t.ERROR={INTERNAL_ERROR:-1,DURATION_IS_NOT_ALL_EQUAL:-2,DURATION_DEVIATION_IS_TOO_LARGE:-3,START_OFFSET_TIME_WARNING:-4,DOWNLOAD_ERROR:4,DOWNLOAD_MPD_ERROR:4001,DOWNLOAD_XINK_ERROR:4002,DOWNLOAD_INIT_SEGMENT_ERROR:4003,DOWNLOAD_MEDIA_SEGMENT_ERROR:4004,DOWNLOAD_INDEX_SEGMENT_ERROR:4005,DOWNLOAD_SWITCHING_SEGMENT_ERROR:4006,DOWNLOAD_OTHER_ERROR:4007,DOWNLOAD_FRAGMENT_ERROR:4101,
DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS:4102,DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE:4103,DOWNLOAD_FRAGMENT_ERROR_TIMEOUT:4105,CONNECT_FRAGMENT_ERROR_TIMEOUT:4106,CONNECT_FRAGMENT_ERROR_OFFLINE:4107,MANIFEST_ERROR:5,MANIFEST_TYPE_ERROR:5001,MANIFEST_RESOLVE_ERROR:5002,MEDIA_ERROR:6,MEDIA_ABORTED_ERROR:6001,MEDIA_NETWORK_ERROR:6002,MEDIA_DECODE_ERROR:6003,MEDIA_SUPPORTED_ERROR:6004,MEDIA_ENCRYPTED_ERROR:6005,MEDIA_UNKNOWN_ERROR:6e3},t.STRING={VIDEO:"video",AUDIO:"audio",LOG:"log",WARNING:"warning",ERROR:"error",ABR_DYNAMIC:"abrDynamic",ABR_BOLA:"abrBola",ABR_THROUGHPUT:"abrThroughput",SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME:"bilidp-switch-source-transition-canvas",DASH_CONFIG:"dash_config",PDN_ENABLE:"pdn_enable",BILIBILI_DECODE_ERROR_OBJ:"bilibili_decode_error_obj"},t.FLAC_QN=30251,t.DEFAULT_FAWKES_CONFIG={dash_config:{pdn_disable_qn_list:"[120, 125, 126, 127]",pdn_disable_codecid_list:"[13]",pdn_enable:"1",pdn_mid_black_list:"[]",nc_disable:"0",p2p_disable:"0",rp_disable:"0",wasm_off_list:"[]"},common_policy:{},data_policy:{},gray_policy:{},monitor:{},nc_box_policy:{},nc_new_push_policy:{},nc_policy:{},nc_sdk_policy:{},nc_tracker_policy:{},player_policy:{},reward_pcdn_loader_policy:{},reward_seeder_policy:{},self_test_policy:{},top_list_service_policy:{}}(n||(n={})),t.DOLBY_AUDIO_QN=n(i||(i={})),t.ERROR_CODE=i,function(e){e[e.QN_8K=127]="QN_8K",e[e.QN_DOLBY_VISION=126]="QN_DOLBY_VISION",e[e.QN_HDR10=125]="QN_HDR10",e[e.QN_4K=120]="QN_4K",e[e.QN_1080P_60=116]="QN_1080P_60",e[e.QN_1080P_PLUS=112]="QN_1080P_PLUS",e[e.QN_1080P=80]="QN_1080P",e[e.QN_720P_60=74]="QN_720P_60",e[e.QN_720P=64]="QN_720P",e[e.QN_480P=32]="QN_480P",e[e.QN_360P=16]="QN_360P"}(o||(o={})),t.VIDEO_QN=o,function(e){e[e.AVC=7]="AVC",e[e.HEVC=12]="HEVC",e[e.AV1=13]="AV1"}(a||(a={})),t.VIDEO_CODEC_ID=a,function(e){e.USE_HEVC_INSTEADOF_AVC="USE_HEVC_INSTEADOF_AVC",e.FILTER_SPECIAL_VIDEO="FILTER_SPECIAL_VIDEO"}(s||(s={})),t.FILTER_VIDEO_URL_REASON=s,function(e){e[e.RECOMMEND=0]="RECOMMEND",e[e.HEVC=1]="HEVC",e[e.DISABLE=2]="DISABLE",e[e.AV1=3]="AV1"}(u||(u={})),t.USER_CODEC_PREFER_TYPE=u(c||(c={})),t.SPECIAL_AUDIO_TYPE=c(l||(l={})),t.DISABLE_LOADER_TYPE=l},function(e,t,r){"use strict";var n=function()return e.prototype.extend,e}();t.a=n},function(e,t,r){"use strict";var n=this&&this.__makeTemplateObject|;Object.defineProperty(t,"__esModule",{value:!0});var i,o,a=function(){function e(){}return e.getLocalStorage=function(e){var t="";try{t=window.localStorage.getItem(e)}catch(e){}return t},e.setLocalStorage=function(e,t){try{window.localStorage.setItem(e,t)}catch(e){}},e.removeStorage,e.getSessionStorage,e.setSessionStorage,e.toFixed=function(e,t){return void 0===t&&(t=2),parseFloat(null==e?void 0:e.toFixed(t))},e.atob=function(e){try{return window.atob(e)}catch(e){return null}},e.switchFawkesConfig=function(e){var t={};for(var r in e)if(RegExp(String.raw(i||(i=n(["^(.+).(.+)$"],["^(.+)\\.(.+)$"])))).test(r)){var a=r.match(RegExp(String.raw(o||(o=n(["^(.+).(.+)$"],["^(.+)\\.(.+)$"]))))),s=a[1],u=a[2];t[s]||(t[s]={}),t[s][u]=this.atob(e[r])}return t},e.getCookie=function(t){try{if(e.cookie)return e.cookie[t]||"";if(!document.cookie||""===document.cookie)return"";e.cookie={};for(var r=document.cookie.split(";"),n=0;n<r.length;n++){var i=r[n].split("="),o=i[0].trim(),a=i[1].trim();e.cookie[o]=a}return e.cookie[t]||""}catch(e){return""}},e.saveDecodeErrorMediaQualityNumber=function(e,t,r){try{var n=null;if(!(sessionStorage&&sessionStorage.setItem&&sessionStorage.getItem&&sessionStorage.removeItem))throw new Error("");var i=sessionStorage.getItem(r);null!==i&&""!==i?(n=JSON.parse(i))[e]&&Array.isArray(n[e])?!n[e].includes(t)&&n[e].push(t):(n[e]=[],n[e].push(t)):(n={audio:[],video:[]})[e].push(t),n&&sessionStorage.setItem(r,JSON.stringify(n))}catch(e){console.error(e)}},e.getDecodeErrorMediaQualityNumberListForType=function(e,t){try{if(sessionStorage&&sessionStorage.getItem){var r=sessionStorage.getItem(t);if(void 0!==r&&""!==r){var n=JSON.parse(r);return n[e]&&Array.isArray(n[e])?n[e]:[]}return[]}}catch(e){return[]}},e.isInSpareTime=function(){var e=(new Date).getHours();return![12,13,20,21].includes(e)},e.cookie=null,e}();t.default=a},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BROWSER_TYPE=t.getGPUInfo=t.getCurrentBrowserInfo=t.getFireFoxInfo=t.getEdgeInfo=t.getSafariInfo=void 0;var i,o=n(r(4));(i||(i={})),t.BROWSER_TYPE=i,t.getSafariInfo=function(e){var t,r;e||(e=null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase());var n=e.indexOf("safari")>-1&&e.indexOf("chrom")<0,i=e.match(/version\/\d+/);return{isSafari:n,version:n&&(null==i?void 0:i.length)?+i[0].substr(8):-1}},t.getEdgeInfo=function(e){var t,r;e||(e=null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase());var n=e.indexOf("edge/")>-1,i=e.match(/edge\/\d+/);return{isEdge:n,version:n&&(null==i?void 0:i.length)?+i[0].substr(5):-1}},t.getFireFoxInfo=function(e){var t,r;e||(e=null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase());var n=e.indexOf("Firefox/")>-1,i=e.match(/Firefox\/\d+/);return{isFireFox:n,version:n&&(null==i?void 0:i.length)?+i[0].substr(8):-1}},t.getCurrentBrowserInfo=function(){var e,t,r=null===(t=null===(e=window.navigator)||void 0===e?void 0:e.userAgent)||void 0===t?void 0:t.toLowerCase(),n={type:i.Other,version:0};try{var o={Chrome:r.indexOf("chrome")>-1&&r.indexOf("safari")>-1,Firefox:r.indexOf("firefox")>-1,Safari:r.indexOf("safari")>-1&&-1===r.indexOf("chrome"),LegacyEdge:r.indexOf("edge")>-1,Edge:r.indexOf("edg/")>-1,QQ:r.indexOf("qqbrowser")>-1,Sogou:r.indexOf("se 2.x")>-1};for(var a in o)if(o[a]){var s="",u=null;"QQ"===a?(s=r.match(/chrome\/([\d.]+)/)[1],u=i.QQ):"Chrome"===a?(u=i.Chrome,s=r.match(/chrome\/([\d.]+)/)[1]):"Firefox"===a?(s=r.match(/firefox\/([\d.]+)/)[1],u=i.Firefox):"Safari"===a?(s=r.match(/version\/([\d.]+)/)[1],u=i.Safari):"Edge"===a?(s=r.match(/edg\/([\d.]+)/)[1],u=i.ChromiumEdge):"LegacyEdge"===a?(s=r.match(/edge\/([\d.]+)/)[1],u=i.LegacyEdge):"Sogou"===a&&(u=i.Sogou,s=r.match(/chrome\/([\d.]+)/)[1]),n.type=u,n.version=parseInt(s,10)}}catch(e){n.type=i.Other,n.version=0}return n},t.getGPUInfo},function(e,t,r){"use strict";var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init,e}()),i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init,e}()),o=new(function()return e.prototype.init=function(){this.DOWNLOAD_ERROR=4,this.DOWNLOAD_MPD_ERROR=4001,this.DOWNLOAD_XINK_ERROR=4002,this.DOWNLOAD_INIT_SEGMENT_ERROR=4003,this.DOWNLOAD_MEDIA_SEGMENT_ERROR=4004,this.DOWNLOAD_INDEX_SEGMENT_ERROR=4005,this.DOWNLOAD_SWITCHING_SEGMENT_ERROR=4006,this.DOWNLOAD_OTHER_ERROR=4007,this.DOWNLOAD_FRAGMENT_ERROR=4101,this.DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS=4102,this.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE=4103,this.DOWNLOAD_FRAGMENT_ERROR_RANGE=4104,this.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT=4105,this.CONNECT_FRAGMENT_ERROR_TIMEOUT=4106,this.CONNECT_FRAGMENT_ERROR_OFFLINE=4107,this.CONNECT_NC_FRAGMENT_ERROR_TIMEOUT=4108,this.DOWNLOAD_PCDN_SCRIPT_ERROR=4201,this.DOWNLOAD_PCDN_SCRIPT_TIMEOUT=4202,this.DOWNLOAD_PCDN_DISABLED=4203,this.MANIFEST_ERROR=5,this.MANIFEST_TYPE_ERROR=5001,this.MANIFEST_RESOLVE_ERROR=5002,this.MEDIA_ERROR=6,this.MEDIA_ABORTED_ERROR=6001,this.MEDIA_NETWORK_ERROR=6002,this.MEDIA_DECODE_ERROR=6003,this.MEDIA_SUPPORTED_ERROR=6004,this.MEDIA_ENCRYPTED_ERROR=6005,this.MEDIA_UNKNOWN_ERROR=6e3,this.MEDIA_DECODE_ERROR_VIDEO="video",this.MEDIA_DECODE_ERROR_AUDIO="audio",this.MEDIA_DECODE_ERROR_UNKNOWN="unknown"},e}()),a=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""},s=r(0);function u(){var e={}return{on:function(r,n,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!r)throw new Error("event type cannot be null or undefined");if(!n||"function"!=typeof n)throw new Error("listener must be a function: "+n);if(!(t(r,n,i)>=0)){e[r]=e[r]||[];var a={callback:n,scope:i,priority:o},s=e[r].some());s||e[r].push(a)}},off,trigger,reset:function(){e={}}}}u.__dashjs_factory_name="EventBus";var l=s.a.getSingletonFactory(u);l.EVENT_PRIORITY_LOW=0,l.EVENT_PRIORITY_HIGH=5e3,s.a.updateSingletonFactory(u.__dashjs_factory_name,l);var d=l,f=r(3),p=new(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this));return r.BUFFERING_COMPLETED="bufferingCompleted",r.BUFFER_CLEARED="bufferCleared",r.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",r.BYTES_APPENDED="bytesAppended",r.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",r.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",r.CURRENT_TRACK_CHANGED="currentTrackChanged",r.DATA_UPDATE_COMPLETED="dataUpdateCompleted",r.DATA_UPDATE_STARTED="dataUpdateStarted",r.INITIALIZATION_LOADED="initializationLoaded",r.INIT_FRAGMENT_LOADED="initFragmentLoaded",r.INIT_REQUESTED="initRequested",r.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",r.LIVE_EDGE_SEARCH_COMPLETED="liveEdgeSearchCompleted",r.LOADING_COMPLETED="loadingCompleted",r.LOADING_PROGRESS="loadingProgress",r.LOADING_DATA_PROGRESS="loadingDataProgress",r.LOADING_ABANDONED="loadingAborted",r.MANIFEST_UPDATED="manifestUpdated",r.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",r.QUOTA_EXCEEDED="quotaExceeded",r.REPRESENTATION_UPDATED="representationUpdated",r.SEGMENTS_LOADED="segmentsLoaded",r.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",r.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",r.SOURCEBUFFER_REMOVE_COMPLETED="sourceBufferRemoveCompleted",r.STREAMS_COMPOSED="streamsComposed",r.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",r.STREAM_COMPLETED="streamCompleted",r.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",r.TIMED_TEXT_REQUESTED="timedTextRequested",r.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",r.URL_RESOLUTION_FAILED="urlResolutionFailed",r.VIDEO_CHUNK_RECEIVED="videoChunkReceived",r.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",r.XLINK_ELEMENT_LOADED="xlinkElementLoaded",r.XLINK_READY="xlinkReady",r.REQUEST_RETRYED="requestRetryed",r.BUFFER_CREATED="bufferCreated",r.VERIFY_SEGMENT_WARNING="verifySegmentWarning",r.INIT_HID="initHID",r.BIND_MEDIA_SOURCE_LOADER="bindMediaSourceLoader",r.SWITCH_AUDIO_TRACK_REQUEST="switchAudioTrackRequest",r.MULTI_AUDIO_TRACK_APPEND="multiAudioTrackAppend",r.SWITCH_AUDIO_TRACK_RENDERED="switchAudioTrackRendered",r.PREDICT_SEEK="predictSeek",r.JUMP_MEDIA_GAP="jumpMediaGap",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(f.a))),h=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,
this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null,this.timeout=1e4};h.ACTION_DOWNLOAD="download",h.ACTION_COMPLETE="complete";var y=h;function m(){var e,t=this.context,r=d(t).getInstance(),n=void 0,i=void 0,o=void 0,a=void 0,s=void 0;return e={log:function(){var e="",t=null;i&&(t=(new Date).getTime(),e+="["+(t-s)+"]"),o&&this&&this.getClassName&&(e+="["+this.getClassName()+"]",this.getType&&(e+="["+this.getType()+"]")),e.length>0&&(e+=" "),Array.apply(null,arguments).forEach()),n&&console.log(e),r.trigger(p.LOG,{message:e})},setLogTimestampVisible:function(e){i=e},setCalleeNameVisible:function(e){o=e},setLogToBrowserConsole:function(e){n=e},getLogToBrowserConsole:function(){return n},setABRLogVisible:function(e){a=e},getABRLogVisible},n=!1,a=!1,i=!0,o=!1,s=(new Date).getTime(),e}m.__dashjs_factory_name="Debug";var g=s.a.getSingletonFactory(m),v="loading",_="executed",E="failed";function b(e){e=e||{};var t=this.context,r=g(t).getInstance().log,n=d(t).getInstance(),i=e.metricsModel,o=e.fragmentLoader,a={},s=void 0,u=void 0,c=void 0,l=void 0;function f(e){var t;return!!e&&(t=!1,c.some((function(r){if(n=e,i=r,!isNaN(n.index)&&n.startTime===i.startTime&&n.adaptationIndex===i.adaptationIndex&&n.type===i.type|(e,r)|(e,r))return t=!0;var n,i})),t)}function h(e){return isNaN(e.duration)?.25:e.duration/8tion A(e){if(e.sender===o&&!e.error){if(l.splice(l.indexOf(e.request),1),e.response&&!e.error){var t=c&&c[c.length-1],i=u.getPlaybackController().getTime()||0,a=e.request,s=t&&(isNaN(t.index)||isNaN(t.startTime)&&isNaN(t.duration)),d=a&&(isNaN(a.index)||isNaN(a.startTime)&&isNaN(a.duration)),f=t&&(0===i||a.startTime-1<=i&&a.startTime+a.duration+1>=i),h=t&&a.index-t.index==1||c&&c.length&&c.filter((function(e){return a.index-e.index==1})).length||0===a.index;if(r("push",a.mediaType,JSON.stringify({index:a.index,isLastNaNRequest:s,isCurrentNaNRequest:d,isCurrentTimeInFirstRequest:f,isMediaRequest:h,currentTime:i,range:a.range})),!d&&f&&c.length>1&&!h&&c.splice(1,c.length-1),t&&!d&&!f&&!h)return void u.getScheduleController().start();c.push(e.request)}w(e.request,e.error?E:_),n.trigger(p.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this}),e.request&&e.request.p2pLoadInfo&&"{}"!=JSON.stringify(e.request.p2pLoadInfo)&&n.trigger(p.FRAGMENT_P2P_LOAD_INFO,{p2pLoadInfo:e.request.p2pLoadInfo}),e.request&&e.request.loadInfo&&"{}"!=JSON.stringify(e.request.loadInfo)&&n.trigger(p.CDN_LOAD_INFO,{loadInfo:e.request.loadInfo,NCInfo:e.request.NCInfo,mediaInfo:{mediaType:e.request.mediaType,quality:e.request.quality,id:e.request.representationId}})}}function R(e){e.sender===o&&n.trigger(p.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this})}function P(e){if(e.sender===o&&(n.trigger(p.FRAGMENT_LOADING_ABANDONED,{streamProcessor:this.getStreamProcessor(),request:e.request,mediaType:e.mediaType}),e.request&&e.request.NCInfo&&"{}"!=JSON.stringify(e.request.NCInfo))){var t=e.request;if(a!=={}&&a.mediaType===t.mediaType&&a.quality===t.quality&&a.range===t.range&&a.delayLoadingTime===t.delayLoadingTime)return;a={mediaType:t.mediaType,quality:t.quality,range:t.range,delayLoadingTime:t.delayLoadingTime},n.trigger(p.CDN_LOAD_INFO,{NCInfo:e.request.NCInfo,mediaInfo:{mediaType:e.request.mediaType,quality:e.request.quality,id:e.request.representationId}})}return s={setStreamProcessor:function(e){u=e},getStreamProcessor:function(){return u},getRequests:function(e){var t=e?e.state instanceof Array?e.state:[e.state]:[],r=[];return t.forEach((function(t){var n=T(t);r=r.concat(n,e))})),r},isFragmentLoaded:f,isFragmentLoadedOrPending,removeExecutedRequestsBeforeTime:m,removeExecutedRequestsAfterTime:function(e){c=c.filter((function(t){return isNaN(t.startTime)||void 0!==e&&t.startTime<=e}))},syncExecutedRequestsWithBufferedRange,clearExecutedRequestBySeeking,abortRequests,executeRequest:function(e){switch(e.action){case y.ACTION_COMPLETE:c.push(e),w(e,_),r("[FragmentModel] executeRequest trigger STREAM_COMPLETED"),n.trigger(p.STREAM_COMPLETED,{request:e,fragmentModel:this});break;case y.ACTION_DOWNLOAD:w(e,v),l.push(e),function(e){n.trigger(p.FRAGMENT_LOADING_STARTED,{sender:s,request:e});var t=u&&u.getBufferLevel();e.bufferLevel=t,e.startLoadFragmentTime=(new Date).getTime(),o.load(e)}(e);break;default:r("Unknown request action.")}},reset,addExecutedRequest:function(){},resetInitialSettings:D,getLastQnFragmentCompletedCnts:function(e){var t=0;if(c&&c.length>0)for(var r=c.length-1;r>=0&&e===c[r].quality;r--)t++;return t},resetPreloadData,syncExecutedRequestsWithMultipleLevels:function(e,t){if(e&&0!==e.length){for(var r=0,n=0,i=e.length;n<i;n++){var o=e[n];b(r,o.start),r=o.end}t>0&&b(r,t)}else m()},getRequestsForState:T,getLoadingRequests:function(){return l}},D(),n.on(p.LOADING_COMPLETED,A,s),n.on(p.LOADING_DATA_PROGRESS,R,s),n.on(p.LOADING_ABANDONED,P,s),s}b.__dashjs_factory_name="FragmentModel";var S=s.a.getClassFactory(b);S.FRAGMENT_MODEL_LOADING=v,S.FRAGMENT_MODEL_EXECUTED=_,S.FRAGMENT_MODEL_CANCELED="canceled",S.FRAGMENT_MODEL_FAILED=E,s.a.updateClassFactory(b.__dashjs_factory_name,S);var T=S,w=function e(t,r,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=r||null,this.data=n||null,this.errorCode=i||null,this.httpCode=o||null};function A(e,t,r){var n=this.context,i=g(n).getInstance().log,o=d(n).getInstance(),a=void 0,s=void 0,u=[],c=rfunction f(){var e=this;if(u.length>0){s=!0;var t=u[0];u.splice(0,1);var r=[],n=function(){var n=l();!function(e,t,r,n){t&&t.length>0&&t.length<r.length&(t,n)&&o.trigger(p.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:e,from:r.end(r.length-2),to:r.start(r.length-1),unintended:!0})}(e,r,n,t),u.length>0?f.call(this):(s=!1,c&&c({chunk:t}))};try{0===t.bytes.length?n.call(this):(r=l(),a.appendBuffer?a.appendBuffer(t.bytes):a.append(t.bytes,t),h(a,n.bind(this)))}catch(e){i('SourceBuffer append failed "'+e+'"'),u.length>0?f():s=!1,c&&c({chunk:t,error:new w(e.code,e.message,null)})}}}function h(e,t){var r=void 0,n;if(e.updating)if("function"==typeof e.addEventListener)try{e.addEventListener("updateend",),!1)}catch(e){r=setInterval(n,50)
}else r=setInterval(n,50);else t()}var y={getAllBufferRanges:l,getBuffer:function(){return a},append:function(e){u.push(e),s||h(a,f.bind(this))},remove:function(t,r,n){var i=this;h(a,(function(){try{t>=0&&r>t&&(n||"ended"!==e.readyState)&&a.remove(t,r),h(a,(function(){o.trigger(p.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:i,from:t,to:r,unintended:!1})}))}catch(e){o.trigger(p.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:i,from:t,to:r,unintended:!1,error:new w(e.code,e.message,null)})}}))},abort:function(){try{("open"===e.readyState||a.setTextTrack&&"ended"===e.readyState)&&a.abort()}catch(e){i('SourceBuffer append abort failed: "'+e+'"')}u=[]},reset:function(){if(a){try{e.removeSourceBuffer(a)}catch(e){i("Failed to remove source buffer from media source.")}s=!1,a=null}u=[],c=null},setAppendWindowEnd:function t(r){r<=0||h(a,(function(){if("open"===e.readyState)a.appendWindowEnd=r;else var n=setTimeout(),50)}))},updateTimestampOffset:function(e){a.timestampOffset===e||isNaN(e)||h(a,))}};return function(){s=!1;var r=t.codec;try{if(r.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))throw new Error("not really supported");a=e.addSourceBuffer(r)}catch(e){throw e}}(),y}A.__dashjs_factory_name="SourceBufferSink";var R=s.a.getClassFactory(A);function P(e){var t=this.context,r=g(t).getInstance().log,n=[],i=void 0,o=ereturn{getAllBufferRanges,append:function(e){"InitializationSegment"!==e.segmentType?(n.push(e),n.sort()),i=null):i=e,r("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),o&&o({chunk:e})},remove:a,abort:function(){},discharge,reset}}P.__dashjs_factory_name="PreBufferSink";var D=s.a.getClassFactory(P),O={DEFAULT:.5,STRONG:1,WEAK:0}I.__dashjs_factory_name="SwitchRequest";var C=s.a.getClassFactory(I);C.NO_CHANGE=-1,C.PRIORITY=O,s.a.updateClassFactory(I.__dashjs_factory_name,C);var N=C;function k(e){e=e||{};var t=this.context,r=g(t).getInstance().log,n=e.metricsModel;return{getMaxIndex:function(e){var i=N(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getStreamProcessor")))return i;();var o=e.getMediaInfo(),a=e.getMediaType(),s=n.getReadOnlyMetricsFor(a),u=e.getStreamProcessor(),c=e.getAbrController(),l=e.getStreamInfo(),d=l&&l.manifestInfo?l.manifestInfo.isDynamic:null,f=c.getThroughputHistory(),p=f.getSafeAverageThroughput(a,d),h=f.getAverageLatency(a),y=s.BufferState.length>0?s.BufferState[s.BufferState.length-1]:null,m=e.useBufferOccupancyABR();return!s||isNaN(p)||!y||m||c.getAbandonmentStateFor(a)!==oe.ABANDON_LOAD&&(y||d)&&(i.quality=c.getQualityForBitrate(o,p,h),u.getScheduleController().setTimeToLoadDelay(0),r("ThroughputRule requesting switch to index: ",i.quality,"type: ",a,"Average throughput",Math.round(p),"kbps"),i.reason={throughput:p,latency:h}),i},reset:function(){}}}k.__dashjs_factory_name="ThroughputRule";var L=s.a.getClassFactory(k);function x(e){e=e||{};var t=this.context,r=g(t).getInstance().log,n=e.mediaPlayerModel,i=e.metricsModel,o=e.dashMetrics,a=void 0,s=void 0,u=void 0var l={shouldAbandon:function(e){var c=N(t).create(N.NO_CHANGE,{name:x.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return c;var l,d,f=e.getMediaInfo(),p=e.getMediaType(),h=e.getCurrentRequest();if(!isNaN(h.index)){l=p,d=h.index,a[l]=a[l]||{},a[l][d]=a[l][d]||{};var y=n.getStableBufferTime(),m=o.getCurrentBufferLevel(i.getReadOnlyMetricsFor(p));if(m>y)return c;var g=a[p][h.index];if(null===g||null===h.firstByteDate||s.hasOwnProperty(g.id))return c;if(void 0===g.firstByteTime&&(u[p]=[],g.firstByteTime=h.firstByteDate.getTime(),g.segmentDuration=h.duration,g.bytesTotal=h.bytesTotal,g.id=h.index),g.bytesLoaded=h.bytesLoaded,g.elapsedTime=(new Date).getTime()-g.firstByteTime,g.bytesLoaded>0&&g.elapsedTime>0&(p,Math.round(8*g.bytesLoaded/g.elapsedTime)),u[p].length>=5&&g.elapsedTime>500&&g.bytesLoaded<g.bytesTotal){var v=u[p].reduce((function(e,t){return e+t}),0);g.measuredBandwidthInKbps=Math.round(v/u[p].length),g.estimatedTimeOfDownload=+(8*g.bytesTotal/g.measuredBandwidthInKbps/1e3).toFixed(2);var _=g.estimatedTimeOfDownload;if(_<1.8*g.segmentDuration&&_<.8*m||0===e.getRepresentationInfo().quality)return c;if(!s.hasOwnProperty(g.id)){var E=e.getAbrController(),b=g.bytesTotal-g.bytesLoaded,S=E.getBitrateList(f),T=E.getQualityFor(p,f.streamInfo),w=function(e,t,r){var o=E.getQualityForBitrate(f,g.measuredBandwidthInKbps*n.getBandwidthSafetyFactor()),a=E.getMinAllowedIndexFor(p),s=i.getReadOnlyMetricsFor(p),u=s.BufferState.length>0?s.BufferState[s.BufferState.length-1]:null;return t>=.8*r&&o>e?e>0?e-1:e:r<1||u&&u.state===Le.BUFFER_EMPTY?0:void 0!==a?Math.max(a,o):o}(T,_,m);b>g.bytesTotal*S[w].bitrate/S[T].bitrate&&w!==T&&(c.quality=w,c.reason.throughput=g.measuredBandwidthInKbps,c.reason.fragmentID=g.id,s[g.id]=g,r("AbandonRequestsRule ( ",p,"frag id",g.id,") is asking to abandon and switch to quality to ",w,"from quality "+T," measured bandwidth was",g.measuredBandwidthInKbps),delete a[p][g.id])}}else g.bytesLoaded===g.bytesTotal&&delete a[p][g.id]}return c},reset:c};return c(),l}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}x.__dashjs_factory_name="AbandonRequestsRule",s.a.getClassFactory(x);var F,U;function B(e){e=e||{};var t=this.context,r=g(t).getInstance().log,n=e.dashMetrics,o=e.metricsModel,a=e.mediaPlayerModel,s=d(t).getInstance(),u=void 0,c=void 0function f(){for(var e in c)if(c.hasOwnProperty(e)){var t=c[e];0!==t.state&&l(t)}}function h(){}function y(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){var r=n.getCurrentBufferLevel(o.getReadOnlyMetricsFor(t))+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),i=function(e,t){return e.Vp*(e.utilities[t]+e.gp)}(e,e.lastQuality),a=Math.max(0,i-r);e.placeholderBuffer=Math.min(a,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}function v(e){if(e&&e.metric===i.HTTP_REQUEST&&e.value&&e.value.type===F.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=c[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),y(t,e.mediaType))}unction b(e,t,r,n){var i=e.getRealBufferLevel();return+(5*r[t].bandwidth/(1e3*n)).toFixed(2)>i-3return u={getMaxIndex:function(e){var i=e.getMediaInfo(),s=e.getMediaType(),u=o.getReadOnlyMetricsFor(s),d=e.getStreamProcessor(),f=e.getStreamInfo(),p=e.getAbrController(),h=p.getThroughputHistory(),y=(f&&f.id,f&&f.manifestInfo&&f.manifestInfo.isDynamic),m=e.useBufferOccupancyABR(),g=N(t).create();if(g.reason=g.reason||{},!m)return g;d.getScheduleController().setTimeToLoadDelay(0);var v=function(e){var t=e.getMediaType(),r=c[t];return r||(r=function(e){var t={},r=e.getMediaInfo().bitrateList.map((function(e){return e.bandwidth})),n(r);n=n.map());var i=a.getStableBufferTime(),o=function(e,t,r){var n=r.reduce(),0);if(0===n)return null;var i=Math.max(e,10+2*t.length),o=(r[n]-1)/(i/10-1);return{gp:o,Vp:10/o}}(i,r,n);return o?(t.state=1,t.bitrates=r,t.utilities=n,t.stableBufferTime=i,t.Vp=o.Vp,t.gp=3,t.lastQuality=0,l(t)):t.state=0,t}(e),c[t]=r),r}(e);if(0===v.state)return g;var _=n.getCurrentBufferLevel(u),E=h.getAverageThroughput(s,y),S=h.getSafeAverageThroughput(s,y),T=h.getAverageLatency(s),w=void 0;if(g.reason.state=v.state,g.reason.throughput=E,g.reason.latency=T,isNaN(E))return g;switch(v.state){case 1:w=p.getQualityForBitrate(i,.4*S,T);var A=e.getCurrentValue();w>A&&(w=A),g.quality=w,g.reason.throughput=S,v.lastQuality=w,v.lastPredictQn=w,isNaN(v.lastSegmentDurationS),!isNaN(v.lastSegmentDurationS)&&_>=1*v.lastSegmentDurationS&&(v.state=2),r("bolaV2 "+s+"use throughput qn is "+i.bitrateList[w].id);break;case 2:var R=p.getPlaybackRate(),P=p.getRealBufferLevel();w=function(e,t,n,i){var o=0,s=n.getMediaInfo(),u=n.getMediaType(),c=n.getAbrController(),l=c.getThroughputHistory(),d=l.getAverageLatency(u);if(e>i){var f=l.getMinThroughput(u),p=t;o=f*a.getFactorByBufferLevel(p),r("bolaV2 cac "+u+" min throughput: "+f)}else o=l.getSafeAverageThroughput(u),r("bolaV2 cac "+u+" avg throughput: "+l.getAverageThroughput(u));var h=c.getQualityForBitrate(s,o,d),y=s.bitrateList;if(r("bolaV2 adjust "+u+"startQn: "+y[e].id+", curQn: "+y[i].id+", cache: "+t+", adapter: "+o+", latency: "+d+", thQn: "+y[h].id),e>i)e=h<i||c.getHasChangedByABRStrategy(u)&&c.getLastQnFragmentCompletedCnts(u,i)<3||c.getRealBufferLevel()<12?h<i&&b(c,i,y,o)?h:i:h>e?e:h;else{var m=l.getDict(u);h>=i||!m||m.length<2?b(c,i,y,o)&&(e=i):(h>e||h<e&&b(c,e,y,o))&&(e=h)}return e}(w=function(e,t,n,i,o){var a=t.bitrates.length,s=Math.min(1,n/e)/o,u=NaN,c=NaN,l=t.utilities,d=t.gp,f=l[l.length-1];r("bolaV2 getQn "+i+", efcBuf: "+e+", curBufLv: "+s+", high: "+f);for(var p=a-1;p>=0;p--){var h=s;p<t.lastQuality&&(h=Math.min(1,h+.1));var y=t.utilities[p],m=((y+d)/(f+d)-h)/y;(isNaN(c)||m>=c)&&(c=m,u=p)}return u}(p.getEffectiveBufferTime(),v,P,s,R),P/R,e,v.lastPredictQn),g.quality=w,g.reason.throughput=E,g.reason.latency=T,g.reason.bufferLevel=P,v.lastQuality=w,v.lastPredictQn=w,r("bolaV2 "+s+"final qn is "+i.bitrateList[w].id);break;case 3:w=p.getQualityForBitrate(i,.5*S,T),!isNaN(v.lastSegmentDurationS)&&_>=1*v.lastSegmentDurationS&&(v.state=2),g.quality=w,g.reason.throughput=E,g.reason.latency=T,g.reason.bufferLevel=_,r("bolaV2 "+s+"seek use throughput qn is "+i.bitrateList[w].id);break;default:r("BOLA ABR rule invoked in bad state."),g.quality=p.getQualityForBitrate(i,S,T),g.reason.state=v.state,g.reason.throughput=S,g.reason.latency=T,v.state=1,l(v)}return g},reset:function(){S(),s.off(p.PLAYBACK_xING,f,u),s.off(p.PERIOD_SWITCH_STARTED,h,u),s.off(p.MEDIA_FRAGMENT_LOADED,m,u),s.off(p.METRIC_ADDED,v,u),s.off(p.QUALITY_CHANGE_REQUESTED,_,u),s.off(p.FRAGMENT_LOADING_ABANDONED,E,u)}},S(),s.on(p.PLAYBACK_SEEKING,f,u),s.on(p.PERIOD_SWITCH_STARTED,h,u),s.on(p.MEDIA_FRAGMENT_LOADED,m,u),s.on(p.METRIC_ADDED,v,u),s.on(p.QUALITY_CHANGE_REQUESTED,_,u),s.on(p.FRAGMENT_LOADING_ABANDONED,E,u),u}F.GET="GET",F.HEAD="HEAD",F.MPD_TYPE="MPD",F.XLINK_EXPANSION_TYPE="XLinkExpansion",F.INIT_SEGMENT_TYPE="InitializationSegment",F.INDEX_SEGMENT_TYPE="IndexSegment",F.MEDIA_SEGMENT_TYPE="MediaSegment",F.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",F.OTHER_TYPE="other",B.__dashjs_factory_name="BolaRuleV2";var j=s.a.getClassFactory(B),V="qualitySwitchRules",H="abandonFragmentRules";function G(e){e=e||{};var t=this.context,r=e.mediaPlayerModel,n=e.metricsModel,i=e.dashMetrics,o=void 0,a=void 0;fueturn e.quality>N.NO_CHANGE}))}function u(e){var r,n={},i=void 0,o=void 0,a=void 0,s=void 0;if(0!==e.length){for(n[N.PRIORITY.STRONG]=N.NO_CHANGE,n[N.PRIORITY.WEAK]=N.NO_CHANGE,n[N.PRIORITY.DEFAULT]=N.NO_CHANGE,i=0,r=e.length;i<r;i+=1)(o=e[i]).quality!==N.NO_CHANGE&&(n[o.priority]=n[o.priority]>N.NO_CHANGE?Math.min(n[o.priority],o.quality):o.quality);return n[N.PRIORITY.WEAK]!==N.NO_CHANGE&&(a=n[N.PRIORITY.WEAK]),n[N.PRIORITY.DEFAULT]!==N.NO_CHANGE&&(a=n[N.PRIORITY.DEFAULT]),n[N.PRIORITY.STRONG]!==N.NO_CHANGE&&(a=n[N.PRIORITY.STRONG]),a!==N.NO_CHANGE&&(s=a),N(t).create(s)}}return{initialize:function(){o=[],a=[],r.getUseDefaultABRRules()&&(o.push(j(t).create({metricsModel:n,dashMetrics:i,mediaPlayerModel:r})),o.push(L(t).create({metricsModel:n,dashMetrics:i}))),r.&a.push(e&&e.reset()}))})),o=[],a=[]},getMaxQuality:function(e){return u(s(o.map((function(t){return t.getMaxIndex(e)}))))||N(t).create()},shouldAbandonFragment:function(e){return u(s(a.map((function(t){return t.shouldAbandon(e)}))))||N(t).create()}}}G.__dashjs_factory_name="ABRRulesCollection";var q=s.a.getClassFactory(G);q.QUALITY_SWITCH_RULES=V,q.ABANDON_FRAGMENT_RULES=H,s.a.updateSingletonFactory(G.__dashjs_factory_name,q);var W=q,K=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN,this.id=""};function Y(e){var t=(e=e||{}).abrController,r=e.streamProcessor,n=e.streamProcessor.getCurrentRepresentationInfo(),i=e.switchHistory,o=e.droppedFramesHistory,a=e.currentRequest,s=e.useBufferOccupancyABR,u=e.currentValue;return{getMediaType:function(){return n.mediaInfo.type},getMediaInfo:function(){return n.mediaInfo},getDroppedFramesHistory:function(){return o},getCurrentRequest:function(){return a},getSwitchHistory:function(){return i},getStreamInfo:function(){return n.mediaInfo.streamInfo},getStreamProcessor:function(){return r},getAbrController:function(){return t},getRepresentationInfo:function(){return n},useBufferOccupancyABR:function(){return s},getCurrentValue:function(){return u}}}Y.__dashjs_factory_name="RulesContext";var Q=s.a.getClassFactory(Y);function z(){var e=[],t=[];return{push:function(r){r.newValue===N.NO_CHANGE&&(r.newValue=r.oldValue),e[r.oldValue]||(e[r.oldValue]={noDrops:0,drops:0,dropSize:0});var n=r.newValue-r.oldValue,i=n<0?1:0,o=i?-n:0,a=i?0:1;if(e[r.oldValue].drops+=i,e[r.oldValue].dropSize+=o,e[r.oldValue].noDrops+=a,t.push({idx:r.oldValue,noDrop:a,drop:i,dropSize:o}),t.length>8){var s=t.shift();e[s.idx].drops-=s.drop,e[s.idx].dropSize-=s.dropSize,e[s.idx].noDrops-=s.noDrop}},getSwitchRequest,reset:function(){e=[],t=[]}}}z.__dashjs_factory_name="SwitchRequestHistory";var Z=s.a.getClassFactory(z);function J(){ames:s,totalVideoFrames:u})},getFrameHistory:functppedFrFrames,r=n.totalVideoFrames}}}J.__dashjs_factory_name="DroppedFramesHistory";var X=s.a.getClassFactory(J);function $(e){var t=(e=e||{}).mediaPlayerModel,r=void 0,i=void owEstimate,e.totalWeight+=r}function c(e,u,c){return t.getMovingAverageMethod()!==n.MMath.min(i,u):Math.max(i,u)}(e,u):function(e,t,n){var o=function(e,t,n){var o=void 0,a=void 0;if(e?(o=r[t],a=n?3:4):(o=i[t],a=4),o){if(a>=o.length)a=o.length;else if(e)for(var s=1;s<a;++s){var u=o[s]/o[s-1];if((u>=1.3||u<=1/1.3)&&(a+=1)===o.length)break}}else a=0;return a}(e,t,n),a=(e?r:i)[t];return 0!==o&&a&&0!==a.lee((function(e,t){returnn f(){r={},i={},o={},a={}}var p={push:function(e,c,l){if(c.trace&&c.trace.length){var f=c.tresponse.getTime()-c.trequest.getTime()||1,p=c._tfinish.getTime()-c.tresponse.genction(e,t){return e+t.b[0]}),0),y=f+p,m=Math.round(8*h/y);if(!(h<1e4)){if(d(e),function(e,r,i){return e===n.VIDEO?i+r<t.getCacheLoadThresholdForType(n.VIDEO):e===n.AUDIO?i+r<t.getCacheLoadThresholdForType(n.AUDIO):void 0}(e,f,p)){if(r[e].length>0&&!r[e].hasCachedEntries)return;r[e].hasCachedEntries=!0}else elete o[e],delete a[e],d(e)}(e);m>9900&&(m=9900),r[e].push(m),r[e].length>5&&r[e].shift(),i[e].push(f),i[e].length>5&&i[e].shift(),u(o[e],m,.001*p,s.throughputHalfLife),u(a[e],f,1,s.latencyHalfLife)}}},getAverageThroughput:l,getSafeAverageThroughput:function(e,r){var n=l(e,r);return isNaN(n)||(n*=t.getBandwidthSafetyFa:function(e){return c(!1,e)},getMinThroughput:function(eturn r}return Arroughput:r[e],latency:i[e]}},onProgress:function(e,t){if(!t.requestStartDate&&!t.p2pLoadInfo||"video"!==e)return!1;var n=(new Date).getTime(),a=null;if(t.headersReceivedDate?a=t.headersReceivedDate.getTime():t.p2pLoadInfo.requestStartTime&&(a=t.p2pLoadInfo.requestStartTime.getTime()),a){var c=n-a||1,l=null;t.headersReceivedDate&&t.requestStartDate&&(l=t.headersReceivedDate.getTime()-t.requestStartDate.getTime());var f=c,p=t.bytesLoaded;if(p<76100)return!1;t.lastByte=p;var h=Math.round(8*p/f);return t.p2pLoadInfo&&t.p2pLoadInfo.requestStartTime,d(e),"number"!=typeof l||isNaN(l)||(i[e].push(l),i[e].length>5&&i[e].shift()),h>9900&&(h=9900),r[e].push(h),r[e].length>5&&r[e].shift(),u(o[e],h,.001*c,s.throughputHalfLife),!0}},reset:f};return s={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},f(),p}$.__dashjs_factory_name="ThroughputHistory";var ee=s.a.getClassFactory($),te="abandonload",re="allowload";function ne(){var e=this.context,t=g(e).getInstance(),r=d(e).getInstance(),o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,y=void 0,m=void 0,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,O=void 0,I=void 0,C=void 0,k=void 0,L=void 0,x=void 0,M=void 0,U=void 0,B=void 0,j=void 0,V=void 0,H=void 0,G=void 0,q={video:0,audio:0},Y={video:{},audio:{}};function z(e){var t=e.request.mediaType;"MediaSegment"===e.request.type&&"video"===t&&M.onProgress(t,e.request,e.response)}function J(e){e||(c={video:!0,audio:!0}),l={},f={},h={},y={},v={},m={},L={},U={},E=!1,V=!0,b=!1,void 0===S&&(S=!1),k=void 0,x=void 0,M=void 0,clearTimeout(_),_=null,H={video:!1,audio:!1}}function $(e){e.mediaType===n.VIDEO&&(k=e.oldQuality,x.push(k,O.getPlaybackQuality()))}function ne(e){e.metric!==i.HTTP_REQUEST||!e.value||e.value.type!==F.MEDIA_SEGMENT_TYPE||e.mediaType!==n.AUDIO&&e.mediaType!==n.VIDEO||M.push(e.mediaType,e.value,V),e.metric!==i.BUFFER_LEVEL||e.mediaType!==n.AUDIO&&e.mediaType!==n.VIDEO||function(e,t){var r=I.getABRStrategy();if(r!==n.ABR_STRATEGY_BOLA)if(r!==n.ABR_STRATEGY_THROUGHPUT){var i=I.getStableBufferTime(),o=i,s=.5*i,u=U[e],c=t>(u?s:o);U[e]=c,c!==u&&a(c?"AbrController ("+e+") switching from throughput to buffer occupancy ABR rule (buffer: "+t.toFixed(3)+").":"AbrController ("+e+") switching from buffer occupancy to throughput ABR rule (buffer: "+t.toFixed(3)+").")}else U[e]=!1;else U[e]=!0}(e.mediaType,.001*e.value.level)}function ie(e,t){return l[t]=l[t]||{},l[t].hasOwnProperty(e)||(l[t][e]=0),function(e,t){if(t!==n.VIDEO||!E||!m[t])return e;S||ve();var r=R.getValue(),i=P.getAdaptationForType(r,0,t).Representation,o=e;if(w>0&&A>0){for(;o>0&&i[o]&&w<i[o].width&&w-i[o-1].width<i[o].width-w;)o-=1;i.length-2>=o&&i[o].width===i[o+1].width&&(o=Math.min(e,o+1))}return o}(function(e,t,r){var n=ce(t);return isNaN(n)||n>=1||n<0?e:Math.min(e,Math.round(r*n))}(function(e,t){var r=e;if(!m[t])return r;var n=ue(t);void 0!==n&&(r=Math.max(e,n));var i=se(t);return void 0!==i&&(r=Math.min(r,i)),r}(l[t][e],e),e,l[t][e]),e)}function oe(e){return h.hasOwnProperty("max")&&h.max.ha].getMediaInfo(),t):void 0}function ue(e){var t=ae(e);if(t){var r=ye(m[e].getMediaInfo()),n=he(m[e].getMediaInfo(),t);return r[n]&&n<r.length-1asOwnProperty(e)?y.max[e]:1}function le(e){return c[e]}function de(e,t,r,n){var i=t.id,o=ge(e);if(null===r||isNaN(r)||r%1!=0)throw new Error("argument is not an integer");var a=ie(e,i);r!==o&&r>=0&&r<=a&&fe(e,o,r,a,n)}function fe(e,n,i,o,s){if(e&&m[e]){var u=m[e].getStreamInfo(),c=u?u.id:null;if(t.getABRLogVisible()){var l=j.getCurrentBufferLevel(B.getReadOnlyMetricsFor(e));a("AbrController ("+e+") switch from "+n+" to "+i+"/"+o+" (buffer: "+l+") "+(s?JSON.stringify(s):"."))}!function(e,t,r){f[t]=f[t]||{},f[t][e]=r}(e,c,i),r.trigger(p.QUALITY_CHANGE_REQUESTED,{mediaType:e,streamInfo:u,oldQuality:n,newQuality:i,reason:s})}}function pe(e,t){v[e].state=t,v[e].time=t===te?performance.now():NaN}function he(e,t,r){if(V&&r&&m[e.type].getCurrentRepresentationInfo()&&m[e.type].getCurrentRepresentationInfo().fragmentDuration){r/=1e3;var n=m[e.type].getCurrentRepresentationInfo().fragmentDuration;if(r>n)return 0;t*=1-r/n}var i=ye(e);if(!i||0===i.length)return 0;for(var o=i.length-1;o>=0;o--)if(1e3*t>=i[o].bitrate)return o;return 0}function ye(e){if(!e||!e.bitrateList)return null;for(var t=e.bitrateList,r=e.type,n=[],i=void 0,o=0,a=t.length;o<a;o++)(i=new K).mediaType=r,i.qualityIndex=o,i.id=t[o].id,i.bitrate=t[o].bandwidth,i.width=t[o].width,i.height=t[o].height,i.scanType=t[o]}function me(e){return U[e]}function ge(e){if(e&&m[e]){var t=m[e].getStreamInfo(),r=t?t.id:null;if(r)return f[r]=f[r]||{},f[r].hasOwnProperty(e)||(f[r][e]=E*e,A=O.getClientHeight()*e}}function _e(t){var r=t.request.mediaType;if(le(r)){var n=m[r];if(!n)return;var i=Q(e).create({abrController:o,streamProcessor:n,currentRequest:t.request,useBufferOccupancyABR:me(r)}),a=s.shouldAbandonFragment(i);if(a.quality>N.NO_CHANGE){
var c=n.getFragmentModel();c.getRequests({state:T.FRAGMENT_MODEL_LOADING,index:t.request.index})[0]&&(c.abortRequests(),pe(r,te),L[r].reset(),L[r].push({oldValue:ge(r,u.getActiveStreamInfo()),newValue:a.quality,confidence:1,reason:a.reason}),de(r,u.getActiveStreamInfo(),a.quality,a.reason),c(function(){pe(r,re),_=null}),I.getAbandonLoadTimeout()))}}}function Ee(e){if(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]){var t=I.getPreloadData();if(t&&t[e+"id"])return m[e].getRepresentationController().getQualityForRepresentationId(t[e+"id"])}return q[e]||0}return o={isPlayingAtTopQuality:function(e){var t=e.id,r=ge(n.AUDIO),i=ge(n.VIDEO);return r===ie(n.AUDIO,t)&&i===ie(n.VIDEO,t)},updateTopQualityIndex:function(e){var t=e.type,r=e.streamInfo.id,n=e.,r){l[t]=l[t]||{},l[t][e]=r}(t,r,n),n},getThroughputHistory:function(){return M},getBitrateList:ye,getQualityForBitrate:he,getMaxAllowedBitrateFor:oe,getTopBitrateInfoFor:function(e){if(e&&m&&m[e]){var t=m[e].getStreamInfo();if(t.id){var r=ie(e,t.id),n=ye(m[e].getMediaInfo());return n[r]?n[r]:null}}return null},getMinAllowedBitrateFor:ae,setMaxAllowedBitrateFor:function(e,t){h.max=h.max||{},h.max[e]=t},setMinAllowedBitrateFor:function(e,t){h.min=h.min||{},h.min[e]=t},getMaxAllowedIndexFor:se,getMinAllowedIndexFor:ue,getMaxAllowedRepresentationRatioFor:ce,setMaxA{y.max=y.max||{},y.max[e]=t},getInitialBitrateFor:function(e){var t=C.getSavedBitrateSettings(e);if(!h.hasOwnProperty(e))if(y.hasOwnProperty(e)){var r=R.getValue(),i=P.getAdaptationForType(r,0,e).Representation;if(Array.isArray(i)){var o=Math.max(Math.round(i.length*y[e])-1,0);h[e]=i[o].bandwidth}else h[e]=0}else isNaN(t)?h[e]=e===n.VIDEO?1e3:100:h[e]=t;return h[e]},setInitialBitrateFor:function(e,t){h[e]=t},getIhasOwnProperty(e)?y[e]:null},setInitialRepresentationRatioFor:function(e,t){y[e]=t},setAutoSwitchBitrateFor:function(e,t){c[e]=t},getAutoSwitchBitrateFor:le,getUseDeadTimeLatency:function(){return V},setUseDeadTimeLatency:function(e){V=e},setLimitBitrateByPortal:function(e){E=e},getLimitBitrateByPortal:function(){return E},getUsePixelRatioInLimitBitrateByPortal:function(){return b},setUsePixelRatioInLimitBitrateByPortal:function(e){b=e},getQualityFreturn v[e]?v[e].state:null},setPlaybackQuality:de,checkPlaybackQuality:function(r){if(r&&m&&m[r]){var n=m[r].getStreamInfo(),i=n?n.id:null,u=ge(r),c=Q(e).create({abrController:o,streamProcessor:m[r],currentValue:u,switchHistory:L[r],droppedFramesHistory:x,useBufferOccupancyABR:me(r)});if(x){var l=O.getPlaybackQuality();l&&x.push(k,l)}if(le(r)){var d=ue(r),f=ie(r,i),p=s.getMaxQuality(c),h=p.quality;if(void 0!==d&&h<d&&(h=d),h>f&&(h=f),L[r].push({oldValue:u,newValue:h}),h>N.NO_CHANGE&&h!=u){if(v[r].state===re||h>u)return H[r]=!0,fe(r,u,h,f,p.reason),!0}else if(t.getABRLogVisible()){var y=j.getCurrentBufferLevel(B.getReadOnlyMetricsFor(r));a("AbrController ("+r+") stay on "+u+"/"+f+" (buffer: "+y+")")}}}return!1},getTopQualityIndexFor:ie,setElementSize:ve,setWindowResizeEventCalled:function(e){S=e},createAbrRulesCollection:function(){(s=W(e).create({metricsModel:B,dashMetrics:j,mediaPlayerModel:I,videoModel:O,adapter:D})).initialize()},registerStreamType:function(t,i){L[t]=Z(e).create(),m[t]=i,v[t]=v[t]||{},v[t].state=re,U[t]=!1,r.on(p.LOADING_PROGRESS,_e,this),r.on(p.FRAGMENT_LOADING_PROGRESS,z,this),t==n.VIDEO&&(r.on(p.QUALITY_CHANGE_RENDERED,$,this),x=X(e).create()),r.on(p.METRIC_ADDED,ne,this),M=ee(e).create({mediaPlayerModel:I})},unRegisterStreamType:function(e){delete m[e]},setDefaultQualityFor:function(e,t){q[e]=Number(t)||0,a("Set default quality for "+e+" - "+q[e])},getDefaultQualityFor:Ee,getDroppedFramesInfo:function(){return x&&x.getFrameInfo&&x.getFrameInfo()||nfoFor:function(e,t){Y[e]=t},getCurrentSegmentInfoFor:function(e){return Y[e]},getInitializeDate:function(){return G},getHasChangedByABRStrategy:functiDate&&(G=e.initializeDate))},getLastQnFragmentCompletedCnts:function(e,t){var r=m[e];return r?r.getFragmentModel().getLastQnFragmentCompletedCnts(t):0},getEffectiveBufferTime:function(){var e,t=I.getStableBufferTime(),r=O.getTime(),n=O.getDuration()-r,i=(new Date).getTime(),o=I.getLastStartSeekTime(),s=I.getStartPlaybackTime(),u=(i-Math.max(o,s))/1e3;return e=u<10?Math.min(10,t):Math.min(Math.min(n,u),t),a("bolaV2 getEfcmax: "+t+", curTime: "+r+",playTime: "+u+"){return O.getPlaybackRate()||1},reset:function(){J(!0),r.off(p.LOADING_PROGRESS,_e,this),r.off(p.FRAGMENT_LOADING_PROGRESS,z,this),r.off(p.QUALITY_CHANGE_RENDERED,$,this),r.off(p.METRIC_ADDED,ne,this),s&&s.reset()},shouldAbandon:function(e,t){var r=e.retry,n=e.retryTimes,i=e.bytesTotal,o=e.bytesLoaded;return r>0||n>0||+((i-o)/(1e3*M.getSafeAverageThroughput(t,!1))).toFixed(2)>j.getCurrentBufferLevel(B.getReadOnlyMetricsFor(t))-5},getRealBufferLevel:function(){var e=O.getVideoBufferRanges();if(!e||e.length<=0)return 0;var t=O.getTime();return e[e.length-1].end-t||0}},a=t.log.bind(o),J(),o}ne.__dashjs_factory_name="AbrController";var ie=s.a.getSingletonFactory(ne);ie.ABANDON_LOAD=te,ie.QUALITY_DEFAULT=0,s.a.updateSingletonFactory(ne.__dashjs_factory_name,ie);var oe=ie,ae="neverReplace",se="alwaysReplace",ue="highestBitrate",ce="widestRange",le=ue;function de(){var e,t=this.context,r=g(t).getInstance().log,i=d(t).getInstance(),o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=[se,a[t.id]?null:o[t.id][e].current}function v(e){if(e){var t=e.type,r=e.streamInfo,n=r.id,a=m(t,r);if(o[n]&&o[n][t]&&(!a||!T(e,a))){o[n][t].current=e,a&&i.trigger(p.CURRENT_TRACK_CHANGED,{oldMediaInfo:a,newMedelConfiguration.length>0?t:null}(e);s&&o[n][t].storeLastSettings&&(s.roles&&(s.role=s.roles[0],delete s.roles),s.accessibility&&(s.accessibility=s.accessibility[0]),s.audioChannelConfiguration&&(s.audioChannelConfiguration=s.audioChannelConfiguration[0])g();return r&&n&&i&&o&&a&&s}function w(){o={},a={audio:null,vtion}))[0];return r&&n&&i&&o&&a}function R(e){var t=b(),n=[],i=function(e){var t=0>t?(t=n,r=[e]):n===t&&r.push(e)})),r},o=function(e){var t=0>t?(t=n,r=[e]):n===t&&r.push(e)})),r}
;switch(t){case ue:(n=i(e)).length>1&&(n=o(n));break;case ce:(n=o(e)).length>1&&(n=i(e));break;default:r("track selection mode is not supported: "+t)}return n[0]}return e={checkInitialMediaSettingsForType:function(e,t){var r=E(e),i=y(e,t),o=[];e!==n.FRAGMENTED_TEXT?(r||_(e,r=c.getSavedMediaSettings(e))((function(e){A(r,e)&&o.push(e)})),0===o.length?v(R(i)):o.length>1?v(R,e)&&!m(t,e.streamInfo)&&v(e)}}},getTracksFor:y,getCurrentTrackFor:m,isCurrentTrack:function(e){var t=e.type,r=e.streamInfo.id;return o[r]&&o[r][t]&&T(o[r][t].current,e)},setTrack:v,setInitialSettings:_,getInitialSettings:E,setSwitchMode:function(e,t){-1!==l.indexOf(t)?u[e]=t:r("track switch mode is notchMode:function(e){return u[e]},setSelectionModeForInitialTrack:function(e){-1!==f.indexOf(e)?s=e:r("track selection mode is not supported: "+e)},getSelectionModeForInitialTrack:b,isMultiTrackSupportedByType:S,isTracksEqual:T,setStartOffsetTimeForType:function(e,t){e&&t>0&&(h[Type:function(e){return h[e]||0},setConfig:function(e){e&&(e.errHandler&&e.errHandler,e.domStorage&&(c=e.domStorage))},reset:w},w(),e}de.__dashjs_factory_name="MediaController";var fe=s.a.getSingletonFactory(de);fe.TRACK_SWITCH_MODE_NEVER_REPLACE=ae,fe.TRACK_SWITCH_MODE_ALWAYS_REPLACE=se,fe.TRACK_SELECTION_MODE_HIGHEST_BITRATE=ue,fe.TRACK_SELECTION_MODE_WIDEST_RANGE=ce,fe.DEFAULT_INIT_TRACK_SELECTION_MODE=le,s.a.updateSingletonFactory(de.__dashjs_factory_name,fe);var pe=fe,he=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var r=0;r<t.boxes.length;r++)this.boxes.push(new e(t.boxes[r]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var n=0;n<t.references.length;n++){var i={reference_type:t.references[n].reference_type,referenced_size:t.references[n].referenced_size,subsegment_duration:t.references[n].subsegment_duration};this.references.push(i)}}break;case"emsg":this.id=t.id,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":case"mvhd":this.timescale=t.timescale;break;case"mfhd":this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var o=0,a=t.samples.length;o<a;o++){var s={sample_size:t.samples[o].sample_size,sample_duration:t.samples[o].sample_duration,sample_composition_time_offset:t.samples[o].sample_composition_time_offset};this.samples.push(s)}}break;case"elst":this.boxes=t.entries].type===e)return this.box&t.push(this.boxes[r]);return t}(o=r(i[a]))&&n.push(o);return n}function r(e){if(!e)return null;var t=new he(e);return e.hasOwnProperty("_incomplete")&&(t.isCompletepeof e.fetch?r(e.fetch(t)):null},getBoxes:t,setn r.length>0?r[r.length-1]:null}}}ye.__dashjs_factory_name="IsoFile";var me=s.a.getClassFfset=t,this.found=r,this.size=n};++])+String.fromCharCode(e[t])}return{parse:function(t){if(!t)return null;void 0===t.fileStart&&(t.fileStart=0);var r=ve.a.parseBuffer(t),n=me(e).create();return n.setData(r),n},findLastTopIsoBoxCompleted:function(e,n,i){if(void 0===i&&(i=0),!n||i+8>=n.byteLength)return new _e(0,!1);for(var o=n instanceof ArrayBuffer?new Uint8Array(n):n,a=void 0,s=0;i<o.byteLength;){var u=t(o,i),c=r(o,i+4);if(0===u)break;i+u<=o.byteLength&&(e.indexOf(c)>=0?a=new _e(i,!0,u):s=i+u),i+=u}return a||new _e(s,!1)}}}Ee.__dashjs_factory_name="BoxParser";va]:null},reset:function(){e={}}}}Se.__dashjs_factory_name="InitCache";var Te=s.a.getSingletonFactory(Se),we=[1,3,7];function Ae(e){e=e||{};var t,r=this.context,i=e.bufferController,o=e.mediaPlayerModel,a=d(r).getInstance(),s=1,u=void 0,c=void 0;function l(e){e.chunk.mediaInfo.type===n.AUDIO&&y(e.chunk.bytes)}function f(e){u&&e.sender.getType()===n.AUDIO&&(u=!1,a.trigger(p.SWITCH_AUDIO_TRACK_RENDERED,{id:o.getAudioTrackId(),index:{return o.getAudioTrackId()!==s}function y(e){for(var t=ve.a.parseBuffer(e).fetchAll("tkhd"),r=[],n=0;n<t.length;n++){var i=t[n],a={id:i.track_ID,enabled:!1,flags:i.flags};we.includes(i.flags)&&(s=i.track_ID,a.enabled=!0),r.push(a)}c("AudioTrackControllerparse tkhd success, default tracks is "+s),o.setAudioTrackIds(rtion(){return"AudioTrackController"},shouldSwitchTrack:h,canUseNativeFomular:function(){var e=i.getBuffer(),t=e.getBuffer();return e&&t&&t.audioTracks&&!1},switchByAudioTracks:function(){var e=i.getBuffer().getBuffer().nd((function(e){return e.enabled=!0})),r=o.getAudioTrackId(),n=e.getTrackById(r),a=!0;t&&(t.enabled=!1),e.addEventListener("change",(function(){a&&n&&(n.enabled=!0),a=!1}))},switchByModifyTrackId:function(e){if(e&&h()){var t=e.bytes,r=ve.a.parseBuffer(t).fetchAll("tfhd");if(r&&r.length>1){var n=o.getAudioTrackId(),i=r.find((function(e){return e.track_ID===s})),a=r.find((function(e){return e.track_ID===n}));i&&a&&(i._raw.setUint32(12,n),a._raw.setUint32(12,s),e.trackSwitchInfo={id:n})}}},setDefaultTrackId:y,revertDefaultTrack:function(e){if(e&&e.trackSwitchInfo){var t=e.bytes,r=e.trackSwitchInfo.id,n=ve.a.parseBuffer(t).fetchAll("tfhd");if(n&&n.length>1){var i=n.find((function(e((function(e){return e.track_ID===r}));i&&o&&(i._raw.setUint32(12,r),o._raw.setUint32(12,s),e.trackSwitchInfo=null)}}},setSwitchingState:function(e){u=e},initialize:function(){a.on(p.BYTES_APPENDED_END_FRAGMENT,f,this),a.on(p.INIT_FRAGMENT_LOADED,l,this)},reset:function(){u=!1,a.off(p.BYTES_APPENDED_END_FRAGMENT,f,this),
a.off(p.INIT_FRAGMENT_LOADED,l,this)}},c=g(r).getInstance().log.bind(t),u=!1,t}Ae.__dashjs_factory_name="AudioTrackController";var Re=s.a.getClassFactory(Ae),Pe="bufferLoaded",De="bufferStalled",Oe=.5,Ie=.01,Ce="BufferController";function Ne(e){e=e||{};var t=this.context,r=d(t).getInstance(),i=e.metricsModel,o=e.mediaPlayerModel,a=e.errHandler,s=e.streamController,u=e.mediaController,c=e.adapter,l=e.abrController,f=e.playbackController,h=e.type,m=e.streamProcessor,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,w=void 0,A=void 0,P=void 0,O=void 0,I=void 0,C=void 0,N=void 0,k=void 0,L=void 0,x=void 0,M=void 0,U=void 0,B=void 0,j=void 0,V=void 0,H=void 0,G=void 0,q=void 0,W=void 0,K=void 0,Y=void 0,Q=void 0,z=void 0,Z=void 0,J=void 0;function X(e){var t=e.time;if(I&&I.getBuffer()&&J.length){var r=I.getBuffer().buffered;if(r&&r.length>=1&&r.end(r.length-1)-t<=.5){var n=J.shift();n&&(z.switchByModifyTrackId(n),ie(n))}}}function $(){if(z.setSwitchingState(!0),k){var e=f.getTime();k.end-e>2&&(!z.shouldSwitchTrack()&&k.trackSwitchInfo?z.revertDefaultTrack(k):(k.trackSwitchInfo&&z.revertDefaultTrack(k),z.switchByModifyTrackId(k)),ie(k,!0))}}function ee(){var e=f.getTime(),t=de();0===t.length&&ge().length>0&&(t=[{start:ge().start(0)}]),t.length<=0||(t[t.length-1].end=e-1,t.forEach((function(e){e.force=!0})),Ae(t))}function te(e){if(!U||!e||!m)return null;if(A)try{"function"==typeof(I=R(t).create(A,e,se.bind(this))).getBuffer().initialize&&I.getBuffer().initialize(h,m),r.trigger(p.BUFFER_CREATED,{mediaType:e.type})}catch(e){_("Caught error on create SourceBuffer: "+e),a.mediaSourceError("Error creating "+h+" source buffer.")}else I=D(t).create(se.bind(this));m.getRepresentationInfoForQuality(E)&&Le(m.getRepresentationInfoForQuality(E).MSETimeOffset)}function re(e){e.fragmentModel===m.getFragmentModel()&&(_("Init fragment finished loading saving to",h+"'s init cache"),_("Append Init fragment",h," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality),I?I.setAppendWindowEnd(o.ge"duration");I.setAppendWindowEnd(e)},ie(e.chunk))}function ne(e){if(e.fragmentModel===m.getFragmentModel()){var i=e.chunk,a=i.bytes,s=i.quality,u=m.getRepresentationInfoForQuality(s),l=c.getEventsFor(u.mediaInfo,m),d=c.getEventsFor(u,m),y=o.getEnableMultipleAudioTracks();if(l&&l.length>0||d&&d.length>0){var g=function(e,r,n,i){for(var o=Math.max(!r||isNaN(r.startTime)?0:r.startTime,0),a=[],s=[],u=n.concat(i),l=0,d=u.length;l<d;l++)a[u[l].schemeIdUri]=u[l];for(var f=be(t).getInstance().parse(e).getBoxes("emsg"),p=0,h=f.length;p<h;p++){var y=c.getEvent(f[p],a,o);y&&s.push(y)}return s}(a,m.getFragmentModel().getRequests({state:T.FRAGMENT_MODEL_EXECUTED,quality:s,index:i.index})[0],l,d);m.getEventController().addInbandEvents(g)}if(G){q=i;var E=I&&ge();E&&E.length>0&&f.getTimeToStreamEnd()>Oe&&(_("Clearing buffer because track changed - "+(E.end(E.length-1)+.5)),Ae([{start:0,end:E.end(E.length-1)+.5,force:!0}]))}else h===n.AUDIO&&i.mediaInfo.type===n.AUDIO&&y?function(e){var t;if(t=f.getTime(),0===e.index||e.start<=t&&t<=e.end)_("Multi Audioappend multi audio chunk: "+e.index+"-"+e.start+"-"+e.end),z.switchByModifyTrackId(e),ie(e);else{var n={sender:v,index:e.index},i=J.findIndex((function(t){return t.index===e.index}));if(-1!==i)return _("Multi Audiomulti audio identical chunk emerged, replacing it: "+e.index),void(J[i]=e);J.push(e),e.fromMulti=!0,r.trigger(p.MULTI_AUDIO_TRACK_APPEND,n)}}(i):ie(i)}}function ie(e,t){!x||t?(x=!0,k=e,e.startOffsetTime=u.getStartOffsetTimeForType(e.mediaInfo.type),I?I.append(e):W.push(e),e.mediaInfo.type===n.VIDEO&&r.trigger(p.VIDEO_CHUNK_RECEIVED,{chunk:e})):H.push(e)}function ae(e){if(e.mediaType===h&&(Q&&(Q(),Q=null),W.length))for(var t=Date.now(),n=e.mediaType,i=l.getInitializeDate(),a=0;a<W.length;a++){var s=W[a];s&&s.mediaInfo.type===n&&I&&I.append&&(W[a]=null,K&&(Le(K),K=0),I.append(s),r.trigger(p.DELAY_TO_APPEND_TO_BUFFER,{mediaType:n,appendTime:t-i,createdTime:Date.now()-i,isPreload:!!o.getPreloadData()}))}}function se(e){if(e.error){if(22===e.error.code&&(w=.8*He(),_("Quota exceeded for type: "+h+", Critical Buffer: "+w),w>0)){var t=Math.max(.2*w,1),n=w-t;o.setBufferToKeep(parseFloat(t).toFixed(5)),o.setBufferAheadToKeep(parseFloat(n).toFixed(5))}22!==e.error.code&&Ge()||(_("Clearing playback buffer to overcome quota exceed situation for type: "+h),r.trigger(p.QUOTA_EXCEEDED,{sender:v,criticalBufferLevel:w,mediaType:h}),le(),x=!1)}else{(k=e.chunk)&&!isNaN(k.index)&&(P=Math.max(k.index,P),Ee());var i=ge();if(k.segmentType===F.MEDIA_SEGMENT_TYPE)fe();else if(G){var a=f.getTime();_("[BufferController][",h,"] appendToBuffer seek target should be "+a),m.getScheduleController().setSeekTarget(a),c.setIndexHandlerTime(m,a)}var s={sender:v,quality:k.quality,startTime:k.start,index:k.index,fromMulti:k.fromMulti,bufferedRanges:i};k&&!k.endFragment?r.trigger(p.BYTES_APPENDED,s):k&&r.trigger(p.BYTES_APPENDED_END_FRA.newQuality).MSETimeOffset),E=e.newQuality)}function ce(){if(b&&(j=!0,b=!1,O=Number.POSITIVE_INFINITY),H=[],x=!1,h!==n.FRAGMENTED_TEXT){var e=ge(),t=o.getEnableMultipleAudioTracks(),r=!0;if(e&&e.length>0)for(var i=f.getTime(),a=0,s=e.length;a<s;a++)i>=e.start(a)&&i<=e.end(a)-1&&(r=!1);r?(h===n.AUDIO&&t&&fdex((function(t){return t.start<=e&&t.end>e}));if(-1!==t){var r=J[t],n=J.slice(t+1);J=n,r&&(_("Multi Audiofind multi audio chunk in buffer list after seeking: "+r.index),z.switchByModifyTrackId(r),ie(r))}else J.length=0}}(f.getTime()),m.getFragmentModel().clearExecutedRequestBySeeking(),le()):fe()}else fe();B=void 0}function le(){var e=de();e&&0!==e.length||fe(),Ae(e)}function de(){var e=[],t=ge();if(!t||0===t.length)return e;var r=f.getTime(),n=t.end(t.length-1)+.5,i=m.getFragmentModel().getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:r,threshold:Ie})[0];if(i){var o={start:0,end:i.startTime-Oe},a=m.getFragmentModel().getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:i.startTime-i.duration/2,threshold:Ie})[0];a&&a.startTime!=i.startTime&&(o.end=a.startTime),o.start<o.end&&o.end>t.start(0)&&e.push(o);var s={start:i.startTime+i.duration+Oe,end:n},u=m.getFragmentModel().getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:i.startTime+i.duration+Oe,threshold:Ie})[0];u&&u.startTime!==i.startTime&&(s.start=u.startTime+u.duration+Oe),s.start<s.end&&s.start<n&&e.push(s)}else _("getAllRangesWithSafetyFactor for",h,"- No request found in current time position, removing full buffer 0 -",n),e.push({start:0,end:n});return e}function fe(){G||(ve(),_e())}function he(){Se()}function ye(){Se()}function me(e,t){var r=I&&ge(),n=0,i=0,o=null,a=null,s=0,u=void 0,c=void 0,l=t||.15;if(null!=r){for(c=0,u=r.length;c<u;c++)if(n=r.start(c),i=r.end(c),null===o)s=Math.abs(n-e),(e>=n&&e<i||s<=l)&&(o=n,a=i);else{if(!((s=n-a)<=l))break;a=i}if(null!==o)return{start:o,end:a}}return null}function ge(){var e=I.getAllBufferRanges();if(0===e.length)return[];for(var t=e.start(0),r=e.start(0),n=[],i=0;i<e.length;i++)Math.abs(e.start(i)-r)<=.5||Math.abs(e.start(i)-r-5)<=.1?(r=e.end(i),Math.abs(e.start(i)-r-5)<=.1&&(_("Browser has dropped five seconds buffer from "+r+"s to "+e.start(i)+"s"),m.getFragmentModel().removeExecutedRequestsInTimeRange(r,e.start(i)),c.setIndexHandlerTime(m,r))):(r>t&&n.push({start:t,end:r}),t=e.start(i),r=e.end(i));return r>t&&n.push({start:t,end:r}),{length:n.length,start:function(e){return n[e].start},end:function(e){return n[e].end}}}function ve(){var e,t;f&&(e=function(){var e=f.getTime();if(B){var t=ge();t&&t.length&&(e=Math.max(t.start(0),B))}return e}()||0,S=null===(t=me(e,void 0))?0:t.end-e,r.trigger(p.BUFFER_LEVEL_UPDATED,{sender:v,bufferLevel:S}),Se())}function _e(){m&&s&&m.getStreamInfo().id===s.getActiveStreamInfo().id&&(i.addBufferState(h,N,m.getScheduleController().getBufferTarget()),i.addBufferLevel(h,new Date,1e3*S))}function Ee(){P>=O-1&&!b&&void 0===I.discharge&&(b=!0,
_("[BufferController]["+h+"] checkIfBufferingCompleted trigger BUFFERING_COMPLETED"),r.trigger(p.BUFFERING_COMPLETED,{sender:v,streamInfo:m.getStreamInfo()}))}function Se(){if("audio"===h||"video"===h){var e=f.getTimeToStreamEnd()-S;if(j&&!b&&f&&e<.5)if(f.getTimeToStreamEnd()>.5){for(var t=c.getIndexHandlerTime(m),n=m.getIndexHandler(),i=m.getCurrentRepresentationInfo(),a=n.getIndex(),s=c.getFragmentRequestForTime(m,i,t,{keepIdx:!1});s&&s.action!==y.ACTION_COMPLETE&&m.getFragmentModel().isFragmentLoaded(s);)s=c.getNextFragmentRequest(m,i);n.setIndex(a),s&&s.action===y.ACTION_COMPLETE?(b=!0,j=!1,_("[BufferController]["+h+"] checkIfSufficientBuffer trigger BUFFERING_COMPLETED"),r.trigger(p.BUFFERING_COMPLETED,{sender:v,streamInfo:m.getStreamInfo()})):b=!1}else _("[BufferController]["+h+"] handle the fragment which duration may be less than 0.5s");S<Oe&&!b?we(De):(b||S>=o.getStableBufferTime())&&we(Pe)}}function we(e){N===e||e===De&&0===f.getTime()||(N=e,_e(),r.trigger(p.BUFFER_LEVEL_STATE_CHANGED,{sender:v,state:e,mediaType:h,streamInfo:m.getStreamInfo()}),r.trigger(e===Pe?p.BUFFER_LOADED:p.BUFFER_EMPTY,{mediaType:h}),_(e===Pe?"Got enough buffer to start for "+h:"Waiting foe&&I&&0!==e.length&&(V.push.apply(V,e),M||Ne())}function Ne(){if(0===V.length||!I)return _("Nothing to prune, halt pruning"),V=[],void(M=!1);var e=I.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return _("SourceBuffer is empty (or does not exist), halt pruning"),V=[],void(M=!1);var t=V.shift();_("Removing",h,"buffer from:",t.start,"to",t.end),M=!0;var r=f.getTime();r<t.end&&(b=!1,P=0,G||(m.getScheduleController().setSeekTarget(r),c.setIndexHandlerTime(m,r)));var n=s.getDuration()-1;n&&0===t.start&&t.end>=n&&(t.force=!0),I.remove(t.start,t.end,t.force)}function ke(e){I===e.buffer&&(_("[BufferController][",h,"] onRemoved buffer from:",e.from,"to",e.to),0===V.length&&(M=!1),e.unintended&&(_("[BufferController][",h,"] detected unintended removal from:",e.from,"to",e.to,"setting index handler time to",e.from),c.setIndexHandlerTime(m,e.from)),M?Ne():(G?(G=!1,q&&ie(q)):(_("onRemoved : call updateBufferLevel"),ve()),r.trigger(p.BUFFER_CLEARED,{sender:v,from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:Ge()})))}function Le(e){0!==e&&(I&&I.updateTimestampOffset?I.updateTimestampOffset(e):K=e)}function xe(e){if(e.sender.getStreamProcessor()===m&&!e.error){var t=0;try{t=e.currentRepresentation=m.getFragmentModel()&&(O=e.request.index,Ee())}function Fe(e){var t=I&&ge();t&&e.newMediaInfo.type===h&&e.newMediaInfo.streamInfo.id===m.getStreamInfo().id&&(_("[BufferController]["+h+"] track change asked"),u.getSwitchMode(h)===pe.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&t&&t.length>0&&f.getTimeToStreamEnd()>Oe&&(b=!1,O=Number.POSITIVE_INFINITY))}function Ue(){++L*(o.getWallclockTimeUpdateInterval()/1e3)>=o.getBufferPruningInterval()&&(L=0,I&&h!==n.FRAGMENTED_TEXT&&(b||Ae(function(){var e=[],t=ge();if(!t||0===t.length)return e;var r=f.getTime(),n={start:Math.max(0,r-o.getBufferToKeep()),end:r+o.getBufferAheadToKeep()},i=m.getFragmentModel().getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:r,threshold:Ie})[0];if(i)n.start=Math.min(i.startTime,n.start),n.end=Math.max(i.startTime+i.duration,n.end);else if(0===r&&f.getIsDynamic())return[];if(t.start(0)<=n.start){for(var a={start:0,end:n.start},s=0;s<t.length&&t.end(s)<=n.start;s++)a.end=t.end(s);a.start<a.end&&e.push(a)}if(t.end(t.length-1)>=n.end){var u={start:n.end,end:t.end(t.lengtnd&&e.push(u)}return e}())))}function Be(){Se()}function je(){if(o.getAppendingSourceState()){b=!1,O=Number.POSITIVE_INFINITY,U.reset();var e=o.getCachedDurationOffset("offset");c.setIndexHandlerTime(m,e),m.resetPreloadDat&t&&"function"==typeof I.discharge&&(C=I,te(t))}function He(){var e,t=ge(),r=0,n=void 0;if(!t)return r;for(n=0,e=t.start(n);return r}function Ge(){return He()<w}function qe(e){w=Number.POSITIVE_INFINITY,N=void 0,E=oe.QUALITY_DEFAULT,O=Number.POSITIVE_INFINITY,P=0,k=null,b=!1,x=!1,M=!1,j=!1,S=0,L=0,V=[],W=[],I&&(e||I.abort(),I.reset(),I=null),G=!1,J=[]}return v={getBufferControllerType:function(){return Ce},initialize:function(e){Ve(e),E=l.getQualityFor(h,m.getStreamInfo()),r.on(p.DATA_UPDATE_COMPLETED,xe,this),r.on(p.INIT_FRAGMENT_LOADED,re,this),r.on(p.MEDIA_FRAGMENT_LOADED,ne,this),r.on(p.QUALITY_CHANGE_REQUESTED,ue,this),r.on(p.STREAM_COMPLETED,Me,this),r.on(p.PLAYBACK_PLAYING,ye,this),r.on(p.PLAYBACK_PROGRESS,fe,this),r.on(p.PLAYBACK_TIME_UPDATED,fe,this),r.on(p.PLAYBACK_RATE_CHANGED,Be,this),r.on(p.PLAYBACK_SEEKING,ce,this),r.on(p.PLAYBACK_STALLED,he,this),r.on(p.WALLCLOCK_TIME_UPDATED,Ue,this),r.on(p.CURRENT_TRACK_CHANGED,Fe,this,d.EVENT_PRIORITY_HIGH),r.on(p.SOURCEBUFFER_REMOVE_COMPLETED,ke,this),r.on(p.BUFFER_CREATED,ae,this),r.on(p.APPENDING_NEXT_SOURCE,je,this),h===n.AUDIO&&o.getEnableMultipleAudioTracks()&&(r.on(p.SWITCH_AUDIO_TRACK_REQUEST,$,this),r.on(p.SWITCH_AUDIO_TRACK_RENDERED,ee,this),r.on(p.PLAYBACK_TIME_UPDATED,X,this))},createBuffer:te,dischargePreBuffer:function(){if(I&&C&&"function"==typeof C.discharge){var e=C.getAllBufferRanges();if(e.length>0){for(var t="Beginning "+h+"PreBuffer discharge, adding buffer for:",r=0;r<e.length;r++)t+=" start: "+e.start(r)+", end: "+e.end(r)+";";_(t)}else _("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");for(var n=C.discharge(),i=null,o=0;o<n.length;o++){var a=n[o],s=U.extract(a.streamId,a.representationId);s&&(i!==s&&(I.append(s),i=s),I.append(a))}C.reset(),C=null}},getType:function(){return h},getStreamProcessor:function(){return m},setSeekStartTime:function(e){B=e},getBuffer:function(){return I},getBufferLevel:function(){return S},getRangeAt:me,setMediaSource:Ve,getMediaSource:function(){return A},getIsBufferingCompleted:function(){return b},switchInitData:function(e,t,n){var i=U.extract(e,t);G=!0===n&&n,Y=o.getAppendingSourceState(),i&&!Y?(_("Append Init fragment",h," with representationId:",i.representationId," and quality:",i.quality),ie(i)):(Y&&(Y=!1,G=!1),r.trigger(p.INIT_REQUESTED,{sender:v}))},getIsPruningInProgress:function(){return M},reset:function(e){r.off(p.DATA_UPDATE_COMPLETED,xe,this),r.off(p.QUALITY_CHANGE_REQUESTED,ue,this),r.off(p.INIT_FRAGMENT_LOADED,re,this),r.off(p.MEDIA_FRAGMENT_LOADED,ne,this),r.off(p.STREAM_COMPLETED,Me,this),r.off(p.CURRENT_TRACK_CHANGED,Fe,this),r.off(p.PLAYBACK_PLAYING,ye,this),r.off(p.PLAYBACK_PROGRESS,fe,this),r.off(p.PLAYBACK_TIME_UPDATED,fe,this),r.off(p.PLAYBACK_RATE_CHANGED,Be,this),r.off(p.PLAYBACK_SEEKING,ce,this),r.off(p.PLAYBACK_STALLED,he,this),r.off(p.WALLCLOCK_TIME_UPDATED,Ue,this),r.off(p.SOURCEBUFFER_REMOVE_COMPLETED,ke,this),r.off(p.BUFFER_CREATED,ae,this),r.off(p.APPENDING_NEXT_SOURCE,je,this),h===n.AUDIO&&o.getEnableMultipleAudioTracks()&&(r.off(p.SWITCH_AUDIO_TRACK_REQUEST,$,this),r.off(p.SWITCH_AUDIO_TRACK_RENDERED,ee,this),r.off(p.PLAYBACK_TIME_UPDATED,X,this),z&&(z.reset(),z=null)),clearInterval(Z),Z=-1,qe(e)},getStoreBufferLevel:function(){if(J.length){var e=f.getTime();return J[J.length-1].end-e}return 0},getMultiBufferRanges:function(){for(var e=ge(),t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});if(J&&J.length>0){var n=t.length,i=J[J.length-1].end;t.length>0?t[n-1].end=i:t.push({start:J[0].start,end:i})}return t},getBufferRanges:ge},_=g(t).getInstance().log.bind(v),U=Te(t).getInstance(),H=[],W=[],K=0,h===n.AUDIO&&o.getEnableMultipleAudioTracks()&&(_("Multi Audioenable multiple audio tracks and init audio track controller"),(z=Re(t).create({bufferController:v,mediaPlayerModel:oe(),Z=setInterval((function(){X({time:f.getTime()})}),50)),qe(),v}Ne.__dashjs_factory_name=Ce;var ke=s.a.getClassFactory(Ne);ke.BUFFER_LOADED=Pe,ke.BUFFER_EMPTY=De,s.a.updateClassFactory(Ne.__dashjs_factory_name,ke);var Le=ke,xe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.xywh=null,
this.track=null,this.id=null,this.s=null,this.ng(0,s);e.hasOwnProperty(u)&&(e[u]=a.substr(s+1))}}},getURIFragmentData:function(){return e}}}Me.__dashjs_factory_name="URIFragmentModel";var Fe=s.a.getSingletonFactory(Me);function Ue(){var e,t=this.context,r=g(t).getInstance().log,i=d(t).getInstance(),o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,y=void 0,m=void 0,v=void 0,_=void 0,Ee.fromStreamInfo.id],delete m[e.fromStreamInfo.id])}function P(){var e=B(!0),t=b?e-E.start:0;return parseFloat((e+(E.duration-t)-k()).toFixed(5))}function D(){if(E&&f&&f.getElement())return f.plE&&f?f.isPaused():null}function I(){E&&f&&f.pause()}function C(){return E&&f?f.isSeeking():null}function N(e){E&&f&&(i.trigger(p.PLAYBACK_SEEK_ASKED),r("Requesting seek to time: "+e+" from "+k()),f.setCurrentTime(e))}function k(){return E&&f?f.getTime():nue():null}function x(){return E&&f?f.getEnded():null}function M(){return b}function F(){h=NaN,T=!1,m={},v=0,A=0,_={},f&&(i.off(p.DATA_UPDATE_COMPLETED,G,this),i.off(p.BUFFER_LEVEL_STATE_CHANGED,ie,this),i.off(p.BYTES_APPENDED_END_FRAGMENT,ne,this),i.off(p.PERIOD_SWITCH_STARTED,R,this),V(),f.removeEventListener("canplay",q),f.removeEventListener("play",W),f.removeEventListener("waiting",K),f.removeEventListener("playing",Y),f.removeEventListener("pause",Q),f.removeEventListener("error",re),f.removeEventListener("seeking",z),f.removeEventListener("seeked",Z),f.removeEventListener("timeupdate",J),f.removeEventListener("progress",X),f.removeEventListener("ratechange",$),f.removeEventListener("loadedmetadata",ee),f.removeEventListener("ended",te),f.removeEventListener("stalled",oe)),f=null,E=null,b=null,y=null}function U(){var e=Fe(t).getInstance().getURIFragmentData(),r=void 0;if(e){r={};var n=parseInt(e.r,10);n>=0&&E&&n<E.manifestInfo.DVRWindowSize&&null===e.t&&(e.t=Math.floor(Date.now()/1e3)-E.manifestInfo.DVRWindowSize+n),r.fragS=parseInt(e.s,10),r.fragT=parseInt(e.t,10)}return r}function B(e,t){var r,n=void 0,i=U();if(r=i?e?E.start:isNaN(i.fragS)?i.fragT:i.fragS:0,b)isNaN(r)||((n=r-E.manifestInfo.availableFrom.getTime()/1e3)>h||n<(isNaN(t)?NaN:t-E.manifestInfo.DVRWindowSize))&&(n=null),n=n||h;else if(!isNaN(r)&&r<Math.max(E.manifestInfo.duration,E.duration)&&r>=0)n=r;else{var o=m[E.id];n=void 0!==o?Math.max(void 0!==o.audio?o.audio:0,void 0!==o.video?o.video:0,E.start):E.start}return n}function j(){null===y&&(y=setInterval((function(){var e;i.trigger(p.WALLCLOCK_TIME_UPDATED,{isDynamic:b,time:new Date}),M()&&O()&&(e=Date.now(),(!w||e>w+500teInterval()))}function V(){clearInterval(y),y=null}function H(){if(!O()&&b&&0!==f.getReadyState()){var e=k(),t=function(e){var t=a.getReadOnlyMetricsFor(n.VIDEO)||a.getReadOnlyMetricsFor(n.AUDIO),r=s.getCurrentDVRInfo(t),i=r?r.range:null,o=void 0;if(!i)return NaN;if(e>i.end)o=Math.max(i.end-2*E.manifestInfo.minBufferTime,i.start);else{if(!(e+.25<i.start))retation).mediaInfo.streamInfo;E.id===t.id&&(E=t,H())}}function q(){i.trigger(p.CAN_PLAY)}function W(){r("Native video element event: play"),S.getStartPlaybackTime()||S.setStartPlaybackTime((new Date).getTime()),H(),j(),i.trigger(p.PLAYBACK_STARTED,{startTime:k()})}function K(){r("Native video element event: waiting"),i.trigger(p.PLAYBACK_WAITING,{playingTime:k()})}function Y(){r("Native video element event: playing"),i.trigger(p.PLAYBACK_PLAYING,{playingTime:k()})}function Q(){r("Native video element event: pause"),i.trigger(p.PLAYBACK_PAUSED,{ended:x()})}function z(){var e=k();r("Seeking to: "+e),j(),S&&S.setLastStartSeekTime((new Date).getTime()),i.trigger(p.PLAYBACK_SEEKING,{seekTime:e})}function Z(){r("Native video element event: seeked"),i.trigger(p.PLAYBACK_SEEKED)}function J(){var e=k();i.trigger(p.PLAYBACK_TIME_UPDATED,{timeToEnd:P(),time:e})}function X(){i.trigger(p.PLAYBACK_PROGRESS)}function $(){var e=L();r("Native video element event: ratechange: "+e+" currentTime: "+k()),i.trigger(p.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function ee(){r("Native video element event: loadedmetadata"),i.trigger(p.PLAYBACK_METADATA_LOADED),j()}function te(){r("Native video element event: ended"),I(),V(),i.trigger(p.PLAYBACK_ENDED,{isNativeEnded:!0})}function re(e){var t=e.target||e.srcElement;i.trigger(p.PLAYBACK_ERROR,{error:t.error})}function ne(e){var t,n=void 0,i=e.bufferedRanges;if(i&&i.length&&(!m[E.id]||!0!==m[E.id].started)){var a=e.sender.getType();void 0===_[E.id]&&(_[E.id]=[]),_[E.id][a]=i,void 0===m[E.id]&&(m[E.id]=[],m[E.id].started=!1),void 0===m[E.id][a]&&(m[E.id][a]=Math.max(i.start(0),E.start));var s=o.isVideoTrackPresent(),u=o.isAudioTrackPresent();if(t=B(!1),u&&s){if(!isNaN(m[E.id].audio)&&!isNaN(m[E.id].video)&&(m[E.id].audio<m[E.id].video?(n=m[E.id].video>t?m[E.id].video:t,i=_[E.id].audio):(n=m[E.id].audio>t?m[E.id].audio:t,i=_[E.id].video),function(e,t){if(t&&t.length>0)for(var r=0,n=t.length;r<n;r++)if(e>=t.start(r)&&e<t.end(r))return!0;return!1}(n,i))){var c=k();!C()&&0!==n&&n>c&&(N(n+.2),r("Playback controller seek hack",n+.2)),m[E.id].started=!0}}else m[E.id][a]&&(n=m[E.id][a]>t?m[E.id][a]:t,C()||N(n),m[E.id].started=!0)}}function ie(e){e.streamInfo.id===E.id&&f.setStallState(e.mediaType,e.state===Le.BUFFER_EMPTY)}function oe(e){r("Native video element event: stalled",e),i.trigger(p.PLAYBACK_STALLED,{e:e})}return e={initialize:function(e){E=e,f.addEventListener("canplay",q),f.addEventListener("play",W),f.addEventListener("waiting",K),f.addEventListener("playing",Y),f.addEventListener("pause",Q),f.addEventListener("error",re),f.addEventListener("seeking",z),f.addEventListener("seeked",Z),f.addEventListener("timeupdate",J),f.addEventListener("progress",X),f.addEventListener("ratechange",$),f.addEventListener("loadedmetadata",ee),f.addEventListener("ended",te),f.addEventListener("stalled",oe),b=E.manifestInfo.isDynamic,h=E.start,i.on(p.DATA_UPDATE_COMPLETED,G,this),i.on(p.BYTES_APPENDED_END_FRAGMENT,ne,this),i.on(p.BUFFER_LEVEL_STATE_CHANGED,ie,this),i.on(p.PEpter&&(l=e.adapter),e.videoModel&&(f=e.videoModel))},getStartTimeFromUriParameters:U,getStreamStartTime:B,getTimeToStrges:function(){return E&&f?f.getPlayedRanges():null},getEnded:x,getIsDynamic:M,getStreamController:function(){return o},setLiveStartTime:function(e){h=e},getLiveStartTime:function(){return h},computeLiveDelay:function(e,t){var r,i=c.getMpd(u.getValue()),o=void 0;if(r=S.getUseSuggestedPresentationDelay()&&i.hasOwnProperty(n.SUGGESTED_PRESENTATION_DELAY)?i.suggestedPresentationDelay:S.getLowLatencyEnabled()?0:S.getLiveDelay()?S.getLiveDelay():isNaN(e)?2*E.manifestInfo.minBufferTime:e*S.getLiveDelayFragmentCount(),i.availabilityStartTime&&(A=i.availabilityStartTime.getTime()),t>0){var a=Math.max(t-10,t/2);o=Math.min(r,a)}else o=r;return v=o,o},getLiveDelay:function(){return v},getCurrentLiveLatency:function(){if(!b||isNaN(A))return NaN;var e=k();return isNaN(e)||0===e?0:(Math.round((new Date).getTime()-(1e3*e+A))/1e3).toFixed(3)},playtDuration:function(){return f.getElement().duration},reset:F},F(),e}Ue.__dashjs_factory_name="PlaybackController";var Be=s.a.getSingletonFactory(Ue);function je(e){var t=(e=e||{}).timelineConverter,r=e.streamProcessor;return{getLiveEdge:function(){!function(){
if(!(t&&t.hasOwnProperty("getExpectedLiveEdge")&&r&&r.hasOwnProperty("getCurrentRepresentationInfo")))throw new Error("Missing config parameter(s)")}();var e=r.getCurrentRepresentationInfo(),n=e.DVRWindow.end;return e.useCalculatedLiveEdgeTime&&(n=t.getExpectedLiveEdge(),t.setClientTimeOffset(n-e.DVRWindow.end)),n},reset:function(){t=null,r=null}}}je.__dashjs_factory_name="LiveEdgeFinder";var Ve=s.a.getClassFactory(je);function He(e,t){if(!(e instanceof t))throw new T,this.mstart=null,this.starttype=null,this.trace=[]};Ge.INITIAL_PLAYOUT_START_REASON="initial_playout",Ge.SEEK_START_REASON="seek",Ge.RESUME_FROM_PAUSE_START_REASON="resume",Ge.METRICS_COLLECTION_START_REASON="metrics_collection_start";var qe=function e(){He(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};function We(e){e=e||{};var t=!1,r=this.context,i=d(r).getInstance(),o=e.dashMetrics,a=e.metricsModel,s=e.mediaPlayerModel,u=e.abrController;function c(e,r,i){var c=NaN,l=e.getCurrentRepresentationInfo();if(r===n.FRAGMENTED_TEXT);else if(r===n.AUDIO&&i){var d=o.getCurrentBufferLevel(a.getReadOnlyMetricsFor(n.VIDEO));c=isNaN(l.fragmentDuration)?d:Math.max(d,l.fragmentDuration),t&&(c=Math.min(c,s.getStableBufferTime()))}else{var f=l.mediaInfo.streamInfo;c=u.isPlayingAtTopQuality(f)&&!t?f.manifestInfo.duration>=s.getLongFormContentDurationThreshold()?s.getBufferTimeAtTopQualityLongForm():s.getBufferTimeAtTopQuality():s.getStableBufferTime()}return c}function l(){t=!0}var f={execute:function(e,t,r,n){return(n&&n+o.getCurrentBufferLevel(a.getReadOnlyMetricsFor(t))||o.getCurrentBufferLevel(a.getReadOnlyMetricsFor(t)))<c(e,t,r)},getBufferTarget:c};return function(){i.on(p.QUOTA_EXCEEDED,l,this)}(),f}qe.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",qe.REBUFFERING_REASON="rebuffering",qe.USER_REQUEST_STOP_REASON="user_request",qe.END_OF_PERIOD_STOP_REASON="end_of_period",qe.END_OF_CONTENT_STOP_REASON="end_of_content",qe.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",qe.FAILURE_STOP_REASON="failure",We.__dashjs_factory_name="BufferLevelRule";var Ke=s.a.getClassFactory(We);function Ye(e){e=e||{};var t=this.context,r=g(t).getInstance().log,n=e.adapter;return{execute:function(e,t){var i=e.getCurrentRepresentationInfo(),o=i.mediaInfo.type,a=e.getScheduleController(),s=a.getSeekTarget(),u=!isNaN(s),c=e.getBufferController(),l=u?s:n.getIndexHandlerTime(e);if(isNaN(l))return null;if(u&&a.setSeekTarget(NaN),c){var d=c.getRangeAt(l);null===d||u||(r("Prior to making a request for time, NextFragmentRequestRule is aligning index handler's currentTime with bufferedRange.end for",o,".",l,"was changed to",d.end),l=d.end)}var f=void 0;if(t)l=t.startTime+t.duration/2,f=n.getFragmentRequestForTime(e,i,l,{timeThreshold:0,ignoreIsFinished:!0});else{for(f=n.getFragmentRequestForTime(e,i,l,{keepIdx:!u});f&&f.action!==y.ACTION_COMPLETE&&e.getFragmentModel().isFragmentLoaded(f);)f=n.getNextFragmentRequest(e,i);f&&(isNaN(f.startTime+f.duration)||n.setIndexHandlerTime(e,f.startTime+f.duration),f.delayLoadingTime=(new Date).getTime()+a.getTimeToLoadDelay(),a.setTimeToLoadDelay(0))}return f}}}Ye.__dashjs_factory_name="NextFragmentRequestRule";var Qe=s.a.getClassFactory(Ye);function ze(e){e=e||{};var t,r=this.context,i=d(r).getInstance(),o=e.metricsModel,a=e.adapter,s=e.dashMetrics,u=e.dashManifestModel,c=e.timelineConverter,l=e.mediaPlayerModel,f=e.abrController,h=e.playbackController,y=e.streamController,m=e.type,v=e.streamProcessor,_=e.mediaController,E=void 0,b=void 0,S=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,O=void 0,I=void 0,C=void 0,N=void 0,k=void 0,L=void 0,x=void 0,M=void 0,F=void 0,U=void 0,B=void 0,j=void 0,V=void 0,H=void 0,G=void 0,q={video:-1,audio:-1};function W(){S&&!v.isBufferingCompleted()?(E("[ScheduleController][",m,"] start"),we(),A=!1,w&&(w=!1),J(!1),z(0)):E("[ScheduleController][",m,"] start denied")}function K(){A||(E("[Sch has changed from "+F[t][e]+" to "+r),F[t][e]=r,!0)}function Q(){var e=v.getBufferController();if(A||O||h.isPaused()&&!x)E("[ScheduleController][",m,"] - schedule stop!");else if(e.getIsBufferingCompleted())E("Schedule stop because buffering is completed!");else{!function(){var e=1.5*(S.fragmentDuration||5),t=b.getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:h.getTime()+e,threshold:0})[0];if(t&&-1===B.indexOf(t)&&!u.getIsTextTrack(m)){var r=l.getFastSwitchEnabled(),n=v.getBufferLevel(),i=f.getAbandonmentStateFor(m);t.mediaType&&f.setCurrentSegmentInfoFor(t.mediaType,{index:t.index,startTime:t.startTime,duration:t.duration,url:t.url});var o=!_.isCurrentTrack(t.mediaInfo)&&_.getSwitchMode(t.mediaInfo.type)===pe.TRACK_SWITCH_MODE_NEVER_REPLACE,a=t.quality!==S.quality;r&&(o||a)&&n>=e&&i!==oe.ABANDON_LOAD?(ee(t),E("Reloading outdated fragment at index: ",t.index)):t.quality>S.quality&&(E("The buffer has better quality it in then what we would request so set append point to end of buffer!!"),be(h.getTime()+v.getBufferLevel()))}}();var t=B.length>0,r=v.getStreamInfo();V||isNaN(U)||j||t||Y(S.mediaInfo.type,r.id)||k.execute(v,m,y.isVideoTrackPresent(),e.getStoreBufferLevel())?(J(!0),t||j||f.checkPlaybackQuality(m),function(){i.trigger(p.GET_NEXT_FRAGMENT,{mediaType:m,currentTime:v.getPlaybackController().getTime(),bufferLevel:v.getBufferLevel(),bufferResetInProgress:V,lastInitQuality:isNaN(U),switchTrack:j,isReplacement:t,hasTopQualityChanged:Y(S.mediaInfo.type,r.id),bufferLevelRule:k.execute(v,m,y.isVideoTrackPresent(),e.getStoreBufferLevel()),final:V||isNaN(U)||j||t||Y(S.mediaInfo.type,r.id)||k.execute(v,m,y.isVideoTrackPresent(),e.getStoreBufferLevel())});var n=v.getFragmentController();if(S.quality!==U)E("ScheduleController - "+m+" - quality has changed at "+h.getTime()+", get init request for representationid = "+S.id),U=S.quality,v.switchInitData(S.id);else if(j)E("ScheduleController - "+m+" - switch track has been asked, get init request for "+m+" with representationid = "+S.id),V=_.getSwitchMode(m)===pe.TRACK_SWITCH_MODE_ALWAYS_REPLACE,v.switchInitData(S.id,V),U=S.quality,j=!1;else{var o=B.shift();if(n.isInitializationRequest(o))v.switchInitData(o.representationId);else{var a=void 0;v.getBufferController().getIsPruningInProgress()||!(a=L.execute(v,o))&&r.manifestInfo&&r.manifestInfo.isDynamic&&E("getNextFragment - "+m+" - Playing at the bleeding live edge and frag is not available yet"),a?(E("ScheduleController - "+m+" - getNextFragment - request is "+a.url),"video"===m&&f.getAutoSwitchBitrateFor(m)&&Object.keys(q).forEach((function(e){-1!==q[e]&&(a.isSwitchingQn=!0)}r&&e.sender.getStreamProcessor()===v&&X(S.quality)}function J(e){O!==e?O=e:E("[ScheduleController][",m,"] isFragmentProcessingInProgress is already equal to",e)}function X(e){var t=a.getInitRequest(v,e);t&&(t.mediaType&&f.setCurrentSegmentInfoFor(t.mediaType,{index:t.index,startTime:t.startTime,duration:t.duration,url:t.url}),J(!0),b.executeRequest(t))}function $(){j=!0}function ee(e){B.push(e)}function te(e){if(m===e.mediaType&&v.getStreamInfo().id===e.streamInfo.id){if(null==(S=v.getRepresentationInfoForQuality(e.newQuality)))throw new Error("Unexpected error! - currentRepresentationInfo is null or undefined");q[m]=e.newQuality,Te(new Date,qe.REPRESENTATION_SWITCH_STOP_REASON),we(),h.isPaused()&&(G={type:m,oldQuality:e.oldQuality})}}function re(e){if(h&&b){var t=b.getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:h.getTime(),threshold:0})[0];t&&h.getTime()>=t.startTime&&((!M.mediaInfo||t.mediaInfo.type===M.mediaInfo.type&&t.mediaInfo.id!==M.mediaInfo.id)&&e&&i.trigger(p.TRACK_CHANGE_RENDERED,{mediaType:m,oldMediaInfo:M.mediaInfo,newMediaInfo:t.mediaInfo}),t.quality===M.quality&&t.adaptationIndex===M.adaptationIndex||!e||q[m]===t.quality&&(i.trigger(p.QUALITY_CHANGE_RENDERED,{mediaType:m,
oldQuality:M.quality,newQuality:t.quality}),q[m]=-1,G=null),M={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function ne(e){e.error||e.sender.getStreamProcessor()!==v||(S=a.convertDataToRepresentationInfo(e.currentRepresentation),l.getAppendingSourceState()&&$())}function ie(e){e.error||v.getStreamInfo().id!==e.streamInfo.id||(S=v.getCurrentRepresentationInfo(),w&&(h.getIsDynamic()?(c.setTimeSyncCompleted(!0),function(){var e=v.getLiveEdgeFinder();if(e){var t=e.getLiveEdge(),r=S.mediaInfo.streamInfo.manifestInfo.DVRWindowSize/2,i=t-h.computeLiveDelay(S.fragmentDuration,r),u=a.getFragmentRequestForTime(v,S,i,{ignoreIsFinished:!0});if(l.getLowLatencyEnabled()){var d=u.duration<l.getLiveDelay()?u.startTime:u.startTime+u.duration-l.getLiveDelay();h.setLiveStartTime(d)}else h.setLiveStartTime(u.startTime);(N=h.getStreamStartTime(!1,t))>S.mediaInfo.streamInfo.start+S.mediaInfo.streamInfo.duration&&h.seek(N);var f=s.getCurrentManifestUpdate(o.getMetricsFor(n.STREAM));o.updateManifestUpdateInfo(f,{currentTime:N,presentationStartTime:t,latency:t-N,clientTimeOffset:c.getClientTimeOffset()})}}()):(N=h.getStreamStartTime(!1),v.getBufferController().setSeekStartTime(N))),A&&W())}function ae(e){e.fragmentModel===b&&(K(),J(!1),E("[ScheduleController] Stream is complete"),l.getAppendingSourceState()&&W())}function se(e){e.sender===b&&(E("[ScheduleController][",m,"] - onFragmentLoadingCompleted"),u.getIsTextTrack(m)&&J(!1),e.error&&e.request.serviceLocation&&!A&&J(!1),V&&(H=e.request),h.isPaused()&&G&&e.request.quality===q[m]&&(i.trigger(p.QUALITY_CHANGE_RENDERED,{mediaType:m,oldQuality:M.quality||G.oldQuaest.quality}),q[m]=-1,G=null))}function ue(){re(!0)}function ce(e){e.sender.getStreamProcessor()!==v||e.fromMulti||(V&&!isNaN(e.startTime)&&(V=!1,b.addExecutedRequest(H)),J(!1),z(0))}function le(e){e.streamProcessor===v&&(E("[ScheduleController][onFragmentLoadingAbandoned] for "+m+", request: "+e.request.url+" has been aborted"),h.isSeeking()||j||(E("[ScheduleController][onFragmentLoadingAbandoned] for "+m+", request: "+e.request.url+" has to be downloaded again, origin is not seeking procenction de(e){e.sender.getStreamProcessor()===v&&K()}function fe(e){e.sender.getStreamProcessor()===v&&(e.unintended?v.getFragmentModel().removeExecutedRequestsAfterTime(e.from,v.getStreamInfo().duration):m===n.AUDIO&&l.getEnableMultipleAudioTracks()?v.getFragmentModel().syncExecutedRequestsWithMultipleLevels(v.getBufferController().getMultiBufferRanges(),v.getStreamInfo().duration):v.getFragmentModel().syncExecutedRequestsWithBufferedRange(v.getBufferController().getBuffer().getAllBufferRanges(),v.getStreamInfo().duration),e.hasEnoughSpaceToAppend&&A&&W())}function he(e){e.sender.getStreamProcessor()!==v||e.state!==Le.BUFFER_EMPTY||h.isSeeking()||(E("[ScheduleController][",m,"] - Buffer is emessor()===v&&X(e.index)}function ve(){!A&&x||W()}function _e(e){N=e.seekTime,Se(0),A&&W();var t=s.getCurrentManifestUpdate(o.getMetricsFor(n.STREAM)),r=S.DVRWindow&&h?S.DVRWindow.end-h.getTime():NaN;o.updateManifestUpdateInfo(t,{latency:r}),O?function(){var e=N,t=b.getLoadingRequests(),r=v.getBufferController().getBufferRanges(),n=!1;if(!e||t.length>1||0===t.length)return!0;var i=t[0];if(i&&(isNaN(i.index)||isNaN(i.startTime)&&isNaN(i.duration)))return!0;for(var o=0;o<r.length;o++){var a=r.start(o),s=r.end(o);if(e>=a-.5&&e<=s+.5){n=!0;break}}if(n){if(i.startTime>e)return E("[ScheduleController][onPlaybackSeeking] seekTime is inside the range and less then the startTime of loadingRequest",e,i),!1}else if(e>=i.startTime&&e<i.startTime+i.duration)return E("[ScheduleController][onPlaybackSeeking] seekTime is outside the range but inside the time range of loadingRequest",e,i),!1;return!0}()?(E("[ScheduleController][onPlaybackSeeking] for "+m+", call fragmentModel.abortRequests in order to seek quicker"),b.abortRequests(),q[m]>=0&&(a.setIndexHandlerTime(v,N),v.switchInitData(S.id)),J(!1),z(30)):E("[ScheduleController]e(e){P&&(P.playbackspeed=e.playbackRa);P.duration=n,P.stopreason=t,R.trace.push(P),D=!0}}function we(){R&&!0===D&&S&&(D=!1,(P=new qe).representationid=S.id,P.start=new Date,P.mstart=1e3*h.getTih.getPlaybackRate().toString())}function Ae(){U=NaN}function Re(){O=!1,I=0,N=NaN,R=null,P=null,D=!0,w=!0,U=NaN,M={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},F={},B=[],A=!0,j=!1,V=!1,H=null}return t={initialize:function(){b=v.getFragmentModel(),x=l.getScheduleWhilePaused(),k=Ke(r).create({abrController:f,dashMetrics:s,metricsModel:o,mediaPlayerModel:l}),L=Qe(r).create({adapter:a}),u.getIsTextTrack(m)&&i.on(p.TIMED_TEXT_REQUESTED,ge,this),i.on(p.QUALITY_CHANGE_REQUESTED,te,this),i.on(p.DATA_UPDATE_STARTED,de,this),i.on(p.DATA_UPDATE_COMPLETED,ne,this),i.on(p.FRAGMENT_LOADING_COMPLETED,se,this),i.on(p.STREAM_COMPLETED,ae,this),i.on(p.STREAM_INITIALIZED,ie,this),i.on(p.BUFFER_LEVEL_STATE_CHANGED,he,this),i.on(p.BUFFER_CLEARED,fe,this),i.on(p.BYTES_APPENDED_END_FRAGMENT,ce,this),i.on(p.INIT_REQUESTED,Z,this),i.on(p.QUOTA_EXCEEDED,ye,this),i.on(p.PLAYBACK_SEEKING,_e,this),i.on(p.PLAYBACK_STARTED,ve,this),i.on(p.PLAYBACK_RATE_CHANGED,Ee,this),i.on(p.PLAYBACK_TIME_UPDATED,ue,this),i.on(p.URL_RESOLUTION_FAILED,me,this),i.on(p.FRAGMENT_LOADING_ABANDONED,le,this),i.on(p.MANIFEST_UPDATED,Ae,this),m===n.AUDIO&&l.getEnableMultipleAudioTracks()&&i.on(p.MULTI_AUDIO_TRACK_APPEND,ce,this)},getType:function(){return m},getSeekTarget:function(){return N},setSeekTarget:be,setTimeToLoadDelay:Se,getTimeToLoadDelay:function(){retuwitchTrackAsked:$,isStarted:function(){return!1===A},start:W,stop:K,reset:function(){i.off(p.DATA_UPDATE_STARTED,de,this),i.off(p.DATA_UPDATE_COMPLETED,ne,this),i.off(p.BUFFER_LEVEL_STATE_CHANGED,he,this),i.off(p.QUALITY_CHANGE_REQUESTED,te,this),i.off(p.FRAGMENT_LOADING_COMPLETED,se,this),i.off(p.STREAM_COMPLETED,ae,this),i.off(p.STREAM_INITIALIZED,ie,this),i.off(p.QUOTA_EXCEEDED,ye,this),i.off(p.BYTES_APPENDED_END_FRAGMENT,ce,this),i.off(p.BUFFER_CLEARED,fe,this),i.off(p.INIT_REQUESTED,Z,this),i.off(p.PLAYBACK_RATE_CHANGED,Ee,this),i.off(p.PLAYBACK_SEEKING,_e,this),i.off(p.PLAYBACK_STARTED,ve,this),i.off(p.PLAYBACK_TIME_UPDATED,ue,this),i.off(p.URL_RESOLUTION_FAILED,me,this),i.off(p.FRAGMENT_LOADING_ABANDONED,le,this),i.off(p.MANIFEST_UPDATED,Ae,this),u.getIsTextTrack(m)&&i.off(p.TIMED_TEXT_REQUESTED,ge,this),K(),re(!1turn k.getBufferTt())},finalisePlayList:function(e,t){Te(e,t),R=null}},E=g(r).getInstance().log.bind(t),Re(),t}ze.__dashjs_factory_name="ScheduleController";var Ze=s.a.getClassFactory(ze),Je=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",
this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.INTERACTIVE="interactive",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:prioritbilityTimeOffset=0,this.avn(e){return null!==e.initialization||null!==e.range},e.hasSegments=function(e){return e.segmentInfoType!==Je.BASE_URL&&e.segmentInfoType!==Je.SEGMENT_BASE&&!e.indexRange},e}();function $e(){var e=this.context,t=d(e).getInstance(),r=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,y=void 0,m=void 0,g=void 0,v=void 0,_=void 0,E=voige(u,r);h.addDVRInfo(_.getType(),f.getTime(),t,n)}function D(e){return s[e]}function O(e){return s.indexOf(e)}function I(e){var n=e;a=!1,t.trigger(p.AST_IN_FUTURE,{delay:n}),setTimeout((function(){if(!S()){a=!0,t.trigger(p.DATA_UPDATE_STARTED,{sender:r}),s.forEach((function(e){e.segmentAvailabilityRange=null}));for(var e=0;e<s.length;e++)l.updateRepresentation(s[e],!0)}}),n)}function C(e){if(e.sender.getStreamProcessor()===_&&S()){var r=e.representation,o=h.getMetricsFor(n.STREAM),l=T().adaptation.type,d=h.getMetricsFor(T().adaptation.type),y=v.getCurrentManifestUpdate(o),m=!1,g=0,E=void 0,b=void 0;if(r.adaptation.period.mpd.manifest.type===Je.DYNAMIC&&!r.adaptation.period.mpd.manifest.ignorePostponeTimePeriod){var A=r.segmentAvailabilityRange.end-r.segmentAvailabilityRange.start;g=1e3*(f.computeLiveDelay(u.segmentDuration,_.getStreamInfo().manifestInfo.DVRWindowSize)-A)}if(g>0)return P(),I(g),b=new w(1,"Segments update failed",null),void t.trigger(p.DATA_UPDATE_COMPLETED,{sender:this,data:i,currentRepresentation:u,error:b});if(y){for(var D=0;D<y.representationInfo.length;D++)if((E=y.representationInfo[D]).index===r.index&&E.mediaType===_.getType()){m=!0;break}m||h.addManifestUpdateRepresentationInfo(y,r.id,r.index,r.adaptation.period.index,_.getType(),r.presentationTimeOffset,r.startNumber,r.segmentInfoType)}(function(e){var t=c.getQualityFor(e),r=_.getStreamInfo(),n=c.getTopQualityIndexFor(e,r.id),i=c.getMinAllowedIndexFor(e);void 0!==i&&t<i&&(t=i),t>n&&(t=n);for(var o=t;o<1;o++){var a=s[o].segmentInfoType;if(null===s[o].segmentAvailabilityRange||!Xe.hasInitialization(s[o])||(a===Je.SEGMENT_BASE||a===Je.BASE_URL)&&!s[o].segments)return!1}return!0})(l)&&(a=!1,c.setPlaybackQuality(_.getType(),_.getStreamInfo(),O(u)),h.updateManifestUpdateInfo(y,{latency:u.segmentAvailabilityRange.end-f.getTime()}),v.getCurrentRepresentationSwitch(d)||R(),t.trigger(p.DATA_UPDATE_COMPLETED,{sender:this,data:i,currentRepresentation:u}))}}function N(e){e.isDynamic&&function(e){for(var t=void 0,r=0,n=s.length;r<n;r++)(t=s[r]).segmentAvailabilityRanetValue().doNotUpdateDVRWindowOnBufferUpdated||P())}function L(e){if(e.mediaType===_.getType()&&_.getStreamInfo().id===e.streamInfo.id&&e.oldQuality!==e.newQuality){var t=e.newQuality;b[t]||(b[t]=!0,l.updateRepresentation(s[t],!0)),u=D(e.newQuality);var r=c.getThroughputHistory().getAverageThroughput(e.mediaType);isNriod&&(t.adaptation.turn r={initialize:function(){l=_.getIndexHandler()},setConfig:function(e){e.abrController&&(c=e.abrController),e.domStorage&&(y=e.domStorage),e.metricsModel&&(h=e.metricsModel),e.dashMetrics&&(v=e.dashMetrics),e.dashManifestModel&&(g=e.dashManifestModel),e.playbackController&&(f=e.playbackController),e.timelineConverter&&(m=e.timelineConverter),e.manifestModel&&(E=e.manifestModel),e.streamProcessor&&(_=e.streamProcessor)},getData:function(){return i},getDataIndex:function(){return o},isUpdating:S,updateData:function(e,r,d){var f=_.getStreamInfo(),h=c.getTopQualityIndexFor(d,f.id),y=c.getMinAllowedIndexFor(d),m=void 0;if(a=!0,t.trigger(p.DATA_UPDATE_STARTED,{sender:this}),s=function(e){return o=g.getIndexForAdaptation(i,e.period.mpd.manifest,e.period.index),g.getRepresentationsForAdaptation(e)}(r),null!==i&&i.id==e.id||d===n.FRAGMENTED_TEXT||c.getThroughputHistory().getAverageThroughput(d)||c.getInitialBitrateFor(d,f),m=c.getQualityFor(d),void 0!==y&&m<y&&(m=y),m>h&&(m=h),u=D(m),i=e,d!==n.VIDEO&&d!==n.AUDIO&&d!==n.FRAGMENTED_TEXT)return a=!1,void t.trigger(p.DATA_UPDATE_COMPLETED,{sender:this,data:i,currentRepresentation:u});(b=[])[m]=!0,l.updateRepresentation(s[m],!0)},getStreamProcessor:function(){return _},getCurrentRepresentation:T,getRepre){return O(s.find((function(t){return t.id===e})))},reset:function(){t.off(p.QUALITY_CHANGE_REQUESTED,L,r),t.off(p.REPRESENTATION_UPDATED,C,r),t.off(p.WALLCLOCK_TIME_UPDATED,N,r),t.off(p.BUFFER_LEVEL_UPDATED,k,r),t.off(p.MANIFEST_VALIDITY_CHANGED,x,r),A(),b=[]}},A(),t.on(p.QUALITY_CHANGE_REQUESTED,L,r),t.on(p.REPRESENTATION_UPDATED,C,r),t.on(p.WALLCLOCK_TIME_UPDATED,N,r),t.on(p.BUFFER_LEVEL_UPDATED,k,r),t.on(p.MANIFEST_VALIDITY_CHANGED,x,r),r}$e.__dashjs_factory_name="RepresentationController";var et=s.a.getClassFactory($e)
;function tt(){var e=void 0,t=/^[a-z][a-z0-9+\-.]*:/i,r=/^https?:\/\//i,n=/^httn substring(0,e.indexOf("?"))),e.substring(0,r+1)arAw.URL("x","http://y"),e=o}catch(e){}finally{e=e||a}}(),{parseBaseUrl:s,parseOrigin:u,parseScheme:c,isRelative:l,isPathAbsolute:d,isSchemeRelative:f,isHTTPURL:function(e){return r.test(e)},isHTTPS:function(e){return n.test(e)},resolve:function(t,r){return e(t,r)}}}tt.__dashjs_factory_ntion ot(e,t){return e.representation.startNumber+t}function at(e,t,r){var n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=t.length;if(!e)return e;for(;;){if((n=e.indexOf("$"+t))<0)return e;if((i=e.indexOf("$",n+c))<0)return e;if((o=e.indexOf("%0",n+c))>n&&o<i)switch(a=e.charAt(i-1),s=parseInt(e.substring(o+2,i-1),10),a){case"d":case"i":case"u":u=it(r.toString(),s);break;case"x":u=it(r.toString(16),s);break;case"X":u=it(r.toString(16),s).toUpperCase();break;case"o":u=it(r.toString(8),s);break;default:return e}else u=r;e=e.substring(0,n)+u+e.substring(i+1)}}function st(e,t,r,n){var i,o,a=void 0,s=void 0;return s=r.segmentDuration,isNaN(s)&&(s=r.adaptation.period.duration),i=parseFloat((r.adaptation.period.start+n*s).toFixed(5)),o=parseFloat((i+s).toFixed(5)),(a=new nt).representation=r,a.duration=s,a.presentationStartTime=i,a.mediaStartTime=e.calcMediaTimeFromPresentationTime(a.presentationStartTime,r),a.availabilityStartTime=e.calcAvailabilityStartTimeFromPresentationTime(a.presentationStartTime,r.adaptation.period.mpd,t),a.availabilityEndTime=e.calcAvailabilityEndTimeFromPresentationTime(o,r.adaptation.period.mpd,t),a.wallStartTime=e.calcWallTimeForSegment(a,t),a.replacementNumber=ot(a,n),a.availabilityIdx=n,a}function ut(e,t,r,n,i,o,a,s,u,c){var l,d,f=n/o,p=Math.min(i/o,r.adaptation.period.mpd.maxSegmentDuration),h=void 0;return d=(l=e.calcPresentationTimeFromMediaTime(f,r))+p,(h=new nt).representation=r,h.duration=p,h.mediaStartTime=f,h.presentationStartTime=l,h.availabilityStartTime=r.adaptation.period.mpd.manifest.loadedTime,h.availabilityEndTime=e.calcAvailabilityEndTimeFromPresentationTime(d,r.adaptation.period.mpd,t),h.wallStartTime=e.calcWallTimeForSegment(h,t),h.replacementTime=c||n,h.replacementNumber=ot(h,u),a=at(a,"Number",h.replacementNumber),a=at(a,"Time",h.replacementnts[i])&&n.availabilityIdx===e)return n;return null}function lt(e,t,r,n,i,o){var a=r.segmentDuration,s=r.adaptation.period.mpd.manifest.minBufferTime,u=r.segmentAvailabilityRange,c={start:e.calcPeriodRelativeTimeFromMpdRelativeTime(r,u.start),end:e.calcPeriodRelativeTimeFromMpdRelativeTime(r,u.end)},l=r.segments,d=2*a,f=o||Math.max(2*s,10*a),p=NaN,h=null,y=void 0;return c.start=Math.max(c.start,0),t&&!e.isTimeSyncCompleted()?{start:y=Math.floor(c.start/a),end:Math.floor(c.end/a)}:(p=l&&l.length>0?(h=ct(i,r))?e.calcPeriodRelativeTimeFromMpdRelativeTime(r,h.presentationStartTime):i>0?i*a:e.calcPeriodRelativeTimeFromMpdRelativeTime(r,n):i>0?i*a:t?c.end:c.start,{start:y=Math.floor(Math.max(p-d,c.start)/a),end:Math.floor(Math.min(y+f/a,c.end/a))})}function dt(e,t){var r=(e=e||{}).timelineConverter;return{getSegments:function(e,n,i,o){if(function(){if(!(r&&r.hasOwnProperty("calcMediaTimeFromPresentationTime")&&r.hasOwnProperty("calcSegmentAvailabilityRange")&&r.hasOwnProperty("calcMediaTimeFromPresentationTime")))throw new Error("Missing config parameter(s)")}(),!e)throw new Error("no representation");void 0===n&&(n=null);var a,s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,u=s.SegmentTimeline,c=s.SegmentURL_asArray,l=e.availableSegmentsNumber>0;a=o||(i>-1||null!==n?10:1/0);var d,f,p,h=0,y=0,m=-1,g=[],v=null,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=function(n,i){var o=s.media,a=n.mediaRange;return c&&(o=c[i].media||"",a=c[i].mediaRange),ut(r,t,e,h,n.d,R,o,a,m,n.tManifest)};for(R=e.timescale,d=u.S_asArray,p=i,null!==n&&(v=r.calcMediaTimeFromPresentationTime(n,e)),E=0,f=d.length;E<f;E++){if(S=0,(_=d[E]).hasOwnProperty("r")&&(S=_.r),_.hasOwnProperty("t")&&(y=(h=_.t)/R),S<0){if((w=d[E+1])&&w.hasOwnProperty("t"))T=w.t/R;else{var D=e.segmentAvailabilityRange?e.segmentAvailabilityRange.end:r.calcSegmentAvailabilityRange(e,t).end;T=r.calcMediaTimeFromPresentationTime(D,e),e.segmentDuration=_.d/R}S=Math.ceil((T-y)/(_.d/R))-1}if(A){if(l)break;m+=S+1}else for(b=0;b<=S;b++)if(m++,g.length>a){if(A=!0,l)break}else null!==v?y>=v-_.d/R*1.5&&g.push(P(_,m)):m>=p&&g.push(P(_,m)),y=(h+=_.d)/R}return l||(e.availableSegmentsNumber=m+1),g}}}dt.__dashjs_factory_name="TimelineSegmentsGetter";var ft=s.a.getClassFactory(dt);function pt(e,t){var r=e.timelineConverter;return{getSegments:function(e,n,i,o){var a,s,u,c,l=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate,d=e.segmentDuration,f=e.segmentAvailabilityRange,p=[],h=null,y=null,m=void 0;for(u=e.startNumber,a=(c=isNaN(d)&&!t?{start:u,end:u}:lt(r,t,e,n,i,o)).start,s=c.end,m=a;m<=s;m++)(y=st(r,t,e,m)).replacementTime=(u+m-1)*e.segmentDuration,h=at(h=l.media,"Number",y.replacementNumber),h=at(h,"Time",y.replacementTime),y.media=h,p.push(y),y=null;return isNaN(d)?e.availableSegmentsNumber=1:e.availableSegmentsNumber=Math.ceil((f.end-f.start)/d),p}}}pt.__dashjs_factory_name="TemplateSegmentsGetter";var ht=s.a.getClassFactory(pt);function yt(e,t){var r=(e=e||{}).timelineConverter;return{getSegments:function(e,n,i,o){var a,s,u,c,l=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,d=l.SegmentURL_asArray.length,f=[],p=void 0,h=void 0,y=void 0;for(c=e.startNumber,a=lt(r,t,e,n,i,o),s=Math.max(a.start,0),u=Math.min(a.end,l.SegmentURL_asArray.length-1),p=s;p<=u;p++)y=l.SegmentURL_asArray[p],(h=st(r,t,e,p)).replacementTime=(c+p-1)*e.segmentDuration,h.media=y.media?y.media:"",h.mediaRange=y.mediaRange,h.index=y.index,h.indexRange=y.indexRange,f.push(h),h=null;return e.availableSegmentsNumber=d,f}}}yt.__dashjs_factory_name="ListSegmentsGetter";var mt=s.a.getClassFactory(yt);function gt(e,t){var r,n=this.context,i=void 0,o=void 0,a=void 0;return r={getSegments:function(e,t,r,n,s){var u=void 0,c=e.segmentInfoType;c!==Je.SEGMENT_BASE&&c!==Je.BASE_URL&&function(e,t){var r=e.segments,n=!1,i=void 0,o=void 0;return r&&0!==r.length?(o=r[0].availabilityIdx,i=r[r.length-1].availabilityIdx,n=t<o||t>i):n=!0,n
}(e,r)?(c===Je.SEGMENT_TIMELINE?u=i.getSegments(e,t,r,s):c===Je.SEGMENT_TEMPLATE?u=o.getSegments(e,t,r,s):c===Je.SEGMENT_LIST&&(u=a.getSegments(e,t,r,s)),n&&n(e,u)):u=e.segments}},i=ft(n).create(e,t),o=ht(n).create(e,t),a=mt(n).create(e,t),r}gt.__dashjs_factory_eturn e},modifyRequestHeader:function(e){return e}}}_t.__dashjs_factory_name="RequestModifier";var Et=s.a.getSingletonFactory(_t);function bt(e){var t=(e=e||{}).requestModifier;return{load:function(e){var r=new Date,n=e.request,i=new XMLHttpRequest;i.open(e.method,e.url,!0),n.responseType&&(i.responseType=n.responseType),n.range&&i.setRequestHeader("Range","bytes="+n.range),n.requestStartDate||(n.requestStartDate=r),t&&(i=t.modifyRequestHeader(i)),i.withCredentials=e.withCredentials,e.request.loadInfo={rType:"XHR",cdn:0,pdn:0,protocol:"TCP"},i.onload=e.onload,i.onloadend=e.onend,i.onerror=e.onerror,i.timeout=e.timeout,i.ontimeout=e.ontimeout,i.onprogress=e.progress,i.onabort=e.onabort,i.onNcFail=e.onNcFail,i.onreadystatechange=function(){if(2===i.readyState)e.onHeadersReceived();else if(4===i.readyState)try{var t=i.getAllResponseHeaders&&i.getAllResponseHeaders();t&&t.indexOf("quic")>-1&&e.request&&e.request.loadInfo&&(e.request.loadInfo.protoabort:function(e){e&&e.response&&e.response.abort()},getP2pType:function(){return""}}}bt.__dashjs_factory_name="XHRLoader";var St=s.a.getClassFactory(bt);function Tt(e){var t=void 0,r={cdn:0,p2p:0},n=void 0,i=(e=e||{}).p2pType,o=!1,a=g(this.context).getInstance().log,s="[P2PLoader]";return{load:function(u){n=u;var c=u.request;t||(t=new e.supplier(u.url,e.video,c.mediaType),a(s,"["+i+"] new sdk loader ["+c.mediaType+"]")),t.onDataArrival=function(e){var n=t&&t.loadInfo();n&&(c.p2pLoadInfo||(c.p2pLoadInfo={cdn:0,p2p:0}),c.p2pLoadInfo.url=n.url),u.progress&&u.progress(null,e,n&&{cdn:n.cdn-r.cdn,p2p:n.p2p-r.p2p,rType:"PCDN"}),r=n||r},t.onError=function(e,t){a(s,"["+i+"] error, status:"+e+", msg:"+t+", type:"+c.mediaType),u.response={status:e,statusText:t},o=!1,u.onerror(),u.onend()},t.onComplete=function(){a(s,"["+i+"] onComplete, type:"+n.request.mediaType),o=!1,u.onload(),u.onend()};var l=void 0;if(c.range){var d=c.range.split("-");l={from:parseInt(d[0]),to:parseInt(d[1]||"-1")}}else l={from:0,to:-1};a(s,"["+i+"] load "+c.mediaType+" url:"+u.url+", range: "+l.from+"-"+l.to),t.load(l,u.withCredentials);var f=t.loadInfo();f&&(c.p2pLoadInfo||(c.p2pLoadInfo={cdn:0,p2p:0}),c.p2pLoadInfo.url=f.url),o=!0},abort:function(){o=!1,t&&(t.abort(),t.onDataArrival=void 0,t.onError=void 0,t.onComplete=void 0),n.onabort(),n.onend(),a(s,"["+i+"] abort sdk ["+n.request.mediaType+"]")},destroySdk:function(){var e=function(){o=!1,t&&(t.destroy(),t=void 0,a(s,"["+i+"] destroy sdk ["+n.request.mediaType+"]")),r={cdn:0,p2p:0}};o?(t.onError=function(t,r){a(s,"["+i+"] error, status:"+t+", msg:"+r+", type:"+n.request.mediaType),n.response={status:t,statusText:r},n.onerror(),n.onend(),e()},t.onComplete=function(){a(s,"["+i+"] detroy sdk onComplete, type:"+n.request.mediaType),n.onload(),n.onend(),e()}):e()},getUrl:function(){return n.url||""},getP2pType:function(){return i}}}Tt.__dashjs_factory_name="P2PLoader";var wt=s.a.getClassFactory(Tt);function At(e){var t,r=void 0,n=void 0;t=(e=e||{}).hid;var i=!1;if(window.localStorage&&localStorage.getItem)try{var o=JSON.parse(localStorage.getItem("bp_nc_config"));o&&1===o.showLog&&(i=!0)}catch(e){}function a(){var e="bpNC";return t&&(e+="_"+t),window[e]}return g(this.context).getInstance().log,{load:function(e){r=e;var t=e.request,o=a();o&&(n=o.getToken(),o.getData({url:t.url,range:t.range,token:n,bitrate:t.bitrate||0,latency:t.latency||5e3}).then((function(r){if(i){var n=0,o="";r&&r.responseData&&(r.responseData.getDataTime&&(n=Math.round(8*r.responseData.gotDataByte/1e3/(r.responseData.getDataTime/1e3))),r.responseData.path&&(o=r.responseData.path),r.peers=r.responseData.usePeerSids&&r.responseData.usePeerSids.length||0),console.log("--\x3e "+o+" nc success, speed is",n,"Kbps, res:",r)}e.progress&&e.progress(null,r.responseData.data,{nc:r.responseData.data.byteLength,cdn:0,rType:"NC",url:t.url,ncBr:r.responseData.gotDataByteFromBr}),e.onNCInfo&&e.onNCInfo(r),e.onload&&e.onload(),e.onend&&e.onend()}),(function(r){if(i){var n=0,o="";r&&r.responseData&&(r.responseData.getDataTime&&(n=Math.round(8*r.responseData.gotDataByte/1e3/(r.responseData.getDataTime/1e3))),r.responseData.path&&(o=r.responseData.path),r.peers=r.responseData.usePeerSids&&r.responseData.usePeerSids.length||0),console.log("--\x3e "+o+" nc fail, speed is",n,"Kbps, res:",r)}if(e.onNCFail&&r.responseData){var a=r.responseData.data?r.responseData.data.byteLength:0,s=r.responseData.gotDataByte?r.responseData.gotDataByte:0;e.onNCFail({ncFail:a,nc:s,ncGotFail:s,cdn:0,rType:"NC",url:t.url,ncBr:r.responseData.gotDataByteFromBr||0})}e.onNCInfo&&e.onNCInfo(r),e.onerror&&e.onerror()})))},abort:function(e){var t=a();t&&n&&t.abortGetData(n),r&&(r.onNCInfo&&r.onNCInfo({code:4999,qn:parseInt(e.representationId,10)||0,responseData:{}}),r&&r.onabort&&r.onabort(),r&&r.onend&&r.onend())},getP2pType:function(){return""},disableRP:function(){var e=a();e&&"function"==typeof e.disableRP&&e.disableRP()}}}At.__dashjs_factory_name="NCLoader";var Rt=s.a.getClassFactory(At);function Pt(e){var t=(e=e||{}).requestModifier;function r(e,t){e.reader.read().then(t).catch((function(){}))}return{load:function(e){var n=new Date,i=e.request,o=new Headers;i.range&&o.append("Range","bytes="+i.range),i.requestStartDate||(i.requestStartDate=n),t&&t.modifyRequestHeader({setRequestHeader:function(e,t){o.append(e,t)}});var a=void 0;"function"==typeof window.AbortController&&(a=new AbortController,e.abortController=a);var s={method:e.method,headers:o,credentials:e.withCredentials?"include":void 0,signal:a?a.signal:void 0};fetch(e.url,s).then((function(t){e.response||(e.response={}),e.response.status=t.status,e.response.statusText=t.statusText,e.response.responseURL=t.url,t.ok||e.onerror();var n="",i=!0,o=!1,a=void 0;try{for(var s,u=t.headers.keys()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;n+=c+": "+t.headers.get(c)+"\n"}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}if(e.response.responseHeaders=n,e.onHeadersReceived(),!t.body)return t.arrayBuffer().then((function(t){e.response.response=t;var r={loaded:t.byteLength,total:t.byteLength};e.progress(r),e.onload(),e.onend()}));var l=parseInt(t.headers.get("Content-Length"),10),d=0,f=!1,p=new Uint8Array,h=0;e.reader=t.body.getReader(),r(e,(function t(n){var i=n.value;if(n.done)return p&&(e.progress({loaded:d,total:isNaN(l)?d:l,lengthComputable:!0}),e.response.response=p.bength+t.length);return r.set(e),r.set(t,e.length),r}(p,i),d+=i.length;var o=be().getInstance().findLastTopIsoBoxCompleted(["moov","mdat"],p,h);if(o.found){var a=o.lastCompletedOffset+o.size,s=void 0;a===p.length?(s=p,p=new Uint8Array):(s=new Uint8Array(p.subarray(0,a)),p=p.subarray(a)),e.progress({data:s.buffer,lengthComputable:!1,noTrace:!0}),h=0}else h=o.lastCompletedOffset,f||(e.progress({lengthComputable:!1,noTrace:!0}),f=!0)}r(e,t)}))})).);else if(e.reader)try{e.reader.cancel()}catch(e){}}}}Pt.__dashjs_factory_name="FetchLoader";var Dt=s.a.getClassFactory(Pt);function Ot(){var e=this.context,t=d(e).getInstance();return{capabilityError:function(e){t.trigger(p.ERROR,{error:"capability",event:e})},downloadError:function(e,r,n,i,o){t.trigger(p.ERROR,{error:"download",event:{id:e,url:r,request:n},code:i,httpCode:o})},manifestError:function(e,r,n,i,o,a){t.trigger(p.ERROR,{error:"manifestError",event:{message:e,id:r,manifest:n,event:i},code:o,httpCode:a})},timedTextError:function(e,r,n){t.trigger(p.ERROR,{error:"cc",event:{message:e,id:r,cc:n}})},mediaSourceError:function(e,r,n){t.trigger(p.ERROR,{error:"mediasource",event:e,code:r,decodeErrorType:n})},
mediaKeySessionError:function(e){t.trigger(p.ERROR,{error:"key_session",event:e})},mediaKeyMessageError:function(e){t.trigon(e){t.trigger(p.ERROR,{error:"mssError",event:e})}}}Ot.__dashjs_factory_name="ErrorHandler";var It=s.a.getSingletonFactory(Ot);It.CAPABILITY_ERROR_MEDIASOURCE="mediasource",It.CAPABILITY_ERROR_MEDIAKEYS="mediakeys",It.DOWNLOAD_ERROR_ID_MANIFEST="manifest",It.DOWNLOAD_ERROR_ID_SIDX="SIDX",It.DOWNLOAD_ERROR_ID_CONTENT="content",It.DOWNLOAD_ERROR_ID_INITIALIZATION="initialization",It.DOWNLOAD_ERROR_ID_XLINK="xlink",It.DOWNLOAD_ERROR_ID_PCDN_SDK="pcdnsdk",It.MANIFEST_ERROR_ID_CODEC="codec",It.MANIFEST_ERROR_ID_PARSE="parse",It.MANIFEST_ERROR_ID_NOSTREAMS="nostreams",It.TIMED_TEXT_ERROR_ID_PARSE="parse",s.a.updateSingletonFactory(Ot.__dashjs_factory_name,In String.fromCharCode.apply(null,new Uint8Array(e))},base642ab:function(e){e=window.atob(e);for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return t},concat:function(e,t){var r=new Uint8Array(e),n=new Uint8Array(t),i=new Uint8Array(r.length+n.length);return i.set(r),i.set(n,r.length),i.buffer}}}Nt.__dashjs_factory_name="ArrayBufferHandler";var kt=s.a.getSingletonFactory(Nt);function Lt(e){e=e||{};var t=void 0,r=g(this.context).getInstance().log,n="[ExternalMediaSourceLoader]",i=e.loader;return{load:function(e){t=e;var o,a=e.request;if(i&&"function"==typeof i){var s=(o=a.url).match(/[^/]+.m4s/gi)&&o.match(/[^/]+.m4s/gi)[0];r(n+" start to get "+s+", range is "+a.range),e.request.loadInfo={rType:"exld",url:a.url},i({filename:s,range:a.range,url:a.url}).then((function(t){return function(e,t){0===e.code?(t.progress&&t.progress(null,e.data,null),t.onload&&t.onload(),t.onend&&t.onend()):(r(n+" Get data error, err code is "+e.code),this.onError("Get data error "+e.code,t))}(t,e)})).catch((function(t){return function(e,t){r(n+" Get data error, err is "+e),t.onerror&&t.onerror()}(t,e)}))}},abort:function(){t&&t.onabort&&t.onabort(),t&&t.onend&&t.onend()}}}Lt.__dashjs_factory_name="ExternalMediaSourceLoader";var xt=s.a.getClassFactory(Lt);function Mt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ft={video:null,audio:null};function Ut(e){e=e||{};var t,r=this.context,i=d(r).getInstance(),a=e.errHandler,s=e.videoModel,u=e.metricsModel,c=e.mediaPlayerModel,l=e.requestModifier,f=e.useFetch||!1,h=e.dashMetrics,y=B()?2:3,m=B()?20:15,v=g(r).getInstance().log,_=void 0,E=void 0,b=void 0,S=void 0,T=[],w=void 0,A={},R=kt(r).getInstance(),P=[],D=0,O=void 0,I=void 0,C=void 0,N=void 0,k=-1,L=0,x=[],M=void 0,U=e.preloadData;function B(){var e=(new Date).getHours();return![12,13,20,21].includes(e)}function j(e){x.length>5&&x.shift(),x.push(e)}function V(e,t){var r=e.url;if(!r||!r.includes("traceid="))return!1;if(t||e.urls.length<2)return!1;if(isNaN(e.index)||e.index<=2&&B())return!0;var n=s&&s.getElement(),i=n&&n.seeking,o=n&&n.currentTime||0,a=0;return n.buffered&&n.buffered.length&&(a=n.buffered.end(0)),!i&&a-o<7}function H(e){e&&e.beforeSeekingRange&&(e.range=e.beforeSeekingRange,e.beforeSeekingRange=null,v("[HTTPLoader] Clear Seek More Bytes"))}function G(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=e.request,h="",y=0,m=0,g=0;if(H(d),d.range){var _=d.range.split("-");if(y=parseInt(_[0]),m=parseInt(_[1]),d.mediaType&&d.representationId&&U&&U[d.mediaType+"id"]===d.representationId+""&&U[d.mediaType]){if(m<U[d.mediaType].byteLength)return m+1===U[d.mediaType].byteLength&&(d.preloadEnd=1),void e.success(U[d.mediaType].slice(y,m+1));y<U[d.mediaType].byteLength&&(h=U[d.mediaType].slice(y,m+1),d.range=U[d.mediaType].byteLength+"-"+m,d.preloadEnd=1)}try{var P=!(!e.params||"boolean"!=typeof e.params.disableSeekDownloadMore)&&e.params.disableSeekDownloadMore;if(s&&!P){var N,x=s.getElement(),B=s.isSeeking(),Q=s.getPlaybackRate()||1,z=x&&x.currentTime||0,J=(d.startTime+d.duration-z)/Q,X="video"===d.mediaType?+d.representationId:0,$=-1;if(x.buffered&&x.buffered.length&&($=x.buffered.end(0)),N=$-z,X&&X<125&&B&&d.index>=2&&N<=0&&J<2.5&&J>=0){var ee=Math.min(1-J/5,.6);d.beforeSeekingRange=d.range;var te=d.range.split("-");y=parseInt(te[0]),m=parseInt(te[1]);var re=nullM[d.mediaType].find((function(e,t){return t>d.index})))){var ie=re.mediaRange.split("-");ne=ie.length&&+ie[1]-+ie[0]||0}var oe=Math.round(ne*ee);d.range=y+"-"+(m+oe),v("[HTTPLoader] Seeking Download More "+oe+" Bytes")}}}catch(e){}}var ae=s.getElement();d.currentTime=ae&&ae.currentTime;var se=d.NCInfo;if(se&&se.responseData&&se.responseData.availableData&&se.responseData.availableData.length>0){var ue=se.responseData.missingData;if(ue&&1===ue.length){var ce=ue[0].start,le=ue[0].end;ce>0&&le>0&&ce>=y&&le<=m&&(d.completeNCMissingRange=!0,d.originRange=d.range,d.range=ce+"-"+le)}}"video"===d.mediaType&&parseInt(d.representationId,10)>=80||(d.completeNCMissingRange=!1,d.originRange&&(d.range=d.originRange)),d.firstByteDate=null;var de=[],fe=d.representationId,pe=!0,he=!0,ye=new Date,me=ye,ge=0,ve=void 0,_e=A[fe]||0,Ee=!1,be=1,Se=0,Te=void 0,we=-1;if(d.urls&&d.urls.length>1&&_e&&(d.url=d.urls[_e],e.url=d.urls[_e]),!l||!u||!a)throw new Error("config object is not correct or missing");var Ae=l.modifyRequestURL(d.url),Re=!(!e.params||"boolean"!=typeof e.params.canUseNC)&&e.params.canUseNC,Pe=s&&s.getElement()&&s.getElement().playbackRate||1,De=(d.bufferLevel||0)/Pe,Oe=function(e){var t=0;try{var r=e&&e.mediaInfo&&e.mediaInfo.bitrateList,n=e&&e.representationId;if(n&&r&&r.length){var i=r.filter((function(e){return e.id===n}));i&&i.length&&(t=i[0].bandwidth)}}catch(e){}return t}(d);if(Oe>1048576){var Ie=parseInt(Oe/1024/1024,10),Ce=Math.min(10,2+1.5*Ie);De=Math.max(0,De-Ce)}else De=Math.max(0,De-2);var Ne=Y({canUseNC:Re,rangeStart:y,mediaUrl:Ae,bufferLevel:De,bitrate:Oe,originBufferLevel:d&&d.bufferLevel||0,isSwitchingQn:!(!d||!d.isSwitchingQn)});Ne&&H(d);try{if(V(d,Ne)){if(!n&&d.urls.length){var ke=d.urls[1]||d.url;ke&&(Ae=d.url=ke)}we=1}}catch(e){}var Le=function(e){he=!1;var t=new Date;if(d.requestStartDate=ye,d.requestEndDate=t,d.firstByteDate=d.firstByteDate||t,H(d),function(e){if(e.p2pLoadInfo&&e.loadInfo){var t=function(e){for(var t in e)["url","rType"].indexOf(e)>-1||(r[t]=(r[t]||0)+(e[t]||0))},r={};t(e.p2pLoadInfo),t(e.loadInfo),r.rType="XHR",r.url=e.loadInfo.url||e.p2pLoadInfo.url||"",e.loadInfo=r}else e.loadInfo=e.p2pLoadInfo||e.loadInfo||{};"XHR"===e.loadInfo.rType&&(e.url&&e.url.indexOf("traceid=")>-1?e.loadInfo.pdn=e.bytesTotal||e.bytesLoaded||0:e.loadInfo.cdn=e.bytesTotal||e.bytesLoaded||0,e.loadInfo.url=e.url)}(d),e){if(Ne||!Ne&&d&&d.p2pLoadInfo&&d.p2pLoadInfo.nc){Ne&&(L=0);var r=d.requestEndDate,n=d.startLoadFragmentTime;n&&r&&j(r.getTime()-new Date(n).getTime())}}else if(Ne&&d&&d.mediaType){var i=k,o=d.index;d.p2pLoadInfo&&(isNaN(o)||o-i!=1&&-1!==i||L++),k=o}d.checkExistenceOnly||u.addHttpRequest(d.mediaType,null,d.type,d.url,ve.response?ve.response.responseURL:null,d.serviceLocation||null,d.range||null,d.requestStartDate,d.firstByteDate,d.requestEndDate,ve.response?ve.response.status:null,d.duration,ve.response&&ve.response.getAllResponseHeaders?ve.response.getAllResponseHeaders():ve.response?ve.response.responseHeaders:null,e?de:null)},xe=function(){if(clearTimeout(Se),-1!==E.indexOf(ve)){E.splice(E.indexOf(ve),1),Te=!1;var r=ve&&ve.response&&ve.response.status;if(he)if(Le(!1),e.params&&(e.params.canUseNC=!1),function(e){var t=e.NCInfo;return t&&t.responseData&&t.responseData.missingData&&t.responseData.missingData.length>0}(d)&&e.params&&(e.params.disableSeekDownloadMore=!0),t>0){var s=0,u=0;Date.now()-ye<50&&(u=!d.index||d.index<=2||performance&&performance.now&&performance.now()<1e4?1e3*(n+1)/100:1e3*(n+1),g=o.CONNECT_FRAGMENT_ERROR_OFFLINE),(r>=400&&r<500||r>=600)&&(u=0,s=0),Ne&&(u=0,s=0),D=setTimeout((function(){var o;c.setRetryTimes(n+1),Ne||n++;var a=ve.request,u=ve.request&&ve.request&&ve.request.NCInfo;if(a.retryTimes=n,i.trigger(p.REQUEST_RETRYED,(Mt(o={retryTimes:n,representationId:fe,status:ve.response&&ve.response.status,
url:a.url,mediaType:a.mediaType,range:a.range,rType:Ne?"NC":"XHR",code:(Ne?u&&u.code:ve.response&&ve.response.status)||g,index:a&&a.index,id:a&&a.representationId},"url",a&&a.url),Mt(o,"timeout",a.timeout),Mt(o,"latencyTime",a.latency),Mt(o,"downloadTime",(a.requestEndDate&&a.requestEndDate.getTime())-(a.requestStartDate&&a.requestStartDate.getTime())),o)),c.getP2pPermission()&&4203===r&&K(),e.request.urls&&e.request.urls.length>1){var l=n%a.urls.length;a.urls&&a.urls.length&&a.urls[0].includes("traceid=")&&(we>0?l=(n+1)%a.urls.length:Ne?(W(a.mediaType)||0)<30&&(l=(n+1)%a.urls.length):l===A[fe]&&(l=(l+1)%a.urls.length)),A[fe]=l,_e=A[fe],e.request.url=a.urls[_e],e.url=a.urls[_e],t--,S.push(setTimeout((function(){v("[HTTPLoader] internalLoad failure retry, useNC: "+Ne),G(e,t,n)}),s))}else t--,S.push(setTimeout((function(){v("[HTTPLoader] internalLoad failure retry, useNC: "+Ne),G(e,t,n)}),s))}),u)}else a.downloadError(w[d.type].type,d.url,d,w[d.type].code,ve.response&&ve.response.status),e.error&&e.error(d,"error",ve.response&&ve.response.statusText,ve.response&&ve.response.status),e.complete&&e.complete(d,ve.response&&ve.response.statusText),q(d.mediaType)}},Me=function(e){var t=s.getPlaybackRate()||1,r=e.request,n=e.useNC,i=e.modifiedUrl,o=e.retryTimes,a=e.connectMaxTime,u=e.bitrate,c=a+1e3*o+50,l=r.timeout+3e3*o;if((n||i&&i.includes("traceid"))&&(c=function(e,t){var r=5e3,n=1e4,i=5e3;return e<15?i=r:e<20?i=1e3*parseInt(e-10,10):e>20&&(i=n),i=Math.min(i,n),i=Math.max(i,r),v("NCLoader latency, bufferLevel: "+e+", latencyTimeout: "+i),i}(r.bufferLevel),r.bitrate=u,r.latency=c,l=c+200),isNaN(r.bufferLevel)||!t||!r.bufferLevel)return{latencyTimeout:c,timeout:l};var d=r.bufferLevel/t*1e3,f=n?5e3:2e3,p=n?.6:.2,h=Math.max,y=Math.min;return{latencyTimeout:0|h(y(c,d*p),f),timeout:0|h(y(l,.6*d),5e3)}}({request:d,useNC:Ne,modifiedUrl:Ae,retryTimes:n,connectMaxTime:2e3,bitrate:Oe}),Fe=Me.latencyTimeout,Ue=Me.timeout;Se=setTimeout((function(){c.getP2pPermission()&&"function"==typeof Te.getP2pType&&Te.getP2pType()&&c.addP2pSDKErrorCount(),Ee=!0,Te.abort(ve),T.push(4106),e.connectTimeout&&e.connectTimeout(d,Fe,Ne),xe()}),Fe);var Be=new Uint8Array,je=function(e,t){var r=t||e.response.response,n=e.request;if(n&&n.beforeSeekingRange){var i=n.beforeSeekingRange.split("-"),o=parseInt(i[0]),a=parseInt(i[1]),s=new Uint8Array(r.slice(0,a-o+1));return n.range=n.beforeSeekingRange,n.beforeSeekingRange=null,s.buffer}return r},Ve=Z();if(Ve&&"function"==typeof Ve)Te=xt(r).create({requestModifier:l,loader:Ve});else if(Ne)Te=Rt(r).create({requestModifier:l,hid:O}),c.getUseP2P()||Te.disableRP(),i.trigger(p.CDN_LOAD_INFO,{NCInfo:{code:9999,qn:parseInt(d.representationId,10)||0,range:d.range,responseData:{}}});else if(f&&window.fetch&&"arraybuffer"===d.responseType)Te=Dt(r).create({requestModifier:l});else{var He=window.__DASH_P2P_TYPE__,Ge={yf:window.YFDashIO,xl:window.xyvp&&window.xyvp.Loader,ks:window.KSLoader,pear:window.PearDownloader,bili:window.DIYSdk},qe=void 0,We=void 0,Ke=void 0;if(He&&c.getP2pPermission()){var Ye=He.match(/([a-z]+)-([a-z0-9]+)/);Ye&&(qe=Ge[Ye[1]],Ke="cg2"===Ye[2],We="eg"===Ye[2]),qe||delete window.__DASH_P2P_TYPE__}We&&qe&&d.index>=0?Ft[d.mediaType]&&Ft[d.mediaType].getP2pType()&&function(e,t){var r=e.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)&&e.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)[1],n=t.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)&&t.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)[1];return r&&n&&r===n}(Ft[d.mediaType].getUrl(),Ae)?Te=Ft[d.mediaType]:(q(d.mediaType),Te=wt(r).create({video:s.getElement(),p2pType:He,supplier:qe}),Ft[d.mediaType]=Te):Ke&&qe&&"video"===d.mediaType&&Ae!==C&&(C=Ae,I&&I.destroy(),I=new qe(Ae,s.getElement(),"watch")),Te||(q(d.mediaType),Te=St(r).create({requestModifier:l}))}var Qe=d.checkExistenceOnly?F.HEAD:F.GET,ze=c.getXHRWithCredentialsForType(d.type);ve={url:Ae,method:Qe,withCredentials:ze,timeout:Ue,request:d,onload:function(){if(ve.response){if(ve.response.status>=200&&ve.response.status<=299){var t=je(ve);h&&(t=R.concat(h,t),d.range=y+"-"+m),Le(!0),e.success&&e.success(t,ve.response.statusText,ve.response.responseURL),e.complete&&e.complete(d,ve.response.statusText)}}else{var r=je(ve,Be);h&&(r=R.concat(h,r),d.range=y+"-"+m),Le(!0),e.success&&e.success(r,"",Ae),e.complete&&e.complete(d,"")}},onend:xe,onerror:xe,ontimeout:function(){T.push(4105),e.timeout&&e.timeout(d,be,Ue),xe()},progress:function(t,r,n){var i=new Date;if(n){for(var o in d.p2pLoadInfo||(d.p2pLoadInfo={}),n)["p2p","cdn","nc","ncBr","pdn"].indexOf(o)>-1?d.p2pLoadInfo[o]=(d.p2pLoadInfo[o]||0)+n[o]:d.p2pLoadInfo[o]=n[o];d.p2pLoadInfo.requestStartTime=ye}if(!t){if(t={lengthComputable:!1,total:0,loaded:0},r&&(Be=R.concat(Be,r),t.loaded=Be.byteLength),d.range){var a=d.range.split("-"),s=parseInt(a[0]),u=parseInt(a[1]);u&&(t.total=u-s+1)}t.loaded&&t.total&&(t.lengthComputable=!0)}pe&&(pe=!1,(be=i-ye)<2e3&&clearTimeout(Se),(!t.lengthComputable||t.lengthComputable&&t.total!==t.loaded)&&(d.firstByteDate=i)),t.lengthComputable&&(d.bytesLoaded=t.loaded,d.bytesTotal=t.total),t.noTrace||(de.push({s:me,d:i.getTime()-me.getTime(),b:[t.loaded?t.loaded-ge:0]}),me=i,ge=t.loaded),e.progress&&t.loaded&&e.progress(t.loaded)},onabort:function(){clearTimeout(Se),clearTimeout(D),e.abort&&!Ee&&e.abort(d)},onHeadersReceived:function(){d.headersReceivedDate=new Date,e.headersReceived&&e.headersReceived(ve.response&&ve.response.getAllResponseHeaders&&ve.response.getAllResponseHeaders())},onNCFail:function(e){if(e){for(var t in d.p2pLoadInfo||(d.p2pLoadInfo={}),e)["p2p","cdn","nc","ncFail","ncGotFail","ncBr","pdn"].indexOf(t)>-1?d.p2pLoadInfo[t]=(d.p2pLoadInfo[t]||0)+e[t]:d.p2pLoadInfo[t]=e[t];d.p2pLoadInfo.requestStartTime=ye}},onNCInfo:function(e){e.qn=parseInt(d.representationId,10)||0,d.NCInfo=e},loader:Te};var Ze=(new Date).getTime();if(isNaN(d.delayLoadingTime)||Ze>=d.delayLoadingTime)E.push(ve),Te.load(ve);else{var Je={htJe.httpRequest)}catch(e){Je.httpRequest.onerror()}}}),d.delayLoadingTime-Ze)}}function q(e){Ft[e]&&Ft[e].destroySdk&&(Ft[e].destroySdk(),Ft[e]=null)}function W(e){if(h)return-1!==[n.VIDEO,n.AUDIO,n.FRAGMENTED_TEXT].indexOf(e)&&h.getCurrentBufferLevel(u.getReadOnlyMetricsFor(e))||NaN}function K(){i.trigger(p.PCDN_LOADED_ERROR,{code:o.DOWNLOAD_PCDN_DISABLED,from:1}),c.setP2pPermission(!1)}function Y(e){if(!c.getUseNC())return!1;var t=e.canUseNC,r=e.rangeStart,n=e.mediaUrl,i=e.bufferLevel,o=e.bitrate,a=e.originBufferLevel,u=e.isSwitchingQn;if(isNaN(r)||r<0||!n||u)return!1;var l=function(){var e="bpNC";return O&&(e+="_"+O),window[e]}();if(!t||!l||"function"!=typeof l.allowDPGetDataByNC)return!1;var d=(""+n).split("?")[0].split("/"),f=d[d.length-1].split(".")[0].split("-").pop();if(!f)return!1;var p=parseInt(f,10);if(isNaN(p))return!1;var h,g=NaN,_=!1,E=1;if(s&&s.getElement()){var b=s.getElement(),S=b.currentTime,T=0;b.buffered&&b.buffered.length&&(T=b.buffered.end(0)),g=T-S,_=b&&b.seeking,E=b&&b.playbackRate||1}return!isNaN(g)&&!(!i||a/E<=((h=x.length)&&x.reduce((function(e,t){return e+t}))/h/1e3||0))&&(L>=y&&i/E<m?(v("[disableNc] cause ncLoaderFailedConstantlyTimes is "+L),!1):(v("Is Use NCLoader, "+l.allowDPGetDataByNC({rangeStart:r,qn:p,bufferRemaining:g,bufferLevel:i,isSeeking:_,bitrate:o,originBufferLevel:a})+","+JSON.stringify({rangeStart:r,qn:p,bufferRemaining:g,bufferLevel:i,isSeeking:_,bitrate:o,originBufferLevel:a})),l.allowDPGetDataByNC({rangeStart:r,qn:p,bufferRemaining:g,bufferLBufferLevel:a})))}function Q(e){e&&e.hid&&(O=e.hid)}function z(e){e&&e.loader&&!N&&(N=e.loader,i.off(p.BIND_MEDIA_SOURCE_LOADER,z,_))}function Z(){var e=N||c.getExternalMediaLoader();return v("[getMediaSourceLoader] use media source loader is ",!!e),e}return U&&(U.video&&"string"==typeof U.video&&(U.video=R.base642ab(U.video)),U.audio&&"string"==typeof U.audio&&(U.audio=R.base642ab(U.audio))),_={load:function(e){e.request&&(c.setRetryTimes(0),G(e,c.getRetryAttemptsForType(e.request.type),0))},abort:function(){I&&(I.destroy(),I=void 0,C=void 0),N&&(N=null),
clearTimeout(D),P.forEach((function(e){return clearTimeout(e)})),S.forEach((fch((function(e){return clearTimeout(e.delayTimeout)})),b=[],E.forEach((function(e){e&&e.request&&isNaN(e.request.index)||(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e),e.onabort())})),E=[],i.off(p.INIT_HID,Q,_),i.off(p.BIND_MEDIA_SOURCE_LOADER,z,_)},setPreloadData:function(e){(U=e)&&(U.video&&"string"==typeof U.video&&(U.video=R.base642ab(U.video)),U.audio&&"string"==typeof U.audio&&(U.audio=R.base642ab(U.audio)))},setSegmentsInfo:function(e){e&&e.segments&&(M||(M={}),M[e.mediaType]=e.segments)}},i.on(p.INIT_HID,Q,_),i.on(p.BIND_MEDIA_SOURCE_LOADER,z,_),E=[],b=[],S=[],Mt(t={},F.MPD_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_MANIFEST,code:o.DOWNLOAD_MPD_ERROR}),Mt(t,F.XLINK_EXPANSION_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_XLINK,code:o.DOWNLOAD_XINK_ERROR}),Mt(t,F.INIT_SEGMENT_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_INITIALIZATION,code:o.DOWNLOAD_INIT_SEGMENT_ERROR}),Mt(t,F.MEDIA_SEGMENT_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_CONTENT,code:o.DOWNLOAD_MEDIA_SEGMENT_ERROR}),Mt(t,F.INDEX_SEGMENT_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_CONTENT,code:o.DOWNLOAD_INDEX_SEGMENT_ERROR}),Mt(t,F.BITSTREAM_SWITCHING_SEGMENT_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_CONTENT,code:o.DOWNLOAD_SWITCHING_SEGMENT_ERROR}),Mt(t,F.OTHER_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_CONTENT,code:o.DOWNLOAD_OTHER_ERROR}),w=t,_}Ut.__dashjs_factory_name="HTTPLoader";var Bt=s.a.getClassFactory(Ut);function jt(){var e=this.context,t=g(e).getInstance().log,r=d(e).getInstance(),n=void 0,i=void 0,ar("setConfig function has to be called previously")}function m(e){if(e.url){var t=new y;return t.type=e.init?F.INIT_SEGMENT_TYPE:F.MEDIA_SEGMENT_TYPE,t.url=e.url,t.urls=e.urls,t.range=e.range.start+"-"+e.range.end,t.representationId=e.representationId,t.mediaType=e.mediaType,t}}function v(e,t,n){e?r.trigger(p.SEGMENTS_LOADED,{segments:e,representation:t,mediaType:n}):r.trigger(p.SEGMENTS_LOADED,{segments:null,representation:t,mediaType:n,error:new w(null,"error loading segments",null)})}return{setConfig:function(e){e.baseURLController&&(f=e.baseURLController),e.metricsModel&&(u=e.metricsModel),e.mediaPlayerModel&&(c=e.mediaPlayerModel),e.errHandler&&(n=e.errHandler),e.videoModel&&(i=e.videoModel)},initialize:function(){a=be(e).getInstance(),s=Et(e).getInstance(),l=Bt(e).create({errHandler:n,videoModel:i,metricsModel:u,mediaPlayerModel:c,requestModifier:s,preloadData:c.getPreloadData()})},loadInitialization:function e(n,i){h();var o=null,s=null,u=f.resolve(n.path),c=i||{init:!0,url:u?u.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500};t("Start searching for initialization.");var d=m(c);l.load({request:d,success:function(i){c.bytesLoaded=c.range.end,s=a.parse(i),(o=function(e){var r=e.getBox("ftyp"),n=e.getBox("moov"),i=null,o=void 0,a=void 0;return t("Searching for initialization."),n&&n.isComplete&&(o=r?r.offset:n.offset,a=n.offset+n.size-1,t("Found the initialization.  Range: "+(i=o+"-"+a))),i}(s))?(n.range=o,r.trigger(p.INITIALIZATION_LOADED,{representation:n})):(c.trigger(p.INITIALIZATION_LOADED,{representation:n})}}),t("Perform init search: "+c.url)},loadSegments:function e(r,i,s,u,d){if(h(),s&&(void 0===s.start||void 0===s.end)){var p=s?s.toString().split("-"):null;s=p?{start:parseFloat(p[0]),end:parseFloat(p[1])}:null}s.start=0,d=d||v;var y=null,g=null,_=!!s,E=f.resolve(r.path),b={init:!1,url:E?E.url:void 0,urls:E.urls,range:_?s:{start:0,end:1500},searching:!_,bytesLoaded:u?u.bytesLoaded:0,bytesToLoad:1500,represe:r.adaptation.type},S=m(b),T=function(){d(null,r,i)};l.load({request:S,success:function(s){if(b.bytesLoaded=b.range.end-b.range.start,y=a.parse(s),(g=y.getBox("sidx"))&&g.isComplete){var u=g.references,l=void 0,f=void 0;if(null!=u&&u.length>0&&(l=1===u[0].reference_type),l){t("Initiate multiple SIDX load."),b.range.end=b.range.start+g.size;var p=void 0,h=void 0,m=void 0,v=n(e){e?(_=_.concat(e),++E>=h&&d(_,r,i)):d(null,r,i)};for(p=0,h=u.length;p<h;p++)m=S,v=S+u[p].referenced_size-1,S+=u[p].referenced_size,e(r,null,{start:m,end:v},b,w)}else{t("Parsing segments from SIDX."),f=function(e,t){for(var r=e.references,n=r.length,i=e.timescale,o=e.earliest_presentation_time,a=t.range.start+e.offset+e.first_offset+e.size,s=[],u=void 0,c=void 0,l=void 0,d=void 0,f=0;f<n;f++)l=r[f].subsegment_duration,d=r[f].referenced_size,(u=new nt).duration=l,u.startTime=o,u.timescale=i,c=a+d-1,u.mediaRange=a+"-"+c,s.push(u),o+=l,a+=d;return s}(g,b);try{var A=f[f.length-1],R=(A.duration+A.startTime)/A.timescale;r.adaptation.period.min?r.adaptation.period.min=Math.min(r.adaptation.period.min,R):r.adaptation.period.min=R;var P=c.getCachedDurationOffset("offset");r.adaptation.period.duration=parseFloat((P+r.adaptation.period.min).toFixed(5)),t("Set real min period duration "+r.adaptation.period.duration+" ( "+P+" )")}catch(e){t("Set real period error "+i)}d(f,r,i)}}else T(),n.mediaSourceError("Error parsing "+i+" response.",o.MEDIA_DECODE_ERROR)},error::function(){l&&l.setPreloadData(c.getPreloadData())},reset:function(){l.abort(),l=null,n=null,a=null,s=null}}}jt.__dashjs_factory_name="SegmentBaseLoader";var Vt=s.a.getSingletonFactory(jt);function Ht(e){e=e||{};var t=this.context,r=d(t).getInstance(),i=rt(t).getInstance(),o=void 0,a=e.timelineConverter,s=e.dashMetrics,u=e.metricsModel,c=e.mediaPlayerModel,l=e.errHandler,f=e.baseURLController,h=void 0,m=void 0,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,A=void 0;function R(){v=-1,E=0,b=NaN,_=null,S=null,T=null}function P(e,t,r){var n=f.resolve(r.path),o=void 0,a=void 0,s=void 0;return n&&t!==n.url&&i.isRelative(t)?(o=n.url,a=n.urls||[],s=n.serviceLocation,t&&(o=i.resolve(t,o))):a=[o=t],!i.isRelative(o)&&(e.url=o,e.urls=a,e.serviceLocation=s,!0)}function D(e){var t=!1,r=S?S.getStreamInfo().manifestInfo.isDynamic:null;if(r||v!==e.availableSegmentsNumber){var n=ct(v,e);if(n){var i=parseFloat((n.presentationStartTime-e.adaptation.period.start).toFixed(5)),o=c.getCachedDurationOffset("duration"),a=o?Math.min(e.adaptation.period.duration,o):e.adaptation.period.duration;a=e.adaptation.period.duration,m(e.segmentInfoType+": "+i+" / "+a),t=(e.segmentInfoType!==Je.SEGMENT_TIMELINE||!r)&&i>=a}else m("isM t=!0;return t}function O(e){T.getSegments(e,_,v,I)}function I(e,t){var r=S?S.getStreamInfo().manifestInfo.isDynamic:null;if(e.segments=t,t&&t.length>0&&(b=isNaN(b)?t[0].presentationStartTime:Math.min(t[0].presentationStartTime,b),r&&isNaN(a.getExpectedLiveEdge()))){var i=t[t.length-1].presentationStartTime,o=u.getMetricsFor(n.STREAM);a.setExpectedLiveEdge(i),u.updateManifestUpdateInfo(s.getnew Error("no representation");e.segments=null,O(e)}function N(e,t,r){var n=t.segments,i=n?n.length:null,o=-1,a=void 0,s=void 0,u=void 0,l=void 0,d=void 0;if(n&&i>0){for(r=null==r?c.getSegmentOverlapToleranceTime():r,d=0;d<i;d++)if(u=(s=n[d]).presentationStartTime,l=s.duration,e+(a=null==r?l/2:r)>=u&&e-a<u+l){o=s.availabilityIdx;break}0===e&&n[0].presentationStartTime>0&&(o=0)}return o}function k(e){if(null==e)return null;var t=new y,r=e.representation,n=r.adaptation.period.mpd.manifest.Period_asArray[r.adaptation.period.index].AdaptationSet_asArray[r.adaptation.index].Representation_asArray[r.index].bandwidth,i=e.media,o=S?S.getType():null;return i=at(i,"Number",e.re)ring();return e.split("$RepresentationID$").join(r)}(i=at(i,"Bandwidth",n),r.id)),t.mediaType=o,t.type=F.MEDIA_SEGMENT_TYPE,t.range=e.mediaRange,t.startTime=e.presentationStartTime,t.duration=e.duration,t.timescale=r.timescale,t.availabilityStartTime=e.availabilityStartTime,
t.availabilityEndTime=e.availabilityEndTime,t.wallStartTime=e.wallStartTime,t.quality=r.index,t.index=e.availabilityIdx,t.mediaInfo=S.getMediaInfo(),t.adaptationIndex=r.adaptation.index,t.representationId=r.id,P(t,i,r)?t:void 0}function L(e,t,r){var n=void 0,i=S?S.getType():null,o=S?S.getStreamInfo().manifestInfo.isDynamic:null,a=v,s=!!r&&r.keepIdx,u=r?r.timeThreshold:null,c=!(!r||!r.ignoreIsFinished);return e?(_!==t&&(_=t,m("Getting the request for "+i+" time : "+t)),O(e),(v=N(t,e,u))<0&&(O(e),v=N(t,e,u)),v>0&&m("Index for "+i+" time "+t+" is "+v),!c&&D(e)?((n=new y).action=y.ACTION_COMPLETE,n.index=v,n.mediaType=i,n.mediaInfo=S.getMediaInfo(),m("Signal complete in getSegmentRequestForTime -",i)):n=k(ct(v,e)),s&&a>=0&&(v=e.segmentInfoType===Je.SEGMENT_TIMELINE&&o?v:a),n):null}function x(e){var t=e.representation;t.segments&&r.trigger(p.REPRESENTATION_UPDATED,{sender:this,representation:t})}function M(e){var t=S?S.getType():null,n=S?S.getStreamInfo().manifestInfo.isDynamic:null;if(!e.error&&t===e.mediaType){var i,o=e.segments,s=e.representation,u=[],l=0,d=void 0,f=void 0,h=void 0,y=0;for(c.getAppendingSourceState()&&(A=c.getCachedDurationOffset("offset"),y=o[0].startTime,v=0),d=0,i=o.length;d<i;d++)f=o[d],h=ut(a,n,s,f.startTime+A*f.timescale-y,f.duration,f.timescale,f.media,f.mediaRange,l),u.push(h),h=null,l++;s.segmentAvailabilityRange={start:u[0].presentationStartTime,end:u[i-1].presentationStartTime},s.availableSegmentsNumber=i,I(s,u),Xe.hasInitialization(s)&&r.trigger(p.REPRESENTATION_UPDATED,{sender:this,representation:s})}}return h={initialize:function(r){var n=(S=r)?S.getStreamInfo().manifestInfo.isDynamic:null;o.initialize(),T=vt(t).create(e,n)},getStreamProcessor:function(){return S},getInitRequest:function(e){var t=S?S.getType():null;return e?function(e,t){var r=new y,n=e.adaptation.period,i=n.start,o=S?S.getStreamInfo().manifestInfo.isDynamic:null;if(r.mediaType=t,r.type=F.INIT_SEGMENT_TYPE,r.range=e.range,r.availabilityStartTime=a.calcAvailabilityStartTimeFromPresentationTime(i,n.mpd,o),r.availabilityEndTime=a.calcAvailabilityEndTimeFromPresentationTime(i+n.duration,n.mpd,o),r.quality=e.index,r.mediaInfo=S?S.getMediaInfo():null,r.representationId=e.id,P(r,e.initialization,e))return r}(e,t):null},getSegmentRequestForTime:L,getNextSegmentRequest:function(e){var t=void 0,r=void 0,n=S?S.getType():null,i=S?S.getStreamInfo().manifestInfo.isDynamic:null;return e&&-1!==v?(_=null,v++,m("Getting the next request at index: "+v+", type: "+n),!ct(v,e)&&i?(m("No segment found at index: "+v+". Wait for next loop"),O(e),v--,null):(D(e)?((t=new y).action=y.ACTION_COMPLETE,t.index=v,t.mediaType=n,t.mediaInfo=S.getMediaInfo(),m("Signal complete -",n)):(O(e),t=k(r=ct(v,e)),!r&&i&&v--),t)):null},generateSegmentRequestForTime:function(e,t){var r=(e.segmentAvailabilityRange.end-e.segmentAvailabilityRange.start)/2;return e.segments=null,e.segmentAvailabilityRange={start:t-r,end:t+r},L(e,t,{keepIdx:!1,ignoreIsFinished:!0})},updateRepresentation:function(e,t){var n=Xe.hasInitialization(e),i=Xe.hasSegments(e),s=S?S.getType():null,u=S?S.getStreamInfo().manifestInfo.isDynamic:null,c=void 0;if(e.segmentDuration||e.segments||C(e),e.segmentAvailabilityRange=a.calcSegmentAvailabilityRange(e,u),e.segmentAvailabilityRange.end<e.segmentAvailabilityRange.start&&!e.useCalculatedLiveEdgeTime)return c=new w(1,"no segments are available yet",{availabilityDelay:e.segmentAvailabilityRange.start-e.segmentAvailabilityRange.end}),void r.trigger(p.REPRESENTATION_UPDATED,{sender:this,representation:e,error:c});t||(v=-1),e.segmentDuration&&C(e),n||o.loadInitialization(e),i||o.loadSegments(e,s,e.indexRange),n&&i&&r.trigger(p.REPRESENTATION_UPDATED,{sender:this,representation:e})},updateSegmentList:C,setCurrentTime:function(e){c.getCachedDurationOffset("duration")&&(e=Math.min(c.getCachedDurationOffset("duration"),e)),E=e},getCurrentTime:function(){return E},getEarliestTime:function(){return b},resetPreloadData:function(){o&&o.resetPreloadData()},reset:function(){R(),r.off(p.INITIALIZATION_LOADED,x,h),r.off(p.SEGMENTS_LOADED,M,h)},getIndex:function(){return v},setIndex:function(e){v=e}},m=g(t).getInstance().log.bind(h),R(),(o=Vt(t).getInstance()).setConfig({baseURLController:f,metricsModel:u,mediaPlayerModel:c,videoModel:e.videoModel,errHandler:l}),A=0,r.on(p.INITIALIZATION_LOADED,x,h),r.on(p.SEGMENTS_LOADED,M,h),h}Ht.__dashjs_factory_name="DashHandler";var Gt=s.a.getClassFactory(Ht);Gt.SEGMENTS_UNAVAILABLE_ERROR_CODE=1,s.a.updateClassFactory(Ht.__dashjs_factory_name,Gt);var qt=Gt;function Wt(e){e=e||{};var t=this.context,r=void 0,i=e.type,o=e.errHandler,a=e.mimeType,s=e.timelineConverter,u=e.adapter,c=e.manifestModel,l=e.mediaPlayerModel,d=e.stream,f=e.abrController,p=e.playbackController,h=e.streamController,y=e.mediaController,m=e.domStorage,v=e.metricsModel,_=e.dashMetrics,E=e.dashManifestModel,b=g(t).getInstance(),S=void 0,T=void 0,w=void 0,A=void 0,Rd 0;function N(){C=[]}function k(){A=[],w=null,N()}function L(){return d?d.getStreamInfo():null}function x(){return w}return S={initialize:function(g){(r=qt(t).create({mimeType:a,timelineConverter:s,dashMetrics:_,metricsModel:v,mediaPlayerModel:l,baseURLController:e.baseURLController,videoModel:e.videoModel,errHandler:o})).initialize(S),f.registerStreamType(i,S),(I=d.getFragmentController().getModel(i)).setStreamProcessor(S),R=function(e){var r=null;return e!==n.VIDEO&&e!==n.AUDIO||(r=Le(t).create({type:e,metricsModel:v,mediaPlayerModel:l,manifestModel:c,errHandler:o,streamController:h,mediaController:y,adapter:u,abrController:f,playbackController:p,streamProcessor:S})),r}(i),P=Ze(t).create({type:i,metricsModel:v,adapter:u,dashMetrics:_,dashManifestModel:E,timelineConverter:s,mediaPlayerModel:l,abrController:f,playbackController:p,streamController:h,streamProcessor:S,mediaController:y}),(O=et(t).create()).setConfig({abrController:f,domStorage:m,metricsModel:v,dashMetrics:_,dashManifestModel:E,manifestModel:c,playbackController:p,timelineConverter:s,streamProcessor:S}),R.initialize(g),P.initialize(),O.initialize()},isUpdating:function(){return!!O&&O.isUpdating()},getType:function(){return i},getBufferController:function(){return R},getFragmentModel:function(){return I},getScheduleController:function(){return P},getLiveEdgeFinder:function(){return D},getEventController:function(){return :function(){return d?d.getFragmentController():null},getRepresentationController:function(){return O},getIndexHandlfunction(){return u.getCurrentReon(e){return u.getRepresentationInfoForQuality(O,e)},getBufferLevel:function(){return R.getBufferLevel()},switchInitData:function(e,t){Rd:function(){return!!R&&R.getIsBufferingCompleted()},createBuffer:function(){return R.getBuffer()||R.createBuffer(w)},getStreamInfo:L,updateMediaInfo:function(e){if(!(e===w||e&&w&&e.type!==w.type)){var t=(w=e).bitrateList.map((function(e){return{id:e.id,bandwidth:e.bandwidth}}));T("[mediaInfo] type: "+w.type+", bitrateList: "+JSON.stringify(t))}-1===A.indexOf(e)&&A.push(e),u.updateData(this)},switchTrackAsked:function(){P.switchTrackAsked()},getMediaInfoArr:function(){return A},getMediaInfo:x,getMediaSource:,setMediaSource:function(e){R.setMediaSource(e,x())},dischargePreBuffer:function(){R.dischargePreBuffer()},getBuffer:function(){return R.getBuffer()},setBuffer:function(e){R.setBuffer(e)},registerExternalControllerunction(e){var t=C.indexOf(e);-1!==t&&C.splice(t,1)},getExternalControllers:function(){return C},unregisterAllExternalController:N,getPlaybackController:function(){return p},resetPreloadData:function(){I.resetPreloadData(),r.resetPreloadData()},reset:function(e){r.reset(),R&&(R.reset(e),R=null),P&&(P.reset(),P=null),O&&(O.reset(),O=null),f&&f.unRegisterStreamType(i),C.forEach((function(e){e.reset()})),k(),i=null,d=null,D&&(D.reset(),D=null)}},p&&p.getIsDynamic()&&(D=Ve(t).create({timelineConverter:s,
streamProcessor:S})),T=b.log.bind(S),k(),S}Wt.__dashjs_factory_name="StreamProcessor";var Kt=s.a.getClassFactory(Wt);function Yt(){var e,t="urn:mpeg:dash:event:2012",r=this.context,n=g(r).getInstance().log,i=d(r).getInstance(),o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,y=void 0,m=void 0;function v(){m=!1,o={},a={},s={},u=null,l=(c=100)/1e3}function _(){if(!f||!h||!y)throw new Errion E(){null!==u&&m&&(clearInterval(u),u=null,m=!1)}function b(e){if(1==e.eventStream.value){var t,r=e.eventStream.timescale||1,o=e.presentationTime/r;t=4294967295==e.presentationTime?NaN:(e.presentationTime+e.duration)/r,n("Manifest validity changed: Valid until: "+o+"; remaining duration: "+t),i.trigger(p.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:o,newDuration:t,newManifestValidAfter:NaN})}}function S(){T(a),T(o),function(){if(s)for(var e=y.getTime(),t=Object.keys(s),r=0;r<t.length;r++){var i=t[r],o=s[i];null!==o&&(o.duration+o.presentationTime)/o.eventStream.timescale<e&&(n("Remove Event "+i+" at time "+e),o=null,delete s[i])}}()}function T(e){var r,o=y.getTime();if(e)for(var a=Object.keys(e),u=0;u<a.length;u++){var c=a[u],d=e[c];void 0!==d&&(0==(r=d.presentationTime/d.eventStream.timescale)||r<=o&&r+l>o)&&(n("Start Event "+c+" at "+o),d.duration>0&&(s[c]=d),d.eventStream.schemeIdUri==t&&1==d.eventStream.value?0===d.duration&&0===d.presentationTimeDelta||(_(),h.refreshManifest()):i.trigger(d.eventStream.schemeIdUri,{event:d}),delete e[c])}}return e={addInlineEvents:function(e){if(_(),o={},e)for(var t=0;t<e.length;t++){var r=e[t];o[r.id]=r,n("Add inline event with id "+r.id)}n("Added "+e.length+" inline events")},addInbandEvents:function(e){_();for(var r=0;r<e.length;r++){var i=e[r];i.id in a?n("Repeated event with id "+i.id):(i.eventStream.schemeIdUri===t&&void 0===a[i.id]&&b(i),a[i.id]=i,n("Add inband event with id "+i.id))}},stop:E,start:function(){_(),n("Start Event Controller"),m||isNaN(c)||(m=!0,u=setInterval(S,c))},setConfig:function(e){e&&(e.manifestModel&&(f=e.manifestModel),e.manifestUpdater&&(h=e.manifestUpdater),e.(y=e.playbackController))},reset:function(){E(),v()}},v(),e}Yt.__dashjs_factory_nameaN,this.representationId=null,this.endFragment=null},Zt=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this));return n.url=r||null,n.checkForExistenceOnly=!0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(y);function Jt(){return{verify:function(e){if(!e)return{verified:!1};var t=ve.a.parseBuffer(e),r=t.fetchAll("moof"),n=t.fetchAll("mdat"),i=t.fetchAll("trun"),o=e.byteLength,a="",s=r.length>0&&r.length===n.length&&i.length>=r.length,u=!0,c=0,l=!0;if(s){for(var d=0,f=r.length;d<f;d++){var p=r[d],h=n[d],y=p._parent,m=y&&y.boxes||null;Array.isArray(m)?m.forEach((function(e){c+=e.size})):c+=p.size+h.size,h.size!==h._raw.byteLength&&(l=!1,a+="The index "+d+" mdat box size error, decoded: "+h.size+", actually: "+h._raw.byteLength+". ")}o!==c&&(u=!1,l&&(a="Size error, decoded: "+c+", actually: "+o))}else a="Missing moof box and mdat box.";return{size:o,moofBoxesCount:r.length,isSizeCorrect:u,areAllBoxesInPairs:s,areAllMdatBoxesSizeCorrect:l,verified:u&&s&&l,msg:a}}}}Jt.__dashjs_factory_name="VerifySegment";var Xt=s.a.getSingletonFactory(Jt),$t="request timeout";function er(e){e=e||{};var t=this.context,r=d(t).getInstance(),n=Xt(t).getInstance()=void 0,u=void 0;function cction(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function t(u,c){c?c.hasOwnProperty("canUseNC")||(c.canUseNC=!0):c={canUseNC:!0};var l=function(t,n){if(!n&&(r.trigger(p.LOADING_COMPLETED,{request:u,response:t||null,error:n||null,sender:a}),u.preloadEnd)){e.mediaPlayerModel.setPreloadData(null);var i=e.abrController.getDefaultQualityFor(u.mediaType,!1);e.abrController.setPlaybackQuality(u.mediaType,e.streamController.getActiveStreamInfo(),i)}};u?(void 0===u.retry&&(u.retry=1),s.load({request:u,progress:function(e){r.trigger(p.LOADING_PROGRESS,{request:u}),e&&r.trigger(p.LOADING_DATA_PROGRESS,{request:u,response:e||null,error:null,sender:a})},success:function(e){try{if(u.completeNCMissingRange){i("CompleteNCMissingRange, "+u.range+" -> "+u.originRange),u.completeNCMissingRange=!1,u.NCInfo.responseData.missingData=[];var a=u.range.split("-"),s=u.originRange.split("-"),d=parseInt(a[0]),f=parseInt(a[1]),h=parseInt(s[0]),y=parseInt(s[1]),m=u.NCInfo.responseData.availableData;m.push({start:d,end:f,data:e}),m.sort((function(e,t){return e.start-t.start}));for(var g=new Uint8Array(y-h+1),v=0;v<m.length;v++)g.set(new Uint8Array(m[v].data),m[v].start-m[0].start);e=g.buffer,u.range=u.originRange}var _=void 0;if(u.range){var E=u.range&&u.range.split("-");_=E[1]-E[0]+1}var b={mediaType:u.mediaType,id:u.representationId,index:u.index,range:u.range,received:e&&e.byteLength||0,url:u.url,startTime:u.startTime,duration:u.duration,p2pLoadInfo:u.p2pLoadInfo,rType:c&&c.canUseNC?"NC":"XHR",retryTimes:u.retryTimes,timeout:u.timeout};e&&e.byteLength>3e7&&(b.code=o.DOWNLOAD_FRAGMENT_ERROR_RANGE,r.trigger(p.FRAGMENT_LOADED_ERROR,b));var S=function(e,t){try{if(e&&t){if(isNaN(e.index)||"MediaSegment"!==e.type)return{verified:!0};var o=n.verify(t);return o.mediaType=e.mediaType,o.quality=e.quality,o.index=e.index,o.id=e.representationId,o&&!o.verified&&(i("VERIFY_SEGMENT_WARNING: "+JSON.stringify(o)),r.trigger(p.VERIFY_SEGMENT_WARNING,o)),o}}catch(e){throw new Error(e)}}(u,e);e&&(e.byteLength===_||!_)&&S&&S.verified?(1===u.retry||(b.code=o.DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS,r.trigger(p.FRAGMENT_LOADED_ERROR,b)),l(e)):(b&&b.hasOwnProperty("type")&&delete b.type,S.verified||(e.byteLength===_?b.verifiedType=1:b.verifiedType=2),u.retry&&u.retry>0?(b.code=o.DOWNLOAD_FRAGMENT_ERROR,r.trigger(p.FRAGMENT_LOADED_ERROR,b),u.retry--,t(u,{canUseNC:!1,disableSeekDownloadMore:!0})):(b.code=o.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE,r.trigger(p.FRAGMENT_LOADED_ERROR,b)))}catch(e){console.error("FragmentLoader Load Error: ",e)}},timeout:function(e,t,n){var i={mediaType:e.mediaType,id:e.representationId,index:e.index,range:e.range,received:e.bytesLoaded,url:e.url,startTime:e.startTime,duration:e.duration,total:e.bytesTotal,latency:t,timeout:n,p2pLoadInfo:e.p2pLoadInfo,rType:c&&c.canUseNC?"NC":"XHR",retryTimes:e.retryTimes};i.code=o.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT,r.trigger(p.FRAGMENT_LOADED_ERROR,i),l(void 0,new w(1,$t))},error:function(e,t,r){l(void 0,new w(1,r,t))},abort:function(e){e&&r.trigger(p.LOADING_ABANDONED,{request:e,mediaType:e.mediaType,sender:a})},connectTimeout:function(e,t,n){if(e){var i={mediaType:e.mediaType,id:e.representationId,index:e.index,range:e.range,received:e.bytesLoaded||0,url:e.url,startTime:e.startTime,duration:e.duration,total:e.bytesTotal,timeout:t,p2pLoadInfo:e.p2pLoadInfo,rType:n?"NC":"XHR",retryTimes:e.retryTimes};i.code=o.CONNECT_FRAGMENT_ERROR_TIMEOUT,n&&(i.code=o.CONNECT_NC_FRAGMENT_ERROR_TIMEOUT),r.trigger(p.FRAGMENT_LOAMENT_LOADING_HEADER_RECEIVED,{request:u,headers:e})},failedQuicklyReport:function(e,t){if(e){var n={
mediaType:e.mediaType,id:e.representationId,index:e.index,range:e.range,received:e.bytesLoaded||0,url:e.url,startTime:e.startTime,duration:e.duration,total:e.bytesTotal,rType:t?"NC":"XHR",retryTimes:e.retryTimes};n.code=o.CONNECT_FRAGMENT_ERROR_OFFLINE,r.trigger(p.FRAGMENT_LOADED_ERROR,n)}},params:c})):l(void 0,new w(2,"request is null"))},abort:function(){s&&s.abort()},reset:function(){s&&(s.abort(),s=null),r.off(p.SEGMENTS_LOADED,c,a)},resetPreloadData:function(){u=e.mediaPlayerModel.getPreloadData(),s.setPreloadData(u)}},u=e.mediaPlayerModel.getPreloadData(),s=Bt(t).create({errHandler:e.errHandler,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.mediaPlayerModel.getLowLatencyEnabled(),dashMetrics:e.dashMetrics,preloadData:u}),r.on(p.SEGMENTS_LOADED,c,a),a}er.__dashjs_factory_name="FragmentLoader";var tr=s.a.getClassFactory(er);tr.FRAGMENT_LOADER_ERROR_LOADING_FAILURE=1,tr.FRAGMENT_LOADER_ERROR_NULL_REQUEST=2,s.a.updateClassFactory(er.__dashjs_factory_name,tr);var rr=tr;function nr(e){e=e||{};var t,r=this.context,i=g(r).getInstance().log,o=d(r).getInstance(),a=e.errHandler,s=e.mediaPlayerModel,u=e.metricsModel,c=e.abrController,l=e.streamController,f=e.videoModel,h=void 0;function_TYPE}function m(){for(var e in h)h[e].reset();h={}}function v(e){if(h[e.request.mediaType]===e.sender){var t=e.request,r=e.response,a=y(t),s=t.mediaInfo.streamInfo;if(e.error&&(e.request.mediaType!==n.AUDIO&&e.request.mediaType!==n.VIDEO&&e.request.mediaType!==n.FRAGMENTED_TEXT||o.trigger(p.SERVICE_LOCATION_BLACKLISTpresentationId=t.representationId,i.endFragment=n,i}(r,t,s.id,e.type!==p.FRAGMENT_LOADING_PROGRESS);o.trigger(a?p.INIT_FRAGMENT_LOADED:p.MEDIA_FRAGMENT_LOADED,{chunk:u,fragmentModel:e.sender})}else i("No "+t.mediaType+" bytes to push or stream is inactive.")}}return t={getModel:function(t){var n=h[t];return n||(n=T(r).create({metricsModel:u,fragmentLoader:rr(r).create({metricsModel:u,videoModel:f,mediaPlayerModel:s,errHandler:a,requestModifier:Et(r).getInstance(),dashMetrics:e.dashMetrics,abrController:c,streamController:l})}),h[t]=n),n},isInitializationRequest:y,reset:function(){o.off(p.FRAGMENT_LOADING_COMPLETED,v,this),m()}},m(),o.on(p.FRAGMENT_LOADING_COMPLETED,v,t),t}nr.__dashjs_factory_name="FragmentController";var ir=s.a.getClassFactory(nr);function or(e){e=e||{};var t=this.context,r=g(t).getInstance().log,i=d(t).getInstance(),o=e.manifestModel,a=e.dashManifestModel,s=e.mediaPlayerModel,u=e.manifestUpdater,c=e.adapter,l=e.capabilities,f=e.errHandler,h=e.timelineConverter,y=e.metricsModel,m=e.abrController,v=e.playbackController,_=e.mediaController,E=e.videoModel,b=e.streamController,S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,O=void 0,I=void 0,C=void 0,N=void 0;function k(){for(var e=T?T.length:0,t=0;t<e;t++)T[t].getFragmentModel().removeExecutedRequestsBeforeTime(F()+M()),T[t].resetRACK_CHANGED,H,S)}function L(){k(),R=null,P={},D=!1}function x(){v&&v.pause(),I&&(I.reset(),I=null),C&&(C.reset(),C=null),L(),r=null,i.off(p.DATA_UPDATE_COMPLETED,Q,S),i.off(p.BUFFERING_COMPLETED,Y,S),i.off(p.KEY_ERROR,B,S),i.off(p.SERVER_CERTIFICATE_UPDATED,B,S),i.off(p.LICENSE_REQUEST_COMPLETE,B,S),i.off(p.KEY_SYSTEM_SELECTED,B,S),i.off(p.KEY_SESSION_CREATED,B,S),i.off(p.KEY_STATUS R?R.duration:NaN}function F(){return R?R.start:NaN}function U(){if(!(m&&m.hasOwnProperty("getBitrateList")&&c&&c.hasOwnProperty("getAllMediaInfoForType")&&c.hasOwnProperty("getEventsFtion j(e){return e.type===n.TEXT?e.mimeType:e.type}function V(e){var t,i=e.type,a=void 0;if(i===n.MUXED&&e)return r(a="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines"),f.manifestError(a,"multiplexedrep",o.getValue()),!1;if(i===n.TEXT||i===n.FRAGMENTED_TEXT||i===n.EMBEDDED_TEXT||i===n.IMAGE)return!0;if(t=e.codec,r(i+" codec: "+t),e.contentProtection&&!l.supportsEncryptedMedia())f.capabilityError("encryptedmedia");else if(!l.supportsCodec(t))return r(a=i+"Codec ("+t+") is not supported."),!1;return!0}function H(e){if(e.newMediaInfo.streamInfo.id===R.id){var t=z(e.oldMediaInfo);if(t){var i=v.getTime();r("Stream -  Process track changed at current time "+i);var a=e.newMediaInfo,s=o.getValue();r("Stream -  Update stream controller"),s.refreshManifestOnSwitchTrack?(r("Stream -  Refreshing manifest for switch track"),N=e,u.refreshManifest()):(t.updateMediaInfo(a),a.type!==n.FRAGMENTED_TEXT&&(m.updateTopQualityIndex(a),t.switchTrackAsked(),t.getFragmentModel().abortRequests()))}}}function G(i,u){var l=c.getAllMediaInfoForType(R,i),d=null;if(l&&0!==l.length){for(var p=0,g=l.length;p<g;p++)if(d=l[p],i===n.EMBEDDED_TEXT);else{if(!V(d))continue;_.addTrack(d)}i!==n.EMBEDDED_TEXT&&0!==_.getTracksFor(i,R).length&&(_.checkInitialMediaSettingsForType(i,R),function(r,i,u,l){var d=Kt(t).create({type:j(r),mimeType:r.mimeType,timelineConverter:h,adapter:c,manifestModel:o,dashManifestModel:a,mediaPlayerModel:s,metricsModel:y,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,stream:S,abrController:m,domStorage:e.domStorage,playbackController:v,mediaController:_,streamController:b,videoModel:E,errHandler:f});if(d.initialize(u),m.updateTopQualityIndex(r),T.push(d),r.type===n.TEXT||r.type===n.FRAGMENTED_TEXT){for(var p=void 0,g=0;g<i.length;g++)i[g].index===r.index&&(p=g),d.updateMediaInfo(i[g]);r.type===n.FRAGMENTED_TEXT&&d.updateMediaInfo(i[p])}else d.updateMediaInfo(r)}(_.getCurrentTrackFor(i,R),l,u))}else r("No "+i+" data.")}function q(e){var t=a.getAdaptationForType(o.getValue(),R.index,e,R);if(!t||!Array.isArray(t.Representation_asArray))return null;t.Representation_asArray=t.Representation_asArray.filter((function(e,n){if(0===n)return!0;var i=a.getCodec(t,n,!0);return!!l.supportsCodec(i)||(r("[Stream] codec not supported: "+i),!1)}))}function W(){for(var e=T.length,t=P.audio||P.video?new Error(1,"Data update failed",null):null,r=0;r<e;r++)if(T[r].isUpdating()||D)return;if(A){if(O)for(var o=0;o<e&&T[o];o++)T[o].getType()!==n.AUDIO&&T[o].getType()!==n.VIDEO&&T[o].getType()!==n.FRAGMENTED_TEXT||O.initializeForMedia(T[o].getMediaInfo());i.t{for(var e=0,t=T.length;e<t;e++)T[e].createBuffer()}function Y(e){if(e.streamInfo===R){var t=Z(),o=t.length;if(0!==o){for(var a=0;a<o;a++)if(!t[a].isBufferingCompleted()&&(t[a].getType()===n.AUDIO||t[a].getType()===n.VIDEO))return void r("[Stream] onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because streamProcessor "+t[a].getType()+" is not buffering completed");r("[Stream] onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),i.trigger(p.STREAM_BUFFERING_COMPLETED,{streamInfo:R})}else r("[Stream] onBufferingCompleted - can't trigger STREAM_BUFFERINt.getStreamInfo()===R&&(P[t.getType(Z().filter((function(t){return t.getType()===e.type}))[0]}function Z(){for(var e=T.length,t=[],r=void 0,i=void 0,o=0;o<e;o++)(r=(i=T[o]).getType())!==n.AUDIO&&r!==n.VIDEO&&r!==n.FRAGMENTED_TEXT||t.push(i);return t}return S={initialize:function(e,t){R=e,(O=t)&&(i.on(p.KEY_ERROR,B,S),i.on(p.SERVER_CERTIFICATE_UPDATED,B,S),i.on(p.LICENSE_REQUEST_COMPLETE,B,S),i.on(p.KEY_SYSTEM_SELECTED,B,S),i.on(p.KEY_SESSION_CREATED,B,S),i.on(p.KEY_STATUSES_CHANGED,B,S))},activate:function(e){w||(i.on(p.CURRENT_TRACK_CHANGED,H,S),function(e){U();var i=void 0,a=E.getElement();if(C||((C=Qt(t).create()).setConfig({manifestModel:o,manifestUpdater:u,playbackController:v}),i=c.getEventsFor(R),C.addInlineEvents(i)),
D=!0,q(n.VIDEO),q(n.AUDIO),(null===a||a&&("VIDEO"===a.nodeName||"BWP-VIDEO"===a.nodeName))&&G(n.VIDEO,e),G(n.AUDIO,e),"open"!==e.readyState?(e.addEventListener("sourceopen",K,!1),e.addEventListener("webkitsourceopen",K,!1)):K(),A=!0,D=!1,0===T.length){var s="No streams to play.";f.manifestError(s,"nostreams",o.getValue()),r(s)}else W()}(e),w=M,getStartTime:F,getId:function(){return R?R.id:NaN},getStreamInfo:function(){return R},getFragmentController:function(){return I},getEventController:function(){return C},getBitrateListFor:function(e){U();var t=function(e){for(var t=T.length,r=null,n=0;n<t;n++)if((r=T[n]).getType()===e)return r.getMediaInfo();return null}(e);return m.getBitrateList(t)},startEventController:function(){C&&C.start()},stopEventController:function(){C&&C.stop()},updateData:function(e){if(r("Manifest updated... updating data system wide."),w=!1,D=!0,R=e,C){var t=c.getEventsFor(R);C.addInlineEvents(t)}q(n.VIDEO),q(n.AUDIO);for(var i=0,o=T.length;i<o;i++){var a=T[i],s=c.getMediaInfoForType(R,a.getType());m.updateTopQualityIndex(s),a.updateMediaInfo(s)}if(N&&"fragmentedText"!==N.newMediaInfo.type){var u=z(N.oldMediaInfo);if(!u)return;u.switchTrackAsked(),N=void 0}D=!1,W()},reset:x,getProcessors:Z,setMediaSource:function(e){for(var t=0;t<T.length;)V(T[t].getMediaInfo())?(T[t].setMediaSource(e),t++):(T[t].reset(),T.splice(t,1));for(var n=0;n<T.length;n++)T[n].dischargePreBuffer();if(0===T.length){var i="No streams to play.";f.manifestError(i,"nostreams",o.getValue()),r(i)}}},L(),I=ir(t).create({mediaPlayerModel:s,videoModel:E,metricsModel:y,errHandler:f,dashMetrics:e.dashMetrics,abrController:m,streamController:b}),i.on(p.BUFFERING_COMPLETED,Y,S),i.on(p.DATA_UPDATE_COMPLETED,Q,S),S}or.__dashjs_factory_name="Stream";var ar=s.a.getClassFactory(or);function sr(){var e=this.context,t=g(e).getInstance().log,r=d(e).getInstance(),n=void 0,i=void 0,o=void 0,a)}function y(){null!==i&&(clearInterval(i),i=null)}function m(e){y(),isNaN(e)&&!isNaN(n)&&(e=1e3*n),isNaN(e)||(t("Refresh lue(),t=e.url,r=c.getLocation(e);r&&(t=r),s.load(t)}function _(e){if(l.getAppendingSourceState()){var i=l.getCachedDurationOffset("offset");e.mediaPresentationDuration+=i,e.Period.duration+=i,e.Period_asArray.duration+=i}u.setValue(e);var a=new Date,s=(a.getTime()-e.loadedTime.getTime())/1e3;1e3*(n=c.getManifestUpdatePeriod(e,s))>2147483647&&(n=2147483.647),r.trigger(p.MANIFEST_UPDATED,{manifest:e}),t("Manifest has been refreshed at "+a+"["+a.getTime()/1e3+"] "),o||m()}function E(){o&&!l.getScheduleWhilePaused()||(a?m(l.getManifestUpdateRetryInterval()):v())}function b(e){e.error?f.manifestError(e.error.message,e.error.code,"","",e.error.errorCode,e){o=!1,m()}function T(){o=!0,y()}function w(){a=!1}return{initialize:function(){h(),r.on(p.STREAMS_COMPOSED,w,this),r.on(p.PLAYBACK_STARTED,S,this),r.on(p.PLAYBACK_PAUSED,T,this),r.on(p.INTERNAL_MANIFEST_LOADED,b,this)},setMas=e.manifestLoader),e.errHandler&&(f=e.errHandler))},reset:function(){r.off(p.PLAYBACK_STARTED,S,this),r.off(p.PLAYBACK_PAUSED,T,this),r.off(p.STREAMS_COMPOSED,w,this),r.off(p.INTERNAL_MANIFEST_LOADED,b,this),h()}}}sr.__dashjs_factory_name="ManifestUpdater";var ur=s.a.getClassFactory(sr);function cr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var lr=1e3;function dr(){var e,t,r,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,d=void 0,f=void 0,p=void 0,h=void 0,y=void 0,m=void 0,g=void 0,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,O=void 0,I=void 0,C=void 0,N=void 0,k=void 0,L=void 0,x=void 0,M=void 0,U=void 0,B=void 0,j=void 0,V=void 0,H=void 0,G=void 0,q=void 0,W=void 0,K=void 0,Y=void 0,QO.length;t++)if(O[t].rulename===e)return t;return-1}function te(e){V=e}return e={setABRStrategy:function(e){A=e},getABRStrategy:function(){return A},setUseDefaultABRRules:function(e){R=e},getUseDefaultABRRules:function(){return R},getABRCustomRules:function(){return O},addABRCustomRule:function(e,t,r){var n=ee(t);-1===n?O.push({type:e,rulename:t,rulmRule:function(e){var t=ee(e);-1!==t&&O.splice(t,1)},removeAllABRCustomRule:function(){O=[]},setBandwidthSafetyFactor:function(e){E=e},getBandwidthSafetyFactor:function(){return E},setAbandonLoadTimeout:function(e){b=e},getAbandonLoadTimeout:function(){return b},setLastBitrateCachingInfo:function(e,t){p.enabled=e,void 0===t||isNaN(t)||"number"!=typeof t||(p.ttl=t)},getLastBitrateCachingInfo:function(){return p},setLastMediaSettingsCachingInfo:function(e,t){h.enabled=e,void 0===t||isNaN(t)||"number"!=typeof t||(h.ttl=t)},getLastMediaSettingsCachingInfo:function(){return h},setStableBufferTime:function(e){y=e},getStableBufferTime:function(){return isNaN(y)?D?20:12:y},setBufferTimeAtTopQuality:function(e){m=e},getBufferTimeAtTopQuality:function(){return m},setBufferTimeAtTopQualityLongForm:function(e){g=e},getBufferTimeAtTopQualityLongForm:function(){return g},setLongFormContentDurationThreshold:function(e){v=e},getLongFormContentDurationThreshold:function(){return v},setSegmentOverlapToleranceTime:function(e){_=e},getSegmentOverlapToleranceTime:function(){return _},getCacheLoadThresholdForType:function(e){return C[e]},setCacheLoadThresholdForType:function(e,t){C[e]=t},setBufferToKeep:function(e){l=e},getBufferToKeep:function(){return l},setBufferAheadToKeep:function(e){d=e},getBufferAheadToKeep:function(){return d},setBufferPruningInterval:function(e){f=e},getBufferPruningInterval:function(){return f},setFragmentRetryAttempts:function(e){S[F.MEDIA_SEGMENT_TYPE]=e},getFragmentRetryAttempts:function(){return S[F.MEDIA_SEGMENT_TYPE]},setManifestRetryAttempts:function(e){S[F.MPD_TYPE]=e},getManifestRetryAttempts:function(){return S[F.MPD_TYPE]},setRetryAttemptsForType:function(e,t){S[e]=t},getRetryAttemptsForType:function(e){return S[e]},setFragmentRetryInterval:function(e){T[F.MEDIA_SEGMENT_TYPE]=e},getFragmentRetryInterval:function(){retuetManifestRetryInterval:fnifestRetryInterval:function(){return T[F.MPD_TYPE]},setRetryIntervalForType:function(e,t){T[e]=t},getRetryIntervalForType:function(e){return T[e]},setWallclockTimeUpdateInterval:function(e){w=e},getWallclockTimeUpdateInterval:function(){return w},setScheduleWhilePaused:function(e){c=e},getScheduleWhilePaused:function(){return c},getUseSuggestedPresentationDelay:function(){return o},setUseSuggestedPresentationDelay:function(e){o=e},setLiveDelayFragmentCount:function(e){s=e},getLiveDelayFragmentCount:function(){return s},getLiveDelay:function(){return L?u||3:u},setLiveDelay:function(e){u=e},setUseManifestDateHeaderTimeSource:function(e){i=e},getUseManifestDateHeaderTimeSource:function(){return i},setUTCTimingSources:function(e){a=e},getUTCTimingSourc]=!!r:Object.keys(P).forEach(unction(e){var t=P[e];return void 0===t?P.default:t},setFastSwitchEnabled:function(e){D=e},getFastSwitchEnabled:function(){return D},setMovingAverageMethod:function(e){I=e},getMovingAverageMethod:function(){return I},setJumpGaps:function(e){N=e},getJumpGaps:function(){return N},setSmallGapLimit:function(e){k=e},getSmallGapLimit:function(){return k},getLowLatencyEnabled:function(){return L},setLowLatencyEnabled:function(e){L=e},getPreloadData:function(){return x},setPreloadData:function(e){x=e},setManifestUpdateRetryInterval:function(e){M=e},getManifestUpdateRetryIM},setAppendingSourceState:function(e){e!==U&&(U=e)},
getAppendingSourceState:function(){return U},setCachedDurationOffset:function(e,t){t=parsgetCachedDurationOffset:fuedDruationOffset:function(){B={offset:0,duration:0}},setEndOfStreamState:function(e){j=e},getEndOfStreamState:function(){return j},setP2pPermission:te,getP2pPermission:function(){return V},addP2pSDKErrorCount:function(){(H+=1)>12&&te(!1)},getP2pction(){return H},addBufferingCount:function(){G+=1},getBufferingCount:function(){return G},setExternalMediaLoader:function(e){J=e},getExternalMedturn J},getFactorByBufferLevel:function(e){return.7},setLastStartSeekTime:function(e){q=e},getLastStartSeekTime:function(){return q},getStartPlaybackTime:function(){return W},setStaron(e){W=e},resetStartAndSeekTime:function(){q=0,W=0},reset:function(){},getAudioTrackId:function(){return K},setAudioTrackId:function(e){K=e},getEnableMultipleAudioTracks:function(){return Y},setEnableMultipleAudioTracks:function(e){Y=e},geudioTrackIds:function(e){e&&Array.isArray(e)&&(Q=e)},setDeviationReset:function(e){z=e},getDeviationReset:function(e){return z},setRetryTimes:function(e){Z=e},getRetryTimes:function(){return Z},getUseNC:function(){return X},setUseNC:function(e){X=e},getUseP2P:function(){return $},setUseP2P:function(e){$=e}},a=[],o=!1,i=!0,c=!0,A=n.ABR_STRATEGY_DYNAMIC,R=!0,D=!1,p={enabled:!0,ttl:36e4},h={enabled:!0,ttl:36e4},s=4,u=void 0,l=20,d=80,f=10,y=NaN,m=30,g=60,v=600,_=.2,E=.6,b=1e4,w=50,N=!1,k=1.8,M=100,P={default:!1},O=[],I=n.MOVING_AVERAGE_SLIDING_WINDOW,L=!1,U=!1,z=!1,B={time:0,duration:0,offset:0},cr(t={},F.MPD_TYPE,3),cr(t,F.XLINK_EXPANSION_TYPE,1),cr(t,F.MEDIA_SEGMENT_TYPE,3),cr(t,F.INIT_SEGMENT_TYPE,3),cr(t,F.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),cr(t,F.INDEX_SEGMENT_TYPE,3),cr(t,F.OTHER_TYPE,3),S=t,cr(r={},F.MPD_TYPE,500),cr(r,F.XLINK_EXPANSION_TYPE,500),cr(r,F.MEDIA_SEGMENT_TYPE,lr),cr(r,F.INIT_SEGMENT_TYPE,lr),cr(r,F.BITSTREAM_SWITCHING_SEGMENT_TYPE,lr),cr(r,F.INDEX_SEGMENT_TYPE,lr),cr(r,F.OTHER_TYPE,lr),T=r,(C={})[n.VIDEO]=25,C[n.AUDIO]=5,j=!0,V=!0,H=0,G=0,q=0,W=0,J=null,K=1,Y=!1,Q=[],Z=0,X=!0,$=!0,e}dr.__dashjs_factory_name="MediaPlayerModel";var fr=s.a.getSingletonFactory(dr);fr.DEFAULT_UTC_TIMING_SOURCE={scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"http://time.akamai.com/?iso"},s.a.updateSingletonFactory(dr.__dashjs_factory_name,fr);var pr=fr,hr=new(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this));return r.AST_IN_FUTURE="astInFuture",r.BUFFER_EMPTY="bufferStalled",r.BUFFER_LOADED="bufferLoaded",r.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",r.ERROR="error",r.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",r.FRAGMENT_LOADING_HEADER_RECEIVED="fragmentLoadingHeaderReceived",r.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",r.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",r.FRAGMENT_P2P_LOAD_INFO="fragmentP2pLoadInfo",r.CDN_LOAD_INFO="cdnLoadInfo",r.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",r.FRAGMENT_LOADED_ERROR="fragmentLoadedError",r.PCDN_LOADED_ERROR="pcdnLoadedError",r.LOG="log",r.MANIFEST_LOADED="manifestLoaded",r.METRICS_CHANGED="metricsChanged",r.METRIC_CHANGED="metricChanged",r.METRIC_ADDED="metricAdded",r.METRIC_UPDATED="metricUpdated",r.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",r.PERIOD_SWITCH_STARTED="periodSwitchStarted",r.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",r.QUALITY_CHANGE_DOWNLOADED="qualityChangeDownloaded",r.QUALITY_CHANGE_RENDERED="qualityChangeRendered",r.TRACK_CHANGE_RENDERED="trackChangeRendered",r.SOURCE_INITIALIZED="sourceInitialized",r.STREAM_INITIALIZED="streamInitialized",r.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",r.TEXT_TRACKS_ADDED="allTextTracksAdded",r.TEXT_TRACK_ADDED="textTrackAdded",r.TTML_PARSED="ttmlParsed",r.TTML_TO_PARSE="ttmlToParse",r.CAN_PLAY="canPlay",r.PLAYBACK_ENDED="playbackEnded",r.PLAYBACK_ERROR="playbackError",r.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",r.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",r.PLAYBACK_PAUSED="playbackPaused",r.PLAYBACK_PLAYING="playbackPlaying",r.PLAYBACK_PROGRESS="playbackProgress",r.PLAYBACK_RATE_CHANGED="playbackRateChanged",r.PLAYBACK_SEEKED="playbackSeeked",r.PLAYBACK_SEEKING="playbackSeeking",r.PLAYBACK_SEEK_ASKED="playbackSeekAsked",r.PLAYBACK_STALLED="playbackStalled",r.PLAYBACK_STARTED="playbackStarted",r.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",r.PLAYBACK_WAITING="playbackWaiting",r.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",r.DELAY_TO_APPEND_TO_BUFFER="delayToAppendBuffer",r.GET_NEXT_FRAGMENT="getNextFragment",r.APPENDING_NEXT_SOURCE="appendingNextSource",r.APPENDED_NEXT_SOURCE="appendedNextSource",r.APPENDED_NEXT_SOURCE_DURATION_CHANGED="appendedNextSourceDurationChanged",r.START_OFFSET_TIME_WARNING="startOffsetTimeWarning",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(f.a));function yr(){var e=this.context,t=g(e).getInstance().log,r=d(e).getInstance(),i=rt(e).getInstance(),o=void 0,a=void 0,s=void 0,uvoid 0,f=void 0;function h(e){a=e}function y(e){o=e}function m(e){var t=Date.parse(e);return isNaN(t)&&(t=function(e){var t=void 0,r=void 0,n=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e);return t=Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[4],10),parseInt(n[5],10),n[6]&&(parseInt(n[6],10)||0),n[7]&&1e3*parseFloat(n[7])||0),n[9]&&n[10]&&(r=60*parseInt(n[9],10)+parseInt(n[10],10),t+=("+"===n[8]?-1:1)*r*60*1e3),new Date(t)()}function b(e,t,r){var n=m(e);isNaN(n)?r():t(n)}function S(e,t,r,n,o){var a,s,u=!1,c=new XMLHttpRequestioer("Date"):c.response,n=e(t),isNaN(n)||(r(n),u=!0))},i.isRelative(t)){var p=f.resolve();p&&(t=i.resolve(t,p.url))}c.open(nloadend=a,c.send()}function T(e,t,r){S(_,e,t,r,!0)}function A(e,t,n){h(!1),r.trigger(p.TIME_SYNCHRONIZATION_COMPLETED,{time:t,offset:n,error:e?new w(1):null})}function R(e,r){var i=r||0,a=e[i],d=function(e,t){var r,i,a,u=!e||!t;u&&s?(r=c.getReadOnlyMetricsFor(n.STREAM),a=null!==(i=l.getLatestMPDRequestHeaderValueByID(r,"Date"))?new Date(i).getTime():Number.NaN,isNaN(a)?A(!0):(y(a-(new Date).getTime()),A(!1,a/1e3,o))):A(u,e,t)};h(!0),a?u.has  Difference (ms): "+n),d(e,n)}),(function(){R(e,i+1)})):R(e,i+1):(y(0),d())}return{initialize:function(e,t){s=t,o=0,a=!1,u={"urn:mpeg:dash:utc:http-head:2014":T,"urn:mpeg:dash:utc:http-xsdate:2014":S.bind(null,m),"urn:mpeg:dash:utc:http-iso:2014":S.bind(null,v),"urn:mpeg:dash:utc:direct:2014":b,"urn:mpeg:dash:utc:http-head:2012":T,"urn:mpeg:dash:utc:http-xsdate:2012":S.bind(null,m),"urn:mpeg:dash:utc:http-iso:2012":S.bind(null,v),"urn:mpeg:dash:utc:direct:2012":b,"urn:mpeg:dash:utc:http-ntp:2014":E,"urn:mpeg:dash:utc:ntp:2014":E,"urn:mpeg:dash:utc:sntp:2014":E},a||R(e)},gerics),r&&(f=e.baseURLController))},reset:function(){h(!1)}}}yr.__dashjs_factory_name="TimeSyncController";var mr=s.a.getSingletonFactory(yr)
;mr.TIME_SYNC_FAILED_ERROR_CODE=1,mr.HTTP_TIMEOUT_MS=5e3,s.a.updateSingletonFactory(yr.__d(){return{areEqual:function(e,t){return _r()(e,t)}}}Er.__dashjs_factory_name="ObjecaseUrls:t||null,selectedIdx:r||Sr},this.children=[]};function wr(){var e,t=unction(t){return a(e,t)}))}function s(){t=new Tr}return e={reset:s,update:function(e){!function(e){var n=r.getBaseURLsFromElement(e);i.areEqual(n,t.data.baseUrls)||(t.data.baseUrls=n,t.data.selecte,r){o(t.children[n),n.filter((function(e){reselectedIdion(e){e.dashManifestModel&&(r=e.dashManifestModel)}},s(),e}wr.__dashjs_factory_name="BaseURLTreeModel";var Ar=s.a.getClassFactory(wr);function Rr(e){return e=e||{},{select:function(e){return e&&functionr=e.dvb_pr&e.dvb_priority&&r[0].dvb_priority===e.dv&&(o.forEach((function(e){t+=e.dvb_weight,r.pm()*(t-1)),r.every((function(e,t){return n=t,!(i<e)}))),th||!e.dvb_priority||-1===t.indexOf(e.dvb_priority)}))));var t}}}Rr.__dashjs_factory_name="DVBSelector";var Pr=s.a.getClassFactory(Rr);function Dr(e){return e=e||{},{soid 0;return e&&e.some((function(e,r){return t=r,!0}))&&(r=e[t]),r}}}Dr.__dashjs_factory_name="BasicSelector";var Or=s.a.getClassFactory(Dr),Ir="Failed to resolve a valid URL";function Cr(){var e,t=this.context,r=d(t).getInstance(),n=void 0,i=void 0,o=void 0,a=void 0;return e={chooseSelectorFromManifest:function(e){!function(){if(!n||!n.hasOwnProperty("getIsDVB"))throw new Error("Missing config parameter(s)")}(),a=n.getIsDVB(e)?o:i},select:function(e){var t=e.baseUrls,n=e.selectedIdx;if(!isNaN(n))return t[n];var i=a.select(t);if(i)return e.selectedIdx=t.indexOf(i),i;r.trigger(p.URL_RESOLUTION_FAILED,{eector),e.dashManifestModel&&(n=e.dashManifestModel)}},i=Or(t).create({}),o=Pr(t).create({}),a=i,e}Cr.__dashjs_factory_name="BaseURLSelector";var Nr=s.a.getClassFactory(Cr);Nr.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=1,Nr.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE=Ir,s.a.updateClbilityTimeOffset=0,this.availabilityTimeComplete=!0};Lr.DEFAULT_DVB_PRIORITY=1,Lr.DEFAULT_DVB_WEIGHT=1;var xr=Lr;function Mr(){var e,t=void 0,r=this.context,n=d(r).getInstance(),i=rt(r).getInstance(),o=void 0,a=void 0;return e={reset:function(){o.reset(),a.reset()},initialize:function(e){var r;o.setConfig({dashManifestModel:t}),a.setConfig({dashManifestModel:t}),r=e,):new xr})ector),e.dashManifestModel&&(t=e.dashManifestModel)}},o=Ar(r).create(),a=kr(r)D,(function(e){o.invalidateSelectedIndexes(e.entry)}),e),e}Mr.__dashjs_factory_name="BaseURLController";var Fr=s.a.getSingletonFactory(Mr);function Ur(){return{createMediaSource:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e&&window.BwpElement&&e instanceof window.BwpElement&&window.BwpMediaSource)return new BwpMediaSource;var t="WebKitMediaSource"in window;return"MediaSource"in window?new MediaSource:t?new WebKitMediaSource:null},attachMediaSource:function(e,t){var r;return r=window.BwpMediaSource&&e instanceof window.BwpMediaSource&&e.createObjectURL?e.createObjectURL():window.URL.cr,r},detachMediaSource:function(e){e.setSource(null)},setDuration:function e(t,r){return t.duration!=r&&function(e,t){var r=void 0,n=function(){for(var t=!1,r=0;r<e.length;r++)e[r].updating&&(t=!0);return t};if(e.length&&n()){var i=function(){n()||(clearInterval(r),t())},o=function e(){this.removeEventListener("updateend",e,!1),this.removeEventListener("abort",e,!1),this.removeEventListener("error",e,!1),n()||t()};if("function"==typeof e[0].addEventListener)try{for(var a=0;a<e.length;a++)e[a].updating&&(e[a].addEventListener("updateend",o,!1),e[a].addEventListener("abort",o,!1),e[a].addEventListener("error",o,!1))}catch(e){r=setInterval(i,50)}else r=setInterval(i,50)}else t()}(t.sourceBuffers,(function(){if("openvar n=setTimeout((function(){clearTimeout(n),e(t,r)}),50)})),t.duration},setSeekable:function(e,t,r){e&&"function"==typeof e.setLiveSeekableRange&&"function"==typeof e.clearLiveSeekableRange&&"open"===e.readyState&&t>=0&&t<r&&(e.clearLiveSeekableRange(),e.setLiveSeekableRange(t,r))},signalEndOfStream:function(e){var t=e.sourceBuffers,r=t.length;if("open"===e.readyState){for(var n=0;n<r;n++){if(t[n].updating)return;if(0===t[n].buffered.length)return}e.endOfStream()}}}}Ur.__dashjs_factory_name="MediaSourceController";var Br=s.a.getSingletonFactory(Ur);function jr(){var e=this.context,t=g(e).getInstance().log,r=d(e).getInstance(),a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,y=void 0,m=void 0,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,O=void 0,I=void 0,C=void 0,N=void 0,k=void 0,L=void 0,x=void 0,M=void 0,F=void 0,U=void 0,B=void 0,j=void 0,V=void 0,H=void 0,G=void 0,q=void 0,W=void 0,K=void 0,Y=void 0,Q=void 0,z=void 0,Z=void 0;function J(){if(he()){var e=F.getPlaybackQuality();if(e&&y.addDroppedFrames(n.VIDEO,e),!B.getJumpGaps()||!O||0===O.getProcessors().length||U.isSeeking()||j||k||L||x)return;!function(){var e=U.getTime(),n=F.getEnded(),i=F.getVideoBufferRanges(),o=!1,a=void 0;if(!(i.length<=0||n)&&1!==i.length){for(var s=0;s<i.length;s++)if(e>=i[s].start&&e<=i[s].end){a=s,o=!0;break}if(o){var u=i.slice(a);if(u[0].end-e<.5){if(1===u.length)return;for(var c=1;c<u.length;c++)if(u[c].end-u[c].start>=1)return t("Gap has been prdiected,seek from ",e," to ",u[c].start),U.seek(u[c].start),void r.trigger(p.PREDICT_SEEK,{currentTime:e,bufferRanges:i,destination:u[c].start});U.seek(u[u.length-1].start)}}}}()}}function X(){if(!(!B.getJumpGaps()||!O||0===O.getProcessors().length||U.isSeeking()||j||k||L||x)&&++Y>=2){var e=U.getTime();Z===e?function(e){for(var n=O.getProcessors(),i=B.getSmallGapLimit(),o=void 0,a=0;a<n.length;a++){
var s=n[a].getBuffer(),u=s&&s.getAllBufferRanges&&s.getAllBufferRanges(),c=void 0;if(u&&!(u.length<=1)){for(var l=0;l<u.length;l++)if(e<u.start(l)){c=u.start(l);break}if(c>0){var d=c-e;d>0&&d<=i&&(void 0===o||c>o)&&(o=c)}}}var f=U.getTimeToStreamEnd();if(void 0===o&&!isNaN(f)&&f<i&&(o=e+f),o>0)if(!isNaN(f)&&o>=e+f){t("Jumping media gap (discontinuity) at time ",e,". Jumping to end of the stream");var h=F.getVideoBufferRanges();if(h&&h.length){var y=h[h.length-1].end;!y||Q||F.getEnded()||(Q=!0,U.seek(y+1),r.trigger(p.JUMP_MEDIA_GAP,{time:e,seekToPosition:y+1,toEnd:!0}),t("Stuck in ending. Jumping to end of the stream."))}}else r.trigger(p.JUMP_MEDIA_GAP,{time:e,seekToPosition:o,toEnd:!1}),t("Jumping media gap (discontinuity) at time ",e,". Jumping to time position",o),U.seek(o)}(e):Z=e,Y=0}}function $(e){var t=oe(e.seekTime);K&&(re(),W=!1),t&&t!==O?(me(qe.END_OF_PERIOD_STOP_REASON),se(O,t,e.seekTime)):me(qe.USER_REQUEST_STOP_REASON),ge(Ge.SEEK_START_REASON)}function ee(){t("[StreamController][onPlaybackStarted]"),V?(V=!1,ge(Ge.INITIAL_PLAYOUT_START_REASON)):j&&(j=!1,ge(Ge.RESUME_FROM_PAUSE_START_REASON),ne())}function te(e){t("[StreamController][onPlaybackPaused]"),e.ended||(j=!0,me(qe.USER_REQUEST_STOP_REASON),ne())}function re(){t("[StreamController][toggleEndPeriodTimer] stop end period timer."),clearTimeout(K),K=void 0}function ne(){if(W)if(K)re();else{var e=U.getTimeToStreamEnd(),n=e>0?1e3*e:0;t("[StreamController][toggleEndPeriodTimer] start-up of timer to notify PLAYBACK_ENDED event. It will be triggered in "+n+" milliseconds"),K=setTimeout((function(){r.trigger(p.PLAYBACK_ENDED)}),n)}}function ie(){var e=_e().isLast,r=B.getEndOfStreamState();M&&e?(t("[StreamController][onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),r&&v.signalEndOfStream(M)):M&&void 0===K&&(t("[StreamController][onStreamBufferingCompleted] end of period detected"),W=!0,!1===j&&ne())}function oe(e){var t=0,r=null,n=D.length;n>0&&(t+=D[0].getStartTime());for(var i=0;i<n;i++)if(r=D[i],e<(t=parseFloat((t+r.getDuration()).toFixed(5))))return r;return null}function ae(e){var r=function(){if(O){var e=O.getStreamInfo()etStreamInfo().start===parseFloat((e+t).toFixed(5))}))[0]}}();r?(q=void 0,G=void 0,se(O,r,NaN)):t("StreamController no next stream found"),me(r?qe.END_OF_PERIOD_STOP_REASON:qe.END_OF_CONTENT_STOP_REASON),K=void 0,W=!1;try{if(B.getEndOfStreamState()){var n=Re("video"),i=Re("audio");isNaN(n)&&isNaN(i)||(U.seek(U.getTime()-.3),v.signalEndOfStream(M))}}catch(e){console.error("Hack PLAYBACK_END trigger native ended event error",e)}}function se(e,t,n){!k&&t&&e!==t&&(k=!0,r.trigger(p.PERIOD_SWITCH_STARTED,{fromStreamInfo:e?e.getStreamInfo():null,toStreamInfo:t.getStreamInfo()}),e&&(e.stopEventController(),e.deactivate()),O=t,U.initialize(O.getStreamInfo()),F.getElement()?ue(n,e,!1):function(e){ce(e)}(n))}function ue(e,n,i){var o=void 0;function a(){M&&(t("MediaSource is open!"),window.URL.revokeObjectURL(o),M.removeEventListener("sourceopen",a),M.removeEventListener("webkitsourceopen",a),le(),n||r.trigger(p.SOURCE_INITIALIZED),i&&O.setMediaSource(M))}M?v.detachMediaSource(F):M=v.createMediaSource(F.getElement()),ce(e),M.addEventListener("sourceopen",a,!1),M.addEventListener("webkitsourceopen",a,!1),o=v.attachMediaSource(M,F),t("MediaSource attached to element.  Waiting on open...")}function ce(e){if(O.activate(M),q=ye(n.AUDIO),G=ye(n.VIDEO),!V)if(isNaN(e)){var ts().forEach((function(e){h.setIndexHandlerTime(e,t)}))}else U.seek(e);O.startEventController(),!N&&V||U.play(),k=!1,r.trigger(p.PERIOD_SWITCH_COMPLETED,{toStreamInfo:O.getStreamInfo()})}function le(e){var r=e||O.getStreamInfo().manifestInfo.duration,n=v.se;t++)if(D[t].getId()===e.id)return D[t];return null}function fe(){var t=l.getValue();I&&(r.trigger(p.PROTECTION_CREATED,{controller:I,manifest:t}),I.setMediaElement(F.getElement()),C&&I.setProtectionData(C)),function(){try{var t=h.getStreamsInfo();if(0===t.length)throw new Error("There are no streams");var i=m.getCurrentManifestUpdate(y.getMetricsFor(n.STREAM));y.updateManifestUpdateInfo(i,{currentTime:U.getTime(),buffered:F.getBufferRange(),presentationStartTime:t[0].start,clientTimeOffset:P.getClientTimeOffset()});for(var o=0,c=t.length;o<c;o++){var d=t[o],g=de(d);g?g.updateData(d):(g=ar(e).create({manifestModel:l,dashManifestModel:f,mediaPlayerModel:B,metricsModel:y,dashMetrics:m,manifestUpdater:u,adapter:h,timelineConverter:P,capabilities:s,errHandler:R,baseURLController:E,domStorage:b,abrController:S,playbackController:U,mediaController:T,videoModel:F,streamController:a}),D.push(g),g.initialize(d,I)),y.addManifestUpdateStreamInfo(i,d.id,d.index,d.start,d.duration)}if(!O){var v=U.getStartTimeFromUriParameters(),_=null;v&&(_=oe(isNaN(v.fragS)?v.fragT:v.fragS)),se(null,null!==_?_:D[0],NaN)}r.trigger(p.STREAMS_COMPOSED)}catch(e){R.manifestError(e.message,"nostreamscomposed",l.getValue()),x=!0,we()}}()}function pe(e){if(e.error)x=!0,we();else{var r=e.manifest;B.getAppendingSourceState()&&le(r.mediaPresentationDuration),h.updatePeriods(r);var i=h.getStreamsInfo(void 0,1)[0],o=h.getMediaInfoForType(i,n.VIDEO)||h.getMediaInfoForType(i,n.AUDIO),a=void 0;o&&(a=f.getUseCalculatedLiveEdgeTimeForAdaptation(h.getDataForMedia(o)))&&(t("SegmentTimeline detected using calculated Live Edge Time"),B.setUseManifestDateHeaderTimeSource(!1));var s=f.getUTCTimingSources(e.manifest),u=!f.getIsDynamic(r)||a?s:s.concat(B.getUTCTimingSources()),c=A.isHTTPS(e.manifest.url);u.forEach((function(e){e.value.replace(/.*?:\/\//g,"")===pr.DEFAULT_UTC_TIMING_SOURCE.value.replace(/.*?:\/\//g,"")&&(e.value=e.value.replace(c?new RegExp(/^(http:)?\/\//i):new RegExp(/^(https:)?\/\//i),c?"https://":"http://"),t("Matching default timing source protocol to manifest protocol: ",e.value))})),E.initialize(r),_.setConfig({metricsModel:y,dashMetrics:m,baseURLController:E}),_.ifinalisePlayList(t,e)})),y.addPlayList(H),H=null)}function ge(e){(H=new Ge).start=new Date,H.mstart=1e3*U.gvar t=e.getScheduleController();t&&t.setPlayList(H)}))}function ve(e){if(e.error){var r="",n=o.MEDIA_ERROR,i=void 0;switch(this.MEDIA_DOWNLOAD_ERROR=5001,e.error.code){case 1:r="MEDIA_ERR_ABORTED",n=o.MEDIA_ABORTED_ERROR;break;case 2:r="MEDIA_ERR_NETWORK",n=o.MEDIA_NETWORK_ERROR;break;case 3:r="MEDIA_ERR_DECODE",n=o.MEDIA_DECODE_ERROR,i=function(e){var t=o.MEDIA_DECODE_ERROR_UNKNOWN;return String.prototype.includes.call(e,"video")?t=o.MEDIA_DECODE_ERROR_VIDEO:String.prototype.includes.call(e,"audio")&&(t=o.MEDIA_DECODE_ERROR_AUDIO),t}(e.error.message);break;case 4:r="MEDIA_ERR_SRC_NOT_SUPPORTED",n=o.MEDIA_SUPPORTED_ERROR;break;case 5:r="MEDIA_ERR_ENCRYPTED",n=o.MEDIA_ENCRYPTED_ERROR;break;default:r="UNKNOWN",n=o.MEDIA_UNKNOWN_ERROR}e.errorCode=n,L=!0,e.error.message&&(r+=" ("+e.error.message+")"),e.error.msExtendedCode&&(r+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),t("Video Element Error: "+r)we()}}function _e(){return O?O.getStreamInfo():null}function Ee(){if(!(c&&c.hasOwnProperty("load")&&P&&P.hasOwnProperty("initialize")&&P.hasOwnProperty("reset")&&P.hasOwnProperty("getClientTimeOffset")))throw new Errction be(e){isNaN(e.newDuration)||le(e.newDuration)}function Se(){D=[],I=null,k=!1,O=null,L=!1,x=!1,G=void 0,q=void 0,V=!0,j=!1,N=!0,H=null,K=void 0,W=!1,Y=0,Q=!1}function we(){Ee(),z&&(clearTimeout(z),z=null),_.reset(),me(L||x?qe.FAILURE_STOP_REASON:qe.USER_REQUEST_STOP_REASON);for(var e=0,t=D?D.length:0;e<t;e++)D[e].reset(L);r.off(p.PLAYBACK_TIME_UPDATED,J,this),
r.off(p.BYTES_APPENDED_END_FRAGMENT,J,this),r.off(p.PLAYBACK_SEEKING,$,this),r.off(p.PLAYBACK_ERROR,ve,this),r.off(p.PLAYBACK_STARTED,ee,this),r.off(p.PLAYBACK_PAUSED,te,this),r.off(p.PLAYBACK_ENDED,ae,this),r.off(p.MANIFEST_UPDATED,pe,this),r.off(p.STREAM_BUFFERING_COMPLETED,ie,this),r.off(hr.METRIC_ADDED,Ae,this),r.off(p.MANIFEST_VALIDITY_CHANGED,be,this),E.reset(),u.reset(),y.clearAllCurrentMetrics(),l.setValue(null),c.reset(),P.reset(),w.reset(),M&&(v.detachMediaSource(F),M=null),F=null,I&&(I.setMediaElement(null),I=null,C=null,l.getValue()&&r.trigger(p.PROTECTION_DESTROYED,{data:l.getValue().url})),r.trigger(p.STREAM_TEARDOWN_COMPLETE),Se()}function Ae(e){e.metric===i.DVR_INFO&&e.mediaType===n.AUDIO&&v.setSeekable(M,e.value.range.start,e.value.range.end)}function Re(e){return-1!==[n.VIDEO,n.AUDIO,n.FRAGMENTED_TEXT].indexOf(e)?m.getCurrentBufferLevel(y.getReadOnlyMetricsFor(e))||NaN:(t("Warning  - getBufferLength requested for invalid type"),NaN)}return a={initialize:function(t,n){Ee(),N=t,C=n,P.initialize(),(u=ur(e).create()).setConfig({manifestModel:l,dashManifestModel:f,mediaPlayerModel:B,manifestLoader:c,errHandler:R}),u.initialize(),E.setConfig({dashManifestModel:f}),r.on(p.TIME_SYNCHRONIZATION_COMPLETED,fe,this),r.on(p.PLAYBACK_SEEKING,$,this),r.on(p.PLAYBACK_TIME_UPDATED,J,this),r.on(p.BYTES_APPENDED_END_FRAGMENT,J,this),r.on(p.PLAYBACK_ENDED,ae,this),r.on(p.PLAYBACK_ERROR,ve,this),r.on(p.PLAYBACK_STARTED,ee,this),r.on(p.PLAYBACK_PAUSED,te,this),r.on(p.MANIFEST_UPDATED,pe,this),r.on(p.STREAM_BUFFERING_COMPLETED,ie,this),r.on(p.MANIFEST_VALIDITY_CHANGED,be,this),r.on(p.WALLCLOCK_TIME_UPDATED,X,this),r.on(hr.METRIC_ADDED,Ae,this)},getActiveStreamInfo:_e,isVideoTrackPresent:he,isAudioTrackPresent:function(){return q},switchToVideoElement:function(e){U.initiarn D.filter((function(t){return t.getId()===e}))[0]},getStreamForTime:oe,getDuration:function(){if(O)return O.getStreamInfo().duration},getTimeRelativeToStreamId:function(e,t){for(var r=null,n=0,i=0,o=null,a=D.length,s=0;s<a;s++){if(i=(r=D[s]).getStartTime(),o=r.getDuration(),Number.isFinite(i)&&(n=i),r.getId()===t)return e-n;Number.isFinite(o)&&(n+=o)}return null},load:n has to be called previouProcessors:function(){return O?O.getProcessors():[]},setConfig:function(e){e&&(e.capabilities&&(s=e.capabilities),e.manifestLoader&&(c=e.manifestLoader),e.manifestModel&&(l=e.manifestModel),e.dashManifestModel&&(f=e.dashManifestModel),e.mediaPlayerModel&&(B=e.mediaPlayerModel),e.protectionController&&(I=e.protectionController),e.adapter&&(h=e.adapter),e.metricsModel&&(y=e.metricsModel),e.dashMetrics&&(m=e.dashMetrics),e.errHandler&&(R=e.errHandler),e.timelineConverter&&(P=e.timelineConverter),e.videoModel&&(F=e.videoModel),e.playbackController&&(U=e.playbackController),e.domStorage&&(b=e.domStorage),e.abrController&&(S=e.abrController),e.mediaController&&(T=e.mediaController))},setProtectionData:function(e){C=e},setMediaDuration:le,setAppendWindowEnd:function(e){if(e)for(var t=O.getProcessors(),r=0;r<t.length;r++){var n=t[r].getBuffer();n&&n.setAppendWindowEnd(e)}},reset:we},_=gr(e).getInstance(),E=Fr(e).getInstance(),v=Br(e).getInstance(),w=Te(e).getInstance(),A=rt(e).getInstance(),Se(),a}jr.__dashjs_factory_name="StreamController";var Vr=s.a.getSingletonFactory(jr),Hr=function(e){function t(r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this));return o.url=r||null,o.type=i||null,o.mediaType=n.STREAM,o.responseType="",o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(y);function Gr(e){e=e||{};var t=this.context,r=d(t).getInstance(),n=Bt(t).create({errHandler:e.errHandler,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:ereturn t.toString=function(){return e.toString()},t}((function(n,o){t.resolved=!0,t.resolvedContent=n||null,r.trigger(p.XLINK_ELEMENT_LOADED,{element:t,resolveObject:i,error:n||o?null:new w(1,"Failed loading Xlink element: "+e)})}));if("urn:mpeg:dash:resolve-to-zero:2013"===e)o(null,!0);else{vaNK_TYP,success:fo(null)}})}},reset:function(){n&&(n.abort(),n=null)}}}Gr.__dashjs_factory_name="XlinkLoader";var qr=s.a.getClassFactory(Gr);qr.XLINK_LOADER_ERROR_LOADING_FAILURE=1,s.a.updateClassFactory(Gr.__dashjs_factory_name,qr);var Wr=qr,Kr=function(e){void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),void 0===e.attributePrefix&&(e.attributePrefix="_"),e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=Filter.length>0)||i(e.xmlElementsFilter,r,o,a)}function u(n,c){if(9==n.nodeType){for(var l=new Object,d=n.childNodes,f=0;f<d.length;f++)(h=d[f]).nodeType==t&&(e.ignoreRoot?l=u(h):(l={})[y=r(h)]=u(h));return l}if(n.nodeType==t){(l=new Object).__cnt=0;var p=[];for(d=n.childNodes,f=0;f<d.length;f++){var h,y=r(h=d[f]);if(8!=h.nodeType){var m=c+"."+y;if(s(l,h.nodeType,y,m))if(l.__cnt++,null==l[y]){var g=u(h,m);("#text"!=y||/[^\s]/.test(g))&&((v={})[y]=g,p.push(v)),l[y]=g,o(l,y,m)}else{var v;null!=l[y]&&(l[y]instanceof Array||(l[y]=[l[y]],o(l,y,m))),g=u(h,m),("#text"!=y||/[^\s]/.test(g))&&((v={})[y]=g,p.push(v)),l[y][l[y].length]=g}}}l.__children=p;for(var _=r(n),E=0;E<n.attributes.length;E++){var b=n.attributes[E];l.__cnt++;for(var S=b.value,T=0,w=e.matchers.length;T<w;T++){var A=e.matchers[T];A.test(b,_)&&(S=A.converter(b.value))}l[e.attributePrefix+b.name]=S}var R=function(e){return e.prefix}(n);return null!=R&&""!=R&&(l.__cnt++,l.__prefix=R),null!=l["#text"]&&(l.__text=l["#text"],l.__text instanceof Array&&(l.__text=l.__text.join("\n")),
e.stripWhitespaces&&(l.__text=l.__text.trim()),delete l["#text"],"property"==e i(e.datetimeAccessFormPaths,t,r,o)?a(t):t}return t}(l.__text,y,c+"."+y)),null!=l["#cdata-section"]&&(l.__cdata=l["#cdata-section"],delete l["#cdata-section"],"property"==e.arrayAccessForm&&delete l["#cdata-section_asArray"]),0==l.__cnt&&"text"==e.emptyNodeForm?l="":1==l.__cnt&&null!=l.__text?l=l.__text:1!=l.__cnt||null==l.__cdata||e.keepCData?l.__cnt>1&&null!=l.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==l.__text||""==l.__text.trim())&&delete l.__text:l=l.__cdata,delete l.__cnt,!e.enableToStrihis.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i,n,o,!1),osoft.XMLDOM"urn void 0===e||nul):"number"==typeateTime=function(e){return"string"==typeof e?a(e):e},thisseXmlString(e);ret:null},this.js=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},Yr="onLoad",Qr="Period",zr="AdaptationSet";function Zr(e){e=e||{};var t=this.context,r=d(t).getInstance(),n=rt(t).getInstance(),io.url:o.originalContent.BaseURL+o.url,c.load(a,o,i)}function f(e){var t,r=void 0,n="";if(r=e.element,t=e.resolveObject,r.resolvedContent){var i=0;0===r.resolvedContent.indexOf("<?xml")&&(i=r.resolvedContent.indexOf("?>")+2),n=r.resolvedContent.substr(0,i)+"<response>"+r.resolvedContent.substr(i++)if(!1===e.elements[t].resolved)return!1;return!0})(t)&&h(t)}function h(e){var t=[],n=void 0,i=void 0;if(function(e){var t=[],r=void 0,n=void 0,i=void 0,o=void 0,u=void 0,c=void 0;for(o=e.elements.length-1;o>=0;o--){if(n=(r=e.elements[o]).type+"_asArray",r.resolvedContent){if(r.resolvedContent)for(u=0;u<r.resolvedContent[n].length;u++)i=r.resolvedContent[n][u],t.push(i)}else delete r.originalContent["xlink:actuate"],delete r.originalContent["xlink:href"],t.push(r.originalContent);for(r.parentElement[n].splice(r.index,1),c=0;c<t.length;c++)r.parentElement[n].splice(r.index+c,0,t[c]);t=[]}e.elements.length>0&&a.run(s)}(e),"onActuate"===e.resolveType&&r.trigger(p.XLINK_READY,{manifest:s}),e.resolveType===Yr)switch(e.type){case Qr:for(n=0;n<s.Period_asArray.length;n++)(i=s.Period_asArray[n]).hasOwnProperty("AdaptationSet_asArray")&&(t=t.concat(y(i.AdaptationSet_asArray,i,zr,Yr))),i.hasOwnProperty("EventStream_asArray")&&(t=t.concat(y(i.EventStream_asArray,i,"EventStream",Yr)));l(t,zr,Yr);break;case zr:r.trigger(p.XLINK_READY,{manifest:s})}}function y(e,t,r,n){var i=[],o=void 0,a=void 0,s=void 0;for(a=e.length-1;a>=0;a--)(o=e[a]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===o["xlink:href"]&&e.splice(a,1);for(a=0;a<e.length;a++)(o=e[a]).hasOwnProperty("xlink:href")&&o.hasOwnProperty("xlink:actuate")&&o["xlink:actuate"]===n&originalContent:o,resolvedContent:null,resolved:!1}}return i={resolveManifestOnLoad:function(e){u=new Kr({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:o}),l(y((s=e).Period_asArray,s,Qr,Y:function(e){e&&(o=e)},setIron:function(e){e&&(a=e)},reset:function(){r.off(p.XLINK_ELEMENT_LOADED,f,i),c&&(c.reset(),c=null)}},r.on(p.XLINK_ELEMENT_LOADED,f,i),c=Wr(t).create({errHandler:e.errHandler,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),i}Zr.__dashjs_factory_name="XlinkController";var Jr=s.a.getClassFactory(Zr),Xr="function"==typeof Symbol&&"symbol"==c(Symbol.iterator)?function(e){return c(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function r(e,r,n){for(var i=0,o=e.length;i<o;++i){var a=e[i];if(r[a.name])if(n[a.name]){if(a.merge){var s=r[a.name],u=n[a.name];"object"===(void 0===s?"undefined":Xr(s))&&"object"===(void 0===u?"undefined":Xrth;u<c;++u){var l=s[u];r(e.properties,t,l),n(a,l)}}}return{run:function(t){if(null===t||"object"!==(void 0===t?"undefined":Xr(t)))return t;if("period"in e)for(var r=e.period,i=t.Period_asArray,o=0,a=i.length;o<a;++o){var s=i[o];if(n(r,s),"adaptationset"in e){var u=s.AdaptationSet_asArray;if(u)for(var c=e.adaptationset,l=0,d=u.length;l<d;++l)n(c,u[l])}}return t}}}$r.__dashjs_factory_name="ObjectIron";var en=s.a.getClassFactory($r),tn=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(ernumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var on=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this,(function(e,t){var r,n=(nn(r={},Je.MPD,[Je.ID,Je.PROFILES]),nn(r,Je.PERIOD,[Je.ID]),nn(r,Je.BASE_URL,[Je.SERVICE_LOCATION,Je.BYTE_RANGE]),nn(r,Je.SEGMENT_BASE,[Je.INDEX_RANGE]),nn(r,Je.INITIALIZATION,[Je.RANGE]),nn(r,Je.REPRESENTATION_INDEX,[Je.RANGE]),nn(r,Je.SEGMENT_LIST,[Je.INDEX_RANGE]),nn(r,Je.BITSTREAM_SWITCHING,[Je.RANGE]),nn(r,Je.SEGMENT_URL,[Je.MEDIA_RANGE,Je.INDEX_RANGE]),nn(r,Je.SEGMENT_TEMPLATE,[Je.INDEX_RANGE,Je.MEDIA,Je.INDEX,Je.INITIALIZATION_MINUS,Je.BITSTREAM_SWITCHING_MINUS]),nn(r,Je.ASSET_IDENTIFIER,[Je.VALUE,Je.ID]),nn(r,Je.EVENT_STREAM,[Je.VALUE]),nn(r,Je.ADAPTATION_SET,[Je.PROFILES,Je.MIME_TYPE,Je.SEGMENT_PROFILES,Je.CODECS,Je.CONTENT_TYPE]),nn(r,Je.FRAME_PACKING,[Je.VALUE,Je.ID]),nn(r,Je.AUDIO_CHANNEL_CONFIGURATION,[Je.VALUE,Je.ID]),nn(r,Je.CONTENT_PROTECTION,[Je.VALUE,Je.ID]),nn(r,Je.ESSENTIAL_PROPERTY,[Je.VALUE,Je.ID]),nn(r,Je.SUPPLEMENTAL_PROPERTY,[Je.VALUE,Je.ID]),nn(r,Je.INBAND_EVENT_STREAM,[Je.VALUE,Je.ID]),nn(r,Je.ACCESSIBILITY,[Je.VALUE,Je.ID]),nn(r,Je.ROLE,[Je.VALUE,Je.ID]),nn(r,Je.RATING,[Je.VALUE,Je.ID]),nn(r,Je.VIEWPOINT,[Je.VALUE,Je.ID]),nn(r,Je.CONTENT_COMPONENT,[Je.CONTENT_TYPE]),nn(r,Je.REPRESENTATION,[Je.ID,Je.DEPENDENCY_ID,Je.MEDIA_STREAM_STRUCTURE_ID]),nn(r,Je.SUBSET,[Je.ID]),nn(r,Je.METRICS,[Je.METRICS_MINUS]),nn(r,Je.REPORTING,[Je.VALUE,Je.ID]),r);if(n.hasOwnProperty(t)){var i=n[t];return void 0!==i&&i.indexOf(e.name)>=0}return!1}),(function(e){return String(e)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(rn),an=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,sn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this,(function(e){for(var t=[Je.MIN_BUFFER_TIME,Je.MEDIA_PRESENTATION_DURATION,Je.MINIMUM_UPDATE_PERIOD,Je.TIMESHIFT_BUFFER_DEPTH,Je.MAX_SEGMENT_DURATION,Je.MAX_SUBSEGMENT_DURATION,n.SUGGESTED_PRESENTATION_DELAY,Je.START,n.START_TIME,Je.DURATION],r=t.length,i=0;i<r;i++)if(eparseFloat(t[12]||0);return void 0!==t[1]&&(r=-r),r})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(rn),un=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,cn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this0);r+=("+"===t[8]?-1:1)*n*60*1e3}return new Date(r)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(rn),ln=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,dn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"objectis,e.call(this,(function(e){return ln.test(e.value)}),(function(e){return parseFloat(e)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(rn),fn=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){retu&&r.length&&r.charAt(0)===r.charAt(0).toUpperCase()}return fn(e,[{key:"name",get:function(){return this._name}},{key:"tion(t,r,n){returEach((function(e){i._properties.push(new pn(e))}))}return hn(e,[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}]),e}(),mn=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=[Je.PROFILES,Je.WIDTH,Je.HEIGHT,Je.SAR,Je.FRAMERATE,Je.AUDIO_SAMPLING_RATE,Je.MIME_TYPE,Je.SEGMENT_PROFILES,Je.CODECS,Je.MAXIMUM_SAP_PERIOD,Je.START_WITH_SAP,Je.MAX_PLAYOUT_RATE,Je.CODING_DEPENDENCY,Je.SCAN_TYPE,Je.FRAME_PACKING,Je.AUDIO_CHANNEL_CONFIGURATION,Je.CONTENT_PROTECTION,Je.ESSENTIAL_PROPERTY,Je.SUPPLEMENTAL_PROPERTY,Je.INBAND_EVENT_STREAM];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this,Je.ADAPTATION_SET,r,[new yn(Je.REPRESENTATION,r,[new yn(Je.SUB_REPRESENTATION,r)])]))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(yn),gn=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=[Je.SEGM;return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this,Je.PERIOD,r,[new yn(Je.ADAPTAototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(yn);function vn(){var e,t=this.context,r=g(t).getInstance().log,n=void 0,i=void 0,o=void 0;return e={parse:function(e){var t,n=window.performance.now();if(!(t=i.xml_str2json(e)))throw new Error("parsing the manifest failed");var a=window.performance.now();o.run(t);var s=window.performance.now();return r("Parsing complete: ( xml2json: "+(a-n).toPrecision(3)+"ms, objectiron: "+(s-a).toPrecision(3)+"ms, total: "+((s-n)/1e3).toPrecision(3)+"s)"),t},getMatchers:function(){return n},getIron:function(){return o}},n=[new sn,new cn,new dn,new on],i=new Kr({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:n}),o=en(t).create({adaptationset:new mn,period:new gn}),e}vn.__dashjs_factory_name="DashParser";var _n=s.a.getClassFactory(vn),En="function"==typeof Symbol&&"ructor===Symbol&&e!==Symbol.prototype?"symbol":c(e)};function bn(){var e,t=this.context,r=g(t).getInstance().log,n=void 0;function i(e,t){return t?e&&e.replace(/http:\/\//g,"https://"):e}return e={parse:function(e,t){var n={},o=window.performance.now(),a=function(e){var t=e&&(e.ContentProtection||e.content_protection);return t?t.pssh?{schemeIdUri:t.schemeIdUri||t.scheme_id_uri,value:t.value,pssh:t.pssh}:{schemeIdUri:t.schemeIdUri||t.scheme_id_uri,value:t.value}:null};try{e=function e(t){var r={};if(t instanceof Object){var n=function(n){var i=n.replace(/[\x41-\x5A]/g,(function(e,t){var r=String.fromCharCode(e.charCodeAt(0)+32);return t?"_"+r:r}));"[object Array]"===Object.?(r[i]=[],t[n].forEach((function(t){r[i].push(e(t))}))):"[object Object]"===Object.prototype.toString.call(t[n])?r[i]=e(t[n]):r[i]=t[n]};for(var i in t)n(i)}else r=t;return r}(e)}catch(e){throw new Error("Convert bilibili mpd failed, "+e)}if(n.ProgramInformation={Title:""},n.loadedTime=new Date,n.mediaPresentationDuration=e.duration,n.minBufferTime=e.min_buffer_time,n.profiles="urn:mpeg:dash:profile:isoff-on-demand:2011",n.xmlns="urn:mpeg:dash:profile:isoff-on-demand:2011",n.type="static",n.interactive="interactive"===e.type,n.originalUrl=location.href,n.url=location.href,n.Period={duration:e.duration,AdaptationSet:[]},e.video&&(n.Period.AdaptationSet[0]={},n.Period.AdaptationSet[0].Representation=e.video.map((function(e){var r=a(e),o={__text:i(e.base_url,t)};return e.backup_url&&e.backup_url.forEach((function(e,r){o["backupUrl"+(r+1)]=i(e,t)})),r&&!n.Period.AdaptationSet[0].ContentProtection&&(n.Period.AdaptationSet[0].ContentProtection=r),{BaseURL:o,ContentProtection:r,SegmentBase:{Initialization:{range:e.segment_base.initialization},indexRange:e.segment_base.index_range,indexRangeExact:"true"},bandwidth:e.bandwidth,codecs:e.codecs,frameRate:e.frame_rate,height:e.height,width:e.width,id:e.id+"",mimeType:e.mime_type,sar:e.sar,startWithSAP:e.start_with_sap}}))),e.audio&&(n.Period.AdaptationSet[1]={},n.Period.AdaptationSet[1].Representation=e.audio.map((function(e){var r=a(e),o={__text:i(e.base_url,t)};return e.backup_url&&e.backup_url.forEach((function(e,r){o["backupUrl"+(r+1)]=i(e,t)})),r&&!n.Period.AdaptationSet[1].ContentProtection&&(n.Period.AdaptationSet[1].ContentProtection=r),{BaseURL:o,ContentProtection:r,SegmentBase:{Initialization:{range:e.segment_base.initialization},indexRange:e.segment_base.index_range,indexRangeExact:"true"},bandwidth:e.bandwidth,codecs:e.codecs,id:e.id+"",mimeType:e.mime_type}}))),n.ProgramInformation={Title:""},function e(t){var r="[object Array]"!==Object.prototype.toString.call(t);for(var n in t)"object"===En(t[n])&&(e(t[n]),r&&(t[n+"_asArray"]="[object Array]"===Object.prototype.toString.call(t[n])?t[n]:[t[n]]))}(n),!n)throw new Error("parsing the manifest failed");var s=window.performance.now(),u=window.performance.now();return r("Parsing complete: ( xml2json: "+(s-o).toPrecision(3)+"ms, objectiron: "+(u-s).toPrecision(3)+"ms, total: "+((u-o)/1e3).toPrecision(3)+"s)"),n},getMatchers:function(){return null},getIron:function(){return n}},n=en(t).create({adaptationset:new mn,period:new gn}),e}bn.__dashjs_factory_name="DashBilibiliParser";var Sn=s.a.getClassFactory(bn);function Tn(e){e=e||{};var t=this.context,r=d(t).getInstance(),i=rt(t).getInstance(),a=g(t).getInstance().log,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=e.mssHandler,y=e.errHandler;function m(e){r.trigger(p.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}function v(e,s,u,d){if(c){var y=void 0,m=void 0,g=void 0;if(window.location&&window.location&&"https:"===window.location.protocol&&(f=!0),d&&d!==e?(m=i.parseBaseUrl(d),y=d):(i.isRelative(e)&&(e=i.resolve(e,window.location.href)),m=i.parseBaseUrl(e)),null===l&&(l=function(e){var r=null;return e.video||e.audio?Sn(t).create():e.indexOf("SmoothStreamingMedia")>-1?(h&&(r=h.createMssParser(),h.registerEvents()),r):e.indexOf("MPD")>-1?_n(t).create():r}(s)),null!==l){c.setMatchers(l.getMatchers()),c.setIron(l.getIron());try{g=l.parse(s,f)}catch(t){return void r.trigger(p.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new w(1,"Failed parsing manifest : "+(d?e:"MPD String"),null,o.MANIFEST_RESOLVE_ERROR)})}g?(g.url=y||e,g.originalUrl||(g.originalUrl=g.url),g.hasOwnProperty(n.LOCATION)&&(m=i.parseBaseUrl(g.Location_asArray[0]),a("BaseURI set by Location to: "+m)),g.baseUri=function(e,t){return t?e&&e.replace(/http:\/\//g,"https://"):e}(m,f),g.loadedTime=new Date,c.resolveManifestOnLoad(g)):r.trigger(p.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new w(1,"parsing failed",null,o.MANIFEST_ERROR)})}else r.trigger(p.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new w(1,"Failed detecting manifest type or manifest type unsupported : "+(d?e:"MPD String"),null,o.MANIFEST_TYPE_ERROR)})}}return s={load:function(e,t){if(f=t,!e||"string"!=typeof e||0!==e.indexOf("http")&&0!==e.indexOf("/"))v("",e,0,"");else{.load({request:n,success:function(t,r,n){v(e,t,0,n)},error:function(t,n,i,a){r.trigger(p.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new w(2,"Failed loading manifest: "+e+", "+i,null,o.MANIFEST_DOWNLOAD_ERROR,a)})}})}},reset:function(){r.off(p.XLINK_READY,m,s),c&&(c.reset(),c=null),u&&(u.abort(),u=null),h&&h.reset()}},r.on(p.XLINK_READY,m,s),u=Bt(t).create({errHandler:y,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),c=Jr(t).create({errHandler:y,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),l=null,s}Tn.__dashjs_factory_name="ManifestLoader";var wn=s.a.getClassFactory(Tn);wn.MANIFEST_LOADER_ERROR_PARSING_FAILURE=1,wn.MANIFEST_LOADER_ERROR_LOADING_FAILURE=2,s.a.updateClassFactory(Tn.__dashjs_factory_name,wn);var An=wn;functiurce"in window,t="MediaSource"in window;return e||t},supportsEncryptedMedia:function(){return t},supportsCodec:function(e){return!(!("MediaSource"in window)||!MediaSource.isTypeSupported(e))||!(!("WebKitMediaSource"in window)||!WebKitMediaSource.isTypeSupported(e))||!!(window.__ENABLE_WASM_PLAYER__&&"BwpMediaSource"in window&&BwpMediaSource.isTypeSupported(e))},setEncryptedMediaSupported:function(e){t=e}},t=!1,e}Rn.__dashjs_factory_name="Capabilities";var Pn=s.a.getSingletonFactory(Rn);function Dn(){var e=this.context,t=d(e).getInstance(),r=void 0;return{getValue:function(){return r},setValue:function(e){r=e,e&&t.trigger(p.MANIFEST_LOADED,{data:e})}}}Dn.__dashjs_factory_name="Updthithis.t=null,this.mt=null,this.to=null,this.lto=null},kn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.level=null},Ln=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(thiis. new Tncy,thll,l,te),this.loadingRequests=[],this.executedRequests=[]};function Gn(,o=void 0;function a(){r.trigger(p.METRICS_CHANGED)}function s(e){r.trigger(p.METRIC_CHANGED,{mediaType:e}),a()}function u(e,t,n){r.trigger(p.METRIC_UPDATED,{mediaType:e,metric:t,value:n}),s(e)}function c(e,t,n){r.trigger(p.METRIC_ADDED,{mediaType:e,metric:t,value:n}),s(e)}function l(e){var t=void 0;return o.hasOwnProperty(e)?t=o[e]:(t=new In,o[e]=t),t}function f(e,t,r){v3&&n[t].shift()}function h(e,t,r){f(rCurrentMetricsForType:e],s(e)},clearAllCurrentMetrics:function(){o={},a()},getReadOnlyMetricsFor:function(e){return o.hasOwnProperty(e)?o[e]:null},getMetricsFor:l,addTcpConnection:function(e,t,r,n,o,a){var s=new Cn;return s.tcpid=t,s.dest=r,s.topen=n,s.tclose=o,s.tconnect=a,h(e,i.TCP_CONNECTION,s),s},addHttpRequest:function e(t,r,n,o,a,s,u,c,l,d,f,p,y,m){var g=new F;return a&&a!==o&&(e(t,null,n,o,null,null,u,c,null,null,null,p,null,null),g.actualurl=a),g.tcpid=r,g.type=n,g.url=o,g.range=u,g.trequest=c,g.tresponse=l,g.responsecode=f,g._tfinish=d,g._stream=t,g._mediaduration=p,g._responseHeaders=y,g._serviceLocation=s,m?m.forEach((function(e){!function(e,t,r,n){var i=new U;i.s=t,i.d=r,i.b=n,e.trace.push(i),e.interval||(e.interval=0),e.interval+=r}(g,e.s,e.d,e.b)})):(delete g.interval,delete g.trace),h(t,i.HTTP_REQUEST,g),g},addRepresentationSwitch:function(e,t,r,n,o){var a=new Nn;return a.t=t,a.mt=r,a.to=n,o?a.lto=o:delete a.lto,h(e,i.TRACK_SWITCH,a),a},addBufferLevel:function(e,t,r){var n=new kn;return n.t=t,n.level=r,h(e,i.BUFFER_LEVEL,n),n},addBufferState:function(e,t,r){var n=new Ln;return n.target=r,n.state=t,h(e,i.BUFFER_STATE,n),n},addDVRInfo:function(e,t,r,n){var o=new xn;return o.time=t,o.range=n,o.manifestInfo=r,h(e,i.DVR_INFO,o),o},addDroppedFrames:function(e,t){var r=new Mn,n=l(e).DroppedFrames;return r.time=t.creationTime,r.droppedFrames=t.droppedVideoFrames,n.length>0&&n[n.length-1]==r?n[n.length-1]:(h(e,i.DROPPED_FRAMES,r),r)},addSchedulingInfo:function(e,t,r,n,o,a,s,u,c){var l=new Vn;return l.mediaType=e,l.t=t,l.type=r,l.startTime=n,l.availabilityStartTime=o,l.duration=a,l.quality=s,l.range=u,l.state=c,h(e,i.SCHEDULING_INFO,l),l},addRequestsQueue:function(e,t,r){var n=new Hn;n.loadingRequests=t,n.executedRequests=r,l(e).RequestsQueue=n,c(e,i.REQUESTS_QUEUE,n)},addManifestUpdate:function(e,t,r,o,a,s,u,l,d,p){var h=new Un;return h.mediaType=e,h.type=t,h.requestTime=r,h.fetchTime=o,h.availabilityStartTime=a,h.presentationStartTime=s,h.clientTimeOffset=u,h.currentTime=l,h.buffered=d,h.latency=p,f(n.STREAM,i.MANIFEST_UPDATE,h),c(e,i.MANIFEST_UPDATE,h),h},updateManifestUpdateInfo:function(e,t){if(e){for(var r in t)e[r]=t[r];u(e.mediaType,i.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,r,n,o){if(e){var a=new Bn;return a.id=t,a.index=r,a.start=n,a.duration=o,e.streamInfo.push(a),u(e.mediaType,i.MANIFEST_UPDATE_STREAM_INFO,e),a}return null},addManifestUpdateRepresentationInfo:function(e,t,r,n,o,a,s,c){if(e){var l=new jn;return l.id=t,l.index=r,l.streamIndex=n,l.mediaType=o,l.startNumber=s,l.fragmentInfoType=c,l.presentationTimeOffset=a,e.representationInfo.push(l),u(e.mediaType,i.MANIFEST_UPDATE_TRACK_INFO,e),l}return null},addPlayList:function(e){var t=n.STREAM;retsubreplevel")&&!e.subreplevel&&delete e.subreplevel})):delete e.trace,h(t,i.PLAY_LIST,e),e},addDVBErrors:functie),e},setConfig:function(e){e&&e.adapter&&e.adapter}},o={},e}Gn.__dashjs_factory_name="MetricsModel";var qn=s.a.getSingletonFactory(Gn);function Wn(){var e=void 0,t=void 0,r=void 0,n=void 0,i=this.contexhEvent(t)}}function f(){return e?e.buffered:null}return{initialize:function(){a.on(p.PLAYBACK_PLAYING,l,this)},setCurrentTime:function(t){if(e){if(e.currentTime==t)return;try{e.currentTime=t}catch(r){0===e.readyState&&r.code===r.INVALID_STATE_ERR&&setTimeout((function(){e.currentTime=t}),400)}}},play:function(){if(e){e.autoplay=!0;var t=e.play();return t&&"undefined"!=typeof Promise&&t instanceof Promise&&t.catch((function(e){"NotAllowedError"===e.name&&a.trigger(p.PLAYBACK_NOT_ALLOWED),o("Caught pending play exception - continuing ("+e+")")})),tnull},pause:function(){e&&(e.pause(),e.autoplay=!1)},isSeeking:function(){return e?e.seeking:null},getTime:function(){return e?e.currentTime:null},getPlaybackRate:function(){return e?e.playbackRate:null},getPlayedRanges:function(){return e?e.played:null},getEnded:function(){return e?e.ended:null},setStallState:function(t,r){!function(t,r){r?function(t){var r=void 0;null===t||e.seeking||-1!==s.indexOf(t)||(s.push(t),e&&1===s.length&&((r=document.createEvent("Event")).initEvent("waiting",!0,!1),n=e.playbackRate,e.dispatchEvent(r)))}(t):function(t){var r,i=s.indexOf(t),o=void 0;null!==t&&(-1!==i&&s.splice(i,1),e&&!1===c()&&0===e.playbackRate&&(r=n||1,e&&(e.readyState<=2&&r>0?e.addEventListener("canplay",u):e.playbackRate=r),e.paused||((o=document.createEvent("Event")).initEvent("playing",!0,!1),e.dispatchEvent(o))))}(t)}(t,r)},getElement:function(){return e},setElement:function(t){if(null!=t&&(!t||!t.nodeName||"VIDEO"!==t.nodeName&&"AUDIO"!==t.nodeName&&"BWP-VIDEO"!==t.nodeName))throw"element is not video or a{e&&(t?e.src=t:(e.removeAttribute("src"),e.load()))},getSource:function(){return e?e.src:null},getVideoContainer:function(){return r},setVideoContainer:function(e){r=e},getTTMLRe.pointerEvents="noe.webkitDecodedFrameCount,creationTime:new Date}),r},addEventListener:function(istener:function(t,r){e&&e.removeEventListener(t,r)},getReadyState:function(){return e?e.readyState:NaN},getBufferRange:f,getClientWidth:function(){return e?e.clientWidth:NaN},getClientHeight:f},getTextTracks:function(){return e?e.textTracks:[]},getTextTrack:function(t,r,n,i,o){if(e)for(var a=0;a<e.textTracks.length;a++)if(e.textTracks[a].kind===t&&(!r||e.textTracks[a].label==r)&&e.textTracks[a].language===n&&e.textTracks[a].isTTML===i&&e.textTracks[a].isEmbedded=function(t,rks[e.textTracks.length-1].isEmbedded=t.isEmbedded))},removeChild:function(t){e&&e.removeChild(t)},getVideoWidth:function(){return e?e.videoWidth:NaN},getVideoHeight:function(){return e?e.videoHeight:NaN},getVideoRelativeOffsetTop:function(){return e&&e.parentNode?e.getBoundingClientRect().top-e.parentNode.getBoun.left-e.parentNodeAttr:functiot)},getDuration:function(){return e?e.duration:null},getVideoBufferRanges:function(){var e=f();if(e){for(var t=[],r=e.length,n=0;n<r;n++)t.push({start:e.start(n),end:e.end(n)});return t}return[]},reset:function(){a.off(p.PLAYBACK_PLAYING,l,this)}}}Wn.__dashjs_factory_name="VideoModel";var Kn=s.a.getSingletonFactory(Wn),Yn=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],Qn="dashjs_?_bitrate",zn="dashjs_?_settings",Zn="localStorage",Jn="LastBitrate",Xn="LastMediaSettings";function $n(e){e=e||{};var t,r=this.context,n=g(r).getInstance().log,i=e.mediaPlayerModel,o=void 0;function a(e){if(void 0!==o)return o;o=!1;var t=void 0;try{"undefined"!=typeof window&&(t=window[e])}catch(e){return n("Warning: DOMStorage access denied: "+e.message),o}if(!t||e!==Zn&&"sessionStorage"!==e)return o;try{t.setItem("1","1"),t.removeItem("1"),o=!0}catch(e){n("Warning: DOMStorage is t){return a(e)&&i["get"+t+"CachingInfo"]().enabled}function c(){if(!i||!i.hasOwnProperty("getLastMediaSettingsCachingInfo"))throw new Error("Missing config parameter(s)")}return t={getSavedBitrateSettings:function(e){var t=NaN;if(c(),u(Zn,Jn)){var r=Qn.replace(/\?/,e);try{var o=JSON.parse(localStorage.getItem(r))||{},a=(new Date).getTime()-parseInt(o.timestamp,10)>=i.getLastMediaSettingsCachingInfo().ttl||!1,s=parseFloat(o.bitrate);isNaN(s)||a?a&&localStorage.removeItem(r):(t=s,n("Last saved bitrate for "+e+" was "+s))}catch(e){return null}}return t},setSavedBitrateSettings:function(e,t){if(u(Zn,Jn)&&t){var r=Qn.replace(/\?/,e);try{localStorage.setItem(r,JSON.stringify({bitrate:t.toFixed(3),timestamp:s()}))}catch(e){n(e.message)}}},getSavedMediaSettings:function(e){if(c(),!u(Zn,Xn))return null;var t=null,r=zn.replace(/\?/,e);try{var n=JSON.parse(localStorage.getItem(r))||{},o=(new Date).getTime()-parseInt(n.timestamp,10)>=i.getLastMediaSettingsCachingInfo().ttl||!1;t=n.settings,o&&(localStorage.removeItem(r),t=null)}catch(e){return null}return t},setSavedMediaSettings:function(e,t){if(u(Zn,Xn)){var r=zn.replace(/\?/,e);try{localStorage.setItem(r,JSON.stringify({settings:t,timestampStorage.setItem(e.newKey,t)}catch(e){n(e.message)}}})),t}$n.__dashjs_factory_name="DOMStorage";var ei=s.a.getSingletonFactory($n),ti=r(5),ri=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},ni=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,th.duNaNhis.eventStream=null,this.presentationTimeDelta=NaN},si=r(15),ui=r.+){var i=t[n];if(e.id===i.id)return i}return null}function u(e){var r=new ri,n=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],i=t.getRepresentationFor(e.index,n);return r.id=e.id,r.quality=e.index,r.bandwidth=t.getBandwidth(i),r.DVRWindow=e.segmentAvailabilityRange,r.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),r.MSETimeOffset=e.MSETimeOffset,r.useCalculatedLiveEdgeTime=e.useCalculatedLiveEdgeTime,r.mediaInfo=c(e.adaptation),r}function c(e){var r,n=new ni,i=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];return n.id=e.id,n.index=e.index,n.type=e.type,n.streamInfo=d(e.period),n.representationCount=t.getRepresentationCount(i),n.lang=t.getLanguageForAdaptation(i),r=t.getViewpointForAdaptation(i),n.viewpoint=r?r.value:void 0,n.ar=t?"cea-608:"+t:"cea-608",n.embeddedCaptions=!0),r})),n.audioChannelConfiguration=t.getAudioChannelConfigurationForAdaptation(i).map((function(e){return e.value})),n.roles=t.getRolesForAdaptation(i).map((function(e){return e.value})),n.codec=t.getCodec(i),n.mimeType=t.getMimeType(i),n.contentProtection=t.getContentProtectionData(i),n.bitrateList=t.getBitrateListForAdaptation(ntProtection.forEach((function(e){e.KID=t.ext=!0,e.isEmbedded=!0,e.lang=r,e.roles=["caption"]}function d(e){var r,n,i=new ii;return i.id=e.id,i.index=e.index,i.start=e.start,i.duration=e.duration,i.manifestInfo=(r=e.mpd,(n=new oi).DVRWindowSize=r.timeShiftBufferDepth,n.loadedTime=r.manifest.loadedTime,
n.availableFrom=r.availabilityStartTime,n.minBufferTime=r.manifest.minBufferTime,n.maxFragmentDuration=r.maxSegmentDuration,n.duration=t.getDuration(r.manifest),n.isDynamic=t.getIsDynamic(r.manifest),n),i.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(i.start+i.duration-i.manifestInfo.duration)<1,i}function f(){if(!t||!t.hasOwnProperty("getMpd")||!t.hasOwnProperty("getRegularPeriods"))throw new ErrionController parameter is missing or malformed!")}function y(e){if(null===e||isNaN(e)||e%1!=0)targument is not an integer")}function m(){r=[],i={}}return e={convertDataToRepresentationInfo:u,getDataForMedia:a,getStreamsInfo:function(e,n){var i=[],o=r;if(e){f();var a=t.getMpd(e);o=t.getRegularPeriods(a)}n||(n=o.length);for(var s=0;s<n;s++)i.push(d(o[s]));return i},getMediaInfoForType:function(e,n){if(0===r.length)return null;var o=r[0].mpd.manifest,a=t.getAdaptationForType(o,e.index,n,e);if(!a)return null;var u=s(e,r),l=u.id,d=t.getIndexForAdaptation(a,o,e.index);return i[l]=i[l]||t.getAdaptationsForPeriod(u),c(i[l][d])},getAllMediaInfoForType:function(e,o,a){var u,d=r,p=a,h=[],y=void 0,m=void 0,g=void 0,v=void 0,_=void 0;if(p){f();var E=t.getMpd(p);d=t.getRegularPeriods(E)}else{if(!(r.length>0))return h;p=r[0].mpd.manifest}var b=s(e,d),S=b.id,T=t.getAdaptationsForType(p,e.index,o!==n.EMBEDDED_TEXT?o:n.VIDEO);if(!T)return h;for(i[S]=i[S]||t.getAdaptationsForPeriod(b),v=0,u=T.length;v<u;v++)if(y=T[v],g=t.getIndexForAdaptation(y,p,e.index),m=c(i[S][g]),o===n.EMBEDDED_TEXT){var w=m.accessibility.length;for(_=0;_<w;_++)if(m){var A=m.accessibility[_];if(0===A.indexOf("cea-608:")){var R=A.substring(8).split(";");if("CC"===R[0].substring(0,2))for(_=0;_<R.length;_++)m||(m=c.call(this,i[S][g])),l(m,R[_].substring(0,3),R[_].substring(4)),h.push(m),m=null;else for(_=0;_<R.length;_++)m||(m=c.call(this,i[S][g])),l(m,"CC"+(_+1),R[_]),h.push(m),m=null}else 0===A.indexOf("cea-608")&&(l(m,n.CC1,"eng"),h.push(m),m=null)}}else o===n.IMAGE?(m.type=n.IMAGE,h.push(m),m=null):m&&h.push(m);return h},getCurrentRepresentationInfo:function(e){h(e);var t=e.getCurrentRepresentation();return t?u(t):null},getRepresentationInfoForQuality:function(e,t){h(e),y(t);var r=e.getRepresentationForQuality(t);return r?u(r):null},updateData:function(e){p(e);var n,i=s(e.getStreamInfo(),r),o=e.getMediaInfo(),u=a(o),c=e.getType(),l=void 0;n=o?o.id:null,r.length>0&&(l=n?t.getAdaptationForId(n,r[0].mpd.manifest,i.index):t.getAdaptationForIndex(o.index,r[0].mpd.manifest,i.index),e.getRepresentationController().updateData(l,u,c))},getInitRequest:function(e,t){var r,n=void 0,i=void 0;return p(e),y(t),n=e.getRepresentationController(),i=e.getIndexHandler(),r=n?n.getRepresentationForQuality(t):null,i?i.getInitRequest(r):null},getNextFragmentRequest:function(e,t){var r,n=void 0;return p(e),r=o(t,e.getRepresentationController()),(n=e.getIndexHandler())?n.getNextSegmentRequest(r):null},getFragmentRequestForTime:function(e,t,r,n){var i,a=void 0;return p(e),i=o(t,e.getRepresentationController()),(a=e.getIndexHandler())?a.getSegmentRequestForTime(i,r,n):null},generateFragmentRequestForTime:function(e,t,r){var n,i=void 0;return p(e),n=o(t,e.getRepresentationController()),(i=e.getIndexHandler())?i.generateSegmentRequestForTime(n,r):null},getIndexHandlerTime:function(e){p(e);var t=e.getIndexHandler();return t?t.getCurrentTime():NaN},setIndexHandlerTime:function(e,t){p(e);var r=e.getIndexHandler();r&&r.setCurrentTime(t)},getEventsFor:function(e,n){var i=[];if(0===r.length)return i;var u=r[0].mpd.manifest;return e instanceof ii?i=t.getEventsForPeriod(s(e,r)):e instanceof ni?i=t.getEventStreamForAdaptationSet(u,a(e)):e instanceof ri&&(i=t.getEventStreamForRepresentation(u,o(e,n.getRepresentationController()))),i},getEvent:function(e,t,r){if(!e||!t)return null;var n=new ai,i=e.scheme_id_uri,o=e.value,a=e.timescale,s=e.presentation_time_delta,u=e.event_duration,c=e.id,l=e.message_data,d=r*a+s;return t[i]?(n.eventStream=t[i],n.eventStream.value=o,n.eventStream.timescale=a,n.duration=u,n.id=c,n.presentationTime=d,n.messag(e){e&&e.dashManifestModel&&(t=e.dashManifestModel)},updatePeriods:function(e){if(!e)return null;f();var n=t.getMpd(e);r=t.getRegularPeriods(n),i={}},reset:m},m(),e}ci.__dashjs_factory_nameis,e),this.period=null,this.index=-1,this.type=null},fi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,tUpd,this.timescale=1,this.value="",this.schemeIdUri=""};function mi(e){e=e||{};var t=this.context,r=rt(t).getInstance(),i=e.mediaController,o=e.timelineConverter,s=e.adapter,u=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function c(e,t){var r=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=!1,c=!1;if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.hasOwnProperty("ContentComponent_asArray")&&e.ContentComponent_asArray,a=t!==n.TEXT?new RegExp(t):new RegExp("(vtt|ttml)"),e.Representation_asArray&&e.Representation_asArray.length&&e.Representation_asArray.length>0&&e.Representation_asArray[0].hasOwnProperty(Je.CODECS)&&(0===(s=e.Representation_asArray[0].codecs).search(n.STPP)||0===s.search(n.WVTT)))return t===n.FRAGMENTED_TEXT;if(e.hasOwnProperty(Je.MIME_TYPE)&&(u=a.test(e.mimeType),c=!0),!c)for(r=0,i=e.Representation_asArray&&e.Representation_asArray.length?e.Representation_asArray.length:0;!c&&r<i;)(o=e.Representation_asArray[r]).hasOwnProperty(Je.MIME_TYPE)&&(u=a.test(o.mimeType),c=!0),r++;return u}function l(e){return c(e,n.AUDIO)}function d(e){return c(e,n.VIDEO)}function f(e){return c(e,n.FRAGMENTED_TEXT)}function p(e){re){return"text/vtt"===e||"application/ttml+xml"===e}function m(e){return e&&e.hasOwnProperty(Je.ROLE_ASARRAY)?e.Role_asArray:[]}function g(e){return m(e).filter((function(e){return e.value===Je.MAIN}))[0]}function v(e){return e&&void 0!==e.Representation_asArray&&null!==e.Representation_asArray&&e.Representation_asArray.sort((function(e,t){return e.bandwidth-t.bandwidth})),e}function _(e,t,r){var n,i=e&&e.Period_asArray&&u(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[],o=void 0,a=[];for(o=0,n=i.length;o<n;o++)c(i[o],r)&&a.push(v(i[o]));return a}function E(e){var t=!1;return e&ay.length-1];return!t.hasOwnProperty("r")||t.r>=0}function w(e,t){if(!e)throw new Error("Period cannot be null or undefined");var r=pi.DEFAULT_ID+"_"+t;return e.hasOwnProperty(Je.ID)&&e.id.length>0&&"__proto__"!==e.id&&(r=e.id),r}function A(e,t){var r=[],i=void 0;if(!e)return r;for(i=0;i<e.length;i++){var o=new yi;if(o.timescale=1,o.representation=t,!e[i].hasOwnProperty(n.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");o.schemeIdUri=e[i].schemeIdUri,e[i].hasOwnProperty(Je.TIMESCALE)&&(o.timescale=e[i].timescale),e[i].hasOwnProperty(Je.VALUE)&&(o.value=e[i].value),r.push(o)}return r}function R(e){var t=[],n=e.BaseURL_asArray||[e.baseUri],i=!1;return n.some((function(n){if(n){var o=new xr,a=n.__text||n;r.isRelative(a)&&(i=!0,e.baseUri&&(a=r.resolve(a,e.baseUri))),o.url=a;for(var s=[],u=1;n["backupUrl"+u];u++)s.push(n["backupUrl"+u]);return o.urls=[o.url].concat(s),n.hasOwnProperty(Je.SERVICE_LOCATION)&&n.serviceLocation.length?o.serviceLocation=n.serviceLocation:o.serviceLocation=a,n.hasOwnProperty(Je.DVB_PRIORITY)&&(o.dvb_priority=n[Je.DVB_PRIORITY]),n.hasOwnProperty(Je.DVB_WEIGHT)&&(o.dvb_weight=n[Je.DVB_WEIGHT]),n.hasOwnProperty(Je.AVAILABILITY_TIME_OFFSET)&&(o.availabilityTimeOffset=n[Je.AVAILABILITY_TIME_OFFSET]),n.hasOwnProperty(Je.AVAILABILITY_TIME_COMPLETE)&&(o.availabilityTimeComplete="false"!==n[Je.AVAILABILITY_TIME_COMPLETE]),t.push(o),i}})),t}return{getIsTypeOf:c,getIsAudio:l,getIsVideo:d,getIsText:function(e){return c(e,n.TEXT)},getIsMuxed:p,getIsTextTrack:y,getIsFragmentedText:f,getIsImage:h,getIsMain:g,getLanguageForAdaptation:function(e){var t="";return e&&e.hasOwnProperty(Je.LANG)&&(t=e.lang.replace(/[^A-Za-z0-9-]/g,"")),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty(Je.VIEWPOINT)?e.Viewpoint:null},getRolesForAdaptation:m,getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty(Je.ACCESSIBILITY_ASARRAY)?e.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty(Je.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]},getAdaptationForIndex:function(e,t,r){var n=t&&t.Period_asArray&&u(r)&&t.Period_asArray[r]?t.Period_asArray[r].AdaptationSet_asArray:null;return n&&u(e)?n[e]:null},getIndexForAdaptation:function(e,r,n){var i=r&&r.Period_asArray&&u(n)&&r.Period_asArray[n]?r.Period_asArray[n].AdaptationSet_asArray:[],o=i.length;if(e)for(var a=0;a<o;a++)if(br(t).getInstance().areEqual(i[a],e))return a;return-1},getAdaptationForId:function(e,t,r){var n,i=t&&t.Period_asArray&&u(r)&&t.Period_asArray[r]?t.Period_asArray[r].AdaptationSet_asArray:[],o=void 0;for(o=0,n=i.length;o<n;o++)if(i[o].hasOwnProperty(Je.ID)&&i[o].id===e)return i[o];return null},getAdaptationsForType:_,getAdaptationForType:function(e,t,r,n){var o=_(e,t,r);if(!o||0===o.length)return null;if(o.length>1&&n){var a=i.getCurrentTrackFor(r,n),u=s.getAllMediaInfoForType(n,r);if(a)for(var c=0,l=o.length;c<l;c++)if(i.isTracksEqual(a,u[c]))return o[c];for(var d=0,f=o.length;d<f;d++)if(g(o[d]))return o[d]}return o[0]},getCodec:function(e,t,r){if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){var n=u(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0],i=n.mimeType+';codecs="'+n.codecs+'"';return r&&void 0!==n.width&&(i+=';width="'+n.width+'.length>0?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty(Je.CENC_DEFAULT_KID)?e[Je.CENC_DEFAULT_KID]:null},getContentProtectionData:function(e){return e&&e.hasOwnProperty(Je.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:E,getIsDVB:function(e){return function(e,t){var r=!1;return e&&e.profiles&&e.profiles.length>0&&(r=-1!==e.profiles.indexOf("urn:dvb:dash:profile:dvb-dash:2014")),r}(e)},getDuration:function(e){return e&&e.hasOwnProperty(Je.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:Numh:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=NaN;return e&&e.hasOwnProperty(Je.MINIMUM_UPDATE_PERIOD)&&(r=e.minimumUpdatePeriodon_asArray.length?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length?v(e).Representation_asArray.map((function(e){return{id:e.id||"",bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanray.length>0&&u(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){var t=[],r=S(e),n=void 0,i=void 0;if(e&&e.period&&u(e.period.index)){var a=R(e.period.mpd.manifest);a&&(i=a[0])}if(r&&r.Representation_asArray)for(var s=0,c=r.Representation_asArray.length;s<c;++s){var l=r.Representation_asArray[s],d=new Xe;if(d.index=s,d.adaptation=e,l.hasOwnProperty(Je.ID)&&(d.id=l.id),l.hasOwnProperty(Je.CODECS)&&(d.codecs=l.codecs),l.hasOwnProperty(Je.CODEC_PRIVATE_DATA)&&(d.codecPrivateData=l.codecPrivateData),l.hasOwnProperty(Je.BANDWITH)&&(d.bandwidth=l.bandwidth),l.hasOwnProperty(Je.WIDTH)&&(d.width=l.width),l.hasOwnProperty(Je.HEIGHT)&&(d.height=l.height),l.hasOwnProperty(Je.SCAN_TYPE)&&(d.scanType=l.scanType),l.hasOwnProperty(Je.MAX_PLAYOUT_RATE)&&(d.maxPlayoutRate=l.maxPlayoutRate),l.hasOwnProperty(Je.SEGMENT_BASE)?(n=l.SegmentBase,d.segmentInfoType=Je.SEGMENT_BASE):l.hasOwnProperty(Je.SEGMENT_LIST)?(n=l.SegmentList).hasOwnProperty(Je.SEGMENT_TIMELINE)?(d.segmentInfoType=Je.SEGMENT_TIMELINE,d.useCalculatedLiveEdgeTime=T(n.SegmentTimeline)):(d.segmentInfoType=Je.SEGMENT_LIST,d.useCalculatedLiveEdgeTime=!0):l.hasOwnProperty(Je.SEGMENT_TEMPLATE)?((n=l.SegmentTemplate).hasOwnProperty(Je.SEGMENT_TIMELINE)?(d.segmentInfoType=Je.SEGMENT_TIMELINE,d.useCalculatedLiveEdgeTime=T(n.SegmentTimeline)):d.segmentInfoType=Je.SEGMENT_TEMPLATE,n.hasOwnProperty(Je.INITIALIZATION_MINUS)&&(d.initialization=n.initialization.split("$Bandwidth$").join(l.bandwidth).split("$RepresentationID$").join(l.id))):d.segmentInfoType=Je.BASE_URL,d.essentialProperties=b(l),n){if(n.hasOwnProperty(Je.INITIALIZATION)){var f=n.Initialization;f.hasOwnProperty(Je.SOURCE_URL)?d.initialization=f.sourceURL:f.hasOwnProperty(Je.RANGE)&&(d.range=f.range)}else l.hasOwnProperty(Je.MIME_TYPE)&&y(l.mimeType)&&(d.range=0);n.hasOwnProperty(Je.TIMESCALE)&&(d.timescale=n.timescale),n.hasOwnProperty(Je.DURATION)&&(d.segmentDuration=n.duration/d.timescale),n.hasOwnProperty(Je.MEDIA)&&(d.media=n.media),n.hasOwnProperty(Je.START_NUMBER)&&(d.startNumber=n.startNumber),n.hasOwnProperty(Je.INDEX_RANGE)&&(d.indexRange=n.indexRange),n.hasOwnProperty(Je.PRESENTATION_TIME_OFFSET)&&(d.presentationTimeOffset=n.presentationTimeOffset/d.timescale),n.hasOwnProperty(Je.AVAILABILITY_TIME_OFFSET)?d.availabilityTimeOffset=n.availabilityTimeOffset:i&&void 0!==i.availabilityTimeOffset&&(d.availabilityTimeOffset=i.availabilityTimeOffset),n.hasOwnProperty(Je.AVAILABILITY_TIME_COMPLETE)?d.availabilityTimeComplete="false"!==n.availabilityTimeComplete:i&&void 0!==i.availabilityTimeComplete&&(d.availabilityTimeComplete=i.availabilityTimeComplete)}d.MSETimeOffset=o.calcMSETimeOffset(d),d.path=[e.period.index,e.index,s],t.push(d)}return t},getAdaptationsForPeriod:function(e){var t=e&&u(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,r=[],i=void 0,o=void 0,a=void 0;if(t&&t.AdaptationSet_asArray)for(a=0;a<t.AdaptationSet_asArray.length;a++)o=t.AdaptationSet_asArray[a],i=new di,o.hasOwnProperty(Je.ID)&&(i.id=o.id),i.index=a,i.period=e,p(o)?i.type=n.MUXED:l(o)?i.type=n.AUDIO:d(o)?i.type=n.VIDEO:f(o)?i.type=n.FRAGMENTED_TEXT:h(o)?i.type=n.IMAGE:i.type=n.TEXT,r.push(i);return r},getRegularPeriods:function(e){
var t,r=!!e&&E(e.manifest),n=[],i=null,o=null,a=null,s=null,u=void 0;for(u=0,t=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;u<t;u++)(o=e.manifest.Period_asArray[u]).hasOwnProperty(Je.START)?(s=new pi).start=o.start:null!==i&&o.hasOwnProperty(Je.DURATION)&&null!==a?((s=new pi).start=parseFloat((a.start+a.duration).toFixed(5)),s.duration=o.duration):0!==u||r||((s=new pi).start=0),null!==a&&isNaN(a.duration)&&(a.duration=parseFloat((s.start-a.start).toFixed(5))),null!==s&&(s.id=w(o,u)),null!==s&&o.hasOwnProperty(Je.DURATION)&&(s.duration=o.duration),null!==s&&(s.index=u,s.mpd=e,n.push(s),i=o,a=s),o=null,s=null;return 0===n.length||null!==a&&isNaN(a.duration)&&(a.duration=parseFloat((function(e){var t=E(e.mpd.manifest),r=void 0;if(e.mpd.manifest.mediaPresentationDuration)r=e.mpd.manifest.mediaPresentationDuration;else if(e.duration)r=e.duration;else{if(!t)throw new Error("Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.");r=Number.POSITIVE_INFINITY}return r}(a)-a.start).toFixed(5))),n},getMpd:function(e){var t=new hi;return e&&(t.manifest=e,e.hasOwnProperty(Je.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):t.availabilityStartTime=new Date(e.loadedTime.getTime()),e.hasOwnProperty(Je.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(Je.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(Je.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(n.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(Je.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(Je.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration)),t},getEventsForPeriod:function(e){var t=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,r=t?t.Period_asArray:null,i=r&&e&&u(e.index)?r[e.index].EventStream_asArray:null,o=[],a=void 0,s=void 0;if(i)for(a=0;a<i.length;a++){var c=new yi;if(c.period=e,c.timescale=1,!i[a].hasOwnProperty(n.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(c.schemeIdUri=i[a].schemeIdUri,i[a].hasOwnProperty(Je.TIMESCALE)&&(c.timescale=i[a].timescale),i[a].hasOwnProperty(Je.VALUE)&&(c.value=i[a].value),s=0;s<i[a].Event_asArray.length;s++){var l=new ai;l.presentationTime=0,l.eventStream=c,i[a].Event_asArray[s].hasOwnProperty(Je.PRESENTATION_TIME)&&(l.presentationTime=i[a].Event_asArray[s].presentationTime),i[a].Event_asArray[s].hasOwnProperty(Je.DURATION)&&(l.duration=i[a].Event_asArray[s].duration),i[a].Event_asArray[s].hasOwnProperty(Je.ID)&&(l.id=i[a].Event_asArray[s].id).index])&&(r=i.InbandEventStreamy[t.index])&&(r=o.InbandEventStream_asArray),A(r,t)},getUTCTimingSources:function(e){var t=E(e),r=!!e&&e.hasOwnProperty(Je.AVAILABILITY_START_TIME),i=e?e.UTCTiming_asArray:null,o=[];return(t||r)&&i&&i.forEach((function(e){var t=new a;e.hasOwnProperty(n.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(Je.VALUE)&&(t.value=e.value.toString(),o.push(t)))})),o},geeturn function(e,t){return e.bandwidth-t.bandwidth}},getLocation:function(e){if(e&&e.hasOwnProperty(n.LOCATION))return e.Location=e.Location_asArray[0],e.Location},getUseCalculatedLiveEdgeTimeForAdaptation:function(e){var t=S(e).Representation_asArray[0],r=void 0;return t.hasOwnProperty(Je.SEGMENT_LIST)?!(r=t.SegmentList).hasOwnProperty(Je.SEGMENT_TIMELINE)||T(r.SegmentTimeline):!(!t.hasOwnProperty(Je.SEGMENT_TEMPLATE)||!(r=t.SegmentTemplate).hasOwnProperty(Je.SEGMENT_TIMELINE))&&T(r.SegmentTimeline)}}}mi.__dashjs_factory_name="DashManifestModel";var gi=s.a.getSingletonFactory(mi),vi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot caplit("e"))[0]+"e"+(t[1]?+t[1]+r:r))))}("round",e,t)},e}();function _i(e)ifestModel;function n(e){return s(e,i.BUFFER_LEVEL)}function o(e){if(!e)return null;var t=e.HttpList,r=null,n=void 0;if(!t||t.length<=0)return null;for(n=t.length-1;n>s+=1)if(t===(i=o[s]).id)return r?s:i;return null}function l(e,r){return t.getIsTypeOf(e,r)}return{getBandwidthForRepresentation:function(e,t){var n;return null===(n=c(r.getValue().Period_asArray[t],e))?null:n.bandw function(e,t){var r=c(e,t,!0);return null!==r?r:-1}(r.getValue().Period_asArray[t],e)},getMaxIndexForBufferType:function(e,t){var n=r.getValue();return n?function(e,t){var r,n=void 0,i=void 0,o=void 0;if(!e||!t)return-1;for(r=e.AdaptationSet_asArray,o=0;o<r.length;o+=1)if(i=(n=r[o]).Representation_asArray,l(n,t))return i.length;return-1}(n.Period_asArray[t],e):-1},getCurrentRepresentationSwitch:function(e){return s(e,i.TRACK_SWITCH)},getLatestBufferLevelVO:n,getCurrentBufferLevel:function(e){var t=n(e);return t?vi.round10(t.level/1e3,-3):0},getCurrentHttpRequest:o,getHttpRequests:a,getCurrentDroppedFrames:function(e){return s(e,i.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return s(e,i.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return s(e,i.DVR_INFO)},getCurrentManifestUpdate:function(e){return s(e,i.MANIF&&(r=u(n._responseHeaders)),void 0===r[t]?null:r[t]},getLatestMPDRequestHeaderValueByID:function(e,t){var r,n={},i=void 0,o=void 0;for(o=(r=a(e)).length-1;o>=0;o--)if((i=r[o]).type===F.MPD_TYPE){n=u(i._responseHeaders);brestsQueue:function(e){return e?e.RequestsQueue:null}}}_i.__dashjs_factory_name="DashMetrics";var Ei=s.a.getSingletonFactory(_i);function bi(){var e=this.context,t=d(e).getIns(e.offset/1e3),n=!0)}function c(){r=0,n=!1,i=NaN}return{initialize:function(){c(),t.on(p.TIME_SYNCHRONIZATION_COMPLETED,u,this)},isTimeSyncCompleted:function(){return n},setTimeSyncCompleted:function(e){n=e},getClientTimeOffset:function(){return r},setClientTimeOffset:o,getExpectedLiveEdge:function(){return i},setExpectedLiveEdge:function(etionTime:function(e,t,r){
return a.call(thisonTime:function(e,t,r){return a.call(this,e,t,r,!0)},calcPresentationt.adaptation.period.start-t.presentationTime:function(e,t){return t-e.adapta-t.adaptation.period.start+t.presentationTimeOffset},calcSegmentAvailabilityRange:function(e,t){var r=e.adaptation.period,i={start:r.start,end:r.start+r.duration};if(!t)return i;if(!n&&e.segmentAvailabilityRange)return e.segmentAvailabilityRange;var o=e.segmentDuration||(e.segments&&e.segments.length?e.segments[e.segments.length-1].duration:0),a=s(new Date,r),u=r.start+r.duration;i.start=Math.max(a-r.mpd.timeShiftBufferDepth,r.start);var c=void 0!==e.availabilityTimeOffset&&e.availabilityTimeOffset<o?o-e.availabilityTimeOffset:o;retuew Date(e.availabilityStartTime.getTime()+1e3*n)),i},calcMSETimeOffset:function(e){var t=e.presentationTimeOffset;return e.adaptation.period.start-t},reset:function(){t.off(p.TIME_SYNCHRONIZATION_COMPLETED,u,this),c()}}}bi.__dashjs_factory_name="TimelineConverter";var Si=s.a.getSingletonFactory(bi),Ti=r(8),wi=r.n(Ti);function Ai(){var e,t="You must first call initialize() and set a source before calling this method",r="You must first call initialize() and set a valid source and view before calling this method",u="You must first call attachView() to set the video element before calling this method",c="You must first call attachSource() with a valid source before calling this method",l="MediaPlayer not initialized!",f=this.context,h=d(f).getInstance(),y=g(f).getInstance(),m=y.log,v=NaN,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,O=void 0,I=void 0,C=void 0,N=void 0,k=void 0,L=void 0,x=void 0,M=void 0,U=void 0,B=void 0,j=void 0,V=void 0,H=void 0,G=void 0,q=void 0,W=void 0,K=void 0,Y=void 0,Q=void 0,z=void 0,Z=void 0,J=void 0,X=void 0,$=void 0,ee={video:{},audio:{}},te={min:0,video:0,audio:0},re=null,ne={};function ie(){if(te.min&&U&&U.getDuration()>te.min&&Math.abs(U.getDuration()-te.min)>=1&&M)try{var e=+("0."+((te.min+"").split(".")[1]||0)),t=e<.1?0:e>=.1?.1:+(e-.03).toFixed(2);t&&t>0&&!isNaN(t)&&(M.setMediaDuration(te.min-t),M.setAppendWin)}function ue(){if(!T)throw r;return U.isPaused()}function ce(e){var t=[n.VIDEO,n.AUDIO,n.FRAGMENTED_TEXT];if(e)return-1!==t.indexOf(e)?_e().getCurrentBufferLevel(Ee(e))||NaN:(m("Warning  - getBufferL?_e().getCurrentBufferLevel(Ee(e)):Number.MAX_VALUE})).reduce((function(e,t){return Math.min(e,t)}));return r===Number.MAX_VALUE?NaN:r}function le(e){var t=De(),r=U.getLiveDelay();if(!t)return 0;var n=t.range.start+e;return n>t.range.end-r&&(n=t.range.end-r),n}function de(e,t){if(!T)throw r;var n=be().currentTime;if(void 0!==e)n=M.getTimeRelativeToStreamId(n,e);else if(U.getIsDynamic()){var i=De();n=null===i?0:fe()-(i.range.end-i.time)}var o=k.getCachedDurationOffset("time");return t&&n-o>0&&(n-=o,n=Math.min(n,fe(void 0))),parseFloat(n.toFixed(5))}function fe(e){if(!T)throw r;var t=be().duration;if(U.getIsDynamic()){var n,i=De();if(!i)return 0;t=(n=i.range.end-i.range.start)<i.manifestInfo.DVRWindowSize?n:i.manifestInfo.DVRWindowSize}if(e){var o=be().currentTime,a=k.getCachedDurationOffset("time"),s=k.getCachedDurationOffset("offset");a?o>a&&(t=o<s?s-a:t-s):t=s?Math.min(t,s):t,t=parseFloat(t.toFixed(5))}return t}function he(e){w=e}function ye(e,t){me(e,t);var r=new a;r.schi){n.schemeIdUri===e&&n.value===t&&r.splice(i,1)}))}function ge(){ye(pr.DEFAULT_UTC_TIMING_SOURCE.scheme,pr.DEFAULT_UTC_TIMING_SOURCE.value)}function _e(){retur(){if(!H.getElement())throw u;return H.getElement()}function Se(e){if(!b)throw l;H.setElement(e),e&&(Pe(),function(){if(!O){var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(f).create();O=t.createMetricsReporting({log:m,eventBus:h,mediaElement:be(),dashManifestModel:j,metricsModel:N,events:p,constants:n,metricsConstants:i})}}}(),function(){if(!I){var e=dashjs.MssHandler;"function"==typeof e&&(I=e(f).create({eventBus:h,mediaPlayerModel:k,metricsModel:N,playbackController:U,protectionController:D,errHandler:L,events:p,constants:n,log:m,initSegmentType:F.INIT_SEGMENT_TYPE,BASE64:wi.a,ISOBoxer:vtActiveStreamInfo();return r?P.getTracksFor(e,r):[]}function we(e){if(!b)throw l;"string"==typeof e&&Fe(f).getInstance().initialize(e),ee.video={},ee.audio={},_=e,(S||T)&&Ae(),ae()&&Ce()}function Ae(){T=!1,S=!1,C.reset(),M.reset(),U.reset(),A.reset(),P.reset(),D&&(D.reset(),D=null,Pe())}function Re(){return An(f).create({errHandler:L,videoModel:H,metricsModel:N,mediaPlayerModel:k,requestModifier:Et(f).getInstance(),mssHandler:I})}function Pe(){if(D)return D;var e=dashjs.Protection;if("function"==typeof e){var t=e(f).create();return p.extend(e.events),hr.extend(e.events,{publicOnly:!0}),x||(x=Pn(f).getInstance()),D=t.createProtectionSystem({log:m,errHandler:L,videoModel:H,capabilities:x,eventBus:h,events:p,BASE64:wi.a,constants:n,ignoreEmeEncryptedEvent:$})}return null}function De(){var e=N.getReadOnlyMetricsFor(n.VIDEO)||N.getReadOveStreamInfo();return e?M.getStreamById(e.id):null}function Ce(){var e;!S&&_&&(S=!0,m("Streaming Initialized"),e=Re(),M||(M=Vr(f).getInstance()),P.setConfig({errHandler:L,domStorage:G}),M.setConfig({capabilities:x,manifestLoader:e,manifestModel:V,dashManifestModel:j,mediaPlayerModel:k,protectionController:D,adapter:C,metricsModel:N,dashMetrics:B,errHandler:L,timelineConverter:R,videoModel:H,playbackController:U,domStorage:G,abrController:A,mediaController:P}),U.setConfig({streamController:M,metricsModel:N,dashMetrics:B,manifestModel:V,mediaPlayerModel:k,dashManifestModel:j,adapter:C,videoModel:H}),A.setConfig({streamController:M,domStorage:G,mediaPlayerModel:k,metricsModel:N,dashMetrics:B,dashManifestModel:j,manifestModel:V,videoModel:H,adapter:C,initializeDate:Me()}),A.createAbrRulesCollection(),M.initialize(w,E),_.video||_.audio||"string"==typeof _?M.load(_,q):M.loadWithManifest(_,q)),!T&&ae()&&(T=!0,m("Playback Initialized"))}function Ne(e){var t=k.getCachedDurationOffset("offset");t&&e.time>=t&&Z&&(k.setCachedDurationOffset("time",t),Z=!1,H.setDataOffsetAttr(t),h.trigger(p.APPENDED_NEXT_SOURCE_DURATION_CHANGED,{offset:t,totalTime:e.time,totalDuration:fe(),time:de(void 0,!0),duration:te.min||fe(!0)}))}function ke(e){try{if(e&&e.mediaType&&e.segments){var t=e.mediaType,r=ee[t],n=e.segments,i=e.representation&&e.representation.index,o=!0,a=[],s={},u=0,c=0;if(r.total&&r.total===n.length&&(r.segments.forEach((function(e,t){e.duration&&e.duration!==n[t].duration&&t<r.total-1&&Math.ceil(1e3*Math.abs(e.duration/e.timescale-n[t].duration/n[t].timescale))>100&&a.push(t)})),a.length)){o=!1,s={old:r.qualityIndex,new:i};var l=H.getTime(),d=Math.floor(l/5);-1===a.indexOf(d)&&-1===a.indexOf(d+1)&&-1===a.indexOf(d+2)&&(o=!0)}var f=0,p=e.segments&&e.segments[e.segments.length-1];p&&(f=(p.duration+p.startTime)/p.timescale,te[t]=f,(!te.min||te.min>0&&te.min>f)&&(te.min=f));var h=0;n&&n.length&&(h=n[0].startTime/n[0].timescale,P.setStartOffsetTimeForType(t,h),u=parseInt(n[0].mediaRange.split("-")[0],10),c=parseInt(n[n.length-1].mediaRange.split("-")[1],10),J=Math.max(J,h)),
te.min===f&&k.getCachedDurationOffset("duration")&&h>0&&(te.min-=h),k.setCachedDurationOffset("duration",te.min+K);var y={total:n&&n.length,segments:n,isDurationAllEqual:o,qualityIndex:i,realDuration:f,startOffsetTime:h,rangeStart:u,rangeEnd:c};o||(y.notEqualIndexList=a,y.notEqualQualityIndex=s),ee[e.mediaType]=y,"function"==typeof re&&re(t,y)}}catch(e){throw new Error("Parse segment loaded error, "+e)}}function Le(){Y=!0;var e=H.getBufferRange(),t=H.getElement().duration,r=e&&e.length&&e.end(e.length-1),n=H.getTie("audio")],o=i.filter((function(e){return!isNaN(e)})),a=o.reduce((function(e,t){return e+t}))/o.length,s=Math.min.apply(null,o);if(m("onStreamBufferingCompleted",K,i,k.getAppendingSourceState(),Q),Math.abs(s-a)<1&&(K=parseFloat(s.toFixed(5)),Q.length)){var u=Q.splice(0,1)[0];m("Appending delay next source",u),Ue(u.manifest,u.preloadData)}}function xe(e){if(U.getEnded()&&k.getAppendingSourceState()){var t=e.sender.getType();if(ne[t]=e.bufferLevel,ne.audio>0&&ne.video>0){var r=H.getBufferRange(),n=r&&r.length&&r.end(r.length-1),i=U.getTime();n>i+.01&&(console.log("Playing next appending source after prev playback ended.",ne),U.seek(i+.01),U.play())}}if(k.getAppendingSourceState()&&z){for(var o=k.getCachedDurationOffset("offset"),a=H.getBufferRange(),s=U.getTime(),u=0,c=0;c<a.length;c++)a.start(c)<s&&a.end(c)>=s&&(u=a.end(c));o>0&&u>o+1&&(k.setAppendingSourceState(!1),m("Appended Next Source, currentTime: "+s+" , buffered end: "+u),z=!1,h.trigger(p.APPENDED_NEXT_SOURCE,{time:s,ended:u}))}if(!X){var l=H.getBufferRange(),d=U.getTime(),f=l&&l.length&&l.start(0);l&&l.length&&f>=J&&(X=!0,d<f&&h.trigger(p.START_OFFSET_TIME_WARNING,{time:f}))}}function Me(){return v}function Ue(e,t){if(m("Append Next Source",H.getTime(),H.isSeeking()),!b)throw l;if("string"==typeof e&&Fe(f).getInstance().initialize(e),H.isSeeking())h.on(p.PLAYBACK_SEEKED,(function t(){m("Seeked to append next source"),h.off(p.PLAYBACK_SEEKED,t),Ue(e)}));else{if(!Y)return m("Stream buffering is not completed, delay to append!"),void(Q=[{manifest:e,preloadData:t}]);k.setAppendingSourceState(!0),k.setCachedDurationOffset("offset",K),h.trigger(p.APPENDING_NEXT_SOURCE,{manifest:e,time:U.getTime(),offset:K}),z=!0,Z=!0,Y=!1,ee.video={},ee.audio={},_=e,te.min=0,te.video=0,te.audio=0,M.load(e,!0,!0)}}return e={initialize:function(e,t,r,n,i,o,a,s){var u;k.setExternalMediaLoader(o),k.setEnableMultipleAudioTracks(s),q=!!n,v=new Date,$=a,delete window.__DASH_P2P_TYPE__,x||(x=Pn(f).getInstance()),L=Ct(f).getInstance(),x.supportsMediaSource()?b||(b=!0,R=Si(f).getInstance(),A||(A=oe(f).getInstance()),U||(U=Be(f).getInstance()),P||(P=pe(f).getInstance()),C=li(f).getInstance(),j=gi(f).getInstance({mediaController:P,timelineConverter:R,adapter:C}),V=On(f).getInstance(),B=Ei(f).getInstance({manifestModel:V,dashManifestModel:j}),N=qn(f).getInstance(),G=ei(f).getInstance({mediaPlayerModel:k}),C.setConfig({dashManifestModel:j,mediaPlayerModel:k}),N.setConfig({adapter:C}),ge(),he(void 0===r||r),e&&Se(e),t&&we(t),o&&(u=o,h.trigger(p.BIND_MEDIA_SOURCE_LOADER,{loader:u})),h.trigger(p.INIT_HID,{hid:i}),m("[dash.js "+se()+"] MediaPlayer has been initiantroller),e.mediaController&&(P=e.mediaController))},on:function(e,t,r){h(e,t,r)},extend:function(e,t,r){s.a.extend(e,t,r,(){if(H.getElement()||S)return!1;if(!_)throw c;Ce()},play:function(){if(!T)throwsPaused:ue,pause:function(){if(!T)throw r;U.pause()},isSeeking:function(){if(!T)throw r;return U.isSeeking()},isDynamic:function(){if(!T)throw r;return U.getIsDynamic()},seek:function(e,t){if(!T)throw r;if("number"!=typeof e||isNaN(e))throw"MediaPlayer Invalid Arguments!";var n=U.getIsDynamic()?le(e):e;t&&(n+=k.getCachedDurationOffset("time")),U.seek(n)},setPlaybackRate:function(e){if(!H.getElement())throw u;be().playbackRate=e},getPlaybackRate:function(){if(!H.getElement())throw u;return be().playbackRate},setMute:function(e){if(!H.getElement())throw u;be().muted=e},isMuted:function(){if(!H.getElement())throw u;return be().muted},setVolume:function(e){if(!H.getElement())throw u;be().volume=e},getVolume:function(){if(!H.getElement())throwfunction(){if(ationAsUTC:function(){if(!T)throw r;{var e=De();return e?e.manifestInfo.DVoString())toLocaleTimeString(t,{hour12:r});return n?a+" "+o:a},getVersion:se,getDebug:function(){return y},getBufferLength:ce,getVideoContainer:function(){return H?H.getVideoContainer():null},getTTMLRenderingDiv:function(){return H?H.getTment:be,getSource:function(){if(!_)throw c;return _},setLiveDelayFragmentCount:function(e){k.setLiveDelayFragmentCount(e)},setLiveDelay:function(e){k.setLiveDelay(e)},getLiveDelay:functf(!b)throw l;return T?U.getCurrentLiveLatency():NaN},useSuggestedPresentationDelay:function(e){k.setUseSuggestedPresentationDelay(e)},enableLastBitrateCaching:function(e,t){k.setLastBitrateCachingInfo(e,t)},enableLastMediaSettingsCaching:function(e,t){k.setLastMediaSettingsCachingInfo(e,t)},setMaxAllowedBitrateFor:function(e,t){A.setMaxAllowedBitrateFor(e,t)},getMaxAllowedBitrateFor:function(e){return A.getMaxAllowedBitrateFor(e)},getTopBitrateInfoFor:function(e){if(!S)throw t;return A.getTopBitrateInfoFor(e)},setMinAllowedBitrateFor:function(e,t){A.setMinAllowedBitrateFor(e,t)},getMinAllowedBitrateFor:function(e){return A.getMinAllowedBitrateFor(e)},setMaxAllowedRepresentationRatioFor:function(e,t){A.setMaxAllowedRepresentationRatioFor(e,t)},getMaxAllowedRepresentationRatioFor:function(e){return A.getMaxAllowedRepresentationRatioFor(e)},setAutoPlay:he,getAutoPlay:function(){return w},setScheduleWhilePaused:function(e){k.setScheduleWhilePaused(e)},getScheduleWhilePaused:function(){return k.getScheduleWhilePaused()},getDashMetrics:_e,getMetricsFor:Ee,getQualityFor:function(e){if(!S)throw t;return A.getQualityFor(e,M.getActiveStreamInfo())},setQualityFor:function(e,r){if(!S)throw t;A.setPlaybackQuA.setElementSize(),A.setWindowResizeEventCalled(!0)},getLimitBitrateByPortal:function(){return A.getLimitBitrateByPortal()},setLimitBitrateByPortal:function(e){A.setLimitBitrateByPortal(e)},getUsePixelRatioInLimitBitrateByPortal:function(){return A.getUsePixelRatioInLimitBitrateByPortal()},setUsePixelRatioInLimitBitrateByPortal:function(e){A.setUsePixelRrow t;var r=Ie();return r?r.getBitrateListFor(e):[]},setInitialBitrateFor:function(e,t){A.setInitialBitrateFor(e,t)},getInitialBitrateFor:function(e){if(!S)throw t;return A.getInitialBitrateFor(e)},setInitialRepresentationRatioFor:function(e,t){A.setInitialRepresentationRatioFor(e,t)},getInitialRepresentationRatioFor:function(e){return A.getInitialRepresentationRatioFor(e)},getStreamsFromManifest:function(e){if(!S)throw t;return C.getStreamsIamsInfo(r,1)[0])?C.getAllMediaInfoForType(n,e,r):[]},getCurrentTrackFor:function(e){if(!S)throw t;var r=M.getActiveStreamInfo();return r?P.getCurrentTrackFor(e,r):null},setInitialMediaSettingsFor:function(e,t){if(!b)throw l
;P.setInitialSettings(e,t)},getInitialMediaSettingsFor:function(e){if(!b)throw l;return P.getInitialSettings(e)},setCurrentTrack:function(efunction(e){if(!b)throor:function(e,t){if(!b)throw l;P{if(!b)throw l;P.setSelectionMod)throw l;return P.getSelectionModeForInitialTrack()},setFastSwitchEnabled:function(e){k.setFastSwitchEnabled(e)},getFastSwitchEnabled:function(){return k.getFastSwitchEnabled()},setMovingAverageMethod:function(e){e===n.MOVING_AVERAGE_SLIDING_WINDOW||e===n.MOVING_AVERAGE_EWMA?k.setMovingAverageMethod(e):m("Warning: Ignoring setMovingAverageMethod("+e+") - unknown value.")},getMovingAverageMethod:function(){return k.getMovingAverageMethod()},getAutoSwitchQualityFor:function(e){return A.getAutoSwitchBitrateFor(e)},setAutoSwitchQualityFor:function(e,t){A.setAutoSwitchBitrateFor(e,t)},setABRStrategy:function(e){e===n.ABR_STRATEGY_DYNAMIC||e===n.ABR_STRATEGY_BOLA||e===n.ABR_STRATEGY_THROUGHPUT?k.setABRStrategy(e):m("Warning: Ignoring setABRStrategy("+e+") - unknown value.")},getABRStrategy:function(){return k.getABRStrategy()},useDefaultABRRules:funcustomRule:function(e,t,r){k.addABRCustomRule(e,t,r)},removeABRCustomRule:function(e){k.removeABRCustomRule(e)},removeAllABRCustomRule:function(){k.removeAllABRCustomRule()},setBandwidthSafetyFactor:function(e){k.setBandwidthSafetyFactor(e)},getBandwidthSafetyFactor:function(){returghputHistory();return t?t.getAverageThroughput(e):0},setAbandonLoadTimeout:function(e){k.setAbandonLoadTimeout(e)},retrieveManifest:function(e,t){var r=Re(),n=this;h.on(p.INTERNAL_MANIFEST_LOADED,(function e(i){i.error?t(null,i.error):t(i.manifest),h.off(p.INTERNAL_MANIFEST_LOADED,e,n),r.reset()}),n),Fe(f).getInstance().initialize(e),r.load(e,q)},addUTCTimingSource:ye,rCTimingSources:function(){k.setUTCTimingSources([])},restoreDefaultUTCTimingSources:ge,setBufferToKeep:function(e){k.setBufferToKeep(e)},setBufferAheadToKeep:function(e){k.setBufferAheadToKeep(e)},setBufferPruningInterval:function(e){k.setBufferPruningInterval(e)},setStableBufferTime:function(e){k.setStableBufferTime(e)},getStableBufferTime:function(){return k.getStableBufferTime()},setBufferTimeAtTopQuality:function(e){k.setBufferTimeAtTopQuality(e)},getBufferTimeAtTopQuality:function(){return k.getBufferTimeAtTopQuality()},setBufferTimeAtTopQualityLongForm:function(e){k.setBufferTimeAtTopQualityLongForm(e)},getBufferTimeAtTopQualityLongForm:function(){return k.getBufferTimeAtTopQualityLongForm()},setFragmentLoaderRetryAttempts:function(e){k.setFragmentRetryAttempts(e)},setFragmentLoaderRetryInterval:function(e){k.setFragmentRetryInterval(e)},setManifestLoaderRetryAttempts:function(e){k.setManifestRetryAttempts(e)},setManifestLoaderRetryInterval:function(e){k.setManifestRetryInterval(e)},setXHRWithCredentialsForType:function(e,t){k.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return k.getXHRWithCredentialsForType(e)},setJumpGaps:function(e){k.setJumpGaps(e)},getJumpGaps:function(){return k.getJumpGaps()},setSmallGapLimit:function(e){k.setSmallGapLimit(e)},getSmallGapLimit:function(){return k.getSmallGapLimit()},getLowLatencyEnabled:function(){return k.getLowLatencyEnabled()},setLowLatencyEnabled:function(e){return k.setLowLatencyEnabled(e)},setPreloadData:function(e){return k.setPreloadData(e)},setManifestUpdateRetryInterval:function(e){k.setManifestUpdateRetryInterval(e)},getManifestUpdateRetryInterval:function(){return k.getManifestUpdateRetryInterval()},setLongFormContentDurationThreshold:function(e){k.setLongFormContentDurationThreshold(e)},setSegmentOverlapToleranceTime:function(e){k.setSegmentOverlapToleranceTime(e)},setCacheLoadThresholdForType:function(e,t){k.setCacheLoadThresholdForType(e,t)},getProtectionController:function(){return Pe()},attachProctionData:function(e){E=e,M&&M.setProtectionData(E)},enableManifestDateHeaderTimeSource:function(e){k.setUseManifestDateHeaderTimeSource(e)},attachVideoContainer:function(e){if(!H.getElement())thif(!H.getElement())throw u;H.setTTMLRenderingDiv(e)},getUseDeadTimeLatencyForAbr:function(){return A.getUseDeadTimeLatency()},setUseDeadTimeLatencyForAbr:function(e){A.setUseDeadTimeLatency(e)},getThumbnail:function(e){if(e<0)return null;var t=U.getIsDynamic()?le(e):e,r=M.getStreamForTime(t);if(null===r)return null;var n=r.getThumbnailController(),i=r.getStreamInfo();if(!n||!i)return null;var o=M.getTimeRelativeToStreamId(t,r.getId());return n.get(o)},setDefaultQualityFor:function(e,t){A||(A=oe(f).getInstance()),A.setDefaultQualityFor(e,t)},getDefaultQualityFor:function(e){return A.getDefaultQualityFor(e)},getDroppedFramesInfo:function(){return A.getDroppedFramesInfo()},getCurrentSegmentInfoFor:function(e){return A.getCurrentSegmentInfoFor(e)},onInitSegmentsLoaded:function(e){re=e},getThroughputDict:function(e){var t=A.getThroughputHistory();return t?t.getDict(e):{}},getInitializeDate:Me,updateSource:function(e){if(!b)throw l;"string"==typeof e&&Fe(f).getInstance().initialize(e),ee.video={},ee.audio={},_=e,M.load(_,q)},switchSource:function(e){if(!b)throw l;"string"==typeof e&&Fe(f).getInstance().initialize(e),ee.video={},ee.audio={},te.min=0,te.video=0,te.audio=0,_=e,K=0,H.setDataOffsetAttr(0),k.setCachedDurationOffset("offset",0),k.setCachedDurationOffset("time",0),k.setCachedDurationOffset("duration",0),k.setAppendingSourceState(!1),k.resetStartAndSeekTime(),Z=!1,Q=[],(S||T)&&Ae(),ae()&&Ce()},appendSource:Ue,setEndOfStreamState:functtP2pPermission:function(e){e||k.addBufferingCount()},setP2pType:function(e,t){var r,n=!1;switch(e){case"yf-eg":case"yf-cg2":window.YFDashIO&&(n=!0);break;case"xl-eg":case"xl-cg2":window.xyvp&&(n=!0);break;case"ks-eg":case"ks-cg2":window.KSLoader&&(n=!0);break;case"bili-eg":case"bili-cg2":window.DIYSdk&&(n=!0);break;case"pear-eg":case"pear-cg2":window.PearDownloader&&(n=!0)}n?window.__DASH_P2P_TYPE__=e:t?(r=t,new Promise((function(e,t){varrc=r,n.onload=function(){window.clearTimeout(W),e()},n.onerror=function(){window.clearTimeout(W),t(),h.trigger(p.PCDN_LOADED_ERROR,{code:o.DOWNLOAD_PCDN_SCRIPT_ERROR,url:r})},document.body.appendChild(n),W=window.setTimeout((function(){t(),h.trigger(p.PCDN_LOADED_ERROR,{code:o.DOWNLOAD_PCDN_SCRIPT_TIMEOUT,url:r})}),2e3)}))).then((function(){window.__DASH_P2P_TYPE__=ection(){console.warn("load p2p sdk scripts failed")})):console.warn("lack p2p sdk scriptsetUseNC(e)},setUseP2P:function(e){k&&k.setUseP2P(e)},switchAudioTrack:function(e){return k.getAudioTrackIds().find((function(t){return t.id===e}))?(k.setAudioTrackId(e),h.trigger(p.SWITCH_AUDIO_TRACK_REQUEST,{id:e}),0):-1},getCurrentAudioTrackId:function(){return k.getAudioTrackId()},getAudioTrackList:function(){return k.getAudioTrackIds()},getRetryTimes:function(){return k.getRetryTimes()},getSpaceUtilLastSeekInSec:function(){return((new Date).getTime()-k.getLastStartSeekTime())/1e3},reset:function(){we(null),Se(null),E=null,z=!1,Z=!1,K=0,Q=[],D&&(D.reset(),D=null),O&&(O.reset(),O=null),U&&(U.reset(),U=null),h.reset(),s.a.reset()},setQualityMap:function(e){}},function(){b=!1,T=!1,S=!1,w=!0,D=null,E=null,C=null,p.extend(hr),k=pr(f).getInstance(),H=Kn(f).getInstance(),K=0,Y=!1,Q=[],ne={video:0,audio:0},J=0,h.on(p.SEGMENTS_LOADED,ke,e),h.on(p.BUFFER_LEVEL_UPDATED,xe,e),h.on(p.PLAYBACK_ENDED,Le,this),h.on(p.STREAM_BUFFERING_COMPLETED,Le,this),h.on(p.PLAYBACK_TIME_UPDATED,Ne,this),h.on(p.PLAYBACK_METADATA_LOADED,ie,this)}(),e}Ai.__dashjs_factory_name="MediaPlayer";var Ri=s.a.getClassFactory(Ai);Ri.events=hr,s.a.updateClassFactory(Ai.__dashjs_facto>1)),t.push(String.fromCharCode(n))}return t.join("")},f={};n="ABCDEFGHIJKLMNOr.push(n.charAt(63&o>>12)),r.push("==")),r.join("")},o=function(){for(var e=[],t=0;t<64;++t)e[n.c2)?(r.pop(r=0;r<e+t)a[t]=String.ray=function(ecodeASCII=funccodeASCII=function(e){var t=u(e);return c.decode(t)},fn i(t)},f.decode=function(e){var t=u(e);return d(t)},t.decode=f.decode,t.decodeArray=f.decodeArray,t.encode=f.encode,t.encodeASCII=f.encodeASCII},function(e,t,r){"use strict";(function(e){var n=r(7);r.d(t,"a",(function(){return n.a}));var i=r(0),o=r(5),a="undefined"!=typeof window&&window||e,s=a.dashjs;s||(s=a.dashjs={}),s.MediaPlayer=n.a,s.FactoryMaker=i.a,s.Version=Object(o.a)()}).call(this,r(17))},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,argu]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[defineProperty(e,"default",{enumerable:!0,value:t})}:fu.hasOwnProperty.call(e,r)&&i(ts[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=r(18),d=r(11),f=u(r(4)),p=r(2),h=u(r(19)),y=a(r(13)),m=u(r(20)),g=r(12),v=r(6),_=u(r(21)),E=u(r(22)),b=function(){function e(e,t){if(this.config={scriptSrc:"https://static.hdslb.com/player/js/dash.mediaplayer.min.js",scriptMaxLoadTime:1e4,minQualityNumberMappingNumber:6,videoInfoScheduleTime:1e3},(null==t?void 0:t.hid)&&"string"==typeof t.hid&&(this.config.hid=t.hid),(null==t?void 0:t.mediaSourceLoader)&&"function"==typeof t.mediaSourceLoader&&(this.externalMediaLoader=t.mediaSourceLoader),this.state={defaultVideoQuality:0,defaultAudioQuality:0,setTheDefaultVideoQualityState:!1,stableBufferTime:60,isAutoPlay:!1,abrStrategy:p.STRING.ABR_THROUGHPUT,isAutoSwitch:{video:!1,audio:!1},autoSwitchTopQualityMap:{video:-1,audio:-1},onScriptLoading:!1,initialized:!1,mpd:null,manifest:null,manifestInfo:{},currentQualityIndex:{video:0,audio:0},maxQualityIndex:{video:-1,audio:-1},qualityNumberMap:{video:{},audio:{}},segmentsInfoMap:{video:{},audio:{}},mediaInfo:{},statisticsInfo:{},autoSwitchStartTime:0,preloadData:null,startOffsetTime:0,enforceSSLStream:!1,latestPlayurlExpireTimeStamp:0,latestPlayurlErrorHTTPCode:0,fragmentLoadingInfo:{},appendingSourceState:!1,logHistory:[],networkWarningHistory:[],playbackState:y.BUFFERING.PLAYBACK.PLAYING,enableHEVC:!1,enableAV1:!1,cdnInfo:{cdn:0,p2p:0,nc:0,pdn:0,ncBr:0,business:0,mcdn:0,bcache:0,vcache:0,ncFail:0,ncGotFail:0},cdnInfoDetail:{},requestedInfoRecordIndex:0,requestedInfoDetail:{},NCInfo:{},filterVideoInfo:{},protectionDataSet:null,ignoreEmeEncryptedEvent:t.ignoreEmeEncryptedEvent,enableMultiAudioTracks:!!t.enableMultiAudioTracks,decodeErrorLocalConfig:t.decodeErrorLocalConfig||{}},this.timer={loadScript:0,videoInfoSchedule:0,removeSwitchSourceTransition:0,qnChangeTimeOutFlag:{video:-1,audio:-1},switchSourceTimer:-1,updateSourceTimer:-1,appendSourceTimer:-1,delayStartOffsetHackTimer:-1},this.events={},this.components={networkActivity:new h.default,bufferingInfo:new y.default(e),bufferingStrategy:new m.default,performanceInfo:new _.default(e),ncDisableStrategy:new E.default(this)},this.video=e,this.mixin(t),!e||!(e instanceof HTMLVideoElement||window.__ENABLE_WASM_PLAYER__&&e instanceof window.BwpElement))throw new Error("Video parameter is not a HTMLVideoElement")}return e.getFawkesConfigValue=function(t,r){if(!e.fawkesConfig){var i=JSON.parse(JSON.stringify(p.DEFAULT_FAWKES_CONFIG));e.fawkesConfig=i;try{var o=f.default.getLocalStorage("bilibili_player_dash_fawkes_config");if(o){var a=f.default.switc){e.fawkesConfig[t]=n(n({},e.fawkesConfig[t]),a[t])}))}}catch(e){}}return e.fawkesConfig[t]?r&&"string"==typeof r?e.fawkesConfig[t][r]||"":e.fawkesConfig[t]||"":""},e.prototype.processManifest=function(e,t,r){return"string"!=typeof e&&this.processSpecialAudioItem(e,this.state.defaultAudioQuality),this.filterManifest({enableHEVC:t,enableAV1:r,manifest:e,state:this.state})},e.prototype.preload=function(){var e=this;this.dett().then(ror({msg:"Load dash player script error",detail:t})}))},e.prototype.initialize=function(e,t){var r=this;this.mixin(t);var n=this.processManifest(e,this.state.enableHEVC,this.state.enableAV1),i=n.codecId,o=n.manifest;return this.state.mpd=o,this.state.enableHEVC=i===p.VIDEO_CODEC_ID.HEVC,this.state.enableAV1=i===p.VIDEO_CODEC_ID.AV1,this.checkShouldResetLocalDecodeErr(),this.components.bufferingStrategy.setHEVCEnableFlag(this.state.enableHEVC).setOnOptimizingCallback(this.fire.bind(this)),new Promise((function(t,n){e||n({msg:"Manifest parameter error, manifest: "+JSON.stringify(e)}),r.detectDashJSExists()?r.createPlayer(t,n):r.state.onScriptLoading?r.on(p.EVENTS.SCRIPT_LOADED,(function(){r.off(p.EVENTS.SCRIPT_LOADED),rPlayerScript().then((function(){r.createPlayer(t,n)})).catch((function(e){r.error(e)}))}))},e.prototype.on=function(e,t){e&&"function"==typeof t&&(this.events[e]||(this.events[e]=[]),this.events[e].push(t))},){var r=this;this.on(e,(function(n){t(n),r.off(e,t)}))},e.prototype.off=function(e,t){if(e)if("function"==typeof t){if(this.events[e]&&this.events[e].length){var r=this.events[e].indexOf(t);r>=0&&this.events[e].splice(r,1)}}else this.events[e]=[]},e.prototype.fire=function(e,th((function(e){"function"==typeof e&&e.call(null,t)}))}},e.prototype.play=function(){try{return this.player.play()}catch(e){this.error({msg:"Call play function error",detail:e})}},e.prototype.pause=function(){try{this.player.pause()}catch(e){this.error({msg:"Call pause function error",detail:e})}},e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);try{
return this.player.time(void 0,e)}catch(e){this.error({type:p.STRING.WARNING,msg:"Call getCurrentTime function error",detail:e})}return 0},e.prototype.getBufferedTime=function(){this.getCurrentTime();var e=this.video;try{e.buffered}catch(e){this.error({msg:"Call getBufferedTime function error",detail:e})}return 0},e.prototype.getDuration=function(e){void 0===e&&(e=!0);try{return this.player.duration(e)}catch(e){this.error({msg:"Call getDuration function error",detail:e})}},e.prototype.seek=function(e,t){var r=this;return void 0===t&&(t=!1),new Promise((function(n,i){if(isNaN(parseInt(""+e,10))||e<0)i({msg:"Seek time value error, time: "+e});else if(r.state.appendingSourceState)i({msg:"Call seek function error while appending source, time: "+e});else try{var o=r.getCurrentTime(),a=Date.now();r.changePlaybackState(y.BUFFERING.PLAYBACK.SEEKING);var s=r.getStartOffsetTime();e<s&&(e=s+.3);var u=999999,c=r.state.segmentsInfoMap,l=parseInt(r.video.getAttribute("data-offset"),10)||0;if(c)for(var d in c)u=Math.min(c[d].realDuration+l,u);u=Math.min(r.state.manifest.mediaPresentationDuration,u),e>u-.6&&(e=u-.6),r.player.seek(e,t),r.player.on(p.EVENTS.PLAYBACK_SEEKED,(function i(){r.changePlaybackState(y.BUFFERING.PLAYBACK.PLAYING).player.off(p.EVENTS.PLAYBACK_SEEKED,i),n({cost:Math.floor(Date.now()-a),currentTime:o,seekedTime:e,isRelative:t})}))}catch(e){r.error({msg:"Call seek function error",detail:e})}}))},e.prototype.getCorePlayer=function(){return this.player},e.prototype.setVolume=function(e){if(isNaN(parseInt(""+e,10))||e<0||e>1)this.error({msg:"SetVolume value error, value: "+e});else try{this.player.setVolume(e)}catch(e){this.error({msg:"Call setVolume function error",detail:e})}},e.prototype.getVolume=function(){try{return this.player.getVolume()}catch(e){this.error({msg:"Call getVolume function error",detail:e})}},e.prototype.setPlaybackRate=function(e){try{this.player.setPlaybackRate(e)}catch(e){this.error({msg:"Call setPlaybackRate function error",detail:e})}},e.prototype.getPlaybackRate=function(){try{return this.player.getPlaybackRate()}catch(e){this.error({msg:"Call getPlaybackRate function error",detail:e})}},e.prototype.getAutoSwitchQualityFor=function(e){try{return this.player.getAutoSwitchQualityFor(e)}catch(e){this.error({msg:"Call getAutoSwitchQualityFor function error",detail:e})}},e.prototype.setAutoSwitchQualityFor=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!0);try{this.state.isAutoSwitch&&r&&(this.state.isAutoSwitch[e]=t),t||this.setMaxAllowedBitrateFor(e,0),this.player.setAutoSwitchQualityFor(e,t)}catch(e){this.error({msg:"Call setAutoSwitchQualityFor function error",detail:e})}return this},e.prototype.getAudioQuallityCanBeUsed=function(e){return e===p.DOLBY_AUDIO_QN.AUDIO||e===p.DOLBY_AUDIO_QN.AMTOS?this.checkAudioCodecCanUseByType(p.SPECIAL_AUDIO_TYPE.DOLBY)&&e||30280:e===p.FLAC_QN?this.checkAudioCodecCanUseByType(p.SPECIAL_AUDIO_TYPE.FLAC)&&e||30280:e},e.prototype.getQualityList=function(e){try{return this.player.getBitrateInfoListFor(e)}catch(e){this.error({msg:"Call getQualityList function error",detail:e})}},e.prototype.setDefaultQualityFor=function(e,t){void 0===t&&(t=0);var r=this.getQualityIndexFromQualityNumber(t,e);try{var n=this.state.mpd&&this.state.mpd[e];if(!n)return;var i=n.length;i&&(r=Math.min(r,i-1)),r>=0?(this.state.currentQualityIndex[e]=r,this.player.setDefaultQualityFor(e,r)):this.error({msg:"Call setDefaultQualityFor function error, quality: "+t})}catch(e){this.error({msg:"Call setDefaultQualityFor function error, quality: "+t+", qualityIndex = "+r,detail:e})}},e.prototype.setAutoSwitchTopQualityFor=function(e,t){var r=this;try{if(!this.state.initialized)return void this.on(p.EVENTS.STREAM_INITIALIZED,(function n(){r.off(p.EVENTS.STREAM_INITIALIZED,n),r.setAutoSwitchTopQualityFor(e,t)}));if(!t&&0!==t)return void this.setMaxAllowedBitrateFor(e,0);if(!this.state.isAutoSwitch||!this.state.isAutoSwitch[e])return;var n=this.getQualityIndexFromQualityNumber(t,e),i=this.getQualityList(e),o=i&&i[n],a=Math.floor(o.bitrate/1e3)+1;this.state.autoSwitchTopQualityMap[e]=n,this.setMaxAllowedBitrateFor(e,a)}catch(e){this.error({msg:"Call setAutoSwitchTopQualityFor function error",detail:e})}},e.prototype.setQualityFor=function(e,t){var r=this;return new Promise((function(n,i){if(isNaN(parseInt(""+t,10))||t<0)i({msg:"Set quality value error, quality: "+t,code:p.ERROR_CODE.SET_QUALITY_VALUE_ERR});else if(r.detectQualityTypeIsLegal(e))i({msg:"Set quality type error, type: "+e,code:p.ERROR_CODE.SET_QUALITY_TYPE_ERR});else if(r.state.appendingSourceState)i({msg:"Reject setQualityFor by appending next source.",code:p.ERROR_CODE.SET_QUALITY_APENDING_ERR});else if("audio"===e&&r.state.enableMultiAudioTracks)i({msg:"MultiAudioTrack disable change Qn",code:p.ERROR_CODE.SET_QUALITY_MULTI_TRACK});else if("audio"===e&&r.getAutoSwitchQualityFor("video"))i({msg:"abr disable change Qn",code:p.ERROR_CODE.SET_QUALITY_ABR});else try{var o=t;if((t=r.getQualityIndexFromQualityNumber(t,e))===r.state.currentQualityIndex[e])return void i({msg:"Set quality equal current quality, quality: "+t,code:p.ERROR_CODE.SET_QUALITY_SAME_VALUE,isChange:o!==r.getQualityNumberFromQualityIndex(t)&&t!==o});r.player.setQualityFor(e,t);var a=Date.now(),s=function(e){-1!==r.timer.qnChangeTimeOutFlag[e]&&(clearTimeout(r.timer.qnChangeTimeOutFlag[e]),r.timer.qnChangeTimeOutFlag[e]=-1)};s(e),r.timer.qnChangeTimeOutFlag[e]=window.setTimeout((function(){r.player.off(p.EVENTS.QUALITY_CHANGE_RENDERED,u),i({msg:"Call setQualityFor timeout",code:p.ERROR_CODE.SET_QUALITY_TIME_OUT}),s(e);var t=r.state.currentQualityIndex[e];r.player.setQualityFor(e,t)}),1e4);var u=function u(c){if(c.mediaType===e){var l=c.newQuality;if(s(c.mediaType),r.player.off(p.EVENTS.QUALITY_CHANGE_RENDERED,u),l===t){var d=r.getQualityNumberFromQualityIndex(l,e);l!==o&&o!==d?(i({msg:"Quality rendered and quality is not "+o+" but "+d,code:p.ERROR_CODE.SET_QUALITY_RENDER_CHANGED,newQuality:l,newQnNumber:d}),r.fire(p.EVENTS.QUALITY_CHANGE_ABNORMAL,{type:p.EVENTS.QUALITY_CHANGE_ABNORMAL,mediaType:e,defaultQuality:o,currentIndex:l,qualityNumber:d})):n(r.getQualityChangedData(c,a))}}};r.player.on(p.EVENTS.QUALITY_CHANGE_RENDERED,u)}catch(e){i({msg:"Call setQualityFor function error",code:p.ERROR_CODE.SET_QUALITY_ERR,detail:e})}}))},e.prototype.getQualityFor=function(e){try{return this.player.getQualityFor(e)}catch(e){this.error({msg:"Call getQualityFor function error",detail:e})}},e.prototype.setStableBufferTime=function(e){void 0===e&&(e=60);try{this.player.setStableBufferTime(e),this.player.setBufferTimeAtTopQuality(e),this.player.setBufferTimeAtTopQualityLongForm(e),this.player.setBufferAheadToKeep(e+10)}catch(e){this.error({msg:"Call setStableBufferTime function error",detail:e})}},e.prototype.getStableBufferTime=function(){try{return this.player.getStableBufferTime()}catch(e){this.error({msg:"Call getStableBufferTime function error",detail:e})}},e.prototype.getBufferLength=function(e){try{return this.player.getBufferLength(e)}catch(e){this.error({msg:"Call getBufferLength function error",detail:e})}},e.prototype.getCurrentPlayURLFor=function(e){try{return this.player.getCurrentSegmentInfoFor(e).url||""}catch(t){this.error({msg:"Call getCurrentPlayURLFor function error, type: "+e+", qualityIndex: "+this.state.currentQmediaInfo,statisticsInfo:this.state.statisticsInfo}},e.prototype.getCurrentCodecID=function(e){void 0===e&&(e=p.STRING.VIDEO);var t=0;return e===p.STRING.VIDEO&&this.state&&(t=p.VIDEO_CODEC_ID.AVC,this.state.enableAV1&&(t=p.VIDEO_CODEC_ID.AV1),this.state.enableHEVC&&(t=p.VIDEO_CODEC_ID.HEVC)),t},e.prototype.getAverageConnectionSpeed=function(e){void 0===e&&(e=p.STRING.VIDEO);try{return Number(this.player.getAverageThroughput(e))||0}catch(e){this.error({msg:"Call getAverageConnectionSpeed function error",detail:e})}},e.prototype.switchSource=function(e,t,r){var n=this;if(void 0===r&&(r=!1),window.clearTimeout(this.timer.removeSwitchSourceTransition),this.onVideoSwitchSourceEnded(),t&&("string"!=typeof t.videoid||"string"!=typeof t.audioid?this.error({type:p.STRING.WARNING,
msg:"Preload data videoid/audioid value must be string type.",detail:t}):this.player&&this.player.setPreloadData(t)),r){var i=document.createElement("canvas"),o=this.video.offsetWidth,a=this.video.offsetHeight,s=this.video.videoWidth/this.video.videoHeight,u=o/a;i.width=o,i.height=a,i.style.zIndex="10",i.style.position="absolute",i.className=p.STRING.SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME;var c=i.getContext("2d"),l=void 0,d=void 0;u>=s?(l=a*s,d=a):(l=o,d=o/s),c.fillRect(0,0,i.width,i.height),c.drawImage(this.video,Math.abs(o-l)/2,Math.abs(a-d)/2,l,d),this.video.parentNode.appendChild(i),this.timer.removeSwitchSourceTransition=window.setTimeout((function(){n.onVideoSwitchSourceEnded()}),1e4),i=null,c=null,this.video.removeEventListener("canplay",this.onVideoSwitchSourceEnded),this.video.removeEventListener("playing",this.onVideoSwitchSourceEnded),this.video.addEventListener("canplay",this.onVideoSwitchSourceEnded),this.video.addEventListener("playing",this.onVideoSwitchSourceEnded)}return new Promise((function(t,r){try{if(e=n.filterManifest({manifest:e,state:n.state}).manifest,n.state.mpd=e,n.player){for(var i in n.state.currentQualityIndex)n.state.currentQualityIndex[i]>=0&&n.setDefaultQualityFor(i,n.state.currentQualityIndex[i]);n.state.defaultVideoQuality=n.state.currentQualityIndex.video,n.state.defaultAudioQuality=n.state.currentQualityIndex.audio,n.bindSwitchSourceEvents(t,r,1e4),n.player.switchSource(e)}else r("Dash Player Error")}catch(e){r(e)}}))},e.prototype.updateSource=function(e){var t=this;return new Promise((function(r,n){try{e=t.filterManifest({manifest:e,state:t.state}).manifest,t.player.updateSource(e),t.timer.updateSourceTimer=window.setTimeout((function(){n({msg:"Update Source Timeout"})}),5e3),t.player.on(p.EVENTS.STREAM_INITIALIZED,(function e(){t.player.off(p.EVENTS.STREAM_INITIALIZED,e),clearTimeout(t.timer.updateSourceTimer),r(null)}))}catch(e){n({msg:"Call updateSource function error, "+JSON.stringify(e),detail:e})}}))},e.prototype.appendSource=function(e,t){var r=this,n=this.state.appendingSourceState,i=this.state;return new Promise((function(o,a){n&&a("Dash Player is Appending Next Source!"),r.setAutoSwitchQualityFor("video",!1,!1),r.setAutoSwitchQualityFor("audio",!1,!1);var s=Date.now();t&&("string"!=typeof t.videoid||"string"!=typeof t.audioid?r.error({type:p.STRING.WARNING,msg:"Preload data videoid/audioid value must be string type.",detail:t}):r.player&&r.player.setPreloadData(t)),r.timer.appendSourceTimer=window.setTimeout((function(){r.state.appendingSourceState=!1,a({msg:"Append source time out."})}),5e3),r.state.appendingSourceState=!0;try{if(r.player){for(var u in r.state.currentQualityIndex)r.state.currentQualityIndex[u]>=0&&r.setDefaultQualityFor(u,r.state.currentQualityIndex[u]);e=r.filterManifest({manifest:e,state:r.state}).manifest,r.player.setEndOfStreamState(!1),r.player.appendSource(e),r.player.on(p.EVENTS.APPENDED_NEXT_SOURCE,(function e(t){clearTimeout(r.timer.appendSourceTimer),r.player.off(p.EVENTS.APPENDED_NEXT_SOURCE,e),o({cost:Date.now()-s})})),r.player.on(p.EVENTS.APPENDED_NEXT_SOURCE_DURATION_CHANGED,(function e(t){r.player.off(p.EVENTS.APPENDED_NEXT_SOURCE_DURATION_CHANGED,e),r.state.appendingSourceState=!1,i.autoSwitchTopQualityMap.video>=0&&r.setAutoSwitchTopQualityFor("video",i.autoSwitchTopQualityMap.video),r.setAutoSwitchQualityFor("video",i.isAutoSwitch[p.STRING.VIDEO],!1),r.setAutoSwitchQualityFor("audio",i.isAutoSwitch[p.STRING.AUDIO],!1)}))}else clearTimeout(r.timer.appendSourceTimer),r.state.appendingSourceState=!1,a({msg:"Missing dash player instance!"})}catch(e){clearTimeout(r.timer.appendSourceTimer),r.state.appendingSourceState=!1,a({msg:"Append Source Error",detail:e})}}))},e.prototype.getNction(){var e="";try{var t=function(e){return e?1:0};if(this.state.getNextFragmentHistory){var r=function(r){var i=n.state.getNextFragmentHistory[r],o="";i.forEach((function(e){var r,n,i=[t(e.final),e.currentTime,e.bufferLevel.toFixed(3),(r=[e.bufferResetInProgress,e.isReplacement,e.switchTrack,e.hasTopQualityChanged,e.lastInite],n="",r.length&&r.forEach((function(e){n+=""+t(e)})),parseInt(n,2))];o+=i.join(",")+";"})),e+=r+":"+o+"!"},n=this;for(var i in this.state.getNextFragmentHistory)r(i)}}catch(e){}return e},e.prototype.isLoadingFragment=function(e){if(e)return!!this.state.frhis.components.networkActivity.getNetworkActivity()},e.prototype.getNetworkActivityHistory=function(e){return void 0===e&&(e=0),this.components.networkActivity&&this.components.networkActivity.getNetworkActivityHistory(e)},e.prototype.setEndOfStreamState=function(e){void 0===e&&(e=!1);try{return this.player.setEndOfStreamState(e)}catch(e){this.error({msg:"Call setEndOfStreamState function error",detail:e})}},e.prototype.getLogHistory=function(){var e=this.state&&this.state.logHistory||[],t=e.join("\n");return{length:e.length,log:t,size:function(e){for(var t=[],r=[e],n=0;r.length;){var i=r.pop();if("boolean"==typeof i)n+=4;else if("string"==typeof i)n+=2*i.length;else if("number"==typeof i)n+=8;else if("object"==c(i)&&-1===t.indexOf(i))for(var o in t.push(i),i)r.push(i[o])}return n}(t)}},e.prototype.getPerformanceInfo=function(e){void 0===e&&(e=!1);var t=this.getDroppedFramesInfo();return this.components.performanceInfo.getInfo(t,e)},e.prototype.getDisableLoaderType=function(){return this.components.ncDisableStrategy.isUseNC?this.components.ncDisableStrategy.isUseP2P?p.DISABLE_LOADER_TYPE.NONE:p.DISABLE_LOADER_TYPE.DISABLE_RP:p.DISABLE_LOADER_TYPE.DISABLE_NC},e.prototype.getBufferingInfo=function(e){var t;void 0===e&&(e=!0);var r={type:-1};try{var i=this.state.currentQualityIndex.video,o=this.state.currentQualityIndex.audio;r=this.components.bufferingInfo&&this.components.bufferingInfo.getInfo({videoBufferLength:this.getBufferLength("video"),audioBufferLength:this.getBufferLength("audio"),videoCurrentIndex:i,audioCurrentIndex:o,videoCurrentQn:this.getQualityNumberFromQualityIndex(i,p.STRING.VIDEO),audioCurrentQn:this.getQualityNumberFromQualityIndex(o,p.STRING.AUDIO),videoSpeed:this.getAverageConnectionSpeed(p.STRING.VIDEO),audioSpeed:this.getAverageConnectionSpeed(p.STRING.AUDIO),networkActivity:this.getNetworkActivityHistory(5),playbackState:this.state.playbackState,latestPlayurlErrorHTTPCode:this.state.latestPlayurlErrorHTTPCode,fragmentLoadingInfo:this.state.fragmentLoadingInfo,networkWarningHistory:this.state.networkWarningHistory,startOffsetTime:this.state.startOffsetTime,retryTimes:this.player.getRetryTimes(),seekSpace:this.player.getSpaceUtilLastSeekInSec()}),r=n(n({},r),this.getPerformanceInfo(!0)),null===(t=this.components)||void 0===t||t.bufferingStrategy.push(r)}catch(e){throw new Error(e.message)}return e&&this.onDashJSLog({type:"videoBuffering",message:"[videoBuffering]:"+JSON.stringify(r)}),r},e.prototype.getCDNInfo=function(e){if(void 0===e&&(e=!1),this.state){var t=n({},this.state.cdnInfo);return e&&(this.state.cdnInfo={cdn:0,p2p:0,nc:0,pdn:0,ncBr:0,business:0,mcdn:0,bcache:0,vcache:0,ncFail:0,ncGotFail:0}),t}return{}},e.prototype.getCDNInfoDetail=function(e){if(void 0===e&&(e=!1),this.state){var t=n({},this.state.cdnInfoDetail);return e&&(this.state.cdnInfoDetail={}),t}return{}},e.prototype.getRequestedInfoDetail=function(e){if(void 0===e&&(e=!1),this.state){var t=n({},this.state.requestedInfoDetail);return e&&(this.state.requestedInfoDetail={}),t}return{}},e.prototype.getNCInfo=function(e){if(void 0===e&&(e=!1),this.state){var t={};for(var r in this.state.NCInfo)t[r]=n({},this.state.NCInfo[r]);return e&&(this.state.NCInfo={}),t}return{}},e.prototype.switchAudioTrack=function(e){var t=this;return new Promise((function(r,n){try{var i=-1,o="";if(t.state.enableMultiAudioTracks?e===t.getCurrentAudioTrackId()&&(i=p.ERROR_CODE.SWITCH_AUDIO_TRACK_ID_NOT_CHANGED,o="the id which is going to be switched is equal to current"):(i=p.ERROR_CODE.SWITCH_AUDIO_TRACK_NOT_SUPPORT,o="not support multiple audio tracks"),-1!==i)return void n({code:i,msg:o});0!==t.player.switchAudioTrack(e)?n({code:i=p.ERROR_CODE.SWITCH_AUDIO_TRACK_ID_NOT_EXIST,
msg:o="the id which is going to be switched is not exist"}):t.once(p.EVENTS.SWITCH_AUDIO_TRACK_RENDERED,(function(e){r(e)}))}catch(e){n({code:p.ERROR_CODE.SWITCH_AUDIO_TRACK_ERR,msg:"switch aduio track failed, "+(e&&e.message)})}}))},e.prototype.getCurrentAudioTrackId=function(){return this.player.getCurrentAudioTrackId()},e.prototype.getAudioTrackList=function(){try{return this.player.getAudioTrackList()}catch(e){return[]}},e.prototype.destroy=function(){try{this.player.off(p.EVENTS.FRAGMENT_LOADING_STARTED,this.onFragmentLoading,this),this.player.off(p.EVENTS.FRAGMENT_LOADING_PROGRESS,this.onFragmentLoading,this),this.player.off(p.EVENTS.FRAGMENT_LOADING_COMPLETED,this.onFragmentLoading,this),this.player.off(p.EVENTS.SWITCH_AUDIO_TRACK_REQUEST,this.onAudioTrackSwitchRequest,this),this.player.off(p.EVENTS.SWITCH_AUDIO_TRACK_RENDERED,this.onAudioTrackSwitchRendered,this),this.player.off(p.EVENTS.LOG,this.onDashJSLog,this),this.player.off(p.EVENTS.PREDICT_SEEK,this.onPredictSeek,this),this.player.off(p.EVENTS.JUMP_MEDIA_GAP,this.onJumpMediaGap,this),this.player&&this.player.reset(),this.onVideoSwitchSourceEnded(),this.clearAllTimer(),this.events={},this.config=null,this.state=null,this.video=null,this.player=null,this.destroyAllComponents(),this.externalMediaLoader=null}catch(e){this.error({msg:"Call destroy function error, "+(e&&e.message),detail:e})}},e.prototype.destroyAllComponents=function(){this.components.networkActivity.destroy(),this.components.networkActivity=null,this.components.bufferingInfo.destroy(),this.components.bufferingInfo=null,this.components.bufferingStrategy.destroy(),this.components.bufferingStrategy=null,this.components.performanceInfo.destroy(),this.components.performanceInfo=null,this.components.ncDisableStrategy.destroy(),this.components.ncDisableStrategy=null,this.components=null},e.prototype.clearAllTimer=function(){var e=this;this.timer&&(Object.keys(this.timer).forEach((function(t){"qnChangeTimeOutFlag"===t?(clearTimeout(e.timer.qnChangeTimeOutFlag.video),clearTimeout(e.timer.qnChangeTimeOutFlag.audio)):clearTimeout(e.timer[t])})),this.timer=null)},e.prototype.mixin=function(e){if(e&&e instanceof Object)for(var t in e)e.hasOwnProperty(t)&&this.state.hasOwnProperty(t)&&(this.state[t]=e[t]);this.state&&this.state.isAutoSwitch||(this.state.isAutoSwitch={video:!1,audio:!1})},e.prototype.loadDashPlayerScript=function(){var e=this,t=this.config.scriptSrc;return new Promise((function(r,n){try{var i=document.createElement("script");i.src=t,i.onload=function(){e.state.onScriptLoading=!1,clearTimeout(e.timer.loadScript),r()},i.onerror=function(r){e.state.onScriptLoading=!1,clearTimeout(e.timer.loadScript),n({msg:"Load dash player script error, src: "+t,detail:r})},document.body.appendChild(i),e.state.onSc{msg:"Call loadDashPlayerScript function timeout"})}),e.config.scriptMaxLoadTime)}catch(e){n({msg:"Call loadDashPlayerScript function error",detail:e})}}))},e.prototype.createPlayer=function(t,r){var n,i=window.dashjs,o=this.state;this.state.defaultVideoQuality=this.getQualityIndexFromQualityNumber(o.defaultVideoQuality,p.STRING.VIDEO),this.state.defaultAudioQuality=this.getQualityIndexFromQualityNumber(o.defaultAudioQuality,p.STRING.AUDIO);try{var a=i.MediaPlayer().create();o&&o.protectionDataSet&&"function"==typeof a.setProtectionData&&a.setProtectionData(o.protectionDataSet),this.player=a,this.setDebugLog(),this.bindEvents(t),this.state.logHistory.push("Dash player log history, "+JSON.stringify(e.CONFIG)),o.preloadData&&a.setPreloadData(o.preloadData),a.initialize(this.video,o.mpd,o.isAutoPlay,o.enforceSSLStream,null===(n=this.config)||void 0===n?void 0:n.hid,this.externalMediaLoader,o.ignoreEmeEncryptedEvent,o.enableMultiAudioTracks),a.setABRStrategy(o.abrStrategy||p.STRING.ABR_THROUGHPUT),a.setAutoSwitchQualityFor(p.STRING.VIDEO,o.isAutoSwitch[p.STRING.VIDEO]),a.setAutoSwitchQualityFor(p.STRING.AUDIO,o.isAutoSwitch[p.STRING.AUDIO]),a.setFastSwitchEnabled(!0),a.enableLastBitrateCaching(!1),a.setBufferPruningInterval(20),a.setUseNC(this.components.ncDisableStrategy.isUseNC),a.setUseP2P(this.components.ncDisableStrategy.isUseP2P),o.mpd&&o.mpd.interactive&&a.setEndOfStreamState(!1),a.setJumpGaps(!0),this.setStableBufferTime(this.state.stableBufferTime)}catch(e){r({msg:"Call createPlayer function error",detail:e})}},e.prototype.bindEvents=function(e){var t=this,r=this.player;r.on(p.EVENTS.STREAM_INITIALIZED,(function n(){r.off(p.EVENTS.STREAM_INITIALIZED,n,t),t.state.initialized=!0;var i=t.player.getBitrateInfoListFor("video");e&&e(i),t.fire(p.EVENTS.STREAM_INITIALIZED),t.videoInfoSchedule(),t.detectDefaultQualityChangeAbnormal()}),this),r.on(p.EVENTS.MANIFEST_LOADED,this.parseManifestInfo,this),r.on(p.EVENTS.GET_NEXT_FRAGMENT,this.getNextFragmentInfo,this),r.on(p.EVENTS.FRAGMENT_LOADING_STARTED,this.onFragmentLoading,this),r.on(p.EVENTS.FRAGMENT_LOADING_PROGRESS,this.onFragmentLoading,this),r.on(p.EVENTS.FRAGMENT_LOADING_COMPLETED,this.onFragmentLoading,this),r.on(p.EVENTS.SWITCH_AUDIO_TRACK_REQUEST,this.onAudioTrackSwitchRequest,this),r.on(p.EVENTS.SWITCH_AUDIO_TRACK_RENDERED,this.onAudioTrackSwitchRendered,this),r.on(p.EVENTS.FRAGMENT_LOADED_ERROR,this.onFragmentLoadingError,this),r.on(p.EVENTS.REQUEST_RETRYED,this.onFragmentLoadingError,this),r.on(p.EVENTS.LOG,this.onDashJSLog,this),r.on(p.EVENTS.PREDICT_SEEK,this.onPredictSeek,this),r.on(p.EVENTS.JUMP_MEDIA_GAP,this.onJumpMediaGap,this),r.onInitSegmentsLoaded(this.onInitSegmentsLoaded.bind(this)),r.on(p.EVENTS.DELAY_TO_APPEND_TO_BUFFER,(function(e){})),r.on(p.EVENTS.START_OFFSET_TIME_WARNING,(function(e){var r=e&&e.time;r&&r>t.state.startOffsetTime&&(t.error({type:p.STRING.WARNING,code:p.ERROR.START_OFFSET_TIME_WARNING,msg:"Start offset time is less than buffer.start(0), "+t.state.startOffsetTime+" < "+r}),t.state.startOffsetTime=r+.2)})),r.on(p.EVENTS.PLAYBACK_METADATA_LOADED,(function e(){r.off(p.EVENTS.PLAYBACK_METADATA_LOADED,e),t.timer.delayStartOffsetHackTimer=window.setTimeout((function(){if(t.video){var e=t.video.buffered,n=e.length&&e.start(0),i=t.video.currentTime;i<n&&(t.error({type:p.STRING.WARNING,code:p.ERROR.START_OFFSET_TIME_WARNING,msg:"Current offset time is less than buffer.start(0), "+i+" < "+n}),t.state.startOffsetTime=n+.2,r.seek(n+.2))}}),3e3)})),this.bindDashCorePlayerEvents()},e.prototype.onAudioTrackSwitchRequest=function(e){this.fire(p.EVENTS.SWITCH_AUDIO_TRACK_REQUEST,e)},e.prototype.onAudioTrackSwitchRendered=function(e){this.fire(p.EVENTS.SWITCH_AUDIO_TRACK_RENDERED,e)},e.prototype.bindSwitchSourceEvents=function(e,t,r){var n=this,i=Date.now();this.timer.switchSourceTimer=window.setTimeout((function(){n.onVideoSwitchSourceEnded(),t({err:"Dash Player Switch Source timeout",cost:Date.now()-i})}),r),this.player.on(p.EVENTS.STREAM_INITIALIZED,(function t(){window.clearTimeout(n.timer.switchSourceTimer),n.player.off(p.EVENTS.STREAM_INITIALIZED,t,n),e({cost:Date.now()-i})}),this)},e.prototype.error=function(e){e.code=e.code||p.ERROR.INTERNAL_ERROR,e.msg="[Dash] "+e.msg,e.type=e.type||p.STRING.ERROR,this.state&&this.state.logHistory.push("Dash player "+e.type+" - "+e.code+": "+e.msg),p.STRING.ERROR===e.type?this.fire(p.EVENTS.ERROR,e):this.fire(p.EVENTS.WARNING,e)},e.prototype.bindDashCorePlayerEvents=function(){var e=this,t=this.events;this.player.on(p.EVENTS.ERROR,(function(t){var r,n=null===(r=null==t?void 0:t.event)||void 0===r?void 0:r.request;n&&(n.code=t.httpCode||t.code),e.recordRequestedInfoDetail(null==n?void 0:n.mediaType,n),e.errorHandler(t)})),this.on(p.EVENTS.QUALITY_CHANGE_REQUESTED,(function(t){e.changePlaybackState(y.BUFFERING.PLAYBACK.SWITCHING_QUALITY),e.components.bufferingInfo&&e.components.bufferingInfo.setSwitchingInfo({mediaType:t.mediaType,newQuality:t.newQuality,oldQuality:t.oldQuality})})),this.on(p.EVENTS.QUALITY_CHANGE_RENDERED,(function(t){e.changePlaybackState(y.BUFFERING.PLAYBACK.PLAYING),e.components.bufferingInfo&&e.components.bufferingInfo.setSwitchingInfo(null),e.state.currentQualityIndex[t.mediaType]=t.newQuality})),[{key:p.EVENTS.QUALITY_CHANGE_REQUESTED,callbackQueue:function(){return t[p.EVENTS.QUALITY_CHANGE_REQUESTED]}},{
key:p.EVENTS.QUALITY_CHANGE_RENDERED,callbackQueue:function(){return t[p.EVENTS.QUALITY_CHANGE_RENDERED]}},{tion(){return t[p.EVENTS.QUALITY_CHANGE_DOWNLOADED]}}].forEach((function(t){e.player.on(t.key,(f"function"==typeof t&&t(e.getQualityChangedData(r))}))}catch(r){e.error({msg:"Call "+t.key+" callback queue error",detail:r,type:p.STRING.WARNING})}}))})),this.player.on(p.EVENTS.FRAGMENT_LOADED_ERROR,(function(t){if(t){if(!t.code)return;var r=p.STRING.WARNING;t.code===p.ERROR.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE&&(r=p.STRING.ERROR),e.saveNetworkWarningInfo(t),e.error({code:t.code,detail:t,msg:"Fragment Loaded Error, "+JSON.stringify(t),type:r})}})),this.player.on(p.EVENTS.PCDN_LOADED_ERROR,(function(t){if(t){if(!t.code)return;e.error({code:t.code,detail:t,msg:"Pcdn Loaded Error, "+JSON.stringify(t),type:p.STRING.WARNING})}})),this.player.on(p.EVENTS.CDN_LOAD_INFO,this.onDashCDNLoadInfo,this),this.player.on(p.EVENTS.QUOTA_EXCEEDED,(function(e){}))},e.prototype.checkShouldResetLocalDecodeErr=function(){if(this.state){var e=this.state,t=e.enableAV1,r=e.enableHEVC,n=t?"AV1":r?"HEVC":"AVC";if("AVC"!==n){var i=d.getLocalDecodeErrorInfo(n);if(i&&"number"==typeof i.reactivateTime){var o=(new Date).getTime();i.reactivateTime<=o&&d.rmLocalDecodeErrorInfo(n)}}}},e.prototype.errorHandler=function(e){var t=this;if(e)try{var r=e.code,n=e.error,i=e.event.message,o=e.decodeErrorType||null;switch(r){case p.ERROR.DOWNLOAD_ERROR:case p.ERROR.DOWNLOAD_MPD_ERROR:case p.ERROR.DOWNLOAD_XINK_ERROR:case p.ERROR.DOWNLOAD_INIT_SEGMENT_ERROR:case p.ERROR.DOWNLOAD_MEDIA_SEGMENT_ERROR:case p.ERROR.DOWNLOAD_INDEX_SEGMENT_ERROR:case p.ERROR.DOWNLOAD_SWITCHING_SEGMENT_ERROR:case p.ERROR.DOWNLOAD_OTHER_ERROR:var a=e.event.url,s=e.httpCode,u=!0;if(s&&s>=400){var c=0;if(a){var l=a.match(/expires=\d+/g),h=a.match(/deadline=\d+/g);c=l&&parseInt(l[0].substr(8),10)||h&&parseInt(h[0].substr(9),10)}c&&this.state.latestPlayurlExpireTimeStamp===c&&this.state.latestPlayurlErrorHTTPCode===s&&(u=!1),this.state.latestPlayurlExpireTimeStamp=c,this.state.latestPlayurlErrorHTTPCode=s}u&&this.error({code:r,msg:s+" downloadError - "+a,detail:e});break;case p.ERROR.MANIFEST_ERROR:case p.ERROR.MANIFEST_TYPE_ERROR:case p.ERROR.MANIFEST_RESOLVE_ERROR:this.error({code:r,msg:n+" - "+i,detail:e});break;case p.ERROR.MEDIA_ERROR:case p.ERROR.MEDIA_ABORTED_ERROR:case p.ERROR.MEDIA_NETWORK_ERROR:case p.ERROR.MEDIA_SUPPORTED_ERROR:case p.ERROR.MEDIA_ENCRYPTED_ERROR:case p.ERROR.MEDIA_UNKNOWN_ERROR:case p.ERROR.MEDIA_DECODE_ERROR:!function(){try{if(r===p.ERROR.MEDIA_DECODE_ERROR&&"audio"===o){var e=t.getQualityNumberFromQualityIndex(t.getQualityFor("audio"),"audio");f.default.saveDecodeErrorMediaQualityNumber("audio",e,p.STRING.BILIBILI_DECODE_ERROR_OBJ)}var n=t.state,i=n.enableAV1,a=n.enableHEVC,s=n.decodeErrorLocalConfig,u=i?"AV1":a?"HEVC":"AVC";if("AVC"===u)return;if(!o||"audio"!==o){var c="enable"+u+"Error";f.default.setSessionStorage(c,"1")}if(s&&s[u]){var l=s[u],h=l.occurTimes,y=l.disableDuration,m=d.getLocalDecodeErrorInfo(u)||{occurTimes:0},g=m.occurTimes,v=m.reactivateTime;if(++g>=h&&!v){var _=y||6048e5;v=(new Date).getTime()+_}d.setLocalDecodeErrorInfo(u,{occurTimes:g,reactivateTime:v})}}catch(e){}}();var y=e.event,m=o?"[DecodeErrorType]"+o+";":n+" - "+y;this.error({code:r,msg:m,detail:e});break;default:this.error({msg:"Unknown error.",detail:e}),console.error(e)}}catch(e){this.error({msg:"Unknownreturn!(!window.dashjs||!window.dashj(e){return!(e===p.STRING.VIDEO||e===p.STRING.AUDIO)},e.prototype.parseManifestInfo=function(e){var t=this;try{var r=e.data;if(this.state.manifest=r,r&&r.Period){var n={baseUri:r.baseUri,representation:{video:[],audio:[]}},i={video:{},audio:{}},o=r.Period.AdaptationSet_asArray;o.length&&o.forEach((function(e){var r=e.Representation_asArray;if(r){var o="";r instanceof Array||(r=[r]),r.length&&(r.sort((function(e,t){return e.bandwidth-t.bandwidth})),r.forEach((function(r,a){var s=r.frameRate,u=r.mimeType||e.mimeType;try{if(s&&(""+s).indexOf("/")>-1){var c=s.split("/");s=(s=parseInt(c[0],10)/parseInt(c[1],10)).toFixed(3)}}catch(e){t.error({msg:"Parse fps error, fps: "+s,detail:e})}var l={id:r.id,baseURL:r.BaseURL,width:r.width,height:r.height,bandwidth:r.bandwidth,codecs:r.codecs,fps:s,mimeType:u,sar:r.sar,startWithSAP:r.startWithSAP,audioSamplingRate:r.audioSamplingRate};u.indexOf(p.STRING.VIDEO)>-1?o=p.STRING.VIDEO:u.indexOf(p.STRING.AUDIO)>-1?o=p.STRING.AUDIO:t.error({msg:"Manifest missing mimeType",detail:r}),o&&(function(e){var t,r,n,i=e.width,o=e.height,a=e.id;return t=function(e,t,r,n){return e+';codecs="'+t+'"'+(r&&n?';width="'+r+'";height="'+n+'"':";")}(e.mimeType,e.codecs,i,o),(null===(n=(r=window.MediaSource).isTypeSupported)||void 0===n?void 0:n.call(r,t))&&function(e,t,r){return v.getCurrentBrowserInfo().type!==v.BROWSER_TYPE.Firefox||e!==p.VIDEO_QN.QN_4K||!(!t||!r)&&t<=4096&&r<=2160}(+a,i,o)}(l)||t.isUsingWasmPlayer())?(n.representation[o].push(l),i[o][l.id]=a):t.onDashJSLog({type:"FilterCodecNotSupportedQn",message:"abandon qn: "+l.id})}))),t.state.maxQualityIndex[o]=r.length-1}})),this.state.manifestInfo=n,this.state.qualityNumberMap=i,this.state.setTheDefaultVideoQualityState||(this.state.setTheDefaultVideoQualityState=!0,this.setDefaultQualityFor("video",this.state.defaultVideoQuality),this.setDefaultQualityFor("audio",this.state.defaultAudioQuality))}}catch(t){this.error({msg:"Parse dash player manifest error",detail:e})}},e.prototype.getQualityIndexFromQualityNumber=function(e,t){void 0===t&&(t=p.STRING.VIDEO);var r=0;"audio"===t&&(e=this.qualityNumberDowngrading("audio",e)),t===p.STRING.AUDIO&&[p.DOLBY_AUDIO_QN.AMTOS,p.DOLBY_AUDIO_QN.AUDIO,p.FLAC_QN].includes(e)&&(e=this.getAudioQuallityCanBeUsed(e));try{var n=this.state.qualityNumberMap[t];e=parseInt(""+e,10);var i=this.state.maxQualityIndex[t];if(n&&n[e]>=0&&e>=this.config.minQualityNumberMappingNumber){var o=n[e];o>=0&&(r=o)}else if(-1===i||e>=0&&e<=i)r=e;else if(n){for(var a in n)if(n.hasOwnProperty(a)){var s=parseInt(a,10);s<e&&(r=n[""+Math.max(r,s)])}this.error({msg:"Quality number or index is error, qn or index: "+e+",using lower quality number: "+this.getQualityNumberFromQualityIndex(r)+" with quality index: "+r,type:p.STRING.WARNING})}else this.error({msg:"Quality number or index is error, qn or index: "+e+", qn map: "+JSON.stringify(n)+", max quality index: "+i,type:p.STRING.WARNING})}catch(t){this.error({msg:"Call getQualityIndexFromQualityNumber error, qn: "+e,detail:t})}return r},e.prototype.getQualityNumberFromQualityIndex=function(e,t){void 0===t&&(t=p.STRING.VIDEO);try{var r=this.state.qualityNumberMap[t];if(e=parseInt(""+e,10),r)for(var n in r)if(r.hasOwnProperty(n)&&r[n]===e)return parseInt(n,10)}catch(t){this.error({msg:"Call getQualityNumberFromQualityIndex error, qn: "+e,detail:t})}return 32},e.prototype.getDroppedFramesInfo=function(){try{return this.player.getDroppedFramesInfo()||{}}catch(e){this.error({msg:"Call getDroppedFramesInfo function error",detail:e,type:p.STRING.WARNING})}},e.prototype.getCurrentTrackFor=function(e){try{return this.player.getCurrentTrackFor(e)||{}}catch(e){this.error({msg:"Call getCurrentTrackFor function error, "+(e&&e.message),detail:e,type:p.STRING.WARNING})}},e.prototype.getCurrentSegmentInfoFor=function(e){void 0===e&&(e=p.STRING.VIDEO);try{return this.player.getCurrentSegmentInfoFor(e)||{}}catch(e){this.error({msg:"Call getCurrentSegmentInfoFor function error",detail:e,type:p.STRING.WARNING})}},e.prototype.onInitSegmentsLoaded=function(e,t){try{if(this.state.segmentsInfoMap[e]=t,!t.isDurationAllEqual){var r=t.notEqualQualityIndex;this.error({code:p.ERROR.DURATION_IS_NOT_ALL_EQUAL,msg:"Segments duration is not all equal, type: "+e+", quality index switch: "+r.old+" => "+r.new+", segment index list: "+t.notEqualIndexList+" } "})}var n=this.state.segmentsInfoMap,i=this.state.appendingSourceState;if(n&&n.video&&n.audio&&!i){var o=n.video.realDuration,a=n.audio.realDuration,s=Math.abs(o-a);if(s>3){
var u=this.getQualityNumberFromQualityIndex(n.video.qualityIndex,p.STRING.VIDEO),c=this.getQualityNumberFromQualityIndex(n.audio.qualityIndex,p.STRING.AUDIO),l=n.video.segments.length,d=n.audio.segments.length;this.error({type:p.STRING.WARNING,code:p.ERROR.DURATION_DEVIATION_IS_TOO_LARGE,msg:"Video / audio duration deviation is too large, deviation: "+s+"s. Video qn:"+u+", segments:"+l+", duration:"+o+". Audio qn:"+c+", segments:"+d+", duration:"+a})}}if(this.state.startOffsetTime<t.startOffsetTime&&(this.state.startOffsetTime=t.startOffsetTime,t.segments&&t.segments.length)){var f=t.segments[0];f.duration,f.timescale,this.state.startOffsetTime>.1&&(this.player.seek(this.state.startOffsetTime+.2),this.error({type:p.STRING.WARNING,code:p.ERROR.START_OFFSET_TIME_WARNING,msg:e+" start offset time is greater than 0, "+this.state.startOffsetTime}))}}catch(e){this.error({msg:"Call onInitSegmentsLoaded function error",detail:e})}},e.prototype.setMaxAllowedBitrateFor=function(e,t){try{this.player.setMaxAllowedBitrateFor(e,t)}catch(e){this.error({msg:"Call setMaxAllowedBitrateFor function error",detail:e})}},e.prototype.videoInfoSchedule=function(){var e=this,t={},r={};try{var n=this.state,i=n.manifestInfo,o=n.currentQualityIndex,a=i.representation[p.STRING.VIDEO][o[p.STRING.VIDEO]]||{},s=i.representation[p.STRING.AUDIO][o[p.STRING.AUDIO]]||{},u=a.mimeType+';codecs="'+a.codecs+'"',c=this.getCurrentSegmentInfoFor(p.STRING.VIDEO),l=s.mimeType+';codecs="'+s.codecs+'"',d=this.getCurrentSegmentInfoFor(p.STRING.AUDIO),f=this.getDroppedFramesInfo(),h=this.getCurrentCodecID(p.STRING.VIDEO);t={width:a.width,height:a.height,sar:a.sar,mimeType:u+", "+l,fps:a.fps,videoDataRate:a.bandwidth,videoCodec:a.codecs,videoCodecID:h,audioDataRate:s.bandwidth,audioCodec:s.codecs,audioCodecID:0,audioSampleRate:s.audioSamplingRate||0,audioChannelCount:0},r={playerType:"DashPlayer",speed:Math.round(this.getAverageConnectionSpeed(p.STRING.VIDEO)),videoConnectionSpeed:Math.round(this.getAverageConnectionSpeed(p.STRING.VIDEO)),audioConnectionSpeed:Math.round(this.getAverageConnectionSpeed(p.STRING.AUDIO)),networkActivity:this.components.networkActivity&&this.components.networkActivity.getNetworkActivity(),videoBufferHealth:this.getBufferLength("video")||0,audioBufferHealth:this.getBufferLength("audio")||0,droppedFrames:f.droppedFrames||0,decodedFrames:f.totalFrames||0,audioURL:d.url||"",audioCurrentSegmentIndex:d.index||0,audioCurrentSegmentStartTime:d.startTime||0,audioCurrentSegmentDuration:d.duration||0,audioTotalSegmentCount:n.segmentsInfoMap[p.STRING.AUDIO].total||0,videoURL:c.url||"",videoCurrentSegmentIndex:c.index||0,videoCurrentSegmentStartTime:c.startTime||0,videoCurrentSegmentDuration:c.duration||0,videoTotalSegmentCount:n.segmentsInfoMap[p.STRING.VIDEO].total||0},this.state.mediaInfo=t,this.state.statisticsInfo=r,this.fire(p.EVENTS.VIDEO_INFO,{mediaInfo:t,statisticsInfo:r})}catch(e){}clearTimeout(this.timer&&this.timer.videoInfoSchedule),this.config&&this.config.videoInfoScheduleTime&&this.timer&&(this.timer.videoInfoSchedule=window.setTimeout((function(){e.videoInfoSchedule()}),this.config.videoInfoScheduleTime))},e.prototype.getQualityChangedData=function(e,t){var r={};try{var n=e.mediaType,i=e.type,o=e.newQuality,a=e.oldQuality,s=this.state.isAutoSwitch[n];r={mediaType:n,type:i,newQuality:o,newQualityNumber:this.getQualityNumberFromQualityIndex(o,n),oldQuality:a,oldQualityNumber:this.getQualityNumberFromQualityIndex(a,n),currentTime:this.getCurrentTime(),isAutoSwitch:s,dict:this.player.getThroughputDict("video")},p.EVENTS.QUALITY_CHANGE_RENDERED===i?((t=t||this.state.autoSwitchStartTime||0)&&(r.cost=Math.floor(Date.now()-t)),this.state.autoSwitchStartTime=0):p.EVENTS.QUALITY_CHANGE_REQUESTED===i&&(this.state.autoSwitchStartTime=Date.now())}catch(e){this.error({msg:"Call getQualityChangedData error",detail:e,type:p.STRING.WARNING})}return r},e.prototype.onVideoSwitchSourceEnded=function(e){try{var t=void 0;if(e&&e.target){var r=e.target.parentElement;t=r&&r.querySelectorAll("."+p.STRING.SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME)}else t=document.querySelectorAll("."+p.STRING.SWITCH_SOURCE_TREach((function(e){e&&e.parentElement.removeChild(e)}))}catch(e){console.error("Remove transition canvas error.",e)}},e.prototype.getStartOffsetTime=function(){var e=0;try{var t=this.state.segmentsInfoMap;t&&(e=Math.max(t.video.startOffsetTime||0,t.audio.startOffsetTime||0))}catch(e){}return e},e.prototype.setDebugLog=function(){try{var e=location.href;e&&e.indexOf("debug=1")>0&&this.player.getDebug().setLogToBrowserConsole(!0)}catch(e){}},e.prototype.getNextFragmentInfo=function(e){if(e&&e.mediaType){var t=e.mediaType;this.state.getNextFragmentHistory||(this.state.getNextFragmentHistory={video:[],audio:[]});var r=!1,n=this.state.getNextFragmentHistory[t].length;if(n){var i=this.state.getNextFragmentHistory[t][this.state.getNextFragmentHistory[t].length-1];for(var o in i)if(i[o]!==e[o]){r=!0;break}}!r&&n||(n>=30&&this.state.getNextFragmentHistory[e.mediaType].splice(0,1),this.state.getNextFragmentHistory[e.mediaType].push(e))}},e.prototype.onFragmentLoading=function(e){var t,r;if(e&&e.type){var n=e.type,i=e.request,o=this.covertFragmentInfoObject(i);if(o.loadingType=n,n===p.EVENTS.FRAGMENT_LOADING_STARTED)this.state.fragmentLoadingInfo[o.mediaType]=o;else if(n===p.EVENTS.FRAGMENT_LOADING_COMPLETED){var a=this.state.fragmentLoadingInfo[o.mediaType];o.isError=!!e.error;var s=e.response&&e.response.byteLength||0,u=Number(i.firstByteDate)-Number(i.requestStartDate);u=u?Math.max(u,1):1;var c=Number(i.requestEndDate)-Number(i.firstByteDate);c=c?Math.max(c,1):1;var l=Number(i.requestEndDate)-Number(i.requestStartDate);l=l?Math.max(l,1):1;var d=Math.round(8*s/l);o.latencyTime=u,o.downloadTime=c,o.totalTime=l,o.downloadBytes=s,o.connectionSpeed=d,o.data=e.response,o.totalSize=this.state.segmentsInfoMap[o.mediaType].rangeEnd+1;var f=!0;for(var h in a)if(a[h]!==o[h]&&"loadingType"!==h&&!isNaN(a[h])){f=!1;break}f&&(this.state.fragmentLoadingInfo[o.mediaType]=null,this.fire(p.EVENTS.FRAGMENT_LOADING_COMPLETED,o)),this.bpNCSaveData(o);var y=i.mediaType;"video"!==y&&"audio"!==y||this.recordRequestedInfoDetail(y,{code:200,qn:null==o?void 0:o.qn,index:null==o?void 0:o.index,rType:null===(t=null==i?void 0:i.loadInfo)||void 0===t?void 0:t.rType,protocol:null===(r=null==i?void 0:i.loadInfo)||void 0===r?void 0:r.protocol,currentTime:this.getCurrentTime(),buffered:this.getBufferLength(y),now:Math.round(null===performance||void 0===performance?void 0:performance.now()),latencyTime:u,downloadTime:c,totalTime:l,connectionSpeed:d,totalSize:s,retryTimes:null==i?void 0:i.retry,url:null==i?void 0:i.url})}else this.state.fragmentLoadingInfo&&this.state.fragmentLoadingInfo[o.mediaType]&&!this.state.fragmentLoadingInfo[o.mediaType].loaderType&&(this.state.fragmentLoadingInfo[o.mediaType].loaderType=o.loaderType),this.components.networkActivity&&this.components.networkActivity.onFragmentLoadingProgess(e)}},e.prototype.onFragmentLoadingError=function(e){if(e){if(e.type===p.EVENTS.REQUEST_RETRYED&&(null==e?void 0:e.code)<4e3)return;var t=null==e?void 0:e.mediaType;"video"!==t&&"audio"!==t||this.recordRequestedInfoDetail(t,{code:null==e?void 0:e.code,qn:(null==e?void 0:e.id)||(null==e?void 0:e.qn),index:null==e?void 0:e.index,rType:e.rType,retryTimes:e.retryTimes,currentTime:this.getCurrentTime(),buffered:this.getBufferLength(t),now:Math.round(null===performance||void 0===performance?void 0:performance.now()),latencyTime:null==e?void 0:e.timeout,downloadTime:(null==e?void 0:e.downloadTime)||(null==e?void 0:e.timeout),totalTime:(null==e?void 0:e.totalTime)||(null==e?void 0:e.timeout),totalSize:null==e?void 0:e.received,url:null==e?void 0:e.url})}},e.prototype.recordRequestedInfoDetail=function(e,t){var r,n,i,o;if(t&&this.state){(null===(r=this.state)||void 0===r?void 0:r.requestedInfoDetail[e])||(this.state.requestedInfoDetail[e]={latestHost:"",list:[]}),this.state.requestedInfoDetail[e].list.length>1e3&&this.state.requestedInfoDetail[e].list.shift();var a="-",s="443";try{var u=((null==t?void 0:t.url)||"").match(/^(?:https?:\/\/)?([^\/\n:]+)(?::(\d+))?/)
;u[2]&&(s=u[2]);var c=null===(n=u[1])||void 0===n?void 0:n.split(".");a=c.splice(0,c.length-2).join("."),"443"!==s&&(a+=":"+s);var l=this.state.requestedInfoDetail[e].latestHost;l&&l===a||(this.state.requestedInfoDetail[e].latestHost=a)}catch(e){}var d=t.qn||t.representationId;if(d){var p={id:this.state.requestedInfoRecordIndex++,co:t.code,qn:parseInt(d.toString().substr(-3),10),in:t.index,rt:(t.rType||"-").substr(0,1),qr:(t.protocol||"-").substr(0,1),ct:f.default.toFixed(t.currentTime||0,2),bf:f.default.toFixed(t.buffered||0,2),lt:t.latencyTime||0,dt:t.downloadTime||0,cs:t.connectionSpeed||0,ts:t.totalSize||0,ry:t.retryTimes||0,ht:a};null===(o=null===(i=this.state)||void 0===i?void 0:i.requestedInfoDetail[e])||void 0===o||o.list.push([p.id,p.co,p.qn,p.in,{"-":0,X:1,N:2,P:3}[p.rt]||0,{"-":0,T:1,Q:2}[p.qr]||0,p.ct,p.bf,p.lt,p.dt,p.cs,p.ts,p.ry,p.ht])}}},e.prototype.bpNCSaveData=function(e){if(e&&e.url&&e.range&&e.data){var t=this.getBPNC();if(t&&"function"==typeof t.allowDPSaveDataByNC){var r=(""+e.url).split("?")[0].split("/"),n=r[r.length-1].split(".")[0].split("-").pop();if(n){var i=parseInt(n,10);if(!isNaN(i)&&t.allowDPSaveDataByNC({qn:i})){var o={url:e.url,range:e.range,data:e.data,totalSize:e.totalSize,token:t.getToken()};t.saveData(o)}}}}},e.prototype.getBPNC=function(){var e,t="bpNC";return(null===(e=this.config)||void 0===e?void 0:e.hid)&&(t+="_"+this.config.hid),window[t]},e.prototype.covertFragmentInfoObject=function(e){var t={};try{t={type:e.type,mediaType:e.mediaType,startTime:e.startTime,url:e.url,index:e.index,id:e.representationId,qn:this.getQualityNumberFromQualityIndex(e.quality,e.mediaType),range:e.range,duration:e.duration,isError:!1},e.startLoadFragmentTime?t.startDownloadTime=new Date(e.startLoadFragmentTime).getTime():t.startDownloadTime=(new Date).getTime(),e.loadInfo&&(t.loaderType=e.loadInfo.rType)}catch(e){}return t},e.prototype.onDashJSLog=function(e){this.state.logHistory||(this.state.logHistory=[]),this.state.logHistory.length>=2e4&&this.state.logHistory.shift(),e&&this.state.logHistory.push(e.message)},e.prototype.onPredictSeek=function(e){this.fire(ap=function(e){this.fire(p.EVENTS.JUMP_MEDIA_GAP,e)},e.prototype.onDashCDNLoadInfo=function(e){var t,r,n,i,o,a,s,u,c;if(null==e?void 0:e.loadInfo){var l=e.loadInfo,d=null==e?void 0:e.mediaInfo.id;for(var f in d&&!this.state.cdnInfoDetail[d]&&(this.state.cdnInfoDetail[d]={cdn:0,p2p:0,nc:0,ncBr:0,pdn:0,business:0,mcdn:0,bcache:0,vcache:0,ncFail:0,ncGotFail:0}),this.state.cdnInfo)l[f]&&(this.state.cdnInfo[f]+=l[f],d&&(this.state.cdnInfoDetail[d][f]+=l[f]));if("XHR"===l.rType&&l.url&&l.cdn){var h=l.url;h.indexOf("upos-")>-1?(this.state.cdnInfo.business+=l.cdn,d&&(this.state.cdnInfoDetail[d].business+=l.cdn)):h.indexOf("os=mcdn")>-1?(this.state.cdnInfo.mcdn+=l.cdn,d&&(this.state.cdnInfoDetail[d].mcdn+=l.cdn)):h.indexOf("os=bcache")>-1?(this.state.cdnInfo.bcache+=l.cdn,d&&(this.state.cdnInfoDetail[d].bcache+=l.cdn)):h.indexOf("os=vcache")>-1&&(this.state.cdnInfo.vcache+=l.cdn,d&&(this.state.cdnInfoDetail[d].vcache+=l.cdn))}this.fire(p.EVENTS.CDN_LOAD_INFO,l)}if((null===(t=null==e?void 0:e.NCInfo)||void 0===t?void 0:t.responseData)&&this.state.NCInfo){var y=null==e?void 0:e.NCInfo,m=(d=y.qn,this.state.NCInfo[d]||{total:0,response:0,expect:0});if(9999===y.code){if(m.total++,y.range){var g=y.range.split("-"),v=parseInt(g[0],10),_=parseInt(g[1],10);_&&(m.expect+=_-v+1||0)}return void(this.state.NCInfo[d]=m)}if(m[y.code]||(m[y.code]={}),4999===y.code)return m[y.code].count=(null===(r=m[y.code])||void 0===r?void 0:r.count)+1||1,(null===(n=this.video)||void 0===n?void 0:n.seeking)&&(m[y.code].seeking=m[y.code].seeking+1||1),void(this.state.NCInfo[d]=m);var E=y.responseData,b=E.gotDataByte,S=E.getDataTime,T=E.usePeerSids,w=E.retryCount,A=E.originRange,R=E.gotDataByteFromBr;T=T||[],b=b||0,S=S||0,R=R||0,w=w||0,A&&A.hasOwnProperty("start")&&A.hasOwnProperty("end")||(A={start:0,end:0});var P=Math.abs(A.end-A.start)+1,D=(null==T?void 0:T.length)||0;if(m.response++,m[y.code].count=(null===(i=m[y.code])||void 0===i?void 0:i.count)+1||1,m[y.code].bytes=(null===(o=m[y.code])||void 0===o?void 0:o.bytes)+b||b,m[y.code].time=(null===(a=m[y.code])||void 0===a?void 0:a.time)+S||S,m[y.code].peers=(null===(s=m[y.code])||void 0===s?void 0:s.peers)+D||D,m[y.code].retry=(null===(u=m[y.code])||void 0===u?void 0:u.retry)+w||w,m[y.code].expect=(null===(c=m[y.code])||void 0===c?void 0:c.expect)+P||P,4003!==y.code&&40003!==y.code||0!==b||(m[y.code].abnormal=m[y.code].abnormal+1||1),2e3===y.code||24e3===y.code){var O="peers_"+D;m[y.code][O]=m[y.code][O]+1||1}this=function(e){return this.state.playbackState=e,this},e.prototype.saveNetworkWarningInfo=function(e){this.state.networkWarningHistory&&(this.state.networkWarningHistory||(this.state.networkWarningHistory=[]),this.state.networkWarningHistory.length>=100&&this.state.networkWarningHistory.shift(),this.state.networkWarningHistory.push(e))},e.prototype.detectDefaultQualityChangeAbnormal=function(){var e=this,t=this.state,r=t.defaultVideoQuality,n=t.defaultAudioQuality,i=t.currentQualityIndex,o=i.video,a=i.audio;return[{type:p.STRING.VIDEO,defaultQuality:r,currentIndex:o},{type:p.STRING.AUDIO,defaultQuality:n,currentIndex:a}].forEach((function(t){var r=e.getQualityNumberFromQualityIndex(t.currentIndex,t.type),n=t.defaultQuality,i=t.currentIndex;n>=0&&i>=0&&-1===[i,r].indexOf(n)&&e.fire(p.EVENTS.QUALITY_CHANGE_ABNORMAL,{type:p.EVENTS.QUALITY_CHANGE_ABNORMAL,mediaType:t.type,defaultQuality:n,currentIndex:i,qualityNumber:r})})),this},e.prototype.isUsingWasmPlayer=function(){return window.__ENABLE_WASM_PLAYER__&&this.video instanceof window.BwpElement},e.prototype.filterHEVCSpecialVideoUrl=function(e){var t=this;if("string"!=typeof e&&(null==e?void 0:e.video)){var r=this.state.defaultVideoQuality,n=[p.VIDEO_QN.QN_8K,p.VIDEO_QN.QN_DOLBY_VISION,p.VIDEO_QN.QN_HDR10],i=p.VIDEO_CODEC_ID.HEVC;((null==e?void 0:e.video)||[]).filter((function(e){return e.codecid===i})).length<=0||n.includes(r)||(e.video=e.video.filter((function(e){if(!n.includes(e.id))return!0;var r=t.state.filterVideoInfo,i=p.FILTER_VIDEO_URL_REASON.FILTER_SPECIAL_VIDEO;return void 0===r[i]&&(r[i]=[]),r[i].push(JSON.parse(JSON.stringify(e))),t.onDashJSLog({type:"filterSpecialVideo",message:"filter hevc special video urls"}),!1})))}},e.prototype.filterPdnUrl=function(t)eof e&&(e.includes("traceid")||e.includes(":8082"))},o=this.shouldFilterPdnUrl(),a=JSON.parse(e.getFawkesConfigValue(p.STRING.DASH_CONFIG,"pdn_disable_qn_list")),s=JSON.parse(e.getFawkesConfigValue(p.STRING.DASH_CONFIG,"pdn_disable_codecid_list")),u=!1,c=function(e){e&&e.length&&e.forEach((function(e){(i(e.baseUrl)||i(e.base_url))&&(o||a.includes(e.id)&&f.default.isInSpareTime()||s.includes(e.codecid)&&f.default.isInSpareTime())&&(u=!0,e.baseUrl&&e.backupUrl&&e.backupUrl.length&&(e.baseUrl=e.backupUrl.shift()),e.base_url&&e.backup_url&&e.backup_url.length&&(e.base_url=e.backup_url.shift()))}))};c(r),c(n),u&&this.onDashJSLog({type:"filterPdn",message:"["+Math.round(performance.now())+"] filter pdn, "+o+", qn list: "+a+", codec list: "+s})}},e.prototype.filterManifest=function(e){var t=e.manifest;e.log=this.onDashJSLog.bind(this),void 0===e.enableAV1&&(e.enableAV1=this.state.enableAV1),void 0===e.enableHEVC&&(e.enableHEVC=this.state.enableHEVC),t&&!t.video&&(this.onDashJSLog({type:"audio-only",message:"playing in audio-only"}),"string"!=typeof t&&(t.video=[]));var r=p.VIDEO_CODEC_ID.AVC;t&&t.video&&t.video instanceof Array&&(this.externalMediaLoader||(this.filterHEVCSpecialVideoUrl(e.manifest),r=g.applyCodecStrategy(e),t.video=t.video.filter((function(e){return e.codecid===r}))),t=this.adjustManifestHack(t));try{this.filterPdnUrl(t)}catch(e){}return{codecId:r,manifest:t}},e.prototype.shouldFilterPdnUrl=function(){try{var t=e.getFawkesConfigValue(p.STRING.DASH_CONFIG,"pdn_mid_black_list"),r=t&&JSON.parse(t)||[],n=f.default.getCookie("DedeUserID"),i=""===n?0:Number(n)
;if(Math.random()>Number(e.getFawkesConfigValue(p.STRING.DASH_CONFIG,p.STRING.PDN_ENABLE)))return!0;if(r.includes(i))return!0}catch(e){return!1}return!1},e.prototype.adjustManifestHack=function(e){var t;if((null===(t=null==e?void 0:e.video)||void 0===t?void 0:t.length)>1){var r=e.video,n=Math.max.apply(Math,r.map((function(e){return e.bandwidth}))),i=Math.min.apply(Math,r.map((function(e){return e.bandwidth})));if(Math.abs(n-i)<1e4){this.state&&this.state.logHistory.push("Adjust manifest hack, max: "+n+", min: "+i+", delta: "+Math.abs(n-i));for(var o=r.length-1;o>0;o--)r[o-1].bandwidth=Math.max(r[o-1].bandwidth,r[o].bandwidth+1e4)}}return e},e.prototype.processSpecialAudioItem=function(e,t){var r;void 0===t&&(t=30280),e.audio;var n=e.flac,i=e.dolby;if(n&&n.audio&&d.isFLACTypeSupported()&&t===p.FLAC_QN)return n.audio.codecs=n.audio.codecs.toLocaleLowerCase(),void(e.audio=[n.audio]);i&&(null===(r=null==i?void 0:i.audio)||void 0===r?void 0:r.length)&&d.isEC3DolbyATMOSTypeSupported()&&[p.DOLBY_AUDIO_QN.AMTOS,p.DOLBY_AUDIO_QN.AUDIO].includes(t)&&(e.audio=s(i.audio))},e.prototype.checkAudioCodecCanUseByType=function(e){var t=this.state.mpd&&this.state.mpd[p.STRING.AUDIO]?this.state.mpd[p.STRING.AUDIO]:this.state.manifest&&this.state.manifest.audio?this.state.manifest.audio:void 0;if(!t||!t.length)return!1;switch(e){case p.SPECIAL_AUDIO_TYPE.DOLBY:if(d.isDOLBY_AUDIO_QN.AUDIO||e.id===p.DOLBY_AUDIO_QN.AMTOS}));break;case p.SPECIAL_AUDIO_TYPE.FLAC:if(d.isFLACTypeSupported())return-1!==t.findIndex((function(e){return e.id===p.FLAC_QN}))}return!1},e.prototype.qualityNumberDowngrading=function(e,t){var r=f.default.getDecodeErrorMediaQualityNumberListForType(e,p.STRING.BILIBILI_DECODE_ERROR_OBJ),n=Object.keys(this.state.qualityNumberMap[e]).map(Number).reverse(),i=0;if(r.length>0){for(;r.includes(t)&&i<n.length;)t=n[i++];if(r.includes(t))return-1}return t},e.EVENTS=p.EVENTS,e.ERROR=p.ERROR,e.STRING=p.STRING,e.BUFFERING=y.BUFFERING,e.CONFIG=l.CONFIG,e.ERROR_CODE=p.ERROR_CODE,e.isHEVCTypeSupported=d.isHEVCTypeSupported,e.isBwpHEVCPrefSupported=d.isBwpHEVCPrefSupported,e.isHEVCHDR10TypeSupported=d.isHEVCHDR10TypeSupported,e.isEC3DolbyATMOSTypeSupported=d.isEC3DolbyATMOSTypeSupported,e.isHEVCDolbyVisionTypeSupported=d.isHEVCDolbyVisionTypeSupported,e.isHEVC8kTypeSupported=d.isHEVC8kTypeSupported,e.isAV1TypeSupported=d.isAV1TypeSupported,e.isAV18KTypeSupported=d.isAV18KTypeSupported,e.is8KTypeSupported=d.is8KTypeSupported,e.getSupportedVideoIdList=d.getSupportedVideoIdList,e.shouldUseHardwareDecodingAV1=d.shouldUseHardwareDecodingAV1,e.isFLACTypeSupported=d.isFLACTypeSupported,e.getVideoCodecStrategy=d.getVideoCodecStrategy,e.isMultiAudioTracksSupported=d.isMultiAudioTracksSupported,e.shouldUseNativeHEVCDecode=d.shouldUseNativeHEVCDecode,e.fawkesConfig=null,e}();t.default=b},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.rmLocalDecodeErrorInfo=t.setLocalDecodeErrorInfo=t.getLocalDecodeErrorInfo=t.getCPULogicCount=t.getOS=t.shouldUseNativeHEVCDecode=t.isMultiAudioTracksSupported=t.getVideoCodecStrategy=t.isFLACTypeSupported=t.shouldUseHardwareDecodingAV1=t.isBrowserSupportHardwareDecodeAV1=t.getSupportedVideoIdList=t.is8KTypeSupported=t.isAV18KTypeSupported=t.isBrowserSupportAV1=t.isMIMETypeSupported=t.isAV1TypeSupported=t.isHEVC8kTypeSupported=t.isHEVCDolbyVisionTypeSupported=t.isEC3DolbyATMOSTypeSupported=t.isHEVCHDR10TypeSupported=t.isBwpHEVCPrefSupported=t.isHEVCTypeSupported=void 0;var i=r(2),o=r(6),a=n(r(4)),s=r(12);t.isHEVCTypeSupported=function(){return"1"!==a.default.getSessionStorage("enableHEVCError")&&(!!window.__ENABLE_WASM_PLAYER__||window.MediaSource&&window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="hev1.1.6.L120.90"'))},t.isBwpHEVCPrefSupported=function(){if("1"===a.default.getSessionStorage("enableHEVCError"))return!1;switch(s.getUserCodecPreferType()){case i.USER_CODEC_PREFER_TYPE.HEVC:return!0;case i.USER_CODEC_PREFER_TYPE.AV1:case i.USER_CODEC_PREFER_TYPE.DISABLE:return!1;default:var e=parseInt(a.default.getLocalStorage("bilibili_player_codec_prefer_strategy"),10);return i.USER_CODEC_PREFER_TYPE.DISABLE!==e}};var u=function(e){var t,r,n,i;if("1"===a.default.getSessionStorage("enableHEVCError"))return!1;var s=!1,u=null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase(),c=u.indexOf("safari")>-1&&u.indexOf("chrom")<0,l=0,d=u.match(/version\/\d+/);c&&d&&d.length&&(l=Number(d[0].substr(8)));var f=u.indexOf("edge/")>-1,p=0,h=u.match(/edge\/\d+/);f&&h&&h.length&&(p=Number(h[0].substr(5)));var y=(null==e?void 0:e.codec)||"hev1.2.4.H150.90",m=window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="'+y+'"'),g=null===(n=window.matchMedia("(color-gamut:p3)"))||void 0===n?void 0:n.matches,v=(null===(i=window.screen)||void 0===i||i.colorDepth,parseInt(a.default.getLocalStorage("bilibili_player_force_hdr"),10)),_=o.getCurrentBrowserInfo(),E=_.type,b=_.version;return m&&(c&&g&&l>=13||f&&p>=18||g&&"Chrome"===E&&b>=104||v)&&(s=!0),s};t.isHEVCHDR10TypeSupported=u;var c=function(e){var t=window.MediaSource;return t&&!!t.isTypeSupported(e)};t.isMIMETypeSupported=c;var l=function(e){var t,r,n,i;if("1"===a.default.getSessionStorage("enableHEVCError"))return!1;var s=null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase(),u=o.getSafariInfo(s),l=o.getEdgeInfo(s),d=!1;if(e&&e.codec)d=c('video/mp4; codecs="'+e.codec+'"');else{var f=c('video/mp4; codecs="hev1.1.6.L153.90"'),p=c('video/mp4; codecs="dvh1.05.06"');d=f&&p}var h=parseInt(a.default.getLocalStorage("bilibili_player_force_hdr"),10);if(!d)return!1;var y=!1;u.isSafari&&(y=(null===(n=window.matchMedia("(color-gamut:p3)"))||void 0===n?void 0:n.matches)&&u.version>=13||!1),l.isEdge&&(y=l.version>=18);var m=o.getCurrentBrowserInfo(),g=m.type,v=m.version;return"Chrome"===g&&(y=(null===(i=window.matchMedia("(color-gamut:p3)"))||void 0===i?void 0:i.matches)&&v>=104||!1),!!h||y};t.isHEVCDolbyVisionTypeSupported=l,t.isEC3DolbyATMOSTypeSupported=function(){var e,t,r=c('audio/mp4; codecs="ec-3"'),n=null===(t=null===(e=window.navigator)||void 0===e?void 0:e.userAgent)||void 0===t?void 0:t.toLowerCase(),i=o.getSafariInfo(n),a=o.getEdgeInfo(n);return!!r&&(i.isSafari&&i.version>=13||a.isEdge)};var d=function(e){var t=(null==e?void 0:e.width)||7680,r=(null==e?void 0:e.height)||4320,n=(null==e?void 0:e.codec)||"hev1.1.6.L180.90";if(!c('video/mp4;codecs="'+n+'";width='+t+";height="+r))return!1;var i=o.getSafariInfo();return!!parseInt(a.default.getLocalStorage("bilibili_player_force_8k"),10)||i.isSafari&&i.version>=13};t.isHEVC8kTypeSupported=d;var f=function(e){var t=o.getCurrentBrowserInfo(),r=t.type,n=t.version;return e="number"==typeof e?e:4e3,r===o.BROWSER_TYPE.ChromiumEdge&&n>=79||r===o.BROWSER_TYPE.Chrome&&n>=70||r===o.BROWSER_TYPE.Firefox&&n>=67||r===o.BROWSER_TYPE.QQ&&n>=70&&e<=4e3};t.isBrowserSupportAV1=f,t.isAV1TypeSupported=function(e){if(!window||!window.MediaSource||!window.MediaSource.isTypeSupported)return!1;if(!f())return!1;var t="av01.0.08M.08.0.110.01.01.01.0";if(!e)return c('video/mp4;codecs="'+t+'";');var r=e.width,n=e.height;return c('video/mp4;codecs="'+t+'";width='+r+";height="+n)};var p=function(e){var t=(null==e?void 0:e.width)||7680,r=(null==e?void 0:e.height)||4320,n=(null==e?void 0:e.codec)||"av01.0.16M.08.0.110.01.01.01.0";return!!c('video/mp4;codecs="'+n+'";width='+t+";height="+r)&&(!!parseInt(a.default.getLocalStorage("bilibili_player_force_8k"),10)ed=p,t.is8KTypeSupported=function(){return p()||d()},t.getSupportedVideoIdList=function(e,t,r){try{var n=[],o="boolean"!=typeof(null==t?void 0:t.enableHEVC)||t.enableHEVC,a="boolean"!=typeof(null==t?void 0:t.enableAV1)||t.enableAV1,s=function(e){return-1!==e.indexOf("av01")?i.VIDEO_CODEC_ID.AV1:-1!==e.indexOf("hev")||-1!==e.indexOf("dvh")?i.VIDEO_CODEC_ID.HEVC:i.VIDEO_CODEC_ID.AVC},f=function(e){return e&&e instanceof Array&&e.length>0},h=function(e,t,r,n){
for(var o=n[0],a=n[1],u=0,c=e;u<c.length;u++){var l=c[u],f=s(l);if(f===i.VIDEO_CODEC_ID.AV1&&a&&p({codec:l})){t.push(r);break}if(f===i.VIDEO_CODEC_ID.HEVC&&o&&d({codec:l})){t.push(r);break}}},y=function(e,t,r,n){for(var i=0,o=e;i<o.length;i++)if(n({codec:o[i]})){t.push(r);break}};if(!f(of r?r:0,g=e.filter((function(e){return e.quality>m}));if(g.length<=0)return n;for(var v=0,_=g;v<_.length;v++){var E=_[v],b=E.quality,S=E.codecs;if(f(S))if([i.VIDEO_QN.QN_DOLBY_VISION,i.VIDEO_QN.QN_HDR10,i.VIDEO_QN.QN_8K].includes(b))if(i.VIDEO_QN.QN_8K===b)(o||a)&&h(S,n,b,[o,a]);else{if(!o)continue;y(S,n,b,i.VIDEO_QN.QN_DOLBY_VISION===b?l:u)}else for(var T=0,w=S;T<w.length;T++){var A=w[T];if(c('video/mp4;codecs="'+A+'";')){n.push(b);break}}else n.push(b)}return n}catch(e){return[]}};var h=function(){var e=o.getCurrentBrowserInfo(),t=e.type,r=e.version;return t===o.BROWSER_TYPE.ChromiumEdge&&r>=79||t===o.BROWSER_TYPE.Chrome&&r>=70};t.isBrowserSupportHardwareDecodeAV1=h,t.shouldUseHardwareDecodingAV1=function(){if(!h())return!1;var e=o.getGPUInfo().toLowerCase();return!!Object.values({rtx3xx:/rtx 3[0-9]{3}/,m1max:/m1 max/}).some((function(t){return t.test(e)}))},t.isFLACTypeSupported=function(){var e,t,r=c('audio/mp4; codecs="flac"'),n=null===(t=null===(e=window.navigator)||void 0===e?void 0:e.userAgent)||void 0===t?void 0:t.toLowerCase(),i=o.getSafariInfo(n);return!!r&&(i.isSafari&&i.version>=13||r)},t.getVideoCodecStrategy=function(e){return s.applyCodecStrategy(e)},t.isMultiAudioTracksSupported=function(){var e=o.getCurrentBrowserInfo(),t=e.type,r=e.version;return t===o.BROWSER_TYPE.ChromiumEdge&&r>=79||t===o.BROWSER_TYPE.Chrome&&r>=69||t===o.BROWSER_TYPE.Firefox&&r>=67||t===o.BROWSER_TYPE.QQ&&r>=69||t===o.BROWSERt(e)?r="Android":!r&&/Linux/.=function(){return navigator.hardwareConcurrency||0},t.shouldUseNativeHEVCDecode=function(){var e=o.getCurrentBrowserInfo().type,t="Mac OS"===y(),r=c('video/mp4; codecs="hev1.1.6.L120.90"');return e===o.BROWSER_TYPE.ChromiumEdge?t&&r:r},t.getLocalDecodeErrorInfo=function(e){var t="decode"+e+"Error",r=a.default.getLocalStorage(t);return r?JSON.parse(r):null},t.setLocalDecodeErrorInfo=function(e,t){var r="decode"+e+"Error";a.default.setLocalStorage(r,JSON.stringify(t))},t.rmLocalDecodeErrorInfo=function(e){var t="decode"+e+"Error";a.default.removeStorage(t)}},function(et||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getUserCodecPreferType=t.applyCodecStrategy=void 0;var i=r(2),o=r(6),a=n(r(4)),s=r(11),u="bilibili_player_codec_prefer_type",c={HARDWARE:i.VIDEO_QN.QN_4K,SOFTWARE:i.VIDEO_QN.QN_1080P_60},l=[i.VIDEO_QN.QN_8K],d={HARDWARE:i.VIDEO_QN.QN_4K,SOFTWARE:i.VIDEO_QN.QN_1080P_PLUS,WASM:i.VIDEO_QN.QN_1080P_60},f=[i.VIDEO_QN.QN_HDR10,i.VIDEO_QN.QN_DOLBY_VISION,i.VIDEO_QN.QN_8K];function p(){return parseInt(a.default.getLocalStorage(u),10)||i.USER_CODEC_PREFER_TYPE.RECOMMEND}function h(){return new Promise((function(e,t){var r="bilibili_player_codec_prefer_reset",n="1.5.2";a.default.getLocalStorage(r)!==n?(a.default.setLocalStorage(r,n),e()):t()}))}t.applyCodecStrategy=function(e){var t,r,n=e.state,y=e.manifest,m=e.enableAV1,g=e.enableHEVC,v=e.log,_=e.defaultVideoQn,E=i.VIDEO_CODEC_ID.HEVC,b=i.VIDEO_CODEC_ID.AV1,S=i.VIDEO_CODEC_ID.AVC,T=n?n.defaultVideoQuality:_;T=T||0;var w=-1,A=-1,R=!1,P=!1,D=y.video,O=y.duration;if(D&&D.forEach((function(e){e.codecid===b&&(w=s.isMIMETypeSupported('video/mp4;codecs="'+e.codecs+'";')?1:0,e.id!==T&&0!==T||(R=!0)),e.codecid===E&&(A=s.isMIMETypeSupported('video/mp4;codecs="'+e.codecs+'";')?1:0,e.id!==T&&0!==T||(P=!0))})),v&&v({type:"UA",message:""+(null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase())}),v&&v({type:"abilityDetect",message:"[0]Ability: isAV1CodecSupported: "+w+", isAV1HasCurrentQn: "+R+"        isHEVCCodecSupported: "+A+", isHEVCHasCurrentQn: "+P}),1===w&&R&&function(e,t,r,n,o){var u=e;if(u){var d=0;t&&t.defaultVideoQuality?d=t.defaultVideoQuality:"number"==typeof o&&(d=o);var f=c.HARDWARE,h=c.SOFTWARE;d>(s.shouldUseHardwareDecodingAV1()?f:h)&&(u=!1);var y=p();switch(y){case i.USER_CODEC_PREFER_TYPE.AV1:u=!0;break;case i.USER_CODEC_PREFER_TYPE.DISABLE:case i.USER_CODEC_PREFER_TYPE.HEVC:u=!1}var m=s.getLocalDecodeErrorInfo("AV1"),g=(new Date).getTime();m&&(m.reactivateTime||0)>g&&(u=!1),l.includes(d)&&(u=!0),s.isBrowserSupportAV1(r)||(u=!1);var v=!!+a.default.getSessionStorage("enableAV1Error");v&&(u=!1),n&&n({type:"applyAV1Strategy",message:"[1] Apply AV1 strategy, enable: "+u+", preferType: "+y+", hardwareLimit: "+f+", softwareLimit: "+h+", prevEnableAV1Error: "+v})}return u}(m,n,O,v,_))return b;var I=!!window.__ENABLE_WASM_PLAYER__;return(1===A||I)&&P&&function(e,t,r,n){var c=e;if(c){var l=navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase(),y=l.indexOf("edge/")>-1,m=t&&t.defaultVideoQuality||n,g=d.SOFTWARE,v=d.HARDWARE,_=d.WASM,E=o.getCurrentBrowserInfo(),b=E.type,S=E.version,T=b===o.BROWSER_TYPE.Chrome&&S>108&&s.getCPULogicCount()>=8?v:g,w=m>T&&!y&&l.indexOf("chrome/")>0,A=m>v,R=b===o.BROWSER_TYPE.ChromiumEdge,P=!!+a.default.getSessionStorage("enableHEVCError"),D=parseInt(a.default.getLocalStorage("bilibili_player_codec_prefer_strategy"),10);window.__ENABLE_WASM_PLAYER__?m>_&&(c=!1):(w||A)&&(c=!1);var O=p();i.USER_CODEC_PREFER_TYPE.HEVC===O?c=!0:i.USER_CODEC_PREFER_TYPE.DISABLE===O||i.USER_CODEC_PREFER_TYPE.AV1===O?(c=!1,h().then((function(){a.default.setLocalStorage(u,""+i.USER_CODEC_PREFER_TYPE.RECOMMEND)})).catch((function(){}))):(h().catch((function(){})),i.USER_CODEC_PREFER_TYPE.DISABLE===D&&(c=!1));var I=s.getLocalDecodeErrorInfo("HEVC"),C=(new Date).getTime();I&&(I.reactivateTime||0)>C&&(c=!1),f.includes(m)&&(c=!0),(!window.__ENABLE_WASM_PLAYER__&&R&&"Mac OS"!==s.getOS()||P)&&(c=!1),r&&r({type:"applyHEVCStrategy",message:"[1] Apply HEVC strategy, enable: "+c+", preferType: "+O+", hardwareLimit: "+v+", softwareLimit: "+T+", wasm: "+_+", prevEnableHEVCError: "+P+", strategyType: "+D})}return c}(g,n,v,_)?E:S},t.getUserCodecPreferType=p},fun(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.BUFFERING=void 0;var i=r(2);t.BUFFERING={PLAYBACK:{PLAYING:1,SEEKING:2,SWITCHING_QUALITY:3,SWITCHING_SOURCE:4,UPDATING_SOURCE:5,APPENDING_SOURCE:6},TYPE:{UNKNOWN:0,SEEKING:10,SEEKING_INSIDE_BUFFERED:11,SEEKING_OUTSIDE_BUFFERED:12,NETWORK:20,NETWORK_CONNECT_TIMEOUT:21,NETWORK_READING_TIMEOUT:22,NETWORK_DOWNLOAD_TIMEOUT:23,NETWORK_DOWNLOAD_ERROR:24,NETWORK_POOR:25,NETWORK_POOR_UNDER_PLAYBACKRATE:26,NETWORK_DOWNLOAD_TOO_LONG:27,MEDIA:30,MEDIA_ERR_ABORTED:31,MEDIA_ERR_NETWORK:32,MEDIA_ERR_DECODE:33,MEDIA_ERR_SRC_NOT_SUPPORTED:34,MEDIA_DECODING_PERFORMANCE:35,GAP:40,GAP_BEFORE_CURRENT:41,GAP_AFTER_CURRENT:42,PERFORMANCE:50,PERFORMANCE_UNKNOWN:51,INTERNAL:60,INTERNAL_STARTING:61,INTERNAL_ENDING:62,INTERNAL_UNNORMAL_RANGES:63,INTERNAL_VIDEO_Rdeo=e,this.swichingInfo=nuingInfo=null,this.downloadInfo=null,this.video=null},e.prototype.setSwitchingInfo=function(e){if(this.swichingInfo=e,e&&this.video&&this.video.buffered&&this.video.buffered.length>0){var t=this.video.buffered.end(this.video.buffered.length-1),r=this.video.currentTime,n=Math.floor(1e3*(t-r))/1e3;this.swichingInfo.bufferLen=n}},e.prototype.getInfo=function(e){var r={type:-1};if(!e)return r;try{
var i=this.video,o=i.currentTime,a=i.duration,s=i.readyState,u=i.buffered,c=u&&u.length,l=i.seeking,d=i.playbackRate,f=t.BUFFERING.TYPE.UNKNOWN,p=e.playbackState||t.BUFFERING.PLAYBACK.PLAYING;if(!l||p!==t.BUFFERING.PLAYBACK.PLAYING&&p!==t.BUFFERING.PLAYBACK.SWITCHING_QUALITY||(p=t.BUFFERING.PLAYBACK.SEEKING),r={type:f,isSeeking:l,cTime:o,duration:a,rState:s,nRanges:c,vLength:e.videoBufferLength,aLength:e.audioBufferLength,activity:e.networkActivity,vSpeed:Math.round(e.videoSpeed),aSpeed:Math.round(e.audioSpeed),playbackRate:d,vQn:e.videoCurrentQn,aQn:e.audioCurrentQn,retryTimes:e.retryTimes,seekSpace:e.seekSpace},p===t.BUFFERING.PLAYBACK.SEEKING)f=0===c?t.BUFFERING.TYPE.SEEKING_OUTSIDE_BUFFERED:t.BUFFERING.TYPE.SEEKING_INSIDE_BUFFERED;else{var h=this.checkGapInfo(),y=h.nativeBufferLength;if(r.nLength=y,r.cRange=h.start+"-"+h.end,h.hasGap)f=h.type,r.gap=h.gapStart+"-"+h.gapEnd,r.gapLength=h.gapLength;else if(y<1){var m=this.checkLackOfBufferInfo(e);f=m.type,r.vCode=m.videoErrorCode,r.aCode=m.audioErrorCode}else f=s>=3?t.BUFFERING.TYPE.PERFORMANCE:t.BUFFERING.TYPE.PERFORMANCE_UNKNOWN}var g=this.checkNativeErrorInfo();g.type&&(f=g.type,r.nCode=g.code);var v=e.fragmentLoadingInfo;if(v&&v.video){var _=v.video;r.vFragment=_.id+"-"+_.index,e.latestPlayurlErrorHTTPCode&&(r.hCode=e.latestPlayurlErrorHTTPCode)}v&&v.audio&&(_=v.audio,r.aFragment=_.id+"-"+_.index,e.latestPlayurlErrorHTTPCode&&(r.hCode=e.latestPlayurlErrorHTTPCode)),r.type=""+p+(f||"00")}catch(e){throw new Error(e.message)}return this.swichingInfo&&(r=n(n({},r),this.swichingInfo)),this.downloadInfo&&(r=n(n({},r),this.downloadInfo)),r},e.prototype.checkGapInfo=function(){var e=this.video,r=e.currentTime,n=e.buffered,i=n&&n.length,o=0,a=!1,s=0,u=0,c={start:0,end:0},l=0,d=t.BUFFERING.TYPE.UNKNOWN;if(i&&i>1)for(var f=0;f<i;f++){var p=n.start(f),h=n.end(f);p<=r&&h>=r&&(o=Math.floor(1e3*(h-r))/1e3,c={start:p,end:h},d===t.BUFFERING.TYPE.GAP_BEFORE_CURRENT?u=p:s=h),p>r&&p-r<=1&&d!==t.BUFFERING.TYPE.GAP_BEFORE_CURRENT&&(a=!0,d=t.BUFFERING.TYPE.GAP_AFTER_CURRENT,u=u?Math.min(u,p):p,s=c.end),r-h<3&&r-h>=0&&(a=!0,d=t.BUFFERING.TYPE.GAP_BEFORE_CURRENT,s=h,u=c.start)}else 1===i&&(h=n.end(0),c={start:n.start(0),end:h},o=Math.floor(1e3*(h-r))/1e3);return a&&(l=Math.round(1e3*(u-s))/1e3),{type:d,start:c.start,end:c.end,nativeBufferLength:o,hasGap:a,gapStart:s,gapEnd:u,gapLength:l}},e.prototype.checkLackOfBufferInfo=function(e){var r=t.BUFFERING.TYPE.UNKNOWN,n=this.video,i=n.currentTime,o=n.buffered,a=n.duration,s=n.readyState,u=0,c=0;if(o&&o.length)if(a&&a-i<1)r=t.BUFFERING.TYPE.INTERNAL_ENDING;else{var l=this.checkNetworkInfo(e);r=l.type,u=l.videoErrorCode,c=l.audioErrorCode}else r=i<=e.startOffsetTime&&s<=1?t.BUFFERING.TYPE.INTERNAL_STARTING:(e.networkActivity.length&&e.networkActivity.reduce((function(e,t){return e+t})))<100?t.BUFFERING.TYPE.NETWORK_POOR:e.videoBufferLength?e.audioBufferLength?t.BUFFERING.TYPE.INTERNAL_UNNORMAL_RANGES:t.BUFFERING.TYPE.INTERNAL_AUDIO_RANGES:t.BUFFERING.TYPE.INTERNAL_VIDEO_RANGES;return{type:r,videoErrorCode:u,audioErrorCode:c}},e.prototype.checkNetworkInfo=function(e){var r=this,n=t.BUFFERING.TYPE.UNKNOWN,o=this.video.currentTime,a=e.videoBufferLength||0,s=e.audioBufferLength||0,u=e.networkWarningHistory,c=this.getCurrentNetworkWarningInfo({mediaType:i.STRING.VIDEO,currentQn:e.videoCurrentQn,networkWarningHistory:u,warningTime:o+a,bufferLength:a},1),l=this.getCurrentNetworkWarningInfo({mediaType:i.STRING.AUDIO,currentQn:e.audioCurrentQn,networkWarningHistory:u,warningTime:o+s,bufferLength:s},1),d=c.code,f=l.code,p=this.getBufferingTypeByPoorNetwork(d),h=this.getBufferingTypeByPoorNetwork(f);if(p||h)n=p||"00",h&&(n=""+n+h);else if(this.video.playbackRate>1)n=t.BUFFERING.TYPE.NETWORK_POOR_UNDER_PLAYBACKRATE;else{var y=e.fragmentLoadingInfo,m=function(e){if(!e)return!1;var t=e.startDownloadTime,n=e.loaderType,i=e.qn,o=e.index,a=((new Date).getTime()-t)/1e3;return r.downloadInfo||(r.downloadInfo={}),r.downloadInfo[e.mediaType]={downloadTime:a,loaderType:n,qn:i,index:o},a>5};if(y){var g=y.video,v=y.audio,_=m(g),E=m(v);n=_||E?t.BUFFERING.TYPE.NETWORK_DOWNLOAD_TOO_LONG:t.BUFFERING.TYPE.NETWORK}else n=t.BUFFERING.TYPE.NETWORK}return{type:n,videoErrorCode:d,audioErrorCode:f,videoBufferLength:a,audioBufferLength:s}},e.prototype.checkNativeErrorInfo=function(){var e=this.video.error,r=e&&e.code||0,n=t.BUFFERING.TYPE.UNKNOWN;if(e&&r)switch(r){case 1:n=t.BUFFERING.TYPE.MEDIA_ERR_ABORTED;break;case 2:n=t.BUFFERING.TYPE.MEDIA_ERR_NETWORK;break;case 3:n=t.BUFFERING.TYPE.MEDIA_ERR_DECODE;break;case 4:n=t.BUFFERING.TYPE.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:n=t.BUFFERING.TYPE.MEDIA}return{type:n,code:r}},e.prototype.getCurrentNetworkWarningInfo=function(e,t){if(void 0===t&&(t=1),!e)return{code:0};var r=e.mediaType,n={code:0,type:"",mediaType:e.mediaType},i=e.networkWarningHistory,o=e.warningTime,a=e.bufferLength,s=e.currentQn;if(i.length&&a<t){o+=t;try{var u=i.filter((function(e){return e.mediaType===r&&e.startTime<=o+t&&e.startTime+e.duration>=o&&e.id===s.toString()}));u.length&&(n=u[u.length-1])}catch(e){throw new Error("getCurrentNetworkWarningInfo error, "+JSON.stringify(e))}}return n},e.prototype.getBufferingTypeByPoorNetwork=function(e){var r=t.BUFFERING.TYPE.UNKNOWN;if(e)switch(e){case i.ERROR.CONNECT_FRAGMENT_ERROR_TIMEOUT:r=t.BUFFERING.TYPE.NETWORK_CONNECT_TIMEOUT;break;case i.ERROR.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT:r=t.BUFFERING.TYPE.NETWORK_DOWNLOAD_TIMEOUT;break;case i.ERROR.DOWNLOAD_FRAGMENT_ERROR:r=t.BUFFERING.TYPE.NETWORK_DOWNLOAD_ERROR}return r},e}();t.default=o},function(e,t,r){"use strict";var n=Array.isArray,i=Obj++)if(!e(t[u=y[a]],r[u]))return!1;return!0}return!1}},function(e,t,r){!function(e){"use strict";var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,20.hasOwnProperty(e)&&(r=t[e]),String.fromCharCode(r)},n=15,i=32,o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},a={17:2,18:4,21:6,22:8,23:10,19:13,20:15},s={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},u={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],l={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:nullrbo0;s=r||!1,this.backgris.italics++){var n=his.itahis.bics,this. backgro){this.uchar=e||" set:funcar:function(e,t){this.uchar=e,this.penState.copy(t)},ss.uch){this.u){returhars.push(new p);this.pos=0,this.currPenState=new f};h.prototype={equals:function(e){for(var t=!0,r=0;r<i;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},copy:function(e){for(var t=0;t<i;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<i;t++)if(!thi,"Too larger].setPenSthis.chars[s].setChar(t,tion(elearFromPos(0),tarToEndOfRow:far;" "!==n&&(this.chthis.currRow=14,thiar e=0;this.e){for(vt++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){unction(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e)r:functionetCursoitalics,bacthis.backSpace(),this.setPen(e),this.insertChar(32)},slog("DEBUG","roength>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},splayedMemory,this.mode=null,this.cueStartTime=null};m.prototype={modes:["MODE_ROLL-ull,this.cueStartTime=null,this.lastCueEndTime=null},getHantFilter},setHandler:function(e){this.outputFilter=e},setPAtBkgData.nonDisplayeMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){l.log("INFO","RCL - Resume en===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){l.log("INFO","DER- Delete to End of Row"),this.writeScre("MODEON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){l.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){ion(){lhis.di),this.-displayedMem+e+") - TaOW: "+JSON.stringe,this.lastOutptTime,e,this.dataCounters={padder:functionandler:f "+d([t[a,this.lastCm])+")"),t,this.lastCmd,n.color="white"):n.indent=4*Math.floor((r-16)/2),n},parseChars:function(e,t){var n,i=null,o=null,a=null;(e>=25?(i=2,a=e-8):(i=1,a=e),17<=a&&a<=19)?(n=17===a?t+80:18===a?t+112:t+144,l.log("INFO","Special char '"+r(n)+"' in channel "+i),o=[n],this.lastCmdA=e,this.lastCmdB=t):32<=e&&e<=127&&(o=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null);if(o){var s=d(o);l.log("DEBUG","Char codes =].setBls[e].reset();this.channels[t]&&this.channels[t].cueSplitAtTime(e)}},e.logger=l,e.PenState=f,,s++;a(u,l,e,s)&&o.push([s,l]sh(l)):1===u&&(n[1].push(c),n[1].push(l)))}return n}}(t)},function(e,t,r){var n=r(23).lease:"2023-11-07T06:57:39.112Z",mode:"production"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.state={runningInterval:1e3,maxCacheLength:200,fragmentLoadingProgressInfo:{},networkActivityLoadedList:[],networkActivityHistory:[],networkActivityLatestTraceTime:0},this.initalize()}return e.prototype.onFragmentLoadingProgess=function(e){var t=e.request,r=0,n=Math.floor(performance.now()),i=t.quality+"-"+t.index+"-"+t.ts,o=!1;if(this.state.fragmentLoadingProgressInfo[t.mediaType]&&this.state.fragmentLoadingProgressInfo[t.mediaType][i]){var a=this.state.fragmentLoadingProgressInfo[t.mediaType][i],s=!1;for(var u in a)if("bytesLoaded"!==u&&a[u]!==t[u])s=!0;else if(a.bytesLoaded===t.bytesLoaded)return;r=s?t.bytesLoaded:t.bytesLoaded-a.bytesLoaded}else this.state.fragmentLoadingProgressInfo[t.mediaType]||(this.state.fragmentLoadingProgressInfo[t.mediaType]={}),r=t.bytesLoaded;t.bytesLoaded===t.bytesTotal&&(o=!0),o?delete this.state.fragmentLoadingProgressInfo[t.mediaType][i]:this.state.fragmentLoadingProgressInfo[t.mediaType][i]={bytesLoaded:t.bytesLoaded,bytesTotal:t.bytesTotal,quality:t.quality,index:t.index,mediaType:t.mediaType,range:t.range},this.state.networkActivityLoadedList.length>=this.state.maxCacheLength&&this.state.networkActivityLoadedList.splice(0,1),r&&this.state.networkActivityLoadedList.push({time:n,loaded:Math.max(r,0)})},e.prototype.getNetworkActivity=function(){return this.state.networkActivityHistory.length?this.state.networkActivityHistory[this.state.networkActivityHistory.length-1]:0},e.prototype.getNetworkActivityHistory=function(e){return void 0===e&&(e=0),e?this.state.networkActivityHistory.slice(this.state.networkActivityHistory.length-e):this.state.networkActivityHistory},e.prototype.destroy=function(){clearTimeout(this.state&&this.state.networkActivityTimer),this.state.networkActivityLoadedList.length=0,this.state.networkActivityHistory.length=0,this.state=null},e.prototype.initalize=function(){this.runNewWorkActivityTimer()},e.prototype.runNewWorkActivityTimer=function(){var e=this;this.runNetworkActivity(),clearTimeout(this.state.networkActivityTimer),this.state.networkActivityTimer=window.setTimeout((function(){e.runNewWorkActivityTimer()}),this.state.runningInterval)},e.prototype.runNetworkActivity=function(){var e=this.state.runningInterval,t=Math.floor(performance.now()),r=this.state.networkActivityLatestTraceTime,n=this.state.networkActivityLoadedList.filter((function(n){return t-n.time<e&&t>r}));this.state.networkActivn.length&&n.forEach((function(e){return i+=e.loaded})),
this.state.networkActivityHistory.length>=this.state.maxCacheLength&&this.state.networkActivityHistory.splice(0,1),this.state.networkActivityHistory.push(Math.max(i,0))},e}();t.default=n},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),o=r(13),a=n(r(4)),s=function(){function e(){this.bufferingHistory=[],ton(){this.state=null,this.buffurn void 0===e&&(e=!1),this.state.enableHEVC=e,this},e.prototype.push=function(e){this.bufferingHistory.length>=this.MAX_HISTORY_LENGTH&&this.bufferingHistory.shift(),e.timestamp=this.getNow(),this.bufferingHistory.push(e),this.optimize()},e.prototype.setOnOptimizingCallback=function(e){this.sizingCallback&&this.state.onOptimizingCallback(e,t)},e.prototype.optimize=function(){var e=this.getNow(),t=this.bufferingHistory.filter((function(t){return e-t.timestamp<=2e4}));if(this.state.enableHEVC){var r=""+o.BUFFERING.PLAYBACK.PLAYING+o.BUFFERING.TYPE.PERFORMANCE,n=t.filter((function(e){return r===e.type}));n&&n.length>=10&&(this.state.enableHEVC=!1,this.disableHEVCFlag())}},e.prototype.disableHEVCFlag=function(){1!==parseInt(a.default.getLocalStorage("bilibili_player_codec_prefer_type"),10)&&(a.default.setLocalStorage("bilibili_player_codec_prefer_strategy","2"),this.onOptimzing(i.EVENTS.BUFFERING_OPTIMIZATION,{type:"hevcPerf"}))},e.prototype.getNow=function(){var e;return(null===(e=window.performance)||void 0===e?void 0:e.now())||Date.now()},e}();t.default=s},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.video=e,this.frameCount=0,this.totalFrameCnt=0,this.fpsArr=[],this.lows=[],this.lastFPSTime=0,this.battery=null,this.chargingState=1,this.rafId=-1,this.hiddenCnt=0,this.start=this.start.bind(this),e.addEventListener("canplay",this.start)}return e.prototype.getInfo=function(e,t){void 0===t&&(t=!1);var r=+("visible"===document.visibilityState),i=this.chargingState,o=navigator.hardwareConcurrency||0,a=t?1:5,s=this.getLastXMinutesFPS(a);return n({viState:r,fps:this.getFPS(),oneLowFps:this.get1PercentLowFPS(),stdDev:this.getStandardDeviation(),charging:i,coreNum:o,totalRFrames:this.totalFrameCnt,fpsArr:s,hiddenCnt:this.hiddenCnt},e)},e.prototype.destroy=function(){this.fpsArr.length=0,this.lows.length=0,this.removePageEvent(),window.cancelAnimationFrame(this.rafId),this.battery&&(this.battery.removeEventListener("chargingchange",this.onChargingStateChange),this.battery=null),this.video.removeEventListener("canplay",this.start),this.video=null},e.prototype.start=function(){this.pageVisible()&&-1===this.rafId&&(this.video.removeEventListener("canplay",this.start),this.runFPSDetect()),this.addPageEvent(),this.runBatteryStateDetect()},e.prototype.stopFPSDetect=function(){window.cancelAnimationFrame(this.rafId),this.rafId=-1,this.frameCount=1,this.lastFPSTime=0},e.prototype.onVisibilityChange=function(){this.pageVisible()?-1===this.rafId&&this.runFPSDetect():(this.hiddenCistener("visibilitychange",tistener("visibilitychange",this.onVisibilityChange)},e.prototype.pageVisible=function(){return"visible"===document.visibilityState},e.prototype.getFPS=function(){return this.fpsArr.length?Math.floor(this.fpsArr.reduce((function(e,t){return e+t}),0)/this.fpsArr.length):0},e.prototype.get1PercentLowFPS=function(){if(!this.lows.length||this.low e=this.lows.slice().sort((function(e,t){return e-t})),t=Math.ceil(.01*e.length),r=e.slice(1,t);return Math.floor(r.reduce((function(e,t){return e+t}),0)/r.length)||1},e.prototype.getLastXMinutesFPS=function(e){if(e<=0)return[];var t=60*e,r=this.fpsArr.length-t,n=Math.max(r,0);return this.fpsArr.slice(n)},e.prototype.getStandardDeviation=function(){var e=this.fpsArr.slice(),t=e.length;if(!t)return 0;var r=e,n=e.reduce((function(e,t){return e+Math.pow(t-r,2)}),0)/ton(){return performance.now()||(new Date).getTime()},e.prototype.runFPSDetect=function(){var e=this;"function"!=typeof window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRationFrame||function(e){window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(e){clearTimeout(e)});var t=0;this.rafId=requestAnimationFrame((function r(n){e.frameCount++,e.totalFrameCnt++;var i=e.getTime();e.lastFPSTime||(e.lastFPSTime=i);var o=i-e.lastFPSTime,a=n-t;if(a>0){var s=1e3/a;e.lows.length>=43200&&e.lows.shift(),e.lows.push(s)}t=n,o>=1e3&&(s=e.frameCount/o*1e3,e.frameCount=1,e.lastFPSTime=i,e.fpsArr.length>=7200&&e.fpsArr.shift(),e.fpsArr.push(Math.floor(s)||1)),e.rafId=requestAnimationFrame(r)}))},e.prototype.onChargingStateChange=function(){this.chargingState=+this.battery.charging},e.prototype.runBatteryStateDetect=function(){var e=this;"function"==typeof navigator.getBattery&&(this.onChargingStateChange=this.onChargingStateChange.bind(this),navigator.getBattery().then((function(t){e.battery=t,e.chargingState=+t.charging,t.addEventListener("chargingchange",e.onChargingStateChange)})))},e}();t.default=i},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(10)),o=r(2),a=function(){function e(e){this.player=e,this.ncGrayPercentage=Math.random(),this.p2pGrayPercentage=Math.random(),this.ncDisable=this.getDisableValue("nc_disable"),this.p2pDisable=this.getDisableValue("rp_disable")}return Object.defineProperty(e.prototype,"isUseNC",{get:function(){return this.ncGrayPercentage>=this.ncDisable},enumerable:!1,configurable:!0on(){return this.p2pGrayPercentage>=this.p2pDisable},enumerable:!1,configurable:!0}),e.prototype.getDisableValue=function(e){var t=0,r=i.default.getFawkesConfigValue(o.STRING.DASH_CONFIG,e);return""!==r&&(t=Number(r)),t},e.prototype.destroy=function(){this.player=null},e}();t.default=a},function(e,t,r){"use strict";r.r(t),r.d(t,"MediaPlayer",(function(){return n.a})),r.d(t,"Protection",(function(){return X}));var n=r(9),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a fue()&&"cenc"===t+=20,n>0&&(t+=4+16*r.(t.uuid.toLowerCase())?n[t.uuid.toLow"pssh"in e?t.decodeArray(e.pssh.__text).buffer:null},e.parsePSSHList=function(e){if(null===e)return[];for(var t=new DataView(e.buffer||e),r={},n=0;;){var i,o,a=void 0,s=n;if(n>=t.buffer.byteLength)break;if(i=n+t.getUint32(n),n+=4,1886614376===t.getUint32(n))if(n+=4,0===(o=t.getUint8(n))||1===o){n++,n+=3,a="";var u=void 0,c=void 0;for(u=0;u<4;u++)a+=1===(c=t.getUint8(n+u).toString(16)).length?"0"+c:c;for(n+=4,a+="-",
u=0;u<2;u++)a+=1===(c=t.getUint8(n+u).toString(16)).length?"0"+c:c;for(n+=2,a+="-",u=0;u<2;u++)a+=1===(c=t.getUint8(n+u).toString(16)).length?"0"+c:c;for(n+=2,a+="-",u=0;u<2;u++)a+=1===(c=t.getUint8(n+u).toString(16)).length?"0"+c:c;for(n+=2,a+="-",u=0;u<6;u++)a+=1===(c=t.getUint8(n+u).toString(16)).length?"0"+c:c;n+=6,a=a.toLowerCase(),t.getUint32(n),n+=4,r[a]=t.buffer.slice(s,i),n=i}else n=i;else n=i}return r},e}(),o=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a functiotifier=n,this.persistentState=i,this.sessionTypes=o},s="function"==typeof Symbol&&"symbol"==c(Symbol.iterator)?function(e){return c(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":c(e)};function u(e){var t,r=(e=e||{}).protectionKeyController,n=e.protectionModel,u=e.eventBus,c=e.events,l=e.log,d=e.BASE64,f=e.constants,p=e.ignoreEmeEncryptedEvent,h=void 0,y=void 0,m=void 0,g=void 0,v=void 0,_=void 0;function E(e,t){var o=i.getPSSHForKeySystem(_,e),a=T(_);if(o){for(var s=n.getAllInitData(),d=0;d<s.length;d++)if(r.initDataEquals(o,s[d]))return void l("DRM: Ignoring initData because we have already seen it!");try{n.createKeySession(o,a,A(_),t)}catch(e){u.trigger(c.KEY_SESSION_CREATED,{data:null,error:"Error creating key session! "+e.message})}}else e?n.createKeySession(e,a,A(_),t):u.trigger(c.KEY_SESSION_CREATED,{data:null,error:"Selected key system is "+_.systemString+".  needkey/encrypted event contar=e.systemString;m&&(t=r in m?m[r]:null)}return t}function w(e){var t=T(e),r=[],n=[],i=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:v,s=t&&t.videoRobustness&&t.videoRobustness.lodec,i)):e.type===f.VIDEO&&n.push(new o(e.codec,s))})),new a(r,n,"{var t=T(e);return t&&t.sessionType?t.sespriority>=0?m[r.ks.systemString].priority:e.length)}));var a=void 0;if(_)for(a=0;a<e.length&&(_!==e[a].ks||"break"!=(o.push({ks:e[a].ks,configs:[w(_)]}),u.on(c.KEY_SYSTEM_ACCESS_COMPLETE,(function r(n){u.off(c.KEY_SYSTEM_ACCESS_COMPLETE,r,i),n.error?t||u.trigger(c.KEY_SYSTEM_SELECTED,{error:"DRM: KeySystem Access Denied! -- "+n.error}):(l("DRM: KeySystem Access Granted"),u.trigger(c.KEY_SYSTEM_SELECTED,{data:n.data}),e[a].sessionId?b(e[a].sessionId,e[a].initData):e[a].initData&&E(e[a].initData,e[a].cdmData))}),i),n.requestKeySystemAccess(o),"break"));a++);else if(void 0===_){_=null,h.push(e);for(var s=0;s<e.length;s++)o.push({ks:e[s].ks,configs:[w(e[s].ks)]});var f=void 0,p=function e(r){u.off(c.KEY_SYSTEM_ACCESS_COMPLETE,e,i),r.error?(_=void 0,u.off(c.INTERNAL_KEY_SYSTEM_SELECTED,y,i),t||u.trigger(c.KEY_SYSTEM_SELECTED,{data:null,error:"DRM: KeySystem Access Denied! -- "+r.error})):(f=r.data,l("DRM: KeySystem Access Granted ("+f.keySystem.systemString+")!  Selecting key system..."),n.selectKeySystem(f))},y=function e(o){if(u.off(c.INTERNAL_KEY_SYSTEM_SELECTED,e,i),u.off(c.KEY_SYSTEM_ACCESS_COMPLETE,p,i),o.error)_=void 0,t||u.trigger(c.KEY_SYSTEM_SELECTED,{data:null,error:"DRM: Error selecting key system! -- "+o.error});else{_=n.getKeySystem(),u.trigger(c.KEY_SYSTEM_SELECTED,{data:f});var s=T(_);s&&s.serverCertificate&&s.serverCertificate.length>0&&n.setServerCertificate(d.decodeArray(s.serverCertificate).buffer);for(var l=0;l<h.length;l++)for(a=0;a<h[l].length;a++)if(_===h[l][a].ks){if(r.isClearKey(_)&&s&&s.hasOwnProperty("clearkeys")){var y={kids:Object.keys(s.clearkeys)};h[l][a].initData=(new TextEncoder).encode(JSON.stringify(y))}h[l][a].sessionId?b(h[l][a].sessionId,h[l][a].initData):null!==h[l][a].initData&&E(h[l][a].initData,h[l][a].cdmData);break}}};u.on(c.INTERNAL_KEY_SYSTEM_SELECTED,y,i),u.on(c.KEY_SYSTEM_ACCESS_COMPrigger(c.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function D(e){e.error?u.trigger(c.KEY_STATUSES_CHANGED,{data:null,error:"DRM: KeyStatusChange error! -- "+e.error}):l("DRM: key status = "+e.status)}function O(e){if(l("DRM: onKeyMessage"),e.error)l(e.error);else{var t=e.data;u.trigger(c.KEY_MESSAGE,{data:t});var o=t.messageType?t.messageType:"license-request",a=t.message,d=t.sessionToken,f=T(_),p=_?_.systemString:null,h=r.getLicenseServer(_,f,o),y={sessionToken:d,messageType:o};if(a&&0!==a.byteLength){if(!h)return l("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+d.getSessionID()),void P(y);if(r.isClearKey(_)){var m=r.processClearKeyLicenseRequest(_,f,a);if(m)return l("DRM: ClearKey license request handled by application!"),P(y),void n.updateKeySession(d,m)}var g=new XMLHttpRequest,v=null;if(f&&f.serverURL){var E=f.serverURL;"string"==typeof E&&""!==E?v=E:"object"===(void 0===E?"undefined":s(E))&&E.hasOwnProperty(o)&&(v=E[o])}else f&&f.laURL&&""!==f.laURL?v=f.laURL:(v=_.getLicenseServerURLFromInitData(i.getPSSHData(d.initData)))||(v=e.data.laURL);if(v=h.getServerURLFromMessage(v,a,o)){var b=function(e,t,r,n){var i=e.response?h.getErrorResponse(e.response,r,n):"NONE";P(t,"DRM: "+r+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+i)};g.open(h.getHTTPMethod(o),v,!0),g.responseType=h.getResponseType(p,o),g.onload=function(){if(200==this.status){var e=h.getLicenseMessage(this.response,p,o);null!==e?(P(y),n.updateKeySession(d,e)):b(this,y,p,o)}else b(this,y,p,o)},g.onabort=function(){P(y,"DRM: "+p+' update, XHR aborted. status is "'+this.statusText+'" ('+this.st('+this.status+"), readyState is "+this.readyState)};var S=function(e){if(e)for(var t in e)"authorization"===t.toLowerCase()&&(g.withCredentials=!0),g.setRequestHeader(t,e[t])};f&&S(f.httpRequestHeaders),S(_.getRequestHeadersFromMessage(a)),f&&"boolean"==typeof f.withCredentials&&(g.withCredentials=f.withCredentials),g.send(_.getLicenseRequestFromMessage(a))}else P(y,"DRM: No license server URL specified!")}else P(y,"DRM: Empty key message from CDM")}}function I(e){if(!p){if(l("DRM: onNeedKey"),"cenc"!==e.key.initDataType)return void l("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType);var t=e.key.initData;if(ArrayBuffer.isView(t)&&(t=t.buffer),_){var o=i.getPSSHForKeySystem(_,t);if(o)for(var a=n.getAllInitData(),s=0;s<a.length;s++)if(r.initDataEquals(o,a[s]))return void l("DRM: Ignoring initData because we have already seen it!")}l("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(t)));var u=r.getSupportedKeySystems(t,m);if(0===u.length)return void l("DRM: Received needkey event with initData, but we don't support any of the key systems!");R(u,!1)}}return t={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");!function(){if(!(u&&u.hasOwnProperty("on")&&r&&r.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}(),u.on(c.INTERNAL_KEY_MESSAGE,O,this),u.on(c.INTERNAL_KEY_STATUS_CHANGED,D,this),y.push(e);var t=r.getSupportedKeySystemsFromContentProtection(e.contentProtection);t&&t.length>0&&R(t,!0)},createKeySession:E,loadKeySession:b,removeKeySession:function(e){n.removeKeySession(e)},
closeKeySession:function(e){n.closeKeySession(e)},setServerCertificate:function(e){n.setServerCertificate(e)},setMediaElement:S,setSessionType:function(e){g=e},sotectionData:function(e){m=e,r.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return r.getSupportedKeySystemsFromContentProtection(e)},getKeySystems:function(){return r?r.getKeySystems():[]},reset:function(){u.off(c.INTERNAL_KEY_MESSAGE,O,this),u.off(c.INTERNAL_KEY_STATUS_CHANGED,D,this),S(null),_=void 0,n&&(n.reset(),n=null),y=[]}},h=[],y=[],g="temporary",v="",t}u.__dashjs_factory_name="ProtectionController";var l=dashjs.FactoryMaker.getClassFactory(u),d=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a functstent' or 'temporary'");ay(a);for(e=0;e<o;e++)s[e]=i.charCodeAt(e);return a},e}(),p=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready"},e}()),h=p.CLEARKEY_KEYSTEM_STRING;function y(e){var t=(e=e||{}).BASE64;return{uuid:"e2719d58-a985-b3c9-781a-b030af78d30e",schemeIdURI:"urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e",systemString:h,getInitData:function(e){return i.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:funot known!");i.push(new d(a,s))}r=new f(i)}return r}}}y.__dashjs_factory_name="KeySystemClearKey";var m=dashjs.FactoryMaker.getSingletonFactory(y),g=p.CLEARKEY_KEYSTEM_STRING;function v(e){var t=e.BASE64,r=e.log;return{uuid:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:g,getInitData:function(e){return i.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),o=[],a=0;a<i.kids.length;a++){var s=i.kids[a],u=e.clearkeys&&e.clearkeys.hasOwnProperty(s)?e.clearkeys[s]:null;if(!u)throw new Error("DRM: ClearKey keyID ("+s+") is not known!");o.push(new d(s,u))}n=new f(o),r("Warning: ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return n}}}v.__dashjs_factory_name="KeySystemW3CClearKey";var _=dashjs.FactoryMaker.getSingletonFactory(v),E=p.WIDEVINE_KEYSTEM_STRING;function b(e){var t=null,r=(e=e||{}).BASE64;return{uuid:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:E,init:function(e){e&&(t=e)},getInitData:function(e){return i.parseInitDataFromContentProtection(e,r)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return nssionId?t.sessionId:e&&e.sessionId?e.sessionId:null}}}b.__dashjs_factory_name="KeySystemWidevine";var S=dashjs.FactoryMaker.getSingletonFactory(b),T=p.PLAYREADY_KEYSTEM_STRING,w=vay"))throw new Error("Missing config parameter(s)")}return{uuid:"9a04f079-9840-4286-ab92-e65be0885f95",schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:T,getInitData:function(e){var t,o,a,s=new Uint8Array([112,115,115,104,0,0,0,0]),u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),c=0,l=null,d=void 0,f=void 0;if(n(),"pssh"in e)return i.parseInitDataFromContentProtection(e,r);if("pro"in e)l=r.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;l=r.decodeArray(e.prheader.__text)}return t=l.length,o=4+s.length+u.length+4+t,a=new ArrayBuffer(o),d=new Uint8Array(a),(f=new DataView(a)).setUint32(c,o),c+=4,d.set(s,c),c+=s.length,d.set(u,c),c+=u.length,f.setUint32(c,t),c+=4,d.set(l,c),c+=t,d.buffer},getRequestHeadersFromMessage:function(e){var r,n=void 0,i={},o=new DOMParser,a="utf16"===t?new Uint16Array(e):new Uint8Array(e);r=String.fromCharCode.apply(null,a);for(var s=(n=o.parseFromString(r,"application/xml")).getElementsByTagName("name"),u=n.getElementsByTagName("value"),c=0;c<s.length;c++)i[s[c].childNodes[0].nodeValue]=u[c].childNodes[0].nodeValue;return i.hasOwnProperty("Content")&&(i["Content-Type"]=i.Content,delete i.Content),i.hasOwnProperty("Content-Type")||(i["Content-Type"]="text/xml; charset="+t),i},getLicenseRequestFromMessage:function(e){var i=null,o=new DOMParser,a="utf16"===t?new Uint16Array(e):new Uint8Array(e);n();var s=String.fromCharCode.apply(null,a),u=o.parseFromString(s,"application/xml");if(u.getElementsByTagName("Challenge")[0]){var c=u.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;c&&(i=r.decode(c))}else if(u.getElementsByTagName("parsererror").lengts[0].nodeVapush(0);return new Uint8Array(i).buffer}return null},getSessionId:function(){return null},setPlayReadyMessageFormat:function(e){if("utf8"!==e&&"utf16"!==e)throw new Error("Illegal PlayReady message format! -- "+e);t=e},init:function(e){e&&(w=e)}}}A.__dashjs_factory_name="KeySystemPlayReanse:function(e,t){return r[t].getErrorResponse(e)}}}P.__dashjs_factory_name="DRMToday";var D=dashjs.FactoryMaker.getSingletonFactory(P);function O"+i+", name: "+n;return o&&(m+=", message: "+o),m}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return r.call(this,e)},getErrorResponse:function(e){return n.call(this,e)}}}O.__dashjs_factory_name="PlayReaString.fromCharCode.apply(null,new Uint8Array(e))}}}C.__dashjs_factory_name="Widevine";var N=dashjs.FactoryMaker.getSingletonFactory(C);function k(){return{getServerURLFromMessage:function(e,t){var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t)));e+="/?";for(var n=0;n<r.kids.length;n++)e+=r.kids[n]+"&";return e.substring(0,e.length-1)},getHTTPMethod:function(){return"GET"},getResreplace(/=/g,"");t.push(new d(i,o))}return new f(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}k.__dashjs_factory_name="ClearKey";var L=dashjs.FactoryMaker.getSingletonFactory(k);function x(){var e=this.context,t=void 0,r=void 0,n=void 0,o=void 0,a=void 0;return{initialize:function(){r=[];var i=void 0;i=R(e).getInstance({BASE64:n}),r.push(i),i=S(e).getInstance({BASE64:n}),r.push(i),i=m(e).getInstance({BASE64:n}),r.push(i),o=i,i=_(e).getInstancString,n=vol),n))}},isCleaength;i++)if(r[i]!==n[i])return!1;return!0}return!1},getKeySys++)if(r[t].systemString===e)return r[t];return null},getSupportedKeySystemsFromContentProtection:function(e){var t=void 0,n=void 0,i=void 0,o=void 0,a=[];if(e)for(i=0;i<r.length;++i)for(n=r[i],o=0;o<e.length;++o)(t=e[o]).schemeIdUri.toLowerCase()===n.schemeIdURI&&a.push({ks:n,initData:n.getInitData(t),cdmData:n.getCDMData(),sessionId:n.getSessionId(t)});return a},getSupportedKeySystems:function(e,t){for(var n=[],o=i.parsePSSHList(e),a=void 0,s=void 0,u=void 0,c=0;c<r.length;++c)s=(a=r[c]).systemString,u=!t||s in t,a.uuid in o&&u&&n.push({ks:a,initData:o[a.uuid],cdmData:a.getCDMData(),sesp.CLEARKEY_KEYSTEM_STRING&&(o=L(e).getInstance()),o},processClearKeyLicenseRequest:function(e,r,n){try{return e.getClearKeysFromProtectionData(r,n)}catch(e){return t("Failed to retriion(e){e&&(e.log&&(t=e.log),e.BASE64&&(n=e.BASE64))}}}x.__dashjs_factory_name="ProtectionKeyController";var M=dashjs.FactoryMaker.getSingletonFactory(x),F=new(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this));return r.INTERNAL_KEY_MESSAGE="internalKeyMessage",r.INTERNAL_KEY_SYSTEM_SELECTED="internalKeySystemSelected",r.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",r.KEY_ADDED="public_keyAdded",r.KEY_ERROR="public_keyError",r.KEY_MESSAGE="public_keyMessage",r.KEY_SESSION_CLOSED="public_keySessionClosed",r.KEY_SESSION_CREATED="public_keySessionCreated",r.KEY_SESSION_REMOVED="public_keySessionRemoved",r.KEY_STATUSES_CHANGED="public_keyStatusesChanged",r.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",r.KEY_SYSTEM_SELECTED="public_keySystemSelected",r.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",r.NEED_KEY="needkey",r.PROTECTION_CREATED="public_protectioncreated",r.PROTECTION_DESTROYED="public_protectiondestroyed",r.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",r.TEARDOWN_COMPLETE="protectionTeardownComplete",r.VIDEO_ELEMENT_SELECTED="videoElementSelected",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(r(3).a)),U=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=t,this.initDataType=r},B=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a fun.d")}(this,e),this.keySystem=t,this.ksConfiguration=r};function H(e){e=e||{};var t,r=this.context,n=e.eventBus,i=e.events,o=e.log,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,d=void 0;function f(e,t){void 0!==navigator.requestMediaKeySystemAccess&&"function"==typeof navigator.requestMediaKeySystemAccess?function(t){var r=e[t].ks,o=e[t].configs;navigator.requestMediaKeySystemAccess(r.systemString,o).then((function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,o=new V(r,t);o.mksa=e,n.trigETE,{error:"Key system access denied! "+r.message})}))}(t):n.trigger(i.KEY_SYSTEM_ACCESS_C0;t<c.length;t++)if(c[t]===e){c.splice(t,1);break}}function m(e,t,r,a){var s={session:e,initData:t,sessionId:a,handleEvent:function(e){switch(e.type){case"keystatuseschange":n.trigger(i.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach((function(){var e=void 0,t=void 0;"expired"===(arguments&&arguments.length>0&&(arguments[0]&&("string"==typeof arguments[0]?e=arguments[0]:t=arguments[0]),arguments[1]&&("string"==typeof arguments[1]?e=arguments[1]:t=arguments[1])),e)?n.trigger(i.INTERNAL_KEY_STATUS_CHANGED,{error:"License has expired"}):n.trigger(i.INTERNAL_KEY_STATUS_CHANGED,{status:e,keyId:t})}));break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;n.trigger(i.INTERNAL_KEY_MESSAGE,{data:new j(this,t,void 0,e.messageType)})}},getSessionID:function(){return e.sessionId},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getSessionType:function(){return r}};return e.addEventListener("keystatuseschange",s),e.addEventListener("message",s),e.closed.then((function(){y(s),o("DRM: Session closed.  SessionID = "+s.getSessionID()),n.trigger(i.KEY_SESSION_CLOSED,{data:s.getSh;t++)c[t].initData&&e.push(c[t].initData);return e},requestKeySystemAccess:function(e){f(e,0String+")! Couldncrypted",l),s.setMediaKeys&&u&&s.setMediaKeys(u)))},setServerCertificate:function(e){if(!a||!u)throw new Error("Can not set server certificate until you have sel updated."),n.trigger(i.SERVER_CERTIFICATE_UPDATED)})).catch((function(e){n.trigger(i.SERVER_CERTIFICATE_UPDATED,{error:"Error updating server certificate -- "+e.name})}))},createKeySession:function(e,t,r){if(!a||!u)throw new Error("Can not create sessions until you have selected a key system");var s=u.createSession(r),c=m(s,e,r),l=this.getKeySystem().systemString===p.CLEARKEY_KEYSTEM_STRING&&t&&t.clearkeys?"keyids":"cenc";s.generateRequest(l,e).then((function(){o("DRM: Session created.  SessionID = "+c.getSessionID()),n.trigger(i.KEY_SESSION_CREATED,{data:c})})).catch((function(e){y(c),n.trigger(i.KEY_SESSION_CREATED,{data:null,error:"Error generating key request -- "+e.name})}))},updateKeySession:function(e,t){var r=e.session;d.isClearKey(a)&&(t=t.toJWK()),r.update(t).catch((function(t){n.trigger(i.KEY_ERROR,{data:new B(e,"Error sending update() message! "+t.name)})}))},loadKeySession:function(e,t,r){if(!a||!u)throw new Error("Can not load sessions until you have selected a key system");for(var s=0;s<c.length;s++)if(e===c[s].sessionId)return void o("DRM: Ignoring session ID because we have already seen it!");var l=u.createSession(r),d=m(l,t,r,e);l.load(e).then((function(t){t?(o("DRM: Session loaded.  SessionID = "+d.getSessionID()),n.trigger(i.KEY_SESSION_CREATED,{data:d})):(y(d),n.trigger(i.KEY_SESSION_CREATED,{data:null,error:"Could not load session! Invalid Session ID ("+e+")"}))})).catch((function(t){y(d),n.trigger(i.KEY_SESSION_CREATED,{data:null,error:"Could not load session ("+e+")! "+t.name})}))},removeKeySession:function(e){e.session.remove().then((function(){o("DRM: Session removed.  SessionID = "+e.getSessionID()),n.triggremoving session ("losing{r(e)}))}(t=c[o])}():n.trigger(i.TEARDOWN_COMPLETE)}},a=null,s=.trigger(i.NEED_KEY,{key:new U(t,e.initDataType)})}}},t}H.__dashjs_factory_name="ProtectionModel_21Jan2015";var G=dashjs.FactoryMaker.getClassFactory(H);function q(e){e=e||{};var t,r=this.context,n=e.eventBus,i=e.events,o=e.log,s=e.api,u=void 0,cbind(this),u.addEventLi],t=0;t<f.length;t++)e.push(f[t].initData);return e},requestKeySystemAccess:function(e){for(var t=!1,r=0;r<e.length;r++)for(var o=e[r].ks.systemString,u=e[r].configs,c=null,l=null,d=0;d<u.length;d++){var f=u[d].audioCapabilities,p=u[d].videoCapabilities;if(f&&0!==f.length){c=[];for(var y=0;y<f.length;y++)window[s.MediaKeys].isTypeSupported(o,f[y].contentType)&&c.push(f[y])}if(p&&0!==p.length){l=[];for(var m=0;m<p.length;m++)window[s.MediaKeys].isTypeSupported(o,p[m].contentType)&&l.push(p[m])}if(!(!c&&!l||c&&0===c.length||l&&0===l.length)){t=!0;var g=new a(c,l),v=h.getKeySystemBySystemString(o);n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{data:new V(v,g)});break}}t||n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"}emString+")! Coup),(u=e)&&(u.addEventListener(s.needkey,p),l&&m()))},createKeySession:function(e,t,r,a){if(!c||!l||!d)throw new Error("Can not create sessions until you have selected a key system");var u=null;if(null!==d.ksConfiguration.videoCapabilities&&d.ksConfiguration.videoCapabilities.length>0&&(u=d.ksConfiguration.videoCapabilities[0]),null===u&&null!==d.ksConfiguration.audioCapabilities&&d.ksConfiguration.audioCapabilities.length>0&&(u=d.ksConfiguration.audioCapabilities[0]),null===u)throw new Error("Can not create sessions for unknown content types.");var p=u.contentType,h=l.createSession(p,new Uint8Array(e),a?new Uint8Array(a):null),y=function(e,t){return{session:e,initData:t,getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case s.error:n.trigger(i.KEY_ERROR,{data:new B(this,"KeyError")});break;case s.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;n.trigger(i.INTERNAL_KEY_MESSAGE,{data:new j(this,t,e.destinationURL)});break;case s.ready:o("DRM: Key added."),n.trigger(i.KEY_ADDED);break;case s.close:
o("DRM: Session closed.  SessionID = "+this.getSessionID()),n.trigger(i.KEY_SESSION_CLOSED,{data:this.getSessionID()})}}}}(h,e);h.addEventListener(s.error,y),h.addEventListener(s.message,y),h.addEventListener(s.ready,y),h.addEventListener(s.close,y),f.push(y),o("DRM: Session created.  SessionID = "+y.getSessionID()),n.trigg Uint8Array(t.toJWK())):r.update(new Uint8Array(t))},closeKeySession:y,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},reset:function(){try{for(var e=0;e<f.length;e++)y(f[e]);u&&u.removeEventListener(s.needkey,p),n.trigger(i.TEARDOWN_COMPLETE)}catch(e){n.trigger(i.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}},u=null,c=null,l=itData;n.trigger(i.NEED_KEY,{key:new U(t,"cenc")})}}},t}q.__dashjs_factory_name="ProtectionModel_3Feb2014";var W=dashjs.FactoryMaker.getClassFactory(q);function K(e){e=e||{};var t,r=this.context,n=e.eventBus,i=e.events,o=e.log,s=e.api,u=e.errHandler,c=void 0,lkeymessage,y),c.remover r=0;r<p.length;r++)e.push(p[r].initData);return e},requestKeySystemAccess:function(e){var t=c;t||(t=document.createElement("video"));for(var r=!1,o=0;o<e.length;o++)for(var s=e[o].ks.systemString,u=e[o].configs,l=null,f=0;f<u.length;f++){var p=u[f].videoCapabilities;if(p&&0!==p.length){l=[];for(var h=0;h<p.length;h++)""!==t.canPlayType(p[h].contentType,s)&&l.push(p[h])}if(l&&(!l||0!==l.length)){r=!0;var y=new a(null,l),m=d.getKeySystemBySystemString(s);n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{data:new V(m,y)});break}}r||n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"}keySystem,n.trigger(i.INTERNAL_KEY_SYSTEM_SELECTED)},setMediaElement:function(e){c!==e&&(c&&v(),(c=e)&&(c.addEventListener(s.keyerror,y),c.addEventListener(s.needkey,y),c.addEventListener(s.keymessage,y),c.addEventListener(s.keyadded,y),n.tt}throw new Erroring,new Uint8Array(t),new Uint8Array(e.initData),r)},closeKeySession:m,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},reset:function(){c&&v();for(var e=0;e<p.length;e++)m(p[e]);n.trigger(i.TEARDOWN_COMPLETE)}},c=null,l=null,f=[],p=[],d=M(r).getInstance(),y={handleEvent:function(e){var t=null;switch(e.type){case s.needkey:var r=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;n.trigger(i.NEED_KEY,{key:new U(r,"cenc")});break;case s.keyerror:if((t=g(p,e.sessionId))||(t=g(f,e.sessionId)),t){var a="";switch(e.errorCode.code){case 1:a+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:a+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:a+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:a+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:a+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:a+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}a+="  System Code = "+e.systemCode,n.trigger(i.KEY_ERROR,{data:new B(t,a)})}else o("No session token found for key error");break;case s.keyadded:(t=g(p,e.sessionId))||(t=g(f,e.sessionId)),t?(o("DRM: Key added."),n.trigger(i.KEY_ADDED,{data:t})):o("No session token found for key added");break;case s.keymessage:if((h=null!==e.sessionId&&void 0!==e.sessionId)?!(t=g(p,e.sessionId))&&f.length>0&&(t=f.shift(),p.push(t),t.sessionID=e.sessionId,n.trigger(i.KEY_SESSION_CREATED,{data:t})):f.length>0&&(t=f.shift(),p.push(t),0!==f.length&&u.mediaKeyMessageError("Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!")),t){var c=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=c,n.trigger(i.INTERNAL_KEY_MESSAGE,{data:new j(t,c,e.defaultURL)})}else o("No session token found for key message")}}},t}K.__dashjs_factory_name="ProtectionModel_01b";var Y=dashjs.FactoryMaker.getClassFactory(K),Q=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],z=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",typeof e[n[Object.keys(n)[0]]])return n}return null}return{createProtectionSystem:function(r){var n=null,i=M(e).getInstance();i.setConfig({log:r.log,BASE64:r.BASE64}),i.initialize();var o=function(r){var n=r.log,i=r.eventBus,o=r.errHandler,a=r.videoModel?r.videoModel.getElement():null;return a&&void 0===a.onencrypted||a&&void 0===a.mediaKeys?t(a,z)?(n("EME detected on this user agent! (ProtectionModel_3Feb2014)"),W(e).create({log:n,eventBus:i,events:r.events,api:t(a,z)})):t(a,Q)?(n("EME detected on this user agent! (ProtectionModel_01b)"),Y(e).create({log:n,eventBus:i,errHandler:o,events:r.events,api:t(a,Q)})):(n("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(n("EME detected on this user agent! (ProtectionModel_21Jan2015)"),G(e).create({log:n,eventBus:i,events:r.events}))}(r);return!n&&o&&(n=l(e).create({protectionModel:o,protectionKeyController:i,eventBus:r.eventBus,log:r.log,events:r.events,BASE64:r.BASE64,constants:r.constants,ignoreEmeEncryptedEvent:r.ignoreEmeEncryptedEvent}),r.capabilities.setEncryptedMediaSupported(!0)),n}}}Z.__dashjs_factory_name="Protection";var J=dashjs.FactoryMaker.getClassFactory(Z);J.events=F,dashjs.FactoryMaker.updateClassFactory(Z.__dashjs_factory_name,J);var X=J;dashjs.Protection=X,t.default=dashjs}])},"object"==c(t)&&"object"==c(e)?e.exports=u():(i=[],void 0===(o="function"==typeof(n=u)?n.apply(t,i):n)||(e.exports=o))},33108:function(e,t,r){var n,i,o,a;function s(e){
return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}e=r.nmd(e),self,a=function(){return function(){var e={715:function(e,t){var r={parseBuffer:function(e){return new n(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(i.prototype._boxProcessors[e]=t)},createFile:function(){return new n},createBox:function(e,t,r){var n=i.create(e);return t&&t.append(n,r),n},createFullBox:function(e,t,n){var i=r.createBox(e,t,n);return i.version=0,i.flags=0,i},Utils:{}};r.Utils.dataViewToString=function(e,t){var r=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(r).decode(e);var n=[],i=0;if("utf-8"===r)for(;i<e.byteLength;){var o=e.getUint8(i++);o<128||(o<224?(o=(31&o)<<6,o|=63&e.getUint8(i++)):o<240?(o=(15&o)<<12,o|=(63&e.getUint8(i++))<<6,o|=63&e.getUint8(i++)):(o=(7&o)<<18,o|=(63&e.getUint8(i++))<<12,o|=(63&e.getUint8(i++))<<6,o|=63&e.getUint8(i++))),n.push(String.fromCharCode(o))}else for(;i<e.byteLength;)n.push(String.fromCharCode(e.getUint8(i++)));return n.join("")},r.Utils.utf8ToByteArray=function(e){var t,r;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],r=0;r<e.length;++r){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?(t.push(192|n>>6),t.push(128|63&n)):n<65536?(t.push(224|n>>12),t.push(128|63&n>>6),t.push(128|63&n)):(t.push(240|n>>18),t.push(128|63&n>>12),t.push(128|63&n>>6),t.push(128|63&n))}return t},r.Utils.appendBox=function(e,t,r){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==r)if(null!=r){var n,i=-1;if("number"==typeof r)i=r;else{if("string"==typeof r)n=r;else{if("object"!=s(r)||!r.type)return void e.boxes.push(t);n=r.type}for(var o=0;o<e.boxes.length;o++)if(n===e.boxes[o].type){i=o+1;break}}e.boxes.splice(i,0,t)}else e.boxes.push(t)},t.parseBuffer=r.parseBuffer,t.addBoxProcessor=r.addBoxProcessor,t.createFile=r.createFile,t.createBox=r.createBox,t.createFullBox=r.createFullBox,t.Utils=r.Utils,r.Cursor=function(e){this.offset=void 0===e?0:e};var n=function(e){this._cursor=new r.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};n.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},n.prototype.fetchAll=function(e,t){var r=[];return n._sweep.call(this,e,r,t),r},n.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=i.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},n._sweep=function(e,t,r){for(var i in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&r)return;n._sweep.call(this.boxes[i],e,t,r)}},n.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var r=new Uint8Array(t);for(this._rawo=new DataView(r.buffer),this.bytes=r,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return r.buffer},n.prototype.append=function(e,t){r.Utils.appendBox(this,e,t)};var i=function(){this._cursor=new r.Cursor};i.parse=function(e){var t=new i;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},i.create=function(e){var t=new i;return t.type=e,t.boxes=[],t},i.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],i.prototype._boxProcessors={},i.prototype._procField=function(e,t,r){this._parsing?this[e]=this._readField(t,r):this._writeField(t,r,this[e])},i.prototype._procFieldArray=function(e,t,r,n){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e][i]=this._readField(r,n);else for(i=0;i<this[e].length;i++)this._writeField(r,n,this[e][i])},i.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},i.prototype._procEntries=function(e,t,r){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push({}),r.call(this,this[e][n]);else for(n=0;n<t;n++)r.call(this,this[e][n])},i.prototype._procSubEntries=function(e,t,r,n){var i;if(this._parsing)for(e[t]=[],i=0;i<r;i++)e[t].push({}),n.call(this,e[t][i]);else for(i=0;i<r;i++)n.call(this,e[t][i])},i.prototype._procEntryField=function(e,t,r,n){this._parsing?e[t]=this._readField(r,n):this._writeField(r,n,e[t])},i.prototype._procSubBoxes=function(e,t){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e].push(i.parse(this));else for(r=0;r<t;r++)this._rawo?this[e][r].write():this.size+=this[e][r].getLength()},i.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},i.prototype._readInt=function(e){var t=null,r=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(r);break;case 16:t=this._raw.getInt16(r);break;case 32:t=this._raw.getInt32(r);break;case 64:var n=this._raw.getInt32(r),i=this._raw.getInt32(r+4);t=n*Math.pow(2,32)+i}return this._cursor.offset+=e>>3,t},i.prototype._readUint=function(e){var t,r,n=null,i=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:n=this._raw.getUint8(i);break;case 16:n=this._raw.getUint16(i);break;case 24:n=((t=this._raw.getUint16(i))<<8)+(r=this._raw.getUint8(i+2));break;case 32:n=this._raw.getUint32(i);break;case 64:t=this._raw.getUint32(i),r=this._raw.getUint32(i+4),n=t*Math.pow(2,32)+r}return this._cursor.offset+=e>>3,n},i.prototype._readString=function(e){for(var t="",r=0;r<e;r++){var n=this._readUint(8);t+=String.fromCharCode(n)}return t},i.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},i.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},i.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var r=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,r}return null},i.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?r.Utils.dataViewToString(t):t},i.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},i.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},i.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(i.parse(this))},i.prototype.append=function(e,t){r.Utils.appendBox(this,e,t)},i.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),
"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},i.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},i.prototype._writeInt=function(e,t){if(this._rawo){var r=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(r,t);break;case 16:this._rawo.setInt16(r,t);break;case 32:this._rawo.setInt32(r,t);break;case 64:var n=Math.floor(t/Math.pow(2,32)),i=t-n*Math.pow(2,32);this._rawo.setUint32(r,n),this._rawo.setUint32(r+4,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeUint=function(e,t){if(this._rawo){var r,n,i=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(i,t);break;case 16:this._rawo.setUint16(i,t);break;case 24:r=(16776960&t)>>8,n=255&t,this._rawo.setUint16(i,r),this._rawo.setUint8(i+2,n);break;case 32:this._rawo.setUint32(i,t);break;case 64:n=t-(r=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(i,r),this._rawo.setUint32(i+4,n)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeString=function(e,t){for(var r=0;r<e;r++)this._writeUint(8,t.charCodeAt(r))},i.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},i.prototype._writeTemplate=function(e,t){var r=Math.floor(t),n=(t-r)*Math.pow(2,e/2);this._writeUint(e/2,r),this._writeUint(e/2,n)},i.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,r=0;r<e.length;r++)this._rawo.setInt8(t+r,e[r]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},i.prototype._writeUTF8String=function(e){var t=r.Utils.utf8ToByteArray(e);if(this._rawo)for(var n=new DataView(this._rawo.buffer,this._cursor.offset,t.length),i=0;i<t.length;i++)n.setUint8(i,t[i]);else this.size+=t.length},i.prototype._writeField=function(e,t,r){switch(e){case"uint":this._writeUint(t,r);break;case"int":this._writeInt(t,r);break;case"template":this._writeTemplate(t,r);break;case"string":-1==t?this._writeTerminatedString(r):this._writeString(t,r);break;case"data":this._writeData(r);break;case"utf8":this._writeUTF8String(r)}},i.prototype._boxProcessors.avc1=i.prototype._boxProcessors.avc2=i.prototype._boxProcessors.avc3=i.prototype._boxProcessors.avc4=i.prototype._boxProcessors.hvc1=i.prototype._boxProcessors.hev1=i.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},i.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)}))},i.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},i.prototype._boxProcessors.free=i.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},i.prototype._boxProcessors.ftyp=i.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},i.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},i.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},i.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},i.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},i.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},i.prototype._boxProcessors.mp4a=i.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},i.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),
this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},i.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},i.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},i.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},i.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},i.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)}))},i.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},i.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,(function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)}))}))},i.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,(function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)}))}))},i.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},i.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},i.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},i.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},i.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))},i.prototype._boxProcessors["url "]=i.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},i.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},i.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},i.prototype._boxProcessors.vttC=function(){this._procField("config","utf8"inhe[1](e){ne e.exe.exports.__esModule=!0,e.exports.default=e.exports},687:function(e,t,r){var n=r(61)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==("undefined"==typeof globalThis?"undefined":s(globalThis))?globalThis.regeneratorRuntimen,edefaObject.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var n={};return function(){"use strict";r.d(n,{default:function(){return xn}});var e,t,i,o,a,u,c,l="4.3.18",d="https://s1.hdslb.com/bfs/static/bwphevc/libwpengn-4.3.18.wasm",f="https://s1.hdsl===Symbol&&e!==Symbol.prototype?"symbol":s(e)},p(e)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.ds may only return object or undefined");return v(e)}function b(e){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},b(e)}function S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,y private field");t.value=r}}(e,T(e,t,"set"),r),r}!function(e){e.CLOSED="closed",e.OPEN="open",e.ENDED="ended"}(e||(e={})),function(e){e.NETWORK="network",e.DECODE="decode"}(t||(t={})),function(e){e[e.NETWORK_EMPTY=0]="NETWORK_EMPTY",e[e.NETWORK_IDLE=1]="NETWORK_IDLE",e[e.NETWORK_LOADING=2]="NETWORK_LOADING",e[e.NETWORK_NO_SOURCE=3]="NETWORK_NO_SOURCE"}(i||(i={})),function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(o||(o={})),function(e){e[e.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED",e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED"}(a||(a={})),function(e){e.SEGMENTS="segments",e.SEQUENCE="sequence"}(u||(u={})),function(e){e.AUDIO="audio",e.VIDEO="video",e.MIX="mix"}(c||(c={}));var R=g((function e(){y(this,e)})),P=window.EventTarget||R,D=function(e){_(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}(r);function r(){var e;return y(this,r),S(v(e=t.call(this)),"onaddsourcebuffer",void 0),S(v(e),"onremovesourcebuffer",void 0),S(v(e),"sourceBuffers",void 0),e.sourceBuffers=[],E(e,new Proxy(v(e),{get:function(e,t,r){return Number.isNaN(Number(t))?"function"==typeof e[t]?e[t].bind(e):Reflect.get(e,t,r):e.sourceBuffers[t]}}))}return g(r,[{key:"length",get:function(){realue:function(e,t){the",value:function(e){this.sourceBuffers.splice(e,1)}},{key:"push",value:function(e){this.sourceBuffers.push(e)}},{key:"pop",value:function(){return this.sourceBuffers.pop()}},{key:"indexOf",value:function(e){return this.sourceBuffers.indexOf(e)}}]),r}(P);function O(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function I(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){O(o,n,i,a,s,"next",e)}function s(e){O(o,n,}else r=n.apply(this,arguments);return E(this,r)}}var M=function(e){_(r,e);var t=x(r);function r(e,n){var i;return y(this,r),(i=t.call(this,e)).name=n,i.message=e,i.stack=(new Error).stack,i}return g(r)}(L(Error)),F=function(e){_(r,e);var t=x(r);function r(){return y(this,r),t.call(this,"The operation is not supported.","NotSupportedError")}return g(r)}(M),U=function(e){_(r,e);var t=x(r);function r(){return y(this,r),t.call(this,"The object is in an invalid state.","InvalidStateErrdex is not in tvate elements twice on an object")}(e,t),t.set(e,r)}var V=new WeakMap,H=new WeakMap,G=new WeakMap,q=function(){function e(){var t=this;y(this,e),j(this,V,{writable:!0,value:void 0}),j(this,H,{writable:!0,value:function(e,r){var n=w(t,V)[e],i=w(t,V)[r];return n.start<=i.start&&i.start<=n.end&&n.end<=i.end?(n.end=i.end,w(t,V).splice(r,1),!0):i.start<=n.start&&n.start<=i.end&&i.end<=n.end?(n.start=i.start,w(t,V).splice(r,1),!0):i.start<=n.start&&n.start<=i.end&&n.end<=i.end?(w(t,V).splice(e,1),!0):n.start<=i.start&&i.start<=n.end&&i.end<=n.end&&(w(t,V).splice(r,1),!0)}}),j(this,G,{writable:!0,value:function(e){if(null===e||Number.isNaN(e)||e%1!=0)throw new Error("index argument is not an integer");if(e>=w(t,V).length||e<0)throwkey:"length",get:function(){return w(this,V).length}},{key:"get",value:function(e){return w(this,G).call(this,e),w(this,V)[e]}},{key:"start",value:function(e){return w(this,G).call(this,e),w(this,V)[e].start}},{key:"end",value:function(e){return w(this,G).call(this,e),w(this,V)[e].end}},{key:"add",value:function(e,t){var r=0
;for(r=0;r<w(this,V).length&&!(e>w(this,V)[r].start);r++);for(w(this,V).splice(r,0,{start:e,end:t}),r=0;r<w(this,V).length-1;r++)w(this,H).call(this,r,r+1)&&r--}},{key:"remove",value:function(e,t){for(var r=0;r<w(this,V).length;r++)if(e<=w(this,V)[r].start&&t>=w(this,V)[r].end)w(this,V).splice(r,1),r--;else{if(e>w(this,V)[r].start&&t<w(this,V)[r].end){w(this,V).splice(r+1,0,{start:t,end:w(this,V)[r].end}),w(this,V)[r].end=e;break}e>w(this,V)[r].start&&e<w(this,V)[r].end?w(this,V)[r].end=e:t>w(this,V)[r].start&&t<w(this,V)[r].end&&(w(this,V)[r].start=t)}}},{key:"addRange",value:function(e){return w(this,V).push(e)}},{key:"clear",value:function(){w(this,V).length=0}},{key:"container",value:function(e){for(var t=0;t<w(this,V).length;t++){var r=w(this,V)[t];if(e>=r.start&&e<=r.end)return!0}return!1}}]),e}();function W(e,t){return e.start<=t.start&&t.start<=e.end&&e.end<=t.end?{start:t.start,end:e.end}:t.start<=e.start&&e.start<=t.end&&t.end<=e.end?{start:e.start,end:t.end}:t.start<=e.start&&e.start<=t.end&&e.end<=t.end?{start:e.start,end:e.end}:e.start<=t.start&&t.start<=e.end&&t.end<=e.end?{start:t.start,end:t.end}:null}function K(e,t){for(var r=new q,n=0;n<e.length;n++)for(var i=e.get(n),o=0;o<t.length;o++){var a=t.get(o);if(a.start>=i.start&&a.start<i.end||a.start<=i.start&&a.end>i.start){var s=W(i,a);s&&r..end)break}return r}var Y=g((function e(){y(this,e)}));S(Y,"MIN_DECODE_BUFFER_TIME",4),S(Y,"MAX_DECODE_BUFFER_TIME",8);var Q=Y,z=function(e){_(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}nction r(){return y(this,r),t.apply(this,arguments)}return g(r)}(function(e){_(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}(r);function r(){var e;return y(this,r),S(v(e=t.call(this)),"tracks",void 0),e.tracks=[],E(e,new Proxy(v(e),{get:function(e,t,r){return Number.isNaN(Number(t))?"function"==typeof e[t]?e[t].bind(e):Reflect.get(e,t,r):e.tracks[t]}}))}return g(r,[{key:"length",get:function(){r.tracks[t].id=).then((function(){e.dispatchEvent(new Event(t))}))}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var $,ee=function(){var e={};return"undefined"!=typeof window&&(e=window),"undefined"!=typeof self&&(e=self),e},te=function(){var e=!1;try{var t;e="1"===(null===(t=ee().localStorage)||void 0===t?void 0:"debug",e.INFO="info",e.WARN=$||($={}));var re=function(){function e(){y(this,e)}return g(e,[{key:"proxyLog",value:function(t,r){var n;te&&(n=console)[t].apbjects must have a [Symbol.iterator]() method.")}()}(r)))}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.proxyLog($.INFO,t)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.proxyLog($.TRACE,t)}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.proxyLog($.DEBUG,t)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=argum;r<e;r++)t[r]=arguments[r];this.proxyLog($.ERROR,t)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e,e.startTime=+new Date),e.instance}}]),e}();S(re,"instance",void 0),S(re,"stari)}else r=n.apply(this,arguments);return E(this,r)}}(r);function r(){var e;return y(this,r),S(v(e=t.call(this)),"trackId",void 0),S(v(e),"ldt",void 0),S(v(e),"lfd",void 0),S(v(e),"het",void 0),S(v(e),"nrapFlag",void 0),S(v(e),"trackRanges",void 0),S(v(e),"_appendMode",void 0),S(v(e),"TAG","[BwpTrackBuffer]"),S(v(e),"logger",void 0),S(v(e),"initSegmentBuffer",void 0),S(v(e),"mediaSegmentBuffer",void 0),S(v(e),"mediaSegmentBufferCount",void 0),e.nrapFlag=!0,e.trackRanges=new q,e.initSegmentBuffer=[],e.mediaSegmentBuffer={},e.mediaSegmentBufferCount=0,e._appendMode=u.SEGMENTS,e.logger=ne.getInstance(),e}return g(r,[{key:"appendMode",get:function(){return this.appendMode},set:function(e){this._appendMode=e}},{key:"appendInitSegment",value:function(e){for(var t=this.initSegmentBuffer,r=0;r<t.length;r++){var n=t[r];if((1===n.volume&&0===n.width&&0===n.height||0===n.volume&&n.width===e.width&&n.height===e.height)&&n.buffer.byteLength===e.buffer.byteLength)return this.logger.warn(this.TAG,"append init segment is exists, it is index is:",r),r}return this.initSegmentBuffer.push(e)-1}},{key:"appendMediaSegment",value:function(e){var t=this.mediaSegmentBuffer,r=e.sequenceNumber;if(this._appendMode===u.SEQUENCE)r=this.mediaSegmentBufferCount;else{var n=t[r];n&&(this.remove(n.fpts,n.lpts),this.logger.warn(this.TAG,"append media segment is exists, remove old segment"))}t[r]=e;var i=t[r-1],o=t[r+1],a=e.fpts,s=e.lpts;return i&&(a=i.lpts),o&&(s=o.fpts),this.trackRanges.add(a,s),this.mediaSegmentBufferCount+=1,r}},{key:"remove",value:function(e,t){for(var r=0,n=e,i=t,o=this.mediaSegmentBuffer,a=Object.keys(o),s=0;s<a.length;s++){var u=parseInt(a[s],10),c=o[u],l=c.fpts,d=c.lpts;if(e>=l&&e<d){var f=o[u-1];n=f?f.lpts:l}if(t>l&&t<=d){var p=o[u+1];i=p?p.fpts:d}d<e||l>t||(delete o[u],r+=1)}return this.trackRanges.remove(n,i),this.mediaSegmentBufferCount=Object.keys(o).length,r>0}},{key:"getInitSegment",value:function(e){return thisvalue:function(e){return this.mediaSegmentBuffer[e]}},{key:"getMediaSegmentTimeRange",value:function(e){var t=this.mediaSegmentBuffer[e];return t?{start:t.fpts,end:t.lpts}:{start:NaN,end:NaN}}},{key:"isLastSegment",value:function(e){var t=Object.keys(this.mediaSegmentBuffer);return parseInt(t.pop()||"-1",10)===e}},{key:"getCurrentSegmentIndex",value:function(e){for(var t=Object.keys(this.mediaSegmentBuffer),r=0;r<t.length;r++){var n=this.mediaSegmentBuffer[t[r]];if(e>=n.fpts&&e<=n.lpts)return parseInt(t[r],10);if(e>n.lpts){var i=this.mediaSegmentBuffer[t[r+1]];if(i&&e<i.fpts)retdiaSegmentBuffer={},this.mediaSegmentBufferCount=0
}}]),r}(P),oe=g((function e(){y(this,e)}));S(oe,"LOAD_START","loadstart"),S(oe,"PROGRESS","progress"),S(oe,"SUSPEND","suspend"),S(oe,"ABORT","abort"),S(oe,"ERROR","error"),S(oe,"EMPTIED","emptied"),S(oe,"STALLED","stalled"),S(oe,"LOADED_METADATA","loadedmetadata"),S(oe,"LOADED_DATA","loadeddata"),S(oe,"CANPLAY","canplay"),S(oe,"CANPLAY_THROUGH","canplaythrough"),S(oe,"PLAYING","playing"),S(oe,"WAITING","waiting"),S(oe,"SEEKING","seeking"),S(oe,"SEEKED","seeked"),S(oe,"ENDED","ended"),S(oe,"DURATION_CHANGE","durationchange"),S(oe,"TIME_UPDATE","timeupdate"),S(oe,"PLAY","play"),S(oe,"PAUSE","pause"),S(oe,"RATE_CHANGE","ratechange"),S(oe,"RESIZE","resize"),S(oe,"VOLUME_CHANGE","volumechange"),S(oe,"CHANGE","change"),S(oe,"ADD_TRACK","addtrack"),S(oe,"REMOVE_TRACK","removetrack"),S(oe,"CUE_CHANGE","cuechange"),S(oe,"ENTER_PICTURE_IN_PICTURE","enterpictureinpicture"),S(oe,"LEAVE_PICTURE_IN_PICTURE","leavepictureinpicture"),S(oe,"PERFORMANCE","performance");var ae=oe,se=g((function e(){return y(this,e),S(this,"BWPHEVC","__bwphevc__"),S(this,"SET_READY_STATE","__bwphevc_set_ready_state__"),S(this,"SET_DURATION","__bwphevc_set_duration__"),S(this,"MEDIASOURCE_ATTACH","__bwphevc_mediasource_attach__"),S(this,"MEDIASOURCE_DETACH","__bwphevc_mediasource_detach__"),S(this,"END_OF_STREAM","__bwphevc_end_of_stream__"),S(this,"SOURCEBUFFER_SEEK","__bwphevc_sourcebuffer_seek__"),S(this,"SOURCEBUFFER_IS_ENDED","__bwphevc_sourcebuffer_is_ended__"),S(this,"SOURCEBUFFER_GET_BUFFER","__bwphevc_sourcebuffer_get_buffer__"),S(this,"SOURCEBUFFER_FIRST_INIT","__bwphevc_sourcebuffer_first_init__"),S(this,"DOCUMENT_HAS_SHOWED","__bwphevc_document_has_showed__"),new Proxy(this,{get:function(e,t,r){var n=Reflect.get(e,t,r);return n?Symbol.for(n):n}})})),ue=null!=window.Symbol&&null!=window.Proxy?new se:{},ce=r(715),le=function(){function e(t){if(y(this,e),S(this,"offset",void 0),S(this,"type",void 0),S(this,"size",void 0),S(this,"boxes",void 0),S(this,"isComplete",void 0),S(this,"timescale",void 0),S(this,"earliest_presentation_time",void 0),S(this,"first_offset",void 0),S(this,"references",void 0),S(this,"id",void 0),S(this,"version",void 0),S(this,"value",void 0),S(this,"scheme_id_uri",void 0),S(this,"presentation_time_delta",void 0),S(this,"event_duration",void 0),S(this,"message_data",void 0),S(this,"sequence_number",void 0),S(this,"entry_count",void 0),S(this,"entries",void 0),S(this,"base_data_offset",void 0),S(this,"sample_description_index",void 0),S(this,"default_sample_duration",void 0),S(this,"default_sample_size",void 0),S(this,"default_sample_flags",void 0),S(this,"flags",void 0),S(this,"baseMediaDecodeTime",void 0),S(this,"sample_count",void 0),S(this,"first_sample_flags",void 0),S(this,"data_offset",void 0),S(this,"samples",void 0),S(this,"fragment_duration",void 0),S(this,"track_id",void 0),S(this,"width",void 0),S(this,"height",void 0),S(this,"volume",void 0),S(this,"samplerate",void 0),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var r=0;r<t.boxes.length;r++)this.boxes.push(new e(t.boxes[r]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var n=0;n<t.references.length;n++){var i={reference_type:t.references[n].reference_type,referenced_size:t.references[n].referenced_size,subsegment_duration:t.references[n].subsegment_duration};this.references.push(i)}}break;case"emsg":this.id=t.id,this.version=1===t.version?1:0,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=1===t.version?t.presentation_time:t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":this.timescale=t.timescale;break;case"mfhd":this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.track_id=t.track_ID,this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"trex":this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var o=0,a=t.samples.length;o<a;o++){var s={sample_size:t.samples[o].sample_size,sample_duration:t.samples[o].sample_duration,sample_composition_time_offset:t.samples[o].sample_composition_time_offset};this.samples.push(s)}}break;case"mehd":this.fragment_duration=t.fragment_duration;break;case"tkhd":this.track_id=t.track_ID,this.flags=t.flags,this.width=t.width,this.height=t.height,this.volume=t.volume;break;case"stsd":if(t.entries){var u=t.entries[0];"mp4a"===u.type&&(this.samplerate=u.samplerate)}}}return g(e,[{key:"getChildBox",value:function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t];return null}},{key:"getChildBoxes",value:function(e){for(var t=[],r=0;r<this.boxes.length;r++)this.boxes[r].type===e&&tnction e(){y(this,e),S(this,"parsedIsoFile",void 0)}return g(e,[{key:"getBox",value:function(e){return e&&this.parsedIsoFile&&this.parsedIsoFile.boxes&&0!==this.parsedIsoFile.boxes.length&&"function"==typeof this.parsedIsoFile.fetch?this.convertToDashIsoBox(this.parsedIsoFile.fetch(e)):null}},{key:"getBoxes",value:function(e){var t=[];if(!e||!this.parsedIsoFile||"function"!=typeof this.parsedIsoFile.fetchAll)return t;for(var r,n=this.parsedIsoFile.fetchAll(e),i=0,o=n.length;i<o;i++)(r=this.convertToDashIsoBox(n[i]))&&t.push(r);return t}},{key:"setData",value:function(e){this.parsedIsoFile=e}},{key:"getData",value:function(){return this.parsedIsoFile}},{key:"getLastBox",value:function(){if(!this.parsedIsoFile||!this.parsedIsoFile.boxes||!this.parsedIsoFile.boxes.length)return null;var e=this.parsedIsoFile.boxes[this.parsedIsoFile.boxes.length-1].type,t=this.getBoxes(e);return t.length>0?t[t.length-1]:null}},{key:"convertToDashIsoBox",value:function(e){if(!e)return null;var t=new le(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}}]),e}(),fe=g((function e(t,r,n){y(this,e),S(this,"lastCompletedOffset",void 0),S(this,"found",void 0),S(this,"size",void 0),this.lastCompletedOffset=t,this.found=r,this.size=n})),pe=function(){function e(){y(this,e)}return g(e,[{key:"parse",value:function(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);var t=ce.parseBuffer(e),r=new de;return r.setData(t),r}},{key:"findLastTopIsoBoxCompleted",value:function(e,t,r){if(void 0===r&&(r=0),!t||r+8>=t.byteLength)return new fe(0,!1);for(var n,i=t instanceof ArrayBuffer?new Uint8Array(t):t,o=0;r<i.byteLength;){var a=this.parseUint32(i,r),s=this.parseIsoBoxType(i,r+4);if(0===a)break;r+a<=i.byteLength&&(e.indexOf(s)>=0?n=new fe(r,!0,a):o=r+a),r+=a}return n||new fe(o,!1)}},{key:"getFirstBoxType",value:function(e){return e&&e.boxes&&e.boxes.length?e.boxes[0].type:null}},{key:"getSamplesInfo",value:function(e,t,r,n){var i;if(t)i=t;else if(i=this.parse(e),!e||0===e.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};if(!i)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var o,a,s,u,c,l,d=i.getBoxes("moof"),f=i.getBoxes("mfhd"),p=[],h=NaN,y=i.getBoxes("moof").length,m=f[f.length-1].sequence_number;a=0;for(var g=-1,v=-1,_=0;_<d.length;_++)for(var E=d[_],b=E.getChildBoxes("traf"),S=0;S<b.length;S++){var T=[],w=b[S],A=w.getChildBox("tfhd"),R=w.getChildBox("tfdt");u=R.baseMediaDecodeTime;for(var P=w.getChildBoxes("trun"),D=w.getChildBoxes("subs"),O=0;O<P.length;O++){
var I=P[O];a=I.sample_count,l=(A.base_data_offset||0)+(I.data_offset||0);for(var C=0;C<a;C++){o=void 0!==(c=I.samples[C]).sample_duration?c.sample_duration:A.default_sample_duration||r,s=void 0!==c.sample_size?c.sample_size:A.default_sample_size||n;var N={dts:u,pts:u+(void 0!==c.sample_composition_time_offset?c.sample_composition_time_offset:0),duration:o,offset:E.offset+l,size:s,subSizes:[s]};if(D)for(var k=0;k<D.length;k++){var L=D[k];if(g<L.entry_count-1&&C>v&&(g++,v+=L.entries[g].sample_delta),C==v){N.subSizes=[];for(var x=L.entries[g],M=0;M<x.subsample_count;M++)N.subSizes.push(x.subsamples[M].subsample_size)}}T.push(N),l+=s,u+=o}}h=u-R.baseMediaDecodeTime,T.length>0&&(p[S]?p[S]=p[S].concat(T):p[S]=T)}return{sampleList:p,lastSequenceNumber:m,totalDuration:h,numSequences:y}}},{key:"getMediaTimescaleFromMoov",value:function(e){var t=this.parse(e),r=t?t.getBox("mdhd"):void 0;return r?r.timescale:NaN}},{key:"parseUint32",value:function(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}},{key:"parseIsoBoxType",value:function(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}},{key:"findInitRange",value:function(e){var t,r,n=null,i=this.parse(e);if(!i)return n;var o=i.getBox("ftyp"),a=i.getBox("moov");return a&&a.isComplete&&(t=o?o.offset:a.offset,r=a.offset+a.size-1,n="".con(){return e.instance||(e.instance=new e),e.instance}}]),e}();S(pe,"instance",void 0);var he=pe;function ye(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var me=new WeakMap,ge=new WeakMap,ve=new WeakMap,_e=new WeakMap,Ee=new WeakMap,be=new WeakMap,Se=new WeakMap,Te=new WeakMap,we=new WeakMap,Ae=new WeakMap,Re=new WeakMap,Pe=new WeakMap,De=new WeakMap,Oe=new WeakMap,Ie=new WeakMap,Ce=new WeakMap,Ne=new WeakMap,ke=new WeakMap,Le=new WeakMap,xe=new WeakMap,Me=new WeakMap,Fe=new WeakMap,Ue=new WeakMap,Be=new WeakMap,je=new WeakMap,Ve=new WeakMap,He=new WeakMap,Ge=new WeakMap,qe=new WeakMap,We=new WeakMap,Ke=new WeakMap,Ye=new WeakMap,Qe=new WeakMap,ze=new WeakMap,Ze=new WeakMap,Je=new WeakMap,Xe=new WeakMap,$e=new WeakMap,et=new WeakMap,tt=new WeakMap,rt=new WeakMap,nt=new WeakMap,it=new WeakMap,ot=function(t){_(n,t);var r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}(n);function n(t,i,a,s){var u,l,d;return y(this,n),ye(v(u=r.call(this)),me,{writable:!0,value:void 0}),ye(v(u),ge,{writable:!0,value:"[BwpSourceBuffer]"}),ye(v(u),ve,{writable:!0,value:void 0}),S(v(u),"updating",void 0),ye(v(u),_e,{writable:!0,value:void 0}),ye(v(u),Ee,{writable:!0,value:void 0}),S(v(u),"textTracks",void 0),ye(v(u),be,{writable:!0,value:void 0}),ye(v(u),Se,{writable:!0,value:void 0}),S(v(u),"onupdatestart",void 0),S(v(u),"onupdate",void 0),S(v(u),"onupdateend",void 0),S(v(u),"onerror",void 0),S(v(u),"onabort",void 0),ye(v(u),Te,{writable:!0,value:void 0}),ye(v(u),we,{writable:!0,value:void 0}),ye(v(u),Ae,{writable:!0,value:void 0}),ye(v(u),Re,{writable:!0,value:void 0}),ye(v(u),Pe,{writable:!0,value:void 0}),S(v(u),"generateTimestampsFlag",void 0),ye(v(u),De,{writable:!0,value:void 0}),S(v(u),"mediaType",void 0),ye(v(u),Oe,{writable:!0,value:void 0}),ye(v(u),Ie,{writable:!0,value:void 0}),ye(v(u),Ce,{writable:!0,value:void 0}),ye(v(u),Ne,{writable:!0,value:void 0}),ye(v(u),ke,{writable:!0,value:void 0}),ye(v(u),Le,{writable:!0,value:void 0}),ye(v(u),xe,{writable:!0,value:void 0}),ye(v(u),Me,{writable:!0,value:void 0}),ye(v(u),Fe,{writable:!0,value:void 0}),ye(v(u),Ue,{writable:!0,value:void 0}),ye(v(u),Be,{writable:!0,value:void 0}),ye(v(u),je,{writable:!0,value:.1}),ye(v(u),Ve,{writable:!0,value:function(e){for(var t=0;t<w(v(u),Ae).length;t++){var r=w(v(u),Ae)[t],n=r.trackId,i=w(v(u),Be)[n];if(i){var o=r.getCurrentSegmentIndex(e);w(v(u),me).log(w(v(u),ge),"[".concat(u.mediaType,"] seek to ").concat(e,", target segment index: ").concat(o)),w(v(u),Be)[n]=-1!==o?{index:o-1,fpts:-1,lpts:-1,initSegmentIndex:i.initSegmentIndex}:{index:-1,fpts:-1,lpts:-1,initSegmentIndex:i.initSegmentIndex}}}}}),ye(v(u),He,{writable:!0,value:function(t,r){var n=[],i=!1;if(r)return{buffer:n,isEndOfStream:i,sampleRate:w(v(u),xe)};for(var o=0;o<w(v(u),Ae).length;o++){var a=w(v(u),Ae)[o],s=a.trackId;if(void 0===s)throw new Error("Error track, cannot get trackID");var c=w(v(u),Be)[s];if(!c||c.lpts-t<Q.MIN_DECODE_BUFFER_TIME){var l=-1;if(c&&-1!==c.index)l=c.index+1;else{var d=a.getCurrentSegmentIndex(t);d&&(l=d)}var f=a.getMediaSegment(l);if(f){if(c||(c={},w(v(u),Be)[s]=c),!c||c.initSegmentIndex!==f.initSegmentIndex){var p,h=null===(p=a.getInitSegment(f.initSegmentIndex))||void 0===p?void 0:p.buffer;if(!h)throw new Error("Cannot get init segment buffer.");n.push({data:h,isInitSegment:!0}),c.initSegmentIndex=f.initSegmentIndex}n.push({data:f.buffer,isInitSegment:!1}),c.index=l,c.fpts=f.fpts,c.lpts=f.lpts,w(v(u),me).log(w(v(u),ge),"[".concat(u.mediaType,"] get cache segment, fpts: ").concat(f.fpts,", lpts: ").concat(f.lpts)),w(v(u),Oe).readyState===e.ENDED&&a.isLastSegment(l)&&(i=!0)}}}return{buffer:n,isEndOfStream:i,sampleRate:w(v(u),xe)}}}),ye(v(u),Ge,{writable:!0,value:function(){for(var e=0;e<w(v(u),Ae).length;e++){var t,r=w(v(u),Ae)[e],n=r.trackId;if(void 0!==n&&r.isLastSegment(null===(t=w(v(u),Be)[n])||void 0===t?void 0:t.index))return!0}return!1}}),ye(v(u),qe,{writable:!0,value:function(){if(w(v(u),it).call(v(u)),null!==w(v(u),Ie).error)throw new U;if(w(v(u),Ce).call(v(u)),w(v(u),Re))throw new Error("QuotaExceededError")}}),ye(v(u),We,{writable:!0,value:(l=I(N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,w(v(u),Ke).call(v(u)),e.next=8;break;case 4:return e.prev=4,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return");case 8:A(v(u),ke,null),u.updating=!1,J(v(u),"update"),J(v(u),"updateend");case 12:case"end":return e.stop()}}),e,null,[[0,4]])}))),function(){return l.apply(this,arguments)})}),ye(v(u),Ke,{writable:!0,value:function(){if(null!==w(v(u),Te)){if("WAITING_FOR_SEGMENT"===w(v(u),Pe)){var e;w(v(u),Ye).call(v(u),w(v(u),Te));var t=w(v(u),Ne).getFirstBoxType(null===(e=w(v(u),ke))||void 0===e?void 0:e.getData());"ftyp"===t&&A(v(u),Pe,"PARSING_INIT_SEGMENT"),"moof"===t&&A(v(u),Pe,"PARSING_MEDIA_SEGMENT"),w(v(u),Ke).call(v(u))}if("PARSING_INIT_SEGMENT"===w(v(u),Pe)&&(w(v(u),Qe).call(v(u)),A(v(u),Te,null),A(v(u),ke,null),A(v(u),Pe,"WAITING_FOR_SEGMENT"),w(v(u),Ke).call(v(u))),"PARSING_MEDIA_SEGMENT"===w(v(u),Pe)){if(!w(v(u),De))return console.error("[BwpSourceBuffer] InitalizationSegment must append before MediaSegment!"),void w(v(u),Je).call(v(u));w(v(u),ze).call(v(u)),A(v(u),Te,null),A(v(u),ke,null),A(v(u),Pe,"WAITING_FOR_SEGMENT"),w(v(u),Ke).call(v(u))}}}}),ye(v(u),Ye,{writable:!0,value:function(e){try{A(v(u),ke,w(v(u),Ne).parse(e))}catch(e){console.error(e)}}}),ye(v(u),Qe,{writable:!0,value:function(){var e,t,r,n;if(!w(v(u),Te))throw new Error("Cannot get input buffer!");var i=null===(e=w(v(u),ke))||void 0===e?void 0:e.getBox("mehd");Number.isNaN(w(v(u),Oe).duration)&&(i&&i.fragment_duration?w(v(u),Ze).call(v(u),i.fragment_duration/1e3):w(v(u),Ze).call(v(u),Number.POSITIVE_INFINITY));var a=null===(t=w(v(u),ke))||void 0===t?void 0:t.getBox("trak"),s=a.getChildBox("tkhd");if(w(v(u),me).log(w(v(u),ge),"[".concat(u.mediaType,"] appendBuffer initSegment, track_id: ").concat(s.track_id)),!a)return w(v(u),Je).call(v(u)),void console.error("[BwpSourceBuffer] append error cannot get trak!");if(u.mediaType===c.AUDIO||u.mediaType===c.MIX){var l,d=null===(l=w(v(u),ke))||void 0===l?void 0:l.getBoxes("stsd");if(!d)throw new Error("Cannot get audio sample rate!");var f=u.mediaType===c.MIX&&d.length>1?1:0;A(v(u),xe,d[f].samplerate),
w(v(u),me).log(w(v(u),ge),"[".concat(u.mediaType,"] get audio sample rate ").concat(w(v(u),xe)))}if(w(v(u),De)){w(v(u),me).warn(w(v(u),ge),"[".concat(u.mediaType,"] firstinit is true, received new init segment."));var p=w(v(u),rt).call(v(u),s.track_id);if(!p)throw new Error("Firstinit is true, but cantnot get already push init segment!");w(v(u),Ue)[s.track_id]=p.appendInitSegment({buffer:w(v(u),Te),width:s.width,height:s.height,volume:s.volume})}var h=!1;if(!w(v(u),De)){h=!0;var y=new ie;y.trackId=s.track_id,w(v(u),Ue)[s.track_id]=y.appendInitSegment({buffer:w(v(u),Te),width:s.width,height:s.height,volume:s.volume}),w(v(u),Ae).push(y),h&&(w(v(u),Oe).activeSourceBuffers.push(v(u)),w(v(u),Oe).activeSourceBuffers.dispatchEvent(new Event("addsourcebuffer"))),A(v(u),De,!0)}if(w(v(u),Ie).readyState===o.HAVE_NOTHING){w(v(u),me).log(w(v(u),ge),"[".concat(u.mediaType,"] init segment loop: BwpElement is HAVE_NOTHING"));for(var m=!0,g=w(v(u),Oe).sourceBuffers,_=0;_<g.length;_++)g[_][ue.SOURCEBUFFER_FIRST_INIT]()||(m=!1,w(v(u),me).log(w(v(u),ge),"[".concat(u.mediaType,"] init segment loop: another is not init")));m&&(w(v(u),me).log(w(v(u),ge),"[".concat(u.mediaType,"] init segment loop: have meta")),w(v(u),Ie)[ue.SET_READY_STATE](o.HAVE_METADATA))}var E=null===(r=w(v(u),ke))||void 0===r?void 0:r.getBox("mdhd");A(v(u),Le,E.timescale);var b=null===(n=w(v(u),ke))||void 0===n?void 0:n.getBox("trex");A(v(u),Me,b.default_sample_duration),A(v(u),Fe,b.default_sample_size),h&&w(v(u),Ie).readyState>=o.HAVE_CURRENT_DATA&&w(v(u),Ie)[ue.SET_READY_STATE](o.HAVE_METADATA)}}),ye(v(u),ze,{writable:!0,value:function(){var e,t;if(!w(v(u),Te))throw new Error("Cannot get input buffer!");var r=w(v(u),Ne).getSamplesInfo(w(v(u),Te),w(v(u),ke),w(v(u),Me),w(v(u),Fe)).sampleList[0];if(!r||0===r.length)throw new Error("[BwpSourceBuffer] parsed sample list is empty!");if(!w(v(u),Le))throw new Error("[BwpSourceBuffer] timescale is undefined!");var n=(null===(e=w(v(u),ke))||void 0===e?void 0:e.getBox("tfhd")).track_id,i=w(v(u),rt).call(v(u),n);if(!i)throw new Error("[BwpSourceBuffer] cannot get trackBuffer!");var a=r[r.length-1],s=r[0].dts/w(v(u),Le),c=r[0].pts/w(v(u),Le),l=a.pts/w(v(u),Le);0===s&&(c=0),l>w(v(u),Se)&&(l=w(v(u),Se));var d=w(v(u),Ie),f=(null===(t=w(v(u),ke))||void 0===t?void 0:t.getBox("mfhd")).sequence_number;i.ldt=a.dts,i.lfd=a.duration,i.appendMediaSegment({sequenceNumber:f,initSegmentIndex:w(v(u),Ue)[n],buffer:w(v(u),Te),fpts:c,lpts:l});var p=d.currentTime,h=d.buffered;w(v(u),me).log(w(v(u),ge),"[".concat(u.mediaType,"] appendBuffer mediaSegment, fpts: ").concat(c.toFixed(5),", lpts: ").concat(l.toFixed(5))),h.container(p)&&(d.readyState===o.HAVE_METADATA&&d[ue.SET_READY_STATE](o.HAVE_CURRENT_DATA),d.readyState===o.HAVE_CURRENT_DATA&&h.end(0)>p&&d[ue.SET_READY_STATE](o.HAVE_FUTURE_DATA),d.readyState===o.HAVE_FUTURE_DATA&&h.end(0)-h.start(0)>=w(v(u),je)&&d[ue.SET_READY_STATE](o.HAVE_ENOUGH_DATA)),d.readyState>=o.HAVE_METADATA&&J(d,ae.PROGRESS)}}),ye(v(u),Ze,{writable:!0,value:function(e){}}),ye(v(u),Je,{writable:!0,value:function(){w(v(u),Xe).call(v(u)),u.updating=!1,J(v(u),"error"),J(v(u),"updateend"),w(v(u),Oe).endOfStream("decode")}}),ye(v(u),Xe,{writable:!0,value:function(){w(v(u),me).log(w(v(u),ge),"[".concat(u.mediaType,"] call resetParseState()")),w(v(u),Pe),w(v(u),$e).call(v(u)),A(v(u),Te,null),A(v(u),ke,null),A(v(u),Pe,"WAITING_FOR_SEGMENT")}}),ye(v(u),$e,{writable:!0,value:function(){for(var e=0;e<w(v(u),Ae).length;e++){var t=w(v(u),Ae)[e];t.ldt=void 0,t.lfd=void 0,t.het=void 0,t.nrapFlag=!0}}}),ye(v(u),et,{writable:!0,value:(d=I(N().mark((function e(t,r){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.updating=!0,e.next=3,u.dispatchEvent(new Event("updatestart"));case 3:w(v(u),me).log(w(v(u),ge),"[".concat(u.mediaType,"] call removeBuffer, start: ").concat(t,", end: ").concat(r)),w(v(u),tt).call(v(u),t,r),u.updating=!1,J(v(u),"update"),J(v(u),"updateend");case 8:case"end":return e.stop()}}),e)}))),function(e,t){return d.apply(this,arguments)})}),ye(v(u),tt,{writable:!0,value:function(e,t){for(var r=0;r<w(v(u),Ae).length;r++){var n=w(v(u),Ae)[r],i=n.trackId;if(n.trackRanges,void 0===i)throw new Error("Error track, cantnot get track id");var a=n.remove(e,t);w(v(u),$e).call(v(u));var s=w(v(u),Ie);w(v(u),Oe).activeSourceBuffers.indexOf(v(u))&&(s.currentTime>=e&&s.currentTime<t&&s.readyState>o.HAVE_METADATA&&s[ue.SET_READY_STATE](o.HAVE_METADATA),a&&s.readyState>=o.HAVE_METADATA&&J(s,ae.PROGRESS))}w(v(u),Re)&&A(v(u),Re,!1)}}),ye(v(u),rt,{writable:!0,value:function(e){for(var t=0;t<w(v(u),Ae).length;t++){var r=w(v(u),Ae)[t];if(e===r.trackId)return r}return null}}),ye(v(u),nt,{writable:!0,value:function(){return-1===w(v(u),Oe).sourceBuffers.indexOf(v(u))}}),ye(v(u),it,{writable:!0,value:function(){if(w(v(u),nt).call(v(u)))throw new U;if(u.updating)throw new Error("This SourceBuffer is still processing an 'appendBuffer' or 'remove' operation.")}}),A(v(u),me,ne.getInstance()),u.mediaType=t,A(v(u),Ie,i),A(v(u),Oe,a),A(v(u),Ce,s),u.updating=!1,A(v(u),_e,new q),A(v(u),Ee,0),u.textTracks=new Z,A(v(u),Se,1/0),A(v(u),be,0),A(v(u),Te,null),A(v(u),we,0),A(v(u),Re,!1),A(v(u),Ae,[]),A(v(u),De,!1),A(v(u),Pe,"WAITING_FOR_SEGMENT"),A(v(u),Ue,{}),A(v(u),Be,{}),u[ue.SOURCEBUFFER_SEEK]=w(v(u),Ve),u[ue.SOURCEBUFFER_GET_BUFFER]=w(v(u),He),u[ue.SOURCEBUFFEURCEBUFFER_FIRST_INIT]=function(){return w(v(u),De)},A(v(u),Ne,he.getInstance()),w(v(u),me).log(w(v(u),ge),"SOURCE BUFFER CREATE"),u}return g(n,[{key:"mode",get:function(){return w(this,ve)},set:function(e){if(e===u.SEQUENCE)throw new Error("Mode sequence is not implemented!");if(w(this,it).call(this),this.generateTimestampsFlag&&"segments"===e)throw new TypeError("GenerateTimestampsFlag is true, not support segments mode");if(w(this,Ce).call(this),"PARSING_MEDIA_SEGMENT"===w(this,Pe))throw new U;w(this,Oe).readyState&&w(this,me).log(w(this,ge),"[".concat(this.mediaType,"] MediaSource is working fine!, readyState:"),w(this,Oe).readyState.toString()),A(this,ve,e)}},{key:"buffered",get:function(){if(w(this,nt).call(this))return A(this,_e,new q),w(this,_e);for(var t=0,r=w(this,Ae).length,n=0;n<r;n++){var i=w(this,Ae)[n].trackRanges;if(i.length>0){var o=i.end(i.length-1);o>t&&(t=o)}}if(0===t)return w(this,_e).length>0&&w(this,_e).clear(),w(this,_e);var a=new q;a.add(0,t);for(var s=0;s<r;s++){var u=w(this,Ae)[s].trackRanges;a=K(a,u);var c=u.length;if(c>0){var l=u.end(c-1);w(this,Oe).readyState===e.ENDED&&(t=l)}}return A(this,_e,a),w(this,_e)}},{key:"timestampOffset",get:function(){return w(this,Ee)},set:function(e){if(w(this,it).call(this),w(this,Ce).call(this),"PARSING_MEDIA_SEGMENT"===w(this,Pe))throw new U;A(this,Ee,e)}},{key:"appendWindowStart",get:function(){return w(this,be)},set:function(e){if(w(this,me).log(w(this,ge),"[".concat(this.mediaType,"] set appendWindowStart: ").concat(e)),w(this,it).call(this),e<0||e>=w(this,Se))throw new TypeError("AppendWindowStart cannot greater than or equal End.");A(this,be,e)}},{key:"appendWindowEnd",get:function(){return w(this,Se)},set:function(e){if(w(this,me).log(w(this,ge),"[".concat(this.mediaType,"] set appendWindowEnd: ").concat(e)),w(this,it).call(this),Number.isNaN(e))throw new TypeError;if(e<=w(this,be))throw new TypeError("AppendWindowEnd cannot less then or equal Start.");A(this,Se,e)}},{key:"appendBuffer",value:function(e){if(w(this,qe).call(this),w(this,Te)){var t=new Uint8Array(w(this,Te)),r=new Uint8Array(e),n=new Uint8Array(t.length+r.length);n.set(t),n.set(r,t.length),A(this,Te,n.buffer)}else A(this,Te,e);this.updating=!0,this.dispatchEvent(new Event("updatestart")),w(this,We).call(this)}},{key:"abort",value:function(){if(w(this,nt).call(this))throw new Error("This SourceBuffer has been removed from the parent media source.");if(w(this,Oe).readyState!==e.OPEN)throw new U;this.updating&&(w(this,me).log(w(this,ge),"[".concat(this.mediaType,"] Call abort when this.updating is true.")),this.updating=!1,J(this,"abort"),J(this,"updateend")),w(this,Xe).call(this),this.appendWindowStart=0,this.appendWindowEnd=Number.POSITIVE_INFINITY}},{key:"remove",value:function(e,t){w(this,it).call(this),
w(this,me).log(w(this,ge),"[".concat(this.mediaType,"] remove buffer: ").concat(e,", ").concat(t));var r=w(this,Oe).duration;if(Number.isNaN(r))throw new TypeError("MediaSource duration cannot NaN");if(e<0||e>r)throw new TypeError("Start must be valid.");if(t<=e||Number.isNaN(t))throw new TypeError("end must be valid.");w(this,Ce).l.replace].call(this,r,i)},st.apply(this,arguments)}function ut(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var ct=new WeakMap,lt=new WeakMap,dt=new WeakMap,ft=new WeakMap,pt=new WeakMap,ht=new WeakMap,yt=new WeakMap,mt=new WeakMap,gt=new WeakMap,vt=new WeakMap,_t=new WeakMap,Et=new WeakMap,bt=new WeakMap,St=new WeakMap,Tt=new WeakMap,wt=function(t){_(n,t);var r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}(n);function n(){var t;return y(this,n),ut(v(t=r.call(this)),ct,{writable:!0,value:void 0}),ut(v(t),lt,{writable:!0,value:"[BwpMediaSource]"}),S(v(t),"sourceBuffers",void 0),S(v(t),"activeSourceBuffers",void 0),ut(v(t),dt,{writable:!0,value:void 0}),ut(v(t),ft,{writable:!0,value:void 0}),S(v(t),"onsourceopen",void 0),S(v(t),"onsourceended",void 0),S(v(t),"onsourceclose",void 0),ut(v(t),pt,{writable:!0,value:void 0}),ut(v(t),ht,{writable:!0,value:void 0}),ut(v(t),yt,{writable:!0,value:void 0}),ut(v(t),mt,{writable:!0,value:function(e){if(w(v(t),ft)!==e){for(var r=NaN,n=0;n<t.sourceBuffers.length;n++){var i=t.sourceBuffers[n].buffered;if(i.length>0){var o=i.end(i.length-1);o>-1&&(!r||o>r)&&(r=o)}}if(r&&e<r)throw new Error("InvalidStateError, duration must be valid");A(v(t),ft,e),w(v(t),ht)[ue.SET_DURATION](e)}}}),ut(v(t),gt,{writable:!0,value:function(r){if(A(v(t),dt,e.ENDED),J(v(t),"sourceended"),w(v(t),ct).warn(w(v(t),lt),"source ended"),!r){for(var n=0,i=0;i<t.sourceBuffers.length;i++){var o=t.sourceBuffers[i].buffered;if(o.length>0){var a=o.end(o.length-1);a>n&&(n=a)}}w(v(t),mt).call(v(t),n)}}}),S(v(t),"createObjectURL",(function(){window[ue.BWPHEVC]||(window[ue.BWPHEVC]={});var e="xxMath.random()|0;return("x"==e?t:3&t|8).toString(16)})),r="blob:".concat(window.location.origin,"/").concat(e);return window[ue.BWPHEVC][r]=v(t),r})),ut(v(t),vt,{writable:!0,value:function(e){A(v(t),ht,e),window[ue.DOCUMENT_HAS_SHOWED]?(A(v(t),yt,!1),w(v(t),bt).call(v(t))):A(v(t),yt,!0)}}),ut(v(t),_t,{writable:!0,value:function(){A(v(t),dt,e.CLOSED),A(v(t),ft,NaN);for(var r=t.activeSourceBuffers.length;r>0;r--)t.activeSourceBuffers.remove(r-1);t.activeSourceBuffers.dispatchEvent(new Event("removesourcebuffer"));for(var n=t.sourceBuffers.length;n>0;n--)t.sourceBuffers.remove(n-1);t.sourceBuffers.dispatchEvent(new Event("removesourcebuffer")),J(v(t),"sourceclose"),w(v(t),ct).warn(w(v(t),lt),"source close")}}),ut(v(t),Et,{writable:!0,value:function(){w(v(t),dt)===e.ENDED&&(A(v(t),dt,e.OPEN),J(v(t),"sourceopen"),w(v(t),ct).log(w(v(t),lt),"source open"))}}),ut(v(t),bt,{writable:!0,value:function(){document.removeEventListener("visibilitychange",w(v(t),St)),A(v(t),dt,e.OPEN),J(v(t),"sourceopen"),w(v(t),ct).log(w(v(t),lt),"source open")}}),ut(v(t),St,{writable:!0,value:function(){w(v(t),Tt).call(v(t))&&(window[ue.DOCUMENT_HAS_SHOWED]||(window[ue.DOCUMENT_HAS_SHOWED]=!0),w(v(t),yt)&&(A(v(t),yt,!1),w(v(t),ct).warn(w(v(t),lt),"visibility change trigger sourceopen"),setTimeout((function(){w(v(t),bt).call(v(t))}),0)))}}),ut(v(t),Tt,{writable:!0,value:function(){return"visible"===document.visibilityState}}),A(v(t),ct,ne.getInstance()),t.sourceBuffers=new D,t.activeSourceBuffers=new D,A(v(t),dt,e.CLOSED),A(v(t),ft,NaN),A(v(t),pt,!0),A(v(t),yt,!1),void 0===window[ue.DOCUMENT_HAS_SHOWED]&&(window[ue.DOCUMENT_HAS_SHOWED]=w(v(t),Tt).call(v(t))),window[ue.DOCUMENT_HAS_SHOWED]||document.addEventListener("visibilitychange",w(v(t),St)),t[ue.MEDIASOURCE_ATTACH]=w(v(t),vt),t[ue.MEDIASOURCE_DETACH]=w(v(t),_t),w(v(t),ct).log(w(v(t),lt),"MediaSource CREATE, readyState is: ".concat(w(v(t),dt))),t}return g(n,[{key:"readyState",get:function(){return w(this,dt)}},{key:"duration",get:function(){return w(this,dt)===e.CLOSED?NaN:w(this,ft)},set:function(t){if(!t||t<0)throw new TypeError("Failed to set the 'duration' property on 'BwpMediaSource': The duration provided (".concat(t,") is less than the minimum bound (0)."));if(w(this,dt)!==e.OPEN)throw new DOMException("Failed to set the 'duration' property on 'BwpMediaSource': The BwpMediaSource's readyState is not 'open'.");w(this,mt).call(this,t)}},{key:"addSourceBuffer",value:function(t){if(!t||!t.trim())throw new TypeError("Failed to execute 'addSourceBuffer' on 'MediaSource': The type provided is empty");var r=t.match(st(/(video|audio)\/mp4;.*?codecs="(hev|mp4a|hvc).*?(,(mp4a).*?|)"(;width="(.*?)";height="(.*?)"|)/,{mediaType:1,codec:2,codec2:4,width:6,height:7})),n=null==r?void 0:r.groups;if(!r||!n)throw new DOMException("Failed to execute 'addSourceBuffer' on 'MediaSource': The type provided ('".concat(t,"') is unsupported."));var i,o=n.mediaType,a=n.codec,s=n.codec2;if(!o||!a)throw new DOMException("Failed to execute 'addSourceBuffer' on 'MediaSource': The type provided ('".concat(t,"') is unsupported."));if("video"===o&&A(this,pt,"hev"===a||"hvc"===a),w(this,ct).log(w(this,lt),"ready to add SourceBuffer: ".concat(t,", isHEVC: ").concat(w(this,pt),", readyState: ").concat(this.readyState)),!w(this,pt))throw new Error("H.264 not implemented");if(w(this,dt)!==e.OPEN)throw new Error("InvalidStateError, BwpMediaSource ready state not open!");i="audio"===o?c.AUDIO:"mp4a"===s?c.MIX:c.VIDEO;var u=new at(i,w(this,ht),this,w(this,Et));return this.sourceBuffers.push(u),u.generateTimestampsFlag=!1,u.mode="segments",this.sourceBuffers.dispatchEvent(new Event("addsourcebuffer")),u}},{key:"removeSourceBuffer",value:function(e){if(w(this,ct).log(w(this,lt),"remove SourceBuffer: ".concat(e)),-1===this.sourceBuffers.indexOf(e))throw new Error("SourceBuffer not in SourceBuffers");e.updating&&(e.abort(),J(e,"abort"),J(e,"updateend"));var t=this.activeSourceBuffers.indexOf(e);-1!==t&&(this.activeSourceBuffers.remove(t),J(this.activeSourceBuffers,"removesourcebuffer")),this.sourceBuffers.remove(this.sourceBuffers.indexOf(e))}},{key:"endOfStream",value:function(t){if(w(this,ct).log(w(this,lt),"endOfStream, isHEVC: ".concat(w(this,pt),", error: ").concat(t)),w(this,dt)!==e.OPEN)throw new DOMException("Failed to execute 'endOfStream' on 'MediaSource': The MediaSource's readyState is not 'open'.");for(var r=0;r<this.sourceBuffers.length;r++)if(this.sourceBuffers[r].updating)throw new Error("InvalidStateError, some BwoSourceBuffer is updating");w(this,gt).call(this,t),w(this,ht)[ue.END_OF_STREAM]()}}],[{key:"isTypeSupported",value:function(e){if(0===e.length)return!1;var t=e.match(st(/(video|audio)\/mp4;.*?codecs="(hev|mp4a|hvc).*?(,(mp4a).*?|)"(;width="(.*?)";height="(.*?)"|)/,{mediaType:1,codec:2,codec2:4,width:6,height:7})),r=null==t?void 0:t.groups;if(t&&r){
var n=r.mediaType,i=r.codec,o=parseInt(r.width,10),a=parseInt(r.height,10);if(!n||!i)return!1;if("video"===n&&("hev"===i||"hvc"===i))return!(o>=3840&&a>1080);if("audio"===n&&"mp4a"===i)return!0}return!1}}]),n}(P),At=g((function e(){y(this,e)}));S(At,"WASM_PLAYER_ERROR",7e3),S(At,"CORE_PLAYER_LOAD_ERROR",7001),S(At,"CORE_PLAYER_MODULE_LOAD_TIMEOUT",7002),S(At,"CORE_PLAYER_EXCEPTION",7003),S(At,"WASM_MEMORY_MALLOC_ERROR",7004),S(At,"CORE_PLAYER_ADD_FUNCTION_ERROR",7005),S(At,"CORE_PLAYER_JS_ERROR",7006),S(At,"AUDIO_RENDER_ERROR",7007),S(At,"AUDIO_CHANNELS_NOT_SUPPORT",7008),S(At,"TRIGGER_CANPLAY_ERROR",7009),S(At,"OUT_OF_SYNC",7013);var Rt=At,Pt=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]);function Dt(){try{return"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(Pt)}catch(e){return!1}}var Ot=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);function It(){try{return WebAssembly.validate(Ot)}catch(e){return!1}}function Ct(){var e,t,r=document.createElement("canvas"),n="",i="";try{(e=r.getContext("webgl")||r.getContext("webgl2")||r.getContext("experimental-webgl"))&&(t=e.getExtension("WEBGL_debug_renderer_info"))&&(n=e.getParameter(t.UNMASKED_VENDOR_WEBGL),i=e.getParameter(t.UNMASKED_RENDERER_WEBGL))}catch(e){return null}return{vendor:n,renderer:i}}var Nt="name",kt="version";function Lt(e,t){for(var r,n,i,o,a,s={},u=0;u<t.length;u+=2){r=t[u],i=t[u+1];for(var c=0;c<r.length;c++)if(a=r[c].exec(e)){for(var l=0;l<i.length;l++)o=a[l+1],"object"===p(n=i[l])&&n.length>0?2===n.length?s[n[0]]=n[1]:console.error("[Browser] [rgxMapper] not support arg count!"):s[n]=o||void 0;return s}}return s}function xt(){return(xt=I(N().mark((function e(t,r,n){var i,o;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{credentials:"same-origin"});case 2:if((i=e.sent).ok){e.next=5;break}throw new Error("failed to load wasm file from network");case 5:return e.next=7,i.arrayBuffer();case 7:return o=e.sent,e.next=10,t.put(r,o);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Mt=function(){function e(t,r){y(this,e),S(this,"dbName",void 0),S(this,"storeName",void 0),S(this,"dbPromise",void 0),this.dbName=t,this.storeName=r,this.initDB()}var t,r,n,i,o;return g(e,[{key:"initDB",value:function(e){var t=this;if(!ee().indexedDB)throw new Error("Not support indexedDB!");var r=indexedDB.open(this.dbName,e);this.dbPromise=new Promise((function(e,n){r.onsuccess=function(){e(r.result)},r.onupgradeneeded=function(){r.result.objectStoreNames.contains(t.storeName)||r.result.createObjectStore(t.storeName)},r.onerror=function(e){n(e)}}))}},{key:"getObjectStore",value:(o=I(N().mark((function e(t){var r,n;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbPromise;case 2:return r=e.sent,n=r.transaction(this.storeName,t),e.abrupt("return",n.objectStore(this.storeName));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"get",value:(i=I(N().mark((function e(t){var r;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getObjectStore("readonly");case 2:return r=e.sent,e.abrupt("return",new Promise((function(e,n){var i=r.get(t);i.onsuccess=function(){e(i.result)},i.onerror=n})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"put",value:(n=I(N().mark((function e(t,r){var n;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getObjectStore("readwrite");case 2:return n=e.sent,e.abrupt("return",newvar o=n.put(r,t);o.onsuccess=function(){e(o.result)},o.onerror=i})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"delete",value:(r=I(N().mark((function e(t){var r;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getObjectStore("readwrite");case 2:return r=e.sent,e.abrupt("return",r.delete(t));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"clear",value:(t=I(N().mark((function e(){var t;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getObjectStore("readwrite");case 2:return t=e.sent,e.abrupt("return",t.clear());case 4:case"end":return e.stop()}}),e,this)}))),function(){return tsSupported",value:function(){return!!ee().indexedDB}}]),e}(),Ft=Mt,Ut={BROWSER_LIST:{Chrome:{min:80,blackList:[]},Edge:{min:80,blackList:[]}},OS_LIST:{Windows:!0,"Mac OS":!0},BASE_CPU_CORE_NUMBER:4},Bt="[Browser]",jt=ne.getInstance(),Vt=navigator.userAgent,Ht="bwphevc_supported",Gt=!1,qt=null,Wt={browser:!1,browserHEVC:!1,cpu:!1,gpu:!1,gpuInfo:null,simd:!1,pthread:!1,hardwareConcurrency:0};function Kt(e){var t=JSON.stringify({version:l,ua:Vt,supported:e,supportInfo:Wt,cached:Gt,date:+new Date});localStorage.setItem(Ht,t)}function Yt(e){setTimeout((function(){var t=Wt.simd?f:d;(function(e,t,r){return xt.apply(this,arguments)})(new Ft("bwphevc","lib"),"libwpengn.wasm",t).then((function(){jt.log(Bt,"Cache done!"),Gt=!0,Kt(!0),e(!0)})).catch((function(){e(!1)}))}),arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Qt(){if(null!==qt)return qt&&Gt;qt=!1;try{if("undefined"==typeof localStorage)return!1}catch(e){return!1}var e=JSON.parse(localStorage.getItem(Ht)||"null"),t=(null==e?void 0:e.version)===l,r=!(e&&t&&e.ua===Vt),n=window.navigator.hardwareConcurrency>=6?6e3:9e3;return r?(Gt=Boolean(e&&e.cached&&t),setTimeout((function(){var e,t,r,n,i,o,a,s,u,c=(e=+new Date,t=function(){var e,t,r="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:null,n="other",i="other",o="0";if(null!==r){n=function(e){var t=Lt(e,[[/microsoft (windows) (vista|xp)/i],"",[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[/ ]?([\d.\w ]*)/i,/(windows)[/ ]?([ntce\d. ]+\w)(?!.+xbox)/i],[Nt],[/(win(?=3|9|n)|win 9x )([nt\d.]+)/i],"Windows",[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[Nt,"iOS"]],[/(mac os x) ?([\w. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[Nt,"Mac OS"]]]).name;return{Windows:!0,"Mac OS":!0}[t]?t:"other"}(r);var a=function(e){var t=Lt(e,[[/edg(?:e|ios|a)?\/([\w.]+)/i],[kt,[Nt,"Edge"]],[/\bopr\/([\w.]+)/i],[kt,[Nt,"Opera"]],[/(kindle)\/([\w.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[/ ]?([\w.]*)/i,/(avant |iemobile|slim)(?:browser)?[/ ]?([\w.]*)/i,/(ba?idubrowser)[/ ]?([\w.]+)/i,/(?:ms|\()(ie) ([\w.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w.]+)/i,/(weibo)__([\d.]+)/i],[Nt,kt],[/(?:\buc? ?browser|(?:juc.+)ucweb)[/ ]?([\w.]+)/i],[kt,[Nt,"UCBrowser"]],[/\bqbcore\/([\w.]+)/i],[kt,[Nt,"WeChat(Win) Desktop"]],[/micromessenger\/([\w.]+)/i],[kt,[Nt,"WeChat"]],[/konqueror\/([\w.]+)/i],[kt,[Nt,"Konqueror"]],[/trident.+rv[: ]([\w.]{1,9})\b.+like gecko/i],[kt,[Nt,"IE"]],[/yabrowser\/([\w.]+)/i],[kt,[Nt,"Yandex"]],[/(avast|avg)\/([\w.]+)/i],[[Nt,"Avast/AVG Secure Browser"],kt],[/coc_coc\w+\/([\w.]+)/i],[kt,[Nt,"Coc Coc"]],[/dolfin\/([\w.]+)/i],[kt,[Nt,"Dolphin"]],[/slbrowser\/([\w.]+)/i],[kt,[Nt,"Lenovo"]],[/115browser\/([\w.]+)/i],[kt,[Nt,"115 Browser"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[Nt,"360 Browser"]],[/(comodo_dragon)\/([\w.]+)/i],[[Nt,"Comodo Dragon"],kt],[/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[/ ]?([\w.]+)/i],[Nt,kt],[/(metasr)[/ ]?([\w.]+)/i,/(lbbrowser)/i],[Nt],[/headlesschrome(?:\/([\w.]+)| )/i],[kt,[Nt,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w.]+)/i],[[Nt,"Chrome WebView"],kt],[/(chrome)\/v?([\w.]+)/i],[[Nt,"Chrome"],kt]]);return{browser:{Chrome:!0,Edge:!0}[t.name]?t.name:"other",version:t.version||"0"}}(r);i=a.browser,o=a.version}return{ua:r||"",os:n,browser:i,version:o,gpuInfo:Ct(),hardwareConcurrency:window.navigator.hardwareConcurrency||0,isSIMDSupported:It(),
isPThreadSupported:Dt(),isSupportHEVC:(null===(e=window.MediaSource)||void 0===e||null===(t=e.isTypeSupported)||void 0===t?void 0:t.call(e,'video/mp4; codecs="hev1.1.6.L120.90"'))||!1}}(),r=Ut.BROWSER_LIST[t.browser],n=!!Ut.OS_LIST[t.os]&&!!r&&parseFloat("".concat(t.version))>=r.min,i=!!t.gpuInfo,o=t.hardwareConcurrency>=Ut.BASE_CPU_CORE_NUMBER,a=t.isPThreadSupported,s=t.isSupportHEVC,u=!(!(a&&o&&i&&n)||s&&"Edge"!==t.browser),jt.warn(Bt,"supportedChecker end spent: ".concat(+new Date-e,"ms, pass: ").concat(u)),{pass:u,supportInfo:{browser:n,browserHEVC:s,cpu:o,gpu:i,gpuInfo:t.gpuInfo,simd:t.isSIMDSupported,pthread:a,hardwareConcurrency:t.hardwareConcurrency}});Wt=c.supportInfo,Kt(qt=c.pass),qt&&!Gt&&Yt((function(){}))}),n)):null!=e&&e.supported?(qt=!0,Wt=(null==e?void 0:e.supportInfo)||Wt,null!=e&&e.cached?(jt.log(Bt,"SUPPORT! Already cached!"),Gt=!0):(jt.log(Bt,"SUPPORT! But not cache done!"),Gt=!1,Yt((function(){}),n))):jt.log(Bt,"Not SUPPORT!"),Boolean(qt&&Gt)}var zt,Zt=g((function e(){var t;y(this,e),S(this,"fps",void 0),S(this,"creationTime",void 0),S(this,"totalVideoFrames",void 0),S(this,"droppedVideoFrames",void 0),this.fps=0,this.totalVideoFrames=0,this.droppedVideoFrames=0,this.creationTime=+new Date-((null===(t=window.performance)||void 0===t?void 0:t.timing.navigationStart)||0)}));!function(e){e.CANPtTime,a.isDebug)}}}()}();',"Worker",void 0,void 0)
}var er=g((function e(){y(this,e)})),tr=Event;"function"!=typeof Event&&(tr=er);var rr=tr,nr=function(e){_(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}(r);function r(e,n,i){var o;return y(this,r),S(v(o=t.call(this,ae.PERFORMANCE,i)),"errorCode",void 0),S(v(o),"describe",void 0),o.errorCode=e,o.describe=n,o}return g(r)}(rr),ir=function(e){_(n,e);var t,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}(n);function n(e,t){var i;return y(this,n),S(v(i=r.call(this)),"logger",void 0),S(v(i),"TAG","[AudioWorkletRender]"),S(v(i),"DEFAULT_VOLUME",1),S(v(i),"audioCtx",void 0),S(v(i),"gainNode",void 0),S(v(i),"audioBuffer",void 0),S(v(i),"audioprocessCallback",void 0),S(v(i),"errorCallback",void 0),S(v(i),"bwpProcessorUrl",void 0),S(v(i),"bwpProcessorNode",void 0),S(v(i),"_muted",void 0),S(v(i),"_volume",void 0),S(v(i),"playState",void 0),S(v(i),"seeking",void 0),S(v(i),"seekFlag",void 0),S(v(i),"onmessage",(function(e){var t=e.data;if(t&&i.audioCtx){var r=t.message,n=t.options;if("TIME_UPDATE"===r){var o=n.currentTime,a=n.bufferTime,s=n.timeStamp;void 0===o||void 0===a||i.seeking||i.audioprocessCallback&&i.audioprocessCallback(o,a,s)}else"SEEKED"===r?(null==n?void 0:n.seekFlag)===i.seekFlag&&(i.seeking=!1):"ERROR"===r&&i.errorCallback&&i.errorCallback(Rt.AUDIO_RENDER_ERROR,(null==n?void 0:n.detail)||"BwpProcessor unknow error")}})),S(v(i),"setAutoResume",(function(){for(var e=["keydown","mousedown","touchstart"],t=0;t<e.length;t++)document.addEventListener(e[t],(function(){i.resume()}),{once:!0})})),i.logger=ne.getInstance(),i.audioCtx=null,i.gainNode=null,i.audioBuffer=[],i._muted=!1,i._volume=i.DEFAULT_VOLUME,i.playState=!1,i.seeking=!1,i.audioprocessCallback=e,i.errorCallback=t,i}return g(n,[{key:"muted",get:function(){return this._muted},set:function(e){e!==this._muted&&(this._muted=e,this.gainNode&&(this.gainNode.gain.value=e?0:this._volume))}},{key:"volume",get:function(){return this._volume},set:function(e){e!==this._volume&&(this._volume=e,this.gainNode&&!this._muted&&(=this.audioCtx)||void 0===e?void 0:e.sampleRate)||0}},{key:"preCreateContext",value:function(e){this.logger.warn(this.TAG,"pre create AudioContext with sampleRate: ".concat(e)),this.audioCtx=new(window.AudioContext||window.webkitAudioContext)({sampleRate:e})}},{key:"play",value:function(){this.playState=!0){this.playState=!1,this.postSimpleMessage("PAUSE")}},{key:"seek",value:function(){var e;this.seeking=!0,this.seekFlag=+new Date,null===(e=this.bwpProcessorNode)||void 0===e||e.port.postMessage({message:"SEEK",seekFlag:this.seekFlag})}},{key:"canPlay",value:function(){return!(!this.audioCtx||"suspended"===this.audioCtx.state)}},{key:"isPlaying",value:function(){return this.playState}},{key:"fillBuffer",value:function(e){var t;null===(t=this.bwpProcessorNode)||void 0===t||t.port.postMessage({message:"APPEND_BUr",value:function(){this.postSimpleMessage("FLUSH")}},{key:"init",value:(t=I(N().mark((function e(t){var r,n,i,o=this;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.log(this.TAG,"init audio worklet render with sampleRate: ".concat(t)),r=+new Date,this.audioCtx&&this.audioCtx.sampleRate!==t&&this.destroy(!0),e.prev=3,this.bwpProcessorUrl=URL.createObjectURL(new Blob(['!function(){class s extends AudioWorkletProcessor{constructor(s){super(s),this.playState=!1,this.offset=0,this.audioBuffer=[],this.port.onmessage=this.onmessage.bind(this)}flush(){this.audioBuffer.length=0,this.offset=0}seek(s){this.flush(),this.postMessage("SEEKED",{seekFlag:s})}postMessage(s,e){this.port.postMessage({message:s,options:e})}onmessage(s){const{data:e}=s;if(!e)return;const t=e?.message,i=e?.buffer;if("APPEND_BUFFER"===t)if(i){if(this.audioBuffer.push(i),!this.playState){const s=this.audioBuffer[0].time,e=this.audioBuffer[this.audioBuffer.length-1].time;this.postMessage("TIME_UPDATE",{currentTime:-1,bufferTime:e-s})}}else this.postMessage("ERROR",{detail:"[BwpProcessor] must valid buffer"});else"PLAY"===t?this.playState=!0:"PAUSE"===t?this.playState=!1:"FLUSH"===t?this.flush():"SEEK"===t&&this.seek(e?.seekFlag)}process(s,e,t){const i=this.audioBuffer[0],f=e[0][0],o=e[0][1];if(!f||f&&!f.length)return this.postMessage("ERROR",{detail:"[BwpProcessor] must have left channel"}),!1;if(!o||o&&!o.length)return this.postMessage("ERROR",{detail:"[BwpProcessor] must have right channel"}),!1;if(!i||!this.playState){for(let s=0;s<f.length;s++)f[s]=0,o[s]=0;return!0}const h=i.channels,r=new Float32Array(i.data);for(let s=0;s<f.length;s++)2===h?(f[s]=r[2*s+this.offset],o[s]=r[2*s+1+this.offset]):(f[s]=r[s+this.offset],o[s]=r[s+this.offset]);if(0===this.offset){const s=this.audioBuffer[this.audioBuffer.length-1].time-i.time;this.postMessage("TIME_UPDATE",{currentTime:i.time,bufferTime:s,timeStamp:+new Date})}return this.offset+=f.length*h,this.offset>=r.length&&(this.offset=0,this.audioBuffer.shift()),!0}}registerProcessor("bwp-processor",s)}();'],{type:"application/javascript"})),this.audioCtx||(this.logger.warn(this.TAG,"create new AudioContext with sampleRate: ".concat(t)),this.audioCtx=new(window.AudioContext||window.webkitAudioContext)({sampleRate:t})),i=this.audioCtx,this.gainNode=i.createGain(),e.next=10,null===(n=i.audioWorklet)||void 0===n?void 0:n.addModule(this.bwpProcessorUrl);case 10:if(i&&this.gainNode){e.next=12;break}return e.abrupt("return");case 12:this.bwpProcessorNode=new window.AudioWorkletNode(i,"bwp-processor",{channelCount:2,numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2]}),this.bwpProcessorNode.port.onmessage=this.onmessage,this.bwpProcessorNode.port.start(),this.bwpProcessorNode.connect(this.gainNode),this.gainNode.connect(i.destination),this.gainNode.gain.value=this._muted?0:this._volume,URL.revokeObjectURL(this.bwpProcessorUrl),this.logger.warn(this.TAG,"init AudioWorkletNode done, ".concat(+new Date-r," ms,"),"volume: ".concat(this._volume,", muted: ").concat(this._muted)),setTimeout((function(){o.triggerCanplay()})),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),this.errorCallback&&this.errorCallback(Rt.AUDIO_RENDER_ERROR,(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"BwpProcessor init error");case 26:this.setAutoResume();case 27:case"end":return e.stop()}}),e,this,[[3,23]])}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{null!==this.audioCtx&&(this.gainNode&&this.bwpProcessorNode&&(this.flushBuffer(),this.bwpProcessorNode.port.onmessage=null,this.bwpProcessorNode.port.close(),this.bwpProcessorNode.disconnect(this.gainNode),this.gainNode.disconnect(this.audioCtx.destination)),this.audioCtx.close()),this.audioCtx=null,this.gainNode=null,e||(this.audioprocessCallback=null,this.errorCallback=null),this.audioBuffer.length=0,this.playState=!1,this.muted=!1,this._volume=1,this.seeking=!1,this.seekFlag=0}catch(e){}}},{key:"postSimpleMessage",value:function(e){var t;null===(t=this.bwpProcessorNode)||void 0===t||t.port.postMessage({message:e})}},{key:"resume",value:function(){var e=this;this.audioCtx&&"suspended"===this.audioCtx.state&&this.audioCtx.resume().then((function(){e.triggerCanplay(),e.playState&&e.logger.warn(e.TAG,"Audio is resumed")}))}},{key:"triggerCanplay",value:function(){
this.canPlay()&&(this.logger.warn(this.TAG,"audio render [canplay]"),J(this,zt.CANPLAY))}}]),n}(P),or=ir,ar=g((function e(){y(this,e)}));S(ar,"INIT","init"),S(ar,"RELOAD","reload"),S(ar,"DESTROY","destroy"),S(ar,"AUDIO_RENDER_INIT_DONE","audio_render_init_done"),S(ar,"PLAY","play"),S(ar,"PAUSE","pause"),S(ar,"SEEK","seek"),S(ar,"PLAYBACK_RATE","playback_rate"),S(ar,"PLAYBACK_QUALITY","playback_quality"),S(ar,"GET_PLAYBACK_QUALITY","get_playback_quality"),S(ar,"RESIZE","resize"),S(ar,"FIRST_FRAME","first_frame"),S(ar,"SEEKED","seeked"),S(ar,"BUFFER_FLUSHED","buffer_flushed"),S(ar,"PLAY_END","play_end"),S(ar,"SET_AUDIO_TIME","set_audio_time"),S(ar,"SET_DECODE_MODE","set_decode_mode"),S(ar,"SET_APPEND_WINDOW","set_append_window"),S(ar,"SET_PIP_MODE","set_pip_mode"),S(ar,"END_OF_STREAM","end_of_stream"),S(ar,"RESET_OUTOFSYNC_FRAME_COUNT","reset_outofsync_frame_count"),S(ar,"REDRAW_LAST_FRAME","redraw_last_frame"),S(ar,"OPENED","opened"),S(ar,"TIMEUPDATE","timeupdate"),S(ar,"FILL_BUFFER","fill_buffer"),S(ar,"RENDER_AUDIO","render_audio"),S(ar,"FALLBACK","fallback"),S(ar,"LOG","log"),S(ar,"ERROR","error"),S(ar,"PERFORMANCE","performance");var sr,ur,cr=ar,lr=function(e){_(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}(r);function r(e,n,i){var o;return y(this,r),S(v(o=t.call(this,ae.ERROR,i)),"errorCode",void 0),S(v(o),"describe",void 0),o.errorCode=e,o.describe=n,o}return g(r)}(rr);!function(e){e[e.SOURCE=0]="SOURCTE="timeupdate",e.CANPLAY="canplay",e.ERROR="error"}(ur||(ur={}));var dr=function(e){_(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}(r);function r(e,n,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:sr.MSE;return y(this,r),S(v(o=t.call(this)),"logger",void 0),S(v(o),"TAG","[BwpMediaPlayer]"),S(v(o),"MIN_TIMEUPTE_INTERVAL",110),S(v(o),"renderCanvas",void 0),S(v(o),"bwpElement",void 0),S(v(o),"timeupdateCallback",void 0),S(v(o),"sourceMode",void 0),S(v(o),"bwpMediaSource",void 0),S(v(o),"appendWindowStart",void 0),S(v(o),"appendWindowEnd",void 0),S(v(o),"corePlayerWorker",void 0),S(v(o),"audioRenderer",void 0),S(v(o),"audioSampleRate",void 0),S(v(o),"audioRenderBuffer",void 0),S(v(o),"currentTime",void 0),S(v(o),"_playbackRate",void 0),S(v(o),"glueJsUrl",void 0),S(v(o),"pthreadJsUrl",void 0),S(v(o),"bufferChekTimer",void 0),S(v(o),"buffFlushFlag",void 0),S(v(o),"isBuffFlushing",void 0),S(v(o),"wakeLock",void 0),S(v(o),"isWakeLockInit",void 0),S(v(o),"canplayTimer",void 0),S(v(o),"fps",void 0),S(v(o),"totalVideoFrames",void 0),S(v(o),"droppedVideoFrames",void 0),S(v(o),"moduleLoadedTime",void 0),S(v(o),"lastTimeUpdate",void 0),S(v(o),"hasFirstFrame",void 0),S(v(o),"isAudioInitDone",void 0),S(v(o),"isCorePlayerOpened",void 0),S(v(o),"isCorePlayerCanPlay",void 0),S(v(o),"isSeeking",void 0),S(v(o),"isWaiting",void 0),S(v(o),"isInternalSeek",void 0),S(v(o),"isVideoEnd",void 0),S(v(o),"isAudioEnd",void 0),S(v(o),"_isPictureInPicture",void 0),S(v(o),"setMediaSource",(function(e){o.bwpMediaSource=e})),S(v(o),"setSourceOpen",(function(){o.isCorePlayerCanPlay||(clearTimeout(o.canplayTimer),o.canplayTimer=setTimeout((function(){o.bwpElement&&o.bwpElement.buffered.length>0&&o.throwError(Rt.TRIGGER_CANPLAY_ERROR,"trigger canplay timeout > 30s")}),3e4))})),S(v(o),"loadedMetadata",(function(){if(o.bwpMediaSource){for(var e=o.bwpMediaSource.activeSourceBuffers,t=0;t<e.length;t++){var r=e[t];if(r.mediaType===c.AUDIO){var n=r[ue.SOURCEBUFFER_GET_BUFFER](0,!0).sampleRate;if(n<=0)break;if(n!==o.audioSampleRate){var i=o.audioRenderer,a=i.volume,s=i.muted;o.logger.warn(o.TAG,"init audio renderer, old: ".concat(o.audioSampleRate,", new: ").concat(n,","),"volume: ".concat(a,", muted: ").concat(s)),o.audioSample){o.isAudioInitDone=!0,o.triggerCorePlayerCanPlay()})),o.audioRenderer.volume=a,o.audioRenderer.muted=s}else o.isAudioInitDone=!0,o.triggerCorePlayerCanPlay();break}}o.isCorePlayerOpened&&o.checkBuffer()}})),S(v(o),"corePlayerMsgHandler",(function(e){var t,r,n=null===(t=e.data)||void 0===t?void 0:t.msg,i=null===(r=e.data)||void 0===r?void 0:r.data;switch(n){case cr.OPENED:o.isCorePlayerOpened=!0,o.bufferChekTimer=o.createTimer(o.bufferCheckHandler,50),o.bufferChekTimer.start(),o.glueJsUrl=i.glueJsUrl,o.pthreadJsUrl=i.pthreadJsUrl,o.logger.warn(o.TAG,"[state] open done, spent: ".concat(+new Date-o.moduleLoadedTime," ms")),Promise.resolve().then((function(){o.applyCorePlayerOfflineState()}));break;case cr.RESIZE:J(o.bwpElement,ae.RESIZE);break;case cr.FIRST_FRAME:o.logger.warn(o.TAG,"[state] render first frame, spent: ".concat(+new Date-o.moduleLoadedTime," ms")),o.hasFirstFrame=!0,o.triggerCorePlayerCanPlay();break;case cr.TIMEUPDATE:if(o.isSeeking||o.isBuffFlushing)return;i.time>=0&&o.currentTime!==i.time&&(o.currentTime=i.time,o.lastTimeUpdate=+new Date,o.timeupdateCallback(o.currentTime/1e3),Promise.resolve().then((function(){o.readyStateChecker()})));break;case cr.RENDER_AUDIO:if(o.isBuffFlushing||!o.isAudioInitDone)return void o.logger.warn(o.TAG,"discard invalid audio buffer,","currentTime: ".concat(o.currentTime,", audio buffer time: ").concat(i.time));o.isCorePlayerCanPlay||o.triggerCorePlayerCanPlay(),o.audioRenderer.fillBuffer({data:i.data,time:i.time,channels:i.channels});break;case cr.BUFFER_FLUSHED:i.flag===o.buffFlushFlag?(o.isBuffFlushing=!1,o.isSeeking||(o.buffFlushFlag=0)):o.logger.warn(o.TAG,"discard invalid buffer flushed");break;case cr.SEEKED:if(i.flag!==o.buffFlushFlag||!o.isSeeking)return void o.logger.warn(o.TAG,"discard invalid seek, isSeeking: ".concat(o.isSeeking));o.buffFlushFlag=0,o.isSeeking=!1,o.isInternalSeek?(o.logger.warn(o.TAG,"inner seek done"),o.isInternalSeek=!1):(o.logger.warn(o.TAG,"seek done"),o.dispatchEvent(new Event(ur.SEEKED)),Promise.resolve().then((function(){o.readyStateChecker(!1)}))),o.triggerCorePlayerCanPlay();break;case cr.PLAY_END:o.resetKeepScreenAlive(),J(v(o),ur.ENDED);break;case cr.PLAYBACK_QUALITY:o.fps=i.fps,o.totalVideoFrames=i.totalVideoFrames,o.droppedVideoFrames=i.droppedVideoFrames;break;case cr.FALLBACK:setTimeout((function(){var e;null===(e=o.bwpElement)||void 0===e||e.dispatchEvent(new nr(Rt.OUT_OF_SYNC,n))}));break;case cr.LOG:if(!te)return;console[i.logLevel](i.msg);break;case cr.ERROR:o.throwError(i.errorCode,i.describe||"");break;default:o.logger.warn("".concat(o.TAG," Unsupport messsage ").concat(n))}})),S(v(o),"corePlayerOnErrorHandler",(function(e){o.logger.error(o.TAG,"core player onerror",null==e?void 0:e.message),o.throwError(Rt.CORE_PLAYER_JS_ERROR,null==e?void 0:e.message)})),S(v(o),"checkBuffer",(function(){if(o.isCorePlayerOpened&&o.isAudioInitDone){if(o.sourceMode!==sr.MSE)throw new Error("Not support source mode now");o.checkMseModeBuffer()}})),S(v(o),"checkMseModeBuffer",(function(){if(o.bwpMediaSource&&o.isCorePlayerOpened)for(var e=o.bwpMediaSource.activeSourceBuffers,t=0;t<e.length;t++){var r=e[t],n=r.mediaType,i=r.appendWindowStart,a=r.appendWindowEnd,s=[],u=!1;if(n===c.AUDIO||i===o.appendWindowStart&&a===o.appendWindowEnd||(o.appendWindowStart=i,o.appendWindowEnd=a,o.sendMsgToCorePlayer(cr.SET_APPEND_WINDOW,{start:1e3*o.appendWindowStart,end:1e3*o.appendWindowEnd}),
o.logger.log(o.TAG,"set append window to core player: ".concat(i,", ").concat(a))),!o.isVideoEnd&&!o.isAudioEnd){var l=r[ue.SOURCEBUFFER_GET_BUFFER](o.currentTime/1e3);s=l.buffer,u=l.isEndOfStream}if(s.length>0){o.logger.log(o.TAG,"[".concat(n,"] ready to append buffer to core player,"),"currentTime: ".concat(o.currentTime));for(var d=0;d<s.length;d++){var f=s[d],p=performance.now();o.sendMsgToCorePlayer(cr.FILL_BUFFER,{mediaType:n,buffer:f.data,isInitSegment:f.isInitSegment},[]);var h=performance.now();h-p>10&&o.logger.warn(o.TAG,"send buffer data spent > 10ms => ".concat(h-p,"ms"))}}u&&o.endOfStream(n)}})),S(v(o),"audioprocessingCallback",(function(e,t,r){var n;if(o.audioRenderBuffer=t,-1!==e&&(o.sendMsgToCorePlayer(cr.SET_AUDIO_TIME,{time:e,bufferLen:t,timeStamp:r}),!(e<0||null!==(n=o.bwpElement)&&void 0!==n&&n.paused||o.isWaiting||o.isSeeking))){var i=+new Date;i-o.lastTimeUpdate>o.MIN_TIMEUPTE_INTERVAL&&(o.lastTimeUpdate=i,o.timeupdateCallback(e/1e3))}})),S(v(o),"applyCorePlayerOfflineState",(function(){0!==o.currentTime&&(o.logger.log(o.TAG,"[applyOfflineState] seek to ".concat(o.currentTime)),o.seek(o.currentTime)),1!==o._playbackRate&&(o.logger.log(o.TAG,"[applyOfflineState] set playbackrate: ".concat(o._playbackRate)),o.playbackRate=o._playbackRate)})),S(v(o),"audioCanplayHandler",(function(){var e,t;o.triggerCorePlayerCanPlay(),null!==(e=o.bwpElement)&&void 0!==e&&e.paused||null!==(t=o.audioRenderer)&&void 0!==t&&t.isPlaying()||!o.isCorePlayerCanPlay||(o.play(),o.logger.warn(o.TAG,"[applyOfflineState], audio render is not play, call play"))})),S(v(o),"triggerCorePlayerCanPlay",(function(){!o.isCorePlayerCanPlay&&o.hasFirstFrame&&!o.isSeeking&&o.isCorePlayerOpened&&o.isAudioInitDone&&(o.logger.warn(o.TAG,"trigger BwpMediaPlayer canplay"),clearTimeout(o.canplayTimer),J(v(o),ur.CANPLAY),o.isCorePlayerCanPlay=!0,Promise.resolve().then((function(){o.readyStateChecker(!1)})))})),S(v(o),"bufferCheckHandler",(function(){o.checkBuffer()})),S(v(o),"visibilityChangeHandler",(function(){o.isCorePlayerOpened&&(o.getIsDocumentVisible()?(o.sendMsgToCorePlayer(cr.SET_DECODE_MODE,{enable:!0}),o.setKeepScreenAlive()):o.isPictureInPicture||(o.sendMsgToCorePlayer(cr.SET_DECODE_MODE,{enable:!1}),o.resetKeepScreenAlive()))})),S(v(o),"setKeepScreenAlive",I(N().mark((function e(){var t;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null!==(t=o.bwpElement)&&void 0!==t&&t.paused||!window.navigator.wakeLock||o.wakeLock||o.isWakeLockInit)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,o.isWakeLockInit=!0,e.next=6,window.navigator.wakeLock.request("screen");case 6:o.wakeLock=e.sent,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),o.wakeLock=null,o.isWakeLockInit=!1;case 13:case"end":return e.stop()}}),e,null,[[2,9]])})))),S(v(o),"resetKeepScreenAlive",I(N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.wakeLock&&o.isWakeLockInit){e.next=2;break}return e.abrupt("return");case 2:return o.isWakeLockInit=!1,e.next=5,o.wakeLock.release();case 5:o.isWakeLockInit||(o.wakeLock=null);case 6:case"end":return e.stop()}}),e)})))),S(v(o),"globalErrorHandler",(function(e){var t=null==e?void 0:e.filename;t&&(o.pthreadJsUrl!==t&&o.glueJsUrl!==t||o.throwError(Rt.CORE_PLAYER_EXCEPTION,e.message))})),S(v(o),"throwError",(function(e,t){if(o.bwpElement){try{localStorage.setItem("bwphevc_error","code: ".concat(e,", message: ").concat(t,", timestamp: ").concat(new Date))}catch(e){}o.dispatchEvent(new lr(e,(null==t?void 0:t.replace(",","."))||"")),o.destroy()}})),o.moduleLoadedTime=+new Date,o.logger=ne.getInstance(),o.renderCanvas=e,o.bwpElement=n,o.timeupdateCallback=i,o.sourceMode=a,o.bwpMediaSource=null,o.appendWindowStart=0,o.appendWindowEnd=0,o.audioSampleRate=-1,o.audioRenderBuffer=0,o.currentTime=0,o._playbackRate=1,o.isBuffFlushing=!1,o.isWakeLockInit=!1,o.fps=0,o.totalVideoFrames=0,o.droppedVideoFrames=0,o.lastTimeUpdate=0,o.hasFirstFrame=!1,o.isAudioInitDone=!1,o.isCorePlayerOpened=!1,o.isCorePlayerCanPlay=!1,o.isSeeking=!1,o.isWaiting=!1,o.isInternalSeek=!1,o.isVideoEnd=!1,o.isAudioEnd=!1,o._isPictureInPicture=!1,o.audioRenderer=new or(o.audioprocessingCallback,o.throwError),o.audioRenderer.addEventListener(zt.CANPLAY,o.audioCanplayHandler),setTimeout((function(){var e=performance.now();o.corePlayerWorker=new $t,o.corePlayerWorker.onmessage=o.corePlayerMsgHandler,o.corePlayerWorker.onerror=o.corePlayerOnErrorHandler,o.logger.warn(o.TAG,"[state] load core player worker done, spent: ".concat(performance.now()-e," ms"));var t=o.renderCanvas.transferControlToOffscreen();o.sendMsgToCorePlayer(cr.INIT,{renderCanvas:t,isEnableSIMD:Wt.simd,logStartTime:ne.startTime,isDebug:te},[t]),o.audioRenderer.preCreateContext(48e3)})),window.addEventListener("error",o.globalErrorHandler),document.addEventListener("visibilitychange",o.visibilityChangeHandler),o}return g(r,[{key:"muted",get:function(){return this.audioRenderer.muted},set:function(e){e!==this.audioRenderer.muted&&(this.audioRenderer.muted=e)}},{key:"volume",audioRenderer.volume&&(this.audioRenderer.volume=e)}},{key:"playbackRate",set:function(e){this.logger.warn(this.TAG,"set playbackRate: ".concat(e,", currentTime: ").concat(this.currentTime));var t=parseFloat(e.toFixed(2));this._playbackRate=t,this.sendMsgToCorePlayer(cr.PLAYBACK_RATE,{rate:t})}},{key:"isPictureInPicture",get:function(){return this._isPictureInPicture},set:function(e){this._isPictureInPicture=e,e&&this.isCorePlayerOpened&&!this.getIsDocumentVisible()&&this.sendMsgToCorePlayer(cr.SET_DECODE_MODE,{enable:!0}),this.sendMsgToCorePlayer(cr.SET_PIP_MODE,{enable:e})}},{key:"play",value:function(){var e=this;return new Promise((function(t,r){e.isCorePlayerOpened&&e.isAudioInitDone&&e.canplay()?(e.getIsDocumentVisible()||e.isPictureInPicture||(e.sendMsgToCorePlayer(cr.SET_DECODE_MODE,{enable:!1}),e.logger.log(e.TAG,"play in background tab, set not decoder & not render mode")),e.sendMsgToCorePlayer(cr.PLAY),e.audioRenderer.play(),e.setKeepScreenAlive(),t()):r()}))}},{key:"pause",value:function(){this.isCorePlayerOpened&&(this.sendMsgToCorePlayer(cr.PAUSE),this.audioRenderer.pause(),this.resetKeepScreenAlive())}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.buffFlushFlag=+new Date;var r=Number.parseInt("".concat(e),10);if(this.currentTime=r,this.isSeeking=!0,this.isInternalSeek=t,this.isVideoEnd=!1,this.isAudioEnd=!1,this.audioRenderer.seek(),this.audioRenderBuffer=0,this.isCorePlayerOpened?(this.isBuffFlushing=!0,this.sendMsgToCorePlayer(cr.SEEK,{flag:this.buffFlushFlag,time:r})):this.logger.warn(this.TAG,"corePlayer not opened, delay seek"),this.bwpMediaSource)for(var n=this.bwpMediaSource.activeSourceBuffers,i=0;i<n.length;i++)n[i][ue.SOURCEBUFFER_SEEK](r/1e3);t||this.checkBuffer()}},{key:"getVideoPlaybackQuality",value:function(){this.isCorePlayerOpened&&this.sendMsgToCorePlayer(cr.GET_PLAYBACK_QUALITY);var e=new Zt;return e.fps=this.fps,e.totalVideoFrames=this.totalVideoFrames,e.droppedVideoFrames=this.droppedVideoFrames,e}},{key:"isAllReady",value:function(){re=this.audioRenderer)||void 0==on(){this.sendMsgToCorePlasendMsgToCorePlayer(cr.END_OF_setWaitingState",value:function(){this.isWaiting=!0}},{key:"getWaitingState",value:function(){return this.isWaiting}},{key:"toDataURL",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.92;return this.renderCanvas.toDataURL(e,t)}},{key:"toBlob",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.92;return new Promise((function(n,i){try{e.renderCanvas.toBlob(n,t,r)}catch(e){i(e)}}))}},{key:"reload",value:function(){var e,t,r,n
;if(this.logger.warn(this.TAG,"reload, ready to flush core player"),clearTimeout(this.canplayTimer),null===(e=this.bufferChekTimer)||void 0===e||e.stop(),this.resetKeepScreenAlive(),null!==(t=this.audioRenderer)&&void 0!==t&&t.isPlaying()&&this.pause(),this.isCorePlayerOpened&&(this.isBuffFlushing=!0,this.buffFlushFlag=+new Date,this.sendMsgToCorePlayer(cr.RELOAD,{flag:this.buffFlushFlag})),this.currentTime=0,this.appendWindowStart=0,this.appendWindowEnd=0,this.audioRenderBuffer=0,this.moduleLoadedTime=+new Date,this.fps=0,this.totalVideoFrames=0,this.droppedVideoFrames=0,this.lastTimeUpdate=0,this.hasFirstFrame=!1,this.isAudioInitDone=!1,this.isCorePlayerCanPlay=!1,this.isSeeking=!1,this.isWaiting=!1,this.isInternalSeek=!1,this.isVideoEnd=!1,this.isAudioEnd=!1,this._isPictureInPicture=!1,null===(r=this.audioRenderer)||void 0===r||r.seek(),this.bwpMediaSource)for(var i=this.bwpMediaSource.activeSourceBuffers,o=0;o<i.length;o++)i[o][ue.SOURCEBUFFER_SEEK](0);null===(n=this.bufferChekTimer)||void 0===n||n.start()}},{key:"destroy",value:function(){var e,t,r;this.corePlayerWorker&&(clearTimeout(this.canplayTimer),this.resetKeepScreenAlive(),window.removeEventListener("error",this.globalErrorHandler),document.removeEventListener("visibilitychange",this.visibilityChangeHandler),null===(e=this.bufferChekTimer)||void 0===e||e.stop(),this.resetKeepScreenAlive(),this.bwpElement=null,this.bwpMediaSource=null,this.isCorePlayerCanPlay=!1,null===(t=this.audioRenderer)||void 0===t||t.removeEventListener(zt.CANPLAY,this.audioCanplayHandler),null===(r=this.audioRenderer)||void 0===r||r.destroy(),this.corePlayerWorker.terminate(),this.corePlayerWorker.onmessage=null,this.corePlayerWorker.onerror=null,this.corePlayerWorker=null)}},{key:"sendMsgToCorePlayer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.corePlayerWorker&&(this.isCorePlayerOpened||e===cr.INIT)&&this.corePlayerWorker.postMessage({msg:e,data:t},r)}},{key:"readyStateChecker",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.bwpElement;if(!(null!=t&&t.paused||this.isAudioEnd&&this.isVideoEnd)&&t&&t.readyState>=o.HAVE_METADATA){var r=t.buffered,n=r.length>0?r.end(0):0,i=this.currentTime/1e3;if(r.container(i)){if(n-i>.1){if(!this.isWaiting)return;!this.audioRenderer.isPlaying()&&this.canplay()&&(this.play(),this.logger.warn(this.TAG,"[waiting] recovery play")),this.isWaiting=!1,this.logger.warn(this.TAG,"[waiting] end"),!this.isSeeking&&e&&J(this.bwpElement,ae.PLAYING)}}else{if(this.isWaiting||this.isSeeking)return;this.audioRenderBuffer<=0&&(J(this.bwpElement,ae.WAITING),this.isWaiting=!0,this.seek(this.currentTime,!0),this.logger.warn(this.TAG,"[waiting] trigger internal seek, currentTime:",this.currentTime,n,t.duration)),this.sendMsgToCorePlayer(cr.RESET_OUTOFSYNC_FRAME_COUNT)}}}},{key:"createTimer",value:function(e,t){va){var n=the(),n.start()}),t)},stop:function(){cnction(){return"visible"===document.visibilityState}}]),r}(P),fr=dr,pr=g((function e(){y(this,e)})),hr=HTMLElement;"function"!=typeof HTMLElement&&(hr=pr);var yr=hr;function mr(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var gr=new WeakMap,vr=new WeakMap,_r=function(){function e(t,r){y(this,e),mr(this,gr,{writable:!0,value:void 0}),mr(this,vr,{writable:!0,value:void 0}),A(this,gr,t),A(this,vr,r)}return g(e,[{key:"code",get:function(){return w(this,gr)}},{key:"message",get:function(){return w(this,vr)}}]),e}(),Er=r(601),br={};function Sr(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var Tr=new WeakMap,wr=new WeakMap,Ar=new WeakMap,Rr=new WeakMap,Pr=new WeakMap,Dr=new WeakMap,Or=new WeakMap,Ir=new WeakMap,Cr=new WeakMap,Nr=new WeakMap,kr=new WeakMap,Lr=new WeakMap,xr=new WeakMap,Mr=new WeakMap,Fr=new WeakMap,Ur=new WeakMap,Br=new WeakMap,jr=new WeakMap,Vr=new WeakMap,Hr=new WeakMap,Gr=new WeakMap,qr=new WeakMap,Wr=new WeakMap,Kr=new WeakMap,Yr=new WeakMap,Qr=new WeakMap,zr=new WeakMap,Zr=new WeakMap,Jr=new WeakMap,Xr=new WeakMap,$r=new WeakMap,en=new WeakMap,tn=new WeakMap,rn=new WeakMap,nn=new WeakMap,on=new WeakMap,an=new WeakMap,sn=new WeakMap,un=new WeakMap,cn=new WeakMap,ln=new WeakMap,dn=new WeakMap,fn=new WeakMap,pn=new WeakMap,hn=new WeakMap,yn=new WeakMap,mn=new WeakMap,gn=new WeakMap,vn=new WeakMap,_n=new WeakMap,En=new WeakMap,bn=new WeakMap,Sn=new WeakMap,Tn=new WeakMap,wn=new WeakMap,An=new WeakMap,Rn=new WeakMap,Pn=new WeakMap,Dn=new WeakMap,On=new WeakMap,In=new WeakMap,Cn=new WeakMap,Nn=function(t){_(s,t);var r,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}(s);function s(){var t,r,i;y(this,s),Sr(v(t=n.call(this)),Tr,{writable:!0,value:void 0}),Sr(v(t),wr,{writable:!0,value:"[BwpElement]"}),Sr(v(t),Ar,{writable:!0,value:void 0}),Sr(v(t),Rr,{writable:!0,value:void 0}),Sr(v(t),Pr,{writable:!0,value:void 0}),S(v(t),"srcObject",void 0),Sr(v(t),Dr,{writable:!0,value:void 0}),S(v(t),"crossOrigin",void 0),Sr(v(t),Or,{writable:!0,value:void 0}),S(v(t),"preload",void 0),Sr(v(t),Ir,{writable:!0,value:void 0}),Sr(v(t),Cr,{writable:!0,value:void 0}),Sr(v(t),Nr,{writable:!0,value:void 0}),Sr(v(t),kr,{writable:!0,value:void 0}),Sr(v(t),Lr,{writable:!0,value:void 0}),Sr(v(t),xr,{writable:!0,value:void 0}),S(v(t),"defaultPlaybackRate",void 0),Sr(v(t),Mr,{writable:!0,value:void 0}),Sr(v(t),Fr,{writable:!0,value:void 0}),Sr(v(t),Ur,{writable:!0,value:void 0}),Sr(v(t),Br,{writable:!0,value:void 0}),S(v(t),"autoplay",void 0),S(v(t),"loop",void 0),Sr(v(t),jr,{writable:!0,value:void 0}),Sr(v(t),Vr,{writable:!0,value:void 0}),S(v(t),"defaultMuted",void 0),Sr(v(t),Hr,{writable:!0,value:void 0}),Sr(v(t),Gr,{writable:!0,value:void 0}),Sr(v(t),qr,{writable:!0,value:void 0}),S(v(t),"poster",void 0),S(v(t),"playsInline",void 0),Sr(v(t),Wr,{writable:!0,value:void 0}),Sr(v(t),Kr,{writable:!0,value:void 0}),Sr(v(t),Yr,{writable:!0,value:void 0}),Sr(v(t),Qr,{writable:!0,value:void 0}),Sr(v(t),zr,{writable:!0,value:void 0}),Sr(v(t),Zr,{writable:!0,value:void 0}),Sr(v(t),Jr,{writable:!0,value:void 0}),Sr(v(t),Xr,{writable:!0,value:void 0}),Sr(v(t),$r,{writable:!0,value:void 0}),Sr(v(t),en,{writable:!0,value:void 0}),Sr(v(t),tn,{writable:!0,value:void 0}),Sr(v(t),rn,{writable:!0,value:void 0}),Sr(v(t),nn,{writable:!0,value:void 0}),Sr(v(t),on,{writable:!0,value:void 0}),Sr(v(t),an,{writable:!0,value:void 0}),Sr(v(t),sn,{writable:!0,value:function(){var e="bwp-base-style",r=document.querySelector("#".concat(e));r||((r=document.createElement("style")).setAttribute("id",e),r.innerHTML="bwp-video { object-fit: contain; }",document.head.appendChild(r)),A(v(t),zr,t.attachShadow({mode:"closed"}));var n=document.createElement("style");n.innerHTML=Er.Z.toString(),w(v(t),zr).appendChild(n),A(v(t),Zr,document.createElement("div")),w(v(t),Zr).setAttribute("class","-bwp-internal-container"),w(v(t),zr).appendChild(w(v(t),Zr)),w(v(t),Jr).setAttribute("class","-bwp-internal-render-canvas"),w(v(t),Zr).appendChild(w(v(t),Jr)),w(v(t),tn).setAttribute("class","-bwp-internal-proxy-video-element"),w(v(t),Zr).appendChild(w(v(t),tn)),t.getAttribute("controls")&&w(v(t),un).call(v(t))}}),Sr(v(t),un,{writable:!0,value:function(){w(v(t),en)||"function"!=typeof br||(A(v(t),en,new br(v(t),w(v(t),Zr),w(v(t),Jr))),w(v(t),en).setupControls())}}),Sr(v(t),cn,{writable:!0,value:(r=I(N().mark((function e(){var r;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:w(v(t),Or)===t.NETWORK_EMPTY&&w(v(t),Tr).log(w(v(t),wr),"[internalPlay] network empty"),
w(v(t),Br)&&w(v(t),Mr)>0&&w(v(t),pn).call(v(t),0),w(v(t),xr)?(A(v(t),xr,!1),J(v(t),ae.PLAY),w(v(t),Cr)<=t.HAVE_CURRENT_DATA?(w(v(t),Tr).warn(w(v(t),wr),"[waiting] not enough data to play"),null===(r=w(v(t),$r))||void 0===r||r.setWaitingState(),J(v(t),ae.WAITING)):w(v(t),Cr)>=t.HAVE_FUTURE_DATA&&w(v(t),$r).play().then((function(){J(v(t),ae.PLAYING)})).catch((function(e){A(v(t),xr,!0);var r=new Error("Not ready");throw r.name="NotReady",r}))):(w(v(t),Cr),t.HAVE_ENOUGH_DATA),A(v(t),Qr,!1);case 4:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})}),Sr(v(t),ln,{writable:!0,value:function(){var e;w(v(t),Or)!==t.NETWORK_LOADING&&w(v(t),Or)!==t.NETWORK_IDLE||J(v(t),ae.ABORT),w(v(t),Or)!==t.NETWORK_EMPTY&&(J(v(t),ae.EMPTIED),w(v(t),Xr)&&(w(v(t),Xr).removeEventListener("sourceopen",w(v(t),mn)),w(v(t),Xr)[ue.MEDIASOURCE_DETACH]()),w(v(t),Ir).clear(),null===(e=w(v(t),$r))||void 0===e||e.reload(),w(v(t),Cr)!==t.HAVE_NOTHING&&w(v(t),An).call(v(t),t.HAVE_NOTHING),w(v(t),xr)||A(v(t),xr,!0),w(v(t),Nr)&&A(v(t),Nr,!1),A(v(t),kr,0),0!==w(v(t),Wr)&&(A(v(t),Wr,0),J(v(t),ae.TIME_UPDATE)),A(v(t),Lr,NaN),w(v(t),Br)&&A(v(t),Br,!1)),t.playbackRate=t.defaultPlaybackRate,A(v(t),Ar,null),A(v(t),Qr,!0),w(v(t),dn).call(v(t))}}),Sr(v(t),dn,{writable:!0,value:(i=I(N().mark((function e(){var r,n;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A(v(t),Or,t.NETWORK_NO_SOURCE),A(v(t),Yr,null===(r=window[ue.BWPHEVC])||void 0===r?void 0:r[w(v(t),Pr)||""]),!(w(v(t),Yr)instanceof MediaStream||w(v(t),Yr)instanceof MediaSource||w(v(t),Yr)instanceof wt||w(v(t),Yr)instanceof Blob)){e.next=6;break}n="object",e.next=16;break;case 6:if(!w(v(t),Pr)&&""!==w(v(t),Pr)){e.next=10;break}n="attribute",e.next=16;break;case 10:if(!t.children[0]||"SOURCE"!==t.children[0].tagName){e.next=14;break}n="children",e.next=16;break;case 14:return A(v(t),Or,t.NETWORK_EMPTY),e.abrupt("return");case 16:if(w(v(t),Tr).log(w(v(t),wr),"src: ".concat(w(v(t),Pr),", mode: ").concat(n)),"object"!==n){e.next=24;break}A(v(t),Or,t.NETWORK_LOADING),J(v(t),ae.LOAD_START),A(v(t),Dr,""),w(v(t),fn).call(v(t)),e.next=29;break;case 24:if("attribute"!==n){e.next=28;break}throw new Error("[BwpElement] resourceSelectionAlgorithm not implemented mode attribute");case 28:throw new Error("[BwpElement] resourceSelectionAlgorithm not implemented mode other");case 29:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})}),Sr(v(t),fn,{writable:!0,value:function(){var r;if(r=w(v(t),Yr)?"local":"remote",A(v(t),Dr,w(v(t),Pr)),"remote"===r)throw new Error("[BwpElement] resourceFetchArlgorithm not implemented mode remote");if(w(v(t),Yr)&&w(v(t),Yr)instanceof File)throw new Error("[BwpElement] resourceFetchArlgorithm not implemented local file");w(v(t),Yr)&&w(v(t),Yr)instanceof wt&&w(v(t),Pr)&&(A(v(t),Xr,w(v(t),Yr)),w(v(t),Xr).readyState!==e.CLOSED||w(v(t),yn).call(v(t)))}}),Sr(v(t),pn,{writable:!0,value:function(e){if(w(v(t),Cr)!==t.HAVE_NOTHING){w(v(t),Br)&&A(v(t),Br,!1),w(v(t),Nr),A(v(t),Nr,!0);var r=e;r>w(v(t),Lr)&&(r=w(v(t),Lr)),w(v(t),Tr).warn(w(v(t),wr),"currentTime is ".concat(w(v(t),Wr),", seek to ").concat(r)),A(v(t),Wr,r),0!==t.seekable.length&&(J(v(t),ae.SEEKING),A(v(t),kr,r),w(v(t),Xr)&&t.readyState>t.HAVE_METADATA&&!w(v(t),Ir).container(r)&&w(v(t),An).call(v(t),t.HAVE_METADATA),w(v(t),$r).seek(1e3*r))}}}),Sr(v(t),hn,{writable:!0,value:function(){if(w(v(t),Cr)>=o.HAVE_METADATA){if(w(v(t),Wr)>=w(v(t),Lr)&&w(v(t),Mr)>=0&&!t.loop)return!0;if(0===w(v(t),Wr)&&w(v(t),Mr)<0)return!0}return!1}}),Sr(v(t),yn,{writable:!0,value:function(){var e,r;w(v(t),Xr)&&(w(v(t),Tr).log(w(v(t),wr),"attach BwpMediaSource"),w(v(t),Xr).addEventListener("sourceopen",w(v(t),mn)),w(v(t),Xr)[ue.MEDIASOURCE_ATTACH](v(t)),null===(e=window[ue.BWPHEVC])||void 0===e||delete e[w(v(t),Pr)],null===(r=w(v(t),$r))||void 0===r||r.setMediaSource(w(v(t),Xr)))}}),Sr(v(t),mn,{writable:!0,value:function(){var e;w(v(t),Xr)&&(null===(e=w(v(t),$r))||void 0===e||e.setSourceOpen())}}),Sr(v(t),gn,{writable:!0,value:function(e){if(!(w(v(t),Or)<t.NETWORK_LOADING||w(v(t),Wr)===e||w(v(t),Br))){A(v(t),Wr,e);var r=+new Date;r-w(v(t),nn)>=200&&(A(v(t),nn,r),J(v(t),ae.TIME_UPDATE))}}}),Sr(v(t),vn,{writable:!0,value:function(){var e;A(v(t),Nr,!1),0!==w(v(t),Kr)&&A(v(t),Kr,0),J(v(t),ae.TIME_UPDATE),J(v(t),ae.SEEKED),!w(v(t),xr)&&null!==(e=w(v(t),$r))&&void 0!==e&&e.isAllReady()&&J(v(t),ae.PLAYING)}}),Sr(v(t),_n,{writable:!0,value:function(){w(v(t),Tr).warn(w(v(t),wr),"play ended"),A(v(t),Wr,w(v(t),Lr)),t.pause(),A(v(t),Br,!0),J(v(t),ae.ENDED)}}),Sr(v(t),En,{writable:!0,value:function(){var e,r,n;null!==(e=w(v(t),$r))&&void 0!==e&&e.isAllReady()?(w(v(t),on)&&A(v(t),on,!1),J(v(t),ae.CANPLAY),w(v(t),Tr).log(w(v(t),wr),"readyState change CANPLAY"),w(v(t),xr)||(A(v(t),Qr,!1),t.seeking||null!==(r=w(v(t),$r))&&void 0!==r&&r.getWaitingState()||null===(n=w(v(t),$r))||void 0===n||!n.canplay()||J(v(t),ae.PLAYING))):A(v(t),on,!0)}}),Sr(v(t),bn,{writable:!0,value:function(){var e;null!==(e=w(v(t),$r))&&void 0!==e&&e.isAllReady()?(w(v(t),an)&&A(v(t),an,!1),J(v(t),ae.CANPLAY_THROUGH)):A(v(t),an,!0)}}),Sr(v(t),Sn,{writable:!0,value:function(){var e;null!==(e=w(v(t),$r))&&void 0!==e&&e.isAllReady()&&(w(v(t),$r).canplay()?w(v(t),$r).play().then((function(){w(v(t),Tr).log(w(v(t),wr),"[triggerAutoPlay], call play done"),J(v(t),ae.PLAY),J(v(t),ae.PLAYING)})).catch((function(){A(v(t),xr,!0),w(v(t),Tr).log(w(v(t),wr),"[triggerAutoPlay], failed, not ready")})):(A(v(t),xr,!0),w(v(t),Tr).warn(w(v(t),wr),"[triggerAutoPlay], cannot auto play")),A(v(t),Qr,!1))}}),Sr(v(t),Tn,{writable:!0,value:function(){var e;w(v(t),on)&&w(v(t),En).call(v(t)),w(v(t),an)&&w(v(t),bn).call(v(t)),t.autoplay&&w(v(t),Qr)&&!w(v(t),xr)&&t.readyState===t.HAVE_ENOUGH_DATA&&w(v(t),Sn).call(v(t)),w(v(t),xr)||null!==(e=w(v(t),$r))&&void 0!==e&&e.canplay()||(w(v(t),Tr).warn(w(v(t),wr),"[corePlayerCanplay] can not play, set paused true"),A(v(t),xr,!0))}}),Sr(v(t),wn,{writable:!0,value:function(e){var r=e.errorCode,n=e.describe;A(v(t),Rr,new _r(r,n)),console.error("WasmPlayer error, code: ".concat(r,", message: ").concat(n)),t.dispatchEvent(new lr(r,n))}}),Sr(v(t),An,{writable:!0,value:function(e){if(e!==w(v(t),Cr)&&t.networkState!==t.NETWORK_EMPTY){w(v(t),Tr).log(w(v(t),wr),"set readyState, new state is ".concat(e));var r=w(v(t),Cr);if(A(v(t),Cr,e),r===t.HAVE_NOTHING&&e===t.HAVE_METADATA)w(v(t),Tr).log(w(v(t),wr),"readyState change LOADED_METADATA"),J(v(t),ae.LOADED_METADATA),setTimeout((function(){var e;null===(e=w(v(t),$r))||void 0===e||e.loadedMetadata(),0!==w(v(t),Kr)&&w(v(t),pn).call(v(t),w(v(t),Kr))}),1);else if(r===t.HAVE_METADATA&&e>=t.HAVE_CURRENT_DATA&&(J(v(t),ae.LOADED_DATA),e<t.HAVE_FUTURE_DATA))return;r>=t.HAVE_FUTURE_DATA&&e<=t.HAVE_CURRENT_DATA?w(v(t),hn).call(v(t))||w(v(t),xr)||(J(v(t),ae.TIME_UPDATE),J(v(t),ae.WAITING),w(v(t),Tr).log(w(v(t),wr),"fire waiting")):r<=t.HAVE_CURRENT_DATA&&e===t.HAVE_FUTURE_DATA?w(v(t),En).call(v(t)):e===t.HAVE_ENOUGH_DATA&&(r<=t.HAVE_CURRENT_DATA&&w(v(t),En).call(v(t)),w(v(t),bn).call(v(t)),t.autoplay&&w(v(t),Qr)&&w(v(t),xr)&&(w(v(t),Tr).log(w(v(t),wr),"[autoplay] HAVE_ENOUGH_DATA, set paused false"),A(v(t),xr,!1),w(v(t),Sn).call(v(t))))}}}),Sr(v(t),Rn,{writable:!0,value:function(e){e!==w(v(t),Lr)&&(A(v(t),Lr,e),J(v(t),ae.DURATION_CHANGE))}}),Sr(v(t),Pn,{writable:!0,value:function(){if(w(v(t),Xr)&&w(v(t),Xr).readyState===e.ENDED)for(var r=w(v(t),Xr).activeSourceBuffers,n=0;n<r.length;n++){var i,o=r[n];o[ue.SOURCEBUFFER_IS_ENDED]()&&(null===(i=w(v(t),$r))||void 0===i||i.endOfStream(o.mediaType))}}}),Sr(v(t),Dn,{writable:!0,value:function(){J(v(t),ae.ENTER_PICTURE_IN_PICTURE)}}),Sr(v(t),On,{writable:!0,value:function(){w(v(t),$r)&&(w(v(t),$r).isPictureInPicture=!1,w(v(t),Jr).style.visibility="visible",w(v(t),tn).style.display="none",w(v(t),tn).srcObject=null,A(v(t),rn,null),w(v(t),tn).removeEventListener(ae.ENTER_PICTURE_IN_PICTURE,w(v(t),Dn)),w(v(t),tn).removeEventListener(ae.LEAVE_PICTURE_IN_PICTURE,w(v(t),Dn)),J(v(t),ae.LEAVE_PICTURE_IN_PICTURE))}}),Sr(v(t),In,{writable:!0,value:function(){window.removeEventListener("beforeunload",w(v(t),In)),t.destroy()}}),Sr(v(t),Cn,{writable:!0,value:function(e){
return!!"".concat(e).match(/^[0-9]+.?[0-9]*$/)}});var a=performance.now();if(!Qt())throw new Error("WasmPlayer not supported!");if(!window.AudioWorklet||!window.AudioWorkletNode)throw new Error("WasmPlayer not supported, HTTP page can not use AudioWorklet!");return A(v(t),Tr,ne.getInstance()),A(v(t),Ar,null),A(v(t),Rr,null),A(v(t),Pr,""),t.srcObject=null,A(v(t),Dr,""),t.crossOrigin=null,A(v(t),Or,t.NETWORK_EMPTY),t.preload="metadata",A(v(t),Ir,new q),A(v(t),Cr,t.HAVE_NOTHING),A(v(t),Nr,!1),A(v(t),Lr,NaN),A(v(t),xr,!0),t.defaultPlaybackRate=1,A(v(t),Mr,1),A(v(t),Fr,new q),A(v(t),Ur,new q),A(v(t),Br,!1),t.autoplay=!1,t.loop=!1,A(v(t),jr,!1),A(v(t),Vr,!1),t.defaultMuted=!1,A(v(t),Hr,new Z),A(v(t),Gr,0),A(v(t),qr,0),t.poster="",t.playsInline=!1,A(v(t),kr,0),A(v(t),Wr,0),A(v(t),Kr,0),A(v(t),Qr,!0),A(v(t),on,!1),A(v(t),an,!1),A(v(t),Jr,document.createElement("canvas")),A(v(t),$r,new fr(w(v(t),Jr),v(t),w(v(t),gn))),w(v(t),$r).addEventListener(ur.ENDED,w(v(t),_n)),w(v(t),$r).addEventListener(ur.SEEKED,w(v(t),vn)),w(v(t),$r).addEventListener(ur.CANPLAY,w(v(t),Tn)),w(v(t),$r).addEventListener(ur.ERROR,w(v(t),wn)),t[ue.SET_READY_STATE]=w(v(t),An),t[ue.SET_DURATION]=w(v(t),Rn),t[ue.END_OF_STREAM]=w(v(t),Pn),A(v(t),tn,document.createElement("video")),w(v(t),sn).call(v(t)),window.addEventListener("beforeunload",w(v(t),In)),A(v(t),nn,0),w(v(t),Tr).warn(w(v(t),wr),"init bwp done, spent: ".concat(performance.now()-a," ms")),t}return g(s,[{key:"error",get:function(){return w(this,Ar)}},{key:"bwpError",get:function(){return w(this,Rr)}},{key:"src",get:function(){return w(this,Pr)},set:function(e){A(this,Pr,e),this.setAttribute("src",e),w(this,ln).call(this)}},{key:"currentSrc",get:function(){return w(this,Dr)}},{key:"NETWORK_EMPTY",get:function(){return i.NETWORK_EMPTY}},{key:"NETWORK_IDLE",get:function(){return i.NETWORK_IDLE}},{key:"NETWORK_LOADING",get:function(){return i.NETWORK_LOADING}},{key:"NETWORK_NO_SOURCE",get:function(){return i.NETWORK_NO_SOURCE}},{key:"networkState",get:function(){return w(this,Or)},set:function(e){w(this,Tr).log(w(this,wr),"Network State Change to ".concat(e)),A(this,Or,e)}},{key:"buffered",get:function(){if(w(this,Xr)){var e=w(this,Xr).activeSourceBuffers,t=e.length;if(0==t)return w(this,Ir);for(var r=NaN,n=0;n<t;n++)for(var i=e[n].buffered,o=0;o<i.length;o++)(!r||r<i.end(o))&&(r=i.end(o));var a=new q;a.add(0,r);for(var s=0;s<t&&0!==(a=K(a,e[s].buffered)).length;s++);A(this,Ir,a)}else w(this,Ir)||A(this,Ir,new q);return w(this,Ir)}},{key:"HAVE_NOTHING",get:function(){return o.HAVE_NOTHING}},{key:"HAVE_METADATA",get:function(){return o.HAVE_METADATA}},{key:"HAVE_CURRENT_DATA",get:function(){return o.HAVE_CURRENT_DATA}},{key:"HAVE_FUTURE_DATA",get:function(){return o.HAVE_FUTURE_DATA}},{key:"HAVE_ENOUGH_DATA",get:function(){return o.HAVE_ENOUGH_DATA}},{key:"readyState",get:function(){return w(this,Cr)}},{key:"seeking",get:function(){return w(this,Nr)}},{key:"currentTime",get:function(){return w(this,Wr)},set:function(e){0!==w(this,Kr)&&A(this,Kr,0),w(this,Cr)===this.HAVE_NOTHING?0!==e&&A(this,Kr,e):w(this,pn).call(this,e)}},{key:"duration",get:function(){return w(this,Lr)}},{key:"paused",get:function(){return w(this,xr)}},{key:"playbackRate",get:function(){return w(this,Mr)},set:function(e){e!=w(this,Mr)&&(A(this,Mr,e),w(this,$r)&&(w(this,$r).playbackRate=e),J(this,ae.RATE_CHANGE))}},{key:"played",get:function(){return w(this,Fr)}},{key:"seekable",get:function(){if(w(this,Xr)){if(Number.isNaN(w(this,Lr)))return new q;if(w(this,Lr)===Number.POSITIVE_INFINITY)throw new Error("Method not implemented.");var e=new q;return e.add(0,w(this,Lr)),e}return w(this,Ur)}},{key:"ended",get:function(){return w(this,hn).call(this)}},{key:"controls",get:function(){return w(this,jr)},set:function(e){e!==w(this,jr)&&(e?this.setAttribute("controls",""):this.removeAttribute("controls"))}},{key:"muted",get:function(){return w(this,Vr)},set:function(e){e!=w(this,Vr)&&(A(this,Vr,e),w(this,Tr).warn(w(this,wr),"set muted: ".concat(e)),w(this,$r)&&(w(this,$r).muted=e,J(this,ae.VOLUME_CHANGE)))}},{key:"volume",get:function(){var e;return(null===(e=w(this,$r))||void 0===e?void 0:e.volume)||0},set:function(e){if(e<0||e>1)throw new DOMException("IndexSizeError");if(w(this,Tr).warn(w(this,wr),"set volume: ".concat(e)),w(this,$r)){if(e==w(this,$r).volume)return;w(this,$r).volume=e,J(this,ae.VOLUME_CHANGE)}}},{key:"textTracks",get:function(){return w(this,Hr)}},{key:"width",get:function(){return w(this,Gr)},set:function(e){this.setAttribute("width",w(this,Cn).call(this,e)?e.toString():"0")}},{key:"height",get:function(){return w(this,qr)},set:function(e){this.setAttribute("height",w(this,Cn).call(this,e)?e.toString():"0")}},{key:"videoWidth",get:function(){return w(this,Jr).width||0}},{key:"videoHeight",get:functi,{key:"load",value:function(){w(this,ln).call(this)}},{key:"canPlayType",value:function(e){return"probably"}},{key:"play",value:(r=I(N().mark((function e(){var t;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w(this,Tr).log(w(this,wr),"call play"),!w(this,$r)||null!==(t=w(this,$r))&&void 0!==t&&t.canplay()||w(this,Or)===this.NETWORK_EMPTY){e.next=4;break}throw w(this,Tr).warn(w(this,wr),"play() failed because the user didn't interact with the document first."),new DOMException("play() failed because the user didn't interact with the document first.","NotAllowedError");case 4:if(!w(this,Ar)||w(this,Ar).code!==a.MEDIA_ERR_SRC_NOT_SUPPORTED){e.next=6;break}throw new F;case 6:return e.abrupt("return",w(this,cn).call(this));case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"pause",value:function(){var e;w(this,Tr).warn(w(this,wr),"call pause"),w(this,Or)!==this.NETWORK_EMPTY&&(A(this,Qr,!1),w(this,xr)||(A(this,xr,!0),null!=w(this,$r)&&(w(this,Tr).log(w(this,wr),"send pause event"),J(this,ae.TIME_UPDATE),J(this,ae.PAUSE),null===(e=w(this,$r))||n(e,t,r){throw new Error("Method not implemented.")}},{key:"getVideoPlaybackQuality",value:function(){return w(this,$r)?w(this,$r).getVideoPlaybackQuality():new Zt}},{key:"requestPictureInPicture",value:function(){var e=this;if(w(this,Tr).log(w(this,wr),"requestPictureInPicture"),!document.pictureInPictureEnabled)throw new F;if(w(this,Cr)===this.HAVE_NOTHING)throw new U;return document.pictureInPictureElement instanceof s?w(this,tn).requestPictureInPicture():new Promise((function(t,r){if(w(e,$r)){w(e,$r).isPictureInPicture=!0,A(e,rn,w(e,Jr).captureStream(30));var n,i=w(e,tn);i.addEventListener(ae.LOADED_METADATA,(function n(){w(e,Tr).log(w(e,wr),"browser video element loaded metadata"),i.removeEventListener(ae.LOADED_METADATA,n),i.addEventListener(ae.ENTER_PICTURE_IN_PICTURE,w(e,Dn)),i.addEventListener(ae.LEAVE_PICTURE_IN_PICTURE,w(e,On)),i.requestPictureInPicture().then((function(r){w(e,tn).style.display="block",w(e,Jr).style.visibility="hidden",t(r)})).catch((function(t){w(e,$r)&&(w(e,$r).isPictureInPicture=!1),A(e,rn,null),console.error(t),r(t)}))})),i.srcObject=w(e,rn),i.play(),w(e,xr)&&(null===(n=w(e,$r))||void 0===n||n.redrawLastFrame())}else r()}))}},{key:"destroy",value:function(){w(this,Tr).warn(w(this,wr),"call destroy"),w(this,$r)&&(w(this,$r).removeEventListener(ur.SEEKED,w(this,vn)),w(this,$r).removeEventListener(ur.ENDED,w(this,_n)),w(this,$r).removeEventListener(ur.CANPLAY,w(this,Tn)),w(this,$r).removeEventListener(ur.ERROR,w(this,wn)),window.removeEventListener("beforeunload",w(this,In)),w(this,$r).destroy()),w(this,Xr)&&(w(this,Xr).removeEventListener("sourceopen",w(this,mn)),w(this,Xr)[ue.MEDIASOURCE_DETACH]()),A(this,$r,null),A(this,Xr,null)}},{key:"toDataURL",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.92;return null===(e=w(this,$r))||void 0===e?void 0:e.toDataURL(t,r)}},{key:"toBlob",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.92;return w(this,$r)?w(this,$r).toBlob(etRenderCanvas",value:function(){
return w(this,Jr)}},{key:"connectedCallback",value:function(){w(this,Tr).log(w(this,wr),"connectedCallback")}},{key:"disconnectedCallback",value:function(){w(this,Tr).warn(w(this,wr),"disconnectedCallback")}},{key:"adoptedCallback",value:function(){w(this,Tr).warn(w(this,wr),"adoptedCallback")}},{key:"attributeChangedCallback",value:function(e,t,r){w(this,Tr).log(w(this,wr),"attribute change, name: ".concat(e,", oldValue: ").concat(t,", newValue: ").concat(r));var n=Number.parseInt(r,10);switch(e){case"controls":var i;null===t?(w(this,un).call(this),A(this,jr,!0)):(null===(i=w(this,en))||void 0===i||i.destroyControls(),A(this,en,null),A(this,jr,!1));break;case"autoplay":this.autoplay=null===t;break;case"src":w(this,Pr)!==r&&A(this,Pr,r);break;case"style":default:break;case"loop":this.loop=null===t;break;case"width":if(null===r||""===r){w(this,Zr).style.width="";break}if(w(this,Gr)===n&&w(this,Zr).style.width===r)break;if(Number.isNaN(n)||n<0){A(this,Gr,0);break}A(this,Gr,n),-1!==r.indexOf("%")?w(this,Zr).style.width="".concat(n,"%"):w(this,Zr).style.width="".concat(n,"px");break;case"height":if(null===r||""===r){w(this,Zr).style.height="";break}if(w(this,qr)===n&&w(this,Zr).style.height===r)break;if(Number.isNaN(n)||n<0){A(this,qr,0);break}A(this,qr,n),-1!==r.indexOf("%")?w(this,Zr).style.height="".concat(n,"%"):w(this,Zr).style.height=","autoplay","src","style","loop","width","height"]}}]),s}(yr),kn=Nn;te&&console.log("%c[WasmPlayer] version: ".concat(l,", build date: ").concat("6/1/2023, 16:42:40 GMT+0800"),"color: #fb7299;");var Ln=document.createElement("meta");Ln.setAttribute("id","bwp-meta"),Ln.setAttribute("http-equiv","origin-trial"),Ln.setAttribute("content","Asgonbsvb0ufqVFRrwnMJgGf3HAtiwl++2S208XERSmTRBxebWHcsJTu9K4wtePhsFzqKF2Zf9F4FuaDogfx3woAAAB2eyJvcmlnaW4iOiJodHRwczovL2JpbGliaWxpLmNvbTo0NDMiLCJmZWF0dXJlIjoiVW5yZXN0cmljdGVkU2hhcmVkQXJyYXlCdWZmZXIiLCJleHBpcnkiOjE3MDk4NTU5OTksImlzU3ViZG9tYWluIjp0cnVlfQ=="),document.head.appendChild(Ln),window.customElements&&window.customElements.define&&(window.customElements.define("bwp-video",kn),window.BwpElement=kn,window.BwpMediaSource=wt);var xn={BwpElement:kn,BwpMediaSource:wt,BwpErrorCodes:Rt,isBwpSupported:Qt}}(),n.default}()},"object"==s(t)&&"object"==s(e)?e.exports=a():(i=[],void 0===(o="function"y-browl].ref 'inseAttributes(t,e.attributes),e.insert(t,e.os(t).fon(e){n(r,t,!1,e)},remove:function(e){n(r,t,!0,e)}}}},79637:function(e,t,r){"use strict";r.d(t,{R2:function(){return c},_j:function(){return i},a_:function(){return a},bw:function(){return u},cx:function(){return s},eG:function(){return n},m:function(){return o}});var n="bpx-docker",i="bpx-common",o="bpx-player",a="bpx-state",s="".concat(o,"-seamless-replacement"),u="nano",c=/\/player\/(main|js)\/core\.(.+\.)?js(\?.*)?$/},80942:function(e,t,r){"use strict";var n,i,o,a,s,u,c;r.d(t,{HR:function(){return o},dY:function(){return n},hH:function(){return s},qW:function(){return u},s:function(){return c},ty:function(){return i},u5:function(){return a}}),function(e){e[e.Normal=0]="Normal",e[e.Wide=1]="Wide",e[e.Web=2]="Web",e[e.Mini=3]="Mini",e[e.Full=4]="Full",e[e.Pip=5]="Pip"}(n||(n={})),function(e){e[e.Auto=0]="Auto",e[e.Delay=1]="Delay",e[e.Abort=2]="Abort"}(i||(i={})),function(e){e[e.Ugc=0]="Ugc",e[e.Pgc=1]="Pgc",e[e.Pugv=2]="Pugv",e[e.Stein=3]="Stein",e[e.Oneself=4]="Oneself",e[e.Manager=5]="Manager"}(o||(o={})),function(e){e[e.Default=0]="Default",e[e.Manager=1]="Manager",e[e.Creator=2]="Creator",e[e.Oneself=3]="Oneself",e[e.Homepage=4]="Homepage",e[e.Homepage_Topic=5]="Homepage_Topic",e[e.Embedded=6]="Embedded",e[e.PC_APP=7]="PC_APP",e[e.Playlist=8]="Playlist",e[e.Embedded_White=9]="Embedded_White",e[e.Embedded_Other=10]="Embedded_Other"}(a||(a={})),function(e){e.ManualAction="ManualAction",e.TimeupdateEvent="TimeupdateEvent",e.SeekingEvent="SeekingEvent"}(s||(s={})),function(e){e[e.I_PlayUrl=0]="I_PlayUrl",e[e.I_UserInfo=1]="I_UserInfo",e[e.I_ViewInfo=2]="I_ViewInfo",e[e.I_VideoShot=3]="I_VideoShot",e[e.P_Titlect=17]="Redirect",e[e.Flip_Season=18]="Flip_Season"}(c||(c={}))},1835:function(e,t,r_URL",e.WASM_PLAYER_FALLBACK="WASM_PLAYER_FALLBACK"}(n||(n={}))},25385:function(e,t,rck",e.Player_Virtual_Action="Player_Virtual_Action"}(n||(n={}))},78384:function(e,t,r){"use strict";r.d(t,{Rs:function(){return i},ZZ:function(){return n},Zc:function(){return p},Qj:function(){return f},Ac:function(){return _},rs:function(){return u},ae:function(){return w},T1:function(){return S},YE:function(){return T},ql:function(){return A},rS:function(){return b},bP:function(){return a},oh:function(){return s},fB:function(){return E}});var n,i=function(){function e(){}return e.USER_LOGOUT=0,e.USER_LIMITED=1,e.USER_REGISTERED=2,e.USER_NORMAL=3,e.USER_VIP=4,e.USER_ADVANCED=5,e.P_ROLE_FREE=0,e.P_ROLE_ASSISTANT=1,e.SEND_POOL_NORMAL=[],e.SEND_POOL_ADMIN=[1,1],e.SEND_FONT_SIZE_LOGOUT=[0,0,0,0,0,0,0],e.SEND_FONT_SIZE_LIMITED=[0,0,1,1,0,0,0],e.SEND_FONT_SIZE_REGISTERED=[0,0,1,1,0,0,0],e.SEND_FONT_SIZE_NORMAL=[0,0,1,1,0,0,0],e.SEND_FONT_SIZE_VIP=[0,1,1,1,1,0,0],e.SEND_FONT_SIZE_ADVANCED=[1,1,1,1,1,1,1],e.SEND_FONT_SIZE_ADMIN=[0,0,1,1,1,0,0],e.SEND_MODE_LOGOUT=[0,0,0,0],e.SEND_MODE_LIMITED=[1,-2,-2,0],e.SEND_MODE_REGISTERED=[1,-2,-2,0],e.SEND_MODE_NORMAL=[1,-2,-2,0],e.SEND_MODE_VIP=[1,1,1,1],e.SEND_MODE_ADVANCED=[1,1,1,1],e.SEND_MODE_LEVEL_LOW=[1,-2,-2,0],e.SEND_MODE_LEVEL_TWO=[1,-2,-2,0],e.SEND_MODE_LEVEL_NORMAL=[1,1,1,0],e.SEND_COLOR_LOGOUT=0,e.SEND_COLOR_LEVEL_LOW=1,e.SEND_COLOR_NORMAL=2,e.SEND_STATUS_LOGOUT=0,e.SEND_STATUS_LEVEL_LOW=1,e.SEND_STATUS_LIMITED=4,e.SEND_STATUS_NORMAL=5,e.SEND_STATUS_TYPING=6,e.SEND_STATUS_BEYOND_WORDS=7,e.SEND_STATUS_SENDING=8,e.SEND_STATUS_SENT=9,e.SEND_STATUS_BLOCKING=11,e.SEND_STATUS_BLOCKED=12,e.SEND_STATUS_CLOSED=13,e.SEND_STATUS_UPDATE=14,e.SEND_ANSWER_STATUS_IN=15,e.SEND_STATUS_CANNOT_BUY=16,e.SEND_STATUS_UP_DM=17,e.SEND_STATUS_DYNAMIC_PANEL=18,e.SEND_STATUS_MANUALLY_CLOSED=19,e.SEND_INPUT_LOGOUT=[0,1e5],e.SEND_INPUT_LIMITED=[20,1e4],e.SEND_INPUT_REGISTERED=[20,1e4],e.SEND_INPUT_NORMAL=[100,5e3],e.SEND_INPUT_VIP=[100,1e3],e.SEND_INPUT_ADVANCED=[100,1e3],e.BLOCK_DISABLED=0,e.BLOCK_SCROLL=1,e.BLOCK_REVERSE=2,e.BLOCK_BOTTOM=3,e.BLOCK_TOP=4,e.BLOCK_COLOR=5,e.BLOCK_GUEST=6,e.BLOCK_FONTSIZE=7,e.BLOCK_NORMAL=8,e.BLOCK_SUBTITLE=9,e.BLOCK_SPECIAL=10,e.BLOCK_LIST_USER=11,e.BLOCK_LIST_KEYWORD=12,e.BLOCK_LIST_COLOR=13,e.BLOCK_LIST_REGEXP=14,e.BLOCK_CLOUD_VIDEO=15,e.BLOCK_CLOUD_PARTITION=16,e.BLe=navigator.userAgent;return/Windows NT 10/.test(e)}function s(e,t,r,i,s){var u="spm_id_from="+n.Embed_White_Other,c="spm_id_from="+n.Embed,l="https://www.bilibili.com?",d="https://app.bilibili.com?",f="https://www.bilibili.com/v/jump-middle-edge/?",p="&mode="+e,h="",y=window.__NanoEmbedRefer?"&embed_refer="+document.referrer:"";if(s&&(h="&t="+Math.floor(s)),o.X.edge.alike||!a())switch(e){case"play":switch(r){case 1:return void window.open(t+c+h+y);case 2:case 3:return void window.open(t+u+h+y);default:return}case"main":switch(r){case 1:return void window.open(l+c+y);case 2:case 3:return void window.open(l+u+y);default:return}case"download":switch(r){case 1:return void window.open(d+c+y);case 2:case 3:return void window.open(d+u+y);default:return}default:return}else switch(e){case"play":switch(r){case 1:return void window.open(f+c+h+y+p+"&bvid="+i);case 2:case 3:return void window.open(f+u+h+y+p+"&bvid="+i);default:return}case"main":switch(r){case 1:return void window.open(f+c+y+p);case 2:case 3:return void window.open(f+u+y+p);default:return}case"download":switch(r){case 1:return void window.open(f+c+y+p);case 2:case 3:return void window.open(f+u+y+p);default:return}}}function u(e){var t={dolbyAudioQuality:0,hasDolbyAudio:!1,hasDolbyAudioSrc:!1,dolbyName:null,flacAudioQuality:0,hasFlacAudio:!1,hasFlacAudioSrc:!1,flacName:null,type:null};try{var r=e.url;if(r.dolby&&r.dolby.type){var n=+r.dolby.type,i=Array.isArray(r.dolby.audio)&&r.dolby.audio[0];if(t.hasDolbyAudio=!0,t.type=n,2===n)t.dolbyName="";else t.dolbyName="";i&&i.id&&(t.dolbyAudioQuality=+i.id,t.hasDolbyAudioSrc=!0)}r.flac&&r.flac.display&&(t.hasFlacAudio=!0,t.flacName="Hi-Res",r.flac.audio&&r.flac.audio.id&&(t.flacAudioQuality=+r.flac.audio.id,t.hasFlacAudioSrc=!0))}catch(e){}return t}!function(e){e.Embed_White_Other="888.80997.embed_other.whitelist",e.Embed="888.82037.embed"}(n||(n={}));var c=r(91332),l=r.n(c),d=r(96607);function f(e){return e.quality}function p(e,t){var r,n,i,o,a=d.n.alias,s=e.mediaDataSource.url,c=1===t,f=2===t,p=u(e.mediaDataSource),h=e.quality<=a.SD_32?a.AQ_30216:e.quality<a.FHD_80?a.AQ_30232:a.AQ_30280;return c&&p.hasDolbyAudioSrc&&"function"==typeof l().isEC3DolbyATMOSTypeSupported&&l().isEC3DolbyATMOSTypeSupported()?p.dolbyAudioQuality:f&&p.hasFlacAudioSrc&&"function"==typeof l().isFLACTypeSupported&&l().isFLACTypeSupported()?p.flacAudioQuality:"string"!=typeof s&&(+(null===(n=null===(r=null==s?void 0:s.audio)||void 0===r?void 0:r.find((function(e){return e.id===h})))||void 0===n?void 0:n.id)||+(null===(o=null===(i=null==s?void 0:s.audio)||void 0===i?void 0:i[0])||void 0===o?void 0:o.id))||a.AQ_30280}var h=r(15418),y=r(1326),m=r(92767),g=r(90787),v=r(19062);function _(){te){if(1===e.length)return e[0];var t=0;e.forEach,n=0;return e.forEach((function(e){r.set(new Uint8Array(e),n),n+=e.byteLength})),r.buffer};if(e)return e.abort(),m.x8.fsd=null,{type:"dash",video:t(e.vChunks),videoid:String(e.info.vId),videoUrl:e.info.vUrl,audio:t(e.aChunks),audioid:String(e.info.aId),audioUrl:e.info.aUrl}}catch(e){}}function E(){var e=function(e){var t,r,n,i;try{var o=y.Q.getPlayUrlBody(e);if(!o)return;if(!o.dash)return;var a=y.x.parse(e,{mseSupported:(0,g.a)(),enableSSLStream:!0,enableSSLResolve:!0});if(a.error)return;var s=o.dash.video,u=o.dash.audio,c=f(a.body),d=p(a.body,1),m=l().getVideoCodecStrategy({enableAV1:!0,enableHEVC:!0,manifest:o.dash,defaultVideoQn:c}),v=void 0,_=void 0,E=void 0,b=void 0;try{for(var S=(0,h.XA)(s),T=S.next();!T.done;T=S.next())if((R=T.value).id===c&&R.codecid===m){v=R.base_url||R.baseUrl,E=R.backup_url||R.backupUrl;break}}catch(e){t={error:e}}finally{try{T&&!T.done&&(r=S.return)&&r.call(S)}finally{if(t)throw t.error}}try{for(var w=(0,h.XA)(u),A=w.next();!A.done;A=w.next()){var R;if((R=A.value).id===d){_=R.base_url||R.baseUrl,b=R.backup_url||R.backupUrl;break}}}catch(e){n={error:e}}finally{try{A&&!A.done&&(i=w.return)&&i.call(w)}finally{if(n)throw n.error}}if(v&&_)return{vId:c,vUrl:v,vBackupUrls:E,aId:d,aUrl:_,aBackupUrls:b}}catch(e){}}(window.__playinfo__);if(e){var t="function"==typeof window.fetch,r="function"==typeof window.AbortController;!function(e){if(window.Set&&window.isSecureContext){var t="preconnect",r="dns-prefetch";try{var n=document.createDocumentFragment(),i=document.createElement("a"),o=function(e){if(e&&"string"==typeof e)return i.href=e,"https://".concat(i.host,"/")},a=o(e.vUrl),s=o(e.aUrl),u=new Set([a]),c=new Set([s]),l=function(e,t){var r,n;if(Array.isArray(t))try{for(var i=(0,h.XA)(t),a=i.next();!a.done;a=i.next()){var s=a.value,u=o(s);if(u&&e.add(u),e.size>=3)break}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},d=function(e,t){if(e){var r=document.createElement("link");r.rel=t,r.href=e,r.crossOrigin="anonymous",
r.setAttribute("data-injector","nano"),n.appendChild(r)}};d(a,t),d(s,t),l(u,e.vBackupUrls),l(c,e.aBackupUrls),u.forEach((function(e){return d(e,r)})),c.forEach((function(e){return d(e,r)})),document.head.appendChild(n)}catch(e){}}}(e),t&&r&&function(e){var t=this;try{ks:[],vChunks:[],abort:function(){return"function"==typeof i.abort&&i.abort()}},s=function(e,r,n){if(o.aborted)throw new Error("AbortError");var i={mode:"cors",cache:"force-cache",redirect:"follow",credentials:"omit",headers:{range:"bytes=".concat(r)},signal:o};return fetch(e,i).then((function(e){return(0,h.mG)(t,void 0,void 0,(function(){var t,r;return(0,h.Jh)(this,(function(i){switch(i.label){case 0:return e.ok?(r=(t=n).push,[4,e.arrayBuffer()]):[3,2];case 1:return r.apply(t,[i.sent()]),[3,3];case 2:throw new Error("HTTP error, status = ".concat(e.status));case 3:return[2]}}))}))}))};["0-8000","8001-100000","100001-200000","200001-300000"].forEach((function(t){r=r?r.then((function(){return s(e.vUrl,t,a.vChunks)})):s(e.vUrl,t,a.vChunks)})),["0-4000"00"].forEach((function(t){n=n?n.then((function(){return s(e.aUrl,t,a.aChunks)})):s(e.aUrl,t,ar b=function(){return Promise.all([r.e(655),r.e(154)]).then(r.bind(r,13179))},S=function(){return r.e(565).the20hen(r.bind(r,65839))},A=function(){return r.e(435).then(r.t.bind(r,97015,23))}},59707:function(e,t,r){"use strict";r.d(t,{bV:function(){return Vn},p7:function(){return vt},Su:function(){return Ii},vq:function(){return Ci.v},iG:function(){return nn},u5:function(){return f.u5},Om:function(){return x},ab:function(){return Se},mU:function(){return mn},tw:function(){return a.t},HR:function(){return f.HR},ty:function(){return f.ty},hH:function(){return f.hH},p2:function(){return s.p},s:function(){return f.s},IS:function(){return ze},Dg:function(){return yn},lS:function(){return mi},R2:function(){return v.R2},dY:function(){return f.dY},i0:function(){return cn},iX:function(){return Ti},w9:function(){return Pn},wY:function(){return hn},BI:function(){return sn},oF:function(){return Te},rs:function(){return Le.rs},Wp:function(){return _n}});var n=r(15418),i=r(75276),o=r(77165),a=r(25385),s=r(1835),u=r(93546),c=r(16983),l=function(){function e(e){var t,r=this;this.rootStore=e,this.rootPlayer=e.rootPlayer,this.nodes=e.nodes,this.track=this.rootPlayer.track,this.dp=Object.create(null),this.dc=Object.create(null),this.rootPlayer.on(a.t.Player_Dispose,(function(){return r.dp=(0,u.Jo)(r.dp)})).once(a.t.Player_Disconnect,(function(){return r.dc=(0,u.Jo)(r.dc)})),e.isLoadEnded&&(null===(t=e.userStore)||void 0===t?void 0:t.info)?this.onLoaded(e.userStore.info):this.rootPlayer.on(s.p.PLAYER_LOADED,(function(e){return r.onLoaded(e)})),this.rootPlayer.on(a.t.Player_Access_Changed,(function(){return r.onQuickLogin()})).on(s.p.PLAYER_UNLOAD,(function(){return r.onUnload()})).on(a.t.Player_Dispose,(function(){return r.onDispose()})).once(a.t.Player_Disconnect,(function(){return r.onDisconnect()}))}return Object.defineProperty(e.prototype,"log",{get:function(){if(!this._cachedLog){var e=this.rootPlayer.log;this._cachedLog=this.tag?e.getLogger(this.tag):_cachedLog},enumerable:!1,configurable:!0}),e.prototype.onLoaded=function(e){},e.prototype.onQuickLogin=function(){},e.prototype.onUnload=function(){},e.prototype.onDispose=function(){},e.prototype.onDisconnect=function(){},e}(),d=function(e){function t(t){var r=e.call(this,t)||this;return r.rootPlayer.once(s.p.PLAYER_GRAPH_FLATTEN,(function(){return r.onGraphFlatten()})).once(s.p.PLAYER_STORAGE_BUILD,(function(){return r.onStorageBuild()})).once(s.p.PLAYER_STATE_CREATE,(function(){return r.onStateCreate()})).once(s.p.PLAYER_STATE_CREATED,(function(){return r.onStateCreated()})).once(s.p.PLAYER_STORE_MOUNT,(function(){return r.onMount()})).once(s.p.PLAYER_STORE_MOUNTED,(function(){return r.onMounted()})),r.rootPlayer.on(a.t.Player_Navigate,(function(){return r.onNavigate()})).on(a.t.Player_Committed,(function(){return r.onCommitted()})).on(a.t.Player_Prepared,(function(){return r.onPrepared()})),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:fable:!1,configurable:!0}),t.prototype.changeState=function(e,t){(0,u.$p)(e,t)},t.prototype.setState=function(e,t){!t&&this.root.prototype.onGraphFlatten=function(){this.rootStore.decomposeSubStores(this)},t.prototype.onStorageBuild=function(){},t.prototype.onStateCreate=function(){var e=this.defaultState;(0,c.Z)(e)&&(this.state=o.LO.object(e,null,{deep:!1}))},t.prototype.onStateCreated=function(){},t.prototype.onMount=function(){},t.prototype.onMounted=function(){},t.prototype.onNavigate=function(){},t.prototype.onCommitted=function(){},t.prototype.onPrepared=function(){},t.prototype.onDispose=function(e){var t=this.defaultState;={},n=this.defaultState;Object.keys(n).forEach((function(t){e[t]||(r[t]=n[t])})),this.setState(r,!0)}}else this.setState(t,!0)},t}(l),f=r(80942);function p(){try{return"function"==typeof ResizeObserver&&"function"==typeof ResizeObserver.prototype.observe}catch(e){return!1}}var h=r(78757),y=r(19612),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="UiAtom",t.boundingRectTimer=null,t.loadedTimeoutClock=null,t}return(0,n.ZT)(t,e),t.prototype.addEvents=function(){var e=this;this.rootPlayer.on(s.p.PLAYER_MEDIA_CHANGED,(function(){p()&&(e.removeResizeObserver(),e.addResizeObserver())}))},t.prototype.addReactions=function(){var e=this,t=this.rootStore.uiStore;this.dc.mainChanged=(0,o.U5)((function(){return t.state.mainScreen}),(function(r){e.resize(!1,!1),e.rootPlayer.emit(a.t.Player_Statue_Changed,new CustomEvent(a.t.Player_Statue_Changed,{detail:{mainTrigger:!0,sideTrigger:null,mainScreen:r,sideScreen:t.state.sideScreen}}))})),this.dc.sideChanged=(0,o.U5)((function(){return t.state.sideScreen}),(function(r){e.resize(!1,!1),e.rootPlayer.emit(a.t.Player_Statue_Changed,new CustomEvent(a.t.Player_Statue_Changed,{detail:{mainTrigger:null,sideTrigger:!0,mainScreen:t.state.mainScreen,sideScreen:r}}))})),this.dc.isLoaded=(0,o.U5)((function(){return e.rootStore.isLoaded}),(function(t){queueMicrotask((function(){t?e.rootPlayer.emit(a.t.Player_Leave_Loading,new CustomEvent(a.t.Player_Leave_Loading)):e.rootPlayer.emit(a.t.Player_Enter_Loading,new CustomEvent(a.t.Player_Enter_Loading))}))}),{fireImmediately:!0}),this.dc.containerResize=(0,o.U5)((function(){return{w:t.state.containerWidth,h:t.state.containerHeight}}),(function(){e.rootPlayer.emit(a.t.Player_Container_Resize,new CustomEvent(a.t.Player_Container_Resize))})),this.dc.videoNodeResize=(0,o.U5)((function(){return{w:t.state.videoNodeWidth,h:t.state.videoNodeHeight}}),(function(){e.rootPlayer.emit(a.t.Media_Element_Resize,new CustomEvent(a.t.Media_Element_Resize))})),this.dc.isFirstLoadEnded=(0,o.gx)((function(){return e.rootStore.isLoadEnded}),(function(){p()?e.addResizeObserver():e.resizeEventsDisposer=e.addResizeEvents(),e.resize(!0,!0)}))},t.prototype.startLoadChecker=function(e){var t=this;this.stopLoadChecker();this.loadedTimeoutClock=new h.eF((function(r,n){n>=r&&(t.log.w("[LoadChecker]","",""),e&&e())}),3e3,500),this.dp.loadChecker&&this.dp.loadChecker(),this.dp.loadChecker=(0,o.EH)((function(){t.rootStore.pageHidden?t.loadedTimeoutClock&&t.loadedTimeoutClock.suspend():t.loadedTimeoutClock&&t.loadedTimeoutClock.resume()}))},t.prototype.stopLoadChecker=function(){this.dp.loadChecker&&this.dp.loadChecker(),this.loadedTimeoutClock&&(this.loadedTimeoutClock.abort(),this.loadedTimeoutClock=null)},t.prototype.boundingRectHandler=function(){var e={},t=this.nodes.container,r=this.nodes.videoArea,n=this.rootStore,i=n.mediaStore,o=n.uiStore;e.videoNodeWidth=Math.round(i.video.offsetWidth),e.videoNodeHeight=Math.round(i.video.offsetHeight),r&&(e.videoAreaWidth=Math.round(r.offsetWidth),e.videoAreaHeight=Math.round(r.offsetHeight)),
t&&(e.containerWidth=Math.round(t.offsetWidth),e.containerHeight=Math.round(t.offsetHeight)),o.setState(e)},t.prototype.addResizeEvents=function(){var e=this,t=(0,y.Z)EventListener("resize",t),functiveResizeEvents=function(){"function"==typeof this.resizeEventsDisposer&&this.resizeEventsDisposer()},t.prototype.addResizeObserver=function(){var e=this.nodes.container,t=this.nodes.videoArea,r=this.rootStore,i=r.mediaStore,o=r.uiStore,a=i.video;this.resizeObserver=new ResizeObserver((function(r,i){var s,u,c={};try{for(var l=(0,n.XA)(r),d=l.next();!d.done;d=l.next()){var f=d.value,p=f.contentRect;if(p){var h=Math.round(p.width),y=Math.round(p.height);switch(f.target){case e:c.containerWidth=h,c.containerHeight=y;break;case t:c.videoAreaWidth=h,c.videoAreaHeight=y;break;case a:c.videoNodeWidth=h,c.videoNodeHeight=y}}}}catch(e){s={error:e}}finally{try{d&&!d.done&&(u=l.return)&&u.call(l)}finally{if(s)throw s.error}}o.setState(c)})),this.resizeObserver.observe(e,{box:"border-box"}),this.resizeObserver.observe(t,{box:"border-box"}),this.resizeObserver.observe(a,{box:"border-box"})},t.prototype.removeResizeObserver=function(){this.resizeObserver&&this.resizeObserver.disconnect()},t.prototype.resize=function(e,t){var r=this;e?t?this.boundingRectHandler():(cancelAnimationFrame(this.boundingRectTimer),this.boundingRectTimer=requestAnimationFrame((function(){return r.boundingRectHandler()}))):p()||this.resize(!0,t)},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),cancelAnimationFrame(this.boundingRectTimer),this.stopLoadChecker(),this.removeResizeEvents(),this.removeResizeObserver()},t}(l),g=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="UiStore",(0,o.rC)(r),r.uiAtom=new m(t),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{isLoaded:!1,isLoadTimeout:!1,kind:f.HR.Ugc,mainScreen:f.dY.Normal,sideScreen:null,pipWindowWidth:0,pipWindowHeight:0,videoNodeWidth:0,videoNodeHeight:0,videoAreaWidth:0,videoAreaHeight:0,containerWidth:0,containerHeight:0,mouseClientX:0,mouseClientY:0,miniScreenRight:84,miniScreenBottom:48}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isTinyView",{get:function(){return null==this.state.sideScreen&&this.state.mainScreen===f.dY.Mini||(this.configStore.embeddedEnv?0===this.embedView:this.state.containerWidth<=480||this.state.contaiullView",{get:function(){return this.state.sideScreen===f.dY.Full||this.state.mainScreen===f.dY.Web},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"embedView",{get:function(){return this.state.containerWidth<420?0:this.state.containerWidth<550?1:this.state.containerWidth<730?2:this.state.containerWidth<1100?3:4},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasBlackGap",{get:function(){return this.portStore.getScreenKind()===f.dY.Normal&&!this.settingStore.state.hideBlackGap},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenKind",{get:function(){return this.portStore.getScreenKind()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShowCtrlButtons",{get:function(){var e=this.embedView,t=this.danmakuStore.state.isHideInput,r=this.state.videoAreaWidth;return 1!==e&&!(!t&&r<900&&3===e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kind",{get:function(){return this.state.kind},enumerable:!1,configurable:!0}),t.prototype.onMount=function(){e.prototype.onMount.call(this),this.uiAtom.addEvents(),this.uiAtom.addReactions(),this.addEvents()},t.prototypCommitted.call(this),thi!0})}))},t.prototypoadChecker(),this.setSrototype.addEvents=function(){this.rootPlayer.window.addEventListener("mousemove",this.onMousemove)},t.prototype.onMousemove=function(e){this.setState({mouseClientX:e.clientX||0,mouseClientY:e.clientY||0})},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,{kind:1,mainScreen:1,sideScreen:1,pipWindowWidth:1,pipWindowHeight:1,videoNodeWidth:1,videoNodeHeight:1,videoAreaWidth:1,videoAreaHeight:1,containerWidth:1,containerHeight:1,mouseClientX:1,mouseClientY:1,miniScreenRight:1,miniScreenBottom:1})},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),this.rootPlayer.window.removeEventListener("mousemove",this.onMousemove)},(0,n.gn)([o.Fl],t.prototype,"isTinyView",null),(0,n.gn)([o.Fl],t.prototype,"isFullView",null),(0,n.gn)([o.Fl],t.prototype,"embedView",null),(0,n.gn)([o.Fl],t.prototype,"hasBlackGap",null),(0,n.gn)([o.Fl],t.prototype,"screenKind",null),(0,n.gn)([o.Fl],t.prototype,"isShowCtrlButtons",null),(0,n.gn)([i.ZP],t.prototype,"onMousemove",null),t}(d),v=r(79637);function _(e,t){return void 0===t&&(t=2),isNaN(e)?e:Math.round(Math.pow(10,t)*e)/Math.pow(10,t)}function E(){var e=document.createElement("video");e.croseturn(0,n.mG)(this,vull!==e&&e.apply(this,arguments)||this;return t.tag="MediaAtom",t.autcopyElementProps=function(e,t){var r=[function(){e.style.cssText&&(t.style.cssText=e.style.cssText)}];["controls","autoPictureInPicture","disablePictureInion(r){return function(r){r in e&&t[r]!==e[r]&&(t[r]=e[r])}(r)})),r.forEach((function(e){return e()}))},t.prototype.getBufferRange=function(e){var t=this.rootStore.mediaStore.video,r=t.buffered,n=t.currentTime;if(r&&r.length){if(e)return[r.start(r.length-1),r.end(r.length-1)];for(var i=0,o=1/0,a=0;a<r.length;a++){var s=r.start(a),u=r.end(a);if(s<=n&&u>=n)return[r.start(a),r.end(a)];var c=Math.min(Math.abs(n-s),Math.abs(n-u));o>c&&(i=a,o=c)}return[r.start(i),r.end(i)]}return[0,0]},t.prototype.gotoFirstTime=function(){if(!this.isFirstPlayForbidden()){var e=this.rootStore,t=e.mediaStore,r=e.configStore,n=e.mpdStore;if(!t.state.tExhausted){var i=r.t,o=t.video.duration,a=n.lastWatchSecond;i>0&&i<o?(this.log.i("[Config.t]","Seek to ".concat(i,"s")),t.internalSeek(i)):a&&(this.log.i("[History]","Seek to ".concat(a,"s")),t.internalSeek(a),t.setState({isLastWatchSeeked:!0})),t.setState({tExhausted:!0})}}},t.prototype.startFirstPlay=function(e,t){var r=this.rootStore,n=r.configStore,i=r.uiStore,o=r.portStore,a=r.mediaStore,s=r.episodeStore;if(!n.fromDid&&(this.autoplayId!==this.autoplayIdUsed||e))if(this.isFirstPlayForbidden())i.isFullView&&o.reqStatue(null);else{if(e&&n.setState({ips:0}),!a.state.autoplayExhausted&&(a.autoplay||t)){var u=!!s.isFirst;this.firstPlayback(this.autoplayId,u)}this.autoplayIdUsed=this.autoplayId,this.log.i("[StartFirstPlay]","isManual:".concat(!!e))}},t.prototype.isFirstPlayForbidden=function(){var e=this.rootStore,t=e.uiStore,r=e.mpdStore,n=e.configStore,i=t.kind,o=r.state.playUrlCode;if(n.fromDid||n.isManagerCreator())return!0;switch(i){case f.HR.Ugc:return 87007===o;case f.HR.Pgc:return 87005===o;case f.HR.Pugv:return-403===o;default:return!1}},t.prototype.firstPlayback=function(e,t,r){var n=this,i=this.rootStore,o=i.mediaStore,s=i.portStore,u="[autoplay:".concat(e,"]"),c=function(t){var r=e!==n.autoplayId;return r&&n.log.w(u,t,"Inconsistent"),r},l=function(){r&&o.video.muted&&(n.log.i(u,"reset HTMLMediaElement.muted"),o.video.muted=!1)};this.log.i(u,"start"),s.play({initiator:"Initial:Autoplay"}).then((function(){c("done")||(n.log.i(u,"done"),o.setState({autoplayExhausted:!0,autoplayPlanB:!!r}))})).catch((function(r){if(!r)return n.log.w(u,"Unknown err"),void l();if(c("fail"))l();else{if(t&&!o.video.muted)return n.log.i(u,"fallback"),o.video.muted=!0,n.firstPlayback(e,!1,!0);if(l(),n.log.w(u,"fail",r.name,r.message),
"NotAllowedError"===(r&&r.name))o.setState({autoplayNotAllowed:!0}),n.track.e("browser_forbid_autoplay"),n.rootPlayer.emit(a.t.Me_Allowed))}}))},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.autoplayId++},t}(l),T=r(73584),w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="BufferAtom",t.pageFirstVisible=!1,t.stuckDetail={timer:-1,previousTime:-1},t.bufferingDetail={timer:-1,interval:250,previousTime:-1},t.laggingDetail={timer:-1,interval:250,previousTime:-1},t}return(0,n.ZT)(t,e),t.prototype.hackLongStuck=function(e,t){var r=this,n=this.rootStore,i=n.mediaStore,o=n.uiStore,a=n.portStore;if(t&&(this.stuckDetail.previousTime=-1),!e)return clearTimeout(this.stuckDetail.timer),void(this.stuckDetail.timer=null);i.video&&o.state.isLoaded&&(clearTimeout(this.stuckDetail.timer),this.stuckDetail.timer=window.setTimeout((function(){var e=a.getCurrentTime(),t=r.stuckDetail.previousTime;if(t!==e||0===t){var n=e+.5;if(T.X.safari.alike&&e<1)n=1;else{var o=i.video.buffered;o&&o.length&&e<o.start(0)&&(n=o.start(0))}r.log.w("[Stuck:Rescue]","ct:".concat(e,",st:").concat(n)),i.internalSeek(n),r.stuckDetail.previousTime=a.getCurrentTime(),r.track.o("stuck_rescue",{ct:e,st:n})}else r.rootPlayer.emit(s.p.PLAYER_PLAYBACK_LAG)}),5e3))},t.prototype.checkBufferStatus=function(e,t){var r=this,n=this.rootStore.mediaStore;if(t&&(this.bufferingDetail.previousTime=-1),!e)return clearInterval(this.bufferingDetail.timer),void n.setState({buffering:!1});clearInterval(this.bufferingDetail.timer),this.bufferingDetail.timer=window.setInterval((function(){var e=n.video;if(e){var t=r.bufferingDetail.previousTime,i=!(e.ended||e.paused||e.error)&&t===e.currentTime;n.state.buffering!==i&&n.setState({buffering:!!i}),i||(r.bufferingDetail.previousTime=e.currentTime)}}),this.bufferingDetail.interval)},t.prototype.checkLaggingStatus=function(e,t){var r=this,n=this.rootStore,i=n.mediaStore,o=n.uiStore,a=n.errorStore,u=function(){clearInterval(r.laggingDetail.timer),r.laggingDetail.timer=-1};if((null==t?void 0:t.resetPreviousTime)&&(this.laggingDetail.previousTime=-1),!e)return u(),(null==t?void 0:t.fromSeeking)||i.setState({lagging:!1}),void this.rootPlayer.emit(s.p.PLAYER_LAG_FRAME,{isLagging:i.state.lagging,isRunning:!1});var c=i.video;c&&this.pageFirstVisible&&o.state.isLoaded&&(c.paused||c.seeking||isNaN(c.currentTime)||isNaN(c.duration)||0!==c.readyState&&0!==c.networkState&&3!==c.networkState&&(this.laggingDetail.timer>-1||(u(),this.laggingDetail.timer=window.setInterval((function(){var e=i.video;if(e){var t=r.laggingDetail.previousTime,n=!(e.ended||e.paused||e.error),o=!a.state.kernelError,u=n&&o&&t===e.currentTime;i.state.lagging!==u&&i.setState({lagging:!!u}),u||(r.laggingDetail.previousTime=e.currentTime),r.rootPlayer.emit(s.p.PLAYER_LAG_FRAME,{isLagging:u,isRunning:!0})}}),this.laggingDetail.interval))))},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.hackLongStuck(!1,!0),this.checkBufferStatus(!1,!0),this.checkLaggingStatus(!1,{resetPreviousTime:!0})},t}(l),A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="StuckAtT)(t,e),t.prototype.cleanAfterDispose=function(){this.latestSeekedTime=NaN,this.extBufferingInfo={}},t.prototype.addEvents=function(){var e=this,t=this.rootStore,r=t.mediaStore,n=t.portStore,i=t.kernelStore;this.rootPlayer.on(a.t.Play()}),1),this.rootPlayer.on(s.p.PLAYER_PLAYBACK_LAG,(function(){r.setState({loadLagTime:Date.now()})})).on(s.p.PLAYER_PLAYBACK_LAG,(function(){var t=NaN,o=NaN,a="",s=r.state.bufferedTime,u=n.getCurrentTime(),c=i.dashKernel;c&&(t=c.getBufferLength("video"),o=c.getBufferLength("audio"),"function"==typeof c.getNextFragmentHistoryInfo&&(a=c.getNextFragmentHistoryInfo())),e.track.o("web_loadlag",{ct:u,bt:s,vbl:t,abl:o,msg:a})})).on(s.p.MEDIA_TIMEUPDATE,(function(){r.state.loadLagTime&&(e.track.o("web_loadlag_end",{val:Date.now()-r.state.loadLagTime}),r.setState({loadLagTime:0}))})),this.rootPlayer.on(s.p.PLAYER_LAG_FRAME,(function(t){var n=r.video,o=n.currentTime;if(t.isLagging){if(r.setState({stalled:!0}),!r.state.bufferStartTime){var a={},s=i.dashKernel,u=s&&s.getBufferingInfo(!1),c=u&&u.type,l=r.state.bufferedTime,d=!(n.error||n.seeking||n.ended||n.paused);if(a.obLen=l,a.ocTime=o,s&&Object.assign(a,{vbl:s.getBufferLength("video"),abl:s.getBufferLength("audio"),spd:s.getNetworkActivity()},s.getBufferingInfo()),e.extBufferingInfo=a,e.track.o("start_load",a),o<l-3?r.setState({lagLoad:!0}):"161"===c?r.setState({headLoad:!0}):s&&!a.type&&r.setState({nullLoad:!0}),d)switch(c){case"142":case"141":e.trySkipDashGap(u);break;default:e.trySkipMediaGap()}r.setState({bufferStartTime:Date.now()})}}else t.isRunning?r.setState({previousTime:o}):r.setState({previousTime:o,stalled:!1})})).on(s.p.MEDIA_SEEKED,(function(){e.latestSeekedTime=r.video.currentTime,r.setState({seekLoad:!1})})).on(s.p.MEDIA_TIMEUPDATE,(function(){var t=r.video.currentTime,n=r.state.previousTime,o=!isNaN(t)&&!isNaN(n)&&n!==t;if(r.state.stalled&&o){var a=Date.now(),s=r.state.bufferStartTime;if(s&&s<a){e.extBufferingInfo.bufferTime=a-s;var u=t-e.latestSeekedTime;u>0&&u<.2&&(r.setState({seekLoad:!0}),e.extBufferingInfo.latestSeekedTime=e.latestSeekedTime,e.extBufferingInfo.videoTime=t,e.extBufferingInfo.delta=u,e.extBufferingInfo.ccType="seeked_hack"),e.track.o(r.state.seekLoad?"seek_end_load":r.state.lagLoad?"lag_end_load":r.state.headLoad?"head_end_load":r.state.nullLoad?"null_end_load":"end_load",e.extBufferingInfo,{exParam:i.serviceModule}),e.extBufferingInfo={}}}r.setState({stalled:!1,lagLoad:!1,seekLoad:!1,headLoad:!1,nullLoad:!1,bufferStartTime:0})}))},t.prototype.trySkipDashGap=function(e){var t=this.rootStore.mediaStore,r=t.video;try{var i=(0,n.CR)(e.gap.split("-").map(Number),2),o=i[0],a=i[1],s=Math.max(r.currentTime,e.cTime),u=Math.max(r.currentTime,a)+.1;a-o>0&&(this.log.w("[DashGap]","".concat(s,";").concat(o,",").concat(a)),this.track.o("video_gap",{ct:s,st:u,end:o,nextStart:a,type:+e.type})),isNaN(u)?this.trySkipMediaGap():u>s&&u!==t.state.prevSeekTime&&(this.log.i("[SkipDashGap]","ct:".concat(s,",st:").concat(u)),t.setState({prevSeekTime:u}),t.internalSeek(u))}catch(e){0,this.trySkipMediaGap()}},t.prototype.trySkipMediaGap=function(){var e=this.rootStore.mediaStore,t=e.video,r=t.currentTime;if(t.buffered&&t.buffered.length>1)for(var n=0;n<t.buffered.length-1;n++){var i=0,o=t.buffered.start(n),a=t.buffered.end(n),s=t.buffered.start(n+1);t.buffered.end(n+1);o<r&&a>=r-4&&s>r-4&&s-a<4&&(i=Math.max(s,r),this.log.w("[MediaGap]","".concat(r,";").concat(a,",").concat(s)),this.track.o("video_gap",{ct:r,st:i,end:a,nextStart:s,type:0})),i&&i!==e.state.prevSeekTime&&(this.log.i("[SkipGap]","ct:".concat(r,",st:").concat(i)),e.setState({prevSeekTime:i}),e.internalSeek(i))}},t}(l),R=function(e){function t(t){var r=e.call(this,t)||this;r.tag="MediaStore",r.ifReqId=null,r.ifTimer=null,r.modernResize=!1,(0,o.rC)(r),r.mediaAtom=new S(t),r.bufferAtom=new w(t),r.stuckAtom=new A(t);var n=r.element=E(),i=r.nodes.videoWrap;return n.crossOrigin="anonymous",r.rootPlayer.hasFeature("noPip")&&(n.disablePictureInPicture=!0),i&&!n.parentElement&&i.appendChild(n),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{ended:!1,paused:!0,duration:NaN,remoteDuration:NaN,currentTime:0,progressTime:0,bufferedTime:0,aBufferLength:null,vBufferLength:null,videoWidth:0,videoHeight:0,seeking:!1,lagging:!1,buffering:!1,isLoadStart:!1,isMetadataLoaded:!1,isFirstFrame:!1,isFirstCanplay:!1,isLastWatchSeeked:!1,tExhausted:!1,autoplayExhausted:!1,autoplayPlanB:!1,autoplayNotAllowed:!1,firstPlay:0,firstIdleFrame:0,stalled:!1,lagLoad:!1,seekLoad:!1,headLoad:!1,nullLoad:!1,bufferStartTime:0,previousTime:0,prevSeekTime:0,loadLagTime:0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.state.videoWidth&&this.state.videoHeight?this.state.videoWidth/this.state.videoHeight:0},enumerable:!1,configurable:!0}),
Object.defineProperty(t.prototype,"autoplay",{get:function(){if(this.rootPlayer.hasFeature("noAutoplay"))return!1;switch(this.configStore.state.ips){case 2:return!1;case 1:return!0;default:return!this.episodeStore.isFirst||this.settingStore.state.autoplay}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){return this.element},enumerable:!1,configurable:!0}),t.prototype.addEvents=function(){var e=this;this.rootPlayer.on(a.t.Player_DurationChange,(function(){e.setState({duration0)})})).on(a.t.Player_TimeUpdate,(function(){e.setState({currentTime:e.portStore.getCurrentTime()})})).on(a.t.Player_Progress,(functi)})).on(a.t.Player_ProgressBar_Change,(function(t){e.setState({progressTime:t.detail.progressTime})})).on(a.t.Player_Quality_Rendered,(function(t){if(!(e.modernResize||t.detail&&"video"!==t.detail.mediaType)){var r=e.element.videoWidth,n=e.element.videoHeight;r&&n&&e.setState({videoWidth:r,videoHeight:n})}})),this.rootPlayer.on(a.t.Player_Play,this.leavePlayerEndedHandler).on(a.t.Player_TimeUpdate,this.leavePlayerEndedHandler).on(a.t.Player_Seeking,this.leavePlayerEndedHandler)},t.prototype.leavePlayerEndedHandler=function(){this.portStore.isEnded(!0)||this.setState({ended:!1})},t.prototype.internalSeek=function(e){var t=this.video;this.log.i("[internalSeek]","targetTime:".concat(e,",duration:").concat(t.duration)),this.rootPlayer.emit(s.p.PLAYER_BEFORE_SEEKING,t.currentTime,e),this.tateCreated=function(){e.prototype.onStateCreated.call(this),this.addEvents(),this.addMediaEvents()},t.prototype.onMount=function(){var s.dc.playingAndWaiting=(0,o.U5)((function(){return{paused:t.state.paused,waiting:t.state.buffering}}),(function(e){queueMicrotask((function(){e.paused||(e.waiting?t.rootPlayer.emit(s.p.MEDIA_WAITING):t.rootPlayer.emit(s.p.MEDIA_PLAn t.state.buffering}),(function(e){t.checkBufferLength("Buffering",e),t.bufferAtom.hackLongStuck(e)})),this.dc.retrySource=(0,o.U5)((function(){return t.kernelStore.retrySource}),(function(e){return t.bufferAtom.checkLaggingStatus(!e)})),this.dc.pageFirstVisible=(0,o.gx)((function(){return!t.rootStore.pageHidden}),(function(){t.bufferAtom.pageFirstVisible=!0,t.bufferAtom.checkLaggingStatus(!0)}))},t.prototype.replaceElement=function(e){this.element.parentElement?(this.rootPlayer.emit(s.p.PLAYER_BEFORE_MEDIA_REPLACE,e),this.removeMediaEvents(),this.mediaAtom.copyElementProps(this.element,e),e.classList.remove(v.cx),e.defaultPlaybackRate=this.element.defaultPlaybackRate,e.playbackRate=this.element.playbackRate,e.volume=this.element.volume,e.muted=this.element.muted,this.element.muted=!0,this.element.parentElement.removeChild(this.element),this.wmpStore.destroyWasmPlayer(this.element),this.element=e,this.addMediaEvents(),this.log.i("[replaceElement]","HTMLMediaElement haement is null")},t.prototype.startFirstPlay=function(e,t){return this.mediaAtom.startFirstPlay(e,t)},t.prototype.startIdleFrame=function(){var e=this;if(!this.ifTimer&&!this.state.firstIdleFrame){var t=this.episodeStore.isFirst?500:50,r=Date.now(),n=window.requestIdleCallback,i=function(){var t=Date.now(),n=t-r;e.clearIdleFrame(),e.log.i("[IdleFrame]","delay:".concat(n,"ms")),e.state.firstIdleFrame||e.setState({firstIdleFrame:t}),e.rootPlayer.emit(a.t.Player_Idle_Frame,new CustomEvent(a.t.Player_Idle_Frame))};this.ifTimer="function"==typeof n?window.setTimeout((function(){e.ifReqId=n(i,{timeout:t})}),1):window.setTimeout((function(){return i()}),t)}},t.prototype.clearIdleFrame=function(){var e=window.cancelIdleCallback;this.ifReqId&&"function"==typeof e&&(e(this.ifReqId),this.ifReqI},t.prototype.isSameProgressTime=function(){return this.video.currentTime===this.state.progressTime},t.prototype.checkBufferLength=function(e,t){var r=this.state.aBufferLength,n=this.state.vBufferLength;if(null!=r&&null!=n){var i=this.video.currentTime;(t||(!r||!n))&&(this.log.i("[CBL:".concat(e,"]"),"".concat(i,";").concat(r,",").concat(n)),this.track.o("zero_buffer",{from:e,currentTime:i,abl:r,vbl:n}))}},t.prototype.addMediaEvents=function(){this.video&&(this.video.addEventListener("loadstart",this.onLoadStart),this.video.addEventListener("loadedmetadata",this.onLoadedmetadata),this.video.addEventListener("loadeddata",this.onLoadedData),this.video.addEventListener("canplay",this.onCanplay),this.video.addEventListener("error",this.onError),this.video.addEventListener("abort",this.onAbort),this.video.addEventListener("emptied",this.onEmptied),this.video.addEventListener("seeking",this.onSeeking),this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("ended",this.onEnded),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("stalled",this.onStalled),this.video.addEventListener("progress",this.onProgress),this.video.addEventListener("suspend",this.onSuspend),this.video.addEventListener("timeupdate",this.onTimeUpdate),this.video.addEventListener("ratechange",this.onRateChange),this.video.addEventListener("volumechange",this.onVolumeChange),this.video.addEventListener("durationchange",this.onDurationChange),this.video.addEventListener("performance",this.onWasmPlayerFallback),this.video.addEventListener("resize",this.onResize),this.video.addEventListener("playing",this.onPlaceholder),this.video.addEventListener("waiting",this.onPlaceholder))},t.prototype.removeMediaEvents=function(){this.video&&(this.video.removeEventListener("loadstart",this.onLoadStart),this.video.removeEventListener("loadedmetadata",this.onLoadedmetadata),this.video.removeEventListener("loadeddata",this.onLoadedData),this.video.removeEventListener("canplay",this.onCanplay),this.video.removeEventListener("error",this.onError),this.video.removeEventListener("abort",this.onAbort),this.video.removeEventListener("emptied",this.onEmptied),this.video.removeEventListener("seeking",this.onSeeking),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("ended",this.onEnded),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("stalled",this.onStalled),this.video.removeEventListener("progress",this.onProgress),this.video.removeEventListener("suspend",this.onSuspend),this.video.removeEventListener("timeupdate",this.onTimeUpdate),this.video.removeEventListener("ratechange",this.onRateChange),this.video.removeEventListener("volumechange",this.onVolumeChange),this.video.removeEventListener("durationchange",this.onDurationChange),this.video.removeEventListener("performance",this.onWasmPlayerFallback),this.video.removeEventListener("resize",this.onResize),this.video.removeEventListener("playing",this.onPlaceholder),this.video.removeEventListener("waiting",this.onPlaceholder))},t.prototype.onLoadStart=function(){this.rootStore.stageAtom.set(6),this.log.i("LoadStart"),this.setState({isLoadStart:!0}),this.bufferAtom.checkBufferStatus(!1),this.bufferAtom.checkLaggingStatus(!1),this.rootPlayer.emit(s.p.MEDIA_LOADSTART)},t.prototype.onLoadedmetadata=function(){this.rootStore.stageAtom.set(7),this.log.i("Loadedmetadata"),this.setState({isMetadataLoaded:!0}),this.mediaAtom.gotoFirstTime(),this.rootPlayer.emit(s.p.MEDIA_LOADEDMETADATA)},t.prototype.onLoadedData=function(){this.rootStore.stageAtom.set(8),this.log.i("LoadedData",this.configStore.session),this.setState({isFirstFrame:!0}),this.rootPlayer.emit(s.p.MEDIA_LOADEDDATA)},t.prototype.onCanplay=function(){if(this.state.isLoadStart||this.state.isMetadataLoaded){if(this.rootStore.stageAtom.set(9),this.setState({isFirstCanplay:!0}),this.uiStore.complete(),this.mediaAtom.startFirstPlay(),this.bufferAtom.checkLaggingStatus(!0),
!(this.modernResize||this.state.videoWidth&&this.state.videoHeight)){var e=this.element.videoWidth,t=this.element.videoHeight;e&&t&&this.setState({videoWidth:e,videoHeight:t})}this.rootPlayer.emit(s.p.MEDIA_CANPLAY),this.startIdleFrame()}},t.prototype.onError=function(e){this.bufferAtom.checkLaggingStatus(!1),this.rootPlayer.emit(s.p.MEDIA_ERROR)},t.prototype.onAbort=function(){this.bufferAtom.checkLaggingStatus(!1),this.rootPlayer.emit(s.p.MEDIA_ABORT)},t.prototype.onEmptied=function(){this.bufferAtom.checkLaggingStatus(!1),this.rootPlayer.emit(s.p.MEDIA_EMPTIED)},t.prototype.onSeeking=function(){this.setState({seeking:!0}),this.bufferAtom.checkLaggingStatus(!1,{fromSeeking:!0}),this.rootPlayer.emit(s.p.MEDIA_SEEKING),!this.isSameProgressTime()&&this.video.currentTime>.1&&this.rootPlayer.emit(a.t.Player_ProgressBar_Change,new CustomEvent(a.t.Player_ProgressBar_Change,{detail:{progressTime:this.video.currentTime,initiator:f.hH.SeekingEvent}}))},t.prototype.onSeeked=function(){this.setState({seeking:!1}),this.bufferAtom.checkLaggingStatus(!0),this.rootPlayer.emit(s.p.MEDIA_SEEKED)},t.prototype.onStalled=function(){this.rootPlayer.emit(s.p.MEDIA_STALLED)},t.prototype.onProgress=function(){this.rootPlayer.emit(s.p.MEDIA_PROGRESS)},t.prototype.onSuspend=function(){this.rootPlayer.emit(s.p.MEDIA_SUSPEND)},t.prototype.onTimeUpdate=function(){this.checkBufferLength("Timeupdate"),this.rootPlayer.emit(s.p.MEDIA_TIMEUPDATE),!this.isSameProgressTime()&&this.video.currentTime>.1&&this.rootPlayer.emit(a.t.Player_ProgressBar_Change,new CustomEvent(a.t.Player_ProgressBar_Change,{detail:{progressTime:this.video.currentTime,initiator:f.hH.TimeupdateEvent}}))},t.prototype.onRateChange=function(){this.settingStore.setState({playbackRate:this.video.playbackRate}),this.rootPlayer.emit(s.p.MEDIA_RATECHANGE)},t.prototype.onVolumeChange=function(){this.settingStore.setState({muted:this.video.muted,volume:_(this.video.volume)}),this.rootPlayer.emit(s.p.MEDIA_VOLUMECHANGE)},t.prototype.onDuratiCHANGE)},t.prototype.onWasmPlayerFallback=function(){this.rootPlayer.emit(s.p.WASM_PLAYER_FALLBACK)},t.prototype.onEnded=function(){this.bufferAtom.checkBufferStatus(!1),this.bufferAtom.checkLaggingStatus(!1),this.rootPlayer.emit(s.p.MEDIA_ENDED)},t.prototype.onPlay=function(){this.state.firstPlay||this.setState({firstPlay:Date.now()}),this.bufferAtom.checkBufferStatus(!0),this.bufferAtom.checkLaggingStatus(!0),this.rootPlayer.emit(s.p.MEDIA_PLAY)},t.prototype.onPause=function(){this.bufferAtom.checkBufferStatus(!1),this.bufferAtom.checkLaggingStatus(!1),this.rootPlayer.emit(s.p.MEDIA_PAUSE)},t.prototype.onResize=function(){if(this.modernResize||(this.modernResize=!0),this.element){var e=this.element.videoWidth,t=this.element.videoHeight;e&&t&&this.setState({videoWidth:e,videoHeight:t})}},t.prototype.onPlaceholder=function(){},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.clearIdleFrame()},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),this.removeMediaEvents(),this.element&&this.element.parentElement&&this.element.parentElement.removeChild(this.element)},(0,n.gn)([o.Fl],t.prototype,"aspectRatio",null),(0,n.gn)([i.ZP],t.prototype,"leavePlayerEndedHandler",null),(0,n.gn)([i.ZP],t.prototype,"onLoadStart",null),(0,n.gn)([i.ZP],t.prototype,"onLoadedmetadata",null),(0,n.gn)([i.ZP],t.prototype,"onLoadedData",null),(0,n.gn)([i.ZP],t.prototype,"onCanplay",null),(0,n.gn)([i.ZP],t.prototype,"onError",null),(0,n.gn)([i.ZP],t.prototype,"onAbort",null),(0,n.gn)([i.ZP],t.prototype,"onEmptied",null),(0,n.gn)([i.ZP],t.prototype,"onSeeking",null),(0,n.gn)([i.ZP],t.prototype,"onSeeked",null),(0,n.gn)([i.ZP],t.prototype,"onStalled",null),(0,n.gn)([i.ZP],t.prototype,"onProgress",null),(0,n.gn)([i.ZP],t.prototype,"onSuspend",null),(0,n.gn)([i.ZP],t.prototype,"onTimeUpdate",null),(0,n.gn)([i.ZP],t.prototype,"onRateChange",null),(0,n.gn)([i.ZP],t.prototype,"onVolumeChange",null),(0,n.gn)([i.ZP],t.prototype,"onDurationChange",null),(0,n.gn)([i.ZP],t.prototype,"onWasmPlayerFallback",null),(0,n.gn)([i.ZP],t.prototype,"onEnded",null),(0,n.gn)([i.ZP],t.prototype,"onPlay",null),(0,n.gn)([i.ZP],t.prototype,"onPause",null),(0,n.gn)([i.ZP],t.prototype,"onResize",null),(0,n.gn)([i.ZP],t.prototype,"onPlaceholder",null),t}(d),P=0,D=1,O=!0,I=!1,C=!0,N="CURRENT_QUALITY",k="CURRENT_BLACKGAP",L="bilibili_player_codec_prefer_type",x="bilibili_player_gpu_renderer",M=r(35878),F=r(63653),U=r(93759),B=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{loop:!1,muted:!1,mirror:!1,lightOff:!1,autoplay:O,hideBlackGap:!I,volume:D,playbackRate:1,aspectRatio:"0:0",codecTyp,configurable:!0}),t.prototype.getRealVolume=function(){return this.state.muted?0:this.state.volume},t.prototype.onStateCreated=function(){e.prototype.onStateCreated.call(this),this.rootPlayer.hasFeature("blackGap")?this.setState({hideBlackGap:this.localStore.get().media.hideBlackGap}):this.setState({hideBlackGap:!0}),this.setState({codecType:this.getLocalCodecType()})},t.prototype.onMount=function(){e.prototype.onMount.call(this),this.addReactions()},t.prototype.onMounted=function(){e.prototype.onMounted.call(this);var t=this.localStore.get().media;this.setVolume(t.volume),this.setAutoplay(t.autoplay),this.setHandoff(t.handoff),this.setOpEd(t.opEd)},t.prototype.setBlackGapCookie=function(e){var t=String(+!this.state.hideBlackGap);(e||M.get(k)!==t)&&M.set(k,t)},t.prototype.addReactions=function(){var e=this;this.dc.loopAndEnded=(0,o.U5)((function(){return e.state.loop}),(function(t){t?e.mediaStore.setState({ended:!1}):e.mediaStore.setState({ended:e.portStore.isEnded(!0)}),e.rootPlayer.emit(a.t.Player_LoopChange,new CustomEvent(a.t.Player_LoopChange))})),this.dc.mirror=(0,o.U5)((function(){return e.state.mirror}),(function(t){e.rootPlayer.emit(a.t.Player_MirrorChange,new CustomEvent(a.t.Player_MirrorChange))})),this.dc.aspectRatio=(0,o.U5)((function(){return e.state.aspectRatio}),(function(t){e.uiStore.resize(!1,!1),e.rootPlayer.emit(a.t.Player_AspectRatioChange,new CustomEvent(a.t.Player_AspectRatioChange))})),this.dc.lightOff=(0,o.U5)((function(){return e.state.lightOff}),(function(t){e.rootPlayer.emit(a.t.Player_LightOffChange,new CustomEvent(a.t.Player_LightOffChange))})),this.dc.hideBlackGap=(0,o.U5)((function(){return e.state.hideBlackGap}),(function(t){e.uiStore.resize(!1,!1),e.localStore.set({media:{hideBlackGap:t}}),e.setBlackGapCookie(!0),e.rootPlayer.emit(a.t.Player_BlackGapChange,new CustomEvent(a.t.Player_BlackGapChange,{detail:{blackGap:!t,mainScreen:e.uiStore.state.mainScreen,sideScreen:e.uiStore.state.sideScreen,screenKind:e.portStore.getScreenKind()}}))})),this.dc.autoplay=(0,o.U5)((function(){return e.state.autoplay}),(function(t){e.localStore.set({media:{autoplay:t}}),e.rootPlayer.emit(a.t.Player_AutoplayChange,new CustomEvent(a.t.Player_AutoplayChange))})),this.dc.handoff=(0,o.U5)((function(){return e.state.handoff}),(function(t){e.localStore.set({media:{handoff:t}}),e.rootPlayer.emit(a.t.Player_HandoffChange,new CustomEvent(a.t.Player_HandoffChange))})),this.dc.codecType=(0,o.U5)((function(){return e.state.codecType}),(function(t){e.setLocalCodecType(t),e.rootPlayer.emit(a.t.Player_PreferCodecChange,new CustomEvent(a.t.Player_PreferCodecChange))})),this.dc.opEd=(0,o.U5)((function(){return e.state.opEd}),(function(t){e.localStore.set({media:{opEd:t}}),e.rootPlayer.emit(a.t.Player_OpEdChange,new CustomEvent(a.t.Player_OpEdChange))})),this.dc.volume=(0,o.U5)((function(){return e.state.volume}),(function(t){t?e.localStore.set({media:{volume:t,nonzeroVol:t}}):e.localStore.set({media:{volume:t}})}))},t.prototype.getLocalCodecType=function(){var e=+(0,F.tv)(L);switch(e){case 0:case 1:case 2:case 3:return e;default:return 0}},t.prototype.setLocalCodecType=function(e){(0,F.co)(L,String(e))},t.prototype.setLoop=function(e,t){this.setState({loop:!!e})},t.prototype.getLoop=function(){return this.state.loop},t.prototype.setMuted=function(e,t,r){
if(this.mediaStore.video.muted=!!e,t){var n=this.mediaStore.video;n.volume=e?0:this.localStore.get().media.nonzeroVol}},t.prototype.getMuted=function(){return this.mediaStore.video.muted},t.prototype.setVolume=function(e,t,r){var n=this.mediaStore.video;t&&n.muted&&this.setMuted(!1,!1,r),n.volume=(0,U.Z)(e,0,1),this.setState({muted:n.muted,volume:_(n.volume)})},t.prototype.getVolume=function(){return this.mediaStore.video.volume},t.prototype.setPlaybackRate=function(e,t){var r=(0,U.Z)(e,.25,4);this.mediultPlaybackRate=r},t.prototype.getPlaybackRate=function(){return this.mediaStore.video.playbackRate},t.prototype.setMirror=function(e,t){this.setState({mirror:!!e})},t.prototype.getMirror=function(){return this.state.mirror},t.prototype.setAspectRatio=function(e,t){"string"==typeof e&&/^\d+(\.\d+)?:\d+(\.\d+)?$/.test(e)?this.setState({aspectRatio:e}):console.error("Illegal argument")},t.prototype.getAspectRatio=function(){return this.state.aspectRatio},t.prototype.setLightOff=function(e,t){this.rootPlayer.isEmbed||this.setState({lightOff:!!e})},t.prototype.getLightOff=function(){return this.state.lightOff},t.prototype.setBlackGap=function(e,this.setState({hideBlackGap:!e})},t.prototype.getBlackGap=function(){return!this.state.hideBlackGap},t.prototype.setAutoplay=function(e,t){this.setState({autoplay:!!e})},t.prototype.getAutoplay=function(){return this.state.autoplay},t.prototype.setOpEd=function(e,t){this.setState({opEd:!!e})},t.prototype.getOpEd=function(){return this.state.opEd},t.prototype.setHandoff=function(e,t){switch(e){case f.ty.Auto:case f.ty.Delay:case f.ty.Abort:this.setState({handoff:e});break;default:console.error("Illegal argument")}},t.prototype.getHandoff=function(){return this.state.handoff},t.prototype.setPreferCodec=function(e){switch(e){case 0:case 1:case 2:case 3:this.setState({codecType:e});break;default:console.error("Illegal argument")}},t.prototype.getPreferCodec=function(){return this.state.codecType},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,{muted:1,lightOff:laybackRate:1,codecType:1,handoff:1,opEd:1})},t}(d),j=r(90787);funct=l.charAt(f-1);)f--;return l.slice(d,f).split("\0").map(s).join(c)}(e,(0,n.pi)({delimiter:"."},t))}var K="__NANO_GLOBAL_THEME__";function Y(e){if(!e)return!1;if(document[K])return!1;var t=[];if(Object.keys(e).filter((function(r){var i,o;"string"==typeof r&&/^bpx.+/i.test(r)&&"string"==typeof e[r]&&t.push([(i=r,void 0===o&&(o={}),W(i,(0,n.pi)({delimiter:"-"},o))),e[r]])})),!t.length)return!1;var r=t.reduce((function(e,t){return e+"--".concat(t[0],": ").concat(t[1],";")}),""),i=document.createElement("style");return i.setAttribute("data-injector","nano"),i.setAttribute("data-function","theme"),i.textContent="html { ".concat(r," }"),document.head.appendChild(i),document[K]=!0,!0}var Q=r(98680),z="__NANO_UNIQUE_IDENTIFIER__";function Z(){return("number"!=typeof document[z]||isNaN(document[z]))&&(document[z]=0),++document[z]}var J=r(51797),X=r(60428),$=r.n(X),ee=r(1326),te=r(83434),re=r(37260);var ne=function(e){return(0,re.nableAV1:e.enableAV1,enableWMP:e.enableWMP,featureList:e.featureList,revision:e.revision,iid:e.iid}}function ce(e){return{kind:e.kind,aid:e.aid,cid:e.cid,bvid:e.bvid,seasonId:e.seasonId,episodeId:e.episodeId,p:e.p,t:e.t,fromDid:e.fromDid,replyDid:e.replyDid,stats:e.stats,seasonType:e.seasonType,httpQuery:e.httpQuery,controlsList:e.controlsList,autoplay:e.autoplay,hasPrev:e.hasPrev,hasNext:e.hasNext,localUrl:e.localUrl,poster:e.poster,extraEPInfo:e.extraEPInfo}}var le=r(75335),de=6e4,fe=10,pe=2e3,he=[];function ye(e,t){if(function(e){if(e){var t=Date.now()-e.timeStamp>pe,r=e.periodCount<fe;if(t&&r)return!0}return!1}(e)){if(e&&t){var r=Date.now(),n=r-e.periodTime>de;try{e.data=Object.assign(e.data,JSON.parse(t)),e.timeStamp=r}catch(e){}n?(e.periodTime=r,e.periodCount=0):e.periodCount+=1}}else console.warn("[StorageCache]","Trigger perf bottleneck")}function me(e){var t,r;if(e)try{for(var i=(0,n.XA)(he),o=i.next();!o.done;o=i.next()){var a=o.value,s=e.storageArea&&e.storageArea===a.storage,u=e.key&&e.key===a.storageKey;if(s&&u){ye(a,e.newValue);break}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}function ge(e,t){var r=function(e,t){var r,i;try{for(var o=(0,n.XA)(he),a=o.next();!a.done;a=o.next()){var s=a.value;if(s&&s.storage===e&&s.storageKey===t)return s}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return null}(e,t)||function(e,t){var r={},n={storage:e,storageKey:t,data:r,timeStamp:0,periodTime:0,periodCount:0};try{Object.assign(r,JSON.parse(e.getItem(t)))}cattener("storage",me),n}(e,t);return r.data}var ve=r(96607);function _e(){return!!M.get("DedeUserID")}var Ee=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="ConfigAtom",r.debug={},r.reload={},r.primary={},r.validKeys=new Set(["p","aid","cid","bvid","seasonId","episodeId"]),r.tmp={},(0,o.rC)(r),(0,o.z)((function(){r.debug=r.rootPlayer.searchParam,r.primary=ue(r.rootPlayer.input)})),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"iScreenKind",{get:function(){var e;return null!==(e=this.primary.screenKind)&&void 0!==e?e:f.dY.Normal},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iAutoplay",{get:function(){return null!=this.debug.autoplay?this.debug.autoplay?1:2:null==this.reload.autoplay?0:this.reload.autoplay?1:2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iMuted",{get:function(){return this.primary.muted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iQuality",{get:function(){return function(e,t){var r,n,i=null,o=null,a=function(){if(!o)try{o=ge(localStorage,e)}catch(e){}return o},s=ve.n.normalize(t),u=0;(null==t||isNaN(s))&&(s=(i=M.get(N))?ve.n.normalize(i)||P:ve.n.normalize(null===(n=null===(r=a())||void 0===r?void 0:r.media)||void 0===n?void 0:n.quality)||P,!_e()&&s>ve.n.gt.login&&(s=P)),s>ve.n.gt.mseSupported&&!(0,j.a)()&&(s=ve.n.gt.mseSupported);try{var c=a();if(c&&c.media){var l=c.media.audioQuality,d=c.media.dolbyAudio;null!=l?u=+l:d&&(u=1)}}catch(e){}return{aq:u,vq:s}}(this.storageKey,this.primary.quality)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iKind",{get:function(){var e;return null!==(e=this.reload.kind)&&void 0!==e?e:f.HR.Ugc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storageKey",{get:function(){return this.primary.storageKey||"bpx_player_profile"},enumerable:!1,configurable:!0}),t.prototype.setReloadConfig=function(){var e,t=(e=this.rootStore).uiStore,r=e.configStore;this.reload=ce(this.rootPlayer.input),t.setState({kind:this.iKind}),null!=this.iAutoplay&&(this.log.i("[InitialPlaybackState]",this.iAutoplay),r.setState({ips:this.iAutoplay}))},t.prototype.fixCompleteId=function(e){var t,r=this,n=(t=this.rootStore).configStore,i=t.httpStore,o=i.getViewKind(),a=function(){r.rootStore.stageAtom.set(2),n.setState({isCompleteIdEnded:!0})};r.rootStore.stageAtom.set(1),o.isFatalError&&r.lo(i.fetchViewInfo(!0).then((function(t){
t&&t.body&&e(t.body),a()})).catch((function(e){le.eV.isCanceled(e)||a()})),n.setState({isRequestId:!0})):(this.log.i(""),a())},t.prototype.cleanSessf(this.rootPlayer.input&&"object"==typeof this.rootPlayer.input){var t=ce({});Object.keys(t).forEach((function(e){t[e]=null}));var r={kind:this.reload.kind,seasonType:this.reloadbject.assign(this.rootPlayer.input,t,r,e)}},t.prototype.resetSessionData=function(){this.tmp.pid=null,thi(){var e=this;this.fixCompleteId((function(t){t&&Object.keys(t).forEach((function(r){e.validKeys.has(r)&&(e.reload[r]=t[r])}))}))},t.prototype.cleanPrefetchData=function(){if(this.debug.no_cache){for(var e in this.rootPlayer.cd)Object.prototype.hasOwnProperty.call(this.rootPlayer.cd,e)&&delete this.rootPlayer.cd[e];return console.warn("Prefetch has been disabled"),!0}return!1},t.prototype.injectGlobalPlayer=function(e){void 0===e&&(e=100);var t=this.debug.ns,r=0;if(t&&isNaN(+t)){for(;null!=window[t]&&!(++r>e);)t=this.debug.ns+r;null==window[t]?(window[t]=this.rootPlayer,this.tmp.name=t,console.log(this.tag,"GlobalPlayerName:",t)):console.warn(this.tag,"Inject Failed")}},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),this.tmp.name&&delete window[this.tmp.name]},(0,n.gn)([o.LO.shallow],t.prototype,"debug",void 0),(0,n.gn)([o.LO.shallow],t.prototype,"reload",void 0),(0,n.gn)([o.LO.shallow],t.prototype,"primary",void 0),(0,n.gn)([o.aD],t.prototype,"setReloadConfig",null),t}(l),be=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="ConfigStore",r.configAtom=new Ee(t),r.tmp.mseSupported=(0,j.a)(),(T.X.iPad.alike||T.X.tesla.alike)&&r.pointingDevice.set(2),Y(r.rootPlayer.theme),r.revision?r.nodes.container.setAttribute("data-revision","".concat(r.revision)):r.nodes.container.removeAttribute("data-revision"),r.isChannel(f.u5.Embedded)||r.isChannel(f.u5.Embedded_White)||r.isChannel(f.u5.Embedded_Other)?r.nodes.container.classList.add("".concat(v.m,"-embedded")):r.nodes.contai),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{ips:0,ctrl:0,isRequestId:!1,isCompleteIdEnded:!1}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storageKey",{get:function(){return this.configAtom.storageKey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iid",{get:function(){return this.tmp.iid||(this.tmp.iid="0",this.primary.iid&&(this.tmp.iid=this.primary.iid.toString())),this.tmp.iid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this.primary.element},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"auxiliary",{get:function(){return this.primary.auxiliary||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mntAuxSender",{get:function(){if(this.primary.mntAuxSender){if("string"==typeof this.primary.mntAuxSender){var e=this.rootStore.nodes.container.querySelector(this.primary.mntAuxSender);return e&&(this.primary.mntAuxSender=e),e}return this.primary.mntAuxSender}return this.rootStore.nodes.controlBottomCenter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mntAuxConfig",{get:function(){return this.primary.mntAuxConfig?this.primary.mntperty(t.prototype,"channelKind",{get:function(){var e;return null!==(e=this.primary.channelKind)&&void 0!==e?e:f.u5.Default},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hideBoxShadow",{get:function(){return!!this.primary.hideBoxShadow},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"errorUrl",{get:function(){return"string"==typeof this.primary.errorUrl?this.primary.errorUrl.replace(/^https?:/,""):"//s1.hdslb.com/bfs/static/player/media/error.mp4"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableHEVC",{get:function(){return!thgurable:!0}),Object.defineProperty(t.prototype,"enableAV1",{get:function(){return!tgurable:!0}),Object.defineProperty(t.prototype,"enableWMP",{get:function(){return },enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"revision",{get:function(){return+this.primary.revision},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ctrl",{get:function(){switch(+this.primary.ctrl){case 0:case 2:case 1:retunnelKind){case f.u5.Embedded:return 1;case f.u5.Embedded_White:return 2;case f.u5.Embedded_Other:return 3;default:return 0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"p",{get:function(){return+this.reload.p||1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"t",{get:function(){return null!=this.ndb.t?(0,Q.o)(this.ndb.t):this.fromDid||null==this.reload.t?null:(0,Q.o)(this.reload.t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"extraEPInfo",{get:function(){return this.reload.extraEPInfo||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"aid",{get:function(){return+this.reload.aid||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cid",{get:function(){return+this.reload.cid||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bvid",{getmerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localUrl",{get:function(){return this.reload.localUrl||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seasonId",{get:function(){return+this.reload.seasonId||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"episodeId",{get:function(){return+this.reload.episodeId||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.reload.stt.defineProperty(t.prototype,"fromDid",{get:function(){return this.reload.replyDid?this.reload.replyDid:this.reload.fromDid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"replyDid",{get:function(){return this.reload.replyDid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"httpQuery",{get:function(){return this.reload.httpQuery?this.reload.httpQuery:this.reload.httpQuery={}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"controlsList",{get:function(){var e=this.reload.controlsList;return se(e)?e:Array.isArray(e)?this.reload.controlsList=new erable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seasonType",{get:function(){return+this.reload.seasonType||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPrev",{get:function(){return null==this.reload.hasPrev?null:!!this.reload.hasPrev},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasNext",{get:function(){return null==thiNext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"poster",{get:function(){return!!this.reload.poster},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tmp",{get:function(){return this.configAtom.tmp},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primary",{get:function(){return this.configAtom.primary},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reload",{get:function(){return this.configAtom.reload},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ndbfigurable:!0}),Object.defineProperty(t.prototype,"pid",{get:function(){return this.tmp.pid||(this.tmp.pid=Z()),this.tmp.pid},enumerable:!1,configurable:!0}),
Object.defineProperty(t.prurn this.tmp.session||(this.tmp.session=$()(t.getRandomString())),this.tmp.session},set:function(e){e&&(this.tmp.session=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mseSupported",{get:function(){return this.tmp.mseSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"invalidGPU",{get:function(){if(this.ndb.no_gpu)return!0;if(null==this.tmp.invalidGPU){var e=(0,F.tv)(x)||"";this.tmp.invalidGPU=/Vulkan/i.test(e)}return this.tmp.invalidGPU},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointingDevice",{get:function(){return this.tmp.pointingDevice||(this.tmp.pointingDevice=new J.d9(3)),this.tmp.pointingDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spmId",{get:function(){return this.stats.spmId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spmIdFrom",{get:function(){return this.stats.spmIdFrom},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bSource",{get:function(){return this.stats.bSource},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"referrer",{get:function(){return"string"==typeof this.stats.referrer?this.stats.referrer:document.referrer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spmIdFromOuter",{get:function(){return this.stats.spmIdFromOuter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"noDanmaku",{get:function(){return thinfigurable:!0}),Object.defineProperty(t.prototype,"onlyTouchMode",{get:function(){return this.pointingDevice.isOnlyAllow(2)},enumerable:!1,configurable:!0}),t.buvid=function(){return M.get("buvid3")},t.getRandomString=function(){return(M.get("buvid3")||Math.floor(1e5*Math.random()).toString(16))+Date.now()},t.prototype.onStateCreated=function(){e.prototype.onStateCreated.call(this),this.configAtom.setReloadConfig();var t=this.configAtom.iQuality;this.log.i("[onStateCreated]",JSON.stringify(t)),this.qualityStore.setState({nowAudio:t.aq,newAudio:t.aq,reqAudio:t.aq,nowQuality:t.vq,newQuality:t.vq,reqQuality:t.vq}),this.auxStore.setState({isListSpread:!!this.mntAuxConfig.isTabListOpen,disableListSwitch:!!this.mntAuxConfig.isUserSwitchingDisabled}),this.portStore.reqStatue(this.configAtom.iScreenKind),null!=this.configAtom.iMuted&&this.settingStore.setMuted(this.configAtom.iMuted),null!=this.ndb.ctrl?this.setState({ctrl:this.ndb.ctrl%2?2:1}):1===this.ctrl&&this.sCommitted.call(tgAtom.injectGlobalPlayer(),this.configAtom.fillStoryId()},t.prototype.has=function(e){return null!=this.rootPlayer.input[e]},t.prototype.remove=function(e){if("cid"===e)this.reload[e]=null},t.prototype.isChannel=function(){for(var e=this,t=[],r=0;ron(t){return t===e.channelKind}))},t.prototype.isManagerCreator=function(){return this.isChannel(f.u5.Creator,f.u5.Manager)},t.prototype.startReloadParser=function(e){this.configAtom.cleanSessionConfig(e),this.configAtom.resetSessionData(),this.configAtom.setReloadConfig()},t.prototype.injectFnVal=function(){var e=ee.x.getFnVal({mseSupported:this.mseSupported,enableHEVC:this.enableHEVC,enableAV1:this.enableAV1});M.set("CURRENT_FNVAL",e.toString())},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,{ctrl:1})},t}(d),Se={fade:!1,scale:!0,fontsize:1,opacity:.4,bilingual:!1,color:"16777215",shadow:"0",position:"bottom-center"};function Te(){return{lastView:0,lastUid:0,media:{quality:P,volume:D,nonzeroVol:D,hideBlackGap:!I,dolbyAudio:!1,audioQuality:null,autoplay:O,handoff:f.ty.Auto,seniorTip:!0,opEd:C},dmSend:{upDm:!1,dmChecked:!0},blockList:[],dmSetting:{status:!0,dmSwitch:!0,aiSwitch:!0,aiLevel:3,preventshade:!1,dmask:!0,typeTop:!0,typeScroll:!0,typeBottom:!0,typeColor:!0,typeSpecial:!0,opacity:.8,dmarea:50,speedplus:1,fontsize:1,fullscreensync:!0,speedSync:!1,fontfamily:T.X.linux.alike?"'Noto Sans CJK SC DemiLight'":"SimHei, 'Microsoft JhengHei'",bold:!T.X.iOS.alike,fontborder:0,seniorModeSwitch:0},basEditorData:{},audioEffect:null,boceTimes:[],interaction:{rookieGuide:null,showedDialog:!1},iswide:null,widesave:null,subtitle:Se,progress:{precisionGuide:r(74534);var De=fun)&&(0,Pe.Z)(r)&r(57651).Z)((function(e,t,r,n){(0,Re.Z)(e,t,r,n)})),Ie=(0,Ae.Z)((function(e){return e.push(void 0,De),(0,we.Z)(Oe,void 0,e)})),Ce=function(){function e(e){var t=this;this.rootStore=e,this.isLoaded=!1,this.hasPendingSet=!1,this.rootPlayer=e.rootPlayer,this.rootPlayer.once(s.p.PLAYER_STORAGE_BUILD,(function(){return t.onStorageBuild()})).once(s.p.PLAYER_LOADED,(function(){return t.onLoaded()}))}return Object.defineProperty(e.prototype,"localData",{get:function(){if(null==this.cachedLocalData){var e=ge(this.storage,this.storageKey);this.cachedLocalData=Ie(e,this.defProfile)}return this.cachedLocalData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"log",{get:function(){if(!this._cachedLog){var e=this.rootPlayer.log;this._cachedLog=this.tag?e.getLogger(this.tag):e}return this._cachedLog},enumerable:!1,configurable:!0}),e.prototype.onStorageBuild=function(){try{this.setStorageArea(),this.storageKey=this.rootSssage)}},e.prototype.onLoaded=funct.setStorageItem())},e.prototype.getSerializedLocalData=function(){return this.localData?JSON.stringify(this.localData):null},e.prototype.setStorageItem=function(){if(!this.isLoaded)return this.hasPendingSet=!0,null;try{return this.storage.setItem(this.storageKey,this.getSerializedLocalData()),!0}catch(e){return this.log.w(e&&e.message,e&&e.stack),!1}},e.prototype.checkAvailability=function(){try{var e="__storage_test__";this.storage.setItem(e,e);var t=this.storage.getItem(e)===e;return this.storage.removeItem(e),!t&&this.log.i("Storage is disabled"),t}catch(e){var r="An error occurred while detecting Storage",n=this.storage&&0!==this.storage.length;return e?this.log.w(r,e.code,e.name,e.message):this.log.w(r),e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&n}},e.prototype.get=function(e){var t={},r==e)Object.assign(t,r);else if("string"==typeof e||Array.isArray(e)){(Array.isArray(e)?e:[e]).forEach((function(e){t[e]=r[e]}))}else Object.keys(e).forEach((function(n){var i=r[n];null!=i?t[n]=i:e.hasOwnProperty(n)&&(t[n]=e[n])}));return t},e.prototype.set=function(e,t){var r=this;return Object.keys(e).forEach((function(n){t?r.localData[n]=e[n]:r.localData[n]&&"object"==typeof r.localData[n]&&e[n]&&"object"==typeof e[n]?r.localData[n]=Object.assign(r.localData[n],e[n]):r.ltion(e){var t=this;return(Array.isArray(e)?e:[e]).forEach((function(e){t.localData.hasOwnProperty(e)&&delete t.localData[e]})),this.setStorageItem()},e}(),Ne=function(e){function t(){var t=null!==e&&e.app;return t.tag="LocalStore",t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defProfile",{get:function(){return Te()},enumerable:!1,configurable:!0}),t.prototype.setStorageArea=function(){this.storage=window.localStorage},t.prototype.set=function(t,r){var n=e.prototype.set.call(this,t,r),i=t.media,o={setting_config:{},video_status:{}};if(n&&i&&"object"==typeof i&&Object.keys(i).forEach((function(e){var t=i[e];switch(e){case"quality":o.setting_config.defquality=t;break;case"volume":o.video_status.volume=t;break;case"nonzeroVol":o.video_status.lastVol=t;break;case"autoplay":o.video_status.autoplay=t;break;case"handoff":o.video_status.playtype=2===t?2:1;break
;case"hideBlackGap":o.video_status.blackside_state=!t,M.set("blackside_state",String(+!t))}})),Object.keys(o.setting_config).length+Object.keys(o.video_status).length){var a="bilibili_player_settings";try{var s=JSON.parse(localStorage.getItem(a));if(!s)return;s.setting_config&&Object.assign(s.setting_config,o.setting_config),s.video_status&&Object.assign(s.video_status,o.video_status),localStorage.setItem(a,JSON.stringify(s))}catch(e){}}return n},t}(Ce);var ke=function(e){function t(){var t=null!==e&&e.apply="SessionStore",t}return(0,n.ZT)(t,e),Object.definePropertyn{interaction:{}}},enumerable:!1,configurable:!0}),t.prototype.setStorageArea=function(){this.storage=window.sessionStorage},t}(Ce);var Le=r(78384),xe=r(62344),Me=r(19062),Fe=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="User0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{isUserPrepared:!1}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isInteraction",{get:function(){return this.info?!!this.info.interaction:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSuperUser",{get:function(){return!(!this.info||this.info.err)&&!(0===this.info.vipType||1!==this.info.vipStatus)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLogin",{get:function(){return this.info&&!this.info.err?!!this.info.mid:_e()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChargingExlusive",{get:function(){var e,t;return!(!(null===(e=this.info)||void 0===e?void 0:e.is_upower_exclusive)||!(null===(t=this.info)||void 0===t?void 0:t.is_upower_play))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disableShowUpInfo",{get:function(){var e;return!!(null===(e=this.info)||void 0t.prototype,"needLoginSubtitle",{get:function(){var e;return!!(null===(e=this.info)||void 0===e?void 0:e.needLoginSubtitle)},enumerable:!1,configurable:!0}),t.prototype.setUserInfo=function(e){e&&(this.setLevel(e),this.setVIPInfo(e),this.setMemberRole(e),this.setDMPermission(e),this.setViewPoints(e)),this.info=e},t.prototype.onPrepared=function(){e.prototype.onPrepared.call(this),this.fetchUserDetails().catch(Me.Z)},t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.dc.infoChanged=(0,o.U5)((function(){return t.info}),(isLoadEnded=(0,o.gx)((function(){return t.rootStore.isLoadEnded}),(function(){return t.rootPlayer.emit(s.p.PLAYER_LOADED,e)})))}))},t.prototype.reloadAccess=function(){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(e){switch(e.label){case 0:return this.log.i("[reloadAccess]"),[4,this.fetchUserDetails()];case 1:return e.sent(),[2]}}))}))},t.prototype.tryDelayUserResolved=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t,r=this;return(0,n.Jh)(this,(function(n){return this.configStore.isChannel(f.u5.Homepage)||this.configStore.isChannel(f.u5.Homepage_Topic)?(e=(0,o.gx)((function(){return r.rootStore.isLoadEnded})),this.dp.delayUserResolved&&this.dp.delayUserResolved(),this.dp.delayUserResolved=function(){return e.cancel()},[2,e]):(t=(0,o.gx)((function(){return!!r.mediaStore.state.firstIdleFrame||r.rootStore.isLoadEnded})),this.dp.delayUserResolved2&&this.dp.delayUserResolved2(),this.dp.delayUserResolved2=function(){return t.cancel()},[2,t])}))}))},t.prototype.fetchUserDetails=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t,r=this;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return e=(0,o.gx)((function(){return r.rootStore.isPrepared})),this.dp.isPrepared&&this.dp.isPrepared(),this.dp.isPrepared=function(){return e.cancel()},[4,e];case 1:return n.sent(),t=this.httpStore.fetchUserInfo(!1),[4,this.tryDelayUserResolved()];case 2:return n.sent(),[2,new Promise((function(e,n){t.then((function(t){var n=t.body,i=t.response;if(0===i.data.code)return r.setUserInfo(n),r.setState({isUserPrepared:!0}),void e(n);r.setUserInfo({err:new Error("Unknown error")}),r.setState({isUserPrepared:!0}),r.errorStore.err(1,1103,"form error,url:".concat(i.config.url))})).catch((function(e){if(!xe.Z.isCancel(e)){var t=e&&e.response&&e.response.status,i=e&&e.config&&e.config.url;r.setUserInfo({err:e||new Error("Unknown error")}),r.setState({isUserPrepared:!0}),r.errorStore.err(1,1101,"status:".concat(t,",url:").concat(i)),n(e)}}))}))]}}))}))},t.prototype.requestQuickLogin=function(e){this.requestQuickLoginPromise(e).catch(Me.Z)},t.prototype.requestQuickLoginPromise=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){if(T.X.mobile.alike&&!T.X.iPad.alike)throw this.rootStore.parent.location.href="https://passport.bilibili.com/login",new Error("Redirect to login page");return this.uiStore.isFullView&&this.portStore.reqStatue(null),[2,this.getQuickLoginScript("MiniLogin","https://s1.hdslb.com/bfs/seed/jinkela/short/mini-login/miniLogin.umrent.MiniLogin(e?{customTitle:e}:s",a)(){o(),queueMicrotask((function(){t.fetchUserDetails().then(r).catch(n)}))},s=function(){o(),n(new Error("User cancelled"))};i.showComponent(),i.addEventListener("success",a),i.addEventListener("cancel",s)}))})).then((function(){t.rootPlayer.emit(a.t.Player_Access_Changed,new CustomEvent(a.t.Player_Access_Changed))})).catch((function(e){return t.log.w(e&&e.message),Promise.reject(e)}))]}))}))},t.prototype.getQuickLoginScript=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(r){return this.rootStore.parent[e]?[2]:[2,(n=t,i=this.rootStore.parent,void 0===i&&(i=window),new Promise((function(e,t){var r=i.document.createElement("script");r.onload=e,r.onerror=t,r.type="text/javascript",r.async=!0,r.crossOrigin="anonymous",r.src=n,i.document.head.appendChild(r)})))];var n,i}))}))},t.prototype.setLevel=function(e){var t;if(e.err)e.level=this.defLoginLevel;else{var r=null===(t=e.levelInfo)||void 0===t?void 0:t.current_level;null==r?e.mid?e.level=this.defLoginLevel:e.level=null:e.level=+r}},t.prototype.setVIPInfo=function(e){this.configStore.isChannel(f.u5.Manager)&&(e.vipType=2,e.vipStatus=1)},t.prototype.setMemberRole=function(e){if(e.err)_e()?e.memberRole=Le.Rs.USER_NORMAL:e.memberRole=Le.Rs.USER_LOGOUT;else if(e.mid)if("string"==typeof e.permission){var t=e.permission.split(",");0===t.length||-1!==t.indexOf("9999")?e.memberRole=Le.Rs.USER_LIMITED:-1!==t.indexOf("5000")?e.memberRole=Le.Rs.USER_REGISTERED:-1!==t.indexOf("20000")?e.memberRole=Le.Rs.USER_ADVANCED:-1!==t.indexOf("32000")||-1!==t.indexOf("31300")?(e.memberRole=Le.Rs.USER_ADVANCED,e.isSystemAdmin=!0):-1!==t.indexOf("30000")||-1!==t.indexOf("25000")?e.memberRole=Le.Rs.USER_VIP:e.memberRole=Le.Rs.USER_NORMAL}else e.memberRole=Le.Rs.USER_NORMAL;else e.memberRole=Le.Rs.USER_LOGOUT},t.prototype.setDMPermission=function(e){var t,r,n=e.level,i={pool:Le.Rs.SEND_POOL_NORMAL,mode:Le.Rs.SEND_MODE_LOGOUT,color:Le.Rs.SEND_COLOR_LOGOUT,input:Le.Rs.SEND_INPUT_LOGOUT,fontsize:Le.Rs.SEND_FONT_SIZE_LOGOUT,initStatus:Le.Rs.SEND_STATUS_NORMAL};switch((e.isOwner||e.isSystemAdmin)&&(i.pool=Le.Rs.SEND_POOL_ADMIN,r=Le.Rs.SEND_FONT_SIZE_ADMIN),e.memberRole){case Le.Rs.USER_LIMITED:i.fontsize=Le.Rs.SEND_FONT_SIZE_LIMITED,i.mode=Le.Rs.SEND_MODE_LIMITED,i.initStatus=Le.Rs.SEND_STATUS_LIMITED,i.input=Le.Rs.SEND_INPUT_LIMITED;break;case Le.Rs.USER_REGISTERED:i.fontsize=Le.Rs.SEND_FONT_SIZE_REGISTERED,i.mode=Le.Rs.SEND_MODE_REGISTERED,i.input=Le.Rs.SEND_INPUT_REGISTERED;break;case Le.Rs.USER_NORMAL:i.fontsize=Le.Rs.SEND_FONT_SIZE_NORMAL,i.mode=Le.Rs.SEND_MODE_NORMAL,i.input=Le.Rs.SEND_INPUT_NORMAL;break;case Le.Rs.USER_VIP:i.pool=Le.Rs.SEND_POOL_ADMIN,i.fontsize=Le.Rs.SEND_FONT_SIZE_VIP,i.mode=Le.Rs.SEND_MODE_VIP,i.input=Le.Rs.SEND_INPUT_VIP;break
;case Le.Rs.USER_ADVANCED:i.pool=Le.Rs.SEND_POOL_ADMIN,i.fontsize=Le.Rs.SEND_FONT_SIZE_ADVANCED,i.mode=Le.Rs.SEND_MODE_ADVANCED,i.input=Le.Rs.SEND_INPUT_ADVANCED;case Le.Rs.USER_LOGOUT:}switch(!0){case 0===n:t=Le.Rs.SEND_MODE_LEVEL_LOW,i.color=Le.Rs.SEND_COLOR_LEVEL_LOW,i.initStatus=Le.Rs.SEND_STATUS_LEVEL_LOW;break;case 1===n:t=Le.Rs.SEND_MODE_LEVEL_LOW,i.color=Le.Rs.SEND_COLOR_LEVEL_LOW;break;case 2===n:t=Le.Rs.SEND_MODE_LEVEL_TWO,i.color=Le.Rs.SEND_COLOR_NORMAL;break;case n>=3:t=Le.Rs.SEND_MODE_LEVEL_NORMAL,i.color=Le.Rs.SEND_COLOR_NORMAL}e.blockTime>0&&(i.initStatus=Le.Rs.SEND_STATUS_BLOCKING),e.blockTime<0&&(i.initStatus=Le.Rs.SEND_STATUS_BLOCKED),2===e.pugvSeasonStatus&&1===e.pugvPayStatus&&(i.initStatus=Le.Rs.SEND_STATUS_CANNOT_BUY),2!==e.answerStatus||n||(i.initStatus=Le.Rs.SEND_ANSWER_STATUS_IN),e.err||e.mid||(i.color=Le.Rs.SEND_COLOR_LOGOUT,i.initStatus=Le.Rs.SEND_STATUS_LOGOUT),r&&i.fontsize.forEach((function(e,t,n){n[t]=n[t]||r[t]})),t&&i.mode.forEach((function(e,r,n){n[r]=1===t[r]||1===n[r]?1:n[r]})),e.dmRights=i},t.prototype.setViewPoints=function(e){this.configStore.isManagerCreator()&&(e.viewPoints=null)},t.prototype.requestSuperGuide=function(e){this.portStore.pause(),this.uiStore.isFullView&&this.portStore.reqStatue(null),this.rootPlayer.emit(a.t.Player_Virtual_Action,new CustomEvent(a.t.Player_Virtual_Action,{detail:{data:e,kind:f.s.Super_Quality_Guide}}))},t.prototype.requestSuperColorGuide=function(e){this.portStore.pause(),this.uiStore.isFullView&&this.portStore.reqStatue(null),this.rootPlayer.emit(a.t.Player_Virtual_Action,new CustomEvent(a.t.Player_Virtual_Action,{detail:{data:e,kind:f.s.Super_Quality_Guide}}))},(0,n.gn)([o.LO.shallow],t.prototype,"info",void 0),(0,n.gn)([o.aD],t.prototype,"setUserInfo",null),t}(d),Ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpUpMid",t.url="//api.bilibili.com/x/web-interface/relation",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,params:e,withCredentials:!0}).then((function(e){var r;return{body:t.convertResult(null===(r=e.data)||void 0===r?void 0:r.data),response:e}}))]}))}))},t.prototype.convertResult=function(e){var t=(null==e?void 0:e.relation)||{};return{attribute:t.attribute,mid:t.mid,mtime:t.mtime,special:t.special,tag:t.tag}},t}(le.eV),Be=r(35538),je=function(e){function t(){var t=null!==e&&e.apineProperty(t.prototype,"defaultState",{get:function(){e:!0}),t.prototype.o.call(this),this.configStore.embeddedEnv&&this.fetchUpInfo()},t.prototype.onMount=function(){e.prototype.onMount.call(this)},t.prototype.getRelation=function(e){return new Ue(this.rootPlayer).r({mid:e})},t.prototype.upFollow=function(e,t){return new Be.YR(this.rootPlayer).r({act:t?2:1,fid:e,re_src:245})},t.prototype.fetchUpInfo=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t=this;return(0,n.Jh)(this,(function(r){switch(r.label){case 0:return e=(0,o.gx)((function(){return t.rootStore.isPrepared})),this.dp.isPrepared&&this.dp.isPrepared(),this.dp.isPrepared=function(){return e.cancel()},[4,e];case 1:return r.sent(),[2,this.httpStore.fetchVideoDetail(!0).then((function(e){var r=e.body;t.setState((0,n.pi)({},r.up))})).catch((function(e){if(!xe.Z.isCancel(e))return Promise.reject(e)}))]}}))}))},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,{name:1,mid:1,face:1,follow:1,fans:1})},t}(d);function Ve(){return window.performance&&"function"==typeof window.performance.now?window.performance.now():Date.now()}function He(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n="",i=0;i<t.length;i++){var o=t[i],a="";if(null!=o)if("string"==typeof o)a=o;else if("[object Object]"===Object.prototype.toString.call(o))try{a=JSON.stringify(o)}catch(e){}else if("string"==typeof o.message)a=o.message;else try{a=o.toString()}catch(e){}n+=e[i],n+=a}return n+=e[e.length-1]}function Ge(e,t,r){var n=null,i=null,o=document.createElement("canvas"),a=o.getContext("2d");return t&&(n=Math.floor(t)),r&&(i=Math.floor(r)),n&&!i&&(i=Math.floor(t/e.videoWidth*e.videoHeight)),!n&&i&&(n=Math.floor(r/e.videoHeight*e.videoWidth)),n||(n=Math.floor(e.videoWidth)),i||(i=Math.floor(e.videoHeight)),o.width=n,o.height=i,e&&"BWP-VIDEO"===e.tagName?a.drawImage(null==e?void 0:e.getRenderCanvas(),0,0,n,i):a.drawImage(e,0,0,n,i),o}var qe,We,Ke,Ye,Qe=r(51454),ze={mode:"production",name:"nano",version:"4.7.4",revision:"ea85bb55",lastCompiled:"2023-11-14T14:25:26+08:00"},Ze=r(61273),Je=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpNow",t.url="//api.bilibili.com/x/click-interface/click/now",t}return(0,n.ZT)(t,e),t.prototype.r=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e=this;return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,withCredentials:!0}).then((function(t){var r=t.data,n=Math.floor(Date.now()/1e3)null!==e&&e.apply(this,arguments)||this;return t.tag="PortStore",t.cachedNow=0,t.cachedNowTimeStamp=0,t.seekDeferred=null,t}return(0,n.ZT)(t,e),Object.defineProperty(t.urable:!0}),Object.defineProperty(t.prototype,"rid",{get:function(){return this.metadata.version+"-"+this.metadata.revision},enumerable:!1,configurable:!0}),t.prototype.getRemoteNow=function(e){return void 0===e&&(e=600),(0,n.mG)(this,void 0,void 0,(function(){var t,r;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return t=Ve()-this.cachedNowTimeStamp,this.cachedNow&&this.cachedNowTimeStamp>0&&t<1e3*e?[2,this.cachedNow+Math.floor(t/1e3)]:[3,1];case 1:return n.trys.push([1,3,,4]),[4,new Je(this.rootPlayer,{noStore:!0,memCache:!1,persistent:!0}).r()];case 2:return r=n.sent(),this.cachedNow=r.now,this.cachedNowTimeStamp=Ve(),[2,this.cachedNow];case 3:return n.sent(),[2,Math.floor(Date.now()/1e3)];case 4:return[2]}}))}))},t.prototype.getScreenKind=function(e){var t=this.uiSnull!=r?r:t},t.prototype.getPlayUrl=function(){return this.kernelStore.baseAgent?this.kernelStore.baseAgent.getPlayUrl():""},t.prototype.hasFocus=function(){return!!this.nodes.container.contains(document.activeElement)||this.ctrlStore.state.containerFocus},t.prototype.hasEditableFocus=function(){var e=[this.rootStore.window.document];if(this.rootStore.isEmbedSOP)try{e.push(this.rootStore.parent.document)}catch(e){}return e.some((function(e){if(e.activeElement){switch(e.activeElement.tagName){case"INPUT":switch(e.activeElement.type){case"button":case"reset":case"submit":case"hidden":case"radio":case"checkbox":case"image":case"file":case"range":return!1;default:return!0}case"TEXTAREA":return!0}if(e.activeElement.isContentEditable)return!0}return!1}))},t.prototype.seekAutoplay=function(e,t){var r=this;this.seek(e,{initiator:t?"".concat(t,":Seek"):t}).then((function(){return r.play({initiator:t?"".concat(t,":Autoplay"):t})})).catch((function(e){return r.log.w("[seekAutoplay]",He(qe||(qe=(0,n.cy)(["",""],["",""])),e))}))},t.prototype.reqStatue=function(e,t,r){this.statueStore.requestStatue(e,t,r).catch(Me.Z)},t.prototype.isEnded=function(e){return(e||!this.settingStore.state.loop)&&this.mediaStore.video.ended},t.prototype.isPaused=function(){retaStore.video.seeking},t.prototype.isMuted=function(){return this.settingStore.getMuted()||0===this.settingStore.getVolume()},t.prototype.getManifest=function(){return{p:this.configStore.p,aid:this.configStore.aid,cid:this.configStore.cid,pid:this.configStore.pid,bvid:this.configStore.bvid,seasonId:this.configStore.seasonId,episodeId:this.configStore.episodeId,kind:this.uiStore.kind,
screenKind:this.getScreenKind(),channelKind:this.configStore.channelKind,seasonType:this.configStore.seasonType,hasPrev:this.episodeStore.state.hasPrev,hasNext:this.episodeStore.state.hasNext,hasPipFn:this.statueStore.hasPipFn,hasFullscreenFn:this.statueStore.hasFullscreenFn,referrer:this.episodeStore.state.referrer}},t.prototype.getStates=function(){return{initError:this.errorStore.state.initError,pipEnabled:this.statueStore.pipEnabled,fullscreenEnabled:this.statueStore.fullscreenEnabled,majorCtrlHidden:this.ctrlStore.isCtrlHidden(),mainScreen:this.uiStore.state.mainScreen,sideScreen:this.uiStore.state.sideScreen}},t.prototype.getMediaInfo=function(){return{playUrl:this.getPlayUrl(),absolutePlayTime:this.metricStore.getAbsolutePlayTime(),relativePlayTime:this.metricStore.getRelativePlayTime(),videoWidth:this.mediaStore.video.videoWidth,videoHeight:this.mediaStore.video.videoHeight}},t.prototype.getUserInfo=function(){var e;return{mid:(null===(e=this.userStore.info)||void 0===e?void 0:e.mid)||null}},t.prototype.getUserParams=function(){return(0,Ze.Z)({},{input:this.rootPlayer.input,theme:this.rootPlayer.theme,prefetch:this.rootPlayer.cd})},t.prototype.getElements=function(){var e=this.rootStore.nodes;return{container:e.container,videoArea:e.videoArea,controlWrap:e.controlWrap,topTitle:e.topTitle,topFollow:e.topFollow,subtitle:e.subtitleWrap,endingPanel:e.endingPanel}},t.prototype.getSupportedQualityList=function(e){var t=this.mpdStore.body,r=null==t?void 0:t.mediaDataSource,n=(null==e?void 0:e.formats)||(null==t?void 0:t.supportFormats);return Array.isArray(n)?r&&"dash"===r.type?$e().getSupportedVideoIdList(n,e):n.map((function(e){return e.quality})):null},t.prototype.canPlayType=function(e){var t,r,i;if("string"!=typeof e)return null;if(this.errorStore.state.disableNonDAQ&&/^(FLAC|EC3DolbyATMOS)$/i.test(e))return!1;var o={},a=0;"HEVC_HDR10"===e?a=125:"HEVC_DolbyVision"===e&&(a=126);var s=null===(i=this.mpdStore.body)||void 0===i?void 0:i.supportFormats.filter((function(e){return e.quality===a}));a&&s&&s[0]&&s[0].codecs&&(o.codec=s[0].codecs[0]||"");try{for(var u=(0,n.XA)([{key:"HEVC",prop:"isHEVCTypeSupported"},{key:"HEVC_HDR10",prop:"isHEVCHDR10TypeSupported"},{key:"HEVC_DolbyVision",prop:"isHEVCDolbyVisionTypeSupported"},{key:"EC3DolbyATMOS",prop:"isEC3DolbyATMOSTypeSupported"},{key:"HEVC_8K",prop:"isHEVC8kTypeSupported"},{key:"AV1",prop:"isAV1TypeSupported"},{key:"FLAC",prop:"isFLACTypeSupported"}]),c=u.next();!c.done;c=u.next()){var l=c.value;try{if(new RegExp("^".concat(l.key,"$"),"i").test(e)&&"function"==typeof $e()[l.prop])return $e()[l.prop](o)}catch(e){}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return null},t.prototype.readFrameAsBlob=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t,r;return(0,n.Jh)(this,(function(n){return t=Object.assign({},e),r=Ge(this.mediaStore.video,t.width,t.height),[2,new Promise((function(e,t){try{r.toBlob(e,"image/jpeg",.8)}catch(e){t(e)}}))]}))}))},t.prototype.readFrameAsDataURL=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t;return(0,n.Jh)(this,(function(r){return t=Object.assign({},e),[2,Ge(this.mediaStore.video,t.width,t.height).toDataURL("image/jpeg",.8)]}))}))},t.prototype.getCurrentTime=function(){var e=this.mediaStore.video,t=this.mediaStore.state.currentTime;return isNaN(e.duration)?t:this.mediaStore.video.currentTime},t.prototype.getDuration=function(e){var t=this.mediaStore.video,r=this.mpdStore.state.suspectDuration,n=this.mediaStore.state.duration;return e?isNaN(t.duration)?n+r:t.duration+r:isNaN(t.duration)?n:t.duration},t.prototype.seek=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){var r,i,s,u,c,l=this;return(0,n.Jh)(this,(function(d){switch(d.label){case 0:if(r=this.rootPlayer.disabled.seek||this.rootPlayer.hasFeature("noSeek"),this.log.i("[seek]",He(We||(We=(0,n.cy)(["params:",",alt:",",disabled:",""],["params:",",alt:",",disabled:",""])),e,t,r)),i=(null==t?void 0:t.initiator)||null,u=(s="number"==typeof e?{value:e}:e).isOffset?this.getCurrentTime()+s.value:s.value,c=(0,U.Z)(u,0,this.getDuration()-.1),r)throw new Error("Seek Disabled");if(isNaN(c))throw new Error("The provided double value is non-finite");return this.seekDeferred&&(this.seekDeferred=null),this.freeStore.eventAtom.setActionCaller("iSeek",i),this.seekDeferred=this.rootPlayer.addDispose(new Qe.B),this.mediaStore.setState({seekLoad:!0}),this.rootPlayer.emit(a.t.Player_ProgressBar_Change,new CustomEvent(a.t.Player_ProgressBar_Change,{detail:{progressTime:c,initiator:i}})),this.mediaStore.internalSeek(c),this.dp.seekAction&&this.dp.seekAction(),this.dp.seekAction=(0,o.gx)((function(){return!l.mediaStore.state.seeking&&!l.mediaStore.video.seeking}),(function(){return l.seekDeferred.resolve()})),[4,this.seekDeferred.promise];case 1:return d.sent(),null!=s.autoplay?[2,s.autoplay?this.play(t):this.pause(t)]:[2]}}))}))},t.prototype.play=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t,r,i=this;return(0,n.Jh)(this,(function(o){if(t=this.rootPlayer.disabled.play,this.log.i("[play]",He(Ke||(Ke=(0,n.cy)(["alt:",",disabled:",""],["alt:",",disabled:",""])),e,t)),t)throw new Error("Play Disabled");return this.freeStore.eventAtom.setActionCaller("iPlay",(null==e?void 0:e.initiator)||null),(r=b(this.mediaStore.video)).catch((function(e){i.log.w("[play]",e&&e.message),i.freeStore.eventAtom.setActionCaller("iPlay",null)})),[2,r]}))}))},t.prototype.pause=function(e){var t=this.rootPlayer.disabled.pause;if(this.log.i("[pause]",He(Ye||(Ye=(0,n.cy)(["alt:",",disabled:",""],["alt:",",disabled:",""])),e,t)),t)throw new Error("Pause Disabled");return this.freeStore.eventAtom.setActionCaller("iPause",(null==e?void 0:e.initiator)||null),this.mediaStore.video.pause()},t.prototype.attachExtState=function(e){var t=this;Object.keys(e).forEach((function(r){var n=+r;switch(n){case f.s.Follow:t.upStore.setState({follow:e[r]});break;case f.s.UpInfo:t.upStore.setState(e[r]);break;case f.s.Manuscript:t.storyStore.setState(e[r]);break;case f.s.Premiere:t.premiereStore.setState(e[r]);break;case f.s.ThreeBody:t.danmakuStore.setState({threeBody:e[r]});break;default:t.log.w("key(".concat(n,") not implemented"))}}))},t.prototype.fetch=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t,r=this;return(0,n.Jh)(this,(function(i){switch(i.label){case 0:return t=function(){return(0,n.mG)(r,void 0,void 0,(function(){var e=this;return(0,n.Jh)(this,(function(t){switch(t.label){case 0:return this.basicIdPromise=this.basicIdPromise||(0,o.gx)((function(){return e.configStore.state.isCompleteIdEnded})),[4,this.basicIdPromise];case 1:return t.sent(),[2]}}))}))},e===f.qW.M_Lottie?[3,1]:[3,2];case 1:return[3,4];case 2:return[4,t()];case 3:return i.sent(),[3,4];case 4:switch(e){case f.qW.I_PlayUrl:return[3,5];case f.qW.I_UserInfo:return[3,6];case f.qW.I_ViewInfo:return[3,7];case f.qW.I_VideoShot:return[3,8];case f.qW.P_Title:return[3,9];case f.qW.M_Lottie:return[3,11]}return[3,12];case 5:return[2,this.httpStore.fetchPlayUrl(!0).then((function(e){return e.raw}))];case 6:return[2,this.httpStore.fetchUserInfo(!0).then((function(e){return e.response.data}))];case 7:return[2,this.httpStore.fetchViewInfo(!0).then((function(e){return e.response.data}))];case 8:return[2,this.httpStore. e.response.data}))];case 9:return this.titlePromise=this.titlePromise||(0,o.gx)((function(){return null!=r.ctrlStore.title})),[4,this.titlePromise];case 10:return i.sent(),[2,this.ctrlStore.title];case 11:return[2,(0,Le.ql)()];case 12:throw new Error("Not Implemented")}}))}))},t.prototype.getRedirectTime=on-1?e:0},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.basicIdPromise=null,this.titlePromise=null},t}(d),tt=function(e){function t(t){var r=e.call(thisn(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{opened:!1,disabled:!1,backdrop:null}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAnyOpened",{
get:function(){return!this.state.disabled&&(this.shareStore.state.opened||this.state.opened)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectOption",{get:function(){return this.shareStore.state.opened?2:this.state.opened?1:0},enumerable:!1,configurable:!0}),t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this);var r=this.nodes.container.querySelector(".".concat(v.m,"-ending-backdrop"));this.dc.disabled=(0,o.U5)((function(){return t.state.disabled}),(function(e){e&&(t.shareStore.close(),t.close())})),this.dc.endingWrap=(0,o.U5)((function(){hange=(0,o.U5)((function(){return t.selectOption}),(function(e){t.nodes.endingWrap.setAttribute("data-select",e.toString())})),this.dc.backdropChange=(0,o.U5)((function(){return t.state.backdrop}),(function(e){return(0,n.mG)(t,void 0,void 0,(function(){var t,i,o;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return[4,e];case 1:return t=n.sent(),i=t?URL.createObjectURL(t):null,o=i?"url(".concat(i,")"):"none",this.revokeOldBlobURL(),r&&(r.style.backgroundImage=o),i&&(this.oldBlobUrl=i),[2]}}))}))})),this.dc.endPanel=(0,o.U5)((function(){return t.state.opened}),(function(e){queueMicrotask((function(){if(t.rootPlayer.isInitialized){if(t.rootPlayer.hasFeature("noEndingPanel"))return;e?(t.log.i("OpenEndPanel"),t.rootPlayer.emit(a.t.Player_Show_EndPanel,new CustomEvent(a.t.Player_Show_EndPanel))):(t.log.i("CloseEndPanel"),t.rootPlayer.emit(a.t.Player_Hide_EndPanel,new CustomEvent(a.t.Player_Hide_EndPanel)))}}))})),this.rootPlayer.on(a.t.Player_Play,(function(){return t.close()})),this.rootPlayer.on(a.t.Player_Seeking,(function(){return t.close()}))},t.prototype.open=function(){this.state.disabled||this.state.opened||this.setState({opened:!0})},t.prototype.close=function(){this.state.opened&&this.setState({opened:!1})},t.prototype.setBackdrop=function(){this.sta.Z)})},t.prototype.revokeOldBlobURL=function(){this.oldBlobUrl&&(URL.revokeObjectURL(this.oldBlobUrl),this.oldBlobUrl=null)},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.close()},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),this.revokeOldBlobURL()},(0,n0208),nt||e===-1/0?1:0};var ot=function(e){var t=it(e),r=t%1;return t==t?r?t-r:t:0};var at,st,ut=function(e){return"number"==typeof e&&e==ot(e)},ct=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="Episodeerty(t.prototype,"defaultState",{get:function(){return{hasPrev:null,hasNext:null,isRenewal:!1,isSameEpisode:!1,referrer:""}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isFirst",{get:function(){return this.state.isRenewal?1===this.rootStore.ding||2===this.rootStore.ding:1===this.rootStore.ding},enumerable:!1,configurable:!0}),t.prototype.onLoaded=function(t){e.prototype.onLoaded.call(this,t);var r={};null!=this.configStore.hasPrev&&(r.hasPrev=this.configStore.hasPrev),null!=this.configStore.hasNext&&(r.hasNext=this.configStore.hasNext),this.setState(r)},t.prototype.isSameSeason=function(){var e=this.reloadReferrer,t=this.configStore;if(e)if(t.state.isCompleteIdEnded){if(t.seasonId&&e.seasonId)return t.seasonId===e.seasonId;if(t.aid&&e.aid)return t.aid===e.aid;if(t.bvid&&e.bvid)return t.bvid===e.bvid}else this.log.e("Illegal call isSameSeason method");return null},t.prototype.reload=function(e,t,r){return(0,n.mG)(this,void 0,void 0,(function(){var i=this;return(0,n.Jh)(this,(function(u){switch(u.label){case 0:return this.log.i("[reload]",He(at||(at=(0,n.cy)(["config:",",alt:",""],["config:",",alt:",""])),e,r)),clearTimeout(this.reloadTimer),this.reloadDeferred&&(this.reloadDeferred=null),this.configStore.state.isCompleteIdEnded&&(this.reloadReferrer={aid:this.configStore.aid,cid:this.configStore.cid,bvid:this.configStore.bvid,seasonId:this.configStore.seasonId,episodeId:this.configStore.episodeId}),this.rootPlayer.connectDetails.starting&&(this.rootPlayer.emit(s.p.PLAYER_UNLOAD),this.rootPlt(a.t.Player_Dispose,new CustomEvent(a.t.Player_Dispose))),[4,new Promise((function(e){i.reloadTimer=window.setTimeout(e,1)}))];case 1:return u.sent(),this.rootStore.stageAtom.set(0),this.reloadDeferred=this.rootPlayer.addDispose(new Qe.B),this.setState({isRenewal:!!(null==t?void 0:t.isRenewal),isSameEpisode:!!(null==t?void 0:t.isSameEpisode),referrer:(null==r?void 0:r.initiator)||""}),null!=e&&this.configStore.startReloadParser(e),this.dp.reloadAction&&this.dp.reloadAction(),this.dp.reloadAction=(0,o.gx)((function(){return i.rootStore.isLoaded}),(function(){return i.reloadDeferred.resolve()})),this.rootStore.changeP(),[4,this.reloadDeferred.promise];case 2:return u.sent(),[2,!this.errorStore.state.initError]}}))}))},t.prototype.prev=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(r){switch(r.label){case 0:return[4,this.goto(-1,!1,e,t)];case 1:return r.sent(),[2]}}))}))},t.prototype.next=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(r){switch(r.label){case 0:return[4,this.goto(1,!1,e,t)];case 1:return r.sent(),[2]}}))}))},t.prototype.goto=function(e,t,r,i){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(n){if(!ut(e))throw new Error("The first argument MUST be an integer");return this.rootPlayer.emit(a.t.Player_Handoff_Signal,new CustomEvent(a.t.Player_Handoff_Signal,{detail:{offset:e,absolute:t,config:r,alt:i}})),[2]}))}))},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),clearTimeout(this.reloadTimer)},t}(d),lt=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="AssetStore",r.flvjs=null,(0,o.rC)(r),r}return(0,n.ZT)(t,e),t.prototype.onMount=function(){e.prototype.onMount.call(this),this.fetchDashAsset(),this.addLazyActions()},t.prototype.fetchDashAsset=function(){window.DashPlayer||(window.DashPlayer=$e())},t.prototype.addLazyActions=function(){var ,(function(){t(),(0,Le.YE)().then((function(t){window.flvjs||(window.flvjs=t.default),(0,o.z)((function(){e.flvjs=t.default}))})).catch((function(t){e.log.e(t&&t.message)}))}))},(0,n.gn)([o.LO.shallow],t.prototype,"flvjs",void 0),t}(d);!function(e){e.Flv="Flv",e.Dash="Dash"}(st||(st={}));var dt,ft,pt=function(){function e(e,t,r){this.isAgentReady=!1,this.isQualityReady=!1,this.isAgentOffscreen=!1,this.rootStore=e,this.rootPlayer=e.rootPlayer,this.isAgentOffscreen=!!r,this.track=this.rootPlayer.track,this.video=t,this.rootStore.decomposeSubStores(this),this.isAgentReady=!0}return Object.defineProperty(e.prototype,"log",{get:function(){if(!this._cachedLog){var e=this.rootPlayer.log;this._cachedLog=this.tag?e.getLogger(this.tag):e}return this._cachedLog},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return this.isAgentReady},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isOffscreen",{get:function(){return this.isAgentOffscreen},enumerable:!1,configurable:!0}),e.prototype.getPlayUrl=function(){var e=this.data&&this.data.mediaDataSource;return e&&e.segments&&e.segments[0]&&e.segments[0].url||""},e.prototype.attachSource=function(e){this.log.i("[attachSouType="range")},e.prototype.attachEv.addBaseEventsualityReadyState"),this.isQualityReady=!1},e.prototype.w=function(){this.log.w("[Warning]","kernelPlayer is not destroyed")},e.prototype.setInitQuality=function(){if(!this.isQualityReady){var e=0===this.qualityStore.state.newQuality?0:this.realVQ
;this.log.i("[setInitQuality]","q:".concat(e)),this.qualityStore.setRenderedQuality(null,e),this.isQualityReady=!0}},e.prototype.restoreStates=function(){var e=this,t=this.kernelStore.cachedStatus;if(t){var r=t.currentTime,n=t.paused,i=this.video.duration;if(this.log.i("[Restore]","paused:".concat(n,",currentTime:").concat(r,",duration:").concat(i)),r){var o=(0,U.Z)(r,0,i);o&&(this.seek(o),this.log.i("[Restore]","SeekAction"))}n?this.video.pause():b(this.video).catch((function(t){return e.log.w("[Restore]","PlayFailed",t&&t.message)}))}},e.prototype.addBaseEvents=function(){this.video.readyState>edmetadata)},e.prototype.remodmetadata)},e.prototype.onLoadedmetadata=function(){this.restoreStates(),this.setInitQuality(),this.errorStore.abortRetry()},e.prototype.dispose=function(){this.log.i("dispose"),this.isAgentReady=!1,this.resetQualityReadyState(),this.removeBaseEvents()},(0,n.gn)([i.ZP],e.prototype,"onLoadedmetadata",null),e}(),ht=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="QualityAtom",t}return(0,n.ZT)(t,e),t.prototype.switchProxy=function(){var e=this.rootStore,t=e.kernelStore,r=e.qualityStore,n=t.baseAgent,i=n&&n.kernelPlayer,o=r.state.newQuality;return n&&i?(n.kind===st.Dash?this.switchDash(n,i,o):this.switchFlv(n,i,o),!0):(this.log.w("[switchProxy]","kernel is not initialized"),!1)},t.prototype.triggerRequestedEvent=function(e){e.isAutomatic&&"video"===e.mediaType&&this.setAudioQuality(e.newQ),this.rootPlayer.emit(a.t.Player_Quality_Requested,new CustomEvent(a.t.Player_Quality_Requested,{detail:e}))},t.prototype.triggerRenderedEvent=function(e){this.rootPlayer.emit(a.t.Player_Quality_Rendered,new CustomEvent(a.t.Player_Quality_Rendered,{detail:e}))},t.prototype.switchDash=function(e,t,r){var n=this,i=this.rootStore,o=i.uiStore,a=i.qualityStore,s=i.kernelStore,u=i.mpdStore,c=i.userStore;if(this.canDashSeamless(e.realVQ,r))if(0===r){var l=o.kind===f.HR.Ugc?ve.n.gt.ugcLogin:ve.n.gt.login,d=c.isLogin?ve.n.gt.abrMax:l;a.maxEmbeddedQn&&(d=a.maxEmbeddedQn),t.setAutoSwitchQualityFor("video",!0).setAutoSwitchTopQualityFor("video",d),a.setRenderedQuality(null,r)}else t.setAutoSwitchQualityFor("video",!1).setQualityFor("video",r).then((function(t){var n=t&&+t.newQualityNumber||e.realVQ||r;a.setRenderedQuality(null,n)})).catch((function(e){var t,r,i=a.state.nowQuality,o=a.state.newQuality,u=s.baseAgent&&s.baseAgent.realVQ,c=e&&e.code;n.log.w("[switchDashQualityForVideo]","code:".concat(c,",nowQ:").concat(i,",newQ:").concat(o,",realQ:").concat(u)),c===$e().ERROR_CODE.SET_QUALITY_RENDER_CHANGED?(t=e,r=u):0===i&&o&&o===u?(t=null,r=o):(t=e,r=i),o&&o===u&&(t=null,r=o),a.setRenderedQuality(t,r)})),this.setAudioQuality(r);else u.fetchPlayUrl({qn:r,try_look:+a.state.isTrialQuality},{initiator:1})},t.prototype.setAudioQuality=function(e){var t,r,n=this,i=this.rootStore,o=i.mpdStore,a=i.kernelStore,s=i.qualityStore,u=null===(r=null===(t=o.body)||void 0===t?void 0:t.mediaDataSource)||void 0===r?void 0:r.url,c=a.dashKernel,l=s.realAQ,d=function(){var t,r,n=ve.n.alias,i=e<=n.SD_32?n.AQ_30216:e<n.FHD_80?n.AQ_30232:n.AQ_30280;return u&&"string"!=typeof u&&Array.isArray(u.audio)&&u.audio.length&&+((null===(t=u.audio.find((function(e){return e.id===i})))||void 0===t?void 0:t.id)||(null===(r=u.audio[0])||void 0===r?void 0:r.id))||n.AQ_30280}();c&&d!==l&&(s.state.nowAudio||(this.log.i("[switchDashQualityForAudio]","nAQ:".concat(l,",tAQ:").concat(d)),c.setAutoSwitchQualityFor("audio",!1).setQualityFor("audio",d).catch((function(e){var t=e&&e.code;n.log.w("[switchDashQualityForAudio]","code:".concat(t,",newAQ:").concat(d,",realAQ:").concat(l))}))))},t.prototype.switchFlv=function(e,t,r){this.rootStore.mpdStore.fetchPlayUrl({qn:r},{initiator:1})},t.prototype.canDashSeamless=function(e,t){var r,i,o=this,a=this.rootStore,s=a.kernelStore,u=a.qualityStore,c=a.wmpStore,l=a.mediaStore,d=a.mpdStore,p=a.uiStore,h=function(){var r,i;try{var a=s.dashKernel;if(a){var u=a.getQualityList("video"),c=!1,l=!1;try{for(var d=(0,n.XA)(u),f=d.next();!f.done;f=d.next()){var p=+f.value.id;isNaN(p)||(p===e&&(c=!0),p===t&&(l=!0))}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}return c&&l}return!1}catch(e){return o.log.e("[isSameCodec]",e&&e.message),!1}}(),y=u.state.newAudio!==u.state.nowAudio,m=e===ve.n.alias.UHD_HDR||e===ve.n.alias.UHD_DVision||t===ve.n.alias.UHD_HDR||t===ve.n.alias.UHD_DVision,g=c.isNeedSwitchBwpVideoTag(l.video,t,null===(i=null===(r=d.body)||void 0===r?void 0:r.mediaDataSource)||void 0===i?void 0:i.url);if(this.log.i("[canDashSeamless]","newQ:".concat(t,",isSwitchAudio:").concat(y,",isUniqueCodec:").concat(m,",isSameCodec:").concat(h,",isNeedSwitchBwpVideoTag:").concat(g)),y||m)return!1;if(g)return!1;if(0===t)return!0;if(!h)return!1;switch(p.kind){case f.HR.Pgc:case f.HR.Ugc:case f.HR.Pugv:}return!0},t}(l),yt=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="QualityStore",r.switchingTimer=null,r.qualityDeferred=null,(0,o.rC)(r),r.qualityAtom=new ht(t),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{oldAudio:NaN,nowAudio:NaN,newAudio:NaN,reqAudio:0,oldQuality:NaN,nowQuality:NaN,newQuality:NaN,reqQuality:P,isTrialQuality:!1,isTrialSwitch:!1}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAutoQ",{get:function(){var e=this.state.nowQuality,t=this.state.newQuality;if(0===e){if(isNaN(t)||t===e)return!0perty(t.prototype,"quality",{get:function(){return isNaN(this.state.nowQuality)?this.state.newQuality:this.state.nowQuality},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realQ",{get:function(){return this.kernelStore.baseAgent?this.kernelStore.baseAgent.realVQ:NaN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realAQ",{get:function(){return this.kernelStore.baseAgent?this.kernelStore.baseAgent.realAQ:NaN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"requestQ",{get:function(){return isNaN(this.state.reqQuality)?P:this.state.reqQuality},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSwitching",{get:function(){var e=isNaN(this.state.newAudio),t=isNaN(this.state.nowAudio),r=isNaN(this.state.newQuality),n=isNaN(this.state.nowQuality),i=this.state.newAudio===this.state.nowAudio,o=this.state.newQuality===this.state.nowQuality;return!(e||t||r||n)&&(!i||!o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxEmbeddedQn",{get:function(){switch(this.configStore.embeddedEnv){case 2:return ve.n.gt.whiteEmbedded;case 3:return ve.n.gt.otherEmbedded;default:return null}},enumerable:!1,configurable:!0}),t.prototype.prototype.onMount.call(this),this.dc.switching=(0,o.U5)((function(){return t.isSwitching}),(function(e){e&&t.switchProxy()}),{fireImmediately:!0}),this.dc.cacheQuality=(0,o.U5)((function(){return{a:t.state.nowAudio,q:t.state.nowQuality}}),(function(e){isNaN(e.a)||isNaN(e.q)||t.rootPlayer.emit(a.t.Player_Quality_Changed,new CustomEvent(a.t.Player_Quality_Changed))})),this.dc.reqAudio=(0,o.U5)((function(){return t.state.reqAudio}),(function(e){isNaN(e)||t.localStore.set({media:{audioQuality:e}})})),this.dc.reqQuality=(0,o.U5)((function(){return t.state.reqQuality}),(function(e){t.setLocalQuality(e)}))},t.prototype.setLocalQuality=function(e){var t=+e;if(!isNaN(t)){var r=M.get(N),n=this.localStore.get().media.quality;null!=r&&+r===t||M.set(N,t.toString()),null!=n&&+n===t||this.localStore.set({media:{quality:t}})}},t.prototype.switchProxy=function(){return this.qualityAtom.switchProxy()},t.prototype.requestQuality=function(e,t,r){return(0,n.mG)(this,void 0,void 0,(function(){var i,o;return(0,n.Jh)(this,(function(a){switch(a.label){case 0:if(!this.userStore.isLogin&&e>ve.n.gt.login&&!this.state.isTrialQuality||this.maxEmbeddedQn&&e>this.maxEmbeddedQn)throw i="Permission denied",this.log.w("[requestQuality]",i),
new Error(i);this.log.i("[requestQuality]",He(dt||(dt=(0,n.cy)(["nvq:",",naq:",",alt:",""],["nvq:",",naq:",",alt:",""])),e,+t,r)),o=this.rootPlayer.addDispose(new Qe.B),this.qualityDeferred&&(this.qualityDeferred=null),this.qualityDeferred=o;try{this.setRequestedQuality(e,null==t?null:+t)}catch(e){o.reject(e)}return[4,o.promise];case 1:return a.sent(),[2]}}))}))},t.prototype.getQuality=function(){return{oldA:this.state.oldAudio,nowA:this.state.nowAudio,newA:this.state.newAudio,oldQ:this.state.oldQuality,nowQ:this.state.nowQuality,newQ:this.state.newQuality,realQ:this.realQ}},t.prototype.setRequestedQuality=function(e,t){var r=this,n="[setRequestedQuality]",i={audio:!0,video:!0};null==t&&(i.audio=!1);var o=this.state.nowAudio,a=this.state.nowQuality,s=null==e?a:+e,u=s===a,c=i.audio?+t:o;if(c===o&&(i.audio=!1),isNaN(s)&&(i.video=!1,!i.video&&!i.audio))throw new Error("Illegal argument");if(u&&(i.video=!1,!i.video&&!i.audio))throw new Error("Same as current quality:".concat(a,",").concat(o));if(clearTimeout(this.switchingTimer),i.video&&i.audio)this.log.i(n,"Request:A&V"),this.setState({newQuality:s,reqQuality:s,newAudio:c,reqAudio:c}),this.qualityAtom.triggerRequestedEvent({mediaType:"audio",isAutomatic:!1,oldQ:o,newQ:c}),this.qualityAtom.triggerRequestedEvent({mediaType:"video",isAutomatic:!1,oldQ:a,newQ:s});else if(i.video)this.log.i(n,"Request:V"),this.setState({newQuality:s,reqQuality:s}),this.qualityAtom.triggerRequestedEvent({mediaType:"video",isAutomatic:!1,oldQ:a,newQ:s});else{if(!i.audio){var l="Fatal error";throw this.log.e(n,l),new Error(l)}this.log.i(n,"Request:A"),this.setState({newAudio:c,reqAudio:c}),this.qualityAtom.triggerRequestedEvent({mediaType:"audio",isAutomatic:!1,oldQ:o,newQ:c})}this.switchingTimer=window.setTimeout((function(){r.setRenderedQuality(new Error("Timeout:".concat(15,"s")),r.state.nowQuality)}),15e3)},t.prototype.setRenderedQuality=function(e,t){var r=this,i="[setRenderedQuality]",o=function(){var e="[setAudioQuality]",t=r.state.nowAudio,i=r.state.newAudio,o=function(){var e,t,i,o,a=r.kernelStore.dashKernel,s=r.mpdStore.body;if(a&&s){var u=a.getQualityFor("audio"),c=+a.getQualityNumberFromQualityIndex(u,"audio"),l=s.mediaDataSource.url,d=null===(i=null==l?void 0:l.dolby)||void 0===i?void 0:i.audio,f=null===(o=null==l?void 0:l.flac)||void 0===o?void 0:o.audio;if(Array.isArray(d))try{for(var p=(0,n.XA)(d),h=p.next();!h.done;h=p.next())if(+h.value.id===c)return 1}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=p.return)&&t.call(p)}finally{if(e)throw e.error}}if(f&&+f.id===c)return 2}return 0}();if(t!==i){if(t===o)return r.log.e(e,"targetA:".concat(o)),r.setState({nowAudio:o,newAudio:o}),"Audio(type:".concat(i,") maybe Unsupported or Unknown err");r.log.i(e,"targetA:".concat(o)),r.setState({ot({return r.qualityDeferred&&r.qualityDeferred.resolve()},s=function(e){return r.qualityDeferred&&r.qualityDeferred.reject(e)},u=+t,c=this.state.nowQuality,l=this.state.newQuality,d=u===c;if(clearTimeout(this.switchingTimer),this.log.i(i,He(ft||(ft=(0,n.cy)(["nVQ:",",tVQ:",",",""],["nVQ:",",tVQ:",",",""])),c,t,e)),isNaN(this.state.newQuality)||isNaN(this.state.newAudio)){var f="Lifecycle issue";return this.log.e(i,f),void s(new Error(f))}if(l===c){var p=this.state.oldAudio,h=this.state.nowAudio,y="string"==typeof o;if(this.log.i(i,d?"Only":"Extra","switch audio"),this.qualityAtom.triggerRenderedEvent({mediaType:"audio",isError:y,isAutomatic:!1,oldQ:p,newQ:h}),y?s(new Error(o)):a(),d)return}var m=e?(r.log.e(i,e.message),r.setState({nowQuality:c,newQuality:c}),e||new Error("Unknown")):isNaN(u)?(r.log.e(i,"targetQ:NaN"),r.setState({nowQuality:c,newQuality:c}),e||new TypeError("Rendered quality is not a number")):(d?(r.log.w(i,"targetQ same as nowQ"),r.setState({nowQuality:u,newQuality:u})):(r.log.i(i,"targetQ:".concat(u)),r.setState({oldQuality:c,nowQuality:u,newQuality:u})),null),g=this.state.oldQuality,v=this.state.nowQuality;this.qualityAtom.triggerRenderedEvent({mediaType:"video",isError:!!m,isAutomatic:!1,oldQ:g,newQ:v}),m?s(m):a()},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,{newAudio:1,reqAudio:1,newQuality:1,reqQuality:1}),clearTimeout(this.switchingTimer),this.switchingTimer=null},(0,n.gn)([o.Fl],t.prototype,"isSwitching",null),(0,n.gn)([o.Fl],t.prototype,"maxEmbeddedQn",null),(0,n.gn)([o.aD],t.prototype,"setRequestedQuality",null),(0,n.gn)([o.aD],t.prototype,"setRenderedQuality",null),t}(d);function mt(e,t){try{if("string"==typeof e){var r=e.match(new RegExp("".concat(t,": r gt,vt,_t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="DashAgent",t.kind=st.Dash,t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"realVQ",{get:function(){if(this.dashPlayer){var e=(this.dashPlayer.getQualityList("video")||[])[this.dashPlayer.getQualityFor("video")];return e&&e.hasOwnProperty("id")?+e.id:NaN}return NaN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realAQ",{get:function(){if(this.dashPlayer){var e=(this.dashPlayer.getQualityList("audio")||[])[this.dashPlayer.getQualityFor("audio")];return e&&e.hasOwnProperty("id")?+e.id:NaN}return NaN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"averageThroughput",{get:function(){var e=this.dashPlayer.getCorePlayer(),t=+e.getAverageThroughput("video"),r=+e.getAverageThroughput("audio");return t&&r?1e3*(t+r)/1024/8/2:t?1e3*t/1024/8:r?1e3*r/1024/8:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastSecondThroughput",{get:function(){var e=this.dashPlayer&&this.dashPlayer.getVideoInfo();try{return e.statisticsInfo.networkActivity/1024}catch(e){return 0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kernelPlayer",{get:function(){return this.dashPlayer},enumerable:!1,configurable:!0}),t.prototype.seek=function(e){var t=this;this.dashPlayer?this.dashPlayer.seek(e).catch((function(e){t.log.w("seek",e&&e.message)})):this.video.currentTime=e},t.prototype.getPlayUrl=function(){try{return this.dashPlayer?this.dashPlayer.getCurrentPlayURLFor("video")+","+this.dashPlayer.getCurrentPlayURLFor("audio"):e.prototype.getPlayUrl.call(this)}catch(t){return e.prototype.getPlayUrl.call(this)}},t.prototype.attachSource=function(t,r){var n,i=this;e.prototype.attachSource.call(this,t),this.dashPlayer&&(this.w(),this.removePlayerEvents(),this.removeProtectionEvents(),this.dashPlayer.destroy());var o,a=this.rootPlayer,u=a.hasFeature("noAudioStream"),c=this.errorStore.state.disableNonDAQ,l=this.qualityStore.state.reqAudio,d=null===(n=this.mpdStore.body)||void 0===n?void 0:n.quality,p=this.qualityStore.state.reqQuality,h=(0,Le.Qj)(t),y=(0,Le.Zc)(t,c?0:l);this.log.i("daq:".concat(y,",dvq:").concat(h,";rawVQ:").concat(d,",reqVQ:").concat(p)),this.dashPlayer=new($e())(this.video,{defaultAudioQuality:y,defaultVideoQuality:h,isAutoPlay:!1,enableHEVC:this.configStore.enableHEVC,enableAV1:this.configStore.enableAV1,enableMultiAudioTracks:function(){try{return t.mediaDataSource.url.audio[0].codecs.split(",").length>1}catch(e){}return!1}()&&$e().isMultiAudioTracksSupported(),abrStrategy:$e().STRING.ABR_BOLA,stableBufferTime:this.kernelStore.getDynamicBuffer()[0]||20,preloadData:t.mediaDataSource.preloadAVData,hid:a.iid,protectionDataSet:null==r?void 0:r.protectionData,ignoreEmeEncryptedEvent:null==r?void 0:r.ignoreEmeEncryptedEvent}),this.dashPlayer.initialize((o=(0,Ze.Z)({},t.mediaDataSource.url),u&&o&&o.audio&&(o.audio=null),o)).then((function(){return function(){if(!i.dashPlayer)throw new Error("dashPlayer does not exist");i.qualityStore.isAutoQ&&i.dashPlayer.setAutoSwitchQualityFor("video",!0),i.qualityStore.maxEmbeddedQn?i.dashPlayer.setAutoSwitchQualityFor("video",!0).setAutoSwitchTopQualityFor("video",i.qualityStore.maxEmbeddedQn):i.userStore.isLogin?i.dashPlayer.setAutoSwitchTopQualityFor("video",ve.n.gt.abrMax):i.dashPlayer.setAutoSwitchTopQualityFor("video",i.uiStore.kind===f.HR.Ugc?ve.n.gt.ugcLogin:ve.n.gt.login)}()
})).catch((function(e){i.isOffscreen||i.rootPlayer.emit(s.p.ERROR_DASH_INITIALIZE,e)}))},t.prototype.attachEvent=function(){e.prototype.attachEvent.call(this),this.addPlayerEvents(),this.addProtectionEvents()},t.prototype.addPlayerEvents=function(){var e=this.dashPlayer.getCorePlayer();e.on($e().EVENTS.PLAYBACK_PROGRESS,this.onPlaybackProgress),e.on($e().EVENTS.FRAGMENT_LOADING_HEADER_RECEIVED,this.onHttpHeaderReceived),e.on($e().EVENTS.QUOTA_EXCEEDED,this.onQuotaExceeded),e.on("requestRetryed",this.onRequestRetried),e.on($e().EVENTS.PREDICT_SEEK,this.onPredictSeek),e.on($e().EVENTS.JUMP_MEDIA_GAP,this.onJumpMediaGap),this.dashPlayer.on($e().EVENTS.ERROR,this.onError),this.dashPlayer.on($e().EVENTS.VIDEO_INFO,this.onVideoInfo),this.dashPlayer.on($e().EVENTS.QUALITY_CHANGE_REQUESTED,this.onQualityRequested),this.dashPlayer.on($e().EVENTS.QUALITY_CHANGE_RENDERED,this.onQualityRendered),this.dashPlayer.on($e().EVENTS.BUFFERING_OPTIMIZATION,this.onBufferingOptimization),this.dashPlayer.on($e().EVENTS.WARNING,this.onWarning)},t.prototype.removePlayerEvents=function(){if(this.dashPlayer){this.dashPlayer.off($e().EVENTS.ERROR,this.onError),this.dashPlayer.off($e().EVENTS.VIDEO_INFO,this.onVideoInfo),this.dashPlayer.off($e().EVENTS.QUALITY_CHANGE_REQUESTED,this.onQualityRequested),this.dashPlayer.off($e().EVENTS.QUALITY_CHANGE_RENDERED,this.onQualityRendered),this.dashPlayer.off($e().EVENTS.BUFFERING_OPTIMIZATION,this.onBufferingOptimization),this.dashPlayer.off($e().EVENTS.WARNING,this.onWarning);var e=this.dashPlayer.getCorePlayer();e&&(e.off($e().EVENTS.PLAYBACK_PROGRESS,this.onPlaybackProgress),e.off($e().EVENTS.FRAGMENT_LOADING_HEADER_RECEIVED,this.onHttpHeaderReceived),e.off($e().EVENTS.QUOTA_EXCEEDED,this.onQuotaExceeded),e.off("requestRetryed",this.onRequestRetried),e.off($e().EVENTS.PREDICT_SEEK,this.onPredictSeek),e.off($e().EVENTS.JUMP_MEDIA_GAP,this.onJumpMediaGap))}},t.prototype.addProtectionEvents=function(){var e=this.dashPlayer.getCorePlayer();e.on($e().EVENTS.KEY_ERROR,this.onKeyError),e.on($e().EVENTS.KEY_MESSAGE,this.onKeyMessage),e.on($e().EVENTS.KEY_SESSION_CLOSED,this.onKeySessionClosed),e.on($e().EVENTS.KEY_SESSION_CREATED,this.onKeySessionCreated),e.on($e().EVENTS.KEY_SESSION_REMOVED,this.onKeySessionRemoved),e.on($e().EVENTS.KEY_STATUSES_CHANGED,this.onKeyStatusesChanged),e.on($e().EVENTS.KEY_SYSTEM_SELECTED,this.onKeySystemSelected),e.on($e().EVENTS.LICENSE_REQUEST_COMPLETE,this.onLicenseReqComplete),e.on($e().EVENTS.PROTECTION_CREATED,this.onProtectionCreated),e.on($e().EVENTS.PROTECTION_DESTROYED,this.onProtectionDestroyed)},t.prototype.removeProtectionEvents=function(){if(this.dashPlayer){var e=this.dashPlayer.getCorePlayer();e&&(e.off($e().EVENTS.KEY_ERROR,this.onKeyError),e.off($e().EVENTS.KEY_MESSAGE,this.onKeyMessage),e.off($e().EVENTS.KEY_SESSION_CLOSED,this.onKeySessionClosed),e.off($e().EVENTS.KEY_SESSION_CREATED,this.onKeySessionCreated),e.off($e().EVENTS.KEY_SESSION_REMOVED,this.onKeySessionRemoved),e.off($e().EVENTS.KEY_STATUSES_CHANGED,this.onKeyStatusesChanged),e.off($e().EVENTS.KEY_SYSTEM_SELECTED,this.onKeySystemSelected),e.off($e().EVENTS.LICENSE_REQUEST_COMPLETE,this.onLicenseReqComplete),e.off($e().EVENTS.PROTECTIONTION_DESTROYED,this.onProtectionDestroyed))}},t.prototype.onError=function(e){this.rootPlayer.emit(s.p.ERROR_DASH_KERNEL,e)},t.prototype.onHttpHeaderReceived=function(e){switch(e.request.mediaType){case"video":this.kernelStore.setState({vTag:mt(e.headers,"x-service-module")});break;case"audio":this.kernelStore.setState({aTag:mt(e.headers,"x-service-module")})}},t.prototype.onJumpMediaGap=function(e){var t={ct:null==e?void 0:e.time,des:null==e?void 0:e.seekToPosition,end:null==e?void 0:e.toEnd};this.track.o("jump_media_gap",t)},t.prototype.onPredictSeek=function(e){var t={ct:null==e?void 0:e.currentTime,des:null==e?void 0:e.destination};this.track.o("predict_seek",t)},t.prototype.onVideoInfo=function(e){var t=e.mediaInfo;t&&Object.keys(t).length&&this.menuStore.setVideoInfo(e,"DashPlayer")},t.prototype.onQualityRequested=function(e){if(e.isAutoSwitch&&"video"===e.mediaType){var t=this.dashPlayer.getQualityList(e.mediaType)[e.newQuality];this.track.o("auto_switch_requested",{oldQ:e.oldQualityNumber,newQ:e.newQualityNumber,bitrate:Math.floor(t.bitrate/1e3),throughput:e.dict&&e.dict.throughput}),this.qualityStore.qualityAtom.triggerRequestedEvent({mediaType:"video",isAutomatic:!0,oldQ:e.oldQualityNumber,newQ:e.newQualityNumber})}},t.prototype.onQualityRendered=function(e){if("video"===e.mediaType&&!isNaN(e.oldQuality))if(e.isAutoSwitch){var t=this.dashPlayer.getQualityList(e.mediaType)[e.newQuality];this.track.o("auto_switch_rendered",{oldQ:e.oldQualityNumber,newQ:e.newQualityNumber,bitrate:Math.floor(t.bitrate/1e3),throughput:e.dict&&e.dict.throughput}),this.qualityStore.qualityAtom.triggerRenderedEvent({mediaType:"video",isAutomatic:!0,oldQ:e.oldQualityNumber,newQ:e.newQualityNumber})}else e.newQualityNumber&&(this.log.i("[onQualityRendered]",e.newQualityNumber),this.qualityStore.setRenderedQuality(null,e.newQualityNumber))},t.prototype.onQuotaExceeded=function(e){var t=this.kernelStore.state.mseQuotaExceeded+1;this.kernelStore.setState({mseQuotaExceeded:t}),this.log.w("[QuotaExceeded]",t),this.dashPlayer&&this.dashPlayer.setStableBufferTime(30),this.track.o("quota_exceeded",{type:e.mediaType,cbl:e.criticalBufferLevel})},t.prototype.onPlaybackProgress=function(){var e=this.dashPlayer.getCorePlayer();if(e){var t=e.getBufferLength("audio"),r=e.getBufferLength("video");this.mediaStore.setState({aBufferLength:t,vBufferLength:r})}},t.prototype.onBufferingOptimization=function(e){this.track.o("buffering_optimization",{val:e&&e.type})},t.prototype.onWarning=function(e){e&&e.code&&e.msg&&-1!==e.code&&this.track.o("load_dash_warning",{code:e.code,msg:e.msg,srcUrl:e.detail&&e.detail.url},{exParam:this.kernelStore.serviceModule})},t.prototype.onRequestRetried=function(){if(this.episodeStore.isFirst&&!this.mediaStore.state.isMetadataLoaded)this.kernelStore.setState({streamRetries:++this.kernelStore.state.streamRetries});else{var e=this.dashPlayer.getCorePlayer();e&&e.off("requestRetryed",this.onRequestRetried)}},t.prototype.onKeyError=function(e){var t,r;this.log.e(e.type,null===(t=e.data)||void 0===t?void 0:t.error),this.mpdStore.fallback(5200,"onKeyError",null===(r=e.data)||void 0===r?void 0:r.error)},t.prototype.onKeyMessage=function(e){var t;this.log.i(e.type,null===(t=e.data)||void 0===t?void 0:t.messageType)},t.prototype.onKeySessionClosed=function(e){e.error?(this.log.e(e.type,e.error),this.mpdStore.fallback(5201,"onKeySessionClosed",e.error)):this.log.i(e.type)},t.prototype.onKeySessionCreated=function(e){e.error?(this.log.e(e.type,e.error),this.mpdStore.fallback(5201,"onKeySessionCreated",e.error)):this.log.i(e.type)},t.prototype.onKeySessionRemoved=function(e){e.error?(this.log.e(e.type,e.error),this.mpdStore.fallback(5201,"onKeySessionRemoved",e.error)):this.log.i(e.type)},t.prototype.onKeySystemSelected=function(e){var t,r;e.error?(this.log.e(e.type,e.error),this.mpdStore.fallback(5202,"onKeySystemSelected",e.error)):this.log.i(e.type,"ks:".concat(null===(r=null===(t=e.data)||void 0===t?void 0:t.mksa)||void 0===r?void 0:r.keySystem))},t.prototype.onLicenseReqComplete=function(e){e.error?(this.log.e(e.type,e.error),this.mpdStore.fallback(5203,"onLicenseReqComplete",e.error)):this.log.i(e.type)},t.prototype.onKeyStatusesChanged=functtotype.onProtectionCreated=function(e){this.log.i(e.type)},t.prototype.onProtectionDestroyed=function(e){this.log.i(e.type)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.removePlayerEvents(),this.removeProtectionEvents(),this.dashPlayer&&(this.dashPlayer.destroy(),this.dashPlayer=null)},(0,n.gn)([i.ZP],t.prototype,"onError",null),(0,n.gn)([i.ZP],t.prototype,"onHttpHeaderReceived",null),(0,n.gn)([i.ZP],t.prototype,"onJumpMediaGap",null),(0,n.gn)([i.ZP],t.prototype,"onPredictSeek",null),(0,n.gn)([i.ZP],t.prototype,"onVideoInfo",null),(0,n.gn)([i.ZP],t.prototype,"onQualityRequested",null),(0,n.gn)([i.ZP],t.prototype,"onQualityRendered",null),(0,
n.gn)([i.ZP],t.prototype,"onQuotaExceeded",null),(0,n.gn)([i.ZP],t.prototype,"onPlaybackProgress",null),(0,n.gn)([i.ZP],t.prototype,"onBufferingOptimization",null),(0,n.gn)([i.ZP],t.prototype,"onWarning",null),(0,n.gn)([i.ZP],t.prototype,"onRequestRetried",null),(0,n.gn)([i.ZP],t.prototype,"onKeyError",null),(0,n.gn)([i.ZP],t.prototype,"onKeyMessage",null),(0,n.gn)([i.ZP],t.prototype,"onKeySessionClosed",null),(0,n.gn)([i.ZP],t.prototype,"onKeySessionCreated",null),(0,n.gn)([i.ZP],t.prototype,"onKeySessionRemoved",null),(0,n.gn)([i.ZP],t.prototype,"onKeySystemSelected",null),(0,n.gn)([i.ZP],t.prototype,"onLicenseReqComplete",null),(0,n.gn)([i.ZP],t.prototype,"onKeyStatusesChanged",null),(0,n.gn)([i.ZP],t.prototype,"onProtectionCreated",null),(0,n.gn)([i.ZP],t.prototype,"onProtectionDestroyed",null),t}(pt),Et=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.internalQuality=NaN,t.tag="FlvAgent",t.kind=st.Flv,t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"realVQ",{get:function(){return this.internalQuality},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realAQ",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"averageThroughput",{get:function(){try{return this.flvPlayer._transmuxer._controller._ioctl._speedSampler.averageKBps}catch(e){return 0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastSecondThroughput",{get:function(){try{return this.flvPlayer._transmuxer._controller._ioctl._speedSampler.lastSecondKBps/8}catch(e){return 0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kernelPlayer",{get:function(){return this.flvPlayer},enumerable:!1,configurable:!0}),t.prototype.seek=function(e){this.video.currentTime=e},t.prototype.getPlayUrl=function(){try{return this.flvPlayer&&(this.flvPlayer.statisticsInfo.redirectedURL||this.flvPlayer.statisticsInfo.url)||e.prototype.getPlayUrl.call(this)}catch(t){return e.prototype.getPlayUrl.call(this)}},t.prototype.attachSource=function(t){e.prototype.attachSource.call(this,t);var r={enableWorker:!1,accurateSeek:!0,stashInitialSize:65536,seekType:this.data.seekType,rangeLoadZeroStart:!1,lazyLoadMaxDuration:100,lazyLoadRecoverDuration:50,deferLoadAfterSourceOpen:!1,fixAudioTimestampGap:!1,reuseRedirectedURL:!0};(T.X.safari.alike||T.X.edge.alike||T.X.trident.alike)&&(r.enableWorker=!1,r.lazyLoadMaxDuration=100),this.assetStore.flvjs.LoggingControl.forceGlobalTag=!0,this.assetStore.flvjs.LoggingControl.enableVerbose=!1,this.flvPlayer&&(this.w(),this.removePlayerEvents(),this.flvPlayer.destroy()),this.flvPlayer=this.assetStore.flvjs.createPlayer(this.data.mediaDataSource,r),this.flvPlayer.attachMediaElement(this.video),this.flvPlayer.load(),this.internalQuality=this.data.quality},t.prototype.attachEvent=function(){e.prototype.attachEvent.call(this),this.addPlayerEvents()},t.prototype.addPlayerEvents=function(){var e=this.assetStore.flvjs;e.LoggingControl.addLogListener(this.onEarlyEOF),this.flvPlayer.on(e.Events.ERROR,this.onError),this.flvPlayer.on(e.Events.LOADING_COMPLETE,this.onLoadingComplete),this.flvPlayer.on(e.Events.HTTP_HEADER_RECEIVED,this.onHttpHeaderReceived),this.flvPlayer.on(e.Events.STATISTICS_INFO,this.onVideoInfo),this.flvPlayer.on(e.Events.CTS_WARNING,this.onCtsWarning),this.flvPlayer.on(e.Events.FLV_DATA_ABNORMAL,this.onFlvDataAbnormal),this.flvPlayer.on(e.Events.RECOVERED_EARLY_EOF,this.onRecoveredEarlyEOF)},t.prototype.removePlayerEvents=function(){var e=this.assetStore.flvjs;e.LoggingControl.removeLogListener(this.onEarlyEOF),this.flvPlayer&&e&&(this.flvPlayer.off(e.Events.ERROR,this.onError),this.flvPlayer.off(e.Events.LOADING_COMPLETE,this.onLoadingComplete),this.flvPlayer.off(e.Events.HTTP_HEADER_RECEIVED,this.onHttpHeaderReceived),this.flvPlayer.off(e.Events.STATISTICS_INFO,this.onVideoInfo),this.flvPlayer.off(e.Events.CTS_WARNING,this.onCtsWarning),this.flvPlayer.off(e.Events.FLV_DATA_ABNORMAL,this.onFlvDataAbnormal),this.flvPlayer.off(e.Events.RECOVERED_EARLY_EOF,this.onRecoveredEarlyEOF))},t.prototype.onError=function(e,t,r){this.rootPlayer.emit(s.p.ERROR_FLV_KERNEL,e,t,r)},t.prototype.onLoadingComplete=function(e){try{var t=e.metadata.filesize,r=e.to,n=e.requestUrl;t&&r&&t!==r+1&&this.track.o("abnormal_segment_bytelength",{length:r+1,filesize:t,requestUrl:n})}catch(e){}},t.prototype.onHttpHeaderReceived=function(e,t,r){this.kernelStore.setState({aTag:null,vTag:mt(r,"x-service-module")})},t.prototype.onVideoInfo=function(e){var t=this.flvPlayer.mediaInfo;t&&Object.keys(t).length&&this.menuStore.setVideoInfo({mediaInfo:t,statisticsInfo:e},this.flvPlayer.type)},t.prototype.onEarlyEOF=function(e,t){"string"==typeof t&&t.indexOf("code = -1, msg = Fetch stream meet Early-EOF")>-1&&(this.metricStore.earlyEOFSymbol||(this.track.o("range_early_eof"),this.metricStore.setEarlyEOFSymbol(!0)))},t.prototype.onCtsWarning=function(e){this.track.o("video_cts_warning",e?{cts:e.cts,dts:e.dts}:null)},t.prototype.onFlvDataAbnormal=function(e){this.track.o("flv_data_abnormal",e?{type:e.type,dts:e.dts}:null)},t.prototype.onRecoveredEarlyEOF=function(){e.prototype.dispose.call(this),this.removePlayerEvents(),this.flvPlayer&&(this.flvPlayer.destroy(),this.flvPlayer=null)},(0,n.gn)([i.ZP],t.prototype,"onError",null),(0,n.gn)([i.ZP],t.prototype,"onLoadingComplete",null),(0,n.gn)([i.ZP],t.prototype,"onHttpHeaderReceived",null),(0,n.gn)([i.ZP],t.prototype,"onVideoInfo",null),(0,n.gn)([i.ZP],t.prototype,"onEarlyEOF",null),(0,n.gn)([i.ZP],t.prototype,"onCtsWarning",null),(0,n.gnn t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="SeamlessAtom",t.offscreenVideo=!1,t.switchDisposer=null,t}return(0,n.ZT)(t,e),t.prototype.fakeSwitch=function(e,t){var r=this;this.log.i("[fakeSeamlessProxy]"),this.switchDisposer&&(this.switchDisposer(),this.switchDisposer=null);var n=this.rootStore,i=n.mediaStore,a=n.qualityStore,u=n.wmpStore,c=n.kernelStore,l="[fakeSeamless]",d=function(){var e=r.rootStore.qualityStore,t=ve.n.alias.FHD_116,n=ve.n.alias.UHD_4K,i=ve.n.alias.UHD_8K,o=0;switch(e.state.nowQuality){case i:o+=1;break;case n:o+=.5;break;case t:o+=.25}switch(e.state.newQuality){case i:o+=1;break;case n:o+=.5;break;case t:o+=.25}if(2===e.state.newAudio)o+=1;return(0,U.Z)(6+o,5,8)}(),f=i.video,p=u.createNewVideoElement(a.state.newQuality,e.mediaDataSource.url),h=null,y=null,m=null,g=function(){clearTimeout(h),clearTimeout(y)},_=function(e){rOffset:").concat(e));var t=f.currentTime+e;S(t)},E=function(e){b(p).then((function(){r.log.i(l,"[play:".concat(e,"] done"))})).catch((function(t){r.log.e(l,"[play:".concat(e,"] fail: ").concat(t&&t.message))}))},S=function(e){p.currentTime!==e&&(m?m.seek(e):p.currentTime=e)},T=function(e){clearTimeout(h),h=window.setTimeout((function(){r.log.i(l,"from:".concat(e)),P()}),1e3*(p.currentTime-f)},w=function(){if(C.forEach((function(e){f.removeEventListener(e.type,e.callback)})),N.forEach((function(e){p[e.prop]=null})),m)switch(m.kind){case st.Dash:(e=m.kernelPlayer)&&e.off($e().EVENTS.ERROR,O);break;case st.Flv:var e;(e=m.kernelPlayer)&&e.off(r.rootStore.assetStore.flvjs.Events.ERROR,I)}},A=function(){r.log.w(l,"[catchPrimaryError]");var e=r.rootStore.mediaStore,t=e.state.paused,n=e.state.progressTime;S(n),t?p.pause():E("catchPrimaryError"),P()},R=function(){w(),g(),m&&(c.cacheLogTimely(m),m.dispose(),m=null),p.parentElement&&p.parentElement.removeChild(p),r.offscreenVideo=!1,r.switchDisposer=null},P=function(){r.log.i(l,"[done]"),r.switchDisposer=null,g(),w(),function(){if(!isNaN(f.duration)&&!f.error){var e=p.currentTime,t=f.currentTime,n=Math.abs(e-t),i=f.ended,o=f.paused,a=p.ended;(n>1||i||a)&&(p.currentTime=t,r.log.w(l,t,",diff:").concat(n)),!a||i||o||(r.log.w(l,"[ForceSyncState]"),b(p).then((function(){r.log.i(l,"[ForceSyncState]","done")
})).catch((function(e){r.log.e(l,"[ForceSyncState]","fail",e&&e.message)}))))}}(),r.rootStore.mediaStore.replaceElement(p),t(m),m&&(m.attachEvent(),r.log.i(l,"events attached"),m=null),r.offscreenVideo=!1,r.rootPlayer.emit(s.p.PLAYER_MEDIA_CHANGED)},D=function(e,n){r.log.e(l,"[fail]","from:".concat(e,";msg:").concat(n));var i=r.rootStore,o=i.wmpStore,a=i.qualityStore;o.isUseWasmPlayer(p)&&o.onWasmPlayerError(p,null==p?void 0:p.bwpError,!0),R(),a.setRenderedQuality(new Error(n),a.state.nowQuality),t(null)},O=function(e){var t=e?"type:".concat(e.type,";code:").concat(e.code,";msg:").concat(e.msg):null,n="[DASH]";r.log.e(l,n,t),D(n,t)},I=function(e,t,n){var i="type:".concat(e,";details:").concat(t,";code:").concat(null==n?void 0:n.code,";msg:").concat(null==n?void 0:n.msg),o="[FLV]";r.log.e(l,o,i),D(o,i)},C=[{type:"ratechange",callback:function(){p.playbackRate===f.playbackRate&&p.defaultPlaybackRate===f.defaultPlaybackRate||(p.playbackRate=f.playbackRate,p.defaultPlaybackRate=f.defaultPlaybackRate,r.log.i(l,"playbackRate:".concat(f.playbackRate)))},fireImmediately:!0},{type:"ratechange",callback:function(){T("RatechangeEvent")}},{type:"volumechange",callback:function(){p.volume=f.volume,r.log.i(l,"volume:".concat(f.volume))},fireImmediately:!0},{type:"play",callback:function(){E("PlayEvent")}},{type:"pause",callback:function(){p.pause()}},{type:"seeking",callback:function(){_(f.paused?0:1),T("SeekingEvent")}},{type:"error",callback:function(){A()}}],N=[{prop:"onloadedmetadata",callback:function(){f.error?A():(C.forEach((function(e){e.fireImmediately&&e.callback(),f.addEventListener(e.type,e.callback)})),f.paused?p.pause():E("LoadedmetadataEvent"),_(f.paused?0:3)),p.onloadedmetadata=null}},{prop:"oncanplay",callback:function(){f.paused&&p.paused&&(S(f.currentTime),T("CanplayEvent"))}},{prop:"onplaying",callback:function(){T("PlayingEvent")}},{prop:"onpause",callback:function(){f.paused&&p.paused?(S(f.currentTime),T("PauseEvent")):r.log.w(l,"drop-out of step")}},{prop:"onerror",callback:function(){var e=p.error,t=e&&"".e);D("[MEDIA]",t)}}];p.muted=!0,p.crossOrigin="anonymous",p.classList.add(v.cx),N.forEach((function(e){p[e.prop]=e.callback})),this.nodes.videoWrap.insertBefore(p,f),this.switchDisposer=R,this.offscreenVideo=!0;var k=function(e){var t;"dash"===e.mediaDataSource.type?((t=m=new _t(r.rootStore,p,!0)).attachSource(e),t.kernelPlayer.on($e().EVENTS.ERROR,O)):((t=m=new Et(r.rootStore,p,!0)).attachSource(e),t.kernelPlayer.on(r.rootStore.assetStore.flvjs.Events.ERROR,I));clearTimeout(y),y=window.setTimeout((function(){r.log.w(l,"from:timeout(".concat(d,"s)")),P()}),1e3*d)};if("dash"===e.mediaDataSource.type)k(e);else"function"==typeof this.dc.isFlvOk&&this.dc.isFlvOk(),this.dc.isFlvOk=(0,o.gx)((function(){return!!r.rootStore.assetStore.flvjs}),(function(){return k(e)}))},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.switchDisposer&&(this.switchDisposer(),this.switchDisposer=null)},t}(l),St=r(55360),Tt=r(33070),wt=r(50960),At=r(38823),Rt=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="KernelAtom",r.isLoadStartChecked=!1,r.rootPlayer.on(s.p.MEDIA_ENDED,(function(){return r.setCachedStatus(null)})).on(s.p.MEDIA_PROGRESS,(function(){return r.setBufferPolicy()})),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"agentKind",{get:function(){return this.baseAgent?this.baseAgent.kind:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flvKernel",{get:function(){return this.baseAgent&&this.baseAgent.kind===st.Flv?this.baseAgent.kernelPlayer:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dashKernel",{get:function(){return this.baseAgent&&this.baseAgent.kind===st.Dash?this.baseAgent.kernelPlayer:null},enumerable:!1,configurable:!0}),t.prototype.setCachedStatus=function(e){this.cachedStatus&&(e||this.log.i("[CacheStatus]","clear"),this.cachedStatus=e)},t.prototype.setBufferPolicy=function(){var e=this.rootStore,t=e.kernelStore,r=e.mediaStore,i=t.dashKernel,o=i&&i.getCorePlayer();if(i&&o){var a=r.video.currentTime,s=i.getStableBufferTime(),u=t.state.mseQuotaExceeded,c=(0,n.CR)(this.getDynamicBuffer(),6),l=(c[0],c[1]),d=c[2],f=c[3],p=c[4],h=c[5];if(u)return i.setStableBufferTime(p),void o.setBufferToKeep(h);s<p&&(a>f&&s<p?(i.setStableBufferTime(p),o.setBufferToKeep(h)):a>l&&s<d&&(i.setStableBufferTime(d),o.setBufferToKeep(h)))}},t.prototype.getPlayerIdle=function(){var e=this.rootStore.configStore,t=this.baseAgent&&this.baseAgent.getPlayUrl();return t&&+(0,St.eY)("agrr",t)>0?e.session&&parseInt(e.session[0],16)<8?"eg":"cg":""},t.prototype.getPlayerUserWhite=function(){var e=this.baseAgent&&this.baseAgent.getPlayUrl();if(!e)return"";switch(+(0,St.eY)("uagrr",e)){case 1:return"eg1";case 2:return"eg2";case 3:return"cg";default:return""}},t.prototype.getDynamicBuffer=function(e){var t=this,r=this.rootStore,n=r.kernelStore,i=r.configStore,o=r.qualityStore,a=n.state.mseQuotaExceeded;if(a)return 1===a?[20,5,25,20,30,10]:[20,5,25,20,20,10];var s=[[20,5,40,20,70,20],[20,5,25,20,30,10],[60,5,60,20,70,20],[60,5,60,20,70,20],[40,5,50,20,70,20],[15,0,15,0,15,5]];return s[1]=this.get4KPlusDynamicBufferGroup(),s["number"==typeof e&&s[e]?e:i.isChannel(f.u5.Homepage)?5:o.realQ>=ve.n.alias.UHD_4K?1:"eg"===t.getPlayerIdle()?2:"eg1"===t.getPlayerUserWhite()?3:"eg2"===t.getPlayerUserWhite()?4:void 0]||s[0]},t.prototype.get4KPlusDynamicBufferGroup=function(){var e,t,r=this.rootStore,n=r.kernelStore,i=r.qualityStore,o=[20,5,25,20,30,10],a=n.state.mseQuotaExceeded,s=n.dashKernel;if(a||!s)return o;try{if(T.X.safari.alike||T.X.chrome.alike){var u=i.realQ,c=null===(eo"))||void 0===e?void 0:e.bitrateList;if(null==c?void 0:c.length){var l=c.filter((function(e){return parseInt(e.id,10)===u}));if(null==l?void 0:l.length){var d=((null===(t=l[0])||void 0===t?void 0:t.bandwidth)||0)/1e3/1e3,f=5*Math.floor(150/(5*d/8*1.2));f=Math.min(f,70),f=Math.max(f,30),o[2]=30+Math.floor((f-30)/2),o[4]=f}}}}catch(e){}return o},t.prototype.checkMediaLoadStart=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t,r,i,a,s,u,c,l,d=this;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return this.isLoadStartChecked?[2]:this.rootStore.episodeStore.isFirst?T.X.microMessenger.alike?iaStore,i=e.httpStore,a=(0,Tt.t)('<div class="'.concat(v.m,'-hinter-area"></div>')),s=function(){a.onclick=null,(0,wt.b)(a)},u=function(e)=(0,At.Q)(e,r.clientWidth||720);a.style.backgroundImage='url("'.concat(n,'")')}a.onclick=function(){return t.play().then(s)},r.appendChild(a)},r.state.isLoadStart?[3,2]:[4,i.fetchViewInfo(!0)]):(this.isLoadStartChecked=!0,[2]):[2];case 1:c=n.sent(),l=c&&c.body&&c.body.pic,u(l),n.label=2;case 2:return this.dc.isLoadStart&&this.dc.isLoadStart(),this.dc.isLoadStart=(0,o.gx)((function(){return r.state.isLoadStart}),(function(){return s()})),this.isLoadStartChecked=!0,[2]}}))}))},t.prototype.cacheMediaStatus=function(e){if(this.log.i("[CIS]","keep:".concat(e)),e){var t=this.rootStore,r=t.mediaStore,n=t.configStore,i=r.video,o=n.episodeId||n.cid,a=r.state,s=a.progressTime,u=a.currentTime,c=i.currentTime,l=a.paused,d=a.duration,f=s||u||c,p=this.cachedStatus,h=!p&&d-u<1&&0===s;if(!p||p.currentTime<1||o&&o!==p.vid||Math.abs(f-p.currentTime)>.1){var y="ended:".concat(i.ended,",paused:").concat(l,",seeking:").concat(i.seeking,",").concat(f,"/").concat(d,",cpt:").concat(s,",cct:").concat(u,",vct:").concat(c,",e2r:").concat(h);if(f<1)return void this.log.i("[CIS]","ignored. ".concat(y));this.log.i("[CIS]",y),this.cachedStatus={vid:o,paused:l,currentTime:f}}}},t.prototype.attachSourceProxy=function(e){var t=this;this.log.i("[attachSourceProxy]"),this.clearBaseAgent();var r=this.rootStore,n=r.wmpStore,i=r.freeStore,a=r.mpdStore,s=r.mediaStore,u=function(e,r){(t.clearBaseAgent(),n.checkWasmPlayerSupported(e.quality,e.mediaDataSource.url),"dash"===e.mediaDataSource.type)?(t.baseAgent=new _t(t.rootStore,s.video)).attachSource(e,r):(t.baseAgent=new Et(t.rootStore,s.video)).attachSource(e);t.baseAgent.attachEvent(),
t.checkMediaLoadStart().catch(Me.Z)};if("dash"===e.mediaDataSource.type)switch(a.drmTechType){case 3:var c=a.streamKid,l=i.guardAtom.getKeyDetail(c);this.abortKeyRequest&&this.abortKeyRequest(),this.abortKeyRequest=function(){return l.abort()},l.promise.then((function(r){t.log.i("[DRM:clearKeys]","done"),u(e,{protectionData:r.protectionData})})).catch((function(e){var r=e&&e.message;l.isAbort(e)?t.log.w("[DRM:clearKeys:abort]",r):(t.log.w("[DRM:clearKeys]",r),a.fallback(5100,"clearKeys",r))}));break;case 2:var d=i.guardAtom.getWidevineDetail();this.abortKeyRequest&&this.abortKeyRequest(),this.abortKeyRequest=function(){return d.abort()},d.promise.then((function(r){t.log.i("[DRM:widevine]","done"),u(e,{protectionData:r.protectionData,ignoreEmeEncryptedEvent:!0})})).catch((function(e){var r=e&&e.message;d.isAbort(e)?t.log.w("[DRM:widevine:abort]",r):(t.log.w("[DRM:widevine]",r),a.fallback(5300,"widevine",r))}));break;default:this.log.i("[ction"==typeof this.dc.isFlvOk&&this.dc.isFlvOk(),this.dc.isFlvOk=(0,o.gx)((function(){return!!t.rootStore.assetStore.flvjs}),(function(){return u(e)}))},t.prototype.clearBaseAgent=function(){this.baseAgent&&(this.log.i("[clearBaseAgent]"),this.rootStore.kernelStore.cacheLogTimely(this.baseAgent),this.baseAgent.dispose(),this.baseAgent=null)},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.abortKeyRequest&&this.abortKeyRequest(),this.setCachedStatus(null)},t}(l),Pt=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="KernelStore",r.kernelLogs=[],r.maxKernelLogs=10,(0,o.rC)(r),r.kernelAtom=new Rt(t),r.seamlessAtom=new bt(t),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{fakeSwitching:!1,srcSwitching:!1,srcUpdating:!1,mseQuotaExceeded:!0}),Object.defineProperty(t.prototype,"retrySource",{get:function(){return this.state.srcSwitching||this.state.srcUpdating},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseAgent",{get:function(){return this.kernelAtom.baseAgent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"agentKind",{get:function(){return this.kernelAtom.agentKind},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flvKernel",{get:function(){return this.kernelAtom.flvKernel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dashKernel",{get:function(){return this.kernelAtom.dashKernel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cachedStatus",{get:function(){return this.kernelAtom.cachedStatus},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serviceModule",{get:function(){var e=this.state.aTag||"",t=this.state.vTag||"";return this.flvKernel&&t?"vtag:".concat(t):this.dashKernel&&(e||t)?"vtag:".concat(t,",atag:").concat(e):null},enumerable:!1,configurable:!0}),t.prototype.cacheLogTimely=function(e){if(e&&e.kind===st.Dash&&e.kernelPlayer){var t=e.kernelPlayer.getLogHistory().log;this.kernelLogs.push({kind:st.Dash,text:t,timeStamp:Date.now()}),this.kernelLogs.length>this.maxKernelLogs&&this.kernelLogs.shift()}},t.prototype.getPlayerIdle=function(){return this.kernelAtom.getPlayerIdle()},t.prototype.getPlayerUserWhite=function(){return this.kernelAtom.getPlayerUserWhite()},t.prototype.getDynamicBuffer=function(e){return this.kernelAtom.getDynamicBuffer(e)},t.prototype.getHistoryLogs=function(e){void 0===e&&(e=1);var t=this.kernelLogs,r=t.length,n=Math.min(e,r),i=t.slice(r-n).map((function(e){return e.text}));return this.dashKernel&&i.push(this.dashKernel.getLogHistory().log),i.join("\n-------- Section --------\n")},t.prototype.requestAudioTrack=function(e){return(0,n.mG)(this,void 0,void 0,(rack(e)]}))}))},t.prototype.geAudioTrackId():null},t.prototype.getAudioTrackList=function(){return this.dashKernel?this.dashKernel.getAudioTrackList():[]},t.prototype.attachExternal=function(e,t){var r=this,n=t.initiator,i=1===n,o=i||2===n||3===n;!!!this.mpdStore.drmTechType&&i&&this.portStore.getScreenKind()!==f.dY.Pip?(this.state.fakeSwitching&&this.log.w("dupe:fakeSwitching"),this.setState({fakeSwitching:!0}),this.seamlessAtom.fakeSwitch(e,(function(e){e&&(r.kernelAtom.clearBaseAgent(),r.kernelAtom.baseAgent=e),r.setState({fakeSwitching:!1})}))):(this.kernelAtom.cacheMediaStatus(o),this.kernelAtom.attachSourceProxy(e))},t.prototype.tryUpdateSource=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){var r=this;return(0,n.Jh)(this,(function(n){if("dash"!==e.mediaDataSource.type||!this.dashKernel)throw new Error("Illegal operation");return this.log.i("attachExternal:callUpdate"),this.state.srcUpdating&&this.log.w("dupe:srcUpdating"),this.setState({srcUpdating:!0}),[2,this.dashKernel.updateSource(e.mediaDataSource.url).then((function(){r.log.i("attachExternal:callUpdate","done"),r.track.o("video_retry_success",{from:t.from}),r.setState({srcUpdating:!1})})).catch((function(e){var n=e&&(e.msg||e.message);return r.log.w("attachExternal:callUpdate","fail",n),r.track.o("video_retry_fail",{from:t.from,msg:n}),r.setState({srcUpdating:!1}),Promise.reject(e)}))]}))}))},t.prototype.trySwitchSource=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){var r=this;return(0,n.Jh)(this,(function(n){if("dash"!==e.mediaDataSource.type||!this.dashKernel)throw new Error("Illegal operation");return this.log.i("attachExternal:callSwitch"),this.state.srcSwitching&&this.log.w("dupe:srcSwitching"),this.setState({srcSwitching:!0}),[2,this.dashKernel.switchSource(e.mediaDataSource.url,t.preloadAVData,t.enableTransition).then((function(){r.log.i("attachExternal:callSwitch","done"),r.setState({srcSwitching:!1})})).catch((function(e){var t=e&&(e.msg||e.message);return r.log.w("attachExternal:callSwitch","fail",t),r.setState({srcSwitching:!1}),Promise.reject(e)}))]}))}))},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.ddyState()},t.prototype.onDisconnect=function(){e.prototype.onDisconne&&e.apply(this,arguments)||this;return t.tag="RecoveryAtom",t.irc=0,t.retryCount=0,t.backupUrlIndex=0,t.resumeStartTime=0,t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"retryInterval",{get:function(){var e=this.rootn(t,e)},enumerable:!1,configurable:!0}),t.prototype.resetResuming=function(){this.resumeStartTime&&(this.resumeStartTime=0)},t.prototype.resetCounter=function(){this.backupUrlIndex=0,this.resumeStartTime=0},t.prototype.resume=function(e){var t=this,r="[Resume]",n=Date.now();if(this.resumeStartTime&&n-this.resumeStartTime<50)return this.log.w(r,"dupe,initiator:".concat(e));if(this.resumeStartTime=n,this.log.i(r,"initiator:".concat(e)),this.tryFlvBackupUrl(1))this.log.i(r,"try flv backup url");else{var i=this.rootStore.mpdStore.prefetchPlayUrl();this.retryHttp&&this.log.w(r,"http dupe"),this.retryHttp=i.http,i.promise.then((function(n){if(!(n&&n.body&&n.body.mediaDataSource))throw new Error("Invalid data");t.log.i(r,"playurl:done"),t.rootStaSource:n.body.mediaDataSource,quality:n.body.quality},{from:5,initiator:e}).catch((function(){return t.infiniteRetry(e,50)})),t.retryHttp=null})).catch((function(n){t.log.w(r,"playurl:fail",n&&n.message),t.infiniteRetry(e,50),t.retryHttp=null}))}},t.prototype.getRetryCount=function(){return this.retryCount},t.prototype.abortRetry=function(){this.clearTimeout(this.retryTimer),this.retryTimer=null,this.irc=0)},t.prototype.startRetry=function(e){this.infiniteRetry(e,50)},t.prototype.infiniteRetry=function(e,t){var r=this,n="[InfiniteRetry]";if(this.retryTimer)return this.log.w(n,"dupe,initiator:".concat(e));var i=0===this.irc&&t||this.retryInterval
;this.log.i(n,"initiator:".concat(e,",interval:").concat(i)),clearTimeout(this.retryTimer),this.retryTimer=window.setTimeout((function(){r.retryTimer=null,r.rootStore.mpdStore.fetchPlayUrl(null,{initiator:e}),r.irc+=1,r.retryCount+=1}),i)},t.prototype.isUrlExpired=function(){var e=this.rootStore.portStore.getPlayUrl();if(!e)return!1;var t=Math.ceil(Date.now()/1e3),r=+((0,St.eY)("expires",e)||(0,St.eY)("wsTime",e)||(0,St.eY)("txTime",e)||(0,St.eY)("um_deadline",e)||(0,St.eY)("deadline",e));return!!r&&t>r},t.prototype.tryFlvBackupUrl=function(e){var t,r,i=this,o=this.rootStore,a=o.kernelStore,s=o.mpdStore,u=o.qualityStore;if(!a.flvKernel)return!1;if(e>=this.backupUrlIndex)return!1;var c=!1,l={},d=[],f=s.body,p=f&&f.mediaDataSource;if(p&&Array.isArray(p.segments)){try{for(var h=(0,n.XA)(p.segments),y=h.next();!y.done;y=h.next()){var m=y.value,g=m.backupURL[this.backupUrlIndex],v={};if(!g){c=!1;break}(0,Ze.Z)(v,m),v.url=g,d.push(v),c=!0}}catch(e){t={error:e}}finally{try{y&&!y.done&&(r=h.return)&&r.call(h)}finally{if(t)throw t.error}}c&&(0,Ze.Z)(l,p,{segments:d})}else if(p&&Array.isArray(p.backupURL)){(g=p.backupURL[this.backupUrlIndex])?(c=!0,(0,Ze.Z)(l,p,{url:g})):c=!1}return c&&(this.log.i("","backupUrlIndex:".clIndex+=1,a.tryUpdateSource({mediaDataSource:l,quality:u.requestQ},{from:4,initiator:2}).catch((function(){return i.infiniteRetry(2,50)}))),c},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.abortRetry(),this.resetResuming(),this.irc=0,this.retryCount=0,this.backupUrlIndex=0,this.resumeStartTime=0,this.retryHttp&&this.retryHttp.dispose(le.eV.LIFECYCLE_TOKEN)},t}(l),Ot=functiPLAYER_STORE_MOUNT,(function(){r.addReaction(),r.addStuckEvent(),r.addPlayUrlEvent(),r.addDashEvent(),r.addFlvEvent(),r.addMediaEvent()})),r}return(0,n.ZT)(t,e),t.prototype.addReaction=function(){var e=this;this.dc.retrySource=(0,o.U5)((function(){return e.rootStore.kernelStore.retrySource}),(function(t){return!t&&e.recoveryAtom.resetResuming()}))},t.prototype.addStuckEvent=function(){var e=this;this.rootPlayer.on(s.p.PLAYER_PLAYBACK_LAG,(function(){var t=e.rootStore,r=t.kernelStore,n=t.mediaStore,i=r.dashKernel;if(i){var o=n.video;if(i&&"function"==typeof i.isLoadingFragment){var a=i.getBufferLength("video"),s=i.getBufferLength("audio"),u=o.buffered,c="web_videoload_lag",l=u&&u.length>1?"".concat(c,",").concat(u.end(0),",").concat(u.start(1)):c;((isNaN(a)||a<.01)&&!i.isLoadingFragment("video")||(isNaN(s)||s<.01)&&!i.isLoadingFragment("audio"))&&e.errProxy(4100,l)}}}))},t.prototype.addPlayUrlEvent=function(){var e=this;this.rootPlayer.on(s.p.ERROR_PLAY_URL,(function(t,r){var n=e.rootStore,i=n.errorStore,o=n.kernelStore,a=n.configStore,s=n.qualityStore,u=n.mpdStore;switch(r){case 0:i.setState({initError:!0}),e.track.o("video_error",{code:3001,from:1}),e.log.w(""),o.attachExternal({quality:0,mediaDataSource:{type:"mp4",url:a.errorUrl}},{initiator:r});break;case 2:e.track.o("video_error",{code:3001,from:2}),e.track.o("video_retry_fail",{from:2}),e.recoveryAtom.startRetry(2);break;case 1:e.track.o("video_error",{code:3001,from:3}),s.setRenderedQuality(t,s.state.nowQuality);break;default:e.log.e("[PlayUrl]: UnhandledError"),e.track.o("video_error",{code:3001,from:0})}e.log.i("[PlayUrlCode]",u.state.playUrlCode),e.notify(t.message,0)}))},t.prototype.addDashEvent=function(){var e=this;this.rootPlayer.on(s.p.ERROR_DASH_INITIALIZE,(function(t){e.errProxy(4e3,"dashPlayer initializing error."),e.recoveryAtom.startRetry(2),e.notify(t.message,1)})),this.rootPlayer.on(s.p.ERROR_DASH_KERNEL,(function(t){var r=e.rootStore,n=r.errorStore,i=r.qualityStore,o=$e().ERROR,a=0===i.quality;switch(n.setState({kernelError:!0}),t&&t.detail&&t.detail.httpCode&&e.track.o("load_videoerror_code",{code:t.detail.httpCode}),t&&t.code&&e.errProxy(t.code,t.msg),t&&t.code){case o.DURATION_IS_NOT_ALL_EQUAL:e.log.w("isAutoQuality:".concat(a,";").concat(t.msg)),a||e.recoveryAtom.resume(1);break;case o.MANIFEST_ERROR:case o.MANIFEST_TYPE_ERROR:case o.MANIFEST_RESOLVE_ERROR:case o.DOWNLOAD_MPD_ERROR:case o.DOWNLOAD_XINK_ERROR:e.recoveryAtom.resume(2);break;case o.MEDIA_SUPPORTED_ERROR:n.setState({disableNonDAQ:!0}),e.recoveryAtom.startRetry(2);break;case o.MEDIA_DECODE_ERROR:e.recoveryAtom.startRetry(2);break;case o.MEDIA_ERROR:case o.MEDIA_ABORTED_ERROR:case o.MEDIA_ENCRYPTED_ERROR:case o.MEDIA_NETWORK_ERROR:case o.MEDIA_UNKNOWN_ERROR:e.recoveryAtom.resume(2);break;case o.INTERNAL_ERROR:case o.DURATION_DEVIATION_IS_TOO_LARGE:case o.START_OFFSET_TIME_WARNING:case o.DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS:e.log.e("Fatal err or warning, retry is useless");break;case o.DOWNLOAD_ERROR:case o.DOWNLOAD_INIT_SEGMENT_ERROR:case o.DOWNLOAD_MEDIA_SEGMENT_ERROR:case o.DOWNLOAD_INDEX_SEGMENT_ERROR:case o.DOWNLOAD_SWITCHING_SEGMENT_ERROR:case o.DOWNLOAD_OTHER_ERROR:case o.DOWNLOAD_FRAGMENT_ERROR:case o.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE:case o.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT:case o.CONNECT_FRAGMENT_ERROR_TIMEOUT:default:e.recoveryAtom.resume(2)}e.notify("".concat(t.code,";").concat(t.msg),2)}))},t.prototype.addFlvEvent=function(){var e=this;this.rootPlayer.on(s.p.ERROR_FLV_KERNEL,(function(t,r,n){var i=e.rootStore,o=i.errorStore,a=i.assetStore,s=a.flvjs.ErrorTypes,u=a.flvjs.ErrorDetails,c=n&&n.msg,l=n&&n.code,d="[".concat(t,"] ").concat(r,": ").concat(-1!==l?l:c);switch(o.setState({kernelError:!0}),t){case s.MEDIA_ERROR:switch(r){case u.MEDIA_MSE_ERROR:e.errProxy(3121,d);break;case u.MEDIA_FORMAT_ERROR:e.errProxy(3122,d);break;case u.MEDIA_FORMAT_UNSUPPORTED:e.errProxy(3123,d);break;case u.MEDIA_CODEC_UNSUPPORTED:e.errProxy(3124,d)}break;case s.NETWORK_ERROR:switch(r){case u.NETWORK_EXCEPTION:e.errProxy(3111,d);break;case u.NETWORK_STATUS_CODE_INVALID:e.track.o("load_videoerror_code",{code:l}),e.errProxy(3112,d);break;case u.NETWORK_UNRECOVERABLE_EARLY_EOF:e.errProxy(3113,d)}break;case s.OTHER_ERROR:default:if(r===u.ABNORMAL_SEGMENT_BYTELENGTH)e.track.o("abnormal_segment_bytelength_error"),e.errProxy(3125,d)}switch(t){case s.MEDIA_ERROR:case s.NETWORK_ERROR:case s.OTHER_ERROR:}e.isFlvKernel(!1)&&e.recoveryAtom.resume(2),e.notify("".concat(t,";").concat(r,";").concat(n.code,";").concat(n.msg),3)}))},t.prototype.addMediaEvent=function(){var e=this;this.rootPlayer.on(s.p.MEDIA_ERROR,(function(){var t=e.rootStore,r=t.wmpStore,n=t.mediaStore,i=t.errorStore,o=t.qualityStore,a=r.isUseWasmPlayer(n.video),s=a?n.video.bwpError:n.video.error,u=null==s?void 0:s.code;if(s||console.warn("Illegal argument of [MediaError]"),a&&u>=7e3&&u<=7015&&(r.onWasmPlayerError(n.video,s),o.switchProxy()),4===u)i.setState({disableNonDAQ:!0});switch(u){case 1:case 3:case 4:e.isFlvKernel(!0)&&(e.errProxy(3104,"[MediaError] Exception: ".concat(null==s?void 0:s.message)),e.recoveryAtom.resume(2));break;default:e.isFlvKernel(!0)&&(e.errProxy(3104,"[NetworkError] Exception: 3104 Failed to fetch, ".concat(null==s?void 0:s.message)),e.recoveryAtom.resume(2))}e.notify(null==s?void 0:s.message,4)})),this.rootPlayer.on(s.p.MEDIA_CANPLAY,(function(){var t=e.rootStore.errorStore;t.state.kernelError&&t.setState({kernelError:!1})}))},t.prototype.errProxy=function(e,t){var r,n=this.rootStore,i=n.portStore,o=n.mpdStore,a=n.errorStore,s=i.getPlayUrl(),u=t&&t.replace(/,/g,"."),c=(null===(r=o.body)||void 0===r?void 0:r.streamType)||null,l="type:".concat(c,",url:").concat(s,",message:").concat(u);this.log.w("code:".concat(e,",").concat(l)),a.err(3,e,l)},t.prototype.isFlvKernel=function(e){var t=this.rootStore.kernelStore.flvKernel;return!!t&&(e?"FlvPlayer"!==t.type:"FlvPlayer"===t.type)},t.prototype.notify=function(e,t){var r="...",n=null==t?r:"".concat(r,"(from:").concat(t,")"),i=this.rootStore.mediaStore,o="".concat(i.state.currentTime,"/").concat(i.state.bufferedTime);this.log.e(n,e,o)},t}(l),It=function(e){function t(t){var r=eturn(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{initError:!1,kernelError:!1,disableNonDAQ:!1,
occurredFatalError:!1}},enumerable:!1,confithis;e.prototype.onMount.call(this),this.dc.disableNonDAQ=(0,o.gx)((function(){return t.state.disableNonDAQ}),(function(){return t.log.w("[NonDAQ]","disabled")}))},t.prototype.err=function(e,t,r){if(e){var n=r||!0,i=this.codeRecord[t];this.setState({occurredFatalError:!0}),i&&i===n||(this.codeRecord[t]=n,this.track.o("web_videoload_fail",{kind:e,code:t,msg:r}))}},t.prototype.abortRetr.prototype.resetCountetype.getRetryCount=function()ispose=function(){e.prototype.onDispose.call(this),this.codeRecord={}},t.prototype.occurredFatalErr=function(){return this.state&&this.state.occurredFatalError},t}(d),Ct=function(){function e(e){this.cfs=null,this.fss=[{fullscreenEnabled:"fullscreenEnabled",fullscreenElement:"fullscreenElement",onfullscreenchange:"onfullscreenchange",onfullscreenerror:"onfullscreenerror",requestFullscreen:"requestFullscreen",exitFullscreen:"exitFullscreen",fullscreenchange:"fullscreenchange",fullscreenerror:"fullscreenerror"},{fullscreenEnabled:"webkitFullscreenEnabled",fullscreenElement:"webkitFullscreenElement",onfullscreenchange:"onwebkitfullscreenchange",onfullscreenerror:"onwebkitfullscreenerror",requestFullscreen:"webkitRequestFullscreen",exitFullscreen:"webkitExitFullscreen",fullscreenchange:"webkitfullscreenchange",fullscreenerror:"webkitfullscreenerror"},{fullscreenEnabled:"mozFullScreenEnabled",fullscreenElement:"mozFullScreenElement",onfullscreenchange:"onmozfullscreenchange",onfullscreenerror:"onmozfullscreenerror",requestFullscreen:"mozRequestFullScreen",exitFullscreen:"mozCancelFullScreen",fullscreenchange:"mozfullscreenchange",fullscreenerror:"mozfullscreenerror"},{fullscreenEnabled:"msFullscreenEnabled",fullscreenElement:"msFullscreenElement",onfullscreenchange:"onmsfullscreenchange",onfullscreenerror:"onmsfullscreenerror",requestFullscreen:"msRequestFullscreen",exitFullscreen:"msExitFullscreen",fullscreenchange:"MSFullscreenChange",fullscreenerror:"MSFullscreenError"}],this.ele=e,this.doc=this.ele.ownerDocument||document,this.win=this.doc.defaultView||window;for(var t=0;t<this.fss.length;t++)if(this.fss[t].fullscreenEnabled in this.doc){this.cfs=this.fss[t];break}}return Object.defineProperty(e.prototype,"hasElementEvent",{get:function(){return!!this.cfs&&(this.cfs.onfullscreenchange in this.ele&&this.cfs.onfullscreenerror in this.ele)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentElement",{get:function(){return this.ele},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullscreenMapping",{get:function(){return this.cfs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullscreenEnabled",{get:function(){return!!this.cfs&&Boolean(this.doc[this.cfs.fullscreenEnabled])},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullscreenElement",{get:function(){return this.cfs&&this.doc[this.cfs.fullscreenElement]||null},enumerable:!1,configurable:!0}),e.prototype.getBrowsingContextPromise=function(){var e=this.win.Promise;return"function"==typeof e&&"function"==typeof e.resolve&&"function"==typeof e.reject?e:null},e.prototype.requestFullscreen=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t,r,i=this;return(0,n.Jh)(this,(function(n){if(this.cfs)return t=new Promise((function(e,t){var r=function(t){i.fullscreenElement===i.currentElement&&(i.removeElementListener("fullscreenchange",r,!0),i.removeElementListener("fullscreenerror",n,!0),i.removeListener("fullscreenchange",r),i.removeListener("fullscreenerror",n),e())},n=function(e){i.fullscreenElement!==i.currentElement&&(i.removeElementListener("fullscreenchange",r,!0),i.removeElementListener("fullscreenerror",n,!0),i.removeListener("fullscreenchange",r),i.removeListener("fullscreenerror",n),t())};i.addElementListener("fullscreenchange",r,!0),i.addElementListener("fullscreenerror",n,!0),i.addListener("fullscreenchange",r),i.addListener("fullscreenerror",n)})),(r=this.ele[this.cfs.requestFullscreen](e))&&"function"==typeof r.then&&"function"==typeof r.catch?[2,r]:[2,t];throw new Error("Fullscreen is not supported")}))}))},e.prototype.exitFullscreen=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t,r=this;return(0,n.Jh)(this,(function(n){if(this.cfs)return e=new Promise((function(e,t){var n=function(t){r.fullscreenElement!==r.currentElement&&(r.removeElementListener("fullscreenchange",n,!0),r.removeElementListener("fullscreenerror",i,!0),r.removeListener("fullscreenchange",n),r.removeListener("fullscreenerror",i),e())},i=function(e){r.fullscreenElement===r.currentElement&&(r.removeElementListener("fullscreenchange",n,!0),r.removeElementListener("fullscreenerror",i,!0),r.removeListener("fullscreenchange",n),r.removeListener("fullscreenerror",i),t())};r.addElementListener("fullscreenchange",n,!0),r.addElementListener("fullscreenerror",i,!0),r.addListener("fullscreenchange",n),r.addListener("fullscreenerror",i)})),(t=this.doc[this.cfs.exitFullscreen]())&&"function"==typeof t.then&&"function"==typeof t.catch?[2,t]:[2,e];throw new Error("Fullscreen is not supported")}))}))},Object.defineProperty(e.prototype,"onfullscreenchange",{get:function(){return this.cfs?this.ele[this.cfs.onfullscreenchange]:null}enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onfullscreenerror",{get:function(){return this.cfs?this.ele[this.cfs.onfullscreenerror]:null},set:function(e){this.cfs&&(this.ele[this.cfs.onfullscreenerror]=e)},enumerable:!1,configurable:!0}),e.prototype.addElementListener=function(e,t,r){this.cfs&&this.ele.addEventListener(this.cfs[e],t,r)},e.prototype.removeElementListener=function(e,t,r){this.cfs&&this.ele.removeEventListener(this.cfs[e],t,r)},e.prototype.addListener=function(e,t,r){this.cfs&&this.doc.addEventListener(this.cfs[e],t,r)},e.prototype.removeListener=function(e,t,r){this.cfs&&this.doc.removeEventListener(this.cfs[e],t,r)},e}(),Nt=function(){function e(e){this.vid=e,this.doc=this.vid.ownerDocument||document,this.win=this.doc.defaultView||window,"function"==typeof this.vid.requestPictureInPicture?this.pipKind=1:"function"==typeof this.vid.webkitSetPresentationMode?this.pipKind=2:this.pipKind=0}return Object.defineProperty(e.prototype,"currentElement",{get:function(){return this.vid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pipEntered",{get:function(){return 2===this.pipKind?"picture-in-picture"===this.vid.webkitPresentationMode:this.pipElement===this.vid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pipEnabled",{get:function(){return 2===this.pipKind?this.vid.webkitSupportsPresentationMode("picture-in-picture"):this.doc.pictureInPictureEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pipElement",{get:function(){return this.doc.pictureInPictureElement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoPip",{get:function(){return this.vid.autoPictureInPicture},set:function(e){this.vid.autoPictureInPicture=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disablePip",{get:function(){return this.vid.disablePictureInPicture},set:function(e){this.vid.disablePictureInPicture=e},enumerable:!1,configurable:!0}),e.prototype.requestPip=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e=this;return(0,n.Jh)(this,(function(t){if(2===this.pipKind){if(this.pipEnabled)return[2,new Promise((function(t){var r=e.vid.onwebkitpresentationmodechanged;e.vid.onwebkitpresentationmodechanged=function(n){"function"==typeof r&&r(n),e.pipEntered&&(e.vid.onwebkitpresentationmodechanged=r,t())},e.vid.webkitSetPresentationMode("picture-in-picture")}))];throw new Error("Picture-in-Picture not supported")}return[2,this.vid.requestPictureInPicture()]}))}))},e.prototype.exitPip=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e=this;return(0,n.Jh)(this,(function(t){
return 2===this.pipKind?[2,new Promise((function(t){var r=e.vid.onwebkitpresentationmodechanged;e.vid.onwebkitpresentationmodechanged=function(n){"function"==typeof r&&r(n),e.pipEntered||(e.vid.onwebkitpresentationmodechanged=r,t())},e.vid.webkitSetPresentationMo))}))},e.prototype.addListener=function(e,t,r){this.vid.addEventListener(e,t,r)},e.prototype.removeListener=function(e,t,r){this.vid.removeEventListener(e,t,r)},e}(),kt=function(e){function t(){var t,r,n=null!==e&&e.apply(this,arguments)||this;return n.tag="StatueStore",n.delayEventTimer=null,n.lastChanged=((t={})[f.dY.Normal]=0,t[f.dY.Wide]=0,t[f.dY.Web]=0,t[f.dY.Mini]=0,t[f.dY.Full]=0,t[f.dY.Pip]=0,t),n.rollbackPath=((r={})[f.dY.Normal]=[],r[f.dY.Wide]=[f.dY.Normal],r[f.dY.Web]=[f.dY.Normal,f.dY.Wide],r[f.dY.Mini]=[f.dY.Normal,f.dY.Wide],r[f.dY.Full]=[f.dY.Normal,f.dY.Wide],r[f.dY.Pip]=[f.dY.Normal,f.dY.Wide,f.dY.Web],r),n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"hasPipFn",{get:function(){return this.ps?0!==this.ps.pipKind:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pipEnabled",{get:function(){return this.ps?this.ps.pipEnabled:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasFullscreenFn",{get:function(){return this.fs?!!this.fs.fullscreenMapping:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullscreenEnabled",{get:function(){return this.fs?this.fs.fullscreenEnabled:null},enumerable:!1,configurable:!0}),t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.fs=new Ct(this.nodes.container),this.ps=new Nt(this.mediaStore.video),this.dc.mainScreenChanged=(0,o.EH)((function(){t.lastChanged[t.uiStore.state.mainScreen]=performance.now()})),this.dc.sideScreenChanged=(0,o.EH)((function(){null!=t.uiStore.state.sideScreen&&(t.lastChanged[t.uiStore.state.sideScreen]=performance.now())})),this.log.i("M_Fullscreen:".concat(this.fs.hasElementEvent)),this.rootPlayer.on(s.p.PLAYER_MEDIA_CHANGED,(function(){return(0,n.mG)(t,void 0,void 0,(function(){return(0,n.Jh)(this,(function(e){switch(e.label){case 0:if(!this.ps||this.ps.currentElement===this.mediaStore.video||!this.ps.pipEntered)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.ps.exitPip()];case 2:return e.sent(),[3,4];case 3:return e.sent(),[3,4];case 4:return this.removeEvents(),this.ps=new Nt(this.mediaStore.video),this.addEvents(),[2]}}))}))})),this.addEvents()},t.prototype.requestStatue=function(e,t,r){return(0,n.mG)(this,void 0,void 0,(function(){var i,o,a,s,u=this;return(0,n.Jh)(this,(function(c){switch(c.label){case 0:if(this.log.i("[requestStatue]",He(gt||(gt=(0,n.cy)(["kind:",",canExitPip:",",alt:",""],["kind:",",canExitPip:",",alt:",""])),e,t,r)),null==e)return[2,this.backwardStatue(t)];switch(this.removeDelayEvents(),e){case f.dY.Normal:case f.dY.Wide:case f.dY.Web:case f.dY.Mini:return[3,1];case f.dY.Full:return[3,5];case f.dY.Pip:return[3,6]}return[3,7];case 1:return[4,this.exitBrowserScreen(f.dY.Full)];case 2:return c.sent(),t?[4,this.exitBrowserScreen(f.dY.Pip)]:[3,4];case 3:c.sent(),c.label=4;case 4:return i=this.ps&&this.ps.pipElement===this.mediaStore.video,o=!t&&i?f.dY.Pip:null,this.uiStore.setState({mainScreen:e,sideScreen:o}),this.addDelayEvents(),[2];case 5:return a=this.exitBrowserScreen(f.dY.Pip),[2,this.fs.requestFullscreen().then((function(t){return(0,n.mG)(u,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){switch(t.label){case 0:return[4,a];case 1:return t.sent()?this.uiStore.setState({mainScreen:this.getPastScreenDetails().kind,sideScreen:e}):this.uiStore.setState({sideScreen:e}),this.addDelayEvents(),[2]}}))}))})).catch((function(e){return(0,n.mG)(u,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){switch(t.label){case 0:return e&&e.message&&this.log.w("[FullscreenError]",e.message),[4,a];case 1:return t.sent(),this.fixSideScreen(f.dY.Pip),this.addDelayEvents(),[2,Promise.reject(e)]}}))}))}))];case 6:return s=this.exitBrowserScreen(f.dY.Full),[2,this.ps.requestPip().then((function(t){return(0,n.mG)(u,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){switch(t.label){case 0:return[4,s];case 1:return t.sent()?this.uiStore.setState({mainScreen:this.getPastScreenDetails().kind,sideScreen:e}):this.uiStore.setState({sideScreen:e}),this.addDelayEvents(),[2]}}))}))})).catch((function(e){return(0,n.mG)(u,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){switch(t.label){case 0:return e&&e.message&&this.log.w("[PipScreenError]",e.message),[4,s];case 1:return t.sent(),this.fixSideScreen(f.dY.Full),this.addDelayEvents(),[2,Promise.reject(e)]}}))}))}))];case 7:throw new Error("Illegal argument")}}))}))},t.prototype.backwardStatue=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t,r;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:switch(t=!e,r=this.portStore.getScreenKind(t),r){case f.dY.Pip:return[3,1];case f.dY.Full:return[3,3]}return[3,5];case 1:return[4,this.exitBrowserScreen(f.dY.Pip)];case 2:case 4:case 6:return n.sent(),[3,7];case 3:return[4,this.exitBrowserScreen(f.dY.Full)];case 5:return[4,this.requestStatue(this.getPastScreenDetails(r).kind,e)];case 7:return[2]}}))}))},t.prototype.fixSideScreen=function(e){var t="fixSideScreen",r=this.uiStore.state.sideScreen;if(this.log.i(t,"".concat(e,"/").concat(r)),r===e){var n=null;this.fs&&this.fs.fullscreenElement===this.fs.currentElement&&(n=f.dY.Full),this.ps&&this.ps.pipElement===this.ps.currentElement&&(n=f.dY.Pip),this.log.w(t,"".concat(r," to ").concat(n)),this.uiStore.setState({sideScreen:n})}},t.prototype.exitBrowserScreen=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){switch(t.label){case 0:return e!==f.dY.Full?[3,3]:this.fs&&this.fs.fullscreenElement?[4,this.fs.exitFullscreen()]:[3,2];case 1:return t.sent(),[2,!0];case 2:this.fixSideScreen(e),t.label=3;case 3:return e!==f.dY.Pip?[3,6]:this.ps&&this.ps.pi}))}))},t.prototype.addDelayEvents=function(){var e=this;this.removeDelayEvents(),this.delayEventTimer=window.setTimeout((function(){return e.addEvents()}),50)},t.prototype.removeDelayEvents=function(){null==this.delayEventTimer&&(clearTimeout(this.delayEventTimer),this.delaystScreenDetails=function(e){var t=this,r=this.rollbackPath[null!=e?e:this.portStore.getScreenKind()].map((function(e){return{kind:e,timeStamp:t.lastChanged[e]}})).sort((function(e,t){return t.timeStamp-e.timeStamp}))[0];return r?{kind:r.kind,isTrusted:!0}:{kind:f.dY.Normal,isTrusted:!1}},t.prototype.addEvents=function(){this.fs.hasElementEvent?(this.fs.addElementListener("fullscreenchange",this.onFullscreenChange),this.fs.addElementListener("fullscreenerror",this.onFullscreenError)):(this.fs.addListener("fullscreenchange",this.onFullscreenChange),this.fs.addListener("fullscreenerror",this.onFullscreenError)),2===this.ps.pipKind?this.ps.addListener("webkitpresentationmodechanged",this.onPipChange):(this.ps.addListener("enterpictureinpicture",this.onPipEnter),this.ps.addListener("leavepictureinpicture",this.onPipLeave))},t.prototype.removeEvents=function(){this.fs&&(this.fs.removeElementListener("fullscreenchange",this.onFullscreenChange),this.fs.removeElementListener("fullscreenerror",this.onFullscreenError),this.fs.removeListener("fullscreenchange",this.onFullscreenChange),this.fs.removeListener("fullscreenerror",this.onFullscreenError)),this.ps&&(this.ps.removeListener("enterpictureinpicture",this.onPipEnter),this.ps.removeListener("leavepictureinpicture",this.onPipLeave),this.ps.removeListener("webkitpresentationmodechanged",this.onPipChange))},t.prototype.onFullscreenChange=function(){this.fs&&(this.fs.fullscreenElement===this.fs.currentElement?th:this.uiStore.setState({type.onFullscreenError=function(){this.log.w("Fullscreen error")},t.prototype.onPipChange=function(e){
this.ps.pipEntered?this.onPipEnter(e):this.onPipLeave(e)},t.prototype.onPipEnter=function(e){var t=e.pictureInPictureWindow;t&&(this.uiStore.setState({pipWindowWidth:t.width,pipWindowHeight:t.height}),t.addEventListener("resize",this.onPipWindowResize)),this.uiStore.setState({sideScreen:f.dY.Pip})},t.prototype.onPipLeave=function(e){var t=this.fs,r=e.pictureInPictureWindow;r&&(this.uiStore.setState({pipWindowWidth:r.width,pipWindowHeight:r.height}),r.removeEventListener("resize",this.onPipWindowResize)),t&&t.fullscreenElement===t.currentElement?(this.log.i("[iPad]","Pip -> Fullscreen"),this.uiStore.setState({sideScreen:f.dY.Full})):this.uiStore.setState({mainScreen:this.getPastScreenDetails().kind,sideScreen:null})},t.prototype.onPipWindowResize=function(e){if(e.target){var t=e.target.width,r=e.target.height;"number"==typeof t&&"number"==typeof r&&this.uiStore.setState({pipWindowWidth:t,pipWindowHeight:r})}},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),this.exitBrowserScreen(f.dY.Pip),this.removeDelayEvents(),this.removeEvents()},(0,n.gn)([i.ZP],t.prototype,"onFullscreenChange",null),(0,n.gn)([i.ZP],t.prototype,"onFullscreenError",null),(0,n.gn)([i.ZP],t.prototype,"onPipChange",null),(0,n.gn)([i.ZP],t.prototype,"onPipEnter",null),(0,n.gn)([i.ZP],t.prototype,"onPipLeave",null),(0,n.gn)([i.ZP],t.prototype,"onPipWindowResize",null),t}(d),Lt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmSend",t.url="//api.bilibili.com/x/v2/dm/post",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){var t=e.data||{};return{code:e.code,message:e.message,dmid:t.dmid_str,visible:t.visible,action:t.action,animation:t.animation,dm_content:t.dm_content}},t}(le.eV),xt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpFirstShowSend",t.url="//api.bilibili.com/x/v2/dm/post2",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){var t=e.data||{};return{code:e.code,message:e.message,dmid:t.dmid_str,visible:t.visible,action:t.action,animation:t.animation}},t}(le.eV),Mt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmCmdSend",t.url="//api.bilibili.com/x/v2/dm/command/post",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){var t=e.data||{};return{code:e.code,message:e.message,dmid:t.idStr,extra:t.extra}},t}(le.eV),Ft=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmCmdDel",t.url="//api.bilibili.com/x/v2/dm/command/del",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){return{code:e.code,message:e.message}},t}(le.eV),Ut=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpOnlineNum",t.url="//api.bilibili.com/x/player/online/total",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,params:e,withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){var t,r,n=null==e?void 0:e.data;return{total:(null==n?void 0:n.total)||"-",count:(null==n?void 0:n.count)||"<10",showSwitch:{total:null===(t=null==n?void 0:n.show_switch)||void 0===t?void 0:t.total,count:null===(r=null==n?void 0:n.show_switch)||void 0===r?void 0:r.count}}},t}(le.eV),Bt=function(e){function t(t){var r=e.call(this,t)||this;return(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{status:null,mid:null,level:null,dmRights:null,focus:!1,forceOn:!1,err:null,webNum:"-",allNum:"-",showWeb:!0,showAll:!0,postPanelCard:null,outSendMsg:null}},enumerable:!1,configurable:!0}),t.prototype.onMounted=function(){var t=this;e.prototype.onMounted.call(this),this.configStore.fromDid&&(this.setState({forceOn:!0}),this.forceOn=!0),this.dc.dmVisible=(0,o.U5)((ion(){t.rootPlayer.emit(a.t.Player_Danmaku_Change,new CustomEvent(a.t.Player_Danmaku_Change))})),this.dc.forceDm=(0,o.EH)((function(){t.forceOn=t.state.forceOn}))},t.prototype.onLoaded=function(t){e.prototype.onLoaded.call(this,t),this.setState({err:t.err,mid:t.mid,level:t.level,dmRights:t.dmRights})},Object.defineProperty(t.prototype,"status",{get:function(){var e,t,r=this.state.status,n=(e=this.danmakuStore.state).isViewLoaded,i=e.state,o=e.checkBox,a=this.userStore.info,s=this.state.status;if(!this.userStore.isLogin)return Le.Rs.SEND_STATUS_LOGOUT;if(n)switch(i){case 0:o&&this.localStore.get().dmSend.upDm&&(r=Le.Rs.SEND_STATUS_UP_DM);break;case 1:return Le.Rs.SEND_STATUS_CLOSED;case 2:return Le.Rs.SEND_STATUS_UPDATE}return"number"==typeof(null===(t=null==a?void 0:a.dmRights)||void 0===t?void 0:t.initStatus)&&(r=a.dmRights.initStatus),null!==s&&(r=s),r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dmVisible",{get:function(){var e=this.dmSettingStore.state.dmSwitch,t=this.dmSettingStore.state.dmSwitchOut;return!this.danmakuStore.state.state&&(!!this.forceOn||("boolean"==typeof t&&(e=t),e))},enumerable:!1,configurable:!0}),t.prototype.send=function(e){return new Lt(this.rootPlayer).r((0,n.pi)((0,n.pi)({},e),{polaris_appid:100,polaris_platfrom:5,spmid:this.configStore.spmId,from_spmid:this.configStore.spmIdFrom}))},t.prototype.firstShowSend=function(e){return new xt(this.rootPlayer).r(e)},t.prototype.cmdSend=function(e){return new Mt(this.rootPlayer).r(e)},t.prototype.cmdDel=function(e){return new Ft(this.rootPlayer).r({dmid:e,oid:this.configStore.cid})},t.prototype.onlineNum=function(e){return new Ut(this.rootPlayer,{noStore:!0}).r(e)},(0,n.gn)([o.Fl],t.prototype,"status",null),(0,n.gn)([o.Fl],t.prototype,"dmVisible",null),t}(d),jt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmid",t.url="//api.bilibili.com/x/v2/dm/thumbup/detail",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,params:e,withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){var t=e.data||{};return{dmid:t.dmid_str,likes:t.likes||1,liked:t.user_like,mode:t.mode,color:t.color,size:t.font_size,pool:t.pool,attr:t.attr,stime:t.progress/1e3||0,text:t.msg||""}},t
}(le.eV),Vt=JSON.parse('{"nested":{"bilibili":{"nested":{"community":{"nested":{"service":{"nested":{"dm":{"nested":{"v1":{"nested":{"DmWebViewReply":{"fields":{"state":{"type":"int32","id":1},"text":{"type":"string","id":2},"textSide":{"type":"string","id":3},"dmSge":{"type":"DmSegConfig","id":4},"flag":{"type":"DanmakuFlagConfig","id":5},"specialDms":{"rule":"repeated","type":"string","id":6},"checkBox":{"type":"bool","id":7},"count":{"type":"int64","id":8},"commandDms":{"rule":"repeated","type":"CommandDm","id":9},"dmSetting":{"type":"DanmuWebPlayerConfig","id":10},"reportFilter":{"rule":"repeated","type":"string","id":11},"expressions":{"rule":"repeated","type":"Expressions","id":12},"postPanel":{"rule":"repeated","type":"PostPanel","id":13},"activityMetas":{"rule":"repeated","type":"string","id":14},"postPanelV2":{"rule":"repeated","type":"PostPanelV2","id":15}}},"PostPanel":{"fields":{"start":{"type":"int64","id":1},"end":{"type":"int64","id":2},"priority":{"type":"int64","id":3},"bizId":{"type":"int64","id":4},"bizType":{"type":"PostPanelBizType","id":5},"clickButton":{"type":"ClickButton","id":6},"textInput":{"type":"TextInput","id":7},"checkBox":{"type":"CheckBox","id":8},"toast":{"type":"Toast","id":9}}},"PostPanelV2":{"fields":{"start":{"type":"int64","id":1},"end":{"type":"int64","id":2},"bizType":{"type":"PostPanelBizType","id":3},"clickButton":{"type":"ClickButtonV2","id":4},"textInput":{"type":"TextInputV2","id":5},"checkBox":{"type":"CheckBoxV2","id":6},"toast":{"type":"ToastV2","id":7},"bubble":{"type":"BubbleV2","id":8},"label":{"type":"LabelV2","id":9},"postStatus":{"type":"PostStatus","id":10}}},"ClickButton":{"fields":{"portraitText":{"rule":"repeated","type":"string","id":1},"landscapeText":{"rule":"repeated","type":"string","id":2},"portraitTextFocus":{"rule":"repeated","type":"string","id":3},"landscapeTextFocus":{"rule":"repeated","type":"string","id":4},"renderType":{"type":"RenderType","id":5},"show":{"type":"bool","id":6}}},"ClickButtonV2":{"fields":{"portraitText":{"rule":"repeated","type":"string","id":1},"landscapeText":{"rule":"repeated","type":"string","id":2},"portraitTextFocus":{"rule":"repeated","type":"string","id":3},"landscapeTextFocus":{"rule":"repeated","type":"string","id":4},"renderType":{"type":"RenderType","id":5},"textInputPost":{"type":"bool","id":6},"exposureOnce":{"type":"bool","id":7},"exposureType":{"type":"ExposureType","id":8}}},"PostPanelBizType":{"values":{"PostPanelBizTypeNone":0,"PostPanelBizTypeEncourage":1,"PostPanelBizTypeFragClose":4,"PostPanelBizTypeColorDM":2}},"TextInput":{"fields":{"portraitPlaceholder":{"rule":"repeated","type":"string","id":1},"landscapePlaceholder":{"rule":"repeated","type":"string","id":2},"renderType":{"type":"RenderType","id":3},"placeholderPost":{"type":"bool","id":4},"show":{"type":"bool","id":5},"postStatus":{"type":"PostStatus","id":7}}},"TextInputV2":{"fields":{"portraitPlaceholder":{"rule":"repeated","type":"string","id":1},"landscapePlaceholder":{"rule":"repeated","type":"string","id":2},"renderType":{"type":"RenderType","id":3},"placeholderPost":{"type":"bool","id":4},"textInputLimit":{"type":"int32","id":6}}},"PostStatus":{"values":{"PostStatusNormal":0,"PostStatusClosed":1}},"RenderType":{"values":{"RenderTypeNone":0,"RenderTypeSingle":1,"RenderTypeRotation":2}},"CheckBox":{"fields":{"text":{"type":"string","id":1},"type":{"type":"CheckboxType","id":2},"defaultValue":{"type":"bool","id":3},"show":{"type":"bool","id":4}}},"CheckBoxV2":{"fields":{"text":{"type":"string","id":1},"type":{"type":"CheckboxType","id":2},"defaultValue":{"type":"bool","id":3}}},"CheckboxType":{"values":{"CheckboxTypeNone":0,"CheckboxTypeEncourage":1}},"Toast":{"fields":{"text":{"type":"string","id":1},"duration":{"type":"int32","id":2},"show":{"type":"bool","id":3},"button":{"type":"Button","id":4}}},"ToastV2":{"fields":{"text":{"type":"string","id":1},"duration":{"type":"int32","id":2},"toastButtonV2":{"type":"ToastButtonV2","id":3}}},"BubbleV2":{"fields":{"text":{"type":"string","id":1},"url":{"type":"string","id":2},"bubbleType":{"type":"BubbleType","id":3},"exposureOnce":{"type":"bool","id":4},"exposureType":{"type":"ExposureType","id":5}}},"BubbleType":{"values":{"BubbleTypeNone":0,"BubbleTypeClickButton":1,"BubbleTypeDmSettingPanel":2}},"LabelV2":{"fields":{"title":{"type":"string","id":1},"content":{"rule":"repeated","type":"string","id":2},"exposureOnce":{"type":"bool","id":3},"exposureType":{"type":"ExposureType","id":4}}},"ExposureType":{"values":{"ExposureTypeNone":0,"ExposureTypeDMSend":1}},"ToastButtonV2":{"fields":{"text":{"type":"string","id":1},"action":{"type":"ToastFunctionType","id":2}}},"Button":{"fields":{"text":{"type":"string","id":1},"action":{"type":"ToastFunctionType","id":2}}},"ToastFunctionType":{"values":{"ToastFunctionTypeNone":0,"ToastFunctionTypePostPanel":1}},"ToastBizType":{"values":{"ToastBizTypeNone":0,"ToastBizTypeEncourage":1}},"CommandDm":{"fields":{"oid":{"type":"int64","id":2},"mid":{"type":"int64","id":3},"command":{"type":"string","id":4},"text":{"type":"string","id":5},"stime":{"type":"int32","id":6},"ctime":{"type":"string","id":7},"mtime":{"type":"string","id":8},"extra":{"type":"string","id":9},"dmid":{"type":"string","id":10}}},"DmSegConfig":{"fields":{"pageSize":{"type":"int64","id":1},"total":{"type":"int64","id":2}}},"DanmakuFlagConfig":{"fields":{"recFlag":{"type":"int32","id":1},"recText":{"type":"string","id":2},"recSwitch":{"type":"int32","id":3}}},"DmSegMobileReply":{"fields":{"elems":{"rule":"repeated","type":"DanmakuElem","id":1},"colorfulSrc":{"rule":"repeated","type":"DmColorful","id":5}}},"DanmakuElem":{"fields":{"stime":{"type":"int32","id":2},"mode":{"type":"int32","id":3},"size":{"type":"int32","id":4},"color":{"type":"uint32","id":5},"uhash":{"type":"string","id":6},"text":{"type":"string","id":7},"date":{"type":"int64","id":8},"weight":{"type":"int32","id":9},"action":{"type":"string","id":10},"pool":{"type":"int32","id":11},"dmid":{"type":"string","id":12},"attr":{"type":"int32","id":13},"animation":{"type":"string","id":22},"colorful":{"type":"DmColorfulType","id":24}}},"DanmuWebPlayerConfig":{"fields":{"dmSwitch":{"type":"bool","id":1},"aiSwitch":{"type":"bool","id":2},"aiLevel":{"type":"int32","id":3},"typeTop":{"type":"bool","id":4},"typeScroll":{"type":"bool","id":5},"typeBottom":{"type":"bool","id":6},"typeColor":{"type":"bool","id":7},"typeSpecial":{"type":"bool","id":8},"preventshade":{"type":"bool","id":9},"dmask":{"type":"bool","id":10},"opacity":{"type":"float","id":11},"dmarea":{"type":"int32","id":12},"speedplus":{"type":"float","id":13},"fontsize":{"type":"float","id":14},"fullscreensync":{"type":"bool","id":15},"speedsync":{"type":"bool","id":16},"fontfamily":{"type":"string","id":17},"bold":{"type":"bool","id":18},"fontborder":{"type":"int32","id":19},"seniorModeSwitch":{"type":"int32","id":21}}},"Expressions":{"fields":{"data":{"rule":"repeated","type":"Expression","id":1}}},"Expression":{"fields":{"keyword":{"rule":"repeated","type":"string","id":1},"url":{"type":"string","id":2},"period":{"rule":"repeated","type":"Period","id":3}}},"Period":{"fields":{"start":{"type":"int64","id":1},"end":{"type":"int64","id":2}}},"AnyBody":{"fields":{"body":{"type":"google.protobuf.Any","id":1}}},"DmColorful":{"fields":{"type":{"type":"DmColorfulType","id":1},"src":{"type":"string","id":2}}},"DmColorfulType":{"values":{"NoneType":0,"VipGradualColor":60001}}}}}}}}}}}},"google":{"nested":{"protobuf":{"nested":{"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}}}}}}}}'),Ht=JSON.parse('{"nested":{"bilibili":{"nested":{"community":{"nested":{"service":{"nested":{"dm":{"nested":{"live":{"nested":{"BizScene":{"values":{"BizSceneNone":0,"BizSceneLottery":1,"BizSceneSurvive":2,"BizSceneVoiceConn":3,"BizScenePlayBack":4,"BizSceneVote":5}},"DmType":{"values":{"DmTypeNormal":0,"DmTypeEmoticon":1,"DmTypeVoice":2}},"Dm":{"fields":{"dmid":{"type":"string","id":1},"mode":{"type":"int32","id":2},"size":{"type":"int32","id":3},"color":{"type":"uint32","id":4},"uhash":{"type":"string","id":5},"text":{"type":"string","id":6},"date":{"type":"int64","id":7},"weight":{"type":"int32","id":8},"rnd":{"type":"int64","id":9},"attr":{"type":"int64","id":10},"bizScene":{"type":"BizScene","id":11},"bubble":{"type":"Bubble","id":12},"dmType":{"type":"DmType","id":13},"emoticons":{"keyType":"string","type":"Emoticon","id":14},"voice":{"type":"Voice","id":15},"animation":{"type":"string","id":16},"aggregation":{"type":"Aggregation","id":17},"sendFromMe":{"type":"bool","id":18},"check":{"type":"Check","id":19},"user":{"type":"User","id":20},"room":{"type":"Room","id":21},"icon":{"type":"Icon","id":22}}},"Check":{"fields":{"token":{"type":"string","id":1},"ts":{"type":"int64","id":2}}},"Room":{"fields":{"uid":{"type":"int64","id":1}}},"Aggregation":{"fields":{"isAggregation":{"type":"bool","id":1},"activitySource":{"type":"int64","id":2},"activityIdentity":{"type":"string","id":3},"notShow":{"type":"int32","id":4}}},"Bubble":{"fields":{"id":{"type":"int64","id":1},"color":{"type":"string","id":2},"idV2":{"type":"int64","id":3}}},"Emoticon":{"fields":{"unique":{"type":"string","id":1},"url":{"type":"string","id":2},"isDynamic":{"type":"bool","id":3},"inPlayerArea":{"type":"int64","id":4},"bulgeDisplay":{"type":"int64","id":5},"height":{"type":"int64","id":6},"width":{"type":"int64","id":7}}},"Voice":{"fields":{"url":{"type":"string","id":1},"fileFormat":{"type":"string","id":2},"text":{"type":"string","id":3},"fileDuration":{"type":"int64","id":4},"fileId":{"type":"string","id":5}}},"User":{"fields":{"uid":{"type":"int64","id":1},"name":{"type":"string","id":2},"nameColor":{"type":"string","id":3},"face":{"type":"string","id":4},"vip":{"type":"int64","id":5},"svip":{"type":"int64","id":6},"rank":{"type":"int32","id":7},"mobileVerify":{"type":"int32","id":8},"lplStatus":{"type":"int64","id":9},"attr":{"type":"int64","id":10},"medal":{"type":"Medal","id":11},"level":{"type":"UserLevel","id":12},"title":{"type":"Title","id":13},"identify":{"type":"Identify","id":14},"wealth":{"type":"Wealth","id":15}}},"Identify":{"fields":{"beginningUrl":{"type":"string","id":1},"endingUrl":{"type":"string","id":2},"jumpToUrl":{"type":"string","id":3}}},"Medal":{"fields":{"level":{"type":"int64","id":1},"name":{"type":"string","id":2},"special":{"type":"string","id":3},"color":{"type":"int64","id":4},"iconId":{"type":"int64","id":5},"borderColor":{"type":"int64","id":6},"gradientStartColor":{"type":"int64","id":7},"gradientEndColor":{"type":"int64","id":8},"privilege":{"type":"int64","id":9},"light":{"type":"int64","id":10}}},"UserLevel":{"fields":{"level":{"type":"int64","id":1},"color":{"type":"int64","id":2},"rank":{"type":"string","id":3},"onlineRank":{"type":"int64","id":4}}},"Title":{"fields":{"title":{"type":"string","id":1},"oldTitle":{"type":"string","id":2}}},"Record":{"fields":{"dmid":{"type":"string","id":1},"timeOffset":{"type":"int64","id":2}}},"Wealth":{"fields":{"level":{"type":"int64","id":1}}},"Icon":{"fields":{"prefix":{"type":"Prefix","id":1}}},"Prefix":{"fields":{"type":{"type":"int32","id":1},"resource":{"type":"string","id":2}}}}}}}}}}}}}}}'),Gt=function(){
function e(e){this.config=(0,n.pi)({protobuf:null,protocols:"proto",platform:"web"},e),this.protobuf=e.protobuf;var t=this.protobuf.Root.fromJSON(Vt),r=this.protobuf.Root.fromJSON(Ht),i="bilibili.community.service.dm.";this.anyType=t.lookupType("google.protobuf.Any"),this.pbType={view:t.lookupType(i+"v1.DmWebViewReply"),dm:t.lookupType(i+"v1.DmSegMobileReply"),live:r.lookupType("live.Dm")}}return e.prototype.toJson=function(e,t){var r=this.getType(t);if(!r)return console.warn("no json/path");var n=r.decode(new Uint8Array(e));return r.toObject(n)},e.prototype.toBuffer=function(e,t){var r=this.getType(t);if(!r)return console.warn("no json/path");var n=r.verify(e);if(n)return console.warn(n);var i=r.create(e);return r.encode(i).finish()},e.prototype.encodeAny=function(e,t,r){return r="type.googleapis.com".concat(r),this.anyType.create({type_url:r,value:t.encode(e).finish()})},e.prototype.getType=function(e){var t=e||{},r=t.type,n=t.json,i=t.path,o=this.pbType[r];if(!o){if(!n||!i)return"";o=this.protobuf.Root.fromJSON(n).lookupType(i),this.pbType[r]=o}return o},e}(),qt=Gt,Wt=r(45748),Kt=r.n(Wt),Yt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDanmaku",t.retried=0,t}return(0,n.ZT)(t,e),t.prototype.initPb=function(){this.pb2Json=this.pb2Json||new qt({protocols:"proto",protobuf:Kt()})},t.prototype.r=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){var e=this;return(0,n.Jh)(this,(function(r){return this.initPb(),this.config=Object.assign({url:null,retryCount:3,retryInterval:500,withCredentials:!0,type:"dm"},t),[2,this.getRemoteResponse().then((function(t){var r;re8Array(t.data),{type:e.config.type})||{},size:(null===(r=t.data)||void 0===r?void 0:r.byteLength)||0}})).catch((function(e){return{error:e,details:null,size:0}}))]}))}))},t.prototype.getRemoteResponse=function(){var e=this;return this.request({url:this.config.url,withCredentials:this.config.withCredentials,responseType:"arraybuffer"}).catch((function(t){return!le.eV.isCanceled(t)&&!le.eV.isGaiaFailed(t)&&e.config.retryCount>e.retried?new Promise((function(t,r){e.timer=window.setTimeout((function(){e.retried++,e.getRemoteonfig.retryCount))}),e.config.retryInterval)})):Promise.reject(t)}))},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t),clearTimeout(this.timer)},t}(le.eV),Qt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmReport",t.url="//api.bilibili.com/x/dm/report/add",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),zt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmForbid",t.url="//api.bilibili.com/x/v2/dm/filter/up/black",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),Zt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmLike",t.url="//api.bilibili.com/x/v2/dm/thumbup/stats",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return this.ids=e.ids,[2,this.request({url:this.url,params:e,withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){var t=null==e?void 0:e.data;if(t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&t[r].id_str===this.ids)return{num:t[r].likes,liked:Boolean(t[r].user_like)};return null},t}(le.eV),Jt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmLike",t.url="//api.bilibili.com/x/v2/dm/thumbup/add",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),Xt=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="DanmakuStore",r.host="//api.bilibili.com/x/v2/dm/web/",r.basSegment={},r.loadAllDm=[],r.userChange=!1,r.pageSize=360,r.allSegment={},r.allHistory={},r.dmTrack=r.defaultTrack,(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{textSide:"",cmdDm:null,addCmd:null,state:null,text:"",isViewLoaded:!1,checkBox:!1,basUrl:null,noStopDm:!0,reportDmid:null,expressions:null,postPanel:null,fragClose:null,u.prototype,"defaultTrack",{get:function(){return{all:0,allbas:0,view:0,dm:0,bas:0,umerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPaused",{get:function(){return this.mediaStore.state.paused||this.mediaStore.state.buffering},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canLoadAll",{get:function(){return!this.dmListStore.state.allLoaded&&(!!this.mediaStore.state.duration&&(!(!this.state.isViewLoaded||this.state.state)&&!(!this.auxStore.state.isListSpread||"LIST"!==this.auxStore.state.currentMenu)))},enumerable:!1,configurable:!0}),t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.rootPlayer.on(s.p.PLAYER_UNLOAD,(function(e){var r,n=(r=t.metricStore.quitInfo).dmInfo||(r.dmInfo={});for(var i in t.dmTrack)t.dmTrack[i]&&(n[i]=t.dmTrack[i])})),this.configStore.embeddedEnv&&this.setState({isHideInput:!0})},t.prototype.onLoaded=function(t){var r=this;if(e.prototype.onLoaded.call(this,t),this.configStore.cid){if(this.setState({isViewLoaded:!1}),this.configStore.noDanmaku||this.dmCmdStore.creator)return void this.log.i("noDanmaku");this.fetchDmView(t).then((function(e){return r.userChange=!0,r.setState({isViewLoaded:!0}),r.sendStore.setState({forceOn:!1}),e})).then((function(e){return(0,n.mG)(r,void 0,void 0,(function(){var t,r,i,o,a,s;return(0,n.Jh)(this,(function(n){return e&&(t=e.dmSetting,r=e.commandDms,i=r?r.length:0,t?(o=t.aiLevel,a=t.aiSwitch,s=t.dmSwitch,this.log.i("[requestDmInfo]",JSON.stringify({commandDmLen:i,dmSwitch:Boolean(s),aiSwitch:Boolean(a),aiLevel:o}))):this.log.i("[requestDmInfo]",JSON.stringify({commandDmLen:i}))),[2]}))}))}))}},t.prototype.fetchDmid=function(e){return new jt(this.rootPlayer).r({dmid:e,oid:this.configStore.cid})},t.prototype.fetchDmView=function(e){var t,r=this,n=(t=this.rootStore.configStore).cid,i=t.aid;return new Yt(this.rootPlayer).r(null,{url:"".concat(this.host,"view?type=1&oid=").concat(n,"&pid=").concat(i),retryCount:0,type:"view"}).then((function(t){var n;if(!t.details)return r.dmTrack.view++,null;var i=t.details;if(i){var o={text:i.text||"",checkBox:i.checkBox,state:i.state||0};i.textSide&&(o.textSide=i.textSide),r.setState(o),T.X.cssVar&&!r.configStore.embeddedEnv&&r.setState({cmdDm:i.commandDms}),i.activityMetas&&i.activityMetas.length&&r.addActivityMetas(i.activityMetas),i.checkBox&&r.dmModeStore.setState({checkBoxValue:r.localStore.get().dmSend.upDm}),r.blockStore.reportFilter=i.reportFilter,r.state.expressions=i.expressions,r.setLocal(i.dmSetting,Boolean(e.mid))}return r.userChange&&!r.statei,e),r.dmTrack.dmnum+=(null===(n=i.commandDms)||void 0===n?void 0:n.length)||0,r.dmListStore.setState({viewCount:i.count||0})),i})).catch((function(e){return{}}))},t.prototype.fetchDmSeg=function(e){var t,r=(t=this.rootStore.configStore).cid,n=t.aid,i="".concat("//api.bilibili.com/x/v2/dm/wbi/web/","seg.so?type=1&oid=").concat(r,"&pid=").concat(n);return i+=e<2?"&segment_index=1&pull_mode=1&ps=".concat(1===e?0:12e4,"&pe=").concat(1===e?12e4:36e4):"&segment_index=".concat(e),
new Yt(this.rootPlayer).r(null,{url:i,retryCount:3})},t.prototype.fetchDmBas=function(e){return new Yt(this.rootPlayer).r(null,{url:e,retryCount:1,withCredentials:!1})},t.prototype.dmReport=function(e,t){return new Qt(this.rootPlayer).r((0,n.pi)((0,n.pi)({cid:t||this.configStore.cid},e),{polaris_appid:100,polaris_platfrom:5,spmid:this.configStore.spmId,from_spmid:this.configStore.spmIdFrom}))},t.prototype.dmForbid=function(e){return new zt(this.rootPlayer).r({oid:this.configStore.cid,dmid:e})},t.prototype.dmLikeStats=function(e){return new Zt(this.rootPlayer).r({oid:this.configStore.cid,ids:e})},t.prototype.dmLike=function(e,t,r){return new Jt(this.rootPlayer).r({op:t,dmid:e,oid:r||this.configStore.cid,platform:"web_player",polaris_appid:100,polaris_platfrom:5,spmid:this.configStore.spmId,from_spmid:this.configStore.spmIdFrom})},t.prototype.dmReportBlock=function(e,t,r){e&&(this.blockStore.addReportFilter(e),this.blockStore.add(r,2),this.setState({reportDmid:t}),this.dmSettingStore.refresh())},t.prototype.viewLoaded=function(e,t){var r;this.pageSize=e.dmSge?e.dmSge.pageSize/1e3:360;var n=this.mpdStore.dmStartOffss.pageSize&&n>this.pageSize/3&&(i=1.5),null===(r=e.postPanelV2)||void 0===r?void 0:r.length){var o=e.postPanelV2.map((function(e){return e.start||(e.start=0),e}));this.setState({postPanel:o})}this.loadDmPb(i),Array.isArray(e.specialDms)&&this.loadBasPb(e.specialDms)},t.prototype.loadDmPb=function(e,t){var r=this;if(void 0===e&&(e=1),!this.allSegment[e]){this.dmTrack.all++;var n=performance.now();this.allSegment[e]=this.fetchDmSeg(e).then((function(i){var o,a;r.dmTrack.dmSize+=Number((i.size/1024).toFixed(2));var s=(null===(o=i.details)||void 0===o?void 0:o.eleturn u&&r.dmModeStore.setState({colorfulSrc:u}),s.forEach((function(e){e.colorful&&u&&u.some((function(t){if(t.type===e.colorful)return e.colorfulImg=t.src,!0}))})),r.log.i("[DmSeg]",JSON.stringify({error:i.error,len:s.length,segment:e})),i.error?(r.dmTrack.fail+="".concat(e,","),void r.dmTrack.dm++):(s.length&&(r.dmTrack.loadtime+=performance.now()-n,t?Array.prototype.push.apply(r.loadAllDm,s):r.appendDm(s)),s)})).then((function(t){return 1===e&&r.danmakuStore.setState({isFirstSegment:!0}),t}))}return this.allSegment[e]},t.prototype.appendDm=function(e){var t=performance.now();this.dmListStore.appendDm(e),this.dmTrack.appendtime+=performance.now()-t,this.dmTrack.dmnum+=(null==e?void 0:e.length)||0},t.prototype.loadBasPb=function(e){for(var t=this,r="",n=0;n<e.length;n++)e[n]&&(r=e[n].replace("http://","//"),this.basSegment[r]||(this.dmTrack.allbas++,this.basSegment[r]=this.fetchDmBas(r).then((function(e){var n;return e.error?(t.dmTrack.fail+="".concat(r,","),void t.dmTrack.bas++):(e.details&&t.dmListStore.appendDm(e.details.elems),(null===(n=e.details)||void 0===n?void 0:n.elems)||[])}))))},t.prototype.addActivityMetas=function(e){for(var t,r,n=[],i=[],o=[],a=0;a<e.length;a++){var s={};try{s=JSON.parse(e[a])}catch(e){}if(s.id)switch(s.id){case 20016:n.push(s);break;case 20017:var u=s.color_picture.resource.replace("http://","//");0!==(u=u.replace("https://","//")).indexOf("//")&&(u="//"+u),s.color_picture.resource=u,i.push(s);break;case 20023:case 20022:var c=(t=this.dmModeStore.state).color,l=t.fontsize,d={mode:t.mode,color:c,pool:t.pool,size:l,stime:1e3*s.start,border:!0,dmid:"",text:"firework",uhash:null===(r=this.userStore.info)||void 0===r?void 0:r.hashId,animation:e[a]};o.push(d)}}n.length&&this.dmListStore.setState({reverseDmSrc:n}),i.length&&this.dmListStore.setState({metaResource:i}),o.length&&this.dmListStore.setState({fireworkSrc:o})},t.prototype.loadDmPbAll=function(e){var t=this;void 0===e&&(e=!1),e&&(this.allSegment={});var r=this.mediaStore.state.duration/this.pageSize+1,n=[],i=this.mpdStore.dmStartOffset;Math.ceil(i/this.pageSize);return new Promise((function(e,i){for(var o=1;o<r;o++)n.push(t.loadDmPb(o,!0)),1===o&&n.push(t.loadDmPb(1.5,!0));for(var a in t.basSegment)n.push(t.basSegment[a]);Promise.all(n).then((function(r){var n=[];r.forEach((function(e){var t;9!==(null===(t=e[0])||void 0===t?void 0:t.mode)&&(n=n.concat(e))})),t.allHistory[0]=Promise.resolve(n),t.appendDm(t.loadAllDm),t.loadAllDm.length=0,t.dmListStore.setState({allLoaded:!0,count:t.dmListStore.allDm.length}),e()})).catch((function(){t.appendDm(t.loadAllDm),t.loadAllDm.length=0,t.dmListStore.setState({allLoaded:!0,count:t.dmListStore.allDm.length}),i()}))}))},t.prototype.loadHistory=function(e){var t=this;if(!this.allHistory[e]){var r=new Yt(this.rootPlayer),n=this.rootStore.configStore.cid,i="".concat(this.host,"history/seg.so?type=1&oid=").concat(n,"&date=").concat(e);this.allHistory[e]=r.r(null,{url:i,retryCount:1}).then((function(r){var n;return r.error?(t.dmTrack.fail+="".concat(e,","),t.allHistory[e]=null,Promise.reject()):null===(n=r.details)||void 0===n?void 0:n.elems}))}return this.allHistory[e]},t.prototype.setLocal=function(e,t){if(e&&t){var r=(0,n.pi)({dmSwitch:!1,aiSwitch:!1,aiLevel:3,preventshade:!1,dmask:!1,typeTop:!1,typeScroll:!1,typeBottom:!1,typeColor:!1,typeSpecial:!1,opacity:0,dmarea:0,speedplus:1,fontsize:1,fullscreensync:!1,speedsync:!1,fontfamily:"",bold:!1,fontborder:0,seniorModeSwitch:0},e);delete r.fontfamily,delete r.bold,r.opacity=Number(r.opacity.toFixed(2));var i=(0,n.pi)({},this.localStore.get().dmSetting);for(var o in r)i[o]=r[o];this.dmSettingStore.onlineSetting(i)}else{var a={seniorModeSwitch:0},s=(e||{}).dmSwitch;void 0!==s&&(a.dmSwitch=s),this.dmSettingStore.onlineSetting(a)}},t.prototype.tooltipCenter=function(e,t){this.tooltipStore.create({name:e,title:t,target:this.nodes.container,position:5,duration:1e3})},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.userChange=!1,this.pageSize=360,this.allSegment={},this.allHistory={},this.basSegment={},this.dmTrack=this.defaultTrack},(0,n.gn)([o.Fl],t.prototype,"isPaused",null),(0,n.gn)([o.Fl],t.prototype,"canLoadAll",null),t}(d),$t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpAdvVerify",t.url="//api.bilibili.com/x/dm/adv/state",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,params:e,withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){var t=e.data||{};return{hasBuy:t.hasBuy,confirm:t.confirm,accept:t.accept,coins:t.coins}},t}(le.eV),er=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpAdvBuy",t.url="//api.bilibili.com/x/dm/adv/buy",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){retus.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){return e||{}},t}(le.eV);!function(e){e[e.Hide=-3]="Hide",e[e.None=-2]="None",e[e.NeedBuy=-1]="NeedBuy",e[e.Request=0]="Request",e[e.Confirm=1]="Confirm",e[e.Verification=2]="Verification",e[e.Reject=3]="Reject"}(vt||(vt={}));va;return(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{advDm:null,testAdvDm:null,verifyState:vt.None}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShow",{get:function(){var e,t=(e=this.auxStore.state).currentMenu,r=e.isListSpread;return"ADV"===t&&r},enumerable:!1,configurable:!0}),t.prototype.send=function(e){return this.sendStore.send(e)},t.prototype.verify=function(){return new $t(this.rootPlayer).r({aid:this.configStore.aid,cid:this.configStore.cid,mode:"sp"})},t.prototype.buyVerify=function(){return new er(this.rootPlayer).r({aid:this.configStore.aid,cid:this.configStore.cid,mode:"sp"})},(0,n.gn)([o.Fl],t.prototype,"isShow",nl(this,t)||this;return(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{
basTest:null,showCodePanel:!1}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShowVisual",{get:function(){var e,t=(e=this.auxStore.state).currentMenu,r=e.isListSpread;return"BAS"===t&&r},enumerable:!1,configurable:!0}),t.prototype.test=function(e,t){var r=this;return new Promise((function(i,o){return(0,n.mG)(r,void 0,void 0,(function(){var r,a=this;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return e&&e.text?[3,1]:(o({code:-1,message:""}),[3,3]);case 1:return[4,(0,Le.ae)()];case 2:r=n.sent(),r.default.parse({danmaku:e,success:function(e){a.setState({basTest:{dm:e,test:!t}}),i(e)},error:function(e){o({code:-1,message:": "+e})}}),n.label=3;case 3:return[2]}}))}))}))},t.prototype.send=function(e,t){var r=this;return new Promise((function(i,o){return(0,n.mG)(r,void 0,void 0,(function(){var r,a,s=this;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return e&&e.text?[3,1]:(o({code:-1,message:""}),[3,3]);case 1:return r={type:1,oid:this.configStore.cid,msg:e.text,aid:this.configStore.aid,progress:Math.ceil(1e3*e.stime),color:1,fontsize:1,pool:2,mode:9,rnd:this.configStore.pid,plat:1},[4,(0,Le.ae)()];case 2:a=n.sent(),a.default.parse({danmaku:e,success:function(n){t?s.dmListStore.delete(t).then((function(t){t.body&&0===t.body.code?s.sendStore.send(r).then((function(t){if(0===t.body.code&&t.body.dmid){var n=s.userStore.info;e.dmid=t.body.dmid,e.uhash=null==n?void 0:n.hashId,e.uname=(null==n?void 0:n.name)?n.name.split(" ")[0]:"",e.pool=r.pool,e.mode=r.mode,s.dmListStore.addDm(e),i(e)}else o({code:-2,message:"".concat(t&&t.message?t.message:"")})})).catch((function(e){o({code:-1,message:""})})):o({code:-1,message:""})})).catch((function(e){o({code:-1,message:""})})):s.sendStore.send(r).then((function(t){if(0===t.body.code&&t.body.dmid){var n=s.userStore.info;e.dmid=t.body.dmid,e.uhash=null==n?void 0:n.hashId,e.uname=(null==n?void 0:n.name)?n.name.split(" ")[0]:"",e.pool=r.pool,e.mode=r.mode,s.dmListStore.addDm(e),i(e)}else o({code:-1,message:"".concat(t.body&&t.body.message?t.body.message:"")})})).catch((function(e){o({code:-1,message:""})}))}}),n.label=3;case 3:return[2]}}))}))}))},(0,n.gn)([o.Fl],t.prototype,"isShowVisual",null),t}(d),ar=r(9178),sr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmRecall",t.url="//api.bilibili.com/x/dm/recall",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),ur=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmProtect",t.url="//api.bilibili.com/x/dm/protect/apply",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),cr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmMove",t.url="//api.bilibili.com/x/v2/dm/edit/pool",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),lr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmState",t.url="//api.bilibili.com/x/v2/dm/edit/state",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),"HttpDmMonth",t.url="//api.bilibili.com/x/v2/dm/history/index",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,params:e,withCredentials:!0}).then((function(e){var t;return{body:null===(t=e.data)||void 0===t?void 0:t.data,response:e}}))]}))}))},t}(le.eV),fr=function(e){function t(t){var r=e.call(this,t)||this;return r.dmidApplied={},r.allDm=[],r.basList=[],r.dmModeMap={},(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){retur:[],addAdv:null,addAdvList:[],addCrossList:[],deletingDm:[],delDmid:[],searchId:"",allLoaded:!1,history:"",reverseDmSrc:[],metaResource:[],addReverseList:[],fireworkSrc:[]}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"multiViewBtn",{get:function(){var e;return null===(e=this.mpdStore.body)||void 0===e?void 0:e.clipInfoList},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reaurn e.allLoaded?r:t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShow",{get:function(){var e,t=(e=this.auxStore.state).currentMenu,r=e.isListSpread;return"LIST"===t&&r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canScrollTo",{get:function(){return Boolean(this.state.searchId&&this.state.allLoaded)},enumerable:!1,configurable:!0}),t.prototype.addDm=function(e,t){void 0===t&&(t=!1);var r=Math.floor((e.stime/1e3||0)/this.danmakuStore.pageSize)+1;if(this.danmakuStore.allSegment[r]){var n=this.realCount;t||(this.allDm.push(e),++n);var i={};switch(this.state.allLoaded?i.count=n:i.viewCount=n,e.mode){case 7:e.weight=10,i.addAdv=e;break;case 9:e.weight=10,i.addBas=e,this.basList.push(e);break;default:e.weight||(e.weight=-Math.round(10*Math.random())),i.addDm=e}this.danmakuStore.dmTrack.dmnum++,this.setState(i)}},t.prototype.recall=function(e){var t=this;return new sr(this.rootPlayer).r({dmid:e,cid:this.configStore.cid}).then((function(r){if(0===r.body.code){for(var n=t.realCount,i={delDmid:[e]},o=0;o<t.allDm.length;o++)if(t.allDm[o].dmid===e){t.ate.allLoaded?i.count=n:i.viewCount=n,t.setStatehis;return new ur(this.rootPlayer).r({dmids:e,mid:null===(t=this.userStore.info)||void 0===t?void 0:t.mid,cid:this.configStore.cid}).then((function(t){switch(t.body.code){case 0:case 36104:e.split(",").forEach((function(e){r.dmidApplied[e]=!0}))}return r.refresh(),t}))},t.prototype.refresh=function(){this.setState({refresh:this.state.refresh+1})},t.prototype.move=function(e){return new cr(this.rootPlayer).r({dmids:e,type:1,pool:1,oid:this.configStore.cid})},t.prototype.delete=function(e){var t=this;return new lr(this.rootPlayer).r({dmids:e,state:1,type:1,oid:this.configStore.cid}).then((function(r){return 0===r.body.code&&t.setState({deletingDm:e.split(",")}),r}))},t.prototype.dmState=function(e){return new lr(this.rootPlayer).r({dmids:e,state:2,type:1,oid:this.configStore.cid})},t.prototype.laodActiveMonth=function(e){return new dr(this.rootPlayer).r({month:evar t,r=null===(t=this.us.hashId;return!(!e||!r)&&e.uhash===r},t.prototype.canProtect=function(e){var t=this.userStore.info;return!!(this.uiStore.kind===f.HR.Pgc&&e&&(null==t?void 0:t.level)>=4)&&e.uhash===t.hashId},t.prototype.setDMModeMap=function(e){this.dmModeMap[e]||(this.dmModeMap[e]=0),this.dmModeMap[e]++},t.prototype.getDMModeMap=function(){return this.dmModeMap},t.prototype.appendDm=function(e){var t=this;if(Array.isArray(e)){var r=1e3*this.mpdStore.dmStartOffset,i=this.configStore.cid,o=(0,n.ev)([],(0,n.CR)(this.state.addDmList),!1),a=[],s=[],u=[],c=[];e.forEach((function(e){var l,d;if((null===(d=e.text)||void 0===d?void 0:d.replace(/\r/g,""))&&!(e.stime<r)){if(t.configStore.embeddedEnv>1){
if(![1,4,5,6].includes(e.mode))return}e.stime-=r;var f=(0,ar.j)(e.animation),p=(l=f||{}).id,h=l.cid;if(20016===p)return h&&h!==i||t.allDm.push(e),1===f.direction?void c.push((0,n.pi)((0,n.pi)({},e),{effect:f,stime:e.stime/1e3||0})):void o.push(e);if(1002!==p){switch(e.mode){case 7:e.color=e.color||16777215,s.push(e);break;case 9:var y=(0,n.pi)((0,n.pi)({},e),{stime:e.stime/1e3||0});a.push(y),t.basList.push(y);break;default:if(t.configStore.fromDid===e.dmid)return;o.push(e)}t.allDm.push(e),t.setDMModeMap(e.mode)}else u.push((0,n.pi)((0,n.pi||0}))}})),u.length&&T.X.cssVar&&this.setState({addCrossList:u}),c.length&&T.X.cssVar&&this.setState({addReverseList:c}),a.length&&this.setState({addBasList:a}),o.length&&this.setState({addDmList:o}),s.length&&this.setState({addAdvList:s}),this.state.viewCount||this.setState({count:this.allDm.length})}},t.prototype.reset=function(){this.allDm=[]},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.reset(),this.basList=[],this.loadAnimationZipPromise=null},(0,n.gn)([o.Fl],t.prototype,"multiViewBtn",null),(0,n.gn)([o.Fl],t.prototype,"realCount",null),(0,n.gn)([o.Fl],t.prototype,"isShow",null),(0,n.gn)([o.Fl],t.prototype,"canScrollTo",null),t}(d),pr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="Httpototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),hr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpImg",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:e,responseType:"arraybuffer"})]}))}))},t}(le.eV),yr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpCmdReserve",t.url="//api.bilibili.com/x/activity/reserve",t}return(0,n.ZT)(t,e),t.prototype.r=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(r){return[2,this.request({url:t?this.url+"/cancel":this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),mr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpCmdScore",t.url="//api.bilibili.com/x/v2/dm/command/grade/post",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),gr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpCmdShrink",t.url="//api.bilibili.com/x/v2/dm/command/user/conf",t}return(0,n.ZT)(t,e),t.prototype.r=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),vr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpCmdCheckin",t.url="//api.bilibili.com/x/v2/dm/command/checkin/record/add",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),_r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmGoodsLtion(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),Er=function(e){functts)||this;return t.tag="HttpCmdCmtieturn(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,v{var r=e.call(this,t)||this;return(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProList:null,voteId:null,shortcutVoteId:null,shortcutTime:null,scoreGrade:null,upEgg:null,insideW:0,insideH:0,businessConfig:null}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cmdVisible",{grCreator()||this.sendStore.dmVisible},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"creator",{get:function(){return this.configStore.isManagerCreator()},enumerable:!1,configurable:!0}),t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.dc.cmdDm=(0,o.U5)((function(){return t.danmakuStore.state.cmdDm}),(function(e){t.creator||(null==e?void 0:e.length)&&t.appendCmd(e)})),this.dc.resize=(0,o.U5)((function(){return{height:t.uiStore.state.containerHeight,width:t.uiStore.state.containerWidth,isMetadataLoaded:t.mediaStore.state.isMetadataLoaded,videoNodeWidth:t.uiStore.state.videoNodeWidth,videoWidth:t.mediaStore.state.videoWidth}}),(function(e){var r=e.height,n=e.width,i=e.isMetadataLoaded,o=e.videoNodeWidth,a=e.videoWidth;i&&n&&r&&o&&a&&t.resize()}),{fireImmediately:!0})},t.prototype.resize=function(){var e,t=this.rootStore,r=this.mediaStore.video,n=r.videoHeight/r.videoWidth,i=(e=this.uiStore.state).videoNodeHeight,o=e.videoNodeWidth;i/o>n?i=o*n:o=i/n,t.nodes.cmdInside.style.cssText="width:".concat(o,"px;height:").concat(i,"px;"),this.setState({insideW:o,insideH:i})},t.prototype.appendCmd=function(e){if(!this.creator){var t,r=[];e.forEach((function(e){try{t=JSON.parse(e.extra)}catch(e){}if(t&&"#ENCOURAGE#"===e.command){var n=e.stime/1e3||0;r.push({from:n,to:n+(t.duration/1e3||5),duration:t.duration/1e3||5,resource:t.resource,positionType:t.position_type,dms:t.dms})}})),r.length&&this.setState({wordC{return new pr(this.igStore.cid,progress:Math.round(1e3*n),vote_id:e,vote_type:t,cmd_id_str:o,option_id:r,has_self_def:i,polaris_appid:100,polaris_platfrom:5,spmid:this.configStore.spmId,from_spmid:this.configStore.spmIdFrom})},t.prototype.getImg=function(e){return new hr(this.rootPlayer).r(e)},t.prototype.reserve=function(e,t){return new yr(this.rootPlayer).r(e,t)},t.prototype.score=function(e,t){return new mr(this.rootPlayer).r(e)},t.prototype.shrink=function(e,t){return new gr(this.rootPlayer).r(e)},t.prototype.checkin=function(e,t){return new vr(this.rootPlayer).r(e)},t.prototype.goodsLike=function(e,t){return new _r(this.rootPlayer).r(e)},t.prototype.cmtime=function(e,t){return new Er(this.rootPlayer).r(e)},t.prototype.editorCenter=function(e){if(this.mediaStore.state.isMetadataLoaded)try{var t=JSON.parse(e);if(!t)return;var r=this.state.updateCmdList||[];for(var i in t){var o=t[i]||[];switch(i){case"dm2":this.editorLink(o,r);break;case"dm5":this.editorFollow(o,r);break;case"dm8":this.editorCombo(o,r);break;case"dm10":this.editorReserve(o,r);break;case"dm11":this.editorScore(o,r);break;case"dm14":this.editorClock(o,r);break;case"dm18":this.editorGoods(o,r);break;case"dm20":this.editorCmtime(o,r)}}this.setState({updateCmdList:(0,n.ev)([],(0,n.CR)(r),!1)})}catch(e){console.warn(e)}},t.prototype.editorFollow=function(e,t){if(!(null==e?void 0:e.length))return t.push({mode:3016,delete:!0});e.forEach((function(e){
var r,n=(r=e||{}).key,i=r.type,o=r.dmid,a=r.text,s=r.from,u=r.to,c=r.pos_x,l=r.pos_y,d=r.face,f=r.mid,p=r.electricGuide,h=r.question,y=r.options,m=r.electricIcon,g=r.electricStatus,v=u-s;9!==i?t.push({mode:3016,dmid:o,text:a,stime:s,duration:v,modeInfo:{key:n,type:i,face:d,mid:f,electricGuide:p,posX:c,posY:l,electricIcon:m,electricStatus:g}}):t.push({mode:3017,dmid:o,text:h,stime:s,duration:v,modeInfo:{key:n,type:i,face:d,mid:f,options:y,duration:v,posX:c,posY:l}})}))},t.prototype.editorLink=function(e,t){if(!(null==e?void 0:e.length))return t.push({mode:3012,delete:!0});e.forEach((function(e){var r,n=(r=e||{}).key,i=r.dmid,o=r.data,a=r.from,s=r.to,u=r.posX,c=r.posY;t.push({mode:3012,dmid:i,text:o.msg,stime:a,duration:s-a,modeInfo:{key:n,posX:u,posY:c}})}))},t.prototype.editorCombo=function(e,t){if(!(null==e?void 0:e.length))return t.push({mode:2003,delete:!0});e.forEach((function(e){var r,n=(r=e||{}).key,i=r.dmid,o=r.text,a=r.stime,s=r.duration,u=r.count,c=r.step,l=r.url;t.push({mode:2003,dmid:i,text:o,stime:a,duration:s,modeInfo:{key:n,count:u,step:c,resource:l}})}))},t.prototype.editorReserve=function(e,t){if(!(null==e?void 0:e.length))return t.push({mode:3018,delete:!0});e.forEach((function(e){var r=e||{},n=r.key,i=r.dmid,o=r.text,a=r.from,s=r.to-a;t.push({mode:3018,dmid:i,text:o,stime:a,duration:s,modeInfo:{key:n,duration:s,posX:r.posX,posY:r.posY,count:r.count,liveTime:r.liveTime,liveState:r.liveState,popularity:r.popularity,popularityStr:r.popularityStr,liveTimeFormat:r.liveTimeFormat,state:r.state,jump:r.jump,live:r.live,reserveType:r.reserveType,arcTime:r.arcTime,arcTimeFormat:r.arcTimeFormat,desc:r.desc}})}))},t.prototype.editorScore=function(e,t){if(!(null==e?void 0:e.length))return t.push({mode:3013,delete:!0});e.forEach((function(e){var r,n,i=(r=e||{}).key,o=r.dmid,a=r.from,s=r.to,u=r.pos_x,c=r.pos_y,l=(n=r.data||{}).summary,d=n.summaryList,f=n.msg,p=n.skin,h=n.skinUnselected,y=n.count,m=(n.id,s-a);l?t.push({mode:3014,dmid:o,text:f,stime:a,duration:m,modeInfo:{key:i,duration:m,posX:u,posY:c,summaryList:d}}):t.push({mode:3013,dmid:o,text:f,stime:a,duration:m,modeInfo:{key:i,count:y,skin:p,duration:m,skinUnselected:h,posX:u,posY:c}})}))},t.prototype.editorClock=function(e,t){if(!(null==e?void 0:e.length))return t.push({mode:3015,delete:!0});e.forEach((function(e){var r,n,i=(r=e||{}).key,o=r.dmid,a=r.from,s=r.to,u=r.pos_x,c=r.pos_y,l=(n=r.data||{}).total,d=n.endClock,f=n.msg,p=n.type;t.push({mode:3015,dmid:o,text:f,stime:a,duration:s-a,modeInfo:{key:i,type:p,total:l,endClock:d,posX:u,posY:c}})}))},t.prototype.editorGoods=function(e,t){if(!(null==e?void 0:e.length))return t.push({mode:3020,delete:!0});e.forEach((function(e){var r,n,i=(r=e||{}).key,o=r.dmid,a=r.from,s=r.to,u=r.pos_x,c=r.pos_y,l=(n=r.data||{}).msg,d=n.type,f=n.keyword,p=n.button_selected,h=n.button_unselected,y=n.button_icon,m=n.desc,g=n.item_id_str,v=n.item_image,_=n.user_sub;t.push({mode:3020,dmid:o,text:l,stime:a,duration:s-a,modeInfo:{key:i,type:d,posX:u,posY:c,keyword:f,itemIdStr:g,itemImage:v,userSub:_,desc:m,buttonSelected:p,buttonUnSelected:h,buttonIcon:y}})}))},t.prototype.editorCmtime=function(e,t){if(!(null==e?void 0:e.len(e){var r,n=(r=e||{}).key,i=r.dmid,o=r.from,a=r.to,s=r.pos_x,u=r.pos_y,c=r.data,l=r.realTo;t.push({mode:3022,dmid:i,text:"",stime:o,duration:a-o,modeInfo:{key:n,posX:s,posY:u,upSlogan:c.upSlogan,upSloganIcon:c.upSloganIcon,ifSupported:c.ifSupported,realTo:l}})}))},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.upMid=null},(0,n.gn)([o.Fl],t.prototype,"cmdVisible",null),(0,n.gn)([o.Fl],t.prototype,"creator",null),t}(d),Sr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmSkip",t.url="//api.bilibili.com/x/player/card/click",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:d:"post",withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){return{code:e.code,message:e.message}},t}(le.eV),Tr=function(e){function t(t){var r=e.call(this,t)||this;return(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skips",{get:function(){var e,t,r=null===(e=this.userStore.info)||void 0===e?void 0:e.operationCard,n=null===(t=this.mpdStore.body)||void 0===t?void 0:t.isPreview,i=this.interactStore.renderInteractionTPL;return n||i?null:r},enumerable:!1,configurable:!0}),t.prototype.jumpCard=function(e){return new Sr(this.rootPlayer).r(e)},t.prototype.onDispose=function(){e.prototype.onDispose.call(this)},(0,n.gn)([o.Fl],t.prototype,"skips",null),t}(d),wr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmSetting",t.url="//api.bilibili.com/x/v2/dm/web/config",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0})]}))}))},t}(le.eV),Ar=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onlineSet={},t.blockList=[],t.block2IO={dmSwitch:"dm_switch",aiSwitch:"ai_switch",aiLevel:"ai_level",typeTop:"blocktop",typeScroll:"blockscroll",typeBottom:"blockbottom",typeColor:"blockcolor",typeSpecial:"blockspecial",dmask:"dmask",opacity:"opacity",fontfamily:"fontfamily",bold:"bold",preventshade:"preventshade",fontborder:"fontborder",speedplus:"speedplus",speedsync:"speedsync",fontsize:"fontsize",fullscreensync:"screensync",dmareatch"},t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return(0,n.pi)((0,n.pi)({},Te().dmSetting),{dmFresh:0,dmClear:0,dmSwitchOut:null,currentSet:null,seniorMode:!1})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miniSet",{get:function(){return this.configStore.isChannel(f.u5.Homepage)},enumerable:!1,configurable:!0}),t.prototype.onStateCreated=function(){if(e.prototype.onStateCreated.call(this),this.miniSet)this.setState({typeTop:!1,typeBottom:!1,speedplus:.5});else{var t=this.rootStore.localStore.gnMounted=function(){var t=this;e.prototype.onMounted.call(this),this.dc.dmLocal=(0,o.EH)((function(){var e,r=t.dmSettingStore.state.dmSwitch,n=t.dmSettingStore.state.dmSwitchOut;"boolean"==typeof n&&(r=n),t.setLocal({dmSwitch:r}),null===(e=t.dmSetting({dmSwitch:r}))||void 0===e||e.catch((function(){t.track.e("danmuku_set_error",{type:0,value:r})}))}))},t.prototype.onlineSetting=function(e){this.miniSet||(this.onlineSet=e,this.setLocal(e))},t.prototype.setLocal=function(e){this.setState(e),this.localStore.set({dmSetting:e}),this.setState({currentSet:e})},t.prototype.dmSetting=function(e){var t=this,r={};if(Object.keys(e).forEach((function(n){void 0!==t.onlineSet[n]&&e[n]!==t.onlineSet[n]&&(t.onlineSet[n]=e[n],r[t.block2IO[n]]=e[n])})),Object.keys(r).length){r.ts=Date.now(),this.setTrack(r);var n=new wr(this.rootPlayer),i=this.danmakuStore.dmTrack.dmSetIO||{all:0,err:0};return i.all++,this.danmakuStore.dmTrack.dmSetIO=i,n.r(r).catch((function(){return i.err++,t.danmakuStore.dmTrack.dmSetIO=i,Promise.reject()}))}return null},t.prototype.refresh=function(){this.dmSettingStore.setState({dmFresh:this.state.dmFresh+1})},t.prototype.setTrack=function(e){e.ai_level&&this.track.e("danmaku_ai_level",String(e.ai_level)),e.opacity&&this.track.e("danmaku_final_opacity",String(e.opacity)),e.speedplus&&this.track.e("danmaku_final_speed",String(e.speedplus)),e.fontsize&&this.track.e("danmaku_final_size",String(e.fontsize))},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,!0)},t}(d),Rr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmUnBlock",t.url="//api.bilibili.com/x/dm/filter/user/add",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){
return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),Pr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmBlockBatch",t.url="//api.bilibili.com/x/dm/filter/user/add2",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){var t=(e.data||[]).map((function(e){return{type:e.type,filter:e.filter,opened:!0,id:e.id}}));return{code:e.code,message:e.message,list:t}},t}(le.eV),Dr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmUnBlock",t.url="//api.bilibili.com/x/dm/filter/user/del",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(le.eV),Or=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmBlockList",t.url="//api.bilibili.com/x/dm/filter/user",t}return(0,n.ZT)(t,e),n(){var e=this;return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.url,method:"get",withCredentials:!0}).then((function(t){return{body:e.parse(t.data),response:t}}))]}))}))},t.prototype.parse=function(e){var t,r=((null===(tunction(e){return{type:e.type,filter:e.filter,opened:!0,id:efunction(e){function t(t){var r=e.call(this,t)||this;return r.blockList=[],(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{isSyncBlocked:!1,refresh:1}},enumerable:!1,configurable:!0}),t.prototype.addReportFilter=function(e){this.reportFilter?this.reportFilter.push(e):this.reportFilter=[e]},Object.defineProperty(t.prototype,"isShow",{get:function(){var e,t=(e=this.auxStore.state).currentMenu,r=e.isListSpread;return"BLOCK"===t&&r},enumerable:!1,configurable:!0}),t.prototype.onStateCreated=function(){e.prototype.onStateCreated.call(this);var t=this.rootStore.localStore.get();this.blockList=t.blockList},t.prototype.onLoaded=function(t){(e.prototype.onLoaded.call(this,t),t.mid)&&(this.rootStore.localStore.get().lastUid!==t.mid&&this.blockList.forEach((function(e){e.id=0})))},t.prototype.add=function(e,t,r){var n,i=this,o=null===(n=this.userStore.info)||void 0===n?void 0:n.mid,a=this.isBlocked(e,t);if(!r&&a)return Promise.resolve({code:-1,message:""});var s={code:-1,message:""};return o?new Rr(this.rootPlayer).r({type:t,filter:e}).then((function(n){var o,u=(null===(o=n.body.data)||void 0===o?void 0:o.id)||0;return r&&a?(a.rule.id=u,i.addLocal()):(i.blockList.push({type:t,filter:e,opened:!0,id:u}),i.addLocal()),s.code=0,s})).catch((function(){return i.blockList.push({type:t,filter:e,opened:!0,id:0}),i.addLocal(),s})):(this.blockList.push({type:t,filter:e,opened:!0,id:0}),this.addLocal(),Promise.resolve(s))},t.prototype.blockUserList=function(e){var t=this;return new Pr(this.rootPlayer).r({type:2,filters:e.join(",")}).then((function(e){var r=e.body;t.blockList=t.noRepeat(r.list),t.addLocal()})).catch((function(){var r=e.map((function(e){return{type:2,filter:e,opened:!0,id:0}}));t.blockList=t.noRepeat(r),t.addLocal()}))},t.prototype.addLocal=function(){this.localStore.set({blockList:this.blockList},!0),this.setState({refresh:this.state.refresh+1}),this.dmListStore.refresh(),this.dmSettingStore.refresh(),this.setLastUid()},t.prototype.isBlocked=function(e,t){for(var r,n,i=0;i<this.blockList.length;i++)(r=this.blockList[i]).type===t&&r.filter===e&&(n={i:i,rule:r});return n},t.prototype.remove=function(e,t){var r=this.isBlocked(e,t);if(r){var n=r.i,i=r.rule;if(this.blockList.splice(n,1),i.id)new Dr(this.rootPlayer).r({ids:String(i.id)});this.addLocal()}},t.prototype.fromOut=function(e){(null==e?void 0:e.length)&&(this.blockList=this.noRepeat(e,!0),this.addLocal())},t.prototype.dmSync=function(){var e=this;return new Or(this.rootPlayer).r().then((function(t){return 0===t.body.code&&(e.blockList=e.noRepeat(t.body.list),e.setState({isSyncBlocked:!0}),e.addLocal()),t}))},t.prototype.aiJudge=function(e,t){return!!(t.aiSwitch&&Math.abs(e.weight)<t.aiLevel)},t.prototype.reportFilterReg=function(e){var t;return!!(null===(t=this.reportFilter)||void 0===t?void 0:t.length)&&this.reportFilter.some((function(t){if(new RegExp(t).test(e.text))return!0}))},t.prototype.judgeUser=function(e){for(var t,r=0;r<this.blockList.length;r++)if(2===(t=this.blockList[r]).type&&String(e.uhash)===String(t.filter))return Le.Rs.BLOCK_LIST_USER;return Le.Rs.BLOCK_DISABLED},t.prototype.judgeWord=function(e){var t,r,n=this.dmSettingStore.state,i=e.text,o=e.mode,a=e.uhash,s=e.uid,u=a||s;try{i=7===o&&"["===i[0]?JSON.parse(i)[4]:i}catch(e){}if(9!==o&&n.status&&(null===(t=this.blockList)||void 0===t?void 0:t.length))for(var c=0;c<this.blockList.length;c++)if((r=this.blockList[c]).opened&&r.filter){if(2===r.type&&String(u)===String(r.filter))return Le.Rs.BLOCK_LIST_USER;if(0===r.type)try{if(new RegExp(r.filter.replace(/(\^|\$|\\|\.|\*|\+|\?|\(|\)|\[|\]|\{|\}|\||\/)/g,"\\$1"),"i").test(i))return Le.Rs.BLOCK_LIST_KEYWORD}catch(e){this.log.w(e)}if(1===r.type)try{if(this.filterRegexp(r.filter).test(i))return Le.Rs.BLOCK_LIST_REGEXP}catch(e){this.log.w(e)}}},t.prototype.judge=function(e,t){if(e.border)return 0;var r=this.dmSettingStore.state,n=r.typeSpecial,i=r.typeColor,o=r.seniorMode;e.asNormal=!n;var a=(e.modeInfo||{}).id;if(!t){if(this.aiJudge(e,r))return 1;if(this.reportFilterReg(e))return 1}if(o&&e.weight<=10)return 1;if(20017===a||20011===a){if(!n)return Le.Rs.BLOCK_SPECIAL;if(!i)return Le.Rs.BLOCK_COLOR}if(e.colorful&&!i)return Le.Rs.BLOCK_COLOR;var s=this.judgeWord(e);return s||e.mode>10?s:r.typeScroll||1!==e.mode&&6!==e.mode?r.typeBottom||4!==e.mode?r.typeTop||5!==e.mode?r.typeColor||9===e.mode||"#FFFFFF"===(0,Ir.X)(e.color).toUpperCase()?!r.typeSpecial&&(2===e.pool||e.mode>=7)?Le.Rs.BLOCK_SPECIAL:Le.Rs.BLOCK_DISABLED:Le.Rs.BLOCK_COLOR:Le.Rs.BLOCK_TOP:Le.Rs.BLOCK_BOTTOM:Le.Rs.BLOCK_SCROLL},t.prototype.filterRegexp=function(e){var t=/^\/(.+)\/([img]{0,3})$/.exec(e);try{return new RegExp(t[1],t[2])}catch(t){return new RegExp(e)}},t.prototype.noRepeat=function(e,t){var r={},n=this.blockList||[];n.length&&n.forEach((function(e){var t=e.type,n=e.filter,i=0===t?t+n.toLowerCase():t+n;r[i]=e})),Array.isArre,o=e.filter;if(o)if(n=0===i?i+o.toLowerCase():i+o,r[n]){if(t)return;r[n].id=e.id}else r[n]=e}}));var i=[];for(var o in r)i.push(r[o]);return i},t.prototype.setLastUid=function(){var e,t=null===(e=this.userStore.info)||void 0===e?void 0:e.mid;t&&this.localStore.set({lastUid:t})},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,!0),this.reportFilter=null},(0,n.gn)([o.Fl],t.prototype,"isShow",null),t}(d),Nr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmMask",t}return(0,n.ZT)(t,e),t.prototype.r=function(e,t){return(0,n.mG)(this,void 0,voidis.request({url:t.url,responseType:"arraybuffer",headers:{range:t.range}})]}))}))},t}(le.eV),kr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.maskTrack={hasMask:0,browser:null,supportMask:0,invalidGPU:0},t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{maskUrl:"",fps:24,maxfps:24,disable:!1}},enumerable:!1,configurable:!0}),t.prototype.onLoaded=function(t){if(e.prototype.onLoaded.call(this,t),t.dmMask&&(this.maskTrack.hasMask=1,this.maskTrack.browser=T.X.info,this.maskTrack.invalidGPU=+this.configStore.invalidGPU),
t.dmMask&&T.X.chrome.alike&&!T.X.edge.alike&&!this.configStore.invalidGPU){this.maskTrack.supportMask=1;var r=t.dmMask,n=r.maskUrl,i=r.fps;n?this.setState({maxfps:i,maskUrl:n}):this.setState({maskUrl:""})}},t.prototype.getBufferRange=function(e,t){if(!this.state.maskUrl)return Promise.reject(new Error("no url"));var r=-1===t?"bytes=".concat(e,"-"):"bytes=".concat(e,"-").concat(t);return new Nr(this.rootPlayer).r(null,{url:this.state.maskUrl,range:r})},t}(d),Lr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDmPanel",t.url="//api.bilibili.com/x/v2/dm/panel",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,params:e,method:"get",withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){if(0===(null==e?void 0:e.code))return{colorfulPanel:e.data.colorful_panel,colorfulPrivilegeDetails:{vipOrderPromotion:e.data.colorful_privilege_details.vip_order_promotion}}},t}(le.eV),xr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){reull,colorfulPrivilegeDetails:null,colorful:null}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upDm",{get:function(){return this.danmakuStore.state.checkBox?this.state.checkBoxValue?1:0:2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upCheckbox",{get:function(){return this.danmakuStore.state.checkBox&&this.state.checkBoxValue},enumerable:!1,configurable:!0}),t.prototype.vipSwitch=function(){return new Lr(this.rootPlayer).r({oid:this.configStore.cid,pid:this.configStore.pid,type:1})},t}(d),Mr=function(e){function t(t){var r=e.call(this,t)||this;return r.records=new o.vP,(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"maxActions",{get:function(){return 5},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxFixedActnotSetRecord=function(e,t,r){return!(!r||!e.length)&&Math.min.apply(Math,(0,n.ev)([],(0,n.CR)(e.map((function(e){return e.priority}))),!1))>t.priority},t.prototype.abortOldestRecord=function(e,t){if(e.length>=t){var r=new Map,i=[];e.sort((function(e,t){return e.priority-t.priority})).forEach((function(e){r.has(e.priority)?r.get(e.priority).push(e):r.set(e.priority,[e])})),r.forEach((function(e,t){var r=e.sort((function(e,t){return e.timeStamp-t.timeStamp}));i.push.apply(i,(0,n.ev)([],(0,n.CR)(r),!1))}));for(var o=e.length-t+1,a=Math.min(o,i.length),s=0;s<a;s++){var u=i[s];u&&this.remove(u.iid,"abort")}}(e){var t=this;e.duration&&!e.timerClock&&(e.timerClock=new h.eF((function(r,n){n>=r&&t.remove(e.iid,"delay")}),e.duration,250))},t.prototype.create=function(e,t){var r=Z();if(e.iid=r,e.timeStamp=Date.now(),null==e.priority&&(e.fixed?e.priority=100:e.confirmText?e.priority=10:e.priority=0),e.fixed){var i=[];if(this.records.forEach((function(e){return e.fixed&&i.push(e)})),i.length>=this.maxFixedActions){if(this.cannotSetRecord(i,e,t))return null;this.abortOldestRecord(i,this.maxFixedActions)}}if(this.records.size>=this.maxActions){var o=(0,n.ev)([],(0,n.CR)(this.records.values()),!1);if(this.cannotSetRecord(o,e,t))return null;this.abortOldestRecord(o,this.maxActions)}return e=Object.assign({text:"Hello",duration:3e3},e),this.trySetTimerClock(e),this.records.set(e.iid,e),r},t.prototype.update=function(e,t){var r=this.records.get(e);return!!r&&(r.timeStamp=Date.now(),!!t&&(r.text&&t.text&&(r.text=t.text),r.confirmText&&t.confirmText&&(r.confirmText=t.confirmText),this.records.set(e,r),!0))},t.prototype.remove=function(e,t){void 0===t&&(t="api");var r=this.records.get(e);return!!r&&(r.timerClock&&(r.timerClock.onRemoved({reason:t}),!0)},t.prototype.resumeClock=function(e){var t=this.records.get(e);return!(!t||!t.timerClock)&&(t.timerClock.rlock=function(e){var t=this.records.get(e);return!(!t||!t.timerClock)&&(t.timerClock.suspend(),!0)},t.prototype.getActions=function(){return{maxActions:this.maxons}},t.prototype.onDispose=function(){var t=this;e.prototype.onDispose.call(this),(0,n.ev)([],(0,n.CR)(this.records.values()),!1).filter((function(e){return!e.persistent})).forEach((function(e){t.remove(e.iid,"lifecycle")}))},t.prototype.onDisconnect=function(){var t=this;e.prototype.onDisconnect.call(this),this.records.forEach((function(e){t.remove(e.iid,"lifecycle")}))},(0,n.gn)([o.LO],t.prototype,"records",void 0),(0,n.gn)([o.aD],t.prototype,"create",null),(0,n.gn)([o.aD],t.prototype,"update",null),(0,n.gn)([o.aD],t.prototype,"remove",null),t}(d),Fr=function(e){function t(t){var r=e.call(this,t)||this;return r.records=new o.vP,(0,o.rC)(r),r}return(0,n.ZT)(t,e),t.prototype.tryStartTimerClock=function(e){var t=this;e.duration&&!e.timerClock&&(e.timerClock=new h.eF((function(r,n){n>=r&&t.remove(e.name)}),e.duration,250))},t.prototype.create=function(e){this.defRenderTarget=this.defRenderTarget||this.nodes.tooltipArea||this.nodes.container;var t=Object.assign({title:"Hello",delay:300,duration:3e3,position:2,gap:6,offsetX:0,offsetY:0,renderGap:8,renderTarget:this.defRenderTarget,timeStamp:Date.now()},e);if(t.target||(null==t.clientX&&(t.clientX=this.uiStore.state.mouseClientX),null==t.clientY&&(t.clientY=this.uiStore.state.mouseClientY)),t.tip&&(t.duration=0,null==t.target))throw new Error("`target` is required when `tip` is truly");this.tryStartTimerClock(t),this.records.set(t.name,t)},t.prototype.update=function(e,t){var r=this.records.get(e);return!!r&&(r.timeStamp=Date.now(),!!t&&(r.title&&t.title&&(r.title=t.title),this.records.set(e,r),!0))},t.prototype.remove=function(e){var t=this.records.get(e);return!!t&&(t.timerClock&&(t.timerClock.abort(),t.timerClock=null),this.records.delete(e),!0)},t.prototype.onDisconnect=function(){var t=this;e.prototype.onDisconnect.call(this),this.records.forEach((function(e){t.remove(e.name)}))},(0,n.gn)([o.LO],t.prototype,"records",void 0),(0,n.gn)([o.aD],t.prototype,"create",null),(0,n.gn)([o.aD],t.prototype,"update",null),(0,n.gn)([o.aD],t.prototype,"remove",null),t}(d),Ur=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpUser",t.retried=0,t.url="//api.bilibili.com/x/player/wbi/v2",t}return(0,n.ZT)(t,e),t.prototype.r=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){var r=this;return(0,n.Jh)(this,(function(n){return this.retried=0,this.params=e,this.config=Object.assign({retryCount:3,retryInterval:500},t),[2,this.getRemoteResponse().then((function(e){return{body:r.parse(e.data),response:e}}))]}))}))},t.prototype.getRemoteResponse=function(){var e=this;return this.request({url:this.url,params:this.params,withCredentials:!0}).catch((function(t){return!le.eV.isCanceled(t)&&!le.eV.isGaiaFailed(t)&&e.config.retryCount>e.retried?new Promise((function(t,r){e.timer=window.setTimeout((function(){e.retried++,e.getRemoteResponse().then(t,r),e.log.i("Retry: ".concat(e.retried,"/").concat(e.config.retryCount))}),e.config.retryInterval)})):Promise.reject(t)}))},t.prototype.parse=function(e){var t,r,n,i,o,a,s,u,c,l,d,f,p={err:null},h=e.data||{},y=h.dm_mask||{},m={pn:+h.page_no,mid:+h.login_mid,aid:+h.aid,cid:+h.cid,bvid:h.bvid,name:h.name,hashId:h.login_mid_hash,isOwner:!!h.is_owner,isUgcPayPreview:!!h.is_ugc_pay_preview,allowBp:!!h.allow_bp,blockTime:+h.block_time,role:+h.role,hasNext:!!h.has_next,permission:h.permission,lastCid:+h.last_play_cid,lastPlayTime:+h.last_play_time,onlineCount:+h.online_count,previewToast:h.preview_toast,answerStatus:+h.answer_status,viewPoints:h.view_points,pugvWatchStatus:null!==(r=null===(t=h.pugv)||void 0===t?void 0:t.watch_status)&&void 0!==r?r:0,pugvPayStatus:null!==(i=null===(n=h.pugv)||void 0===n?void 0:n.pay_status)&&void 0!==i?i:0,
pugvSeasonStatus:null!==(a=null===(o=h.pugv)||void 0===o?void 0:o.season_status)&&void 0!==a?a:0,dmMask:{fps:y.fps,maskUrl:y.mask_url},vip:h.vip||{},levelInfo:h.level_info||{},pCdnLoader:h.pcdn_loader||{},is360:null!==(u=!!(null===(s=null==h?void 0:h.options)||void 0===s?void 0:s.is_360))&&void 0!==u&&u,interaction:h.interaction,withoutVip:!!(null===(c=h.options)||void 0===c?void 0:c.without_vip),subtitle:h.subtitle,fawkes:h.fawkes,progressIcon:h.player_icon,longProgress:!!(null===(l=h.show_switch)||void 0===l?void 0:l.long_progress),bgmInfo:null==h?void 0:h.bgm_info,toastBlock:null==h?void 0:h.toast_block,is_upower_exclusive:null==h?void 0:h.is_upower_exclusive,is_upower_play:null==h?void 0:h.is_upower_play,elec_high_level:null==h?void 0:h.elec_high_level,disableShowUpInfo:null==h?void 0:h.disable_show_up_info,needLoginSubtitle:null==h?void 0:h.need_login_subtitle},g=h.operation_card;(null==g?void 0:g.length)&&(m.operationCard=this.parseCard(g)),h.subtitle&&(m.subtitle.submitSwitch=+(null!==(f=null===(d=h.online_switch)||void 0===d?void 0:d.subtitle_submit_switch)&&void 0!==f?f:1));var v={isSystemAdmin:!1,vipType:+m.vip.type,vipStatus:+m.vip.status};return Object.assign(p,m,v),p},t.prototype.parseCard=function(e){return e.map((function(e){var t,r,n={id:e.id,from:e.from,to:e.to,status:e.status,cardType:e.card_type,bizType:e.biz_type};return 1===e.card_type?(n.title=e.standard_card.title,n.buttonTitle=e.standard_card.button_title,n.buttonSelectedTitle=e.standard_card.button_selected_title,n.showSelected=e.standard_card.show_selected,n.seasonId=null===(t=e.param_follow)||void 0===t?void 0:t.season_id,n.activityId=null===(r=e.param_reserve)||void 0===r?void 0:r.activity_id):(n.icon=e.skip_card.icon.replace("http://","//")||"",n.label=e.skip_card.label,n.content=e.skip_card.content,n.button=e.skip_card.button,n.link=e.skip_card.link),n}))},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t),clearTimeout(this.timer)},t}(le.eV),Br=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpView",t}return(0,n.ZT)(t,e),t.prototype.r=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){var r,i=this;return(0,n.Jh)(this,(function(n){return this.params=e,this.config=t,this.httpKind=t.httpKind,r=this.getViewUrl(),[2,this.request({url:r,params:this.getRequestParams(),withCredentials:!0}).then((function(e){return{body:i.parse(e.data),response:e}}))]}))}))},t.prototype.getViewUrl=function(){var e;return((e={})[f.HR.Ugc]="//api.bilibili.com/x/web-interface/wbi/view/detail",e[f.HR.Pgc]="//api.bilibili.com/pgc/view/web/season",e[f.HR.Pugv]="//api.bilibili.com/pugv/view/web/season",e)[this.httpKind]},t.prototype.getRequestParams=function(){switch(this.httpKind){case f.HR.Pgc:case f.HR.Pugv:return{ep_id:this.params.episodeId};case f.HR.Ugc:return this.params.aid?{aid:this.params.aid,need_view:1}:{bvid:this.params.bvid,need_view:1};default:return this.params.aid?{aid:this.params.aid}:{bvid:this.params.bvid}}},t.prototype.parse=function(e){switch(this.httpKind){case f.HR.Pgc:return this.parsePgc(e);case f.HR.Pugv:return this.parsePugv(e);case f.HR.Ugc:default:return this.parseUgc(e,this.params.p)}},t.prototype.parsePgc=function(e){var t=e.result,r={};if(t){var n=t.section,i=t.episodes,o=+t.season_id,a=t.up_info,s=function(e,t){var n=+e.aid,i=+e.cid,o=e.bvid,a=e.cover,s=t+1;n&&(r.aid=n),i&&(r.cid=i),o&&(r.bvid=o),a&&(r.pic=a),s&&(r.p=s)};if(a&&(r.owner={mid:a.mid,name:a.uname,face:a.avatar}),o&&(r.seasonId=o),Array.isArray(i)&&i.length)for(var u=0;u<i.length;u++){if(+(d=i[u]).id==+this.params.episodeId)return s(d,u),r}if(Array.isArray(n)&&n.length)for(u=0;u<n.length;u++){var c=n[u].episodes;if(Array.isArray(c)&&c.length)for(var l=0;l<c.length;l++){var d;if(+(d=c[l]).id==+this.params.episodeId)return s(d,l),r}}}return r},t.prototype.parsePugv=function(e){var t,r,i,o=e.data,a={};if(o){var s=o.episodes,u=+o.season_id,c=o.up_info,l=o.user_status;if(u&&(a.seasonId=u),c&&(a.owner={mid:c.mid,name:c.uname,face:null===(i=c.avatar)||void 0===i?void 0:i.replace("http://","//")}),l&&(a.payed=l.payed),Array.isArray(s)&&s.length)try{for(var d=(0,n.XA)(s),f=d.next();!f.done;f=d.next()){var p=f.value;if(+p.id==+this.params.episodeId){var h=+p.aid,y=+p.cid,m=p.bvid,g=p.cover,v=+p.index;return h&&(a.aid=h),y&&(a.cid=y),m&&(a.bvid=m),g&&(a.pic=g),v&&(a.p=v),a}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}}return a},t.prototype.parseUgc=function(e,t){var r,n=this;if(0!==(null==e?void 0:e.code)){var i=new Error;throw i.data=e,i}var o=e.data,a={};if(o&&o.View){var s=+(o=o.View).aid,u=o.bvid,c=o.pages,l=o.title,d=o.pic,f=o.desc;if(s&&(a.aid=s),u&&(a.bvid=u),l&&(a.title=l),d&&(a.pic=d),f&&(a.desc=f),o.owner&&(a.owner={mid:o.owner.mid,name:o.owner.name,face:null===(r=o.owner.face)||void 0===r?void 0:r.replace("http://","//")}),Array.isArray(o.staff)&&o.staff.length>1&&(a.staff=[],o.staff.forEach((function(e){var t;a.staff.push({mid:e.mid,name:e.name,face:null===(t=e.face)||void 0===t?void 0:t.replace("http://","//")})}))),Array.isArray(c)&&c.length){var p=0,h=!1;if(this.params.cid&&(h=c.some((function(e,t){if(e.cid===n.params.cid)return p=t,!0}))),h)a.p=p+1,a.cid=this.params.cid;else{var y=c[(0,U.Z)(t-1,0,c.length-1)||0];if(y){var m=+y.page,g=+y.cid;m&&(a.p=m),g&&(a.cid=g)}}}}return a},t}(le.eV),jr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpVideoShot",t.url="//api.bilibili.com/x/player/videoshot",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,params:e}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){var t=e.data;return t?{pvData:t.pvdata,xLen:+t.img_x_len,yLen:+t.img_y_len,xSize:+t.img_x_size,ySize:+t.img_y_size,images:t.image}:null},t}(le.eV),Vr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpVideoDetail",t.url="//api.bilibili.com/x/web-interface/wbi/view/detail",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t=this;return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,params:(0,n.pi)((0,n.pi)({},e),{platform:"web"}),method:"get",withCredentials:!0}).then((function(e){return{body:t.parse(e.data),response:e}}))]}))}))},t.prototype.parse=function(e){var t=e.data;return t?{up:{follow:t.Card.following,mid:t.View.owner.mid,name:t.View.owner.name,face:t.View.owner.face,fans:t.Card.follower},video:{title:t.View.title,bvid:t.View.bvid,stat:t.View.stat},relate:t.Related}:{up:null,video:null,relate:null}},t}(le.eV),Hr=function(){function e(){}return e.isBrowserSupported=function(){return!!(window.MediaKeys&&window.navigator&&window.navigator.requestMediaKeySystemAccess&&window.MediaKeySystemAccess&&window.MediaKeySystemAccess.prototype.getConfiguration)},e.probeSupport=function(t){return(0,n.mG)(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,l=this;return(0,n.Jh)(this,(function(d){switch(d.label){case 0:if(!e.isBrowserSupported())throw new Error("Must have basic EME support");return r=t||["org.w3.clearkey","com.widevine.alpha","com.microsoft.playready","com.microsoft.playready.recommendation","com.apple.fps.3_0","com.apple.fps.2_0","com.apple.fps.1_0","com.apple.fps","com.adobe.primetime"],o=[{videoCapabilities:i=[{contentType:'video/mp4; codecs="avc1.42E01E"'}],persistentState:"required",sessionTypes:["persistent-license"]},{initDataTypes:["cenc"],videoCapabilities:i}],a=new Map,s=function(e){return(0,n.mG)(l,void 0,void 0,(function(){var t,r,i;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:if("org.w3.clearkey"===e&&T.X.apple.alike)return[2,a.set(e,null)];n.label=1;case 1:return n.trys.push([1,4,,5]),[4,navigator.requestMediaKeySystemAccess(e,o)];case 2:return t=n.sent(),r=t.ge)];case 3:return n.sent(),[3,5];case 4:return n.sent(),a.set(e,null),[3,5];case 5:return[2]}}))}))},u=r.map((function(e){return s(e)})),[4,Promise.all(u)];case 1:
return d.sent(),c={},a.forEach((function(e,t){c[t]=e})),[2,c]}}))}))},e}(),Gr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpStore",t.validKss=null,t.drmFallback=!1,t}return(0,n.ZT)(t,e),t.prototype.getViewKind=function(){var e={isMissing:!1,isFatalError:!1,httpKind:f.HR.Ugc};switch(this.uiStore.kind){case f.HR.Pgc:this.configStore.episodeId?this.configStore.cid||(e.isMissing=!0):e.isFatalError=!0,e.httpKind=f.HR.Pgc;break;case f.HR.Pugv:this.configStore.episodeId?this.configStore.aid&&this.configStore.cid||(e.isMissing=!0):e.isFatalError=!0,e.httpKind=f.HR.Pugv;break;case f.HR.Ugc:default:this.configStore.aid||this.configStore.bvid?this.configStore.aid&&this.configStore.cid||(e.isMissing=!0):e.isFatalError=!0,e.httpKind=f.HR.Ugc}return e},t.prototype.getPlayUrlParams=function(e){var t,r=this.configStore.httpQuery;switch(this.configStore.channelKind){case f.u5.Embedded:case f.u5.Embedded_White:case f.u5.Embedded_Other:t="external-link";break;case f.u5.Homepage:case f.u5.Homepage_Topic:t="view-card";break;case f.u5.Creator:t="creative-center";break;default:t=""}var n={avid:this.configStore.aid,bvid:this.configStore.bvid,cid:this.configStore.cid,qn:this.qualityStore.requestQ,fnver:0,fnval:ee.x.getFnVal({mseSupported:this.configStore.mseSupported,enableHEVC:this.configStore.enableHEVC,enableAV1:this.configStore.enableAV1}),fourk:1,gaia_source:t,from_client:this.configStore.isChannel(f.u5.PC_APP)?"PC_APP":"BROWSER"};return this.configStore.episodeId&&(n.ep_id=this.configStore.episodeId),this.configStore.session&&(n.session=this.configStore.session),this.configStore.ndb.fnval&&(n.fnval=this.configStore.ndb.fnval),Object.assign({},r.playUrl,n,e)},t.prototype.getPlayUrlConfig=function(e){var t={kind:f.HR.Ugc,mseSupported:this.configStore.mseSupported};switch(this.configStore.channelKind){case f.u5.Manager:t.kind=f.HR.Manager;break;case f.u5.Oneself:t.kind=f.HR.Oneself;break;case f.u5.Default:default:t.kind=this.uiStore.kind}return Object.assign(t,e)},t.prototype.getValidKeySystems=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t,r,i,o;return(0,n.Jh)(this,(function(n){switch(n.labss?[2,this.validKss]:(e=["org.w3.clearkey","com.widevine.alpha","com.apple.fps.3_0","com.apple.fps.2_0","com.apple.fps.1_0","com.apple.fps"],t=Date.now(),259200,(r=this.localStore.get().ksInfo)&&r.ts&&r.kss&&r.ts+259200>t?(this.validKss=r.kss,[2,this.validKss]):(i=[],[4,Hr.probeSupport(e)]));case 1:return(o=n.sent())?(Object.keys(o).forEach((function(e){o[e]&&i.push(e)})),this.localStore.set({ksInfo:{ts:t,kss:i}}),this.validKss=i,[2,this.validKss]):[2]}}))}))},t.prototype.fetchPlayUrl=function(e,t,r){return(0,n.mG)(this,void 0,void 0,(function(){var i,o,a,s,u,c,l,d,p,h,y,m,g;return(0,n.Jh)(this,(function(v){switch(v.label){case 0:return i=this.drmFallback||r&&r.drmFallback,o=new ee.x(this.rootPlayer,{memCache:e}),a=this.getPlayUrlParams(t),s=this.getPlayUrlConfig(r),i?(this.drmFallback=!0,[3,4]):[3,1];case 1:switch(this.uiStore.kind){case f.HR.Pgc:case f.HR.Pugv:return[3,2]}return[3,4];case 2:return[4,this.getValidKeySystems().catch(Me.Z)];case 3:if(u=v.sent(),c=void 0,Array.isArray(u))try{for(l=(0,n.XA)(u),d=l.next();!d.done;d=l.next())switch(d.value){case"com.widevine.alpha":c=2;break;case"com.apple.fps.1_0":default:break;case"org.w3.clearkey":c=3}}catch(e){m={error:e}}finally{try{d&&!d.done&&(g=l.return)&&g.call(l)}finally{if(m)throw m.error}}return c&&Object.assign(a,{drm_tech_type:c}),[3,4];case 4:return v.trys.push([4,6,,7]),[4,o.r(a,s)];case 5:return[2,v.sent()];case 6:if(p=v.sent(),this.track.o("player_url_error",p),h=r&&r.initiator,y=Promise.reject(p),this.episodeStore.state.isRenewal)return[2,y];if(0!==h)return[2,y];if(this.uiStore.kind!==f.HR.Ugc)return[2,y];if(!p||!p.raw||null==!p.raw.code)return[2,y];switch(p.raw.code){case 0:case 87005:case-403:case 87007:break;default:return[2,Promise.reject({code:p.raw.code,errType:2,message:p.message,srcUrl:p.playUrl,raw:p.raw})]}return[2,y];case 7:return[2]}}))}))},t.prototype.fetchUserInfo=function(e){var t,r;return(0,n.mG)(this,void 0,void 0,(function(){var i,o;return(0,n.Jh)(this,(function(n){return i=new Ur(this.rootPlayer,{memCache:e}),o={aid:this.configStore.aid,cid:this.configStore.cid,ep_id:this.configStore.episodeId,season_id:this.configStore.seasonId,graph_version:this.episodeStore.state.isSameEpisode?null===(r=null===(t=this.userStore.info)||void 0===t?void 0:t.interaction)||void 0===r?void 0:r.graph_version:null},this.uiStore.state.kind===f.HR.Ugc&&(delete o.ep_id,delete o.season_id),this.uiStore.state.kind===f.HR.Pugv&&(o.video_type="pugv"),[2,i.r(o)]}))}))},t.prototype.fetchViewInfo=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return this.configStore.localUrl?[2]:[2,new Br(this.rootPlayer,{memCache:e}).r({p:this.configStore.p,aid:this.configStore.aid,cid:this.configStore.cid,bvid:this.configStore.bvid,seasonId:this.configStore.seasonId,episodeId:this.configStore.episodeId},{httpKind:this.getViewKind().httpKind})]}))}))},t.prototype.fetchVideoShot=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,new jr(this.rootPlayer,{memCache:e}).r({aid:this.configStore.aid,cid:this.configStore.cid})]}))}))},t.prototype.fetchVideoDetail=functfunction(){return(0,n.Jh)(this,(function(t){return[2,new Vr(this.rootPlayer,{memCache:e}).r({aid:this.configStore.aid,bvid:this.configStore.bvid,p:this.configStore.p})]}))}))},t}(d),qr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaulble:!1,configurable:!0}),t.prototype.onPrepared=function(){var t=this;e.prototype.onPrepared.call(this),this.dp.pxTimeout=(0,o.gx)((function(){return t.uiStore.state.isLoadTimeout}),(function(){t.track.o(this.dp.pxStart=(0,o.gx)((function(){return!(!t.rootStore.isLoaded||!t.userStore.info)}),(function(){return queueMicrotask((function(){return t.setState({pxStart:!0})}))})),this.dp.vxStart=(0,o.gx)((function(){return!!(t.rootStore.isLoaded&&t.userStore.info&&t.mediaStore.state.firstPlay)}),(function(){return queueMicrotask((function(){return t.setState({vxStart:!0})}))}))},t.prototype.getReportType=function(){switch(this.uiStore.state.kind){case f.HR.Pugv:return 10;case f.HR.Pgc:return 4;case f.HR.Ugc:default:return 3}},t.prototype.getSourceType=function(){var e=this.mpdStore.body;if(e&&e.abTestId)return+e.abTestId+10;if(!this.kernelStore.baseAgent)return 0;if(this.kernelStore.flvKernel){var t=this.kernelStore.flvKernel;return t?"FlvPlayer"===t.type?1:2:0}if(this.kernelStore.dashKernel){var r=this.kernelStore.dashKernel,n=r&&"function"==typeof r.getCurrentCodecID&&r.getCurrentCodecID("video");if(!n)return 0;switch(n){case 12:return this.wmpStore.isUseWasmPlayer(this.mediaStore.video)?5:4;case 13:return 6;defauiStore.kind]||"Unknown";return"".concat(e,":").concat(t,":").concat(this.configr=e.call(this,t)||this;return r.tag="AuxStore",(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",istSwitch:!1,currentMerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.auxStore.state.height+"px"},enumerable:!1,configurable:!0}),t.prototype.onStateCreated=function(){e.prototype.onStateCreated.call(this)},t.prototype.onLoaded=function(t){e.prototype.onLoaded.call(this,t)},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,!0)},(0,n.gn)([o.Fl],t.prototype,"height",null),t}(d),Kr=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="CtrlStore",r.delayShowTimer=null,r.virtualHoverTimer=null,r.clientRect=null,r.clientRectRefresh=0,(0,o.rC)(r),r}return(0,n.ZT)(t,e),
Object.defineProperty(t.prototype,"defaultState",{get:function(){return{containerFocus:!0,containerHover:!0,majorVirtualHover:0,majorHovered:!1,majorHidden:!1,majorTitle:null}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ctrlHidden",{get:function(){return this.isCtrlHidden()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mouseHidden",{get:function(){return this.ctrlHidden&&this.danmakuStore.state.noStopDm&&1!==this.interactStore.state.ctrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this.state.majorTitle},enumerable:!1,configurable:!0}),t.prototype.isCtrlHidden=function(){if(!this.errorStore.state.initError)switch(this.interactStore.state.ctrl){case 1:return!0;case 2:return!1}switch(this.configStore.state.ctrl){case 1:return!0;case 2:return!1}if(!this.mediaStore.state.firstPlay){if(!this.mediaStore.autoplay)return!1;if(d&&!this.state.majorVirtualHover&&((!this.uiStore.isFullView||!this.sendStore.state.focus)&&((!this.mediaStore.state.paused||2!==this.configStore.ctrl)&&this.state.majorHidden))},t.prototype.focus=function(e){this.clearVirtualHoverTimer(),this.setState({majorVirtualHover:e})},t.prototype.blur=function(){this.clearVirtualHoverTimer(),this.setState({majorVirtualHover:0})},t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.dc.ctrlHidden=(0,o.U5)((function(){return t.ctrlHidden}),(function(e){e?queueMicrotask((function(){return t.rootPlayer.emit(a.t.Player_Hide_Controls,new CustomEvent(a.t.Player_Hide_Controls))})):queueMicrotask((function(){return t.rootPlay(a.t.Player_Show_Controls))}))})),this.configStore.emct),(function(e){!e||t.delayShowTimer||t.isCtrlHidden()||t.setCtrlTimer(1e3)}),{fireImmediately:!0})),this.dc.firstPlay=(0,o.U5)((function(){return t.mediaStore.statainerFocus:!0})}),{fireImmediately:!0}),this.dc.forceHidden=(0,o.U5)((function(){return 1===t.interactStore.state.ctrl}),(function(e){t.nodes.controlWrap.hidden=e})),this.dc.virtualHover=(0,o.U5)((function(){return t.state.majorVirtualHover}),(function(e){e&&(t.clearVirtualHoverTimer(),t.virtualHoverTimer=window.setTimeout((function(){t.setState({majorVirtualHover:0})}),e))})),this.addEvents()},t.prototype.addEvents=function(){this.nodes.container.addEventListener("mouseenter",this.onMouseEnterContainer),this.nodes.container.addEventListener("mouseleave",this.onMouseLeaveContainer),this.configStore.onlyTouchMode||(this.nodes.videoArea.addEventListener("mousemove",this.onMouseMoveMedia),this.nodes.videoArea.addEventListener("mouseleave",this.onMouseLeaveMedia)),this.nodes.controlWrap.addEventListener("mouseenter",this.onHoverEnter),this.nodes.controlWrap.addEventListener("mouseleave",this.onHoverLeave),this.nodes.topWrap.addEventListener("mouseenter",this.onHoverEnter),this.nodes.topWrap.addEventListener("mouseleave",this.onHoverLeave),this.rootStore.window.addEventListener("scroll",this.onContainerChanged),this.rootStore.window.addEventListener("click",this.onFocusChanged),this.rootStore.isEmbedSOP&&this.rootStore.parent.addEventListener("click",this.onFocusChanged),this.rootPlayer.on(a.t.Player_Container_Resize,this.onContainerChanged)},t.prototype.removeEvents=function(){this.nodes.container&&(this.nodes.container.removeEventListener("mouseenter",this.onMouseEnterContainer),this.nodes.container.removeEventListener("mouseleave",this.onMouseLeaveContainer)),this.nodes.videoArea&&(this.nodes.videoArea.removeEventListener("mousemove",this.onMouseMoveMedia),this.nodes.videoArea.removeEventListener("mouseleave",this.onMouseLeaveMedia)),this.nodes.controlWrap&&(this.nodes.controlWrap.removeEventListener("mouseenter",this.onHoverEnter),this.nodes.controlWrap.removeEventListener("mouseleave",this.onHoverLeave)),this.nodes.topWrap&&(this.nodes.topWrap.removeEventListener("mouseenter",this.onHoverEnter),this.nodes.topWrap.removeEventListener("mouseleave",this.onHoverLeave)),this.rootStore.window.removeEventListener("scroll",this.onContainerChanged),this.rootStore.window.removeEventListener("click",this.onFocusChanged),ener("click",this.onFocusChanged),this.rootPlayer.off(a.t.Player_Container_Resize,this.onContainerChanged)},t.prototype.onMouseMoveMedia=function(e){var t=e.clientY-this.getValidClientRect().top,r=this.uiStore.state.videoAreaHeight;tCtrlTimer(3e3):this.setCtrlTimedden(!0)},t.prototype.clearCtrlTimer=function(){this.delayShowTimer&&(clearTimeout(this.delayShowTimer),this.delayShowTimer=null)},t.prototype.setCtrlTimer=function(e){var t=this;this.setMajorHidden(!1),this.delayShowTimer=window.setTimeout((function(){t.setMajorHidden(!0)}),e)},t.prototype.setMajorHidden=function(e){this.clearCtrlTimer(),this.setState({majorHidden:e})},t.prototype.onHoverEnter=function(){this.setState({majorHovered:!0})},t.prototype.onHoverLeave=function(){this.setState({majorHovered:!1})},t.prototype.onFocusChanged=function(e){e&&e.target&&this.nodes.container.contains(e.target)?(this.setState({containerFocus:!ramaStore.state.control.contains(e.target)?this.panoramaStore.setState({isActive:!0}):this.panoramaStore.setState({isActive:!1})):(this.setState({containerFocus:!1}),this.panoramaStore.setState({isActive:!1}))},t.prototype.onMouseEnterContainer=function(){this.setState({containerHover:!0})},t.prototype.onMouseLeaveContainer=function(){this.setState({containerHover:!1})},t.prototype.onContainerChanged=function(){this.clientRect=null},t.prototype.getValidClientRect=function(){var e=Date.now();return e-this.clientRectRefresh>12e4&&(this.clientRect=null),this.clientRect||(this.clientRect=this.nodes.container.getBoundirTimer&&(clearTimeout(this.virtualHoverTimer),this.virtualHoverTimer=null)},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,{containerFocus:1,containerHover:1,majorVirtualHover:1,majorHovered:1,majorHidden:1})},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),this.removeEvents(),this.clearCtrlTimer(),this.clearVirtualHoverTimer()},(0,n.gn)([o.Fl],t.prototype,"ctrlHidden",null),(0,n.gn)([o.Fl],t.prototype,"mouseHidden",null),(0,n.gn)([o.Fl],t.prototype,"title",null),(0,n.gn)([i.ZP],t.prototype,"onMouseMoveMedia",null),(0,n.gn)([i.ZP],t.protonHoverLeave",null),(0,n.gn)([i.ZP],t.prototype,"onFocusChanged",null),(0,n.gn)([i.ZP],t.prototype,"onMouseEnterContainer",null),(0,n.gn)([i.ZP],t.prototype,"onMouseLeaveContainer",null),(0,n.gn)([i.ZP],t.prototype,"onContainerChanged",null),t}(d),Yr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="ScreenEventsStore",t.videoInfo={},t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{position:null,dmList:[],saturate:100,brightnessshowEffect:!1,showKeyBoard:!1,showVideoInfo:!1,showSubtitleIssue:!1}},enumerable:!1,configurable:!0}),t.prototype.setVideoInfo=function(e,t){this.videoInfo.info=e,this.videoInfo.type=t,this.state.showVideoInfo&&this.setState({videoInfo:(0,n.pi)({},this.videoInfo)})},t.prototype.getVideoInfoItems=function(){var e=this.videoInfo.type;return this.generateVideoInfoItems(e)},t.prototype.geull==t?void 0:t.statisticsInfo)},t.prototype.getDmByPosition=function(e){var t;return(null===(t=this.state.dmList)||void 0===t?void 0:t.length)&&this.setState({dmList:[]}),this.setState({position:e}),this.state.dmList},
t.prototype.hideAllPopupPanel=function(){this.setState({showIssue:!1,showColor:!1,showEffect:!1,showKeyBoard:!1,showVideoInfo:!1,showSubtitleIssue:!1})},t.prototype.updateVideoInfoData=function(e,t,r){if(!t||!r)return[];if(0===Object.keys(t).length||0===Object.keys(r).length)return[];var n,i,o,a,s=t.width+" x "+t.height;"DashPlayer"===e?s+="@"+Number(t.fps).toFixed(3):(t.hasOwnProperty("sarNum")&&(s+=" [SAR "+t.sarNum+":"+t.sarDen+"]"),t.hasOwnProperty("sar")&&(s+=" [SAR "+t.sar+"]"));try{r.url&&(n=/https?:\/\/(.+?)\//.exec(r.url)[1],i=/^(https?|wss?)\:\/\/?/.exec(r.url)[1]),r.videoURL&&(o=/https?:\/\/(.+?)\//.exec(r.videoURL)[1]),r.audioURL&&(a=/https?:\/\/(.+?)\//.exec(r.audioURL)[1])}catch(e){n="",i=""}var u=r.droppedFrames+" / "+r.decodedFrames,c=this.wmpStore.isUseWasmPlayer(this.mediaStore.video)?"DashPlayer + WasmPlayer":r.playerType,l=[{name:"mimeType",data:t.mimeType},{name:"playerType",data:c},{name:"resolution",data:s},{name:"streamType",data:i},{name:"streamHost",data:n},{name:"droppedFrames",data:u}];if("NativePlayer"===e)return l;if("FlvPlayer"===e){var d=r.currentSegmentIndex+1+"/"+r.totalSegmentCount,f=t.profile+", L"+t.level,p=t.audioSampleRate+" Hz";p+=1===(m=t.audioChannelCount)?", Mono":2===m?", Stereo":", "+m+" Channels",t.metadata&&t.metadata.description&&(p+=t.metadata.description&&/fixed_gap:True/.test(t.metadata.description)?", Fixed":"");var h=t.videoDataRate,y=t.audioDataRate;l=l.concat([{name:"fps",data:Number(t.fps).toFixed(3)},{name:"videoProfile",data:f},{name:"audioSampling",data:p},{name:"videoDatarate",data:Math.round(h)+" Kbps"},{name:"audioDatarate",data:Math.floor(y)+" Kbps"},{name:"segments",data:d},{name:"loader",data:r.loaderType},{name:"connectionSpeed",data:Math.round(r.speed)}])}if("DashPlayer"===e){var m;p=t.audioSampleRate+" Hz";p+=1===(m=t.audioChannelCount)?", Mono":2===m?", Stereo":", "+m+" Channels";h=t.videoDataRate,y=t.audioDataRate;l.splice(3,3);d=(r.audioCurrentSegmentIndex||1)+" / "+(r.audioTotalSegmentCount||0);l=l.concat([{name:"videoDatarate",data:Math.round(h/1024)+" Kbps"},{name:"audioDatarate",data:Math.floor(y/1024)+" Kbps"},{name:"segments",data:d},{name:"droppedFrames",data:u},{name:"videoStreamHost",data:o},{name:"audioStreamHost",data:a},{name:"videoConnectionSpeed",data:Math.round(r.videoConnectionSpeed)},{name:"audioConnectionSpeed",data:Math.round(r.audioConnectionSpeed)},{name:"networkActivity",data:Math.round(r.networkActivity/1024)}])}return l},t.prototype.generateVideoInfoItems=function(e){return"NativePlayer"===e?{infos:[{name:"mimeType",type:"text",title:"Mime Type",data:""},{name:"playerType",type:"text",title:"Player Type",data:""},{name:"resolution",type:"text",title:"Resolution",data:""},{name:"streamType",type:"text",title:"Stream Type",data:""},{name:"streamHost",type:"text",title:"Stream Host",data:""},{name:"droppedFrames",type:"text",title:"Dropped Frames",data:""},{name:"Log",type:"log",title:"Log",data:""}]}:"DashPlayer"===e?{infos:[{name:"mimeType",type:"text",title:"Mime Type",data:""},{name:"playerType",type:"text",title:"Player Type",data:""},{name:"resolution",type:"text",title:"Resolution",data:""},{name:"videoDatarate",type:"text",title:"Video DataRate",data:""},{name:"audioDatarate",type:"text",title:"Audio DataRate",data:""},{name:"segments",type:"text",title:"Segments",data:""},{name:"videoStreamHost",type:"text",title:"Video Host",data:""},{name:"audioStreamHost",type:"text",title:"Audio Host",data:""},{name:"videoConnectionSpeed",type:"graph",title:"Video Speed",unit:"Kbps",data:0},{name:"audioConnectionSpeed",type:"graph",title:"Audio Speed",unit:"Kbps",data:0},{name:"networkActivity",type:"graph",title:"Network Activity",unit:"KB",data:0},{name:"droppedFrames",type:"text",title:"Dropped Frames",data:""},{name:"Log",type:"log",title:"Log",data:""}]}:{infos:[{name:"mimeType",type:"text",title:"Mime Type",data:""},{name:"playerType",type:"text",title:"Player Type",data:""},{name:"resolution",type:"text",title:"Resolution",data:""},{name:"fps",type:"text",title:"FPS",data:""},{name:"videoProfile",type:"text",title:"Video Profile",data:""},{name:"audioSampling",type:"text",title:"Audio Sampling",data:""},{name:"videoDatarate",type:"text",title:"Video DataRate",data:""},{name:"audioDatarate",type:"text",title:"Audio DataRate",data:""},{name:"segments",type:"text",title:"Segments",data:""},{name:"loader",type:"text",title:"Loader",data:""},{name:"streamType",type:"text",title:"Stream Type",data:""},{name:"streamHost",type:"text",title:"Stream Host",data:""},{name:"connectionSpeed",type:"graph",title:"Connection Speed",unit:"KB/s",data:0},{name:"droppedFrames",type:"text",title:"Dropped Frames",data:""},{name:"Log",type:"log",title:"Log",data:""}]}},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,{showVideoInfo:1})},t}(d),Qr=r(10875),zr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){var e;return(e={})[-1]=null,e[1]=null,e[2]=null,e[3]=null,e},enumerable:!1,configurable:!0}),t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.dc.studyNote=(0,o.U5)((functiotion(e){t.rootPlayer.emit(a.t.Player_Hotspot_Change,new CustomEvent(a.t.Player_Hotspot_Change,{detail:{type:-1,data:e}}))})),this.dc.wonderMoment=(0,o.U5)((function(){return t.state[1]}),(function(e){t.rootPlayer.emit(a.t.Player_Hotspot_Change,new CustomEvent(a.t.Player_Hotspot_Change,{detail:{type:1,data:e}}))})),this.dc.division=(0,o.U5)((function(){return t.state[2]}),(function(e){t.rootPlayer.emit(a.t.Player_Hotspot_Change,new CustomEvent(a.t.Player_Hotspot_Change,{detail:{type:2,data:e}}))}))},t.prototype.onLoaded=function(t){e.prototype.onLoaded.call(this,t),this.setInferredHotspot(t.viewPoints),this.setOpenEndHotSpot(this.mpdStore.body.clipInfoList)},t.prototype.setOpenEndHotSpot=function(e){var t=this,r=[];Array.isArray(e)&&(null==e?void 0:e.length)&&e.forEach((function(e){"CLIP_TYPE_OP"===e.clipType&&0===e.start&&r.push({type:3,from:e.end,to:e.end,content:""}),"CLIP_TYPE_ED"===e.clipType&&e.end&&e.start&&e.start<t.portStore.getDuration()&&e.end<=t.portStore.getDuration()&&r.push({type:3,from:e.start,to:e.start,content:""})})),r.length&&this.set({type:3,data:r})},t.prototype.setInferredHotspot=function(e){var t,r,i,o=this;if(Array.isArray(e)){var a=((t={})[-1]=[],t[1]=[],t[2]=[],t);try{for(var s=(0,n.XA)(e),u=s.next();!u.done;u=s.next()){var c=u.value;if(c)switch(c.type){case-1:case 1:case 2:c.content=(0,Qr.t)(tr||(tr=(0,n.cy)(["",""],["",""])),c.content),a[c.type].push(c)}}}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}Object.keys(a).forEach((function(e){var t=+e,r=o.setMissingDivision(a[t]);r.length&&o.set({type:t,data:r})}))}},t.prototype.setMissingDivision=function(e){if(Array.isArray(e)&&e.length&&2===e[0].type){var t=e[0],r=e[e.length-1];t&&null==t.from&&(t.from=0),r&&nuSegmented=function(e){try{var t=JSON.parse(e);return t=t.map((function(e){return{type:e.type,from:e.from,to:e.to,content:e.content||"",permanent:e.permanent}})),this.set({type:2,data:t})}catch(e){return console.warn(e),!1}},t.prototype.addViewPoints=function(e){try{var t=JSON.parse(e);return t=t.map((function(e){return{type:e.type,from:e.from,to:e.to,content:e.content}})),this.set({type:1,data:t})}catch(e){return console.warn(e),!1}},t.prototype.set=function(e){var t;if(!e)return!1;if(null!=e.data&&!Array.isArray(e.data))return!1;switch(e.type){case-1:case 1:case 3:case 2:return this.setState(((t={})[e.type]=e.data,t)),!0;default:return!1}},t.prototype.get=function(e){switch(e){case-1:case 1:case 3:case 2:return{type:e,data:this.state[e]};default:return{type:e,data:null}}},t}(d),Zr=r(92425),Jr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="PanoramaStore",t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{disabled:!0,contextLost:!1,isActive:!1,gesture:!1,opened:!1,control:null,attitude:null,fov:NaN}},enumerable:!1,configurable:!0}),
Object.defineProperty(t.prototype,"attitude",{get:function(){return this.state.attitude},enumeraProperty(t.prototype,"shortcutPrior",{get:function(){return!this.state.disabled&&this.state.opened&&!this.state.contextLost},enumerable:!1,configurable:!0}),t.prototype.onLoaded=function(e){var t=this;e.is360&&(0,Zr.M)()&&!(T.X.msie.alike||T.X.msie.ie11||T.X.edge.alike||T.X.trident.alike)?this.wmpte({disabled:!1})})):this.setState({disabled:!0})},t.prototype.onStateCreated=function(){e.prototype.onStateCreated.call(this),this.setState({opened:this.localStore.get().panorama})},t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.dc.status=(0,o.U5)((function(){return t.state.opened}),(function(){t.localStore.set({panorama:t.state.opened})}))},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,{opened:!0})},t}(d);!function(e){e[e.Default=0]="Default",e[e.Member=1]="Member",e[e.Manager=2]="Manager"}(nr||(nr={}));var Xr,$r={image:"https://s1.hdslb.com/bfs/static/player/img/default.png",textColor:"ffffff",shadowColor:"222222",shadowOffsetX:0,shadowOffsetY:0,shadowRadius:0,progressColor:"00a1d6",progressShadowColor:"00a1d6"},en=((rr={})[nr.Default]="//api.bilibili.com/x/stein/edgeinfo_v2",rr[nr.Manager]="//manager.bilibili.co/x/stein/edgeinfo_v2/audit",rr[nr.Member]="//api.bilibili.com/x/stein/edgeinfo_v2/preview",rr),tn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpInteraction",t.retry=3,t}return(0,n.ZT)(t,e),t.prototype.r=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(r){return this.params=e,this.url=en[t],[2,this.interactionRequest(this.retry)]}))}))},t.prototype.interactionRequest=function(e){var t=this;return this.request({url:this.url,params:this.params,withCredentials:!0}).then((function(r){window.clearTimeout(t.timer);var n=r.data;return n&&0===n.code||99003===n.code?{body:t.parse(n),response:r}:e?void(t.timer=window.setTimeout((function(){return t.interactionRequest(--e)}),1e3)):Promise.reject({code:n.code,message:n.message,url:t.url})}),(function(r){if(window.clearTimeout(t.timer),!e)return Promise.reject({code:-404,message:r.response&&r.response.status&&r.response.status.toString()||"",url:t.url});t.timer=window.setTimeout((function(){return t.interactionRequest(--e)}),1e3)}))},t.prototype.parse=function(e){if(0===e.code&&e.data){var t=e.data,r=[],n=[],i=void 0,o=$r;if(t.story_list&&Array.isArray(t.story_list)&&t.story_list.map((function(e){r.push({edgeId:e.edge_id,title:e.title,cid:e.cid,cover:e.cover.replace("http://","//"),startPos:e.start_pos,cursor:e.cursor,isCurrent:e.is_current})})),t.edges){var a=t.edges;if(a.skin){var s=a.skin;o={image:s.choice_image.replace(/^(https:)?\/\//,"https://"),textColor:s.title_text_color,shadowColor:s.title_shadow_color,shadowOffsetX:s.title_shadow_offset_x,shadowOffsetY:s.title_shadow_offset_y,shadowRadius:s.title_shadow_radius,progressColor:s.progressbar_color,progressShadowColor:s.progressbar_shadow_color}}a.questions&&Array.isArray(a.questions)&&a.questions.map((function(e){var t=[];e.choices&&Array.isArray(e.choices)&&e.choices.map((function(e){t.push({id:e.id,condition:e.condition,nativeAction:e.native_action,platformAction:e.platform_action,option:e.option,cid:e.cid,isDefault:e.is_default,x:e.x,y:e.y,width:e.width,height:e.height,textAlign:e.text_align,customUrl:e.custom_image_url,customWidth:e.custom_image_width,customHeight:e.custom_image_height,customRotate:e.custom_image_rotate,hidden:e.is_hidden,selected:e.selected,submited:e.submited})})),n.push({id:e.id,type:e.type,startTime:e.start_time,startTimeR:e.start_time_r,duration:e.duration,canPause:e.pause_video,title:e.title,color:e.title_color,fontsize:e.title_font_size,choices:t,fadeInTime:e.fade_in_time,fadeOutTime:e.fade_out_time})})),i={dimension:a.dimension,skin:o,questions:n}}return{code:e.code,message:e.message,data:{isLeaf:t.is_leaf,storyList:r,edgeId:t.edge_id,title:t.title,edges:i,buvid:t.buvid,hiddenVars:t.hidden"===e||(!!/^[A-Z]$/i.test(e)||!(t||!/^[0-9]$/.test(e)))}!function(e){e.Name="Name",e.Number="Number",e.End="End",e.Equal="Equal",e.NotEqual="NotEqual",e.GreaterEqual="GreaterEqual",e.LessEqual="LessEqual",e.Print="Print",e.Plus="+",e.Subtract="-",e.Multiply="*",e.Divide="/",e.And="&",e.Greater=">",e.Less="<",e.Or="|",e.Not="!",e.LBracket="(",e.RBracket=")",e.Assign="="}(Xr||(Xr={}));var nn,on=function(){function e(e){this.express=e,this.index=-1,this.current={kind:Xr.Print}}return Object.defineProperty(e.prototype,"kind",{get:function(){return this.current.kind},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"str",{get:function(){return this.current.str},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"num",{get:function(){return this.current.num},enumerable:!1,configurable:!0}),e.prototype.putforward=function(){return this.char=this.express[++this.index],this.char},e.prototype.putback=function(){return this.char=this.express[--this.index],this.char},e.prototype.getNext=function(){do{if(this.putforward(),!this.char)return this.current={kind:Xr.End}}while("\n"!==this.char&&(e=this.char,t=void 0,(t=e.charCodeAt(0))>8&&t<14||32===t));var e,t;switch(this.char){case";":case"\n":return this.current={kind:Xr.Print};case"*":case"/":case"+":case"-":case"(":case")":return this.current={kind:this.char};case">":return"="===this.putforward()?this.current={kind:Xr.GreaterEqual}:(this.putback(),this.current={kind:Xr.Greater});case"<":return"="===this.putforward()?this.current={kind:Xr.LessEqual}:(this.putback(),this.current={kind:Xr.Less});case"=":return"="===this.putforward()?this.current={kind:Xr.Equal}:(this.putback(),this.current={kind:Xr.Assign});case"&":return"&"===this.putforward()?this.current={kind:Xr.And}:(this.putback(),Error("bad token"),this.current={kind:Xr.Print});case"|":return"|"===this.putforward()?this.current={kind:Xr.Or}:(this.putback(),Error("bad token"),this.current={kind:Xr.Print});case"!":return"="===this.putforward()?this.current={kind:Xr.NotEqual}:(this.putback(),this.current={kind:Xr.Not});case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case".":this.current.kind=Xr.Number;for(var r=this.char;this.putforthis.char;return this.current.num=Number(r),this.putback(),this.current;default:if(rn(this.char,!0)){for(this.current.kind=Xr.Name,this.current.str=this.char;this.putforward()&&rn(this.char,!1);)this.current.str+=this.char;return this.putback(),this.current}return Error("bad token"),this.current={kind:Xr.Print}}},e}(),an=function(){function e(e){this.table=null!=e?e:{}}return e.prototype.logicalExpress=function(e){for(var t=this.comparisonExpress(e);;)switch(this.token.kind){case Xr.And:t=0!==this.comparisonExpress(!0)&&0!==t?1:0;break;case Xr.Or:t=0!==this.comparisonExpress(!0)||0!==t?1:0;break;default:return t}},e.prototype.comparisonExpress=function(e){for(var t=this.numberExpress(e);;)switch(this.token.kind){case Xr.Equal:t=t===this.numberExpress(!0)?1:0;break;case Xr.NotEqual:t=t!==this.numberExpress(!0)?1:0;break;case Xr.Greater:t=t>this.numberExpress(!0)?1:0;break;case Xr.GreaterEqual:t=t>=this.numberExpress(!0)?1:0;break;case Xr.Less:t=t<this.numberExpress(!0)?1:0;break;case Xr.LessEqual:t=t<=this.numberExpress(!0)?1:0;break;default:return t}},e.prototype.numberExpress=function(e){for(var t=this.term(e);;)switch(this.token.kind){case Xr.Plus:t+=this.term(!0);break;case Xr.Subtract:t-=this.term(!0);break;default:return t}},e.prototype.term=function(e){for(var t,r=this.prim(e);;)switch(this.token.kind){case Xr.Multiply:r*=this.prim(!0);break;case Xr.Divide:if(!(t=this.prim(!0)))return console.error("divide by 0"),1/0;r/=t;break;default:return r}},e.prototype.prim=function(e){
switch(e&&this.token.getNext(),this.token.kind){case Xr.Number:var t=this.token.num;return this.token.getNext(),t;case Xr.Name:this.table||(this.table={});t=this.token.str;return this.token.getNext().kind===Xr.Assign?this.table[t]=this.logicalExpress(!0):void 0===this.table[t]&&(this.table[t]=0),this.table[t];case Xr.Plus:return+this.prim(!0);case Xr.Subtract:return-this.prim(!0);case Xr.Not:return 0===this.prim(!0)?1:0;case Xr.LBracket:var r=this.logicalExpress(!0);return this.token.getNext(),r;default:return console.error("primary expected"),1/0}},e.prototype.eval=function(e){this.token=new on(e);for(var t=0pected char")}return t},e}();function sn(e,t){for(var r=new an(e),n="",i="",o=!1,a=t[0],s=0;a;)o?"`"===a?(o=!1,n+=r.eval(i)):i+=a:"`"===a?(o=!0,i=""):n+="\\"===a?a=t[++s]:a,a=t[++s];return n}!function(e){e[e.StoryList=0]="StoryList",e[e.TimeLine=1]="TimeLine",e[e.Question=2]="Question",e[e.Restart=3]="Restart",e[e.HistoryWatch=4]="HistoryWatch",e[e.Special=5]="Special"}(nn||(nn={}));var un,cn,ln=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="InteractStore",r.preloadSymbol=!1,r.preloadAjax=[],r.interactionConfig={isLastPart:!1,portal:0,choiceSet:"",targetId:0,hiddenVars:null},r.hiddenMap={},r.preloadDataMap=new Map,(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{disabled:!1,graphId:null,graphVersion:null,fetchStatus:null,needReload:!1,storyList:null,currentEdgeId:null,hiddenVars:null,questions:null,skin:null,dimension:null,noBacktracking:!1,noTutorial:!1,rookieGuide:!1,ctrl:0,unLoginToastId:null,special:null}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDisableSeamless",{get:function(){return!!(T.X.msie.alike||T.X.edge.alike||T.X.msie.ie11)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderInteractionTPL",{get:function(){return!!this.state.graphVersion},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showHiddenVars",{get:function(){if(this.state.hiddenVars){var e=this.state.hiddenVars.filter((function(e){return e.is_show}));return e.length&&!this.state.noBacktracking?e:null}return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canPrefetchPlayurl",{get:function(){return this.state.questions&&!this.preloadSymbol?this.mediaStore.state.currentTime:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"questions",{get:function(){var e=this.mediaStore.state.duration,t=[],r=null;if(this.state.questions)for(var i=0;i<this.state.questions.length;i++){var o=this.state.questions[i];if(!o.startTime&&o.startTimeR&&e&&(o.startTime=1e3*e-o.startTimeR),4!==o.type)0===o.type&&o.duration<=0?r=(0,n.pi)((0,n.pi)({},o),{start:e,end:e,autoSkip:!0}):o.duration<=0?r=(0,n.pi)((0,n.pi)({},o),{start:e,end:e,autoSkip:!1}):t.push((0,n.pi)((0,n.pi)({},o),{start:1e3*e-o.duration,end:1e3*e,countdown:!0,autoSkip:!1}));else{var a=!1;!o.canPause&&o.duration>0&&(a=!0),t.push((0,n.pi)((0,n.pi)({},o),{start:o.startTime,end:o.startTime+o.duration,countdown:a,autoSkip:!1}))}}return{inEnd:r,inPlay:t}},enumerable:!1,configurable:!0}),t.prototype.onNavigate=function(){e.prototype.onNavigate.call(this),this.episodeStore.state.isSameEpisode||this.reset()},t.prototype.onLoaded=function(t){var r=this;e.prototype.onLoaded.call(this,t);var n=t.i()?this.wmpStore.fallbackWasmPlayer(7015).then((function(){!r.state.disabled&&(null==n?void 0:n.graph_version)&&(1==+n.need_reload?r.setState({needReload:!0}):r.setState({graphVersion:n.graph_version}))})):this.setState({graphVersion:null})),this.dp.fetchIstate.graphVersion}),(function(){r.state.graphVersion&&r.fetchInteraction()})),this.dp.canPreloadPlayurl=(0,o.U5)((function(){return r.canPrefetchPlayurl}),(function(){r.canPrefetchPlayurl&&r.state.questions.map((function(e){var t;4!==e.type&&(null===(t=e.choices)||void 0===t?void 0:t.length)&&r.prefetchPlayurl(e.choices).catch((function(e){return r.log.i(e&&e.message)}))}))}))},t.prototype.getInteractionUrlKind=function(){var e;switch(this.configStore.channelKind){case f.u5.Creator:e=nr.Member;break;case f.u5.Manager:e=nr.Manager;break;case f.u5.Default:default:e=nr.Default}return e},t.prototype.getInteractionParams=function(){return{platform:"pc",graph_version:this.state.graphVersion,portal:this.interactionConfig.portal,screen:this.uiStore.screenKind,edge_id:this.state.currentEdgeId,choices:this.interactionConfig.choiceSet,aid:this.configStore.aid,buvid:be.buvid()}},t.prototype.fetchInteraction=function(){var e=this;new tn(this.rootPlayer).r(this.getInteractionParams(),this.getInteractionUrlKind()).then((function(t){var r,n,i,o,a;0===(null===(r=null==t?void 0:t.body)||void 0===r?void 0:r.code)&&(null===(n=null==t?void 0:t.body)||void 0===n?void 0:n.data)?(e.parseBody(t.body.data),e.setState({fetchStatus:!0})):99003===(null===(i=null==t?void 0:t.body)||void 0===i?void 0:i.code)?e.setSeamless(!0):(e.setState({graphVersion:null,fetchStatus:!1}),e.toastStore.create({text:"",duration:5e3}),e.track.e("interactive_loadfail",{aid:e.configStore.aid,cid:e.configStore.cid,bvid:e.configStore.bvid,code:null===(o=null==t?void 0:t.body)||void 0===o?void 0:o.code,message:(null===(a=null==t?void 0:t.body)||void 0===a?void 0:a.message)||""}))})).catch((function(t){e.setState({graphVersion:null,fetchStatus:!1}),e.toastStore.create({text:"",duration:5e3}),e.track.e("interactive_loadfail",{aid:e.configStore.aid,cid:e.configStore.cid,bvid:e.configStore.bvid,code:null==t?void 0:t.code,message:(null==t?void 0:t.message)||""})}))},t.prototype.parseBody=function(e){var t=this;this.userStore.info.mid||(this.recordKey="bpx_interaction_".concat(this.configStore.bvid||this.configStore.aid),this.setSessicktracking,i=e.noTutorial,o=e.storyList,a=e.edges,s=e.isLeaf,u=e.hiddenVars,c=e.title;r?this.endingStore.setState({disabled:!0}):this.endingStore.setState({disabled:!1}),this.setState({noBacktracking:!!n,noTutorial:!!i}),Array.isArray(o)&&o.length&&(null===this.state.currentEdgeId&&this.setState({currentEdgeId:+o[0].edgeId}),this.setState({storyList:o})),Array.isArray(u)&&u.length&&(this.setState({hiddenVars:u}),u.map((function(e){t.hiddenMap[e.id_v2]=e.value}))),this.ctrlStore.setState({majorTitle:sn(this.hiddenMap,c)}),Array.isArray(null==a?void 0:a.questions)&&a.questions.length&&(this.setState({skin:a.skin,dimension:a.dimension,questions:a.questions}),127===a.questions[0].type?this.setState({special:!0}):this.setState({special:!1})),this.setInteractionConfig({isLastPart:!!s})},t.prototype.setSessionRecord=function(e){try{var t={cid:this.configStore.cid,edgeId:e.edgeId,title:e.title,cover:"//i0.hdslb.com/bfs/steins-gate/".concat(this.configStore.cid,"_screenshot.jpg"),startPos:0,cursor:0},r=this.interactionConfig.targetId,n={graphVersion:this.state.graphVersion,aid:this.configStore.aid,bvid:this.configStore.bvid,list:[]},i=this.getSessionRecord()||n;this.state.graphVersion===i.graphVersion?i.list[r]||(i.list[r]={ptr:r,story:t}):(this.setInteractionConfig({targetId:0}),r=0,i=Object.assign({},n,{list:[{ptr:r,story:t}]})),this.interactionConfig.hiddenVars?e.hiddenVars=this.interactionConfig.hiddenVars:this.setInteractionConfig({hiddenVars:e.hiddenVars||null}),i.list[r].hiddenVars=this.interactionConfig.hiddenVars,i.list.filter((function(e){if(void 0!==e&&e.story)return e})),e.storyList=i.list.map((function(e){return e.story})),this.saveSessionRecord(i)}catch(e){console.warn(e)}},t.prototype.getSessionRecord=function(){return this.sessionStore.get().interaction[this.recordKey]},t.prototype.saveSessionRecord=function(e){var t;this.sessionStore.set({interaction:(t={},t[this.recordKey]=e,t)})},t.prototype.clearSessionRecord=function(){
this.sessionStore.get().interaction[this.recordKey]&&delete this.sessionStore.get().interaction[this.recordKey]},t.prototype.updateSessionRecord=function(){var e,t,r=this;if(0===this.interactionConfig.portal&&!this.userStore.info.mid){var n=this.getSessionRecord(),i=null===(e=null==n?void 0:n.list)||void 0===e?void 0:e.length;if(i&&i>this.interactionConfig.targetId){var o=!0,a=n.list[this.interactionConfig.targetId+1];if(null===(t=null==a?void 0:a.hiddenVars)||void 0===t?void 0:t.length)for(var s=a.hiddenVars,u=0;u<s.length;u++)void 0!==this.hiddenMap[s[u].id_v2]&&this.hiddenMap[s[u].id_v2]===s[u].value||(o=!1);else o=!1;o||n.list.splice(this.interactionConfig.targetId+1,i)}this.saveSessionRecord(n),this.interactionConfig.targetId++,this.interactionConfig.hiddenVars&&this.interactionConfig.hiddenVars.map((function(e){void 0!==r.hiddenMap[e.id_v2]&&(e.value=r.hiddenMap[e.id_v2])}))}},t.prototype.setSeamless=function(e){this.kernelStore.dashKernel&&!this.isDisableSeamless&&this.kernelStore.dashKernel.setEndOfStreamState(e)},t.prototype.prefetchPlayurl=function(e){var t,r,i,o;return(0,n.mG)(this,void 0,void 0,(function(){var a,s,u,c,l,d,p;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:if(this.preloadSymbol||this.configStore.isChannel(f.u5.Manager))return[2,!0];if(!(this.kernelStore.dashKernel&&this.kernelStore.dashKernel.getBufferLength("video")>9||this.mediaStore.state.duration-this.mediaStore.state.currentTime<9))return[3,9];this.preloadSymbol=!0,a=0,n.label=1;case 1:return a<e.length?(s=e[a].cid)?this.preloadDataMap.has(s)?[3,6]:[4,this.mpdStore.prefetchPlayUrl({cid:s,ep_id:this.configStore.episodeId}).promise]:[3,7]:[3,9];case 2:return(u=n.sent())?[4,this.mpdStore.prefetchAVData(u.body)]:[3,6];case 3:return c=n.sent(),(null===(t=c.vbHttp)||void 0===t?void 0:t.xhr)&&this.preloadAjax.push(c.vbHttp.xhr),(null===(r=c.abHttp)||void 0===r?void 0:r.xhr)&&this.preloadAjax.push(c.abHttp.xhr),[4,null===(i=c.vbHttp)||void 0===i?void 0:i.promise];case 4:return l=n.sent(),[4,null===(o=c.abHttp)||void 0===o?void 0:o.promise];case 5:d=n.sent(),p={type:"dash"},l&&(p=Object.assign({},p,{videoUrl:c.videoUrl,videoId:String(c.videoQn),video:l})),d&&(p=Object.assign({},p,{audioUrl:c.audioUrl,audioId:String(c.audioQn),audio:d})),this.preloadDataMap.set(s,{playurlData:u.raal cid in prefetchPlayurl function"),n.label=8;case 8:return a++,[3,1];case 9:return[2]}}))}))},t.prototype.restart=function(){var e;if(this.state.graphVersion&&(null===(e=this.state.storyList)||void 0===e?void 0:e.length)){var t=this.state.storyList[0];this.callNextEdge({cid:+t.cid,edgeId:+t.edgeId,type:nn.Restart},{portal:1,targetId:null,hiddenVars:null,choiceSet:""})}},t.prototype.timeline=function(){return this.state.graphVersion?this.state.storyList:null},t.prototype.isComplete=function(){return this.userStore.isInteraction?!!this.interactStore.interactionConfig.isLastPart&&this.portStore.isEnded(!1):null},t.prototype.jump=function(e){var t=this.timeline();if(Array.isArray(t)&&e<t.length){var r=t[e];this.callNextEdge({type:nn.TimeLine,cid:r.cid,edgeId:r.edgeId,startPos:r.startPos},{portal:1,targetId:e,hiddenVars:null,choiceSet:""})}},t.prototype.setInteractionConfig=function(e){if((0,c.Z)(this.interactionConfig)&&(0,c.Z)(e))for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&Object.prototype.hasOwnProperty.call(this.interactionConfig,t)&&this.interactionConfig[t]!==e[t]&&(this.interactionConfig[t]=e[t])},t.prototype.callNextEdge=function(e,t){var r;return this.log.i("[call next edge]",He(un||(un=(0,n.cy)(["from: ",", config: ",", alt: ",""],["from: ",", config: ",", alt: ",""])),e.type,e,t)),this.setState({currentEdgeId:e.edgeId}),t&&this.setInteractionConfig((0,n.pi)({},t)),this.updateSessionRecord(),this.episodeStore.reload({aid:this.configStore.aid,bvid:this.configStore.bvid,episodeId:this.configStore.episodeId,cid:e.cid,t:null!==(r="".concat(e.startPos/1e3))&&void 0!==r?r:null,stats:this.configStore.stats},{isSameEpisode:!0})},t.prototype.getDisableTime=function(e){if(!Array.isArray(this.state.questions))return 0;for(var t=0;t<this.state.questions.length;t++){var r=1e3*e,n=this.state.questions[t],i=this.mediaStore.state.duration;if(this.state.special){var o=1e3*(i+1)||n.fadeOutTime-n.startTime+1e3;retu.startTime&&i-n.startTime/1e3||0}var a=n.type;if(4===a&&r>n.startTime&&r<n.duration+n.startTime)return i-n.startTimeturn n.duration/1e3||0}},t.prototype.reset=function(){this.setState({currentEdgeId:null}),this.setInteractionConfig({isLastPart:!1,portal:0,choiceSet:"",targetId:0,hidden{e.abort()})),this.preloadAjax=[]),e.prototype.onDispose.call(this,{rookieGuide:!0,currentEdgeId:!0})},t.prototype.onDisconnect=function(){this.preloadDataMap.clear()},(0,n.gn)([o.Fl],t.prototype,"renderInteractionTPL",null),(0,n.gn)([o.Fl],t.prototype,"showHiddenVars",null),(0,n.gn)([o.Fl],t.prototype,"canPrefetchPlayurl",null),t}(d);!function(e){e.weibo="weibo_web",e.tieba="tieba_web",e.qzone="qzone_web",e.qq="qq_web",e.link="copy_web",e.qrcode="weixin_web"}(cn||(cn={}));var dn,fn,pn,hn,yn,mn,gn=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="ShareStore",r.config={url:"",title:"",pic:"",description:"",iframeSrc:"",weiboTag:"#bilibili#"},(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{opened:!1}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){if(-1===this.config.url.indexOf("null"))return-1===this.config.url.indexOf("?")?"".concat(this.config.url,"?share_source="):"".concat(this.config.url,"&share_source=")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"embededUrl",{get:function(){if(-1.url.indexOf("?")?"".concat(this.config.url,"?"):"".concat(this.config.url,"&")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this.config.title.substr(0,120)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pic",{get:function(){return this.config.pic},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this.config.description.substr(0,120)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iframeSrc",{get:function(){return this.config.iframeSrc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"weiboTag",{get:function(){return this.config.weiboTag},enumerable:!1,configurable:!0}),t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.dc.openedChange=(0,o.U5)((function(){return t.state.opened}),(function(e){queueMicrotask((function(){t.rootPlayer.isInitialized&&(t.log.i("".concat(e?"Open":"Close"," SharePanel")),t.rootPlayer.emit(a.t.Player_SharePanel_Change,new CustomEvent(a.t.Player_SharePanel_Change,{detail:{opened:e}})))}))})),this.rootPlayer.on(a.t.Player_Play,(function(){return t.close()})),this.rootPlayer.on(a.t.Player_Seeking,(function(){return t.close()}))},t.prototype.onPrepared=function(){var t,r;e.prototype.onPrepared.call(this);var i=this.rootPlayer.window.document.title||this.ctrlStore.title||this.storyStore.state.title,o=(t=this.configStore).bvid,a=t.aid,s=t.cid,u="",c="";if(o||a||s)u=o?"".concat(this.rootPlayer.window.location.protocol,"//www.bilibili.com/video/").concat(this.configStore.bvid):"".concat(this.rootPlayer.window.location.protocol,"//www.bilibili.com/video/av").concat(this.configStore.aid),u=this.configStore.p>1?u+"?p=".concat(this.configStore.p):u,c="//player.bilibili.com/player.html?".concat(this.configStore.bvid?"bvid=".concat(this.configStore.bvid):"aid=".concat(this.configStore.aid),"&cid=").concat(this.configStore.cid,"&p=").concat(this.configStore.p,"&share_source=").concat(cn.link);else{var l=f.HR.Pgc;this.uiStore.kind===f.HR.Pgc&&(u="https://www.bilibili.com/bangumi/play/ep".concat(this.configStore.episodeId)),
this.uiStore.kind===f.HR.Pugv&&(u="https://www.bilibili.com/cheese/play/ep".concat(this.configStore.episodeId),l=f.HR.Pugv),c="//player.bilibili.com/player.html?episodeId=".concat(this.configStore.episodeId,"&kind=").concat(l)}var d=(null===(r=document.querySelector('meta[name="description"]'))||void 0===r?void 0:r.getAttribute("content"))||this.ctrlStore.title||this.storyStore.state.title;this.setConfig({url:u,iframeSrc:c}),i&&this.setConfig({title:(0,Qr.t)(dn||(dn=(0,n.cy)(["",""],["",""])),i)}),d&&this.setConfig({description:d})},t.prototype.open=function(e){var t;if(!t r=this.rootPlayer.window.document.title||this.ctrlStore.title||this.storyStore.state.title,i=(null===(t=document.querySelector('meta[name="description"]'))||void 0===t?void 0:t.getAttribute("content"))||this.ctrlStore.title||this.storyStore.state.title;this.setConfig({title:(0,Qr.t)(fn||(fn=(0,n.cy)(["",""],["",""])),r),description:i}),this.setState({opened:!0})}e&&this.setConfig(e)}},t.prototype.close=function(){this.state.opened&&this.setState({opened:!1})},t.prototype.setConfig=function(e){if((0,c.Z)(this.config)&&(0,c.Z)(e))for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&Object.prototype.hasOwnProperty.call(this.config,t)&&this.config[t]!==e[t]&&(this.config[t]=e[t])},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.close()},(0,n.gn)([o.LO],t.prototype,"config",void 0),(0,n.gn)([o.Fl],t.prototype,"url",null),(0,n.gn)([o.Fl],t.prototype,"embededUrl",null),(0,n.gn)([o.Fl],t.prototype,"title",null),(0,n.gn)([o.Fl],t.prototype,"pic",null),(0,n.gn)([o.Fl],t.prototype,"description",null),(0,n.gn)([o.Fl],t.prototype,"iframeSrc",null),(0,n.gn)([o.Fl],t.prototype,"weiboTag",null),(0,n.gn)([o.aD],t.prototype,"setConfig",null),t}(d),vn=function(e){function t(t){var r,n=e.call(this,t)||this;return n.tag="SubtitleStore",n.renderData=((r={})[0]=null,r[1]=null,r),(0,o.rC)(n),n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{hover:!1,enable:!1,isclosed:!0,lan:"",minorLan:"",fade:!1,color:"",scale:!1,shadow:null,opacity:null,fontsize:null,bilingual:!1,position:null,languageList:null}},enumerable:!1,configurable:!0}),t.prototype.onStateCreated=function(){e.prototype.onStateCreated.call(this),this.setState(this.localStore.get().subtitle)},t.prototype.onMounted=function(){var t=this;e.prototype.onMounted.call(this),this.dc.fade=(0,o.U5)((function(){return t.state.fade}),(function(e){t.localStore.set({subtitle:{fade:e}})})),this.dc.color=(0,o.U5)((function(){return t.state.color}),(function(e){t.localStore.set({subtitle:{color:e}})})),this.dc.scale=(0,o.U5)((function(){return t.state.scale}),(function(e){t.localStore.set({subtitle:{scale:e}})})),this.dc.shadow=(0,o.U5)((function(){return t.state.shadow}),(function(e){t.localStore.set({subtitle:{shadow:e}})})),this.dc.opacity=(0,o.U5)((function(){return t.state.opacity}),(function(e){t.localStore.set({subtitle:{opacity:e}})})),this.dc.fontsize=(0,o.}),(function(e){t.}})})),this.dc.position=(0,o.U5)((function(){return t.state.position}),(function(e){t.localStore.set({subtitle:{position:e}nction(e){var t,r,n,i=null==e?void 0:e.subtitle;if(i&&((null===(t=i.subtitles)||void 0===t?void 0:t.length)||i.allow_submit||e.isOwner||(null==e?void 0:e.needLoginSubtitle))){var o=Object.assign([],i.subtitles);o.sort((function(e,t){return e.lan>t.lan?-1:1}));var a=o.filter((function(e){return 2!==e.ai_status})),s=a.length?a:o,u=this.getDefaultLa==r?void 0:r.lan),c=(a.length>1?a:o).filter((function(e)(null===(n=c[0])||void 0===n?void 0:n.lan);o.length&&this.setState({languageList:o}),a.length<=1&&this.setState({bilingual:!1}),this.setState({isclosed:!a.length,lan:u||"",minorLan:l||""}),this.setState({enable:!0})}},t.prototype.getDefaultLanguage=function(e,t){var r=function(t){var r=-1;return e.some((function(e,n){if(e.lan===t)return r=n,!0})),-1!==r},n=function(t){t=t.split("-")[0];var r=e.find((function(e){return new RegExp("^".concat(t,"-")).test(e.lan)}));return r&&r.lan},i=this.localStore.get().subtitle[t];if("close"===i)return null;if(i&&r(i))return i;if(navigator.language){if(r(navigator.language))return navigator.language;if(a=n(navigator.language))return a}if(navigator.languages){for(var o=0;o<navigator.languages.length;o++)if(r(navigator.languages[o]))return navigator.languages[o];for(o=0;o<navigator.languages.length;o++){var a;if(a=n(navigator.languages[o]))return a}}return null},t.prototype.findLanguageItem=function(e){return this.state.languageList&&e?this.state.languageList.find((function(t){return t.lan===e})):null},t.prototype.addSubtitle=function(e){var t;if(this.setState({enable:!0}),Array.isArray(];r.body.sort((function(e,t){return e.from-t.from})),this.rootPlayer.emit(s.p.PLAYER_CLEAR_SUBTITLE,0),this.setRenderData(0,r.body),i&&(i.body.sort((function(e,t){return e.from-t.from})),this.rootPlayer.emit(s.p.PLAYER_CLEAR_SUBTITLE,1),this.setRenderData(1,i.body))}else e.body.sort((function(e,t){return e.from-t.from})),this.rootPlayer.emit(s.p.PLAYER_CLEAR_SUBTITLE,0),this.setRenderData(0,e.body)},t.prototype.setRenderData=function(e,t){this.renderData[e]=t},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,{isclosed:1,fade:1,color:1,scale:1,shadow:1,opacity:1,fontsize:1,bilingual:1,position:1}),this.se(0,n.gn)([o.aD],t.prototype,"setRenderData",null),t}(d),_n=((pn={})[2]={value:"",prefix:"division"},pn[1]={value:"",prefix:"wonder"},pn[-1]={value:"",prefix:"note"},pn[3]={value:"",prefix:"oped"},pn),En=function(e){function t(t){var r=e.call(this,t)||this;return(0,o.rC)(r),r}return(0,n.e",{get:function(){return{hasPreview:!0,isHover:!1,isDragging:!1,viewpointListOpened:!1,pbp:null,pbpstate:null}},enumerable:!1,configurable:!0}),t.prototype.onStateCreated=function(){e.prototype.onStateCreated.call(this),this.setState({pbpstate:this.localStore.get().progress.pbpstate})},t.prototype.onMounted=function(){var t=this;e.prototype.onMounted.call(this),this.dc.pbpstate=(0,o.U5)((function(){return t.state.pbpstate}),(function(e){t.localStore.set({progress:{pbpstate:e}})}))},Object.defineProperty(t.prototype,"isActive",{get:function(){var e=this.state.isHover,t=this.state.isDragging;return e||t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferRatio",{get:function(){return this.mediaStore.state.remoteDuration&&this.mediaStore.state.bufferedTime/this.mediaStore.state.remoteDuration||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentRatio",{get:function(){return this.mediaStore.state.remoteDuration&&this.mediaStore.state.progressTime/this.mediaStore.state.remoteDuration||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"segmentData",{get:function(){return this.mediaStore.state.remoteDuration?this.hotspotStore.state[2]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewpoint",{get:function(){if(!this.mediaStore.state.remoteDuration)return null;var e=this.hotspotStore.state[1],t=this.hotspotStore.state[2],r=Object.assign([],e);return(null==t?void 0:t.length)&&(r=r.concat(t)),r.length?r:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeDivisionIndex",{get:function(){var e;if(null===(e=this.segmentData)||void 0===e?void 0:e.length){for(var t=this.mediaStore.state.currentTime+.001,r=0;r<this.segmentData.length;r++){var n=this.segmentData[r];if(t>=n.from&&t<=n.to)return r}return null}return null},enumerable:!1,configurable:!0}),t.prototype.onDntRatio",nullsionIndex",null),t}(d);function bn(e,t){return!(t<=1)&&(e>=0&&e<t-1)}!function(e){e.None="none",e.Start="start",e.Cancel="cancel"}(hn||(hn={})),function(e){e[e.UGCSinglePart=0]="UGCSinglePart",e[e.UGCMultiPart=1]="UGCMultiPart",e[e.UGCSeasonPart=2]="UGCSeasonPart",e[e.PlaylistPart=3]="PlaylistPart",e[e.ActivityPart=4]="ActivityPart"}(yn||(yn={})),function(e){e[e.Disable=-1]="Disable",e[e.Electric=1]="Electric",e[e.ElectricPlus=2]="ElectricPlus",e[e.HighElectric=3]="HighElectric"}(mn||(mn={}));var Sn,Tn=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="ManuscriptStore",(0,o.rC)(r),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{title:"",cover:"",type:null,list:null,likeStatus:!1,coinStatus:!1,collectStatus:!tDisable:!1,related:null,relatedAutoplay:!1,likeIcon:"",electricStatus:mn.Disable,electricBtnIcon:"",electricBtnText:"",stat:null,payed:null}},enumerable:!1,configurable:!0}),t.prototype.onPrepared=function(){e.prototype.onPrepared.call(this),this.configStore.embeddedEnv&&this.fetchStoryInfo(),this.togglePoster(!0),this.fetchViewInfo()},t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.rootPlayer.on(s.p.MEDIA_PLAY,(function(){return t.togglePoster(!1)}))},Object.defineProperty(t.prototype,"tripleStatus",{get:function(){var e,t=(e=this.state).likeStatus,r=e.coinStatus,n=e.collectStatus,i=t&&r&&n;return this.hasTriple&&i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTriple",{get:function(){var e,t=(e=this.state).likeDisable,r=e.coinDisable,n=e.collectDisable;return!(t||r||n||this.configStore.isChannel(f.u5.Embedded))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"eplist",{get:function(){var e,t,r,n,i=this.state.list;if(i&&i.length){for(var o=[],a=0;a<i.length;a++){var s=i[a];o.push({p:a+1,aid:+(null!==(e=s.aid)&&void 0!==e?e:this.configStore.aid),cid:+s.cid,bvid:null!==(t=s.bvid)&&void 0!==t?t:this.configStore.bvid,seasonId:s.season_id,episodeId:s.episodeId||s.ep_id,hasPrev:(r=a,n=i.length,!(n<=1)&&r>=1&&r<n),hasNext:bn(a,i.length),from:s.from,title:s.title||s.part,duration:+s.duration,playWay:+(null==s?void 0:s.play_way),status:+(null==s?void 0:s.status),redirect_url:null==s?void 0:s.redirect_url,badgeInfo:null==s?void 0:s.badge_info,longTitle:null==s?void 0:s.long_title,playerEpTitle:null==s?void 0:s.playerEpTitle})}return o}return null},enumerable:!1,configurable:!0}),t.prototype.fetchStoryInfo=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t=this;return(0,n.Jh)(this,(function(r){switch(r.label){case 0:return e=(0,o.gx)((function(){return t.rootStore.isPrepared})),this.dp.isPrepared&&this.dp.isPrepared(),this.dp.isPrepared=function(){return e.cancel()},[4,e];case 1:return r.sent(),[2,this.httpStore.fetchVideoDetail(!0).then((function(e){var r=e.body,n=r.video,i=r.relate;n&&t.setState({title:n.title,stat:n.stat}),i&&t.setState({related:i})})).catch((function())}))},t.prototype.fetchViewInfo=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t=this;return(0,n.Jh)(this,(function(r){switch(r.label){case 0:return this.uiStore.kind!==f.HR.Pugv?[2]:(e=(0,o.gx)((function(){return t.rootStore.isPrepared})),this.dp.isViewPrepared&&this.dp.isViewPrepared(),this.dp.isViewPrepared=function(){return e.cancel()},[4,e]);case 1:return r.sent(),[2,this.httpStore.fetchViewInfo(!0).then((function(e){var r=e.body.payed;t.setState({payed:r})})).catch((function(e){if(!xe.Z.isCancel(e))return Promise.reject(e)}))]}}))}))},t.prototype.togglePoster=function(e){if(this.configStore.poster){var t=this.mediaStore.video.paused,r=this.nodes.videoPoster;e&&!this.mediaStore.autoplay?t&&this.httpStore.fetchViewInfo(!0).then((function(e){r.innerHTML='<img src="'.concat((0,At.Q)(e.body.pic,720),'" alt="poster">'),t&&(r.hidden=!1)})):r.hidden||(r.hidden=!0)1,cover:1,type:1,list:1,likeStatus:1,coinStatus:1,collectStatus:1,likeDisable:1,coinDisable:1,collectDisable:1,related:1,relatedAutoplay:1}),this.nodes.videoPoster&&(this.nodes.videoPoster.hidden=!0)},(0,n.gn)([o.Fl],t.prototype,"eplist",null),t}(d),wn=r(73787),An=r.n(wn);!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(Sn||(Sn={}));var Rn,Pn,Dn=function(){function e(){this.maximum=1e5,this.instances=new Map,this.records=new Set}return e.prototype.getLogger=function(t){var r="@@".concat(t),n=this.instances;if(n.has(r))return n.get(r);var i=this.records,o=new e;return o.moduleId=t,o.records=i,n.set(r,o),o},e.prototype.add=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=this.maximum,i=this.records,o=this.moduleId,a={level:e,messages:t,timestamp:Date.now(),moduleId:o};i.size>0&&i.size>n&&i.delete(i.keys().next().value),i.add(a)},e.prototype.getFilteredLog=function(e){var t,r,i,o,a;void 0===e&&(e={});var s=this.records,u=this.moduleId,c=null!==(a=e.level)&&void 0!==a?a:-1,l=e.limit||1/0,d=[],f=[];e.header&&(f.push("--------------- Header(S) ---------------"),f.push(e.header),f.push("--------------- Header(E) ---------------"),f.push(""));try{for(var p=(0,n.XA)(s.values()),h=p.next();!h.done;h=p.next()){var y=h.value;if(!e.filterModuleId||y.moduleId===u){if(d.length>=l)break;y.level>=c&&d.push(y)}}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}f.push("--------------- Content(S) ---------------");var m=function(e){var t=[];t.push("[".concat(An()(e.timestamp).format("YYYY-MM-DD hh:mm:ss"),"]")),t.push(Sn[e.level]),e.moduleId&&t.push("[".concat(e.moduleId,"]")),e.messages.forEach((function(e){return t.push(He(Rn||(Rn=(0,n.cy)(["",""],["",""])),e))})),f.push(t.join(" "))};try{for(var g=(0,n.XA)(d),v=g.next();!v.done;v=g.next()){m(v.value)}}catch(e){i={error:e}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}return f.push("--------------- Content(E) ---------------"),e.footer&&(f.push(""),f.push("--------------- Footer(S) ---------------"),f.push(e.footer),f.push("--------------- Footer(E) ---------------")),f.join("\n")},e.prototype.d=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.add.apply(ototyp];this.add.apply(this,(0,n.ev)({for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.add.apply(this,(0,n.ev)([Sn.WARNING],(0,n.CR)(e),!1))},e.prototype.e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.add.apply(this,(0,n.ev)([Sn.ERROR],(0,n.CR)(e),!1))},e.prototype.clear=function(){this.records&&this.records.clear()},e}();!function(e){e.OP="001111",e.EVENT="001114",e.QUALITY_MONITOR="002879"}(PnD"}return e.prototype.checkArgsValidity=function(e,t,r){if("string"!=typeof e)throw new TypeError('Tne "name" MUST be a string');if(null!=t&&"object"!=typeof t&&console.warn("[".concat(e,"]"),new TypeError('The "value" of '.concat(typeof t," type is deprecated. Use object instead"))),null!=r&&"object"!=typeof r)throw new TypeError('Tne "config" MUST be an object')},e.prototype.add=function(e,t,r){var n,i=function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},o="function"==typeof this.getRealtimeReportInfo&&this.getRealtimeReportInfo(),a=Object.assign({name:e,value:t,rawData:t,srcUrl:null,exParam:null,prepend:!1,sendBeacon:!1,timeStamp:Datea.value)||(a.value=((n={})[this.toBeDefined]=a.value,n)),i(a.value))try{a.value=JSON.stringify(a.value)}catch(e){console.warn(e)}a.immedia this.reportSenes.unshift(a):this.queues.push(a)},e.prototype.o=function(e,t,r){this.add(e,t,Object.assign({},r,{origin:0,kind:Pn.OP}))},
e.prototype.e=function(e,t,r){this.add(e,t,Object.assign({},r,{origin:0,kind:Pn.EVENT}))},e.prototype.clear=function(){this.queues.length=0},e}(),In=function(){function e(){}return e.add=function(t){"function"==typeof t&&(e.pendingList.push(t),e.onQueuePushed())},e.increaseSign=function(){e.running++},e.decreaseSign=function(){e.running--,e.onSignDecreased()},e.onQueuePushed=function(){e.consumePendingList()},e.onSignDecreased=function(){e.consumePendingList()},e.consumePendingList=function(){var t=e.maximum-e.running;if(t>0)for(var r=e.pendingList,n=Math.min(t,r.length),i=0;i<n;i++){var o=r.shift();o&&(oturn e.denction(){return e.decreaseSign()})),e.increaseSign())}},e.maximum=3,e.pendingList=[],e.running=0,e}(),Cn=function(){function e(){}return e.key=function(e,t){return t?"EID:".concat(t):e?"CID:".concat(e):"0"},e.has=function(t){var r=e.buf;if(r.has(t)){var n=r.get(t);remove(t),!1)}return!1},e.get=function(t){return e.has(t)?e.buf.get(t):null},e.set=function(t,r){var i=e.buf,o=e.quota;if(r.promise.then((function(e){r.json=e})).catch((function(r){e.remove(t)})),i.set(t,r),i.size>o.maximum)for(var a=i.size-o.maximum+o.discard,s=(0,n.ev)([],(0,n.CR)(i.keys()),!1),u=0;u<a;u++)e.remove(s[u])},e.remove=function(t){var r=e.buf;if(r.has(t)){var n=r.get(t);n.http&&n.http.dispose("Canceled by RemoveAction"),r.delete(t)}},e.clear=function(){e.buf.clear()},e.isExpired=function(t){var r=Date.now()-t.timeStamp;return isNaN(r)||r>e.expired},e.buf=new Map,e.quota={discard:4,maximum:32},e.expired=18e5,e}(),Nn=new(function(){function e(){this.log=new Dn,this.track=new On,this.mseSupported=(0,j.a)()}return e.prototype.getParams=function(e,t){var r={qn:0,fnver:0,fnval:ee.x.getFnVal({mseSupported:this.mseSupported,enableHEVC:t.enableHEVC,enableAV1:t.enableAV1}),fourk:1,voice_balance:1,gaia_source:"pre-load"};return Object.assign(r,e)},e.prototype.getConfig=function(e){var t={kind:f.HR.Ugc,mseSupported:this.mseSupported,retryCount:0,fromPrefetch:!0};switch(e.kind){case f.HR.Pgc:t.kind=f.HR.Pgc;break;case f.HR.Pugv:t.kind=f.HR.Pugv;break;case f.HR.Ugc:default:t.kind=f.HR.Ugc}return t},e.prototype.r=function(e,t){var r=new ee.x(this,{persistent:!0}),n=this.getParams(e,t),i=this.getConfig(t),o=r.r(e.raw&&!e.raw[ee.x.reqCacheKey]&&(e.raw[ee.x.reqCacheKey]=(0,Ze.Z)({},n)),e}));return{http:r,promise:o}},e}());function kn(e,t){var r=Cn.key(e.cid,e.ep_id);Cn.has(r)||In.add((function(){if(Cn.has(r))return Promise.reject(new Error("Cached"));var n=Nn.r(e,t);return Cn.set(r,{http:n.http,promise:n.promise,timeStamp:Date.now()}),n.promise}))}function Ln(e,t,r){var n=new XMLHttpRequest,i=new Promise((function(i,o){n.responseType="arraybuffer",n.onload=function(){return i(n.response)},n.onerror=o,n.onabort=o,n.open("GET",e,!0),n.setRequestHeader("Range","bytes=".concat(t,"-").concat(r-1)),n.send()}));return{xhr:n,promise:i}}var xn,Mn,Fn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="MpdAtom",t.endedTimer=null,t}return(0,n.ZT)(t,e),t.prototype.fixRenewal=function(){var e=this;queueMicrotask((function(){var t=e.rootStore,r=t.configStore,n=t.episodeStore;e.log.w("[Renewal]"),r.remove("cid"),n.reload(null,{isRenewal:!0},{origin:0})}))},t.prototype.getStreamKid=function(e){if(e){var t=e.mediaDataSource,r=null==t?void 0:t.url,n=null==r?void 0:r.video;if(Array.isArray(n)&&n.length){var i=n[0],o=null==i?void 0:i.bilidrm_uri;if("string"==typeof o)return o.split("//").pop()}}return null},t.prototype.getLastWatchS.episodeStore,n=t.configStore,i=t.mediaStore,o=r.isFirst;if(!n.fromDid&&e&&o){var a=i.video,s=n.cid,u=a.duration,c=a.currentTime,l=(e.lastPlayTime||0)/1e3;if(s&&s===e.lastPlayCid&&(c<3&&l>=5&&l<u-5)&&u>30)return l}return 0},t.prototype.getCachedRawMpd=function(){var e,t=this.rootStore,r=t.episodeStore,n=t.interactStore,i=t.configStore,o=r.isFirst,a=this.rootPlayer.cd.playUrl;if(a&&(this.rootPlayer.cd.playUrl=null,o))return a;var s=i.cid,u=function(e,t){return Cn.get(Cn.key(e,t))}(s,i.episodeId);return u&&u.json?u.json.raw:null===(e=n.preloadDataMap.get(s))||void 0===e?void 0:e.playurlData},t.prototype.getSuspectDuration=function(e){if(e&&e.timelength&&e.mediaDataSource.duration){var t=Math.max(0,(e.timelength-e.mediaDataSource.duration)/1e3);return t>5?t:0}return 0},t.prototype.errProxy=function(e){if(e){var t=this.rootStore,r=t.uiStore,n=t.errorStore,i=r.kind,o=e.message||"",a=e.playUrl||"",s=null,u=null;if(o&&/JSON/.test(o))s=i===f.HR.Pgc?2110:2103,u="status:".concat(o,",url:").concat(a);else switch(e.errType){case 1:s=i===f.HR.Pgc?2111:2104,u="status:".concat(o,",url:").concat(a);break;case 0:s=i===f.HR.Pgc?2108:2101,u="type:https,status:".concat(o,",url:").concat(a);break;default:return}n.err(2,s,u)}},t.prototype.triggerLoadedAction=function(e,t){var r,n=this,i=this.rootStore=i.configStore,c=i.interactStore,l=i.freeStore,d=i.kernelStore,f=a.isFirst,p=a.state.isSameEpisode,h=(f?(0,Le.Ac)():null)||(null===(r=c.preloadDataMap.get(u.cid))||void 0===r?void 0:r.videoData),y=!(!p||!h);s.resetCounter(),o.drmTechType?l.guardAtom.validPerm().then((function(){n.log.i("validPerm","done"),d.attachExternal({mediaDataSource:e.mediaDataSource,quality:e.quality},{initiator:t,preloadAVData:h,enableTransition:y})})).catch((function(e){l.guardAtom.handlePermDenied(e,t)})):d.attachExternal({mediaDataSource:e.mediaDataSource,quality:this.hackMpdData(e.quality)},{initiator:t,preloadAVData:h,enableTransition:y})},t.prototype.hackMpdData=function(e){var t=this.rootStore,r=t.qualityStore,n=t.userStore,i=t.uiStore;return r.state.isTrialQuality?r.state.reqQuality:i.kind!==f.HR.Ugc||n.isLogin?e:16},t.prototype.prefetchAVData=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t,r,i,o,a,s,u,c,l;return(0,n.Jh)(this,(function(d){return 5e5,2e4,t=this.rootStore.kernelStore.dashKernel,r=function(e,t,r,i){var o,a;if(void 0===i&&(i=7),Array.isArray(r))try{for(var s=(0,n.XA)(r),u=s.next();!u.done;u=s.next()){var c=u.value;if(c.id===e&&c.baseUrl&&(c.codecid===i&&"video"===t||"audio"===t))return c.baseUrl.replace("http://","https://")}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(o)throw o.error}}},"dash"===e.mediaDataSource.type&&t&&(l=t.getCurrentCodecID("video"),a=t.getQualityNumberFromQualityIndex(t.getQualityFortyFor("audio"),"audio"),s=r(a,"video",e.mediaDataSource.url.video,l),c=r(u,"audio",e.mediaDataSource.url.audio),s&&(i=Ln(s,0,5e5)),c&&(o=Ln(c,0,2e4))),[2,{vbHttp:i,abHttp:o,videoQn:a,videoUrl:s,audioQn:u,audioUrl:c}]}))}))},t.prototype.setEndedTimer=function(e){var t=this;0===e&&(this.delEndedTimer(),this.dp.tmpPrepared=(0,o.gx)((function(){return t.rootStore.isPrepared}),(function(){t.endedTimer=window.setTimeout((function(){return t.rootStore.mpdStore.setState({isMpdEnded:!0})}),0)})))},t.prototype.delEndedTimer=function(){this.endedTimer&&(clearTimeout(this.endedTimer),this.endedTimer=null),this.dp.tmpPrepared&&this.dp.tmpPrepared()},t.prototype.onDisp.delEndedTimer()},t}(l),Un=function(e){function t(t){var r=e.call(this,t)||this;retur Fn(t),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{isMpdEnded:!1,isMpdRequested:!1,isPreviewStream:null,suspectDuration:0,playUrlCode:null,mpdRetries:-1}},enumerable:!1,configurat:function(){return this.body&&this.body.dmOffset||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drmTechType",{get:fuenumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"streamKid",{get:function(){return this.mpdAtom.getStreamKid(this.body)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastWatchSecond",{get:function(){return this.mpdAtom.getLastWatchSecond(this.body)},enumerable:!1,configurable:!0}),
t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.dc.setPreviewStream=(0,o.U5)((function(){return{body:t.body,info:t.userStore.info}}),(function(e){switch(t.uiStore.state.kind){case f.HR.Pgc:case f.HR.Pugv:e.body&&t.setState({isPreviewStream:!!e.body.isPreview});break;case f.HR.Ugc:default:e.info&&t.setState({isPreviewStream:!!e.info.isUgcPayPreview})}})),this.dc.isPreviewStream=(0,o.U5)((function(){return t.state.isPreviewStream}),(function(e){return t.setState({suspectDuration:e?t.mpdAtom.getSuspectDuration(t.body):0})})),this.dc.suspectDuration=(0,o.U5)((function(){return t.state.suspectDuration}),(function(){return t.rootPlayer.emit(a.t.Player_DurationChange,new CustomEvent(a.t.Player_DurationChange))}))},t.prototype.onCommitted=function(){e.prototype.onCommitted.call(this);var t=this.httpStore.getViewKind();t.isFatalError||t.isMissing||(this.log.i("[PlayUrl]",'Starting on "Committed" hook'),this.startPlayUrlProxy(),this.setState({isMpdRequested:!0}))},t.prototype.onPrepared=function(){e.prototype.onPrepared.call(this),this.state.isMpdRequested||(this.log.i("[PlayUrl]",'Starting on "Prepared" hook'),this.startPlayUrlProxy())},t.prototype.startPlayUrlProxy=function(){this.fetchPlayUrl(null,{initiator:0,preloadPlayUrl:this.mpdAtom.getCachedRawMpd()})},t.prototype.fetchPlayUrl=function(e,t){var r=this;this.rootStore.stageAtom.set(3);var n=t&&t.initiator;if(this.configStore.localUrl)return this.rootStore.stageAtom.set(5),void this.kernelStore.attachExternal({quality:0,mediaDataSource:{type:"mp4",url:this.configStore.localUrl}},{initiator:n});this.httpStore.fetchPlayUrl(!1,e,t).then((function(e){return function(e){r.rootStore.stageAtom.set(4),r.configStore.embeddedEnv&&e.body.quality>r.qualityStore.maxEmbeddedQn&&r.qualityStore.maxEmbeddedQn&&(e.body.quality=r.qualityStore.maxEmbeddedQn),r.setMpdBody(e.body,n),r.setState({mpdRetries:e.retries}),r.mpdAtom.setEndedTimer(n)}(e)})).catch((function(e){if(!xe.Z.isCancel(e)){if(r.rootStore.stageAtom.set(5),e){if("TypeError"===e.name)return console.error(e),r.log.e("[Fatal]",e.message,e.stack);null!==e.code&&r.setState({playUrlCode:e.code}),null!=e.retries&&r.setState({mpdRetries:e.retries})}if(0===n&&e&&2===e.errType)etMpdBody=function(e,t){e&&e.session&&(this.configStore.session=e.session),this.body=e,this.mpdAtom.triggerLoadedAction(e,t)},t.prototype.prefetchPlayUrl=function(e,t){var r=new ee.x(this.rootPlayer,{persistent:!0}),n=r.r(this.httpStore.getPlayUrlParams(e),this.httpStore.getPlayUrlConfig(t));return{http:r,promise:n}},t.prototype.prefetchAVData=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.mpdAtom.prefetchAVData(e)]}))}))},t.prototype.fallback=function(e,t,r){var n=this.metricStore.quitInfo;this.log.w("[DRM:fallback]",t,r),null==n.drmErr&&(n.drmErr=e),this.fetchPlayUrl(null,{initiator:3,drmFallback:!0})},(0,n.gn)([o.LO.shallow],t.prototype,"body",void 0),(0,n.gn)([o.aD],t.prototype,"setMpdBody",null),t}(d),Bn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultState",{get:function(){return{seekDetail:{start:null,total:0},enterDetail:{start:0,total:0,locked:!1}}},enumerable:!1,configurable:!0}),t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.rootPlayer.on(a.t.Player_Initialized,(function(){t.state.enterDetail.locked&&t.changeState(t.state.enterDetail,{start:t.portStore.getCurrentTime()})})),this.rootPlayer.on(a.t.Player_Seeking,(function(){t.seekingDetailHandler(),null===t.state.seekDetail.start&&t.changeState(t.state.seekDetail,{start:t.portStore.getCurrentTime()})})),this.rootPlayer.on(a.t.Player_Seeked,(function(){var e;t.seekedDetailHandler();var r=(e=t.state.seekDetail).start,n=e.total;if(null!==r){var i=n+t.portStore.getCurrentTime()-r;t.changeState(t.state.seekDetail,{total:i,start:null})}})),this.rootPlayer.on(a.t.Player_Statue_Changed,(function(){t.uiStore.screenKind===f.dY.Pip?t.pipEnterDetailHandler():t.pipLeaveDetailHandler()})),this.rootPlayer.window.addEventListener("beforeunload",this.onBeforeUnloadHandler)},t.prototype.seekingDetailHandler=function(){this.state.enterDetail.locked&&null===this.state.seekDetail.start&&this.changeState(this.state.seekDetail,{start:this.portStore.getCurrentTime()})},t.prototype.seekedDetailHandler=function(){var e,t=(e=this.state.seekDetail).start,r=e.total;this.state.enterDetail.locked&&null!==t&&this.changeState(this.state.seekDetail,{start:null,total:r+this.portStore.getCurrentTime()-t})},t.prototype.resetSeekDetail=function(){this.state.enterDetail.locked||this.changeState(this.state.seekDetail,{start:null,total:0})},t.prototype.pipEnterDetailHandler=function(){this.resetSeekDetail(),thistart:this.portStore.getCurrentTimler=function(e){var t;void 0===e&&(e=!1);var r=(t=this.state.enterDetail).locked,n=t.start,i=t.total;if(r){var o=this.portStore.getCurrentTime(),a=i+o-n-this.state.seekDetail.total;this.changeState(this.state.enterDetail,{total:a,start:o,locked:e}),this.changeState(this.state.seekDetail,{total:0})}},t.prototype.getPipPlayingDuration=function(){return this.pipLeaveDetailHandler(!0),this.state.enterDetail.total},t.prototype.onBeforeUnloadHandler=function(){this.reportPipDuration()},t.prototype.reportPipDuration=function(e){void 0===e&&(e=!0);var t=Math.round(this.getPipPlayingDuration());t&&this.track.e("pip_playing_duration",t,{sendBeacon:e})},t.prototype.onDispose=function(){e.prototype.onDispose.call(this,{enterDetail:1,seekDetail:1}),this,null),t}(d),jn=r(33108);!function(e){e[e.RECOMMEND=0]="RECOMMEND",e[e.HEVC=1]="HEVC",e[e.DISABLE=2]="DISABLE",e[e.AV1=3]="AV1"}(xn||(xn={})),function(e){e[e.QN_8K=127]="QN_8K",e[e.QN_DOLBY_VISION=126]="QN_DOLBY_VISION",e[e.QN_HDR10=125]="QN_HDR10",e[e.QN_4K=120]="QN_4K",e[e.QN_1080P_60=116]="QN_1080P_60",e[e.QN_1080P_PLUS=112]="QN_1080P_PLUS",e[e.QN_1080P=80]="QN_1080P",e[e.QN_720P_60=74]="QN_720P_60",e[e.QN_720P=64]="QN_720P",e[e.QN_480P=32]="QN_480P",e[e.QN_360P=16]="QN_360P"}(Mn||(Mn={}));var Vn,Hn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="WmpStore",t.WASM_PLAYER_MAX_QUALITY=116,t.WASM_PLAYER_DISABLE="bwphevc_disable",t.QUALITY_CPU_MAP={16:4,32:4,64:4,80:4,0:4,112:8,116:16},t.BLACK_LIST={1:!0,2:!0,9:!0,18:!0,208259:!0,1684013:!0,3479095:!0,9099524:!0,12754559:!0,21673742:!0,35361273:!0,40016273:!0,345039937:!0,386593697:!0,9285500:!0},t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"isDisabledWasmPlayer",{get:function(){try{var e=$e().getFawkesConfigValue("dash_config","wasm_off_list");if(e)if(JSON.parse(e).includes(+M.get("DedeUserID")))return!0}catch(e){}return"1"===(0,F.Gg)(this.WASM_PLAYER_DISABLE)},enumerable:!1,configurable:!0}),Object.definePrreturn!this.mpdStore.drmTechType&&this.configStore.enableWMP&&$e().isBwpHEVCPrefSupported()},enumerable:!1,configurable:!0}),t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.rootPlayer.on(s.p.WASM_PLAYER_FALLBACK,(function(){t.track.o("wasm_player",{code:7011}),t.log.i("WasmPlayer onperformance fallback to H.264"),t.disableWasmPlayer(),t.qualityStore.switchProxy()}))},t.prototype.isBwpElement=function(e){return"BWP-VIDEO"===(null==e?void 0:e.tagName)},t.prototype.isUseWasmPlayer=function(e){return!(!window.__ENABLE_WASM_PLAYER__||!this.isBwpElement(e))},t.prototype.isNeedSwitchBwpVideoTag=function(e,t,r){var n=this.isUseWasmPlayer(e),i=this.isCanUseWasmPlayer(t,r);if(n){if(!i)return!0}else if(i)return!0;return!1},
t.prototype.checkWasmPlayerSupported=function(e,t){var r=this.mediaStore.video,n=this.createVideoElement(r,e,t);n&&r.parentElement&&(r.parentElement.insertBefore(n,r),this.mediaStore.replaceElement(n),this.rootPlayer.emit(s.p.PLAYER_MEDIA_CHANGED))},t.prototype.createNewVideoElement=function(e,t){var r=this.isUseWasmPlayer(this.n=this.createVideoElement(null,e,t);return!r||this.isUseWasmPlayer(n)||this.isDisabledWasmPlayer||this.track.o("wasm_player",{code:7012}),n},t.prototype.fallbackWasmPlayer=function(e){var t=this;return new Promise((function(r,n){t.isUseWasmPlayer(t.mediaStore.video)?(t.track.o("wasm_player",{code:e}),t.log.i("[fallbackWasmPlayer] fallback WasmPlayer, code: ".concat(e)),t.disableWasmPlayer(),t.qualityStore.switchProxy(),t.rootPlayer.once(s.p.PLAYER_MEDIA_CHANGED,(function(){r({})}))):r({})}))},t.prototype.onWasmPlayerError=function(e,t,r){void 0===r&&(r=!1),this.isUseWll==t?void 0:t.code)||7e3}),this.log.w("[onWasmPlayerError] WasmPlayer is enable, disable it, code: ".concat(null==t?void 0:t.code,", message: ").concat(null==t?void 0:t.message)),this.disableWasmPlayer(),r&&this.destroyWasmPlayer(e))},t.prototype.destroyWasmPlayer=function(e){e instanceof HTMLVideoElement||this.isBwpElement(e)&&(this.log.i("[destroyWasmPlayer] call WasmPlayer destroy"),e.destroy())},t.prototype.disableWasmPlayer=function(){(0,F.KY)(this.WASM_PLAYER_DISABLE,"1")},t.prototype.createVideoElement=function(e,t,r){var n=this,i=function(){return n.log.i("[createVideoElement] create native HTMLVideoElement"),window.__ENABLE_WASM_PLAYER__=!1,E()};if(this.isCanUseWasmPlayer(t,r)){if(!this.isBwpElement(e))return document.querySelectorAll("bwp-video").length>1?i():(this.log.i("[createVideoElement] create BwpElement"),window.__ENABLE_WASM_PLAYER__=!0,document.createElement("bwp-video"))}else if(!(e&&e instanceof HTMLVideoElement))return i();return null},t.prototype.isWasmPlayerSupported=function(e,t){var r,n;if(!window.AudioWorklet||!window.AudioWorkletNode||!window.SharedArrayBuffer)return!1;if(this.qualityStore.state.isTrialSwitch)return!1;if(!this.isPrefEnableWasmPlayer)return!1;if(null===(r=null==t?void 0:t.flac)||void 0===r?void 0:r.audio)return!1;if(this.BLACK_LIST[M.get("DedeUserID")]||window.frameElement||!(0,jn.isBwpSupported)()||this.isDisabledWasmPlayer)return!1;var i=(null===(n=null===0:window.navigator)||void 0===n?void 0:n.hardwareConcurrency)||0,o=this.QUALITY_CPU_MAP[e]||0;if(!o||i<o)return!1;if(0===e&&this.WASM_PLAYER_MAX_QUALITY<80||e>this.WASM_PLAYER_MAX_QUALITY)return!1;return!!function(t,r){if(!(null==t?void 0:t.length)||!(null==r?void 0:r.length((function(e){return 12===e.codecid}));if(o.length<=0)return!1;var a=t.filter((function(e){return 7===e.codecid})),s=function(e){return e.filter((function(e){return e.id<=80})).length};return s(o)>=s(a)&&(i=!0),(o.find((function(t){return t.id===e}))||0===e)&&(n=!0),i&&n}(null==t?void 0:t.video,null==t?void 0:t.audio)},t.prototype.isAV1Supported=function(e,t){if(!$e().isAV1TypeSupported()||!(null==t?void 0:t.video))return!1;var r=t.video.filter((function(e){return 13===e.codecid}));if(!rF.tv)(LN_8K)return!1}else if(n!==xn.AV1)return!1;return!!!+(0,F.Gg)("enableAV1Error")},t.prototype.isCanUseWasmPlayer=function(e,t){var r=this.isAV1Supported(e,t),n=this.isWasmPlayerSupported(e,t),i=$e().shouldUseNativeHEVCDecode();return!r&&!i&&n},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),this.destroyWasmPlayer(this.mediaStore.video)},t}(d);!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.PANORAMIC=1]="PANORAMIC",e[e.INTERACTIVE=2]="INTERACTIVE",e[e.DRM=3]="DRM"}(Vn||(Vn={}));var Gn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rtsMap=new Map,t.pcr={pageUnload:!1,earlyEOFSymll,t.maxTimeRecord=0,t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"pageUnload",{get:function(:!1,configurable:!0}),Objec:function(){return this.pcr.earlyEOFSymbol},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"quitInfo",{get:function(){return this.pcr.quitInfo},enumerable:!1,configurable:!0}),t.prototype.setEarlyEOFSymbol=function(e){this.pcr.earlyEOFSymbol=e},t.prototype(!1)},t.prototype.getRelativePlayTime=function(){return this.getPlayTime(!0)},t.prototype.getMaxPlayTime=function(){return Math.floor(this.maxTimeRecord)},t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.rootPlayer.window.addEventListener("(){return t.cleanAfterDispose()}),1),this.rootPlayer.on(s.p.MEDIA_TIMEUPDATE,(function(){t.startRecorder(),t.maxTimeRecordHandler()})).on(s.p.MEDIA_WAITING,(function(){return t.pauseRecorder()})).on(s.p.MEDIA_SEEKING,(function(){return t.pauseRecorder()})).on(s.p.MEDIA_SEEKED,(function(){return t.maxTimeRecordHandler()})).on(s.p.MEDIA_PAUSE,(function(){return t.pauseRecorder()})).on(s.p.MEDIA_ENDED,(function(){t.pauseRecorder(),t.maxTimeRecordHandler(t.mediaStore.state.duration)}))},t.prototype.startRecorder=function(){var e=Date.now(),t=this.mediaStore.state.currentTime;if(!this.mediaStore.video.paused){if(null!=this.rts){var r=e-this.rts,n=1e3*(t-this.mct),i=this.mediaStore.video.playbackRate;if(r>0&&i>0){var o=r<500?r:Math.min(r,n);if(o>0&&o<500){var a=(this.rtsMap.get(i)||0)+o;this.rtsMap.set(i,a)}}}this.rts=e,this.mct=t}},t.prototype.pauseRecorder=function(){this.rts=null,this.mct=null},t.prototype.maxTimeRecordHandler=function(e){this.maxTimeRecord=Math.max(this.maxTimeRecord,e||this.mediaStore.state.currentTime)},t.prototype.getPlayTime=function(e){var t=(0,n.ev)([],(0,n.CR)(this.rtsMap.entrieforeUnload=function(){this.pcr.pageUnload=!0,this.rootStore.isDisposing||(this.rootPlayer.emit(s.p.PLAYER_UNLOAD),this.rootPlayer.emit(s.p.PLAYER_UNLOADED))},t.prototype.cleanAfterDispose=function(){this.pcr.pageUnload=!1,this.pcr.earlyEOFSymbol=!1,this.pcr.quitInfo={},this.maxTimeRecord=0,this.pauseRecorder(),this.rtsMap.clear()},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),this.rootPlayer.window.removeEventListener("beforeunload",this.onBeforeUnload)},(0,n.gn)([i.ZP],t.prototype,"onBeforeUnload",null),t}(d),qn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpHeartbeat",t.url="//api.bilibili.com/x/click-interface/web/heartbeat",t}return(0,n.ZT)(t,e),t.prototype.r=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,method:"POST",params:t,data:e,withCredentials:!0},{wbi:!0})]}))}))},t}(le.eV),Wn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hb={timer:null,startTime:null,disabled:!1,nextRestart:!1,prevPlayType:null},t.realPlayedTime=0,t}return(0,n.ZT)(t,e),t.prototype.onMount=function(){e.prototype.onMount.call(this),this.addEvents()},t.prototype.onPrepared=function(){var t=this;e.prototype.onPrepared.call(this),this.dp.vxStart=(0,o.gx)((function(){return t.trackStore.state.vxStart}),(function(){return t.startReport()}))},t.prs;this.rootPlayer.on(s.p.MEDIA_PLAYING,(function(){e.mediaStore.state.firstPlay&&(e.h(function(){e.mediaStore.state.firstPlay&&(e.isPlaybackCompleted()||e.heartbeat(2),e.hb.disabled=!0)})).on(s.p.MEDIA_SEEKED,(function(){e.hb.nextRestart&&(e.heartbeat(1),e.hb.nextRestart=!1)})).on(s.p.MEDIA_ENDED,(function(){e.heartbefunction(){
e.heartbeatQuitHandle.portStore.getRemoteNow().then((function(t){e.rootPlayer.hasFeature("noVTReport")||e.sendRealtime(t)}))},t.prototype.sendRealtime=function(e){var t=this;this.hb.startTime=e,this.heartbeat(1),this.hb.timer=window.setInterval((function(){t.hb.disabled||t.mediaStore.video.paused||t.heartbeat(0)}),15e3)},t.prototype.heartbeatEndedHandler=function(){this.isPlaybackCompleted()&&this.heartbeat(4)},t.prototype.heartbeatQuitHandler=function(){this.isPlaybackCompleted()||this.heartbeat(4)},t.prototype.shouldDisableHeartbeat=function(e){return 3===e?2!==this.hb.prevPlayType:(1===this.hb.prevPlayType||3===this.hb.prevPlayType)&&1===e},t.prototype.getPlayedTime=function(){return this.isPlaybackCompleted()?-1:Math.floor(this.portStore.getCurrentTime())},t.prototype.isPlaybackCompleted=function(){return!this.mpdStore.state.suspectDuration&&(!!this.mediaStore.video.ended||!!this.mediaStore.video.duration&&this.portStore.getCurrentTime().toFixed(1)===this.portStore.getDuration().toFixed(1))},t.prototype.heartbeat=function(e){if(this.hb.startTime&&!this.shouldDisableHeartbeat(e)){var t=this.getPlayedTime(),r=this.metricStore.getRelativePlayTime();switch(e){case 0:this.realPlayedTime+=15,this.timestamp=performance.now();break;case 1:case 2:case 3:this.timestamp=performance.now();break;case 4:this.realPlayedTime+=Math.floor((performance.now()-this.timestamp)/1e3)}if(0!==r||0!==t||4!==e){var n=this.configStore,i=this.userStore.info,o={player_version:ze.version},a={start_ts:this.hb.startTime,mid:i.mid,aid:n.aid,cid:n.cid,type:this.trackStore.getReportType(),sub_type:n.seasonType,dt:2,play_type:e,realtime:r,played_time:t,real_played_time:this.realPlayedTime,refer_url:n.referrer,bsource:n.bSource,quality:this.qualityStore.quality,video_duration:Math.floor(this.mediaStore.state.duration),last_play_progress_time:Math.floor(this.mediaStore.state.currentTime),max_play_progress_time:this.metricStore.getMaxPlayTime(),outer:this.configStore.channelKind===f.u5.Embedded_Other?1:0};a.mid||delete a.mid,a.aid||delete a.aid,n.seasonId&&(a.sid=n.seasonId),n.episodeId&&(a.epid=n.episodeId),null!=n.spmId&&(a.spmid=n.spmId),null!=n.spmIdFrom&&(a.from_spmid=n.spmIdFrom),null!=n.spmIdFromOuter&&(o.from_outer_spmid=n.spmIdFromOuter),n.session&&(a.session=n.session),this.rootPlayer.hasFeature("noVTHistory")&&(a.no_history=1),a.extra=JSON.stringify(o),4===e&&(this.hb.nextRestart=!0),this.rootPlayer.emit(s.p.PLAYER_HEARTBEAT),new qn(this.rootPlayer,{persistent:!0,noStore:!0}).r(a,{w_strealtime:a.realtime,w_ideo_duration:a.video_duration,w_last_play_progress_time:a.last_play_progress_time}).catch(Me.Z),this.hb.prevPlayType=e}}},t.prototype.resetHeartbeat=function(){this.hb.timer&&(clearInterval(this.hb.timer),this.hb.timer=null),this.hb.startTime=null,this.hb.prevPlayType=null,this.hb.disabled=!1,this.hb.nextRestart=!1},t.prototype.onNavigate=function(){this.realPlayedTime=0,this.timestamp=null},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.resetHeartbeat()},t}(d),Kn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpStatsClick",t.url="//api.bilibili.com/x/click-interface/click/web/h5",t}return(0,n.ZT)(t,e),t.prototype.r=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(r){return[2,this.request({url:this.url,method:"POST",params:t,data:e,withCredentials:!0},{wbi:!0})]}))}))},t}(le.eV),Yn=r(33044),Qn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),t.prototype.onPrepared=function(){var t=this;e.prototype.onPrepared.call(this),this.dp.vxStart=(0,o.gx)((function(){return t.trackStore.state.vxStart}),(function(){return t.startReport()}))},t.prototype.startReport=function(){var e=this;this.portStore.getRemoteNow().then((function(t){e.configStore.isChannel(f.u5.Manager)||e.rootPlayer.hasFeature("noVVReport")||e.sendPoint(t)}))},t.prototype.sendPoint=function(e){var t;(t=new Kn(this.rootPlayer,{persistent:!0,noStore:!0})).r.apply(t,(0,n.ev)([],(0,n.CR)(this.getClickParams(e)),!1)).catch(Me.Z),new Yn.h(this.rootPlayer,{persistent:!0,noStore:!0}).r(this.getLogParams(e)).catch(Me.Z)},t.prototype.getClickParams=function(e){var t,r=this.configStore,n=this.userStore.info,i=null!==(t=n.level)&&void 0!==t?t:0,o=Math.floor(this.mediaStore.state.firstPlay/1e3),a={mid:n.mid,aid:r.aid,cid:r.cid,part:r.p,lv:i,ftime:o,stime:e,type:this.trackStore.getReportType(),sub_type:this.configStore.seasonType,refer_url:r.referrer,bsource:r.bSource,outer:this.configStore.channelKind===f.u5.Embedded_Other?1:0};return a.mid||delete a.mid,a.aid||delete a.aid,r.seasonId&&(a.sid=r.seasonId),r.episodeId&&(a.epid=r.episodeId),null!=r.spmId&&(a.spmid=r.spmId),null!=r.spmIdFrom&&(a.from_spmid=r.spmIdFrom),null!=r.spmIdFromOuter&&(a.extra=J&&(a.session=r.session),[a,{w_aid:a.aid,w_part:a.part,w_ftime:a.ftime,w_s=function(e){var t=1e3*e,r=encodeURIComponent(this.rootPlayer.parent.location.href),n=this.configStore,i=this.settingStore.state.loop?1:0,o=this.qualityStore.quality,a=[];return a.push("000024"+t+r,this.trackStore.getFid(),this.portStore.rid,n.aid,n.cid,n.p,o,i),a.join("|")},t}(d),zn=function(e){functionltState",{get:function(){return{status:null,stime:null,ctime:null}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEnd",{get:function(){return 3===this.state.status||!(2!==this.state.status||!this.mediaStore.state.ended)},enumerable:!1,!0}),t.prototype.onMount=function(){var t=this;e.prototype.onMount.call(this),this.dc.state=(0,o.U5)((function(){return{isLoaded:t.rootStore.isLoaded,ctime:t.state.ctime,stime:t.state.stime,status:t.state.status}}),(function(e){var r=e.isLoaded,n=e.ctime,i=e.stime,o=e.status;r&&(2===o?n-i&&t.portStore.seekAutoplay(n-i):3===o&&(!t.mediaStore.state.ended&&t.portStore.seek(t.mediaS}),{fireImmediately:!0})},t.prototype.onDispose=function(){},t}(d),Zn=function(e){function t(t){var r=e.call(this,t)||this;return r.delay=2e3,r.delayTimer=null,(0,o.rC)(r),r.init(),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"isLoadingStart",{get:function(){return!this.rootStore.episodeStore.state.isSameEpisode&&this.rootStore.isCommitted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoadingEnded",{get:function(){return this.rootStore.isLoaded},enumerable:!1,configurable:!0}),t.prototype.init=function(){var e=this,t="".concat(v.a_,"-loading"),r=this.nodes.container;this.loadNode=r.querySelector(".".concat(v.m,"-loading-panel")),this.textNode=r.querySelector(".".concat(v.m,"-loading-panel-text")),this.blurNode=r.querySelector(".".concat(v.t&&(e.createDelayTimer(),e.loadNode.classList.add(t))})),this.dc.isLoaded=(0,o.EH)((function(){e.isLoadingEnded&&(e.clearDelayTimer(),e.loadNode.classList.remove(t))}))},t.prototype.createDelayTimer=function(){var e=this;this.clearDelayTimer(),this.delayTimer=window.setTimeout((function(){e.textNode&&(e.textNode.hidden=!1),e.blurNode&&(e.blurNode.hidden=!1)}),this.delay)},t.prototype.clearDelayTimer=function(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null)},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.clearDelayTimer(),this.textNode&&(this.textNode.hidden=!0),this.blurNode&&(this.blurNode.hidden=!0)},(0,n.gn)([o.Fl],t.prototype,"isLoadingStart",null),(0,n.gn)([o.Fl],t.prototype,"isLoadingEnded",null),t}(l),Jn=function(e){this.rootStore=e;var t=e.rootPlayer,r=t.log.getLogger("EpochAtom");t.on(a.t.Player_Committed,(func1).on(a.t.Player_Prepared,(function(){return r.i("onPrepared",JSON.stringify(e.portStore.getManifest()))
}),-1).o.on(s.p.PLAYER_LOADED,(function(e){return r.i("onLoaded","err:".concat(!!e.err,",mid:").concat(e.mid||null))}),-1).on(s.p.PLAYER_UNLOAD,(function(){return r.i("onUnload")}),-1).on(s.p.PLAYER_UNLOADED,(function(){return r.i("onUnloaded")}),-1).on(a.t.Player_Dispose,(function(){return r.i("onDispose")}),-1)},Xn=r(52135),$n=r.n(Xn);function ei(e){var t=Object.assign({width:null,height:null,aspectRatio:"16:9"},e),r=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};if(!r(t.width)&&!r(t.height))throw new TypeError('One of "width" and "height" MUST be an integer');var n=t.aspectRatio.split(":"),i=+n[0],o=+n[1];if(!(i>0&&o>0))throw new Error('Invalid "aspectRatio" format');var a=i/o,s=!!t.width;t.width?t.height=Math.round(t.width/a):t.width=Math.round(t.height/(1/a));var u=t.width,c=t.height,l=t.width/t.height;return l>a&&(s?c+=1:u-=1),l<a&&(s?c-=1:u+=1),Math.abs(l-a)>Math.abs(u/c-a)&&(t.width=u,t.height=c),t}var ti=r(72778);var ri=r(92767),ni=r(77208),ii='Interrupted by "Player_Dispose" event',oi='Interrupted by "Player_Disconnect" event',ai=r(70035),si=r(39178),ui=r(69668),ci=r(73245),li=r(97381);function di(){var e=T.X.msie.alike?"".concat(v._j,"-msie"):T.X.edge.alike?"".concat(v._j,"-edge"):T.X.safari.alike?"".concat(v._j,"-safari"):T.X.firefox.alike?"".concat(v._j,"-firefox"):null,t=function(t){var r=document.createElement("div");return r.setAttribute("data-injector","nano"),t.forEach((function(e){return r.classList.add(e)})),e&&r.classList.add(e),r};return{majorNode:t([v.eG,"".concat(v.eG,"-major")]),minorNode:t([v.eG,"".concat(v.eG,"-minor")])}}var fi=function(){function e(e,t){this.isEmbed=!1,this.isEmbedSOP=!1,this.isInitialized=!1,this.cd={__placeholder__:!0},this.primary={},this.input={},this.theme={},this.disabled={},this.httpRequests=new Set,this.httpCaches=new Map,this.connectDetails={starting:!1,finished:!1},this.connectDeferred=null,this.disposeDeferredSet=new Set,this.disconnectDeferredSet=new Set,(0,o.rC)(this),Object.assign(this.input,e),Object.assign(this.theme,t),this.isInitialized=!1,this.beforeEmitter=new ni.EventEmitter,this.emitter=new ni.EventEmitter,this.afterEmitter=new ni.EventEmitter,this.beforeEmitter.setMaxListeners(0),this.emitter.setMaxListeners(0),this.afterEmitter.setMaxListeners(0),this.log=new Dn,this.track=new On,this.track.getRealtimeReportInfo=this.makeRealtimeReportMethod(),this.window=window,this.isEmbed=window!==window.parent,this.cd=this.createPrefetchProxy(),this.primary=ue(this.input),this.searchParam=function(e){var t=Object.create(null);if("string"!=typeof e)return t;var r="debug",n=$n().parse(e,{ignoreQueryPrefix:!0,plainObjects:!0});return"1"!==n[r]||(Object.keys(n).forEach((function(e){var i=n[e];if(e!==r&&null!=i)switch(e){case"ctrl":case"fnval":case"autoplay":case"no_gpu":case"no_cache":t[e]=+i;break;case"t":case"ns":t[e]=i}})),console.log("[DEBUG] Parsed QueryString:",t)),t}(this.window.location.search),this.checkFrameStatus(),this.preBuildNodes(),this.log.i("[EntryTiming]",JSON.stringify(ri._g.entryLoadTime)),ai.I.markOnce("M03"),ai.I.measureOnce("P02:IH2I","M01","M03"),this.instantiate=performance.now()}return e.prototype.emit=function(e){for(var t,r,i,o,a,s,u=[],c=1;c<arguments.length;c++)u[c-1]=arguments[c];try{(t=this.beforeEmitter).emit.apply(t,(0,n.ev)(["**"],(0,n.CR)(u),!1)),(r=this.emitter).emit.apply(r,(0,n.ev)(["**"],(0,n.CR)(u),!1)),(i=this.afterEmitter).emit.apply(i,(0,n.ev)(["**"],(0,n.CR)(u),!1));var l=(o=this.beforeEmitter).emit.apply(o,(0,n.ev)([e],(0,n.CR)(u),!1)),d=(a=this.emitter).emit.apply(a,(0,n.ev)([e],(0,n.CR)(u),!1)),f=(s=this.afterEmitter).emit.apply(s,(0,n.ev)([e],(0,n.CR)(u),!1));return l||d||f}catch(e){throw this.log.e("[EventEmitter]",e&&e.message,e&&e.stack),e}},e.prototype.on=function(e,t,r){switch(!0){case r<0:this.bef,r){switch(!0){case r<0:this.beforeEmitter.once(e,t);break;case r>0:this.afterEmitter.once(e,t);break;default:this.emitter.once(e,t)}return this},e.prototype.off=function(e,t,r){switch(!0){case r<0:this.beforeEmitter.off(e,t);break;case r>0:this.afterEmitter.off(e,t);break;default:this.emitter.off(e,t)}return this},e.prototype.removeAllListeners=function(){return this.beforeEmitter.removeAllListeners(),this.emitter.removeAllListeners(),this.afterEmitter.removeAllListeners(),this},e.prototype.getDimension=function(){var e={width:0,height:0};if(this.rootStore)return e.width=this.uiStore.state.containerWidth,e.height=this.uiStore.state.containerHeight,e;if(this.nodes&&this.nodes.container){var t=this.nodes.container;return e.width=t.offsetWidth,e.height=t.offsetHeight,e}return e},e.prototype.preBuildNodes=function(){var e=this.iid=Z().toString(),t=di(),r=t.majorNode,n=t.minorNode;r.setAttribute("data-iid",e),n.setAttribute("data-iid",e),this.majorNode=r,this.minorNode=n},e.prototype.attachTemplate=function(){var e,t=this.nodes,r=this.majorNode,n=t.container,i=null!==(e=this.primary.channelKind)&&void 0!==e?e:f.u5.Default,o=new Map;o.set(null,{topWrap:this.hasFeature("noControlLayer"),controlWrap:this.hasFeature("noControlLayer"),sendingArea:this.hasFeature("noSendingBar")}).set(f.u5.Homepage,{sendingArea:!,{sendingArea:!0}).set(f.u5.Manager,{sendingArea:!0}),o.forEach((function(e,r){return function(e,r){e!==i&&null!=e||r&&Object.keys(r).forEach((function(e){var n=t[e],i=r[e];n&&null!=i&&(n.hidden=!!i)}))}(r,e)})),(this.hasFeature("noLayerShadow")||this.primary.hideBoxShadow)&&n.classList.add("".concat(v.a_,"-disable-box-shadow")),r&&!n.parentElement&&r.appendChild(n)},e.prototype.detachTemplate=function(){var e=this.nodes.container;if(e){var t=e.parentElement;t&&t.removeChild(e)}},e.prototype.attachBaseNode=function(){var e=this.primary.element,t=this.primary.auxiliary,r=this.majorNode,n=this.minorNode;e&&!r.parentElement&&(0,si.h)(e,r),t&&!n.parentElement&&(0,si.h)(t,n)},e.prototype.detachBaseNode=function(){var e=this.majorNode,t=this.minorNode;e&&e.parentElement&&e.parentElement.removeChild(e),t&&t.parentElement&&t.parentElement.removeChild(t)},e.prototype.checkFrameStatus=function(){try{this.parent=window.parent&&window.parent.document?window.parent:window}catch(e){this.parent=window}this.isEmbed&&(this.isEmbedSOP=this.window!==this.parent),this.log.i("[FrameStatus]","isEmbed:".concat(this.isEmbed,",isEmbedSOP:").concat(this.isEmbedSOP))},e.prototype.createPrefetchProxy=function(){var e=this.input.prefetch;return this.input.prefetch=null,e&&"object"==typeof e?e:(this.log.w("[PrefetchProxy]","Invalid"),{__placeholder__:!0})},r e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,(0,n.ev)(["[EventError]:","whoops! there was an error"],(0,n.CR)(e),!1))},e.prototype.onDispose=function(){var e=this;this.disposeDeferredSet.size&&(this.disposeDeferredSet.forEach((function(e){e&&"function"==typeof e.reject&&e.reject(new Error(ii))})),this.disposeDeferredSet.clear()),this.httpCaches.size&&this.httpCaches.clear();var t=[];this.httpRequests.forEach((function(e){e.persistent||t.push(e)})),t.forEat.dispose(le.eV.LIFECYCLE_TOKEN),e.httpRequests.delete(t)}))},e.prototype.onDisconnect=func&&(this.disconnectDeferredSet.forEach((function(e){e&&"function"==typeof e.reject&&e.reject(new Error(oi))})),this.disconnectDeferredSet.clear()),this.httpRequests.forEach((function(e){e&&"function"==typeof e.dispose&&e.dispose(le.eV.LIFECYCLE_TOKEN)})),this.httpRequests.clear()},e.prototype.snapshotError=function(e){e&&e.message&&this.log.e(e.message)},e.prototype.isDisposeErr=function(e){return e&&e.message===ii},e.prototype.isDisconnectErr=function(e){return e&&e.message===urn this.disposeDeferredSet.add(e),e.promise.then((function(){return t.disposeDeferredSet.delete(e)})).catch(this.snapshotError),e.promise.catch((function(){
return t.disposeDeferredSet.delete(e)})).catch(this.snapshotError),e},e.prototype.addDisconnect=function(e){var t=this;return this.disconnectDeferredSet.add(e),e.promise.then((function(){return t.disconnectDeferredSet.delete(e)})).catch(this.snapshotError),e.promise.catch((function(){return t.disconnectDeferredSet.delete(e)})).catch(this.snapshotError),e},e.prototype.getRuntimeMetadata=function(){return{version:ze.version,revision:ze.revision,lastCompiled:ze.lastCompiled,creationTime:(0,ui.r)(),userAgent:navigator.userAgent,cookieEnabled:navigator.cookieEnabled,hardwareConcurrency:navigator.hardwareConcurrency,maxTouchPoints:navigator.maxTouchPoints,deviceMemory:navigator.deviceMemory,devicePixelRatio:window.devicePixelRatio,viewport:"width:".concat(window.innerWidth,",height:").concat(window.,height:").concat(screen.height,",colorDepth:").concat(screen.colorDepth),gpu:"vendor:".concat(ci.g.vendor,",renderer:").concat(ci.g.renderer),frameUrl:document.URL,referrer:document.referrer}},e.prototype.hasFeature=function(e){var t=this.primary.featureList;return se(t)?t.has(e):!!Array.isArray(t)&&new Set(t).has(e)},e.prototype.getFormattedLogs=function(e){var t,r=this.rootStore,n=this.getRuntimeMetadata(),i=Object.keys(n).map((function(e){return"".concat(e,": ").concat(n[e])}));return r&&r.kernelStore&&!e&&(t=r.kernelStore.getHistoryLogs()),this.log.getFilteredLog({limit:e,header:i.join("\n"),footer:t})},e.prototype.downloadLogs=function(e){void 0===e&&(e=0);var t=(0,ui.p)(null,"yyyyMMdd_hhmmss");(0,li.L)({text:this.getFormattedLogs(e),filename:"BilibiliPlayer_".concat(t,".log")})},e.prototype.makeRealtimeReportMethod=function(){var e=this;return function(){if(!e.isInitialized)return null;if(!e.rootStore)return null;var t=e.rootStore,r=t.qualityStore,n=t.trackStore,i=t.mediaStore,o=t.portStore,a=t.metricStore,s=t.mediaStore.video,u=r.state.nowQuality,c=i.state.bufferedTime;return{absPlayTime:a.getAbsolutePlayTime(),relPlayTime:a.getRelativePlayTime(),bufferedTime:c,currentTime:s.currentTime,duration:s.duration,readyState:s.readyState,playbackRate:s.playbackRate,nowQ:u,realQ:r.realQ,realAQ:r.realAQ,srcUrl:o.getPlayUrl(),sourceType:n.getSourceType()}}},e.prototype.connect=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e=this;return(0,n.Jh)(this,(function(t){switch(t.label){case 0:return this.connectDetails.starting?[3,2]:(this.connectHead=performance.now(),ai.I.markOnce("M04"),ai.I.measureOnce("P03:I2CH","M03","M04"),ri.$W.add(this),(0,o.z)((function(){return e.connectDetails.starting=!0})),this.connectDeferred=new Qe.B,this.beforeEmitter.on("error",this.onError),this.afterEmitter.on("error",this.onError),this.emitter.on("error",this.onError),this.on(a.t.Player_Dispose,this.onDispose),this.on(a.t.Player_Disconnect,this.onDisconnect),this.nodes||(this.nodes=(r=v.m,n='\n        <div class="'.concat(r,'-container">\n            <div class="').concat(r,'-primary-area" aria-label="">\n                <div class="').concat(r,'-video-area">\n                    <div class="').concat(r,'-video-perch">\n                        <div class="').concat(r,'-video-wrap"></div>\n                    </div>\n                    <div class="').concat(r,'-video-poster" hidden></div>\n                    <div class="').concat(r,'-row-dm-wrap">\n                        <div class="').concat(r,'-adv-dm-wrap"></div>\n                        <div class="').concat(r,'-bas-dm-wrap"></div>\n                    </div>\n                    <div class="').concat(r,'-cmd-dm-wrap">\n                        <div class="').concat(r,'-cmd-dm-inside"></div>\n                    </div>\n                    <div class="').concat(r,'-ending-wrap" data-select="0">\n                        <div class="').concat(r,'-ending-backdrop" data-option="0"></div>\n                        <div class="').concat(r,'-ending-panel" data-option="1"></div>\n                        <div class="').concat(r,'-share-panel" data-option="2"></div>\n                    </div>\n                    <div class="').concat(r,'-subtitle-wrap"></div>\n                    <div class="').concat(r,'-top-wrap">\n                        <div class="').concat(r,'-top-mask" hidden></div>\n                        <div class="').concat(r,'-top-title"></div>\n                        <div class="').concat(r,'-top-follow"></div>\n                        <div class="').concat(r,'-top-left">\n                            <div class="').concat(r,'-top-left-title"></div>\n                            <div class="').concat(r,'-top-left-follow"></div>\n                            <div class="').concat(r,'-top-left-music"></div>\n                            <div class="').concat(r,'-top-left-panorama"></div>\n                        </div>\n                        <div class="').concat(r,'-top-issue">\n                            <span class="').concat(r,'-top-issue-icon"></span>\n                        </div>\n                    </div>\n                    <div class="').concat(r,'-state-wrap">\n                        <div class="').concat(r,'-state-play"></div>\n                        <div class="').concat(r,'-state-buff-icon"></div>\n                        <div class="').concat(r,'-state-buff-text">\n                            <span class="').concat(r,'-state-buff-title">...</span>\n                            <span class="').concat(r,'-state-buff-speed"></span>\n                        </div>\n                    </div>\n                    <div class="').concat(r,'-loading-panel">\n                        <div class="').concat(r,'-loading-panel-text" hidden></div>\n                        <div class="').concat(r,'-loading-panel-blur" hidden>\n                            <div class="').concat(r,'-loading-panel-blur-detail"></div>\n                        </div>\n                    </div>\n                    <div class="').concat(r,'-toast-wrap">\n                        <div class="').concat(r,'-toast-auto"></div>\n                        <div class="').concat(r,'-toast-fixed"></div>\n                    </div>\n                    <div class="').concat(r,'-control-wrap">\n                        <div class="').concat(r,'-control-mask"></div>\n                        <div class="').concat(r,'-control-entity">\n                            <div class="').concat(r,'-control-top"></div>\n                            <div class="').concat(r,'-control-bottom">\n                                <div class="').concat(r,'-control-bottom-left"></div>\n                                <div class="').concat(r,'-control-bottom-center"></div>\n                                <div class="').concat(r,'-control-bottom-right"></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="').concat(r,'-dialog-wrap"></div>\n                    <div class="').concat(r,'-music-wrap"></div>\n                    <div class="').concat(r,'-business-wrap business-hide"></div>\n                </div>\n                <div class="').concat(r,'-sending-area">\n                    <div class="').concat(r,'-sending-bar">\n                        <div class="').concat(r,'-sending-bar-left"></div>\n                        <div class="').concat(r,'-sending-bar-right"></div>\n                    </div>\n                </div>\n            </div>\n            <div class="').concat(r,'-dialog-area"></div>\n            <div class="').concat(r,'-tooltip-area"></div>\n            <div class="').concat(r,'-context-area"></div>\n        </div>'),{container:i=(0,Tt.t)(n),videoArea:i.querySelector(".".concat(r,"-video-area")),sendingArea:i.querySelector(".".concat(r,"-sending-area")),dialogArea:i.querySelector(".".concat(r,"-dialog-area")),tooltipArea:i.querySelector(".".concat(r,"-tooltip-area")),contextArea:i.querySelector(".".concat(r,"-context-area")),videoPerch:i.querySelector(".".concat(r,"-video-perch")),videoPoster:i.querySelector(".".concat(r,"-video-poster")),videoWrap:i.querySelector(".".concat(r,"-video-wrap")),rowDanmaku:i.querySelector(".".concat(r,"-row-dm-wrap")),
advDanmaku:i.querySelector(".".concat(r,"-adv-dm-wrap")),basDanmaku:i.querySelector(".".concat(r,"-bas-dm-wrap")),cmdDanmaku:i.querySelector(".".concat(r,"-cmd-dm-wrap")),cmdInside:i.querySelector(".".concat(r,"-cmd-dm-inside")),endingWrap:i.querySelector(".".concat(r,"-ending-wrap")),endingPanel:i.querySelector(".".concat(r,"-ending-panel")),sharePanel:i.querySelector(".".concat(r,"-share-panel")),subtitleWrap:i.querySelector(".".concat(r,"-subtitle-wrap")),topWrap:i.querySelector(".".concat(r,"-top-wrap")),stateWrap:i.querySelector(".".concat(r,"-state-wrap")),loadingPanel:i.querySelector(".".concat(r,"-loading-panel")),toastWrap:i.querySelector(".".concat(r,"-toast-wrap")),controlWrap:i.querySelector(".".concat(r,"-control-wrap")),dialogWrap:i.querySelector(".".concat(r,"-dialog-wrap")),sendingBar:i.querySelector(".".concat(r,"-sending-bar")),musicWrap:i.querySelector(".".concat(r,"-music-wrap")),businessWrap:i.querySelector(".".concat(r,"-business-wrap")),controlEntity:i.querySelector(".".concat(r,"-control-entity")),controlTop:i.querySelector(".".concat(r,"-control-top")),controlBottomCenter:i.querySelector(".".concat(r,"-control-bottom-center")),controlBottomLeft:i.querySelector(".".concat(r,"-control-bottom-left")),controlBottomRight:i.querySelector(".".concat(r,"-control-bottom-right")),topTitle:i.querySelector(".".concat(r,"-top-title")),topFollow:i.querySelector(".".concat(r,"-top-follow")),topLeftTitle:i.querySelector(".".concat(r,"-top-left-title")),topLeftFollow:i.querySelector(".".concat(r,"-top-left-follow")),topLeftMusic:i.querySelector(".".concat(r,"-top-left-music")),topLeftPanoram:i.querySelector(".".concat(r,"-top-left-panorama")),buffIcon:i.querySelector(".".concat(r,"-state-buff-icon")),buffSpeed:i.querySelector(".".concat(r,"-state-buff-speed")),toastAuto:i.querySelector(".".concat(r,"-toast-auto")),toastFixed:i.querySelector(".".concat(r,"-toast-fixed"))})),this.attachTemplate(),this.attachBaseNode(),this.rootStore=new Oi(this),this.rootStore.decomposeSubStores(this),Y(window.__NanoGlobalTheme),ai.I.markOnce("M05"),ai.I.measureOnce("P04:CH2ST","M04","M05"),this.storeTail=performance.now(),[4,this.connectDeferred.promise]);case 1:return t.sent(),this.isInitialized=!0,this.emit(a.t.Player_Connected,new CustomEvent(a.t.Player_Connected)),(0,o.z)((function(){return e.connectDetails.finished=!0})),ai.I.markOnce("M12"),ai.I.measureOnce("P06:CH2CT","M04","M12"),this.connectTail=performance.now(),[3,5];case 2:return[4,this.connectDeferred.promise];case 3:return t.sent(),[4,(0,o.gx)((function(){return e.connectDetails.finished}))];case 4:t.sent(),t.label=5;case 5:return[2,!this.rootStore.errorStore.state.initError]}var r,n,i}))}))},e.prototype.disconnect=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e=this;return(0,n.Jh)(this,(function(t){switch(t.label){case 0:return this.connectDetails.starting?((0,o.z)((function(){return e.connectDetails.finished=!1})),this.connectDeferred&&(td by "Player.disconnect()" action')),this.connectDeferred=nup.PLAYER_UNLOADED),this.emit(a.t.Player_Dispose,new CustomEvent(a.t.Player_Dispose)),this.rootStore&&this.rootStore.disconnect(),this.emit(a.t.Player_Disconnect,new CustomEvent(a.t.Player_Disconnect)),this.isInitialized=!1,this.detachBaseNode(),this.detachTemplate(),this.removeAllListeners(),this.log.clear(),this.track.clear(),this.nodes=null,(0,o.z)((function(){return e.connectDetails.starting=!1})),ri.$W.delete(this),[3,3]):[3,1];case 1:return[4,(0,o.gx)((function(){return!e.connectDetails.starti.LO],e.prototype,"connectDetails",void 0),(0,n.gn)([i.ZP],e.prototype,"onError",null),(0,n.gn)([i.ZP],e.prototype,"onDispose",null),(0,n.gn)([i.ZP],e.protorototype,"snapshotError",null),e}();var pi=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object.assign.apply(Object,(0,n.ev)((0,n.ev)([{}],(0,n.CR)(e),!1),[{origin:1}],!1))};var hi=[function(e){return{__core:function(){return e.kernelStore.dashKernel||e.kernelStore.flvKernel},__getUserParams:function(){return e.portStore.getUserParams()}}},function(e){return{setSegmented:function(t){e.hotspotStore.setSegmented(t)},addViewPoints:function(torCenter:funcenter(t)},addSubtitle:function(t){return e.subtitleStore.addSubtitle(t)}}},function(e){return{emit:function(t){for(var-1]=arguments[i];he external "temit.apply(e,(0,n.ev)([t],(0,(t,r),this},off:function(t,r){return e.off(t,r),this},once:function(t,r){return e.once(t,r),this},isInitialized:function(){return e.isInitialized},connect:function(){return e.connect()},dct()}}},function(e){return{downloadLogs:function(){return e.downloadLogs()},getFormattedLogs:function(t){return void 0===t&&(t=500),e.getFormattedLogs(t)},toggleFeature:function(t){Object.assign(e.disabled,t)}}},function(e){return{isEnded:function(){return e.portStore.isEnded(!1)},isPaused:function(){return e.portStore.isPaused()},isSeeking:function(){return e.portStore.isSeeking()},isMuted:function(){return e.portStore.isMuted()}}},function(e){return{mediaElement:function(){return e.mediaStore.video},canPlayType:function(t){return e.portStore.canPlayType(t)},getQuality:function(){(){return e.portStore.getCurrentTime()},getDuration:function(t){return e.portStore.getDuration(t)}}},function(e){return{getMediaInfo:functionon(){retueturn{getElements:function(){return e.portStore.getElements()},getStates:function(){return e.portStore.getStates()},getManifest:function(){return e.portStore.getManifest()},getSupportedQualityList:function(t){return e.portStore.getSupportedQualityList(t)}}},function(e){return{setLoop:function(t){return e.settingStore.setLoop(t,pi())},getLoop:function(){return e.settingStore.getLoop()},setMuted:function(t,r){return e.settingStore.setMuted(t,r,pi())},getMuted:function(){return e.settingStore.getMuted()},setVolume:function(t){return e.settingStore.setVolume(t,pi())},getVolume:function(){return e.settingStore.getVolume()},setPlaybackRate:function(t){return e.settingStore.setPlaybackRate(t,pi())},getPlaybackRate:function(){return e.settingStore.getPlaybackRate()},setMirror:function(t){return e.settingStore.setMirror(t,pi())},getMirror:function(){return e.settingStore.getMirror()},setAspectRatio:function(t){return e.settingStore.setAspectRatio(t,pi())},getAspectRatio:function(){return e.settingStore.getAspectRatio()},setLightOff:function(t){return e.settingStore.setLightOff(t,pi())},getLightOff:function(){return e.settingStore.getLightOff()},setBlackGap:function(t){return e.settingStore.setBlackGap(t,pi())},getBlackGap:function(){return e.settingStore.getBlackGap()},setAutoplay:function(t){return e.settingStore.setAutoplay(t,pi()re.getingStore.setHandoff(t,pi())},getHandoff:function(){return e.settingStore.getHandoff()},setPreferCodec:function(t){return e.settingStore.setPreferCodec(t)},getPreferCodec:function(){return e.settingStore.getPreferCodec()},setOpEd:function(t){return e.settingStore.setOpEd(t,pi())},getOpEd:function(){return e.settingStore.getOpEd()}}},function(e){return{play:function(t){return e.portStore.play(pi(t))},pause:function(t){return e.portStore.pause(pi(t))},seek:function(t,r){return e.portStore.seek(t,pi(r))},reload:function(t){return e.episodeStore.reload(t,null,pi())},goto:function(t,r,n){return e.episodeStore.goto(t,r,n,pi())},prev:function(t){return e.episodeStore.prev(t,pi())},next:function(t){return e.episodeStore.next(t,pi())},requestStatue:function(t,r){return e.statueStore.requestStatue(t,r,pi())},
requestQuality:function(t,r){return e.qualityStore.requestQuality(t,r,pi())},requestAutoplay:function(t){return e.mediaStore.startFirstPlay(!0,t)},fetch:function(t){return e.portStore.fetch(t)},reload()}}},function(e){return{toast:{create:function(t,r){return e.toastStore.create(t,r)},update:function(t,r){return e.toastStore.update(t,r)},remove:function(t){return e.toastStore.remove(t)},resumeClock:function(t){return e.toastStore.resumeClock(t)},suspendClock:function(t){return e.toastSto}}},function(e){return{tooltip:{create:function(t){return e.tooltipStore.create(t)},update:function(t,r){return e.tooltipStore.update(t,r)},remove:function(t){return e.tooltipStore.remove(t)}}}},function(e){return{hotspot:{set:function(t){return e.hotspotStore.set(t)},get:function(t){return e.hotspotStore.get(t)}}}},function(e){return{danmaku:{open:function(){return e.dmSettingStore.setState({dmSwitchOut:!0,dmSwitch:!0})},close:function(){return e.dmSettingStore.setState({dmSwitchOut:!1,dmSwitch:!1})},isOpen:function(){return e.sendStore.dmVisible},isDisabled:function(){return!!e.danmakuStore.state.state},send:function(t,r){return e.sendStore.setState({outSendMsg:{msg:t,fromPremiere:r}})}}}},function(e){return{sharePanel:{open:function(t){return e.shareStore.open(t)},close:function(){return e.shareStore.close()},isOpen:function(){return e.shareStore.state.opened}}}},function(e){return{endPanel:{open:function(){return e.endingStore.open()},close:function(){return e.endingStore.close()},isOpen:function(){return e.endingStore.state.opened}}}},function(e){return{interaction:{restart:function(){return e.interactStore.restart(plete:function(){return e.interactStore.isComplete()},jump:function(t){return e.interactStore.jump(t)}}}},function(e){return{auxiliary:{openTabList:function(){return e.auxStore.setState({isListSpread:!0})},closeTabList:function(){return e.auxStore.setState({isListSpread:!1})},isTabListOpen:function(){return e.auxStore.state.isListSpread},enableUserSwitching:function(){return e.auxStore.setState({disableListSwitch:!1})},disableUserSwitching:function(){return e.auxStore.setState({disableListSwitch:!0})},isUserSwitchingDisabled:function(){return e.auxStore.state.disableListSwitch}}}},function(e){return{track:{requestAudioId:function(t){return e.kernelStore.requestAudioTrack(t)},getAudioId:function(){return e.kernelStore.getAudioTrackId()},getAudioList:function(){return e.kernelStore.getAudioTrackList()}}}},function(e){return{setState:function(t){return e.portStore.attachExtState(t)},readFrameAsBlob:function(t){return e.portStore.readFrameAsBlob(t)},readFrameAsDataURL:function(t){return e.portStore.readFrameAsDataURL(t)},getStageTiming:function(){return e.rootStore.stageAtom.getTiming()}}}];var yi=function(){function e(e){this.prefix="bpx-legacy-browser",this.config=Object.assign({promptImageUrl:"//s1.hdslb.com/bfs/static/player/img/h5.png",promptTextList:[" HTML5 ","~"]},e),this.container=this.config.container,this.container.innerHTML=this.template()}return e.prototype.template=function(){var e,t,r=[];if(Array.isArray(this.config.promptTextList))try{for(var i=(0,n.XA)(this.config.promptTextList),o=i.next();!o.done;o=i.next()){var a=o.value;r.push('<p class="'.concat(this.prefix,'-text">').concat(a,"</p>"))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return'\n            <div class="'.concat(this.prefix,'-container">\n                <img class="').concat(this.prefix,'-image" src="').concat(this.config.promptImageUrl,'" alt="Legacy Browser">\n           ")},e.prototype.dispose=function(){var e=this.container.querySelector(".".concat(this.prefix,"-container"));e&&e.parentElement&&e.parentElement.removeChild(e)},e}(),mi=function(){function e(){window[v.bw]&&window[v.bw].injector===this.injector?console.error('The "'.concat(v.bw,'" namespace already exist')):window[v.bw]=this}return Object.defineProperty(e.prototype,"injector",{get:function(){return v.bw},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return Object.assign(Object.create(null),ze)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cookies",{get:function(){return M},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"EventType",{get:function(){return(0,n.pi)({},a.t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"GroupKind",{get:function(){return(0,n.pi)({},f.HR)},enumerable:!1,coty(e.prototype,"ScreenKind",{get:function(){return(0,n.pi)({},f.dY)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"FetcherKind",{get:function(){return(0,n.pi)({},f.qW)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"HandoffKind",{get:function(){return(0,n.pi)({},f.ty)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ChannelKind",{get:function(){return(0,n.pi)({},f.u5)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"InternalKind",{get:function(){return(0,n.pi)({},f.s)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"guid",{get:function(){return Z},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"prefetch",{get:function(){return kn},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return ei},enumerable:!1,configurable:!0}),e.prototype.createPlayer=function(e,t){if(!(0,c.Z)(e))throw new Error("1 argument required and MUST be a plain object");return function(e){void 0===e&&(e='video/mp4; codecs="avc1.42001E, mp4a.40.2"');var t="[canPlayType]:"+e;if(ti.x.has(t))return ti.x.get(t);var r=navigator.userAgent.toLowerCase(),n=!(/msie [\w.]+/.exec(r)||/Trident/i.test(r)&&/Windows NT 6/.test(r)||!window.URL);if(n){var i=document.createElement("video");if(i&&i.canPlayType)return!!i.canPlayType(e)}return ti.x.set(t,n),n}()?(r=new fi(e,t),i=hi.map((function(e){return e(r)})),o=Object.assign.apply(Object,(0,n.ev)([{}],(0,n.CR)(i),!1)),r.api=o,o):(e.element&&new yi({container:e.element}),null);var r,i,o},e.prototype.searchParams=function(e){return void 0===e&&(e=window.location.search),$n().parse(e,{ignoreQueryPrefix:!0,plainObjects:!0})},e.prototype.valueOf=function(){return(0,n.ev)([],(0,n.CR)(ri.$W),!1)},e}(),gi=function(e){function t(t){var r,n=e.call(this,t)||this;return n.tag="[HelperAtom]",n.helpers=new Map,n.isReOk=!1,n.helperState=((r={})[0]=!1,r[1]=!1,r[2]=!1,r[3]=!1,r[4]=!1,r[5]=!1,r[6]=!1,r[7]=!1,r),(0,o.rC)(n),n.init(),n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototypeable:!1,configurable:!0}),t.prototype.setHelper=function(e,t){this.helperState[e]=t},t.prototype.init=function(){var e=this,t=this.rootStore.configStore;t.isChannel(f.u5.Homepage)||t.isChannel(f.u5.Homepage_Topic)?this.fetchHelpers():this.dc.fetchHelpers=(0,o.gx)((function(){return e.canRequest}),(function(){return e.fetchHelpers()}))},t.prototype.buildHelper=function(e){var t=this;this.dc[e]&&this.log.e("E:Helper(".concat(e,") is repeatedly initialized")),this.dc[e]=(0,o.gx)((function(){return t.isReOk&&t.rootStore.isLoadEnded&&t.helperState[e]}),(function(){var r=t.helpers.get(e);r?new r(t.rootStore).install():t.log.w("Helper(".concat(e,") not found"))}))},t.prototype.buildRootExtra=function(){var e=this;r.e(892).then(r.bind(r,19325)).then((function(t){new t.RootExtra(e.rootStore),(0,o.z)((function(){return e.isReOk=!0}))})).catch((function(t){e.log.e("root_extra",t&&t.message)}))},t.prototype.fetchHelpers=function(){var e,t=this;this.buildRootExtra();var r=(e=this.rootStore).configStore,n=e.uiStore,i=function(e,r){t.helpers.set(e,r),t.setHelper(e,!0)},o=function(e,r){t.log.e(e,r&&r.message)},a=function(){mi.getCommunityHelper().then((function(e){return i(2,e.CommunityHelper)})).catch((function(e){return o("community_helper",e)}))};if(this.buildHelper(0),
mi.getCommonHelper().then((function(e){return i(0,e.CommonHelper)})).catch((function(e){return o("common_helper",e)})),r.isChannel(f.u5.Homepage)||r.isChannel(f.u5.Homepage_Topic))return this.buildHelper(5),void mi.getHomepageHelper().then((function(e){return i(5,e.HomepageHelper)})).catch((function(e){return o("homepage_helper",e)}));if(r.isManagerCreator())return this.buildHelper(6),void mi.getCreatorHelper().then((function(e){return i(6,e.CreatorHelper)})).catch((function(e){return o("creator_helper",e)}));if(r.isChannel(f.u5.Embedded)||r.isChannel(f.u5.Embedded_White)||r.isChannel(f.u5.Embedded_Other))return this.buildHelper(7),void mi.getEmbeddedHelper().then((function(e){return i(7,e.EmbeddedHelper)})).catch((functioisChannel switch(n.kind){case f.HR.Pgc:this.buildHelper(1),mi.getBangumiHelper().then((function(e){return i(1,e.BangumiHelper)})).catch((function(e){return o("bangumi_helper",e)}));break;case f.HR.Pugv:this.buildHelper(3),k;case f.HR.Ugc:default:this.buildHelper(2),a()}r.auxiliary&&(this.buildHelper(4),mi.getAuxiliaryHelper().then((function(e){return i(4,e.AuxiliaryHelper)})).catch((function(e){return o("auxiliary_helper",e)})))},(0,n.gn)([o.LO],t.prototype,"isReOk",void 0),(0,n.gn)([o.LO],t.prototype,"helperState",void 0),(0,n.gn)([o.Fl],t.prototype,"canRequest",null),(0,n.gn)([o.aD],t.prototype,"setHelper",null),t}(l),vi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loopTimer=null,t.referer={iSeek:null,iPlay:null,iPause:null},t}return(0,n.Zurn this.referer.iSeek=null,e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iPlayOnce",{get:function(){var e=this.referer.iPlay;return this.referer.iPlay=null,e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iPauseOnce",{get:function(){var e=this.referer.iPause;return this.referer.iPause=null,e},enumerable:!1,configurable:!0}),t.prototype.setActionCaller=function(e,t){this.referer[e]=t},t.prototype.addEvents=function(){this.addReactions(),this.addProxyEvent(),this.addCanceledEvent(),this.addTrackEvent()},t.prototype.addProxyEvent=function(){var e=this,t=this.rootStore.mediaStore;this.rootPlayer.on(s.p.MEDIA_ENDED,(function(){return e.mediaEndedHandler()})),this.rootPlayer.on(s.p.MEDIA_PLAY,(function(){t.setState({paused:t.video.paused}),e.rootPlayer.emit(a.t.Player_Play,new CustomEvent(a.t.Player_Play,{detail:{initiator:e.iPlayOnce}}))})).on(s.p.MEDIA_PAUSE,(function(){t.setState({paused:t.video.paused}),e.rootPlayer.emit(a.t.Player_Pause,new CustomEvent(a.t.Player_Pause,{detail:{initiator:e.iPauseOnce}}))})),this.rootPlayer.on(s.p.MEDIA_PLAYING,(function(){e.rootPlayer.emit(a.t.Player_Playing,new CustomEvent(a.t.Player_Playing))})).on(s.p.MEDIA_WAITING,(function(){e.rootPlayer.emit(a.t.Player_Waiting,new CustomEvent(a.t.Player_Waiting))})),this.rootPlayer.on(s.p.MEDIA_SEEKING,(function(){e.rootPlayer.emit(a.t.Player_Seeking,new CustomEvent(a.t.Player_Seeking,{detail:{initiator:e.referer.iSeek}}))})).on(s.p.MEDIA_SEEKED,(function(){e.rootPlayer.emit(a.t.Player_Seeked,new CustomEvent(a.t.Player_Seeked,{detail:{initiator:e.iSeekOnce}}))})),this.rootPlayer.on(s.p.MEDIA_TIMEUPDATE,(function(){e.rootPlayer.emit(a.t.Player_TimeUpdate,new CustomEvent(a.t.Player_TimeUpdate))})).on(s.p.MEDIA_DURATIONCHANGE,(function(){e.rootPlayer.emit(a.t.Player_DurationChange,new CustomEvent(a.t.Player_DurationChange))})),this.rootPlayer.on(s.p.MEDIA_LOADEDMETADATA,(function(){e.rootPlayer.emit(a.t.Player_LoadedMetadata,new CustomEvent(a.t.Player_LoadedMetadata))})).on(s.p.MEDIA_CANPLAY,(function(){e.rootPlayer.emit(a.t.Player_Canplay,new CustomEvent(a.t.Player_Canplay))})).on(s.p.MEDIA_PROGRESS,(function(){e.rootPlayer.emit(a.t.Player_Progress,new CustomEvent(a.t.Player_Progress))})).on(s.p.MEDIA_RATECHANGE,(function(){e.rootPlayer.emit(a.t.Player_RateChange,new CustomEvent(a.t.Player_RateChange))})).on(s.p.MEDIA_VOLUMECHANGE,(function(){e.rootPlayer.emit(a.t.Player_VolumeChange,new CustomEvent(a.t.Player_VolumeChange))})).on(s.p.MEDIA_ERROR,(function(){e.rootPlayer.emit(a.t.Player_Error,new CustomEvent(a.t.Player_Error))})),this.rootPlayer.on(s.p.MEDIA_LOADSTART,(function(){e.rootPlayer.emit(a.t.Player_LoadStart,new CustomEvent(a.t.Player_LoadStart))})).on(s.p.MEDIA_LOADEDDATA,(function(){e.rootPlayer.emit(a.t.Player_LoadedData,new CustomEvent(a.t.Player_LoadedData))})).on(s.p.MEDIA_STALLED,(function(){e.rootPlayer.emit(a.t.Player_Stalled,new CustomEvent(a.t.Player_Stalled))})).on(s.p.MEDIA_SUSPEND,(function(){e.rootPlayer.emit(a.t.Player_Suspend,new CustomEvent(a.t.Player_Suspend))})).on(s.p.MEDIA_ABORT,(function(){e.rootPlayer.emit(a.t.Player_Abort,new CustomEvent(a.t.Player_Abort))})).on(s.p.MEDIA_EMPTIED,(function(){e.rootPlayer.emit(a.t.Player_Emptied,new CustomEvent(a.t.Player_Emptied))}))},t.prototype.mediaEndedHandler=function(){var e=this.rootStore,t=e.mediaStore,r=e.settingStore,n=t.state.paused,i=t.state.ended;r.state.loop?(t.setState({ended:!1}),n||this.rootPlayer.emit(a.t.Player_TimeUpdate,new CustomEvent(a.t.Player_TimeUpdate)),this.rootPlayer.emit(a.t.Player_Loop_Signal,new CustomEvent(a.t.Player_Loop_Signal,{cancelable:!0}))):(t.setState({paused:!0,ended:!0}),n||(this.rootPlayer.emit(a.t.Player_TimeUpdate,new CustomEvent(a.t.Player_TimeUpdate)),this.rootPlayer.emit(a.t.Player_Pause,new CustomEvent(a.t.Player_Pause))),i||this.rootPlayer.emit(a.t.Player_Ended,new CustomEvent(a.t.Player_Ended)))},t.prototype.addReactions=function(){var e=this;this.dc.committed=(0,o.U5)((function(){return e.rootStore.isCommitted}),(function(t){t&&e.rootPlayer.emit(a.t.Player_Committed,new CustomEvent(a.t.Player_Committed))}),{fireImmediately:!0}),this.dc.prepared=(0,o.U5)((function(){return e.rootStore.isPrepared}),(function(t){t&&e.rootPlayepared))}),{fireImmediately:!0}),this.dc.initialized=(0,o.U5)((function(){return e.rootStore.isLoaded}),(function(t){t&&(e.rootPlayer.emit(a.t.Player_Initialized,new CustomEvent(a.t.Player_Initialized)),e.rootPlayer.connectDeferred&&e.rootPlayer.connectDeferred.isPending&&e.rootPlayer.connectDeferred.resolve())}),{fireImmediately:!0})},t.prototype.addCanceledEvent=function(){var e=this;this.rootPlayer.on(a.t.Player_Loop_Signal,(function(t){t.defaultPrevented||(e.loopTimer=window.setTimeout((function(){e.rootStore.portStore.see,t.prototype.addTrackEvent=fr t=e.rootStore,r=t.errorStore,n=t.episodeStore,i=t.uiStore,o=t.mpdStore;e.track.o("enter",{drm:o.drmTechType||0,dpr:window.devicePixelRatio||NaN,screenW:screen.width,screenH:screen.height,colorDepth:screen.colorDepth,webdriver:+navigator.webdriver,initErr:+r.state.initError,initial:+n.isFirst,timeout:+i.state.isLoadTimeout,referrer:document.referrer,frameUrl:document.URL},{immediately:!0})})).on(s.p.MEDIA_ENDED,(function(){e.track.o("ended")}))},t.prototype.onDisconnect=function(){e.prototype.onDisconnect.call(this),clearTimeout(this.loopTimer)},t}(l),_i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDrmCer",t.url="//bvc-drm.bilivideo.com/cer/bilidrm_pub.key",t}return(0,n.ZT)(t,e),t.prototype.r=function(){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(e){return[2,this.getRemoteResponse(0).then((function(e){return e.data}))]}))}))},t.prototype.getRemoteResponse=function(e){var t=this;return this.request({url:this.url,responseType:"arraybuffer"}).catch((function(r){return le.eV.isCanceled(r)?Promise.reject(r):e?t.getRemoteResponse(--e):Promise.reject(r)}))},t}(le.eV),Ei=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDrmCkc",t.url="//bvc-drm.bilivideo.com/bilidrm",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,
n.Jh)(this,(function(t){return[2,this.getRemoteResponse(0,JSON.stringify(e)).then((function(e){var t=e.data;if(t&&200===t.status&&t.ckc)return t;throw t&&t.message?new Error("status: ".concat(t.status,"; message: ").concat(t.message)):new Error("Unknown error")}))]}))}))},t.prototype.getRemoteResponse=function(e,t){var r=this;return this.request({url:this.url,method:"POST",data:t}).catch((function(n){return le.eV.isCanceled(n)?Promise.reject(n):e?r.getRemoteResponse(--e,t):Promise.reject(n)}))},t}(le.eV),bi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDrmWidevineCer",t.url="//bvc-drm.bilivideo.com/cer/bilibili_certificate.bin",t}return(0,n.ZT)(t,e),t.prototype.r=function(){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(e){return[2,this.getRemoteResponse(0).then((function(e){return e.data}))]}))}))},t.prototype.getRemoteResponse=function(e){var t=this;return this.request({url:this.url,responseType:"arraybuffer"}).catch((function(r){return le.eV.isCanceled(r)?Promise.reject(r):e?t.getRemoteResponse(--e):Promise.reject(r)}))},t}(le.eV),Si=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpDrmCheck",t.url="//api.bilibili.com/pgc/player/web/check",t}return(0,n.ZT)(t,e),t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.getRemoteResponse(1,e).then((function(e){if(e.data)return e.data;throw new Error("Invalid data")}))]}))}))},t.prototype.getRemoteResponse=function(e,t){var r=this;return this.request({url:this.url,method:"GET",params:t,withCredentials:!0}).catch((function(n){return le.eV.isCanceled(n)?Promise.reject(n):e?r.getRemoteResponse(--e,t):Promise.reject(n)}))},t}(le.eV);var Ti,wi=r(53680),Ai=f(e){void 0===e&&(e=""mBuffer=function(e){for(var t=[],r=new Uint8Array(e),n=0;n<r.byteLength;n++)t.push(String.fromCodePoint(r[n]));return t.join("")},e.decode=function(t){void 0===t&&(t="");var r=wi.toByteArray(t);return e.textFromBuffer(r)},e.encode=function(t){void 0===t&&(t="");var r=e.bufferFromText(t);return wi.fromByteArray(r)},e.encodeHex=function(t){return e.encode(t.match(/\w{2}/g).map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""))},e.toUrl=function(e){return"string"==typeof e?e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"):e},e}(),Ri=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="GuardAtom",t.widevineServerURL="//bvc-drm.bilivideo.com/bili_widevine",t.permInterval=9e5,t}return(0,n.ZT)(t,e),t.prototype.getHttpCer=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t;return(0,n.Jh)(this,(function(r){switch(r.label){case 0:e=new _i(this.rootPlayer,{memCache:!0}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.r()];case 2:return[2,r.sent()];case 3:throw t=r.sent(),this.log.e("getHttpCer",t&&t.message),t;case 4:return[2]}}))}))},t.prototype.getHttpCkc=function(e){return(0,n.mG)(th t,r;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:t=new Ei(this.rootPlayer),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t.r({spc:e})];case 2:return[2,n.sent().ckc];case 3:throw r=n.sent(),this.log.e("getHttpCkc",r&&r.message),r;case 4:return[2]}}))}))},t.prototype.getDrmSdkModule=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,r;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:if(t.DRM_SDK_MODULE)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),e=t,[4,(0,Le.T1)().then((function(e){return e.default()}))];case 2:return e.DRM_SDK_MODULE=n.sent(),[3,4];case 3:return r=n.sent(),this.log.e("getDrmSdkModule",r&&r.message),[3,4];case 4:r,n.mG)(threturn(0,n.Jh)(this,(function(r){switch(r.label){case 0:e=new bi(this.rootPlayer,{memCache:!0,persistent:!0}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.r()];case 2:return[2,r.sent()];case 3:throw t=r.sent(),this.log.e("getHttpWidevineCer",t&&t.message),t;case 4:return[2]}}))}))},t.prototype.startPeriodicPerm=function(){var e=this;this.permTimer||(this.permTimer=window.setTimeout((function(){e.validPerm().then((function(){e.log.i("validPerm","done"),e.abortPeriodicPerm(),e.startPeriodicPerm()})).catch((function(t){e.handlePermDenied(t,0)}))}),this.permInterval))},t.prototype.abortPeriodicPerm=function(){this.permTimer&&(clearTimeout(this.permTimer),this.permTimer=null)},t.prototype.handlePermDenied=function(e,t){var r=this.rootStore,n=r.kernelStore,i=r.configStore,o=r.toastStore,a=e&&e.message||"";this.log.e("validPerm","fail",a),this.abortPeriodicPerm(),n.attachExternal({quality:0,mediaDataSource:{type:"mp4",url:i.errorUrl}},{initiator:t}),o.create({text:a,duration:3500,manualMode:!0})},t.prototype.validPerm=function(){var e=this,t=this.rootStore.configStore;return new Si(this.rootPlayer,{memCache:!1}).r({season_id:t.seasonId,ep_id:t.episodeId}).then((function(e){var t=e.result&&e.result.allow_play,r=e.result&&e.result.errmsg||e.message;if(!t)throw new Error(r)})).then((function(){e.startPeriodicPerm()}))},t.prototype.getKeyDetail=function(e){var t=this,r=this.getHttpCer(),i=this.getDrmSdkModule(),o=new Qe.B;return Promise.all([r,i]).then((function(r){return(0,n.mG)(t,void 0,void 0,(function(){var t,i,a,s,u,c,l,d,f,p;return(0,n.Jh)(this,(function(h){switch(h.label){case 0:return t=r[0],i=r[1],a=function(e){void 0===e&&(e=16);for(var t=Math.random().toString(36).slice(2);t.length<e;)t+=Math.random().toString(36).slice(2);return t.slice(0,e)}(16),s=i.biliDRMGenSPC(e,a,t),u=s.spc,[4,this.getHttpCkc(u)];case 1:if(c=h.sent(),l=i.biliDRMParseCKC(wi.toByteArray(c),a),d=Ai.toUrl(Ai.encodeHex(e)),f=Ai.toUrl(l.key),!l||!l.key)throw new Error("Parsed CKC invalid");return o.resolve((0,n.pi)((0,n.pi)({},l),{protectionData:{"org.w3.clearkey":{clearkeys:(p={},p[d]=f,p),priority:0}}})),[2]}}))}))})).catch((function(e){return o.reject(e)}))(le.eV.L===le.eV.LIFECYCLE_TOKEN}}},t.prototype.getWidevineDetail=function(){var e=this,t=this.getHttpWidevineCer(),r=new Qe.B;return t.then((function(t){var n=wi.fromByteArray(new Uint8Array(t));if(!n)throw new Error("Get Widevine ServerCertificate Failed");r.resolve({proteertificate:n,priority:0}}})})).catch((function(e){return r.reject(e)})),{promise:r.promise,abort:.eV.LIFECYCLE_TOKEN))},isAbort:function(e){return e&&e.message===le.eV.LIFECYCLE_TOKEN}}},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this.abortPeriodicPerm()},t}(l),Pi=function(e){function t(t){var r=e.call(this,t)||this;return r.tag="FreeStore",r.eventAtom=new vi(t),r.guardAtom=new Ri(t),r}return(0,n.ZT)(t,e),t.prototype.onMount=function(){e.prototype.onMount.call(this),this.eventAtom.addEvents()},t.prototype.onMounted=function(){var t=this;e.prototype.onMounted.call(this),[Zn,Jn,gi].forEach((function(e){return new e(t.rootStore)}))},t}(d),Di=function(){function e(e){var t=this;this.rootStore=e,this.tag="StageAtom",this.timeMap=new Map,this.rootPlayer=e.rootPlayer,this.resetStageInfo(),this.rootPlayer.on(a.t.Player_Dispose,(function(){return t.resetStageInfo()}),1).on(a.t.Player_Navigate,(function(){return t.addReportEvents()})).on(a.t.Player_Dispose,(function(){return t.dispose()})),this.addTimeReaction()}return e.prototype.set=function(e,t){if(this.stageTiming[e])return!1;var r="".concat(this.tag,"@hideTimeGap");switch(e){case 3:ai.I.markOnce("M06"),ai.I.measureOnce("P05:CH2PUH","M04","M06");break;case 4:case 5:ai.I.markOnce("M07"),ai.I.measureOnce("P07:PUH2PUT","M06","M07");break;case 6:ai.I.markOnce("M08"),ai.I.measureOnce("P08:PUT2MLS","M07","M08"),this.hideTimeGap.streamTrusted=!this.rootStore.pageHidden,this.timeStarting(r);break;case 7:ai.I.markOnce("M09"),
ai.I.measureOnce("P09:MLS2MM","M08","M09"),this.hideTimeGap.streamGap=this.timeFinished(r).hiddenDuration;break;case 8:ai.I.markOnce("M10"),ai.I.measureOnce("P10:MLS2MF","M08","M10");break;case 9:ai.I.markOnce("M11"),ai.I.measureOnce("P11:MLS2MC","M08","M11")}return this.stageTiming[e]=null!=t?t:performance.now(),!0},e.prototype.getTiming=function(){var e,t=this.stageTiming,r=ri._g,n=r.entryLoadTime,i=(e=this.rootStore).episodeStore,o=e.errorStore,a=e.configStore,s=e.mpdStore,u=e.kernelStore,c=+i.isFirst,l=+(i.state.isRenewal||a.state.isRequestId),d=+this.hideTimeGap.streamTrusted,p=+o.state.initError,h=+s.state.mpdRetries,y=+u.state.streamRetries,m=-1===h?y:h+y,g=_(this.hideTimeGap.streamGap),v=_(r.entryRequestStart),E=_(r.entryResponseEnd),b=_(ai.I.getMarkTimeByName("M01")),S=_(this.rootPlayer.instantiate),T=_(this.rootPlayer.connectHead),w=_(this.rootPlayer.storeTail),A=_(this.rootPlayer.connectTail),R=_(t[0]),P=_(t[1]),D=_(t[2]),O=_(t[3]),I=_(t[4]),C=_(t[6]),N=_(t[7]),k=_(t[8]),L=_(t[9]),x=c?0:R,M=c?T:R,F=_(c?v:0),U=_(c?P-v:0),B=_(D-P),j=_(I?I-D:0),V=_(I?N-I-g:0),H=_(c?P:0),G=0,q=0,W=0,K=0,Y=0,Q=0;I&&(G=_(N-x-g),q=_(N-M-g),W=_(k-x-g),K=_(k-M-g),Y=_(L-x-g),Q=_(L-M-g)),a.isChannel(f.u5.Default)||(G=q,W=K,Y=Q);var z=0,Z=0,J=0;return c&&n&&(Z=_(n.transferSize),z=_(n.duration),Z&&z&&(J=_(Z/z))),(0,Ze.Z)({context:{initial:c,visible:d,renewal:l,initErr:p,mpdRetries:h,streamRetries:y,totalRetries:m},origin:{metadata:G,firstFrame:W,canplay:Y},approx:{metadata:q,firstFrame:K,canplay:Q},duration:{s1:F,s2:U,s3:B,s4:j,s5:V,s6:H}},{timing:{entryReqStart:v,entryResEnd:E,indexHead:b,instantiate:S,connectHead:T,storeTail:w,connectTail:A,streamGap:g,originStart:x,approxStart:M,reloadHead:R,viewHead:P,viewTail:D,playUrlHead:O,playUrlDone:I,loadStart:C,metadata:N,firstFrame:k,canplay:L},entry:{size:Z,duration:z,speed:J}})},e.prototype.resetStageInfo=function(){var e;this.hideTimeGap={streamGap:0,streamTrusted:!1},this.stageTiming=((e={})[0]=NaN,e[1]=NaN,e[2]=NaN,e[3]=NaN,e[4]=NaN,e[5]=NaN,e[6]=NaN,e[7]=NaN,e[8]=NaN,e[9]=NaN,e)},e.prototype.reportMetadata=function(){var e=this.getTiming(),t=e.context,r=e.duration,n=e.origin.metadata,i=e.approx.metadata;this.rootPlayer.track.o("loaded_time",{initErr:t.initErr,initial:t.initial,origin:n,approx:i}),this.rootPlayer.track.o("stage",{initErr:t.initErr,initial:t.initial,renewal:t.renewal,visible:t.visible,origin:n,approx:i,totalRetries:t.totalRetries,streamRetries:t.streamRetries,mpdRetries:t.mpdRetries,s1:r.s1,s2:r.s2,s3:r.s3,s4:r.s4,s5:r.s5,s6:r.s6})},e.prototype.reportCanplay=function(){var e=this.getTiming(),t=e.context,r=e.origin.canplay,n=e.approx.canplay,i=this.rootStore.kernelStore,o={};i.baseAgent&&(o.canplaySpeed=_(i.baseAgent.averageThroughput)),this.rootPlayer.track.o("frame_time",{initErr:e.context.initErr,initial:t.initial,origin:r,approx:n}),this.rootPlayer.track.o("media_canplay",(0,Ze.Z)(o,e))},e.prototype.addReportEvents=function(){this.rootPlayer.once(s.p.MEDIA_LOADEDMETADATA,this.reportMetadata).once(s.p.MEDIA_CANPLAY,this.reportCanplay)},e.prototype.removeReportEvents=function(){this.rootPlayer.off(s.p.MEDIA_LOADEDMETADATA,this.reportMetadata).off(s.p.MEDIA_CANPLAY,this.reportCanplay)},e.prototype.timeStarting=function(e){var t=performance.now();this.timeMap.set(e,{startingTime:t,previousHiddenTime:this.rootStore.pageHidden?t:NaN,accumulativeHiddenTime:0})},e.prototype.timeFinished=function(e){var t=performance.now(),r=this.timeMap.get(e),n={duration:NaN,hiddenDuration:NaN,visibleDuration:NaN};return r&&(n.duration=t-r.startingTime,this.rootStore=r.accumulativeHiddenTime,n.visibleDuration=n.duration-n.hiddenDuration),this.timeMap.delete(e),n},e.prototype.addTimeReaction=function(){var e=this;this.timeMapDisposer=(0,o.EH)((function(){if(e.rootStore.pageHidden){if(e.timeMap.size){var t=performance.now();e.timeMap.forEach((function(e){e.previousHiddenTime=t}))}}else if(e.timeMap.size){var r=performance.now();e.timeMap.forEach((function(e){e.accumulativeHiddenTime+=r-e.previousHiddenTime||0}))}}))},e.prototype.dispose=function(){this.timeMapDisposer&&this.timeMapDisposer(),this.removeReportEvents()},(0,n.gn)([i.ZP],e.prototype,"reportMetadata",null),(0,n.gn)([i.ZP],e.prototype,"reportCanplay",null),e}(),Oi=function(){function e(e){var t=this;this._isInitialized=!1,this._isDisposing=!1,this.subKeyList=[],this.ding=0,this.pageHidden=!1,(0,o.rC)(this),this.rootPlayer=e,this.nodes=e.nodes,this.window=e.window,this.parent=e.parent,this.isEmbed=e.isEmbed,this.isEmbedSOP=e.isEmbedSOP,this.stageAtom=new Di(this),this.visibilityHandler(),this.addVisibilityEvents(),this.rootPlayer.on(a.t.Player_Navigate,(function(){return t._isDisposing=!1}),-1).on(a.t.Player_Dispose,(function(){return t._isDisposing=!0}),-1).on(a.t.Player_Dispose,(function(){return t._isDisposing=!1}),1),this.subStores={localStore:new Ne(this),sessionStore:new ke(this),settingStore:new B(this),configStore:new be(this),assetStore:new lt(this),mpdStore:new Un(this),kernelStore:new Pt(this),uiStore:new g(this),mediaStore:new R(this),userStore:new Fe(this),upStore:new je(this),episodeStore:new ct(this),errorStore:new It(this),qualityStore:new yt(this),endingStore:new tt(this),portStore:new et(this),statueStore:new kt(this),sendStore:new Bt(this),danmakuStore:new Xt(this),dmAdvStore:new ir(this),dmBasStore:new or(this),dmListStore:new fr(this),dmCmdStore:new br(this),dmSkipStore:new Tr(this),dmSettingStore:new Ar(this),blockStore:new Cr(this),dmMaskStore:new kr(this),dmModeStore:new xr(this),toastStore:new Mr(this),tooltipStore:new Fr(this),httpStore:new Gr(this),trackStore:new qr(this),pipStatStore:new Bn(this),auxStore:new Wr(this),ctrlStore:new Kr(this),menuStore:new Yr(this),hotspotStore:new zr(this),panoramaStore:new Jr(this),interactStore:new ln(this),shareStore:new gn(this),subtitleStore:new vn(this),progressStore:new En(this),storyStore:new Tn(this),premiereStore:new zn(this),wmpStore:new Hn(this),metricStore:new GQn(this),freeStore:new Pi(this)},this.subKeyList=Object.keys(this.subStores),this.decomposeSubStores(this),this.rootPlayer.emit(s.p.PLAYER_GRAPH_FLATTEN),this.rootPlayer.emit(s.p.PLAYER_STORAGE_BUILD),this.rootPlayer.emit(s.p.PLAYER_STATE_CREATr.emit(s.p.PLAYER_STORE_MOUNT),this.rootPlayer.emit(s.p.PLAYER_STORE_MOUNTED),this.changeP(),(0,o.z)((function(){return t._isInitialized=!0}))}return Object.defineProperty(e.prototype,"isCommitted",{get:function(){return this._isInitialized&&this.ding},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPrepared",{get:function(){return this.isCommitted&&this.configStore.state.isCompleteIdEnded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return this.isPrepared&&this.uiStore.state.isLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoadEnded",{get:function(){return this.isPrepared&&(this.uiStore.state.isLoaded||this.uiStore.state.isLoadTimeout)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDisposing",{get:function(){return this._isDisposing},enumerable:!1,configurable:!0}),e.prototype.changeP=function(){this.rootPlayer.emit(a.t.Player_Navigate,new CustomEvent(a.t.Player_Navigate)),this.ding+=1},e.prototype.decomposeSubStores=function(e){var t,r;try{for(var i=(0,n.XA)(this.subKeyList),o=i.next();!o.done;o=i.next()){var a=o.value;0,e[a]=this.suon(){var e=this;(0,o.z)((function(){switch(document.vin=!0;break;case"visible":e.pageHidden=!1;break;default:null!=document.hidden&&(e.pageHidden=document.hidden)}}))},e.prototype.addVisibilityEvents=function(){document.addEventListener("visibilitychange",this.visibilityHandler),window.addEventListener("pagehide",this.visibilityHandler)},e.prototype.removeVisibilityEvents=function(){document.removeEventListener("visibilitychange",this.visibilityHandler),
window.removeEventListener("pagehide",this.visibilityHandler)},e.prototype.disconnect=function(){var e=this;(0,o.z)((function(){return e._isInitialized=!1})),this.removeVisibilityEvents()},(0,n.gn)([o.LO],e.prototype,"_isInitialized",void 0),(0,n.gn)([o.LO],e.prototype,"ding",void 0),(0,n.gn)([o.LO],e.prototype,"pageHidrepared",null),(0,n.gn)([o.Fl],e.prototype,"isLoaded",null),(0,n.gn)([o.Fl],e.prototype,"isLoadEnded",null),(0,n.gn)([o.aD],e.prototype,"changeP",null),(0,n.gn)([i.ZP],e.prototype,"visibilityHandler",null),e}();!function(e){e[e.PanStart=0]="PanStart",e[e.Paning=1]="Paning",e[e.PanEnd=2]="PanEnd"}(Ti||(Ti={}));var Ii=function(){function e(e){var t=this;this.rootStore=e,this.rootPlayer=e.rootPlayer,this.mountedMap=new Map,this.rootPlayer.once(a.t.Player_Disconnect,(function(){t.mountedMap.forEach((function(e){return clearTimeout(e)})),t.mountedMap.clear()}))}return e.prototype.install=function(e){var t=this;Array.isArray(e)&&e.forEach((function(e){if(e){var r=new e(t.rootStore),n=window.setTimeout((function(){r.install(),r.attachEvents(),t.mountedMap.delete(r)}),0);t.mountedMap.set(r,n)}}))},e}(),Ci=r(83898)},83898:function(e,t,r){"use strict";r.d(t,{v:function(){return s}});var n=r(79637),i=r(1835),o=r(25385),a=r(93546),s=function(){function e(e){this.ppx=n.m,this.spx=n.a_,this.cpx=n._j,this.isInstalled=!1,this.rootStorlayer=e.rootPlayer,this.nodes=e.nodes,this.container=this.nodes.container,this.rootPlayer.minorNode.parentElement&&(this.auxiliary=this.rootPlayer.minorNode),this.track=this.rootPlayer.track,this.dp=Object.create(null),this.dc=Object.create(null),e.decomposeSubStores(this),e._rootExtra.decomposeSubExtras(this)}return Object.defineProperty(e.prototype,"log",{get:function(){if(!this._cachedLog){var e=this.rootPlayer.log;this._cachedLog=this.tag?e.getLogger(this.tag):e}return this._cachedLog},enumerable:!1,configurable:!0}),e.prototype.install=function(){0},e.prototype.attachEvents=function(){var e=this;this.rootPlayer.on(o.t.Player_Dispose,(function(){return e.dp=(0,a.Jo)(e.dp)})).once(o.t.Player_Disconnect,(function(){return e.dc=(0,a.Jo)(e.dc)})),this.rootStore.isLoadEnded&&this.userStore.info?this.onLoaded(this.userStore.info):this.rootPlayer.on(i.p.PLAYER_LOADED,(function(t){return e.onLoaded(t)})),this.rootPlayer.on(o.t.Player_Access_Changed,(function(){return e.onQuickLogin()})).on(i.p.PLAYER_UNLOAD,(function(){return e.onUnload()})).on(o.t.Player_Dispose,(function(){return e.onDispose()})).once(o.t.Player_Disconnect,(function(){return e.onDisconnect()}))},e.prototype.onLoaded=function(e){},e.prototype.onQuickLogin=function(){},e.prototype.onUnload=function(){},e.prototype.onDispose=function(){},e.prototype.onDisconnect=function(){},e}()},1326:function(e,t,r){"use strict";r.d(t,{Q:function(){return c},x:function(){return l}});var n=r(15418),i=r(75335),o=r(96607),a=r(73584),s=r(80942),u=r(61273),c=function(){function e(){}return e.getUrl=function(e){var t;return((t={})[s.HR.Ugc]="api.bilibili.com/x/player/wbi/playurl",t[s.HR.Pgc]="api.bilibiger.bilibili.co/v2/playurl",t[s.HR.Pugv]="api.bilibili.com/pugv/player/web/playurl",t[s.HR.Oneself]="member.bilibili.com/x/web/archive/video/playurl",t)[e]},e.getPlayUrlBody=function(e){return e?e.data&&"object"==typeof e.data?e.data:e.result&&"object"==typeof e.result?e.result.video_info:e:e},e.replaceUrlProtocol=function(e){return Array.isArray(e)?e.map((function(e){return e.base_url&&(e.baseUrl=e.base_url.replace(/http:\/\//g,"https://")),Array.isArray(e.backup_url)&&(e.backupUrl=e.backup_url.map((function(e){return e.replace(/http:\/\//g,"https://")}))),e})):e},e.setContentProtection=function(e){return Array.isArray(e)?e.map((function(e){return e&&(e.ContentProtection={schemeIdUri:"urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e",value:"ClearKey1.0"}),e})):e},e.setContentProtectionPSSH=function(e){return Array.isArray(e)?e.map((function(e){return e&&e.widevine_pssh&&(e.ContentProtection={schemeIdUri:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",pssh:{__prefix:"cenc",__text:e.widevine_pssh}}),e})):e},e.normalize=function(e){return e&&(e.quality&&(e.quality=o.n.normalize(e.quality)),Array.isArray(e.acceptQuality)&&(e.acceptQuality=e.acceptQuality.map((function(e){return o.n.normalize(e)})))),e},e}(),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpPlayUrl",t.retried=0,t}return(0,n.ZT)(t,e),Object.defineProperty(t,"reqCacheKey",{get:function(){return"__REQ_INFO__"},enumerable:!1,configurable:!0}),t.getFnVal=function(e){var t=1;return e&&e.mseSupported&&(t=16,e.enableHEVC&&(t=2e3),e.enableAV1&&(t=4048)),t},t.checkPrefetch=function(e,r,n){var i=c.getPlayUrlBody(e),o=e&&e[t.reqCacheKey];if(i&&"object"==typeof i){if(o&&n){if(["qn","fnver","fnval"].some((function(e){return o[e]&&n[e]&&o[e]!==n[e]})))return!1}var a=i.format&&i.format.indexOf("mp4")>-1;return r?!a:a}return!1},t.parse=function(e,t,r){var n={raw:e,error:null,body:null},i=function(e,t){return n.error={code:s,errType:e,message:t||l,srcUrl:r},n};if(!e)return i(1,"Invalid response");var o=(0,u.Z)({},e),s=o.code,l=o.message,d=o.session,f={},p=c.getPlayUrlBody(o);switch(s){case 87005:case-403:return i(1,l||"");case 87007:return i(1,l||"")}if(null!=s&&0!==s)return i(1,"".concat(s,":").concat(l));if(!p)return i(1,"Invalid body");var h=p.accept_quality||[2],y=p.accept_description,m=p.format,g=p.timelength,v=p.drm_tech_type,_=p.durl,E=p.dash?"dash":m&&m.indexOf("mp4")>-1?"mp4":"flv";if(!("dash"===E||Array.isArray(_)&&_.length))return i(1,"Invalid durl");var b=p.quality,S="http";switch(f.type=E,f.duration=0,E){case"dash":if(f.duration=g||0,f.url=p.dash,t.enableSSLStream&&(S="https"),t.enableSSLStream&&f.url)if("string"==typeof f.url)f.url=f.url.replace(/http:\/\//g,"https://");else{var T=f.url;if(T.video=c.replaceUrlProtocol(T.video),T.audio=c.replaceUrlProtocol(T.audio),3===v?(T.video=c.setContentProtection(T.video),T.audio=c.setContentProtection(T.audio)):2===v&&(T.video=c.setContentProtectionPSSH(T.video),T.audio=c.setContentProtectionPSSH(T.audio)),120===b&&a.X.gecko.alike)for(var w=0;w<T.video.length;w++){var A=T.video[w];if(b===A.id&&7===A.codecid){var R=document.createElement("video");R&&R.canPlayType&&R.canPlayType('video/mp4; codecs="'.concat(A.codecs,', mp4a.40.2"'))||(y.splice(0,1),h.splice(0,1),b=h[0],p.quality=h[0]);break}}}break;case"mp4":var P=_&&_[0],D=P&&P.url,O=[];t.enableSSLStream&&"string"==typeof D&&(S="https",D=D.replace(/http:\/\//g,"https://")),Array.isArray(P.backup_url)&&P.backup_url.forEach((function(e){t.enableSSLStream&&"string"==typeof e&&(S="https",e=e.replace(/http:\/\//g,"https://")),O.push(e)})),f.url=D,f.backupURL=O,f.duration=P.length;break;default:f.segmentsisArray(_)&&_.forEach((function(e){var r=e.url,n={},i=[];t.enableSSLStream&&"string"==typeof r&&(S="https",r=r.e=e.size,n.url=r,n.backupURL=i,f.duration+=e.length,f.segments&&f.segments.push(n)}))}var I,C=p.clip_info_list,N=p.is_drm,k=p.abtid,L=p.dm_offset,x=p.is_preview,M=p.last_play_cid,F=p.last_play_time,U=[],B=p.record_info;return B&&Object.values(B).some((function(e){return!!e}))&&(I={record:B.record,recordIcon:B.record_icon}),Array.isArray(p.support_formats)&&p.support_formats.forEach((function(e){U.push({displayDesc:e.display_desc,superscript:e.superscript,needLogin:e.need_login,format:e.format,description:e.description,needVip:e.need_vip,quality:e.quality,newDescription:e.new_description,codecs:e.codecs})})),n.error=null,n.body={format:m,quality:b,timelength:g,streamType:S,acceptQuality:h,acceptDescription:y,mediaDataSource:f,supportFormats:U,clipInfoList:C,isPreview:x,abTestId:k,dmOffset:L,session:d,isDrm:N,drmTechType:v,lastPlayCid:M,lastPlayTime:F,recordInfo:I},n.body=c.normalize(n.body),n},t.prototype.r=function(e,r){return(0,
n.mG)(this,void 0,void 0,(function(){var i;return(0,n.Jh)(this,(function(n){return this.retried=0,this.params=e,this.config=Object.assign({retryCount:3},r,{enableSSLStream:!0,enableSSLResolve:!0}),this.fragmentUrl=c.getUrl(this.config.kind),!this.config.fromPrefetch&&t.checkPrefetch(r.preloadPlayUrl,this.config.mseSupported,this.params)?(i=this.parse(r.preloadPlayUrl,this.config)).error?(this.log.w("prefetch error",i.error.message),[2,this.getRemoteResponse(this.config.retryCount)]):(this.log.i("prefetch succeed"),[2,Promise.resolve({raw:r.preloadPlayUrl,body:i.body,response:null,retries:-1})]):[2,this.getRemoteResponse(this.config.retryCount)]}))}))},t.prototype.getRemoteResponse=function(e,t){var r=this,n=t?"http://".concat(this.fragmentUrl):"//".concat(this.fragmentUrl);return this.request({url:n,params:this.params,withCredentials:!0}).then((function(e){if(r.config.fromPrefetch)return{raw:e.data,body:null,response:e,retries:r.retried};var t=r.parse(e.data,r.config,n);return t.error?(t.error.raw=e.data,t.error.retries=r.retried,r.log.e("parse error",t.error.message),Promise.reject(t.error)):{raw:e.data,body:t.body,response:e,retries:r.retried}}),(function(o){if(i.eV.isCanceled(o))return Promise.reject(o);if(i.eV.isGaiaFailed(o))return Promise.reject(o);if(o)switch(o.code){case 87005:case-403:case 87007:return Promise.reject(o)}return(/^https:/.test(n)||/^\/\//.test(n)&&"https:"===location.protocol)&&(e||"http:"===location.protocol)?(r.retried++,r.log.i("Retry: ".concat(r.retried,"/").concat(r.config.retryCount)),e?r.getRemoteResponse(--e,t):r.getRemoteResponse(0,!0)):Promise.reject({code:0,message:o.response&&o.response.status&&o.response.status.toString()||"",url:n,retries:r.retried})}))},t.prototype.parse=function(e,r,n){return this.isIllegal(e,!0),t.parse(e,r,n)},t}(i.eV)},33044:function(e,t,r){"use strict";r.d(t,{h:function(){return a}});var n=r(15418),i=r(75335),o=r(19062),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpStatsLog",t.url="//data.bilibili.com/log/web",t}return(0,n.ZT)(t,e),t.prototype.sendBeacon=function(e){window.navigator&&"function"==typeof window.navigator.sendBeacon?window.navigator.sendBeacon(this.getSerializedUrl(e)):this.r(e).catch(o.Z)},t.prototype.r=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){return[2,this.request({url:this.getdover,e.sourceType,e.quality,e.realtime,e.srcUrl,e.exParam,e.abVer,e.label].join("|");return"".concat(this.url,"?").concat(e.logId).concat(Date.now()).concat(t)},t}(i.eV)},35538:function(e,t,r){"use strict";r.d(t,{YR:function(){return s},dd:function(){return n},gC:function(){return i}});var n,i,o=r(15418),a=r(75335);!function(e){e[e.Add_Attention=1]="Add_Attention",e[e.Cancel_Attention=2]="Cancel_Attention",e[e.Quiet_Add_Attenyion=3]="Quiet_Add_Attenyion",e[e.Quiet_Cancel_Attention=4]="Quiet_Cancel_Attention",e[e.Add_Block=5]="Add_Block",e[e.Cancel_Block=6]="Cancel_Block",e[e.Delete_Fans=7]="Delete_Fans"}(n||(n={})),function(e){e[e.Player_Top_Follow=164]="Player_Top_Follow",e[e.Player_Ending_Follow=17]="Player_Ending_Follow",e[e.Player_Popup_Follow=245]="Player_Popup_Follow"}(i||(i={}));var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="HttpUpFollow",t.url="//api.bilibili.com/x/relation/modify",t}return(0,o.ZT)(t,e),t.prototype.r=function(e){return(0,o.mG)(this,void 0,void 0,(function(){return(0,o.Jh)(this,(function(t){return[2,this.request({url:this.url,data:e,method:"post",withCredentials:!0}).then((function(e){return{body:e.data,response:e}}))]}))}))},t}(a.eV)},75335:function(e,t,r){"use strict";r.d(t,{eV:function(){return $t}});var n=r(15418),i=r(62344),o=r(55360),a=r(52135),s=r.n(a);var u=r(63653),c=r(60428),l=r.n(c);function d(e){if(e||window.__NanoStaticHttpKey){return"https://i0.hdslb.com/bfs/wbi/".concat("5a6f002d0bb14fc9848fc64157648ad4",".png")}}function f(e){if(e||window.__NanoStaticHttpKey){return"https://i0.hdslb.com/bfs/wbi/".concat("0503a77b29d7409d9548fb44fe9daa1a",".png")}}function p(e,t,r){if(e.web_location=1315873,t=t||d()||(0,u.tv)("wbi_img_url"),r=r||f()||(0,u.tv)("wbi_sub_url"),t&&r||(t=d(!0),r=f(!0)),t&&r){for(var n=function(e){var t=[];return[46,47,18,2,53,8,23,32,15,50,10,31,58,3,45,35,27,43,5,49,33,9,42,19,29,28,14,39,12,38,41,13,37,48,7,16,24,55,40,61,26,17,0,1,60,51,30,4,22,25,54,21,56,59,6,63,57,62,11,36,20,34,44,52].forEach((function(r){e.charAt(r)&&t.push(e.charAt(r))})),t.join("").slice(0,32)}(t.substring(t.lastIndexOf("/")+1,t.length).split(".")[0]+r.substring(r.lastIndexOf("/")+1,r.length).split(".")[0]),i=Math.round(Date.now()/1e3),o=Object.assign({},e,{wts:i}),a=Object.keys(o).sort(),s=[],c=0;c<a.length;c++){var p=a[c],h=o[p];null!=h&&s.push("".concat(encodeURIComponent(p),"=").concat(encodeURIComponent(h)))}var y=s.join("&"),m=l()(y+n);return Object.assign(e,{w_rid:m,wts:i.toString()})}}var h=function(){function e(){}return e.loadScript=function(e,t){return new Promise((function(r,n){var i=t||window;if(i.CaptchaLoader)r();else{var o=i.document.createElement("script");o.onload=function(){r()},o.onerror=function(){n()},ndChild(o)}}))},e.loadValidateSDK=function(t){e.scriptPromise=e.scriptPromise||e.loadScript({url:"https://s1.hdslb.com/bfs/seed/jinkela/risk-captcha-sdk/CaptchaLoader.js"});var r=t.v_voucher;return e.scriptPromise.then((function(){return e.tokenPromise=e.tokenPromise||function(){return(0,n.mG)(this,void 0,void 0,(function(){var e;return(t?{token:t}:{token:""}})).catch((function(t){return e.tokenPromise=null,{token:""}}))},e}(),y=r(19062);function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}function v(e,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},v(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=b(e);if(t){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===m(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return E(e)}(this,r)}}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},b(e)}function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){I(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){
Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(){w=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new N(n||[]);return i(a,"_invoke",{value:D(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",p="suspendedYield",h="executing",y="completed",g={};function v(){}function _(){}function E(){}var b={};c(b,a,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(k([])));T&&T!==r&&n.call(T,a)&&(b=T);var A=E.prototype=v.prototype=Object.create(b);function R(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,t){function r(i,o,a,s){var u=d(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==m(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function D(t,r,n){var i=f;return function(o,a){if(i===h)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=O(s,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=h;var c=d(t,r,n);if("normal"===c.type){if(i=n.done?y:p,c.arg===g)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=y,n.method="throw",n.arg=c.arg)}}}function O(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=d(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function k(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(m(t)+" is not iterable")}return _.prototype=E,i(A,"constructor",{value:E,configurable:!0}),i(E,"constructor",{value:_,configurable:!0}),_.displayName=c(E,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,c(e,u,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},R(P.prototype),c(P.prototype,s,(function(){return this})),t.AsyncIterator=P,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new P(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},R(A),c(A,u,"Generator"),c(A,a,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=k,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:k(t),resultName:r,nextLoc:n},"next"=r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function R(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){A(o,n,i,a,s,"next",e)}function s(e){A(o,n,i,a,s,"throw",e)}a(void 0)}))}}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,C(n.key),n)}}function O(e,t,r){return t&&D(e.prototype,t),r&&D(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function I(e,t,r){return(t=C(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(e){var t=function(e,t){if("object"!==m(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===m(t)?t:String(t)}var N=function(){function e(t){var r,n,i=this;P(this,e),I(this,"whitelist",[]),I(this,"blacklist",[]),I(this,"handler",(function(){return Promise.resolve("Please set a handler for middleware")})),"function"==typeof t?r=t:(this.whitelist=(null==t?void 0:t.whitelist)||[],this.blacklist=(null==t?void 0:t.blacklist)||[],r=null==t?void 0:t.handler,null!=t&&t.payload&&(n=t.payload)),this.handler=function(){var t=R(w().mark((function t(o,a,s){var u
;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!0===(null==s?void 0:s.disabled)){t.next=16;break}if(u=o.config.url,!i.whitelist.length){t.next=9;break}if(i.match(u,i.whitelist)){t.next=7;break}return t.next=6,a();case 6:case 13:case 18:case 21:return t.abrupt("return",t.sent);case 7:t.next=14;break;case 9:if(!i.blacklist.length){t.next=14;break}if(!i.match(u,i.blacklist)){t.next=14;break}return t.next=13,a();case 14:t.next=19;break;case 16:return t.next=18,a();case 19:return t.next=21,(r||i.handler).bind(i)(o,a,e.mergeConfig(s,n));case 22:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}()}return O(e,[{key:"match",value:function(e,t){for(var r=!1,n=0;n<t.length;n++)if(e.indexOf(t[n])>-1){r=!0;break}return r}}]),e}();I(N,"handler",void 0),I(N,"mergeConfig",(function(e,t){return T(T({},e||{}),{},{payload:T(T({},(null==e?void 0:e.payload)||{}),t||{})})}));var k=function(){var e=R(w().mark((function e(t,r,n){var i,o,a,s,u,c,l;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"==typeof window){e.next=4;break}return e.next=3,r();case 3:case 8:return e.abrupt("return",e.sent);case 4:if(i=(null==n?void 0:n.payload)||{},o=i.url,a=i.headers,s=i.com2co,u=i.sign,c=i.internal,t.request){e.next=9;break}return e.next=8,r();case 9:return a&&text/plain, */*"},l),t.request.headers)),c&&u?(t.request.url=t.request.url.replace(".com/x/",".co/x/internal/"),t.request.params=u(uest.st.url.ion(e){g(r,eyload:{sign:ect.prototype.xports:{}};(e,t){retur278255360&F.roion(e){for(varfor(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).tofunction(e){fon t},bytesToBase64:f0;i<4;i++)8*r+ction(e)stringToBytes(unescape(encodeURIComponent(38651)],15,-,f=g(fs[p+1]1744),d=g(d,f,c,l,s[p+6],15,-1560198380),l=51),c=c+v>>>0,l=l+_>>>0,d=d+E>>>0,f=f+b>>>0}return e.endian([c,l,d,f])};i._ff=function(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},i._gg=function(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},i._hh=function(e,t,r,n,i,o,a){van,i,o,a){var s=e+(r^(t|~n))+(i>>>0)+a;return(s<<o|s>>>32-o)+t},i._blocksize=16,i._digestsize=16,U.exports=function(t,r){if(null==t)throw new Error("Illegal argument "+t);var o=e.wordsToBytes(i(t,r));return r&&r.asBytes?o:r&&r.asString?n.bytesToString(o):e.bytesToHex(o)}}();var W=x(U.exports),K=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e.charCodeAe,t){t||(t={});var r,n,i=function(e){var t;if(e.useAssignKey)return{imgKey:e.wbiImgKey,subKey:e.wbiSubKey};var r=(null===(t=function(e){try{return localStorage.getItem(e)}catch(e){return null}}(Y))||void 0===t?void 0:t.split("-"))||[],n=r[0],i=r[1],o=n?z(n):e.wbiImgKey,a=i?z(i):e.wbiSubKey;return{imgKey:o,subKey:a}}(t),o=i.imgKey,a=i.subKey;if(o&&a){for(var s=(r=o+a,n=[],[46,47,18,2,53,8,23,32,15,50,10,31,58,3,45,35,27,43,5,49,33,9,42,19,29,28,14,39,12,38,41,13,37,48,7,16,24,55,40,61,26,17,0,1,60,51,30,4,22,25,54,21,56,59,6,63,57,62,11,36,20,34,44,52].forEach((function(e){r.charAt(e)&&n.push(r.charAt(e))})),
n.join("").slice(0,32)),u=Math.round(Date.now()/1e3),c=Object.assign({},e,{wts:u}),l=Object.keys(c).sort(),d=[],f=/[!'()*]/g,p=0;p<l.length;p++){var h=l[p],y=c[h];y&&"string"==typeof y&&(y=y.replace(f,"")),null!=y&&d.push("".concat(encodeURIComponent(h),"=").concat(encodeURIComponent(y)))}var m=d.join("&");return{w_rid:W(m+s),wts:u.toString()}}return null}function z(e){return e.substring(e.lastIndexOf("/")+1,e.length).split(".")[0]}var Z="d569546b86c252:db:9bc7e99c5d71e5",J="557251g796:g54:f:ee94g8fg969e2de",X=function(){var e=R(w().mark((function e(t,r,n){var i,o,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof window){e.next=4;break}return e.next=3,r();case 3:case 7:case 13:return e.abrupt("return",e.sent);case 4:if(t.request){e.next=8;break}returns)}}(),$=function(e){g(r,e);var t=_(r);function r(){var e;P(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return I(E(e=t.call.apply(t,[this].concat(i))),"handler",X),I(E(e),"name","WBI_ENCODE"),e}return O(r)}(N);function ee(e){return function(e){if(Array.isArray(e))return Ee(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_e(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,he(n.key),n)}}function re(e,t,r){return t&&te(e.prototype,t),r&&te(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oe(e,t)}function oe(e,t){return oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},oe(e,t)}function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ce(e);if(t){var i=ce(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return se(this,r)}}function se(e,t){if(t&&("object"===be(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ue(e)}function ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ce(e){return ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ce(e)}function le(){le=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),s=new I(n||[]);return i(a,"_invoke",{value:R(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",p="suspendedYield",h="executing",y="completed",m={};function g(){}function v(){}function _(){}var E={};c(E,a,(function(){return this}));var b=Object.getPrototypeOf,S=b&&b(b(C([])));S&&S!==r&&n.call(S,a)&&(E=S);var T=_.prototype=g.prototype=Object.create(E);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(i,o,a,s){var u=d(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==be(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function R(t,r,n){var i=f;return function(o,a){if(i===h)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=P(s,n);if(u){if(u===m)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=h;var c=d(t,r,n);if("normal"===c.type){if(i=n.done?y:p,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=y,n.method="throw",n.arg=c.arg)}}}function P(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,P(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var o=d(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,m;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(be(t)+" is not iterable")}return v.prototype=_,i(T,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:v,configurable:!0}),v.displayName=c(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,c(e,u,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},w(A.prototype),c(A.prototype,s,(function(){return this})),t.AsyncIterator=A,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new A(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(T),c(T,u,"Generator"),c(T,a,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg
;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;O(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){pe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function pe(e,t,r){return(t=he(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function he(e){var t=function(e,t){i);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||_e(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _e(e,t){if(e){if("string"==typeof e)return Ee(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ee(e,t):void 0}}function Ee(e,t){(null==t||t>e.lengt);r<t;r++)n[r]=e[r];return n}funcructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},be(e)}I($,"handler",X);var Se=function(e){return"BUILT_IN_".concat(e)},Te=function(e,t){var r,n=new Error(t||"Request Error.status)||"unknow status"));return n.config=e.request,e.response&&(n.response=e.response,e.response.ok||(n.code=e.response.status)),n},we=function(e){return!(!e.name||!e.handler)},Ae="undefined"==typeof window,Re=function(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")},Pe=function(e,t){var r=[];Object.keys(t).forEach((function(e){var n=t[e];null!=n&&(!function(e){return"[object Array]"===toString.call(e)}(n)?n=[n]:e+="[]",n.forEach((function(t){!function(e){return"[object Date]"===toString.call(e)}(t)?function(e){return null!==e&&"object"===be(e)}(t)&&(t=JSON.stringify(t)):t=t.toString(),r.push(Re(e)+"="+Re(t))})))}));var n=r.join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e},De=function(e){var t=ve(e.split("?"),2),r=t[0],n=t[1];if(n){var i=new URLSearchParams(n);if(i.size){var o,a={},s=ge(i.entries());try{for(s.s();!(o=s.n()).done;){var u=ve(o.value,2),c=u[0],l=u[1];a[c]=l}}catch(e){s.e(e)}finally{s.f()}return{url:r,params:a}}}return{url:e}},Oe=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e.charCodeAt(r)-1);return t},Ie=function(){var e=me(le().mark((function e(t,r){var n,i,o,a,s,u,c,l,d,f,p,h,y,m,g,v,_,E;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.request){e.next=2;break}return e.abrupt("return",r());case 2:if(n=t.config,i=n.baseURL,o=n.url,a=n.headers,s=n.params,u=n.data,c=n.credentials,l=void 0===c?"include":c,d=t.request.method,f=De(o),p=f.url,(h=f.params)?(t.request.url=p,t.request.params=fe(fe({},h),s||{})):(t.request.url=o,t.request.params=fe({},s||{})),i&&!1===/^(https?:)?\/\//.test(o)&&(t.request.url="".concat(i).concat(o)),t.request.headers=fe({},a||{}),"POST"===d&&u)if("object"===be(u))if("undefined"!=typeof FormData&&u instanceof FormData){y=new FormData,m=ge(u.entries());try{for(m.s();!(g=m.n()).done;)v=ve(g.value,2),_=v[0],E=v[1],y.append(_,E)}catch(e){m.e(e)}finally{m.f()}t.request.data=y}else Object.keys(u)&&(t.request.data=JSON.parse(JSON.stringify(u)));else t.request.data=u;return t.request.credentials=l,e.next=12,r();case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.sto e.apply(this,arguments)}}(),Ce=function(e){ie(r,e);var t=ae(r);function r(){var e;ne(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return pe(ue(e=t.call.apply(t,[this].concat(i))),"handler",Ie),pe(ue(e),"name",Se("INIT_CTX")),e}return re(r)}(N);pe(Ce,"handler",Ie);var Ne="__butils_cache",ke="$butils_styles",Le="$butils_scripts",xe=/^(https?:)?(\/\/)?(((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)|([0-9a-z_!~*'()-]+\.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.[a-z]{2,6})(:[0-9]{1-6})?([-0-9a-zA-Z+&@#/%=~_|?!:,.;]*)?$/;function Me(e){return"string"==typeof e}function Fe(e,t){var r="number"==typeof e
;retur&Number.isFinite(e)}function Ue(e,t){t||(t={});for(var r=!1===t.decode,n=t.template||document.cookie,i={},o=(r?n:decodeURIComponent(n)).split(";"),a=!0===e,s=0;s<o.length;s++){for(var u=o[s];" "===u.charAt(0);)u=u.substring(1);var c=u.split("="),l=c[0],d=c[1];if(i[l]=d,e===l)return i[e]}return a?i:""}function Be(e,t,r){return new Promise((function(n){t=!1!==t;var i=r?ke:Le,o=function(e){var t=window[Ne]||{};return t.hasOwnProperty(e)?t[e]:null}(i)||[];if(!t&&o.indexOf(e)>-1)return n(!0);var a=document.querySelector("#".concat(e));return a&&a.parentNode.removeChild(a),(o=o.filter((function(t){return t!==e}))).push(e),function(e,t){if(!e||!Me(e))return null;var r=window[Ne]||{};window[Ne]=r,r[e]=t}(i,o),n(!1)}))}function je(e,t){return new Promise((function(r,n){if(i=e,!xe.test(i))return n(new Error("srcurl"));var i,o="bs_url_".concat(function(e){var t=0,r=-1;if(0===e.length)return t;for(;++r<e.length;)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}(e));Be(o,t,!1).then((function(t){if(t)return r();var n=document.createElement("script");n.id=o,n.type="text/JavaScript",n.src=e,n.onload=function(){return r()},n.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||r()},document.querySelector("head").appendChild(n)}))})).then()}var Ve=function(){var e=me(le().mark((function e(t,r){var n,i;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.config.timeout,Fe(t.config.timeout)||(n=Ae?350:1e4),t.abortController||!n){e.next=11;break}return i=new AbortController,t.abortController=i,t.timeoutId=setTimeout((function(){i.abort()}),n),e.next=8,r();case 8:clearTimeout(t.timeoutId),e.next=13;break;case 11:return e.next=13,r();case 13:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),He=function(e){ie(r,e);var t=ae(r);function r(){var e;return ne(this,r),pe(ue(e=t.call(this,Ve)),"name",Se("TIMEOUT")),e}return re(r)}(N);pe(He,"handler",Ve);var Ge=function(){var e=me(le().mark((function e(t,r,n){var i,o,a,s,u,c,l,d,f,p;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.request){e.next=2;break}return e.abrupt("return",r());case 2:return a=t.request,s=a.method,u=a.data,c=a.headers,l="",d=function(){try{l=Ue("bili_jct",Ae?{template:(null==c?void 0:c.cookie)||(null==c?void 0:c.Cookie)||"_",decode:!1}:{decode:!1})}catch(e){Ae||console.warn(e)}},f=(null==n||null===(i=n.payload)||void 0===i?void 0:i.key)||"csrf",!0===(null==n||null===(o=n.payload)||void 0===o?void 0:o.pa.params[f]=l:t.request.params=pe({},f,l))),"POST"===s&&!1!==(null==n||null===(p=n.payload)||void 0===p?void 0:p.data)&&(d(),u&&(u instanceof FormData?u.append(f,l):u[f]=l)),e.next=10,r();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),qe=function(e){ie(r,e);var t=ae(r);function r(){var e;return ne(this,r),pe(ue(e=t.call(this,Ge)),"name",Se("CSRF")),e}return re(r)}(N);pe(qe,"handler",Ge);var We="content-type",Ke=function(e){return(null==e?void 0:e[We])||(null==e?void 0:e["Content-Type"])},Ye=function(e,t){return!!t&&t.indexOf(e)>-1},Qe=function(e,t,r){e.request&&(e.request.data=JSON.stringify(t),e.request.headers?r||(e.request.headers[We]="application/json"):e.request.headers=pe({},We,"application/json"))},ze=function(){var e=me(le().mark((function e(t,r,n){var i,o,a,s,u,c,l,d;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.request){e.next=2;break}retrequest,o=i.method,a=i.params,s=i.headers,t.request.url=Pe(t.request.url,a||{}),"POST"!==o){e.next=17;break}if("[object Object]"!==Object.prototype.toString.call(t.request.data)){e.next=17;break}if(c=Ke(s),l=t.request.data,null==n||null===(u=n.payload)||void 0===u||!u.stringify){e.next=14;break}return Qe(t,l,c),e.next=13,r();case 13:return e.abrupt("return",e.sent);case 14:Ye("application/x-www-form-urlencoded",c)&&(t.request.data=Pe("",l).slice(1)),Ye("application/json",c||"application/json")&&Qe(t,l,c),Ye("multipart/form-data",c)&&(d=Object.keys(l)).length&&(t.request.data=d.reduce((function(e,t){return e.append(t,l[t]),e}),new FormData));case 17:return e.next=19,r();case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Ze=function(e){ie(r,e);var t=ae(r);function r(){var e;ne(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return pe(ue(e=t.call.apply(t,[this].concat(i))),"handler",ze),pe(ue(e),"name",Se("BODY")),e}return re(r)}(N);pe(Ze,"handler",ze);var Je=function(){var e=me(le().mark((function e(t,r){var n,i,o,a,s,u,c;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ae){e.next=2;break}throw new Error("When you are in a Node environment, please use server-side fetch middleware.");case 2:if(window.fetch){e.next=4;break}throw new Error("When you are in a non-modern browser, please manually polyfill fetch.");case 4:if(t.request){e.next=8;break}return e.next=7,r();case 7:case 11:case 19:return e.abrupt("return",e.sent);case 8:if(!t.response){e.next=12;break}return e.next=11,r();case 12:return i=t.request,o=i.url,a=i.method,s=i.headers,u=i.credentials,c=t.request.data,e.next=16,window.fetch(o,{method:a,body:c,headers:s,credentials:u,signal:null===(n=t.abortController)||void 0===n?void 0:n.signal});case 16:return t.response=e.sent,e.next=19,r();case 20:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Xe=function(e){ie(r,e);var t=ae(r);function r(){var e;ne(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return pe(ue(e=t.call.apply(t,[this].concat(i))),"handler",Je),pe(ue(e),"name",Se("FETCH")),e}return re(r)}(N);pe(Xe,"handler",Je);var $e=function(){var e=me(le().mark((function e(t,r,n){var i,o,a;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r();case 2:if(null===(i=t.response)||von||null===(o=n.payload)||void 0===o?void 0:o.type)||"json",e.next=8,t.response[a]();case 8:t.response.data=e.sent,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.warn(e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t,r,n){return e.apply(this,arguments)}}(),et=function(e){ie(r,e);var t=ae(r);function r(){var e;return ne(this,r),pe(ue(e=t.call(this,$e)),"name",Se("RES_DATA")),e}return re(r)}(N);pe(et,"handler",$e);var tt=function(){var e=me(le().mark((function e(t,r){return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r();case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),rt=function(e){ie(r,e);var t=ae(r);function r(e,n){var i;return ne(this,r),pe(ue(i=t.call(this)),"name",Se("SPRAY")),i.handler=function(){var t=me(le().mark((function t(r,i){return le().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(r,i,{payload:n});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),i}return re(r)}(N);pe(rt,"handler",tt);var nt=function(){var e=me(le().mark((function e(t,r,n){var i,o,a,s,u,c,l,d;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null===(i=t.request)||void 0===i?void 0:i.function,a=(null==n?void 0:n.payload)||{times:0},s=a.times,u=a.condition,c=a.onRetry,l=function(){var e=me(le().mark((function e(r){var i,a;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}throw Te(t,"Missing request function");case 2:if(s&&t.retry!==s||null!=n&&null!==(i=n.payload)&&void 0!==i&&i.runtimeShortCircuit){e.next=4;break}throw Te(t);case 4:if(t.retry=t.retry?t.retry+1:1,e.prev=5,!c){e.next=11;break}return e.next=9,c(t.config,r);case 9:(a=e.sent)&&(t.config=a);case 11:return t.response&&delete t.response,e.next=14,o(t);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(5),Te(t,e.t0.message)
;case 19:case"end":return e.stop()}}),e,null,[[5,16]])})));return function(t){return e.apply(this,arguments)}}(),e.prev=3,e.next=6,r();case 6:e.next=14;break;case 8:if(e.prev=8,e.t0=e.catch(3),s&&t.retry!==s){e.next=12;break}throw Te(t,null===e.t0||void 0===e.t0?void 0:e.t0.message);case 12:return e.next=14,l();case 14:if(!u){e.next=23;break}return e.next=17,u(t.response);case 17:if(!(d=e.sent)){e.next=21;break}return e.next=21,l(d);case 21:e.next=26;break;case 23:if(t.response&&t.response.ok){e.next=26;break}return e.next=26,l();case 26:case"end":return e.stop()}}),e,null,[[3,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),it=function(e){ie(r,e);var t=ae(r);function r(){var e;ne(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return pe(ue(e=t.call.apply(t,[this].concat(i))),"name",Se("RETRY")),pe(ue(e),"handler",nt),e}return re(r)}(N);pe(it,"handler",nt);var ot=!1,at="bili_ticket",st="bili_ticket_expires",ut="wbi_img_urls",ct=function(){var e=me(le().mark((function e(t){var r,n,i,o,a,s,u;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Ue(at,{decode:!1}),i="",o="",null!==(r=window)&&void 0!==r&&r.UNIFY_HTTP_WBI_CONFIG?(a=ve(window.UNIFY_HTTP_WBI_CONFIG,2),i=a[0],o=a[1]):(s=(localStorage.getItem(ut)||"").split("-"),u=ve(s,2),i=u[0],o=u[1]),!lt()&&n&&i&&o){e.next=9;break}if(!ot){e.next=8;break}return e.abrupt("return");case 8:t.useAsyncRequest(function(){var e=me(le().mark((function e(t){var r,n,i,o;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ot=!0,e.next=4,pt();case 4:return i=e.sent,e.next=7,t({url:i,method:"POST",credentials:"include"});case 7:0===(null==(o=e.sent)?void 0:o.code)&&null!==(r=o.data)&&void 0!==r&&r.ticket&&null!==(n=o.data)&&void 0!==n&&n.nav&&ft(o.data);case 9:return e.prev=9,ot=!1,e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[0,,9,12]])})));return function(t){return e.apply(this,arguments)}}());case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lt=function(){var e=Ue(st,{decode:!1}),t=(new Date).getTime();return 1e3*e-t<=18e5||1e3*e<t},dt=function(e,t,r){!function(e,t,r){var n="",i=0;if(!1!==(r=r||{}).encode&&(t=encodeURIComponent(t)),Fe(r.exMinuts)&&(i+=6e4*r.exMinuts),Fe(r.exDays)&&(i+=864e5*r.exDays),i){var o=new Date;o.setTime(o.getTime()+i),n=";expires=".concat(o.toUTCString())}var a=Me(r.domain)?";domain=".concat(r.domain):"";document.cookie="".concat(e,"=").concat(t).concat(n,";path=/").concat(a)}(e,t,{domain:".bilibili.com",exMinuts:r/60})},ft=function(e){var t=e.ticket,r=e.nav,n=e.ttl,i=e.created_at;dt(at,t,n),dt(st,i+n,n),window.UNIFY_HTTP_WBI_CONFIG="".concat(r.img,"-").concat(r.sub),localStorage.setItem(ut,"".concat(r.img,"-").concat(r.sub))},pt=function(){var e=me(le().mark((function e(){var t,r,n,i,o;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Math.floor((new Date).getTime()/1e3),r="YhxToH[2q",e.next=4,je("//s1.hdslb.com/bfs/static/jinkela/long/unify-http-request/forticket.min.js");case 4:if(window.CryptoJS){e.next=6;break}throw new Error("CryptoJS is not found");case 6:if(window.CryptoJS.HmacSHA256){e.next=8;break}throw new Error("CryptoJS.HmacSHA256 is not found");case 8:if(window.CryptoJS.enc){e.next=10;break}throw new Error("CryptoJS.enc is not found");case 10:return n=window.CryptoJS.HmacSHA256("ts".concat(t),Oe(r)),i=window.CryptoJS.enc.Hex.stringify(n),e.next=14,Pe("//api.bilibili.com/bapis/bilibili.api.ticket.v1.Ticket/GenWebTicket",{key_id:"ec02",hexsign:i,"context[ts]":t,csrf:Ue("bili_jct",{decode:!1})});case 14:return o=e.sent,e.abrupt("return",o);case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,k((function e(t,r){var n,i,o,a;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof window){e.next=4;break}return e.next=3,r();case 3:return e.abrupt("return",e.sent);case 4:t.request&&(n=t.request,i=n.method,null!=(o=n.params)&&o.web_location||"GET"!==i||(t.request.params=fe(fe({},t.request.params||{}),{},{web_location:(null===(a=document.getElementsByTagName("meta").spm_prefix)||void 0===a?void 0:a.content)||"0.0"})));try{ct(t)}catch(e){console.log("[updateTicketAndWbi]",e)}return e.next=8,r();case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),yt=function(e){ie(r,e);var t=ae(r);function r(){var e;return ne(this,r),pe(ue(e=t.call(this,ht)),"name",Se("TICKET_WBI")),e}return re(r)}(N);pe(yt,"handler",ht);var mt=function(e,t){return Object.keys(t).sort().reduce((function(e,r){return e+="_".concat(r,":").concat(t[r])}),"api:".concat(e))},gt=function(){var e=me(le().mark((function e(t,r,n){var i,o,a,s,u,c;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.request&&"GET"===t.request.method){e.next=4;break}return e.next=3,r();case 3:return e.abrupt("return",e.sent);case 4:if(null!=n&&n.payload){e.next=8;break}return e.next=7,r();case 7:return e.abrupt("return",e.sent);case 8:if(i=n.payload,o=i.store,a=i.extra,(s=n.payload.key)&&o){e.next=14;break}return e.next=13,r();case 13:return e.abrupt("return"s=mt(t.request.url,s)),!(u=o.get(s,a))){e.next=22;break}return t.response=new Response(JSON.stringify(u),{status:200,statusText:"Cache:".concat(s)}),e.next=20,r();case 20:e.next=25;break;case 22:return e.next=24,r();ca&c.data&ase"end":return e.stop()}}),e)})));return function(t,r,n)uments)}}(),vt=function(e){ie(r,e);var t=ae(r);function r(e){var n;return ne(this,r),pe(ue(n=t.caore:e}})),"name",Se("CACHE")),n}return re(r)}(N);pe(vt,"handler",gt);var _t=re((function e(t){ne(this,e),this.httpSvc=t})),Et=function(e){ie(r,e);var t=ae(r);function r(){return ne(this,r),t.apply(this,arguments)}return re(r,[{key:"provide",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={inject:function(n,i){return e.inject(t,n,i),r},disable:function(n){return e.disable(t,n),r},get:function(){return t}};return r}},{key:"inject",value:function(e,t,r){e[t]=r}},{key:"disable",value:function(e,t){e[t]=fe(fe({},e[t]||{}),{},{disabled:!0})}},{key:"get",value:function(e,t){return e[t]||{}}}]),r}(_t),bt={INIT_CTX:Se("INIT_CTX"),TIMEOUT:Se("TIMEOUT"),BODY:Se("BODY"),CSRF:Se("CSRF"),FETCH:Se("FETCH"),RETRY:Se("RETRY"),SPRAY:Se("SPRAY"),RES_DATA:Se("RES_DATA"),RES_EXTRACT:Se("RES_EXTRACT"),TICKET_WBI:Se("TICKET_WBI"),LOG:Se("LOG"),CACHE:Se("CACHE")},Sts",[]),pe(this,"middlewareConfigCtxProvider",void 0),this.control=t,this.middlewareConfigCtxProvider=this.control.httpSvc.configCtrl.provide()}return re(e,[{key:"with",value:function(e,t){return e?("string"==typeof wares.push(e),t&&this.inject(e.name,t)),thder.inject(e,{payload:t}),this}},{key:"disable",value:function(e){return this.middlewareConfigCtxProvider.disable(e),this}},{key:"request",value:function(e){var t=this.control.compose(this.middlewares);return this.control.httpSvc.requestCtrl.request(e,thit(),t)}}]),e}(),wt=fun e;ne(this,r);for(vo++)i[o]=arguments[o];return pe(ue(e=t.call.apply(t,[this].concat(i))),"middlewares",[]),e}return re(r,[{key:"alreadyExistsIdx",value:function(e){return this.middlewares.findIndex((function(t){return t.name===e}))}},{key:"register",value:function(e){var t=this;if(Array.isArray(e)){var r=!1;e.forEach((function(e){if(we(e)){r=!0;var n=t.alreadyExistsIdx(e.name);n>-1?t.middlewares[n]=e:t.middlewares.push(e)}})),r&&this.httpSvc.requestCtrl.reset()}}},{key:"setup",value:function(){return new Tt(this)}},{key:"disable",value:function(e){
return this.setup().disable(e)}},{key:"with",value:function(e,t){return this.setup().with(e,t)}},{key:"compose",value:function(e){var t,r=this,n=[],i=(pe(t={},bt.RETRY,null),pe(t,bt.BODY,null),pe(t,bt.RES_DATA,null),t),o=Object.keys(i),a={};[].concat(ee(e||[]),ee(this.middlewares)).forEach((function(e){if(we(e)){var t=e.name;if(o.includes(t))i[t]||(i[t]=e);else if(t.startsWith(St)){if(t=t.substring(7),!a[t]){var s=r.middlewares.findIndex((function(e){return e.name===t}));if(s>-1){var u=r.middlewares[s];a[t]=u,n.push(u)}}}else a[t]||(a[t]=e,n.push(e))}}));var s=[i[bt.RETRY]||new it,new Ce].concat(n,[i[bt.RES_DATA]||new et,i[bt.BODY]||new Ze,new He,this.httpSvc.fetch]);return function(){var e=me(le().mark((function e(t){var n,i,o,a,u,c,l;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(){return(l=me(le().mark((function e(r){var n;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r!==s.length){e.next=2;break}return e.abrupt("return");case 2:if(!(r<=i)){e.next=4;break}throw Te(t,"The next() called multiple times");case 4:if(n=s[i=r]){e.next=8;break}throw Te(t,"Middleware is not exist");case 8:return e.next=10,n.handler(t,c.bind(null,r+1),o.get(t.middleware,n.name));case").payload,e.next=7,c(0);case 7:if(!a){e.next=9;break}return e.abrupt("return",t);case 9:if(o.get(t.middleware,bt.RES_EXTRACT).disabled||null===(n=t.response)||void 0===n||!n.ok){e.next=12;break}return e.abrupt("return",(null===(u=t.response)||void 0===u?void 0:u.data)||null);case 12:return e.abrupt("return",t.response);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}]),r}(_t),At=function(e){ie(n,e);var t,r=ae(n);function n(){var =0;o<t;o++)i[o]=argu.call.apply(r,[this].concat(i))),"fn",null),e}return re(n,[{key:"request",value:(t=me(le().mark((function e(t){var r,n,i=arguments;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},(n=i.length>2?i[2]:void 0)||this.fn||this.generateRequestFunction(),n||(n=this.fn),e.next=6,n(this.createContext(t,r,n));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"generateRequestFunction",value:function(){this.fn=this.httpSvc.assembleCtrl.compose()}},{key:"reset",value:function(){this.fn=null}},{key:"useAsyncRequest",get:function(){var e=this;return function(t,r){var n=e.httpSvc.create(r);t(n.request.bind(n))}}},{key:"createContext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=e.url,i=e.method;return{config:fe({baseURL:this.httpSvc.baseURL},e),useAsyncRequest:this.useAsyncRequest,middleware:t,request:{url:n,method:(i||"get").toUpperCase(),function:r}}}}]),n}(_t),Rt=function(){function e(t){if(ne(this,e),pe(this,"fetch",void 0),pe(this,"assembleCtrl",new wt(tequestCtrl",new At(this)),pe(this,"baseURL","//api.domain.com"),t)if(Array.isArray(t))this.fetch=new Xe,this.register(t);else{var r=t.middlewares,n=t.fetch,i=t.baseURL;this.fetch=n||new Xe,this.register(r||[]),i&&(this.baseURL=i)}else this.fetch=new Xe,this.register([])}return re(e,[{key:"regieCtrl.register(e)}},{key:"request",value:function(e){return this.requestCtrl.request(e)}},{key:"disable",value:function(e){return this.assembleCtrl.disable(e)}},{key:"with",value:function(e,t){return this.assembleCtnction(){}))),!0}catch(e){return!1}}();return function(){var r,n=Nt(e);if(t){var i=Nt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===kt(t)||"function"==ries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;O(r)}return i}("illegal egate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function Bt(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function jt(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Bt(o,n,i,a,s,"next",e)}function s(e){Bt(o,n,i,a,s,"throw",e)}a(void 0)}))}}var Vt="undefined"==typeof window,Ht=f){var n=document.createElement("script");n.src=e,n.onload=function(){t()},n.onerror=function(){r(new Error("Failed to load script: ".concat(e)))},document.body.appendChild(n)}))},Gt="RISK_CAPTCHA",qt=function(){var e=jt(Ut().mark((function e(){var t;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=window.CaptchaLoader)){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,Ht("//s1.hdslb.com/bfs/seed/jinkela/risk-captcha-sdk/CaptchaLoader.js");case 5:return e.abrupt("return",t=window.CaptchaLoader);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Wt=function(e,t){var r;return(null===(r=e.middleware[t])||void 0===r?void 0:r.payload)||{}},Kt=function(){var e=jt(Ut().mark((function e(t){var r,n,i;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,qt();case 3:return r=e.sent,e.next=6,r.load();case 6:return n=e.sent,e.next=9,n(t);case 9:if(!(i=e.sent)){e.next=12;break}return e.abrupt("return",i);case 12:return e.abrupt("return",Promise.reject(new Error("verify captcha error: no token")));case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}(),Yt=function(e,t){return function(){var r=jt(Ut().mark((function r(n){var i,o,a,s,u,c,l,d,f,p,h,y;return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!Vt){r.next=2;break}return r.abrupt("return",!1);case 2:if(r.prev=2,i={},o=n.data||{},-352!==(a=o.code)){r.next=14;break}if(s={},(u=n.headers.get("x-bili-gaia-vvoucher"))?s.v_voucher=u:Object.assign(s,(null===(c=n.data)||void 0===c?void 0:c.data)||{}),0!==Object.keys(s).length){r.next=11;break}return r.abrupt("return",!1);case 11:i.riskParams=s,r.next=26;break;case 14:if(-401!==a){r.next=20;break}if(null&&void 0!==d&&d.ga_data){r.next=17;break}return r.abrupt("return",!1);case 17:i=null===(f=n.data)||void 0===f||null===(p=f.data)||void 0===p?void 0:p.ga_data,r.next=26;break;case 20:if(e){r.next=22;break}return r.abrupt("return",!1);case 22:if(h=e(n.data)){r.next=25;break}return r.abrupt("return",!1);case 25:i=h;case 26:return r.next=28,Kt(xt(xt({},i),{},{fromSpmid:t}));case 28:return y=r.sent,r.abrupt("return",{event:Gt,data:y});case 32:r.prev=32,r.t0=r.catch(2),console.warn(r.t0);case 35:return r.abrupt("return",!1);case 36:case"end":return r.stop()}}),r,null,[[2,32]])})));return function(e){return r.apply(this,arguments)}}()},Qt=function(){var e=jt(Ut().mark((function e(t,r,n){
var i,o,a,s,u,c,l,d,f;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(null==n?void 0:n.payload)||{},o=i.getToken,a=i.getCaptchaOptionsFromData,s=i.fromSpmid,u=i.inApp,c=i.times,l=i.condition,d=i.onRetry,f={times:c||0,condition:function(e){return jt(Ut().mark((function r(){var n;return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,t.retry){r.next=8;break}return r.next=4,Yt(a,s)(e);case 4:if(!(n=r.sent)){r.next=8;break}return f.times||(f.runtimeShortCircuit=!0),r.abrupt("return",n);case 8:if(!l){r.next=12;break}return r.next=11,l(e);case 11:return r.abrupt("return",r.sent);case 12:return r.abrupt("return",!1);case 15:return r.prev=15,r.t0=r.catch(0),r.abrupt("return",!1);case 18:case"end":return r.stop()}}),r,null,[[0,15]])})))()},onRetry:function(e,r){return jt(Ut().mark((function n(){var i,a,s;return Ut().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("object"!==kt(r)||(null==r?void 0:r.event)!==Gt){n.next=9;break}return delete f.runtimeShortCircuit,i=r.data,n.next=5,null==o?voi.data&&(-401===(a=tn.abrupt("return",e);case 9:if(!d){n.next=13;break}return n.next=12,d(e,r);case 12:return n.abrupt("return",n.sent);case 13:return n.abrupt("return",e);case 14:case"end":return n.stop()}}),n)})))()}},e.next=4,it.handler(t,r,{payload:f});case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),zt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ot(e,t)}(o,e);var t,r,n,i=It(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),Mt(Ct(t=i.call(this,{handler:Qt,payload:e})),"name",bt.RETRY),t}return t=o,r&&Dt(t.prototype,r),,{writable:!1}),t}(N);Mt(zt,"handler",Qt);var Zt=function(e,t,r){return(0,n.mG)(void 0,void 0,void 0,(function(){var o,a,s,u,c,l,d,f,p,h,y,m;return(0,n.Jh)(this,(function(g){switch(g.label){case 0:o=e.request,a=o.url,s=o.method,u=o.headers,c=o.params,g.label=1;case 1:return g.trys.push([1,3,,4]),l=(0,n.CR)(a.split("?"),,r.payload.config)),f=Object.assign(f,{url:d,method:s,headers:u,params:c}),[4,(0,i.Z)(f)];case 2:return p=g.sent(),h=new Headers,Object.keys(p.headers).forEach((function(e){var t=p.headers[e];h.append(e,t)})),e.response={ok:!0,url:a,status:p.status,headers:h,statusText:p.statusText,data:p.data,config:f},e.response.data&&(e.response.data.__Raw__=p,e.response.data.__IsUnified__=!0),[3,4];case 3:return y=g.sent(),console.warn("Custom fetch error:",y),[3,4];case 4:return[4,t()];case 5:return[2,g.sent()]}}))}))},Jt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handler=Zt,t.name="AXIOS_REQUEST",t}return(0,n.ZT)(t,e),t.handler=Zt,t}(N),Xt=function(){function e(){}return e.set=function(t,r,n){n&&t&&"object"==typeof t&&e.rsCache.set(t,r)},e.get=function(t){if(t&&"object"==typeof t)return e.rsCache.get(t)},e.rsCache=new WeakMap,e}(),$t=function(){function e(e,t){this.httpCacheSeconds=900,this.httpCacheInvalidParams=["w_rid","wts","gaia_source","gaia_vtoken"],this.baseParam=e,this.httpCaches=e.httpCachcelToken.source(),e.httpCacheSeconds>0&&(this.httpCacheSeconds=Math.ceil(e.httpCacheSeconds)),e.httpRequests&&!this.baseConfig.noStore&&e.httpRequests.add(this)}return Object.defineProperty(e.prototype,"log",{get:function(){if(!this._cachedLog){var e=this.baseParam.log;this._cachedLog=this.tag?e.getLogger(this.tag):e}return this._cachedLog},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"persistent",{get:function(){return this.baseConfig.persistent},enumerable:!1,configurable:!0}),e.isCanceled=function(e){return i.Z.isCancel(e)},e.isGaiaFailed=function(t){return(null==t?void 0:t.message)===e.GAIA_RISK_HIT},e.prototype.request=function(t,r){var n=this,a=Object.assign({cancelToken:this.cancelSource.token},t),s=(0,o.qx)(i.Z.create().getUri(a),this.httpCacheInvalidParams),u=!a.method||/^GET$/i.test(a.method);if(u&&this.baseConfig.memCache){var c=this.getHttpCache(s);if(c)return this.log.i("[hit]",s),c}!this.baseConfig.noStore&&this.log.i("request start",s);var l=this.generateRequest(a,r).then((function(t){var r;if((null==(t=(null==t?void 0:t.__Raw__)||t)?void 0:t.__IsUnified__)&&-352===(null===(r=t.data)||void 0===r?void 0:r.code))throw new Error(e.GAIA_RISK_HIT);if(!n.baseConfig.noStore&&n.log.i("request done",t.status,t.statusText,t.config.url),Xt.set(t.data,s,u),n.isIllegal(t.data,!0,s)){var i=new Error("response.data is invalid");throw i.response=t,i.config=t.config,i.request=t.request,i.isAxiosError=!1,i.toJSON=function(){return t},i}return t})).catch((function(t){var r,o,a;if(!n.baseConfig.noStore&&t&&n.log.w("request fail",null===(r=t.response)||void 0===r?void 0:r.status,null===(o=t.response)||void 0===o?void 0:o.statusText,null===(a=t.config)||void 0===a?void 0:a.url,t.code,t.message),n.delHttpCache(s),t&&!n.baseConfig.throwLifecycle){if(i.Z.isCancel(t))return e.PENDING_PROMISE;if(t.message===e.LIFECYCLE_TOKEN)return e.PENDING_PROMISE}return Promise.reject(t)}));return this.setHttpCache(s,l,u),l},e.prototype.generateRequest=function(e,t){if(null==e?void 0:e.url.includes("wbi/view/detail")){var r=new Pt({fetch:new Jt});e.params?e.params.web_location=1315873:e.params={web_location:1315873};var n={},i=this.getStaticImgUrlKey(),o=this.getStaticSubUrlKey();return o&&i&&(n={encWbiKeys:{useAssignKey:!0,wbiImgKey:i,wbiSubKey:o}}),r.with("AXIOS_REQUEST",{config:e}).with(new $,n).with(new zt).request({url:e.url,params:e.params,method:e.method,headers:e.headers})}return this.getGaiaRisk(e,t)},e.prototype.getGaiaRisk=function(t,r){var o,a=this,u={};if(t.url.includes("/wbi/")||(null==r?void 0:r.wbi)){t.params=t.params||{};var c=(o=function(e){if(e.includes("?")){var t=e.split("?"),r=t[0],n=t[1];return{pureUrl:r,queryParams:s().parse(n,{ignoreQueryPrefix:!0})}}return{pureUrl:e,queryParams:{}}}(t.url)).pureUrl,l=o.queryParams;t.url=c,Object.assign(t.params,l),Object.assign(u,t.params);var d=p(t.params);d&&(t.params=d)}return(0,i.Z)(t).then((function(r){return(0,n.mG)(a,void 0,void 0,(function(){var o,a,s,c,l,d,f,y;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:if(o="",a=r.data,s=r.headers,c=(0===(null==a?void 0:a.code)||-352===(null==a?void 0:a.code))&&(null===(f=null==a?void 0:a.data)||void 0===f?void 0:f.v_voucher),l=-352===this.getArrayBufferCode(r)&&s["x-bili-gaia-vvoucher"],!(o=c?null===(y=null==a?void 0:a.data)||void 0===y?void 0:y.v_voucher:l?s["x-bili-gaia-vvoucher"]:""))return[3,2];if(!this.canPopupVerifyCom())throw this.log.w("screen too small for validation",t.url),new Error(e.GAIA_RISK_HIT);return[4,h.loadValidateSDK({v_voucher:o})];case 1:if((d=n.sent()).token)return t.params=Object.assign({},u,{gaia_vtoken:d.token}),t.params=p(t.params),[2,(0,i.Z)(t)];throw this.log.w("failed to get token",t.url),new Error(e.GAIA_RISK_HIT);case 2:return[2,r];case 3:return[2]}}))}))}))},e.prototype.getArrayBufferCode=function(e){try{if("arraybuffer"===e.config.responseType){var t=new TextDecoder("utf-8"),r=new Uint8Array(e.data);return JSON.parse(t.decode(r)).code}}catch(e){this.log.w("[ParseError]",null==e?void 0:e.message)}return 0},e.prototype.isIllegal=function(e,t,r){if(null==e)return this.lo,!0;if(t)return!1;if(0===e.code)return!1;try{this.log.w("Response",JSON.stringify(e))}catch(e){this.log.w("Unexpected",e&&e.message)}return this.delHttpCache(r||Xt.get(e)),!0},
e.prototype.setHttpCache=function(e,t,re__=Date.now(),this.httpCaches.set(e,t))},e.prototype.getHttpCache=function(e){if(this.baseConfig.memCache&&this.httpCaches){var t=this.httpCacheSeconds)return t;this.delHttpCache(e)}}},e.prototype.delHttpCache=function(e){this.httpCaches&&this.httpCaches.delete(e)},e.prototype.canPopupVerifyCom=function(){if(this.baseParam.isEmbed&&"function"=tDimension){var e=this.baseParam.getDimension();return 0===e.height||e.height>465}return!0},e.prototype.dispose=function(e){this.log.i("[Dispose]",e),this.cancelSource.cancel(e)},e.prototype.getStaticImgUrlKey=function(){if(window.__NanoStaticHttpKey)return"5a6f002d0bb14fc9848fc64157648ad4"},e.prototype.getStaticSubUrlKey=function(){if(window.__NanoStaticHttpKey)return"0503a77b29d7409d9548fb44fe9daa1a"},e.PENDING_PROMISE=new Promise(y.Z),e.LIFECYCLE_TOKEN="__LifecycleCanceled__",e.GAIA_RISK_HIT="__GaiaRiskHit__",e}()},73584:function(e,t,r){"use strict";r.d(t,{X:function(){return i}});var n=function(){function e(e){this.ua=e}return Object.defineProperty(e.prototype,"apple",{get:function(){return{alike:!!navigator.vendor&&/Apple/i.test(navigator.vendor)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linux",{get:function(){return{alike:/Linux/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tesla",{get:function(){return{alike:/Tesla/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iOS",{get:function(){return{alike:/Mac OS X[\s_\-\/](\d+[.\-_]\d+[.\-_]?\d*)/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"android",{get:function(){return{alike:/Android/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"windowsMobile",{get:function(){return{alike:/Windows Phone/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defin1,configurable:!0}),Object.defineProperty(e.prototype,"gecko",{get:function(){return{alike:/Gecko/i.test(this.ua)&&!/KHTML/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trident",{get:function(){return{alike:/Trident/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"msie",{get:function(){return{alike:window.ActiveXObject||"ActiveXObject"in window,ie11:/rv:11/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"edge",{get:function(){return{alike:/Edge/i.test(this.ua),build16299:/(\s|^)edge\/16.16299(\s|$)/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"safari",{get:function(){var e=/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.test(this.ua)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.test(this.ua);return{alike:e,mseSupported:e&&/version\/1\d/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firefox",{get:function(){return{alike:/Firefox/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.definePrChrome/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mobile",{get:function(){return{alike:/AppleWebKit.*Mobile.*/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iPhone",{get:function(){return{alike:/iPhone/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iPad",{get:function(){return{alike:/iPad/i.test(this.ua)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microMessenger",{get:function(){return{alike:/MicroMessenger/i.test(this.ua)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"info",{get:function(){var e=/(chrome)[ \/]([\w.]+)/.exec(this.ua)||{},t=e[5]||e[3]||e[1]||null;return{browser:t,version:t?parseInt(e[4]||e[2]||"0",10):0}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cssVar",{get:function(){if("boolean"==typeof this.supportCssVar)return this.supportCssVar;var e=this.msie,t=e.alike,r=e.ie11;if(t||r)return this.supportCssVar=!1,!1;var n=this.getBrowserInfo(),i=n.browser,o=n.ver;switch(i){case"chturn this.supportCssVar=!1,!1;break;case"firefox":if(o<32)return this.supportCssVar=!1,!1;break;!1,!1;break;default:return this.supportCssVar=!1,!1}return this.ction(){var e,t=this.ua.match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/);return{browser:null===(e=null==t?void 0:t[1])||void 0===e?void 0:e.replace(/version/,"safari"),vigator.userAgent.toLowerCase())},72778:function(e,t,r){"use strict";r.d(t,{x:function(){return n}});var n=new Map},78757:function(e,t,r){"use strict";r.d(t,{eF:function(){return o}});var n=r(15418),i=function(){function e(){this.zone=this.atomicBufferZone}return Object.defineProperty(e.prototype,"atomicBufferZone",{get:function(){return{paused:!0,currentTime:0,previousTimeStamp:0,currentTimeStamp:0}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this.zone.paused},enumerable:!1,configurable:!0}),e.prototype.getCurrentTime=function(){return this.tick(),this.zone.currentTime},e.prototype.getCurrentTimeStamp=function(){return window.performance&&performance.now?performance.now():Date.now()},e.prototype.tick=function(){if(this.zone.paused)return this.zone.currentTimeStamp=this.zone.previousTimeStamp=this.getCurrentTimeStamp(),!1;vurrentTimeStamp,this.zone.currentTimeStamp=e,this.zone.currentTimeStamp&&this.ze.currentTime+=this.zone.currentTimeStamp-this.zone.previousTimeStamp)),!0},e.prototype.play=function(){return!!this.zone.paused&&(this.tick(),this.zone.paused=!1,!0)},e.prototype.pause=function(){return!this.zone.paused&&(this.tick(),this.zone.paused=!0,!0)},e.prototype.reset=function(e){return e&&(this.zone.paused||this.pause()),!!this.zone.paused&&(this.zone=this.atomicBufferZone,!0)},e}(),o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nid=0,t.previousTime=0,t.record=new Map,t}(0,n.ZT)(t,e),t.prototype.start=function(){return this.play()},t.prototype.stop=function(){return this.pause()},t.prototype.tape=function(e){if(this.paused)return!1;var t=e||" ".concat(++this.nid),r=this.getCurrentTime();return this.record.set(t,r-this.previousTime),this.previousTime=r,!0},t.prototype.reset=function(e){return void 0===e&&(e=!1),e&&(this.paused||(this.tape("FORCE_RESET"),this.stop())),!!this.paused&&(this.record.clear(),!0)}}(i),function(e){function t(t,r,n){void 0===n&&(n=100);var i=e.call(this)||this;if(i.callback=t,i.duration=r,i.interval=n,i.timer=null,"number"!=typeof r||"number"!=typeof n)throw new Error("duration/interval MUST be a number");if(!(r>0&&n>0))throw new Error("duration/interval MUST be a positive number");return i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"currentTime",{get:function(){return Math.min(Math.max(0,this.getCurrentTime()),this.duration)},set:function(e){this.zone.currentTime=Math.min(Math.maxrototype.startInterval=function(){var t=this;e.prototype.play.call(this),this.timer=window.setInterval((function(){var e=t.getCurrentTime();t.paused||t.callback(t.duration,e),t.duration<=e&&t.abort()}),this.interval)},t.prototype.stopInterval=function(){e.prototype.reset.call(this,!0),window.clearInterval(this.timer),this.timer=null},t.prototype.suspend=function(){return!!this.timer&&(!this.paused&&(e.prototype.pause.call(this),
!0))},t.prototype.resume=function(){return this.timer?!!this.paused&&(e.prototype.play.call(this),!0):(this.startInterval(),!0)},t.prototype.abort=function(){return!!this.timer&&(this.stopInterval(),!0)},t}(i))},9178:function(e,t,r){"use strict";r.d(t,{$:function(){return i},j:function(){return o}});var n=r(15418);function i(e){var t={};return"string"==typeof e&&e.split(";").forEach((function(e){var r=(0,n.CR)(e.split(":"),2),i=r[0],o=r[1];i&&(t[i]=o)})),t}function o(e){var t={};if(!e)return t;try{t=JSON.parse(e)}catch(e){}return t||{}}},70035:function(e,t,r){"use strict";r.d(t,{I:function(){return a}});var n=r(15418),i="perf"===(0,r(55360).eY)("debug"),o=Object.create(null),a=function(){function e(){}return e.calcLoadTimes=function(){var e,t,r=[];if(!window.performance)return r;if("function"!=typeof performance.getEntriesByType)return r;var i=performance.getEntriesByType("resource");if(null==i||i.length<=0)return r;try{for(var o=(0,n.XA)(i),a=o.next();!a.done;a=o.next()){var s=a.value,u=s.redirectEnd-s.redirectStart,c=s.domainLookupEnd-s.domainLookupStart,l=s.connectEnd-s.connectStart,d=s.secureConnectionStart>0?s.connectEnd-s.secureConnectionStart:0,f=s.responseEnd-s.responseStart,p=s.fetchStart>0?s.responseEnd-s.fetchStart:0,h=(s.requestStart>0&&(s.responseEnd,s.requestStart),s.startTime>0?s.responseEnd-s.startTime:0);r.push({name:s.name,duration:s.duration||h||p,requestStart:s.startTime||s.fetchStart,entryType:s.entryType,initiatorType:s.initiatorType,nextHopProtocol:s.nextHopProtocol,decodedBodySize:s.decodedBodySize,transferSize:s.transferSize,redirectTime:u,dnsTime:c,tcpTime:l,sslTime:d,responseTime:f})}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return r},e.filterLoadTime=function(t){var r,i,o,a,s=e.calcLoadTimes();if("strincatch(e){r={err)(s),d=l.next();!d.done;d=l.next()){var f=d.value;if(t.test(f.name))return f}}catch(e){o={error:e}}finally{try{d&&!d.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}return null},e.mark=function(e){window.performance&&"function"==typeof performance.mark&&performance.mark(e)},e.clearMarks=function(e){window.performance&&"function"==typeof performance.clearMarks&&performance.clearMarks(e)},e.measure=function(e,t,r){window.performance&&"function"==typeof performance.measure&&performance.measure(e,t,r)},e.clearMeasure=function(e){window.performance&&"function"==typeof performance.clearMeasures&&performance.clearMeasures(e)},e.markOnce=function(t){o[t]||(e.mark(t),o[t]=1)},e.measureOnce=function(t,r,n){o[t]||(i&&e.measure(t,r,n),o[t]=1)},e.getMarkTimeByName=function(e){if(window.performance&&"function"==typeof performance.getEntrieByName(e,"mark"),r=t&&t.length&&t[0];if(r&&r.startTime)return r.startTime}return 0},e}()},;r.d(t,{n:function(){return o}});var n=r(15418),i=[{value:0,name:":"720P "},{value:64,name:"720P "},{value:74,name:"720P ",prime:!0},{value:125,name:"HDR ",prime:!0},{value:126,name:"",prime:!0},{value:127,name:"8K ",prime:!0}].reduce((function(e,t){return e[t.value]=t,e}),Object.create(null)),o=function(){function e(){}return Object.defineProperty(e,"ge",{get:function(){return{privilege:112}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"gt",{get:function(){return{login:32,mseSupported:64,bigWidth:80,whiteEmbedded:32,otherEmbedded:16!1,configurable:!0}),Object.defineProperty(e,"alias",{get:function(){return{SD_32:32,FHD_80:80,FHD_1127,AQ_30216:30216,AQ_30232:30232,AQ_30280:30280}},enumerable:!1,configurable:!0}),e.isSuperQuality=function(t){var r=i[t];return r?!!r.prime:t>=e.ge.privilege},e.item=functir):{value:t,0}},e.normalize=function(e){return{1:16,2:64,3:80,4:112,48:64}[e]||+e},e}()},38823:function(e,t,r){"use strict";r.d(t,{Y:function(){return i},Q:function(){return o}});var n=r(87210);var i=function(){function e(){}return e.getQueryString=function(e){return e.split("?")[1]},e.removeQueryString=function(e){var t=e.indexOf("?");return t>-1?e.slice(0,t):e},e.appendQueryString=function(e,t){return t?"".concat(e,"?").concat(t):e},e.removeBfsParams=function(e){var t=e.indeturn e+=-1===e.indexOf("@")?"@":"_",e+=r+t},e.hasBfsParams=function(e){return e.indexOf("@")>-1},e.getUrlExt=function(e){return e.split(".").pop().toLowerCase()},e.setUrlExt=function(t){var r=e.getUrlExt(e.removeBfsParams(t)),i="gif"!==r&&(0,n.x)()?"webp":r;return t+=e.hasBfsParams(t)?".".concat(i):"@.".concat(i)},e.validateBfsUrl=function(t){return-1!==["jpg","jpeg","png","webp","gif"].indexOf(e.getUrlExt(t))&&-1!==t.indexOf("/bfs/")},e.setisFinite(r)&&r>0&&(t=e.appendBfsParam(t,"w",Math.round(r))),isFinite(n)&&n>0&&(t=e.appendBfsParam(t,"h",Math.round(n))),t},e.thumbnail=function(t,r,n){if(!(t=function(e){return"string"==typeof e?e.replace(/^https?:\/\//i,"//"):e}(t))||"string"!=typeof t)return t;var i=t,o=e.getQueryString(t),a=e.rarams(a);if(!e.validateBfsUrl(s))return i;var u=e.setSize(s,r,n),c=e.setUrlExt(u);return e.appendQueryString(c,o)},e}(),o=i.thumbnail},51454:function(e,t,r){"use strict";r.d(t,{B:function(){return n}});var n=function(){function e(){var e=this;this.state=0,thistate=1},e.reject=function(t){r(t),e.state=2}}))}return Object.defineProperty(e.prototype,"isPending",{get:function(){return 0===this.state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is,configurable:!0}),Object.defineProperty(e.prototype,"isRejected",{get:function(){return 2===this.state},enumerable:!1,configurable:!0}),e}()},33070:function(e,t,r){"use strict";function n(e){var t=(new DOMParser).parseFromString(e.trim(),"text/html");return document.adoptNode(t.body.firstChild)}r.d(t,{t:function(){return n}})},50960:function(e,t,r){"use strict";function n(e){e&&e.parentElement&&e.parentElement.removeChild(e)}r.d(t,{b:function(){return n}})},39178:function(e,t,r){"use strict";r.d(t,{h:function(){return i}});var n=r(15418);function i(e){for(var t,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];if(e&&i.length){!function(e){if(e)for(;e.lastChild;)e.removeChild(e.lastChild)}(e);try{for(var a=(0,n.XA)(i),s=a.next();!s.done;s=a.next()){var u=s.value;"string"==typeof u?e.appendChild(document.createTextNode(u)):e.appendChild(u)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}}},71694:function(eturn"#"+("00000"+e.toString(16)).slice(-6)}r.d(t,{X:function(){return n}})},69668:function(e,t,r){"use strict";function n(e,t){t=t||"yyyy-MM-dd hh:mm:ss";var r={"M+":(e=e||new Date).getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),"S+":e.getMilliseconds()};for(var n in/(y+)/i.test(t)&&(t=t.replace(RegExp.$1,e.getFullYear().toString().substr(4-RegExp.$1.length))),r)if(new RegExp("(".concat(n,")")).test(t)){var i=1===RegExp.$1.lengtg().length);t=t.replace(RegExp.$1,i)}return t}function i(e){var t=-(e=e||new Date).getTimezoneOffset(),r=t>=0?"+":"-",n=function(e){return(e<10?"0":"")+e};return e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+r+n(Math.floor(Math.abs(t)/60))+":"+n(Math.abs(t)%60)}r.d(t,{p:function(){return n},r:function(){return i}
})},98680:function(e,t,r){"use strict";function n(e){if(null==e)return 0;var t=e.toString().split(":").reverse();retut(t[1],10)||0)+3600*(parseInt(t[2],10)||0):0}function i(e){var t=/^(\d+h)?(\d+m|^s)?(\d+s)?(\d+ms)?$/.exec(e),r=function(e){return parseInt(e,10)||0};return t&&t[0]?60*r(t[1])*60+60*r(t[2])+r(t[3])+r(t[4])/1e3:parseFloat(e)>=0||-1===parseFloat(e)?parseFloat(e):0}r.d(t,{N:function(){return n},o:function(){return i}})},73245:function(e,t,r){"use strict";r.d(t,{g:function(){return n}});var n=new(function(){function e(){this.isDetected=!1,this.details={vendor:"",renderer:""}}return Object.defineProperty(e.prototype,"vendor",{get:function(){return this.getDetails().vendor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderer",{get:function(){return this.getDetails().renderer},enumerable:!1,configurable:!0}),e.prototype.getDetails=function(){if(this.isDetected)return this.details;var e,t,r=document.createElement("canvas"),n="",i="";try{(e=r.getContext("webgl2")||r.getContext("webgl")||r.getContext("experimental-webgl"))&&(t=e.getExtension("WEBGL_debug_renderer_info"))&&(n=e.getParameter(t.UNMASKED_VENDOR_WEBGL),i=e.getParameter(t.UNMASKED_RENDERER_WEBGL))}catch(e){console.warn(e)}return this.details.vendor=n,this.details.renderer=i,this.isDetected=!0,{vendor:n,renderer:i}},e}())},90787:function(e,t,r){"use strict";r.d(t,{a:function(){return i}});var n=r(73584);function i(){return!(n.X.safari.alike&&!n.X.safari.mseSupported)&&(window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'))}},92425:function(e,t,r){"use strict";r.d(t,{M:function(){return i}});var n=r(72778);function i(){var e,t="[hasWebgl]";if(n.x.has(t))return n.x.get(t);try{var r=document.createElement("canvas");e=!!(r.getContext("webgl2")||r.getContext("webgl")||r.getContext("experimental-webgl"))}catch(t){e=!1}return n.x.set(t,e),e}},87210:function(e,t,r){"use strict";r.d(t,{x:function(){return i}});var n=r(72778);function i(){var e="[hasWebp]";if(n.x.has(e))return n.x.get(e);var t=!1,r=document.createElement("canvas");if(r.getContext&&r.getContext("2d"))try{t=0===r.toDataURL("image/webp").indexOf("data:image/webp")}catch(e){t=!1}return n.x.set(e,t),t}},10875:function(e,t,r){"use strict";function n(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n="",i=0;i<t.length;i++)n+=e[i],n+=t[i].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;");return n+=e[e.length-1]}r.d(t,{t:function(){return n}})},93546:function(e,t,r){"use strict";r.d(t,{$p:function(){return u},Jo:function(){return s},dX:function(){return a}});var n=r(15418),i=r(77165),o=r(51797);function a(e,t){var r=null,a=null;return(0,i.EH)((function(){var s,u;if(r){var c=(0,o.zP)(e,r),l=(0,o.zP)(r,e((0,n.ev)([],(0,n.CR)(d.keys()),!1)),h=p.next();!h.done;h=p.next()){var y=h.value,m=e.get(y),g=r.get(y),v=a.get(y);m===v?i.p6.structural(m,g)||f.push([m,g]):(l.set(y,v),c.set(y,m))}}catch(e){s={error:e}}finally{try{h&&!h.done&&(u=p.return)&&u.call(p)}finally{if(s)throw s.error}}l.size&&"function"==typeof t.remove&&t.remove((0,n.ev)([],(0,n.CR)(l.values()),!1),e),c.size&&"function"==typeof t.add&&t.add((0,n.ev)([],(0,n.CR)(c.values()),!1),e),f.length&&"function"==typeof t.update&&t.update(f,e)}else e.size&&"function"==typeof t.add&&t.add((0,n.ev)([],(0,n.CR)(e.values()),!1),e);a=new Map(e),r=(0,i.ZN)(e)}))}function s(e){(t){"function"==typeof e[t]&&e[t]()})),Object.create(null)}functionfor(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&Object.prototype.hasOwnProperty.call(e,r)&&e[r]!==t[r]&&(e[r]=t[r])}))}},517,{d9:function(){return aion(){return o}});var n=r(15418);function i(e,t){return new Map((0,n.ev)([],(0,n.CR)(e.entries()),!1).filter((function(e){var r=(0,n.CR)(e,2),i=r[0];r[1];return t.has(i)})))}function o(e,t){return new Map((0,n.ev)([],(0,n.CR)(e.entries()),!1).filter((function(e){var r=(0,n.CR)(e,2),i=r[0];r[1];return!t.has(i)})))}var a=function(){function e(e){this.flag=0,this.set(e)}return e.prototype.get=function(){retudisable=function(e){null!=e&&(this.flag&=~e)},e.prototype.isAllow=function(e){return(this.flag&e)===e},e.prototype.isOnlyAllow=function(e){return this.flag===e},e.prototype.isNotAllow=function(e){return 0==(this.flag&e)},e}()},92767:function(e,t,r){"use strict";r.d(t,{$W:function(){return o},_g:function(){return i},x8:function(){return n}});var n={},i={entryRequestStart:0,entryResponseEnd:0},o=new Set},63653:function(e,t,r){"use strict";function n(e){try{return localStorage.getItem(e)}catch(e){return null}}functiontch(e){}}function o(e){try{return sessionStorage.getItem(e)}catch(e){return null}}function a(e,t){try{sessionStorage.setItem(e,t)}catch(e){}}r.d(t,{Gg:function(){return o},KY:function(){return a},co:function(){return i},tv:function(){return n}})},97381:function(e,t,r){"use strict";r.d(t,{L:function(){return i},w:function(){return o}});var n=r(15418);function i(e){var t=(0,n.pi)({text:"",mimeType:"text/plain;charset=utf-8",filename:"text.txt",timeout:5e3},e),r=Array.isArray(t.text)?t.text:[t.text],i=new Blob(r,{type:t.mimeType}),o=document.createElement("a");o.href=URL.createObjectURL(i),o.download=t.filename,o.target="_blank",o.click(),window.setTimeout((function(){URL.revokeObjectURL(o.href)}),t.timeout)}function o(e,t){return void 0===t&&(t=".json"),new Promise((function(r,n){var i=document.createElement("input");i.type="file",i.setAttribute("accept",t),i.onchange=function(t){var o=new FileReader;o.readAsText(i.files[0]),o.onload=function(){"function"==typeof e&&e(o),r(o)},o.onerror=n,o.onabort=n},i.click()}))}},55360:function(e,t,r){"use strict";function n(e,t){var r="string"==typeof t?function(e){var t=e.indexOf("?"),r=e.indexOf("#");return-1===t?"":-1===rend(t,r)})),n.href}function o(e,t){return t.reduce((fu&]"+t+"=[^&#]*(#.*)?$"),"$1").replace(new RegExp("([?&])"+t+"=[^&]*&"),"$1")}(e,t)}),e)}r.d(t,{Kz:function(){return i},eY:function(){return n},qx:function(){return o}})},71964:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAC0CAYAAABVEkZPAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUD2+vO9L1xG8j77coPnsUOUD2dBlAAAAAAElFTkSuQmCC"},39087:function(){},62344:function(e,t,r){"use strict";function nenructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}r.d(t,{Z:funcunction(e){if("object"!==u(e))return!1;var t=s(e)
;return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOfmbol.iterator in e)},_=c("Date"),E=c("File"),b=c("Blob"),S=unction w(e,t){var r,n,o=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allOwnKeys,a=void 0!==o&&o;:Object.keys(e),c=u.length;for(r=0;r<c;r++)s=u[r],t.call(null,e[s],s,e)}}function A(e,t){t=t.toLowerCase();for(var r,n=Object.keys(e),i=n.le self?self:rn D&&e instanceofnction(e,t){var r=Object.getOwnPnction(r,i){!1!==t(r,i,e)&&(n[i]=r)})),Object.defineProperties(e,n)},x="abcdefghijklmnopqrstuvwxyz",MHA_DIGIT:x+x.toUpperCase()+M};var U={isArray:d,isArrayBuffer:p,i FormDa(e):e=e},isObj,isRegExpeless,r={},n=)?e[i]=n(t,r):e[i]=t}),{allOwnK.replacet,r,n){e.protbject.asst||{},null==e)return t;do{for(o=(i=Object.getOwnPropertyNames(e)).length;o-- ,r);return-1new Array(t)&!r.done;){var i=r.value;t.call(e];null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:C,hasOwnPwritable=!1:t.set||(nction(e,t){voarguments[1]?arguments[1]:r)?[]:{};return w(r,(function(t,r){var o=e(t,n+1);!f(o)&&(i[r]=o)})),t[n]=void 0,i}}return r}(e,0)}};function B(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.messat&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}U.inherits(Bbject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var j=B.prototype,V={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS0}),B.from=function(e,t,r,n,iFlatObjee))})),!1;return!!q(e)||(Object.assi){if(!U.nction(e){return t[e]}))}function Z(e,t){
this._pairs=[],e&&Q(e,this,t)}var J=Z.prototype;J.append=function(e,t){this._pairs.push([e,t])},J.toString=function(e){var t=e?function(t){return e.call(this,t,z)}:z;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var X=Z;function $(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ee(e,t,r){if(!t)return e;var n,i=r&&r.encode||$,o=r&&r.serialize;if(n=o?o(t,r):U.isURLSearchParams(t)?t.toString():new X(t,r).toString(i)){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}function te(e){return te="funct,"symbol"===te(o)?o:String(o)),n)}var i,o}var ne,ie=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handlers=[]}var t,r,n;return t=e,(r=[{key:"use",value:function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}},{key:"eject",value:function(e){this.handlers[e]&&(this.handlers[e]=null)}},{key:"clear",value:function(){this.handlers&&(this.handlers=[])}},{key:"forEach",value:function(e){U.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}])&&re(t.prototype,r),n&&rta:se,Blob:Blob},isStandardBrowserEnv:ue,isStandardBrowserWebWorkerEnv:ce,protocols:["http",rset=utf-8",!1),e.toileList(e))||n.indexOf("multipart/form-data")>-1){var a=this.env&&this.env.FormData;return Q(r?{"files[]":e}:e,a&&new a,this.formSerializer)}}return o||i?(t.setContentType("applif(U.isString(e))try{return(t||JSON.parse)(e),U.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e(e)):e}],transformResponse:[functionional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(e&&U.isString(e)&&(r&&!this.responseType||n)){var i=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw H.from(e,H.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:le.classes.FormData,Blob:le.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};U.forEach(["delete","get","head"],(function(e){pe.headers[e]={}})),U.forEach(["post","put","patch"],(function(e){pe.headers[e]=U.merge(fe)}));var he=pe,ye=U.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);function me(e){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},me(e)}function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ve(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ve(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order t"valnction(e){return e instanceof this?e:new this(e)}},{key:"concat",value:function(e){for(var t=new this(e),r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n.forEach((fuhis[n].call(this,t,e,r,i)},configurable:!0})}))}(r,e),t[n]=!0)}return U.isArraon"]),o=n.da,i.normalize(),t?t.status:void 0)})),i.normalize(),o}function Pe(e){retL__:!0});var Oe=De;var Ie=le.ia-st(t)?f e=n(window.location.href),function(t){var r=U.isString(tined(e.withCreddProgressunctiUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function s(r,i,o){return o in t?n(r,i):o in e?n(void 0,r):void 0}var u={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgresbeforeRedirect:a,transport:a&&"symbol"==typeof Symnction(e,t,r){function n(e,t){return"[Axios v1.3.3] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,i,o){if(!1===e)throw new H(n(i," has been removed"+(t?" in "+t:"")),H.ERR_DEPRECATED);return t&&!qe[i]&&(qe[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,o)}};var We={assertOptions:function(e,t,r){if("object"!==He(e))throw new H("options must be an object",H.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(e),i=n.length;i-- >0;){var o=n[i],a=t[o];if(a){var s=e[o],u=void 0===s||a(s,o,e);if(!0!==u)throw new H("option "+o+" must be "+u,H.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new H("Unknown option "+o,H.ERR_BAD_OPTION)}},validators:Ge};function Ke(e){return Ke="function"==typeof Symbol&&"symn Ye(e,t){for(var r=0;r<t.length;r++){var n=t,"patch","common"],(fEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(u=u&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));var c,l=[.bind(this),void 0];for(p.unshift.ap(this,h)}catch(e){return Promise.reject(e)}for(f=0,d=l.length;f<d;)c=c.then(l[f++],l[f++]);return c}},{key:"getUri",value:function(e){return ee(Ce((e=je(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}])&&Ye(t.prototype,r),n&&Ye(tJe="fuew=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var rt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequirengthRequired:411,Pr2,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerErrore:503,GatewayTimtes:506,InsufficientStorage:507,LoopDetected:508,Notries(rt).forEach((function(e){var t=et(e,2),r=t[0],ion(){;)if((0,i.Z)(e[r][0],t))return r;return-1},a=Array.prototype.splice;var s=function(e){var t=this.__data__,r=o(t,1),--r][1]};var c=function(e){return o(this._d(e){var t=-1,r=null==e?0:e.length;for(tr=n,d.r(54760),i=r(52336),o=(0,n.Z)(i.Z,"Map");t.Z=o},52737:function(e,t,r){"use strict";r.d(t,{Z:function(){return w}});var n=(0,r(54760).Z)(Object,"create");var i=function(){this.__data__=n?n(null):{},this.size=0};var o=function(e){var pe.hasOwnProperty;var s=function(e){var t=this.__data__;if(n){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return a.call(t,e)?t[e]:void 0},u=Object.prototype.hasOwnProperty;var c=function(e){var t=this.__data__;return n?voioid 0=this.ci,d.prototype.delete=o,d.prototype.get=s,d.protot=r(608tion(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.:function(e,t,r){"use strict";r.d(t,{Z:function(){return f}});var n=r(60unctio.__datr.leng,h=p?n(e.length,String):[],y=h.length;for(var m in e)!t&&!c.call(e,m)||p&&("length"==m||d&&("offset8535:function(e,te,o=i.i=a.call(e);return n&&(t?e[s]=r:delete e[s]),i},c=Object.prototype.toString;var l=function(e){return c.call(e)},d=n.Z?n.Z.toStringTag:void 0;var f=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":d&&d in Object(e)?u(e):l(e)}},20772:function(e,t,r){"use strict";r.d(t,{Z:function(){return K}});var n=r(81447),i=r(38700);var o=function(e,t,r){"__proto__"==t&&i.Z?(0,i.Z)(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},a=r(28987);var s=function(e,t,r){(void 0!==r&&!(0,a.Z)(e[ct(t),a=n(t),s=a.on l(eof e}:ol.prototype?"symbol":typeof ==typeof module?"undefined":l(=p?p.allocUnsafe:void 0;var y=function(e,t){if(t)rw e.constructor(r);return e.copy(n),n},m=r(54176);};var v=function(e,t){var r=t?g(e.bufferr=-1,nturn b(t);e.protor A=function(e){return"function"!=typeofe)},C=unctio"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},M=Object.prototype.hasOwnProperty;var F=function(e,t,r){var n=e[t];M.call(e,t)&&(0,a.Z)(n,r)&&(void 0!==r||t in e)||o(e,t,r)};var U=function(e,t,r,n){var i=!r;r||(r={});for(var a=-1,s=t.length;++a<s;){var u=t[a],c=n?n(r[u],e[u],u,r,e):void 0;void 0===c&&(c=e[u]),i?o(r,u,c):F(r,u,c)}return r},B=r(51660);var j=function(e){var t=[];if(null!=e)for(var r in Object,n))&&r.push(n);return r};var G=function(e){return(0,D.Z)(e)?(0,B.Z)(e,!0)e){return U(e,G(e))};var W=fu):h?(0,k.Z)(c)||(0,R.Zdelete(c)),s(e,r,d)0===l&&(l=u),"use s,o=Math.max;var a=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var n=arguments,a=-1,s=o(n.length-t,0),u=Array(s);++a<s;)u[a]=n[t+a];a=-1;for(var c=Array(t+1);++a<t;)c[a]=n[a];return c[t]=r(u),(0,i.Z)(e,this,c)}};var s=function(e){return function(){return e}},u=r(38700),c=u.Z?function(e,t){return(0,u.Z)(e,"toString",{configurable:!0,enureturn arguments[0]}else t=0;retureturn l}}?functvoid 0Objectn,i=r(on(e,=m||a.:void 0,n=r?(0,d.Z)(r):"";if(n)switch(n){case g:return m;case v:return f;case _:return p;case E:return h;case b:return y}return t});var T=S},6138:function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var n=/^(?:0|[1-9]\d*)$/;t.Z=function(e,t){var i=r(e);return!!(t=null==t?9007199254740991:t)&&("number"==i||"symbol"!=e&&e.constructstrictle))&&g("util")}catch(e){}}();t.Z=u},87333:function(e,t){"use strict";t.Z=functin=r(74331);functif Symboon _(e();if(void 0n.Z)(rvoid 0!==f&&clearTimeout(f),h=0,i=p=c=f=void 0},S.flush=function(){return void 0===f?d:b(o())},S}},28987:function(e,t){"use strict";t.Z=function(e,t){return e===t||e!=e&&t!=t}},38802:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(78535),i=r(37260);var o=function(e){return(0,i.Z)(e)&&"[object Arguments]"==(0,n.Z)(e)},a=Object.prototype,s=a.hasOwnProperty,u=a.propertyIsEnumerable,c=o(function(){return arguments}())?o:function(e){return(0,i.Z)(e)&&s.call(e,"callee")&&!u.call(e,"callee")},l=c},74752:function(e,t){"use strict";var r=Array.isArray;t.Z=r},58324:function(e,t,r){"use strict";var on"==ton"==tu.isBuumber""funct,a={};a["[ob["[objNumber]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object Str(0,i.Z)(e.lengtypedArray,d=l?(0,u.Z)(l):s},61273:function(e,t,r){"use strict";var n=r(20772),i=(0,r(57651).Z)((function(e,t,r){(0,n.Z)(e,t,r)}));t.Z=i},19062:function(e,t){"use strict";t.Z=function(){}},19612:function(e,t,r){"use strict";var n=r(81526),i=r(74534);t.Z=function(e,t,r){n");return(0,i.Z)(r)&&(o="leading"in r?!!r.leading:o,a="trailing"in r?!).replace(o,""):e},s=r(74534),u=r(78535),c=r(37260);function l(e){return l="functioSymbol]"==(0,u.Z)(e)},f=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,h=/^0o[0-7]+$/i,y=parseInt;var m=function(e){if("number"==typeof e)return e;if(d(e))return NaN;if((0,s.Z)(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=(0,s.Z)(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=a(e);var r=p.test(e);return r||h.test(e)?y(e.slice(2),r?2:8):f.test(e)?NaN:+e}}},__webpack_module_cache__={},leafPrototypes,getProto,inProgress,dataWebp){return e};return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},__webpack_require__.t=function(e,t){if(1&t&&(e=create(null);__webpack_require__.r(r);var n={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&t&&e;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((function(t){n[t]=function(){return e[t]}}));return n.default=function(){return e},__webpack_require__.d(r,n),r},__webpack_require__.d=function(e,t){for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.f={},__webpack_require__.e=function(e){return Promise.all(Object.keys(__webpack_require__.f).reduce((function(t,r){return __webpack_require__.f[r](e,t),t}),[]))},__webpack_require__.u=function(e){return"widgets/npd."+({120:"flv-module",126:"coiliary-helper",699:"creator-helper",835:"ace",892:"root-extra",905:"embedded-helper",991:"homepage-helper"}[e]||e)+"."+{120:"d277bc5d",126:"0dda537a",139:"72gth;s++){var u=a[s];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==dataWebpackPrefix+r){i=u;break}}i||(o=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,__webpack_require__.nc&&i.seta-webpack",dataWebpackPrefix+r),i.src=e),inProgress[e]=[t];var c=function(t,r){i.onerror=i.onload=null,clearTimeout(l);var n=inProgress[e];if(delete inProgress[e],i.parentNode&&i.parentNode.eturn t(r)},l=setTimeoebpaew Error;__webpack_require__.l(o,(function(r){if(__webpack_require__.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",a.name="ChunkLoadError",a.type=i,a.request=o,n[1](a)}}),"chunk-"+t,t)}};var t=function(t,r){var n,i,o=r[0],a=r[1],s=r[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(n in a)__webpack_require__.o(a,n)&&(__webpack_require__.m[n]=a[n]);if(s)s(__webpack_require__)}for(t&&t(r);u<o.length;u++)i=o[u],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.nanoWidgetsJsonp=self.nanoWidgetsJsonp||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var __webpack_exports__={};return function(){"use strict";__webpack_require__.r(__webpack_exports__);var e=__webpack_require__(70035),t=__webpack_require__(92767),r=(__webpack_require__(90386),__webpack_require__(89426),__webpack_require__(78959),__webpack_require__(50913),__webpack_require__(96713),__webpack_require__(42101),__webpack_require__(22545),__webpack_require__(91021),__webpack_require__(13052),__webpack_require__(6331),__webpack_require__(8249),__webpack_require__(17618),__webpack_require__(91277),__webpack_require__(41090),__webpack_require__(99452),__webpack_require__(78384)),n=__webpack_require__(65312),i=__webpack_require__.n(n),o=__webpack_require__(47396),a=__webpack_require__.n(o),s=__webpack_require__(61538),u=__webpack_require__.n(s),c=__webpack_require__(96906),l=__webpack_require__.n(c),d=__webpack_require__(94376),f=__webpack_require__.n(d),p=__webpack_require__(53297),h={attributes:{"data-injector":"nano"}};h.setAttributes=l(),h.insert=u().bind(null,"head"),h.domAPI=a(),h.insertStyleElement=f();i()(p.Z,h),p.Z&&p.Z.locals&&p.Z.locals;var y=__webpack_require__(52135),m=__webpack_require__.n(y),g=__webpack_require__(62344),v=__webpack_require__(35878);var _=__webpack_require__(77165),E=__webpack_require__(59707);e.I.markOnce("M01"),e.I.measureOnce("P01:NS2IH",null,"M01"),(0,r.fB)(),e.I.markOnce("M02"),"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(e,t){var r=document.createEvent("CustomEvent"),n=Object.assign({bubbles:!1,cancelable:!1,detail:null},t);return r.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),r}),v.defaults.expires=365,v.defaults.path="/",v.defaults.domain=".bilibili.com",g.Z.interceptors.request.use((function(e){var t,r="[object Object]"===((t=e.data)&&Object.prototype.toString.call(t));return/^POST$/i.test(e.method)&&r&&!e.data.csrf&&Object.assign(e.data,{csrf:v.get("bili_jct")}),r&&(e.data=m().stringify(ire__.e(856),__webpack_require__.e(479),__webpack_require__.e(413),__webpack_require__.e(850),__webpack_require__.e(139),__webpack_require__.e(987),__webpack_require__.e(967),__webpack_require__.e(160),__webpack_require__.e(140)]).then(__webpack_require__.bind(__webpack_require__,60874))},E.lS.getCommunityHelper=function(){return Promise.all([__webpack_require__.e(435),__webpack_require__.e(856),__webpack_(160),__webpack_require_(856),__webpack_requirer=function(){return Prire__,45181))},E.lS.getCreatorHelper=function(){return Promise.all([__webpack_require__.e(435),__webpack_require__.e(856),__webpack_require__.e(479),__webpack_require__.e(850),__webpack_require__.e(139),__webpack_require__.e(987),__webpack_require__.e(699)]).then(__webpack_require__.bind(__webpack_require__,98821))},E.lS.getEmbeddedHelper=function(){return Promise.all([__webpack_require__.e(435),__webpack_require__.e(856),__webpack_require__.e(479),__webpack_require__.e(413),__webpack_require__.e(850),__webpack_require__.e(139),__webpack_require__.e(987),__webpack_require__.e(967),__webpack_require__.e(536),__webpack_require__.e(905)]).then(__webpack_require__.bind(__webpack_require__,72986))},new E.lS;var b=e.I.filterLoadTime(E.R2);b&&(t._g.entryRequestStart=b.requestStart,t._g.entryResponseEnd=b.requestStart+b.duration,t._g.entryLoadTime=b)}(),__webpack_exports__}()}));