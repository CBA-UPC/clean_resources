(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1689],{51389:38265:function(e,t,a){"use strict";a.d(t,{Z:function(){return ConnectForm}});var o=a(52322),r=a(47330),n=a(73235),i=a(66547),s=a(91210),l=a(26806);et c=(0,i.ZP)(_templateObject(),s.$);var u=a(86414),d=a(45152),m=a(56958);let p=Object.values(r.tw).map(;function ConnectForm(e){let{webhookEvents:t,webhookAuthType:a,webhookAuthValue:r,integrationSettings:n,children:i,url:s}=e,{workspace:g}=(0,d.cF)(),[,h]=l.Db(c),{name:f,Logo:k,webhookFormat:x}=n;return(0,o.jsxs)("form",{onSubmit:e=>{e.preventDefault(),m.A.promise(h({workspaceId:g.id,data:{name:f,auth:{type:a,value:r},events:null!=t?t:p,format:x,url:s}}).then(e=>{if(e.error)throw Error(e.error.message);u.Z.track("".concat(f.toLowerCase(),"_integration_connected"))}),{loading:"Connecting to ".concat(f,"..."),success:"Connected to ".concat(f),error:"Error connecting to ".concat(f)})},children:[i,(0,o.jsxs)("button",{className:"btn-white mt-5 w-full justify-center bg-white font-medium shadow",type:"submit",children:[(0,o.jsx)(k,{className:"mr-2 h-4 w-4"}),"Connect to ",f]})]})}},1991:function(e,t,a){"use strict";a.d(t,{$T:function(){return apiProjectVersionIdRoute},C2:function(){return apiAuthSsoAuditPortalRoute},CW:function(){return apiGuideVisitorsRoute},T6:function(){return apiIntegrationSalesforceSobjectsRoute},ZA:function(){return apiIntegrationMarketoProgramsRoute},e9:function(){return previewFlowFlowIdRoute},g5:function(){return apiAuthSsoPortalRoute},g9:function(){return apiIntegrationMarketoFieldsRoute},h7:function(){return apiEnrichmentRoute},iu:function(){return apiGuideTimeMeasurementsRoute},nt:function(){return previewCaptureIdRoute},p3:function(){return previewProjectIdRoute},u4:function(){return apiEdgeExportVisitorsRoute},xH:function(){return apiEdgeExportAccountsRoute}});let previewProjectIdRoute=e=>{let{id:t}=e;return"/preview/project/".concat(t)},previewFlowFlowIdRoute=e=>{let{flow_id:t}=e;return"/preview/flow/".concat(t)},previewCaptureIdRoute=e=>{let{id:t}=e;return"/preview/capture/".concat(t)},apiProjectVersionIdRoute=apiGuideVisitorsRoute=()=>"/api/guide/visitors",apiGuideTimeMeasurementsRoute=()=>"/api/guide/time-measurements",apiEnrichmentRoute=()=>"/api/enrichment",apiIntegrationSalesforceSobjectsRoute=()=>"/api/integration/salesforce/sobjects",apiIntegrationMarketoProgramsRoute=()=>"/api/integration/marketo/programs",apiIntegrationMarketoFieldsRoute=()=>"/api/integration/marketo/fields",apiEdgeExportVisitorsRoute=()=>"/api/edge/export/visitors",apiEdgeExportAccountsRoute=()=>"/api/edge/export/accounts",apiAuthSsoPortalRoute=()=>"/api/auth/sso/portal",apiAuthSsoAuditPortalRoute=,2307:function(e,t,a){"use strict";a.r(t),a.d(t,{default:);var o=a(52322),r=a(8583),n=a(2784),i=a(56958),s=a(40761),l=a(1991);let fetchProgramsFromMarketo=async e=>{let{id:t}=e,a=await fetch("".concat((0,l.ZA)(),"?id=").concat(t));if(!a.ok)return{result:[],success:!1};let o=await a.json();return o},fetchLeadFieldsFromMarketo=async e=>{let{webhookId:t}=e,a=await fetch("".concat((0,l.g9)(),"?id=").concat(t));if(!a.ok)return{result:[],success:!1};let o=await a.json();return{result:o.result[0].fields,success:!0}},createLeadFieldsInMarketo=async e=>{let{webhookId:t,request:a}=e,o=await fetch("".concat((0,l.g9)(),"?id=").concat(t),{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}});if(!o.ok){let e=await o.json();return{result:[],success:!1,error:e.error}}let r=await o.json();return r};var c=a(73022),u=a(38445),d=a(13710),MarketoQuick=e=>{let{objectName:t,webhook:a,logo:r,integrationName:l,afterCreateFields:m,autoMapField:p}=e,[g,h]=(0,n.useState)(!1),[f,k]=(0,n.useState)(!1),[x,b]=(0,n.useState)([]),[w,j]=(0,n.useState)(!1);async function handleNextCreateFields(e){j(!0);let t=c.VG.filter(,{success:o}=await createLeadFieldsInMarketo({webhookId:a.id,request:{input:t.filter(.map(e=>({displayName:e.label,name:e.name,description:e.description,dataType:e.type===c.zt.NUMBER?"integer":"string"}))}});j(!1),null==m||m(),o?(b(t),h(!1),k(!0)):(i.A.error("Failed to create fields."),h(!1),k(!1))}return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.Z,{objectName:t,integrationName:l,logo:r,onClick:()=>h(!0)}),(0,o.jsx)(d.Z,{name:l,logo:r,allowedFields:c.VG.filter(,handleNext:handleNextCreateFields,open:g,handleClose:()=>h(!1),loading:w}),(0,o.jsx)(u.Z,{open:f,handleClose:name:l,logo:r,handleNext:()=>{x.forEach(p),k(!1),h(!1)}})]})},m=a(27425),p=a(32517),g=a(18318),h=a(52934),f=a(77815);let useLoadMarketoFields=e=>{let{webhookId:t,onError:a}=e,[o,r]=(0,n.useState)(!1),[i,s]=(0,n.useState)([]),l=(0,n.useCallback)(()=>{if(!t)return;let e=!0;return r(!0),fetchLeadFieldsFromMarketo({webhookId:t}).then(async t=>{e&&(r(!1),t.success?s(t.result):a("Could not retrieve fields from Marketo"))}),()=>{e=!1}},[t,a]);return(0,n.useEffect)([l]),{fetching:o,fields:i,refresh:l}},useLoadMarketoPrograms=e=>{let{webhookId:t,onError:a}=e,[o,r]=(0,n.useState)(!1),[i,s]=(0,n.useState)([]);return(0,n.useEffect)(()=>{if(!t)return;let e=!0;return r(!0),fetchProgramsFromMarketo({id:t}).then(async t=>{e&&(r(!1),t.success?s(t.result):a("Could not retrieve programs from Marketo"))}),,[t,a]),{fetching:o,programs:i}};var k=a(20851),x=a(47128),b=a(91077);let stringifyMarketoConfig=e=>JSON.stringify(e);var w=a(47330),j=a(77512),v=a(38265);let S=[{heading:"Create an API Only User Role",link:"https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/users-and-roles/create-an-api-only-user-role.html"},{heading:"Create an API Only User",link:"https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/users-and-roles/create-an-api-only-user.html"},{heading:"Create a Custom Service",link:"https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/additional-integrations/create-a-custom-service-for-use-with-REST-api.html"},{heading:"Add your Custom Service ID and secret below",link:"https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/additional-integrations/create-a-custom-service-for-use-with-REST-api.html#credentials-for-api-access"},{heading:"Add your Identity and Endpoint URLs below",link:"https://developers.marketo.com/REST-api/base-url/"}],RequiredTextField=e=>{let{label:t,name:a,placeholder:r,textValue:n,setTextValue:i}=e;return(0,o.jsx)(j.oi,{placeholder:r,name:a,labelText:t,value:n,onChange:type:"text",required:!0,className:"w-full"})},C=["get-programs","get-lead-fields","describe-lead"];var y=a(5001),M=a(83408);let N=(0,M.hu)("debug:navattic:marketo"),stringifyParams=var R=a(64766),I=a(170);let F={name:"Marketo",screenshot:"https://www.navattic.com/img/marketo-dashboard.png",allowTestConnection:!0,webhookFormat:w.M8.Marketo,Logo:r.HdF,ConnectComponent:function(e){let{integrationSettings:t}=e,[a,i]=(0,n.useState)(""),[s,l]=(0,n.useState)(""),[c,u]=(0,n.useState)(""),[d,m]=(0,n.useState)(""),p=(0,n.useMemo)([a,s,c,d]);return(0,o.jsxs)(o.Fragment,{children:[S.map((e,t)=>(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsxs)("div",{className:"mb-1 text-base font-semibold",children:[t+1,". ",e.heading]}),(0,o.jsxs)("a",{className:"link flex items-center text-sm",target:"_blank",rel:"noreferrer",href:e.link,children:["Follow steps in Marketo documentation",(0,o.jsx)(r.h0n,{className:"ml-1 h-3 w-3"})]})]},e.heading)),(0,o.jsx)(v.Z,{webhookAuthType:w.H4.None,webhookAuthValue:p,integrationSettings:t,children:(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)(RequiredTextField,{label:"Client ID",name:"client-id",textValue:c,setTextValue:u,placeholder:"Your Custom Service Client ID"}),(0,o.jsx)(RequiredTextField,{label:"Client Secret",name:"client-secret",textValue:d,setTextValue:m,placeholder:"Your Custom Service Client Secret"}),(0,o.jsx)(RequiredTextField,{label:"Endpoint URL",name:"endpoint-url",textValue:a,setTextValue:i,placeholder:"https://<munchkin-id>.mktorest.com/rest"}),(0,o.jsx)(RequiredTextField,{label:"Identity URL",name:"identity-url",textValue:s,setTextValue:l,placeholder:"https://<munchkin-id>.mktorest.com/identity"})]})})]})},DevelopmentComponent:e=>{let[t,a]=(0,n.useState)("get-programs"),[r,s]=(0,n.useState)("{}"),[l,c]=(0,n.useState)(""),[u,d]=(0,n.useState)(0),{webhook:m}=e,onClick=async()=>{if(!t){(0,p.Rn)("Need to specify a method");return}let e=(0,k.OA)(r);if(!e){(0,p.Rn)("Invalid JSON body provided");return}i.A.promise((async()=>{let a=await fetch("/api/private/marketo",{method:y.Z.POST,headers:{"Content-Type":"application/json"},body:stringifyParams({method:t,webhookId:m.id,data:e})}),o=await a.text(),r=(0,k.OA)(o);r?(N.log(r),c(JSON.stringify(r,null,2))):c(o),d(a.status)})(),{loading:"Sending request to Marketo...",success:"Successfully hit Marketo endpoint",error:)};return(0,o.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,o.jsx)("label",{htmlFor:"select-method",className:"label-small",children:"Select method"}),(0,o.jsx)(g.Z,{selected:t,onChange:disabled:!1,items:C.map(}),(0,o.jsx)(j.gx,{id:"json-body",style:{fontFamily:"Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace"},labelText:"JSON body",className:"mt-3 w-full",value:r,onChange:s}),(0,o.jsx)("button",{className:"btn-blue my-3 w-full",onClick:onClick,children:"Send Test Request"}),(0,o.jsx)(j.gx,{id:"json-response",labelText:"Response",readOnly:!0,style:{fontFamily:"Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace"},className:"mt-3 w-full",value:l,placeholder:"Response goes here"}),u?(0,o.jsx)("label",{className:"label-base text-base text-gray-500",children:"Status: ".concat(u)}):null]})},ConfigurationComponent:e=>{var t;let{webhook:a,integrationSettings:s}=e,l=(0,k.OA)(a.config||""),[c,u]=(0,n.useState)(l||{fieldMap:{}}),[,d]=(0,h.I)(),{fields:w,fetching:j,refresh:v}=useLoadMarketoFields({webhookId:a.id,onError:p.Rn}),S=(0,n.useCallback)([w]),{programs:C,fetching:y}=useLoadMarketoPrograms({webhookId:a.id,onError:p.Rn}),[{data:M}]=(0,f.x)({variables:{workspaceId:a.workspaceId}}),onSave=async()=>{if(!c.program){(0,p.Rn)("Please select a program");return}return i.A.promise(d({id:a.id,config:stringifyMarketoConfig(c)}).then(e=>{if(null==e?void 0:e.error)throw Error("Error saving: ".concat(e.error.message))}),{success:"Saved Marketo configuration!",loading:"Saving Marketo configuration...",error:)};return(0,o.jsxs)("div",{className:"mx-auto max-w-[440px]",children:[(0,o.jsx)("label",{className:"label-small",children:"Program"}),y?(0,o.jsxs)("div",{className:"mt-2 flex flex-row items-center justify-center space-x-2 text-sm text-gray-500",children:[(0,o.jsx)(r.L4p,{className:"h-3 w-3"}),(0,o.jsx)("span",{children:"Loading programs..."})]}):(0,o.jsx)(g.Z,{items:C.map(,selected:c.program?{id:c.program.id.toString(),name:null===(t=c.program)||void 0===t?void 0:t.name}:void 0,selectFirstItem:!0,onChange:e=>u(t=>({...t,program:{id:parseInt(e.id),name:e.name}})),placeHolder:"Select program",renderSelectedIcon:),(0,o.jsx)(MarketoQuick,{objectName:"Leads",logo:s.Logo,integrationName:s.name,webhook:a,afterCreateFields:v,autoMapField:e=>{u(t=>{var a;return{...t,fieldMap:{...t.fieldMap,[e.name]:(null===(a=S(e))||void 0===a?void 0:a.name)||""}}})}}),(null==M?void 0:M.formFieldMetadata)&&(0,o.jsx)(m.Z,{title:"Leads",toIcon:s.Logo,preventDuplicates:!0,fromIcon:()=>(0,o.jsx)(b.H,{className:"shrink-0",white:!1,height:15}),fromOptions:(0,x.E)(M.formFieldMetadata).map(e=>({label:e.name,value:e.id})),toOptions:w.map(,mappings:Object.entries(c.fieldMap||{}).map((e,t)=>{let[a,o]=e;return{id:t.toString(),from:a,to:o}}),onChange:e=>u(t=>({...t,fieldMap:Object.fromEntries(e.map()}))}),(0,o.jsxs)("button",{onClick:onSave,className:"btn-white mt-7 w-full justify-center bg-white font-medium shadow",children:[(0,o.jsx)(s.Logo,{className:"mr-2"}),"Save configuration"]})]})}};arketoIntegrationPage.getLayout=var E=MarketoIntegrationPage}},);
//# sourceMappingURL=marketo-200d538424b45f79.js.map