!function($,f){function e(){}var m={},F=("undefined"==typeof console&&(console={log:e,debug:e,error:e,info:e}),m.addEvent=function(e,t,n){return e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},m.removeEvent=function(e,t,n){return e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},m.preventDefault=m.onReady=function(e,t){e.document&&"complete"===e.document.readyState?t():e.document&&e.document.addEventListener?e.document.addEventListener("DOMContentLoaded",t,!1):e.attachEvent?e.attachEvent("onload",t):$.onload=t},m.unescapeHtml=function(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":(e=t.childNodes[0]?t.childNodes[0].nodeValue:"",(e+=t.childNodes[1]?t.childNodes[1].outerHTML:"")+(t.childNodes[2]?t.childNodes[2].outerHTML:""))},m.insertAfter=m.insertBefore=m.moveChildren=function(e,t){if(e!==t)for(;e.hasChildNodes();)t.appendChild(e.firstChild)},m.documentFragmentInnerHtml=function(e,t){var n=document.createElement("div");n.innerHTML=t,m.moveChildren(n,e)},m.isDocumentFragment=m.containerInnerHtml=function(e,t){m.isDocumentFragment(e)?m.documentFragmentInnerHtml(e,t):e.innerHTML=t},m.executeScriptsForScriptTags=function(e){var n,r;e.length&&(n=/^$|\/(?:java|ecma)script/i,r=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,m.each(e,function(e){g.log("_:executeScript",e);var t=e.ownerDocument;n.test(e.type||"")&&(e.src?m.globalEvalScript(e.src,t):m.globalEvalCode(e.textContent.replace(r,""),t))}))},m.executeScripts=m.executeScriptsForNodes=m.replaceChildren=function(e,t){m.isElement(t)||m.isDocumentFragment(t)?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t},m.getNodesArray=function(e){var t=[];return e.hasChildNodes()&&m.each(e.childNodes,function(e){t.push(e)}),t},m.getElementsByTagNameIncludesItself=function(e,t){t=t.toLowerCase(),Array.isArray(e)||(e=[e]);var n=[];return m.each(e,function(e){e&&e.tagName&&(e.tagName.toLowerCase()===t&&n.push(e),(e=e.getElementsByTagName(t)).length)&&m.each(e,function(e){n.push(e)})}),n},m.globalEvalCode=m.globalEvalScript=function(e,t){var n=(t=t||document).createElement("script");n.src=e,t.head.appendChild(n)},m.inArray=function(e,t,n){var r="";if(!!n){for(r in t)if(t.hasOwnProperty(r)&&t[r]===e)return!0}else for(r in t)if(t.hasOwnProperty(r)&&t[r]==e)return!0;return!1},m.isDocumentVisible=),{objects:[],_timerObject:function(e){this.label=e,this.time=(new Date).getTime(),this.getLabel=function(){return this.label},this.getElapsedTime=function(){return(new Date).getTime()-this.time},this.getElapsedTimeString=function(){return this.getElapsedTime()+" ms"},this.getTime=function(){return this.time},this.log=function(){F.log(this)}},create:function(e){var t=new this._timerObject(e);return this.objects[e]=t},get:function(e){return void 0===this.objects[e=void 0!==e&&e?e:"__main__"]&&(this.objects[e]=new this._timerObject(e)),this.objects[e]},log:function(e){g.log('Timer "'+e.getLabel()+'" took '+e.getElapsedTimeString())}}),h={_promiseHandlers:{},_persistentPromiseHandlers:{},_emptyElement:document.createDocumentFragment(),encodeString:function(e,t){return("function"==typeof encodeURIComponent?t?encodeURI:encodeURIComponent:escape)(e)},prepareTimeForDate:function(e,t){t=t?new Date(t.getTime()):new Date;e=e.split(":");return t.setHours(e[0]),t.setMinutes(e[1]),t.setSeconds(e[2]),t},DOMTokenListSupports:function(e,t){if(e&&e.supports)try{return e.supports(t)}catch(e){g.log("The DOMTokenList doesn't have a supported tokens list")}},addStyles:function(r){return new Q(function(e,t){if(g.log("Utils:addStyles"),!r)return e(null);Array.isArray(r)||(r=[r]);var n=h.DOMTokenListSupports(document.createElement("link").relList,"preload");m.each(r,function(e){n&&((t=document.createElement("link")).setAttribute("rel","preload"),t.setAttribute("as","style"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t));var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t)}),e(r)})},uniquePromiseHandler:function(t,n){var e;return h._promiseHandlers[t]||(e=new Q(n),(h._promiseHandlers[t]=e).then(function(){g.log("Utils:uniquePromiseHandler then",t,n),delete h._promiseHandlers[t]}).catch(function(e){g.log("Utils:uniquePromiseHandler catch",t,n,e),delete h._promiseHandlers[t]}),e)},persistentPromiseHandler:addClass:removeClass:function(e,t){h.hasClass(e,t)&&(e.className=e.className.replace(new RegExp("\\b"+t+"\\b","g"),""))},hasClass:function(e,t){return!!e.className.match(new RegExp("\\b"+t+"\\b","g"))},attachHandlerForElements:function(e,n,r,i){g.log("Utils:attachHandlerForElements",e.length,e),0<e.length&&m.each(e,function(t,e){h.addEvent(t,n,function(e){g.log("Utils:attachHandlerForElements on event ",n,e,this,t),!1!==i&&m.preventDefault(e),r(e)})})},attachHandlerByClassName:function(e,t,n,r,i){e=e.getElementsByClassName(t);h.attachHandlerForElements(e,n,r,i)},attachHandlerByQuerySelectorAll:function(e,t,n,r,i){e=e.querySelectorAll(t);h.attachHandlerForElements(e,n,r,i)},timer:F,hashString:function(e){var t=0;if(0!==e.length)for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n);t&=t}return t},getBoundingClientRect:function(e){if(e.getBoundingClientRect)return e.getBoundingClientRect();if(document.createRange&&e.nodeType===Node.TEXT_NODE){var t=document.createRange();if(t.selectNodeContents(e),t.getBoundingClientRect)return t.getBoundingClientRect()}return null},isVisibleOnScreen:isVisibleOnScreenForViewHeight:function(e,t){e=h.getBoundingClientRect(e);return!(!e||0===e.top&&0===e.left&&0===e.width&&0===e.height||e.left<0&&e.right<0||e.bottom<0||0<=e.top-t)},isVisibleAtLeastOneElementOnScreen:function(e){if(e){Array.isArray(e)||(e=[e]);var t,n=h.getWindowHeight();for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(r&&h.isVisibleOnScreenForViewHeight(r,n))return g.info("Utils:isVisibleAtLeastOneElementOnScreen element is visible on screen",r),!0}}return!1},getWindowHeight:function(){return Math.max($.innerHeight,document.documentElement.clientHeight,0)},getWindowYScroll:getDocumentHeight:getScrollPercentage:function(){return(h.getWindowYScroll()+h.getWindowHeight())/h.getDocumentHeight()*100},debounce:escapeHTML:generateUUID:function(){var i=(new Date).getTime();return $.performance&&"function"==typeof $.performance.now&&(i+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){t=i;var t,n,r=(r=$.crypto||$.msCrypto)&&"function"==typeof r.getRandomValues?(n=new Uint32Array(1),r.getRandomValues(n),(t+n[0])%16|0):(t+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==e?r:3&r|8).toString(16)})},validateUUID:validateSelector:addEvent:function(t,e,n){return"click"===e?m.addEvent(t,e,:m.addEvent(t,e,n)},removeEvent:uint8ArrayToBase64Url:function(e,t,n){return t=t||0,n=n||e.byteLength,$.btoa(String.fromCharCode.apply(null,e.subarray(t,n))).replace(/\=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},atou:utoa:,p={_enabled:!1,_events:[],_startTime:null,_groupUuid:null,_intervalId:null,_delayTimeoutId:null,_maxEventCount:25,_logingConditions:[],LEVEL:{fatal:"fatal",error:"error",info:"info",debug:"debug"},TYPE:{general:"general",request:"request",log:"log",click:"click",lost:"lost"},SCOPE:{inner:"inner",outer:"outer"},init:function(e){p._startTime=(e=e||{}).startTime||(new Date).getTime(),p._groupUuid=h.generateUUID(),p._attachWindowErrorListener(),p._logingConditions=[{level:p.LEVEL.fatal,scope:p.SCOPE.inner},{level:p.LEVEL.error,type:p.TYPE.request,scope:p.SCOPE.inner}],o.init()},setEnabled:function(e){p._enabled=e},callFunctionAndLogError:function(e,t,n){var r,i,o;for(o in e.apply(this,t),t)if(t[o]instanceof Error){r=t[o];break}"string"==typeof t[0]&&(i=t[0]),r?(e=p._prepareEventFromError(r,p.TYPE.general,n),i&&(e.msg=i+" "+e.msg),p.handleEvent(e)):p.handleError(new Error(i||"Unknown error dump message"),p.TYPE.general,n)},handleError:handleClick:function(e){p.handleEvent(p._prepareEventFromElement(e,p.TYPE.click,p.LEVEL.info,p.SCOPE.inner))},handleEvent:handleFetch:function(t,e){var n,r=(new Date).getTime();return e.then(function(e){return n=200===e.status||201===e.status||0===e.status?m.extend(p._prepareEventDataFromRequest(t),{level:p.LEVEL.info,type:p.TYPE.request,msg:"Fetch request succeeded",statusCode:e.status}):m.extend(p._prepareEventDataFromRequest(t),{level:p.LEVEL.error,type:p.TYPE.request,name:"Fetch request fail",msg:e.statusText,stack:(new Error).stack,statusCode:e.status}),e}).catch(function(e){return n=m.extend(p._prepareEventDataFromRequest(t),p._prepareEventFromError(e,p.TYPE.request)),Q.reject(e)}).finally(function(){n.requestDuration=(new Date).getTime()-r,p.handleEvent(n)})},sendEvents:function(){p._sendEventsToSender(),p._attachDelayAndSendFewEventsAfterTriggered()},_sendEventsToSender:function(){var e=[].concat(p._events);p._enabled&&o.sendEvents(e),p._events=[]},_attachDelayAndSendFewEventsAfterTriggered:function(){p._delayTimeoutId&&(clearTimeout(p._delayTimeoutId),p._delayTimeoutId=null),p._delayTimeoutId=setTimeout(function(){p._sendEventsToSender()},15)},_prepareEventFromElement:function(e,t,n,r){var i=e.nodeName||null,e=e.className||null;return{level:n||p.LEVEL.error,type:t||p.TYPE.general,scope:r||p.SCOPE.inner,name:"NodeEvent",msg:'Action on "'+(i||"unknown")+'" node with class name "'+(e||"")+'"',nodeName:"string"==typeof i?i.toLowerCase():null,className:e}},_prepareEventFromError:function(e,t,n,r){var i=e.stack,o=e.toString();return{level:n||p.LEVEL.error,type:t||p.TYPE.general,scope:r||p.SCOPE.inner,name:e.name,msg:o,stack:i}},_prepareEventDataFromRequest:_pushEvent:function(e){p._applyEventsLimit(),p._events.push(e),p._checkConditionsAndSend(e)},_checkConditionsAndSend:_checkConditions:function(e){if(e.level!==p.LEVEL.error||e.type!==p.TYPE.request||-1===(e.url||"").indexOf("web-push/get-public-config"))for(var t in p._logingConditions)if(p._logingConditions.hasOwnProperty(t)){t=p._logingConditions[t];if(p._checkCondition(e,t))return!0}return!1},_checkCondition:_applyEventsLimit:function(){var e;p._events.length>=p._maxEventCount&&((e=p._events.shift()).type===p.TYPE.lost?(p._events.shift(),e.lostCount++,p._events.unshift(e)):(e=p._checkAndRichEvent({level:p.LEVEL.info,type:p.TYPE.lost,name:"LostEventsLimitAchieved",msg:"First lost event message: "+e.msg,lostCount:1}),p._events.splice(0,1,e)))},_attachWindowErrorListener:function(){h.addEvent($,"error",function(e){e.error&&p.handleError(e.error,p.TYPE.general,p.LEVEL.error,p.SCOPE.outer)})},_checkAndRichEvent:function(e){var t;if(e&&e.level&&e.type)return e.clientUuid||(t=d.getClientFromStore())&&(e.clientUuid=t.uuid,e.clientPermUuid=t.permUuid),void 0===e.scrollPercentage&&(e.scrollPercentage=h.getScrollPercentage()),e.time||(t=(new Date).getTime(),e.startTime=p._startTime,e.time=t,e.elapsedTime=t-p._startTime),e.groupUuid||(e.groupUuid=p._groupUuid),e.eventUuid||(e.eventUuid=h.generateUUID()),e.scope||(e.scope=p.SCOPE.inner),e.href||(e.href=$.location.href),e.source="sdk-js",e.sdkVersion=b.getVersion(),e.sdkModule=b.getModuleName(),e.sdkBuildTime=b.getBuildTime(),e;throw new Error("Invalid event to handle by error handler")}},o={_logsToSend:[],_eventLost:null,_intervalId:null,_intervalMs:2e3,_timeout:4e3,_localStorageLogsKey:"_snrs_error_logs",_maxLogsCount:100,LEVEL:{fatal:"fatal",error:"error",info:"info",debug:"debug"},TYPE:{general:"general",request:"request",log:"log",click:"click",lost:"lost"},init:sendEvents:function(e){e=o._applyLogsLimit(e);o._logsToSend=o._logsToSend.concat(e)},_attachHandlers:function(){$.onbeforeunload=function(){o._storeLogs()},o._attachLoggingOnMouseExit()},_attachLoggingOnMouseExit:function(){h.addEvent(document,"mouseout",function(e){e.clientY<=0&&setTimeout(function(){o.flush()},10)})},_applyLogsLimit:function(e){var t,n,r,i=e;return e.length>o._maxLogsCount?(i=e.slice(e.length-o._maxLogsCount+1),t=e.slice(0,e.length-o._maxLogsCount+1),n=o._logsToSend[0]||t[0],n=p._checkAndRichEvent({level:p.LEVEL.info,type:p.TYPE.lost,name:"LostLogsToSendLimitAchieved",msg:"First lost event message: "+n.msg,lostCount:t.length+o._logsToSend.length}),o._logsToSend=[n]):o._logsToSend.length+e.length>o._maxLogsCount&&((t=o._logsToSend[0]).type===p.TYPE.lost&&"LostLogsToSendLimitAchieved"===t.name?(i=e.slice(e.length-o._maxLogsCount+1),r=o._logsToSend.length+i.length-o._maxLogsCount,o._logsToSend=o._logsToSend.slice(r+1),o._logsToSend.unshift(t),t.lostCount+=r):(n=p._checkAndRichEvent({level:p.LEVEL.info,type:p.TYPE.lost,name:"LostLogsToSendLimitAchieved",msg:"First lost event message: "+t.msg,lostCount:r}),r=o._logsToSend.length+e.length-o._maxLogsCount,o._logsToSend=o._logsToSend.slice(r+1),o._logsToSend.unshift(n))),i},flush:function(){o._logsToSend.length&&l.checkAuth()&&o._requestLogs(function(){})},_requestLogs:function(e){var t=[].concat(o._logsToSend);o._logsToSend=[],o._requestWithLimits(t,e)},_request:function(e,t){var n=P.trackingDomain+P.trackerLogsUrl,r=new XMLHttpRequest;r.open("POST",n,!0),r.withCredentials=!0,r.timeout=o._timeout,r.setRequestHeader(l.getHeaderAuth("key"),l.getHeaderAuth("value")),r.setRequestHeader("Content-type","application/json"),r.ontimeout=function(e){},r.onabort=function(e){},r.onerror=function(e){},r.onreadystatechange=r.send(JSON.stringify(e))},_requestWithLimits:function(e,t){n.request(},_startLogging:_setToLocalStore:_getFromLocalStore:_getAndRemoveFromLocalStore:function(){var e=I.getString(o._localStorageLogsKey);return e?(I.remove(o._localStorageLogsKey),JSON.parse(e)):null},_storeLogs:function(){var e,t=[].concat(o._logsToSend);o._logsToSend=[],t.length&&((e=o._getFromLocalStore())&&e.length,o._setToLocalStore(t))},_restoreLogs:function(){var e=o._getAndRemoveFromLocalStore();e&&e.length&&o.sendEvents(e)}},n={_locked:!1,_lockedTimeEnd:null,_count:0,_countAll:0,_maxCount:10,_maxCountAll:100,_timeMs:1e4,_localStorageLimitAchievedKey:"_snrs_logs_limit_achieved",_lockForTimeMs:18e4,init:function(e){n._startThrottling()},request:function(e){n._checkAndLock()||(n._count++,n._countAll++,e())},_startThrottling:function(){var e=n._checkAndRemoveLockTimeFromStoreIfExpired();e&&n._lock(e),setInterval(n._timeMs)},_checkAndLock:function(){return!!n._locked||(n._count>n._maxCount||n._countAll>n._maxCountAll)&&(n._lockAndStore(),!0)},_lock:function(e){e=e||(new Date).getTime()+n._lockForTimeMs,n._locked=!0,n._lockedTimeEnd=e,n._setUnlockTimer(n._lockedTimeEnd)},_lockAndStore:_unlockAndStore:function(){n._locked=!1,n._lockedTimeEnd=null,n._count=0,n._countAll=0,n._checkAndRemoveLockTimeFromStoreIfExpired()},_checkAndRemoveLockTimeFromStoreIfExpired:function(){var e=n._getTimeFromLocalStore();return e&&e-(new Date).getTime()<=0?(I.remove(I._localStorageLimitAchievedKey),null):e},_setUnlockTimer:function(e){e-=(new Date).getTime();0<e?setTimeout(function(){n._unlockAndStore()},e):setTimeout(function(){n._unlockAndStore()},10)},_setTimeToLocalStore:function(e){I.setString(I._localStorageLimitAchievedKey,e+"")},_getTimeFromLocalStore:function(){var e=I.getString(I._localStorageLimitAchievedKey);return!e||(e=parseInt(e,10),isNaN(e))?null:e}},t=h.timer.get(),W={},U=(function(){var O=f,A=f,e=f;=this,i=function(e){"use strict"; t(e){null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault)&&e.event.preventDefault():"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener)}nction p(n,e){ar r=Object.keys(e);if(0===r.length)return n;t.prototype=Object.create(n.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var i,o,s=0;s<r.length;++s)(o=r[s])in n.prototype||(i="function"==typeof Object.getOwnPropertyDescriptor(e,o).value,Object.defineProperty(t.prototype,o,(i?function(t){return{value:configurable:!0,enumerable:!0}}:h)(o)));return t}function g(e,t){return new(function e(t){var n;return null==t||t===Object.prototype?d:(null==(n=C.get(t))&&(n=p(e(Object.getPrototypeOf(t)),t),C.set(t,n)),n)}(Object.getPrototypeOf(t)))(e,t)}nction b(e){e=w.get(e);if(null==e)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return e}function y(e,t){var i;Object.defineProperty(e,"on".concat(t),(i=t,{get:set:function(e){"function"==typeof e||m(e)||(e=null);for(var t=b(this),n=null,r=t.get(i);null!=r;)3===r.listenerType?null===n?null===r.next?t.delete(i):t.set(i,r.next):n.next=r.next:n=r,r=r.next;null!==e&&(e={listener:e,listenerType:3,passive:!1,once:!1,next:null},null===n?t.set(i,e):n.next=e)},configurable:!0,enumerable:!0}))}unction v(){if(!(this instanceof v)){if(1===arguments.length&&Array.isArray(arguments[0]))return n(arguments[0]);if(0<arguments.length){for(var e=Array(arguments.length),t=0;t<arguments.length;++t)e[t]=arguments[t];return n(e)}throw new TypeError("Cannot call a class as a function")}w.set(this,new Map)}ar S=new WeakMap,C=new WeakMap,w=(d.prototype={get typeget target(){return l(this).eventTarget},get currentTarget(){return l(this).currentTarget},composedPath:get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return l(this).eventPhase},stopPropagation:stopImmediatePropagation:get bubbles(){return!!l(this).event.bubbles},get cancelable(){return!!l(this).event.cancelable},preventDefault:get defaultPrevented(){return l(this).canceled},get composedget timeStamp(){return l(this).timeStamp},get srcElement(){return l(this).eventTarget},get cancelBubbleset cancelBubble(e){e&&((e=l(this)).stopped=!0,"boolean"==typeof e.event.cancelBubble)&&(e.event.cancelBubble=!0)},get returnValueset returnValueinitEvent:function(){}},Object.defineProperty(d.prototype,"constructor",{value:d,configurable:!0,writable:!0}),void 0!==$&&void 0!==$.Event&&(Object.setPrototypeOf(d.prototype,$.Event.prototype),C.set($.Event.prototype,d)),new WeakMap),E=(v.prototype={addEventListener:function(e,t,n){if(null!=t){if("function"!=typeof t&&!m(t))throw new TypeError("'listener' should be a function or an object.");var r=b(this),i=m(n),o=(i?!!n.capture:!!n)?1:2,i={listener:t,listenerType:o,passive:i&&!!n.passive,once:i&&!!n.once,next:null},s=r.get(e);if(void 0===s)r.set(e,i);else{for(var a=null;null!=s;){if(s.listener===t&&s.listenerType===o)return;s=(a=s).next}a.next=i}}},removeEventListener:function(e,t,n){if(null!=t)for(var r=b(this),i=(m(n)?!!n.capture:!!n)?1:2,o=null,s=r.get(e);null!=s;){if(s.listener===t&&s.listenerType===i)return void(null===o?null===s.next?r.delete(e):r.set(e,s.next):o.next=s.next);s=(o=s).next}},dispatchEvent:function(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');var t=b(this),n=e.type,r=t.get(n);if(null==r)return!0;for(var i,o=g(this,e),s=null;null!=r;){if(r.once?null===s?null===r.next?t.delete(n):t.set(n,r.next):s.next=r.next:s=r,f(o,r.passive?r.listener:null),"function"==typeof r.listener)try{r.listener.call(this,o)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==r.listenerType&&"function"==typeof r.listener.handleEvent&&r.listener.handleEvent(o);if(l(o).immediateStopped)break;r=r.next}return f(o,null),i=0,l(o).eventPhase=i,i=null,l(o).currentTarget=i,!o.defaultPrevented}},Object.defineProperty(v.prototype,"constructor",{value:v,configurable:!0,writable:!0}),void 0!==$&&void 0!==$.EventTarget&&Object.setPrototypeOf(v.prototype,$.EventTarget.prototype),function(){ar t=e,n=v;if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");return t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&c(t,n),s(e,[{key:"aborted",get:]),e}()),T=(y(E.prototype,"abort"),new WeakMap),P=(Object.defineProperties(E.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"===r(Symbol.toStringTag)&&Object.defineProperty(E.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"}),s(I,[{key:"abort",value:,{key:"signal",get:]),I),k=new WeakMap;function I(){var e;i(this,I),k.set(this,(e=Object.create(E.prototype),v.call(e),T.set(e,!1),e))}Object.defineProperties(P.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"===r(Symbol.toStringTag)&&Object.defineProperty(P.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"}),e.AbortController=P,e.AbortSignal=E,e.default=P,Object.defineProperty(e,"__esModule",{value:!0}),void 0===A&&void 0===O&&void 0===(e=Function("return this")()).AbortController&&(e.AbortController=P,e.AbortSignal=E)},"object"==typeof e&&void 0!==A?i(e):"function"==typeof O&&O.amd?O(["exports"],i):i((c=c||self).AbortControllerShim={}),i=this,c=function(){"use strict";otype.append=s.prototype.delete=s.prototype.get=s.prototype.getAll=s.prototype.has=s.prototype.set=s.prototype.forEach=var a={blob:"FileReader"in self&&"Blob"in self&&),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};function t(){return this.bodyUsed=!1,this._initBody=function(e){if("string"==typeof(this._bodyInit=e))this._bodyText=e;else if(a.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(a.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(e){if(!a.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText=""},a.blob?(this.blob=this.arrayBuffer=function(){return this.blob().then(e)},this.text=function(){var e,t=n(this);if(t)return t;if(this._bodyBlob)return t=this._bodyBlob,(e=new FileReader).readAsText(t),o(e);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Q.resolve(this._bodyText)}):this.text=a.formData&&(this.formData=,this.json=this}var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function u(e,t){var n,r=(t=t||{}).body;if(u.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new s(e.headers)),this.method=e.method,this.mode=e.mode,r||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new s(t.headers)),this.method=(e=t.method||this.method||"GET",n=e.toUpperCase(),-1<c.indexOf(n)?n:e),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}unction d(e,t){t=t||{},this._initBody(e),this.type="default",this.status=t.status,this.ok=200<=this.status&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof s?t.headers:new s(t.headers),this.url=t.url||""}u.prototype.clone=t.call(u.prototype),t.call(d.prototype),d.prototype.clone=d.error=var h=[301,302,303,307,308];return d.redirect={fetch:Z=function(t,n){return new Q(function(r,i){var e=u.prototype.isPrototypeOf(t)&&!n?t:new u(t,n),o=new XMLHttpRequest;o.onload=function(){var n,e,t=1223===o.status?204:o.status;t<100||599<t?i(new TypeError("Network request failed")):(t={status:t,statusText:o.statusText,headers:(t=o,n=new s,t.getAllResponseHeaders().trim().split("\n").forEach(,n),url:"responseURL"in o?o.responseURL:/^X-Request-URL:/m.test(o.getAllResponseHeaders())?o.getResponseHeader("X-Request-URL"):void 0},e="response"in o?o.response:o.responseText,r(new d(e,t)))},o.onerror=function(){i(new TypeError("Network request failed"))},o.open(e.method,e.url,!0),"include"===e.credentials&&(o.withCredentials=!0),"responseType"in o&&a.blob&&(o.responseType="blob"),e.headers.forEach(,o.send(void 0===e._bodyInit?null:e._bodyInit)})},Request:u,Headers:s}},"object"==typeof e&&void 0!==A?A.exports=c():"function"==typeof O&&O.amd?O(c):i.ES6Fetch=c(),i=this,c=function(){"use strict";var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)},h=function(){return(h=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};=Error,n(e=i,v=r),e.prototype=null===v?Object.create(v):(t.prototype=v.prototype,new t);var e,r,l=i;function t(){this.constructor=e}function i(e,t){t=r.call(this,t)||this;return t.code=e,t.name="FirebaseError",Object.setPrototypeOf(t,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,g.prototype.create),t}o.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r,i=t[0]||{},o=this.service+"/"+e,e=this.errors[e],e=e?(r=i,e.replace(d,function(e,t){var n=r[t];return null!=n?n.toString():"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+o+").",s=new l(o,e),a=0,c=Object.keys(i);a<c.length;a++){var u=c[a];"_"!==u.slice(-1)&&(u in s&&console.warn('Overwriting FirebaseError base field "'+u+'" can cause unexpected behavior.'),s[u]=i[u])}return s};var g=o;function o(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var d=/\{\$([^}]+)}/g;unction m(e,t){e=new a(e,t);return e.subscribe.bind(e)}c.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},c.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},c.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},c.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e){if("object"==typeof e&&null!==e)for(var t=0,n=["next","error","complete"];t<n.length;t++){var r=n[t];if(r in e&&"function"==typeof e[r])return 1}}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=u),void 0===r.error&&(r.error=u),void 0===r.complete&&(r.complete=u);e=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),e},c.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount)&&void 0!==this.onNoObservers&&this.onNoObservers(this)},c.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},c.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},c.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))};var s,a=c;function c(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Q.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}function u(){}v=s=s||{})[v.DEBUG=0]="DEBUG",v[v.VERBOSE=1]="VERBOSE",v[v.INFO=2]="INFO",v[v.WARN=3]="WARN",v[v.ERROR=4]="ERROR",v[v.SILENT=5]="SILENT";var y=s.INFO,v=(Object.defineProperty(_.prototype,"logLevel",{get:function(){return this._logLevel},set:enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"logHandler",{get:function(){return this._logHandler},set:enumerable:!0,configurable:!0}),_.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,s.DEBUG].concat(e))},_.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,s.VERBOSE].concat(e))},_.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,s.INFO].concat(e))},_.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,s.WARN].concat(e))},_.prototype.error=_);ar S=new g("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),C="[DEFAULT]",w=[],E=(Object.defineProperty(T.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:enumerable:!0,configurable:!0}),Object.defineProperty(T.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(T.prototype,"options",{get:enumerable:!0,configurable:!0}),T.prototype.delete=T.prototype._getService=function(e,t){var n;return void 0===t&&(t=C),this.checkDestroyed_(),this.services_[e]||(this.services_[e]={}),this.services_[e][t]||(n=t!==C?t:void 0,n=this.firebase_.INTERNAL.factories[e](this,this.extendApp.bind(this),n),this.services_[e][t]=n),this.services_[e][t]},T.prototype._removeServiceInstance=T.prototype.extendApp=T.prototype.checkDestroyed_=T);.prototype.name&&E.prototype.options||E.prototype.delete||console.log("dc");var P=new v("@firebase/app"),v=("object"==typeof self&&self.self===self&&void 0!==self.firebase&&(P.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  "),v=self.firebase.SDK_VERSION)&&0<=v.indexOf("LITE")&&P.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    "),function e(){s=E,r={},c={},(u={__esModule:!0,initializeApp:function(e,t){var t=t="object"==typeof(t=void 0===t?{}:t)&&null!==t?t:{name:t},n=(void 0===t.name&&(t.name=C),t.name);if("string"!=typeof n||!n)throw S.create("bad-app-name",{appName:String(n)});if(f(r,n))throw S.create("duplicate-app",{appName:n});e=new s(e,t,u);return i(r[n]=e,"create"),e},app:l,apps:null,SDK_VERSION:"6.6.2",INTERNAL:{registerService:function(n,e,t,r,i){return void 0===i&&(i=!1),a[n]?(P.debug("There were multiple attempts to register service "+n+"."),u[n]):(a[n]=e,r&&(c[n]=r,d().forEach(),void 0!==t&&p(o,t),u[n]=o,s.prototype[n]=o);function o(e){if("function"!=typeof(e=void 0===e?l():e)[n])throw S.create("invalid-app-argument",{appName:n});return e[n]()}},removeApp:factories:a={},useAsService:o}}).default=u,Object.defineProperty(u,"apps",{get:d}),l.App=s;var s,r,a,c,u,t=u;rn t.INTERNAL=h({},t.INTERNAL,{createFirebaseNamespace:e,extendNamespace:function(e){p(t,e)},createSubscribe:m,ErrorFactory:g,deepExtend:p}),t}()),k=v.initializeApp;return v.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){}}()&&P.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),k.apply(void 0,e)},v},"object"==typeof e&&void 0!==A?A.exports=c():"function"==typeof O&&O.amd?O(c):(i=i||self).firebase=c(),i=this,c=function(z){"use strict";try{!function(){z=z&&z.hasOwnProperty("default")?z.default:z;var r=ar o=i,n=Error);var n,F=i;function i(e,t){t=n.call(this,t)||this;return t.code=e,t.name="FirebaseError",Object.setPrototypeOf(t,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,s.prototype.create),t}t.prototype.create=var s=t;ar W=/\{\$([^}]+)}/g;.prototype.next=h.prototype.error=h.prototype.complete=h.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=e)?e:{next:e,error:t,complete:n}).next&&(r.next=p),void 0===r.error&&(r.error=p),void 0===r.complete&&(r.complete=p);e=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(,this.observers.push(r),e},h.prototype.unsubscribeOne=h.prototype.forEachObserver=h.prototype.sendOne=h.prototype.close=var c,u,U=h;unction p(){}var g=new s("messaging","Messaging",{"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","should-be-overriden":"This method should be overriden by extended classes.","bad-sender-id":"Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().","permission-default":"The required permissions were not granted and dismissed instead.","permission-blocked":"The required permissions were not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the firebase SDK.","notifications-blocked":"Notifications have been blocked.","failed-serviceworker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","sw-registration-expected":"A service worker registration was the expected input.","get-subscription-failed":"There was an error when trying to get any existing Push Subscriptions.","invalid-saved-token":"Unable to access details of the saved token.","sw-reg-redundant":"The service worker being used for push was made redundant.","token-subscribe-failed":"A problem occured while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-subscribe-no-push-set":"FCM returned an invalid response when getting an FCM token.","token-unsubscribe-failed":"A problem occured while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occured while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-before-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-delete-token":"You must pass a valid token into deleteToken(), i.e. the token from getToken().","delete-token-not-found":"The deletion attempt for token could not be performed as the token was not found.","delete-scope-not-found":"The deletion attempt for service worker scope could not be performed as the scope was not found.","bg-handler-function-expected":"The input to setBackgroundMessageHandler() must be a function.","no-window-client-to-msg":"An attempt was made to message a non-existant window client.","unable-to-resubscribe":"There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}","no-fcm-token-for-resubscribe":"Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.","failed-to-delete-token":"Unable to delete the currently saved token.","no-sw-in-reg":"Even though the service worker registration was successful, there was a problem accessing the service worker itself.","bad-scope":"The service worker scope must be a string with at least one character.","bad-vapid-key":"The public VAPID key is not a Uint8Array with 65 bytes.","bad-subscription":"The subscription must be a valid PushSubscription.","bad-token":"The FCM Token used for storage / lookup was not a valid token string.","bad-push-set":"The FCM push set used for storage / lookup was not not a valid push set string.","failed-delete-vapid-key":"The VAPID key could not be deleted.","invalid-public-vapid-key":"The public VAPID key must be a string.","use-public-key-before-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.","public-vapid-key-decryption-failed":"The public VAPID key did not equal 65 bytes when decrypted."}),f=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),m="https://fcm.googleapis.com";function b(e,t){if(null==e||null==t)return!1;if(e!==t){if(e.byteLength!==t.byteLength)return!1;for(var n=new DataView(e),r=new DataView(t),i=0;i<e.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1}return!0}function x(e){e=new Uint8Array(e);return btoa(String.fromCharCode.apply(String,e)))}c=c||{}).TYPE_OF_MSG="firebase-messaging-msg-type",c.DATA="firebase-messaging-msg-data";u={PUSH_MSG_RECEIVED:"push-msg-received",NOTIFICATION_CLICKED:"notification-clicked"};_.prototype.getToken=function(o,s,a){return l(this,void 0,void 0,function(){var t,n,r,i;return d(this,function(e){switch(e.label){case 0:r=y(s.getKey("p256dh")),t=y(s.getKey("auth")),r="authorized_entity="+o+"&endpoint="+s.endpoint+"&encryption_key="+r+"&encryption_auth="+t,b(a.buffer,f.buffer)||(t=y(a),r+="&application_pub_key="+t),(t=new ee).append("Content-Type","application/x-www-form-urlencoded"),t={method:"POST",headers:t,body:r},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,Z(m+"/fcm/connect/subscribe",t)];case 2:return[4,e.sent().json()];case 3:return n=e.sent(),[3,5];case 4:throw r=e.sent(),g.create("token-subscribe-failed",{errorInfo:r});case 5:if(n.error)throw i=n.error.message,g.create("token-subscribe-failed",{errorInfo:i});if(!n.token)throw g.create("token-subscribe-no-token");if(n.pushSet)return[2,{token:n.token,pushSet:n.pushSet}];throw g.create("token-subscribe-no-push-set")}})})},_.prototype.updateToken=function(o,s,a,c,u){return l(this,void 0,void 0,function(){var t,n,r,i;return d(this,function(e){switch(e.label){case 0:r=y(c.getKey("p256dh")),t=y(c.getKey("auth")),r="push_set="+a+"&token="+s+"&authorized_entity="+o+"&endpoint="+c.endpoint+"&encryption_key="+r+"&encryption_auth="+t,b(u.buffer,f.buffer)||(t=y(u),r+="&application_pub_key="+t),(t=new ee).append("Content-Type","application/x-www-form-urlencoded"),t={method:"POST",headers:t,body:r},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,Z(m+"/fcm/connect/subscribe",t)];case 2:return[4,e.sent().json()];case 3:return n=e.sent(),[3,5];case 4:throw r=e.sent(),g.create("token-update-failed",{errorInfo:r});case 5:if(n.error)throw i=n.error.message,g.create("token-update-failed",{errorInfo:i});if(n.token)return[2,n.token];throw g.create("token-update-no-token")}})})},_.prototype.deleteToken=function(i,o,s){return l(this,void 0,void 0,function(){var t,n,r;return d(this,})};var v=_;function _(){}ar B="undefined",C="fcm_token_object_Store";function H(){var o=indexedDB.open(B);o.onerror=o.onsuccess=function(e){var n,t,r,i;(n=o.result).objectStoreNames.contains(C)&&(t=n.transaction(C).objectStore(C),r=new v,(i=t.openCursor()).onerror=function(e){console.warn("Unable to cleanup old IDB.",e)},i.onsuccess=function(){var e,t=i.result;t?(e=t.value,r.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet),t.continue()):(n.close(),indexedDB.deleteDatabase(B))})}}E.prototype.get=E.prototype.getIndex=E.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},E.prototype.delete=E.prototype.closeDatabase=E.prototype.createTransaction=function(o,s){return void 0===s&&(s="readonly"),l(this,void 0,void 0,function(){var r,t,i;return d(this,})},E.prototype.getDb=var w=E;(P,T=w),P.prototype.onDbUpgrade=function(e,t){var n=e.result;switch(t.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:H();case 2:var r,i=(r=e.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var e,t,n=i.result;n&&(e=n.value,t=o({},e),e.createTime||(t.createTime=Date.now()),"string"==typeof e.vapidKey&&(t.vapidKey=S(e.vapidKey)),"string"==typeof e.auth&&(t.auth=S(e.auth).buffer),"string"==typeof e.auth&&(t.p256dh=S(e.p256dh).buffer),n.update(t),n.continue())}}},P.prototype.getTokenDetailsFromToken=function(t){return l(this,void 0,void 0,function(){return d(this,function(e){if(t)return k({fcmToken:t}),[2,this.getIndex("fcmToken",t)];throw g.create("bad-token")})})},P.prototype.getTokenDetailsFromSWScope=function(t){return l(this,void 0,void 0,function(){return d(this,function(e){if(t)return k({swScope:t}),[2,this.get(t)];throw g.create("bad-scope")})})},P.prototype.saveTokenDetails=function(t){return l(this,void 0,void 0,function(){return d(this,function(e){if(!t.swScope)throw g.create("bad-scope");if(!t.vapidKey)throw g.create("bad-vapid-key");if(!t.endpoint||!t.auth||!t.p256dh)throw g.create("bad-subscription");if(!t.fcmSenderId)throw g.create("bad-sender-id");if(!t.fcmToken)throw g.create("bad-token");if(t.fcmPushSet)return k(t),[2,this.put(t)];throw g.create("bad-push-set")})})},P.prototype.deleteToken=function(n){return l(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return"string"!=typeof n||0===n.length?[2,Q.reject(g.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(t=e.sent())return[4,this.delete(t.swScope)];throw g.create("delete-token-not-found");case 2:return e.sent(),[2,t]}})})};var T,V=P;function P(){var e=null!==T&&T.apply(this,arguments)||this;return e.dbName="fcm_token_details_db",e.dbVersion=3,e.objectStoreName="fcm_token_object_Store",e}(O,I=w),O.prototype.onDbUpgrade=O.prototype.getVapidFromSWScope=O.prototype.saveVapidDetails=O.prototype.deleteVapidDetails=function(n){return l(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(t=e.sent())return[4,this.delete(n)];throw g.create("delete-scope-not-found");case 2:return e.sent(),[2,t]}})})};var I,j=O;ar A="messagingSenderId",w=(R.prototype.getToken=function(){return l(this,void 0,void 0,function(){var t,n,r,i;return d(this,})},R.prototype.manageExistingToken=function(t,n,i,r){return l(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return function(e,t){var n,r;if(t.vapidKey&&b(i.buffer,t.vapidKey.buffer))return n=e.endpoint===t.endpoint,r=b(e.getKey("auth"),t.auth),e=b(e.getKey("p256dh"),t.p256dh),n&&r&&e}(n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,n,i,r)]:[4,this.deleteTokenFromDB(r.fcmToken)];case 1:return e.sent(),[2,this.getNewToken(t,n,i)]}})})},R.prototype.updateToken=R.prototype.getNewToken=R.prototype.deleteToken=function(n){return l(this,void 0,void 0,function(){var t;return d(this,})},R.prototype.deleteTokenFromDB=R.prototype.getPushSubscription=R.prototype.requestPermission=R.prototype.useServiceWorker=function(e){throw g.create("only-available-in-window")},R.prototype.usePublicVapidKey=function(e){throw g.create("only-available-in-window")},R.prototype.onMessage=function(e,t,n){throw g.create("only-available-in-window")},R.prototype.onTokenRefresh=R.prototype.setBackgroundMessageHandler=R.prototype.delete=R.prototype.getNotificationPermission_=function(){return Notification.permission},R.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},R.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},R.prototype.getIidModel=function(){return this.iidModel},R);ar q,D="FCM_MSG",G=(e(N,q=w),N.prototype.onPush=function(e){e.waitUntil(this.onPush_(e))},N.prototype.onSubChange=function(e){e.waitUntil(this.onSubChange_(e))},N.prototype.onNotificationClick=N.prototype.onPush_=N.prototype.onSubChange_=function(e){return l(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=e.sent(),[3,3];case 2:throw r=e.sent(),g.create("unable-to-resubscribe",{errorInfo:r});case 3:return e.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return e.sent(),[3,8];case 5:return n=e.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(r=e.sent())return[4,this.deleteToken(r.fcmToken)];throw n;case 7:throw e.sent(),n;case 8:return[2]}})})},N.prototype.onNotificationClick_=function(o){return l(this,void 0,void 0,function(){var t,n,r,i;return d(this,function(e){switch(e.label){case 0:return o.notification&&o.notification.data&&o.notification.data[D]&&!o.action&&(o.stopImmediatePropagation(),o.notification.close(),(t=o.notification.data[D]).notification)&&(n=t.fcmOptions&&t.fcmOptions.link||t.notification.click_action)?[4,this.getWindowClient_(n)]:[2];case 1:return(r=e.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=e.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=e.sent(),e.label=5;case 5:return r?(delete t.notification,delete t.fcmOptions,i=Y(u.NOTIFICATION_CLICKED,t),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},N.prototype.getNotificationData_=function(e){var t,n;if(e&&"object"==typeof e.notification)return(n=o({},e.notification)).data=o({},e.notification.data,((t={})[D]=e,t)),n},N.prototype.setBackgroundMessageHandler=N.prototype.getWindowClient_=N.prototype.attemptToMessageClient_=function(t,n){return l(this,void 0,void 0,function(){return d(this,function(e){if(t)return t.postMessage(n),[2];throw g.create("no-window-client-to-msg")})})},N.prototype.hasVisibleClients_=N.prototype.sendMessageToWindowClients_=N.prototype.getSWRegistration_=N.prototype.getPublicVapidKey_=function(){return l(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,this.getSWRegistration_()];case 1:if(t=e.sent())return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];throw g.create("sw-registration-expected");case 2:return null==(t=e.sent())?[2,f]:[2,t]}})})},N);,K=w),L.prototype.requestPermission=L.prototype.useServiceWorker=L.prototype.usePublicVapidKey=function(e){if("string"!=typeof e)throw g.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw g.create("use-public-key-before-get-token");e=S(e);if(65!==e.length)throw g.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},L.prototype.onMessage=function(e,t,n){return"function"==typeof e?this.onMessageInternal(e,t,n):this.onMessageInternal(e)},L.prototype.onTokenRefresh=L.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Q(function(e,t){var n;i?"activated"!==i.state?"redundant"!==i.state?(n=i.addEventListener("statechange",n)):t(g.create("sw-reg-redundant")):e(r):t(g.create("no-sw-in-reg"))})},L.prototype.getSWRegistration_=L.prototype.getPublicVapidKey_=L.prototype.setupSWMessageListener_=var K,J=L;INTERNAL.registerService("messaging",function(e){if(X())return new(self&&"ServiceWorkerGlobalScope"in self?G:J)(e);throw g.create("unsupported-browser")},{isSupported:X})}.apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-messaging - be sure to load firebase-app.js first.")}},"object"==typeof e&&void 0!==A?c(require("@firebase/app")):"function"==typeof O&&O.amd?O(["@firebase/app"],c):c((i||self).firebase),m.cookie=function e(l){function d(e,t,n){var r,i;if(!(1<arguments.length)){e||(r={});for(var o=document.cookie?document.cookie.split("; "):[],s=/(%[0-9A-Z]{2})+/g,a=0;a<o.length;a++){var c=o[a].split("="),u=c[0].replace(s,decodeURIComponent),c=c.slice(1).join("=");'"'===c.charAt(0)&&(c=c.slice(1,-1));try{if(c=l.read?l.read(c,u):l(c,u)||c.replace(s,decodeURIComponent),this.json)try{c=JSON.parse(c)}catch(e){}if(e===u){r=c;break}e||(r[u]=c)}catch(e){}}return r}"number"==typeof(n=h({path:"/"},d.defaults,n)).expires&&((i=new Date).setMilliseconds(i.getMilliseconds()+864e5*n.expires),n.expires=i);try{r=JSON.stringify(t),/^[\{\[]/.test(r)&&(t=r)}catch(e){}t=l.write?l.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[e,"=",t,n.expires&&"; expires="+n.expires.toUTCString(),n.path&&"; path="+n.path,n.domain&&"; domain="+n.domain,n.sameSite?"; SameSite="+n.sameSite:"; SameSite=None","; Secure"].join("")}d.get=d.set=d;d.getJSON=d.defaults={};d.remove=d.withConverter=e;return d}(,c=this,i=function(){"use strict";y.isArray||_=0,S=void 0,C=void 0,w=E=void 0!==$?$:void 0,T=E||{},T=T.MutationObserver||T.WebKitMutationObserver,P="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),F="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,k=new Array(1e3),W=void 0,W=P?T?(i=0,P=new T(n),y=document.createTextNode(""),P.observe(y,{characterData:!0}),:F?((e=new MessageChannel).port1.onmessage=n,:(void 0===E&&"function"==typeof require?t)(),I=Math.random().toString(36).substring(2),O=void 0,A=1,R=2,D=0,U=(L.prototype._enumerate=L.prototype._eachEntry=L.prototype._settledAt=L.prototype._willSettleAt=L),N=(M.prototype.catch=M.prototype.finally=M);turn N.prototype.then=u,N.all=N.race=N.resolve=l,N.reject=N._setScheduler=function(e){C=e},N._setAsap=N._asap=w,N.polyfill=(N.Promise=N).polyfill(),N},"object"==typeof e&&void 0!==A?A.exports=i():"function"==typeof O&&O.amd?O(i):c.ES6Promise=i(),e=this,c=function(){return function(n,e){var r=this,i=(e===f&&(e=999),r.getOffset=function(e){for(var t=$.getComputedStyle(e,null),n=["paddingTop","paddingBottom"],r=0,i=0;i<n.length;i++)r+=parseInt(t[n[i]]);return r},r.autogrowFn=function(){var e=0,t=!1;return n.scrollHeight-i>r.maxAllowedHeight?(n.style.overflowY="scroll",e=r.maxAllowedHeight):(n.style.overflowY="hidden",n.style.height="auto",e=n.scrollHeight-i,t=!0),n.style.height=e+"px",t},r.getOffset(n));r.rows=n.rows||1,r.lineHeight=n.scrollHeight/r.rows-i/r.rows,r.maxAllowedHeight=r.lineHeight*e-i,n.addEventListener("input",r.autogrowFn)}},"function"==typeof O&&O.amd?O([],c):"object"==typeof A&&A.exports?A.exports=c():e.Autogrow=c();function s(e){return"number"==typeof(e=d(e))&&0<=e&&e<=l}r n,i=Array.prototype,a=Object.prototype,e=Function.prototype,o=(i.push,i.slice,a.toString),c=(a.hasOwnProperty,Array.isArray),u=Object.keys,l=(e.bind,Object.create,Math.pow(2,53)-1),d=(n="length",,p=(m.isEmpty=m.isElement=m.isArray=c||m.isObject=m.each=m.forEach=function(e,t,n){if(t=t,n),s(e))for(i=0,o=e.length;i<o;i++)t(e[i],i,e);else for(var r=m.keys(e),i=0,o=r.length;i<o;i++)t(e[r[i]],r[i],e);return e},m.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol"],,!{toString:null}.propertyIsEnumerable("toString")),g=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];m.allKeys=m.keys=m.extend=t(m.allKeys),m.extendOwn=m.assign=t(m.keys),void 0!==U&&(this.firebase=U),void 0!==m&&(this._=m)}.call(W),W.ES6Promise&&W.ES6Promise.Promise||console.error("Main:init Promise library is required"),W.firebase),m=W._,Q=W.ES6Promise.Promise,Z=W.ES6Fetch.fetch,ee=W.ES6Fetch.Headers,x=W.ES6Fetch.Request,g={debug:e,log:e,info:e,error:fatal:,l=(g.log("Main:init SyneriseLibraryScope",W),{_apiKey:null,_trackerKey:null,apiKey:trackerKey:function(e){return void 0!==e?"YOUR_TRACKER_KEY"!=e?l._trackerKey=e:null:l._trackerKey},getHeaderAuth:function(e){if(l.checkAuth())return"key"==e?"Tracker":"value"==e?this.trackerKey():void 0;throw new TypeError("TrackerKey is not set")},checkAuth:function(){return!!this.trackerKey()||(g.error("TrackerKey is not set"),!1)},parseToken:function(t){try{var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(e).split("").map(.join(""));return JSON.parse(n)}catch(e){return g.error("Auth:parseToken ERROR: could not parse token",t,e),null}}});function B(e){this.uuid=(e=e||{}).uuid||null,this.permUuid=e.permUuid||null,this.customIdentify=e.customIdentify||null,this.accessToken=e.accessToken||null,this.tags=null,this.segments=null,this.params=e.params||null,void 0!==this.params&&null!=this.params&&void 0!==this.params.customIdentify&&(this.customIdentify=this.params.customIdentify,delete this.params.customIdentify)}B.prototype.getTags=function(){g.log("Client:getTag");var e=this;return new Q(function(t,n){e.tags?t(e.tags):H(e).then(function(e){g.log("Client:getTag RequestManager.getClientTags then",e),t(e.tags||[])}).catch(function(e){n(e)})})},B.prototype.getSegments=function(){g.log("Client:getSegments");var e=this;return new Q(function(t,n){e.segments?t(e.segments):H(e).then(function(e){g.log("Client:getTag RequestManager.getSegments then",e),t(e.segments||[])}).catch(function(e){n(e)})})};var H=function(r){return g.log("Client:getData"),new Q(function(t,n){r.segments&&r.tags?t({tags:r.tags,segments:r.segments}):P.getClientData(r).then(function(e){g.log("Client:getData RequestManager.getClientData then",e),r.segments=e.segments||[],r.tags=e.tags||[],t(e)}).catch(function(e){n(e)})})},d=(B.prototype.getDynamicContents=function(){g.log("Client:getDynamicContents",this);var n=this;return new Q(function(e,t){y.getDynamicContentsForClient(n).then(e).catch(function(e){g.error(e,n),t(new Error("Can not get dynamic contents"))})})},B.prototype.renderDynamicContents=function(){g.log("Client:renderDynamicContents");var r=this;return new Q(function(t,n){r.getDynamicContents().then(y.renderBatchDynamicContents).then(function(e){m.each(e,function(e){r.renderDynamicContent(e)}),t(e)}).catch(function(e){g.error(e,r),n(new Error("Can not render dynamic contents"))})})},B.prototype.renderDynamicContent=function(e){return y.renderDynamicContentForClient(e,this)},B.prototype.reRenderDynamicContent=B.prototype.getDynamicContentByUuids=function(n){g.log("Client:getDynamicContentByUuids",this);var r=this;return new Q(function(e,t){y.getDynamicContentByUuidsForClient(r,n).then(e).catch(function(e){g.error(e,r),t(new Error("Can not get dynamic content"))})})},B.prototype.renderDynamicContentByUuidFromCache=function(n){g.log("Client:renderDynamicContentByUuidFromCache",this);var r=this;return new Q(function(e,t){y.findDynamicContenByUuid(n).then(function(e){r.renderDynamicContentByUuids(e)}).catch(function(e){g.error(e,r),t(new Error("Can not find dynamic content"))})})},B.prototype.renderDynamicContentByUuids=function(e){g.log("Client:renderDynamicContentByUuids");var r=this;return new Q(function(t,n){r.getDynamicContentByUuids(e).then(function(e){m.each(e,function(e){r.reRenderDynamicContent(e)}),t(e)}).catch(function(e){g.error(e,r),n(new Error("Can not render dynamic content"))})})},B.prototype.getNotifications=function(){g.log("Client:getNotifications");var n=this;return new Q(function(t,e){g.log("Client:getNotifications",n),T.getNotificationsForClient(n).then(function(e){g.log("Client:getNotifications NotificationManager.getNotificationsForClient() then check capping",e);var r=[];m.each(e,function(e){var t,n;e.capping&&m.isObject(e.capping)&&e.id?"count"===(t=e.capping).type&&(g.log("Client.getNotifications capping count limit",t.count),t.count&&0<t.count&&(n=O.getNotificationCapping(e),g.log("Client.getNotifications check capping",e.id,t.count,n,t.count>n),!(t.count>n))||r.push(e)):r.push(e)}),t(r)}).catch(})},B.prototype.renderNotifications=function(){g.log("Client:renderNotifications");var n=this;return new Q(function(t,e){n.getNotifications().then(function(e){return m.each(e,function(e){n.renderNotification(e)}),Q.resolve(e)}).then(function(){t()}).catch(})},{currentClient:null,notify:function(t){t=new E(t),d.getCurrentClient().then(},getAndRenderDynamicContentsForClient:function(t){d.getCurrentClient().then(function(e){void 0!==t?e.renderDynamicContentByUuidFromCache(t):e.renderDynamicContents()})},getCurrentClient:function(){return new Q(function(t,n){var e,r,i;g.log("ClientManager:getCurrentClient",d.currentClient),d.currentClient&&d.currentClient.uuid&&d.currentClient.permUuid?t(d.currentClient):(e=d.getClientFromStore())?(d.currentClient?(d.currentClient.uuid=e.uuid,d.currentClient.permUuid=e.permUuid):d.setCurrentClient(e),g.log("ClientManager:getCurrentClient return:",d.currentClient),t(d.currentClient)):(r=0,i=setInterval(function(){g.log("ClientManager:getCurrentClient try get client again",r,25);var e=d.getClientFromStore();e?(clearInterval(i),i=null,d.currentClient?(d.currentClient.uuid=e.uuid,d.currentClient.permUuid=e.permUuid):d.setCurrentClient(e),g.log("ClientManager:getCurrentClient return:",d.currentClient),t(d.currentClient)):25<=r&&(clearInterval(i),i=null,n(new TypeError("Client has not found"))),r++},50))})},updateClientParams:function(e,t){void 0===t&&(t=!0),e instanceof B?d.currentClient=e:d.currentClient.params=e,t&&w.clientCreateOrUpdate("Update client data",d.currentClient.params)},setCurrentClient:getClientFromStore:function(){g.log("ClientManager:getClientFromStore");var e=O.getClientUuid(),t=O.getClientPermUuid(),n=O.getClientToken();return e?t?(e=new B({uuid:e,permUuid:t,accessToken:n}),g.log("ClientManager:getClientFromStore return:",e),e):(g.log("ClientManager:getClientFromStore PermUuid not found"),g.log("ClientManager:getClientFromStore return:",null),null):(g.log("ClientManager:getClientFromStore return:",null),null)},getAccessToken:setAccessToken:function(t){O.setClientToken(t)?d.getCurrentClient().then(.catch(function(e){g.log("ClientManager:setToken Token stored but not set",e)}):g.log("ClientManager:setToken Failed to store token")},clearAccessToken:function(){d.currentClient&&d.currentClient.accessToken&&(d.currentClient.accessToken=null),O.removeClientToken()},getIdentityHash:function(){return SyneriseTC.identityHash},hashIdentity:function(e){return h.hashString(e)},setUuidAndIdentityHash:setUuid:function(n){return g.log("ClientManager:setUuid",n),new Q(function(e,t){if(!h.validateUUID(n))return t(new TypeError("Uuid is invalid"));SyneriseTC.setNewUUIDAndIdentityHash("",n),SyneriseTC.pageVisit({}).then(.catch(})}}),b={_options:{notificationNewsletterHandlers:!0,disableNotification:!(B.prototype.renderNotification=function(s,a){var c=this;return new Q(function(e,t){a=a||!1;var n=s.conditions&&s.conditions.delay?parseInt(s.conditions.delay,10):0;if(g.log("Client:renderNotification",s,"delay:",n,"forceRender:",a),!a){if(s.additionalParams&&s.additionalParams.popupAtLeave)return g.log("Client:renderNotification atach click handlers for leave popup"),T.attachHandlerForLeavePopup(c,s),void e();s.additionalParams&&s.additionalParams.popupTransparentBackground?T.turnOnPopupTransparentBackground():T.turnOffPopupTransparentBackground();var r=new Date;if(n){var i,o=k.get("_snrs_notify_delay_"+s.id);if(o?i=new Date(parseInt(o,10)):(i=new Date(r.getTime()+1e3*n),k.set("_snrs_notify_delay_"+s.id,i.getTime(),300)),g.log("Client:renderNotification check end date",i),0<(o=i.getTime()-r.getTime()))return g.log("Client:renderNotification set render timeout",o),setTimeout(o),void e(s)}}s.render().then(function(){return k.remove("_snrs_notify_delay_"+s.id),Q.resolve(s)}).then(function(e){return g.log("Client:renderNotification then",e,e.isRendered()),e.isRendered()&&O.setNotificationCapping(e),Q.resolve(e)}).then(function(t){var e=!(!t.conditions||!t.conditions.trackEventShow);return g.log("Client:renderNotification track",t,e,t.isRendered()),t.isRendered()&&e&&P.track("","dynamicContent.show","",{id:t.id,title:t.name}).then(,Q.resolve(t)}).catch(function(e){g.error(e)}),e(s)})}),disableWebPush:!1,webpush:{},dynamicContent:{},lang:f,acceptLangList:f,localStorageMode:!1},_profileConfig:null,PROFILE_CONFIG_TYPE_NOTIFICATIONS:"notifications",PROFILE_CONFIG_TYPE_DATA_MARKER:"dataMarker",PROFILE_CONFIG_TYPE_PROVIDERS:"providers",PROFILE_CONFIG_TYPE_PROFILE:"profile",PROFILE_CONFIG_TYPE_WEBPUSH:"webPush",PROFILE_CONFIG_TYPE_COOKIE_MATCHERS:"cookieMatchers",getVersion:function(){return"3.18.0"},getModuleName:function(){return"default"},getBuildTime:getFullVersion:getBuildHash:function(){return h.hashString(b.getFullVersion()+b.getBuildTime())+""},getOption:function(e){return void 0!==e?b._options[e]:b._options},init:function(r,e){return new Q(function(e,t){b._options=m.extend(b._options,r),u.init(),b._options.lang?b._options.acceptLangList=[b._options.lang]:b._options.lang=u.getLanguage(),b._options.acceptLangList||(b._options.acceptLangList=u.getAcceptLanguageList()),g.log('Core:init module name: "'+b.getModuleName()+'", version: "'+b.getVersion()+'", build time: "'+b.getBuildTime()+'"'),g.log("Core:init with options",b._options);var n=k.get("_snrs_token");if(n&&I.isAvailable()&&O.setClientToken(n),b._options.trackerKey&&l.trackerKey(b._options.trackerKey),!0===b._options.localStorageMode&&I.clearExpiredKeysStartingWithSnrs(),b._options.apiKey&&l.apiKey(b._options.apiKey),b._options.trackingDomain&&P.utils.setTrackingDomain(b._options.trackingDomain),!l.trackerKey())return t(new TypeError("TrackerKey is not set"));var i=[["setTracker",l.trackerKey()]];b._options.customPageVisit&&i.push(["setCustomPageVisit",b._options.customPageVisit]),b._options.customizeMetadata&&i.push(["setCustomizeMetadata",b._options.customizeMetadata]),b._options.cookieExpiration&&i.push(["setCookieExpiration",b._options.cookieExpiration]),b._options.domain&&i.push(["setDomain",b._options.domain]),void 0!==b._options.clientUuid&&b._options.clientUuid&&h.validateUUID(b._options.clientUuid)&&i.push(["setUuid",[b._options.clientUuid,!0]]),void 0!==b._options.triggerPageVisitOnHashChange&&i.push(["setTriggerPageVisitOnHashChange",b._options.triggerPageVisitOnHashChange]),b.getProfileConfig().then(function(n){return new Q(function(e,t){w.init().then(function(){e(n)}).catch(function(e){g.error(e),t(new TypeError("Event list is not defined"))})})}).then(function(r){return new Q(function(e,t){g.log("Core:init init tracker",i);var n=r.recognizeBy[0].name;i.push(["setIdentity",n]),SyneriseTC.init(i),e()})}).then(function(){return new Q(function(t,n){b.initModulesForClient().then(.catch(})}).then(.catch(})},initModulesForClient:function(){return new Q(function(t,n){d.getCurrentClient().then(function(n){return new Q(function(e,t){if(g.log("Core:init dynamicContents"),b._options.disableDynamicContent||void 0===y)return e(n);y.init(b._options.dynamicContent).then(function(){a.init(),location.href.match("snr_preview")?y.renderDynamicContentPreview():b._options.dynamicContent.virtualPage||n.renderDynamicContents()}).catch(function(e){g.error(e)}),e(n)})}).then(function(r){return new Q(function(e,t){var n;g.log("Core:init basic data"),"object"==typeof clientData&&(g.log("Core:init with client data",clientData),d.updateClientParams(clientData)),b._options.disableFormMarker||void 0===i||(i.init().catch(function(e){g.error(e)}),J.init().catch(function(e){g.error(e)})),"object"==typeof b._options.dataLayer&&void 0!==V&&(n=b._options.gaVersion,V.init(b._options.dataLayer,n)),e(r)})}).then(function(n){return new Q(function(t,e){if(g.log("Core:init webpush"),b._options.disableWebPush||void 0===D)return t(n);D.init(b._options.webpush).then(.catch(function(e){t(n)})})}).then(function(n){return new Q(function(e,t){if(g.log("Core:init notifications"),b._options.disableNotification||void 0===T)return e(n);T.init().then(.catch(function(e){g.error(e)}),e(n)})}).then(function(e){t(e)}).catch(function(e){n(e)})})},getProfileConfig:function(){return h.uniquePromiseHandler("Core:getProfileConfig",function(t,n){var e;return O.getProfileConfig()?(e=O.getProfileConfig(),g.log("Core:getProfileConfig RequestManager.getProfileConfig from localStorage",e),b._profileConfig=e,t(e)):b._profileConfig?(g.log("Core:getProfileConfig RequestManager.getProfileConfig from cache",b._profileConfig),t(b._profileConfig)):void P.getProfileConfig().then(function(e){g.log("Core:getProfileConfig RequestManager.getProfileConfig then",e),O.setProfileConfig(e),b._profileConfig=e,t(b._profileConfig)}).catch(function(e){n(e)})})},getProfileConfigByType:function(r){return new Q(function(t,n){b.getProfileConfig().then(function(e){if(g.log("Core:getProfileConfigByType for type",r),!e)return t(null);t(e[r]||null)}).catch(function(e){n(e)})})},getWebPushProfileConfig:function(){return new Q(function(r,t){var i=b.getOption("acceptLangList")?b.getOption("acceptLangList").join(","):f;b.getProfileConfig().then(function(e){return new Q(function(t,n){if(g.log("Core:getWebPushProfileConfig get webpush config",e),b._profileConfig&&b._profileConfig[b.PROFILE_CONFIG_TYPE_WEBPUSH]!==f)return g.log("Core:getWebPushProfileConfig get from cache",b._profileConfig[b.PROFILE_CONFIG_TYPE_WEBPUSH]),t(b._profileConfig);P.getWebPushProfileConfig(i).then(function(e){g.log("Core:getWebPushProfileConfig RequestManager.getWebPushProfileConfig then",e),b._profileConfig[b.PROFILE_CONFIG_TYPE_WEBPUSH]=e,t(b._profileConfig)}).catch(function(e){n(e)})})}).then(function(e){var t,n;return g.log("Core:getWebPushProfileConfig",e),e&&e[b.PROFILE_CONFIG_TYPE_PROVIDERS]&&e[b.PROFILE_CONFIG_TYPE_PROFILE]&&e[b.PROFILE_CONFIG_TYPE_WEBPUSH]?(n=e[b.PROFILE_CONFIG_TYPE_PROFILE],(t=e[b.PROFILE_CONFIG_TYPE_PROVIDERS])&&t.fcm?(n={sender_id:t.fcm.sender_id,public_vapid:t.fcm.public_vapid||null,agreement_page_domain:"https://"+n.subdomain+".snrpush.com"},g.log("Core:getWebPushProfileConfig webpushData",e[b.PROFILE_CONFIG_TYPE_WEBPUSH]),g.log("Core:getWebPushProfileConfig extendData",n),n=m.extend({},e[b.PROFILE_CONFIG_TYPE_WEBPUSH],n),void r(n||null)):(g.log("Core:getWebPushProfileConfig Fcm settings are not configured.",t),r(null))):(g.log("Core:getWebPushProfileConfig configs required for webpush are not defined.",e),g.log("Core:getWebPushProfileConfig configs isProvidersConfig: "+!!e[b.PROFILE_CONFIG_TYPE_PROVIDERS]+" isProfileConfig: "+!!e[b.PROFILE_CONFIG_TYPE_PROFILE]+" isWebPushConfig: "+!!e[b.PROFILE_CONFIG_TYPE_WEBPUSH]),r(null))}).catch(function(e){t(e)})})}},V={_allowDataLayerAction:["add","remove","purchase","refund"],_events:{add_to_cart:"add",remove_from_cart:"remove",purchase:"purchase",refund:"refund"},_initObserverPush:!1,_localOrders:[],_gaVersion:null,init:function(t,e){this.getLocalOrders(),e&&(this._gaVersion=e);try{g.log("DataLayer:init",t,e),this.validData(t)&&(this.observerPush(t,this.eventData),this.eventsData(t))}catch(e){g.error("DataLayer:init",t,e)}},validData:eventsData:function(e){var t=this;e.forEach(},ga4Parser:function(e,n){g.log("DataLayer:ga4 event",e,n);var r,t=this._events[e];return(e={ecommerce:{}}).ecommerce[t]={products:[]},n.currency&&(e.ecommerce.currencyCode=n.currency),[].forEach.call(n.items,function(n){var r={};[].forEach.call(m.keys(n),,e.ecommerce[t].products.push(r)}),t!==this._events.purchase&&t!==this._events.refund||(r={},[].forEach.call(m.keys(n),function(e){var t;"items"!==e&&(t=e.replace(/^transaction_id$/,"id").replace(/^value$/,"revenue"),r[t]=n[e])}),e.ecommerce[t].actionField=r),e.ecommerce},containsItemWithItemId:isGa4GtagValid:function(e){return"string"==typeof e[0]&&"event"===e[0]&&"string"==typeof e[1]&&this._events[e[1]]&&"object"==typeof e[2]&&e[2].items!==f&&this.containsItemWithItemId(e[2].items)},eventData:function(t,e){var e=JSON.parse(JSON.stringify(e)),n=(g.log("DataLayer:eventData - search ecommerce",e),null);return"object"==typeof e.ecommerce&&null!==e.ecommerce?(g.log("DataLayer:eventData - found ecommerce",e),"UA"!==t._gaVersion&&null!==t._gaVersion||(n=e.ecommerce),"GA4"!==t._gaVersion&&null!==t._gaVersion||"object"==typeof e.ecommerce.items&&"string"==typeof e.event&&t._events[e.event]&&(n=t.ga4Parser(e.event,e.ecommerce))):"GA4_gtag"===t._gaVersion&&t.isGa4GtagValid(e)&&(e={event:e[1],ecommerce:e[2]},n=t.ga4Parser(e.event,e.ecommerce)),n&&t._allowDataLayerAction.forEach(function(e){"object"==typeof n[e]&&"object"==typeof n[e].products&&("purchase"==e?t.trackPurchase(n,e):t.track(n,e))}),!0},getParamsCookie:function(e){var t={};try{var n=k.getJson(e);if(n)for(var r in n)n.hasOwnProperty(r)&&r.match("(snrs?|utm)_.*")&&(t[r]=n[r])}catch(e){g.log("DataLayer:eventData - parse snrs_params",item)}return t},observerPush:function(e,t){var n,r;this._initObserverPush||("function"!=typeof e.push?g.log("DataLayer:observerPush - dataLayer.push is not a function",item):(n=e.push,r=this,e.push=function(){try{g.log("DataLayer:observerPush - callback push",arguments[0]),t(r,arguments[0])}catch(e){try{g.error("DataLayer:observerPush - callback push error E: ",e)}catch(e){}}return n.apply(this,arguments)},this._initObserverPush=!0))},buildRequest:function(e,t){return{label:"datalayer.ecommerce",object:"datalayer."+t,params:{data:e,snrs_params:this.getParamsCookie("_snrs_params"),url:$.location.href}}},track:function(e,t){e=this.buildRequest(e,t);return P.trackProxy(e)},trackPurchase:function(e,t){if(e[t].actionField&&e[t].actionField.id){var n=e[t].actionField.id;if(!(-1<this._localOrders.indexOf(n)))return this.setLocalOrders(n),e=this.buildRequest(e,t),P.trackProxy(e);g.log("DataLayer:trackPurchase - duplicate transaction",n,this._localOrders)}},setLocalOrders:function(e){this._localOrders.push(e);var t=Math.floor(((new Date).getTime()+18e5)/1e3);I.setStringWithTtl("_snrs_orders",this._localOrders,t),g.log("DataLayer:setLocalOrders - set orders",e,this._localOrders)},getLocalOrders:function(){var e=I.getStringWithTtl("_snrs_orders");e&&(this._localOrders=e),g.log("DataLayer:getLocalOrders - get orders",this._localOrders)}},u={DEVICE_TYPE_DESKTOP:"desktop",DEVICE_TYPE_MOBILE:"mobile",_screen:null,_isCrawler:null,_canSaveCookies:f,_crawlerExclusionList:null,_crawlerList:["Googlebot","Mediapartners-Google","Web Preview","bot","Applebot","spider","crawler","Feedfetcher","Slurp","Twiceler","Nutch","BecomeBot","bingbot","BingPreview","Google Web Preview","WordPress.com mShots","Seznam","facebookexternalhit","Yandex","Teoma","ThumbSniper","Phantom","Nuhk","DuckDuckBot","sogou","Exabot","facebook","ia_archiver","slack","msnbot","adidxbot","Ask Jeeves"],init:function(){g.log("DeviceManager:init"),u._screen=u.getScreenInfo()},getScreenInfo:function(){var e,t=null,n=null,r=null,i=[],o=null,s=(screen?(t=screen.width+"x"+screen.height,n=screen.colorDepth+"-bit"):java&&(t=(e=java.awt.Toolkit.getDefaultToolkit().getScreenSize()).width+"x"+e.height),navigator.language?r=navigator.language.toLowerCase():navigator.browserLanguage?r=navigator.browserLanguage.toLowerCase():navigator.languages&&navigator.languages.length&&(r=navigator.languages[0].toLowerCase()),navigator.languages&&navigator.languages.length?i=navigator.languages:r&&i.push(r),document.characterSet?o=h.encodeString(document.characterSet):document.charset&&(o=h.encodeString(document.charset)),u.DEVICE_TYPE_DESKTOP);if(t){var a,c=t.split("x"),s=u.DEVICE_TYPE_MOBILE;for(a in c)c.hasOwnProperty(a)&&1024<parseInt(c[a],10)&&(s=u.DEVICE_TYPE_DESKTOP)}return{encoding:o,resolution:t,color:n,language:r,deviceType:s,acceptLanguageList:i,isCrawler:u.isCrawler()}},getProtocol:function(){var e=void 0!==document.location.protocol?document.location.protocol:"https";return e=(e=e.replace(":","")).match("https?")?e:"https"},isCrawler:function(){var e,t;return null===u._isCrawler&&(u._isCrawler=!1,e=navigator.userAgent||"",(e=u._crawlerExclusionList?e.replace(new RegExp(u._crawlerExclusionList.join("|"),"g"),"").trim():e)&&(t=new RegExp(u._crawlerList.join("|"),"g").exec(e),g.log("DeviceManager:isCrawler matches",e,t),t)&&t.length&&(u._isCrawler=!0),g.log("DeviceManager:isCrawler",u._isCrawler)),!!u._isCrawler},checkDeviceType:function(e){return g.log("DeviceManager:checkDeviceType",e),m.isString(e)&&(e=[e]),m.inArray(u._screen.deviceType,e)},getAcceptLanguageList:function(){return g.log("DeviceManager:getAcceptLanguageList",u._screen.acceptLanguageList),u._screen.acceptLanguageList},getLanguage:function(){return g.log("DeviceManager:getLanguage",u._screen.language),u._screen.language},getOsInfo:function(){var e,t=navigator.appVersion,n=navigator.userAgent,r=navigator.appName,i=""+parseFloat(navigator.appVersion),o=(parseInt(navigator.appVersion,10),-1!==(s=n.indexOf("Opera"))?(r="Opera",i=n.substring(s+6),-1!==(s=n.indexOf("Version"))&&(i=n.substring(s+8))):-1!==(s=n.indexOf("OPR/"))?(r="Opera",i=n.substring(s+4)):-1!==(s=n.indexOf("Edge"))?(r="Microsoft Edge",i=n.substring(s+5)):-1!==(s=n.indexOf("MSIE"))?(r="Microsoft Internet Explorer",i=n.substring(s+5)):-1!==(s=n.indexOf("Chrome"))?(r="Chrome",i=n.substring(s+7)):-1!==(s=n.indexOf("Safari"))?(r="Safari",i=n.substring(s+7),-1!==(s=n.indexOf("Version"))&&(i=n.substring(s+8))):-1!==(s=n.indexOf("Firefox"))?(r="Firefox",i=n.substring(s+8)):-1!==n.indexOf("Trident/")?(r="Microsoft Internet Explorer",i=n.substring(n.indexOf("rv:")+3)):(o=n.lastIndexOf(" ")+1)<(s=n.lastIndexOf("/"))&&(r=n.substring(o,s),i=n.substring(s+1),r.toLowerCase()==r.toUpperCase())&&(r=navigator.appName),-1!==(o=(i=-1!==(o=(i=-1!==(o=i.indexOf(";"))?i.substring(0,o):i).indexOf(" "))?i.substring(0,o):i).indexOf(")"))&&(i=i.substring(0,o)),s=parseInt(""+i,10),isNaN(s)&&(i=""+parseFloat(navigator.appVersion),parseInt(navigator.appVersion,10)),/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(t)),s=!!navigator.cookieEnabled,a=(void 0===navigator.cookieEnabled&&(s=s||this.canSaveCookies()),"-"),c=[{s:"BOT",r:/(Googlebot|Mediapartners-Google|Web Preview|bot|Applebot|spider|crawler|Feedfetcher|Slurp|Twiceler|Nutch|BecomeBot|bingbot|BingPreview|Google Web Preview|WordPress.com mShots|Seznam|facebookexternalhit|Yandex|Teoma|ThumbSniper|Phantom|Nuhk|DuckDuckBot|sogou|Exabot|facebook|ia_archiver|slack|msnbot|adidxbot|Ask Jeeves)/},{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/}];for(e in c)if(c.hasOwnProperty(e)){var u=c[e];if(u.r.test(n)){a=u.s;break}}var l="-";switch(/Windows/.test(a)&&(l=/Windows (.*)/.exec(a)[1],a="Windows"),a){case"Mac OS X":var d=/Mac OS X (10[\.\_\d]+)/.exec(n);null!==d&&(l=d[1]);break;case"Android":l=/Android ([\.\_\d]+)/.exec(n)[1];break;case"iOS":l=(l=/OS (\d+)_(\d+)_?(\d+)?/.exec(n))[1]+"."+l[2]+"."+(0|l[3])}return{browser:r,browserVersion:i,mobile:o,os:a,osVersion:l,cookies:s}},canSaveCookies:function(){return this._canSaveCookies===f&&(document.cookie="testcookie=1",this._canSaveCookies=-1!==document.cookie.indexOf("testcookie"),document.cookie="testcookie=1; expires=Thu, 01-Jan-1970 00:00:01 GMT"),this._canSaveCookies},isBrowseIE:function(){g.log("DeviceManager:isBrowseIE");var e=u.getOsInfo();return!(!e||"Microsoft Internet Explorer"!=e.browser)}};function c(e,t){if(t=t||!0,(e=e||{}).options=e.options||{},this._container=null,this._nodes=[],this._status=c.STATUS_NEW,this.id=e.id||null,this.subject=e.subject||null,this.displayType=e.displayType||null,this.toReRender=e.containsJinjava||e.isSegment||null,this.experimentVariantId=e.experimentVariantId||null,this.isGlobalControlGroupEnabled=e.isGlobalControlGroupEnabled||null,this.isControlGroupEnabled=e.isControlGroup||null,this.controlGroupValue=e.options.controlGroup||0,this.targetRestriction=new G(e.targetRestriction,!1),this.variants=[],Array.isArray(e.variants))for(var n in e.variants)e.variants.hasOwnProperty(n)&&(this.variants[n]=new C(e.variants[n],!1));if(0!==this.controlGroupValue||this.isGlobalControlGroupEnabled&&y._isGlobalControlGroup){var r=null,i=e.variants[0];if(!i&&y._dynamicContents){for(var o,s=y._dynamicContents,a=0;a<s.length;a++)if(s[a].id===this.id){o=s[a];break}i=o&&o.variants?o.variants[0].options:{}}r=new C(i,!1),this.isGlobalControlGroupEnabled&&y._isGlobalControlGroup?(r.getControlGroupVariant(this.id,100),this.variants=[r]):(r.getControlGroupVariant(this.id,this.controlGroupValue),this.variants.push(r))}this.viewsPage=new K({include:e.viewsPageUrl,exclude:e.viewsExcludePageUrl},!1),this.utm=new Y(e.options.utm,!1),this.frequency=new v(e.frequency,!1),this.stopDisplay=new _(e.stopDisplay,!1),this.trigger=new S(e.trigger,!1),this.capping=new q(e.capping,!1),t&&this.validate()}c.DISPLAY_TYPE_OPTIONS_LIST=[c.DISPLAY_TYPE_OBJECT="OBJECT",c.DISPLAY_TYPE_LAYER="LAYER"],c.STATUS_RENDERED="RENDERED",c.STATUS_TRIGGERED="TRIGGERED",c.STATUS_WAITING_TO_TRIGGER="WAITING_TO_TRIGGER",c.STATUS_NEW="NEW",c.prototype.validate=function(){if(!this.id)throw new Error("Invalid id");if(!this.displayType||-1===c.DISPLAY_TYPE_OPTIONS_LIST.indexOf(this.displayType))throw new Error('Display type ("'+self.displayType+'") is incorrect, only '+c.DISPLAY_TYPE_OPTIONS_LIST.join(",")+" is allowed");if(!Array.isArray(this.variants)||!this.variants.length)throw new Error("Invalid variants");for(var e=0;e<this.variants.length;e++){var t,n=this.variants[e];n.validate(),n.getTargetSelector();switch(this.displayType){case c.DISPLAY_TYPE_OBJECT:if(!(t=n.getTargetSelector()))throw new Error("Target selector not defined");if(!h.validateSelector(t))throw new Error("Target selector is invalid",this);if(n.getTargetSelectorPrefix())break;throw new Error("Target selector prefix not defined")}}return this.targetRestriction.validate(),this.viewsPage.validate(),this.utm.validate(),this.frequency.validate(),this.stopDisplay.validate(),this.trigger.validate(),this.capping.validate(),!0},c.prototype.hasNodes=c.prototype.getNodes=function(){return this._nodes},c.prototype.getObservableNodes=function(){var t=[],e=this._nodes;return m.each(e,function(e){1===e.nodeType&&e.nodeName&&!e.nodeName.toLowerCase().match(/style|script|meta|title|link|base|noscript/)&&t.push(e)}),t},c.prototype.getStatus=function(){return this._status},c.prototype.isToReRender=function(){return this.toReRender},c.prototype.isAbx=function(){return this.abx},c.prototype.getId=function(){return this.id},c.prototype.getSubject=function(){return this.subject},c.prototype.getVariant=c.prototype.pickVariant=function(){var e=null;if(1===this.variants.length)e=this.variants[0];else{for(var t,n=s.getCachedDynamicContentVariantId(this.id),r=!1,i=0;i<this.variants.length;i++)this.variants[i].getId()==n&&(r=!0);r||(n=this.experimentVariantId?s.cacheDynamicContentVariantId(this.id,this.experimentVariantId):(t=this.drawVariant(),s.cacheDynamicContentVariantId(this.id,t.getId())));for(i=0;i<this.variants.length;i++)if(this.variants[i].getId()==n){e=this.variants[i];break}}return e},c.prototype.drawVariant=function(){for(var e=0,t=0;t<this.variants.length;t++)e+=this.variants[t].getPercentage();for(var n=Math.ceil(Math.random()*e),t=0;t<this.variants.length;t++)if((n-=this.variants[t].getPercentage())<=0)return this.variants[t]},c.prototype.getVariantId=function(){return this.getVariant().getId()},c.prototype.getVariantName=function(){return this.getVariant().getName()},c.prototype.getContent=function(){return this.getVariant().getContent()},c.prototype.getTargetContainer=function(){var e=this.getVariant().getTargetSelector();return e?document.querySelector(e):null},c.prototype.getContentToRender=function(){return this.getVariant().getContentToRender()},c.prototype.isContentHtml=function(){return this.getVariant().isContentHtml()},c.prototype.isContentCss=function(){return this.getVariant().isContentCss()},c.prototype.isContentJs=c.prototype.isTriggerInstant=function(){return this.trigger.isInstant()},c.prototype.isRendered=function(){return this._status===c.STATUS_RENDERED},c.prototype.isDisplayTypeObject=c.prototype.setStatusRendered=function(){return this._status=c.STATUS_RENDERED,g.log("DynamicContent:setStatusRendered",this),this},c.prototype.setStatusWaitingToTrigger=function(){return this._status=c.STATUS_WAITING_TO_TRIGGER,g.log("DynamicContent:setStatusWaitingToTrigger",this),this},c.prototype.setStatusTriggered=function(){return this._status=c.STATUS_TRIGGERED,g.log("DynamicContent:setStatusTriggered",this),this},c.prototype.isStatusReadyToRender=function(){return m.inArray(this.getStatus(),[c.STATUS_NEW,c.STATUS_TRIGGERED])},c.prototype.isStatusNew=c.prototype.isVisibleOnScreen=function(){return!!this.isRendered()&&h.isVisibleAtLeastOneElementOnScreen(this.getNodes())},c.prototype.isGlobalControlGroup=c.prototype.isControlGroup=function(){return 0===this.getVariantId()||this.isGlobalControlGroup()},c.prototype.getControlGroupType=c.prototype.getUtmWithParametersFlatMap=c.prototype.render=function(){var r=this;return new Q(function(e,t){g.log("DynamicContent:render",r);var n=document.createDocumentFragment();(r.displayType===c.DISPLAY_TYPE_LAYER?r.renderLayer(n):r.renderObject(n)).then(e).catch(t)})},c.prototype.renderLayer=function(n){var r=this;return new Q(function(e,t){if(a.isShown())return t(new Error("Other layer shown"));m.containerInnerHtml(n,r.getContentToRender()),r._nodes=m.getNodesArray(n),y.attachHandlers(r).then(function(){if(a.setContent(n),r._container=a._contentCtr,r.isContentJs()&&m.executeScriptsForNodes(r.getNodes()),r.setStatusRendered(),r.isControlGroup())return w.trackClientEvent("","dynamicContent.controlGroup",{id:r.getId(),campaignName:r.getSubject(),type:r.getControlGroupType()}),e();a.show(),e()}).catch(t)})},c.prototype.renderObject=function(r){var i=this;return new Q(function(e,t){var n=i.getTargetContainer();m.containerInnerHtml(r,i.getContentToRender()),i._nodes=m.getNodesArray(r),y.attachHandlers(i).then(function(){i.renderObjectForContainerByPrefix(n,r,i.getVariant().getTargetSelectorPrefix()),i._container=n,i.isContentJs()&&m.executeScriptsForNodes(i.getNodes()),i.setStatusRendered(),e()}).catch(t)})},c.prototype.renderObjectForContainerByPrefix=function(e,t,n){switch(n){case C.TARGET_SELECTOR_PREFIX_BEFORE:this.renderObjectForContainerBefore(e,t);break;case C.TARGET_SELECTOR_PREFIX_AFTER:this.renderObjectForContainerAfter(e,t);break;case C.TARGET_SELECTOR_PREFIX_INNER:this.renderObjectForContainerInner(e,t)}},c.prototype.renderObjectForContainerBefore=function(e,t){if(!e.parentNode||e.parentNode.nodeType!==Node.ELEMENT_NODE||"html"===e.parentNode.nodeName.toLowerCase())throw g.error("DynamicContent:renderObjectForContainerBefore Invalid node to insert before",e,e.parentNode,this),new Error("Invalid node to insert before");m.insertBefore(e,t)},c.prototype.renderObjectForContainerAfter=function(e,t){if(!e.parentNode||e.parentNode.nodeType!==Node.ELEMENT_NODE||"html"===e.parentNode.nodeName.toLowerCase())throw g.error("DynamicContent:renderObjectForContainerBefore Invalid node to insert after",e,e.parentNode,this),new Error("Invalid node to insert after");m.insertAfter(e,t)};var y={_virtualPage:!(c.prototype.renderObjectForContainerInner=function(e,t){if("html"===e.nodeName.toLowerCase())throw g.error("DynamicContent:renderObjectForContainerBefore Invalid node to insert inner",e,this),new Error("Invalid node to insert inner");m.replaceChildren(e,t)}),_isGlobalControlGroup:!1,_dynamicContents:null,_stylesUrl:[],_callbackStack:{customVariablesFunction:,_selectorObservers:{},renderedDynamicContents:[],setCustomVariablesFunction:checkExtras:function(e){var t,n;return e.extras&&(t=e.extras.identityHash,n=e.extras.belongsToGlobalControlGroup,t&&!SyneriseTC.checkIdentityHashExists()&&SyneriseTC.resetUUIDByIdentityHash(t),n)&&(y._isGlobalControlGroup=n),Q.resolve(e)},prepareStyles:function(){var e=P.utils.getStyleUrl();return y._stylesUrl.push(e),z.loadStyles(y._stylesUrl)},init:function(n){return new Q(function(e,t){y.prepareStyles(),s.clearExpiredKeysFromStore(),!0===n.virtualPage&&(y._virtualPage=!0),e()})},getDynamicContentByUuids:function(n,r){return new Q(function(e,t){P.getDynamicContentByUuids(n,r).then(y.checkExtras).then(P.utils.getDataKey).then(y.parseDataToObjects).then(y.filterUnsupportedDynamicContents).then(e).catch(function(e){t(e)})})},getDynamicContentsFiltered:function(n){return new Q(function(e,t){P.getDynamicContentsFiltered(n).then(y.checkExtras).then(P.utils.getDataKey).then(y.parseDataToObjects).then(y.setDynamicContentsCache).then(y.filterUnsupportedDynamicContents).then(e).catch(function(e){t(e)})})},setDynamicContentsCache:function(n){return new Q(function(e,t){e(y._dynamicContents=n)})},findDynamicContenByUuid:function(i){return g.log("DynamicContentManager:findDynamicContenByUuid",i),new Q(function(e,t){var n,r=y._dynamicContents;return r?(n=[],m.each(r,function(e){e.getId()==i&&n.push(e)}),e(n)):t(new Error("Can not find dynamic content"))})},getDynamicContentsForClient:function(n){return g.log("DynamicContentManager:getDynamicContentsForClient",n),new Q(function(e,t){y.getDynamicContentsFiltered(n).then(function(e){return g.log("DynamicContentManager:getDynamicContentsFiltered result",n),y.filterDynamicContentsForClient(n,e)}).then(e).catch(t)})},getDynamicContentByUuidsForClient:function(e,r){return g.log("DynamicContentManager:getgetDynamicContentByUuidsForClient",e),new Q(},parseDataToObjects:function(r){return new Q(function(e,t){g.log("DynamicContentManager:parseToObjects");var n=[];m.isEmpty(r)||m.each(r,function(t){try{var e=new c(t);n.push(e)}catch(e){g.error("DynamicContentManager:parseToObjects error",e,t)}}),g.log("DynamicContentManager:parseToObjects after parse",n),e(n)})},filterDynamicContentsForClient:function(r,i){return g.log("DynamicContentManager:filterDynamicContentsForClient",r,i),new Q(function(e,t){var n=[];if(m.isEmpty(i))return e(n);m.each(i,function(e){y.checkStopDisplay(e,r)&&y.checkFrequency(e,r)&&n.push(e)}),e(n)})},checkFrequency:function(e){var t,n;return!e.frequency.isLimited()||(e.frequency.isSessionExpiration()&&(g.log("DynamicContentManager:checkFrequency renew session frequency expiration",e),y.renewFrequencyExpiration(e),t=setInterval(1e3*v.EXPIRATION_SESSION/10),setTimeout(function(){t&&(g.log("DynamicContentManager:checkFrequency stop renewing session frequency - timeout",e),clearInterval(t))},1e3*v.EXPIRATION_ON_PAGE_FOR_SESSION)),n=y.getFrequencyValue(e),g.log("DynamicContentManager:checkFrequency frequencyValueStored",n),!e.frequency.checkFrequencyLimit(n))||(g.info("DynamicContentManager:checkFrequency - invalid",n),!1)},renewFrequencyExpiration:function(e){return e.frequency.isLimited()?(e=s.renewFrequencyExpiration(e))?e.value:null:0},incrementFrequencyValue:function(e){return e.frequency.isLimited()?s.incrementFrequency(e).value:0},getFrequencyValue:function(e){return e.frequency.isLimited()?(e=s.getFrequencyWithCheckExpiration(e))?e.value:null:0},filterUnsupportedDynamicContents:function(r){return new Q(function(e,t){g.log("DynamicContentManager:filterUnsupportedDynamicContents",r);var n=[];if(m.isEmpty(r))return e(n);m.each(r,,e(n)})},renderBatchDynamicContents:function(i){return new Q(function(e,t){g.log("DynamicContentManager:renderBatchDynamicContents",i);var n=[],r=[];if(m.isEmpty(i))return e(n);m.each(i,function(e){(!e.isStatusReadyToRender()||!y.checkViewsPage(e)||e.isStatusNew()&&!e.isTriggerInstant()||e.isDisplayTypeObject()&&!e.getTargetContainer()||!e.isToReRender()?n:r).push(e)}),g.log("DynamicContentManager:renderBatchDynamicContents::batched",r),0<r.length&&y.reRenderDynamicContents(r),e(n)})},checkDevices:function(e){var t,n,r,i=e.targetRestriction.getDevices();return!(i.length&&!u.checkDeviceType((t=i,(n={})[G.TARGET_RESTRICTION_DESKTOP]=u.DEVICE_TYPE_DESKTOP,n[G.TARGET_RESTRICTION_MOBILE]=u.DEVICE_TYPE_MOBILE,r=[],m.each(t,,r))&&(g.info("DynamicContentManager:validDevices - invalid",i,e),1))},checkViewsPage:function(e){return!!e.viewsPage.isMatchPageUrl(location.href)||(g.info("DynamicContentManager:checkViewsPage - invalid",location.href,e),!1)},attachTrigger:function(e){if(g.info("DynamicContentManager:attachTrigger",e,e.getStatus()),!e.isStatusNew()||e.isTriggerInstant())return Q.resolve();switch(e.setStatusWaitingToTrigger(),e.trigger.getType()){case S.TYPE_ON_LANDING:return y.attachTriggerOnLanding(e);case S.TYPE_ON_EXIT:return y.attachTriggerOnExit(e);case S.TYPE_AFTER_SCROLL:return y.attachTriggerAfterScroll(e)}},attachTriggerOnLanding:function(e){var t,n,r;return g.info("DynamicContentManager:attachTriggerOnLanding",e,e.trigger.isDelay()),e.trigger.isDelay()&&(t=n=new Date,r=s.getTimeForDelay(e),g.info("DynamicContentManager:attachTriggerOnLanding stored date time",r,e),null===r?r=s.setTimeForDelay(e,n):s.renewTimeForDelay(e),0<(r=r.getTime()-n.getTime())?(g.log("DynamicContentManager:attachTriggerOnLanding set timeout",r,e),setTimeout(r)):t()),Q.resolve()},attachTriggerOnExit:function(n){return g.info("DynamicContentManager:attachTriggerOnExit",n),h.addEvent(document,"mouseout",function e(t){t.clientY<=0&&(h.removeEvent(document,"mouseout",e),m.preventDefault(t),g.info("DynamicContentManager:attachTriggerOnExit mouseOut",t.clientY,n),y.renderDynamicContentForClientAfterTriggered(n))}),Q.resolve()},attachTriggerAfterScroll:function(n){var r;function e(e){var t=h.getScrollPercentage();return!!n.trigger.checkScrollingAchieved(t)&&(r&&clearInterval(r),g.info("DynamicContentManager:attachTriggerAfterScroll scrollPercentage achieved",t,n),y.renderDynamicContentForClientAfterTriggered(n),!0)}return g.info("DynamicContentManager:attachTriggerAfterScroll",n,n.trigger.isDelay()),e()||(r=setInterval(e,250)),Q.resolve()},attachHandlerForTrackEventShow:function(n){var t,r,e;function i(e){return!!n.isVisibleOnScreen()&&(t&&clearInterval(t),g.info("DynamicContentManager:attachHandlerForTrackEventShow dc is visible on screen",n),w.trackDynamicContentEventShow(n),!0)}return g.info("DynamicContentManager:attachHandlerForTrackEventShow",n),"IntersectionObserver"in $&&"IntersectionObserverEntry"in $&&"intersectionRatio"in $.IntersectionObserverEntry.prototype?0<(e=n.getObservableNodes()).length&&(r=new IntersectionObserver(function(e,t){e[0].isIntersecting&&(g.info("DynamicContentManager:attachHandlerForTrackEventShow dc is visible on screen",n),w.trackDynamicContentEventShow(n),t.disconnect())},{}),m.each(e,function(e){r.observe(e)})):i()||(t=setInterval(i,200)),Q.resolve()},attachTargetSelectorObserver:function(t){if(g.log("DynamicContentManager:attachTargetSelectorObserver",t),!y._selectorObservers[t.getId()]&&!1===y._virtualPage)try{var e=document.body||document,n=MutationObserver||WebKitMutationObserver||null,r="function"==typeof n,i=h.debounce(function(){t.getTargetContainer()&&(g.log("DynamicContentManager:attachTargetSelectorObserver::findTargetSelector",t),g.log("DynamicContentManager:attachTargetSelectorObserver::stopObserve",t),y._selectorObservers[t.getId()]&&(r?y._selectorObservers[t.getId()].disconnect():clearInterval(y._selectorObservers[t.getId()]),y._selectorObservers[t.getId()]=null),y.renderDynamicContentForClientAfterTriggered(t))},300,!1);r?(y._selectorObservers[t.getId()]=new n(i),y._selectorObservers[t.getId()].observe(e,{childList:!0,subtree:!0,attributes:!0})):y._selectorObservers[t.getId()]=setInterval(i,200)}catch(e){g.error("DynamicContentManager:attachTargetSelectorObserver::catch",e,t)}return Q.resolve()},reRenderDynamicContents:function(t){return d.getCurrentClient().then(,Q.resolve()},renderDynamicContentForClientAfterTriggered:function(e){g.info("DynamicContentManager:renderDynamicContentAfterTriggered",e),e.setStatusTriggered(),y.renderDynamicContentForCurrentClient(e)},renderDynamicContentForCurrentClient:function(n){return g.info("DynamicContentManager:renderDynamicContentForCurrentClient",n),new Q(function(e,t){d.getCurrentClient().then(function(e){return e.renderDynamicContent(n)}).then(e).catch(t)})},attachHandlers:function(e){return g.info("DynamicContentManager:attachHandlers",e,e.hasNodes()),e.hasNodes()?Q.all([y.attachHandlersForStopDisplaySettings(e)]):(g.info("DynamicContentManager:attachHandlers Nodes list empty",e),Q.resolve())},attachHandlersForStopDisplaySettings:function(t){if(g.info("DynamicContentManager:attachHandlersForStopDisplaySettings",t,t.stopDisplay.isStopAfterAction()),!t.stopDisplay.isStopAfterAction())return Q.resolve();function e(e){g.info("DynamicContentManager:attachHandlersForStopDisplaySettings handler",e,t),y.stopDisplayAnymore(t)}h.attachHandlerForElements(m.getElementsByTagNameIncludesItself(t.getNodes(),"a"),"click",e,!1),h.attachHandlerForElements(m.getElementsByTagNameIncludesItself(t.getNodes(),"button"),"click",e,!1)},stopDisplayAnymore:checkStopDisplay:function(e){return g.info("DynamicContentManager:checkStopDisplay",e,e.stopDisplay.isStopDefined()),!e.stopDisplay.isStopDefined()||!s.checkStopDisplay(e)||(g.info("DynamicContentManager:checkStopDisplay - stopped",e),!1)},incrementViewsForStopDisplay:function(e){var t,n;return e.stopDisplay.isStopAfterShow()?(t=s.incrementViewsForStopDisplay(e),n=y.getViewsForStopDisplay(e),g.log("DynamicContentManager:incrementViewsForStopDisplay viewsValueStored",n),e.stopDisplay.checkShowTimesLimit(n)&&(g.info("DynamicContentManager:incrementViewsForStopDisplay - views limit achieved",n),y.stopDisplayAnymore(e),s.removeViewsForStopDisplay(e)),t):0},getViewsForStopDisplay:function(e){return e.stopDisplay.isStopAfterShow()?s.getViewsForStopDisplay(e):0},onAfterDynamicContentRender:function(n,e){return new Q(function(e,t){new Q(function(e,t){if(g.log("Client:renderDynamicContent increment views",n.isRendered(),n.capping.isLimited(),n),!n.isRendered()||!n.capping.isLimited())return e();P.incrementDynamicContentViews(n),e()}).then(function(){return new Q(function(e,t){if(g.log("Client:renderDynamicContent incrementFrequency",n.frequency.isLimited(),n),!n.isRendered()||!n.frequency.isLimited())return e();y.incrementFrequencyValue(n),e()})}).then(function(){return new Q(function(e,t){if(g.log("Client:renderDynamicContent incrementFrequency",n.frequency.isLimited(),n),!n.isRendered()||!n.stopDisplay.isStopAfterShow())return e();y.incrementViewsForStopDisplay(n),e()})}).then(function(){return new Q(function(e,t){return g.log("Client:renderDynamicContent track show",n.isRendered(),n),n.isRendered()?y.attachHandlerForTrackEventShow(n):e()})}).then(e).catch(t)})},renderDynamicContentForClient:function(n,r){return new Q(function(e,t){g.log("DynamicContentManager:renderDynamicContentForClient",r,n.isStatusReadyToRender(),n.getStatus(),n),(n.isStatusReadyToRender()&&y.checkViewsPage(n)?n.isStatusNew()&&!n.isTriggerInstant()?y.attachTrigger(n):n.isDisplayTypeObject()&&!n.getTargetContainer()?y.attachTargetSelectorObserver(n):n.isToReRender()?y.reRenderDynamicContents([n]):n.render().then(function(){return y.renderedDynamicContents.push(n),y.onAfterDynamicContentRender(n,r)}):Q.resolve(!1)).then(function(){e(n.isRendered())}).catch(function(e){g.error(e,self,n),t(new Error("Can not render dynamic content"))})})},reRenderDynamicContentForClient:function(n,r){return new Q(function(e,t){g.log("DynamicContentManager:reRenderDynamicContentForClient",r,n.isStatusReadyToRender(),n.getStatus(),n),(n.isStatusReadyToRender()?n.render().then(function(){return y.renderedDynamicContents.push(n),y.onAfterDynamicContentRender(n,r)}):Q.resolve(!1)).then(.catch(function(e){g.error(e,self,n),t(new Error("Can not reRender dynamic content"))})})},getRenderedDynamicContent:getVariables:function(){try{var t=this._callbackStack.customVariablesFunction()}catch(e){g.error("DynamicContentManager:getVariables -> customVariablesFunction error",e),t={}}try{var n=SyneriseTC.getOgTag()}catch(e){g.error("DynamicContentManager:getVariables -> SyneriseTC.getOgTag error",e),n={}}var e,r=m.extend({},n="object"!=typeof n?{}:n,t="object"!=typeof t?{}:t);for(e in r)"string"!=typeof r[e]&&delete r[e];return r},getDynamicContentPreview:function(n,r){return new Q(function(e,t){P.getDynamicContentPreview(n,r).then(e).catch(})},renderDynamicContentPreview:function(){var e=$.location.search,e=new URLSearchParams(e).get("snr_preview"),t=JSON.parse(h.atou(e));d.getCurrentClient().then(function(e){e=t.customerUuid||e.uuid;y.getDynamicContentPreview(t.id,e).then(function(e){new r(m.extend(e,t),!0).render()})})}};function r(e,t){this._nodes=[],this._container=null,this.options=m.extend({templateId:null,html:"",css:"",js:"",selector:null,selectorPrefix:null},e),t&&this.validate()}r.TARGET_SELECTOR_PREFIX_OPTIONS_LIST=[r.TARGET_SELECTOR_PREFIX_BEFORE="BEFORE",r.TARGET_SELECTOR_PREFIX_AFTER="AFTER",r.TARGET_SELECTOR_PREFIX_INNER="INNER"],r.prototype.getNodes=function(){return this._nodes},r.prototype.getTargetSelectorPrefix=function(){return this.options.selectorPrefix},r.prototype.getContent=r.prototype.isContent=r.prototype.isContentHtml=function(){return!!this.getContent().html},r.prototype.isContentCss=function(){return!!this.getContent().css},r.prototype.isContentJs=r.prototype.getTargetSelector=r.prototype.getContentHtml=function(){return this.getContent().html},r.prototype.getContentCss=function(){return this.getContent().css},r.prototype.getContentJs=r.prototype.getContentHtmlToRender=r.prototype.getContentCssToRender=function(){return'<style type="text/css">'+this.getContentCss()+"</style>"},r.prototype.getContentJsToRender=r.prototype.getTargetContainer=r.prototype.getContentToRender=function(){var e="";return this.isContentCss()&&(e+=this.getContentCssToRender()),this.isContentHtml()&&(e+=this.getContentHtmlToRender()),this.isContentJs()&&(e+=this.getContentJsToRender()),e},r.prototype.validate=function(){var e=this.getTargetSelector(),t=this.getTargetSelectorPrefix(),n=this.isContent();if(t&&!m.inArray(t,r.TARGET_SELECTOR_PREFIX_OPTIONS_LIST))throw new Error('Target selector prefix ("'+t+'") is incorrect, only ['+r.TARGET_SELECTOR_PREFIX_OPTIONS_LIST.join(",")+"] is allowed");if(e&&!h.validateSelector(e))throw new Error("Target selector is invalid",this);if(n)return!0;throw j.showJinjavaAlert(),new Error("Empty preview response",this)},r.prototype.render=function(){var r=this;return new Q(function(e,t){g.log("DynamicContentPreview:render",r);var n=document.createDocumentFragment();(r.getTargetSelector()&&r.getTargetSelectorPrefix()?r.renderObject(n):r.renderLayer(n)).then(e).catch(t)})},r.prototype.renderLayer=function(n){var r=this;return new Q(function(e,t){if(a.isShown())return t(new Error("Other layer shown"));m.containerInnerHtml(n,r.getContentToRender()),r._nodes=m.getNodesArray(n),a.setContent(n),r._container=a._contentCtr,r.isContentJs()&&m.executeScriptsForNodes(r.getNodes()),a.show(),e()})},r.prototype.renderObject=function(r){var i=this;return new Q(function(e,t){var n=i.getTargetContainer();n||j.showSelectorAlert(),m.containerInnerHtml(r,i.getContentToRender()),i._nodes=m.getNodesArray(r),i.renderObjectForContainerByPrefix(n,r,i.getTargetSelectorPrefix()),i._container=n,i.isContentJs()&&m.executeScriptsForNodes(i.getNodes()),e()})},r.prototype.renderObjectForContainerByPrefix=function(e,t,n){switch(n){case r.TARGET_SELECTOR_PREFIX_BEFORE:this.renderObjectForContainerBefore(e,t);break;case r.TARGET_SELECTOR_PREFIX_AFTER:this.renderObjectForContainerAfter(e,t);break;case r.TARGET_SELECTOR_PREFIX_INNER:this.renderObjectForContainerInner(e,t)}},r.prototype.renderObjectForContainerBefore=function(e,t){if(!e.parentNode||e.parentNode.nodeType!==Node.ELEMENT_NODE||"html"===e.parentNode.nodeName.toLowerCase())throw g.error("DynamicContentPreview:renderObjectForContainerBefore Invalid node to insert before",e,e.parentNode,this),new Error("Invalid node to insert before");m.insertBefore(e,t)},r.prototype.renderObjectForContainerAfter=function(e,t){if(!e.parentNode||e.parentNode.nodeType!==Node.ELEMENT_NODE||"html"===e.parentNode.nodeName.toLowerCase())throw g.error("DynamicContentPreview:renderObjectForContainerBefore Invalid node to insert after",e,e.parentNode,this),new Error("Invalid node to insert after");m.insertAfter(e,t)},r.prototype.renderObjectForContainerInner=function(e,t){if("html"===e.nodeName.toLowerCase())throw g.error("DynamicContentPreview:renderObjectForContainerBefore Invalid node to insert inner",e,this),new Error("Invalid node to insert inner");m.replaceChildren(e,t)};var j={_icon:'<svg viewBox="0 0 48 48"><path d="M20.591 10.124c1.442-2.499 5.047-2.499 6.49 0l13.833 23.961c1.443 2.497-.36 5.62-3.243 5.62H10c-2.884 0-4.687-3.122-3.245-5.62zm5.19.75c-.865-1.498-3.026-1.498-3.89 0L8.054 34.836c-.864 1.497.217 3.37 1.947 3.37H37.67c1.728 0 2.81-1.873 1.944-3.37zM23.75 30.85a.75.75 0 01.743.649l.007.101v1.16a.75.75 0 01-1.493.101L23 32.76v-1.159a.75.75 0 01.75-.75zm0-11.351a.75.75 0 01.743.648l.007.102v7.763a.75.75 0 01-1.493.101L23 28.013V20.25a.75.75 0 01.75-.75z"></path></svg>',_language:"EN",_i18n:{EN:{title:"Invalid preview of the Dynamic Content",preview:"The preview of the dynamic content has expired or may not exist. It has been 3 days since the link was generated, or the link may have been incorrect",selector:"The entered CSS selector does not exist on the target page",jinjava:"The JinJava used in the template cannot be rendered correctly"},PL:{title:"Podgląd kampanii Dynamic Content niedostępny",preview:"Podgląd kampanii Dynamic Content wygasł lub nie istnieje. Po trzech dniach od wygenerowania podglądu, zostaje on automatycznie usunięty. Sprawdź czy link jest poprawny lub wygeneruj nowy",selector:"Selektor CSS nie istnieje na stronie, na której uruchomiony jest podgląd",jinjava:"Kod JinJavy użyty w szablonie nie może zostać wyrenderowany dla wybranego profilu"}},prepareContent:function(e){var t=document.createElement("div"),n=(h.addClass(t,"snrs-preview-wrapper"),document.createElement("div")),r=(h.addClass(n,"snrs-preview-content"),document.createElement("p")),i=(h.addClass(r,"snrs-preview-title"),document.createElement("p")),o=(h.addClass(i,"snrs-preview-description"),u.getLanguage());return o&&o.toLowerCase().match("pl")&&(this._language="PL"),r.textContent=this._i18n[this._language].title,i.textContent=this._i18n[this._language][e],n.innerHTML=this._icon,n.appendChild(r),n.appendChild(i),t.appendChild(n),t},sho),a.show()},showJinjavaAlert:function(){var e=this.prepareContent("jinjava");this.showAlertModal(e)},showPreviewAlert:function(){var e=this.prepareContent("preview");this.showAlertModal(e)},showSertModal(e)}};function q(e,t){t=t||!0,e=e||{},this.viewsLimit=null,e.viewsLimit&&(this.viewsLimit=parseInt(e.viewsLimit,10)),t&&this.validate()}function v(e,t){t=t||!0,e=e||{},this._count=null,this._expiration=null,this.type=e.type,this.options=m.extend({count:null,times:null,timesType:null},e.options),this.options.count=this.options.count?parseInt(this.options.count,10):null,this.options.times=this.options.times?parseInt(this.options.times,10):null,this.calculateCountAndExpiration(),t&&this.validate()}function _(e,t){t=t||!0,e=e||{},this._count=null,this._expiration=null,this.type=e.type,this.options=m.extend({times:null},e.options),this.options.times=this.options.times?parseInt(this.options.times,10):null,t&&this.validate()}function G(e,t){t=t||!0,this.options=e||[],t&&this.validate()}function S(e,t){switch(t=t||!0,e=e||{},this._delayInSeconds=null,this.type=e.type,this.options={},this.type){case S.TYPE_ON_LANDING:this.options=m.extend({delayType:null,delayValue:null},e.options),this.options.delayValue=this.options.delayValue?parseInt(this.options.delayValue,10):null,this.calculateDelayInSeconds();break;case S.TYPE_AFTER_SCROLL:this.options=m.extend({scrollingPercentage:null},e.options),this.options.scrollingPercentage=this.options.scrollingPercentage?parseInt(this.options.scrollingPercentage,10):null}t&&this.validate()}function Y(e,t){t=t||!0,this.utm={utmCampaign:(e=e||{}).utmCampaign,utmMedium:e.utmMedium,utmSource:e.utmSource},this.parameters=m.extend({},e.parameters),t&&this.validate()}function C(e,t){t=t||!0,this.options=m.extend({id:null,name:null,percentage:null,content:{css:"",html:"",js:"",raw:""},selector:null,selectorPrefix:null},e),t&&this.validate()}function K(e,t){t=t||!0,this.options=m.extend({},{include:[],exclude:[]},e),t&&this.validate()}q.prototype.validate=function(){if(null!==this.viewsLimit&&isNaN(this.viewsLimit))throw new Error("Invalid views limit");return!0},q.prototype.isLimited=function(){return null!==this.viewsLimit},q.prototype.getViewsLimit=function(){return this.viewsLimit},v.TYPE_OPTIONS_LIST=[v.TYPE_ALWAYS="ALWAYS",v.TYPE_ONCE="ONCE",v.TYPE_ONCE_PER_VISIT="ONCE_PER_VISIT",v.TYPE_ONCE_PER_DAY="ONCE_PER_DAY",v.TYPE_MAXIMUM="MAXIMUM"],v.TIME_TYPE_OPTIONS_LIST=[v.TIME_TYPE_HOURS="HOURS",v.TIME_TYPE_DAYS="DAYS",v.TIME_TYPE_WEEKS="WEEKS"],v.EXPIRATION_SESSION=300,v.EXPIRATION_ON_PAGE_FOR_SESSION=1800,v.EXPIRATION_HOUR=3600,v.EXPIRATION_DAY=86400,v.EXPIRATION_WEEK=604800,v.EXPIRATION_MAX_VALUE=2592e3,v.prototype.validate=function(){var e=this.getType();if(!m.inArray(e,v.TYPE_OPTIONS_LIST))throw new Error('Frequency type ("'+e+'") is incorrect, only ['+v.TYPE_OPTIONS_LIST.join(",")+"] is allowed");if(e===v.TYPE_MAXIMUM){if(!m.inArray(this.options.timesType,v.TIME_TYPE_OPTIONS_LIST))throw new Error('Frequency time type ("'+this.options.timesType+'") is incorrect, only ['+v.TIME_TYPE_OPTIONS_LIST.join(",")+"] is allowed");if(null===this.options.count||isNaN(this.options.count))throw new Error("Invalid count limit");if(null===this.options.times||isNaN(this.options.times))throw new Error("Invalid times limit")}return!0},v.prototype.isLimited=function(){return this.getType()!==v.TYPE_ALWAYS},v.prototype.getType=function(){return this.type},v.prototype.getExpiration=function(){return this._expiration},v.prototype.isExpiration=function(){return null!==this._expiration},v.prototype.isSessio_PER_VISIT},v.prototype.getCount=function(){return this._count},v.prototype.isCount=function(){return null!==this._count},v.prototype.calculateCountAndExpiration=function(){switch(this.type){case v.TYPE_ALWAYS:this._count=null,this._expiration=null;break;case v.TYPE_ONCE:this._count=1,this._expiration=v.EXPIRATION_MAX_VALUE;break;case v.TYPE_ONCE_PER_VISIT:this._count=1,this._expiration=v.EXPIRATION_SESSION;break;case v.TYPE_ONCE_PER_DAY:this._count=1,this._expiration=v.EXPIRATION_DAY;break;case v.TYPE_MAXIMUM:if(this._count=isNaN(this.options.count)?null:this.options.count,(this._expiration=null)!==this._count&&!isNaN(this.options.times))switch(this.options.timesType){case v.TIME_TYPE_HOURS:this._expiration=this.options.times*v.EXPIRATION_HOUR;break;case v.TIME_TYPE_DAYS:this._expiration=this.options.times*v.EXPIRATION_DAY;break;case v.TIME_TYPE_WEEKS:this._expiration=this.options.times*v.EXPIRATION_WEEK}}},v.prototype.checkFrequencyLimit=function(e){return g.log("DynamicContentFrequency:checkFrequencyLimit",e,this._count,this),this.isCount()&&this.getCount()<=e},_.TYPE_OPTIONS_LIST=[_.TYPE_NEVER="NEVER",_.TYPE_AFTER_ACTION="AFTER_ACTION",_.TYPE_AFTER_SHOW="AFTER_SHOW"],_.STOP_DISPLAY_EXPIRATION_MAX_VALUE=2592e3,_.prototype.validate=function(){var e=this.getType();if(!m.inArray(e,_.TYPE_OPTIONS_LIST))throw new Error('Stop display type ("'+e+'") is incorrect, only ['+_.TYPE_OPTIONS_LIST.join(",")+"] is allowed");if(e!==_.TYPE_AFTER_SHOW||null!==this.options.times&&!isNaN(this.options.times))return!0;throw new Error("Invalid times limit")},_.prototype.isTYPE_NEVER},_.prototype.getType=function(){return this.type},_.prototype.getShowTimes=function(){return this.options.times},_.prototype.isShowTimes=function(){return this.isStopAfterShow()},_.prototype.isStopAfterShow=function(){return this.getType()===_.TYPE_AFTER_SHOW},_.prototype.isStopAfterAction=function(){return this.getType()===_.TYPE_AFTER_ACTION},_.prototype.checkShowTimesLimit=function(e){return g.log("DynamicContentStopDisplay:checkShowTimesLimit",e,this.getShowTimes(),this),this.isShowTimes()&&this.getShowTimes()<=e},G.TARGET_RESTRICTION_OPTIONS_LIST=[G.TARGET_RESTRICTION_MOBILE="MOBILE",G.TARGET_RESTRICTION_DESKTOP="DESKTOP"],G.prototype.validate=function(){var e;if(Array.isArray(this.options))return(e=this.getDevices()).length&&m.each(e,function(e){if(!m.inArray(e,G.TARGET_RESTRICTION_OPTIONS_LIST))throw new Error('Target selector prefix ("'+e+'") is incorrect, only ['+G.TARGET_RESTRICTION_OPTIONS_LIST.join(",")+"] is allowed")}),!0;throw new Error("Invalid target restriction options")},G.prototype.getDevices=function(){return this.options},S.TYPE_OPTIONS_LIST=[S.TYPE_ON_LANDING="ON_LANDING",S.TYPE_ON_EXIT="ON_EXIT",S.TYPE_AFTER_SCROLL="AFTER_SCROLL"],S.DELAY_TYPE_OPTIONS_LIST=[S.DELAY_TYPE_SECONDS="SECONDS",S.DELAY_TYPE_MINUTES="MINUTES"],S.TRIGGER_DELAY_EXPIRATION_VALUE=300,S.prototype.validate=function(){var e=this.getType();if(!m.inArray(e,S.TYPE_OPTIONS_LIST))throw new Error('Trigger type ("'+e+'") is incorrect, only ['+S.TYPE_OPTIONS_LIST.join(",")+"] is allowed");switch(e){case S.TYPE_ON_LANDING:if(null!==this.options.delayValue){if(isNaN(this.options.delayValue))throw new Error("Invalid delay value");if(!m.inArray(this.options.delayType,S.DELAY_TYPE_OPTIONS_LIST))throw new Error('Delay type ("'+this.options.delayType+'") is incorrect, only ['+S.DELAY_TYPE_OPTIONS_LIST.join(",")+"] is allowed")}break;case S.TYPE_AFTER_SCROLL:if(null===this.options.scrollingPercentage||isNaN(this.options.scrollingPercentage))throw new Error("Invalid scrolling percentage")}return!0},S.prototype.isInstant=function(){return this.getType()===S.TYPE_ON_LANDING&&!this.isDelay()},S.prototype.getType=function(){return this.type},S.prototdelayValue},S.prototype.getDelay=function(){return this.options.delayValue},S.prototype.getDelayType=function(){return this.options.delayType},S.prototype.getScrollingPercentage=function(){return this.options.scrollingPercentage},S.prototype.isTypeOnLanging=function(){return this.getType()===S.TYPE_ON_LANDING},S.prototype.isTypeOnExit=function(){return this.getType()===S.TYPE_ON_EXIT},S.prototype.isTypeAfterScroll=function(){return this.getType()===S.TYPE_AFTER_SCROLL},S.prototype.getDelayInSeconds=function(){return this._delayInSeconds},S.prototype.isDelyInSeconds},S.prototype.calculateDelayInSeconds=function(){if(null!==this.options.delayValue&&!isNaN(this.options.delayValue))switch(this.options.delayType){case S.DELAY_TYPE_SECONDS:this._delayInSeconds=this.options.delayValue;break;case S.DELAY_TYPE_MINUTES:this._delayInSeconds=60*this.options.delayValue}},S.prototype.checkScrollingAchieved=function(e){return this.isTypeAfterScroll()&&this.getScrollingPercentage()<=e},Y.prototy){return!0},Y.prototype.getUtm=function(){return this.utm},Y.prototype.getUtmCampaign=function(){return this.utm.utmCampaign},Y.prototype.getUtmMedium=function(){return this.utm.utmMedium},Y.prototype.getUtmSource=function(){return this.utm.utmSource},Y.prototype.getParameters=function(){return this.parameters},Y.prototype.getUtmWithParametersFlatMap=function(){return m.extend({},this.getParameters(),this.getUtm())},C.TARGET_SELECTOR_PREFIX_OPTIONS_LIST=[C.TARGET_SELECTOR_PREFIX_BEFORE="BEFORE",C.TARGET_SELECTOR_PREFIX_AFTER="AFTER",C.TARGET_SELECTOR_PREFIX_INNER="INNER"],C.prototype.validate=function(){if(!this.getName())throw new Error("Name not defined");var e=this.getTargetSelectorPrefix();if(e&&!m.inArray(e,C.TARGET_SELECTOR_PREFIX_OPTIONS_LIST))throw new Error('Target selector prefix ("'+e+'") is incorrect, only ['+C.TARGET_SELECTOR_PREFIX_OPTIONS_LIST.join(",")+"] is allowed");return!0},C.prototype.getId=function(){return this.options.id},C.prototype.getName=function(){return this.options.name},C.prototype.getPercentage=function(){return this.options.percentage},C.prototype.getControlGroupVariant=function(e,t){this.options.id=0,this.options.name="Control group",this.options.percentage=t,this.options.selectorPrefix="BEFORE",this.options.content={css:"",html:'<html><head></head><body><div id="snrs-campaign-'+e+'" class="snrs-control-group"></div></body></html>',js:""}},C.prototype.getContent=function(){return this.options.content},C.prototype.getTargetSelector=function(){return this.options.selector},C.prototype.getTargetSelectorPrefix=function(){return this.options.selectorPrefix},C.prototype.isContent=function(){return this.isContentHtml()||this.isContentCss()||this.isContentJs()},C.prototype.isContentHtml=function(){return!!this.getContent().html},C.prototype.isContentCss=function(){return!!this.getContent().css},C.prototype.isContentJs=function(){return!!this.getContent().js},C.prototype.getContentHtml=function(){return this.getContent().html},C.prototype.getContentCss=function(){return this.getContent().css},C.prototype.getContentJs=function(){return this.getContent().js},C.prototype.getContentToRender=function(){var e="";return this.isContentCss()&&(e+=this.getContentCssToRender()),this.isContentHtml()&&(e+=this.getContentHtmlToRender()),this.isContentJs()&&(e+=this.getContentJsToRender()),e},C.prototype.getContentHtmlToRender=function(){return this.getContentHtml()},C.prototype.getContentCssToRender=function(){return'<style type="text/css">'+this.getContentCss()+"</style>"},C.prototype.getContentJsToRender=function(){return'<script type="application/javascript">'+this.getContentJs()+"<\/script>"},K.VIEWS_PAGE_URL_TYPE_OPTIONS_LIST=[K.VIEWS_PAGE_URL_TYPE_EQUALS="EQUALS",K.VIEWS_PAGE_URL_TYPE_CONTAIN="CONTAIN",K.VIEWS_PAGE_URL_TYPE_REGEXP="REGEXP"],K.prototype.validate=function(){if(Array.isArray(this.options.include)&&Array.isArray(this.options.exclude))return m.each(this.options,function(e,t){Array.isArray(e)&&m.each(e,function(e){if(!m.inArray(e.type,K.VIEWS_PAGE_URL_TYPE_OPTIONS_LIST))throw new Error('Type of views page url ("'+e.type+'") is incorrect, only ['+K.VIEWS_PAGE_URL_TYPE_OPTIONS_LIST.join(",")+'] is allowed (in "'+t+'" mode)')})}),!0;throw new Error("Invalid views page url options")},K.prototype.getIncludePages=function(){return this.options.include},K.prototype.getExcludePages=function(){return this.options.exclude},K.prototype.isIncludePages=function(){return this.options.include&&this.options.include.length},K.prototype.isEude.length};var w={EVENT_LIST_SIGNED_IDENTIFIED:"signedIdentifiedActions",jwtRequired:!0,eventList:{},objectToActionMapping:{"event.track":"event.log","product.add":"product.addToCart","product.remove":"product.removeFromCart","client.data":"client.createOrUpdate","client.logIn":"client.login","client.logOut":"client.logout","custom.event":"customEvent.log"},init:function(){return new Q(function(t,n){w.getEventListByType(w.EVENT_LIST_SIGNED_IDENTIFIED).then(function(e){w.jwtRequired=Array.isArray(e)&&0<e.length,t()}).catch(function(e){g.error("EventManager:init EventManager.getEventListByType Error",e),n(e)})})},track:function(e,t){return g.log("EventManager:track",e,t),t=m.extend({url:$.location.href},t||{}),P.trackProxy({label:e,object:"event.track",params:t})},clientCreateOrUpdate:function(e,t){g.log("EventManager:clientCreateOrUpdate",e,t);var e={label:e,object:"client.data",params:t=m.extend({url:$.location.href},t||{})},t=(String.prototype.hashCode=function(){var e,t,n=0;if(0!==this.length)for(e=0,t=this.length;e<t;e++)n=(n<<5)-n+this.charCodeAt(e),n|=0;return n},JSON.stringify(e).hashCode()),n=localStorage.getItem("snrsClientHashCode");if(g.log("EventManager:clientCreateOrUpdate: currentHashCode & lcHashCode",t,n),typeof n===f||n!=t)return g.log("EventManager:clientCreateOrUpdate: SEND REQUEST:",e),localStorage.setItem("snrsClientHashCode",t),P.trackProxy(e)},sendFormData:function(n,r,i,o,s){return new Q(function(e,t){SyneriseTC.sendFormData(n,r,i,o,s).then(e).catch(t)})},pageVisit:function(n){r).catch(t)})},trackCustomEvent:function(r,i,o){return g.log("EventManager:trackCustomEvent",r,i,o),new Q(function(t,n){d.getCurrentClient().then(function(e){return e?e.uuid?r?(i=i||{},void P.track("",r,o,i).then(function(e){g.log("EventManager:trackCustomEvent fetch then",e),t(e)}).catch(function(e){g.error("EventManager:trackCustomEvent fetch error",e),n(e)})):n(new Error("Action is required")):n(new Error("Client is not identified")):n(new Error("Client not exists"))}).catch(function(e){g.error("Can not get current client",e),n(new Error("Client not exists"))})})},trackClientEvent:function(r,i,o){return g.log("EventManager:trackClientEvent",r,i,o),new Q(function(t,n){d.getCurrentClient().then(function(e){return e?e.uuid?i?(o=o||{},void P.track(r,i,e.uuid,o).then(function(e){g.log("EventManager:trackClientEvent fetch then",e),t(e)}).catch(function(e){g.error("EventManager:trackClientEvent fetch error",e),n(e)})):n(new Error("Action is required")):n(new Error("Client is not identified")):n(new Error("Client not exists"))}).catch(function(e){g.error("Can not get current client",e),n(new Error("Client not exists"))})})},trackDynamicContentEventShow:function(e){g.log("EventManager:trackDynamicContentEventShow",e);var t={id:e.getId(),campaignName:e.getSubject()},n=(e.frequency.isLimited()&&(t.frequencyCounter=y.getFrequencyValue(e),t.frequencyLimitAchieved=!y.checkFrequency(e)),e.getUtmWithParametersFlatMap()),t=m.extend({},n||{},t);return e.isControlGroup()?(t.type=e.getControlGroupType(),w.trackClientEvent("","dynamicContent.controlGroup",t)):(t.title=e.getSubject(),t.variantId=e.getVariantId(),t.variantName=e.getVariantName(),w.trackClientEvent("","dynamicContent.show",t))},getEventListByType:function(n){return new Q(function(t,e){if(w.eventList[n]!==f)return t(w.eventList[n]);b.getProfileConfigByType(n).then(function(e){if(g.log("EventManager:getEventListByType for type",n),e)return w.eventList[n]=e,t(w.eventList[n]);throw new Error("EventManager:getEventListByType Failed to fetch config.")}).catch(function(e){return t(e)})})},requiresAuthorization:function(n){return new Q(function(t,e){n||t(!1),w.getEventListByType(w.EVENT_LIST_SIGNED_IDENTIFIED).then(function(e){t(null===e||e.includes(",e),t(!0)})})},mapObjping[e]||e}},i={_dataMarker:null,_blockReloadInitForm:!(K.prototype.isMatchPageUrl=function(e){g.log("DynamicContentViewsPage:isMatchPageUrl",e,this.options,this);var t,r=this;function n(e,t){for(var n in t)if(t.hasOwnProperty(n)){n=t[n];if(function(e,t,n){switch(n){case K.VIEWS_PAGE_URL_TYPE_EQUALS:return e===t;case K.VIEWS_PAGE_URL_TYPE_CONTAIN:return-1!==e.indexOf(t);case K.VIEWS_PAGE_URL_TYPE_REGEXP:try{return new RegExp(t,"m").test(e)}catch(e){g.error("DynamicContentViewsPage:isMatchPageUrl RegExp invalid",t,n,e,r)}}}(e,n.requirement,n.type))return n}return!1}if(this.isIncludePages()){if(!1===(t=n(e,this.getIncludePages())))return g.log("DynamicContentViewsPage:isMatchPageUrl included - not allowed",this.getIncludePages(),this),!1;g.log("DynamicContentViewsPage:isMatchPageUrl included - allowed",t,this)}if(this.isExcludePages()){if(!1!==(t=n(e,this.getExcludePages())))return g.log("DynamicContentViewsPage:isMatchPageUrl excluded - not allowed",t,this.getExcludePages(),this),!1;g.log("DynamicContentViewsPage:isMatchPageUrl excluded - allowed",this)}return!0}),_isInitObserveMarker:!1,init:function(){try{return new Q(function(e,t){i.getDataMarker().then(function(e){g.log("FormMarker:init  FormMarker.getDataMarker() then",e),i.marker(e)}).then(function(){i.bindLiveFormMarker()}).catch(function(e){g.error(e),t(e)})})}catch(e){g.error("FormMarker::init",e)}},reloadInitForm:function(){0==i._blockReloadInitForm&&(i._blockReloadInitForm=!01,i.init()},1e3))},getDataMarker:function(){return new Q(function(t,n){i._dataMarker?(g.log("FormMarker:getFormMarker RequestManager.getFormMarker from cache",i._dataMarker),t(i._dataMarker)):b.getProfileConfigByType(b.PROFILE_CONFIG_TYPE_DATA_Mresolve(e)}).catch(function(e){n(e)}).then(function(e){g.log("FormMarker:getFormMarker RequestManager.getFormMarker then filtered",e),i._dataMarker=e,t(i._dataMarker)}).catch(function(e){n(e)})})},marker:function(t){try{g.log("FormMarker:marker",t),this.validData(t)&&this.markerForm(t)}catch(e){g.error("FormMarker:marker",t,e)}},validData:function(e){return!!Array.isArray&&Array.isArray(e)},addAttribute:function(e,t){g.log("FormMarker:addAttribute",e,t),e.setAttribute("data-synerise",t)},addDataValue:function(e,t){g.log("FormMarker:addDataValue",e,t),e.setAttribute("data-synerise-value",t)},checkCondition:function(e){return!(e.conditions_include_page&&-1==document.URL.indexOf(e.conditions_include_page)||e.conditions_exclude_page&&-1!==document.URL.indexOf(e.conditions_exclude_page))},markerForm:function(e){var n=this,r=[];e.forEach(function(t){var e;t.selector&&n.checkCondition(t)&&(e=document.querySelectorAll(t.selector),g.log("FormMarker:markerForm search selector: ["+t.selector+"] found: "+e.length),e.forEach(function(e){t.attribute&&!e.hasAttribute("data-synerise")&&(n.addAttribute(e,t.attribute),"form"==e.tagName.toLowerCase())&&r.push(e),""==t.data_value||e.hasAttribute("data-value")||n.addDataValue(e,t.data_value)}))}),n.tcSyneriseForm(r)},bindLiveFormMarker:function(){var e;0==i._isInitObserveMarker&&(g.log("bindLiveFormMarker init!"),i._isInitObserveMarker=!0,"MutationObserver"in $?(e=document.querySelector("body"),new MutationObserver(function(e){var r=new RegExp("<s*form","i");e.forEach(function(e){for(var t=0;t<e.addedNodes.length;++t){var n=e.addedNodes[t].nodeValue||e.addedNodes[t].outerHTML;r.test(n)&&(g.log("bindLiveFormMarker call reloadInitForm:",e.addedNodes[t]),i.reloadInitForm())}})}).observe(e,{attributes:!1,childList:!0,characterData:!1})):(g.log("[FormMarker] bindLiveFormMarker MutationObserver is not supported by your browser."),setTimeout(i.reloadInitForm(),3e3)))},tcSyneriseForm:function(e){g.log("FormMarker:tcSyneriseForm"),e.forEach(function(e){g.log("FormMarker:initFormCatch element: ",e),SyneriseTC.initFormCatch(e)})}},J={init:function(){var n=this;return new Q(function(e,t){"#_snrs_tool_marker"==$.location.hash&&(k.set("_snrs_tool_marker",1),n.removeHashFromUrl()),1==k.get("_snrs_tool_marker")&&n.appendToolMarker()})},appenndChild(e)},removeon.search)}},a={_initialized:!1,_html:'<div class="snrs-modal-wrapper"><div class="snrs-modal"><div class="snrs-modal-btn-close"></div><div class="snrs-modal-content"></div><div class="popup-backdrop"></div></div></div>',_container:null,_containerModal:null,_contentCtr:null,_closeBtn:null,_modalShowClass:"snrs-modal-show",_hideClass:"snrs-hide",_transparentModalClass:"snrs-transparent-modal",_cancelBtnClass:"snrs-notify--cancel",_closeBtnClass:"snrs-notify--close",_saveBtnClass:"snrs-notify--allow",_callbackStack:{onCancel:function(){},onClose:function(){},onSave:function(){},onShow:function(){},onHide:function(){}},_attachGeneralActions:function(){g.log("Modal:_attachGeneralActions"),a._closeBtn&&h.addEvent(a._closeBtn,"click",function(e){a.close()})},_modalCloseBtnVisibility:function(e){if(g.log("Modal:_modalCloseBtnVisibility",e),!a._closeBtn)return!1;e?h.removeClass(a._closeBtn,a._hideClass):h.addClass(a._closeBtn,a._hideClass)},_triggerCallback:function(e){if(g.log("Modal:_triggerCallback",e),a._callbackStack[e]){for(var t=new Array(arguments.length-1),n=0;n<t.length;++n)t[n]=arguments[n+1];var r=a._callbackStack[e];if(m.isFunction(r))if(!1===r.apply(a,t))return!1}},_attachContentActions:function(){g.log("Modal:_attachContentActions");var e=a._contentCtr.getElementsByClassName(a._cancelBtnClass),e=(g.log("Modal:_attachContentActions attach cancel items",e.length,e),0<e.length&&m.each(e,function(e,t){h.addEvent(e,"click",function(e){g.log("Modal:_attachGeneralActions action - on cancel ",e,this),a.cancel()})}),a._contentCtr.getElementsByClassName(a._closeBtnClass)),e=(g.log("Modal:_attachContentActions attach close items",e.length,e),0<e.length?(a._modalCloseBtnVisibility(!1),m.each(e,function(e,t){h.addEvent(e,"click",function(e){g.log("Modal:_attachGeneralActions action - on close ",e,this),a.close()})})):a._modalCloseBtnVisibility(!0),a._contentCtr.getElementsByClassName(a._saveBtnClass));g.log("Modal:_attachContentActions attach save items",e.length,e),0<e.length&&m.each(e,function(e,t){h.addEvent(e,"click",function(e){g.log("Modal:_attachGeneralActions action - on save ",e,this),a.save()})})},onCancel:function(e){a._callbackStack.onCancel=e},onClose:function(e){a._callbackStack.onClose=e},onSave:function(e){a._callbackStack.onSave=e},onShow:function(e){a._callbackStack.onShow=e},onHide:function(e){a._callbackStack.onHide=e},init:function(){var e;g.log("Modal:init - initialized:",a._initialized),a._initialized||((e=document.createElement("div")).innerHTML=a._html,a._container=e.childNodes[0],a._contentCtr=a._container.querySelector(".snrs-modal-content"),a._closeBtn=a._container.querySelector(".snrs-modal-btn-close"),a._containerModal=a._container.querySelector(".snrs-modal"),document.body&&(document.body.appendChild(a._container),a._attachGeneralActions()),a._initialized=!0)},setContent:function(e){g.log("Modal:setContent",!!e),m.replaceChildren(a._contentCtr,e),a._attachContentActions()},antainer,e)},show:function(){var e=a.isShown();g.log("Modal:show - hasShow",!!e),e||(h.addClass(a._container,a._modalShowClass),a._triggerCallback("onShow"))},hide:function(){var e=a.isShown();g.log("Modal:hide - hasShow",!!e),e&&(h.removeClass(a._container,a._modalShowClass),a._triggerCallback("onHide"))},isShown:function(){return h.hasClass(a._container,a._modalShowClass)},isTransodalClass)},turnOnTransparentModal:function(){a.isTransparentModal()||h.addClass(a._containerModal,a._transparentModalClass)},turnOffTransparentModal:function(){a.isTransparentModal()&&h.removeClass(a._containerModal,a._transparentModalClass.isShown()},cancel:function(){a.isShown()&&!1!==a._triggerCallback("onCancel")&&a.hide()},close:function(){a.isShown()&&!1!==a._triggerCallback("onClose")&&a.hide()},save:function(){a.isShown()&&!1!==a._triggerCallback("onSave")&&a.hide()}};function E(e){e=e||{},this._container=null,this._contentCtr=null,this._nativeObject=null,this._status=E.STATUS_NEW,this.id=e.id||null,this.name=e.name||null,this.content=e.content||null,this.conditions=e.conditions||{},this.conditions.includeType=this.conditions.includeType||E.PAGE_URL_MATCH_TYPE_CONTAINS,this.conditions.excludeType=this.conditions.excludeType||E.PAGE_URL_MATCH_TYPE_CONTAINS,this.capping=e.capping||{type:"count",expiration:null,count:null},this.additionalParams=e.additionalParams||{},this.type=e.type||"content",this.template=e.template||"default",this.contentSent=e.contentSent||null,this.contentAlreadyExists=e.contentAlreadyExists||null,this.contentProducts=e.contentProducts||null,this.targetSelector=e.targetSelector||null,this.leavePopupNotOpened=!0,this.isNative="native"===this.type}E.STATUS_RENDERED="RENDERED",E.STATUS_NEW="NEW",E.PAGE_URL_MATCH_TYPE_CONTAINS="contains",E.PAGE_URL_MATCH_TYPE_ALLOWED_LIST=[E.PAGE_URL_MATCH_TYPE_EQUALS="equals",E.PAGE_URL_MATCH_TYPE_CONTAINS],E.prototype.getStatus=function(){return this._status},E.prototype.isPageUrlAllowed=function(c){function e(e){if(-1!==E.PAGE_URL_MATCH_TYPE_ALLOWED_LIST.indexOf(e))return 1;g.error("ContentNotification:isMatchPageUrl invalid type",e,this)}function t(e,t,n){var r,i,o,s=t.split("|");for(r in s)if(s.hasOwnProperty(r)){var a=s[r];if(i=c,a=a,(o=n)===E.PAGE_URL_MATCH_TYPE_EQUALS?i===a:o===E.PAGE_URL_MATCH_TYPE_CONTAINS&&-1!==i.indexOf(a))return!0}return!1}if(g.log("ContentNotification:isMatchPageUrl",c,this.conditions,this),this.conditions.pageUrl){if(!e(this.conditions.includeType))return!1;if(!(n=t(0,this.conditions.pageUrl,this.conditions.includeType)))return g.log("ContentNotification:isMatchPageUrl included - not allowed",this.conditions.pageUrl,this.conditions.includeType,n,this),!1;g.log("ContentNotification:isMatchPageUrl included",n,this)}if(this.conditions.excludePageUrl){if(!e(this.conditions.excludeType))return!1;var n;if(!(n=!t(0,this.conditions.excludePageUrl,this.conditions.excludeType)))return g.log("ContentNotification:isMatchPageUrl excluded - not allowed",this.conditions.excludePageUrl,this.conditions.excludeType,n,this),!1;g.log("ContentNotification:isMatchPageUrl excluded",!n,this)}return!0},E.prototype.isRendered=function(){return this._status===E.STATUS_RENDERED},E.prototype.setStatusRendered=function(){return this._status=E.STATUS_RENDERED,g.log("ContentNotification:setStatusRendered",this),this},E.prototype.render=function(){var o=this;return new Q(function(t,n){var e;if(g.log("ContentNotification:render isNative",o,o.isNative),o.isNative)return"web_push_agreement"!==o.template?n(new Error('Template type ("'+o.template+'") is incorrect for notification, only "web_push_agreement" is allowed for native notification')):D.getMode()!==D.CONFIG_WEBPUSH_MODE_NATIVE?n(new Error('Web push service mode ("'+D.getMode()+'") does not support auto triggering web push agreement')):(e=D.getBrowserPermissionState(),g.log("ContentNotification:render check permission",e),e!==M.BROWSER_PERMISSION_DEFAULT?n(new Error('Auto triggering native web push agreement is disabled if browser permission is "'+e+'"')):(g.log("ContentNotification:render subscribe",o),void D.subscribe().then(function(e){return g.log("ContentNotification:render subscribe then Notification permission",o,e),void 0!==e&&!e||o.setStatusRendered(),t()}).catch(function(e){g.error("ContentNotification:render subscribe error occurred",e),n(e)})));var r=document.createElement("div");switch(r.className+=" snrs-notify",r.className+=" snrs-notify-type-"+o.type,r.className+=" snrs-notify-template-"+o.template,r.className+=" snrs-notify-rendered",o.type){case"popup":document.querySelector("snrs-notify-type-popup")?n():(r.innerHTML=m.unescapeHtml(o.content),a.setContent(r),o._container=a._contentCtr,o._contentCtr=r);break;case"content":var i=o.targetSelector?document.querySelector(o.targetSelector):null;if(g.log("ContentNotification:render container",i),!i)return n(new Error("Can not found container("+o.targetSelector+") for notification"));r.innerHTML=m.unescapeHtml(o.content),o._container=i,o._contentCtr=r;break;default:return n(new Error('Notification type ("'+o.type+'") is incorrect, only "popup", "content" is allowed'))}if(!o._container)return n(new Error("ContentNotification container is not defined"));o._contentCtr&&m.executeScripts(o._contentCtr),T.attachHandlers(o).then(function(e){return g.log("ContentNotification:render attachHandlers then",o,e),void 0!==e&&!e||("popup"===o.type?a.show():"content"===o.type&&m.replaceChildren(o._container,o._contentCtr),o.setStatusRendered()),t()}).catch(function(e){g.error("ContentNotification:render attachHandlers error occurred",e),n(e)})})};var T={_notifications:null,_stylesUrl:[],init:function(e){return new Q(function(t,n){T.getNotifications().then(function(e){g.log("NotificationManager:init  NotificationManager.getNotifications() then",e),t(e)}).catch(function(e){g.error(e),n(e)})})},getConnectedSocket:function(){return"undefined"==typeof SocketManager?Q.reject(new Error("Socket module not defined")):SocketManager.getConnectedSocket()},initSocketNotification:function(){return new Q(function(t,n){g.log("NotificationManager:initSocketNotification"),T.getConnectedSocket().then(function(e){e.on("dynamicContentMessage",function(t){T.renderNotificationForCurrentClient(t).catch(function(e){g.error("Can not render notification for message",t),g.error(e)})}),g.log('NotificationManager:initSocketNotification listening "dynamicContentMessage"',e),t()}).catch(function(e){g.error(e),n(e)})})},renderNotificationForCurrentClient:function(e){return new Q(function(n,r){g.log("NotificationManager:renderNotificationForCurrentClient",e),d.getCurrentClient().then(function(t){T.filterUnsupportedNotifications([new E(e)]).then(function(e){e.length&&t.renderNotification(e[0],!0).then(function(e){g.log("NotificationManager:renderNotificationForCurrentClient rendered",e),n()}).catch(r)}).catch(r)}).catch(r)})},prepareStyles:function(){var e=P.utils.getStyleUrl();return T._stylesUrl.push(e),z.loadStyles(T._stylesUrl)},attachHandlers:function(s){return new Q(function(e,t){if(!s._contentCtr)return e(!1);switch(s.template){case"newsletter":var n;return b.getOption("notificationNewsletterHandlers")?(n=s._contentCtr.getElementsByTagName("form"),m.each(n,function(i){var o=i.onsubmit;i.onsubmit=function(e){g.log("Notification:render form submit then",i,s),(e=e||$.event).preventDefault?e.preventDefault():e.returnValue=!1;function t(e){e&&"undefined"!=typeof SyneriseTC&&SyneriseTC.sendFormData(e.type,e.fields,e.fieldsMapping),"function"===(typeof o).toLowerCase()&&o.call(r),s.contentSent&&setTimeout(function(){g.log("Notification:render form submit then saved",i,s),s._contentCtr.innerHTML=m.unescapeHtml(s.contentSent)},1e3),"popup"==s.type&&setTimeout(function(){g.log("Notification:render form submit - close modal",i,s),a.hide()},5e3)}var n,r=this;return"undefined"!=typeof SyneriseTC?((n=SyneriseTC.getFormData(i)).type=i.getAttribute("data-synerise"),e=void 0!==n.fieldsMapping.email?n.fields[n.fieldsMapping.email]:f,g.log("Notification:render form submit then - check email exists:",!!s.contentAlreadyExists,e),s.contentAlreadyExists?P.checkNewsletterSubscription(e).then(function(e){g.log("RequestManager.checkNewsletterSubscription then",e),0==e?t(n):"subscribed"===e||"waiting_for_confirmation"===e?(s._contentCtr.innerHTML=m.unescapeHtml(s.contentAlreadyExists),"popup"==s.type&),a.hide()},4e3)):(g.error("Invalid response. Can not check newsletter subscription"),t(n))}).catch(function(e){g.error("Can not check newsletter subscription",e),t(n)}):t(n)):(g.error("Synerise tracking codes is not defined."),t()),!1}})):"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(s._contentCtr),e(!0);case"products":return"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(s._contentCtr),s._container.style.display="none",s.contentProducts&&P.getProductSku(s.contentProducts,O.getClientUuid()).then(function(e){s._container.style.display="block";var t=s._contentCtr.getElementsByClassName("snrs-products");return 0<t.length?(t[0].innerHTML=e,new X({sliderSelector:"ul.snrs-products"}),"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(t[0])):(s._contentCtr.innerHTML=e,"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(s._contentCtr)),Q.resolve(e)}),e(!0);case"web_push_agreement":if(void 0===D)return g.info("NotificationManager:attachHandlers Web push module not defined",s),e(!1);if(!D.checkSubscribeRequestNeed())return g.log("NotificationManager:attachHandlers Web push agreement is not needed",s),e(!1);D.isWebPushAppReady().then(function(){"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(s._contentCtr),D.attachHandlers(s._contentCtr),e(!0)}).catch(function(){e(!1)});break;default:return"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(s._contentCtr),void 0!==D&&D.attachHandlers(s._contentCtr),e(!0)}})},getNotifications:function(){return new Q(function(t,n){T._notifications?(g.log("NotificationManager:getNotifications RequestManager.getNotifications from cache",T._notifications),t(T._notifications)):b.getProfileConfigByType(b.PROFILE_CONFIG_TYPE_NOTIFICATIONS).then(T.parseDataToObjects).then(T.filterUnsupportedNotifications).then(function(e){g.log("NotificationManager:getNotifications RequestManager.getNotifications then filtered",e),T._notifications=e,T.prepareStyles(),t(T._notifications)}).catch(function(e){n(e)})})},getNotificationsForClient:function(e){return new Q(function(t,n){g.log("NotificationManager:getNotificationsForClient",e),e.getTags().then(function(s){e.getSegments().then(function(e){var o={};o.tags=s,o.segments=e,T.getNotifications().then(function(e){g.log("NotificationManager:getNotificationsForClient NotificationManager.getNotifications() then",e,o);var i=[];m.each(e,function(t){if(t.conditions)if(t.conditions.include){var e=t.conditions.include;switch(e.type){case"segments":e.items&&m.each(e.items,function(e){m.inArray(e,o.segments)&&i.push(t)});break;case"tag":e.items&&m.e&i.push(t)});break;case"all":i.push(t)}}else{var n,r;t.conditions.exclude&&"tag"===(n=t.conditions.exclude).type&&n.items&&(r=!0,m.es)&&(r=!1)}),r)&&i.push(t)}}),t(i)}).catch(n)})})})},parseDataToObjects:function(r){return new Q(function(e,t){g.log("NotificationManager:parseToObjects");var n=[];m.isEmpty(r(new E(e))}),e(n)})},getUnsupportedModules:function(){return new Q(function(e,t){g.log("NotificationManager:getUnsupportedModules");var n={};Q.all([new Q(function(e,t){if(void 0===D)return g.info("NotificationManager:getUnsupportedModules Web push module not defined"),n.webPush=!0,e();D.isWebPushSupported().then(function(){ush=!0,e()})})]).then(function(){e(n)}).catch(function(e){t(e)})})},filterUnsupportedNotifications:function(n){return new Q(function(e,t){g.log("NotificationManager:filterUnsupportedNotifications",n),T.getUnsupportedModules().then(function(s){g.log("NotificationManager:filterUnsupportedNotifications getUnsupportedModules than",n,s);var a,c=[];return m.isEmpty(n)||(a={},m.each(n,function(e){if("web_push_agreement"===e.template){if(s.webPush)return void g.log("NotificationManager:filterUnsupportedNotifications filtered (unsuported webpush module)",e);if(!D.checkSubscribeRequestNeed())return void g.log("NotificationManager:filterUnsupportedNotifications filtered (Web push agreement is not needed)",e)}if(e.conditions){if(!e.isPageUrlAllowed(location.href))return void g.log("NotificationManager:filterUnsupportedNotifications filtered (wrong current page url)",e);if(e.conditions.deviceType&&!u.checkDeviceType(e.conditions.deviceType))return void g.log("NotificationManager:filterUnsupportedNotifications filtered (wrong current device type)",e);if(e.conditions.timeFrom||e.conditions.timeTo){g.log("NotificationManager:filterUnsupportedNotifications filter for time showing",e.conditions.timeFrom,e.condition.\d+./,"")}var n,r=e.conditions.timeFrom,i=e.conditions.timeTo,o=new Date;if(null==r&&((n=new Date).setDate(o.getDate()-7),r=t(n)),null==i&&((n=new Date).setDate(o.getDate()+7),i=t(n)),n=r.length<19?h.prepareTimeForDate(r||"00:00:00",o):new Date(r),(r=i.length<19?h.prepareTimeForDate(i||"23:59:59",o):new Date(i)).setTime(r.getTime()-60*r.getTimezoneOffset()*1e3),n.setTime(n.getTime()-60*n.getTimezoneOffset()*1e3),"Invalid Date"===n.toString()||"Invalid Date"===r.toString())return void g.error("NotificationManager:filterUnsupportedNotifications filtered (invalid showing time)",n,r,e);if(o<n||r<o)return void g.log("NotificationManager:filterUnsupportedNotifications filtered (wrong showing time)",o,n,r)}}if("content"===e.type){if(!e.targetSelector)return void g.log("NotificationManager:filterUnsupportedNotifications filtered (empty target selector)",e);if(a[e.targetSelector])return void g.log("NotificationManager:filterUnsupportedNotifications filtered (with same target selector)",e);a[e.targetSelector]=!0}c.push(e)})),e(c)}).catch(function(e){t(e)})})},leavePopupOpenEventHandler:function(e,t,n){t.leavePopupNotOpened&&n.clientY<=0&&(n.preventDefault(),e.renderNotification(t,!0),t.leavePopupNotOpened=!1)},attachHandlerForLeavePopup:function(e,t){document.addEventListener("mouseout",T.leavePopupOpenEventHandler.bind(this,e,t))},turnOffPopupTransparentBackground:function(){a.turnOffTransparentModal()},turnOnPopupTransparentBackground:function(){a.turnOnTransparentModal()}},X=function(e){for(var t in this.properties={sliderSelector:"ul.snrs-products",slidesTagName:"LI",displayedItemCount:5,slideIntervalMiliseconds:3e3,isResponsive:!0,navigateLeftSelector:".snrs-left-arrow",navigateRightSelector:".snrs-right-arrow",breakingPoints:{small:650,medium:1280}},e)e.hasOwnProperty(t)&&(this.properties[t]=e[t]);this.slider=document.querySelector(this.properties.sliderSelector),null!==this.slider&&(this.slidesCollection=this.slider.getElementsByTagName(this.properties.slidesTagName),this.slideCount=this.slidesCollection.length,this.roundedSlideCount=Math.ceil(this.slideCount/this.properties.displayedItemCount)*this.properties.displayedItemCount,this.sliderPercentWidth=100*Math.ceil(this.roundedSlideCount/this.properties.displayedItemCount),this.position=0,this.init())},P=(X.prototype.init=function(){this.setResponsivity(),this.slider.style.width=this.sliderPercentWidth+"%",this.createNavigation(),this.setSlidesWidth(),this.setInterval=setInterval(this.slideRTL.bind(this),this.properties.slideIntervalMiliseconds),this.attachSlideEvents()},X.prototype.setResponsivity=function(){var e=$.innerWidth;e>this.properties.breakingPoints.small&&e<this.properties.breakingPoints.medium?this.properties.displayedItemCount=3:e<this.properties.breakingPoints.small&&(this.properties.displayedItemCount=1),this.roundedSlideCount=Math.ceil(this.slideCount/this.properties.displayedItemCount)*this.properties.displayedItemCount,this.sliderPercentWidth=100*Math.ceil(this.roundedSlideCount/this.properties.displayedItemCount)},X.prototype.setSlidesWidth=function(){for(var e=1/this.roundedSlideCount*100+"%",t=0,n=this.slidesCollection.length;t<n;t+=1)this.slidesCollection[t].style.width=e},X.prototype.getSlideDistance=function(){return 100*this.position/Math.ceil(this.slideCount/this.properties.displayedItemCount)},X.prototype.slideRTL=function(){this.position=++this.position<Math.ceil(this.slideCount/this.properties.displayedItemCount)?this.position:0,this.slider.style.transform="translateX(-"+this.getSlideDistance()+"%)"},X.prototype.slideLTR=function(){this.position=0<=--this.position?this.position:Math.ceil(this.slideCount/this.properties.displayedItemCount)-1,this.slider.style.transform="translateX(-"+this.getSlideDistance()+"%)"},X.prototype.createNavigation=function(){var e=document.createElement("DIV"),t=document.createElement("DIV");e.className="snrs-arrow snrs-left-arrow",t.className="snrs-arrow snrs-right-arrow",document.querySelector(".snrs-products-slider").appendChild(e),document.querySelector(".snrs-products-slider").appendChild(t)},X.prototype.attachSlideEvents=function(){var e=this;document.querySelector(this.properties.navigateLeftSelector).addEventListener("click",function(){clearInterval(e.setInterval),e.slideLTR(),e.setInterval=setInterval(e.slideRTL.bind(e),e.properties.slideIntervalMiliseconds)}),document.querySelector(this.properties.navigateRightSelector).addEventListener("click",function(){clearInterval(e.setInterval),e.slideRTL(),e.setInterval=setInterval(e.slideRTL.bind(e),e.properties.slideIntervalMiliseconds)})},X.prototype.off=function(){for(var e=0,t=this.properties.slidesCollection.length;e<t;e+=1)this.properties.slidesCollection[e].style.width="";clearInterval(this.setInterval),this.properties.slider.style.width="",this.properties.slider.style.transform="",document.querySelector(this.properties.navigateRight).remove(),document.querySelector(this.properties.navigateLeft).remove()},{trackingDomain:"https://web.snrbox.com",trackIGifUrl:"/_i.gif",trackSdkProxyUrl:"/tck/sdk-proxy",rtomUrl:"/rtom",rtomProxyUrl:"/rtom-proxy/rtom",dynamicContentUrl:"/dc/v4",trackerLogsUrl:"/tck/logs",productsRenderBySkuUrl:location.protocol+"//"+location.hostname+"/dynamicblock/products",utils:{getSsuid:function(){var e=k.get("_snrs_sa"),t="";return t=e&&e.ssuid?e.ssuid:t},setTrangDomain=e},processStatus:function(e){var t;return g.log("RequestManager:utils:processStatus",e),200===e.status||201===e.status||0===e.status?Q.resolve(e):((t=new Error(e.statusText)).status=e.status,Q.reject(t))},getStyleUrl:function(){return b.getOption("trackingDomain")?b.getOption("trackingDomain")+"/sdk/3.0/synerise-javascript-sdk.min.css":"https://www.snrcdn.net/sdk/3.0/synerise-javascript-sdk.min.css"},getDataKey:function(e){return void 0!==e.data?Q.resolve(e.data):Q.reject(new Error("Can no get data from response"))},getDataFromKeyName:function(e,t){return void 0!==e[t]?Q.resolve(e[t]):Q.reject(new Error("Can no get data from response"))n e.json()},fetchWithTimeout:function(e,t){void 0!==t&&null!=t||(t=4e3);var n=new AbortController,r=n.signal,i{n.abort()},t);return Z(e,{signal:r}).then(function(e){return clearTimeout(i),i=f,Q.resolve(e)}).then(P.utils.processStatus).catch(function(e){return clearTimeout(i),i=f,"AbortError"===e.name?Q.reject(new Error("Request Timeout")):Q.reject(e)})},fetchWithTieout(e,t))},trackEventWithCheckPossibility:function(e){return u.isCrawler()?new Error("Can not track event - crawler detected"):P.utils.fetchWithTimeoutAndLog(e,4e3)},checkMe()?2e3:1e4}},getProductSku:function(o,e){g.log("RequestManager:getProductSku");var t={"no-buy":"stats/transaction/no-buy-products","last-view":"products/last-view","top-vew":"products/top-vew",recommend:"products/recommend",similar:"products/recommend"},i=null,s=(void 0!==t[o]&&(i=t[o]),"");if("similar"==o){sku="";try{sku=document.head.querySelector('meta[property="product:retailer_part_no"]').content}catch(e){}s="sku="+sku}else s="clientUUID="+encodeURIComponent(e);return"function"==typeof srRenderProducts&&(s+="&onlySku=1"),new Q(function(n,t){var e={"Content-Type":"application/json"},r=(e[l.getHeaderAuth("key")]=l.getHeaderAuth("value"),P.trackingDomain+P.rtomProxyUrl+"/"+i+"?"+s),r=new x(r,{method:"GET",mode:"cors",redirect:"follow",headers:new ee(e)});P.utils.fetchWithTimeoutAndLog(r).then(P.utils.processStatus).then(P.utils.parseJson).then(function(e){if(g.log("RequestManager:getProductSku fetch then",e),m.isEmpty(e)||m.isEmpty(e.items))throw new TypeError("Empty list product to render");var t,i="";"function"==typeof srRenderProducts?(t=[],e.itush(e.sku)}),srRenderProducts(t,o,function(e){n(e)})):(e.items.forEach(function(e){var t=e.category!==f?'<p class="snrs-product-category">'+e.category+"</p>":"",n=e.sku!==f?'<p class="snrs-product-sku">'+e.sku+"</p>":"",r=e.name!==f?'<p class="snrs-product-title">'+e.name+"</p>":"";i+='<li class="snrs-product" ><a  class="snrs-product-href" href="'+e.url+"?snr_medium=synerise_products&snr_source=synerise&snr_campaign="+o+'" ><img  class="snrs-product-image" alt="'+e.name+'" src="'+e.image+'"/></a>'+t+n+r+"</li>"}),n('<div class="snrs-products-slider"><ul class="snrs-products">'+i+"</ul></div>"))}).catch(function(e){g.error("RequestManager:getProductSku fetch error",e),t(e)})})},checkNewsletterSubscription:function(r){g.log("RequestManager:checkNewsletterSubscription");var i={"Content-Type":"application/json"};return i[l.getHeaderAuth("key")]=l.getHeaderAuth("value"),new Q(function(t,n){var e=P.trackingDomain+P.rtomUrl+"/newsletter/check-subscription?email="+encodeURIComponent(r),e=new x(e,{method:"GET",mode:"cors",redirect:"follow",headers:new ee(i)});P.utils.fetchWithTimeoutAndLog(e).then(P.utils.processStatus).then(P.utils.parseJson).then(function(e){return void 0!==e.status?Q.resolve(e.status):Q.reject(new Error("Can no get status from response"))}).then(function(e){g.log("RequestManager:checkNewsletterSubscription fetch then",e),t(e)}).catch(function(e){g.error("RequestManager:checkNewsletterSubscription fetch error",e),n(e)})})},getNotifications:function(){return g.log("RequestManager:getNotifications"),new Q(function(t,n){var e={"Content-Type":"application/json"},r=(e[l.getHeaderAuth("key")]=l.getHeaderAuth("value"),P.trackingDomain+P.rtomProxyUrl+"/clients/notificationTemplates"),r=new x(r,{method:"GET",mode:"cors",redirect:"follow",headers:new ee(e)});P.utils.fetchWithTimeoutAndLog(r).then(P.utils.processStatus).then(P.utils.parseJson).then(P.utils.getDataKey).then(function(e){g.log("RequestManager:getNotifications fetch then",e),t(e)}).catch(function(e){g.error("RequestManager:getNotifications fetch error",e),n(e)})})},getDynamicContentsFiltered:function(i){return g.log("RequestManager:getDynamicContentsFiltered"),new Q(function(t,n){var e=P.trackingDomain+P.dynamicContentUrl+"/dynamicContent/filtered?code="+l.trackerKey()+"&uuid="+encodeURIComponent(i.uuid),r=new x(e,{method:"GET",mode:"cors",redirect:"follow",headers:new ee({"Content-Type":"text/plain"})});g.log("RequestManager:getDynamicContentsFiltered fetch",e),P.utils.fetchWithTimeoutAndLog(r).then(P.utils.processStatus).then(P.utils.parseJson).then(function(e){g.log("RequestManager:getDynamicContentsFiltered fetch then",e),t(e)}).catch(function(e){g.error("RequestManager:getDynamicContentsFiltered fetch error",e),n(e)})})},getDynamicContentByUuids:function(s,a){return g.log("RequestManager:getDynamicContentByUuids",a),new Q(function(t,n){var e=P.trackingDomain+P.dynamicContentUrl+"/dynamicContent/byUuids?code="+l.trackerKey()+"&uuid="+encodeURIComponent(s.uuid),r=y.getVariables(),i={},r=(m.each(a,function(e){i[e.getId()]=e.getVariantId()||0}),{variantFilters:i,variables:r,referer:location.href}),o=e+"&query="+encodeURIComponent(h.utoa(JSON.stringify(r)));o.length<P.utils.checkMethodLimiter()?P.getDynamicContentByGet(e,o,r).then(function(e){t(e)}).catch(function(e){n(e)}):P.getDynamicContentByPost(e,r).then(function(e){t(e)}).catch(function(e){n(e)})})},getDynamicContentPreview:function(i,o){return new Q(function(t,n){var e=P.trackingDomain+P.dynamicContentUrl+"/dynamicContent/preview?code="+l.trackerKey()+"&uuid="+o,r={variables:y.getVariables(),templateId:i},e=new x(e,{method:"POST",headers:new ee({"Content-Type":"application/json"}),body:JSON.stringify(r)});P.utils.fetchWithTimeoutAndLog(e).then(P.utils.processStatus).then(P.utils.parseJson).then(function(e){g.log("RequestManager:getDynamicContentPreview fetch",e),t(e)}).catch(function(e){g.log("RequestManager:getDynamicContentPreview error",e),n(e)})})},getDynamicContentByGet:function(r,i,o){return g.log("RequestManager:getDynamicContentByGet",o),new Q(function(t,n){var e=new x(i,{method:"GET",headers:new ee({})});P.utils.fetchWithTimeoutAndLog(e).then(P.utils.processStatus).then(P.utils.parseJson).then(function(e){g.log("RequestManager:getDynamicContentByGet fetch",e),t(e)}).catch(function(e){g.log("RequestManager:getDynamicContentByGet error",e),e.status&&400===e.status?(g.log("RequestManager:getDynamicContentByPost::fallback",o),P.getDynamicContentByPost(r,o).then(function(e){t(e)}).catch(function(e){n(e)})):n(e)})})},getDynamicContentByPost:function(r,i){return g.log("RequestManager:getDynamicContentByPost"),new Q(function(t,n){var e=new x(r,{method:"POST",headers:new ee({"Content-Type":"text/plain"}),body:JSON.stringify(i)});P.utils.fetchWithTimeoutAndLog(e).then(P.utils.processStatus).then(P.utils.parseJson).then(function(e){g.log("RequestManager:getDynamicContentByPost fetch",e),t(e)}).catch(function(e){g.log("RequestManager:getDynamicContentByPost error",e),n(e)})})},getProfileConfig:function(){return g.log("RequestManager:getProfileConfig"),new Q(function(t,n){var e=P.trackingDomain+P.rtomProxyUrl+"/configs/getPublicConfigForContext",e=(e+="?tracker="+l.getHeaderAuth("value"),new x(e,{method:"GET",mode:"cors",redirect:"follow",headers:new ee({"Content-Type":"application/json"})}));P.utils.fetchWithTimeoutAndLog(e).then(P.utils.processStatus).then(P.utils.parseJson).then(function(e){g.log("RequestManager:getProfileConfig fetch then",e),t(e)}).catch(function(e){g.error("RequestManager:getProfileConfig fetch error",e),n(e)})})},getWebPushProfileConfig:function(r){return g.log("RequestManager:getWebPushProfileConfig"),new Q(function(t,n){var e=P.trackingDomain+P.rtomProxyUrl+"/web-push/get-public-config",e=(e+="?tracker="+l.getHeaderAuth("value"),r&&(e+="&acceptLanguage="+encodeURIComponent(r)),new x(e,{method:"GET",mode:"cors",redirect:"follow",headers:new ee({"Content-Type":"application/json"})}));P.utils.fetchWithTimeoutAndLog(e).then(P.utils.processStatus).then(P.utils.parseJson).then(function(e){g.log("RequestManager:getWebPushProfileConfig fetch then",e),t(e)}).catch(function(e){g.error("RequestManager:getWebPushProfileConfig fetch error",e),n(e)})})},getClientTags:function(r){g.log("RequestManager:getClientTags",r);var i={"Content-Type":"application/json"};return i[l.getHeaderAuth("key")]=l.getHeaderAuth("value"),new Q(function(t,n){var e=P.trackingDomain+P.rtomProxyUrl+"/clients/tagsHash?uuid="+encodeURIComponent(r.uuid),e=new x(e,{method:"GET",mode:"cors",redirect:"follow",headers:new ee(i)});P.utils.fetchWithTimeoutAndLog(e).then(P.utils.processStatus).then(P.utils.parseJson).then(P.utils.getDataKey).then(function(e){g.log("RequestManager:getClientTags fetch then",e),t(e)}).catch(function(e){g.error("RequestManager:getClientTags fetch error",e),n(e)})})},getClientData:function(e){g.log("RequestManager:getClientData",e);return{"Content-Type":"application/json"}[l.getHeaderAuth("key")]=l.getHeaderAuth("value"),new Q(function(e,t){e({segments:[],tags:[]})})},track:function(s,a,c,u){return g.log("RequestManager:track",s,a,c,u),new Q(function(t,n){var e,r,i,o=d.getClientFromStore();o?(c=c||"",u=u||{},e={uuid:o.uuid,ssuid:P.utils.getSsuid(),url:$.location.href},u=m.extend(e,u),r={action:a,label:c,params:JSON.stringify(u),uuid:o.uuid,tracker:l.getHeaderAuth("value"),hash:Math.random().toString(36).substring(2,8)},s&&(r.category=s),i={method:"GET",mode:"cors",redirect:"follow"},w.requiresAuthorization(a).then(function(e){e&&(e=o.accessToken)&&(i.headers=new ee({Authorization:"Bearer "+e}));e=P.trackingDomain+"/"+l.trackerKey()+P.track.join("&")}(r),e=new x(e,i);P.utils.trackEventWithCheckPossibility(e).then(function(e){g.log("RequestManager:track fetch then",e),t(e)}).catch(function(e){g.error("RequestManager:track fetch error",e),n(e)})}).catch(function(e){g.error("RequestManager:track EventManager.requiresAuthorization error",e),n(e)})):n(new Error("Can not track event if client not exists"))})},trackProxy:function(s){return g.log("RequestManager:trackProxy",s),new Q(function(t,n){var r,i,e,o=d.getClientFromStore();return o?(s=m.extend({uuid:o.uuid,ssuid:P.utils.getSsuid()},s)).label?s.object?(r={"Content-Type":"text/plain"},i=P.trackingDomain+P.trackSdkProxyUrl+"?code="+l.trackerKey(),e=w.mapObjectToAction(s.object),void w.requiresAuthorization(e).then(function(e){e&&(e=o.accessToken)&&(r.Authorization="Bearer "+e);e=new x(i,{method:"POST",mode:"cors",redirect:"follow",headers:new ee(r),body:JSON.stringify(s)});P.utils.trackEventWithCheckPossibility(e).then(function(e){g.log("RequestManager:trackProxy fetch then",e),t(e)}).catch(function(e){g.error("RequestManager:trackProxy fetch error",e),n(e)})})):n(new Error('Can not track event - "object" is required')):n(new Error("Can not track unknown event")):n(new Error("Can not track event if client not exists"))})},subscribeWebPushForClient:function(){return g.log("RequestManager:subscribeWebPushForClient"),new Q(function(r,i){d.getCurrentClient().then(function(e){var t,n;return e?e.uuid?((t={"Content-Type":"application/json"})[l.getHeaderAuth("key")]=l.getHeaderAuth("value"),n=P.trackingDomain+P.rtomUrl+"/web-push/subscribe",n=new x(n,{method:"POST",mode:"cors",redirect:"follow",headers:new ee(t),body:JSON.stringify({uuid:e.uuid,ssuid:P.utils.getSsuid(),url:location.href})}),void P.utils.fetchWithTimeoutAndLog(n).then(P.utils.processStatus).then(function(e){g.log("RequestManager:subscribeWebPushForClient fetch then",e),r(e)}).catch(function(e){g.error("RequestManager:subscribeWebPushForClient fetch error",e),i(e)})):i(new Error("Client is not identified")):i(new Error("Can not subscribe if client not exists"))}).catch(function(){i(new Error("Client is not exists"))})})},unsubscribeWebPushForClient:function(){return g.log("RequestManager:unsubscribeWebPushForClient"),new Q(function(r,i){d.getCurrentClient().then(function(e){var t,n;return e?e.uuid?((t={"Content-Type":"application/json"})[l.getHeaderAuth("key")]=l.getHeaderAuth("value"),n=P.trackingDomain+P.rtomUrl+"/web-push/unsubscribe",n=new x(n,{method:"POST",mode:"cors",redirect:"follow",headers:new ee(t),body:JSON.stringify({uuid:e.uuid,ssuid:P.utils.getSsuid(),url:location.href})}),void P.utils.fetchWithTimeoutAndLog(n).then(P.utils.processStatus).then(function(e){g.log("RequestManager:unsubscribeWebPushForClient fetch then",e),r(e)}).catch(function(e){g.error("RequestManager:unsubscribeWebPushForClient fetch error",e),i(e)})):i(new Error("Client is not identified")):i(new Error("Can not unsubscribe if client not exists"))}).catch(function(){i(new Error("Client is not exists"))})})},addBrowserPermissionWebPushForClient:function(o,s,a,c){return g.log("RequestManager:addBrowserPermissionWebPushForClient",o),new Q(function(r,i){d.getCurrentClient().then(function(e){var t,n;return e?e.uuid?o?((t={"Content-Type":"application/json"})[l.getHeaderAuth("key")]=l.getHeaderAuth("value"),e={uuid:e.uuid,ssuid:P.utils.getSsuid(),token:o,domain:s,url:location.href},c&&(e.version=c),a&&(e.subscription=a),n=P.trackingDomain+P.rtomUrl+"/web-push/add-browser-permission",n=new x(n,{method:"POST",mode:"cors",redirect:"follow",headers:new ee(t),body:JSON.stringify(e)}),void P.utils.fetchWithTimeoutAndLog(n).then(P.utils.processStatus).then(function(e){g.log("RequestManager:addBrowserPermissionWebPushForClient fetch then",e),r(e)}).catch(function(e){g.error("RequestManager:addBrowserPermissionWebPushForClient fetch error",e),i(e)})):i(new Error("Token is required")):i(new Error("Client is not identified")):i(new Error("Can not subscribe if client not exists"))}).catch(function(){i(new Error("Client is not exists"))})})},checkWebPushSubscriptionForClient:function(i){return g.log("RequestManager:checkWebPushSubscriptionForClient"),new Q(function(n,r){d.getCurrentClient().then(function(e){var t;return e?e.uuid?(t=P.trackingDomain+P.rtomUrl+"/web-push/check-subscription",t=(t=(t+="?tracker="+l.getHeaderAuth("value"))+"&uuid="+encodeURIComponent(e.uuid))+"&domain="+encodeURIComponent(i||""),e=new x(t,{method:"GET",mode:"cors",redirect:"follow",headers:new ee({"Content-Type":"application/json"})}),void P.utils.fetchWithTimeoutAndLog(e).then(P.utils.processStatus).then(P.utils.parscription")}).then(function(e){g.log("RequestManager:addBrowserPermissionWebPushForClient fetch then",e),n(e)}).catch(function(e){g.error("RequestManager:addBrowserPermissionWebPushForClient fetch error",e),r(e)})):r(new Error("Client is not identified")):r(new Error("Can not subscribe if client not exists"))}).catch(function(e){g.error("RequestManager:checkWebPushSubscriptionForClient error occurred",e),r(new Error("Client is not exists"))})})},incrementDynamicContentViews:function(o){return g.log("RequestManager:incrementDynamicContentViews",o),new Q(function(r,i){d.getCurrentClient().then(function(e){var t={"Content-Type":"application/json"},n=(t[l.getHeaderAuth("key")]=l.getHeaderAuth("value"),P.trackingDomain+P.dynamicContentUrl+"/dynamicContent/incrementView"),n=new x(n,{method:"POST",mode:"cors",redirect:"follow",headers:new ee(t),body:JSON.stringify({uuid:e.uuid,ssuid:P.utils.getSsuid(),campaignId:o.getId()})});P.utils.fetchWithTimeoutAndLog(n).then(P.utils.processStatus).then(function(e){g.log("RequestManager:incrementDynamicContentViews fetch then",e),rr",e),i(e exists"))})})}}),z={_sourcesMap:{},loadStyles:function(n){return new Q(function(e,t){if(!(n=z.deduplicateSources(n)).length)return e();h.addStyles(n).then(function(){or(e),t(e)})})},deduplicateSources:function(e){var t;return e?(t=Map[e]=!0)}),t):[]}},k={set:function(e,t,n,r,i){m.isObject(t)&&(t=O.prepareObjectToString(t));var o=new Date,s=0,s=void 0!==n?1e3*n:62208e6;o.setTime(o.getTime()+s),k.setForDateExpires(e,t,o,r,i)},setForDateExpires:function(e,t,n,r,i){m.isObject(t)&&(t=O.prepareObjectToString(t)),n||(n=new Date).setTime(n.getTime()+62208e6);i={path:i||"/"};i.expires=n,void 0!==r&&(i.domain=r),b.getOption("localStorageMode")?(n=new Date(i.expires),r=Math.round(n.getTime()/1e3),I.setStringWithTtl(e,t,r)):m.cookie.set(e,t,i)},get:function(e){var t=b.getOption("localStorageMode")?I.getStringWithTtl(e):m.cookie.get(e);return g.log("CookieStore:get",e,t),/:/.test(t)&&(t=O.prepareStringToObject(t)),g.log("CookieStore:get return",t),t},getJson:function(e){var t=b.getOption("localStorageMode")?I.getStringWithTtl(e):m.cookie.get(e);g.log("CookieStore:getJson",e,t);try{return t?JSON.parse(t):{}}catch(e){g.error("CookieStore:getJson ERROR: parse json",t)}return null},remove:function(e){(b.getOption("localStorageMode")?I:m.cookie).remove(e)}},s={FREQUENCY_PREFIX:"_snrs_dc_frq_",STOP_DISPLAY_PREFIX:"_snrs_dc_sd_",VIEWS_FOR_STOP_DISPLAY_PREFIX:"_snrs_dc_views_sd_",DELAY_PREFIX:"_snrs_dc_delay_",CAMPAIGNS:"_snrs_dc_campaigns",EXPIRE:"_snrs_dc_expire",TESTS:"_snrs_dc_tests"E,s.TESTS]},clearExpiredKeysFromStore:function(){var e;return g.log("DynamicContentStore:clearExpiredKeysFromStore"),I.isAvailable()&&(e=s.getKeyList(),m.each(e,function(e){e===s.TESTS?s.clearExpiredTests():I.clearExpiredKeysFromContainer(e)})),!0},clearExpiredTests:function(){var t=new Date,n=I.getJson(s.TESTS);m.each(Object.keys(n),function(e){"number"==typeof n[e].exp&&t.getTime()>n[e].exp?I.removeFromContainer(s.TESTS,e):"number"==typeof n[e]&&s.cacheDynamicContentVariantId(e,n[e])})},incrementFrequency:function(e){var t=e.frequency.getExpiration(),n=(null===t&&(t=v.EXPIRATION_MAX_VALUE),s.getFrequencyWithCheckExpiration(e));return(n=n||{value:0,expires:new Date((new Date).getTime()+1e3*t).getTime()}).value++,I.isAvailable()?I.setToContainer(s.FREQUENCY_PREFIX,e.id,n):(t=s.FREQUENCY_PREFIX+e.id,k.setForDateExpires(t,n,new Date(n.expires))),n},renewFrequencyExpiration:function(e){var t,n=e.frequency.getExpiration(),r=s.getFrequencyWithCheckExpiration(e);return g.log("Store:renewFrequencyExpiration",r,e),r&&(t=new Date((new Date).getTime()+1e3*n),r.expires=t.getTime(),g.log("Store:renewFrequencyExpiration set",r,n,t,e),I.isAvailable()?I.setToContainer(s.FREQUENCY_PREFIX,e.id,r):(n=s.FREQUENCY_PREFIX+e.id,k.setForDateExpires(n,r,new Date(r.expires)))),r},getFrequency:function(e){e=I.isAvailable()?I.getFromContainer(s.FREQUENCY_PREFIX,e.id):k.get(s.FREQUENCY_PREFIX+e.id);return!e||(e.value=parseInt(e.value,10),e.expires=parseInt(e.expires,10),isNaN(e.value))||isNaN(e.expires)?null:e},getFrequencyWithChecrData(e,t)},checkExpirationFrequencyForData:function(e,t){if(t){var n=new Date;if(t.expires<n.getTime())return s.removeFrequency(e),null}return t},removeFrequency:function(e){I.isAvailable()?I.removeFromContainer(s.FREQUENCY_PREFIX,e.id):k.remove(s.FREQUENCY_PREFIX+e.id)},stopDisplay:function(e){var t=new Date,n=_.STOP_DISPLAY_EXPIRATION_MAX_VALUE,n=(t.setSeconds(t.getSeconds()+n),{value:1,expires:t.getTime()});I.setToContainer(s.STOP_DISPLAY_PREFIX,e.id,n)},checkStopDisplay:function(e){return g.log("Store:checkStopDisplay value",I.getFromContainer(s.STOP_DISPLAY_PREFIX,e.id)),!!I.getFromContainer(s.STOP_DISPLAY_PREFIX,e.id)},incrementViewsForStopDisplay:function(e){var t=new Date,n=_.STOP_DISPLAY_EXPIRATION_MAX_VALUE,n=(t.setSeconds(t.getSeconds()+n),s.getViewsForStopDisplay(e)),n=++n,t={value:n,expires:t.getTime()};return I.setToContainer(s.VIEWS_FOR_STOP_DISPLAY_PREFIX,e.id,t),n},getViewsForStopDisplay:function(e){e=I.getFromContainer(s.VIEWS_FOR_STOP_DISPLAY_PREFIX,e.id);return e?e.value:0},removeViewsForEFIX,e.id)},setTimeForDelay:function(e,t){t=t||new Date;var n=e.trigger.getDelayInSeconds(),t=new Date(t.getTime()+1e3*n);return s.storeTimeForDelay(e,t),t},renewTimeForDelay:function(e){var t=s.getTimeForDelay(e);return null!==t&&s.storeTimeForDelay(e,t),t},storeTimeForDelay:function(e,t){var n,r=S.TRIGGER_DELAY_EXPIRATION_VALUE;I.isAvailable()?(n=new Date((new Date).getTime()+1e3*r),n={value:t.getTime(),expires:n.getTime()},I.setToContainer(s.DELAY_PREFIX,e.id,n)):k.set(s.DELAY_PREFIX+e.id,t.getTime(),r)},getTimeForDelay:function(e){t=I.isAvailable()?(t=I.getFromContainer(s.DELAY_PREFIX,e.id))?t.value:null:k.get(s.DELAY_PREFIX+e.id);var t,e=parseInt(t,10);return isNaN(e)?null:new Date(e)},removeTimeForDelay:function(e){I.isAvailable()?I.removeFromContainer(s.DELAY_PREFIX,e.id):k.remove(s.DELAY_PREFIX+e.id)},cacheDynamicContentVariantId:function(e,t){var n;return I.isAvailable()?(n=new Date(Date.now()+2592e6),I.setToContainer(s.TESTS,e,{id:t,exp:n.getTime()})):g.error("DynamicContentStore:setDynamicContentVariant error"),t},getCachedDynamicContentVariantId:function(e){var t,n=null;return I.isAvailable()?(t=I.getFromContainer(s.TESTS,e))&&"number"==typeof t.id&&(n=this.cacheDynamicContentVariantId(e,t.id)):g.error("DynamicContentStore:getDynamicContentVariant error"),n}},I={_is_available:null,setJson:function(e,t){return!!I.isAvailable()&&(t=O.prepareObjectToJsonString(t),g.log("LocalStore:set",e,t),localStorage[e]=t,!0)},getJson:function(e){var t;return!!I.isAvailable()&&(t=void 0!==localStorage[e]?localStorage[e]:f,t=O.prepareJsonStringToObject(t),g.log("LocalStore:get",e,t),t)},saveContainer:function(e,t){return!!I.isAvailable()&&(Object.keys(t).length?I.setJson(e,t):I.removeContainer(e),!0)},getContainer:function(e,t){return!!I.isAvailable()&&(I.getJson(e)||{})},removeContainer:function(e){return!!I.isAvailable()&&(I.remove(e),!0)},getFromContainer:function(e,t){return!!I.isAvailable()&&((e=I.getContainer(e))[t]!==f?e[t]:null)},setToContainer:function(e,t,n){var r;return!!I.isAvailable()&&((r=(r=I.getContainer(e))||{})[t]=n,I.saveContainer(e,r),!0)},removeFromContainer:function(e,t){var n;return!!I.isAvailable()&&(delete(n=I.getContainer(e))[t],I.saveContainer(e,n),!0)},clearExpiredKeysFromContainer:function(r,i,o){if(!I.isAvailable())return!1;i=i||new Date,o=o||"expires";var e=I.getContainer(r),s={},a=!1;return m.each(e,function(e,t){var n=parseInt(e[o],10);!isNaN(n)&&(n=new Date(n))<i.getTime()?(g.log("LocalStore:clearExpiredKeysFromContainer key expired",t,n,r,e),I.removeFromContainer(r,t),a=!0):s[t]=e}),a&&I.saveContainer(r,s),!0},set:function(e,t){return!!I.isAvailable()&&(m.isObject(t)&&(t=O.prepareObjectToString(t)),g.log("LocalStore:set",e,t),localStorage[e]=t,!0)},get:function(e){var t;return!!I.isAvailable()&&(t=void 0!==localStorage[e]?localStorage[e]:f,g.log("LocalStore:get",e,t),t!==f&&/:/.test(t)&&(t=O.prepareStringToObject(t)),g.log("LocalStore:get return",t),t)},setString:function(e,t){return!!I.isAvailable()&&(g.log("LocalStore:setString",e,t),localStorage[e]=t,!0)},getString:function(e){var t;return!!I.isAvailable()&&(t=void 0!==localStorage[e]?localStorage[e]:f,g.log("LocalStore:getString",e,t),t)},setStringWithTtl:function(e,t,n){return!!I.isAvailable()&&(n=n||Math.round((new Date).getTime()/1e3)+43200,g.log("LocalStore:setStringWithTtl",e,t,n),this.setJson(e,{value:t,expires:n}))},getStringWithTtl:function(e){var t=this.getJson(e);return this.isExpired(t.expires)?(g.log("LocalStore:getStringWithTtl key expired",e,t),this.remove(e),null):t.value},remove:function(e){return!!I.isAvailable()&&(g.log("LocalStore:remove",e),localStorage.removeItem(e),!0)},isAvailable:function(e){if(null===I._is_available)if("undefined"!=typeof Storage&&"undefined"!=typeof localStorage)try{localStorage.setItem("lsCheck",1),localStorage.removeItem("lsCheck"),I._is_available=!0}catch(e){g.log("[LocalStore]:isAvailable Local storage isn't available"),I._is_available=!1}else g.log("[LocalStore]:isAvailable Local storage isn't available"),I._is_available=!1;return I._is_available},isExpired:function(e){e=parseInt(e,10);return!!(isNaN(e)||e<Math.round((new Date).getTime()/1e3))},clearExpiredKeysStartingWithSnrs:function(){for(var e=0;e<localStorage.length;e++){var t,n=localStorage.key(e);n.startsWith("_snrs")&&(t=I.getJson(n)).expires&&I.isExpired(t.expires)&&I.remove(n)}}},O={prepareObjectToJsonString:function(e){return JSON.stringify(e)},prepareJsonStringToObject:function(t){var e={};if("string"===(typeof t).toLowerCase())try{e=JSON.parse(t)}catch(e){g.error("Store:parseJson - Wrong JSON format",t)}return e},prepareObjectToString:function(e){var n="";return m.isObject(e)&&(m.each(e,function(e,t){""!==e&&(n+=t+":"+e+"&")}),n=n.substring(0,n.length-1)),n},prepareStringToObject:function(e){var t={};return m.isString(e)&&(e=e.split("&[0]]=e[1])})),t},getClientUuid:function(){g.log("Store:getClientUuid");var e=k.get("_snrs_p"),t=null;return e&&e.uuid&&(t=e.uuid),g.log("Store:getClientUuid value:",t),t},getClientPermUuid:function(){g.log("Store:getClientPermUuid");var e=k.get("_snrs_p"),t=null;return e&&e.permUuid&&(t=e.permUuid),g.log("Store:getClientPermUuid value:",t),t},getClientToken:function(){return g.log("Store:getClientToken"),I.getStringWithTtl("snr-token")||k.get("_snrs_token")},setClientToken:function(e){var t=l.parseToken(e);return null===t||t.exp==f?(g.error("Store:setClientToken ERROR: invalid token",e),!1):I.isExpired(t.exp)?(g.error("Store:setClientToken ERROR: token expired",e),!1):(t=t.exp,I.isAvailable()?I.setStringWithTtl("snr-token",e,t)?(k.remove("_snrs_token"),!0):void 0:(g.log("Store:setClientToken ERROR: Localstorage unavailable. Setting cookie"),t=new Date(1e3*t),k.setForDateExpires("_snrs_token",e,t),!0))},removers_token")},setNotificationCapping:function(e){var t,n;g.log("Store:setNotificationCapping",e),e.capping&&m.isObject(e.capping)&&e.id&&"count"===(t=e.capping).type&&t.count&&0<t.count&&(t.expiration?(n=(n=k.get("_snrs_notify_capping_"+e.id))||0,k.set("_snrs_notify_capping_"+e.id,++n,t.expiration),g.log("Store:setNotificationCapping done",n,"with expiration",t.expiration)):(n=(t=(t=k.get("_snrs_notify_capping"))&&m.isObject(t)?t:{})[e.id]||0,t[e.id]=++n,k.set("_snrs_notify_capping",t),g.log("Store:setNotificationCapping done",n)))},getNotificationCapping:function(e){var t,n;if(g.log("Store:getNotificationCapping",e),e.id)return t=0,e.capping&&e.capping.expiration?t=(t=k.get("_snrs_notify_capping_"+e.id))||0:(n=k.get("_snrs_notify_capping"))&&m.isObject(n)&&n[e.id]&&(t=n[e.id]),g.log("Store:getNotificationCapping value",t),t},getProfileConfig:function(){var e,t=I.getContainer("_snrs_profile_config");return!t||!(e=t.snrsProfileConfigExpire)||18e4<Date.now()-parseInt(e)?null:t},setProfileConfig:function(e){Array.isArray(e[w.EVENT_LIST_SIGNED_IDENTIFIED])&&I.saveContainer("_snrs_profile_config",e)&&I.setToContainer("_snrs_profile_config","snrsProfileConfigExpire",Date.now())}},A={PERMISSION_AGREED:"agreed",PERMISSION_BLOCKED:"blocked",PERMISSION_DEFAULT:"default",_provider:null,init:function(){return g.log("WebPushApp:init"),h.uniquePromiseHandler("WebPushApp.init",function(e,t){if(g.log("WebPushApp:init",D._config.mode),D._config.mode===D.CONFIG_WEBPUSH_MODE_NATIVE)A._provider=N;else{if(D._config.mode!==D.CONFIG_WEBPUSH_MODE_EXTERNAL)return t(new Error("Unable to init web push app"));A._provider=te}A.initProvider().then(function(){g.log("WebPushApp:init done"),e()}).catch(function(e){g.error("WebPushApp:init error",e),t(e)})})},parseFirebaN_UNKNOWN}},ider.init()},requestPermission:function(e){return A._provider.requestPermission(e)},getToken:function(){return A._provider.getToken()},deleteToken:function(e){return A._provider.deleteToken(e)},showNication(e)},getPermission:function(){return A._provider.getPermission()etDomain()}},te={_iframe:null,init:function(){return new Q(function(e,t){return g.log("WebPushExternalApp:init"),D._config.agreement_page_domain?D._config.agreement_page_url?D._config.external_page_iframe_url?void te.initIframe().then(function(){e()}).catch(function(e){t(e)}):t(new Error("Url for iframe external page is required")):t(new Error("Url for agreement page is required")):t(new Error("Domain for agreement page is required"))})},initIframe:function(){return new Q(function(e,t){if(g.log("WebPushExternalApp:initIframe"),te._iframe)return e();var n=null,r=D._config.agreement_page_domain+D._config.external_page_iframe_url+"?tc="+encodeURIComponent(l.trackerKey()),i=(b.getOption("acceptLangList")&&(r+="&lang="+encodeURIComponent(b.getOption("acceptLangList").join(","))),document.createElement("iframe"));i.width=0,i.height=0,i.src=r,i.style="display: none; visibility: hidden; height: 0px; width: 0px;",i.onload=function(){g.log("WebPushExternalApp:initIframe iframe loaded"),n&&(clearTimeout(n),n=null,te._iframe=i,e())},n=setTimeout(function(){t(new Error("Timeout occurred while loading iframe"))},4e3),document.body.appendChild(i)})},getDomain:function(){var e,t=D._config.agreement_page_domain.split("/");return 2<t.length&&(e=t[2]),g.log("WebPushExternalApp:getDomain",e),e},createPromiseWithIframeRequired:function(e){return te._iframe?new Q(e):Q.reject(new Error("WebPush external app is not initialized"))},sendAndGetResponseFromIframe:function(s,a){return te.createPromiseWithIframeRequired(function(n,r){a=void 0!==a?a:1e3,s.payload||(s.payload={}),g.log("WebPushExternalApp:sendAndGetResponseFromIframe with timeout",s,a);var t=te._iframe.contentWindow,i=null,o=null;D.getMessageChannel().then(function(e){e.port1.onmessage=function(e){if(g.log("WebPushExternalApp:sendAndGetResponseFromIframe onmessage took",o.getElapsedTimeString(),e.data,e),i){var t;if(clearTimeout(i),i=null,!e.data||!e.data.payload||"webpush.success"!==e.data.action)return"webpush.error"===e.data.action&&e.data.payload?(t=new Error(e.data.payload.message||"Unknown error message"),e.data.payload.code&&(t.code=e.data.payload.code),r(t)):r(new Error("Invalid response"));n(e.data)}},i=setTimeout(function(){r(new Error("Timeout occurred while waiting for response"))},a),o=F.create("sendAndGetResponseFromIframe"+s.action),t.postMessage(s,D._config.agreement_page_domain,[e.port2])}).catch(function(e){g.error("WebPushExternalApp:sendAndGetResponseFromIframe Can not get message channel",e),r(new Error("Can not get message channel"))})})},onExternalWindowAgreementMessageHandler:function(e){switch(g.log("WebPushExternalApp:onExternalWindowAgreementMessageHandler onmessage",e.data,e),e.data.action){case"webpush.subscribe":case"webpush.subscribeExists":M.setSubscription(M.SUBSCRIPTION_SUBSCRIBE,!0),M.setBrowserPermission(M.BROWSER_PERMISSION_AGREED,!0);break;case"webpush.subscribeBlock":M.setBrowserPermission(M.BROWSER_PERMISSION_BLOCKED,!0)}},requestPermission:function(r){return new Q(function(t,n){r=r||{},g.log("WebPushExternalApp:requestPermission",r),te.getPermission().then(function(e){return e===A.PERMISSION_AGREED?t(!1):e===A.PERMISSION_BLOCKED?((e=new Error("Unable to request permission - has been blocked")).code=D.EVENT_ERROR_CODE_PERMISSION_BLOCKED,n(e)):te.requestPermissionByAgreementPage(r)}).catch(function(e){return g.error("WebPushExternalApp:requestPermission Can not get permission",e),te.requestPermissionByAgreementPage(r)})})},requestPermissionByAgreementPage:function(c){return new Q(function(n,r){c=c||{},g.log("WebPushExternalApp:requestPermissionByAgreementPage",c);var i,e=screen.width/2-240,t=screen.height/2-270,o=D._config.agreement_page_domain+D._config.agreement_page_url+"?tc="+encodeURIComponent(l.trackerKey()),e=(b.getOption("acceptLangList")&&(o+="&lang="+encodeURIComponent(b.getOption("acceptLangList").join(","))),"width=480, height=540, left="+e+", top= "+t),s=(g.log("WebPushExternalApp:requestPermissionByAgreementPage open window",o,e),$.open(o,"snrsWebPushWindow",e)),a=(g.log("WebPushExternalApp:requestPermissionByAgreementPage webPushWindowHandler",s),s||(g.error("WebPushExternalApp:requestPermissionByAgreementPage Can not open an agreement window - has been blocked by browser"),r(new Error("Can not open an agreement window - has been blocked by browser"))),(new Date).getTime());i=setInterval(function(){var e=(new Date).getTime(),t=e-a;if(g.log("WebPushExternalApp:requestPermissionByAgreementPage webPushWindowHandler connecting to agreement window (time: %s ms)",t),3e3<=e-a&&i)return clearInterval(i),i=f,s.close(),r(new Error("Can not connect to agreement window - timeout occurred"));D.getMessageChannel().then(function(e){e.port1.onmessage=function(e){g.log("WebPushExternalApp:requestPermissionByAgreementPage agreement window onmessage",e.data,e),"webpush.readyToSendMessage"===e.data.action&&i&&(clearInterval(i),i=f,D.getMessageChannel().then(function(e){e.port1.onmessage=te.onExternalWindowAgreementMessageHandler,s.postMessage({action:"webpush.readyToReceiveStatus",payload:{}},D._config.agreement_page_domain,[e.port2]),n()}).catch(function(e){g.error("WebPushExternalApp:requestPermissionByAgreementPage onSuccessConnectToWindow Can not get message channel",e),r(new Error("Can not get message channel"))}))},s.postMessage({action:"webpush.readyToReceiveMessage",payload:{}},D._config.agreement_page_domain,[e.port2])}).catch(function(e){i&&(clearInterval(i),i=f),g.error("WebPushExternalApp:requestPermissionByAgreementPage Can not get message channel",e),r(new Error("Can not get message channel"))})},50)})},getPermission:function(){return g.log("WebPushExternalApp:getPermission"),te.createPromiseWithIframeRequired(function(t,n){te.sendAndGetResponseFromIframe({action:"webpush.getPermission",payload:{}}).then(function(e){if(g.info("WebPushExternalApp:getPermission then response",e),e.payload.permission===f)return Q.reject(new Error("Invalid response from iframe worker"));t(e.payload.permission)}).catch(function(e){g.error("WebPushExternalApp:getPermission Can not get permission",e),n(new Error("Can not get permission"))})})},getToken:function(){return g.log("WebPushExternalApp:getToken"),te.createPromiseWithIframeRequired(function(t,n){te.sendAndGetResponseFromIframe({action:"webpush.getToken",payload:{}}).then(function(e){g.info("WebPushExternalApp:getToken then response",e),t(e.payload.token)}).catch(function(e){g.error("WebPushExternalApp:getToken Can not get token",e);var t=A.parseFirebaseErrorCode(e.code);t===D.EVENT_ERROR_CODE_PERMISSION_BLOCKED&&((e=new Error("Can not get token, it has been blocked")).code=t),n(e)})})},deleteToken:function(e){return g.log("WebPushExternalApp:deleteToken"),te.createPromiseWithIframeRequired(function(e,t){return g.info("WebPushExternalApp:deleteToken This functionality for external mode is not supported yet"),t(new Error("Not supported yet"))})},showNotification:function(e){return g.log("WebPushExternalApp:showNotification",e),te.createPromiseWithIframeRequired(function(t,n){g.info("WebPushExternalApp:showNotification payload",e),te.sendAndGetResponseFromIframe({action:"webpush.showNotification",payload:e||{}}).then(function(e){g.info("WebPushExternalApp:showNotification then response",e),t()}).catch(function(e){g.error("WebPushExternalApp:showNotification Can not show notification",e),n(e)})})}},R={_initialized:!1,_html:null,_container:null,_widgetCtr:null,_widgetStateCtr:null,_buttonTriggerCtr:null,_closeBtn:null,_widgetClass:"snrs-webpush--widget",_widgetStateContainerClass:"snrs-webpush--widget-state-container",_buttonTriggerClass:"snrs-webpush--widget-trigger",_triggerWidgetCloseClass:"snrs-webpush--trigger-widget-close",_triggerWidgetOpenClass:"snrs-webpush--trigger-widget-open",_triggerHideClass:"snrs-webpush--trigger-hide",_triggerShowClass:"snrs-webpush--trigger-show",_containerShownClass:"snrs-webpush--shown",_widgetOpenedClass:"snrs-webpush--widget-opened",_statePrefixClass:"snrs-webpush--state-",STATE_SUBSCRIBE:"subscribe",STATE_UNSUBSCRIBE:"unsubscribe",STATE_UNKNOWN:"unknown",_closeBtnClass:"snrs-webpush--close",_options:{},_callbackStack:{onStateContentChange:function(){},onStateChange:function(){},onButtonTriggerClick:function(){},onWidgetClose:function(){},onWidgetOpen:function(){},onShow:function(){},onHide:function(){}},getStateOptionList:function(){return[R.STATE_SUBSCRIBE,R.STATE_UNSUBSCRIBE,R.STATE_UNKNOWN]},init:function(r){return new Q(function(e,t){var n;return g.log("WebPushFloatingButton:init - initialized:",R._initialized,r),R._initialized?e():(R._options=m.extend({},r),R._options?(R._html=R._options.content,R._html?R._options.change_state&&m.isEmpty(R._options.state_content)?(g.error("WebPushFloatingButton:init - State content options are not defined",R._options),t(new Error("State content options are not defined"))):((n=document.createElement("div")).innerHTML=R._html,R._container=n.childNodes[0],R._widgetCtr=R._container.querySelector("."+R._widgetClass),R._widgetStateCtr=R._container.querySelector("."+R._widgetStateContainerClass),R._buttonTriggerCtr=R._container.querySelector("."+R._buttonTriggerClass),R._widgetCtr&&R._buttonTriggerCtr?(R._options.change_state&&!R._widgetStateCtr&&(g.info("WebPushFloatingButton:init - Widget state container is not defined - used widget container instead"),h.addClass(R._widgetCtr,R._widgetStateContainerClass),R._widgetStateCtr=R._widgetCtr),h.removeClass(R._container,R._containerShownClass),R.updateState(R.STATE_UNKNOWN),document.body&&(document.body.appendChild(R._container),R.attachGeneralActions($.document)),R._initialized=!0,void e()):(g.error("WebPushFloatingButton:init - Content is invalid",R._widgetCtr,R._buttonTriggerCtr),t(new Error("Content is invalid")))):(g.error("WebPushFloatingButton:init - Content is not defined",R._options),t(new Error("Content is not defined")))):(g.error("WebPushFloatingButton:init - options are not defined",R._options),t(new Error("Options are not defined"))))})},attachGeneralActions:function(e){g.log("WebPushFloatingButton:_attachGeneralActions"),e=e||R._container,h.attachHandlerByClassName(e,R._buttonTriggerClass,"click",R.onButtonTriggerClick.bind(R)),h.attachHandlerByClassName(e,R._triggerWidgetCloseClass,"click",R.closeWidget.bind(R)),h.attachHandlerByClassName(e,R._triggerWidgetOpenClass,"click",R.openWidget.bind(R)),h.attachHandlerByClassName(e,R._triggerHideClass,"click",R.hide.bind(R)),h.attachHandlerByClassName(e,R._triggerShowClass,"click",R.show.bind(R))},updateState:function(e){if(g.log("WebPushFloatingButton:updateState",e,R._options),!m.inArray(e,R.getStateOptionList()))throw new Error('State value "'+e+'" is invalid');h.removeClass(R._container,R._statePrefixClass+R.STATE_UNKNOWN),h.removeClass(R._container,R._statePrefixClass+R.STATE_SUBSCRIBE),h.removeClass(R._container,R._statePrefixClass+R.STATE_UNSUBSCRIBE),h.addClass(R._container,R._statePrefixClass+e),R._triggerCallback("onStateChange",e),R._options.change_state&&R._widgetStateCtr&&(R._options.state_content&&R._options.state_content[e]!==f?(R._widgetStateCtr.innerHTML=R._options.state_content[e],R.attachGeneralActions(R._widgetStateCtr),R._triggerCallback("onStateContentChange",e,R._widgetStateCtr)):g.error("WebPushFloatingButton:updateState Content is not defined for current state",e,R._options.state_content))},_triggerCallback:function(e){if(g.log("WebPushFloatingButton:_triggerCallback",e,R._callbackStack),R._callbackStack[e]){for(var t=new Array(arguments.length-1),n=0;n<t.length;++n)t[n]=arguments[n+1];var r=R._callbackStack[e];if(m.isFunction(r))if(g.log("WebPushFloatingButton:_triggerCallback call with args",e,t,r),!1===r.apply(R,t))return!1}},onStateContentChangeHandler:function(e){R._callbackStack.onStateContentChange=e},onStateChangeHandler:function(e){R._callbackStack.onStateChange=e},onButtonTriggerClickHandler:function(e){R._callbackStack.onButtonTriggerClick=e},onWidgetCloseHandler:function(e){R._callbackStack.onWidgetClose=e},onWidgetOpenHandler:function(e){R._callbackStack.onWidgetOpen=e},onShowHandler:function(e){R._callbackStack.onShow=e},onHideHandler:function(e){R._callbackStack.onHide=e},show:function(){var e=R.isShown();g.log("WebPushFloatingButton:show - hasShow",!!e),e||(h.addClass(R._container,R._containerShownClass),R._triggerCallback("onShow"))},hide:function(){var e=R.isShown();g.log("WebPushFloatingButton:hide - hasShow",!!e),e&&(h.removeClass(R._container,R._containerShownClass),R._triggerCallback("onHide"))},isShown:function(){return h.hasClass(R._container,R._containerShownClass)},isHidden:function(){return!R.isShown()},isWidgetOpened:function(){return h.hasClass(R._container,R._widgetOpenedClass)},isWidgetClosed:function(){return!R.isWidgetOpened()},onButtonTriggerClick:function(){return!1!==R._triggerCallback("onButtonTriggerClick")&&(R.isWidgetOpened()?R.closeWidget():R.openWidget())},closeWidget:function(){var e=R.isWidgetOpened();g.log("WebPushFloatingButton:closeWidget - isWidgetOpened",!!e),e&&(h.removeClass(R._container,R._widgetOpenedClass),R._triggerCallback("onWidgetClose"))},openWidget:function(){var e=R.isWidgetOpened();g.log("WebPushFloatingButton:closeWidget - isWidgetOpened",!!e),e||(h.addClass(R._container,R._widgetOpenedClass),R._triggerCallback("onWidgetOpen"))}},D={CONFIG_WEBPUSH_MODE_NATIVE:"native",CONFIG_WEBPUSH_MODE_EXTERNAL:"external",EVENT_ERROR_CODE_PERMISSION_BLOCKED:"permission-blocked",EVENT_ERROR_CODE_PERMISSION_DEFAULT:"permission-default",EVENT_ERROR_CODE_PERMISSION_UNKNOWN:"permission-unknown",_stylesUrl:[],_config:{},_appIsReady:f,_serviceWorker:null,_callbackStack:{onWebPushSubscribe:function(){},onWebPushSubscribeBlock:function(){},onWebPushSubscribeDiscard:function(){},onWebPushUnsubscribe:function(){},onBrowserPermissionAgree:function(){},onBrowserPermissionBlock:function(){},onBrowserPermissionDiscard:function(){},onMessage:function(){}},onWebPushSubscribe:function(e){D._callbackStack.onWebPushSubscribe=e},onWebPushSubscribeBlock:function(e){D._callbackStack.onWebPushSubscribeBlock=e},onWebPushSubscribeDiscard:function(e){D._callbackStack.onWebPushSubscribeDiscard=e},onWebPushUnsubscribe:function(e){D._callbackStack.onWebPushUnsubscribe=e},onBrowserPermissionAgree:function(e){D._callbackStack.onBrowserPermissionAgree=e},onBrowserPermissionBlock:function(e){D._callbackStack.onBrowserPermissionBlock=e},onBrowserPermissionDiscard:function(e){D._callbackStack.onBrowserPermissionDiscard=e},onMessage:function(e){D._callbackStack.onMessage=e},getConfigWebpushModeSu_EXTERNAL]},init:function(n){return h.uniquePromiseHandler("WebPushManager.init",function(e,t){g.log("WebPushManager:init",n),b.getWebPushProfileConfig().then(function(e){return Q.resolve(m.extend(e||{},n||{}))}).then(D.setConfig).then(D.initState).then(D.isWebPushSupp.document)}).then(function(){return D.initApp().then(function(){return D.checkAndSynchronizeStateIfRequired().then(function(e){g.log("WebPushManager:init checkAndSynchronizeStateIfRequired then",e)}).catch(function(e){g.error("WebPushManager:init checkAndSynchronizeStateIfRequired then error",e)}),Q.resolve()}).then(function(){return D.initFloatingButon done")}).catch(function(e){g.error("WebPushManager:init initFloatingButton Can not init floating button - error occurred",e)}),Q.resolve()}).catch(function(e){g.error("WebPushManager:init initApp error",e)}),Q.resolve()}).then(function(){g.log("WebPushManager:init done"),e()}).catch(function(e){g.error("WebPushManager:init error",e),t(e)})})},getMode:function(){return D._config.mode},getDomain:function(){return A.getDomain()},initFloatingButton:function(){return new Q(function(e,t){var n;return D._config.floating_button?(n=D._config.language)?(R.onStateContentChangeHandler(D.onFloatingButtonStateContentChange.bind(D)),R.init(n.floating_button).then(function(){D.attachHandlers(R._container),D.updateFloatingButtonState(),R.show(),e()}).catch(t)):(g.error("WebPushManager:init Can not init floating button - language config is not defined",D._config),t(new Error("Language config is not defined"))):(g.log("WebPushManager:init Floating button is disabled",D._config),e())})},onFloatingButtonStateCoandlers(t)},onWebPushStateSubscriptionChange:function(e,t){g.log("WebPushManager:onWebPushStateChange",e,t),g.log("WebPushManager:onWebPushStateChange WebPushFloatingButton._initialized",R._initialized),R._initialized&&D.updateFloatingButtonState()},updateFloatingButtonState:function(){return new Q(function(e,t){if(!R._initialized)return g.error("WebPushManager:init Can not update floating button state - module is not initialized",R),t(new Error("Can not update floating button state - module is not initialized"));var n=null;switch(M.getSubscription()){case M.SUBSCRIPTION_UNKNOWN:n=R.STATE_UNKNOWN;break;case M.SUBSCRIPTION_SUBSCRIBE:n=R.STATE_SUBSCRIBE;break;case M.SUBSCRIPTION_UNSUBSCRIBE:n=R.STATE_UNSUBSCRIBE}R.updateState(n),e()})},initApp:function(){return new h.uniquePromiseHandler("WebPushManager.initApp",function(e,t){g.log("WebPushManager:initApp"),A.init().then(function(){var e=M.getSubscription();return g.log("WebPushManager:initApp check subscription",e),e!==M.SUBSCRIPTION_UNKNOWN?Q.resolve():(g.log("WebPushManager:initApp 0"),new Q(function(t,e){D.sendRequestToCheckSubscription().then(function(e){g.log("WebPushManager:initApp sendRequestToCheckSubscription then",e),M.setSubscription(e,!0),t()}).catch(function(e){g.error("WebPushManager:initApp Can not get subscription",e),t()})}))}).then(function(){var e=M.getBrowserPermission();return g.log("WebPushManager:initApp check browser permission",e),e!==M.BROWSER_PERMISSION_DEFAULT?Q.resolve():(g.log("WebPushManager:initApp 0"),new Q(function(t,e){D.getBrowserPermission().then(function(e){g.log("WebPushManager:initApp getBrowserPermission then",e),M.setBrowserPermission(e,!1),t()}).catch(function(e){g.error("WebPushManager:initApp Can not get browser permission",e),t()}ady=!0,e()}).catch(function(e){return g.error("WebPushManager:initApp Can not init web push app",e),D._appIsReady=!1,t(new Error("Can not init web push app"))})})},prepareStyles:function(){return new Q(function(e,t){if(g.log("WebPushManager:prepareStyles"),!D._stylesUrl)return e();h.addStyles(D._stylesUrl).then(function(){e()}).catch(function(e){g.error(e),t(e)})})},setConfig:function(r){return new Q(function(e,t){r=r||{},g.log("WebPushManager:setConfig",r);var n={service_worker_path:"/snr-sw.js",service_worker_scope:"/",sender_id:null,public_vapid:null,agreement_page_domain:null,agreement_page_url:"/agreement.html",external_page_iframe_url:"/iframeWorker.html",mode:D.CONFIG_WEBPUSH_MODE_NATIVE,enabled:!1};g.log("WebPushManager:setConfig extend",n,D._config,r),D._config=m.extend({},n,D._config,r),D._config.service_worker_path||(D._config.service_worker_path=n.service_worker_path),D._config.service_worker_scope||(D._config.service_worker_scope=n.service_worker_scope),g.log("WebPushManager:setConfig return ",D._config),e()})},initState:function(){return new Q(function(t,e){g.log("WebPushManager:initState"),M.init().then(function(){g.log("WebPushManager:initState done"),M.onStateSubscriptionChangeHandler(D.onWebPushStateSubscriptionChange.bind(D)),t()}).catch(function(e){return g.error("WebPushManager:initState Can not restore state from cache",e),t()})})},checkAndSynchronizeStateIfRequired:function(){return new Q(function(e,t){g.log("WebPushManager:checkAndSynchronizeStateIfRequired");M.getBrowserPermission(),M.getSubscription();navigator.serviceWorker.getRegistrations().then(function(e){return e[0].pushManager.getSubscription().then(function(e){var t;g.log("WebPushManager:checkAndSynchronizeStateIfRequired current subscription",e),e&&(t=h.uint8ArrayToBase64Url(new Uint8Array(e.options.applicationServerKey)),null!==D._config.public_vapid)&&t!==D._config.public_vapid&&(g.log("WebPushManager:checkAndSynchronizeStateIfRequired publicVapid and server keys differ. Unsubscribing."),e.unsubscnSaved(!1)}))}).catch(function(e){g.error("WebPushManager:checkAndSynchronizeStateIfRequired could not convert server key to string",e)})}).then(function(){var n=M.isSwVersionChanged(D._serviceWorker);if(!n&&M.isSubscriptionSaved()&&M.isBrowserPermissionSaved())return e();Q.resolve().then(function(){var e=M.getBrowserPermission();return n||!M.isBrowserPermissionSaved()&&e===M.BROWSER_PERMISSION_AGREED?(g.log("WebPushManager:checkAndSynchronizeStateIfRequired try saving browser permission",e),new Q(function(t,e){D.getToken().then(function(e){if(g.log("WebPushManager:checkAndSynchronizeStateIfRequired getToken then",e),!n&&!M.isTokenChanged(e))return g.log("WebPushManager:checkAndSynchronizeStateIfRequired getToken token has the same value - do not send request",e),M.setBrowserPermissionSaved(!0),t(e);M.setToken(e),M.setServiceWorkerVersion(D._serviceWorker),D.sendBrowserPermissionRequest(e,D._config.public_vapid).then(function(){M.setBrowserPermissionSaved(!0)}).catch(function(e){g.error("WebPushManager:checkAndSynchronizeStateIfRequired sendAddBrowserPermissionRequest then error",e)}),t(e)}).catch(function(e){g.error("WebPushManager:checkAndSynchronizeStateIfRequired getToken then error",e),t()})})):Q.resolve()}).then(function(e){var n=M.getSubscription();return M.isSubscriptionSaved()||n===M.SUBSCRIPTION_UNKNOWN?Q.resolve():(g.log("WebPushManager:checkAndSynchronizeStateIfRequired try saving subscription",n),new Q(function(e,t){if(n===M.SUBSCRIPTION_SUBSCRIBE)D.sendSubscribeRequest().then(function(){M.setSubscriptionSaved(!0)}).catch(function(e){g.error("WebPushManager:checkAndSynchronizeStateIfRequired sendSubscribeRequest then error",e)});else{if(n!==M.SUBSCRIPTION_UNSUBSCRIBE)return e();D.sendUnsubscribeReqnSaved(!0)}).catch(function(e){g.error("WebPushManager:checkAndSynchronizeStateIfRequired sendUnsubscribeRequest then error",e)})}e()}))}).then(function(){e()}).catch(function(e){t(e)})}).catch(function(e){return g.error("WebPushManager:checkAndSynchronizeStateIfRequired could not get current subscription",e),t(new Error("Could not get current subscription"))})})},getBrowserPermission:function(){return g.log("WebPushManager:getBrowserPermission"),new Q(function(t,e){A.getPermission().then(function(e){g.log("WebPushManager:getBrowserPermission getPermission then",e),t(D.mapAppPermissionToBrowserPermissionValues(e))}).catch(e)})},getSionState()},mapAppPermissionToBrowserPermiON_AGREED}},isWebPushSupported:function(){return new Q(function(e,t){return g.log("WebPushManager:isWebPushSupported",D._config,document.location,u.getProtocol()),D._config.enabled?m.inArray(D._config.mode,D.getConfigWebpushModeSupportedList())?D._config.mode===D.CONFIG_WEBPUSH_MODE_NATIVE&&"localhost"!==document.location.hostname&&"https"!==u.getProtocol()?(g.error('WebPushManager:isWebPushSupported WebPush service do not support unsecured protocol "%s"',document.location.protocol),t(new Error("WebPush service do not support unsecured protocol"))):"PushManager"in $?void e():(g.error("WebPushManager:isWebPushSupported This browser does not support push notification"),t(new Error("This browser does not support push notification"))):(g.error('WebPushManager:isWebPushSupported WebPush mode "%s" is not supported',D._config.mode),t(new Error("WebPush mode is not supported"))):(g.info("WebPushManager:isWebPushSupported WebPush is currently disabled",D._config.enabled),t(new Error("WebPush is currently disabled")))})},isWebPushAppReady:function(){return new Q(function(e,t){g.log("WebPushManager:isWebPushAppReady",D._appIsReady),(!0===D._appIsReady?Q.resolve():!1===D._appIsReady?Q.reject(new Error("App not initialized")):D.initApp()).then(function(){e()}).catch(function(e){return g.error("WebPushManager:isWebPushAppReady WebPush app is currently not available"),t(new Error("WebPush is currently not available"))})})},checkSubscribeRequestNeed:function(){var e=M.getSubscription(),t=M.getBrowserPermission();return g.log("WebPushManager:checkSubscribeRequestNeed",e,t),t===M.BROWSER_PERMISSION_DEFAULT||t===M.BROWSER_PERMISSION_AGREED&&e!==M.SUBSCRIPTION_SUBSCRIBE},getSubscriptionState:function(){return M.getSubscription()},getBrowserPermissionState:function(){return M.getBrowserPermission()},attachHandlers:function(n,r){return new Q(function(e,t){g.log("WebPushManager:attachEvents",n,r),h.attachHandlerByClassName(n,"snrs-webpush--trigger-subscribe","click",D.onWebPushTriggerSubscribeHandler,r),h.attachHandlerByClassName(n,"snrs-webpush--trigger-subscribeDiscard","click",D.onWebPushTriggerSubscribeDiscardHandler,r),h.attachHandlerByClassName(n,"snrs-webpush--trigger-unsubscribe","click",D.onWebPushTriggerUnsubscribeHandler,r),e()})},onWebPushTriggerSubscribeHandler:function(){return new Q(function(t,n){g.log("WebPushManager:onWebPushTriggerSubscribeHandler"),D.subsce",e),t(e)}).catch(function(e){g.error("WebPushManager:onWebPushTriggerSubscribeHandler requestPermission error occurred",e),n(e)})})},onWebPushTriggerSubscribeDiscardHandler:function(){return new Q(function(e,t){g.log("WebPushManager:onWebPushTriggerSubscribeDiscardHandler"),D.onWebPushSubscribeDiscardHandler().then(function(){e()}).catch(function(e){g.error("WebPushManager:onWebPushTriggerSubscribeDiscardHandler onWebPushSubscribeDiscardHandler error occurred",e),t(e)})})},onWebPushTriggerUnsubscribeHandler:function(){return new Q(function(e,t){g.log("WebPushManager:onWebPushTriggerUnsubscribeHandler"),D.unsubscribe().then(function(){g.log("WebPushManager:onWebPushTriggerUnsubscribeHandler requestPermission then"),e()}).catch(function(e){g.error("WebPushManager:onWebPushTriggerUnsubscribeHandler error occurred",e),t(e)})})},getMessageChannel:function(){return new Q(function(e,t){if(g.log("WebPushManager:getMessageChannel"),!$.MessageChannel)return t(new Error("MessageChannel is not supported"));t=new $.MessageChannel;g.log("WebPushManager:getMessageChannel result",t),e(t)})},onServiceWorkerMessageHandler:function(e){g.log("WebPushManager:onServiceWorkerMessageHandler onmessage",e.data,e),"snrSwVersionSet"!==e.data.action&&"snrSwInstall"!==e.data.action||(g.log("WebPushManager:onServiceWorkerMessageHandler",e.data.version),D._serviceWorker=e.data.version,D.checkAndSynchronizeStateIfRequired())},onMessageClickHandler:function(n){rer",n),e()})},onBrowserPermissionAgreeHandler:function(){return new Q(function(t,n){g.log("WebPushManager:onBrowserPermissionAgreeHandler"),M.setBrowserPermission(M.BROWSER_PERMISSION_AGREED,!1),D.getToken().then(function(e){g.log("WebPushManager:onBrowserPermissionAgreeHandler getToken then",e),w.trackClientEvent("","webpush.permissionAgree",{token:e}),D._callbackStack.onBrowserPermissionAgree(),D.onWebPushSubscribeHandler(),t()}).catch(function(e){g.error("WebPushManager:onBrowserPermissionAgreeHandler getToken then error",e),n(e)})})},onBrowserPermissionBlockHandler:function(){return new Q(function(e,t){g.log("WebPushManager:onBrowserPermissionBlockHandler"),M.setBrowserPermission(M.BROWSER_PERMISSION_BLOCKED,!1),w.trackClientEvent("","webpush.permissionBlock",{}),D._callbackStack.onBrowserPermissionBlock(),D.onWebPushSubscribeBlockHandler(),e()})},onBrowserPermissionDiscardHandler:function(){return new Q(function(e,t){g.log("WebPushManager:onBrowserPermissionDiscardHandler"),w.trackClientEvent("","webpush.permissionDiscard",{}),D._callbackStack.onBrowserPermissionDiscard(),D.onWebPushSubscribeDiscardHandler(),e()})},onWebPushSubscribeHandler:function(){return new Q(function(e,t){g.log("WebPushManager:onWebPushSubscribeHandler"),M.setSubscription(M.SUBSCRIPTION_SUBSCRIBE,!1),w.trackClientEvent("","webpush.subscribe",{}),D.checkAndSynchronizeStateIfRequired(),D._callbackStack.onWebPushSubscribe(),e()})},onWebPushSubscribeBlockHandler:function(){return new Q(function(e,t){g.log("WebPushManager:onWebPushSubscribeBlockHandler"),w.trackClientEvent("","webpush.subscribeBlock",{}),D._callbackStack.onWebPushSubscribeBlock(),e()})},onWebPushSubscribeDiscardHandler:function(){return new Q(function(e,t){g.log("WebPushManager:onWebPushSubscribeDiscardHandler"),w.trackClientEvent("","webpush.subscribeDiscard",{}),D._callbackStack.onWebPushSubscribeDiscard(),e()})},onWebPushUnsubscribeHandler:function(){return new Q(function(e,t){g.log("WebPushManager:onWebPushUnsubscribeHandler"),M.setSubscription(M.SUBSCRIPTION_UNSUBSCRIBE,!1),w.trackClientEvent("","webpush.unsubscribe",{}),D.checkAndSynchronizeStateIfRequired(),D._callbackStack.onWebPushUnsubscribe(),e()})},requestPermission:function(e){return new Q(function(t,n){e=e||{},A.requestPermission(e).then(function(e){g.log("WebPushManager:requestPermission then",e),t(e)}).catch(function(e){g.error("WebPushManager:requestPermission then error",e),n(e)})})},subscribe:function(e){return new Q(function(t,n){e=e||{},A.requestPermission(e).then(function(e){if(g.log("WebPushManager:requestPermission then",e),!1===e)return M.setBrowserPermission(M.BROWSER_PERMISSION_AGREED,!1),D.onWebPushSubscribeHandler(),t(e);t(e)}).catch(function(e){g.error("WebPushManager:requestPermission then error",e),e.code===D.EVENT_ERROR_CODE_PERMISSION_BLOCKED&&(M.setBrowserPermission(M.BROWSER_PERMISSION_BLOCKED,!1),D.onWebPushSubscribeBlockHandler()),n(e)})})},unsubscribe:function(e){return new Q(function(e,t){g.log("WebPushManager:unsubscribe"),D.onWebPushUnsubscribeHandler().then(function(){g.log("WebPushManager:unsubscribe then"),e()}).catch(function(e){g.error("WebPushManager:unsubscribe then error",e),t(new Error("Unable to unsubscribe webpush notifications"))})})},getToken:function(){return new Q(function(t,n){A.getToken().then(function(e){if(e)return g.log("WebPushManager:getToken Token has been received",e),t(e);g.log("WebPushManager:getToken Can not get token, permission required"),t()}).catch(function(e){g.error("WebPushManager:getToken Can not get token, it has been blocked",e),n(e)})})},deleteToken:function(e){return new Q(function(t,n){A.deleteToken(e).then(function(e){g.log("WebPushManager:deleteToken Token has been deleted",e),M.setBrowserPermission(M.BROWSER_PERMISSION_AGREED,!1),t()}).catch(function(e){g.error("WebPushManager:deleteToken Can not delete token, error occurred",e),n(new Error("Can not delete token, error occurred"))})})},sendSubscribeRequest:function(){return new Q(function(e,t){g.log("WebPushManager:sendSubscribeRequest"),P.subscribeWebPushForClient().then(function(){g.log("WebPushManager:sendSubscribeRequest subscribed"),e()}).catch(function(e){g.error("WebPushManager:sendSubscribeRequest Can not subscribe, error occurred",e),t(new Error("Can not save subscribe status of notifications, error occurred"))})})},sendUnsubscribeRequest:function(){return new Q(function(e,t){return g.log("WebPushManager:sendUnsubscribeRequest"),P.unsubscribeWebPushForClient().then(function(){g.log("WebPushManager:sendUnsubscribeRequest unsubscribed"),e()}).catch(function(e){g.error("WebPushManager:sendUnsubscribeRequest Can not unsubscribe web push, error occurred",e),t(new Error("Can not save unsubscribe status of notifications, error occurred"))}),e()})},sendRequestToCheckSubscription:function(){return new Q(function(t,n){g.log("WebPushManager:sendRequestToCheckSubscription for domain",D.getDomain()),P.checkWebPushSubscriptionForClient(D.getDomain()).then(function(e){if(g.log("WebPushManager:sendRequestToCheckSubscription subscription",e,D.getDomain()),!m.inArray(e,M.getSubscriptionOptionList()))return Q.reject(new Error("Subscription status is invalid"));t(e)}).catch(function(e){g.error("WebPushManager:sendRequestToCheckSubscription Can not get subscription status of notifications, error occurred",e),n(new Error("Can not get subscription status of notifications, error occurred"))})})},sendBrowserPermissionRequest:function(r,i){return new Q(function(t,n){g.log("WebPushManager:sendBrowserPermissionRequest for domain",D.getDomain()),navigator.serviceWorker.getRegistrations().then(function(e){return e[0].pushManager.getSubscription().then(function(e){return g.log("WebPushManager:sendBrowserPermissionRequest current subscription",e.toJSON()),i?e.toJSON():null}).catch(function(e){g.error("WebPushManager:sendBrowserPermissionRequest could not get subscription",e)})}).then(function(e){P.addBrowserPermissionWebPushForClient(r,D.getDomain(),e,M.getServiceWorkerVersion()).then(function(){g.log("WebPushManager:sendBrowserPermissionRequest Token has been saved",r,D.getDomain()),t()}).catch(function(e){g.error("WebPushManager:sendBrowserPermissionRequest Can not save token, error occurred",e),n(new Error("Can not save token, error occurred"))})}).catch(function(e){g.error("WebPushManager:sendBrowserPermissionRequest could not get subscription",e)})})},onTokenRefresh:function(){g.log("WebPushManager:onTokenRefresh"),M.setBrowserPermission(M.BROWSER_PERMISSION_AGREED,!1),D.checkAndSynchronizeStateIfRequired()},onMessageHandler:function(e){g.log("WebPushManager:onMessageHandler",e),e&&m.isDocumentVisible()&&(e.notification?D.showNotification(e):e.data&&D.onMessageClickHandler(e.data),D._callbackStack.onMessage(e))},showNotification:function(n){return new Q(function(e,t){if(g.log("WebPushManager:showNotification",n),!n||!n.notification)return t(new Error("Payload is empty or it have not notification key"));n.notification=m.extend({},n.data,n.notification),A.showNotificatn then",n)}).catch(function(e){g.error("Can not show notification",e),t(new Error("Can not show notification"))})})}},N={_firebaseAppNamespace:"SyneriseApp",_firebaseApp:null,_firebaseMessangingApp:null,_serviceWorkerRegistration:null,init:function(){return new Q(function(e,t){g.log("WebPushNativeApp:init firebase",U),N.initFcmApp().then(N.registerServiceWdone"),e()}).catch(function(e){g.error("WebPushNativeApp:init error",e),t(e)})})},initFcmApp:function(){return new Q(function(e,t){var n;return g.log("WebPushNativeApp:initFcmApp"),U?D._config.sender_id?(n={messagingSenderId:D._config.sender_id},N._firebaseApp=U.initializeApp(n,N._firebaseAppNamespace),N._firebaseMessangingApp=U.messaging(N._firebaseApp),N._firebaseMessangingApp.onTnRefresh()}),N._firebaseMessangingApHandler(e)}),D._config.public_vapid&&(g.log("WebPushNativeApp:initFcmApp usePublicVapidKey ",D._config.public_vapid),N._firebaseMessangingApp.usePublicVapidKey(D._config.public_vapid)),void e()):t(new Error("Sender id is required for web push")):t(new Error("Firebase Cloud Messaging APP is required"))})},registerServiceWorker:function(){return new Q(function(t,n){if(g.log("WebPushNativeApp:registerServiceWorker"),!N._firebaseApp||!N._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));if(!("serviceWorker"in navigator))return n(new Error("Service worker in not supported"));navigator.serviceWorker.addEventListeneHandler(e)});var e=b.getBuildHash();navigator.serviceWorker.register(D._config.service_worker_path+"?hash="+e,{scope:D._config.service_worker_scope}).then(function(e){g.log("WebPushNativeApp:registerServiceWorker Registration succeeded. Scope is "+e.scope),N._serviceWorkerRegistration=e,N._firebaseMessangingApp.useServiceWorker(N._serviceWorkerRegistration),N._serviceWorkerRegistration.active.postMessage({action:"snrSwVersionGet"}),t()}).catch(function(e){g.fatal("WebPushNativeApp:registerServiceWorker Registration failed with ",e),n(new Error("Service worker registration failed"))})})},getDomain:function(){return location.hostname},requestPermission:function(e){return new Q(function(t,n){if(e=e||{},g.log("WebPushNativeApp:requestPermission",e),!N._firebaseApp||!N._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));N.getToken().then(function(e){if(g.log("WebPushNativeApp:requestPermission getToken then",e),e)return t(!1);N._firebaseMessangingApp.requestPermiseHandler()}).catch(function(e){g.error("WebPushNativeApp:requestPermission Unable to get permission to notify",e);var t=new Error("Unable to get permission to notify");switch(t.code=A.parseFirebaseErrorCode(e.code),t.code){case D.EVENT_ERROR_CODE_PERMISSION_BLOCKED:D.onBrowserPermissionBlockHandler();break;case D.EVENT_ERROR_CODE_PERMISSION_DEFAULT:D.onBrowserPermissionDiscardHandler()}}),t()}).catch(function(e){g.error("WebPushNativeApp:requestPermission getToken then error",e);var t=new Error("Unable to request permission to notify");t.code=e.code,n(t)})})},getPermission:function(){return new Q(function(n,r){if(g.log("WebPushNativeApp:getPermission"),!N._firebaseApp||!N._firebaseMessangingApp)return r(new Error("WebPush manager is not initialized"));N.getToken().then(function(e){return g.log("WebPushNativeApp:getPermission getToken then",e),n(e?A.PERMISSION_AGREED:A.PERMISSION_DEFAULT)}).catch(function(e){if(g.error("WebPushNativeApp:getPermission getToken then error",e),e.code===D.EVENT_ERROR_CODE_PERMISSION_BLOCKED)return n(A.PERMISSION_BLOCKED);var t=new Error("Unable to get permission");t.code=e.code,r(t)})})},getToken:function(){return new Q(function(t,n){if(g.log("WebPushNativeApp:getToken"),!N._firebaseApp||!N._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));N._firebaseMessangingApp.getToken().then(function(e){g.log("WebPushNativeApp:getToken then",e),t(e)}).catch(function(e){g.error(e),g.error("WebPushNativeApp:getToken Can not get token, it has been blocked",e);var t=new Error("Can not get token, it has been blocked");t.code=A.parseFirebaseErrorCode(e.code),n(t)})})},deleteToken:function(e){return new Q(function(t,n){if(g.log("WebPushNativeApp:deleteToken"),!N._firebaseApp||!N._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));N._firebaseMessangingApp.deleteToken(e).then(function(e){t(e)}).catch(function(e){g.error("WebPushNativeApp:deleteToken Can not delete token, error occurred",e),n(new Error("Can not delete token, error occurred"))})})},showNotification:function(o){return new Q(function(r,i){g.log("WebPushNativeApp:showNotification",o),navigator.serviceWorker.getRegistrations().then(function(e){g.log("WebPushNativeApp:showNotification serviceWorker getRegistrations",o,e);var t=document.location.origin+D._config.service_worker_scope;[].forEach.call(e,function(n){t==n.scope&&D.getMessageChannel().then(function(e){var t={action:"worker.showNotification",notificationPayload:o};e.port1.onmessage=D.onServiceWorkerMessageHandler,n.active.postMessage(t,[e.port2]),r()}).catch(function(e){g.error("Can not show notification. Can not get message channel",e),i(new Error("Can not show notification. Can not get message channel"))})})}).catch(function(e){g.error("Can not show notification. Service worker is not ready yet",e),i(new Error("Can not show notification. Service worker is not ready yet"))})})}},M={SUBSCRIPTION_SUBSCRIBE:"subscribe",SUBSCRIPTION_UNSUBSCRIBE:"unsubscribe",SUBSCRIPTION_UNKNOWN:"unknown",BROWSER_PERMISSION_AGREED:"agreed",BROWSER_PERMISSION_BLOCKED:"blocked",BROWSER_PERMISSION_DEFAULT:"default",_data:{subscription:"unknown",subscriptionSaved:!1,permission:"default",permissionSaved:!1,tokenTime:null,tokenHash:null,serviceWorker:null},_dataLocalStorageKey:"snr-wp-state",_tokenSavedIntervalRefresh:36e5,_callbackStack:{onStateChange:function(){},onStateSubscriptionChange:function(){}},init:function(){return new Q(function(t,e){g.log("WebPushState:init"),M.restoreStateFromLocalCache().then(function(){var e=O.getClientUuid();g.log("WebPushState:init current state",M._data),g.log("WebPushState:init uuids",e,M._data.uuid),g.log("WebPushState:init synchronized",M._data.permissionSaved),M._data.uuid&&e&&e===M._data.uuid?M._data.tokenTime?(new Date).getTime()-M._data.tokenTime>=M._tokenSavedIntervalRefresh&&(g.log("WebPushState:init timeout occurred for token saved status, clear permission saved status"),M._data.permissionSaved=!1):(g.log("WebPushState:init token time is not defined, clear permission saved status"),M._data.permissionSaved=!1):(g.log("WebPushState:init other client uuid, clear state for this client"),M._data.permissionSaved=!1,M._data.subscriptionSaved=!1,M._data.subscription=M.SUBSCRIPTION_UNKNOWN,M._data.tokenHash=null,M._data.tokenTime=null,M.saveStateInLocalCache()),g.log("WebPushState:init done",M._data),es",e),t()})})},_triggerCallback:function(e){if(g.log("WebPushState:_triggerCallback",e),M._callbackStack[e]){for(var t=new Array(arguments.length-1),n=0;n<t.length;++n)t[n]=arguments[n+1];var r=M._callbackStack[e];if(m.isFunction(r))if(g.log("WebPushState:_triggerCallback call with args",e,t,r),!1===r.apply(M,t))return!1}},onStateChangeHandler:function(e){M._callbackStack.onStateChange=e},onStateSubscriptionChangeHandler:function(e){M._callbackStack.onStateSubscriptionChange=e},getBrowserPermissionOptionList:function(){return[M.BROWSER_PERMISSION_AGREED,M.BROWSER_PERMISSION_BLOCKED,M.BROWSER_PERMISSION_DEFAULT]},getSubscriptioN_UNKNOWN]},getServiceWorkerVersion:function(){return M._data.serviceWorker},setServiceWocalCache()},getSubscription:function(){return M._data.subscription},isSubscriptionSaved:function(){return M._data.subscriptionSaved},setSubscription:function(e,t){if(g.log("WebPushState:setSubscription",e,t=void 0!==t&&!!t),!m.inArray(e,M.getSubscriptionOptionList()))throw new Error('Subscription value "'+e+'" is invalid');var n=M._data.subscription;M._data.subscription=e,M._data.subscriptionSaved=t,M._triggerCallback("onStateSubscriptionChange",e,n),M.saveStateInLocalCache()},setSubscriptionSaved:function(e){g.log("WebPushState:setSubscriptionSaved",e=void 0!==e&&!!e),M._data.subscriptionSaved=e,M.saveStateInLocalCache()},getBrowserPermission:function(){return M._data.permission},isBrowserPermssionSaved},setBrowserPermission:function(e,t){if(g.log("WebPushState:setBrowserPermission",e,t=void 0!==t&&!!t),!m.inArray(e,M.getBrowserPermissionOptionList()))throw new Error('Browser permission value "'+e+'" is invalid');M._data.permission=e,M._data.permissionSaved=t,M._data.tokenTime=(new Date).getTime(),M.saveStateInLocalCache.tokenHash},setToken:function(e){g.log("WebPushState:setToken",e),M.setTokenHash(e?M.prepareHashForToken(e):null)},setTokenHash:function(e){g.log("WebPushState:setTokenHash",e),M._data.tokenHash=e||null,M.saveStateInLocalCache()},prepareHashForToken:function(e){return g.log("WebPushState:prepareHashForToken",e),h.hashString(e)+""},isTokenChanged:function(e){if(g.log("WebPushState:isTokenChanged",e),e)return!M._data.tokenHash||M._data.tokenHash!==M.prepareHashForToken(e);throw new Error("Token not defined")},isSwVersionChanged:function(e){return g.log("WebPushState:isSwVersionChanged",e,M._data.serviceWorker),e&&M._data.serviceWorker!==e},setBrowserPermissionSaved:function(e){g.log("WebPushState:setBrowserPermissionSaved",e=void 0!==e&&!!e),M._data.permissionSaved=e,M._data.tokenTime=(new Date).getTime(),M.saveStateInLocalCache()},saveStateInLocalCache:function(){return new Q(function(e,t){var n;g.log("WebPushState:saveStateInLocalCache",M._data),I.isAvailable()&&(n=M.prepareObjectForCacheState(M._data),I.set(M._dataLocalStorageKey,n),g.log("WebPushState:saveStateInLocalCache saved stateObject",n)),R._triggerCallback("onStateChange",M._data),e()})},restoreStateFromLocalCache:function(){return new Q(function(e,t){if(g.log("WebPushState:restoreStateFromLocalCache"),!I.isAvailable())return e();var n=I.get(M._dataLocalStorageKey),r=M.prepareObjectFromCacheState(n);if(r)for(var i in r)r.hasOwnProperty(i)&&(M._data[i]=r[i]);g.log("WebPushState:restoreStateFromLocalCache restored state",M._data),e()})},prepareObjectForCacheState:function(e){g.log("WebPushState:prepareObjectForCacheState state",e);var t=O.getClientUuid(),n={permissionSaved:e.permissionSaved?"1":"0",subscriptionSaved:e.subscriptionSaved?"1":"0"};return e.tokenTime&&(n.tokenTime=e.tokenTime),e.tokenHash&&(n.tokenHash=e.tokenHash),e.subscription&&(n.subscription=e.subscription),e.serviceWorker&&(n.serviceWorker=e.serviceWorker),e.permission&&(n.permission=e.permission),t&&(n.uuid=t),g.log("WebPushState:prepareObjectForCacheState return stateForCache",n),n},prepareObjectFromCacheState:function(e){g.log("WebPushState:prepareObjectFromCacheState",e);var t={};return void 0===e?g.log("WebPushState:prepareObjectFromCacheState Not found"):(t.permissionSaved="1"===e.permissionSaved,t.subscriptionSaved="1"===e.subscriptionSaved,e.tokenTime&&(t.tokenTime=parseInt(e.tokenTime,10)),e.tokenHash&&(t.tokenHash=e.tokenHash),e.subscription&&(t.subscription=e.subscription),e.serviceWorker&&(t.serviceWorker=e.serviceWorker),e.permission&&(t.permission=e.permission),e.uuid&&(t.uuid=e.uuid),g.log("WebPushState:prepareObjectFromCacheState state",t)),t}};p.init({startTime:t.getTime()});try{var ne={init:b.init.bind(b),auth:{apiKey:l.apiKey.bind(l),trackerKey:l.trackerKey.bind(l)},client:{setAccessToken:d.setAccessToken.bind(d),clearAccessToken:d.clearAccessToken.bind(d),getCurrentClient:d.getCurrentClient.bind(d),update:d.updateClientParams.bind(d),notify:d.notify.bind(d),setUuid:d.setUuid.bind(d),hashIdentity:d.hashIdentity.bind(d),getIdentityHash:d.getIdentityHash.bind(d),setUuidAndIdentityHash:d.setUuidAndIdentityHash.bind(d)},event:{track:w.track.bind(w),pageVisit:w.pageVisit.bind(w),sendFormData:w.sendFormData.bind(w),trackCustomEvent:w.trackCustomEvent.bind(w),requiresAuthorization:w.requiresAuthorization.bind(w)},device:{getAcceptLanguageList:u.getAcceptLanguageList.bind(V),getLanguage:u.getLanguage.bind(V),getProtocol:u.getProtocol.bind(V),getScreenInfo:u.getScreenInfo.bind(V),isCrawler:u.isCrawler.bind(V)},core:{getVersion:b.getVersion.bind(b),getModuleName:b.getModuleName.bind(b),getFullVersion:b.getFullVersion.bind(b),getBuildTime:b.getBuildTime.bind(b),getBuildHash:b.getBuildHash.bind(b),getOption:b.getOption.bind(b)}};void 0!==V&&(ne.dataLayer={init:V.init.bind(V)}),void 0!==y&&(ne.dynamicContent={setCustomVariablesFunction:y.setCustomVariablesFunction.bind(y),get:d.getAndRenderDynamicContentsForClient.bind(d),getRendered:y.getRenderedDynamicContent.bind(y)}),void 0!==D&&(ne.webPush={init:D.init.bind(D),checkSubscribeRequestNeed:D.checkSubscribeRequestNeed.bind(D),isWebPushSupported:D.isWebPushSupported.bind(D),isWebPushAppReady:D.isWebPushAppReady.bind(D),requestPermission:D.requestPermission.bind(D),subscribe:D.subscribe.bind(D),unsubscribe:D.unsubscribe.bind(D),getToken:D.getToken.bind(D),showNotification:D.showNotification.bind(D),onMessage:D.onMessage.bind(D),onWebPushSubscribe:D.onWebPushSubscribe.bind(D),onWebPushSubscribeBlock:D.onWebPushSubscribeBlock.bind(D),onWebPushSubscribeDiscard:D.onWebPushSubscribeDiscard.bind(D),onBrowserPermissionAgree:D.onBrowserPermissionAgree.bind(D),onBrowserPermissionBlock:D.onBrowserPermissionBlock.bind(D),onBrowserPermissionDiscard:D.onBrowserPermissionDiscard.bind(D)}),void 0!==i&&(ne.form={marker:i.marker.bind(i),initMarker:i.init.bind(i)})}catch(e){g.fatal(e)}W=$.SyneriseObjectNamespace||"SR";$[W];if($[W]=ne,void 0===$.SyneriseTC&&$.SyneriseTC,"object"===(typeof SyneriseTC).toLowerCase())console.error("WARNING: SyneriseTC is already initialized!");else{var re={config:null,domain:null,init:function(e,t){return(this.config=e).domain&&(this.domain=e.domain),($this=this).get("_snrs_.domain=e)}),this.ready(t),&&e(),this},getDomain:function(){var e;return null!==this.domain?this.domain:"localhost"!==(e=document.location.hostname)?"."+(e=e.replace(/^www\./i,"")):e},set:function(e,t,n,r,i,o,s){var a;return r="; path="+(r=void 0!==r&&r?r:"/"),i=void 0!==(i=void 0!==i&&i?i:this.getDomain())&&i?"; domain="+i:"",o=void 0===o||o?"; Secure":"",s=void 0!==s&&s?"; SameSite="+s:"; SameSite=None",b.getOption("localStorageMode")?null===t?I.remove(e):(a=new Date(n),a=Math.round(a.getTime()/1e3),I.setStringWithTtl(e,t,a)):document.cookie=e+"="+t+"; expires="+n+i+r+o+s,L.log("Cookie have been SET "+e),this},get:function(e,t){var n="";if(b.getOption("localStorageMode"))n=I.getStringWithTtl(e)||"";else for(var r=document.cookie.split("; "),i=0;i<r.length;i++){var o=r[i].split("=")[0],s=r[i].split("=")[1];e===o&&(n=unescape(s))}L.log('GET cookie "'+e+'"'),t,0,null,t)}},ie=(SyneriseTC={ver:3,dataType:{traffic:"traffic",formData:"formData",staticFile:"staticFile"},stat:{},server_port:{traffic:{http:80,https:443},formData:{http:80,https:443},staticFile:{http:80,https:443}},hosts:{traffic:"tck.snrbox.com",formData:"tck.snrbox.com",staticFile:"tc.snrbox.com"},forceProtocol:"https",domain:null,uuid:null,permUuid:null,oldUuid:null,identity:null,identityHash:"",resetUuid:!1,uniqueVisitTime:86400,campaignUID:0,trackerUID:"",ushash:"_ush",ushashValue:"",short_last:1800,perm_last:3456e4,perm_ttl:null,cookieManagerConfig:{},cookieList:{},cookiePath:"/",uniqueVisits:1,allVisits:1,sessionVisits:1,appear:Math.round((new Date).getTime()/1e3),lastVisit:0,screen:null,ref:null,os:null,user:null,pageTimeLast:0,singleSessUid:h.generateUUID(),productId:null,botNotReact:!0,triggerPageVisitOnHashChange:!1,formCatch:{storageKeyIndex:"synerise-form-catch",stdType:"form",inputDataAttr:{skip:"skip",skipAsAttribute:"skip-as-attribute"},skipFields:["__EVENTVALIDATION","__VIEWSTATEGENERATOR","__VIEWSTATE","__EVENTARGUMENT","__EVENTTARGET"],catchMode:"only-defined"},trafficStorageKeyIndex:"synerise-traffic-storage",gACode:null,customStatParams:null,customPageVisit:!1,customizeMetadata:null,trackerSpecialParams:{emailClick:{requiredParams:{snrs_cl:".+",snrs_cp:".+",snrs_cp_title:".*",snrs_medium:"email",snrs_he:"(-?[0-9]+)?"},category:"client.web.browser.mail",action:"newsletter.click",labelFromParam:"snrs_cp",processStatParams:function(e,t){if(w.jwtRequired||d.getAccessToken()||(SyneriseTC.checkIdentityHashExists()||e.uuid===t.snrs_cl?SyneriseTC.checkIdentityHashExists()&&t.snrs_he&&e.identityHash!==t.snrs_he&&SyneriseTC.setNewUUIDAndIdentityHash(t.snrs_he,t.snrs_cl):(SyneriseTC.setOldUuid(e.uuid),e.uuid=t.snrs_cl,SyneriseTC.setNewUUIDAndIdentityHash(t.snrs_he,t.snrs_cl))),"1"==t.snrs_redir)return!1;t={id:t.snrs_cp,campaignTitle:t.snrs_cp_title};e.params=SyneriseTC.appendToJson(e.params,t)}},webPushClick:{requiredParams:{snrs_cl:".+",snrs_cp:".+",snrs_cp_title:".*",snrs_medium:"web_push",snrs_he:"(-?[0-9]+)?"},category:"client.web.browser.pushmessage",action:"webpush.click",labelFromParam:"snrs_cp",processStatParams:function(e,t){if(w.jwtRequired||d.getAccessToken()||(SyneriseTC.checkIdentityHashExists()||e.uuid===t.snrs_cl?!SyneriseTC.checkIdentityHashExists()&&t.snrs_he&&e.identityHash!==t.snrs_he&&SyneriseTC.setNewUUIDAndIdentityHash(t.snrs_he,t.snrs_cl):(SyneriseTC.setOldUuid(e.uuid),e.uuid=t.snrs_cl,SyneriseTC.setNewUUIDAndIdentityHash(t.snrs_he,t.snrs_cl))),"1"==t.snrs_redir)return!1;t={id:t.snrs_cp,campaignTitle:t.snrs_cp_title};e.params=SyneriseTC.appendToJson(e.params,t)}},utm:{requiredParams:{"(snrs?|utm)_.*":".*"},processStatParams:function(s,a){re.get("_snrs_params",function(e){for(var t in L.log("utm processStatParams stat&snrsUrlParams&cookieSnrsParams",s,a,e),e=e&&JSON.parse(e),L.log("utm processStatParams cookieSnrsParams",e=e||{}),a){var n;a.hasOwnProperty(t)&&(n=a[t],e[t]=n)}for(var r in e){var i;e.hasOwnProperty(r)&&(i=e[r],e[r]=escape(i))}L.log("utm processStatParams cookieSnrsParams after escape",e);var o=new Date,o=(o.setTime(o.getTime()+2592e5),o.toGMTString());re.set("_snrs_params",JSON.stringify(e),o),s.params=SyneriseTC.appendToJson(s.params,e)})}},uuidFromUrl:{requiredParams:{snrs_cl:".+",snrs_he:"(-?[0-9]+)?"},processStatParams:function(e,t){w.jwtRequired||d.getAccessToken()||(SyneriseTC.checkIdentityHashExists()||e.uuid===t.snrs_cl?SyneriseTC.checkIdentityHashExists()&&t.snrs_he&&e.user_hash!==t.snrs_he&&SyneriseTC.setNewUUIDAndIdentityHash(t.snrs_he,t.snrs_cl):(SyneriseTC.setOldUuid(e.uuid),e.uuid=t.snrs_cl,SyneriseTC.setUuid(t.snrs_cl),SyneriseTC.identityHash=t.snrs_he))}},resetUuid:{requiredParams:{snrs_reset_uuid:"[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"},processStatParams:function(e,t){w.jwtRequired||d.getAccessToken()||(SyneriseTC.restoreSessionCookies(),SyneriseTC.clearCookieList(),SyneriseTC.setNewUUIDAndIdentityHash("",t.snrs_reset_uuid))}}},callbacks:{onReady:[],onStore:[]},isReady:!1,isInitialized:!1,ready:function(e){return L.log("Added onReady callback"),this.isReady?this.executeCallbacks([e]):this.callbacks.onReady.push(e),this},enhanceCookieManagerConfig:function(e){for(var t in e)e[t][0]&&e[t][1]&&"setDomain"===e[t][0]&&(this.cookieManagerConfig.domain=e[t][1])},init:function(n){var r;L.setDebugLevel(),this.isInitialized?L.log("ALREADY INITIALIZED!"):(this.isInitialized=!0,oe.get(),this.prepareCookieList(),r=this,L.log("Initializing cookie managers"),this.enhanceCookieManagerConfig(n),re.init(this.cookieManagerConfig,function(){L.log("Cookie manager initialized"),r.collect(),r.checkExternalCookies(),r.manageCookies(r.getCookieList(),function(){var e,t;r.setInitParams(n),r.checkUserHash(),r.gACode&&null!==r.gACode&&r.setGATracker(),!1===r.customPageVisit&&r.initPageHandler(),r.resendStoredData(r.formCatch.storageKeyIndex,function(e,t,n){r.customStatParams=t,r.storeFormData(r.custoeyIndex,e)}),r.customStatParams=null}),r.resendStoredData(r.trafficStorageKeyIndex,function(e,t,n){r.storeTraffic(t,function(){r.removeStoredData(r.trafficStorageKeyIndex,e)})}),r.initFormCatch(),(!1===r.customPageVisit||r.customPageVisit&&!r.uuid)&&(e=!1===r.customPageVisit?{}:{"x-snr-skip":!0},t=r.storeData(r.trafficStorageKeyIndex,r.buildParamsForStat()),r.storeTraffic(e,function(){r.removeStoredData(r.trafficStorageKeyIndex,t)})),r.isReady=!0,L.log("Executing onReady callbacks"),r.executeCallbacks(r.callbacks.onReady),oe.log(oe.get()),void 0!==r.initCookieMatchers&&r.initCookieMatchers()})}))},getPageHandler:function(){return!0&&(this._pageHandler||(this._pageHandler=ce(this,$.history,L)),this._pageHandler)},getHashChangeHandler:function(){return!0&&(this._hashChangeHandler||(this._hashChangeHandler=ae($,L)),this._hashChangeHandler)},initPageHandler:function(){var e=this.getPageHandler();e&&(e.attachHistoryHandler(),this.getTriggerPageVisitOnHashChange())&&e.attachHashHandler(this.getHashChangeHandler())},setTriggerPageVisitOnHashChange:function(e){this.triggerPageVisitOnHashChange=e},getTriggerPageVisitOnHashChange:function(){return this.triggerPageVisitOnHashChange},setInitParams:function(e){for(var t in L.balloon("Init with params",e),e)if(e.hasOwnProperty(t))try{var n,r=e[t][0];void 0!==r&&(this.hasOwnProperty(r)?(n=e[t][1],Array.isArray(n)||(n=[n]),this[r].apply(this,n)):L.log(new Error('Unknown function "'+r+'" in init args!')))}catch(e){L.log(e),L.balloon("Method not allowed or missing args")}if(""===this.trackerUID||!this.trackerUID)throw new Error("Method not allowed or missing args")},clearCookieList:function(){var t=this,n=t.getCookieList();[].forEach.call(Object.keys(n),function(e){t.removeCookie(n[e])})},checkExternalCookies:function(e){var t=this;re.get("_snrs_reset_uuid",function(e){"true"===e||1===Number(e)?(L.balloon("Reset UUID by cookie flag"),t.clearCookieList(),t.setResetUuid(!0),re.remove("_snrs_reset_uuid")):h.validateUUID(e)&&(L.balloon("Reset UUID by cookie with value"+e),t.clearCookieList(),t.setNewUUIDAndIdentityHash("",e),re.remove("_snrs_reset_uuid"))}),"function"==typeof e&&e()},setGeneratedUuid:function(){var e=h.generateUUID();L.balloon('CHANGING UUID! "'+this.uuid+'" to "'+e+'"'),this.setUuid(e,!0)},setUuid:function(t,e){if(t&&!h.validateUUID(t)){g.error("setUuid uuid is invalid & will be reset "+t);var n=t.match("amp")?t.replace("amp;","").replace("amp%253B",""):t;if(this.prevUuid&&n===this.prevUuid)return L.warning("setUuid uuid matches prevUuid & will be ignored "+t),!1;this.prevUuid=n,this.setOldUuid(t),h.validateUUID(n)?t=n:(t=null,this.setResetUuid(!0)),e=!0}this.uuid=t,L.balloon("SETTING UUID TO: "+this.uuid),t&&!this.permUuid&&(this.permUuid=this.uuid,L.balloon("SETTING PERM-UUID TO: "+this.permUuid)),!0===e&&(n=this.getCookieList(),this.removeCookie(n.perm),this.removeCookie(n.shorta),this.manageCookies(n,function(){}));try{d.getCurrentClient().then(function(e){e&&(e.uuid=t,d.updateClientParams(e,!1))})}catch(e){L.error("ERROR: setUuid client",e)}},getUuid:function(){return this.uuid},setOldUuid:function(e){this.oldUuid=e},getOldUuid:function(){return this.oldUuid},sesetUuid=e},getResetUuid:function(){return this.resetUuid},mergeObjects:function(e,t){for(var n in t){var r;t.hasOwnProperty(n)&&("object"==typeof(r=t[n])&&"object"==typeof e[n]?e[n]=this.mergeObjects(e[n],r):e[n]=r)}return e},appendToJson:function(e,t){var n=t;return e&&(n=JSON.parse(e),n=SyneriseTC.mergeObjects(n,t)),JSON.stringify(n)},parseDataType:function(e){return void 0!==e&&void 0!==this.dataType[e]?e:this.dataType.traffic},getProtocol:function(){var e;return void 0!==this.forceProtocol&&this.forceProtocol?this.forceProtocol:(e=(e=void 0!==document.location.protocol?document.location.protocol:"https").replace(":","")).match("https?")?e:"https.hosts[e]},getPort:function(e,t){t=this.parseDataType(t);var n=this.server_port[t].http;return n="undefined"!==this.server_port[t][e]?this.server_port[t][e]:n}ngDomain+e},prepareCookieList:function(){var e=this.perm_ttl||this.perm_last;this.cookieList={shorta:{name:"_snrs_sa",last:this.short_last},shortb:{name:"_snrs_sb",last:this.short_last},perm:{name:"_snrs_p",last:e},uuid:{name:"_snrs_uuid",last:e},permUuid:{name:"_snrs_puuid",last:e}}},getCookieList:function(){return this.cookieList&&this.cookieList.length||this.prepareCookieList(),this.cookieList},manageCookies:function(t,n){var r=0;for(i in t)t.hasOwnProperty(i)&&r++;var i,o=this;for(i in t)t.hasOwnProperty(i)&&this.getCookie(t[i],function(e){void 0!==e&&e&&o.updateOpt(e),o.setCookie(t[i]),0===--r&&n()});o.setStartOpt()},setStartOpt:function(){var e=Math.round((new Date).getTime()/1e3);this.appear=this.appear||e,this.initial=this.initial||e,this.lastVisit=this.lastVisit||e,this.current=this.current||e,this.allVisits=this.allVisits||1,this.sessionVisits=this.sessionVisits||1,this.uniqueVisits=this.uniqueVisits||1},updateOpt:function(e){for(var t=e.split("&"),n={},e=(new Date).getTime()/1e3,r=0;r<t.length;r++){var i=t[r].split(":");n[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}n.hasOwnProperty("uuid")&&"undefined"!==n.uuid&&"null"!==n.uuid&&n.uuid&&(this.setUuid(n.uuid),n.hasOwnProperty("permUuid")||(this.permUuid=this.getUuid())),n.hasOwnProperty("permUuid")&&"undefined"!==n.permUuid&&"null"!==n.permUuid&&n.permUuid&&(this.permUuid=n.permUuid),n.hasOwnProperty("prevUuid")&&"undefined"!==n.prevUuid&&"null"!==n.prevUuid&&n.prevUuid&&(this.prevUuid=n.prevUuid),n.hasOwnProperty("identityHash")&&"undefined"!==n.identityHash&&"null"!==n.identityHash&&n.identityHash&&(this.identityHash=n.identityHash),n.hasOwnProperty("emailHash")&&"undefined"!==n.emailHash&&"null"!==n.emailHash&&n.emailHash&&(this.identityHash=n.emailHash),n.hasOwnProperty("appear")&&(this.appear=n.appear,this.pageTimeLast=Math.round(e-this.appear),n.hasOwnProperty("ssuid"))&&(this.singleSessUid=n.ssuid),n.hasOwnProperty("init")&&(this.initial=n.init),n.hasOwnProperty("last")&&(this.lastVisit=n.last,e-this.lastVisit>this.uniqueVisitTime?(this.lastVisit=e,n.hasOwnProperty("uniqueVisits")&&(this.uniqueVisits=++n.uniqueVisits)):n.hasOwnProperty("uniqueVisits")&&(this.uniqueVisits=n.uniqueVisits)),n.hasOwnProperty("sessionVisits")&&(this.sessionVisits=++n.sessionVisits),n.hasOwnProperty("allVisits")&&(this.allVisits=++n.allVisits),n.hasOwnProperty("init")&&(this.current=Math.round((new Date).getTime()/1e3))},storeData:function(e,t,n){void 0!==n&&n||(n=e+"_"+h.generateUUID());var r=this.getSavedData(e);return ie.save(n,JSON.stringify(t)),r[n]=n,ie.save(e,JSON.stringify(r)),n},removeStoredData:function(e,t){var n=this.getSavedData(e);ie.remove(t),delete n[t],ie.save(e,JSON.stringify(n))},resendStoredData:function(e,t){var n,r=this.getSavedData(e);if(r)for(var i in r)r.hasOwnProperty(i)&&(n=JSON.parse(ie.get(i)),L.log("SAVED DATA: "+i,n),!n||(void 0===n.__retried__&&(n.__retried__=1),L.log("RESEND DATA RETRY: "+n.__retried__),5<n.__retried__)?this.removeStoredData(e,i):(n.__retried__++,this.storeData(e,n,i),t(i,n)))},sleep:function(e){for(var t=(new Date).getTime();(new Date).getTime()<t+e;);},caughtForms:[],initFormCatch:function(e){e=void 0===e?document:e;var a=this,t=[];"form"===e.nodeName.toLowerCase()?t.push(e):t=e.getElementsByTagName("form");for(var n=0;n<t.length;n++)!function(i){var e,o,s=i.getAttribute("data-synerise");null!==s&&-1===a.caughtForms.indexOf(i)&&(""===s.replace(" ","")&&(s=a.formCatch.stdType),L.balloon("Binding to form: "+s,i),e=i.getAttribute("data-synerise-catch-mode")||a.formCatch.catchMode,L.log("Catch mode: "+e),o=i.onsubmit,i.onsubmit=function(e){L.log("Form on submit",e,this);var t,n,r=!0;"function"===(typeof o).toLowerCase()&&(r=o(e),L.log("Original submit returned:",r));try{!1===r?L.balloon("STOPPED FORM SUBMIT (ORIGINAL SUBMIT RETURNED FALSE)",i):(t=a.getFormData(i),(n=i.getAttribute("data-synerise"))&&(s=n),a.sendFormData.call(a,s,t.fields,t.fieldsMapping,t.skipAsAttributes))}catch(e){L.error("ERROR:",e)}return a.sleep(500),r},a.caughtForms.push(i))}(t[n])},getSavedForms:function(){return this.parseJson(ie.get(this.formCatch.storageKeyIndex))},gie.get(e))},sendForm:function(e){},setNewUUIDAndIdentityHash:function(e,t){L.log('Set new uuid and identityHash" '+e+" "+t+'"'),L.balloon("Identity hash has been changed !"),L.balloon('CHANGING UUID! "'+this.uuid+'" to "'+t+'"'),this.setUuid(t),this.setResetUuid(!0),this.identityHash=e;t=this.getCookieList();this.setCookie(t.perm)},checkIdentityHashExists:function(){return this.identityHash&&"null"!==this.identityHash&&"0"!==this.identityHash&&0!==this.identityHash},resetUUIDByIdentityHash:function(e){e&&(this.checkIdentityHashExists()&&(L.log('Saved identity hash: "'+this.identityHash+'"'),parseInt(e)!==parseInt(this.identityHash))&&(L.balloon("Identity hash has been changed !"),L.balloon('CHANGING UUID! "'+this.uuid+'" to "null"'),this.setUuid(null),this.setResetUuid(!0),this.restoreSessionCookies()),this.identityHash=e,e=this.getCookieList(),this.setCookie(e.perm))},restoreSessionCookies:function(){this.singleSessUid=h.generateUUID(),this.appear=Math.round((new Date).getTime()/1e3),this.lastVisit=0,this.pageTimeLast=0,this.sessionVisits=1,this.uniqueVisits=1,this.allVisits=1,this.sessionVisits=1;var e=this.getCookieList();this.setCookie(e.shorta),this.setCookie(e.shortb)},sendFormData:function(e,t,s,a,c){L.log("sendFormData",this,e,t,s,a);var u=this;return new Q(function(n,r){c=c||function(){},(s=void 0!==s&&s?s:u.formCatch.inputDataAttr)[u.identity]=s[u.identity]||u.formCatch.inputDataAttr[u.identity];var i,o={formType:e,formFieldsMapping:JSON.stringify(s),formData:JSON.stringify(t),formSkipAsAttributes:JSON.stringify(a),category:"client.web.browser.contact",action:"form.submit",label:e};i=t,new Q(function(n,e){if(void 0===i[s[u.identity]])return n(!1);w.requiresAuthorization(o.action).then(function(e){var t;return e?n(!1):(e=i[s[u.identity]],t=u.hashString(e),L.log('Generated hash "'+t+'" from "'+u.identity+" "+e+'"'),u.resetUUIDByIdentityHash(t),n(!0))})}).then(function(e){u.customStatParams=o;var t=u.storeData(u.formCatch.storageKeyIndex,u.mergeObjects(u.customStatParams,u.buildParamsForStat()));u.storeFormData(o,function(){c(u.uuid)}).then(function(){u.removeStoredData(u.formCatch.storageKeyIndex,t),n(u.uuid)}).catch(r),u.customStatParams=null})})(e.name,t)},setCookie:function(e){var t=this.buildSForCookie(e.name),n=new Date,n=(n.setTime(n.getTime()+1e3*e.last),n.toGMTString());return re.set(e.name,t,n)},rve(e.name)},checkUserHash:function(){var e={name:this.ushash},t=this;this.getCookie(e,function(e){e&&(t.ushashValue=e)})},setTracker:function(e){this.trackerUID=e},setCustomPageVisit:function(e){this.customPageVisit=e},setCustomizeMetadata:function(e){this.customizeMetadata=e},setCookieExpiration:function(e){this.perm_ttl=24*e*60*60s.domain=e},aAttr[e]=e},setCampaign:function(e){this.campaignUID=e},setGAnalyticsCode:function(e){this.gACode=e},sroductId=e},collect:function(){this.screen=this.getScreenInfo(),this.ref=this.getReferrer();var e=this.getOsInfo();return!1!==e&&(this.os=e),this.user=this.getUserInfo(),!1this.os.os}t}return t},buildSForCookie:function(e){var t,n=[],r=[];if(r[this.cookieList.shorta.name]={ssuid:this.singleSessUid,appear:this.appear,sessionVisits:this.sessionVisits},r[this.cookieList.shortb.name]={ssuid:this.singleSessUid,leaves:Math.round((new Date).getTime()/1e3)},r[this.cookieList.perm.name]={host:this.user.hostn,permUuid:this.permUuid,uuid:this.uuid,identityHash:this.identityHash,user_hash:this.ushashValue,init:this.initial,last:this.lastVisit,current:this.current,uniqueVisits:this.uniqueVisits,allVisits:this.allVisits},this.prevUuid&&(r[this.cookieList.perm.name].prevUuid=this.prevUuid),r[this.cookieList.uuid.name]=this.uuid,r[this.cookieList.permUuid.name]=this.permUuid,"string"===(typeof r[e]).toLowerCase())return r[e];for(t in r[e])r[e].hasOwnProperty(t)&&n.push(encodeURIComponent(t)+":"+encodeURIComponent(r[e][t]));return n.join("&")},buildSForStat:function(e){return function e(t,n){var r=[];for(var i in t){var o,s;t.hasOwnProperty(i)&&i&&(o=n?n+"["+i+"]":i,s=t[i],i.trim())&&r.push("object"==typeof s&&s?e(s,o):encodeURIComponent(o)+"="+encodeURIComponent(s))}return r.join("&")}(this.buildParamsForStat(e))},buildParamsForStat:function(e){var t,n,r,i,o,s,a=Math.round((new Date).getTime()/1e3),c=b?b.getFullVersion()+":"+b.getBuildTime():null,u={uuid:this.getUuid(),ssuid:this.singleSessUid,user_hash:this.ushashValue,identity:this.identity,identityHash:this.identityHash,tck:this.trackerUID,campaign:this.user.campaign,host:this.user.hostn,location:this.user.loc,title:this.user.ptitle,ver:this.user.ver,color:this.screen.color,encoding:this.screen.encoding,lang:this.screen.language,res:this.screen.resolution,refdomain:this.ref.domain,ref:this.ref.ref,browser:this.os.browser,browserver:this.os.browserVersion,ecookies:this.os.cookies,os:this.os.os,osver:this.os.osVersion,init:a,last:this.lastVisit,current:a,long:this.pageTimeLast,visits:this.allVisits,s_visits:this.sessionVisits,u24_visits:this.uniqueVisits,productRef:this.productId,eventUUID:h.generateUUID(),snr_sdk_version:c},l=(this.user.uriHash&&(u.uriHash=this.user.uriHash),u.uuid&&null!=u.uuid||delete u.uuid,this.perm_ttl&&(u["x-snr-cookie-ttl-sec"]=this.perm_ttl),this.getResetUuid()&&(u.resetUuid=this.getResetUuid(),void 0!==this.resetCookieMatchers)&&this.resetCookieMatchers(),this.appendOgTags(u),this.customStatParams&&(u.params=this.customStatParams),u.params&&"string"!==(typeof u.params).toLowerCase()&&(u.params=JSON.stringify(u.params)),this.getSnrsUrlParams());for(t in L.balloon("SnrsUrlParams: "+JSON.stringify(l)),this.trackerSpecialParams)this.trackerSpecialParams.hasOwnProperty(t)&&(o=!(i=r=n=null),!function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r,i=t[n],o=!1;for(r in e)if(e.hasOwnProperty(r)){var s=e[r];if(r.match(n)&&s.match(i)){o=!0;break}}if(!o)return!1}return!0}(l,(s=this.trackerSpecialParams[t]).requiredParams)?L.log('Special params in url failed for "'+t+'". For parameters: ',l,s.requiredParams):((o="function"==typeof s.processStatParams?!1!==s.processStatParams(u,l):o)&&(void 0!==s.category&&s.category&&(n=s.category),void 0!==s.action&&s.action&&(r=s.action),void 0!==s.label?i=s.label:void 0!==s.labelFromParam&&(i=l[s.labelFromParam])),L.log('Processing "'+t+'" special params. Result: '+n+" / "+r+" / "+i),n&&(u.category=n),r&&(u.action=r),i&&(u.label=i)));if(this.identityHash&&(u.identityHash=this.identityHash),this.getOldUuid()&&(u.oldUuid=this.getOldUuid()),void 0!==e&&e)for(var d in e)e.hasOwnProperty(d)&&(u[d]=e[d]);return u},getSnrsUrlParams:function(){var e,t,n={},r=document.location.search.split("&");for(e in r)r.hasOwnProperty(e)&&(t=r[e],t=new RegExp(/(\?|&)?((snrs?|utm)_[^=\?&]+)=([^=&\?]*)/gi).exec(t))&&5===t.length&&(n[t[2]]=t[4]);return n},appendOgTags:function(e){var t=this.getOgTag();0!=Object.keys(t).length?(e.ogTags=JSON.stringify(t),L.log("Adding og tags: "+e.ogTags)):L.log("No og tags in document"),delete t},getOnlyPrimitivePairsWithLimit:function(e){var t,n={},r=0;for(t in e)if(e.hasOwnProperty(t)){var i=e[t];if("object"==typeof i&&null!==i&&!Array.isArray(i)||(n[t]=i,r++),20<=r)break}return n},getOgTag:function(){for(var e,t={},n={"product:category":"array"},r=new RegExp("og:("+["title","url","type","site_name","image","category"].join("|")+")|product:.+","i"),i=document.getElementsByTagName("meta"),o=0;o<i.length;o++){var s,a=i[o];a.getAttribute("property")&&(s=a.getAttribute("property"),r.test(s))&&(a=a.getAttribute("content"),void 0!==n[s]?"array"===n[s]&&(void 0===t[s]&&(t[s]=[]),t[s].push(a)):void 0===t[s]&&(t[s]=a))}return t="function"!=typeof this.customizeMetadata||"object"!=typeof(e=this.customizeMetadata(t))||null===e||Array.isArray(e)?t:this.getOnlyPrimitivePairsWithLimit(e)},getScreenInfo:function(){var e,t=null,n=null,r=null,i=null;return screen?(t=screen.width+"x"+screen.height,n=screen.colorDepth+"-bit"):java&&(t=(e=java.awt.Toolkit.getDefaultToolkit().getScreenSize()).width+"x"+e.height),navigator.language?r=navigator.language.toLowerCase():navigator.browserLanguage&&(r=navigator.browserLanguage.toLowerCase()),document.characterSet?i=this.encodeString(document.characterSet):document.charset&&(i=this.encodeString(document.charset)),{encoding:i,resolution:t,color:n,language:r}},parseJson:function(t){var e={};if("string"===(typeof t).toLowerCase())try{e=JSON.parse(t)}catch(e){L.balloon("parseJson - Wrong JSON format! :: "+t)}else e={};return e},getOsInfo:function(){return u.getOsInfo()},getUserInfo:function(){var e=document.location.pathname+document.location.search,e={ver:this.ver,campaign:this.campaignUID,ptitle:this.encodeString(document.title),hostn:this.encodeString(document.location.hostname),loc:e};return location.hash&&(e.uriHash=location.hash),e},getReferrer:function(){var e,t,n=document.referrer,r=0;return"0"==n||""==n||"-"==n||(e=n.indexOf("://"))<0?{domain:"",ref:""}:(t="",-1<(n=n.substring(e+3,n.length)).indexOf("/")&&(-1<(t=n.substring(n.indexOf("/"),n.length)).indexOf("?")&&(t=t.substring(0,t.indexOf("?"))),n=n.substring(0,n.indexOf("/"))),-1<(e=(r=n=n.toLowerCase()).indexOf(":"))&&(r=r.substring(0,e)),0===n.indexOf("www.")&&(n=n.substring(4,n.length)),{domain:this.encodeChar(n,null),ref:this.encodeChar(t,null)})},setGATracker:function(){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.innerText="ga('set', '&uid', '"+this.uuid+"');ga('set', 'dimension1', '"+this.uuid+"'); ga('send', 'pageview');",document.body.appendChild(e)},getFormData:function(e,t){var n={fieldsMapping:{},fields:{},skipAsAttributes:[]};if(e&&"form"===e.nodeName.toLowerCase()){var r,i,o="",s=e.getAttribute("data-synerise-catch-mode")||this.formCatch.catchMode;for(L.log("Catch mode: "+s),r=e.elements.length-1;0<=r;r-=1){var a,c=(a=e.elements[r]).name,u=a.getAttribute("data-synerise");if(u!==this.formCatch.inputDataAttr.skip)if("all"!==s&&null===u)L.log('Skipped field: "'+c+'" - "data-synerise" attribute is not defined');else{if(u===this.formCatch.inputDataAttr.skipAsAttribute&&(n.skipAsAttributes.push(c),u=null),""===c){if(!u)continue;c=u}if(-1!==this.formCatch.skipFields.indexOf(c))L.log("Skipped field: "+c);else{o="";var l,d=a.getAttribute("data-synerise-value");switch(null!=d?o=d:void 0!==a.value&&(o=a.value),!0===t&&(o=this.encodeString(o)),a.nodeName.toUpperCase()){case"INPUT":switch(void 0!==u&&u&&(n.fieldsMapping[u]=c),a.type){case"password":case"reset":break;case"text":case"hidden":case"button":case"submit":n.fields[c]=o;break;case"checkbox":case"radio":a.checked&&(n.fields[c]=o);break;case"file":break;default:n.fields[c]=o}break;case"TEXTAREA":u!=c&&(p.setEnabled(!0),g.fatal("getFormData:formElement::TEXTAREA "+JSON.stringify({"data-synerise":u,name:c}))),n.fields[c]=o;break;case"SELECT":switch(a.type){case"select-one":u!=c&&(p.setEnabled(!0),g.fatal("getFormData:formElement:select-one::SELECT "+JSON.stringify({"data-synerise":u,name:c}))),n.fields[c]=o;break;case"select-multiple":for(u!=c&&(p.setEnabled(!0),g.fatal("getFormData:formElement:select-multiple::SELECT "+JSON.stringify({"data-synerise":u,name:c}))),i=a.options.length-1;0<=i;i-=1)a.options[i].selected&&(o=null!=(l=a.options[i].getAttribute("data-synerise-value"))?l:a.options[i].value,!0===t&&(o=this.encodeString(o)),n.fields[c]=o)}break;case"BUTTON":switch(a.type){case"submit":case"button":n.fields[c]=o}}}}}}return n},domObject:{getClassList:function(e){if(void 0!==e.className)return e.className.split(" ")},hasClass:function(e,t){for(var n=this.getClassList(e),r=0;r<n.length;r++)if(n[r]===t)return!0;return!1}},appendJS:function(e,t){oe.get(e),L.balloon("JS Loading: "+e);function n(e,t){return!!(e=document.getElementsByTagName(e)).length&&((e=e[0]).appendChild(t),!0)}var r=document.createElement("script");r.onload=function(){L.balloon("JS Loaded: "+e+" in "+oe.get(e).getElapsedTimeString()),t&&t()},r.src=e;n("head",r)||n("body",r)||n("html",r)},encodeString:function(e,t){return("function"==typeof encodeURIComponent?t?encodeURI:encodeURIComponent:escape)(e)},encodeChar:function(e){var t="";if(!e||""===e)return"";for(var n=0;n<e.length;n++)" "===e.charAt(n)?t+="+":t+=e.charAt(n);return t},executeCallbacks:function(e,t){if(t=void 0===t?[this]:t,!e||!e.length)return!1;for(var n in e)e.hasOwnProperty(n)&&"function"===(typeof(n=e[n])).toLowerCase()&&n.apply(this,n,t)},store:function(o,s,a){var c=this;return new Q(function(t,n){var r,e,i;s="function"===(typeof s).toLowerCase()?s:function(){},c.isCrawler()?(L.warning("Prevented store - crawler detected"),s.apply(c,s,[c])):(o=o||{},a=c.parseDataType(a),r=oe.get("store_"+a),e=c.buildSForStat(o),i=c.prepareUrl("/"+c.trackerUID+".gif?"+e),new Q(function(t,e){if(o.action===f||!o.action)return t(null);w.requiresAuthorization(o.action).then(function(e){if(!e)return t(null);e=d.getAccessToken();t(e?{Authorization:"Bearer "+e}:null)})}).then(function(e){se.get(i,function(e){return 200===e.status?(c.setResetUuid(!1),(e=e.getResponseHeader("Client-UUID"))&&"null"!==e.toLowerCase()&&(L.balloon("GOT Client-UUID IN HEADER FROM tck: `"+e+"` !"),h.validateUUID(e)||(e=h.generateUUID()),c.setUuid(e,!0)),r.log(),s.apply(c,s,[c]),t()):(L.error("XHR - ERROR LOADING PIX !!!"),c.getUuid()&&"null"!=c.getUuid().toLowerCase()||(e=h.generateUUID(),L.balloon("UUID is NULL SET NEW UUID: `"+e+"` !"),c.setUuid(e,!0),s.apply(c,s,[c])),n(new Error("Network request failed")))},e)}))})},storeTraffic:function(n,r){return new Q(function(e,t){SyneriseTC.store(n,r,SyneriseTC.dataType.traffic).then(e).catch(t)})},storeFormData:function(n,r){return new Q(function(e,t){SyneriseTC.store(n,r,SyneriseTC.dataType.formData).then(e).catch(t)})},pageVisit:function(r){var i=this;return new Q(function(t,n){i.ready(function(){i.checkExternalCookies(function(){L.log("custom page visit with data: ",r),i.collect();var e=i.storeData(i.trafficStorageKeyIndex,i.buildParamsForStat());i.storeTraffic(r,function(){i.removeStoredData(i.trafficStorageKeyIndex,e)}).then(t).catch(n)})})})}},"undefined"!=typeof CookieMatchers&&(SyneriseTC.initCookieMatchers=CookieMatchers.initCookieMatchers.bind(CookieMatchers),SyneriseTC.resetCookieMatchers=CookieMatchers.resetCookieMatchers.bind(CookieMatchers),SyneriseTC.initCookieMatching=CookieMatchers.initCookieMatching.bind(CookieMatchers),SyneriseTC.setCookieMatchersPromise=CookieMatchers.setCookieMatchersPromise.bind(CookieMatchers),SyneriseTC.getCookieMatchersPromise=CookieMatchers.getCookieMatchersPromise.bind(CookieMatchers)),{isAvailable:function(){if("undefined"!=typeof Storage&&"undefined"!=typeof localStorage)try{return localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage"),!0}catch(e){}return L.log("Local storage isn't available"),!1},save:function(e,t){return!!this.isAvailable()&&(L.log('LocalStorage - SAVE: "'+e+'" with value: "'+t+'"'),localStorage[e]=t,!0)},get:function(e){var t;return!!this.isAvailable()&&(t=void 0!==localStorage[e]?localStorage[e]:null,L.log('LocalStorage - GET: "'+e+'" with value: "'+t+'"'),t)},remove:function(e){return!!this.isAvailable()&&(void 0!==localStorage[e]&&delete localStorage[e],L.log('LocalStorage - Remove: "'+e+'"'),!0)}}),L={debug:!1,target:"console",boxObject:null,balloonObject:null,balloonTimeout:null,setDebugLevel:function(){this.debug=document.location.href.match(/SYNERISETC_DEBUG=?(box|console)?/i),this.debug&&this.debug.length&&void 0!==this.debug[1]&&this.debug[1]&&(this.target=this.debug[1].toLowerCase())},_write:function(e,t){if(this.debug&&"undefined"!=typeof console){for(var n in t)if(t.hasOwnProperty(n)&&n instanceof Error){e="error";break}var r=oe.get().getElapsedTimeString();"console"===this.target?(void 0===console[e]&&(e="info"),console[e]("SyneriseTC ["+r+"]",t)):"box"===this.target&&this.boxLogger(e,r,t)}else this._write=function(){}},balloon:function(){if(!this.debug)return!1;this.balloonObject||(this.balloonObject=document.createElement("div"),this.balloonObject.tabindex="0",this.balloonObject.style="position: fixed; bottom: 0px; right: 0px; z-index: 999999; background: #EEE; color: #000; border: 1px solid #F00; padding: 5px 5px; font-family: monospace; white-space: pre;");var e,t,n=document.createElement("li"),r=(n.style="border-bottom: 1px solid #ddd; padding: 2px 5px;",[]);for(e in arguments)!arguments.hasOwnProperty(e)||arguments[e]instanceof HTMLElement||(t="",isNaN(e)&&(t+=e+": "),r.push(t+=arguments[e]));n.innerHTML=r.join(" &#9483; ");function i(){s.balloonTimeout&&clearTimeout(s.balloonTimeout),s.balloonTimeoutbject=null},15e3)}var o=document.createElement("ul"),s=(o.appendChild(n),this.balloonObject.appendChild(o),this);this.balloonObject.onmouseover=function(){clearTimeout(s.balloonTimeout)},this.balloonObject.onmouseout=i,document.body.appendChild(this.balloonObject),i(),this._write("log",arguments)},log:function(){this._write("log",arguments)},error:function(){this.balloon.apply(this,arguments),this._write("error",argumentarguments)},boxLogger:function(e,t,n){this.boxObject||(this.boxObject=document.createElement("div"),this.boxObject.id="SYNERISE_TC_LOGGER_BOX",this.boxObject.style.position="fixed",this.boxObject.style.bottom="0px",this.boxObject.style.right="0px",this.boxObject.style.width="98%",this.boxObject.style.height="50%",this.boxObject.style.padding="5px 10px",this.boxObject.style.margin="0 auto",this.boxObject.style.overflowY="auto",this.boxObject.style.wordWrap="break-word",this.boxObject.style.background="lightsteelblue",this.boxObject.style.color="black",this.boxObject.style.fontSize="1.2em",this.boxObject.style.fontWeight="bold",this.boxObject.style.lineHeight="1.5em",document.body.appendChild(this.boxObject));var r,i="#000";for(r in"error"===e.toLowerCase()&&(i="#F00"),this.boxObject.innerHTML+='<div style="font-size: 0.8em; font-weight: normal;">--- '+t+"</div>",n)n.hasOwnProperty(r)&&(this.boxObject.innerHTML+='<div style="color: '+i+';">'+n[r]+"</div>")}},oe={objects:[],_timerObject:function(e){this.label=e,this.time=(new Date).getTime(),this.getLabel=function(){return this.label},this.get-this.time},this.getElapseme()+" ms.log(this)}},create:function(e){var t=new this._timerObject(e);return this.objects[e]=t},get:function(e){return void 0===this.objects[e=void 0!==e&&e?e:"__main__"]&&(this.objects[e]=new this._timerObject(e)),this.objeeString())}},se={get:function(e,t,n){return this._request("GET",e,{},t,n)},post:function(e,t,n,r,i){return void 0===i&&(i="application/x-www-form-urlencoded"),L.log("XHR POST DATA: "+t),this._request("POST",e,t,n,r,i)},_request:function(e,t,n,r,i,o){oe.get(t);var s,a=new XMLHttpRequest;if(a.open(e,t,!0),a.withCredentials=!0,a.timeout=5e3,se.ontimeout=function(e){L.error("XHR Timeout!!",e)},void 0!==i)for(var c in i)i.hasOwnProperty(c)&&(s=i[c],a.setRequestHeader(c,s));o&&a.setRequestHeader("Content-type",o),L.log('XHR Requesting "'+t+'" using method "'+e+'"'),a.onreadystatechange=function(){4===a.readyState&&(L.log('XHR Request Finished "'+t+'" in '+oe.get(t).getElapsedTimeString()),r(a))},a.send(n)}},t=!1;if("undefined"!=typeof _riseA&&_riseA.length?t=_riseA:void 0!==$._riseA&&$._riseA.length?t=$._riseA:(L.setDebugLevel(),L.warning('WARNING: "_riseA" is undefined or empty')),t)try{SyneriseTC.init(t)}catch(e){L.setDebugLevel(),L.error("ERROR:",e)}}function ae(t,n){try{if(n.log("createHashChangeHandler"),"onhashchange"in t){if(t.addEventListener)return n.log("createHashChangeHandler created by addEventListener"),{addHashChangeCallback:function(e){t.addEventListener("hashchange",e)},removeHashChangeCallback:function(e){t.removeEventListener("hashchange",e)}};if(t.attachEvent)return n.log("createHashChangeHandler created by attachEvent"),{addHashChangeCallback:function(e){t.attachEvent("onhashchange",e)},removeHashChangeCallback:function(e){t.detachEvent("onhashchange",e)}}}return n.log("createHashChangeHandler unsupported"),{addHashChangeCallback:function(){},removeHashChangeCallback:function(){}}}catch(e){return n.error("createHashChangeHandler error occurred",e),{addHashChangeCallback:function(){},removeHashChangeCallback:function(){}}}}function ce(t,e,a){function n(){a.log("page handler - collect data"),t.collect();var e=t.storeData(t.trafficStorageKeyIndex,t.buildParamsForStat());t.storeyIndex,e)})}function c(e){tryay",e),n()},200)}catch(e){a.log("page handler - history handler error",e)}}return{attachHistoryHandler:function(){var t,n,r,i,o,s;a.log("page handler - attachHistoryHandler"),n=a,r=(t=e).pushState,t.pushState=function(e){return"function"==typeof t.onpushstate&&t.onpushstate({state:e}),n.log("page handler - history handler pushState triggered",e),c(e),r.apply(t,arguments)},o=a,s=(i=e).replaceState,i.replaceState=function(e){return"function"==typeof i.onreplacestate&&i.onreplacestate({state:e}),o.log("page handler - history handler replaceState triggered",e),c(e),s.apply(i,arguments)}},attachHashHandler:function(e){a.log("page handler - attachHashHandler"),e.addHashChangeCallback(function(e){a.log("page handler - hash handler change triggered",e),n()})}}}}(window,void 0);