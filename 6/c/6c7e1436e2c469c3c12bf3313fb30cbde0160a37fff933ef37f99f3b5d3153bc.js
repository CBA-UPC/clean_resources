"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([[3638],{82037:function(e,t,r){r.r(t),r.d(t,{AAC_PROFILE:function(){return lA},AudioMixingDualMonoMode:function(){return f5},AudioMixingType:function(){return f4},AudioProfileType:function(){return lI},AudioSourceType:function(){return ln},ChannelProfile:function(){return lo},ConnectionState:function(){return lp},FallbackOrRecoverReason:function(){return lT},ForwardStreamError:function(){return lN},ForwardStreamState:function(){return lO},LogChannel:function(){return lf},MediaType:function(){return lh},MirrorMode:function(){return lu},MirrorType:function(){return lv},NetworkQuality:function(){return lE},PublicInterpolationMode:function(){return ly},PublicStreamType:function(){return lg},PublishState:function(){return lc},RTCAutoPlayPolicy:function(){return lR},RemoteUserPriority:function(){return lb},RoomProfileType:function(){return lk},SUBTITLE_MODE:function(){return lw},StreamIndex:function(){return ll},StreamRemoveReason:function(){return l_},SubscribeFallbackOption:function(){return lS},SubscribeMode:function(){return la},SubscribeState:function(){return ls},SubtitleEventType:function(){return lx},TRANSCODING_VIDEO_CODEC:function(){return lC},USER_ONLINE_STATUS:function(){return lm},UserOfflineReason:function(){return li},VideoRenderMode:function(){return ld},VideoSourceType:function(){return lr},default:function(){return IQ}}),e=r.hmd(e);var n,i,o,a,s,c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},u={exports:{}},d=l=d("object"==typeof globalThis&&globalThis)||d("object"==typeof window&&window)||d("object"==typeof self&&self)||d("object"==typeof c&&c)||function(){return this}()||Function("return this")(),h=_=!h(,p=Function.prototype,v=p.apply,f=p.call,m="object"==typeof Reflect&&Reflect.apply||(_?f.bind(v):function(){return f.apply(v,arguments)}),g=Function.prototype,y=g.call,S=_&&g.bind.bind(y,y),b=_?S:E=b({}.toString),T=b("".slice),k=I=R="object"==typeof document&&document.all,A={all:R,IS_HTMLDDA:void 0===R&&void 0!==R},C=A.all,w=A.IS_HTMLDDA?function(e){return"function"==typeof e},x={},O=!h(,N=Function.prototype.call,P=_?N.bind(N):function(){return N.apply(N,arguments)},D={},M={}.propertyIsEnumerable,L=Object.getOwnPropertyDescriptor,U=L&&!M.call({1:2},1);D.f=U?M;var V,F,B=j=Object,G=I("".split),H=h(?j,z=K=TypeError,X=W=function(e){return H(X(e))},q=A.all,Y=A.IS_HTMLDDA?J={},Q=Z=$=I({}.isPrototypeOf),ee=Z("navigator","userAgent")||"",et=l.process,er=l.Deno,en=et&&et.versions||er&&er.version,ei=en&&en.v8;ei&&(F=(V=ei.split("."))[0]>0&&V[0]<4?1:+(V[0]+V[1])),!F&&ee&&(!(V=ee.match(/Edge\/(\d+)/))||V[1]>=74)&&(V=ee.match(/Chrome\/(\d+)/))&&(F=+V[1]);var eo=F,ea=!!Object.getOwnPropertySymbols&&!h(,es=ea&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ec=Object,eu=es?function(e){return"symbol"==typeof e}:ed=String,el=eh=TypeError,e_=function(e){if(w(e))return e;throw eh(el(e)+" is not a function")},ep=ev=TypeError,ef={exports:{}},em=Object.defineProperty,eg="__core-js_shared__",ey=l[eg]||eg,{});(ef.exports=("versions",[]).push({version:"3.26.0",mode:"pure",copyright:"\xa9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"});var eS=Object,eb=function(e){return eS(X(e))},eE=I({}.hasOwnProperty),eT=Object.hasOwn||function(e,t){return eE(eb(e),t)},ek=0,eI=Math.random(),eR=I(1..toString),eA=eC=(0,ef.exports)("wks"),ew=l.Symbol,ex=ew&&ew.for,eO=es?ew:ew&&ew.withoutSetter||eA,eN=eP=eD=TypeError,eM=eN("toPrimitive"),eL=eU=eV=l.document,eF=Y(eV)&&Y(eV.createElement),eB=ej=!O&&!h(,eG=Object.getOwnPropertyDescriptor;x.f=O?eG:var eH=/#|\.prototype\./,ez=eK=ez.normalize=eX=ez.data={},eW=ez.NATIVE="N",eq=ez.POLYFILL="P",eY=I(I.bind),eJ=eQ={},eZ=O&&h(,e$=String,e0=TypeError,e1=function(e){if(Y(e))return e;throw e0(e$(e)+" is not an object")},e2=TypeError,e3=Object.defineProperty,e5=Object.getOwnPropertyDescriptor,e4="enumerable",e6="configurable",e8="writable";eQ.f=O?eZ?e3:var e7=O?e9=x.f,te=tt=tr=eQ.f;tt({target:"Object",stat:!0,forced:Object.defineProperty!==tr,sham:!O},{defineProperty:tr});var tn=J.Object,ti=u.exports=tn.defineProperty.sham&&(ti.sham=!0);var to=u.exports,ta=Array.isArray||ts=Math.ceil,tc=Math.floor,tu=Math.trunc||td=tl=Math.min,th=t_=tp=TypeError,tv=tf=tm=eN("toStringTag"),tg={};tg[tm]="z";var ty="[object z]"===String(tg),tS=eN("toStringTag"),tb=Object,tE="Arguments"==k(function(){return arguments}()),tT=tk=ty?k:tI=I(Function.toString);w(ey.inspectSource)||(ey.inspectSource=function(e){return tI(e)});var tR=ey.inspectSource,tA=function(){},tC=[],tw=Z("Reflect","construct"),tx=/^\s*(?:class|function)\b/,tO=I(tx.exec),tN=!tx.exec(tA),tP=tD=tD.sham=!0;var tM=!tw||h(?tD:tP,tL=eN("species"),tU=Array,tV=tF=tB=eN("species"),tj=tG=eN("isConcatSpreadable"),tH=eo>=51||!h(,tz=tj("concat"),tK=tt({target:"Array",proto:!0,arity:1,forced:!tH||!tz},{concat:function(e){var t,r,n,i,o,a=eb(this),s=tF(a,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(tK(o=-1===t?a:arguments[t]))for(tv(c+(i=t_(o))),r=0;r<i;r++,c++)r in o&&tf(s,c,o[r]);else tv(c+1),tf(s,c++,o);return s.length=c,s}});var tX=String,tW=tq={},tY=Math.max,tJ=Math.min,tQ=tZ=t$={includes:tZ(!0),indexOf:tZ(!1)},t0={},t1=t$.indexOf,t2=I([].push),t3=t5=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],t4=Object.keys||function(e){return t3(e,t5)};tq.f=O&&!eZ?Object.defineProperties:var t6,t8=Z("document","documentElement"),t7=(0,ef.exports)("keys"),t9=re="prototype",rt="script",rr=t9("IE_PROTO"),rn=function(){},ri=ro=ra=rs=t0[rr]=!0;var rc=Object.create||ru={},rd=t5.concat("length","prototype");ru.f=Object.getOwnPropertyNames||function(e){return t3(e,rd)};var rl={},rh=Array,r_=Math.max,rp=rv=ru.f,rf="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],rm=rl.f=var rg={};rg.f=Object.getOwnPropertySymbols;var ry=rS={};rS.f=eN;var rb,rE,rT,rk=eQ.f,rI=rR=rA=eQ.f,rC=ty?({}).toString:rw=eN("toStringTag"),rx=rO=l.WeakMap,rN=w(rO)&&/native code/.test(String(rO)),rP="Object already initialized",rD=l.TypeError,rM=l.WeakMap;if(rN||ey.state){var rL=ey.state||(ey.state=new rM);rL.get=rL.get,rL.has=rL.has,rL.set=rL.set,rb=rE=rT=function(e){return rL.has(e)}}else{var rU=t9("state");t0[rU]=!0,rb=rE=rT=function(e){return eT(e,rU)}}var rV={set:rb,get:rE,has:rT,enforce:getterFor:,rF=I([].push),rB=rj={forEach:rB(0),map:rB(1),filter:rB(2),some:rB(3),every:rB(4),find:rB(5),findIndex:rB(6),filterReject:rB(7)},rG=ef.exports,rH=rj.forEach,rz=t9("hidden"),rK="Symbol",rX="prototype",rW=rV.set,rq=rV.getterFor(rK),rY=Object[rX],rJ=l.Symbol,rQ=rJ&&rJ[rX],rZ=l.TypeError,r$=l.QObject,r0=x.f,r1=eQ.f,r2=rl.f,r3=D.f,r5=I([].push),r4=rG("symbols"),r6=rG("op-symbols"),r8=rG("wks"),r7=!r$||!r$[rX]||!r$[rX].findChild,r9=O&&h(?r1,ne=nt=nr=function(e,t){e1(e);var r=W(t);return rH(t4(r).concat(na(r)),,e},nn=ni=no=na=ea||(ry(rQ=(rJ=[rX],"toString",function(){return rq(this).tag}),ry(rJ,"withoutSetter",function(e){return ne(eA(e),e)}),D.f=nn,eQ.f=nt,tq.f=nr,x.f=ni,ru.f=rl.f=no,rg.f=na,rS.f=O&&r1(rQ,"description",{configurable:!0,get:function(){return rq(this).description}})),tt({global:!0,constructor:!0,wrap:!0,forced:!ea,sham:!ea},{Symbol:rJ}),rH(t4(r8),function(e){rI(e)}),tt({target:rK,stat:!0,forced:!ea},{useSetter:function(){r7=!0},useSimple:function(){r7=!1}}),tt({target:"Object",stat:!0,forced:!ea,sham:!O},{create:defineProperty:nt,defineProperties:nr,getOwnPropertyDescriptor:ni}),tt({target:"Object",stat:!0,forced:!ea},{getOwnPropertyNames:no}),rR(),rx(rJ,rK),t0[rz]=!0;var ns=ea&&!!Symbol.for&&!!Symbol.keyFor,nc=ef.exports,nu=nc("string-to-symbol-registry"),nd=nc("symbol-to-string-registry");tt({target:"Symbol",stat:!0,forced:!ns},{for:);var nl=(0,ef.exports)("symbol-to-string-registry");tt({target:"Symbol",stat:!0,forced:!ns},{keyFor:);var nh=I([].slice),n_=Z("JSON","stringify"),np=I(/./.exec),nv=I("".charAt),nf=I("".charCodeAt),nm=I("".replace),ng=I(1..toString),ny=/[\uD800-\uDFFF]/g,nS=/^[\uD800-\uDBFF]$/,nb=/^[\uDC00-\uDFFF]$/,nE=!ea||h(,nT=h(,nk=nI=n_&&tt({target:"JSON",stat:!0,arity:3,forced:nE||nT},{stringify:),tt({target:"Object",stat:!0,forced:!ea||h(function(){rg.f(1)})},{getOwnPropertySymbols:),rI("asyncIterator"),rI("hasInstance"),rI("isConcatSpreadable"),rI("iterator"),rI("match"),rI("matchAll"),rI("replace"),rI("search"),rI("species"),rI("split"),rI("toPrimitive"),rR(),rI("toStringTag"),rx(Z("Symbol"),"Symbol"),rI("unscopables"),rx(l.JSON,"JSON",!0);var nR,nA,nC,nw=J.Symbol,nx={},nO=Function.prototype,nN=O&&Object.getOwnPropertyDescriptor,nP=eT(nO,"name"),nD=nP&&(!O||O&&nN(nO,"name").configurable),nM={PROPER:nP&&"something"===(function(){}).name,CONFIGURABLE:nD},nL=!h(,nU=t9("IE_PROTO"),nV=Object,nF=nV.prototype,nB=nL?nV.getPrototypeOf:nj=eN("iterator"),nG=!1;[].keys&&("next"in(nC=[].keys())?(nA=nB(nB(nC)))!==Object.prototype&&(nR=nA):nG=!0),w((nR=!Y(nR)||h(?{}:rc(nR))[nj])||ry(nR,nj,function(){return this});var nH={IteratorPrototype:nR,BUGGY_SAFARI_ITERATORS:nG},nz=nH.IteratorPrototype,nK=function(){return this},nX=nW=String,nq=TypeError,nY=nJ=Object.setPrototypeOf||("__proto__"in{}?):void 0),nQ=nM.PROPER;nM.CONFIGURABLE,nH.IteratorPrototype;var nZ=nH.BUGGY_SAFARI_ITERATORS,n$=eN("iterator"),n0="keys",n1="values",n2="entries",n3=function(){return this},n5=function(e,t,r,n,i,o,a){nX(r,t,n);var s,c,u,d=l=t+" Iterator",h=!1,_=e.prototype,p=_[n$]||_["@@iterator"]||i&&_[i],v=!nZ&&p||d(i),f="Array"==t&&_.entries||p;if(f&&(s=nB(f.call(new e)))!==Object.prototype&&s.next&&(rx(s,l,!0,!0),nx[l]=n3),nQ&&i==n1&&p&&p.name!==n1&&(h=!0,v=,i){if(c={values:d(n1),keys:o?v:d(n0),entries:d(n2)},a)for(u in c)!nZ&&!h&&u in _||ry(_,u,c[u]);else tt({target:t,proto:!0,forced:nZ||h},c)}return a&&_[n$]!==v&&ry(_,n$,v,{name:i}),nx[t]=v,c},n4=n6=function(){},n8=(eQ.f,"Array Iterator"),n7=rV.set,n9=rV.getterFor(n8);n5(Array,"Array","values"),nx.Arguments=nx.Array,n6(),n6(),n6();var ie={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},it=eN("toStringTag");for(var ir in ie){var ii=l[ir],io=ii&&ii.prototype;io&&tk(io)!==it&&e7(io,it,ir),nx[ir]=nx.Array}rI("asyncDispose"),rI("dispose"),rI("matcher"),rI("metadataKey"),rI("observable"),rI("metadata"),rI("patternMatch"),rI("replaceAll");var ia=I("".charAt),is=I("".charCodeAt),ic=I("".slice),iu=id={codeAt:iu(!1),charAt:iu(!0)},il=id.charAt,ih="String Iterator",i_=rV.set,ip=rV.getterFor(ih);n5(String,"String",;var iv=rS.f("iterator");ar ig=rS.f("toPrimitive");function iy(e){var t=function(e,t){if("object"!==im(e)||null===e)return e;var r=e[ig];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==im(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===im(t)?t:String(t)}target:"Object",stat:!0,sham:!O},{create:rc});var ik=J.Object,iI=function(e,t){return ik.create(e,t)};tt({target:"Object",stat:!0,forced:h(function(){nB(1)}),sham:!nL},{getPrototypeOf:function(e){return nB(eb(e))}});var iR=J.Object.getPrototypeOf,iA=iC=rj.forEach,iw=iA("forEach")?[].forEach:function(e){return iC(this,e,arguments.length>1?arguments[1]:void 0)};tt({target:"Array",proto:!0,forced:[].forEach!=iw},{forEach:iw});var ix=iO=ix("Array").forEach,iN=Array.prototype,iP={DOMTokenList:!0,NodeList:!0},iD=function(e){var t=e.forEach;return e===iN||$(iN,e)&&t===iN.forEach||eT(iP,tk(e))?iO:t};tt({target:"Object",stat:!0},{setPrototypeOf:nJ});var iM=J.Object.setPrototypeOf,iL=I([].concat),iU=Z("Reflect","ownKeys")||iV=Error,iF=I("".replace),iB=String(iV("zxcasd").stack),ij=/\n\s*at [^:]*:[^\n]*/,iG=ij.test(iB),iH=eN("iterator"),iz=Array.prototype,iK=iX=eN("iterator"),iW=iq=TypeError,iY=iJ=iQ=TypeError,iZ=i$=iZ.prototype,i0=i1=!h(,i2=i3=i5=eN("toStringTag"),i4=Error,i6=[].push,i8=function(e,t){var r,n=arguments.length>2?arguments[2]:void 0,i=$(i7,this);nJ?r=nJ(i4(),i?nB(this):i7):e7(r=i?this:rc(i7),i5,"Error"),void 0!==t&&e7(r,"message",function(e,t){return void 0===e?arguments.length<2?"":void 0:tW(e)}(t)),i1&&e7(r,"stack",i2(r.stack,1)),i3(r,n);var o=[];return i0(e,i6,{that:o}),e7(r,"errors",o),r};nJ?nJ(i8,i4):i8,i4,{name:!0});var i7=i8.prototype=rc(i4.prototype,{constructor:B(1,i8),message:B(1,""),name:B(1,"AggregateError")});tt({global:!0,constructor:!0,arity:2},{AggregateError:i8});var i9,oe,ot,or,on="process"==k(l.process),oi=eN("species"),oo=oa=TypeError,os=oc=TypeError,ou=od=eN("species"),ol=oh=TypeError,o_=op=/(?:ipad|iphone|ipod).*applewebkit/i.test(ee),ov=l.setImmediate,of=l.clearImmediate,om=l.process,og=l.Dispatch,oy=l.Function,oS=l.MessageChannel,ob=l.String,oE=0,oT={},ok="onreadystatechange";try{i9=l.location}catch(e){}var oI=oR=oA=function(e){oI(e.data)},oC=ov&&of||(ov=of=on?oe=function(e){om.nextTick(oR(e))}:og&&og.now?oe=oS&&!op?(or=(ot=new oS).port2,ot.port1.onmessage=oA,oe=eJ(or.postMessage,or)):l.addEventListener&&w(l.postMessage)&&!l.importScripts&&i9&&"file:"!==i9.protocol&&!h(oC)?(oe=oC,l.addEventListener("message",oA,!1)):oe=ok in eB("script")?;var ow,ox,oO,oN,oP,oD,oM,oL,oU={set:ov},oV=/ipad|iphone|ipod/i.test(ee)&&void 0!==l.Pebble,oF=/web0s(?!.*chrome)/i.test(ee),oB=x.f,oj=oU.set,oG=l.MutationObserver||l.WebKitMutationObserver,oH=l.document,oz=l.process,oK=l.Promise,oX=oB(l,"queueMicrotask"),oW=oX&&oX.value;oW||(ow=op||on||oF||!oG||!oH?!oV&&oK&&oK.resolve?((oM=oK.resolve(void 0)).constructor=oK,oL=eJ(oM.then,oM),oN=function(){oL(ow)}):on?oN=function(){oz.nextTick(ow)}:(oj=eJ(oj,l),oN=function(){oj(ow)}):(oP=!0,oD=oH.createTextNode(""),new oG(ow).observe(oD,{characterData:!0}),oN=);var oq=oW||oY=oJ=oJ.prototype={add:get:;var oQ=l.Promise,oZ="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,o$=!oZ&&!on&&"object"==typeof window&&"object"==typeof document,o0=oQ&&oQ.prototype,o1=eN("species"),o2=!1,o3=w(l.PromiseRejectionEvent),o5={CONSTRUCTOR:ez("Promise",function(){var e=tR(oQ),t=e!==String(oQ);if(!t&&66===eo||!o0.catch||!o0.finally)return!0;if(!eo||eo<51||!/native code/.test(e)){var r=new oQ(,n=if((r.constructor={})[o1]=n,!(o2=r.then(function(){}) instanceof n))return!0}return!t&&(o$||oZ)&&!o3}),REJECTION_EVENT:o3,SUBCLASSING:o2},o4={},o6=TypeError,o8=o4.f=var o7=oU.set,o9=ae="Promise",at=o5.CONSTRUCTOR,ar=o5.REJECTION_EVENT;o5.SUBCLASSING;var an,ai,ao,aa=rV.getterFor(ae),as=rV.set,ac=oQ&&oQ.prototype,au=oQ,ad=ac,al=l.TypeError,ah=l.document,a_=l.process,ap=o4.f,av=ap,af=!!(ah&&ah.createEvent&&l.dispatchEvent),am="unhandledrejection",ag=ay=aS=ab=aE=aT=ak=aI=aR=aA=at&&(ad=(au=.prototype,(an=.prototype=ry(ad,"then",,ai=o4.f=ap=,tt({global:!0,constructor:!0,wrap:!0,forced:at},{Promise:au}),rx(au,ae,!1,!0),oo(ae);var aC=eN("iterator"),aw=!1;try{var ax=0,aO={next:return:function(){aw=!0}};aO[aC]=function(){return this},Array.from(aO,}catch(e){}var aN=aP=o5.CONSTRUCTOR||!aN(;tt({target:"Promise",stat:!0,forced:aP},{all:);var aD=o5.CONSTRUCTOR;oQ&&oQ.prototype,tt({target:"Promise",proto:!0,forced:aD,real:!0},{catch:),tt({target:"Promise",stat:!0,forced:aP},{race:),tt({target:"Promise",stat:!0,forced:o5.CONSTRUCTOR},{reject:);var aM=aL=o5.CONSTRUCTOR,aU=Z("Promise"),aV=!aL;tt({target:"Promise",stat:!0,forced:!0},{resolve:),tt({target:"Promise",stat:!0},{allSettled:);var aF="No one promise resolved";tt({target:"Promise",stat:!0},{any:);var aB=oQ&&oQ.prototype;tt({target:"Promise",proto:!0,real:!0,forced:!!oQ&&h(},{finally:);var aj=J.Promise;tt({target:"Promise",stat:!0,forced:!0},{try:);var aG=I([].reverse),aH=[1,2];tt({target:"Array",proto:!0,forced:String(aH)===String(aH.reverse())},{reverse:);var az=ix("Array").reverse,aK=Array.prototype,aX=function(e){var t=e.reverse;return e===aK||$(aK,e)&&t===aK.reverse?az:t},aW=tj("slice"),aq=eN("species"),aY=Array,aJ=Math.max;tt({target:"Array",proto:!0,forced:!aW},{slice:);var aQ=ix("Array").slice,aZ=Array.prototype,a$=function(e){var t=e.slice;return e===aZ||$(aZ,e)&&t===aZ.slice?aQ:t};function a0(){a0=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=to||i="function"==typeof nw?nw:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";ry{c({},"")}catch(e){c=function u(e,t,r,i){var o,a,s=iI((t&&t.prototype instanceof h?t:h).prototype);return n(s,"_invoke",{value:(o=new E(i||[]),a="suspendedStart",}),s}.wrap=u;var l={};function h(){}function _(){}function p(){}var v={};c(v,o,function(){return this});var f=iR&&iR(iR(T([])));f&&f!==t&&r.call(f,o)&&(v=f);var m=p.prototype=h.prototype=iI(v);_.prototype=p,n(m,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:_,configurable:!0}),_.displayName=c(p,s,"GeneratorFunction"),e.isGeneratorFunction=e.mark=e.awrap=g(y.prototype),c(y.prototype,a,function(){return this}),e.AsyncIterator=y,e.async=g(m),c(m,s,"Generator"),c(m,o,,c(m,"toString",,e.keys=e.values=T,E.prototype={constructor:E,reset:stop:dispatchException:abrupt:complete:finish:catch:delegateYield:,e}r a3=ix("Array").concat,a5=Array.prototype,a4=function(e){var t=e.concat;return e===a5||$(a5,e)&&t===a5.concat?a3:t};J.JSON||(J.JSON={stringify:JSON.stringify});var a6=a8=rj.map;tt({target:"Array",proto:!0,forced:!tj("map")},{map:function(e){return a8(this,e,arguments.length>1?arguments[1]:void 0)}});var a7=ix("Array").map,a9=Array.prototype,se=function(e){var t=e.map;return e===a9||$(a9,e)&&t===a9.map?a7:t},st="	\n\v\f\r \xa0              　\u2028\u2029\uFEFF",sr=I("".replace),sn="["+st+"]",si=RegExp("^"+sn+sn+"")),2&e&&(r=sr(r,so,"")),r}},ss={start:sa(1),end:sa(2),trim:sa(3)},sc=ss.trim,su=l.parseInt,sd=l.Symbol,sl=sd&&sd.iterator,sh=/^[+-]?0x/i,s_=I(sh.exec),sp=8!==su(st+"08")||22!==su(st+"0x16")||sl&&!u(r,t>>>0||(s_(sh,r)?16:10))}:su;tt({global:!0,forced:parseInt!=sp},{parseInt:sp});var sv=J.neProperty(e,"a",{value:8})}}),sg=Object.isExtensiblBuffer"!=bject.preventExtensions({}))}),sb=eQ.ctID:"O"+sk++,weakData{getOwnP;sI(e)}retur;sI(e)}reE&&sy(e)&&!eT(e,sT)&&sI(e),e}};t0[sT]=!0;var sA=sf.exports,sC=eQ.f,sw=rj.forEach,sx=rV.set,sO=rV.getterFor,sN=function(e,t,r){var n,i=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=i?"set":"add",s=l[e],c=s&&s.prototype,u={};n(){(new s).en,t[a],{that:t,AS_ENTRIES:i})})).prototype,_=sO(e);sw(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(e){var t="add"==e||"set"==e;e i0===r?0:r,n);return t?this:a})}),o||sC(turn _(this).collection.size}})}else n=r.getConstructor(t,e,i,a),sA.enable();return rx(n,e,!1,!0),u[e]=n,tt({global:!0,forced:!0},ut[n]:ry(e,n,t[n],r);return e},sD=eQ.f,sM=sf.exports.fastKey,sL=rV.set,sU=rVn(){returntries":"values",!r,!0),oo(t)}};sN("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},s(e,sB,{that:r}),new this(r))};tt({target:"Map",stat:!0turn new this(nh(arguments))};tt({target:"Map",stat:guments[i]),n=n&&e;return!!n};tt({target:"Map",proto:!0,real:!0,forc=t.insert(e,i),P(s,i,e,n),n)};tt({target:"Map",proto:!0,real:!0,forced:!0},{emplace:sz}),tt({target:"Map",proto:!0,INTERRUPTED:!0}).stopped}}),tt({target:"Map",proto:NTRIES:!0,IS_ITERATOR:!0}),i}}),tt({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=e1(this),r=iY(t),n=eJ(e,arguments.length>1?arguments[1]:void 0);return i0(r,function(e,r,i){if(n(r,e,t))return i(r)},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),tt({target:"Map",proto:!R:!0,INTERRUPTED:!0}).result}});var sK=I([].push);tt({target:"Map,r,[e])},{IS_ITERATOR:!0}),n}}),tt({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return i0(iY(e1(this)),function(t,r,n){if(r===e||r!=r&&e!=e)return n()},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),tt({target:"Munction(e){P(n,r,t(e),e)}),r}}),tt({target:"Map",protoR:!0,INTERRUPTED:!0}).result}}),tt({target:"Map",proto:!NTRIES:!0,IS_ITERATOR:!0}),i}}),tt({target:"Map",proto:!0,NTRIES:!0,IS_ITERATOR:!0}),i}}),tt({target:"Map",proto:!0,realt:t,AS_ENTRIES:!0});return t}});var sX=TypeError;tt({target:"Map",proto: no initial value");return i}}),tt({target:"Map",prot:!0,INTERRUPTED:!0}).stopped}});var sW=TypeError;tt({target:"Map",proto:);return P(o,r,e,t(c,e,r)),r}});var sq=TypeError,sY=function(e,t){var r,n=e1(this),i=e_(n.get),o=e_(n.has),a=e_(n.set),s=arguments.length>2?arguments[2]:void 0;if(!w(t)&&!w(s))throw sq("At least one callback required");return P(o,n,e)?(r=P(i,n,e),w(t)&&P(a,n,e,r=t(r))):w(s)&&P(a,n,e,r=s()),r};tt({target:"Map",proto:!0,real:!0,forced:!0},{upsert:sY}),tt({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:sY}),tt({target:"Object",stat:!0,forced:h(function(){t4(1)})},{keys:function(e){return t4(eb(e))}});var sJ=&(i=r(i,a[c],c,o));return i}},s$={left:sZ(!1),right:sZ(!0)}.left;tt({target:"Array",proto:!0,forced:!iA("reduce"e,t,t>1?arguments[1]:void 0)}});var s0=ix("Array").reduce,s1=Array.prototype,s2=function(e){var t=e.reduce;return e===s1||$(s1,e)&&t===s1.reduce?s0:t},s3=Object.assign,s5=Object.definePropera,c,s)||(r[s]=c[s]);return r}:s3;tt({target:"Object",stat:!0,arity:2,forced:Object.assign!==s6},{assign:s6});var s8=J.Obt=e[s7])?!!t:"Regular expressions"/"[e](t)}catch(e){}}return!1};x.f;var ci=I("".endsWith),co=I("".slice),ca=Math.min;tt({target:"String",proto:!0,forc,o,i):co(t,i-o.length,i)===o}});var cs=ix("String").endsWith,cc=String.prototype,cu=function(e){var t=e.endsWith;return"string"==typeof e||e===cc||$ n&&n.length>=r&&sv(n[r],10)}function cl(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEveset(n,o),i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t]||!this._eventMap[t].has(r))return o.apply(this,arguments);var n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===sJ(this._eventMap).length&&delete this._eventMap,o.apply(ctiotListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function ch(){"undefinet.prototype.toString.call(e)}function cp(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new sF;if(null===t)returIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&function e(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),sJ(r).forEach(function(i){cu(i).call(i,"Id")?e(t,t.get(r[i]),n):cu(i(function(r){e(t,t.get(r),n)})}))}(e,r,i)})}),i}var cv=rj.find,cf="find",cm=!0;cf in[]&&[,][cf](function(){cm=!1}),tt({target:"Array",proto:!0,forced:cm},{find:function(e){return cv(this,e,arguments.length>1?arguments[1]:void 0)}});var cg=ix("Array").find,cy=Array.prototype,cS=function(e){var t=e.find;return e===cy||$(cy,e)&&t===cy.find?cg:t},cb=t$.indexOf,cE=I([].indexOf),cT=!!cE&&1/cE([1],1,-0)<0,ck=iA("indexOf");tt({target:"Array",protcE(this,e,t)||0:cb(this,e,t)}});var cI=ix("Array").indexOf,cR=Array.prototype,cA=function(e){var t=e.indexOf;return e===cR||$(cR,e)&&t===cR.indexOf?cI:t},cC=TypeError,cw=Object.getuction(e,t){returoperty "+el(t)+" of "+el(e))},cP=tj("splice"),cD=Math.max,cM=Math.min;tt({target:"Array"ts[o+2];return cx(c,u-n+r),i}});var cL=ix("Array").splice,cU=Array.prototype,cV=function(e){var t=e.splice;return e===cU||$(cU,e)&&t===cU.splice?cL:t},cF=rj.filter;tt({target:"Array",proto:!0,forced:!tj("filter")},{filter:function(e){return cF(this,e,arguments.length>1?arguments[1]:void 0)}});var cB=ix("Array").filter,cj=Array.prototype,cG=function(e){var t=e.filter;return e===cj||$(cj,e)&&t===cj.filter?cB:tcz=x.f,cK=h(function(){cz(1)});tt({target:"Object",stat:!0,forced:!O||cK,sham:ction(e,t){return cz(W(e),t)}});var cX=J.Object,cW=cH.exports=function(e,t){return cX.getOwnPropertyDescriptor(e,t)};cX.getOwnPropertyDescriptor.sham&&(cW.sham=!0);var cq=cH.exports,cY=t$.includes;tt({tartion(){return![,].includes()})},{includes:function(e){return cY(this,e,arguments.length>1?arguments[1]:void 0)}});var cJ=ix("Array").includes,cQ=I("".indexOf);tt({target:"String",proto:!0,forcength>1?arguments[1]:void 0)}});var cZ=ix("String").includes,c$=Array.pro(c0,e)&&t===c0.includes?cZ:t};function c2(e,t){var r=e&&e.navigator;if(r.mediaDevices){var n=function(e){if("object"!==im(e)||e.mandatory||e.optional)return e;var t,r={};return sJ(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var n="object"===im(e[t])?e[t]:{ideal:e[t]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+a$(t).call(t,1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){r.optional=r.optional||[];var o={};"number"==typeof n.ideal?(o[i("min",t)]=n.ideal,r.optional.push(o),(o={})[i("max",t)]=n.ideal):o[i("",t)]=n.ideal,r.optional.push(o)}void 0!==n.exact&&"number"!=typeof n.exact?(r.mandatory=r.mandatory||{},r.mandatory[i("",t)]=n{},r.mandatory[i(e,t)]=n[e])})}}),e.advanced&&(r.optional=a4(t=r.optional||[]).call(t,e.advanced)),r},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(a6(e)))&&"object"===im(e.audio)){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};o((e=JSON.parse(a6(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===im(e.video)){var a=e.video.facingMode;a=a&&("object"===im(a)?a:{ideal:a});var s,c=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c)&&(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?s=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(s=["front"]),s))return r.mediaDevices.enumerateDevices().then(function(t){var r=cS(t=cG(t).call(t,function(e){return"videoinput"===e.kind})).call(t,function(e){return s.some(function(t){var r;return c1(r=e.label.toLowerCase()).call(r,t)})});return!r&&t.length&&c1(s).call(s,"back")&&(r=t[t.length-1]),r&&(e.video.deviceId=a.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),ch("chrome: "+a6(e)),i(e)});e.video=n(e.video)}returnessage&&": ")+this.t,function(e){n&&n(o(e))})})}).bind(r),r.mediaDevices.getUserMedia){var a=r.mediaDevices.getUserMedia.bind(r.mediaDevices){aStream||e.webkitMediaStream}function c5(e){if("object"!==im(e)||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)cl(e,"track",function(e){return e.transceiver||to(e,"transceiver",{value:{receiver:e.receiver}}),e});else{to(e.RTCPeerConnection.prototype,"ontrack",{get:functioner("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){i=e.RTCPeerConnection.prototype.getReceivers?ack&&e.track.id===n.track.id}):{track:n.track};var i,o,a=new Event("track");a.track=n.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)}),t.stream.getTracks().forEach(function(n){i=e.RTCPeerConnection.prototype.getReceivers?n e.track&&e.track.id===n.id}):{track:n};var i,o,a=new Event("track");a.track=n,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function c4(e){if("object"===im(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPetmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){var e;return this._senders=this._senders||[],a$(e=this._senders).call(e)};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeer,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t,r,i=cA(t=this._senders).call(t,e);-1!==i&&cV(r=this._senders).call(r,i,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerCe){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){var r,n,i,o=cS(r=t._senders).call(r,function(t){return t.track===e});o&&cV(n=t._senders).call(n,cA(i=t._senders).call(i,o),1)})}}else if("object"===im(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},to(e.RTCRt:this._dtmf=null),this._dtmf}})}}function c6(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=a$(Array.prototype).call(arguments),n=r[0],i=r[1],o=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0==arguments.length||"function"!=typeof n))t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){var t;rett,function(t){return[t,e[t]]}))};return arguments.length>=2?t.apply(this,[funct[function(e){r(s(a(e)))},n])}).then(i,o)}}}function c8(e){if("object"===im(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return cp(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),cl(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;ren(t){return cp(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerturn i.apply(this,arguments)}}}}function c7(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e,t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},se(e=sJ(this.t._shimmedLocalStreams[e][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n,i=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===cA(n=this._shimmedLocalStreams[r.id]).call(n,i)&&this._shimmedLocalStreams[r.id].push(i):this._shimmedLocalStreams[r.id]=[r,i],i};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t,n,i=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){var t;if(cS(t=i.getSenders()).call(t,function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var o=this.getSenders();r.apply(this,arguments);var a=c{return -1===cA(o).call(o,e)});this._shimmedLocalStreams[e.id]=a4(n=[e]).call(n,a)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConn.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&sJ(this._shimmedLocalStreams).forEach(function(r){var n,i,o=cA(n=t._shimmedLocalStreams[r]).call(n,e);-1!==o&&cV(i=t._shimmedLocalStreams[r]).call(i,o,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}}function c9(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return c7(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){var t;if(cS(t=r.getSenders()).call(t,function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConn],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n,i,o,a=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var s=a$([]).call(arguments,1);if(1!==s.length||!l(n,function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(cS(i=this.getSenders()).call(i,function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var c=this._streams[r.id];if(c)c. Event("negotiationneeded"))});else{var u=new e.MediaStream([t]);this._streams[r.id]=u,this._reverseStreams[u.id]=r,this.addStream(u)}return cS(o=this.getSenders()).call(o,function(e){return e.track===t})},["createOConnection.prototype[t]=n[t]});var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e,t,r;return arguments.length&&arguments[0].type&&(arguments[0]=(e=this,t=arguments[0],r=t.sdp,sJ(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r}))),o.apply(this,arguments)};var a=cq(e.RTCPeerConnection.prototype,"localDescription");to(e.RTCPeerConnection.proteturn""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},sJ(this._streams).forEach(function(n){var i;cS(i=r._streams[n].getTracks()).call(i,function(t){return e.track===t})&&(t=r._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var r=t.sdp;return sJ(eplace(RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}}function ue(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=iT({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]})}function ut(===r.signalingState)return e})}var ur=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream:c3,shimOnTrack:c5,shimGetSendersWithDtmf:c4,shimGetStats:c6,shimSenderReceiverGetStats:c8,shimAddTrackRemoveTrackWithNative:c7,shimAddTrackRemoveTrack:c9,shimPeerConnection:ue,fixNegotiationNeeded:ut,shimGetUserMedia:c2,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&"function"==typeof t&&(e.navigatordiaDevices.getUserMedia(r)})})}},Symbol.toStringTag,{value:"Module"}));tt({target:"Array",stat:!0},{isArra);r<t;r)}catch(t){f(s,_,l);return s.length=_,s};tt({target:"Array",stat:!0,forced:!aN(function(e){Array.from(e)})},{ay$/.test(n)?ui(e,t):ion(e["@@iterator"])return uc(e)}(e)||uu(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ul=ss.trim,uh=I("".charAt),u_=l.parseFloat,up=l.Symbol,uv=up&&up.iterator,u!urn 0===r&&"-"==uh(t,0)?-0:r}:u_;tt({global:!0,forced:parseFloat!=uf},{parseFloat:uf});var um=J.parseFloat;function ug(e,t){var r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getS e)&&(e[r]=e[t],delete e[t])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===im(e)&&"object"===im(e.audio)&&(i((e=JSON.parse(a6(e))).audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},n&&n.prototype.getSettings){var a=n.prototype.getSetssion","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===im(e)&&(i(e=JSON.parse(a6(e)),"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function uy(e){"object"===im(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&to(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function uS(e,t){if("object"===im(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescriptioConnection.prototype[t]=n[t]});var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=a$(Array.prototype).call(arguments),i=e[0],o=e[1],a=e[2];return n.apply(this,[i||null]).then(function(e){if(t(e){e.type=r[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,s8({},t,{type:r[t.type]||t.type}))})}return e}).then(o,a)}}}function ub(e){if("object"===im(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerguments);return e._pc=this,e}),e.RTis.track):aj.resolve(new sF)}}}function uE(e){if("object"===im(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnnction(t){retu.receiver._pc=e.srcElement,e}),e.RTCRhis._pc.getStats(this.track)}}}function uT(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this.getSenders().forEach(function(r){var n;r.track&&c1(n=e.getTracks()).call(n,rTCDataChannel=e.DataChannel)}function uI(e){if("object"===im(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var r=(ex_framerate must be >= 0.0")});var n=t.apply(this,arguments);if(r){var i=n.sender,o=i.getParameters();"encodings"in o&&(1!==o.encodings.length||0!==sJ(o.encodings[0]).length)||(o.encodings=e,i.sendEncodings=e,this.setParametersPromises.push(i.setParameters(o).then(function(){dion(){delete i.sendEncodings})))}return n})}}function uR(e){if("object"===im(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e,r=t.apply(this,arguments);return"encodings"in r||(r.encodings=a4(e=[]).call(e,this.sendEncodings||[{}])),r})}}function uA(e){if("object"===im(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?aj.all(this.setParametersPromises).then(function(){return t.apply(r,e)}).finally(function(){r.setParametersPromises=[]}):t.apply(this,arguments)}}}function uC(e){if("object"===im(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConn[]}):t.apply(this,arguments)}}}var uw=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack:uy,shimPeerConnection:uS,shimSenderGetStats:ub,shimReceiverGetStats:uE,shimRemoveStream:uT,shimRTCDataChannel:uk,shimAddTransceiver:uI,shimGetParameters:uR,shimCreateOffer:uA,shimCreateAnswer:uC,shimGetUsediaDevices.getUserMedia(r)})}},Symbol.toStringTag,{value:"Module"}));function ux(e){if("object"===im(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnectreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r,n=this;this._localStreams||(this._localStreams=[]),c1(r=this._localStreams).call(r,e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(r){return t.call(n,r,e)tion(r){return t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i&&i.forEach(function(e){var t;r._localStreams?c1(t=r._localStreams).call(t,e)||r._localStreams.push(e):r._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t,r,n=this;this._localStreams||(this._localStreams=[]);var i=cA(t=this._localStreams).call(t,e);if(-1!==i){cV(r=this._localStreams).call(r,i,1);var o=e.getTracks();this.getSenders().forEach(function(e){c1(o).call(o,e.track)&&n.removeTrack(e)})}})}}function uO(e){if("object"===im(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnectireams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){to(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){var r;if(t._remoteStreams||(t._remoteStreams=[]),!c1(r=t._remoteStreams).call(r,e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){var r;if(e._remoteStreams||(e._remoteStreams=[]),!(cA(r=e._remoteStreams).call(r,t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}})}),t.apply(e,arguments)}}}function uN(e){if("object"===im(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),aj(i.then(e,t),aj.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),aj.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),aj.resolve()):(n.then(t,r),aj.resolve()):n},t.addIceCandidate=s}}function uP(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r=function(e){return n(uD(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.ges.getUserMedia(e).then(r,n)}).bind(t))}function uD(e){return e&&void 0!==e.video?s8({},e,{video:function e(t){var r;return c_(t)?s2(r=sJ(t)).call(r,function(r,n){var i=c_(t[n]),o=i?e(t[n]):t[n],a=i&&!sJ(o).length;return void 0===o||a?r:s8(r,iT({},n,o))},{}):t}(e.video)}):e}function uM(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?((o=JSON.parse(a6(o))).urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&to(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function uL(e){"object"===im(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&to(e.RTCTrackEventturn{receiver:this.receiver}}})}function uU(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r,n,i=cS(r=this.getTransceivers()).call(r,function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveAudio||i||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var o=cS(n=tdeo"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0!==e.offerToReceiveVideo||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function uV(e){"object"!==im(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var uF=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI:ux,shimRemoteStreamsAPI:uO,shimCallbacksAPI:uN,shimGetUserMedia:uP,shimConstraints:uD,shimRTCIceServerUrls:uM,shimTrackEventTransceiver:uL,shimCreateOfferLegacy:uU,shimAudioContext:uV},Symbol.toStringTag,{value:"Module"})),uB=nM.PROPER,uj="​\x85᠎",uG=ss.trim;tt({target:"Strl1]()!==u{trim:function(){return uG(this)}});var uH=ix("String").trim,uz=String.prototype,uK=function(e){var t=e.trim;return"string"==typeof e||e===uz||$(uz,e)&&t===uz.trim?uH:t},uX={exndom().toString(36).substr(2,10)}}).localCName=l2.generateIdentifier(),l2.splitLines=function(e){var t;return se(t=function(e){return uK(e).call(e)})},l2.splitSections=function(e){var t=e.split("\nm=");return se(t).call(t,function(e,t){var r;return uK(r=t>0?"m="+e:e).ca.splitSections(e);reitSections(e);return t.shift(),t},l2.matchPrefix=function(e,t){var r;return cG(r=l2.splitLines(e)).call(r,function(e){return 0===cA(e).call(e,t)})},l2.parseCandidate=function(e){for(var t,r={foundation:(t=0===cA(e).call(e,"a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:sv(t[3],10),ip:t[4],address:t[4],port:sv(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=sv(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[ufrag)),"candidate:){return e.subs10):1,r.numChanlockRate+(1!==r?"/"+r:"")+"\r\n"},l2.parseExtmap=function(e){var t,r=e.substr(9).split(" ");return{id:sv(r[0],10),direction:cA(t=r[0]).call(t,"/")>0?r[0].split("/")[1]:"see.direction:"")+" "+e.uri+"\r\n"},l2.parseFmtp=function(e){for(var t,r,n,i={},o=e.substr(cA(e).call(e," ")+1).split(";"),a=0;a<o.length;a++)n=uK(t=o[a]).call(t).split("="),i[uK(r=n[0]).call(r)]=n[1];return i},l2.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&sJ(e.parameters).length){t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},l2.parseRtcpFb=function(e){var t=e.substr(cA(e).call(e," ")+1).split(" ");return{type:t.shift(),paramh?" "+e.parameter:"")+"\r\n"}),t},l2.parseSsrcMedia=function(e){var t=cA(e).call(e," "),r={ssrc:sv(e.substr(7,t-7),10)},n=cA(e).call(e,":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},l2.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:se(t).call(t,functionid:")[0];if(t)returnCase(),value:t[1].toUpperCase()}},l2.getDtlsParameters=function(e,t){var r=l2.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:se(r).call(r,l2.parseFingalgorithm+" "+e.value+"\r\n"}),r},l2.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:sv(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:a$(ssionParams.join(" "):"")+"\r\n"},l2.parseCryptoKeyParams=function(e){if(0!==cA(e).call(e,"inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]"+e.mkiValue+":"+e.mkiLength:"")},l2.getCryptoParameters=function(e,t){var r=l2.matchPrefix(e+t,"a=crypto:");return se(r).call(r,l2.pars(12),password:n.substriceLite&&(t+="a=ice-lite\r\n"),t},l2.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=l2.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var i=r[n],o=l2.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var a,s=l2.parseRtpMap(o),c=l2.matchPrefix(e,"a=fmtp:"+i+" ");switch(s.parameters=c.length?l2.parseFmtp(c[0]):{},s.rtcpFeedback=se(a=l2.matchPrefix(e,"a=rtcp-fb:"+i+" ")).call(a,l2.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return l2.mtensions.push(l2.parseExtmap(e))}),t},l2.writeRtpDescription=function(e,t){var r,n="";n+="m="+e+" "+(t.codecs.length>0?"9":"0")+" UDP/TLS/eferredPayloadType:e.payloadType}).join(" ")+"\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN 2.writeFmtp(e)+l2.writeRtcpFb(e)}(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),t.headerExtenfunction(e){n+=l2.writeExtmap(e)}),n},l2.parseRtpEncodingParameters=function(e){var t,r,n,i,o,a,s=[],c=l2.parseRtpParameters(e),u=-1!==cA(t=c.fecMechanisms).call(t,"RED"),d=-1!==cA(r=c.fecMechanisms).call(r,"ULPFEC"),l=cG(n=se(i=l2.matchPrefix(e,"a=ssrc:")).call(i,function(e){return l2.parseSsrcMedia(e)})).call(n,function(e){return"cname"===e.attribute}),h=l.length>0&&l[0].ssrc,_=se(o=l2.matchPrefix(e,"a=ssrc-group:FID")).call(o,function(e){var t=e.substr(1ll(t,function(e){return sv(e,10)})});_.length>0&&_[0].length>1&&_[0][0]===h&&(a=_[0][1]),c.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:h,codecPayloadType:sv(e.parameters.apt,10)};h&&a&&(t.rtx={ssrc:a}),s.push(t),u&&((t=JSON.parse(a6(t))).fec={ssrc:h,mechanism:d?"red+ulpfec":"red"},s.push(t))}}),0===s.length&&h&&s.push({ssrc:h});var p,v,f=l2.matchPrefix(e,"b=");return f.length&&(f=0===cA(p=f[0]).call(p,"b=TIAS:")?sv(f[0].substr(7),10):0===cA(v=f[0]).call(v,"b=AS:")?1e3*sv(f[0].substrrEach(function(e){e.maxBitrate=f})),s},l2.parseRtcpParameters=function(e){var t,r,n={},i=cG(t=se(r=l2.matchPrefix(e,"a=ssrc:")).call(r,function(e){return l2.parseSsrcMedia(e)})).call(t,function(e){return"cname"===e.attribute})[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);var o=l2.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=0===o.length;var a=l2.matchPrefix(e,"a=rtcp-mux");return n.mux=a.lssrc+" cname:"+e.cname+"\r\n"),t},l2.parseMsid=function(e){var t,r,n,i=l2.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(n=i[0].substr(7).split(" "))[0],track:n[1]};var o=cG(t=se(r=l2.matchPrefix(e,"a=ssrc:")).call(r,function(e){return l2.parseSsrcMedia(e)})).call(t,function(e){return"msid"===e.attribute});return o.length>0?{stream:(n=o[0].value.split(" "))[0],track:n[1]}:void 0},l2.parseSctpDescription=function(e){var t,r=l2.parseMLine(e),n=l2.matchPrefix(e,"a=max-message-size:");n.length>0&&(t=sv(n[0].substr(19),10)),isNaN(t)&&(t=65536);var i=l2.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:sv(i[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};var o=l2.matchPrefix(e,"a=sctpmap:");if(o.length>0){var a=o[0].substr(10).split(" ");return{port:sv(a[0],10),protocol:a[1],maxMessageaxMessageSize+"\r\n")random().toString().substr(4 127.0.0.1\r\ns t?l2.getDies(e)[0].splite){return"0"===e.split(" ",2)[1]},l2.parseMLine=function(e){var t=l2.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:sv(t[1],10),protocol:t[2],fmt:a$(t).ca],addressType:t[r].charAt(1))return!1;return!0},uX.exports=l2;var uW=uX.exports;function uq(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){var r;if("object"===im(e)&&e.candidate&&0===cA(r=e.candidate).call(r,"a=")&&((e=JSON.parse(a6(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=s8(new t(e),uW.parseCandidnameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,cl(e,"icecandidate",function(t){return t.candidate&&to(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}}function uY(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||cl(e,"icecandidate",function(e){if(e.candidate){var t=uW.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol=({0:"tls",1:"tcp",2:"udp"})[t.priority>>24])}return e})}function uJ(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||to(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=uW.splitSections(e.sdp);return t.shift(),t.some(function(e){var t,r=uW.parseMLine(e);return r&&"application"===r.kind&&-1!==cA(r errowser&&-1!==r&&(n=2147483637),n},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76&&"plan-b"===this.getConfiguration().d 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),r(arguments[0])){var e,s=n(arguments[0]),c=i(s),u=o(arguments[0],s);e=0===c&&0===u?Number.POSITIVE_INFINITY:0===c||0===u?Math.max(c,u):Math.min(c,u);vageSize",{get:function(){return e}}),this._sctp=d}return a.apply(this,arguments)}}}function uQ(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConneis,arguments);retur))");return r.apply(e,arguments)}}}function uZ(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.protnState]||this.iceConnectionState},enumerable:!0,configurable:!0}),tos._othis._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescriptionepoly)),r.apply(this,arguments)}})}}function u$(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){var n;if(t&&t.sdp&&-1!==cA(n=t.sdp).call(n,"\na=extmap-allow-mixed")){var i,o=cG(i=t.sdp.split("\n")).call(i,function(e){return"a=extmap-allow-mixed"!==uK(e).call(e)}).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:o}):t.sdp=o}return r.apply(this,arguments)}}}function u0(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnts[1].apply(null),aj.resolve())})}}function u1(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!==im(t)||t.type&&t.sdp)return r.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?r.apply(this,[t]):("offer"===t.type?this.createOffer:thunction(t){return r.apply(e,[t])})})}}function u2(e,t){var r=void 0!==nw&&iW(e)||e["@@iterator"];if(!r){if(un(e)||(r=uu(e))||t&&e&&"number"==typeof e.length){r&&(e=r);va{de:e[n++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() m;rvae.r.return()}finally{if(s)trn f}finally{if(u)t a [Symbol.iterator]() method.")}()}l3={__proto__:nullget:function(){return e[t]}})}})}),Object.freeze(Object.defineProperty(l3,Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate:uq,shimRTCIceCandidateRelayProtocol:uY,shimMaxMessageSize:uJ,shimSendThrowTypeError:uQ,shimConnectionState:uZ,removeExtmapAllowMixed:u$,shimAddIceCandidateNullOrEmpty:u0,shimParameterlessSetLocalDescription:u1},Symbol.toStringTag,{value:"Module"})),!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=cd(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=cd(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=cd(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(t),i={};switch(n.browser){case"chrome":if(!ur||!ue||!r.shimChrome)return ch("Chrome shim is not included in this adapter release.");if(null===n.version)return ch("Chrome shim can not determine version, not shimming.");ch("adapter.js shimming chrome."),i.browserShim=ur,u0(t,n),u1(t),c2(t,n),c3(t),ue(t,n),c5(t),c9(t,n),c4(t),c6(t),c8(t),ut(t,n),uq(t),uY(t),uZ(t),uJ(t,n),uQ(t),u$(t,n);break;case"firefox":if(!uw||!uS||!r.shimFirefox)return ch("Firefox shim is not included in this adapter release.");ch("adapter.js shimming firefox."),i.browserShim=uw,u0(t,n),u1(t),ug(t,n),uS(t,n),uy(t),uT(t),ub(t),uE(t),uk(t),uI(t),uR(t),uA(t),uC(t),uq(t),uZ(t),uJ(t,n),uQ(t);break;case"safari":if(!uF||!r.shimSafari)return ch("Safari shim is not included in this adapter release.");ch("adapter.js shimming safari."),i.browserShim=uF,u0(t,n),u1(t),uM(t),uU(t),uN(t),ux(t),uO(t),uL(t),uP(t),uV(t),uq(t),uY(t),uJ(t,n),uQ(t),u$(t,n);break;default:ch("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var u5=J.Object.getOwnPropertySymbols;tt({target:"Object",stat:!0,shn,t=o[s++]))&&tf(a,t,r);return a}});var u4=J.Object.getOwnPropertyDescriptors,u6={exports:{}},u8=tq.f;tt({target:"Object",stat:!0,forced:Object.defineProperties!==u8,sham:!O},{defineProperties:u{return u7.defineProperties(e,t)};u7.defineProperties.sha haseT(e,"value")||eT(e,"writable"))};tet,o):Y(i=nB(t))?e(i,r,o):void 0}});var da=J.Reflect.get,ds=Function,dc=I(du(n,",")+")"};return Y(r)&&(i.prototype=r),i};tt({target:"Function",proto:!0,forced:Function.bind!==dh},{bind:dh});var d_=ix("Function").bind,dp=Function.prototype,dv=function(e){var t=e.bind;return e===dp||$(dp,e)&&t===dp.bind?d_:t};function dion(e){return e.__proto__||iR(e)})(e)}function dm(){return(dm="undefined"!=targuments.length<3?e:r):i.value}}).apply(this,arguments)}function dg(tion(e,t){return e.__proto__=t,e})(e,t)}function dy(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=iI(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),to(e,"prototype",{writable:!1}),t&&dg(e,t)}var dS=Z("Reflect","construct"),dbfunctiok=!h(function(){dS(function(){})}),dI=dT||dk;tt({target:"Reflect",stati:db),a=m(e,o,t);return Y(a)?a:o}});var dR=J.Reflect.construct;function dA(){if("undefined"==typeof Reflect||!dR||dR.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(dR(Boolean,[],function(){})),!0}catch(e){return!1}}function dC(e){var t=dA();return function(){var r,n=df(e);if(t){var i=df(this).constructor;r=dR(n,arguments,i)}elseject or undefined");return dn(e)}(this,r)}}var dw=ix("Array").values,dx=Array.prototype,dO={DOMTokenList:!0,NodeList:!0},dN=function(e){var t=e.values;return e===dx||$(dx,e)&&t===dx.values||eTdD([--[s++]:a<i?t[a++]:r[s++];return e},dU=ee.match(/firefox\/(\d+)/i),dV=!!dU&&+dU[1],dF=/MSIE|Trident/.test(ee),dB=ee.match(/AppleWebKit\/(\d+)\./),dj=!!dB&&+dB[1],dG=[],dK=h(function(){dG.sort(void 0)}),dX=h(function(){dG&(i+=t);return"DGBEFHACIJK"!==i}});tt({target:"Array",proto:!0,forced:dK||!dX||!dW||!dq},{sort:function(e){void 0!==e&&e_(e);var t=eb(this);if(dq)return void 0===e?dH(t):dH(t,e);var r,n,i=[],o=t_(t);for(n=0;n<!==e?+e(t,r)||0:tW(t)>tW(r)?1:-1}),r=t_(i),n=0;n<r;)t[n]=i[n++];for(;n<o;)cN(t,n++);return t}});var dY=ix("Array").sort,dJ=Array.prototype,dQ=function(e){var t=e.sort;return e===dJ||$(dJ,e)&&t===dJ.sort?dY:t},dZ=rj.findIndex,d$="$ in[]&&[,][d$](function(){d0=!1}),tt({target:"Array",proto:!0,forced:d0},{findIndex:function(e){return dZ(this,e,arguments.length>1?arguments[1]:void 0)}});var d1=ix("Array"||$(d2,e)&&t===d2.findIndex?d1:t};x.f;var d5=I("".startsWith),d4=I("".slice),d6=Math.min;tt({target:"String",proto:!0,forcd5(t,n,r):d4(t,r,r+n.length)===n}});var d8=ix("String").startsWith,d7=String.prototype,d9=function(e){var t=e.startsWith;return"string"==typeof e||e===d7||$(d7,e)&&t===d7.startsWith?d8:t},le=((l5=le||{}).INVALID_ENGINE="INVALID_ENGINE",l5.INVALID_PARAMS="INVALID_PARAMS",l5.INVOKED_BEFORE_JOIN_ROOM="INVOKED_BEFORE_JOIN_ROOM",l5.INVALID_TOKEN="INVALID_TOKEN",l5.EXPIRED_TOKEN="EXPIRED_TOKEN",l5.JOIN_ROOM_FAILED="JOIN_ROOM_FAILED",l5.UPDATE_TOKEN_WITH_INVALID_TOKEN="UPDATE_TOKEN_WITH_INVALID_TOKEN",l5.UPDATE_TOKEN_BEFORE_JOIN="UPDATE_TOKEN_BEFORE_JOIN",l5.REPEAT_JOIN="REPEAT_JOIN",l5.REPEAT_PUBLISH="REPEAT_PUBLISH",l5.REPEAT_PUSH="REPEAT_PUSH",l5.REPEAT_PLAY="REPEAT_PLAY",l5.PUBLISH_BEFORE_JOIN="PUBLISH_BEFORE_JOIN",l5.UNPUBLISH_BEFORE_JOIN="UNPUBLISH_BEFORE_JOIN",l5.SUBSCRIBE_BEFORE_JOIN="SUBSCRIBE_BEFORE_JOIN",l5.UNSUBSCRIBE_BEFORE_JOIN="UNSUBSCRIBE_BEFORE_JOIN",l5.NO_PUBLISH_PERMISSION="NO_PUBLISH_PERMISSION",l5.STREAM_NOT_EXIST="STREAM_NOT_EXIST",l5.EMPTY_STREAM="EMPTY_STREAM",l5.NOT_CONNECTED_YET="NOT_CONNECTED_YET",l5.IM_BEFORE_JOIN="IM_BEFORE_JOIN",l5.USER_NOT_EXIST="USER_NOT_EXIST",l5.ALREADY_IN_ROOM="ALREADY_IN_ROOM",l5.KICKED_OUT="KICKED_OUT",l5.ROOM_DISMISS="ROOM_DISMISS",l5.TOKEN_EXPIRED="TOKEN_EXPIRED",l5.DUPLICATE_LOGIN="DUPLICATE_LOGIN",l5.INVOKED_BEFORE_CAPTURE="INVOKED_BEFORE_CAPTURE",l5.REPEAT_CAPTURE="REPEAT_CAPTURE",l5.GET_VIDEO_TRACK_FAILED="GET_VIDEO_TRACK_FAILED",l5.GET_AUDIO_TRACK_FAILED="GET_AUDIO_TRACK_FAILED",l5.GET_SCREEN_TRACK_FAILED="GET_SCREEN_TRACK_FAILED",l5.STREAM_TYPE_NOT_MATCH="STREAM_TYPE_NOT_MATCH",l5.CANT_FIND_DOM="CANT_FIND_DOM",l5.INVALID_DEVICE_ID="INVALID_DEVICE_ID",l5.NO_PERMISSION="NO_PERMISSION",l5.NOT_SUPPORTED="NOT_SUPPORTED",l5.INTERRUPT="INTERRUPT",l5.ICE_SERVER_WRONG="ICE_SERVER_WRONG",l5.ESTABLISH_DATACHANNEL_FAILED="ESTABLISH_DATACHANNEL_FAILED",l5.LOAD_RESOURCES_FAILED="LOAD_RESOURCES_FAILED",l5.SIGNALING_CHANNEL_NOT_OPEN="SIGNALING_CHANNEL_NOT_OPEN",l5.TIME_OUT="TIME_OUT",l5.REFUSE_OPERATION_IN_DISCONNECT="REFUSE_OPERATION_IN_DISCONNECT",l5.ADD_TRANSCEIVER_FAILED="ADD_TRANSCEIVER_FAILED",l5.UPDATE_TRACK_FAILED="UPDATE_TRACK_FAILED",l5.PUBLISH_FAILED="PUBLISH_FAILED",l5.UNPUBLISH_FAILED="UNPUBLISH_FAILED",l5.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",l5.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",l5.OPERATION_CANCEL="OPERATION_CANCEL",l5.START_CLOUD_PROXY_AFTER_JOIN="START_CLOUD_PROXY_AFTER_JOIN",l5.STOP_CLOUD_PROXY_BEFORE_LEAVE="STOP_CLOUD_PROXY_BEFORE_LEAVE",l5.UNEXPECTED_ERROR="UNEXPECTED_ERROR",l5.REPEAT_DEVICE_TEST="REPEAT_DEVICE_TEST",l5.AUDIO_DEVICE_TEST_FAILED="AUDIO_DEVICE_RECORD_FAILED",l5.ALREADY_LOGIN="ALREADY_LOGIN",l5.LOGIN_FAILED="LOGIN_FAILED",l5.NOT_LOGIN="NOT_LOGIN",l5.RTM_DUPLICATE_LOGIN="RTM_DUPLICATE_LOGIN",l5.RTM_TOKEN_ERROR="RTM_TOKEN_ERROR",l5.USER_MESSAGE_TIMEOUT="USER_MESSAGE_TIMEOUT",l5.USER_MESSAGE_BROKEN="USER_MESSAGE_BROKEN",l5.USER_MESSAGE_NO_RECEIVER="USER_MESSAGE_NO_RECEIVER",l5.USER_MESSAGE_NO_RELAYPATH="USER_MESSAGE_NO_RELAYPATH",l5.USER_MESSAGE_EXCEED_QPS="USER_MESSAGE_EXCEED_QPS",l5.USER_MESSAGE_SEND_TO_SERVER_ERROR="USER_MESSAGE_SEND_TO_SERVER_ERROR",l5.USER_MESSAGE_SERVER_RESPONSE_ERROR="USER_MESSAGE_SERVER_RESPONSE_ERROR",l5.USER_MESSAGE_NOT_JOIN="USER_MESSAGE_NOT_JOIN",l5.USER_MESSAGE_INIT="USER_MESSAGE_INIT",l5.USER_MESSAGE_NO_CONNECTION="USER_MESSAGE_NO_CONNECTION",l5.USER_MESSAGE_NOT_LOGIN="USER_MESSAGE_NOT_LOGIN",l5.USER_MESSAGE_SERVER_PARAMS_NOTSET="USER_MESSAGE_SERVER_PARAMS_NOTSET",l5.USER_MESSAGE_UNKNOWN="USER_MESSAGE_UNKNOWN",l5.START_PUBLIC_STREAM_BEFORE_JOIN="START_PUBLIC_STREAM_BEFORE_JOIN",l5.RECONNECT_FAILED="RECONNECT_FAILED",l5.SUBTITLE_ALREADY_ON="SUBTITLE_ALREADY_ON",l5.SUBTITLE_NOT_TURNED_ON="SUBTITLE_NOT_TURNED_ON",l5.SUBTITLE_ERR_POSTPROCESS="SUBTITLE_ERR_POSTPROCESS",l5.SUBTITLE_ERR_CONNECTION_ERROR="SUBTITLE_ERR_CONNECTION_ERROR",l5.SUBTITLE_ERR_PROCESS_ERROR="SUBTITLE_ERR_PROCESS_ERROR",l5.SUBTITLE_ERR_UNKNOWN="SUBTITLE_ERR_UNKNOWN",l5.UNEXPECTED_INVOKE_FORWARD_STREAM="UNEXPECTED_INVOKE_FORWARD_STREAM",l5),lt=((l4=lt||{})[l4.AUDIO_MIXING_ERROR_OK=0]="AUDIO_MIXING_ERROR_OK",l4[l4.AUDIO_MIXING_ERROR_PRELOAD_FAILED=1]="AUDIO_MIXING_ERROR_PRELOAD_FAILED",l4[l4.AUDIO_MIXING_ERROR_START_FAILED=2]="AUDIO_MIXING_ERROR_START_FAILED",l4[l4.AUDIO_MIXING_ERROR_ID_NOT_FOUND=3]="AUDIO_MIXING_ERROR_ID_NOT_FOUND",l4[l4.AUDIO_MIXING_ERROR_SET_POSITION_FAILED=4]="AUDIO_MIXING_ERROR_SET_POSITION_FAILED",l4[l4.AUDIO_MIXING_ERROR_INVALID_VOLUME=5]="AUDIO_MIXING_ERROR_INVALID_VOLUME",l4[l4.AUDIO_MIXING_ERROR_LOAD_CONFLICT=6]="AUDIO_MIXING_ERROR_LOAD_CONFLICT",l4[l4.AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH=7]="AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH",l4[l4.AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH=8]="AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH",l4[l4.AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK=9]="AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK",l4),lr=((l6=lr||{})[l6.VIDEO_SOURCE_TYPE_EXTERNAL=0]="VIDEO_SOURCE_TYPE_EXTERNAL",l6[l6.VIDEO_SOURCE_TYPE_INTERNAL=1]="VIDEO_SOURCE_TYPE_INTERNAL",l6),ln=((l8=ln||{})[l8.AUDIO_SOURCE_TYPE_EXTERNAL=0]="AUDIO_SOURCE_TYPE_EXTERNAL",l8[l8.AUDIO_SOURCE_TYPE_INTERNAL=1]="AUDIO_SOURCE_TYPE_INTERNAL",l8),li=((l7=li||{})[l7.QUIT=0]="QUIT",l7[l7.DROPPED=1]="DROPPED",l7[l7.SWITCH_TO_INVISIBLE=2]="SWITCH_TO_INVISIBLE",l7[l7.KICKED_BY_ADMIN=3]="KICKED_BY_ADMIN",l7),lo=((l9=lo||{})[l9.CHANNEL_PROFILE_COMMUNICATION=0]="CHANNEL_PROFILE_COMMUNICATION",l9[l9.CHANNEL_PROFILE_LIVE_BROADCASTING=1]="CHANNEL_PROFILE_LIVE_BROADCASTING",l9),la=((he=la||{})[he.AUTO_SUBSCRIBE_MODE=0]="AUTO_SUBSCRIBE_MODE",he[he.MANUAL_SUBSCRIBE_MODE=1]="MANUAL_SUBSCRIBE_MODE",he),ls=((ht=ls||{})[ht.SUBSCRIBE_SUCC=0]="SUBSCRIBE_SUCC",ht[ht.SUBSCRIBE_FAIL=1]="SUBSCRIBE_FAIL",ht),lc=((hr=lc||{})[hr.PUBLISH_SUCC=0]="PUBLISH_SUCC",hr[hr.PUBLISH_FAIL=1]="PUBLISH_FAIL",hr),lu=((hn=lu||{})[hn.MIRROR_MODE_OFF=0]="MIRROR_MODE_OFF",hn[hn.MIRROR_MODE_ON=1]="MIRROR_MODE_ON",hn),ld=((hi=ld||{})[hi.RENDER_MODE_HIDDEN=0]="RENDER_MODE_HIDDEN",hi[hi.RENDER_MODE_FIT=1]="RENDER_MODE_FIT",hi[hi.RENDER_MODE_FILL=2]="RENDER_MODE_FILL",hi),ll=((ho=ll||{})[ho.STREAM_INDEX_MAIN=0]="STREAM_INDEX_MAIN",ho[ho.STREAM_INDEX_SCREEN=1]="STREAM_INDEX_SCREEN",ho),lh=((ha=lh||{})[ha.AUDIO=1]="AUDIO",ha[ha.VIDEO=2]="VIDEO",ha[ha.AUDIO_AND_VIDEO=3]="AUDIO_AND_VIDEO",ha),l_=((hs=l_||{})[hs.STREAM_REMOVE_REASON_UNPUBLISH=0]="STREAM_REMOVE_REASON_UNPUBLISH",hs[hs.STREAM_REMOVE_REASON_PUBLISH_FAILED=1]="STREAM_REMOVE_REASON_PUBLISH_FAILED",hs[hs.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED=2]="STREAM_REMOVE_REASON_KEEP_LIVE_FAILED",hs[hs.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED=3]="STREAM_REMOVE_REASON_CLIENT_DISCONNECTED",hs[hs.STREAM_REMOVE_REASON_REPUBLISH=4]="STREAM_REMOVE_REASON_REPUBLISH",hs[hs.STREAM_REMOVE_REASON_OTHER=5]="STREAM_REMOVE_REASON_OTHER",hs),lp=((hc=lp||{})[hc.CONNECTION_START=0]="CONNECTION_START",hc[hc.CONNECTION_STATE_DISCONNECTED=1]="CONNECTION_STATE_DISCONNECTED",hc[hc.CONNECTION_STATE_CONNECTING=2]="CONNECTION_STATE_CONNECTING",hc[hc.CONNECTION_STATE_CONNECTED=3]="CONNECTION_STATE_CONNECTED",hc[hc.CONNECTION_STATE_RECONNECTING=4]="CONNECTION_STATE_RECONNECTING",hc[hc.CONNECTION_STATE_RECONNECTED=5]="CONNECTION_STATE_RECONNECTED",hc[hc.CONNECTION_STATE_LOST=6]="CONNECTION_STATE_LOST",hc),lv=((hu=lv||{})[hu.MIRROR_TYPE_NONE=0]="MIRROR_TYPE_NONE",hu[hu.MIRROR_TYPE_RENDER=1]="MIRROR_TYPE_RENDER",hu),lf=((hd=lf||{})[hd.domestic=0]="domestic",hd[hd.overseas=1]="overseas",hd),lm=((hl=lm||{})[hl.OFFLINE=0]="OFFLINE",hl[hl.ONLINE=1]="ONLINE",hl[hl.UNREACHABLE=2]="UNREACHABLE",hl),lg=((hh=lg||{})[hh.AUDIO_AND_VIDEO=0]="AUDIO_AND_VIDEO",hh[hh.AUDIO_ONLY=1]="AUDIO_ONLY",hh[hh.VIDEO_ONLY=2]="VIDEO_ONLY",hh),ly=((h_=ly||{})[h_.PREV_FRAME=0]="PREV_FRAME",h_[h_.OTHER_FRAME=1]="OTHER_FRAME",h_),lS=((hp=lS||{})[hp.DISABLE=0]="DISABLE",hp[hp.VIDEO_STREAM_LOW=1]="VIDEO_STREAM_LOW",hp[hp.AUDIO_ONLY=2]="AUDIO_ONLY",hp),lb=((hv=lb||{})[hv.LOW=0]="LOW",hv[hv.MEDIUM=100]="MEDIUM",hv[hv.HIGH=200]="HIGH",hv),lE=((hf=lE||{})[hf.UNKNOWN=0]="UNKNOWN",hf[hf.EXCELLENT=1]="EXCELLENT",hf[hf.GOOD=2]="GOOD",hf[hf.POOR=3]="POOR",hf[hf.BAD=4]="BAD",hf[hf.VBAD=5]="VBAD",hf[hf.DOWN=6]="DOWN",hf),lT=((hm=lT||{})[hm.Unknown=-1]="Unknown",hm[hm.SubscribeFallbackByBandwidth=0]="SubscribeFallbackByBandwidth",hm[hm.SubscribeRecoverByBandwidth=2]="SubscribeRecoverByBandwidth",hm),lk=((hg=lk||{})[hg.communication=0]="communication",hg[hg.chat=5]="chat",hg[hg.chatRoom=6]="chatRoom",hg[hg.coHost=9]="coHost",hg[hg.meeting=16]="meeting",hg[hg.classRoom=18]="classRoom",hg),lI=((hy=lI||{})[hy.default=0]="default",hy[hy.fluent=1]="fluent",hy[hy.standard=2]="standard",hy[hy.hd=3]="hd",hy[hy.standardStereo=4]="standardStereo",hy[hy.hdMono=5]="hdMono",hy),lR=((hS=lR||{})[hS.AUTO_PLAY=0]="AUTO_PLAY",hS[hS.VIDEO_ONLY=1]="VIDEO_ONLY",hS[hS.PLAY_MANUALLY=2]="PLAY_MANUALLY",hS),lA=((hb=lA||{}).LC="LC",hb.HEv1="HEv1",hb.HEv2="HEv2",hb),lC=((hE=lC||{}).H264="H264",hE.H265="H265",hE),lw=((hT=lw||{})[hT.ASR_ONLY=0]="ASR_ONLY",hT[hT.ASR_AND_TRANSLATION=1]="ASR_AND_TRANSLATION",hT),lx=((hk=lx||{})[hk.STARTED=0]="STARTED",hk[hk.STOPPED=1]="STOPPED",hk[hk.ERROR=2]="ERROR",hk),lO=((hI=lO||{})[hI.FORWARD_STREAM_STATE_SUCCESS=0]="FORWARD_STREAM_STATE_SUCCESS",hI[hI.FORWARD_STREAM_STATE_FAILURE=1]="FORWARD_STREAM_STATE_FAILURE",hI),lN=((hR=lN||{})[hR.FORWARD_STREAM_ERROR_OK=0]="FORWARD_STREAM_ERROR_OK",hR[hR.FORWARD_STREAM_ERROR_INVALID_TOKEN=1202]="FORWARD_STREAM_ERROR_INVALID_TOKEN",hR[hR.FORWARD_STREAM_ERROR_RESPONSE=1203]="FORWARD_STREAM_ERROR_RESPONSE",hR[hR.FORWARD_STREAM_ERROR_REMOTE_KICKED=1204]="FORWARD_STREAM_ERROR_REMOTE_KICKED",hR[hR.FORWARD_STREAM_ERROR_NOT_SUPPORT=1205]="FORWARD_STREAM_ERROR_NOT_SUPPORT",hR);function lP(e,t,));return r&&dg(i,r.prototype),i}).apply(null,arguments)}function lD(e){var t="function"==typeof sF?new sF:void 0;return(lD=function(e){var r;if(null===e||-1===cA(r=Function.toString.call(e)).call(r,"[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.,arguments,df(this).constructor)}return n.prototype=iI(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),dg(n,e)})(e)}var lM=function(e){dy(r,lD(Error));var t=dC(r);function r(e,n,i){var o;return iE(this,r),iT(dn(o=t.call(this,n)),"code",void 0),iT(dn(o),"message",void 0),iT(dn(o),"error",void 0),o.code=e,o.message=n,o.error=i,iM(dn(o),r.prototype),o}return ib(r,[{key:"toString",value:function(){var e;return a4(e="SDKError: ".concat(this.code," ")).call(e,this.message)}}]|lU(s,e?[r,n[r]]:n[r]);return s}},lF={entries:lV(!0),values:lV(!1)}.entries;tt({target:"Object",stat:!0},{entries:function(e){return lF(e)}});var lB=J.=1)&&(t+=t))1&n&&(r+=t);return rgth>i&&(o=lH(o,0,i)),e?a+o:o+a)}},lX={start:lK(!1),end:lK(!0)},lW=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(ee),lq=lX.end;tt({target:"String",proto:!0,forced:lW},{padEnd:function(e){return lq(this,e,arguments.length>1?arguments[1]:void 0)}});var lY=ix("String").padEnd,lJ=String.prototype,lQ=function(e){var t=e.padEnd;return"string"==typeof e||e===lJ||$(lJ,e)&&t===lJ.padEnd?lY:t};tt({target:"Number",stat:!0,forced:Number.parseInt!=sp},{parseInt:sp});var lZ=J.Number.parseInt,l$=Math.log,l0=Math.LOG10E;tt({target:"g10||function(e){return l$(e)*l0}});for(var l1,l2,l3,l5,l4,l6,l8,l7,l9,he,ht,hr,hn,hi,ho,ha,hs,hc,hu,hd,hl,hh,h_,hp,hv,hf,hm,hg,hy,hS,hb,hE,hT,hk,hI,hR,hA,hC=J.Math.log10,hw=ix("Array").keys,hx=Array.prototype,hO&&t===hx.keys||eT(hO,tk(e))?hw:t},hP=new Uint8Array(16),hD=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,hM=[],hL=0;hL<256;++hL)hM.push((hL+256).toString(16).substr(1));function hU(e,t,res-not-supported");return hA(hP)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<1ified UUIDretindtion(e){return"number"==typeof e},hj=function(e){var t;return c1(t=Function.prototype.toString.call(e)).call(t,"[native code]")},hG="@byted/ve-rtc",hH="@byted/ve-rtc-cache-size",hz=new(function(){function e(){iE(this,e),iT(this,"storeKey",void 0),iT(this,"logLevel",void 0),iT(this,"LogfileSize",void 0),iT(this,"db",void 0),iT(this,"logId",void 0),iT(this,"cacheLog",void 0),iT(this,"cachedSize",void 0),iT(this,"preCacheTime",void 0),iT(this,"timer",void 0),iT(this,"_getSize",function(e){return new Blob(e).size/1048576}),this.storeKey="",this.logId=1,this.cacheLog="",this.logLevel="none",this.LogfileSize=100,this._createStore()}return ib(e,[{key:"_createStore",value:function(){var e=this;if(!hV()&&window.indexedDB){var t=indexedDB.open("@byted/ve-rtc");t.onupgradeneeded=function(){t.result.createObjectStore(hG);try{localStorage.remtch(e){}},t.e.db=t.result,e._getCachedSize()}}}},{key:"_getCachedSize",value:function(){var e=this;try{var t=localStorage.getItem(hH);t?this.cachedSize=Ne._getSize(t),e._setCachedSize()})}catch(e){}}},{key:"_setCachedSize",value:function(){try{localStorage.setItem(hH,"".concat(this.cachedSize))}catch(e){}}},{key:"_getStore",value:function(e){if(this.db)return this.db.transaction(hG,e).objectStore(hG)}},{key:"set",value:function(e){var t=this;return new aj(function(r,n){if("none"===t.logLevel)return r();if(e&&t.preCacheTime&&t.preCacheTime-Date.now()<1e3)return t.cacheLog+=a4(i="\n\n".concat(t.logId,": ")).call(i,e),t.log=setTimeout(function(){t.set("")},1e3-(t.preCacheTime-Date.now()))),r();clearTimeout(t.timer),t.timer=null;var i,o=t._getStore("readwrite");if(!o)return n("get store fail");t.cachedSize&&t.cachedSize>t.LogfileSize&&t.keyEarliest().then(function(e){t.get(e).then(function(r){t.del(e).then(function(){t.cachedSize=t.cachedSize-t._getSize(["".concat(r)]),t._setCachedSize()})})});var a=o.get(t.storeKey);a.onsuccess=function(){try{var i,s,c,u,d,l,h=a4(s="".concat(a.result||"")).call(s,t.cacheLog),_=e?a4(c=a4(u="".concat(h?"\n\n":"")).call(u,t.logId,": ")).call(c,e):"";o.put(a4(d="".concat(h)).call(d,_),t.storeKey),e&&t.logId++,t.cacheLog="",t.cachedSize=(t.cachedSize||0)+t._getSize([a4(l="".concat(t.cacheLog)).call(l,_)]),t._setCachedSize(),t.preCacheTime=Date.now(),r()}catch(r){if(!e)return n(r);t.cacheLog+=a4(i="\n\n".concat(t.logId,": ")).call(i,e),t.logId++,n(r)}},a.onerror=function(r){var i;if(!e)return n(r);t.cacheLog+=a4(i="\n\n".concat(t.logId,": ")).call(i,e),t.logId++,n(r)}})}},{key:"get",value:function(e){var t=this;return new aj(function(r,n){var i=t._getStore("readonly");if(!i)return n();var o=i.get(e);o.onsuccess=ult)},o.onerror=function(e){n(e)}})}},{key:"del",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.storeKey;return new aj(function(r,n){var i=e._getStore("readwrite");if(!i)return ss=function(){return r(o.result)},o.onerror=function(e){return n(e)}})}},{key:"keyEarliest",value:function(){return hN(this).call(this).then(function(e){var t,r=Date.now();return e.forEach(function(e){if(e&&e.length){var n=e.split("-")[0];Number(n)<r&&(r=Number(n),t=e)}}),t})}},{key:"keys",value:function(){var e=this;return new aj(function(t,r){var n=e._getStore("readonly");if(!n)return r();if(n.getAllKeys){var i=n.getAllKeys();return i.onsuccess=function(){t(i.result)},void(i.onerror=function(){r()})}var o=[];n.openCursor().onsuccess=function(){this.result&&(o.push(this.result.key),this.result.continue())},n.transaction.oncomplete=function(){return t(o)}})}},{key:"values",value:function(){var e=this;return new aj(function(t,r){var n=e._getStore("readonly");if(!n)return r();if(n.getAll){vaonsuccess=funct)},void(i.onerror=function(){r()})}t.value),this.result.contncomplete=function(){return t(o)}})}},{key:"download",value:function(e){e=e||this.storeKey,this.get(e).then(function(t){var r=document.createElement("a");r.download="".concat(e,".txt"),r.href="data:text/paint;utf-8,".concat(t||""),r.click()})}}]),e}()),hK=lX.start;tt({target:"Strits.length>1?arguments[1]:void 0)}});var hX,hW,hq=ix("String"Y||$(hY,e)&&t===hY.padStart?hq:t},hQ="[VERTC]",hZ="#0050b3",h$=(iT(hX={},"DEBUG","rgba(0, 0, 0, 0)"),iT(hX," INFO","rgba(93, 173, 226, 0)"),iT(hX," WARN","rgba(255, 119, 0, 0.3)"),iT(hX,"ERROR","rgba(255, 0, 0, 0.3)"),iT(hX," SUCC","rgba(0, 119, 0, 0.3)"),hX),h0="undefined"!=typeof window&&c1(hW=window.location.search).cald 0),this.module=t,this.indent=r}return ib(e,[{key:"log",value:function(e,t){for(var r,n,i,o,a,s,c,u,d=arguments.length,l=Array(d>2?d-2:0),h=2;h<d;h++)l[h-2]=arguments[h];var _=l.shift();try{var p,v,f,m,g=a4(p=[]).call(pn(){var e=g.shift();return a6(e)});hz.set(a4(v=a4(f=a4(m="".concat(hQ,"[").concat(this.module,".")).call(m,t,"] ")).c.call(g,function(e){return a6(e)}).join(", ")))}catch(e){}if(h0){for(var S="",b=0;b<this.indent;b++)S+="    ";(r=console).log.apply(r,a4(n=[a4(i=a4(o=a4(a=a4(s=a4(c=a4(u="%c".concat(h2(),"-")).call(u,hQ,"%c[")).call(c,e,"]%c")).call(s,S,"[")).call(a,this.module,".")).call(o,t,"] ")).call(i,_),"color:".concat(hZ,";"),"background-color:".concat(h$[e],";"),"color:".concat(hZ,";")]).call(n,l))}}},{key:"print",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.log.apply(this,a4(t=[" INFO",e]).call(t,n))}},{key:"debug",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.log.apply(this,a4(t=["DEBUG",e]).call(t,n))}},{key:"info",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.log.apply(this,a4(t=[" INFO",e]).call(t,n))}},{key:"warn",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.log.apply(this,a4(t=[" WARN",e]).call(t,n))}},{key:"error",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.log.apply(this,a4(t=["ERROR",e]).call(t,n))}},{key:"success",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.log.apply(this,a4(t=[" SUCC",e]).call(t,n))}}]),e}(),h2=function(){var e,t,r=new Date;return a4(e="".concat(r.toTimeString().split(" ")[0],":")).call(e,hJ(t=r.getMilliseconds().toString()).call(t,3,"0"))},h3={};_s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,h3.assign=function(e){for(var t=a$(Array.prototype).call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==im(r))throw TypeError(r+"must be non-object");for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(ey?e.subarray(or(var o=0;o<n,a.set(o,i),i+or(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){returnh3.Buf32=Array,h3.assign(h3,_u))},h3.setTyped(_s);var h5={},h4={},h6={};function h8(e){for(var t=e.length;--t>=0;)e[t]=0}var h7=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],h9=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],_t=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],_r=Array(576);h8(_r);var _n=Array(60);h8(_n);var _i=Array(512);h8(_i);var _o=Array(256);h8(_o);var _a=Array(29);h8(_a);vast_lit);_y(e,256,t)}function _A(e,t){var r,n,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<c;r++)0!==o[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)_I(e,o,r);i=c;do r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],_I(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,_I(e,o,1);while(e.heap_len>=2*i+1])*c[2*i],c[2*i+1]=,u=3):i===a?(c=6,u=3):(c=7,u=4))}function _w(e,t,r){var n,i,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<c&&i===a)){if(s<u)do _y(e,i,e.bl_tree);while(0!=--s);else 0!==i?(i!==o&&(_y(e,i,e.bl_tree),s--),_y(e,16,e.bl_tree),_g(e,s-3,2)):s<=10?(_y(e,17,e.bl_tree),_g(e,s-3,3)):(_y(e,18,e.bl_tree),_g(e,s-11,7));s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}}h8(__);var _x=!1;function _O(e,t,r,n){_g(e,0+(n?1:0),3),_T(e),_m(e,r),_m(e,~r),h3.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}h6._tr_init=function(e){_x||(function(){var e,t,r,n,i,o=Array(16);for(r=0,n=0;n<28;n++)for(_a[n]=r,e=0;e<1<<h7[n];e++)_o[r++]=n;for(_o[r-1]=n,i=0,n=0;n<16;n++)for(__[n]=i,e=0;e<1<<h9[n];e++)_i[i++]=n;for(i>>=7;n<30;n++)for(__[n]=i<<7,e=0;e<1<<h9[n]-7;e++)_i[256+i++]=n;for(t=0;t<=15;t++)o[t]=0;for(e=0;e<=143;)_r[2*e+1]=8,e++,o[8]++;for(;e<=255;)_r[2*e+1]=9,e++,o[9]++;for(;e<=279;)_r[2*e+1]=7,e++,o[7]++;for(;e<=287;)_r[2*e+1]=8,e++,o[8]++;for(_b(_r,287,o),e=0;e<30;e++)_n[2*e+1]=5,_n[2*e]=_S(e,5);_d=new _p(_r,h7,257,286,15),_l=new _p(_n,h9,0,30,15),_h=new _p([],_e,0,19,7)}(),_x=!0),e.l_desc=new _v(e.dyn_ltree,_d),e.d_desc=new _v(e.dyn_dtree,_l),e.bl_desc=new _v(e.bl_tree,_h),e.bi_buf=0,e.bi_valid=0,_E(e)},h6._tr_sree,e.dyn_dtr++),e.last_lit===e.lit_bufsize-1},h6._tr_align=function(e){_g(e,2,3),_y(e,256,_r),16===e.bi_valid?(_m(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)};var _N,_P=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do o=o+(i=i+t[n++]|0)|0;while(--a);i%=652384^e>>>1:e>>>1;t[r]=e}return t}(),_M=function(e,t,r,n){var i=n+r;e^=-1;for(var o=n;o<i;o++)e=e>>>8^_D[255&(e^t[o])];return -1^e},_L={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer ering_buf[e.pending++]=255&t}function _z(e,t){var r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,u=e.window,d=e.w_mask,l=e.prev,h=e.strstart+258,_=u[o+a-1],p=u[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do if(u[(r=t)+a]===p&&u[r+a-1]===_&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do;while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<h);if(n=258-(h-o),o=h-258,n>a){if(e.match_start=t,a=n,n>=s)break;_=u[o+a-1],p=u[o+a]}}while((t=l[t&d])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead}function _K(e){var t,r,n,i,o,a=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-262)){h3.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,t=r=e.hash_size;do n=e.head[--t],e.head[t]=n>=a?n-a:0;while(--r);t=r=a;do n=e.prev[--t],e.prev[t]=n>=a?n-a:0;while(--r);i+=a}if(0===e.strm.avail_in)break;if(r=function(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,h3.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=_P(e.adler,t,i,r):2===e.state.wrap&&(e.adler=_M(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+3-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function _X(e,t){for(var r,n;;){if(e.lookahead<262){if(_K(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-262&&(e.match_length=_z(e,r)),e.match_length>=3){if(n=h6._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask}else n=h6._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(_j(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(_j(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_j(e,!1),0===e.strm.avail_out)?1:2}function _W(e,t){for(var r,n,i;;){if(e.lookahead<262){if(_K(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-262&&(e.match_length=_z(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=h6._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(_j(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=h6._tr_tally(e,0,e.window[e.strstart-1]))&&_j(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=h6._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(_j(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_.strategy=o,s.method=r,_Q(e)}_N=[new _q(0,0,0,0,function(e,t){var r=65535;for(65535>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(_K(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,_j(e,!1),0===e.strm.avail_out)||e.strstart-e.block_start>=e.w_size-262&&(_j(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_j(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(_j(e,!1),e.strm.avail_out),1)}),new _q(4,4,8,4,_X),new _q(4,5,16,8,_X),new _q(4,6,32,32,_X),new _q(4,4,16,16,_W),new _q(8,16,32,32,_W),new _q(8,16,128,128,_W),new _q(8,32,128,256,_W),new _q(32,128,258,1024,_W),new _q(32ion(e,t){return _Z(e,t,8,15,8,0)},h4.deflateInit2=_Z,h4.deflateReset=_Q,h4.deflat.wrap?-2:(e.state.gzhead=t,0):-2},h4.deflate=function(e,t){var r,n,i,o;if(!e||!e.state||t>5||t<0)return e?_U(e,-2):-2;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||666===n.status&&4!==t)return _U(e,0===e.avail_out?-5:-2);if(n.strm=e,r=n.last_flush,n.last_flush=t,42===n.status){if(2===n.wrap)e.adler=0,_G(n,31),_G(n,139),_G(n,8),n.gzhead?(_G(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),_G(n,255&n.gzhead.time),_G(n,n.gzhead.time>>8&255),_G(n,n.gzhead.time>>16&255),_G(n,n.gzhead.time>>24&255),_G(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),_G(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(_G(n,255&n.gzhead.extra.length),_G(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=_M(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(_G(n,0),_G(n,0),_G(n,0),_G(n,0),_G(n,0),_G(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),_G(n,3),n.status=113);else{var a=8+(n.w_bits-8<<4)<<8;a|=(n.strategy>=2||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=113,_H(n,a),0!==n.strstart&&(_H(n,e.adler>>>16),_H(n,65535&e.adler)),e.adler=1}}if(69===n.status){if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=_M(e.adler,n.pending_buf,n.pending-i,i)),_B(e),i=n.pending,n.pending!==n.pending_buf_size));)_G(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=_M(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73}if(73===n.status){if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=_M(e.adler,n.pending_buf,n.pending-i,i)),_B(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,_G(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=_M(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.gzindex=0,n.status=91)}else n.status=91}if(91===n.status){if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=_M(e.adler,n.pending_buf,n.pending-i,i)),_B(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,_G(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=_M(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.status=103)}else n.status=103}if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&_B(e),n.pending+2<=n.pending_buf_size&&(_G(n,255&e.adler),_G(n,e.adler>>8&255),e.adler=0,n.status=113)):n.status=113),0!==n.pending){if(_B(e),0===e.avail_out)return n.last_flush=-1,0}else if(0===e.avail_in&&_V(t)<=_V(r)&&4!==t)return _U(e,-5);if(666===n.status&&0!==e.avail_in)return _U(e,-5);if(0!==e.avail_in||0!==n.lookahead||0!==t&&666(e,!1),0===e.strm.avail_out)?1:2}(n,t):3===n.strategy?function(e,t){for(var r,n,i,o,a=e.window;;){if(e.lookahead<=258){if(_K(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){o=e.strstart+258;do;while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);e.match_length=258-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=h6._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=h6._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(_j(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_j(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_j(e,!1),0===e.strm.avail_out)?1:2}(n,t):_N[n.level].func(n,t);if(3!==s&&4!==s||(n.status=666),1===s||3===s)return 0===e.avail_out&&(n.last_flush=-1),0;if(2===s&&(1===t?h6._tr_align(n):5!==t&&(h6._tr_stored_block(n,0,0,!1),3===t&&(_F(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),_B(e),0===e.avail_out))return n.last_flush=-1,0}return 4!==t?0:n.wrap<=0?1:(2===n.wrap?(_G(n,255&e.adler),_G(n,e.adler>>8&255),_G(n,e.adler>>16&255),_G(n,e.adler>>24&255),_G(n,255&e.total_in),_G(n,e.total_in>>8&255),_G(n,e.total_in>>16&255),_G(n,e.total_in>>24&255)):(_H(n,e.adler>>>16),_H(n,65535&e.adler)),_B(e),n.wrap>0&&(n.wrap=-n.wrap),tate=null,113===t?_U(e,-.input=c,e.avail_in=a,r.wrap=o,0},h4.deflateInfo="pako deflate (from Nodeca project)";var _$={},_0=!0,_1=!0;try{String.fromCharCode.apply(null,[0])}catch(e){_0=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){_1=!1}for(var _2=new h3.Buf8(256),_3=0;_3<256;_3++)_2[_3]=_3>=252?6:_3>=248?ring.fromCharCode(e[n]);return r}_2[254]=_2[254]=1,_$.string2buf=function(e){var t,r,n,i,o,a=e.length,s=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new h3.Buf8(s),o=0,i=0;o<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[o++]=r:(r<2048?t[o++]=192|r>>>6:(r<65536?t[o++]=224|r>>>12:(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63),t[o++]=128|r>>>6&63),t[o++]=128unction(e){return++)t[r]=e.charCodeAt(r);return t},_$.buf2string=function(e,t){var r,n,i,o,a=t||e.length,s=Array(2*a);for(n=0,r=0;r<a;)if((i=e[r++])<128)s[n++]=i;else if((o=_2[i])>4)s[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&r<a;)i=i<<6|63&e[r++],o--;o>1?s[n++]=65533:i<65536?s[n++]=i:(i-=65536,s[n++]=55296|i>>10&1023,s[n++]=56320|1023rn r<0|ll,this.data_type=2,this.adle Error(_L[n]);this._dict_set=!0}}function _7(e,t){var r=new _8(t);if(r.push(e,!0),r.err)throw r.msg||_L[r.err];(this.onEnd(0),i.avail_out=0,!0)},_8.prototype.onData=function(e){this.chis.err=e,this.msg=this.strm.msg},h5.Deflate=_8,h5.deflate=_7,h5.deflateRaw=function(e,t){return(t=t||{}).raw=!0,_7(e,t)},h5.gzip=function(e,t){return(t=t||s&&(t+="v"),e.sticky&&(T(e,"flags")||!$(pt,e)?rn e===pn||$(pn,e)?pr(e):e.flags},po={},pa=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ps=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],pc=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],pu=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],pd=function(e,t){var r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R;r=e.state,n=e.next_in,I=e.input,i=n+(e.avail_in-5),o=e.next_out,R=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),c=r.dmax,u=r.wsize,d=r.whave,l=r.wnext,h=r.window,_=r.hold,p=r.bits,v=r.lencode,f=r.distcode,m=(1<<r.lenbits)-1,g=(1<<r.distbits)-1;e:do for(p<15&&(_+=I[n++]<<p,p+=8,_+=I[n++]<<p,p+=8),y=v[_&m];;){if(_>>>=S=y>>>24,p-=S,0==(S=y>>>16&255))R[o++]=65535&y;else{if(!(16&S)){if(0==(64&S)){y=v[(65535&y)+(_&(1<<S)-1)];continue}if(32&S){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}for(b=65535&y,(S&=15)&&(p<S&&(_+=I[n++]<<p,p+=8),b+=_&(1<<S)-1,_>>>=S,p-=S),p<15&&(_+=I[n++]<<p,p+=8,_+=I[n++]<<p,p+=8),y=f[_&g];;){if(_>>>=S=y>>>24,p-=S,!(16&(S=y>>>16&255))){if(0==(64&S)){y=f[(65535&y)+(_&(1<<S)-1)];continue}e.msg="invalid distance code",r.mode=30;break e}if(E=65535&y,p<(S&=15)&&(_+=I[n++]<<p,(p+=8)<S&&(_+=I[n++]<<p,p+=8)),(E+=_&(1<<S)-1)>c){e.msg="invalid distance too far back",r.mode=30;break e}if(_>>>=S,p-=S,E>(S=o-a)){if((S=E-S)>d&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(T=0,k=h,0===l){if(T+=u-S,S<b){b-=S;do R[o++]=h[T++];while(--S);T=o-E,k=R}}else if(l<S){if(T+=u+l-S,(S-=l)<b){b-=S;do R[o++]=h[T++];while(--S);if(T=0,l<b){b-=S=l;do R[o++]=h[T++];while(--S);T=o-E,k=R}}}else if(T+=l-S,S<b){b-=S;do R[o++]=h[T++];while(--S);T=o-E,k=R}for(;b>2;)R[o++]=k[T++],R[o++]=k[T++],R[o++]=k[T++],b-=3;b&&(R[o++]=k[T++],b>1&&(R[o++]=k[T++]))}else{T=o-E;do R[o++]=R[T++],R[o++]=R[T++],R[o++]=R[T++],b-=3;while(b>2);b&&(R[o++]=R[T++],b>1&&(R[o++]=R[T++]))}break}}break}while(n<i&&o<s);n-=b=p>>3,_&=(1<<(p-=b<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=_,r.bits=p},pl=function(e,t,r,n,i,o,a,s){var c,u,d,l,h,_,p,v,f,m=s.bits,g=0,y=0,S=0,b=0,E=0,T=0,k=0,I=0,R=0,A=0,C=null,w=0,x=new h3.Buf16(16),O=new h3.Buf16(16),N=null,P=0;for(g=0;g<=15;g++)x[g]=0;for(y=0;y<n;y++)x[t[r+y]]++;for(E=m,b=15;b>=1&&0===x[b];b--);if(E>b&&(E=b),0===b)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(S=1;S<b&&0===x[S];S++);for(E<S&&(E=S),I=1,g=1;g<=15;g++)if(I<<=1,(I-=x[g])<0)return -1;if(I>0&&(0===e||1!==b))return -1;for(O[1]=0,g=1;g<15;g++)O[g+1]=O[g]+x[g];for(y=0;y<n;y++)0!==t[r+y]&&(a[O[t[r+y]]++]=y);if(0===e?(C=N=a,_=19):1===e?(C=pa,w-=257,N=ps,P-=257,_=256):(C=pc,N=pu,_=-1),A=0,y=0,g=S,h=o,T=E,k=0,d=-1,l=(R=1<<E)-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){p=g-k,a[y]<_?(v=0,f=a[y]):a[y]>_?(v=N[P+a[y]],f=C[w+a[y]]):(v=96,f=0),c=1<<g-k,S=u=1<<T;do i[h+(A>>k)+(u-=c)]=p<<24|v<<16|f|0;while(0!==u);for(c=1<<g-1;A&c;)c>>=1;if(0!==c?(A&=c-1,A+=c):A=0,y++,0==--x[g]){if(g===b)break;g=t[r+a[y]]}if(g>E&&(A&l)!==d){for(0===k&&(k=E),h+=S,I=1<<(T=g-k);T+k<b&&!((I-=x[T+k])<=0);)T++,I<<=1;if(R+=1<<T,1===e&&R>852||2===e&&R>592)return 1;i[d=A&l]=E<<24|T<<16|h-o|0}}return 0!==A&&(i[e,t))&&(e..whave<o.wsize&&(o.whave+=i))),0}po.inflateReset=pv,po.inflateReset2=pf,po.inflateResetKeep=pp,po.inflateInit=function(e){return pm(e,15)},po.inflateInit2=pm,po.inflate=function(e,t){var r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R=0,A=new h3.Buf8(4),C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return -2;12===(r=e.state).mode&&(r.mode=13),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,u=r.hold,d=r.bits,l=s,h=c,T=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(2&r.wrap&&35615===u){r.check=0,A[0]=255&u,A[1]=u>>>8&255,r.check=_M(r.check,A,2,0),u=0,d=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=30;break}if((15&u)!=8){e.msg="unknown compression method",r.mode=30;break}if(d-=4,E=8+(15&(u>>>=4)),0===r.wbits)r.wbits=E;else if(E>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<E,e.adler=r.check=1,r.mode=512&u?10:12,u=0,d=0;break;case 2:for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(r.flags=u,(255&pi(r))!=8){e.msg="unknown compression method",r.mode=30;break}if(57344&pi(r)){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=u>>8&1),512&pi(r)&&(A[0]=255&u,A[1]=u>>>8&255,r.check=_M(r.check,A,2,0)),u=0,d=0,r.mode=3;case 3:for(;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.head&&(r.head.time=u),512&pi(r)&&(A[0]=255&u,A[1]=u>>>8&255,A[2]=u>>>16&255,A[3]=u>>>24&255,r.check=_M(r.check,A,4,0)),u=0,d=0,r.mode=4;case 4:for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&pi(r)&&(A[0]=255&u,A[1]=u>>>8&255,r.check=_M(r.check,A,2,0)),u=0,d=0,r.mode=5;case 5:if(1024&pi(r)){for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.length=u,r.head&&(r.head.extra_len=u),512&pi(r)&&(A[0]=255&u,A[1]=u>>>8&255,r.check=_M(r.check,A,2,0)),u=0,d=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&pi(r)&&((_=r.length)>s&&(_=s),_&&(r.head&&(E=r.head.extra_len-r.length,r.head.extra||(r.head.extra=Array(r.head.extra_len)),h3.arraySet(r.head.extra,n,o,_,E)),512&pi(r)&&(r.check=_M(r.check,n,_,o)),s-=_,o+=_,r.length-=_),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&pi(r)){if(0===s)break e;_=0;do E=n[o+_++],r.head&&E&&r.length<65536&&(r.head.name+=String.fromCharCode(E));while(E&&_<s);if(512&pi(r)&&(r.check=_M(r.check,n,_,o)),s-=_,o+=_,E)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&pi(r)){if(0===s)break e;_=0;do E=n[o+_++],r.head&&E&&r.length<65536&&(r.head.comment+=String.fromCharCode(E));while(E&&_<s);if(512&pi(r)&&(r.check=_M(r.check,n,_,o)),s-=_,o+=_,E)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&pi(r)){for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}u=0,d=0}r.head&&(r.head.hcrc=pi(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}e.adler=r.check=ph(u),u=0,d=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=d,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){u>>>=7&d,d-=7&d,r.mode=27;break}for(;d<3;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}switch(r.last=1&u,d-=1,3&(u>>>=1))its=9,e.distcode=py,e.distbits=5}(r),r.mode=20,6===t){u>>>=2,d-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}u>>>=2,d-=2;break;case 14:for(u>>>=7&d,d-=7&d;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&u,u=0,d=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(_=r.length){if(_>s&&(_=s),_>c&&(_=c),0===_)break e;h3.arraySet(i,n,o,_,a),s-=_,o+=_,c-=_,a+=_,r.length-=_;break}r.mode=12;break;case 17:for(;d<14;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(r.nlen=257+(31&u),u>>>=5,d-=5,r.ndist=1+(31&u),u>>>=5,d-=5,r.ncode=4+(15&u),u>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;d<3;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.lens[C[r.have++]]=7&u,u>>>=3,d-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,k={bits:r.lenbits},T=pl(0,r.lens,0,19,r.lencode,0,r.work,k),r.lenbits=k.bits,T){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;m=(R=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,g=65535&R,!((f=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(g<16)u>>>=f,d-=f,r.lens[r.have++]=g;else{if(16===g){for(I=f+2;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(u>>>=f,d-=f,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}E=r.lens[r.have-1],_=3+(3&u),u>>>=2,d-=2}else if(17===g){for(I=f+3;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}d-=f,E=0,_=3+(7&(u>>>=f)),u>>>=3,d-=3}else{for(I=f+7;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}d-=f,E=0,_=11+(127&(u>>>=f)),u>>>=7,d-=7}if(r.have+_>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;_--;)r.lens[r.have++]=E}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,k={bits:r.lenbits},T=pl(1,r.lens,0,r.nlen,r.lencode,0,r.work,k),r.lenbits=k.bits,T){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,k={bits:r.distbits},T=pl(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,k),r.distbits=k.bits,T){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=d,pd(e,h),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,u=r.hold,d=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;m=(R=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,g=65535&R,!((f=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(m&&0==(240&m)){for(y=f,S=m,b=g;m=(R=r.lencode[b+((u&(1<<y+S)-1)>>y)])>>>16&255,g=65535&R,!(y+(f=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}u>>>=y,d-=y,r.back+=y}if(u>>>=f,d-=f,r.back+=f,r.length=g,0===m){r.mode=26;break}if(32&m){r.back=-1,r.mode=12;break}if(64&m){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&m,r.mode=22;case 22:if(r.extra){for(I=r.extra;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;m=(R=r.distcode[u&(1<<r.distbits)-1])>>>16&255,g=65535&R,!((f=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(0==(240&m)){for(y=f,S=m,b=g;m=(R=r.distcode[b+((u&(1<<y+S)-1)>>y)])>>>16&255,g=65535&R,!(y+(f=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}u>>>=y,d-=y,r.back+=y}if(u>>>=f,d-=f,r.back+=f,64&m){e.msg="invalid distance code",r.mode=30;break}r.offset=g,r.extra=15&m,r.mode=24;case 24:if(r.extra){for(I=r.extra;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===c)break e;if(_=h-c,r.offset>_){if((_=r.offset-_)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}_>r.wnext?(_-=r.wnext,p=r.wsize-_):p=r.wnext-_,_>r.length&&(_=r.length),v=r.window}else v=i,p=a-r.offset,_=r.length;_>c&&(_=c),c-=_,r.length-=_;do i[a++]=v[p++];while(--_);0===r.length&&(r.mode=21);break;case 26:if(0===c)break e;i[a++]=r.length,c--,r.mode=21;break;case 27:if(r.wrap){for(;d<32;){if(0===s)break e;s--,u|=n[o++]<<d,d+=8}if(h-=c,e.total_out+=h,r.total+=h,h&&(e.adler=r.check=pi(r)?_M(r.check,i,h,a-h):_P(r.check,i,h,a-h)),h=c,(pi(r)?u:ph(u))!==r.check){e.msg="incorrect data check",r.mode=30;break}u=0,d=0}r.mode=28;case 28:if(r.wrap&&pi(r)){for(;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}u=0,d=0}r.mode=29;case 29:T=1;break e;case 30:T=-3;break e;case 31:return -4;default:return -2}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=d,(r.wsize||h!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&pb(e,e.output,e.next_out,h-e.avail_out),l-=e.avail_in,h-=e.avail_out,e.total_in+=l,e.total_out+=h,r.total+=h,r.wrap&&h&&(e.adler=r.check=pi(r)?_M(r.check,i,h,e.next_out-h):_P(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===l&&0===h||4===t&&(t.window=null),e.ap)?-2:(r.head=t,t.done=.mode=31,-4):(r.havedict=1,0):-2},po.inflateInfo="pako inflate (from Nodeca project)";var pE={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEment="",this.hcrc=0,this.done=!1},pk=Object.prototype.toString;function pI(e){if(!(this instanceof pI))return new pI(e);this.options=h3.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _4,this.strm.avail_out=0;var r=po.inflateInit2(this.strm,t.windowBits);if(r!==pE.Z_OK||(this.header=new pT,po.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=_$.string2buf(t.dictionary):"[object ArrayBuffer]"===pk.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=po.inflateSetDictionary(this.strm,t.dictionaryr.msg||_L[r.err];onEnd(pE.Z_OK),s.avail_out=0,!0)},pI.prototype.onData=function(e){this.chis.err=e,this.msg=this.strm.msg},_9.Infla){return(t=t||{}).raw=!0,pR(e,t)},_9.ungzip=pR;var pA=h3.assign,pC={};pA(kitIndexedDB||window.msIndexedDB},pN=function(){var e,t;function r(e){iE(this,r),iT(this,"storeName",void 0),iT(this,"pendingList",[]),this.storeName=e,!hV()&&pO()&&this._checkAndCreateStore(e)}return ib(r,[{key:"_checkAndCreateStore",value:function(e,t){var n=this;r.db&&r.db.close();var i=t?pO().open(px,t):pO().open(px);i.onupgradeneeded=function(){i.result.createObjectStore(e)},i.onerror=function(e){},i.onsuccess=function(){var t,o=i.result;r.db=o;try{r.db.transaction(n.storeName,"readonly"),n.pendingList.forEach((t=a2(a0().mark(function e(t){var r,i,o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.txMode,i=t.resolve,o=t.reject,e.prev=1,e.next=4,n._getStore(r);case 4:a=e.sent,i(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),o();case 11:case"end":return e.stop()}},e,null,[[1,8]])})),function(e){return t.apply(this,arguments)}))}catch(t){n._checkAndCreateStore(e,o.version+1)}}}},{key:"_getStore",value:function(e){var t=this;return new aj(function(n,i){r.db?n(r.db.transaction(t.storeName,e).objectStore(t.storeName)):t.pendingList.push({txMode:e,resolve:n,reject:i})})}},{key:"put",value:(t=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readwrite");case 2:return n=e.sent,e.abrupt("return",new aj(function(e,i){var o=n.put(t,r);o.onsuccess=function(){e()},o.onerror=function(e){i(e)}}));case 4:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"get",value:(e=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readonly");case 2:return r=e.sent,e.abrupt("return",new aj(function(e,n){var i=r.get(t);i.onsuccess=function(){e(i.result)},i.onerror=function(e){n(e)}}));case 4:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})}]),r}();iT(pN,"db",void 0),iT(pN,"state","init");var pP={product_line:"rtc",report_version:"5",os:"web",user_agent:hV()?"":null===(pw=navigator)||void 0===pw?void 0:pw.userAgent,platform:"web",product:"webrtc",app_state:"active"},pD="ReportErrorBuffer",pM=function(){var e,t;function r(){iE(this,r),iT(this,"_buffer",new pN(pD))}return ib(r,[{key:"set",value:(t=a2(a0().maase 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"get",value:(e=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=4,this._buffer.get(pD);case 4:t=e.sent,e.next=9;break;case 7:e.prev=7,e.t0=e.catch(1);case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}},e,this,[[1,7]])})),function(){return e.apply(this,arguments)})}]),r}(),pL=new(function(){var e;function t(){var e=this;iE(this,t),iT(this,"reportCommon",pP),iT(this,"dataBuffer",[]),iT(this,"logBuffer",[]),iT(this,"posting",!1),iT(this,"sucSendTimer",void 0),iT(this,"preSucTime",0),iT(this,"errSendTimer",void 0),iT(this,"errSendDelay",100),iT(this,"errSendBuffer",void 0),iT(this,"_logServerUrl",void 0),iT(this,"_retryCount",0),hV()||(window.addEventListener("beforeunload",function(){clearTimeout(e.errSendTimer),clearTimeout(e.sucSendTimer),e.send(void 0,!0)}),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState?e.setCommonStats({app_state:"active"}):"hidden"===document.visibilityState&&e.setCommonStats({app_state:"background"})}))}return ib(t,[{key:"setUrl",value:function(e){this._logServerUrl=e}},{key:"setCommonStats",value:function(e){this.reportCommon=s8(this.reportCommon,e)er=new pM,this.loadErrorBuffer()}},{key:"push",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?this.send(e):(this.dataBuffer.push(e),!this.posting&&!this.errSendTimer&&Date.now()-this.preSucTime>2e3&&(clearTimeout(this.sucSendTimer),this.send()))}},{key:"unshift",value:function(e){this.dataBuffer=a4(e).call(e,this.dataBuffer)}},{key:"send",value:function(e,t){var r,n,i=this;if((e||this.dataBuffer.length)&&this._logServerUrl){var o={data:e||cV(r=this.dataBuffer).call(r,0,function(e,t){for(var r=0,n=0;n<e.length;n++)if((r+=a6(e[n]).length)>5e5)return n-1;return e.length}(this.dataBuffer,0)),header:dr(dr({},this.reportCommon),{},{http_retry_count:this._retryCount}),from:"web",os:"web",version:"1"},a=new XMLHttpRequest;if(a.timeout=1e4,a.onreadystatechange=function(){if(4===a.readyState){var r,n,s,c;if(e||(i.posting=!1),200===a.status||304===a.status)try{r=JSON.parse(a.responseText)}catch(e){n=e}r&&0===r.StatusCode?e||t||(null===(s=i.errSendBuffer)||void 0===s||s.set([]),i.sucSend()):(setTimeout(function(){var e,t;pY(a4(e="reportor error, res:".concat(null===(t=r)||void 0===t?void 0:t.toString()," err:")).call(e,n),a.status,n)},0),e)?i.send(e):(i.unshift(o.data),null===(c=i.errSendBuffer)||void 0===c||c.set(ud(i.dataBuffer)),t?i.send():i.errSend())}},a.open("POST",this._logServerUrl,!0),e||(this.posting=!0),!hV()&&c1(n=location.search).call(n,"_rtc_debug_"))a.send(a6(o));else{var s=pC.gzip(a6(o));a.setRequestHeader("Content-Encoding","gzip"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.send(s)}}}},{key:"sucSend",value:function(){this.errSendDelay=100,this._retryCount=0,this.preSucTime=Date.now(),this.sucSendTimer=window.setTimeout(this.send.bind(this),2e3)}},{key:"errSend",value:function(){var e=this;th){e.send(),delete e.errSendTimer},this.errSendDelay),this.errSendDelay*=2,this._retryCount++}},{key:"loadErrorBuffer",value:(e=a2(a0().mark(function e(){var t,r,n=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=this.errSendBuffer)||void 0===r?void 0:r.get();case 2:if(e.t1=t=e.sent,e.t0=null!==e.t1,!e.t0){e.next=6;break}e.t0=void 0!==t;case 6:if(!e.t0){e.next=10;break}e.t2=t,e.next=11;break;case 10:e.t2=[];case 11:e.t2.forEach(function(e){n.push(e)});case 13:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})}]),t}()),pU=function(){function e(t){iE(this,e),iT(this,"report_id",0),iT(this,"modify_ids",{}),this.id=t}return ib(e,[{key:"report",value:function(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=dr(dr(dr({event_key:e,report_id:this.report_id++,rtc_timestamp:Date.now()},this.modify_ids),t),{},{common_extra_info:a6(i)});pL.push(o),hV()||null===(r=(n=window).__onRTCReport)||void 0===r||r.calmodify_ids=s8(this.modify_ids,e)}},{key:"destroy",value:function(){}}]),e}(),pV=new h1("MessageReportor",1),pF=function(){function e(t){iE(this,e),iT(this,"_preTime",Date.now()),iT(this,"_one2oneNum",0),iT(this,"_one2manyNum",0),iT(this,"_one2oneMsgCache",new sF),iT(this,"_one2manyMsgCache",new sF),iT(this,"roomId",""),iT(this,"userId",""),iT(this,"rtsSessionId",""),this.id=t}return ib(e,[{key:"needReport",value:function(t){return!!e.config&&(Date.now()-this._preTime>=36e5&&(this._preTime=Date.now(),this._one2oneNum=0,this._one2manyNum=0),"one2one"===t&&this._one2oneNum<e.config.max_one2one_fpt_per_hour&&Math.random()<=e.config.one2one_fpt_ratio/100||"one2many"===t&&this._one2manyNum<e.config.max_one2many_fpt_per_hour&&Math.random()<=e.config.one2many_fpt_ratio/100)}},{key:"cacheP2PMsg",value:function(t){var r;this._one2oneMsgCache.set(t.msg_id,dr({config_version:(null===(r=e.config)||void 0===r?void 0:r.version)||""},t))}},{key:"updateP2PMsg",value:function(e,t){var r=this._one2oneMsgCache.get(e);r&&this._one2oneMsgCache.set(e,dr(dr({},r),t))}},{key:"cacheCustomMsg",value:function(t){var r;this._one2manyMsgCache.set(t.msg_id,dr({config_version:(null===(r=e.config)||void 0===r?void 0:r.version)||""},t))}},{key:"updateOne2ManyMsg",value:function(e,t){var r=this._one2manyMsgCache.get(e);r&&this._one2manyMsgCache.set(e,dr(dr({},r),t))}},{key:"reportP2PMsg",value:function(e){var t,r=this._one2oneMsgCache.get(e);r&&(pV.info("reportP2PMsg",r.type,a6(r)),null===(t=pZ(this.id))||void 0===t||t.report("rts_message",r))}},{key:"reportOne2ManyMsg",value:function(e){var t,r=this._one2manyMsgCache.get(e);r&&(pV.info("reportOne2ManyMsg",r.type,a6(r)),null===(t=pZ(this.id))||void 0===t||t.report("rts_message",r))}},{key:"reportMsgRecv",value:function(t){var r,n;t.config_version=(null===(r=e.config)||void 0===r?void 0:r.version)||"",pV.info("reportMsgRecv",t.type,a6(t)),null===(n=pZ(this.id))||void 0===n||n.report("rts_message",t)}},{key:"destroy",value:function(){this._one2manyNum=0,this._one2oneNum=0,this._one2manyMsgCache.clear(),this._one2oneMsgCache.clear(),this._preTime=Date.now(),this.roomId="",this.userId="",this.rtsSessionId=""}}]),e}();iT(pF,"config",void 0);var pB=new sF,pj={_cache:pB,setConfig:function(e){pV.info("setConfig","get config: ".concat(a6(=pB.get(e);r&&(r.rtsSessionId=t)},createRTSMsgReportor:function(e){var t=pB.get(e)||new pF(e);return pB.e);t&&(t.destroy(),pB.delete(e))},setRoomId:function(e,t){var r=pB.get(e);r&&(r.roomId=t||"")},setUserId:function(e,t){var r=pB.get(e);r&&(r.userId=t||"")},samplingP2PMsg:function(e,t){var r=pB.get(e);if(null!=r&&r.needReport("one2one")){var n,i=a4(n="".concat(t.from)).call(n,t.id),o=t.to?"one2one":"one2server";t.enable_report=!0,t.report_msg_id=t.id,r.cacheP2PMsg({rts_session_id:r.rtsSessionId,msg_id:i,node_role:"src_sdk",from:t.from,to:t.to||"server",type:o,rts_room_id:t.room,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""})}return t},updateP2PMsgReq:function(e,t,r){var n,i;t.enable_report&&hB(t.report_msg_id)&&(null===(n=pB.get(e))||void 0===n||n.updateP2PMsg(a4(i="".concat(t.from)).call(i,t.report_msg_id),{send_ts:Date.now(),msg_size:r}))},updateP2PMsgAck:function(e,t,r){if(t.enable_report&&hB(t.report_msg_id)){var n,i,o=pB.get(e);null==o||o.updateP2PMsg(a4(n="".concat(t.from)).call(n,t.report_msg_id),{ack_ts:Date.now(),error_code:r}),null==o||o.reportP2PMsg(a4(i="".concat(t.from)).call(i,t.report_msg_id))}},samplingOne2ManyMsg:function(e,t,r){var n,i=pB.get(e);return null!=i&&i.needReport("one2many")&&(r.enable_report=!0,r.report_msg_id=t,i.cacheCustomMsg({rts_session_id:i.rtsSessionId,msg_id:a4(n="".concat(r.clientId)).call(n,t),node_role:"src_sdk",from:r.clientId,to:i.roomId,type:"one2many",rts_room_id:i.roomId,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""})),r},reportP2PMsgRecv:function(e,t,r){if(t.enable_report&&hB(t.report_msg_id)){var n,i=pB.get(e),o=t.to?"one2one":"one2many";null==i||i.reportMsgRecv({rts_session_id:i.rtsSessionId,msg_id:a4(n="".concat(t.from)).call(n,t.report_msg_id),msg_size:r.msg_size,node_role:"dst_sdk",type:o,rts_room_id:t.room,from:t.from,to:t.to||t.room,error_code:0,recv_msg_ts:r.recv_msg_ts,fwd_msg_ts:r.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:t.to?"":i.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}},updateOne2ManyMsgAck:function(e,t,r){if(t.enable_report&&hB(t.report_msg_id)){var n,i,o=pB.get(e);o&&(null==o||o.updateOne2ManyMsg(a4(n="".concat(t.clientId)).call(n,t.report_msg_id),{ack_ts:Date.now(),error_code:r}),null==o||o.reportOne2ManyMsg(a4(i="".concat(t.clientId)).call(i,t.report_msg_id)))}},updateOne2ManyMsgReq:function(e,t,r){if(t.enable_report&&hB(t.report_msg_id)){var n,i=pB.get(e);i&&i.updateOne2ManyMsg(a4(n="".concat(t.clientId)).call(n,t.report_msg_id),{send_ts:Date.now(),msg_size:r})}},reportOne2ManyMsgRecv:function(e,t,r){if(t.enable_report&&hB(t.report_msg_id)){var n,i=pB.get(e);null==i||i.reportMsgRecv({rts_session_id:i.rtsSessionId,msg_id:a4(n="".concat(t.clientId)).call(n,t.report_msg_id),msg_size:r.msg_size,node_role:"dst_sdk",type:"one2many",rts_room_id:t.roomId,from:t.clientId,to:t.roomId,error_code:0,recv_msg_ts:r.recv_msg_ts,fwd_msg_ts:r.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:i.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}}},pG=function(){function e(t){iE(this,e),iT(this,"_timer",void 0),iT(this,"userMessage",{}),iT(this,"roomMessage",{}),this.id=t,this._setTimer()}return ib(e,[{key:"_setTimer",value:function(){var e=this;!function t(){e._reportAndgReset(),clearTimeout(e._timer),e._timer=setTimeout(t,1e4)}()}},{key:"_reportAndgReset",value:function(){(sJ(this.userMessage).length||sJ(this.roomMessage).length)&&(this._report(),this._reset())}},{key:"_report",value:function(){var e,t,r,n=this;null===(e=pZ(this.id))||void 0===e||e.report("rtc_message_statistics",{dc_user_message:se(t=sJ(this.userMessage)).call(t,function(e){return n.userMessage[e]}),dc_room_message:ction(e){return n.roomMessage[e]}),media_sererMessage={},this.roomMessage={}}},{key:"_checkInitUserMessage",value:function(e,t){var r,n;this.userMessage[a4(r="".concat(t,"-")).call(r,e)]||(this.userMessage[a4(n="".concat(t,"-")).call(n,e)]={dc_peer_user_id:e,dc_send_total:0,dc_recv_total:0,dc_send_ack:0,dc_send_fail:0,dc_fail_timeout:0,dc_fail_no_receiver:0,dc_fail_no_relay_path:0,dc_cost_time:0,dc_cost_e2s:0,dc_cost_s2s:0,dc_least_time:Number(1/0),dc_most_time:0,dc_cost_peer_s2e:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_message_type:t,dc_send_binary:0})}},{key:"_sendUserMessage",value:function(e,t,r){var n,i;this._checkInitUserMessage(e,t),this.userMessage[a4(n="".concat(t,"-")).call(n,e)].dc_send_total++,r&&this.userMessage[a4(i="".concat(t,"-")).call(i,e)].dc_send_binary++}},{key:"_recvUserMessage",value:function(e,t){var r;this._checkInitUserMessage(e,t),this.userMessage[a4(r="".concat(t,"-")).call(r,e)].dc_recv_total++}},{key:"_sendUserFail",value:function(e,t,r){var n,i=this.userMessage[a4(n="".concat(t,"-")).call(n,e)];i&&(i.dc_send_fail++,this._handleUserFail(i,r))}},{key:"_handleUserFail",value:function(e,t){var r;t&&(t.code||t.err)&&(c1(r=["TIME_OUT","USER_MESSAGE_TIMEOUT"]).call(r,t.code)?e.dc_fail_timeout++:3===t.err?e.dc_fail_no_receiver++:4===t.err?e.dc_fail_no_relay_path++:1===t.err&&e.dc_fail_timeout++)}},{key:"_sendUserAck",value:function(e,t,r,n,i){var o,a=this.userMessage[a4(o="".concat(t,"-")).call(o,e)];a&&(a.dc_send_ack++,a.dc_cost_time+=r,a.dc_cost_s2s+=n||0,a.dc_cost_peer_s2e+=i,a.dc_cost_e2s+=r-(n||0)-i,r<=100?(a.dc_send_ack_100++,a.dc_send_ack_200++,a.dc_send_ack_400++,a.dc_send_ack_1s++):r<=200?(a.dc_send_ack_200++,a.dc_send_ack_400++,a.dc_send_ack_1s++):r<=400?(a.dc_send_ack_400++,a.dc_send_ack_1s++):r<=1e3&&a.dc_send_ack_1s++,r<a.dc_least_time&&(a.dc_least_time=r),r>a.dc_most_time&&(a.dc_most_time=r))}},{key:"sendRoomMessage",value:function(e,t){this.roomMessage[e]||(this.roomMessage[e]={dc_room_id:e,dc_send_total:0,dc_send_ack:0,dc_cost_time:0,dc_least_time:Number(1/0),dc_most_time:0,dc_send_fail:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_send_binary:0}),this.roomMessage[e].dc_send_total++,t&&this.roomMessage[e].dc_send_binary++}},{key:"sendRoomFail",value:function(e){var t=this.roomMessage[e];t&&t.dc_send_fail++}},{key:"sendRoomAck",value:function(e,t){var r=this.roomMessage[e];r&&(r.dc_send_ack++,r.dc_cost_time+=t,t<r.dc_least_time&&(r.dc_least_time=t),t>r.dc_most_time&&(r.dc_most_time=t),t<=100?(r.dc_send_ack_100++,r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=200?(r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=400?(r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=1e3&&r.dc_send_ack_1s++)}},{key:"sendP2PMessage",value:function(e,t){this._sendUserMessage(e,"p2p",t)}},{key:"recvP2PMessage",value:function(e){this._recvUserMessage(e,"p2p")}},{key:"sendP2PFail",value:function(e,t){this._sendUserFail(e,"p2p",t)}},{key:"sendP2PAck",value:function(e,t,r,n){this._sendUserAck(e,"p2p",t,r,n)}},{key:"sendP2POutRoomMessage",value:function(e,t){this._sendUserMessage(e,"p2p_outside_room",t)}},{serMessage(e,"p2p_outside_room")}UserFail(e,"p2p_outside_room",t)rAck(e,"p2p_outside_room",t,r,n)}},{key:"sendP2serverMessage",value:function(e){this._sendUserMessage("","p2server",es._sendUserFail("","p2server",e)}},{key:"sendP2serveAck",value:function(e,t,r){this._sendUserAck("","p2server",e,t,r)}},{key:"countP2PMessage",value:function(e,t,r,n,i){this.sendP2PMessage(t,r),e?this.sendP2PAck(t,Date.now()-n,i.s2s_time,i.s2e_time):this.sendP2PFail(t,i)}},{key:"countRoomMessage",value:function(e,t,r,n){this.sendRoomMessage(t,r),e?this.sendRoomAck(t,Date.now()-n):this.sendRoomFail(t)}},{key:"countUserMessageOutsideRoom",value:function(e,t,r,n,i){this.sendP2POutRoomMessage(t,r),e?this.sendP2POutRoomAck(t,Date.now()-n,i.s2s_time,i.s2e_time):this.sendP2POutRoomFail(t,i)}},{key:"countServerMessage",value:function(e,t,r,n){this.sendP2serverMessage(t),e?(n=n||{},this.sendP2serveAck(Date.now()-r,n.s2s_time||0,n.s2e_time||0)):this.sendP2sereset(),clearTimeout(this._timer)}}]),e}(),pH=function(e){pL.setCommonStats(e)},pz=function(e){pL.setUrl(e)},pK=function(){pL.enableErrorBuffer()},pX=new pU("global"),pW=function(e,t,r){pX.report("rtc_sdk_api_call",{sdk_api_na_naror",{message:e,error_code:t},r)},pJ=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;pX.report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:n,elapse:0},i)},pQ=new sF,pZ=function(e){return pQ.get(e)},p$=function(e,t){var r=new pU(e);return r.set(dr(dr({},t),{},{engine_session_id:hF()})),r.report("sdk_init_engine",{start:Date.now(),type:"begin"}),pQ.set(e,r),r},p0=function(e){e.report("sdk_init_engine",{start:Date.now(),type:"end"}),pQ.delete(e.id)};function p1(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r,n){if("function"==typeof n.value){var i=n.value;n.value=function(){for(var e,n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];var s,c,u=this.forEach(function(e,t){d[e]=o[t]}),"joinRoom"===r&&(null===(s=pZ(u))||void 0===s||s.set({room_id:o[1],user_id:null===(c=o[2])||void 0===c?void 0:c.userId})),null===(e=pZ(u))||void 0===e||e.report("rtc_sdk_api_call",{sdk_api_name:r,message:a6(p5(o)),error_code:0},d);var l=i.apply(this,o);return"function"==typeof(null==l?void 0:l.then)?l.then(function(e){return p2(u,r,[e||{}]),e}).catch(function(e){throw p2(u,r,e.message,e.code),e}):(p2(u,r,[l||{}]),l)}}}}var p2=function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0,a={sdk_callback_name:t,error_code:i,message:a6(Array.isArray(r)?p5(r):r)};o&&(a.room_id=o),null===(n=pZ(e))||void 0===n||n.report("rtc_sdk_callback",a)},p3=function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5?arguments[5]:void 0;null===(n=pZ(e))||void 0===n||n.report("rtc_invoke_status",{sdk_api_name:t,message:r,error_code:i,stream_id:o,elapse:0},a)};function p5(e){return se(e).call(e,function e(t){var r;if(null!=t&&t._reportName)return t._reportName;if(t instanceof HTMLElement)return t.toString();if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){var n,i,o=ArrayBuffer.isView(t)?t.buffer:t,a=o.byteLength,s=[];if(a>10){var c,u,d,l,h=new DataViewnction(e,t){return h.getUint8(t)}),p=se(u=se(d=uc({length:5})).call(d,function(e,t){return a-1-t}).reverse()).call(u,function(e){return h.getUint8(e)});s=a4(l=[]).call(l,ud(_),["..."],ud(p))}else s=uc(new Uint8Array(o));return a4(n=a4(i="".concat(t.constructor.name,"(")).call(i,a,") [")).call(n,s.join(", "),"]")}if(t instanceof ImageData)return"ImageData";if(Array.isArray(t))return se(t).call(t,e);if(c1(r=["[object Object]","[object MediaStreamTrack]"]).call(r,Object.prototype.toString.call(t))){var v={};for(var f in t)v[f]=e(t[f]);return v}return t})}var p4=function(e){var t,r,n=pZ(e.engineId),i={keys:hN(e),labelSelector:"",sdkVersion:e.sdkVersion,deviceType:"web",appId:e.appId},o=se(r=e.requestDomains).call(r,function(e){return"https://".concat(e,"/decision/v1/multi")});null==n||n.report("rtc_get_config",{error_code:0,message:a6(i),elapse:0,host:o.join(","),type:"request",config_id:"",enable_cloud_proxy:!1});var a=se(o).call(o,(t=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:a6(i)}).then(function(e){return e.json()});case 2:return n=e.sent,e.abrupt("return",{result:n,index:r});case 4:case"end":return e.stop()}},e)})),function(e,r){return t.apply(this,arguments)}));return new aj(function(e){var t;(t=a,new aj(function(e,r){var n=(t=Array.isArray(t)?t:[]).length,i=[];0===n?r([]):t.forEach(function(t){t.then(function(t){e(t)},function(e){n--,i.push(e),0===n&&r(i)})})})).then(function(t){var r=t.result,i=t.index;null==n||n.report("rtc_get_config",{error_code:200,message:a6(r),elapse:0,host:o[i],type:"response",config_id:"",enable_cloud_proxy:!1}),e(r)}).catch(function(e){var t;null==n||n.report("rtc_get_config",{error_code:500,message:null===(t=e[0])||void 0===t?void 0:t.message,elapse:0,host:"",type:"response",config_id:"",enable_cloud_proxy:!1})})})},p6=new TextDecoder,p8=new TextEncoder,p7=function(){return hU()},p9=function(){return Date.now()};function ve(e){for(var t=0,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var o=0;o<n.length;o++)t+=n[o].length;for(var a=new e(t),s=0,c=0;c<n.length;c++){var u=n[c];a.set(u,s),s+=u.length}return a}var vt=function(){var e,t;function r(){iE(this,r)}return ib(r,null,[{key:"token2auth",value:function(e,t,n,i){return i?"Bearer ".concat(i):"Basic ".concat(r.createUnsafeToken(e,t,n))}},{key:"createUnsafeToken",value:function(e,t,r){var n;returnll(n,function(e){return null!==e}).join(":"))}},{key:"merge",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0,i=lB(e);n<i.length;n++){var o=u3(i[n],2),a=o[0],s=o[1];null!==s&&"object"===im(s)?r.merge(e[a],t[a]):void 0!==t[a]&&(e[a]=t[a])}}},{key:"ab2str",value:function(e){return pJSON.parse(t)}catch(eon(e){return p8.encode(e).buffer}},{key:"ab2b64str",value:(t=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new aj(function(e){var r=new FileReader;r.onload=function(){return e(r.result)},r.readAsDataURL(new Blob([t]))});case 2:return r=e.sent,e.abrupt("return",r.split(",",2)[1]);case 4:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})},{key:"b64str2ab",value:(e=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("data:application/octet;base64,".concat(t)).then(function(e){return e.arrayBuffer()}));case 1:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})}]),r}();function vr(){for(var e,t,r=Number(lQ(e=a$(t="".concat(Math.random())).call(t,-7)).call(e,7,"0")).toString(2),n=lQ(r).call(r,28,"1").split(""),i=[];n.length;)i.push(cV(n).call(n,0,7));return se(i).call(i,function(e,t){return lZ((t===i.length- Math.floor(65535*Math.random())};function vi(e){return"string"==typeof e&&cA(e).call(e,"__web__rtc__rtt__")>-1}var vo=(vv=a2(a0().mark(function e(){var t,r,n,i=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],(r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"})).createDataChannel("default"),r.addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),t&&(r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"sendonly"})),e.next=8,r.createOffer();case 8:return n=e.sent,r.close(),e.abrupt("return",n.sdp);case 11:case"end":return e.stop()}},e)})),function(){return vv.apply(this,arguments)}),va=function(e){return new aj(function(t,r){var n=(e=Array.isArray(e)?e:[]).length,i=[];0===n?r([]):e.forEach(function(e){e.then(function(e){t(e)},function(e){n--,i.push(e),0===n&&r(i)})})})};function vs(e){return Number(Math.max(-127,10*hC(Math.pow(e/255,2))).toFixed(2))}function vc(e){return(e&lh.AUDIO)===lh.AUDIO}function vu(e){return(e&lh.VIDEO)===lh.VIDEO}function vd(e){var t={};return sJ(e).forEach(function(r){"object"===im(e[r])?t[r]=vd(e[r]):d9(r).call(r,"_")||(t[r]=e[r])}),t}function vl(e){return null==e?"undefined | null":"string"==typeof e?e:a6({contentHint:e.contentHint,enabled:e.enabled,id:e.id,kind:e.kind,label:e.label,muted:function vh(e){return void 0===e}function v_(e){return funcuments[r];return n.apply(this,t)}}}function vp(e){return"number"==typeof e?e:"number"==typeof(null==e?void 0:e.exact)?e.exact:"number"==typeof(null==e?void 0:e.ideal)?e.ideal:"number"==typeof(null==e?void 0:e.max)?e.max:"number"==typeof(null==e?void 0:e.min)?e.min:1}var vv,vf,vm,vg,vy,vS,vb,vE,vT,vk,vI=((vf=vI||{}).onTrackEnded="onTrackEnded",vf.onTrackMute="onTrackMute",vf.onTrackUnmute="onTrackUnmute",vf.onPlayerEvent="onPlayerEvent",vf.onAutoplayFailed="onAutoplayFailed",vf.onUserJoined="onUserJoined",vf.onUserLeave="onUserLeave",vf.onConnectionStateChanged="onConnectionStateChanged",vf.onUserPublishStream="onUserPublishStream",vf.onUserUnpublishStream="onUserUnpublishStream",vf.onUserPublishScreen="onUserPublishScreen",vf.onUserUnpublishScreen="onUserUnpublishScreen",vf.onRoomMessageReceived="onRoomMessageReceived",vf.onRoomBinaryMessageReceived="onRoomBinaryMessageReceived",vf.onUserMessageReceived="onUserMessageReceived",vf.onUserBinaryMessageReceived="onUserBinaryMessageReceived",vf.onVideoFirstFrameRendered="onVideoFirstFrameRendered",vf.onVideoFirstFrameDecoded="onVideoFirstFrameDecoded",vf.onRemoteVideoFirstFrame="onRemoteVideoFirstFrame",vf.onAudioFirstFrameDecoded="onAudioFirstFrameDecoded",vf.onRemoteAudioFirstFrame="onRemoteAudioFirstFrame",vf.onFirstPublicStreamVideoFrameRendered="onFirstPublicStreamVideoFrameRendered",vf.onFirstPublicStreamVideoFrameDecoded="onFirstPublicStreamVideoFrameDecoded",vf.onFirstPublicStreamAudioFrameDecoded="onFirstPublicStreamAudioFrameDecoded",vf.onVideoDeviceStateChanged="onVideoDeviceStateChanged",vf.onAudioDeviceStateChanged="onAudioDeviceStateChanged",vf.onRemoteStreamStats="onRemoteStreamStats",vf.onPublicStreamStats="onPublicStreamStats",vf.onLocalStreamStats="onLocalStreamStats",vf.onAudioVolumeIndication="onAudioVolumeIndication",vf.onLocalAudioPropertiesReport="onLocalAudioPropertiesReport",vf.onRemoteAudioPropertiesReport="onRemoteAudioPropertiesReport",vf.onActiveSpeaker="onActiveSpeaker",vf.onAudioPlaybackDeviceChanged="onAudioPlaybackDeviceChanged",vf.onUserStartVideoCapture="onUserStartVideoCapture",vf.onUserStopVideoCapture="onUserStopVideoCapture",vf.onUserStartAudioCapture="onUserStartAudioCapture",vf.onUserStopAudioCapture="onUserStopAudioCapture",vf.onAutoPublishResult="onAutoPublishResult",vf.onAutoSubscribeResult="onAutoSubscribeResult",vf.onLiveTranscodingResult="onLiveTranscodingResult",vf.onStreamMixingEvent="onStreamMixingEvent",vf.onAudioPlaybackDeviceTestVolume="onAudioPlaybackDeviceTestVolume",vf.onSEIMessageReceived="onSEIMessageReceived",vf.onError="onError",vf.onAudioMixingStateChanged="onAudioMixingStateChanged",vf.onUserMessageReceivedOutsideRoom="onUserMessageReceivedOutsideRoom",vf.onUserBinaryMessageReceivedOutsideRoom="onUserBinaryMessageReceivedOutsideRoom",vf.onTokenWillExpire="onTokenWillExpire",vf.onCloudProxyConnected="onCloudProxyConnected",vf.onPushPublicStreamResult="onPushPublicStreamResult",vf.onPublicStreamSEIMessageReceived="onPublicStreamSEIMessageReceived",vf.onNetworkQuality="onNetworkQuality",vf.onSimulcastSubscribeFallback="onSimulcastSubscribeFallback",vf.onRemoteVideoSizeChanged="onRemoteVideoSizeChanged",vf.onVideoStreamBanned="onVideoStreamBanned",vf.onAudioStreamBanned="onAudioStreamBanned",vf.onLocalVideoSizeChanged="onLocalVideoSizeChanged",vf.onSubtitleStateChanged="onSubtitleStateChanged",vf.onSubtitleMessageReceived="onSubtitleMessageReceived",vf.onServerParamsSetResult="onServerParamsSetResult",vf.onLocalStreamTrackChangedByExtension="onLocalStreamTrackChangedByExtension",vf.onVendorConnectionStateChanged="onVendorConnectionStateChanged",vf.onForwardStreamError="onForwardStreamError",vf.onRejoinWithTcp="onRejoinWithTcp",vf.onIceConnectWithTcp="onIceConnectWithTcp",vf),vR=function(){return"undefined"==typeof window},vA=vR()?"":window.navigator.userAgent;function vC(){var e="none";return vR()||(null!==vA.match("Firefox")?e="mozilla":null!==vA.match("Chrome")?(e="chrome-stable",null!==vA.match("Electron")&&(e="electron")):(null!==vA.match("Safari")||null!==vA.match("AppleWebKit"))&&(e="safari")),e}var vw="mozilla"===vC(),vx="safari"===vC(),vO="chrome-stable"===vC(),vN=!vR()&&/CriOS/i.test(vA),vP=!vR()&&/Edg\//i.test(vA),vD=!vR()&&/EdgA/i.test(vA),vM=!vR()&&/EdgiOS/i.test(vA),vL=vP||vD||vM;vR()||/(iPhone|iPod)/i.exec(vA);var vU=!vR()&&(!!/(iPad)/i.exec(vA)||/Macintosh/i.test(vA)&&"ontouchend"in document),vV=!vR()&&/Macintosh/i.test(vA),vF=!vR()&&/MicroMessenger/i.test(vA),vB=!vR()&&c1(vm=vA.toLowerCase()).call(vm,"mobile");vR()||/SM-\w+/i.test(vA);var vj=!vR()&&!!/(iPhone|iPad|iPod)/i.exec(vA),vG=!vR()&&/Android/i.test(vA),vH=!vR()&&/Windows/i.test(vA),vz=0,vK=!vR()&&(null===(vg=vA.match(/version\/(\d+)/i))||void 0===vg?void 0:vg[1]);vx&&vK&&(vz=Number(vK));var vX=!vR()&&(null===(vy=vA.match(/Firefox\/(\d+)/i))||void 0===vy?void 0:vy[1]);vw&&vX&&(vz=Number(vX));var vW=vz,vq=vz,vY=null!==(vS=!vR()&&(null===(vb=vA.match(/ ([\d_]+) like Mac OS X/i))||void 0===vb||null===(vE=vb[1])||void 0===vE?void 0:se(vT=vE.split("_")).call(vT,function(e){return sv(e)})))&&void 0!==vS?vS:[],vJ=0,vQ=!vR()&&(null===(vk=vA.match(/Chrome\/(\d+)/i))||void 0===vk?void 0:vk[1]);vQ&&(vJ=Number(vQ));var vZ=vJ,v$="VolcEngine",v0="RTC_DEVICE_ID",v1="RTC_ACCESS_NODE",v2="RTC_ACCESS_URLS",v3="ENGINE_WEB_CONFIG",v5=function(){function e(){iE(this,e)}return ib(e,[{key:"get",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{var r=JSON.parse(t);return r.ttl>0&&Date.now()-r.saveTime>r.ttl?(this.delete(e),null):r.message}catch(e){return null}}},{key:"set",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n={ttl:r,saveTime:Date.now(),message:t};try{return localStorage.setItem(e,a6(n)),!0}catch(e){return!1}}},{key:"getTtl",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{return JSON.parse(t).ttl}catch(e){roveItem(e),!0}catch(e){return!1}}}]),e}(),v4=new(function(e){dy(r,v5);var t=dC(r);function r(){return iE(this,r),t.apply(this,arguments)}return ib(r,[{key:"getDeviceId",value:function(){if(vR())return"";var e=this.get(v0);return e&&!/^[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}$/.test(e)||(e=function(e){for(var t="",r=0;r<30;r++)t+=Math.floor(10*Math.random());return t}(0)),this.setDeviceId(e),e}},{key:"setDeviceId",value:function(e){return pH({device_id:e}),this.set(v0,e),e}},{key:"getAccessNode",value:function(e){var t;return this.get(a4(t="".concat(v1,"_").concat(e,"-")).call(t,v$))}},{key:"setAccessNode",value:function(e,t,r){var n;return this.set(a4(n="".concat(v1,"_").concat(e,"-")).call(n,v$),t,1e3*r)}},{key:"deleteAccessNode",value:function(e,t){var r,n=this.getAccessNode(e),i=this.getTtl(a4(r="".concat(v1,"_").concat(e,"-")).call(r,v$));Array.isArray==t.mediaID&&e.msgKey!==t.msgKey})).length>0?this.setAccessNode(e,n,i||0):this.clearAccessNode(e))}},{key:"clearAccessNode",value:function(e){var t;this.delete(a4(t="".concat(v1,"_").concat(e,"-")).call(t,v$))}},{key:"getAccessUrls",value:function(){return this.get("".concat(v2,"-").concat(v$))}},{key:"setAccessUrls",value:function(e){var t=se(e).call(e,function(e){var t,r=e.host,n=e.path;return a4(t="https://".concat(r)).call(t,n)});return this.set("".concat(v2,"-").concat(v$),t)}},{key:"clearAccessUrls",value:function(){this.delete("".concat(v2,"-").concat(v$))}},{key:"getEngineWebConfig",value:function(e,t){var r,n,i,o=a4(r=a4(n="".concat(e,"_")).call(n,t,"_")).call(r,this.getDeviceId()),a=this.get(v3);return(null==a||null===(i=cS(a).call(a,function(e){return e.key===o}))||void 0===i?void 0:i.config)||{}}},{key:"setEngineWebConfig",value:function(e,t,r){var n,i;if(r){var o=a4(n=a4(i="".concat(e,"_")).call(i,t,"_")).call(n,this.getDeviceId()),a=this.l(a,function(e){return e.key!==o})).push({key:o,config:r}),this.set(v3,a$(a).call(a,-5))}}}]),r}()),v6=new h1("JoinRoomConfig",0),v8=function(){function e(t){var r;iE(this,e),iT(this,"_useTcpAfterJoinTimeout",e.DEFAULT_CONF.useTcpAfterJoinTimeout),iT(this,"_joinWithTcpOnly",e.DEFAULT_CONF.joinWithTcpOnly),iT(this,"_joinWithTcpOnlyDelay",e.DEFAULT_CONF.joinWithTcpOnlyDelay),iT(this,"_blackBrowserRegexList",[]),this._engineId=t,cA(r=location.search).call(r,"__rtc_tcp_only__")>-1&&(this._joinWithTcpOnly=!0,this._joinWithTcpOnlyDelay=0),this._report()}return ib(e,[{key:"useTcpAfterJoinTimeout",get:function(){return this._useTcpAfterJoinTimeout}},{key:"useTcpJoin",get:function(){return this._joinWithTcpOnly}},{key:"useTcpJoinDelay",get:function(){return this._joinWithTcpOnlyDelay}},{key:"isBlackBrower",value:function(){var e;return cS(e=thExp(e).test(navigator.userAgent)})}},{key:"setServerConfig",value:function(e){var t,r,n,i,o,a,s=!1;"boolean"==typeof(null==e||null===(t=e.use_tcp_after_join_timeout)||void 0===t?void 0:t.enable)&&(this._useTcpAfterJoinTimeout=null===(i=e.use_tcp_after_join_timeout)||void 0===i?void 0:i.enable,s=!0),"boolean"==typeof(null==e||null===(r=e.join_with_tcp_only)||void 0===r?void 0:r.enable)&&(this._joinWithTcpOnly=null===(o=e.join_with_tcp_only)||void 0===o?void 0:o.enable,s=!0),"number"==typeof(null==e||null===(n=e.join_with_tcp_only)||void 0===n?void 0:n.delay_ms)&&(this._joinWithTcpOnlyDelay=null===(a=e.join_with_tcp_only)||void 0===a?void 0:a.delay_ms,s=!0),e&&Array.isArray(e.black_browser_regex_list)&&(this._blackBrowserRegexList=e.black_browser_regex_list,s=!0),s&&this.st:this._blackBrowserRegexList})}},{key:"_report",value:function(){v6.print("_report",this.toString()),p3(this._engineId,"web_join_room_config",this.toString())}}],[{key:"setDefaulConf",value:function(t){var r=t.useTcpAfterJoinTimeout,n=t.joinWithTcpOnly,i=t.joinWithTcpOnlyDelay;return"boolean"==typeof r&&(e.DEFAULT_CONF.useTcpAfterJoinTimeout=r),"boolean"==typeof n&&(e.DEFAULT_CONF.joinWithTcpOnly=n),"number"==typeof i&&(e.DEFAULT_CONF.joinWithTcpOnlyDelay=Math.max(0,i)),e.DEFAULT_CONF}}]),e}();iT(v8,"DEFAULT_CONF",{useTcpAfterJoinTimeout:!0,joinWithTcpOnly:!1,joinWithTcpOnlyDelay:5e3});var v7="access.rtc.volcvideo.com,access2-hl.rtc.volcvideo.com,rtcg-access.volcvideos.com".split(",");function v9(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://".concat(e)),"".concat(e,"/dispatch/v1/AccessInfo?Action=GetAccessInfo")}var fe="https://web-log-report.rtc.volcvideo.com/video/v1/webrtc_log/",ft={VERSION:"4.55.4",ICE_CONFIG_REQUEST_URLS_INTERNAL:se(v7).call(v7,v9),ICE_CONFIG_REQUEST_URLS:[],EXPECTED_ADDR:"",LOG_SERVER_URL:fe,CONFIG_REQUEST_DOMAINS:"common.rtc.volcvideo.com,rtcg.volcvideos.com".split(","),DEVICE_ID:"",OVERSEA:!1,PLATFORM:"",PRODUCT:"",FORCE_ENABLED_REPORT_CALLBACKS:[],SKIP_WEB_AUDIO_IN_TRACK:!1,AUDIO_STALL:!0,VIDEO_STALL:!0,STATS_SCALLBACK_SUPPORT:!0,JOIN_ROOM_CONFIG:v8.DEFAULT_CONF,IOS_SAFARI_ORIENTATION:!1,ENABLE_REPORT_ERROR_BUFFER:!1,PUB_SUB_MODE:"recv_and_send"};function fr(e,t){var r;if(pW("setParameter",0,a4(r="key: ".concat(e,", value: ")).call(r,t)),"VERSION"!==e){if("JOIN_ROOM_CONFIG"===e)return v8.setDefaulConf(t);if("ICE_CONFIG_REQUEST_URLS"===e)return"string"==typeof t&&(t=[t]),void(ft.ICE_CONFIG_REQUEST_URLS=se(t).call(t,v9));if("PLATFORM"!==e||"string"!=typeof t){if("PRODUCT"!==e||"string"!=typeof t){if("FORCE_ENABLED_REPORT_CALLBACKS"===e)return"string"==typeof t&&(t=[t]),void(ft.FORCE_ENABLED_REPORT_CALLBACKS=t);if("LOG_SERVER_URL"===e){var n=t===lf.overseas?"https://web-log-report.volcvideos.com/video/v1/webrtc_log//":t===lf.domestic?fe:"string"==typeof t?t:void 0;n&&(ft.LOG_SERVER_URL=n,pz(n))}else if("OVERSEA"===e)return pH({extra_is_oversea:t?"1":"0"}),void(ft.OVERSEA=t);"DEVICE_ID"===e&&v4.setDeviceId(t),"ENABLE_REPORT_ERROR_BUFFER"===e&&t&&pK(),ft[e]=t}else pH({product:t})}else pH({platform:t})}}function fn(e){return"DEVICE_ID"===e?v4.getDeviceId():ft[e]}function fi(e,t,r){var n,i,o,a,s,c,u,d,l;return{type:"publicstream",action:t,publicStreamID:e,publicStreamMeta:{audio:{},video:{fps:(null===(n=r.video)||void 0===n?void 0:n.fps)||15,bitrate:1e3*((null===(i=r.video)||void 0===i?void 0:i.kBitRate)||40),width:(null===(o=r.video)||void 0===o?void 0:o.width)||640,height:(null===(a=r.video)||void 0===a?void 0:a.height)||360},layout:{layoutMode:2,interpolationMode:(null===(s=r.layout)||void 0===s?void 0:s.interpolationMode)||ly.PREV_FRAME,canvas:{bgColor:(null===(c=r.layout)||void 0===c?void 0:c.backgroundColor)||"#000000",bgImage:(null===(u=r.layout)||void 0===u?void 0:u.backgroundImage)||""},regions:(null===(d=r.layout)||void 0===d||null===(l=d.regions)||void 0===l?void 0:se(l).call(l,function(e){return{roomId:e.roomId,userId:e.userId,alterImage:e.alertImage||"",alpha:!e.alpha||Number(e.alpha)>1||0>=Number(e.alpha)?1:Number(e.alpha),x:!e.x||Number(e.x)>=1||0>Number(e.x)?0:Number(e.x),y:!e.y||Number(e.y)>=1||0>Number(e.y)?0:Number(e.y),w:!e.w||Number(e.w)>1||0>=Number(e.w)?1:Number(e.w),h:!e.h||Number(e.h)>1||0>=Number(e.h)?1:Number(e.h),zorder:!e.zorder||0>Number(e.zorder)||Number(e.zorder)>100?0:Number(e.zorder),renderMode:void 0===e.renderMode?1:e.renderMode,streamType:e.isScreenStream?1:0,mediaType:e.mediaType||0,sourceCrop:e.sourceCrop}}))||[]}}}}var fo={width:640,height:480,frameRate:15,maxKbps:600},fa={width:1920,height:1080,frameRate:15,maxKbps:3e3};function fs(e,t){if("boolean"!=typeof e)throw new lM(le.INVALID_PARAMS,"Invalid ".concat(t,": The value should be boolean type."))}function fc(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(e<i||e>o||"number"!=typeof e)throw new lM(le.INVALID_PARAMS,a4(r=a4(n="Invalid ".concat(t,": the value range is [")).call(n,i,", ")).call(r,o,"]. integer only"))}function fu(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(null==e)throw new lM(le.INVALID_PARAMS,"".concat(t," cannot be empty"));if(!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"string"==typeof e&&e.length<=r&&e.length>=t}(e,i,o))throw new lM(le.INVALID_PARAMS,a4(r=a4(n="Invalid ".concat(t,": The value should be string type. Length of the string: [")).call(n,i,",")).call(r,o,"]"))}function fd(e,t,r){var n;if(!c1(r).call(r,e))throw new lM(le.INVALID_PARAMS,a4(n="Invalid ".concat(t,": The value can only be set as ")).call(n,a6(r)))}function fl(e){if(!(e instanceof MediaStreamTrack))throw new lM(le.INVALID_PARAMS,"Invalid track, The value should be MediaStreamTrack type.")}function fh(e,t){if(fv(e))throw new lM(le.INVALID_PARAMS,"Invalid ".concat(t,", should not be empty"))}function f_(e,t){if(!(e instanceof ArrayBuffer))throw new lM(le.INVALID_PARAMS,"Invalid ".concat(t,", should be ArrayBuffer"))}function fp(e){try{for(var t=navigator.mediaDevices.getSupportedConstraints(),r=0,n=sJ(e);r<n.length;r++){var i=n{}}function fv(e){return null==e}function ff(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new lM(le.INVALID_PARAMS,"The RoomId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function fm(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new lM(le.INVALID_PARAMS,"The userId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function fg(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new lM(le.INVALID_PARAMS,"The publicStreamId must be within 128 bytes. The supported  fy(e){fh(e,"videoPlayerOption")}function fS(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64;if(!e||0===(null==e?void 0:e.byteLength))throw new lM(le.INVALID_PARAMS,"The message cannot be empty");if((null===(t=e instanceof ArrayBuffer?e:vt.str2ab(a6(e)))||void 0===t?void 0:t.byteLength)>1e3*r)throw new lM(le.INVALID_PARAMS,"The message length must be less than ".concat(r,"K"))}function fb(e,t){if(("number"!=typeof e||Number.isNaN(e)||!(e>=1))&&!(null!=e&&e.min||null!=e&&e.max||null!=e&&e.exact||null!=e&&e.ideal))throw new lM(le.INVALID_PARAMS,"".concat(t," is not a valid ConstrainULong"))}function fE(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.NEGATIVE_INFINITY,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;return fc(e,t,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),e=(e=e>r?e:r)<n?e:n}var fT={exports:{}};!function(e){var t=Object.prototype.hnts=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto_;return u5?a4(i).call(o);i<o;i++)a[i]=n[i].fn;rets[t];return n?n..apply(d[u].context,c)}}return!0},s.prototype.on=function(e,t,r){return on(e,t,r){return o(this,e,t,gth?u[0]:u:a(this,o)}return thi=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(fT);var fk=fT.exports,fI=new h1("VERTC",0),fR=function(e){dy(r,fT.exports.EventEmitter);var t=dC(r);function r(){return iE(this,r),t.apply(this,arguments)}return ib(r,[{key:"safeEmit",value:function(e){var t=this.listenerCount(e);try{for(var n,i,o=arguments.length,a=Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return(n=dm(df(r.prototype),"emit",this)).call.apply(n,a4(i=[this,e]).call(i,a))}catch(r){return fI.error("safeEmit","safeEmit() | event listener threw an error [event:%s]:%o",e,r),!!t}}}]),r}();tt({Reflect.set))return!1;P(a,s,n)}return!0}});var fA=J.Refy(this.s,arguments))}},new fw(e)}var fx=[{maxLayers:3,totalPixels:2073600},{maxLayers:3,totalPixels:921600},{maxLayers:3,totalPixels:518400},{maxLayers:2,totalPixels:230400},{maxLayers:2,totalPixels:129600},{maxLayers:1,totalPixels:57600},{maxLayers:1,totalPixels:0}];sN("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},sV);var fO=J.Set;tt({target:"Set",stat:!0,forced:!0},{from:sj}),tt({target:"Set",stat:!0,forced:!0},{of:sG}),tt({target:"Set",prr++)P(t,e,arguments[r]);return e}}),tt({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:sH}),tt({target:"Set",pATOR:!0,INTERRUPTED:!0}).stopped}}),tt({target:"Set",proto:rn i0(e,function(e){P(n,r,e)}),r}}),tt({target:"Set",pr)&&P(o,i,e)},{IS_ITERATOR:!0}),i}}),tt({target:"Set",RATOR:!0,INTERRUPTED:!0}).result}}),tt({target:"Set",proto:!0nction(e){P(n,t,e)&&P(i,r,e)}),r}}),tt({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(e){var t=e1(this),r=e_(t.has);return!i0(e,function(e,n){if(!0===P(r,t,e))return n()},{INTERRUPTED:!0}).stopped}}),tt({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(e){var t=iY(this),r=e1(e),n=r.has;return w(n)||(n=e_((r=new(Z("Set"))(e)).has)),!i0(t,function(e,t){if(!1===P(n,r,e))return t()},{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),tt({target:"Set",proto:!0n n()},{INTERRUPTED:!0}).stopped}});var fN=I([].join),fP=[].push;tt({target:"Set",proto:!0,real:!0,forced:!0},{join:function(e){var t=iY(e1(this)),r=void 0===e?",":tW(e),n=[];return i0(t,fP,{that:n,IS_ITERATOR:!0}),fN(n,r)}}),tt({target:"Set"i,n(e,e,t))},{IS_ITERATOR:!0}),i}});var fD=TypeError;tt({target:"Set",prwith no initial value");return i}}),tt({target:"Set",ATOR:!0,INTERRUPTED:!0}).stopped}}),tt({target:"Set",proto:!0,real:!nction(e){P(n,r,e)||P(i,r,e)}),r}}),tt({target:"Set",peturn i0(e,e_(r.add),{that:r}),r}});var fM=(mw=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!vR()&&window.RTCPeerConnection&&window.RTCPeerConnection.prototype.addTransceiver&&window.RTCPeerConnection.prototype.createDataChannel){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,fX();case 5:if(e.t0=e.sent,!e.t0){e.next=10;break}return e.next=9,fK();case 9:e.t0=e.sent;case 10:return e.abrupt("return",e.t0);case 13:return e.prev=13,e.t1=e.catch(0),e.abrupt("return",!1);case 16:case"end":return e.stop()}},e,null,[[0,13]])})),function(){return mw.apply(this,arguments)}),fL=(mx=a2(a0().mark(function e(t){var r,n,i,o,a,s;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t||"recv_and_send",n=[],e.next=4,fX();case 4:return i=e.sent,e.next=7,fK();case 7:return o=e.sent,e.next=10,fq();case 10:return a=e.sent,e.next=13,fW();case 13:return s=e.sent,"send_only"===r&&(o&&n.push("H264"),s&&n.push("vp8")),"recv_only"===r&&(i&&n.push("H264"),a&&n.push("vp8")),"recv_and_send"===r&&(o&&i&&n.push("H264"),s&&a&&n.push("vp8")),e.abrupt("return",n);case 18:case"end":return e.stop()}},e)})),function(e){return mx.apply(this1:case"end":return e.stop()}},e)})),function(){return mO.apply(this,arguments)}),fV=(mN=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fL();case 2:return t=e.sent,e.abrupt("return",se(t).call(t,function(e){return e.toUpperCase()}));case 4:case"end":return e.stop()}},e)})),function(){return mN.apply(this,arguments)}),fF={},fB={};function fj(e){var t;if(cS(t=["level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f","profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1","packetization-mode=1;profile-level-id=42e01f;level-asymmetry-allowed=1"]).call(t,function(t){return null==e?void 0:c1(e).call(e,t)})){for(var r=navigator.userAgent.toLowerCase(),n=!1,i=0,o=["miuibrowser"];i<o.length;i++){var a=o[i];c1(r).call(r,a)&&(n=!0)}return!n}return!1}var fG=(mP=a2(a0().mark(function e(t){var r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new RTCPeerConnection({sdpSemantics:"unified-plan"})).addTransceiver("video",{direction:t}),e.next=4,r.createOffer();case 4:return n=e.sent,r.close(),e.abrupt("return",n.sdp.toLowerCase());case 7:case"end":return e.stop()}},e)})),function(e){return mP.apply(this,arguments)}),fH=(mD=a2(a0().mark(function e(){var t,r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fG("sendonly");case 2:if(r=e.sent,!c1(t=navigator.userAgent).call(t,"VivoBrowser")){e.next=7;break}return e.next=6,fG("sendonly");case 6:r=e.sent;case 7:return fF.h264encode=fj(r),fB.h264encode=r,fF.vp8encode=cA(r).call(r,"vp8")>-1,fB.vp8encode="same as h264encode",e.abrupt("return",fF);case 12:case"end":return e.stop()}},e)})),function(){return mD.apply(this,arguments)}),fz=(mM=a2(a0().mark(function e(){var t,r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fG("recvonly");case 2:if(r=e.sent,!c1(t=navigator.userAgent).call(t,"VivoBrowser")){e.next=7;break}return e.next=6,fG("recvonly");case 6:r=e.sent;case 7:return fF.h264decode=fj(r),fB.h264decode=r,fF.vp8decode=cA(r).call(r,"vp8")>-1,fB.vp8decode="same as h264decode",e.abrupt("return",fF);case 12:case"end":return e.stop()}},e)})),function(){return mM.apply(this,arguments)}),fK=(mL=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==fF.h264encode){e.next=10;break}return e.prev=1,e.next=4,fH();case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),fB.h264encode="meet error:"+e.t0,e.abrupt("return",!1);case 10:return e.abrupt("return",fF.h264encode||!1);case 11:case"end":return e.stop()}},e,null,[[1,6]])})),function(){return mL.apply(this,arguments)}),fX=(mU=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==fF.h264decode){e.next=10;break}return e.prev=1,e.next=4,fz();case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),fB.h264decode="meet error:"+e.t0,e.abrupt("return",!1);case 10:return e.abrupt("return",fF.h264decode||!1);case 11:case"end":return e.stop()}},e,null,[[1,6]])})),function(){return mU.apply(this,arguments)}),fW=(mV=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==fF.vp8encode){e.next=10;break}return e.prev=1,e.next=4,fH();case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),fB.vp8encode="meet error:"+e.t0,e.abrupt("return",!1);case 10:return e.abrupt("return",fF.vp8encode||!1);case 11:case"end":return e.stop()}},e,null,[[1,6]])})),function(){return mV.apply(this,arguments)}),fq=(mF=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==fF.vp8decode){e.next=10;break}return e.prev=1,e.next=4,fz();case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),fB.vp8decode="meet error:"+e.t0,e.abrupt("return",!1);case 10:return e.abrupt("return",fF.vp8decode||!1);case 11:case"end":return e.stop()}},e,null,[[1,6]])})),function(){return mF.apply(this,arguments)}),fY=function(){return"undefined"!=typeof TransformStream&&"undefined"!=typeof RTCRtpSender&&"undefined"!=typeof RTCRtpReceiver&&void 0!==RTCRtpSender.prototype.createEncodedStreams&&void 0!==RTCRtpReceiver.prototype.createEncodedStreams},fJ=function(){return vV?vO&&vZ>=70||vw&&vq>=80||vx&&vW>=14:vH?vO&&vZ>=70||vw&&vq>=80:vj?vY[0]>=14:!!vG&&vO&&vZ>=86},fQ=vO&&vZ<=114,fZ=new sF,f$=(mB=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new aj(function(e,r){var n=fn("STATS_SCALLBACK_SUPPORT");if(vO&&void 0===window.InstallTrigger&&fQ&&n)try{t.getStats(function(t){var r=[];t.result().forEach(function(e){if(!c1(f3).call(f3,e.type)){var t={};e.names().forEach(function(r){t[r]=e.stat(r)}),r.push(dr(dr({},t),{},{id:e.id,type:e.type,timestamp:e.timestamp}))}}),e({all:r,getTrackStats:function(e){return cG(r).call(r,function(t){return"ssrc"!==t.type||t.googTrackId===e})}})})}catch(e){etTrackStats:function(){return[]}})}));case 1:case"end":return e.stop()}},e)})),function(e){return mB.apply(this,arguments)}),f0=(mj=a2(a0().mark(function e(t){var r,n,i,o,a,s,c;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getStats();case 2:return n=e.sent,i={all:[]},o=new sF,n.forEach(function(e){var t=o.get(e.type)||new sF;t.set(e.id,e),o.set(e.type,t),i.all.push(e)}),a=function(e,t){e.forEach(function(e){var r,n,i,a,s,c,u=e.codecId,d=e.transportId,l=e.trackId,h=e.playoutId;if(null===(r=o.get(f2.codec))||void 0===r||r.forEach(function(e){e.id===u&&t.add(e)}),null===(n=o.get(f2.transport))||void 0===n||n.forEach(function(e){e.id===d&&(s=e,t.add(e))}),null===(i=o.get(f2.track))||void 0===i||i.forEach(function(e){e.id===l&&t.add(e)}),null===(a=o.get(f2.mediaPlayout))||void 0===a||a.forEach(function(e){e.id===h&&t.add(e)}),s){var _,p,v=s,f=v.localCertificateId,m=v.remoteCertificateId,g=v.selectedCandidatePairId;null===(_=o.get(f2.certificate))||void 0===_||_.forEach(function(e){(e.id===f||e.id===m)&&t.add(e)}),null===(p=o.get(f2.candidatePair))||void 0===p||p.forEach(function(e){e.id===g&&(c=e,t.add(e))})}if(c){var y,S,b=c,E=b.localCandidateId,T=b.remoteCandidateId;null===(y=o.get(f2.localCandidate))||void 0===y||y.forEach(function(e){e.id===E&&t.add(e)}),null===(S=o.get(f2.remoteCh(function(e){e.id===T&&t.add(e)})}})},o.get(f2.mediaSource)?null===(s=o.get(f2.mediaSource))||void 0===s||s.forEach(function(e){var t,r=new fO;r.add(e);var n=[];null===(t=o.get(f2.outboundRtp))||void 0===t||t.forEach(function(t){var i;t.mediaSourceId===e.id&&(r.add(t),n.push(t),null===(i=o.get(f2.remoteInboundRtp))||void 0===i||i.forEach(function(e){e.localId===t.id&&r.add(e)}))}),a(n,r),i[e.trackIdentifier]=uc(r)}):o.get(f2.track)&&(null===(c=o.get(f2.track))||void 0===c||c.forEach(function(e){var t,r=new fO;r.add(e);var n=[];null===(t=o.get(f2.outboundRtp))||void 0===t||t.forEach(function(t){var i;t.trackId===e.id&&(r.add(t),n.push(t),null===(i=o.get(f2.remoteInboundRtp))||void 0===i||i.forEach(function(e){e.localId===t.id&&r.add(e)}))}),a(n,r),i[e.trackIdentifier]=uc(r)})),null===(r=o.get(f2.inboundRtp))||void 0===r||r.forEach(function(e){var t,r=new fO;r.add(e),null===(t=o.get(f2.remoteOuton(t){t.localId===e.id&&r.add(t)}),a([e],r);var n,s=e.trackIdentifier;s||null===(n=o.get(e.trackId&&(s=t.trackIdentifier)}),i[s]=uc(r)}),e.abrupt("return",i);case 10:case"end":return e.stop()}},e)})),function(e){return mj.apply(this,arguments)}),f1=(mG=a2(a0().mark(function e(t,r,n){var i,o,a,s,c,u;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null==r?void 0:r.id,t instanceof RTCPeerConnection){e.next=3;break}return e.abrupt("return",[]);case 3:if(!vw&&!vx){e.next=10;break}return o=[],e.next=7,t.getStats(r);case 7:return e.sent.forEach(function(e){o.push(e)}),e.abrupt("return",o);case 10:return(!(a=fZ.get(t))||Date.now()-a.timestamp>150)&&(a={timestamp:Date.now(),statsPromise:f0(t),extraStatsPromise:f$(t)},fZ.set(t,a)),e.next=14,a.statsPromise;case 14:if(s=e.sent,c=(i?s[i]:s.all)||[],n){e.next=21;break}return e.next=19,a.extraStatsPromise;case 19:u=e.sent,c=a4(c).call(c,(i?u.getTrackStats(i):u.all)||[]);case 21:return e.abrupt("return",c);case 22:case"end":return e.stop()}},e)})),function(e,t,r){return mG.apply(this,arguments)}),f2=((mH=f2||{}).codec="codec",mH.inboundRtp="inbound-rtp",mH.outboundRtp="outbound-rtp",mH.remoteInboundRtp="remote-inbound-rtp",mH.remoteOutboundRtp="remote-outbound-rtp",mH.mediaSource="media-source",mH.csrc="csrc",mH.peerConnection="peer-connection",mH.dataChannel="data-channel",mH.stream="stream",mH.track="track",mH.transceiver="transceiver",mH.sender="sender",mH.receiver="receiver",mH.transport="transport",mH.sctpTransport="sctp-transport",mH.candidatePair="candidate-pair",mH.localCandidate="local-candidate",mH.remoteCandidate="remote-candidate",mH.certificate="certificate",mH.iceServer="ice-server",mH.mediaPlayout="media-playout",mH),f3=["codec","inbound-rtp","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp","media-source","csrc","peer-connection","data-channel","stream","track","transceiver","sender","receiver","transport","sctp-transport","candidate-pair","local-candidate","remote-candidate","certificate","ice-server"],f5=((mz=f5||{})[mz.AUTO=0]="AUTO",mz[mz.MODE_L=1]="MODE_L",mz[mz.MODE_R=2]="MODE_R",mz[mz.MODE_MIX=3]="MODE_MIX",mz),f4=((mK=f4||{})[mK.PLAYOUT=0]="PLAYOUT",mK[mK.PUBLISH=1]="PUBLISH",mK[mK.PLAYOUT_AND_PUBLISH=2]="PLAYOUT_AND_PUBLISH",mK),f6=((mX=f6||{})[mX.AUDIO_MIXING_STATE_PRELOADED=0]="AUDIO_MIXING_STATE_PRELOADED",mX[mX.AUDIO_MIXING_STATE_PLAYING=1]="AUDIO_MIXING_STATE_PLAYING",mX[mX.AUDIO_MIXING_STATE_PAUSED=2]="AUDIO_MIXING_STATE_PAUSED",mX[mX.AUDIO_MIXING_STATE_STOPPED=3]="AUDIO_MIXING_STATE_STOPPED",mX[mX.AUDIO_MIXING_STATE_FAILED=4]="AUDIO_MIXING_STATE_FAILED",mX[mX.AUDIO_MIXING_STATE_FINISHED=5]="AUDIO_MIXING_STATE_FINISHED",mX[mX.AUDIO_MIXING_STATE_PCM_ENABLED=6]="AUDIO_MIXING_STATE_PCM_ENABLED",mX[mX.AUDIO_MIXING_STATE_PCM_DISABLED=7]="AUDIO_MIXING_STATE_PCM_DISABLED",mX),f8={},f7={},f9={exports:{}},me=f9.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","en:"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","n-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:%s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumbectpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:[arams?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dircast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,na%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){return"mediaclk:"+((null!=e.id?"id=%s %s":"%v%s")+(null!=e.mediaClockValue?"=%s":""))+(null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",*)/)tring(Number(e))===e?Number(e):e},mq=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={ll!=e[i+1]&&(t[r[i]]=mW(e[i+1]))})(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},mY=f9.exports,mJ=RegExp.prototype.test.bind(/^([a-z])=(.*)/),f7.parse=function(e){var t,r={},n=[],i=r;return cG(t=e.split(/(\r\n|\r|\n)/)).call(t,mJ).forEach(function(e){var t=e[0],r=a$(e).call(e,2);"m"===t&&(n.push({rtp:[],fmtp:[]}),i=n[n.length-1]);for(var o=0;o<(mY[t]||[]).length;o+=1){var a=mY[t][o];if(a.reg.test(r))re&&t.length>1&&(e[r[0]]=void 0),e},f7.parseParams=function(e){var t;return s2(t=e.split(/;\s?/)).call(t,mQ,{})},f7.parseFmtpConfig=f7.parseParams,f7.parsePayloads=function(e){var t;return se(t=e.toString().split(" ")).call(t,Number)},f7.parseRemoteCandidates=function(e){for(var t,r=[],n=se(t=e.split(" ")).call(t,mW),i=0;i<n.length;i+=3)r.push({component:n[i],ip:n[i+1],port:n[i+2]});return r},f7.parseImageAttributes=function(e){var t;return se(t=e.split(" ")).call(t,function(e){var t;return s2(t=e.substring(1,e.length-1).split(",")).call(t,mQ,{})})},f7.parseSimulcastStreamList=function(e){var t;return se(t=e.split(";")).call(t,function(e){var tlength)),r=!0),{scid:t,paused:r}})})};vn Nt.name]);return mn.apply(null,n)},mo=["v","o","s","i","u","e","p","c","b","t","r","z","))})})})}),i.join("\r\n")+"\r\n"},f8.parse=f7.parse,f8.parseParams=f7.parseParams,f8.parseFmtpConfig=f7.parseFmtpConfig,f8.parsePayloads=f7.parsePayloads,f8.parseRemoteCandidates=f7.parseRemoteCandidates,f8.parseImageAttributes=f7.parseImageAttributes,f8.parseSimulcastStreamList=f7.parseSimulcastStreamList;var ms=new h1("FirefoxHandler",3),mc="kp34Za0H+aVf862l";function mu(e){return e>4294967278?(ms.warn("generateAllSsrc","reset start id",e),mu(e=e-4294967296+1e4+18)):{audio:e,audioFec:e+1,audioRtx:e+2,video:e+3,videoFec:e+4,videoRtx:e+5,next:e+18}}var md=function(e,t,r){var n,i,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"o/i14u9pJrxRKAsu";return[{id:r,attribute:"cname",value:a},{id:r,attribute:"msid",value:a4(n=a4(i="".concat(e," ")).call(i,e,"-")).call(n,t)},{id:r,attribute:"mslabel",value:"".concat(e)},{id:r,attribute:"label",value:a4(o="".concat(e,"-")).call(o,t)}]},ml=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.video,o=t.videoRtx,a=t.videoFec,s=[i,o],c=n.cname,u=n.flexfec;u&&s.push(a);var d,l=s2(s).call(s,function(t,r){return a4(t).call(t,md(e,"video",r,c))},[]),h=[{semantics:"FID",ssrcs:a4(r="".concat(i," ")).call(r,o)}];return u&&h.push({semantics:"FEC-FR",ssrcs:a4(d="".concat(i," ")).call(d,a)}),{ssrcs:l,ssrcGroups:h}};function mh(e){return e.direction="inactive",e.port=0,delete e.ext,delete e.ssrcs,delete e.ssrcGroups,delete e.simulcast,delete e.simulcast_03,delete e.rids,delete e.extmapAllowMixed,delete e.bundleOnly,e}var m_=function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=dr(dr({},e),{},{media:[]});return n&&(i.invalid=[{value:"realx-exts:rscp"}]),t&&i.media.push(t),r&&i.media.push(r),delete i.groups,delete i.msidSemantic,f8.write(i)};function mp(){return(mp=a2(a0().mark(function e(t){var r,n,i,o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n=t.publicIPs,i=t.certFingerprint,o=t.iceParams,a=t.iceConfig,r.fingerprint={type:"sha-256",hash:i},r.icePwd=o.serverIcePwd,e.next=6,mv(o.serverIceUfrag);case 6:return r.iceUfrag=e.sent,r.candidates=function(e,t){if(!Array.isArray(e))return[];var r=0,n=[];return e.forEach(function(e){var i={component:1,ip:e.ip,type:"host",generation:e.generation};e.udpPorts&&!t.tcpOnly&&e.udpPorts.forEach(function(e){n.push(dr(dr({},i),{},{foundation:r++,transport:"udp",port:e,priority:2130706431}))}),e.tcpPorts&&e.tcpPorts.forEach(function(e){n.push(dr(dr({},i),{},{foundation:r++,transport:"tcp",port:e,tcptype:"passive",priority:2130705431}))})}),n}(n,a),r.setup="active",r.iceOptions="renomination",e.abrupt("return",r);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}var mv=(mZ=a2(a0().mark(function e(t){var r,n,i,o,a,s;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(new TextEncoder).encode("PREC"),e.t0=Uint8Array,e.next=5,vt.b64str2ab(t);case 5:return e.t1=e.sent,n=new e.t0(e.t1),i=new Uint8Array(4),crypto.getRandomValues(i),(o=new Uint8Array(2))[0]=0,o[1]=1,a=ve(Uint8Array,r,n,i,o),e.next=15,vt.ab2b64str(a.buffer);case 15:return s=e.sent,e.abrupt("return",s);case 17:case"end":return e.stop()}},e)})),function(e){return mZ.apply(this,arguments)}),mf=function(e,t){var r=0;if(Array.isArray(e.fmtp)&&Array.isArray(e.rtp)){var n,i=u2(e.fmtp);try{for(i.s();!(n=i.n()).done;){var o,a,s,c=n.value;if(c1(o=c.config).call(o,"level-asymmetry-allowed=1")&&c1(a=c.config).call(a,"packetization-mode=1")&&c1(s=c.config).call(s,"profile-level-id=42e01f")){r=c.payload;break}}}catch(e){i.e(e)}finally{i.f()}for(var u=0;u<e.rtp.length;u++){var d,l,h=e.rtp[u];if("H264"===t){if(h.payload===r){e.rtp.unshift(cV(d=e.rtp).call(d,u,1)[0]);break}}else if(h.codec===t){e.rtp.unshift(cV(l=e.rtp).call(l,u,1)[0]);break}}var _=[];e.rtp.forEach(function(e){return _.push(e.payload)}),e.payloads=_.join(" ")}},mm=new h1("BasicHandler",3),mg=function(e){dy(n,fT.exports.EventEmitter);var t,r=dC(n);function n(e,t){var i;return iE(this,n),iT(dn(i=r.call(this)),"_peerConnection",void 0),iT(dn(i),"_dataChannel",void 0),iT(dn(i),"_context",void 0),iT(dn(i),"peerConnectionMode",0),iT(dn(i),"peerConnectionId",""),iT(dn(i),"id",void 0),iT(dn(i),"_monitor",void 0),iT(dn(i),"_nextSsrc",Math.floor(4294967296*Math.random()+1e4)),iT(dn(i),"_aSendonlyAnswerTpl",void 0),iT(dn(i),"_vSendonlyAnswerTpl",void 0),iT(dn(i),"_enableSubFlexfec",!1),iT(dn(i),"audioTrack4ff",void 0),iT(dn(i),"setLocalDescription",void 0),iT(dn(i),"setRemoteDescription",void 0),i.peer=t,i.id=e.id,i._monitor=pZ(i.id),i._peerConnection=t.getOriginRTCPeerConnection(),i._dataChannel=t.getOriginRTCDataChannel(),i.setLocalDescription=t.setLocalDescription.bind(t),i.setRemoteDescription=t.setRemoteDescription.bind(t),function(e){i.emit("ontrack",e)}),i}return ib(n,[{key:"destroy",value:function(){mm.info("destroy",this.peerConnectionId||""),dm(df(n.prototype),"removeAllListeners",this).call(thipeerConnection.getTransceivers()}},{key:"getConnectionState",value:function(){return this._peerConnection.connectionState}},{key:"_simulcast",value:function(e,t,r,n,i){var o,a,s,c=[];1===e.videoEncodeConfig.length?(c=function(e,t){var r=[];if(t<=1)return r;var n=Math.min(e.width,e.height)/90;return r.push({scaleResolutionDownBy:n,width:Math.floor(e.width/n),height:Math.floor(e.height/n),maxkbps:100,frameRate:10}),t<=2||r.unshift({scaleResolutionDownBy:2,width:Math.floor(e.width/2),height:Math.floor(e.height/2),maxkbps:Math.floor(e.maxKbps/2),frameRate:e.frameRate>=30?Math.floor(e.frameRate/2):e.frameRate}),r}(t,i),mm.info("simulcast() ","simulcastLayers: %o",c)):(c=se(o=a$(a=a$(s=e.videoEncodeConfig).call(s,1)).call(a,1-i)).call(o,function(e){var r=vp(e.width),n=t.width/r;return{width:r,height:Math.floor(t.height/n),scaleResolutionDownBy:n,frameRate:vp(e.frameRate)||15,maxkbps:e.maxKbps||600}}),mm.info("simulcast() ","simulcastLayers2: %o",c));var u=[!0];c.forEach(function(e,t){var i,o={maxBitrate:1e3*e.maxkbps,scaleResolutionDownBy:e.scaleResolutionDownBy,rid:"".concat(t+1),maxFramerate:e.frameRate};null===(i=r.sendEncodings)||void 0===i||i.unshift(o),n.push({width:e.width,height:e.height,framerate:e.frameRate,maxkbps:e.maxkbps,rid:"".concat(t+1)}),u.push(!0)}),this._context&&(this._context.activeSimStreams=u)}},{key:"internalPublish",value:function(e){var t=e.stream,r=e.videoTrack,n=e.audioTrack,i=e.enableSimulcast,o=e.pubAudio,a=e.pubVideo,s={direction:"sendonly",streams:[t]},c={direction:"sendonly",streams:[t]},u=[],d=[];if(Array.isArray(null==e?void 0:e.videoEncodeConfig)&&e.videoEncodeConfig.length){var l=null==r?void 0:r.getTrack(),h=dr({},fo);if(l){var _=null==l?void 0:l.getSettings();h={width:Math.floor(_.width),height:Math.floor(_.height),frameRate:Math.floor(_.frameRate)}}"number"!=typeof h.frameRate&&(h.frameRate=30);var p=null==e?void 0:e.videoEncodeConfig[0],v={maxBitrate:1e3*p.maxKbps,rid:"0"};if(e.prevBitrate=p.maxKbps,c.sendEncodings=[v],u.push({width:h.width,height:h.height,framerate:h.frameRate,maxkbps:p.maxKbps,rid:"0"}),!vw&&i){var f,m,g=function(e){for(var t=0,r=e.width*e.height,n=0;n<fx.length;n++)if(r>=fx[n].totalPixels){t=n;break}if(0===t)return fx[t].maxLayers;var i=fx[t-1].totalPixels;return(i-r)/(i-fx[t].totalPixels)<.1?fx[t-1].maxLayers:fx[t].maxLayers}(h);mm.info("simulcast() ","maxLayers: %o",g),g>1&&(this._simulcast(e,dr(dr({},h),{},{maxKbps:p.maxKbps}),c,u,g),null!==(f=this._context)&&void 0!==f&&null!==(m=f.serverConfig)&&void 0!==m&&m.s,{},{video_index:t,sub_index:t})})))}}mm.info("publish videoTransceiverInit videoDescriptions","",c,u);var y=null==n?void 0:n.getTrack("preprocessing");(null==n?void 0:n.mixType)!==f4.PLAYOUT&&null!=n&&n.mixedAudioTrack&&(y=null==n?void 0:n.mixedAudioTrack),y=o&&y?y:"audio";var S=null==r?void 0:r.getTrack("preprocessing");S=a&&S?S:"video";try{this._reportRtcInvokeStatus("Handler.internalPublish",a6({aTrack:vl(y),vTrack:vl(S),audioTransceiverInit:s,videoTransceiverInit:c}))}catch(e){}return{semantics:"unified-plan",videoDescriptions:u,subVideoDescriptions:d,audioTransceiverInit:{track:y,init:s},videoTransceiverInit:{track:S,init:c}}}},{key:"updateMaxBitrate",value:function(e){mm.info("updateMaxBitrate()");var t=null===(n=e.videoTrack)||void 0===n?void 0:n.getTrack(),r=e.videoTransceiver;if(t&&e.pubVideo&&r){var n,i,o,a,s,c=null===(i=e.videoEncodeConfig)||void 0===i||null===(o=i[0])||void 0===o?void 0:o.maxKbps;if(c){if(c===e.prevBitrate)return void mm.warn("updateMaxBitrate()","no change");e.prevBitrate=c}var u=null===(a=r.sender)||void 0===a?void 0:a.getParameters();if(u){u.encodings=null==u||null===(s=u.encodings)||void 0===s?void 0:se(s).call(s,function(t){var r,n=Number(t.rid)||0,i=null===(r=e.videoEncodeConfig[n])||void 0===r?void 0:r.maxKbps;return"number"==typeof i&&(t.maxBitrate=1e3*i),t}),null==r||r.sender.setParameters(u);try{this._reportRtcInvokeStatus("Handler.updateScaleResolutionDownBy",a6(u.encodings))}catch(e){}}}else mm.warn("updateMaxBitrate()",urn f1(this._peerConnection,e,t)}},{key:"setCurrentD0:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)})},{key:"createAVMlineAnswerTpl",value:function(e){var t=this;f8.parse(e).media.forEach(function(e){if("audio"===e.type){if("sendonly"===e.direction){var r,n=null==e?void 0:cS(r=e.rtp).call(r,function(e){return"opus"===e.codec});if(n&&null!=e&&e.fmtp){var i,o=null==e?void 0:cS(i=e.fmtp).call(i,function(e){return e.payload===n.payload});o&&t._context&&(o.config+=";stereo=1;sprop-stereo=1")}t._aSendonlyAnswerTpl=e}}else"video"===e.type&&("sendonly"===e.direction&&(t._vSendonlyAnswerTpl=e),Array.isArray(e.rtp)&&e.rtp.forEach(function(e){var r;null!==(r=e.codec)&&void 0!==r&&c1(r).call(r,"flexfec")&&(t._enableSubFlexfec=!0)}))})}},{key:"pc",get:function(){return this._peerConnection}},{key:"addBitrateLimit",value:function(e,t){null==e||e.rtp.forEach(function(r){var n,i=r.codec,o=r.payload;if(c1(n=["vp8","h264"]).call(n,i.toLocaleLowerCase())){var a,s,c=cS(a=e.fmtp).call(a,function(e){return e.payload===o});c?c.config=a4(s=[]).call(s,ud(c.config.split(";")),["x-google-min-bitrate=100","x-google-start-bitrate=".concat(t)]).join(";"):e.fmtp.push({payload:o,config:"x-google-min-bitrate=100;x-google-start-bitrate=".concat(t)})}})}},{key:"_report",value:function(e,t,r){var n;null===(n=this._monitor)||void 0===n||n.report(e,dr(dr({},t),{},{connection_id:this.peer.getConnectionId(),group_connection_id:this.peer.getGroupConnectionId()}),r)}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;this._report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:n,elapse:0},i)}}]),n}(),my=sf.exports.getWeakData,mS=rV.set,mb=rV.getterFor,mE=rj.find,mT=rj.tur)},es,function(e){retar ts:fu?r[1]=turn~t&&mk(this.entries,t,1),!!~t}};var mw,mx,mO,mN,mP,mD,mM,mL,mU,mV,mF,mB,mj,mG,mH,mz,mK,mX,mW,mq,mY,mJ,mQ,mZ,m$tion(e){return s(this,e,!0)}}),i}},m2=rV.enforce,m3=!l.Actints.length?arguments[0]:void 0)}},m4=sN("WeakMap",m5,m1);if(rN&&m3){m$=m1.getConstructor(m5,"WeakMap",!0),m0.enable();var m6=m4.prototype,m8=I(m6.delete),m7=I(m6.has),m9=I(m6.get),ge=I(m6.set);sP(m6,{delete:function(e){if(Y(e)&&!sy(e)){var t=m2(this);return t.frozen||(t.frozen=new m$),m8(this,e)||t.frozen.fro.frot)}else ge(this,e,t);return this}})}var gt=J.WeakMap;tt({target:"WeakMap",proto:!0,real:!0,forced:!0},{emplace:sz}),tt({target:"WeakMap",stat:!0,forced:!0},{from:sj}),tt({target:"WeakMap",stat:!0,forced:!0},{of:sG}),tt({target:"WeakMap",proto:!0,real:!0,forced:!0},{deleteAll:sH}),tt({target:"WeakMap",proto:!0,real:!0,forced:!0},{upsert:sY});var gr=new(function(e){dy(_,fR);var t,r,n,i,o,a,s,c,u,d,l,h=dC(_);function _(){var e,t,r;return iE(this,_),iT(dn(r=h.call(this)),"inited",!1),iT(dn(r),"deviceMap",{audioinput:new sF,audiooutput:new sF,videoinput:new sF}),iT(dn(r),"checkDeviceChangeTimer",null),iT(dn(r),"isSupportedPermissionsQuery",!1),iT(dn(r),"isGrantedMicrophonePermission",!1),iT(dn(r),"isGrantedCameraPermission",!1),r.isSupportedPermissionsQuery=!vR()&&!(null===(e=navigator)||void 0===e||null===(t=e.permissions)||void 0===t||!t.query),r._handleDeviceChange=r._handleDeviceChange.bind(dn(r)),vR()||r.refreshDevices(),r}return ib(_,[{key:"refreshDevices",value:(l=a2(a0().mark(function e(){var t,r,n=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=2;break}return e.abrupt("return");case 2:if(t=void 0,!vw){e.next=12;break}return e.prev=4,e.next=7,navigator.mediaDevices.getUserMedia({audio:!0});case 7:t=e.sent,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:return e.next=14,navigator.mediaDevices.enumerateDevices();case 14:r=e.sent,t&&t.getTracks().forEach(function(e){return e.stop()}),r.forEach(function(e){var t;e.deviceId&&(null===(t=n.deviceMap[e.kind])||void 0===t||t.set(e.deviceId,e))}),this.inited||this.initListener(),this.inited=!0;case 19:case"end":return e.stop()}},e,this,[[4,10]])})),function(){return l.apply(this,arguments)})},{key:"initListener",value:(d=a2(a0().mark(function e(){var t,r,n,i,o=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.ondevicechange)&&"function"==typeof(null===(r=navigator.mediaDevices)||void 0===r?void 0:r.addEventListener)?navigator.mediaDevice(){o._handleDeviceChange()},300)}):this.checkDeviceChangeTimer=window.setInterval(function(){o._handleDeviceChange()},3e3),!this.isSupportedPermissionsQuery){e.next=22;break}return e.prev=2,e.next=5,navigator.permissions.query({name:"microphone"});case 5:n=e.sent,this.isGrantedMicrophonePermission="granted"===n.state,n.addEventListener("change",function(){o.isGrantedMicrophonePermission="granted"===n.state}),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:return e.prev=12,e.next=15,navigator.permissions.query({name:"camera"});case 15:i=e.sent,this.isGrantedCameraPermission="granted"===i.raPermission="granted"===i.state}),e.next=22;break;case 20:e.prev=20,e.t1=e.catch(12);case 22:case"end":return e.stop()}},e,this,[[2,10],[12,20]])})),function(){return d.apply(this,arguments)})},{key:"_handleDeviceChange",value:(u=a2(a0().mark(function e(){var t,r,n,i,o,a,s,c=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=void 0,!vw){e.next=5;break}return e.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:o=e.sent;case 5:return e.next=7,navigator.mediaDevices.enumerateDevica,function(e){return!!e.deviceId}),o&&o.getTracks().forEach(function(e){return e.stop()}),s=uc(a4(t=[]).call(t,ud(dN(r=this.deviceMap.audioinput).call(r)),ud(dN(n=this.deviceMap.videoinput).call(n)),ud(dN(i=this.deviceMap.audiooutput).call(i)))),(vB||vU)&&!s.length&&a.length&&a.forEach(function(e){var t;null===(t=c.deviceMap[e.kind])||void 0===t||t.set(e.deviceId,e)}),a.forEach(function(e){var t,r,n=c.deviceMap[e.kind].get(e.deviceId);c.deviceMap[e.kind].set(e.deviceId,e),n||(c1(t=e.kind).call(t,"video")?c.emit(vI.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}):c1(r=e.kind).call(r,"audio")&&c.emit(vI.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}))}),s.forEachId===e.deviceId&&t.kind===e.kind})||(c.deviceMap[e.kind].delete(e.deviceId),c1(t=e.kind).call(t,"video")?c.emit(vI.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}):c1(r=e.kind).call(r,"audio")&&c.emit(vI.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}))});case 14:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"getUserMedia",value:(c=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia(t);case 2:return r=e.sent,null!=t&&t.audio&&(this.isGrantedMicrophonePermission=!0),null!=t&&t.video&&(this.isGrantedCameraPermission=!0),this.refreshDevices(),e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"checkPermissionsByDevices",value:(s=a2(a0().mark(function e(){var t,r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={audio:!1,video:!1},navigator.mediaDevices){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:return r=e.sent,t.audio=cG(r).call(r,function(e){return"audioinput"===e.kind&&e.label&&e.deviceIt"===e.kind&&e.label&&e.deviceId}).length>0,e.abrupt("return",t);case 9:case"end":return e.stop()}},e)})),function(){return s.apply(this,arguments)})},{key:"getPermissions",value:(a=a2(a0().mark(function e(){var t,r,n,i,o,a,s,c,u,d,l=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(r=l.length>0&&void 0!==l[0]?l[0]:{}).audio,i=r.video,o=r.force,n||i||(n=!0,i=!0),a={audio:!1,video:!1,reason:void 0},o){e.next=30;break}if(!this.isSupportedPermissionsQuery){e.next=20;break}if(!n||!i){e.next=14;break}if(!this.isGrantedMicrophonePermission||!this.isGrantedCameraPermission){e.next=12;break}return a.audio=!0,a.video=!0,e.abrupt("return",a);case 12:e.next=18;break;case 14:if(!(n&&this.isGrantedMicrophonePermission||i&&this.isGrantedCameraPermission)){e.next=18;break}return a.audio=this.isGrantedMicrophonePermission,a.video=this.isGrantedCameraPermission,e.abrupt("return",a);case 18:case 26:e.next=30;break;case 20:return e.next=22,this.checkPermissionsByDevices();case 22:if(s=e.sent,!n||!i){e.next=28;break}if(!s.audio||!s.video){e.next=26;break}return e.abrupt("return",s);case 28:if(!(n&&s.audio||i&&s.video)){e.next=30;break}return e.abrupt("return",s);case 30:if(null===(t=navigator.mediaDevices)||void 0===t||!t.getUserMedia){e.next=70;break}return e.prev=31,e.next=34,navigator.mediaDevices.getUserMedia({audio:n,video:i});case 34:(c=e.sent)&&(c.getTracks().forEach(function(e){return e.stop()}),n&&(a.audio=!0,this.isGrantedMicrophonePermission=!0),i&&(a.video=!0,this.isGrantedCameraPermission=!0)),e.next=70;break;case 38:if(e.prev=38,e.t0=e.catch(31),a.reason=e.t0,!this.isSupportedPermissionsQuery){e.next=70;break}if(!n){e.next=56;break}return e.next=45,navigator.permissions.query({name:"microphone"}).catch(function(){});case 45:if(e.t2=u=e.sent,e.t1=null===e.t2,e.t1){e.next=49;break}e.t1=void 0===u;case 49:if(!e.t1){e.next=53;break}e.t3=void 0,e.next=54;break;case 53:e.t3=u.state;case 54:e.t4=e.t3,a.audio="granted"===e.t4;case 56:if(!i){e.next=70;break}return e.next=59,navigator.permissions.query({name:"camera"}).catch(function(){});case 59:if(e.t6=d=e.sent,e.t5=null===e.t6,e.t5){e.next=63;break}e.t5=void 0===d;case 63:if(!e.t5){e.next=67;break}e.t7=void 0,e.next=68;break;case 67:e.t7=d.state;case 68:e.t8=e.t7,a.video="granted"===e.t8;case 70:return e.next=72,this.refreshDevices();case 72:return e.abrupt("return",a);case 73:case"end":return e.stop()}},e,this,[[31,38]])})),function(){return a.apply(this,arguments)})},{key:"enumerateDevices",value:(o=a2(a0().mark(function e(){var t,r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions();case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",uc(a4(t=[]).call(t,ud(dN(r=this.deviceMap.audioinput).call(r)),ud(dN(n=this.deviceMap.videoinput).call(n)),ud(dN(i=this.deviceMap.audiooutput).call(i)))));case 5:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"enumerateAudioCaptureDevices",value:(i=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({audio:!0});case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",uc(dN(t=this.deviceMap.audioinput).call(t)));case 5:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"enumerateVideoCaptureDevices",value:(n=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({video:!0});case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",uc(dN(t=this.deviceMap.videoinput).call(t)));case 5:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"enumerateAudioPlaybackDevices",value:(r=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({audio:!0});case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",uc(dN(t=this.deviceMap.audiooutput).call(t)));case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getDeviceById",value:(t=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:return r=e.sent,e.abrupt("return",cS(r).call(r,function(e){return e.deviceId===t}));case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})}]),_}());vR()||(window.__rtc_dd__=gr);var gn=new h1("InternalEventBus",1),gi=((g5=gi||{}).ON_IOS_INTERRUPTION_START="ON_IOS_INTERRUPTION_START",g5.ON_IOS_INTERRUPTION_END="ON_IOS_INTERRUPTION_END",g5.ON_IOS_LOCAL_TRACK_MUTE="ON_IOS_LOCAL_TRACK_MUTE",g5.ON_IOS_LOCAL_TRACK_UNMUTE="ON_IOS_LOCAL_TRACK_UNMUTE",g5),go=new(function(e){dy(r,fT.(this,r),t.apply(this,arguments)}return ib(r,[{key:"emit",value:function(e){var t,n;gn.info(e);for(var i=arguments.length,o=Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return(t=dm(df(r.prototype),"emit",this)).call.apply(t,a4(n=[this,e]).call(n,o))}}]),r}()),ga=new h1("AudioContext",1),gs=function(){function e(){var t=this;iE(this,e),iT(this,"_audioContextInstance",void 0),iT(this,"_previousState",""),iT(this,"_currentState",""),iT(this,"_contextStuckAt",0);var r=0;vR()||setInterval(function(){if(t._audioContextInstance){var e=t._audioContextInstance.currentTime;t._contextStuckAt?t._contextStuckAt!==e&&(t._contextStuckAt=0,ga.info("currentTime resume"),pJ("currentTime resume","")):e&&r===e&&(t._contextStuckAt=e,ga.warn("currentTime stuck",t._contextStuckAt),t._audioContextInstance.suspend(),t._audioContextInstance.resume(),pJ("AudioContext currentTime stuck",t._contextStuckAt)),r=e}},3e3)}return ib(e,[{key:"getAudioContextInstance",value:function(){var e=this;if(!this._audioContextInstance){var t=window.AudioContext||window.webkitAudioContext;this._audioContextInstance=new t,this._audioContextInstance.onstatechange=function(){var t,r,n;ga.warn("state change",null===(t=e._audioContextInstance)||void 0===t?void 0:t.state),e._previousState=e._currentState,e._currentState=(null===(r=e._audioContextInstance)||void 0===r?void 0:r.state)||"","interrupted"===(null===(n=e._audioContextInstance)||void 0===n?void 0:n.state)&&e._audioContextInstance.resume(),(vj||vU)&&("running"===e._previousState&&"interrupted"===e._currentState&&go.emit(gi.ON_IOS_INTERRUPTION_START),"interrupted"===e._previousState&&"running"===e._currentState&&go.emit(gi.ON_IOS_INTERRUPTION_END))}}return this._audioContextInstance}}]),e}(),gc=function(){var e;function t(e){iE(this,t),iT(this,"_ctx",void 0),iT(this,"_analyserNode",void 0),iT(this,"_audioSource",void 0);var r=gu.getAudioContextInstance();if(e instanceof MediaStreamTrack){var n=new MediaStream;n.addTrack(e),this._audioSource=r.createMediaStreamSource(n)}else this._audioSource=r.createMediaElementSource(e),this._audioSource.connect(r.destination);var i=r.createAnalyser();this._audioSource.connect(i),this._analyserNode=i,this._ctx=r}return ib(t,[{key:"getAudioLevel",value:function(){"suspended"===(null===(e=this._ctx)||void 0===e?void 0:e.state)&&this._ctx.resume();var e,t=new Uint8Array(2048);this._analyserNode.getByteTimeDomainData(t);var r=0;t.forEach(function(e){return r=Math.max(r,Math.abs(e-128))});var n=r/128*255;return n>2?n:0}},{key:"resume",value:(e=a2(a0().mark(fuase 2:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,a,this._analyserNode.disconnect()}}]),t}(),gu=new gs,gd=((g4=gd||{})[g4.CAPTURE=0]="CAPTURE",g4[g4.PRE_PROCESSING=1]="PRE_PROCESSING",g4[g4.ENCODE=2]="ENCODE",g4[g4.TRANSFER=3]="TRANSFER",g4[g4.POST_PROCESSING=4]="POST_PROCESSING",g4[g4.DECODE=5]="DECODE",g4[g4.RENDERING=6]="RENDERING",g4),gl=function(){var e;function t(e){iE(this,t),iT(this,"_plugins",new sF),this.id=e}return ib(t,[{key:"register",value:function(e){var t=this._plugins.get(e.type)||[];if(d3(t).call(t,function(t){return t.name===e.name})>-1)throw Error("Failed to register ".concat(e.name,": name is repeated."));t.push(e),this._plugins.set(e.type,t{return this._plugins.get(e)||[]}},{key:"getPluginByName",value:function(e,t){var r;return cS(r=this._plugins.get(e)||[]).call(r,function(e){return e.name===t})}},{key:"getPreProcessingTrack",value:(e=a2(a0().mark(function e(t){var r,n,i,o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=this._plugins.get(1)||[],n=t.getTrack(),i=u2(r),e.prev=3,i.s();case 5:if((o=i.n()).done){e.next=12;break}return a=o.value,e.next=9,a.effect(t,n);case 9:n=e.sent;case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),i.e(e.t0);case 17:return e.prev=17,i.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}},e,this,[[3,14,17,20]])})),function(t){return e.apply(this,arguments)})},{key:"destroy",valuefunction(e){return e.destroy()})}),this._plugins.clear()}}]),t}(),gh=((g6=gh||{})[g6.EXTERNAL=0]="EXTERNAL",g6[g6.INTERNAL=1]="INTERNAL",g6),g_=new h1("VERTC",0),gp=new gt,gv=function(e){dy(r,fR);var t=dC(r);function r(e,n){var i;return iE(this,r),iT(dn(i=t.call(this)),"sourceType",1),iT(dn(i),"mediaType",void 0),iT(dn(i),"_trackId",void 0),iT(dn(i),"_ac",void 0),iT(dn(i),"_sourceNode",void 0),iT(dn(i),"_gainNode",void 0),iT(dn(i),"_destNode",void 0),iT(dn(i),"_channelCount",void 0),i._trackId=e,i.mediaType=n,"audio"===n&&fJ()&&!fn("SKIP_WEB_AUDIO_IN_TRACK")&&(i._ac=gu.getAudioContextInstance(),i._gainNode=i._ac.createGain(),i._destNode=i._ac.createMediaStreamDestination(),i._gainNode.connect(i._destNode)),i}return ib(r,[{key:"getId",value:function(){return this._trackId}},{key:"setVolume",value:function(e){this._gainNode&&(this._gainNode.gain.value=e/100)}},{key:"getVolume",value:function(){return this._gainNode?Math.round(100*this._gainNode.gain.vas._channelCount)&&void 0!==e?e:0}},{key:"connectAudioTrack",value:function(e){if(this._channelCount=e.getSettings().channelCount,!fJ()||fn("SKIP_WEB_AUDIO_IN_TRACK"))return e;this._sourceNode&&(this._sourceNode.mediaStream.getTracks().forEach(function(e){e.stop()}),delete this._sourceNode);var t,r,n=new MediaStream;return n.addTrack(e),this._sourceNode=null===(t=this._ac)||void 0===t?void 0:t.createMediaStreamSource(n),this._gainNode&&(null===(r=this._sourceNode)||void 0===r||r.connect(this._gainNode)),this._destNode.stream.getTracks()[0]}},{key:"destroy",value:function(){var e,t,r,n;null===(e=this._sourceNode)||void 0===e||e.mediaStream.getTracks().forEach(function(e){e.stop()}),13!==vW&&(null===(n=this._destNode)||void 0=s().forEach(function(e){e.stop()})),null===(t=this._sourceNode)||void 0===t||t.disconnect(),null===(r=this._gainNode)||void 0===r||r.disconnect(),delete this._sourceNode,delete this._gainNode,delete this._destNode}}]),r}(),gf=function(e){dy(n,gv);var t,r=dC(n);function n(e,t,i){var o;return iE(this,n),iT(dn(o=r.call(this,t,i)),"_mediaTrack",void 0),iT(dn(o),"_preProcessingTrack",void 0),iT(dn(o),"_originTrack",void 0),iT(dn(o),"handleTrackEnded",function(){o.emit("track-ended",dn(o)),o.close()}),iT(dn(o),"handleMute",function(){o.emit("track-mute"n(){o.emit("track-unmute",dn(o))}),o._mediaTrack="audio"===o.mediaType?o.connectAudioTrack(e):e,o._originTrack=e,o._initListeners(),o}return ib(n,[{key:"getTrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"origin";return"origin"===e?this._mediaTrack:this._preProcessingTrack||this._mediaTrack}},{key:"setTrack",value:function(e,t){this._mediaTrack="audio"===this.mediaType?this.connectAudioTrack(e):e,this._originTrack=e,t&&this.generatePreProcessingTrack(t)}},{key:"generatePreProcessingTrack",value:(t=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._preProcessingTrack=void 0,e.prev=1,e.next=4,t.getPreProcessingTrack(this);case 4:(r=e.sent)instanceof MediaStreamTrack&&(this._preProcessingTrack=r),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1);case 11:case"end":return e.stop()}},e,this,[[1,8]])})),function(e){return t.apply(this,arguments)})},{key:"getOrgTrack",value:function(){return this._originTrack}},{key:"close",value:function(){var e,t,r,n,i;return this._mediaTrack.onended=null,this._mediaTrack.onmute=null,this._mediaTrack.onunmute=null,null===(e=this._originTrack)||void 0===e||e.removeEventListener("ended",this.handleTrackEnded),null===(t=this._originTrack)||void 0===t||t.removeEventListener("mute",this.handleMute),null===(r=this._originTrack)||void 0===r||r.removeEventListener("unmute",this.handleUnmute),null===(n=this._preProcessingTrack)||void 0===n||n.stop(),"audio"===this.mediaType?this.destroy():null===(i=this._mediaTrack)||void 0===i?void 0:i.stop()}},{key:"_initListeners",value:function(){this._originTrack instanceof MediaStreamTrack&&(this._originTrack.addEventListener("ended",this.handleTrackEnded),this._originTrack.addEventListener("mute",this.handleMute),this._originTrack.addEventListener("unmute",this.handleUnmute))}}]),n}(),gm=function(e){dy(r,gv);var t=dC(r);function r(e,n,i){var o;return iE(this,r),iT(dn(o=t.call(this,n,i)),"_mediaTrack",void 0),iT(dn(o),"_originTrack",void 0),o._mediaTrack="audio"===o.mediaType?o.connectAudioTrack(e):e,o._originTrack=e,o}return ib(r,[{key:"getTrack",value:function(){return this._mediaTrack}},{key:"getOrgTrack",value:function(){return this.function(){return this.destroy()}}]),r}(),gg=function(e){dy(n,gf);var t,r=dC(n);function n(e,t){var i;return iE(this,n),iT(dn(i=r.call(this,e,t,"video")),"resolution",void 0),iT(dn(i),"dummy",!1),i.resolution={width:0,height:0},i}return ib(n,[{key:"updateVideoCaptureConfig",value:(t=a2(a0().mark(function e(t){var r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getTrack()){e.next=2;break}return e.abrupt("return");case 2:return g_.info("updateVideoEncoderConfig","update localVideoTrack: ",t),delete(r=dr({},t)).contentHint,vw&&this.streamIndex===ll.STREAM_INDEX_MAIN&&(r.frameRate={ideal:30,max:30}),e.next=8,this.getTrack().applyConstraints(r);case 8:((n=this.getTrack().getSettings()).width&&n.width!==this.resolution.width||n.height&&n.height!==this.resolution.height)&&(this.resolution={width:n.width,height:n.height},this.emit("resolution-change",this.resolution));case 10:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,argumelue:function(e){this.setTrack(e)}},{key:"setContentHint",value:function(e){var t;this._mediaTrack&&"contentHint"in this._mediaTrack&&c1(t=["text","motion","detail"]).call(t,e)&&(this._mediaTrack.contentHint=e)}}]),n}(),gy=function(e){dy(n,gf);var t,r=dC(n);function n(e,t){var i;return iE(this,n),iT(dn(i=r.call(this,e,t,"audio")),"audioCaptureConfig",void 0),iT(dn(i),"_audioLevelFetcher",void 0),iT(dn(i),"mixedAudioTrack",void 0),iT(dn(i),"mixType",f4.PLAYOUT_AND_PUBLISH),i}return ib(n,[{key:"getAudioLevel",value:function(){return this._audioLevelFetcher||(this._audioLevelFetcher=new gc(this.getTrack("preprocessing"))),this._audioLevelFetcher.getAudioLevel()}},{key:"updateAudioCaptureConfig",value:(t=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioCaptureConfig){e.next=2;break}return e.abrupt("return");case 2:return g_.info("updateAudioCaptureConfig","update localAudioTrack: ",this.audioCaptureConfig),e.next=5,null===(t=this.getOrgTrack())||void 0===t?void 0:t.applyConstraints(this.audioCaptureConfig);case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),n}(),gS=function(e){dy(r,gm);var t=dC(r);function r(e,n){return iE(this,r),t.call(this,e,n,"video")}return ib(r)}(),gb=function(e){dy(r,gm);var t=dC(r);function r(e,n){var i;return iE(this,r),iT(dn(i=t.call(this,e,n,"audio")),"_audioLevelFetcher",void 0),i}return ib(r,[{key:"getAudioLevel",value:function(){return this._audioLevelFetcher||(this._audioLevelFetcher=new gc(this.getOrgTrack())),this._audioLevelFetcher.getAudioLevel()}}]),r}(),gE=function(e){dy(r,gy);var t=dC(r);function r(){var e,n;iE(this,r);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return iT(dn(n=t.call.apply(t,a4(e=[this]).call(e,o))),"streamIndex",ll.STREAM_INDEX_MAIN),n}return ib(r)}(),gT=function(e){dy(r,gg);var t=dC(r);function r(){var e,n;iE(this,r);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return iT(dn(n=t.call.apply(t,a4(e=[this]).call(e,o))),"streamIndex",ll.STREAM_INDEX_MAIN),n}return ib(r)}(),gk=function(e){dy(r,gg);var t=dC(r);function r(){var e,n;iE(this,r);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return iT(dn(n=t.call.apply(t,a4(e=[this]).call(e,o))),"streamIndex",ll.STREAM_INDEX_MAIN),iT(dn(n),"sourceType",0),n}return ib(r)}(),gI=function(e){dy(r,gy);var t=dC(r);function r(){var e,n;iE(this,r);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return iT(dn(n=t.call.apply(t,a4(e=[this]).call(e,o))),"streamIndex",ll.STREAM_INDEX_MAIN),iT(dn(n),"sourceType",0),n}return ib(r)}(),gR=function(e){dy(r,gg);var t=dC(r);function r(){var e,n;iE(this,r);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return iT(dn(n=t.call.apply(t,a4(e=[this]).call(e,o))),"streamIndex",ll.STREAM_INDEX_SCREEN),n}return ib(r)}(),gA=function(e){dy(r,gy);var t=dC(r);function r(){var e,n;iE(this,r);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return iT(dn(n=t.call.apply(t,a4(e=[this]).call(e,o))),"streamIndex",ll.STREAM_INDEX_SCREEN),n}return ib(r)}(),gC=function(e){dy(r,gg);var t=dC(r);function r(){var e,n;iE(this,r);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return iT(dn(n=t.call.apply(t,a4(e=[this]).call(e,o))),"streamIndex",ll.STREAM_INDEX_SCREEN),iT(dn(n),"sourceType",0),n}return ib(r)}(),gw=function(e){dy(r,gy);var t=dC(r);function r(){var e,n;iE(this,r);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return iT(dn(n=t.call.apply(t,a4(e=[this]).call(e,o))),"streamIndex",ll.STREAM_INDEX_SCREEN),iT(dn(n),"sourceType",0),n}return ib(r)}();function gx(){return(gx=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new gT(t,p7())).dummy=!0,e.next=4,n.generatePreProcessingTrack(r);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function gO(){return(gO=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new gR(t,p7())).dummy=!0,e.next=4,n.generatePreProcessingTrack(r);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function gN(e,t){return gP.apply(this,arguments)}function gP(){return(gP=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null==t||null===(n=t.deviceId)||void 0===n?void 0:n.exact)||"default",a=pZ(r.id),e.prev=2,g_.info("createCameraVideoTrack","constraints:",t),null==a||a.report("rtc_video_capture_event",{event_type:"start",media_device_id:o}),s=p9(),vw&&(t.frameRate={ideal:30,max:30}),e.next=9,gr.getUserMedia({video:t});case 9:i=e.sent,null==a||a.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:o,reason:"success",elapse:p9()-s}),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(2),null==a||a.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:o,error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new lM(le.GET_VIDEO_TRACK_FAILED,a4(c="throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ")).call(c,e.t0.message||"unknown message","."),e.t0);case 17:return u=i.getVideoTracks()[0],gp.set(u,i),d=new gT(u,p7()),e.next=22,d.generatePreProcessingTrack(r);case 22:return e.abrupt("return",d);case 23:case"end":return e.stop()}},e,null,[[{return gM.apply(this,arguments)}function gM(){return(gM=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g_.info("createMicrophoneAudioTrack","constraints:",t),o=(null==t||null===(n=t.deviceId)||void 0===n?void 0:n.exact)||"default",a=pZ(r.id),e.prev=3,null==a||a.report("rtc_video_capture_event",{event_type:"start",media_device_id:o}),s=p9(),(c=r.getPluginByName(gd.PRE_PROCESSING,"RTCAIAnsExtension"))&&(c.isOpen()?(t.autoGainControl=!0,t.noiseSuppression=!1):t.noiseSuppression=!0),e.next=10,gr.getUserMedia({audio:t});case 10:i=e.sent,null==a||a.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:o,reason:"success",elapse:p9()-s}),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(3),null==a||a.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:o,error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new lM(le.GET_AUDIO_TRACK_FAILED,a4(u="throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ")).call(u,e.t0.message||"unknown message","."),e.t0);case 18:return d=i.getAudioTracks()[0],gp.set(d,i),l=new gE(d,p7()),e.next=23,l.generatePreProcessingTrack(r);case 23:return e.abrupt("return",l);case 24:case"end":return e.stop()}},e,null,[[3,14]])}))).apply(this,arguments)}function gL(){return(gL=a2(a0().mark(function e(){var t,r,n,i,o,a,s,c,u,d=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]&&d[0],r=d.length>1?d[1]:void 0,n=d.length>2?d[2]:void 0,g_.info("createScreenTracks","withAudio: %o, constraints: %o",t,n),o=pZ(r.id),e.prev=5,null==o||o.report("rtc_video_capture_event",{event_type:"start",media_device_id:"screen"}),a=p9(),e.next=10,navigator.mediaDevices.getDisplayMedia({video:!(n&&(!vx||16!==vW))||n,audio:!!t&&{channelCount:2,noiseSuppression:!1,echoCancellation:!0,autoGainControl:!1}});case 10:i=e.sent,null==o||o.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:"screen",reason:"success",elapse:p9()-a}),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(5),null==o||o.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:"screen",error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new lM(le.GET_SCREEN_TRACK_FAILED,"throw error from getDisplayMedia",e.t0);case 18:return s=new gR(i.getVideoTracks()[0],p7()),e.next=22,s.generatePreProcessingTrack(r);case 22:if(!(c=i.getAudioTracks()[0])){e.next=28;break}return u=new gA(c,p7()),e.next=27,u.generatePreProcessingTrack(r);case 27:return e.abrupt("return",[s,u]);case 28:return e.abrupt("return",[s,void 0]);case 29:case"end":return e.stop()}},e,null,[[5,14]])}))).apply(this,arguments)}function gU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p7();return new gb(e,t)}function gV(){return(gV=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new gk(t,p7()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function gF(){return(gF=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new gI(t,p7()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function gB(){return(gB=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new gC(t,p7()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function gj(){return(gj=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new gw(t,p7()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var gG={LocalAudioTrack:gy,RemoteAudioTrack:gb},gH=((g8=gH||{})[g8.NONE=0]="NONE",g8),gz={getNalunits:function(e){if(e.length-e.position<4)return[];var t=e.position;return 1===e.getInt32(t)||0===e.getInt16(t)&&1===e.getInt8(t+2)?gz.getAnnexbNals(e):gz.getAvccNals(e)},getAnnexbNals:function(e){for(var t=[],r=gz.getHeaderPositionAnnexB(e),n=r.pos,i=n;n<e.length-4;){var o,a,s=new Uint8Array(a$(o=e.buffer).call(o,n,n+r.headerLength));r.pos===e.position&&e.skip(r.headerLength),i=(r=gz.getHeaderPositionAnnexB(e)).pos;var c={header:s,body:new Uint8Array(a$(a=e.buffer).call(a,n+s.byteLength,i)),type:-1};gz.analyseNal(c),c.type<=9&&0!==c.type&&t.push(c),e.skip(i-e.position),n=i}return t},getAvccNals:function(e){for(var t=[];e.position<e.length-4;){var r=e.getInt32(e.position);if(!(e.length-e.position>=r))break;var n,i,o=new Uint8Array(a$(n=e.buffer).call(n,e.position,e.position+4));e.skip(4);var a=new Uint8Array(a$(i=e.buffer).call(i,e.position,e.position+r));e.skip(r);var s={header:o,body:a,type:-1};gz.analyseNal(s),s.type<=9&&0!==s.type&&t.push(s)}return t},analyseNal:function(e){var t=31&e.body[0];switch(e.type=t,t){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:e.sei=!0;break;case 7:e.sps=!0;break;case 8:e.pps=!0}},getHeaderPositionAnnexB:function(e){for(var t=e.position,r=0,n=e.length;3!==r&&4!==r&&t<n-4;)0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:1===e.getInt8(t+2)?r=3:t++:t++;return t===n-4&&(0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:t=n:(t++,0===e.getInt16(t)&&1===e.getInt8(t)?r=3:t=n)),{pos:t,headerLength:r}}},gK=function(){function e(t){iE(this,e),iT(this,"_position",0),iT(this,"_dataview",void 0),this._dataview=new DataView(t)}return ib(e,[{key:"length",get:function(){return this.buffer.byteLength}},{key:"buffer",get:function(){return this._dataview.buffer}},{key:"position",get:function(){return this._position},set:function(e){thilue:function(e){this.position-=e}},{key:"getUint8",value:function(e){return this._dataview.getUint8(e)}},{key:"getInt8",value:function(e){return this._dataview.getInt8(e)}},{key:"getInt16",value:function(e){return this._dataview.getInt16(e)}},{key:"getUint16",value:function(e){return this._dataview.getUint16(e)}},{key:"getUint32",value:function(e){return this._dataview.geteturn this._dataview.getInt32(e)}},{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this,4);n>0&&e.readByte(this,n)}},{key:"readUint8",value:function(){return e.readByte(this,1)}},{key:"readUint16",value:function(){return e.readByte(this,2)}},{key:"readUint24",value:function(){return e.readByte(this,3)}},{key:"readUint32",value:function(){return e.readByte(tion(){return e.readByte(this,8)}},{key:"readInt8",value:function(){return e.readByte(this,1,!0)}},{key:"readInt16",value:function(){return e.readByte(thn(){return e.readByte(this255,e>>>16&255,e>>>8&255,255&e])}}],[{key:"readByte",value:function(e,t,r){var n;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw Error("not supported for readByte 3");n=e.getUint8(e.position)<<16|e.getUint8(e.position+1)<<8|e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw Error("not supported for readBody 8");n=e.getUint32(e.position)<<32|e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}(),gX=((g7=gX||{})[g7.internal=0]="internal",g7[g7.external=1]="external",g7[g7.bypass=2]="bypass",g7),gW=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,85]),gq=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,84]),gY=function(e){for(var t=[],r=0;r<e.length;r++)e[r]<=3&&0===e[r-1]&&0===e[r-2]&&t.push(3),t.push(e[r]);return new Uint8Array(t)},gJ=function(e){for(var t=[],r=0;r<e.length;r++)e[r]<=3&&0===e[r-1]&&0===e[r-2]||t.push(e[r]);return new Uint8Array(t)};function gQ(e){for(var t=[];e>=255;)e-=255,t.push(255);return t.push(e),new Uint8Array(t)}function gZ(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;255===e[t]&&t<e.byteLength;)t++,r+=255;return t<e.byteLength&&(rnction(){function e(){iE(this,e)}return ib(e,null,[{key:"generateSEI",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Uint8Array([0,0,0,1]),i=new Uint8Array([6]),o=new Uint8Array([5]),a=r?gW:gq,s=gQ(e.byteLength+a.byteLength),c=gY(e);return new Uint8Array(a4(t=[]).call(t,ud(n),ud(i),ud(o),ud(s),ud(a),ud(c),[128]))}},{key:"decodeSeiBody",value:function(e){var t=gJ(e=a$(e).call(e,0,e.length-1));if(!(t.byteLength<2)){var r=0;if(5===t[1]||100===t[1]){var n=u3(gZ(t,r+=2),2),i=n[0],o=2,a=(r=n[1])+i;return t.byteLength>=gq.byteLength&&i>=gq.byteLength&&a$(t).call(t,r,r+gq.byteLength).toString()===gq.toString()?(r+=gq.byteLength,o=1):t.byteLength>=gq.byteLength&&i>=gq.byteLength&&a$(t).call(t,r,r+gW.byteLength).toString()===gW.toString()&&(r+=gW.byteLength,o=0),{type:o,payload:a$(t).call(t,r,a)}}}}},{key:"parseInternalSEI",value:function(e){var t=new sF,r=0;if(0===e.type){for(;e.payload.byteLength-r>=2;){var n=u3(gZ(e.payload,r),2),i=n[0];r=n[1];var o,a=u3(gZ(e.payload,r),2),s=a[0];if(r=a[1],t.get(i)||!(s<=e.payload.byteLength-r))break;t.set(i,a$(o=e.payload).call(o,r,r+s)),r+=s}return t}}},{key:"makeInternalSei",value:function(e){var t,r=[],n=u2(e);try{for(n.s();!(t=n.n()).done;){var i=u3(t.value,2),o=i[0],a=i[1],s=gQ(o),c=gQ(a.byteLength);r.push(s,c,a)}}catch(e){n.e(e)ction(e,t){return e+t.byteLength},0),d=new return d.set(t,e),e+t.byteLength},0),d}}]),e}(),g0=new h1("Stats",3),g1=function(){function e(t){iE(this,e),iT(this,"player",void 0),iT(this,"_timer",void 0),iT(this,"handler",void 0),iT(this,"_monitor",void 0),iT(this,"_destroyed",!1),this._context=t,this._monitor=pZ(t.id)value:function(e){this.handler=e}},{key:"stopReport",value:function(e){var t;this._timer&&(g0.info("stopReport","invoke"),clearTimeout(this._timer),delete this._timer,p3(this._context.id,"del_media_statistics_timer",a4(t="reason: ".concat(e,", stack: ")).call(t,Error().stack),0,this._stream.streamId||""))}},{key:"filterIllegal",value:function(e){var t={};return sJ(e).forEach(function(r){null===e[r]||void 0===e[r]||Number.isNaN(e[r])||(t[r]=e[r])}),t}},{key:"destroy",value:function(){g0.info("destroy","invoke"),p3(this._context.id,"media_statistics_destroy","".concat(Error().stack),0,"".concat(this._stream.streamId)),this.stopReport("destroy"),this._destroyed=!0}}]),e}(),g2=fun),(r=n.call(this,e))._stream=t,r}return ib(i,[{key:"setLocalStreamStatsEvtInterval",value:function(e,t){var r,n,i,o=this;if(!this._timer){g0.info("setLocalStreamStatsEvtInterval","invoke"),this.setVar(t),this._destroyed=!1;var a,s,c={audio:{},video:{}},u=this._stream,d=null===(r=u.audioTrack)||void 0===r?void 0:r.getTrack("preprocessing"),l=null===(n=u.videoTrack)||void 0===n?void 0:n.getTrack("preprocessing");this.getAudioStats(d,c,null===(i=u.audioTrack)||void 0===i?void 0:i.getAudioLevel()),this.getVideoStats(l,c);var h=(a=a2(a0().mark(function e(){var t,r,n,i,a,s,d;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=null===(t=u.audioTrack)||void 0===t?void 0:t.getTrack("preprocessing"),a=null===(r=u.videoTrack)||void 0===r?void 0:r.getTrack("preprocessing"),e.next=4,o.getAudioStats(i,c,null===(n=u.audioTrack)||void 0===n?void 0:n.getAudioLevel());case 4:return s=e.sent,e.next=7,o.getVideoStats(a,c);case 7:return d=e.sent,e.abrupt("return",{audioStats:s,videoStats:d,isScreen:u.isScreen});case 9:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)}),_=(s=a2(a0().mark(function t(){return a0().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h();case 2:e(t.sent),o._destroyed||(o._timer=setTimeout(_,2e3));case 5:case"end":return t.stop()}},t)})),function(){return s.apply(this,arguments)});this._timer=setTimeout(_,2e3)}}},{key:"getAudioStats",value:(r=a2(a0().mark(function e(t,r,n){var i,o,a,s,c,u,d,l,h,_,p,v,f,m,g;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},c={timestamp:Date.now()},d=(u=this._stream).streamId,l=u.audioMid,h=u.isScreen,_=u.pubAttributes,p=u.pubAudio,v=u.audioTrack,f={media_type:"audio",is_screen:!!h,direction:"up",stream_id:d,vid:l,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,capture_state:_.localaudio?"capture_state_on":"capture_state_off",mute_state:p?"mute_state_off":"mute_state_on"},v&&(f.playback_volume=v.getVolume()),t&&this.handler){e.next=7;break}return e.abrupt("return",s);case 7:return e.next=9,this.handler.getStats(t);case 9:if((m=e.sent).length){e.next=12;break}return e.abrupt("return",s);case 12:if(m.forEach(function(e){var t=e.type,r=e.packetsSent,n=e.packetsLost,i=e.bytesSent,o=e.clockRate,a=e.roundTripTime,u=e.channels,d=e.audioLevel;e.googRtt;var l=e.mimeType,h=e.availableIncomingBitrate,_=e.availableOutgoingBitrate,p=e.bytesReceived,v=e.nominated,m=e.id,g=e.currentRoundTripTime,y=e.state,S=e.writable,b=e.requestsReceived,E=e.responsesReceived,T=e.requestsSent,k=e.consentRequestsSent,I=e.responsesSent,R=e.jitter,A=e.candidateType,C=e.ip,w=e.address,x=e.networkType,O=e.port,N=e.protocol,P=e.nackCount,D=e.retransmittedBytesSent,M=e.retransmittedPacketsSent,L=e.audioInputLevel,U=e.ssrc,V=e.totalAudioEnergy,F=e.totalSamplesDuration,B=e.mediaType,j=e.fractionLost;"outbound-rtp"===t?(c.packetsSent=r,c.bytesSent=i,f.bytes=i,f.packetsSent=r,f.nackCount=P,f.ssrc=U,f.retransmitted_bytes_sent=D,f.retransmitted_packets_sent=M,c.retransmittedBytesSent=D,c.retransmittedPacketsSent=M):"remote-inbound-rtp"===t?(c.packetsLost=n,f.packetsLost=n,f.net_jitter=1e3*R,s.rtt=1e3*a,f.rtt=s.rtt,s._fractionLost=j||0):"codec"===t?(s.recordSampleRate=o,s.numChannels=u,f.codecName=l):"media-source"===t&&void 0!==d?(f.audio_level=d?-10*hC(Math.pow(d,2)):d,f.volume=255*d,f.total_audio_energy=V,f.totalInputDuration=F):"ssrc"===t&&"audio"===B?f.send_level=L:"candidate-pair"===t?(f.ice_available_incoming_bitrate=h,f.ice_available_outgoing_bitrate=_,f.ice_bytes_received=p,f.ice_bytes_sent=i,f.ice_nominated=Number(v),f.ice_pair_id=m,f.ice_pair_rtt=g,f.ice_pair_state=y,f.ice_pair_writable=S,f.recv_ping_requests=b,f.recv_ping_responses=E,f.sent_ping_requests_before_first_response=T,f.sent_ping_requests_total=T+(k||0),f.sent_ping_responses=I):"local-candidate"===t?(f.local_candidate_type=A,f.local_ip=C||w,f.local_network_type=x,f.local_port=O,f.protocol=N):"remote-candidate"===t&&(f.remote_candidate_type=A,f.remote_ip=C||w,f.remote_port=O);var G=fn("STATS_SCALLBACK_SUPPORT");fQ&&G||"media-source"===t&&(f.send_level=d)}),void 0===f.volume&&void 0!==n&&(f.volume=n,f.audio_level=n?-10*hC(Math.pow(n/255,2)):n),(g=r.audio).timestamp){e.next=18;break}return r.audio=c,e.abrupt("return",this.filterIllegal(s));case 18:return void 0!==c.packetsLost&&(s.audioLossRate=(c.packetsLost-g.packetsLost)/(c.packetsSent-g.packetsSent),s.audioLossRate=Number.isNaN(s.audioLossRate)?0:s.audioLossRate,f.fraction_lost=s.audioLossRate),s.statsInterval=c.timestamp-g.timestamp,f.stats_interval=s.statsInterval,s.sendKBitrate=(c.bytesSent-g.bytesSent||0)/s.statsInterval*8,f.mediaBitratebps=Math.round(1e3*s.sendKBitrate),f.bandwidth=Math.round(f.mediaBitratebps/1024),void 0!==c.retransmittedBytesSent&&(f.retransmitBitratebps=(c.retransmittedBytesSent-g.retransmittedBytesSent||0)/s.statsInterval),r.audio=c,f.vendor_mode=(null===(i=this._stream)||void 0===i?void 0:i.vendorCode)||0,f.pc_session_id=null===(o=this.handler)||void 0===o?void 0:o.peerConnectionId,null===(a=this._monitor)||void 0===a||a.report("rtc_media_statistics",f),s._retransmittedRate=(c.retransmittedPacketsSent-g.retransmittedPacketsSent)/(c.packetsSent-g.packetsSent),void 0===s.audioLossRate&&(s.audioLossRate=s._retransmittedRate,f.fraction_lost=s.audioLossRate),s._fractionLost=Math.max(s._fractionLost,s.audioLossRate),e.abrupt("return",this.filterIllegal(s));case 33:case"end":return e.stop()}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"getVideoStats",value:(t=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},i={timestamp:Date.now(),simulcast:{}},a=(o=this._stream).streamId,s=o.videoMid,c=o.isScreen,u=o.pubAttributes,d=o.enableSimulcast,l=o.pubVideo,e.t0=dr,e.t1={media_type:"video",is_screen:!!c,direction:"up",stream_id:a,vid:s,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,capture_state:u.localvideo?"capture_state_on":"capture_state_off",mute_state:l?"mute_state_off":"mute_state_on"},e.next=7,this._stream.requestVideoFrameCallback();case 7:if(e.t2=e.sent,h=(0,e.t0)(e.t1,e.t2),t&&this.handler){e.next=11;break}return e.abrupt("return",n);case 11:return h.cap_frame_width=t.getSettings().width,h.cap_frame_height=t.getSettings().height,h.frameRateSent=t.getSettings().frameRate,n.isScreen=c,e.next=17,this.handler.getStats(t);case 17:if((_=e.sent).length){e.next=20;break}return e.abrupt("return",n);case 20:if(p=0,_.forEach(function(e){var t=e.type,o=e.framesEncoded,a=e.packetsLost,s=e.bytesSent,c=e.framesSent,u=e.retransmittedBytesSent,l=e.totalPacketSendDelay,_=e.totalEncodeTime,v=e.firCount,f=e.targetBitrate,m=e.roundTripTime,g=e.mimeType,y=e.frameWidth,S=e.frameHeight,b=e.packetsSent,E=e.googActualEncBitrate,T=e.googAvailableReceiveBandwidth,k=e.googAvailableSendBandwidth,I=e.googAvgEncodeMs,R=e.googBucketDelay,A=e.googEncodeUsagePercent,C=e.googFrameRateInput,w=e.availableIncomingBitrate,x=e.availableOutgoingBitrate,O=e.bytesReceived,N=e.nominated,P=e.id,D=e.currentRoundTripTime,M=e.state,L=e.writable,U=e.candidateType,V=e.ip,F=e.address,B=e.networkType,j=e.port,G=e.nackCount,H=e.pliCount,z=e.protocol,K=e.qpSum,X=e.requestsReceived,W=e.responsesReceived,q=e.googRetransmitBitrate,Y=e.requestsSent,J=e.consentRequestsSent,Q=e.responsesSent,Z=e.ssrc,$=e.googTargetEncBitrate,ee=e.googTransmitBitrate,et=e.retransmittedPacketsSent,er=e.encoderImplementation,en=e.jitter,ei=e.rid,eo=e.fractionLost,ea=e.googAdaptationChanges,es=e.qualityLimitationReason,ec=e.qualityLimitationDurations,eu=e.googFirsReceived,ed=e.googFrameRateSent,el=e.keyFramesEncoded,eh=e.scalabilityMode,e_=e.framesPerSecond,ep=e.frames;"outbound-rtp"===t?(d&&(ei?i.simulcast[ei]=e:i.simulcast[p]=e,p++),i.framesEncoded=o||i.framesEncoded||0,h.key_frames_encoded=el||0,i.bytesSent=s||i.bytesSent||0,i.framesSent=c||i.framesSent,h.bytes=s||h.bytes||0,i.packetsSent=b||i.packetsSent||0,h.packetsSent=b||h.packetsSent||0,h.nackCount=G||h.nackCount||0,h.pli_count=H||h.pli_count||0,h.qp_sum=K||h.qp_sum||0,h.ssrc=Z||h.ssrc||0,h.retransmitted_packets_sent=et,i.retransmittedPacketsSent=et,i.retransmittedBytesSent=u,h.encoder_implementation=er,h.qualityLimitationReason=es,h.qualityLimitationDurations=ec,h.scalabilityMode=eh,void 0!==y&&((!n.encodedFrameWidth||y>n.encodedFrameWidth)&&(n.encodedFrameWidth=y),(!n.encodedFrameHeight||S>n.encodedFrameHeight)&&(n.encodedFrameHeight=S),h.frame_size_height=S,h.frame_size_width=y)):"track"===t?(n.encodedFrameWidth=y,n.encodedFrameHeight=S,h.frame_size_height=S,h.frame_size_width=y):"remote-inbound-rtp"===t?(i.packetsLost=a,n.rtt=1e3*m,h.rtt=n.rtt,h.jitter=1e3*en,h.packetsLost=a,n._fractionLost=eo||0):"codec"===t?(n.codecType=g,h.codecName=g):"candidate-pair"===t?(h.ice_available_incoming_bitrate=w,h.ice_available_outgoing_bitrate=x,h.ice_bytes_received=O,h.ice_bytes_sent=s,h.ice_nominated=Number(N),h.ice_pair_id=P,h.ice_pair_rtt=D,h.ice_pair_state=M,h.ice_pair_writable=L,h.recv_ping_requests=X,h.recv_ping_responses=W,h.sent_ping_requests_before_first_response=Y,h.sent_ping_requests_total=Y+J,h.sent_ping_responses=Q):"local-candidate"===t?(h.local_candidate_type=U,h.local_ip=V||F,h.local_network_type=B,h.local_port=j,h.protocol=z):"remote-candidate"===t?(h.remote_candidate_type=U,h.remote_ip=V||F,h.remote_port=j):"VideoBwe"===t?(h.encBitratebps=E,h.available_receive_bandwidth=T,h.available_send_bandwidth=k,h.bucket_delay=R,h.retransmitBitratebps=q,h.targetEncBitratebps=$,h.transmit_bitrate=ee,n._sendBandWidth=Number(k)):"ssrc"===t&&(h.avg_encode_ms=I,h.encodeUsage=A,h.frame_rate_input=C,h.orignal_input_Framerate=Number(C),h.ddaptationChanges=ea,h.firsReceived=eu,h.frameRateSent=ed);var ev=fn("STATS_SCALLBACK_SUPPORT");if(!fQ||!ev){var ef=r.video,em=i.timestamp-ef.timestamp;if("outbound-rtp"===t){var eg=s-ef.bytesSent,ey=u-ef.retransmittedBytesSent;h.encBitratebps=Math.round(8e3*(eg-ey)/em),h.bucket_delay=l/b,h.retransmitBitratebps=Math.round(8e3*ey/em),h.targetEncBitratebps=f,h.transmit_bitrate=Math.round(1e3*(s-ef.bytesSent)*8/em),h.avg_encode_ms=1e3*_/o,h.firsReceived=v+H}else"candidate-pair"===t?(h.available_send_bandwidth=x,n._sendBandWidth=x):"media-source"===t&&(h.frame_rate_input=e_,h.orignal_input_Framerate=Number(e_),h.frame_input=ep)}}),(v=r.video).timestamp){e.next=26;break}return r.video=i,e.abrupt("return",this.filterIllegal(n));case 26:return n.statsInterval=i.timestamp-v.timestamp,h.stats_interval=n.statsInterval,f=sJ(i.simulcast),d?(h.sim_enc_width=[],h.sim_enc_height=[],h.sim_enc_bps=[],h.sim_enc_framerate=[],h.sim_enc_key_frames=[],h.sim_rids=[],h.sim_enc_bandwidth=[],h.sim_sent_framerate=[],h.sim_fraction_lost=[],h.sim_keyencoded=[],h.active_sim_streams=(null===(m=this._context)||void 0===m?void 0:m.activeSimStreams)||[],h.sim_retra(e,t){return Number(e)-Number(t)}).forEach(function(e){var t=i.simulcast[e],r=t.frameWidth,o=t.frameHeight,a=t.bytesSent,s=t.framesEncoded,c=t.framesSent,u=t.packetsLost,d=t.packetsSent,l=t.qualityLimitationReason,_=t.qualityLimitationDurations,p=t.qualityLimitationResolutionChanges,f=t.retransmittedPacketsSent,m=t.pliCount,g=t.keyFramesEncoded;void 0!==l&&(h.sim_qualityLimitationReason||(h.sim_qualityLimitationReason=[],h.sim_qualityLimitationDurations=[],h.sim_qualityLimitationResolutionChanges=[]),h.sim_qualityLimitationReason.push(l),h.sim_qualityLimitationDurations.push(_),h.sim_qualityLimitationResolutionChanges.push(p));var y=v.simulcast[e];if(h.sim_enc_width.push(r||0),h.sim_enc_height.push(o||0),h.sim_enc_key_frames.push(g||0),y){var S=(a-y.bytesSent||0)/n.statsInterval;h.sim_enc_bps.push(Math.round(8e3*S)),h.sim_enc_bandwidth.push(Math.round(8e3*S/1024));var E=1e3*(s-y.framesEncoded)/n.statsInterval;h.sim_enc_framerate.push(Math.round(E)),h.sim_rids.push(e);var T=void 0!==c?c-y.framesSent:s-y.framesEncoded,k=1e3*T/n.statsInterval;h.sim_sent_framerate.push(Math.round(k));var I=(u-y.packetsLost)/(d-y.packetsSent);n._retransmittedRate=(f-y.retransmittedPacketsSent)/(d-y.packetsSent),I=Number.isNaN(I)?0:I,h.sim_fraction_lost.push(I),h.sim_keyencoded.push(m-y.pliCount>0),h.sim_retransmittedRate.push(n._retransmittedRate),r>0&&!b&&(n.sentKBitrate=8*S,n.encoderOutputFrameRate=E,n.encodedFrameCount=T,n.sentFrameRate=k,n.videoLossRate=I,b=!0)}}),h.vendor_mode=(null===(g=this._stream)||void 0===g?void 0:g.vendorCode)||0,h.pc_session_id=null===(y=this.handler)||void 0===y?void 0:y.peerConnectionId,null===(S=this._monitor)||void 0===S||S.report("rtc_media_statistics",h)):(n.encodedFrameCount=void 0!==i.framesSent?i.framesSent-v.framesSent:i.framesEncoded-v.framesEncoded,n.sentKBitrate=(i.bytesSent-v.bytesSent||0)/n.statsInterval*8,h.bitrate=Math.round(1e3*n.sentKBitrate),h.bandwidth=Math.round(h.bitrate/1024),n.encoderOutputFrameRate=1e3*(i.framesEncoded-v.framesEncoded)/n.statsInterval,h.frame_rate_encoded=Math.round(n.encoderOutputFrameRate),n.sentFrameRate=1e3*n.encodedFrameCount/n.statsInterval,h.frame_rate_sent=Math.round(n.sentFrameRate),n.videoLossRate=(i.packetsLost-v.packetsLost)/(i.packetsSent-v.packetsSent),n.videoLossRate=Number.isNaN(n.videoLossRate)?0:n.videoLossRate,h.fraction_lost=n.videoLossRate,n._retransmittedRate=(i.retransmittedPacketsSent-v.retransmittedPacketsSent)/(i.packetsSent-v.packetsSent),h.vendor_mode=(null===(E=this._stream)||void 0===E?void 0:E.vendorCode)||0,h.pc_session_id=null===(T=this.handler)||void 0===T?void 0:T.peerConnectionId,null===(k=this._monitor)||void 0===k||k.report("rtc_media_statistics",h)),r.video=i,n._fractionLost=Math.max(n._fractionLost,n.videoLossRate),e.abrupt("return",this.filterIllegal(n));case 33:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})}]),i}(),g3=function(e){dy(o,g1);var t,r,n,i=dC(o);function o(e,t){var r;return iE(this,o),iT(dn(r=i.call(this,e)),"isPaused",void 0),iT(dn(r),"pauseStart",void 0),iT(dn(r),"pauseDuration",void 0),iT(dn(r),"_audioStallCount",void 0),iT(dn(r),"_setAudioStallCount",void 0),iT(dn(r),"_audioStallTimer",void 0),iT(dn(r),"_audioStallInterval",void 0),iT(dn(r),"_audioStallRatio",void 0),iT(dn(r),"_videoInWaiting",void 0),r._stream=t,r._videoInWaiting=!1,r.pauseDuration=0,r}return ib(o,[{key:"setRemoteStreamStatsEvtInterval",value:(n=a2(a0().mark(function e(t,r){var n,i,a,s,c,u,d,l,h,_,p,v,f,m,g,y=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._timer){e.next=2;break}return e.abrupt("return");case 2:return g0.info("setRemoteStreamStatsEvtInterval","invoke"),this.setVar(r),this._audioStallInterval=o.audioStallInterval||100,this._audioStallRatio=o.audioStallRatio||.6,s={audio:{},video:{}},this._destroyed=!1,u=null===(n=(c=this._stream).audioTrack)||void 0===n?void 0:n.getOrgTrack(),d=null===(i=c.videoTrack)||void 0===i?void 0:i.getTrack(),this.getRemoteVideoStats(d,s),e.next=14,this.getRemoteAudioStats(u,s,null===(a=this._stream.audioTrack)||void 0===a?void 0:a.getAudioLevel());case 14:this._stopAudioStallTimer(),l=0,h=0,p=[],v=0,f=p9(),this._setAudioStallCount=function(){if(ft.AUDIO_STALL&&y._audioStallInterval>0&&void 0!==s.audio.concealedSamples){var e=s.audio.concealedSamples,t=s.audio.totalSamplesReceived;f=p9();var r={isStall:!1,counted:!1,diff:0},n=.5*y._audioStallInterval;y._audioStallCount=a2(a0().mark(function i(){var o,a,s,u,d,_,m,g,S,b,E,T,k,I,R,A,C,w,x,O;return a0().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=c.hasAudio,s=c.subAudio,u=c.virtual,d=c.virtualOccupy,!c.removeTrack){i.next=4;break}return clearTimeout(y._audioStallTimer),i.abrupt("return");case 4:if(a&&s){i.next=10;break}return r.isStall=!1,r.counted=!1,p.push({reason:a4(_="hasAudio: ".concat(a,", subAudio: ")).call(_,s)}),f=p9(),i.abrupt("return",{stall_count:l,stall_duration:h,stall_list:p,stats_count:v});case 10:if(!u||d){i.next=16;break}return r.isStall=!1,r.counted=!1,p.push({reason:a4(m="virtual: ".concat(u,", virtualOccupy: ")).call(m,d)}),f=p9(),i.abrupt("return",{stall_count:l,stall_duration:h,stall_list:p,stats_count:v});case 16:return g=null===(o=c.audioTrack)||void 0===o?void 0:o.getOrgTrack(),S=Date.now(),i.next=20,y.handler.getStats(g,!0);case 20:if(b=i.sent,E=Date.now(),!((k=(T=p9())-f)<n)){i.next=27;break}return p.push({diff:k,start:f,end:T,get_stats_cost:E-S,get_stats_start:S,get_stats_end:E,reason:a4(I="diff(".concat(k,") < minInterval(")).call(I,n,")")}),i.abrupt("return",{stall_count:l,stall_duration:h,stall_list:p,stats_count:v});case 27:if(R=b.length,A=cS(b).call(b,function(e){return"inbound-rtp"===e.type})){i.next=32;break}return p.push({diff:k,start:f,end:T,get_stats_cost:E-S,get_stats_start:S,get_stats_end:E,reason:R?"no inbound-rtp":"no report"}),i.abrupt("return",{stall_count:l,stall_duration:h,stall_list:p,stats_count:v});case 32:return C=A.concealedSamples,O=(w=A.totalSamplesReceived)-t,(x=C-e)>=0&&O>=0&&x>=y._audioStallRatio*O?(p.push({concealed:x,received:O,diff:k,start:f,end:T,get_stats_cost:E-S,get_stats_start:S,get_stats_end:E,is_stall:!0}),r.isStall?(r.counted?h+=k:(h=h+r.diff+k,l++),r.counted=!0):k>=200?(h+=k,l++,r.counted=!0):(r.counted=!1,r.diff=k),r.isStall=!0):(p.push({concealed:x,received:O,diff:k,start:f,end:T,get_stats_cost:E-S,get_stats_start:S,get_stats_end:E}),r.isStall=!1,r.counted=!1),e=C,t=w,f=T,v++,i.abrupt("return",{stall_count:l,stall_duration:h,stall_list:p,stats_count:v});case 41:case"end":return i.stop()}},i)})),_=function(){var e=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!y._audioStallCount&&y._setAudioStallCount&&y._setAudioStallCount(),!y._audioStallCount){e.next=6;break}return e.next=4,y._audioStallCount();case 4:y._audioStallTimer&&clearTimeout(y._audioStallTimer),y._audioStallTimer=setTimeout(_,y._audioStallInterval);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),y._audioStallTimer&&clearTimeout(y._audioStallTimer),y._audioStallTimer=setTimeout(_,y._audioStallInterval)}},this._setAudioStallCount(),m=function(){var e=a2(a0().mark(function e(){var t,r,n,i,o,a,u;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=null===(t=c.audioTrack)||void 0===t?void 0:t.getOrgTrack(),o=null===(r=c.videoTrack)||void 0===r?void 0:r.getTrack(),e.next=4,y.getRemoteAudioStats(i,s,null===(n=y._stream.audioTrack)||void 0===n?void 0:n.getAudioLevel());case 4:return a=e.sent,l=0,h=0,p=[],v=0,e.next=11,y.getRemoteVideoStats(o,s);case 11:return u=e.sent,e.abrupt("return",{audioStats:a,videoStats:u,isScreen:c.isScreen,userId:c.userId,streamId:c.streamId});case 13:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),g=function(){var e=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m();case 2:t(e.sent),_&&(f=p9(),y._audioStallTimer&&clearTimeout(y._audioStallTimer),y._audioStallTimer=setTimeout(_,y._audioStallInterval)),y._timer&&clearTimeout(y._timer),y._destroyed||(y._timer=setTimeout(g,2e3));case 7:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),this._timer&&clearTimeout(this._timer),this._timer=setTimeout(g,2e3);case 26:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"_stopAudioStallTimer",value:function(){clearTimeout(this._audioStallTimer),this._audioStallCount=void 0,this._setAudioStallCount=void 0,this.pauseDuration=0}},{key:"unsubscribe",value:function(){g0.info("unsubscribe","invoke"),dm(df(o.prototype),"stopReport",this).call(this,"unsubscribe"),this._stopAudioStallTimer(),this._videoInWaiting=!1}},{key:"getRemoteAudioStats",value:(r=a2(a0().mark(function e(t,r,n){var i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d={},l={},_=(h=this._stream).streamId,p=h.userId,v=h.isScreen,f=h.audioMid,m=h.subMediaType,g=h._attributes,y=h.virtual,S=h.audioTrack,b={media_type:"audio",is_screen:!!v,direction:"down",stream_id:_,stream_user_id:p,vid:f,audio_mux:y,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,mute_state:vc(m)?"mute_state_off":"mute_state_on",remote_user_capture_state:g.localaudio?"capture_state_on":"capture_state_off",remote_user_mute_state:g.localaudio&&g.audiostream?"mute_state_off":"mute_state_on"},S&&(b.playback_volume=S.getVolume()),t&&this.handler){e.next=7;break}return e.abrupt("return",d);case 7:return e.next=9,this.handler.getStats(t);case 9:if((E=e.sent).length){e.next=12;break}return e.abrupt("return",d);case 12:if(E.forEach(function(e){var t,r,i,o=e.type,a=e.packetsLost,s=e.packetsReceived,c=e.bytesReceived,u=e.jitterBufferDelay,h=e.jitterBufferEmittedCount,p=e.clockRate,v=e.channels,f=e.totalSamplesReceived,m=e.concealedSamples,g=e.silentConcealedSamples,y=e.concealmentEvents,S=e.totalRoundTripTime,E=e.packetsDiscarded,T=e.state,k=e.currentRoundTripTime,I=e.audioLevel,R=e.totalAudioEnergy,A=e.totalSamplesDuration,C=e.mimeType,w=e.googDecodingNormal,O=e.googDecodingMuted,N=e.availableIncomingBitrate,P=e.availableOutgoingBitrate,D=e.bytesSent,M=e.nominated,L=e.id,U=e.writable,V=e.jitter,F=e.candidateType,B=e.ip,j=e.address,G=e.networkType,H=e.port,z=e.protocol,K=e.audioOutputLevel,X=e.requestsReceived,W=e.responsesReceived,q=e.requestsSent,Y=e.consentRequestsSent,J=e.responsesSent,Q=e.ssrc;e.kind;var Z=e.nackCount,$=e.lastPacketReceivedTimestamp,ee=e.concealmentevents,et=e.fecPacketsReceived;"inbound-rtp"===o?(l.packetsLost=a,l.packetsReceived=s,b.packetsLost=a,b.packetsReceived=s,b.packetsDiscarded=E,b.nackCount=Z,b.lastPacketReceivedTimestamp=$,b.concealmentevents=ee,l.bytesReceived=c,void 0!==u&&(d.jitterBufferDelay=u/h*1e3,b.average_jitter_buffer_delay_ms=d.jitterBufferDelay),void 0!==f&&(l.totalSamplesReceived=f,d.concealedSamples=m,l.concealedSamples=m,l.silentConcealedSamples=g,b.concealedSamples=m,d.concealmentEvents=y,b.totalSamplesReceived=f),void 0!==et&&(b.fec_packets_received=et,l.fecPacketsReceived=et),b.jitter=1e3*V,b.ssrc=Q,void 0!==I&&0!==I?(b.audio_level=I?-10*hC(Math.pow(I,2)):I,b.volume=255*I):(b.volume=null!=n?n:255*I,b.audio_level=n?-10*hC(Math.pow(n/255,2)):n),void 0!==R&&(b.total_audio_energy=R),void 0!==A&&(b.totalAudioDuration=A)):"codec"===o?(d.recordSampleRate=p,v&&(d.numChannels=v),b.codecName=C):"candidate-pair"===o?(b.ice_available_incoming_bitrate=N,b.ice_available_outgoing_bitrate=P,b.ice_bytes_received=c,b.ice_bytes_sent=D,b.ice_nominated=Number(M),b.ice_pair_id=L,b.ice_pair_rtt=k,b.rtt=1e3*k,b.rtt&&null!==(t=x._context)&&void 0!==t&&null!==(r=t.streamRTT)&&void 0!==r&&null!==(i=r[_])&&void 0!==i&&i.audio&&(b.total_rtt_ms=Math.round(b.rtt+x._context.streamRTT[_].audio)),b.ice_pair_state=T,b.ice_pair_writable=U,b.recv_ping_requests=X,b.recv_ping_responses=W,b.sent_ping_requests_before_first_response=q,b.sent_ping_requests_total=q+(Y||0),b.sent_ping_responses=J,"succeeded"===T&&(d.rtt=1e3*k,d.total_rtt=1e3*S)):"track"===o&&void 0!==I?(0===I&&0!==n?(b.volume=n,b.audio_level=n?-10*hC(Math.pow(n/255,2)):n):(b.audio_level=I?-10*hC(Math.pow(I,2)):I,b.volume=255*I),b.total_audio_energy=R,b.totalAudioDuration=A):"ssrc"===o?(b.decodingNormal=w,b.recvAudioLevel=K,b.decodingMuted=O):"local-candidate"===o?(b.local_candidate_type=F,b.local_ip=B||j,b.local_network_type=G,b.local_port=H,b.protocol=z):"remote-candidate"===o&&(b.remote_candidate_type=F,b.remote_ip=B||j,b.remote_port=H)}),(T=r.audio).timestamp){e.next=18;break}return l.timestamp=Date.now(),r.audio=l,e.abrupt("return",this.filterIllegal(d));case 18:if(k={},void 0!==l.concealedSamples&&(b.interval_concealed_samples=l.concealedSamples-T.concealedSamples,b.interval_samples_received=l.totalSamplesReceived-T.totalSamplesReceived,b.interval_silent_concealed_samples=l.silentConcealedSamples-T.silentConcealedSamples),!(this._audioStallInterval>0&&void 0!==T.concealedSamples)||(!this._audioStallCount&&this._setAudioStallCount&&this._setAudioStallCount(),clearTimeout(this._audioStallTimer),!this._audioStallCount)){e.next=36;break}return e.next=26,this._audioStallCount();case 26:R=(I=e.sent).stall_count,A=I.stall_duration,C=I.stall_list,w=I.stats_count,k.stall_list=C,k.stats_count=w,b.concealedSamples===b.interval_concealed_samples&&b.totalSamplesReceived===b.interval_samples_received?(b.stall_count=0,b.stall_duration=0):(b.stall_count=R,b.stall_duration=A),d.stallCount=b.stall_count,d.stallDuration=b.stall_duration;case 36:return l.timestamp=Date.now(),d.audioLossRate=(l.packetsLost-T.packetsLost)/(l.packetsReceived-T.packetsReceived+(l.packetsLost-T.packetsLost)),d.audioLossRate=Number.isNaN(d.audioLossRate)?0:d.audioLossRate,b.fraction_lost=d.audioLossRate,d.statsInterval=l.timestamp-T.timestamp,b.stats_interval=d.statsInterval,d.receivedKBitrate=(l.bytesReceived-T.bytesReceived||0)/d.statsInterval*8,b.bandwidth=Math.round(1e3*d.receivedKBitrate/1024),void 0!==l.concealedSamples&&(d.receivedSampleRate=1e3*b.interval_samples_received/d.statsInterval),void 0!==l.fecPacketsReceived&&(b.fecBitratebps=(l.fecPacketsReceived-T.fecPacketsReceived||0)/d.statsInterval),b.average_jitter_buffer_delay_ms&&b.total_rtt_ms&&(d.e2eDelay=b.average_jitter_buffer_delay_ms+b.total_rtt_ms),null!==(i=this._context)&&void 0!==i&&null!==(o=i.streamRTT)&&void 0!==o&&null!==(a=o[_])&&void 0!==a&&a.audio&&(d.totalRtt=(b.rtt?b.rtt:0)+this._context.streamRTT[_].audio),r.audio=l,b.vendor_mode=(null===(s=this._stream)||void 0===s?void 0:s.vendorCode)||0,b.pc_session_id=null===(c=this.handler)||void 0===c?void 0:c.peerConnectionId,null===(u=this._monitor)||void 0===u||u.report("rtc_media_statistics",b,k),e.abrupt("return",this.filterIllegal(d));case 53:case"){return r.apply(this,arguments)})},{key:"getRemoteVideoStats",value:(t=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u={},d={timestamp:Date.now()},h=(l=this._stream).streamId,_=l.userId,p=l.isScreen,v=l.subMediaType,f=l._attributes,e.t0=dr,e.t1={media_type:"video",is_screen:!!p,direction:"down",stream_id:h,stream_user_id:_,vid:this._stream.videoMid,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,mute_state:vu(v)?"mute_state_off":"mute_state_on",remote_user_capture_state:f.localvideo?"capture_state_on":"capture_state_off",remote_user_mute_state:f.localvideo&&f.videostream?"mute_state_off":"mute_state_on"},e.next=7,this._stream.requestVideoFrameCallback();case 7:if(e.t2=e.sent,m=(0,e.t0)(e.t1,e.t2),t&&this.handler){e.next=11;break}return e.abrupt("return",u);case 11:return u.isScreen=p,e.next=14,this.handler.getStats(t);case 14:if((g=e.sent).length){e.next=17;break}return e.abrupt("return",u);case 17:if(g.forEach(function(e){var t,r,n,i=e.type,o=e.frameHeight,a=e.frameWidth,s=e.packetsLost,c=e.packetsReceived,l=e.bytesReceived,_=e.framesDecoded,p=e.jitterBufferDelay,v=e.jitterBufferEmittedCount,f=e.mimeType,g=e.firCount,y=e.availableIncomingBitrate,S=e.availableOutgoingBitrate,E=e.bytesSent,T=e.nominated,k=e.id,I=e.currentRoundTripTime,R=e.state,A=e.writable,C=e.candidateType,w=e.ip,x=e.address,O=e.networkType,N=e.port,P=e.nackCount,D=e.pliCount,M=e.protocol,L=e.requestsReceived,U=e.responsesReceived,V=e.requestsSent,F=e.consentRequestsSent,B=e.responsesSent,j=e.ssrc,G=e.jitter,H=e.framesReceived,z=e.keyFramesDecoded,K=e.totalDecodeTime,X=e.decoderImplementation,W=e.lastPacketReceivedTimestamp,q=e.framesDropped;"inbound-rtp"===i?(d.packetsLost=s,m.packetsLost=s,d.packetsReceived=c,m.packetsReceived=c,d.bytesReceived=l,m.bytes=l,d.framesDecoded=_,d.totalDecodeTime=K,void 0!==p&&(d.jitterBufferDelay=p/v*1e3,m.average_jitter_buffer_delay_ms=d.jitterBufferDelay),m.fir_count=g,m.nackCount=P,d.nackCount=P,m.pli_count=D,m.ssrc=j,m.framesDropped=q,m.jitter=1e3*G,m.framesReceived=H,d.framesReceived=H,m.framesDecoded=_,m.key_frames_decoded=z,m.decoder_name=X,m.last_packet_received_timestamp=W,void 0!==a&&(u.width=a,m.frame_size_width=a,u.height=o,m.frame_size_height=o)):"track"===i&&void 0!==a?(u.width=a,m.frame_size_width=a,u.height=o,m.frame_size_height=o,void 0!==H&&(m.framesReceived=H,d.framesReceived=H)):"codec"===i?m.codecName=f:"candidate-pair"===i?(m.ice_available_incoming_bitrate=y,m.ice_available_outgoing_bitrate=S,m.ice_bytes_received=l,m.ice_bytes_sent=E,m.ice_nominated=Number(T),m.ice_pair_id=k,m.ice_pair_rtt=I,m.rtt=1e3*I,m.rtt&&null!==(t=b._context)&&void 0!==t&&null!==(r=t.streamRTT)&&void 0!==r&&null!==(n=r[h])&&void 0!==n&&n.video&&(m.total_rtt_ms=Math.round(m.rtt+b._context.streamRTT[h].video)),u.rtt=m.rtt,m.ice_pair_state=R,m.ice_pair_writable=A,m.recv_ping_requests=L,m.recv_ping_responses=U,m.sent_ping_requests_before_first_response=V,m.sent_ping_requests_total=V+(F||0),m.sent_ping_responses=B):"local-candidate"===i?(m.local_candidate_type=C,m.local_ip=w||x,m.local_network_type=O,m.local_port=N,m.protocol=M):"remote-candidate"===i&&(m.remote_candidate_type=C,m.remote_ip=w||x,m.remote_port=N)}),(y=r.video).timestamp){e.next=22;break}return r.video=d,e.abrupt("return",this.filterIllegal(u));case 22:return u.videoLossRate=(d.packetsLost-y.packetsLost)/(d.packetsReceived-y.packetsReceived+(d.packetsLost-y.packetsLost)),y.totalDecodeTime&&y.framesDecoded&&d.framesDecoded!==y.framesDecoded&&(m.decode_elapse_per_frame=Number(((d.totalDecodeTime-y.totalDecodeTime)/(d.framesDecoded-y.framesDecoded)*1e3).toFixed(2))),u._retransmittedRate=(d.nackCount-y.nackCount)/(d.packetsReceived-y.packetsReceived+(d.packetsLost-y.packetsLost)),u.videoLossRate=Number.isNaN(u.videoLossRate)?0:u.videoLossRate,m.fraction_lost=u.videoLossRate,u.statsInterval=d.timestamp-y.timestamp,m.stats_interval=u.statsInterval,u.receivedKBitrate=(d.bytesReceived-y.bytesReceived||0)/u.statsInterval*8,m.bitrate=Math.round(1e3*u.receivedKBitrate),m.bandwidth=Math.round(m.bitrate/1024),u.decoderOutputFrameRate=1e3*(d.framesDecoded-y.framesDecoded)/u.statsInterval,u.receivedFrameRate=1e3*(d.framesReceived-y.framesReceived)/u.statsInterval,m.frame_rate_decoded=Math.round(u.decoderOutputFrameRate),m.frame_rate_received=Math.round(u.receivedFrameRate),m.average_jitter_buffer_delay_ms&&m.total_rtt_ms&&(u.e2eDelay=m.average_jitter_buffer_delay_ms+m.total_rtt_ms),null!==(n=this._context)&&void 0!==n&&null!==(i=n.streamRTT)&&void 0!==i&&null!==(o=i[h])&&void 0!==o&&o.video&&(u.totalRtt=(m.rtt?m.rtt:0)+this._context.streamRTT[h].video),r.video=d,this.processStall(this._stream,m,u,p),this.isPaused?(S=d.timestamp-(this.pauseStart||0),m.pause_duration=this.pauseDuration+(S>500?S:0),this.pauseStart=d.timestamp):m.pause_duration=this.pauseDuration,m.pause_duration=Math.min(m.stall_duration||m.stuck_length||0,m.pause_duration),this.pauseDuration=0,m.vendor_mode=(null===(a=this._stream)||void 0===a?void 0:a.vendorCode)||0,m.pc_session_id=null===(s=this.handler)||void 0===s?void 0:s.peerConnectionId,null===(c=this._monitor)||void 0===c||c.report("rtc_media_statistics",m),e.abrupt("return",this.filterIllegal(u));case 47:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"processStall",value:function(e,t,r,n){var i=0,o=0,a=0;if(e.recordedVideoFrames&&this.player&&this.player.played){e.recordedVideoFrames.forEach(function(e){e.isStall&&(i+=e.stallCount,o+=e.stallDuration),a=e.playTime}),e.recordedVideoFrames.length||(o=2e3,i=this._videoInWaiting?0:1,this._videoInWaiting=!0);var s=e.recordedVideoFrames.pop();s&&(s.isStall?this._videoInWaiting=!0:this._videoInWaiting=!1),e.recordedVideoFrames=[]}t.stall_count=i,n?(t.stuck_length=Math.min(o,t.stats_interval),t.stall_duration=void 0):(t.stall_duration=Math.min(o,t.stats_interval),t.stuck_length=void 0),t.play_time=a,r.stallCount=i,r.stallDuration=o}},{key:"destroy",value:function(){dm(df(o.prototype),"destroy",this).call(this),dm(df(o.prototype),"stopReport",this).call(this,"destroy"),this._stopAudioStallTimer(),this._videoInWaiting=!1}}],[{key:"audioStallConfig",set:function(e){o.audioStallInterval=((null==e?void 0:e.audio_stall_interval)||200)/2,o.audioStallRatio=null==e?void 0:e.audio_stall_ratio}}]),o}();iT(g3,"audioStallInterval",void 0),iT(g3,"audioStallRatio",void 0);var g5,g4,g6,g8,g7,g9,ye,yt,yr,yn,yi,yo,ya,ys,yc,yu,yd,yl,yh,y_,yp,yv,yf,ym,yg,yy=new h1("Stream",0),yS=function(e){dy(r,fR);var t=dC(r);function r(e){var n;return iE(this,r),iT(dn(n=t.call(this)),"videoDom",void 0),iT(dn(n),"audioMid",void 0),iT(dn(n),"videoMid",void 0),iT(dn(n),"videoTransceiver",void 0),iT(dn(n),"audioTransceiver",void 0),iT(dn(n),"vendorHandler",void 0),iT(dn(n),"vendorCode",0),iT(dn(n),"engineId",void 0),n.engineId=e.id,n}return ib(r,[{key:"requestVideoFrameCallback",value:function(){var e=this;return new aj(function(t){var r,n=null===(r=e.videoDom)||void 0===r?void 0:r.requestVideoFrameCallback;if("function"==typeof n){var i=function(e,r){var n={};sJ(r).forEach(function(e){var t=e.replace(/[a-z]{1}[A-Z]{1}/g,function(e){var t;return a4(t="".concat(e[0],"_")).call(t,e[1].toLowerCase())});n["video_".concat(t)]=r[e]}),clearInterval(o),t(n)};n.call(e.videoDom,i);var o=setTimeout(function(){var r;null===(r=e.videoDom)||void 0===r||r.cancelVideoFrameCallback(i),t({})},500)}else ){this.statsReport.stopReport(e)}},{key:"destroy",value:function(){var e,t;delete this.audioMid,delete this.videoMid,this.statsReport.destroy(),null===(e=this.observer)||void 0===e||e.reset(),delete this.videoTransceiver,delete this.audioTransceiver,null===(t=this.vendorHandler)||void 0===t||t.destroy(),this.vendorCode=0,delete this.vendorHandler}}]),r}(),yb=((g9=yb||{})[g9.INIT=0]="INIT",g9[g9.SUB_ING=1]="SUB_ING",g9[g9.SUB_ED=2]="SUB_ED",g9),yE=function(e){dy(r,yS);var t=dC(r);function r(e){var n;return iE(this,r),iT(dn(n=t.call(this,e)),"isScreen",!1),iT(dn(n),"stream",void 0),iT(dn(n),"streamId",void 0),iT(dn(n),"seiList",[]),iT(dn(n),"videoTrack",void 0),iT(dn(n),"audioTrack",void 0),iT(dn(n),"videoEncodeConfig",[fo]),iT(dn(n),"subVideoDescriptions",[]),iT(dn(n),"enableSimulcast",!1),iT(dn(n),"observer",void 0),iT(dn(n),"statsReport",void 0),iT(dn(n),"prevBitrate",0),iT(dn(n),"pubAudio",!1),iT(dn(n),"pubVideo",!1),iT(dn(n),"pubAttributes",void 0),iT(dn(n),"pcSessionId",void 0),n.stream=new MediaStream,n.pubAttributes={localaudio:!1,localvideo:!1,videostream:!1,audiostream:!1,extvideo:!1,extaudio:!1},n.statsReport=new g2(e,dn(n)),n}return ib(r,[{key:"audioHasCapture",get:function(){return this.pubAttributes.localaudio}},{key:"audioHasPublish",get:function(){return this.pubAttributes.audiostream}},{key:"videoHasCapture",get:function(){return this.pubAttributes.localvideo}},{key:"videoHasPublish",get:function(){return this.pubAttributes.vide!!this.audioMid&&!!this.vihis.audioTrack&&!this.videoTrack}},{key:"initStreamId",get:function(){return this.strLocalStreamStatsEvtInterval(e,t)}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.sender){var t=this.videoTransceiver.sender;if(fY()){var r=t.createEncodedStreams(),n=r.readable,i=r.writable,o=new TransformStream({transform:function(t,r){var n=e.seiList[0];if(n){var i,o=g$.generateSEI(n.content),a=new Uint8Array(o.byteLength+t.data.byteLength);0===n.repeatCount&&cV(i=e.seiList).call(i,0,1),n.repeatCount--,a.set(new Uint8Array(t.data)),a.set(o,t.data.byteLength),t.data=a.buffer,r.enqueue(t)}else r.enqueue(t)}});n.pipeThrough(o).pipeTo(i)}}else yy.warn("no sender found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){if(this.audioTransceiver&&this.audioTransceiver.sender){var e=this.audioTransceiver.sender.createEncodedStreams(),t=e.readable,r=e.writable;t.pipeThrousform:function(e,t){t.enqueue(e)}})).pipeTo(r)}else yy.warn("no sender found when trying to bind encodedTransform")}},{key:"clean",value:function(){p3(this.engineId,"localstream_clean","".concat(Error().stack),0,this.streamId||""),dm(df(r.prototype),"destroy",this).call(this),this.prevBitrate=0,this.subVideoDescriptions=[]}},{key:"switchTrackEnableState",value:function(e,t){"audio"===e?n=this.audioTrack:"video"===e&&(n=this.videoTrack);var r,n,i=null===(r=n)||void 0===r?void 0:r.getTrack();return!(!i||(null==i?void 0:i.enabled)===t)&&(i.enabled=t,!0)}}]),r}(),yT=function(e){dy(r,yS);var t=dC(r);function r(e,n,i,o,a,s){var c;return iE(this,r),iT(dn(c=t.call(this,e)),"streamId",void 0),iT(dn(c),"userId",void 0),iT(dn(c),"isScreen",void 0),iT(dn(c),"isPublic",void 0),iT(dn(c),"hasVideo",void 0),iT(dn(c),"hasAudio",void 0),iT(dn(c),"_attributes",void 0),iT(dn(c),"streamState",void 0),iT(dn(c),"removeTrack",!1),iT(dn(c),"observer",void 0),iT(dn(c),"statsReport",void 0),iT(dn(c),"subVideo",void 0),iT(dn(c),"subAudio",void 0),iT(dn(c),"subMediaType",void 0),iT(dn(c),"subLayer",void 0),iT(dn(c),"_sequenceId",void 0),iT(dn(c),"stream",void 0),iT(dn(c),"videoTrack",void 0),iT(dn(c),"audioTrack",void 0),iT(dn(c),"recordedVideoFrames",void 0),iT(dn(c),"stillExist",void 0),iT(dn(c),"originalMediaType",void 0),iT(dn(c),"priority",void 0),iT(dn(c),"originalStreamIndex",0),iT(dn(c),"virtual",void 0),iT(dn(c),"pcSessionId",void 0),iT(dn(c),"_virtualOccupy",void 0),c.virtual=!1,c._virtualOccupy=!1,c.userId=n,c.isScreen=o,c.isPublic=a,c.streamId=i,c.hasAudio=s.audiostream&&s.localaudio,c.hasVideo=s.videostream&&s.localvideo,c._attributes=s,c.vendorCode=(null==s?void 0:s.vendorCode)||0,c.subVideo=!1,c.subAudio=!1,c._sequenceId=0,c.subMediaType=gH.NONE,c.subLayer={spatialLayer:0,spatialSubLayer:-1},c.streamState=0,c.statsReport=new g3(e,dn(c)),c.enableVendorMode&&(c.pcSessionId=hF()),c}return ib(r,[{key:"vendor",get:function(){return this._attributes.vendorCode}},{key:"audioHasCapture",get:function(){return this._attributes.localaudio}},{key:"audioHasPublish",get:function(){return this._attributes.audiostream}},{key:"videoHasCapture",get:function(){return this._attributes.localvurn this._attributes.vion()==typeof e&&(this._sequenceId=e)}},{key:"enableVendorMode",get:function(){return"number"==typeof this.attributes.vendorCode&&0!==this.attributes.vendon(){return 2===this.streamState}},{key:"attributes",get:function(){return this._attributes},set:function(e){this.hasVideo=e.localvideo&&e.videostream,this.hasAudio=e.localaudio&&e.audiostream,this._attributes=e,this.vendorCode=e.vendorCode||0}},{key:"virtualOccupy",get:function(){return this._virtualOccupy},set:function(e){var t,r;this._virtualOccupy&&!e?null===(t=this.observer)||void 0===t||t.setPushTrack(!1):!this._virtualOccupy&&e&&(null===(r=this.observer)||void 0===r||r.setPushTrack(!0)),this._virtualOccupy=e}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.receiver){var t=this.videoTransceiver.receiver.createEncodedStreams(),r=t.readable,n=t.writable;r.pipeThrough(new TransformStream({transform:function(t,r){gz.getNalunits(new gK(t.data)).forEach(function(t){if(t.sei){var r=g$.decodeSeiBody(t.body);r&&r.type!==gX.internal&&e.safeEmit("onSEIMessage",r.payload)}}),r.enqueue(t)}})).pipeTo(n)}else yy.warn("no receiver found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){if(this.audioTransceiver&&this.audioTransceiver.receiver){var e=this.audioTransceiver.receiver.createEncodedStreams(),t=e.readable,r=e.writable;t.pipeThrough(new TransformStream({transform:function(e,t){e.data.byteLength<=1e3?t.enqueue(e):yy.print("too large audio frame",e.data.byteLength)}})).pipeTo(r)}else yy.warn("no receiver found when trying to bind encodedTransform")}},{key:"ontrack",value:function(e){try{var t,r,n;p3(this.engineId,"Stream.ontrack",a6({uid:this.userId,streamId:this.streamId,streams:s2(s=e.streams).call(s,function(e,t){return e+(null==t?"undefined | null":"string"==typeof t?t:a6({id:t.id,active:t.active}))},""),transceiver:(t=e.transceiver,null==t?"undefined | null":"string"==typeof t?t:a6({currentDirection:t.currentDirection,direction:t.direction,mid:t.mid,stopped:t.stopped,receiver:null==(r=t.receiver)?"undefined | null":"string"==typeof r?r:a6({track:vl(r.track)}),sender:null==(n=t.sender)?"undefined | null":"string"==typeof n?n:a6({track:vl(n.track)})})),track:vl(e.track)}),0,this.streamId||"")}catch(e){}if(this.enableVendorMode||null!==(i=e.streams)&&void 0!==i&&null!==(o=i[0])&&void 0!==o&&null!==(a=o.id)&&void 0!==a&&c1(a).call(a,this.streamId)){var i,o,a,s,c,u=e.track;"video"===(null==u?void 0:u.kind)?this._setVideoTrack(u):"audio"===(null===(c=e.track)||void 0===c?void 0:c.kind)&&this._setAudioTrack(u),this._setStream(e.streams[0])}this.safeEmit("ontrack",e)}},{key:"clean",value:function(){var e,t;yy.info("clean",a4(e="exec stream.clean ".concat(this.streamId," ")).call(e,this.userId)),p3(this.engineId,"remotestream_clean","".concat(Error().stack),0,this.streamId),dm(df(r.prototype),"destroy",this).call(this),this.subAudio=!1,this.subVideo=!1,this.sequenceId=0,this.videoTrack=void 0,null===(t=this.audioTrack)||void 0===t||t.close(),this.audioTrack=void 0,this.stream=void 0,this.recordedVideoFrames=void 0,delete this.priority}},{key:"destroy",value:function(){this.clean(),this.attributes={audiostream:!1,localaudio:!1,localvideo:!1,videostream:!1,extvideo:!1,extaudio:!1,videoDescriptions:[]}}ue:function(){this.streamState=0}},{key:"_setStream",value:function(e){var t=this;this.stream=e,e.onaddtrack=function(e){"video"===e.track.kind?t._setVideoTrack(e.track):"audio"===e.track.kind&&t._setAudioTrack(e.track)}}},{key:"_setAudioTrack",value:function(e){var t,r;(null===(t=this.audioTrack)||void 0===t||null===(r=t.getTrack())||void 0===r?void 0:r.id)!==(null==e?void 0:e.id)&&(this.audioTrack=gU(e),this.emit("ontrack",this.audioTrack))}},{key:"_setVideoTrack",value:function(e){var t,r;(null===(t=this.videoTrack)||void 0===t||null===(r=t.getTrack())||void 0===r?void 0:r.id)!==(null==e?void 0:e.id)&&(this.videoTrack=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p7();return new gS(e,t)}(e),this.emit("ontrack",this.videoTrack))}}]),r}(),yk=new h1("queue",4),yI=((ye=yI||{})[ye.ADD=0]="ADD",ye[ye.CLOSE=1]="CLOSE",ye),yR=((yt=yR||{}).publish="publish",yt.unpublish="unpublish",yt.subscribe="subscribe",yt.unsubscribe="unsubscribe",yt.pushtrack="pushtrack",yt.removetrack="removetrack",yt),yA=(iT(yv={},"publish","unpublish"),iT(yv,"subscribe","unsubscribe"),iT(yv,"pushtrack","removetrack"),yv),yC=(iT(yf={},"publish",0),iT(yf,"subscribe",0),iT(yf,"pushtrack",0),iT(yf,"unpublish",1),iT(yf,"unsubscribe",1),iT(yf,"removetrack",1),yf),yw=function(e){dy(r,fk);var t=dC(r);function r(){var e;return iE(this,r),iT(dn(e=t.call(this)),"_queue",void 0),e._queue=[],e}return ib(r,[{key:"queue",get:function(){return this._queue}},{key:"enqueue",value:function(e){var t,r=this._queue.length,n="";return this._queue=cG(t=this._queue).call(t,function(t){return t.streamId!==e.streamId||e.action!==yA[t.action]||(n=t.streamId,yk.info("offsetStreamId",n),!1)}),this._queue.length===r&&this._queue.push(e),this.emit("start"),n}},{key:"dequeue",value:function(){if(!this._queue.length)return null;var e,t,r=this._queue.length;vO&&vZ>=86&&vZ<=92&&(r=Math.min(this._queue.length,5));for(var n=yC[this._queue[0].action],i=1;i<r;i++)if(yC[this._queue[i].action]!==n)return{sdpStrategy:n,items:cV(t=this._queue).call(t,0,i)};return{sdpStrategy:n,items:cV(e=this._queue).call(e,0,r)}}}]),r}(),yx=new h1("ChromeHandler",3),yO=fY(),yN=function(e){dy(u,mg);var t,r,n,i,o,a,s,c=dC(u);function u(e,t){var r;return iE(this,u),iT(dn(r=c.call(this,e,t)),"name","chrome"),iT(dn(r),"_queueBusy",!1),iT(dn(r),"_sdpQueue",void 0),iT(dn(r),"_aSendonlyOfferTpl",void 0),iT(dn(r),"_vSendonlyOfferTpl",void 0),iT(dn(r),"_aRecvonlyOfferTpl",void 0),iT(dn(r),"_vRecvonlyOfferTpl",void 0),iT(dn(r),"_mid",10),iT(dn(r),"_inactiveMlineIndex",[]),iT(dn(r),"_mlinesCache",{}),iT(dn(r),"setDescription",void 0),r.setDescription=t.setDescription.bind(t),r._sdpQueue=new yw,r._sdpQueue.on("start",function(){r._queueBusy||"stable"!==r._peerConnection.signalingState||(yx.info("dequeue start"),r.dequeue())}),r}.call(this),this._mlinesCache={}}},{key:"publish",value:(s=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,N,P,D,M,L,U;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d=t.stream,l=t.enableSimulcast,_=(h=dm(df(u.prototype),"internalPublish",this).call(this,t)).videoDescriptions,p=h.subVideoDescriptions,v=h.audioTransceiverInit,f=h.videoTransceiverInit,m=mu(this._nextSsrc),this._nextSsrc=m.next,g="".concat(this._mid++),y="".concat(this._mid++),S=dr(dr(dr({},this._aSendonlyOfferTpl),this.peer._offerIce),{},{mid:g,msid:a4(r="".concat(d.id," ")).call(r,d.id,"-audio"),ssrcs:md(d.id,"audio",m.audio,mc)}),b=dr(dr(dr({},this._vSendonlyOfferTpl),this.peer._offerIce),{},{mid:y,msid:a4(n="".concat(d.id," ")).call(n,d.id,"-video")}),l?(yx.info("subVideoDesc","desc: %o ",p),delete b.ssrcGroups,delete b.ssrcs,E=[],b.rids=se(_).call(_,function(e){var t=e.rid;return E.unshift(t),{id:t,direction:"send"}}),b.simulcast={dir1:"send",list1:E.join(";")}):(k=(T=ml(d.id,m,{cname:mc})).ssrcs,I=T.ssrcGroups,b.ssrcs=k,b.ssrcGroups=I),null!==(i=this._context)&&void 0!==i&&null!==(o=i.serverConfig)&&void 0!==o&&o.audioRed&&Array.isArray(S.rtp)&&(-1!==(A=d3(R=S.rtp).call(R,function(e){return"red"===e.codec}))&&(w=u3(cV(C=S.rtp).call(C,A,1),1)[0],S.rtion(e){return x.push(e.payload)}),S.payloads=x.join(" ")),null!==(a=this._context)&&void 0!==a&&null!==(s=a.serverConfig)&&void 0!==s&&s.videoCodec&&mf(b,null===(O=this._context)||void 0===O||null===(N=O.serverConfig)||void 0===N?void 0:N.videoCodec),!fn("IOS_SAFARI_ORIENTATION")&&(vx||vj)&&Array.isArray(b.ext)&&(b.ext=cG(P=b.ext).call(P,function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&c1(t).call(t,"video-orientation"))})),(D=null==S?void 0:cS(c=S.rtp).call(c,function(e){return"opus"===e.codec}))&&S.fmtp&&(U=cS(M=S.fmtp).call(M,function(e){return e.payload===D.payload}))&&null!==(L=this._context)&&void 0!==L&&L.audioProfileManager&&(U.config=this._context.audioProfileManager.getOpusConfigStr(U.config)),l||vx||this.addBitrateLimit(b,t.videoEncodeConfig[0].maxKbps),this._mlinesCache[t.stream.id]=[S,b],e.abrupt("return",{partialSdp:m_(this.peer._offerSession,S,b),audioMid:g,videoMid:y,type:"incroffer",semantics:"unified-plan",videoDescriptions:_,subVideoDescriptions:p,audioTransceiverInit:v,videoTransceiverInit:f,peerConnectionMode:this.peerConnectionMode});case 17:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"subscribe",value:(a=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,N,P,D,M,L,U,V=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(yx.info("subscribe"),a="incroffer",s="unified-plan",this._aRecvonlyOfferTpl&&this._vRecvonlyOfferTpl){e.next=9;break}return e.next=6,this._genOfferSdp();case 6:return c=e.sent,e.next=9,this.createAVMlineOfferTpl(c);case 9:if(u="",d="",l=!1,h=!1,_=void 0,p=void 0,this._mlinesCache[t.streamId]=[_,p],t.virtual?(u="".concat(this._mid++),l=!0):r.multiChatMode?(u="".concat(this._mid++),d="".concat(this._mid++),h=!0):(l=!0,h=!0,u="".concat(this._mid++),d="".concat(this._mid++)),u&&(_=dr(dr({},this._aRecvonlyOfferTpl),{},{mid:u})),l&&(this._mlinesCache[t.streamId][0]=_,v={track:"audio",init:{direction:"recvonly"}}),d&&(p=dr(dr({},this._vRecvonlyOfferTpl),{},{mid:d})),h&&(this._mlinesCache[t.streamId][1]=p,f={track:"video",init:{direction:"recvonly"}}),m=m_(this.peer._offerSession,_,p),g=void 0,t.enableVendorMode||r.multiChatMode||t.virtual||!this._aSendonlyAnswerTpl||!this._vSendonlyAnswerTpl){e.next=32;break}return g=mu(this._nextSsrc),this._nextSsrc=g.next,R=dr(dr(dr({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:u,msid:a4(y=a4(S="".concat(t.streamId)).call(S,null!==(b=this._context)&&void 0!==b&&b.avSync?"":"-audio"," ")).call(y,t.streamId,"-audio"),ssrcs:md(t.streamId,"audio",g.audio)}),A=dr(dr(dr({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:d,msid:a4(E=a4(T="".concat(t.streamId)).call(T,null!==(k=this._context)&&void 0!==k&&k.avSync?"":"-video"," ")).call(E,t.streamId,"-video")},ml(t.streamId,g,{flexfec:this._enableSubFlexfec})),C=new aj(function(e){V._sdpQueue.enqueue({action:yR.subscribe,streamId:t.streamId,audioMid:u,videoMid:d,audioTransceiverInit:v,videoTransceiverInit:f,signalingAck:{sdp:f8.write(dr(dr({},V.peer._answerSession),{},{media:[R,A]})),sequenceId:t.sequenceId?++t.sequesubscribe()","sub success"),e(0)}})}),e.next=31,C;case 31:null===(I=g)||void 0===I||delete I.next;case 32:return(w=null===(n=_)||void 0===n?void 0:cS(i=n.rtp).call(i,function(e){return"opus"===e.codec}))&&null!==(o=_)&&void 0!==o&&o.fmtp&&(N=null===(x=_)||void 0===x?void 0:cS(O=x.fmtp).call(O,function(e){return e.payload===w.payload}))&&this._context&&(N.config+=";stereo=1;sprop-stereo=1"),t.isPublic&&vZ>=86&&null!=(L=null===(P=p)||voinction(e){return"H264"===e.codec}))&&L.length&&null!==(M=p)&&void 0!==M&&M.fmtp&&(null===(U=p)||void 0===U||U.fmtp(t){return t.payload===e.payload})&&(e.config+=";sps-pps-idr-in-keyframe=1")})),e.abrupt("return",{partialSdp:m,audioMid:u,videoMid:d,type:a,semantics:s,audioTransceiverInit:v,videoTransceiverInit:f,allSsrc:g,peerConnectionMode:this.peerConnectionMode});case 36:case"){return a.apply(this,arguments)})},{key:"handleAck",value:(o=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(yx.info("handleAck()","item: %o",t),!t.generatorSsrc){e.next=4;break}return yx.warn("already set remote"),e.abrupt("return","");case 4:return e.abrupt("return",this._sdpQueue.enqueue(t));case 5:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"dequeue",value:(i=a2(a0().mark(function e(){var t,r,n,i,o,a,s,c,u,d,l,h,_,p,v,f=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._queueBusy=!0,t=this._sdpQueue.dequeue(),yx.info("dequeue()","ret: %o",t),t){e.next=6;break}return this._queueBusy=!1,e.abrupt("return");case 6:if(e.prev=6,r=t.items,n=t.sdpStrategy,i=[],o=[],a=[],n!==yI.ADD){e.next=15;break}return e.delegateYield(a0().mark(function e(){var t,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:delete(t=dr({},f.peer._answerIce)).candidates,s=!1,c=!1,e.prev=4,d=function(e){var t,r,n,i=2;for(void 0!==nw&&(r=fC,n=iv);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new fw(t.call(e));r="@@asyncIterator",n="@@iterator"}throw TypeError("Object is not async iterable")}(r);case 6:return e.next=8,d.next();case 8:if(!(s=!(l=e.sent).done)){e.next=16;break}if(n=l.value,"break"!==function(){var e=n.audioMid,r=n.videoMid,s=n.action,c=n.audioTransceiverInit,u=n.videoTransceiverInit,d=n.signalingAck,l=n.stream,h=l instanceof yT;if(n.onSuccess&&a.push(n.onSuccess),h&&(null==d?void 0:d.sequenceId)<l.sequenceId)return"break";var _,p={},v={},m=f8.parse(d.sdp);Array.isArray(m.media)&&dQ(_=m.media).call(_,function(e,t){var r;return null==e||null===(r=e.type)||void 0===r?void 0:r.localeCompare(null==t?void 0:t.type)}).forEach(function(n){"audio"===(n=dr(dr({},n),t)).type?(p=n).mid=e:(v=n).mid=r});var g,y=l.streamId;if(s===yR.publish&&(y=null===(g=l.stream)||void 0===g?void 0:g.id),!f._mlinesCache[y])return"break";var S=u3(f._mlinesCache[y],2),b=S[0],E=S[1];if(c&&b){l.audioTransceiver=f._peerConnection.addTransceiver(c.track,c.init),f._reportRtcInvokeStatus("chromeHandler.addTrack",a6({audioStreamTrack:vl(c.track)}));var T=f._inactiveMlineIndex.shift();T||(T=f.peer._offerMlines.length),f.peer._offerMlines[T]=dr({},b),f.peer._answerMlines[T]=p,yO&&l.initAudioEncodedTransform()}if(u&&E){l.videoTransceiver=f._peerConnection.addTransceiver(u.track,u.init),f._reportRtcInvokeStatus("chromeHandler.addTrack",a6({videoStreamTrack:vl(u.track)}));var k,I,R,A,C=f._inactiveMlineIndex.shift();C||(C=f.peer._offerMlines.length),f.peer._offerMlines[C]=dr({},E),s===yR.publish&&null!==(k=f._context)&&void 0!==k&&null!==(I=k.serverConfig)&&void 0!==I&&I.videoCodec&&mf(v,null===(R=f._context)||void 0===R||null===(A=R.serverConfig)||void 0===A?void 0:A.videoCodec),f.peer._answerMlines[C]=v,yO&&l.initVideoEncodedTransform()}i.push(l.streamId||""),o.push(h?l.userId:"local"),h&&(l.sequenceId=null==d?void 0:d.sequenceId),delete f._mlinesCache[y]}()){e.next=13;break}return e.abrupt("break",16);case 13:s=!1,e.next=6;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(4),c=!0,u=e.t0;case 22:if(e.prev=22,e.prev=23,!s||null==d.return){e.next=27;break}return e.next=27,d.return();case 27:if(e.prev=27,!c){e.next=30;break}throw u;case 30:return e.finish(27);case 31:return e.finish(22);case 32:case"end":return e.stop()}},e,null,[[4,18,22,32],[23,,27,31]])})(),"t0",13);case 13:e.next=20;break;case 15:v={},r.forEach(function(e){var t=e.audioMid,r=e.videoMid,n=e.action;v[t]=t,n!==yR.removetrack&&(v[r]=r),v[t]=t}),this.peer._offerMlines=se(h=this.peer._offerMlines).call(h,function(e,t){return v[e.mid]&&(e=mh(e),f._inactiveMlineIndex.push(t)),e}),dQ(_.call(_,function(e,t){return e-t}),this.peer._answerMlines=se(p=this.peer._answerMlines).call(p,function(e){return v[e.mid]&&(e=mh(e)),e});case 20:return e.next=22,this.setDescription(i.length?{streamId:i.join(","),streamUserId:o.join(",a.forEach(function(e){return e()})}catch(e){}yx.info("dequeue","loop"),e.next=29;break;case 26:e.prev=26,e.t1=e.catch(6),yx.error("dequeue","unknown error: %o",e.t1);case 29:return e.prev=29,this.dequeue(),e.finish(29);case 32:case"end":return e.stop()}},e,this,[[6,26,29,32]])})),function(){return i.apply(this,arguments)})},{key:"getDefaultSdp",value:(n=a2(a0().mark(function e(){var t,r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._genOfferSdp();case 2:return r=e.sent,this.createAVMlineOfferTpl(r),n=f8.parse(r),i=[],n.media=cG(t=n.media).call(t,function(e){var t;return"recvonly"===e.direction&&(Array.isArray(e.ext)&&(e.ext=cG(t=e.ext).call(t,function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri})),i.push("".concat(e.mid)),!0)}),n.groups=[{mids:i.join(" "),type:"BUNDLE"}],e.abrupt("return",{sdp:f8.write(n),semantics:"unified-plan",type:"incroffer"});case 9:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{keye"){return r.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this;f8.parse(e).media.forEach(function(e){var r,n;"audio"===e.type?"sendonly"===e.direction?t._aSendonlyOfferTpl=e:(Array.isArray(e.ext)&&(e.ext=cG(r=e.ext).call(r,function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri})),t._aRecvonlyOfferTpl=e):"video"===e.type&&("sendonly"===e.direction?t._vSendonlyOfferTpl=e:(Array.isArray(rext:sdes:rtp-stream-id"!==e.uri})),t._vRecvonlyOfferTpl=e))})}},{key:"_genOfferSdp",value:(t=a2(a0().mark(function e(){var t,r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,vo(!0);case 3:if(t=e.sent){e.next=6;break}throw"pc.createOffer() return empty.";case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),r="Get offer Error. ".concat(e.t0.message|e.t0),new lM(le.NOT_SUPPORTED,r);case 12:return e.abrupt("return",t);case 13:case"end":ret){return t.apply(this,arguments)})}]),u}(),yP=new h1("FirefoxHandler",3),yD=function(e){dy(d,mg);var t,r,n,i,o,a,s,c,u=dC(d);function d(){var e,t;iE(this,d);for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return iT(dn(t=u.call.apply(u,a4(e=[this]).call(e,n))),"name","firefox"),iT(dn(t),"_aRecvonlyOfferTpl",void 0),t}return ib(d,[{key:"publish",value:(c=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,l,h,_,p,v,f,m=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=(i=dm(df(d.prototype),"internalPublish",this).call(this,t)).videoDescriptions,a=i.subVideoDescriptions,s=i.audioTransceiverInit,c=i.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(s.track,s.init),t.videoTransceiver=this._peerConnection.addTransceiver(c.track,c.init),u=p9(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=7,this._peerConnection.createOffer();case 7:return l=e.sent,this._report("rtc_create_offer",{direction:"up",error_code:0,stream_id:"",stream_user_id:"",elapse:p9()-u}),(h=f8.parse(l.sdp)).media=null===(r=h.media)||void 0===r?void 0:se(r).call(r,function(e){return dr(dr({},e),m.peer._offerIce)}),e.next=13,this.setLocalDescription(f8.write(h));case 13:return _=t.audioTransceiver.mid,p=t.videoTransceiver.mid,v=null,f=null,h.media=null===(n=h.media)||void 0===n?void 0:se(n).call(n,function(e){if("".concat(e.mid)===_){var t,r,n,i,o,a,s=null===(o=v=e)||void 0===o?void 0:cS(a=o.rtp).call(a,function(e){return"opus"===e.codec});if(s&&v.fmtp){var c,u,d=cS(c=v.fmtp).call(c,function(e){return e.payload===s.payload});d&&null!==(u=m._context)&&void 0!==u&&u.audioProfileManager&&(d.config=m._context.audioProfileManager.getOpusConfigStr(d.config))}}else"".concat(e.mid)===p&&(null!==(t=m._context)&&void 0!==t&&null!==(r=t.serverConfig)&&void 0!==r&&r.videoCodec&&mf(e,null===(n=m._context)||void 0===n||null===(i=n.serverConfig)||void 0===i?void 0:i.videoCodec),f=e);return e}),this.addBitrateLimit(f,t.videoEncodeConfig[0].maxKbps),e.next=21,this.setLocalDescription(f8.write(h));case 21:return e.abrupt("return",{partialSdp:m_(h,v,f,!1),audioMid:_,videoMid:p,type:"incroffer",semantics:"unified-plan",videoDescriptions:o,subVideoDescriptions:a,audioTransceiverInit:s,videoTransceiverInit:c,peerConnectionMode:this.peerConnectionMode});case 22:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"subscribe",value:(s=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return yP.info("subscribe()"),c="",u="",d=!1,l=!1,h=void 0,_=void 0,t.virtual?d=!0:(r.multiChatMode||(d=!0),l=!0),d&&(t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"})),l&&(t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"})),p=p9(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=14,this._peerConnection.createOffer();case 14:return v=e.sent,this._report("rtc_create_offer",{error_code:0,direction:"up",stream_id:t.streamId,stream_user_id:t.userId,elapse:p9()-p}),(f=f8.parse(v.sdp)).media=null===(n=f.media)||void 0===n?void 0:se(n).call(n,function(e){return dr(dr({},e),A.peer._offerIce)}),se(i=f.media).call(i,function(e){var t,r;"video"===e.type&&(e.ext=null===(t=e.ext)||void 0===t?void 0:cG(t).call(t,function(e){var t;return -1===cA(t=e.uri).call(t,"abs-send-time")}),e.rtcpFb=null===(r=e.rtcpFb)||void 0===r?void 0:cG(r).call(r,function(e){return"goog-remb"!==e.type}))}),e.next=21,this.setLocalDescription(f8.write(f),{streamId:t.streamId||"",streamUserId:t.userId});case 21:if(c=null===(o=t.audioTransceiver)||void 0===o?void 0:o.mid,u=null===(a=t.videoTransceiver)||void 0===a?void 0:a.mid,null===(s=f.media)||void 0===s||s.forEach(function(e){"".concat(e.mid)===c?h=e:"".concat(e.mid)===u&&(_=e)}),c&&h||(c="audio_".concat(u),h=dr(dr({},this._aRecvonlyOfferTpl),{},{mid:c})),t.audioMid=c,t.videoMid=u,m=void 0,r.multiChatMode||t.virtual||!this._aSendonlyAnswerTpl||!this._aSendonlyAnswerTpl){e.next=36;break}return m=mu(this._nextSsrc),this._nextSsrc=m.next,I=dr(dr(dr({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:c,msid:a4(g=a4(y="".concat(t.streamId)).call(y,null!==(S=this._context)&&void 0!==S&&S.avSync?"":"-audio"," ")).call(g,t.streamId,"-audio"),ssrcs:md(t.streamId,"audio",m.audio)}),R=dr(dr(dr({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:u,msid:a4(b=a4(E="".concat(t.streamId)).call(E,null!==(T=this._context)&&void 0!==T&&T.avSync?"":"-video"," ")).call(b,t.streamId,"-video")},ml(t.streamId,m,{flexfec:this._enableSubFlexfec})),e.next=35,this._internalSetRemoteDescription([I,R],t);case 35:null===(k=m)||void 0===k||delete k.next;case 36:return e.abrupt("return",{partialSdp:m_(f,h,_,!1),audioMid:c,videoMid:u,type:"incroffer",semantics:"unified-plan",audioTransceiverInit:t.audioTransceiver?{track:"audio",init:{direction:"recvonly"}}:void 0,videoTransceiverInit:t.videoTransceiver?{track:"video",init:{direction:"recvonly"}}:void 0,allSsrc:m,peerConnectionMode:this.peerConnectionMode});case 37:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"handleAck",value:(a=a2(a0().mark(function e(t){var r,n,i,o;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.signalingAck,n=t.stream,(i=t.action)!==yR.removetrack){e.next=3;break}return e.abrupt("return","");case 3:if(i!==yR.unpublish&&i!==yR.unsubscribe){e.next=7;break}return e.next=6,this.close(n);case 6:return e.abrupt("return",n.streamId||"");case 7:if(!t.generatorSsrc){e.next=10;break}return yP.warn("already set remote"),e.abrupt("return","");case 10:return o=f8.parse(null==r?void 0:r.sdp),e.next=13,this._internalSetRemoteDescription(o.media,n);case 13:return e.abrupt("return","");case 14:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"_internalSetRemoteDescription",value:(o=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={},(c=f8.parse(null===(n=this._peerConnection.remoteDescription)||void 0===n?void 0:n.sdp)).media.forEach(function(e){void 0!==e.mid&&(s[e.mid]=e)}),t.forEach(function(e){if("audio"===(e=dr(dr({},e),l.peer._answerIce)).type&&(r.audioMid?(e.mid=r.audioMid,s[r.audioMid]=e):s[e.mid]=e),"video"===e.type){if(r instanceof yE&&vq<=87){var t,n,i,o,a={};Array.isArray(e.rtp)&&(e.rtp=cG(t=e.rtp).call(t,function(e){return"rtx"!==e.codec||(a[e.payload]=e.payload,!1)})),"string"==typeof e.payloads&&(e.payloads=cG(n=e.payloads.split(" ")).call(n,function(e){return!a[e]}).join(" ")),Array.isArray(e.fmtp)&&(e.fmtp=cG(i=e.fmtp).call(i,function(e){return!a[e.payload]})),Array.isArray(e.rtc,function(e){return!a[e.payload]}))}r.videoMid?(e.mid=r.videoMid,s[r.videoMid]=e):s[e.mid]=e}}),d=se(o=(u=f8.parse(null===(i=this._peerConnection.localDescription)||void 0===i?void 0:i.sdp)).media).call(o,function(e){var t=s[e.mid];return"inactive"===e.direction?e:t}),c.groups=u.groups,c.media=d,se(a=c.media).call(a,function(e){var t,r;"video"===e.type&&(e.ext=null===(t=e.ext)||void 0===t?void 0:cG(t).call(t,function(e){var t;return -1===cA(t=e.uri).call(t,"abs-send-time")}),e.rtcpFb=null===(r=e.rtcpFb)||void 0===r?void 0:cG(r).call(r,function(e){return"goog-remb"!==e.type}))}),e.next=11,this.setRemoteDescription(f8.write(c));case 11:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"getDefaultSdp",value:(i=a2(a0().mark(function e(){var t,r,n,i,o;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=f8.parse(null===(t=this._peerConnection.localDescription)||void 0===t?void 0:t.sdp),this.createAVMlineOfferTpl(null===(r=this._peerConnection.localDescription)||void 0===r?void 0:r.sdp),o=[],i.media=cG(n=i.media).call(n,function(e){return"recvonly"===e.direction&&(e.mid=e.mid+1,o.push("".concat(e.mid)),!0)}),i.groups=[{mids:o.join(" "),type:"BUNDLE"}],e.abrupt("return",{sdp:f8.write(i),semantics:"unified-plan",type:"incroffer"});case 6:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"rollback",value:(n=a2(a0().mark(function e(t,r,n){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return yP.warn("rollback()"),e.abrupt("return",this.close(r));case 2:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"close",value:(r=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l,h=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return yP.info("close()"),a={},t.audioTransceiver&&t.audioMid&&(t.audioTransceiver.stop(),a[t.audioMid]=t.audioMid),t.videoTransceiver&&t.videoMid&&!r&&(t.videoTransceiver.stop(),a[t.videoMid]=t.videoMid),s=[],e.next=7,this._peerConnection.createOffer();case 7:return c=e.sent,(u=f8.parse(null==c?void 0:c.sdp)).media=se(n=u.media).call(n,function(e){return a[e.mid]&&(e=mh(e)),"inactive"!==e.direction&&s.push(e.mid),dr(dr({},e),h.peer._offerIce)}),d=f8.parse(null===(i=this._peerConnection.remoteDescription)||void 0===i?void 0:i.sdp),l={},d.media.forEach(function(e){void 0!==e.mid&&(l[e.mid]=e)}),d.media=se(o=u.media).call(o,function(e){return"inactive"===e.direction?e:l[e.mid]}),u.groups&&d.groups&&(u.groups[0].mids=s.join(" "),d.groups[0].mids=s.join(" ")),e.next=17,this.setLocalDescription(f8.write(u));case 17:return e.next=19,this.setRemoteDescription(f8.write(d));case 19:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"setCurrentDescription",value:(t=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._peerConnection.createOffer();case 2:if(!this._peerConnection.localDescription||!this._peerConnection.remoteDescription){e.next=7;break}return e.next=5,this._peerConnection.setLocalDescription(this._peerConnection.localDescription);case 5:return e.next=7,this._peerConnection.setRemoteDescription(this._peerConnection.remoteDescription);case 7:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){vare.type&&(t._aRecvonlyOfferTpl=e)})}}]),d}(),yM=function(e,t){return vw?new yD(e,t):new yN(e,t)},yL=((yr=yL||{}).streamRemovedBySchedule308="stream removed",yr.clientRePublish="client republish",yr.publishStreamFaied="publish failed",yr.clientUnPublish="client unpublished",yr.clientDisconnected="client disconnected",yr.videoMuted="video muted",yr),yU=((yn=yU||{}).PushLimitWarn="PushLimitWarn",yn),yV=((yi=yV||{}).ON_ADD_STREAM="onAddStream",yi.ON_ADD_STREAM_LIST="onAddStreamList",yi.ON_REMOVE_STREAM="onRemoveStream",yi.ON_REMOVE_STREAM_LIST="onRemoveStreamList",yi.USER_DISCONNECTION="userDisconnection",yi.USER_DISCONNECTION_LIST="userDisconnectionList",yi.USER_CONNECTION="userConnection",yi.USER_CONNECTION_LIST="userConnectionList",yi.ON_UPDATE_STREAM_ATTRIBUTES="onUpdateStreamAttributes",yi.ON_UPDATE_ROOM_ATTRIBUTES="onUpdateRoomAttributes",yi.ON_UPDATE_USER_ATTRIBUTES="onUpdateUserAttributes",yi.ON_PUSH_TRACK="onPushTrack",yi.ON_REMOVE_TRACK="onRemoveTrack",yi.ON_CUSTOM_MESSAGE="onCustomMessage",yi.NODE_CHANGE="nodeChange",yi.USER_MESSAGE_RECEIVED="userMessageReceived",yi.USER_BINARY_MESSAGE_RECEIVED="userBinaryMessageReceived",yi.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM="userMessageReceivedOutsideRoom",yi.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM="userBinaryMessageReceivedOutsideRoom",yi.POST_PROCESSING_MESSAGE="postProcessingMessage",yi.ON_USER_TOKEN_WILL_EXPIRE="onUserTokenWillExpire",yi.STREAM_CONTROL_MESSAGE="streamControlMessage",yi.ON_SPEAKER_CHANGE="onSpeakerChange",yi.ON_STREAM_FAILED="streamFailed",yi.ON_NOTIFY_RECONNECT="notifyReconnect",yi.ON_FORWARD_DST_ROOM_USER_KICK="onForwardDstRoomUserKick",yi),yF=((yo=yF||{}).RSCP="RSCP",yo.RTT="RTT",yo.SSC="SSC",yo),yB=((ya=yB||{}).ON_CONNECTION_STATE_CHANGE="onConnectionStateChange",ya.ON_VENDOR_CONNECTION_STATE_CHANGE="onVendorConnectionStateChange",ya.ABNORMAL_DISCONNECTION="normalConnection",ya),yj=((ys=yj||{}).userLeave="userLeave",ys.connectionLost="connectionLost",ys.userDuplicateLogin="userDuplicateLogin",ys.kickedByAdmin="kickedByAdmin",ys.roleChanged="roleChanged",ys.onUserTokenDidExpire="onUserTokenDidExpire",ys),yG=((yc=yG||{})[yc.roomDismissByAdmin=2]="roomDismissByAdmin",yc),yH=new h1("Locker",2),yz=1,yK=function(){function e(t){var r;iE(this,e),iT(this,"lockingPromise",aj.resolve()),iT(this,"locks",0),iT(this,"name",""),iT(this,"lockId",void 0),this.lockId=yz++,t&&(this.name=t),yH.info(a4(r="[lock-".concat(this.name,"-")).call(r,this.lockId,"] is created."))t:function(){return this.locks>0}},{key:"lock",value:function(){var e,t,r,n=this;this.locks+=1,yH.info(a4(e=a4(t="[lock-".concat(this.name,"-")).call(t,this.lockId,"] locked, current queue ")).call(e,this.locks,"."));var i=new aj(function(e){r=function(){var t,r;n.locks-=1,yH.info(a4(t=a4(r="[lock-".concat(n.name,"-")).call(r,n.lockId,"] unlocked, current queue ")).call(t,n.locks,".")),e()}}),o=this.lockingPromise.then(function(){return r});return this.lockingPromise=this.lockingPromise.then(function(){return i}),o}}]),e}(),yX=((yu=yX||{}).RESUBSCRIBE="resubscribe",yu.STREAM_FAILED="stream_failed",yu.SUBSCRIBE_PUSH_TRACK="subscribe_push_track",yu.REMOVE_PUSH_TRACK="remove_push_track",yu.VIDEO_FIRST_FRAME="video_first_frame",yu.ON_USER_PUBLISH_STATE_CHANGE="on_user_publish_state_change",yu.ON_USER_START_AUDIO_CAPTURE="on_user_start_audio_capture",yu.ON_USER_STOP_AUDIO_CAPTURE="on_user_stop_audio_capture",yu.ON_USER_START_VIDEO_CAPTURE="on_user_start_video_capture",yu.ON_USER_STOP_VIDEO_CAPTURE="on_user_stop_video_capture",yu.ON_SEI_MESSAGED_RECEIVED="on_sei_messaged_received",yu.ON_PUBLISH_RESULT="on_publish_result",yu.ON_UPDATE_TOKEN_SUCCESS="on_update_token_success",yu.ON_REMOTE_STREAM_STATS="ON_REMOTE_STREAM_STATS",yu.ON_LOCAL_STREAM_STATS="ON_LOCAL_STREAM_STATS",yu.ON_USER_LEAVE="on_user_leave",yu.ON_ROOM_ERROR="on_room_error",yu.ON_NETWORK_QUALITY="on_network_quality",yu.ON_SIMULCAST_SUBSCRIBE_FALLBACK="on_simulcast_subscribe_fallback",yu.ON_REMOTE_VIDEO_SIZE_CHANGED="on_remote_video_size_changed",yu.RECONNECT_FAILED="reconnect_failed",yu.ON_SUBTITLE_STATE_CHANGED="ON_SUBTITLE_STATE_CHANGED",yu.ON_SUBTITLE_MESSAGE_RECEIVED="ON_SUBTITLE_MESSAGE_RECEIVED",yu.ON_VIDEO_STREAM_BANNED="ON_VIDEO_STREAM_BANNED",yu.ON_AUDIO_STREAM_BANNED="ON_AUDIO_STREAM_BANNED",yu.ON_FORWARD_STREAM_ERROR="ON_FORWARD_STREAM_ERROR",yu.ON_REJOIN_WITH_TCP="ON_REJOIN_WITH_TCP",yu.ON_ICE_CONNECT_WITH_TCP="ON_ICE_CONNECT_WITH_TCP",yu),yW=((yd=yW||{})[yd.START=1]="START",yd[yd.START_SUCCESS=2]="START_SUCCESS",yd[yd.START_FAILED=3]="START_FAILED",yd[yd.UPDATE=4]="UPDATE",yd[yd.UPDATE_SUCCESS=5]="UPDATE_SUCCESS",yd[yd.UPDATE_FAILED=6]="UPDATE_FAILED",yd[yd.STOP=7]="STOP",yd[yd.STOP_SUCCESS=8]="STOP_SUCCESS",yd[yd.STOP_FAILED=9]="STOP_FAILED",yd),yq=((yl=yq||{})[yl.PUB=0]="PUB",yl[yl.UNPUB=1]="UNPUB",yl),yY=((yh=yY||{})[yh.SUB=0]="SUB",yh[yh.UNSUB=1]="UNSUB",yh),yJ=(iT(ym={},lk.communication,[0]),iT(ym,lk.chat,[0]),iT(ym,lk.chatRoom,[1,"IES_chatroom"]),iT(ym,lk.coHost,[1,"IES_PK"]),iT(ym,lk.meeting,[16]),iT(ym,lk.classRoom,[0]),ym),yQ=fY(),yZ=function(e){dy(s,mg);var t,r,n,i,o,a=dC(s);function s(e,t){var r;return iE(this,s),iT(dn(r=a.call(this,e,t)),"peerConnectionId",p7()),iT(dn(r),"peerConnectionMode",1),iT(dn(r),"name","vendor"),iT(dn(r),"direction","up"),iT(dn(r),"stream",void 0),t.on("ice_state",function(e){r._report("rtc_ice_state",{pc_session_id:r.peerConnectionId,direction:r.direction,error_code:0,ice_state:e.toUpperCase(),message:"",peer_connection_id:r.peerConnectionId,stream_id:"",stream_user_id:""})}),r}return ib(s,[{key:"publish",value:(o=a2(a0().mark(function e(t){var r,n,i,o,a,c,u,d,l,h,_=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.enableSimulcast=!1,this.stream=t,n=(r=dm(df(s.prototype),"internalPublish",this).call(this,t)).videoDescriptions,i=r.subVideoDescriptions,o=r.audioTransceiverInit,a=r.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(o.track,o.init),t.videoTransceiver=this._peerConnection.addTransceiver(a.track,a.init),yQ&&(t.initAudioEncodedTransform(),t.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:(null==t?void 0:t.vendorCode)||0}),e.next=9,this._peerConnection.createOffer();case 9:return c=e.sent,u=p9(),Array.isArray((d=f8.parse(c.sdp)).media)&&(d.media=se(l=d.media).call(l,function(e){var r,n,i,o,a;if("video"===e.type)null!==(r=_._context)&&void 0!==r&&null!==(n=r.serverConfig)&&void 0!==n&&n.videoCodec&&mf(e,null===(i=_._context)||void 0===i||null===(o=i.serverConfig)||void 0===o?void 0:o.videoCodec),(vx||vj)&&Array.isArray(e.ext)&&(e.ext=cG(a=e.ext).call(a,function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&c1(t).call(t,"video-orientation"))})),vx||_.addBitrateLimit(e,t.videoEncodeConfig[0].maxKbps);else if("audio"===e.type){var s,c=null==e?void 0:cS(s=e.rtp).call(s,function(e){return"opus"===e.codec});if(c&&e.fmtp){var u,d,l=cS(u=e.fmtp).call(u,function(e){return e.payload===c.payload});l&&null!==(d=_._context)&&void 0!==d&&d.audioProfileManager&&(l.config=_._context.audioProfileManager.getOpusConfigStr(l.config))}}return e})),h=new RTCSessionDescription({type:"offer",sdp:f8.write(d)}),e.prev=14,e.next=17,this._peerConnection.setLocalDescription(h);case 17:this._report("rtc_set_description",{error_code:0,message:h.sdp||"",is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:p9()-u},{type:"offer"}),e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(14),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+h.sdp,is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:p9()-u},{type:"offer"}),e.t0;case 24:return e.abrupt("return",{partialSdp:h.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",videoDescriptions:n,subVideoDescriptions:i,audioTransceiverInit:o,videoTransceiverInit:a,peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId});case 25:case"end":return e.stop()}},e,this,[[14,20]])})),function(e){return o.apply(this,arguments)})},{key:"subscribe",value:(i=a2(a0().mark(function e(t){var r,n,i,o,a,s=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.stream=t,this.direction="down",t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"}),yQ&&(t.initAudioEncodedTransform(),t.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"down",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:t.vendorCode||0}),e.next=8,this._peerConnection.createOffer();case 8:return r=e.sent,n=p9(),Array.isArray((i=f8.parse(r.sdp)).media)&&(i.media=se(o=i.media).call(o,function(e){if("audio"===e.type){var t,r=null==e?void 0:cS(t=e.rtp).call(t,function(e){return"opus"===e.codec});if(r&&null!=e&&e.fmtp){var n,i=null==e?void 0:cS(n=e.fmtp).call(n,function(e){return e.payload===r.payload});i&&s._context&&(i.config+=";stereo=1;sprop-stereo=1")}}return e})),a=new RTCSessionDescription({type:"offer",sdp:f8.write(i)}),e.prev=13,e.next=16,this._peerConnection.setLocalDescription(a);case 16:this._report("rtc_set_description",{error_code:0,message:a.sdp||"",is_local:"1",direction:"down",stream_id:t.streamId,stream_user_id:t.userId,elapse:p9()-n},{type:"offer"}),e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(13),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+a.sdp,is_local:"1",direction:"down",stream_id:t.streamId,stream_user_id:t.userId,elapse:p9()-n},{type:"offer"}),e.t0;case 23:return e.abrupt("return",{partialSdp:a.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId});case 24:case"end":return e.stop()}},e,this,[[13,19]])})),function(e){return i.apply(this,arguments)})},{key:"handleAck",value:(n=a2(a0().mark(function e(t){var r,n,i,o,a,s,c;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.action!==yR.publish&&t.action!==yR.subscribe){e.next=16;break}return n=new RTCSessionDescription({sdp:null===(r=t.signalingAck)||void 0===r?void 0:r.sdp,type:"answer"}),i=p9(),e.prev=3,e.next=6,this._peerConnection.setRemoteDescription(n);case 6:this._report("rtc_set_description",{error_code:0,message:n.sdp||"",is_local:"1",direction:"down",stream_id:null===(o=t.stream)||void 0===o?void 0:o.userId,stream_user_id:(null===(a=t.stream)||void 0===a?void 0:a.streamId)||"",elapse:p9()-i},{type:"answer"}),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+n.sdp,is_local:"1",direction:"down",stream_id:null===(s=t.stream)||void 0===s?void 0:s.userId,stream_user_id:(null===(c=t.stream)||void 0===c?void 0:c.streamId)||"",elapse:p9()-i},{type:"offer"}),e.t0;case 13:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=17;break;case 16:t.action!==yR.unpublish&&t.action!==yR.unsubscribe||this.destroy();case 17:return e.abrupt("return","");case 18:case"end":return e.stop()}},e,this,[[3,9]])})),function(e){return n.apply(this,atype),"destroy",this).call(this)}},{key:"getDefaultSdp",value:(r=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{sdp:"",type:"offer",semantics:""});case 1:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"connect",value:function(){throw Error("Method not implemented.")}},{key:"rollback",value:(t=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{this._peerConnection.close()}catch(e){}case 1:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),s}(),y$=((y_=y$||{})[y_.AUTOPLAY_FAILED=-1e3]="AUTOPLAY_FAILED",y_[y_.TRACK_ERROR=-1001]="TRACK_ERROR",y_[y_.Fetch_MODIFY=-1002]="Fetch_MODIFY",y_[y_.BLACK_BROWSER=-1003]="BLACK_BROWSER",y_),y0={start_interval:100,multiplier:2,max_interval:3e4},y1=function(){function e(){iE(this,e),iT(this,"_times",0),iT(this,"_config",y0),iT(this,"initTs",p9())}return ib(e,[{key:"getRetryDelay",value:function(){return Math.min(this._config.max_interval,Math.pow(this._config.multiplier,this._times++)*this._config.start_interval)}},{key:"setConfig",value:function(e){this._config=e}},{key:"reset",value:function(){this._times=0}}]),e}(),y2=new h1("ICERequest",4),y3=function(){var e,t,r,n;function i(e){iE(this,i),iT(this,"_reconnectTimer",void 0),iT(this,"_abortControllers",[]),iT(this,"_monitor",void 0),iT(this,"_groupConfigId",p7()),iT(this,"_retryLimiter",new y1),iT(this,"_timer",void 0),this._ctx=e,this._monitor=pZ(e.id)}return ib(i,[{key:"getICENode",value:(n=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return y2.info("getICENode","invoke"),e.prev=1,e.next=4,this._getAccessWithRetry(t);case 4:if(0!==(r=e.sent).length){e.next=7;break}throw"server return empty nodes.";case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),this._reportRtcInvokeStatus("es.join.getNodeFailed",e.t0),new lM(le.ICE_SERVER_WRONG,"get ICE config failed: ".concat(e.t0),e.t0);case 13:return y2.success("getICENode","success"),this._reportRtcInvokeStatus("es.join.getNodeSuccess",r),e.abrupt("return",r);case 16:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return n.apply(this,arguments)})},{key:"_getAccessWithRetry",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0!==r&&y2.info("_getAccessWithRetry()","invoke feedbackInfo: %o, 201count: %o",e,r),new aj(funct(e){t._retryLimiter.reset(),n(e)}).catch(function(o){if(Array.isArra){return 400<=e.code&&e.code<500})>-1)return t._retryLimiter.reset(),i("HTTP request failed(4xx)");if(o.every(function(e){var t;return 201===e.code||201===(null===(t=e.error)||void 0===t?void 0:t.code)})&&r++,3===r)return t._retryLimiter.reset(),i("HTTP request failed(201)")}var a=t._retryLimiter.getRetryDelay();y2.warn("_getAccessWithRetry()","_getAccessWithRetry error, will retry after ".concat(a,"ms"),o),sWithRetry(e,r).then(n).catch(i)},a)})})}},{key:"_getAccessNode",value:(r=a2(a0().mark(function e(t){var r=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new aj(function(e,n){var i=v4.getAccessNode(r._ctx.appId);i?(y2.info("getAccessNode","use cache node."),e(Array.isArray(i)?i:[i]),r._timer=window.setTimeout(function(){r._getAccessNodeFromServer(t),r._reportRtcInvokeStatus("es.R.node.cache",i),delete r._timer},0)):r._getAccessNodeFromServer(t).then(e).catch(n)}));case 1:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})},{key:"_getAccessNodeFromServer",value:(t=a2(a0().mark(function e(t){var r,n,i,o=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=this._getAccessUrls()).urls,i=r.needFallback,e.abrupt("return",this.getICEConfigFromServer(n,t).then(function(e){var t=e.nodes;return o._ctx.useCloudProxy||v4.setAccessNode(o._ctx.appId,t,e.ttl||11200),e.dispatchDomains&&!o._ctx.useCloudProxy&&v4.setAccessUrls(e.dispatchDomains),t}).catch(function(e){if(i)return o._reportRtcInvokeStatus("es.R.req.fallback",""),v4.clearAccessUrls(),o._getAccessNodeFromServer(t);throw e}));case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_getAccessUrls",value:function(){var e=v4.getAccessUrls()||[],t=!0;return this._reportRtcInvokeStatus("es.R.req.cache.urls",e),0===e.length&&(e=ft.ICE_CONFIG_REQUEST_URLS,t=!1,this._reportRtcInvokeStatus("es.R.req.external.urls",e)),0===e.length&&(e=ft.ICE_CONFIG_REQUEST_URLS_INTERNAL,t=!1,this._reportRtcInvokeStatus("es.R.req.internal.urls",e)),{urls:e,needFallback:t}}},{key:"getICEConfigFromServer",value:(e=a2(a0().mark(function e(t,r){var n,i,o,a,s,c=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=p7(),o={appID:this._ctx.appId,deviceID:v4.getDeviceId(),connectSessionID:i,os:"web",sdkVersion:ft.VERSION,isOversea:ft.OVERSEA,expectedAddr:fn("EXPECTED_ADDR"),productPlatform:"VolcEngine",enableCloudProxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC},r&&(o.feedbackInfo=r,delete o.expectedAddr),a=Date.now(),null===(n=this._monitor)||void 0===n||n.report("rtc_get_access",{error_code:0,message:a6(o),elapse:0,type:"request",host:t.join(","),config_id:i,group_config_id:this._groupConfigId}),s=se(t).call(t,function(){var e=a2(a0().mark(function e(t,r){var n,i,a,s,u;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new AbortController,c._abortControllers.push(i),e.prev=2,e.next=5,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:a6(o),signal:i.signal});case 5:a=e.sent,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(2),hj(fetch)||null===(s=c._monitor)||void 0===s||s.report("rtc_error",{error_code:y$.Fetch_MODIFY,message:"get access failed, possibly due to modifying the browser's Fetch API."},{origin_error:e.t0}),e.t0;case 12:if(c._abortControllers.call(n,function(e){return e!==i}),200===a.status){e.next=15;break}throw{message:a.statusText,code:a.status};case 15:return e.next=17,a.json();case 17:if(200===(u=e.sent).code){e.next=20;break}throw u;case 20:if(0!==u.nodes.length){e.next=22;break}throw{code:u.code,message:a6(u)};case 22:return e.abrupt("return",{url:t,result:u});case 23:case"end":return e.stop()}},e,null,[[2,8]])}));return function(t,r){return e.apply(this,arguments)}}()),e.abrupt("return",va(s).then(function(e){var t,r=e.result,n=e.url;return null===(t=c._monitor)||void 0===t||t.report("rtc_get_access",{error_code:200,message:a6(r),elapse:Date.now()-a,type:"response",host:n,config_id:i,group_config_id:c._groupConfigId}),r}).catch(function(e){var r,n,o,s;throw null===(r=c._monitor)||void 0===r||r.report("rtc_get_access",{error_code:Number((null===(n=e[0])||void 0===n?void 0:n.code)||(null===(o=e[0])||void 0===o?void 0:o.server_code)),message:null===(s=e[0])||void 0===s?void 0:s.message,elapse:Date.now()-a,type:"response",host:t.join(","),config_id:i,group_config_id:c._groupConfigId},{error:a6(e)}),e}));case 7:case"end":return e.stop()}},e,this)})),function(t,r){return e.apply(this,arguments)})},{key:"destroy",value:function(){this._abortControllers.forEach(function(e){return e.abort()}),this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer),this._timer&&(window.clearTimeout(this._timer),delete this._timer)}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;null===(r=this._monitor)||void 0===r||r.report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:n,stream_id:"",elapse:0,group_config_id:this._groupConfigId},i)}}]),i}(),y5={iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",encodedInsertableStreams:!!fY()||void 0},y4=((yp=y4||{})[yp.DC_ERROR=0]="DC_ERROR",yp[yp.DC_CLOSE=1]="DC_CLOSE",yp[yp.ICE_FAILED=2]="ICE_FAILED",yp[yp.DESTROY=3]="DESTROY",yp[yp.TIMEOUT=4]="TIMEOUT",yp),y6=0,y8=function(e){dy(s,fR);var t,r,n,i,o,a=dC(s);function s(e,t){var r;return iE(this,s),iT(dn(r=a.call(this)),"uuid",(y6++).toString()),iT(dn(r),"_peerConnectionId",""),iT(dn(r),"audioTrack4ff",void 0),iT(dn(r),"_pc",void 0),iT(dn(r),"_dc",void 0),iT(dn(r),"_iceNode",void 0),iT(dn(r),"_initSctpEvents",!1),iT(dn(r),"_monitor",void 0),iT(dn(r),"_offerIce",{}),iT(dn(r),"_answerIce",{}),iT(dn(r),"_offerSession",void 0),iT(dn(r),"_answerSession",void 0),iT(dn(r),"_offerMlines",[]),iT(dn(r),"_answerMlines",[]),iT(dn(r),"_connectReject",void 0),iT(dn(r),"_logger",new h1("PeerConnection_".concat(r.uuid),4)),r._ctx=e,r._groupConnectionId=t,r._monitor=pZ(e.id),r._pc=new RTCPeerConnection(y5),r._pc.ontrack=function(e){var t,n,i,o,a=null===(t=e.streams)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id;r._print("pc.ontrack",a4(i=a4(o="".concat(e.track.kind," ")).call(o,e.track.id," ")).call(i,a)),"ff-stream"===a&&(r.audioTrack4ff=e.track),r.emit("ontrack",e)},r._pc.onconnectionstatechange=function(e){var t;r._print("onconnectionstatechange",a4(t="".concat(r._pc.connectionState,". ice -> ")).call(t,r._pc.iceConnectionState)),"failed"!==r._pc.iceConnectionState&&"closed"!==r._pc.iceConnectionState&&"failed"!==r._pc.connectionState||r.emit("disconnect","ice failed")},r._pc.oniceconnectionstatechange=function(){var e=r._pc.iceConnectionState;r._report("rtc_pre_ice_state",{message:e,ice_state:e.toUpperCase()}),r.emit("ice_state",e)},r}return ib(s,[{key:"getOriginRTCPeerConnection",value:function(){return this._pc}},{key:"getOriginRTCDataChannel",value:function(){return this._dc}},{key:"getConnectionId",value:function(){return this._peerConnectionId}},{key:"getGroupConnectionId",value:function(){return this._groupConnectionId}},{key:"connect",value:(o=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,d,l=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._print("connect","invoke. %o",t),this._iceNode=t,this._dc=this._pc.createDataChannel("signaling",{negotiated:!0,id:100}),this._dc.binaryType="arraybuffer",e.next=6,this._genIceInfo(t);case 6:return n=(r=e.sent).offerIce,i=r.answerIce,this._offerIce=n,this._answerIce=i,this._peerConnectionId=i.iceUfrag||"",vw&&(this._pc.addTransceiver("audio",{direction:"recvonly"}),this._pc.addTransceiver("video",{direction:"recvonly"})),e.next=15,this._pc.createOffer();case 15:if(o=e.sent,s=u3((a=f8.parse(o.sdp)).media,1)[0],this._offerIce.fingerprint=a.fingerprint||s.fingerprint,!vw){e.next=30;break}return a.media=se(c=a.media).call(c,function(e){var t,r,n=dr(dr({},e),l._offerIce);return"video"===n.type&&(n.ext=null===(t=n.ext)||void 0===t?void 0:cG(t).call(t,function(e){var t;return -1===cA(t=e.uri).call(t,"abs-send-time")}),n.rtcpFb=null===(r=n.rtcpFb)||void 0===r?void 0:cG(r).call(r,function(e){return"goog-remb"!==e.type})),n}),(d=dr({},a)).fingerprint=this._answerIce.fingerprint,d.media=se(u=d.media).call(u,function(e){return delete(e=dr(dr({},e),l._answerIce)).bundleOnly,e.port=9,"application"===e.type?e.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}:("audio"===e.type&&(e.msid="ff-stream ff-stream-audio"),e.direction="sendonly"),e}),e.next=26,this.setLocalDescription(f8.write(a));case 26:return e.next=28,this.setRemoteDescription(f8.write(d));case 28:e.next=38;break;case 30:delete a.media,this._offerSession=dr({},a),this._answerSession=dr({},a),this._answerSession.fingerprint&&(this._answerSession.fingerprint=this._answerIce.fingerprint),this._offerMlines=[dr(dr(dr({},s),this._offerIce),{},{mid:"".concat(0)})],this._answerMlines=[dr(dr(dr({},s),this._answerIce),{},{sctpmap:{sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144},mid:"".concat(0)})],this.setDescription();case 38:return e.next=40,new aj(function(e,t){l._connectReject=t,l._dc.onopen=function(){l._print("connect","dataChannel open"),l._reportRtcInvokeStatus("es.dc.open",""),e(""),delete l._connectReject},l._dc.onerror=function(e){var t,r;l._report("rtc_signaling_msg_error",{error_code:e.error.sdpLineNumber,message:e.error.errorDetail,reason:"invalid data"}),l._reportRtcInvokeStatus("es.dc.error",""),null===(t=l._connectReject)||void 0===t||t.call(l,{message:"dc.onerror, ".concat(null===(r=e.error)||void 0===r?void 0:r.errorDetail),code:0}),l.emit("disconnect","dc onerror"),delete l._connectReject},l._dc.onclose=function(e){var t;l._reportRtcInvokeStatus("es.dc.close",""),null===(t=l._connectReject)||void 0===t||t.call(l,{message:"dc.onclose",code:1}),l.emit("disconnect","dc onclose"),delete l._connectReject},l._pc.addEventListener("connectionstatechange",function(e){var t,r;"failed"!==l._pc.iceConnectionState&&"closed"!==l._pc.iceConnectionState&&"failed"!==l._pc.connectionState||(null===(t=l._connectReject)||void 0===t||t.call(l,{message:a4(r="pc.connectionstatechange -> ".concat(l._pc.connectionState,", ice -> ")).call(r,l._pc.iceConnectionState),code:2}),delete l._connectReject)}),setTimeout(function(){var e;null===(e=l._connectReject)||void 0===e||e.call(l,{code:4,message:"connect timeout"}),delete l._connectReject},8e3)});case 40:return this._print("connect","dataChannel establish success"),e.abrupt("return",this._dc);case 42:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"setDescription",value:(i=a2(a0().mark(function e(t){var r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._print("setDescription","invoke."),this._offerSession.media=this._offerMlines,this._answerSession.media=this._answerMlinve"!==e.direction&&r.push(e.mid)}),this._offerSession.groups&&this._answerSession.groups&&(this._offerSession.groups[0].mids=r.join(" "),this._answerSession.groups[0].mids=r.join(" ")),n=p9(),t&&this._report("rtc_begin_create_offer",{direction:"local"===t.streamUserId?"up":"down",stream_id:t.streamId,stream_user_id:t.streamUserId,pc_session_id:this._peerConnectionId,vendor_mode:0}),e.next=10,this._pc.createOffer();case 10:return t&&this._report("rtc_create_offer",{error_code:0,direction:"local"===t.streamUserId?"up":"down",stream_id:t.streamId,stream_user_id:t.streamUserId,elapse:p9()-n}),e.next=13,this.setLocalDescription(f8.write(this._offerSession),t);case 13:return e.next=15,this.setRemoteDescription(f8.write(this._answerSession),t);case 15:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"setLocalDescription",value:(n=a2(a0().mark(function e(t,r){var n,i,o,a=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p9(),e.prev=1,e.next=4,this._pc.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:t}));case 4:this._report("rtc_set_description",{error_code:0,message:t,is_local:"1",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:p9()-n},{type:"offer"}),this._initSctpEvents||(this._initSctpEvents=!0,(o=null===(i=this._pc)||void 0===i?void 0:i.sctp)&&(o.onstatechange=function(){a._reportRtcInvokeStatus("sctp","sctp state change TO: ".concat(o.state))},o.transport&&(o.transport.onstatechange=function(){var e;a._reportRtcInvokeStatus("dtls","dtls state change TO: ".concat(null==o||null===(e=o.transport)||void 0===e?void 0:e.state))}))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+t,is_local:"1",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:"",stream_user_id:"",elapse:p9()-n},{type:"offer"});case 12:case"end":return e.stop()}},e,this,[[1,8]])})),function(e,t){return n.apply(this,arguments)})},{key:"setRemoteDescription",value:(r=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p9(),e.prev=1,e.next=4,this._pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t}));case 4:this._report("rtc_set_description",{error_code:0,message:t,is_local:"0",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:p9()-n},{type:"answer"}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+t,is_local:"0",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:p9()-n},{type:"answer"});case 11:case"end":return e.stop()}},e,this,[[1,7]])})),function(e,t){return r.apply(this,arguments)})},{key:"disconnect",value:function(){var e,t;null===(e=this._connectReject)||void 0===e||e.call(this,{code:3,message:"invoke destroy()"}),delete this._connectReject,this._pc.close(),null===(t=this._dc)||void 0===t||t.close(),this._pc.ontrack=null}},{key:"destroy",value:function(){this._print("destroy",this._peerConnectionId),dm(df(s.prototype),"removeAllListeners",this).call(this),this.disconnect()}},{key:"_genIceInfo",value:(t=a2(a0().mark(function e(t){var r,n,i,o;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={iceUfrag:null===(r=t.iceParams)||void 0===r?void 0:r.clientIceUfrag,icePwd:null===(n=t.iceParams)||void 0===n?void 0:n.clientIcePwd,iceOptions:"renomination"},e.next=3,function(e){return mp.apply(this,arguments)}(t);case 3:return o=e.sent,e.abrupt("return",{offerIce:i,answerIce:o});case 5:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})},{key:"_print",value:function(e){for(var t,r,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(t=this._logger).info.apply(t,a4(r=["".concat(e)]).call(r,i))}},{key:"_report",value:function(e,t,r){var n,i,o,a;null===(n=this._monitor)||void 0===n||n.report(e,dr(dr({},t),{},{connection_id:this._peerConnectionId,group_connection_id:this._groupConnectionId}),dr(dr({},r),{},{tcp_only:null===(i=this._iceNode)||void 0===i?void 0:i.iceConfig.tcpOnly,ms_addr:a6((null===(o=this._iceNode)||void 0===p,tcp:e.tcpPorts,udp:e.udpPorts}}))||[])}))}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;this._report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:n,elapse:0},i)}}],[{key:"checkSupported",value:function(){if(!RTCPeerConnection)throw new lM(le.NOT_SUPPORTED,"missing RTCPeerConnection API.");["addTransceiver","createDataChannel","createOffer","setLocalDescription","setRemoteDescription"].forEach(function(e){var t,r;if(null===(t=RTCPeerConnection)||void 0===t||null===(r=t.prototype)||void 0===r||!r[e])throw new lM(le.NOT_SUPPORTED,"missing peer.".concat(e," API."))})}}]),s}(),y7=((E_=y7||{})[E_.SEND=0]="SEND",E_[E_.FEEDBACK=1]="FEEDBACK",E_),y9=((Ep=y9||{})[Ep.P2P=0]="P2P",Ep[Ep.SIGNAL=1]="SIGNAL",Ep[Ep.BROADCAST=2]="BROADCAST",Ep[Ep.BUSINESS_SERVER=3]="BUSINESS_SERVER",Ep),Se=((Ev=Se||{})[Ev.SUCCESS=0]="SUCCESS",Ev[Ev.TIMEOUT=1]="TIMEOUT",Ev[Ev.BROKEN=2]="BROKEN",Ev[Ev.NO_RECEIVER=3]="NO_RECEIVER",Ev[Ev.NO_RELAYPATH=4]="NO_RELAYPATH",Ev[Ev.EXCEED_QPS=5]="EXCEED_QPS",Ev[Ev.SEND_TO_SERVER_ERROR=17]="SEND_TO_SERVER_ERROR",Ev[Ev.SERVER_RESPONSE_ERROR=18]="SERVER_RESPONSE_ERROR",Ev[Ev.NOT_JOIN=100]="NOT_JOIN",Ev[Ev.NOT_LOGIN=105]="NOT_LOGIN",Ev[Ev.SERVER_PARAMS_NOTSET=106]="SERVER_PARAMS_NOTSET",Ev[Ev.UNKNOWN=1e3]="UNKNOWN",Ev),St=(iT(yg={},0,[0,"success"]),iT(yg,1,[le.USER_MESSAGE_TIMEOUT,"timeout, failed to send."]),iT(yg,2,[le.USER_MESSAGE_BROKEN,"dataChannel broken, failed to send."]),iT(yg,3,[le.USER_MESSAGE_NO_RECEIVER,"cannot find the receiver."]),iT(yg,4,[le.USER_MESSAGE_NO_RECEIVER,"cannot find relay path."]),iT(yg,5,[le.USER_MESSAGE_EXCEED_QPS,"cannot find relay path."]),iT(yg,17,[le.USER_MESSAGE_SEND_TO_SERVER_ERROR,"failed to send to business server."]),iT(yg,18,[le.USER_MESSAGE_SERVER_RESPONSE_ERROR,"business server response error."]),iT(yg,100,[le.USER_MESSAGE_NOT_JOIN,"not join room"]),iT(yg,105,[le.USER_MESSAGE_NOT_LOGIN,"not login."]),iT(yg,106,[le.USER_MESSAGE_SERVER_PARAMS_NOTSET,"server param is not set."]),iT(yg,1e3,[le.USER_MESSAGE_UNKNOWN,"unknown."]),yg),Sr=["msg"],Sn=new h1("DataChannelSignaling",3),Si=[],So=((Ef=So||{})[Ef.C2S=0]="C2S",Ef[Ef.C2C=1]="C2C",Ef[Ef.C2GW=2]="C2GW",Ef[Ef.C2CDirect=3]="C2CDirect",Ef[Ef.C2RTM=4]="C2RTM",Ef),Sa=function(e){dy(a,fT.exports.EventEmitter);var t,r,n,i,o=dC(a);function a(e,t){var r;return iE(this,a),iT(dn(r=o.call(this)),"_singlingCache",new sF),iT(dn(r),"_p2pCache",new sF),iT(dn(r),"_rttIds",{}),iT(dn(r),"_p2pMessageId",1),iT(dn(r),"_clearDataChannelListener",void 0),iT(dn(r),"_monitor",void 0),r.id=e,r._dataChannel=t,r._clearDataChannelListener=r._handleHandler(),r._monitor=pZ(e),r}return ib(a,[{key:"destroy",value:function(){var e=this;this._dataChannel&&(this._clearDataChannelListener(),this._dataChannel.close()),this._singlingCache.forEach(function(t,r){t.error(new lM(le.OPERATION_CANCEL,"disconnect")),e._singlingCache.delete(r)}),this._singlingCache.clear(),this._p2pCache.clear(),this._p2pMessageId=1,this._rttIds={}}},{key:"sendSignaling",value:function(e,t,r){var n,i=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6e4;return null===(n=this._monitor)||void 0===n||n.report("rtc_signaling",{error_code:0,message:a6(t),signaling_event:"call-".concat(e),signaling_type:"Send",stream_id:t.streamId,stream_user_id:t.streamUserId,direction:"up"}),new aj(function(n,a){var s,c=i._genHeader(r);c.id=vr();var u=c.id.join("-"),d="customMessage"===e;d&&pj.samplingOne2ManyMsg(i.id,Number(c.id.join("")),t);var l=setTimeout(function(){i._singlingCache.delete(u),a(new lM(le.TIME_OUT,"".concat(e," message time out"))),d&&pj.updateOne2ManyMsgAck(i.id,t,999)},o);i._singlingCache.set(u,{signalingType:e,success:function(e){clearTimeout(l),n(e),d&&pj.updateOne2ManyMsgAck(i.id,t,0)},error:function(e){clearTimeout(l),a(e),d&&pj.updateOne2ManyMsgAck(i.id,t,e.code)}}),Sn.info("Signal",a4(s=">>>>>> [".concat(e,"][")).call(s,u,"]"),t),i._sendMessage(e,c,t)})}},{key:"sendPingSignaling",value:function(){return this.sendSignaling("CheckConnectivity",{ts:Date.now()},{functionType:2})}},{key:"sendP2PMessage",value:(i=a2(a0().mark(function e(t,r){var n,i,o;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.msg,i=function(ell(t,r)>=0||(i[r]=e[r]);return i}(e,t);if(u5){var o=u5(e);for(n=0;n<o.length;n++)r=o[n],cA(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(t,Sr),o=n instanceof ArrayBuffer,e.t0=this,e.t1=pj,e.t2=this.id,e.t3=dr,e.t4=dr({ver:1,id:this._p2pMessageId++,time:Date.now(),dir:y7.SEND,type:y9.P2P,err:Se.SUCCESS},i),e.t5={},e.t6=o,!o){e.next=15;break}return e.next=12,vt.ab2b64str(n);case 12:e.t7=e.sent,e.next=16;break;case 15:e.t7=n;case 16:return e.t8=e.t7,e.t9={binary:e.t6,msg:e.t8},e.t10=(0,e.t3)(e.t4,e.t5,e.t9),e.t11=e.t1.samplingP2PMsg.call(e.t1,e.t2,e.t10),e.t12=r,e.abrupt("return",e.t0._sendP2PMessage.call(e.t0,e.t11,e.t12));case 22:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"_sendP2PMessage",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vi(e.msg)?this._rttIds[e.id]=e.id:e.dir===y7.SEND&&Sn.info("_sendP2PMessage [DC Signaling p2p >>]",a6(e)),new aj(function(n,i){var o=t._genHeader(dr(dr({needAck:!0,functionType:1},r),{},{id:vr()}));if(e.dir===y7.SEND){var a=setTimeout(function(){t._p2pCache.delete(e.id),i(new lM(le.USER_MESSAGE_TIMEOUT,"P2P message timeout")),pj.updateP2PMsgAck(t.id,e,999)},12e3);t._p2pCache.set(e.id,{success:function(r,i){clearTimeout(a),n(i),pj.updateP2PMsgAck(t.id,e,0)},error:function(r){clearTimeout(a),pj.updateP2PMsgAck(t.id,e,r.err);var n,o=u3(St[r.err]||[le.USER_MESSAGE_UNKNOWN,a4(n="err: ".concat(r.err,", msg: ")).call(n,r.msg)],2),s=o[0],c=o[1];i({err:r.err,code:s,message:r.msg||c})}})}try{t._sendMessage("p2p",o,e)}catch(e){throw e.code===le.NOT_CONNECTED_YET&&(e.code=le.USER_MESSAGE_BROKEN),e}})}},{key:"_sendMessage",value:function(e,t,r){if(!this._dataChannel||"open"!==this._dataChannel.readyState)throw new lM(le.NOT_CONNECTED_YET,"DataChannel not open");var n,i=t.version+(Number(t.zip)<<5)+(Number(t.encrypt)<<6),o=Number(t.needAck)+(Number(t.direction)<<1)+(Number(t.functionType)<<2)+(Number(t.binary)<<6),a=vt.str2ab(a6([e,r])),s=ve(Uint8Array,a4(n=[i,o]).call(n,ud(t.id||[])),new Uint8Array(a));this._dataChannel.send(s.buffer),"p2p"===e?pj.updateP2PMsgReq(this.id,r,s.buffer.byteLength):"customMessage"===e&&pj.updateOne2ManyMsgReq(this.id,r,s.buffer.byteLength)}},{key:"_dispartData",value:function(e){var t=new Uint8Array(e),r=0,n=t[r++],i=t[r++],o={version:15&n,zip:16==(16&n),encrypt:32==(32&n),needAck:1==(1&i),direction:(2&i)>>1,functionType:(60&i)>>2,binary:64==(64&i)};if(o.needAck||1===o.direction){for(;r<=6;r++)if(128!=(128&t[r])){r++;break}o.id=uc(a$(t).call(t,2,r))}return{header:o,data:a$(t).call(t,r)}}},{key:"_feedbackSignaling",value:function(e,t,r){var n,i,o=this._genHeader({needAck:!0,direction:1,id:se(n=e.split("-")).call(n,function(e){return Number(e)})});c1(Si).call(Si,t)||Sn.info("Signal",a4(i=">>>>>> [".concat(t,"-res][")).call(i,e,"]")),this._sendMessage("".concat(t,"-res"),o,r)}},{key:"_handleMessage",value:(n=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,d;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=Date.now(),n=t.byteLength,o=(i=this._dispartData(t)).data,(a=i.header).zip&&((s=new pC.Inflate).push(o,!0),o=s.result),c=vt.ab2str(o),u=[],e.prev=8,u=JSON.parse(c),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(8),e.t0 instanceof Error&&(null===(d=this._monitor)||void 0===d||d.report("rtc_signaling_msg_error",{error_code:-1,message:e.t0.message,reason:"message parse failed"})),e.abrupt("return");case 16:e.t1=a.functionType,e.next=0===e.t1?19:1===e.t1?21:2===e.t1?23:25;break;case 19:return this.C2S(a,u,c,n,r),e.abrupt("break",26);case 21:return this.C2C(u,n,r),e.abrupt("break",26);case 23:return this.C2GW(a,u,c),e.abrupt("break",26);case 25:return e.abrupt("break",26);case 26:case"end":return e.stop()}},e,this,[[8,12]])})),function(e){return n.apply(this,arguments)})},{key:"C2S",value:(r=a2(a0().mark(function e(t,r,n,i,o){var a,s,c,u,d;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(null===(a=t.id)||void 0===a?void 0:a.join("-"))||"",1!==t.direction){e.next=5;break}this._handleAckMessage(s,r[0]||{},n),e.next=18;break;case 5:if(!Array.isArray(r)){e.next=18;break}if(u=r[0],r=r[1],c1(Si).call(Si,u)||Sn.info("Signal","<<<<<< ".concat(u),r,s),this._feedbackSignaling(s,u,u===yV.ON_CUSTOM_MESSAGE?dr(dr({},r),{},{message:""}):""),!r.binary||"string"!=typeof r.message){e.next=14;break}return e.next=13,vt.b64str2ab(r.message);case 13:r.message=e.sent;case 14:d=Date.now(),this.emit(u,dr({},r)),u===yV.ON_CUSTOM_MESSAGE&&pj.reportOne2ManyMsgRecv(this.id,r,{msg_size:i,recv_msg_ts:o,fwd_msg_ts:d}),null===(c=this._monitor)||void 0===c||c.report("rtc_signaling",{error_code:0,message:n,signaling_event:"on-".concat(u),signaling_type:"Recv",stream_id:r.streamId,stream_user_id:r.clientId,direction:"down"});case 18:case"end":return e.stop()}},e,this)})),function(e,t,n,i,o){return r.apply(this,arguments)})},{key:"C2C",value:(t=a2(a0().mark(function e(t,r,n){var i,o,a,s,c,u,d,l,h,_,p,v,f;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Array.isArray(t)&&(t=t[1]),c=null===(i=t)||void 0===i?void 0:i.id,this._rttIds[c]||(null===(o=t)||void 0===o?void 0:o.dir)===y7.FEEDBACK||vi(null===(a=t)||void 0===a?void 0:a.msg)?delete this._rttIds[c]:Sn.info("Signal","<<<<<< p2p response",t),e.t0=t.dir,e.next=e.t0===y7.SEND?6:e.t0===y7.FEEDBACK?46:48;break;case 6:if(u=Date.now(),vi(null===(s=t)||void 0===s?void 0:s.msg)){e.next=43;break}if(l=(d=t).binary,h=d.msg,_=d.room,p=d.to,v=d.from,f=""===_?l?yV.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM:yV.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM:l?yV.USER_BINARY_MESSAGE_RECEIVED:yV.USER_MESSAGE_RECEIVED,p){e.next=27;break}if(e.t1=this,e.t2=yV.ON_CUSTOM_MESSAGE,e.t3=v,e.t4=l,!l){e.next=21;break}return e.next=18,vt.b64str2ab(h);case 18:e.t5=e.sent,e.next=22;break;case 21:e.t5=h;case 22:e.t6=e.t5,e.t7={clientId:e.t3,binary:e.t4,message:e.t6},e.t1.emit.call(e.t1,e.t2,e.t7),e.next=43;break;case 27:if(e.t8=this,e.t9=f,e.t10=dr,e.t11=dr({},t),e.t12={},!l){e.next=38;break}return e.next=35,vt.b64str2ab(h);case 35:e.t13=e.sent,e.next=39;break;case 38:e.t13=h;case 39:e.t14=e.t13,e.t15={msg:e.t14},e.t16=(0,e.t10)(e.t11,e.t12,e.t15),e.t8.emit.call(e.t8,e.t9,e.t16);case 43:return this._sendP2PMessage(dr(dr({},t),{},{dir:y7.FEEDBACK,msg:""})),pj.reportP2PMsgRecv(this.id,t,{msg_size:r,recv_msg_ts:n,fwd_msg_ts:u}),e.abrupt("break",49);case 46:return this._handleP2PMsgFeedback(t),e.abrupt("break",49);case 48:return e.abrupt("break",49);case 49:case"end":return e.stop()}},e,this)})),function(e,r,n){return t.apply(this,arguments)})},{key:"C2GW",value:function(e,t,r){if(1===e.direction){var n,i=(null===(n=e.id)||void 0===n?void 0:n.join("-"))||"";this._handleAckMessage(i,t[0]||{},r)}else{var o=u3(t,2),a=o[0],s=o[1],c=void 0===s?{}:s;if("RXMediaMsg"===a){var u,d=c.type,l=c.data;switch(null===(u=this._monitor)||void 0===u||u.report("rtc_signaling",{error_code:0,message:r,signaling_event:"on-".concat(d),signaling_type:"Recv",stream_id:"",stream_user_id:"",direction:"down"}),d){case"RSCP":try{var h=JSON.parse(l);Array.isArray(h)&&this.emit(d,h)}catch(e){}break;case"RTT":try{var _=JSON.parse(l);_.length&&this.emit(d,_[0])}catch(e){}break;case"SSC":try{var p=JSON.parse(l);p.length&&this.emit(d,p[0])}catch(e){}}}}}},{key:"_handleHandler",value:function(){var e=this,t=function(e){Sn.warn("_handleHandler","dataChannel close",e)},r=function(e){Sn.error("_handleHtion(t){e._handleMessage(t.data)};return this._dataChannel.addEventListener("close",t),this._dataChannel.addEventListener("error",r),this._dataChanremoveEventListener("message",n)}}},{key:"_genHeader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return dr({version:2,zip:!1,encrypt:!1,needAck:!0,direction:0,functionType:0,binary:!1},e)}},{key:"_handleAckMessage",value:function(e,t,r){var n,i,o=this._singlingCache.get(e);o&&(this._singlingCache.delete(e),200===t.code?o.success(t):o.error(t),Sn.info("Signal",a4(i="<<<<<< [".concat(o.signalingType,"-ack] ")).call(i,e),t)),null===(n=this._monitor)||void 0===n||n.report("rtc_signaling",{error_code:0,message:r,signaling_event:null==o?void 0:o.signalingType,signaling_type:"Ack",stream_id:"",stream_user_id:"",direction:"down"})}},{key:"_handleP2PMsgFeedback",value:function(e){var t=this._p2pCache.get(e.id);t&&(this._p2pCache.delete(e.id),e.err===Se.SUCCESS?t.success(e.id,e):t.error(e))}}]),a}(),Ss="object"==typeof window&&window&&window.Object===Object&&window,Sc="object"==typeof self&&self&&self.Object===Object&&self,Su=Ss||Sc||Function("return this")(),Sd=Su.Symbol,Sl=Object.prototype,Sh=Sl.hasOwnProperty,S_=Sl.toString,Sp=Sd?Sd.toStringTag:void 0,Sv=Object.prototype.toSurn null!=e&&"objection]"==t||"[object Proxy]"==t}var ST=Su["__core-js_shared__"],Sk=(Em=/[^.]+$/.exec(ST&&ST.keys&&ST.keys.IE_PROTO||""))?"Symbol(src)_1."+Em:{return e+""}catch(e){}}return""}var SA=/^\[object .+?Constructor\]$/,SC=Object.prototype,Sw=Function.prototype.toString,Sx=SC.hasOwnProperty,SO=RegExp("^"+Sw.call(Sx).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()E(r)?SO:SA).test(SR(r))?r:void 0}var SP=SN(w e;return e.prot;return nction(){return teturn SV.apply(void 0,a(e,t){return e===t||e!=e&&t!=t}var S,i?SG(r,s,c):Sn null!=e&&Sq(e.lengthe)&&"[object Arguments]"==Sm(e)}var S$=Object.prototype,S0=S$.hasOwnProperty,S1=S$.propertyIsEnumerable,S2=SZ(f,"callee")&&!S1.call(e,"callee")},S3="object"==typeof exports&&exports&&!exports.nodeType&&exports,S5=S3&&e&&!e.nodeType&&e,S4=S5&&S5.exports===S3?Su.Buffer:vfer:vo{return function(t){return e(t)}}S8["[object Float32Array]"]=S8["[object Float64Array]"]=S8["[object Int8Array]"]=S8["[object Int16Array]"]=S8["[object Int32Array]"]=S8["[object Uint8Array]"]=S8["[object Uint8ClampedArray]"]=S8["[object Uint16Array]"]=S8["[object Uint32Array]"]=!0,S8["[object Arguments]"]=S8["[object Array]"]=S8["[object ArrayBuffer]"]=S8["[object Boolean]"]=S8["[object DataView]"]=S8["[object Date]"]=S8["[object Error]"]=S8["[object Function]"]=S8["[object Map]"]=S8["[object Number]"]=S8["[object Object]"]=S8["[object RegExp]"]=S8["[object Set]"]=S8["[object String]"]=S8["[object WeakMap]"]=!1;var S9="object"==typeof exports&&exports&&!exports.nodeType&&exports,be=S9&&e&&!e.nodeType&&e,bt=bg&&bt.binding("util")}catch(e){}}(),bnSg(e)&&Sq(e.length)&&!!S8[Sm(e)]},burn function(r){return e(t(r))}}var bc=bs(Object.keys,Object),bctor"!=r&&t.push(r);return t}(e)}var bll(e,n))&&=(ES=functr a=t[r];a&&ES(e,a,r,i)}return e}}return e.apply(t,r)}(EE,this,i)}),Eb+"")),bp=SN(Object,"create"),bv=Object.prototype.hasOwnProperty,bf=Object.prototype.hasOwnProperty;function bm(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;SH(e[r][0],t))retuata__=bp?bp(null):{}a__[e];return thi}return bv.call(trn bp?void 0!==t[_lodash_hash_undefined__":t,this};var by=Array.prototype.splice;function bS(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.sn(){this.__data__=[]):by.call(t,r,1),g(t,e);return r<0e){return bg(thisze,r.push([e,t])):r[th;++r<n;)e[i+r]m,map:new(bb||bS),stete(e);return this.size-=t?1:0,t},bT.prototype.get=function(e){return bEtion(e){return bEt),this.size+=r.size==n?0:1,this};var bIata__=new bS(e);ththis.__data__=new bSete(e);return this.size=t.size,r},bR.prototype.get=function(e){return this.__data__.get(e)},bR.prototype.has=function(e){return this.r.set(e,t),this.size=r.size,this};var bA="object"==typeof exports&&exports&&!exports.nodeType&&exports,bC=bA&&e&&!e.nodeType&&e,bw=bC&&bC.exports===bA?Su.Buffer:vfe:void 0;function bO(){return[]}var bN=Object.prototype.propertyIsEnumerable,bP=Ounction(t){return bN.call(e,t)})}:b;e;n=t(e);return Sy(e)?n:bk(n,r(e))}var bU=SN(Su,"DataView"),bV=SN(Su,"Promise"),bF=SN(Su,"Set"),bB="[object Map]",bj="[object Promise]",bG="[object Set]",bH="[object WeakMap]",bz="[object DataView]",bK=SR(bU),bX=SR(bb),bW=SR(bV),bq=SR(bF),bY=SR(SP),bJ=Sm;(bU&&bJ(new bU(new ArrayBuffer(1)))!=bz||bb&&bJ(new bb)!=bB||bV&&bJ(bV.resolve())!=bj||bF&&bJ(new rn bG;case bY:return bH}return t});var bQ=bJ,bZ=Object.prototypeturn new b$(t).set(new b$(e)),t}var b1=/\w*$/,b2=Sd?Sd.prototype:void 0,b3=b2?b2.valueOf:void 0,b5=br&&br.isMap,b4=b5?S7(b5):function(e){return Sg(e)&&"[object Map]"==bQurn Sg(e)&&"[object Set]"==bQ(e)},b7="[object Arguments]",b9="[object Function]",Ee="[object Object]",Et={};function Er(e){return function e(t,r,n,i,o,a){var s,c=1&r,u=2&r,d=4&r;if(n&&(s=o?n(t,i,o,a):n(t)),void 0!==s)return s;if(!SS(t))return t;var l=Sy(t);if(l){if(h=t.length,_=new t.constructor(h),h&&"string"==typeof t[0]&&bZ.call(t,"index")&&(_.index=t.inday(n));++r<n;)t[r]=e[r];return t}(t,s)}else{var h,_,p,v,f,m,g=bQ(t),y=g==b9||"[object Generonstructor(r);return e.copy(n),n}(t,c);if(g==Ee||g==b7||y&&!o){if(s=u||y?{}:"function"!=typeof t.constructor||SQ(t)?{}:SM(bI(t)),!c)return u?(v=(p=s)&&SX(t,bh(t),p),SX(t,bM(t),v)):(m=(f=s)&&SX(t,bd(t),f),SX(t,bD(t),m))}else{if(!Et[g])return o?t:{};s=function(e,t,r){var n,i,o,a=e.constructor;switch(t){case"[object ArrayBuffer]":return b0(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return n=r?b0(e.buffer):e.buffer,new e.constructor(n,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return i=r?b0(e.buffer):e.buffer,new e.constructor(i,e.byteOffset,e.length);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return(o=new e.constructor(e.source,b1.exec(e))).lastIndex=e.lastIndex,o;case"[object Symbol]":return b3?Object(b3.call(e)):{}}}(t,g,c)}}a||(a=new bR);var S=a.get(t);if(S)reunction(i){s.add(eion(i,o){s.set(o,e(i,r,n,o,t,a))});var b=l?void 0:(d?}:function(e){returengthi=t[o=i]),SK(s,o,e(i,r,n,o,t,a))}),s}(e,5)++r<n;)i[r]=t(e[r],r,e);return i}(bd(e),function(t){return e[t]})}Et[b7]=Et["[object Array]"]=Et["[object ArrayBuffer]"]=Et["[object DataView]"]=Et["[object Boolean]"]=Et["[object Date]"]=Et["[object Float32Array]"]=Et["[object Float64Array]"]=Et["[object Int8Array]"]=Et["[object Int16Array]"]=Et["[object Int32Array]"]=Et["[object Map]"]=Et["[object Number]"]=Et[Ee]=Et["[object RegExp]"]=Et["[object Set]"]=Et["[object String]"]=Et["[object Symbol]"]=Et["[object Uint8Array]"]=Et["[object Uint8ClampedArray]"]=Et["[object Uint16Array]"]=Et["[object Uint32Array]"]=!0,Et["[object Error]"]=Et[b9]=Et["[object WeakMap]"]=!1;var Ei=new h1("ConnectionManager",3),Eo=function(e){dy(o,fR);var t,r,n,i=dC(o);function o(e){var t;return iE(this,o),iT(dn(t=i.call(this)),"id",void 0),iT(dn(t),"_monitor",void 0),iT(dn(t),"_getAccessManager",void 0),iT(dn(t),"_connectionPool",new sF),iT(dn(t),"_curConnection",void 0),iT(dn(t),"_hasReportBrowerWarning",!1),iT(dn(t),"_reconnectTimer",void 0),iT(dn(t),"_connecting",!1),iT(dn(t),"_isFirstTimeConnected",!0),iT(dn(t),"_feedbackNodes",[]),iT(dn(t),"_preIceStartTime",-1),iT(dn(t),"_tcpOnlyTimer",void 0),iT(dn(t),"_destroyed",!1),t._ctx=e,Ei.info("constructor","invoke"),t.id=e.id,t._monitor=pZ(t.id),t._getAccessManager=new y3(e),t}return ib(o,[{key:"connect",value:function(){var e=this;Ei.info("connect","invoke");try{y8.checkSupported()}catch(e){this.safeEmit("disconnected",e)}this._connecting||(this._onConnectStart("init"),aj.resolve().then(function(){return e.emit("__onGetIceConfigHook")}),this._getAccess())}},{key:"reconnectByNodeChange",value:(n=a2(a0().mark(function e(t){var r,n,i,o,a,s;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Ei.info("reconnectByNodeChange","invoke %o",t),o=t.nodes,a=t.reason,null===(r=this._monitor)||void 0===r||r.report("rtc_node_change",{error_code:0,message:a6(t),reason:a6(a)}),v4.clearAccessNode(this._ctx.appId),s=(null===(n=this._curConnection)||void 0===n||null===(i=n.node.publicIPs[0])||void 0===i?void 0:i.ip)||"",this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart("node change"),Array.isArray(o)&&o.length>0?this._startIceConnect(o):this._getAccess([{feedbackIP:s,feedbackReason:{type:"NODE_CHANGED",reason:a}}]);case 10:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"reconnect",value:(r=a2(a0().mark(function e(t){var r,n=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.length>1&&void 0!==n[1]&&n[1],Ei.info("reconnect","invoke. ".concat(r?"ICE over TCP":"")),this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart(t),this._getAccess(void 0,r);case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){Ei.info("destroy","invoke"),this._destroyed=!0,this.safeEmit("disconnected",new lM(le.OPERATION_CANCEL,"destroy")),dm(df(o.prototype),"removeAllListeners",this).call(this),this._clearReconnectTimer(),this._clearConnectionPool(),this._getAccessManager.destroy(),this._closeCurrentConnection()}},{key:"_getAccess",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._geHook",e),t._startIceConnect(e,r)}).catch(function(e){t.safeEmit("disconnected",e)}).finally(function(){t._feedbackNodes=[]})}},{key:"_startIceConnect",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._destroyed){Ei.info("_startIceConnect","invoke");var n,i=hF();this._preIceStartTime=p9();var o=this._ctx.joinRoomConfig.useTcpJoin,a=this._ctx.joinRoomConfig.useTcpJoinDelay,s=(n=a2(a0().mark(function e(n){var o,a,s,c;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r&&((n=Er(n)).iceConfig.tcpOnly=!0),o={node:n},e.prev=2,a=new y8(t._ctx,i),o.pc=a,t._connectionPool.set(a.uuid,o),e.next=8,a.connect(n);case 8:return s=e.sent,c=new Sa(t.id,s),o.signaling=c,e.next=13,c.sendPingSignaling();case 13:t._onConnectSuccess({node:n,pc:a,signaling:c,dc:s}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),t._onConnectionFailed(o,e.t0);case 19:case"end":return e.stop()}},e,null,[[2,16]])})),function(e){return n.apply(this,arguments)});this.emit("__onIceConnectStartHook"),e.forEach(s),o&&!r&&(Ei.info("_startIceConnect","tcp-only will try after ".concat(a,"ms")),this._tcpOnlyTimer=window.setTimeout(function(){t.emit("connectWidthTcp"),e.forEach(function(e){(e=Er(e)).iceConfig.tcpOnly=!0,s(e)}),delete t._tcpOnlyTimer},a))}}},{key:"_onConnectSuccess",value:function(e){var t,r,n,i=this;(Ei.info("connect","peer_%s connect success.",e.pc.uuid),this.emit("__onIceConnectSuccessHook",e),this._curConnection)?(e.pc.destroy(),null===(t=e.signaling)||void 0===t||t.destroy(),this._connectionPool.delete(e.pc.uuid)):(this._curConnection=e,this._addConnectionHandler(e.pc,e.dc),null===(r=this._monitor)||void 0===r||r.set({connection_id:e.pc.getConnectionId(),rtc_vid:(null===(n=e.node.iceConfig)||void 0===n?void 0:n._abtest_vid)||""}),this._connectionPool.delete(e.pc.uuid),this._feedbackNodes.forEach(function(e){return i._feedbackBySignaling(e)}),this._feedbackNodes=[],this._onConnectEnded(e))}},{key:"_onConnectionFailed",value:function(e,t){var r,n,i=this;Ei.info("connect","peer_%s connect failed. %s",(null===(r=e.pc)||void 0===r?void 0:r.uuid)||"",t.message),this.emit("__onIceConnectFailedHook",e),t.code!==y4.DESTROY&&t.code!==le.OPERATION_CANCEL&&(this._curConnection?this._feedbackBySignaling(e.node):this._feedbackNodes.push(e.node),Ei.info("connect","remove cache node"),v4.deleteAccessNode(this._ctx.appId,e.node),e.pc&&(this._connectionPool.delete(e.pc.uuid),e.pc.destroy()),null===(n=e.signaling)||void 0===n||n.destroy()),0!==this._connectionPool.size||this._curConnection||this._destroyed||(Ei.error("connect","establish peerConnection failed"),this._checkBrowserUA(),p9()-this._preIceStartTime<1e3?(this._clearReconnectTimer(),this._reconnectTimer=window.setTimeout(function(){delete i._reconnectTimer,i._reconnectWithIceFailed(i._feedbackNodes)},1e3)):this._reconnectWithIceFailed(this._feedbackNodes))}},{key:"_feedbackBySignaling",value:function(e){var t;null===(t=this._curConnection)||void 0===t||t.signaling.sendSignaling("scheduleMessage",{type:"feedback",body:{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}})}},{key:"_reconnectWithIceFailed",value:(t=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._onConnectStart("ice failed"),Ei.warn("reconnect","because of ice failed"),this._getAccess(se(t).call(t,function(e){return{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}}));case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_checkBrowserUA",value:function(){var e;!this._hasReportBrowerWarning&&this._ctx.joinRoomConfig.isBlackBrower()&&(this._hasReportBrowerWarning=!0,null===(e=this._monitor)||void 0===e||e.report("rtc_error",{error_code:y$.BLACK_BROWSER,message:"failed to establish data-channel, and the current browser is on the browser blacklist."}))}},{key:"_onConnectStart",value:function(e){Ei.info("_onConnectStart","invoke, reason: ".concat(e)),this._connecting=!0,this.safeEmit(this._isFirstTimeConnected?"connecting":"reconnecting");var t,r,n=hF();null===(t=this._monitor)||void 0===t||t.set({connect_session_id:n}),this._isFirstTimeConnected||null===(r=this._monitor)||void 0===r||r.report("rtc_reconnect",{error_code:1002,message:"peerconnection reconnecting",reconnect_id:n,reconnect_type:"peerconnection"},{reason:e})}},{key:"_onConnectEnded",value:function(e){var t;Ei.info("_onConnectEnded","invoke"),this._connecting=!1,this._isFirstTimeConnected=!1,this.safeEmit("connected",e),this._isFirstTimeConnected||null===(t=this._monitor)||void 0===t||t.report("rtc_reconnected",{message:"peerconnection reconnected",reconnect_type:"peerconnection"}),e.node.iceConfig.tcpOnly&&(Ei.info("_onConnectEnded","use tcp only"),p3(this._ctx.id,"connected_with_tcp_only",a6(e.node))),this._tcpOnlyTimer&&(window.clearTimeout(this._tcpOnlyTimer),delete this._tcpOnlyTimer),this._clearConnectionPool()}},{key:"_addConnectionHandler",value:function(e,t){var r=this;e.on("disconnect",function(e){r._closeCurrentConnection(),r._clearReconnectTimer(),navigator.onLine?r.reconnect(e):r._reconnectTimer=window.setTimeout(function(){return r.reconnect(e)},3e3)})}},{key:"_closeCurrentConnection",value:function(){var e,t;null===(e=this._curConnection)||void 0===e||e.pc.destroy(),null===(t=this._curConnection)||void 0===t||t.signaling.destroy(),delete this._curConnection}},{key:"_clearConnectionPool",value:function(){var e=this;this._connectionPool.forEach(function(t,r){var n,i;null===(n=t.pc)||void 0===n||n.destroy(),null===(i=t.signaling)||void 0===i||i.destroy(),e._connectionPool.delete(r)})}},{key:"_clearReconnectTimer",value:function(){this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer)}}]),o}(),Ea=function(e,t,r,n){for(var i,o=n>1?void 0:n?cq(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&to(t,r,o),o},Es=new h1("MediaServerClient",2),Ec=((Ek=Ec||{}).DISCONNECTED="disconnected",Ek.DISCONNECTING="disconnecting",Ek.CONNECTED="connected",Ek.CONNECTING="connecting",Ek),Eu=function(e,t){Es.info(e,"userId: %o, subAudio: %o, subVideo: %o, audioMid: %o, videoMid: %o, sequenceId: %o",t.userId,t.subAudio,t.subVideo,t.audioMid,t.videoMid,t.sequenceId)},Ed=function(e){dy(k,fR);var t,r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T=dC(k);function k(e){var t;return iE(this,k),iT(dn(t=T.call(this)),"id",void 0),iT(dn(t),"_token",void 0),iT(dn(t),"_roomId",void 0),iT(dn(t),"_roomAttributes",void 0),iT(dn(t),"_vendorConfig",{enableMultiVendor:!1,vendorCode:0}),iT(dn(t),"_clientId",void 0),iT(dn(t),"_businessId",void 0),iT(dn(t),"_userInfo",void 0),iT(dn(t),"_authorization",void 0),iT(dn(t),"_sessionId",""),iT(dn(t),"_liveControlMessage",void 0),iT(dn(t),"isReconnecting",!1),iT(dn(t),"_ontrackCallbackMap",new sF),iT(dn(t),"_subResolves",{}),iT(dn(t),"supportConcurrent",!1),iT(dn(t),"_handler",void 0),iT(dn(t),"_pubSubLock",void 0),iT(dn(t),"_joinLeaveLock",void 0),iT(dn(t),"_state",void 0),iT(dn(t),"_dataChannelSignal",void 0),iT(dn(t),"_joinRoomStartTs",void 0),iT(dn(t),"_subConfig",{}),iT(dn(t),"_monitor",void 0),iT(dn(t),"_roomProfile",lk.communication),iT(dn(t),"_context",void 0),iT(dn(t),"_subStreamQueue",{}),iT(dn(t),"_connectionManager",void 0),iT(dn(t),"_joinRoom5xxTimer",void 0),iT(dn(t),"_joinResolve",void 0),iT(dn(t),"_joinReject",void 0),Es.info("constructor","invoke"),t.id=e.id,t._monitor=pZ(t.id),t._pubSubLock=new yK("pubSubLock"),t._joinLeaveLock=new yK("joinLeaveLock"),t._state="disconnected",t._roomAttributes={multiChatMode:!1,bigRoomMode:!1},t._context=e,t.on("SUB_END",function(e){return t._handleSubStreamQueue(e)}),t._connectionManager=new Eo(e),t._addConnectHandler(),t}return ib(k,[{key:"_addSignalEventHandler",value:function(){var e,t,r=this;[yV.ON_ADD_STREAM,yV.ON_ADD_STREAM_LIST,yV.ON_REMOVE_STREAM,yV.ON_REMOVE_STREAM_LIST,yV.USER_CONNECTION,yV.USER_CONNECTION_LIST,yV.USER_DISCONNECTION,yV.USER_DISCONNECTION_LIST,yV.ON_UPDATE_STREAM_ATTRIBUTES,yV.ON_UPDATE_ROOM_ATTRIBUTES,yV.ON_PUSH_TRACK,yV.ON_REMOVE_TRACK,yV.ON_CUSTOM_MESSAGE,yV.USER_MESSAGE_RECEIVED,yV.USER_BINARY_MESSAGE_RECEIVED,yV.POST_PROCESSING_MESSAGE,yV.ON_USER_TOKEN_WILL_EXPIRE,yV.STREAM_CONTROL_MESSAGE,yV.ON_UPDATE_USER_ATTRIBUTES,yV.ON_SPEAKER_CHANGE,yF.RSCP,yF.RTT,yV.ON_STREAM_FAILED,yV.ON_NOTIFY_RECONNECT,yF.SSC,yV.ON_FORWARD_DST_ROOM_USER_KICK].forEach(function(e){var t;null===(t=r._dataCon(e,function(t){r.safeEmit(e,t)})}),null===(e=this._dataChannelSignal)||void 0===e||e.on(yV.NODE_CHANGE,function(e){r._connectionManager.reconnectByNodeChange(e)}),null===(t=this._dataChannelSignal)||void 0recv notifyReconnect signaling")})}},{key:id 0===t||t.removeAllListeners()}},{key:"connectionState",get:function(){return this._state},set:function(e){this._state!==e&&(this.safeEmit(yB.ON_CONNECTION_STATE_CHANGE,{prev:this._state,next:e}),this._state=e)}},{key:"businessId",set:function(e){this._businessId=e}},{key:"setLiveControlMessage",value:function(e){this._liveControlMessage=e}},{key:"connect",value:function(){var e=this;return new aj(function(t,r){e._connectionManager.once("connected",function(){return t()}),e._connectionManager.once("disconnected",r),e._connectionManager.connect()})}},{key:"join",value:(E=a2(a0().mark(function e(t){var r,n=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Es.info("join()","info: %o",t),this._token=t.token,this._roomId=t.roomId,this._clientId=t.userInfo.userId,this._businessId=t.userInfo.businessId,this._userInfo=t.userInfo,this._roomProfile=t.roomProfile,this._reportJoinRoomStart(),e.next=10,new aj(function(e,t){n._joinResolve=e,n._joinReject=t,(n._handler?aj.resolve():n.connect()).then(function(){n._callJoinRoom()}).catch(function(e){var t=Array.isArray(e)&&e.length>0?e[0]:e;n._joinRoomFailed(t.message)})});case 10:return r=e.sent,e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"_callJoinRoom",value:(b=a2(a0().mark(function e(){var t,r,n,i,o,a,s,c,u,d,l,h,_,p,v,f=this,m=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=m.length>0&&void 0!==m[0]&&m[0],Es.info("_callJoinRoom","invoke"),e.t0=vt.token2auth(this._context.appId,this._roomId,this._clientId,this._token),e.t1=this._sessionId,e.t2=Date.now(),e.t3=this._liveControlMessage,e.t4={extra_info:this._userInfo.extraInfo,role:this._userInfo.role},e.next=9,null===(t=this._handler)||void 0===t?void 0:t.getDefaultSdp();case 9:return e.t5=e.sent,e.next=12,fL(fn("PUB_SUB_MODE"));case 12:return e.t6=e.sent,e.t7=window.navigator.userAgent,e.t8=ft.VERSION,e.t9=v4.getDeviceId(),e.t10=this._context.appId,e.t11=this._roomId,e.t12=this._clientId,e.t13=this._businessId,e.t14=this._context.useCloudProxy,e.t15=yJ[this._roomProfile]?"".concat(yJ[this._roomProfile][0]):"0",e.t16={supportedCodecs:e.t6,deviceType:"web",userAgent:e.t7,sdkVersion:e.t8,deviceId:e.t9,appId:e.t10,roomId:e.t11,userId:e.t12,businessId:e.t13,enableCloudProxy:e.t14,channelProfile:e.t15},e.t17={supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0,enableAudioMux:!0,enableBigRoomMode:!0,needNegotiateSDP:!0,supportMultiVendor:!0},n={Authorization:e.t0,sessionId:e.t1,timestamp:e.t2,controlMessage:e.t3,userAttributes:e.t4,sdpInfo:e.t5,params:e.t16,options:e.t17},e.prev=25,e.t18=p3,e.t19=this.id,e.t20=a6,e.next=31,fU();case 31:e.t21=e.sent,e.t22=fn("PUB_SUB_MODE")||"recv_and_send",e.t23={supportedCodecsSdpOffer:e.t21,pubSubMode:e.t22},e.t24=(0,e.t20)(e.t23),(0,e.t18)(e.t19,"MediaClient.internalGetSupportedCodecsSdpOffer",e.t24),e.next=40;break;case 38:e.prev=38,e.t25=e.catch(25)emit("onSendingJoinMessageHook")}),e.prev=41,o=r?"reconnected":"joinRoom",e.next=45,this._joinRoomWithRetry(o,n);case 45:a=e.sent,Es.success("join","send join message success"),s=(a.config||{}).engine_WEB,this.connectionState="connected",this._authorization=n.Authorization,v4.setEngineWebConfig(this._context.appId,this._roomId,s),this._context&&(this._context.serverConfig={videoCodec:(null==s?void 0:s.video_codec)||"H264",audioRed:!(null==s||!s.pub_audio_red),muteReplaceUnsub:!(null===(c=a.config)||void 0===c||!c.mute_replace_unsub),simulcastOnDemand:!(vw||!1===(null===(u=a.config)||void 0===u||null===(d=u.engine_VPM)||void 0===d||null===(l=d.ondemand)||void 0===l?void 0:l.enable)),forceUniHandler:1===(null==a||null===(h=a.config)||void 0===h||null===(_=h.vendor_param)||void 0===_?void 0:_.vendor_stream_sub_mode)},"boolean"==typeof(null==s?void 0:s.av_sync)&&(this._context.avSync=s.av_sync)),a.vendorConfig&&(this._vendorConfig=a.vendorConfig),g3.audioStallConfig=s,null!=a&&null!==(i=a.relayMessage)&&void 0!==i&&i.sdp&&(null===(p=this._handler)||void 0===p||p.createAVMlineAnswerTpl(a.relayMessage.sdp)),this.emit("joinSuccess",{joinRes:a,reconnect:r}),this._joinRoomSuccess(a),e.next=62;break;case 59:e.prev=59,e.t26=e.catch(41),(null===e.t26||void 0===e.t26?void 0:e.t26.code)>=700&&(null===e.t26||void 0===e.t26?void 0:e.t26.code)<800?this._joinRoomFailed("token_error",le.INVALID_TOKEN):(null===e.t26||void 0===e.t26?void 0:e.t26.code)===le.TIME_OUT&&this._context.joinRoomConfig.useTcpAfterJoinTimeout?(v="joinRoom timeout, retry with tcp only",Es.error("join",v),this.safeEmit(yX.ON_REJOIN_WITH_TCP),this._connectionManager.reconnect(v,!0)):e.t26.code===le.OPERATION_CANCEL&&"connecting"===this.connectionState||this._joinRoomFailed((null===e.t26||void 0===e.t26?void 0:e.t26.message)||"signaling_error");case 62:case"end":return e.stop()}},e,this,[[25,38],[41,59]])})),function(){return b.apply(this,arguments)})},{key:"publish",value:(S=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,N,P,D=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Es.info("publish()","localStream: %o",t),r=t.videoTrack,n=t.audioTrack,i=p9(),o="",a="",s=this._handler,e.prev=7,!this._vendorConfig.enableMultiVendor){e.next=20;break}return T=new y8(this._context,""),t.vendorHandler=new yZ(this._context,T),t.pcSessionId&&(t.vendorHandler.peerConnectionId=t.pcSessionId),e.next=14,t.vendorHandler.publish(t);case 14:E=e.sent,(s=t.vendorHandler).on("ice_state",function(e){D.emit(yB.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:lp.CONNECTION_STATE_CONNECTING,connected:lp.CONNECTION_STATE_CONNECTED,disconnected:lp.CONNECTION_STATE_RECONNECTING}[e],userId:D._clientId})}),T.once("disconnect",a2(a0().mark(function e(){var r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=s)||void 0===r||r.removeAllListeners(),"connected"===(null===(n=D._handler)||void 0===n||null===(i=n.pc)||void 0===i?void 0:i.iceConnectionState)){e.next=4;break}return Es.error("vendor ice failed",t.streamId),e.abrupt("return");case 4:t.clean(),D.unpublish(t),D.publish(t);case 7:case"end":return e.stop()}},e)}))),e.next=23;break;case 20:return e.next=22,null===(k=this._handler)||void 0===k?void 0:k.publish(t);case 22:E=e.sent;case 23:if(null===(c=t.observer)||void 0===c||c.setHandler(s),E){e.next=26;break}throw new lM(le.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 26:if("H264"!==(null===(u=this._context)||void 0===u||null===(d=u.serverConfig)||void 0===d?void 0:d.videoCodec)){e.next=32;break}return e.next=29,fK();case 29:if(e.sent){e.next=32;break}throw new lM(le.PUBLISH_FAILED,"h264 is not supported");case 32:return o=E.audioMid,a=E.videoMid,t.pubAttributes={localaudio:!!n,localvideo:!!r,videostream:t.pubVideo,audiostream:t.pubAudio,extvideo:r instanceof gk,extaudio:n instanceof gI},I={attributes:dr({videoDescriptions:E.videoDescriptions},t.pubAttributes),audio:!0,video:!0,screen:t.isScreen,audioMid:o,videoMid:a,sdpInfo:{msid:t.stream.id,type:E.type,sdp:E.partialSdp,semantics:E.semantics},peerConnectionMode:null===(l=E)||void 0===l?void 0:l.peerConnectionMode,supportMultiVendor:!0},(R=!this._vendorConfig.enableMultiVendor&&t.enableSimulcast&&(null===(h=this._context)||void 0===h||null===(_=h.serverConfig)||void 0===_?void 0:_.simulcastOnDemand)&&(null===(p=E.subVideoDescriptions)||void 0===p?void 0:p.length))&&(I.attributes.subVideoDescriptions=E.subVideoDescriptions),null!==(v=E)&&void 0!==v&&v.peerConnectionId&&(I.peerConnectionId=E.peerConnectionId),e.next=41,null===(f=this._dataChannelSignal)||void 0===f?void 0:f.sendSignaling("publish",I);case 41:if(200===(null==(A=e.sent)?void 0:A.code)){e.next=44;break}throw new lM(le.PUBLISH_FAILED,(null==A?void 0:A.message)||"publish failed");case 44:if(null===(m=this._monitor)||void 0===m||m.report("rtc_recv_answer",{error_code:0,answer_type:null==A?void 0:A.relayMessage.type,sequence_id:(null==A||null===(g=A.relayMessage)||void 0===g?void 0:g.sequenceId)||0,message:null==A||null===(y=A.relayMessage)||void 0===y?void 0:y.sdp,direction:"up",stream_id:"",stream_user_id:"",pc_session_id:(null===(S=s)||void 0===S?void 0:S.peerConnectionId)||""}),C=new aj(function(e,r){var n,i,c,u,d,l;null===(n=s)||void 0===n||n.handleAck({action:yR.publish,streamId:A.streamId,audioMid:o,videoMid:a,audioTransceiverInit:null===(i=E)||void 0===i?void 0:i.audioTransceiverInit,videoTransceiverInit:null===(c=E)||void 0===c?void 0:c.videoTransceiverInit,signalingAck:{sdp:null==A||null===(u=A.relayMessage)||void 0===u?void 0:u.sdp,sequenceId:null==A||null===(d=A.relayMessage)||void 0===d?void 0:d.sequenceId},sdp:null===(l=E)||void 0===l?void 0:l.sdp,stream:t,onSuccess:function(){Es.info("publish()","publish success"),e(0)}})}),e.t0=!vw,!e.t0){e.next=50;break}return e.next=50,C;case 50:return R&&this.emit(yF.RSCP,[{StreamIds:[t.stream.id],Metadata:{VideoIndex:0}}],!0),t.streamId=A.streamId,t.videoMid=a,t.audioMid=o,t.subVideoDescriptions=E.subVideoDescriptions,null===(b=this._monitor)||void 0===b||b.report("rtc_publish_stat",{result:"success",is_screen:"0",start:i,message:"unknown"}),e.abrupt("return");case 59:return e.prev=59,e.t1=e.catch(7),e.t1 instanceof Error?null===(x=this._monitor)||void 0===x||x.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:i,message:a4(O="".concat(e.t1.name,": ")).call(O,e.t1.message)}):e.t1 instanceof lM&&(null===(N=this._monitor)||void 0===N||N.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:i,message:a4(P="".concat(e.t1.code,": ")).call(P,e.t1.message)})),e.next=64,null===(w=s)||void 0===w?void 0:w.rollback(t.stream.id,t);case 64:throw e.t1;case 65:case"end":return e.stop()}},e,this,[[7,59]])})),function(e){return S.apply(this,arguments)})},{key:"updatePubTrack",value:(y=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Es.info("updatePubTrack()","localStream: %o",t),n=t.videoTrack,i=t.audioTrack,o=t.pubAudio,a=t.pubVideo,s=t.vendorHandler||this.handler,c=null==i?void 0:i.getTrack("preprocessing"),u=null==n?void 0:n.getTrack("preprocessing"),!a||!u){e.next=10;break}return e.next=8,null===(d=t.videoTransceiver)||void 0===d?void 0:d.sender.replaceTrack(u);case 8:e.next=12;break;case 10:return e.next=12,null===(l=t.videoTransceiver)||void 0===l?void 0:l.sender.replaceTrack(null);case 12:if(null==s||s.updateMaxBitrate(t),!o||!c){e.next=20;break}return _=i.mixType,(p=i.mixedAudioTrack)&&_!==f4.PLAYOUT&&c.enabled&&(c=p),e.next=18,null===(h=t.audioTransceiver)||void 0===h?void 0:h.sender.replaceTrack(c);case 18:e.next=23;break;case 20:return e.next=22,null===(v=t.audioTransceiver)||void 0===v?void 0:v.sender.replaceTrack(null);case 22:p3(this.id,"MediaClient.updatePubTrack(audio)","null");case 23:try{p3(this.id,"MediaClient.updatePubTrack",a6({audioStreamTrack:vl(c),videoStreamTrack:vl(u)}))}catch(e){}for(m={},g=0,y=lB(f={localaudio:!!i,localvideo:!!n,videostream:a,audiostream:o,extvideo:n instanceof gk,extaudio:i instanceof gI});g<y.length;g++)b=(S=u3(y[g],2))[0],(E=S[1])!==da(t.pubAttributes,b)&&fA(m,b,E);if(sJ(m).length){e.next=29;break}return e.abrupt("return");case 29:return t.observer&&(T=t.observer,k=m.audiostream,I=m.videostream,R=m.localaudio,A=m.localvideo,C=m.extaudio,w=m.extvideo,void 0!==A?void 0!==w?T.setPushVideo(w):T.setEnableVideo(A):void 0!==I&&T.setUnmuteVideo(I),void 0!==R?void 0!==C?T.setPushAudio(C):T.setEnableAudio(R):void 0!==k&&T.setUnmuteAudio(k)),t.pubAttributes=f,x={roomId:this._roomId,streamId:t.streamId,attributes:m},e.next=34,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("updateStreamAttributes",x);case 34:if(200===(null==(O=e.sent)?void 0:O.code)){e.next=37;break}throw new lM(le.UPDATE_TRACK_FAILED,(null==O?void 0:O.message)||"update track failed");case 37:if(!vw){e.next=40;break}return e.next=40,null==s?void 0:s.setCurrentDescription();case 40:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"updateToken",value:(g=a2(a0().mark(function e(t){var r,n,i,o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Es.info("updateToken()","newToken: %o",t),this._token=t,this._context.appId&&null!==(r=this._userInfo)&&void 0!==r&&r.userId&&this._roomId){e.next=4;break}return e.abrupt("return");case 4:return i={roomId:this._roomId,userId:null===(n=this._userInfo)||void 0===n?void 0:n.userId,appId:this._context.appId,token:"Bearer ".concat(t)},e.prev=5,e.next=8,null===(o=this._dataChannelSignal)||void 0===o?void 0:o.sendSignaling("updateToken",i);case 8:if(200===(null==(a=e.sent)?void 0:a.code)){e.next=11;break}throw new lM(le.UPDATE_TOKEN_WITH_INVALID_TOKEN,"invoke updateToken with an invalid token");case 11:e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(5),new lM(le.UPDATE_TOKEN_WITH_INVALID_TOKEN,"invoke updateToken with an invalid token");case 16:case"end":return e.stop()}},e,this,[[5,13]])})),function(e){return g.apply(this,arguments)})},{key:"unpublish",value:(m=a2(a0().mark(function e(t){var r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Es.info("unpublish()","localStream: %o",t),n={roomId:this._roomId,initStreamId:t.initStreamId,streamId:t.streamId},null===(r=this._dataChannelSignal)||void 0===r||r.sendSignaling("unpublish",n),i=t.vendorHandler||this._handler,e.next=6,null==i?void 0:i.handleAck({action:yR.unpublish,audioMid:t.audioMid,videoMid:t.videoMid,stream:t,streamId:t.streamId});case 6:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"subscribe",value:(f=a2(a0().mark(function e(t,r,n){var i=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new aj(function(){var e=a2(a0().mark(function e(o,a){var s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,N,P,D,M,L,U,V,F,B,j,G,H,z,K,X,W,q,Y,J,Q,Z,$;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.streamState!==yb.SUB_ED){e.next=2;break}return e.abrupt("return",i._updateSubTrack(t,r,yY.SUB).then(o,a));case 2:if(t.streamState!==yb.SUB_ING){e.next=7;break}return i._subStreamQueue[t.streamId]||(i._subStreamQueue[t.streamId]=[]),Es.info("_subStreamQueue","streamId: %o, enqueue",t.streamId),i._subStreamQueue[t.streamId].push({fn:i.subscribe,args:[t,r,n],resolve:o,reject:a}),e.abrupt("return");case 7:if(Es.info("subscribe()","mediaType: %o",r),Eu("subscribe()",t),t.streamState=yb.SUB_ING,c=!1,u=!1,vc(r)&&(u=!0),vu(r)&&(c=!0),c||!i.multiChatMode()){e.next=17;break}return t.streamState=yb.INIT,i.emit("SUB_END",t.streamId),e.abrupt("return",o(null));case 17:if(d=p9(),l=t.subVideo,h=[],_=!i.multiChatMode(),i._subResolves[t.streamId]||(i._subResolves[t.streamId]=[]),h.push(new aj(function(e,r){i._subResolves[t.streamId].push(e);var n=setTimeout(function(){return r(new lM(le.TIME_OUT,"wait video timeout for userId: ".concat(t.userId)))},6e4);t.on("ontrack",function r(i){"video"===i.mediaType&&(Es.success("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(n),e(0))})})),_&&h.push(new aj(function(e,r){i._subResolves[t.streamId].push(e);var n=setTimeout(function(){return r(new lM(le.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))},6e4);t.on("ontrack",function r(i){"audio"===i.mediaType&&(Es.success("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))})})),p=function(e){t.ontrack(e)},null===(s=i._handler)||void 0===s||s.on("ontrack",p),i._ontrackCallbackMap.set(t,p),v=i._handler,e.prev=28,null!==(f=i._context.serverConfig)&&void 0!==f&&f.forceUniHandler||!t.enableVendorMode){e.next=42;break}return V=new y8(i._context,""),t.vendorHandler=new yZ(i._context,V),t.pcSessionId&&(t.vendorHandler.peerConnectionId=t.pcSessionId),(v=t.vendorHandler).on("ontrack",p),e.next=37,t.vendorHandler.subscribe(t);case 37:U=e.sent,v.on("ice_state",function(e){i.emit(yB.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:lp.CONNECTION_STATE_CONNECTING,connected:lp.CONNECTION_STATE_CONNECTED,disconnected:lp.CONNECTION_STATE_RECONNECTING}[e],userId:t.userId})}),V.once("disconnect",a2(a0().mark(function e(){var r,n,o;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=v)||void 0===r||r.removeAllListeners(),"connected"===(null===(n=i._handler)||void 0===n||null===(o=n.pc)||void 0===o?void 0:o.iceConnectionState)){e.next=4;break}return Es.error("vendor ice failed",t.streamId),e.abrupt("return");case 4:return t.resetHasSubscribed(),i.unsubscribe(t,lh.AUDIO_AND_VIDEO,!0),e.next=8,i.subscribe(t,t.subMediaType);case 8:i.emit(yX.RESUBSCRIBE,{stream:t});case 9:case"end":return e.stop()}},e)}))),e.next=45;break;case 42:return e.next=44,null===(F=i._handler)||void 0===F?void 0:F.subscribe(t,{multiChatMode:i.multiChatMode()});case 44:U=e.sent;case 45:if(null===(m=t.observer)||void 0===m||m.setHandler(v),U){e.next=48;break}throw new lM(le.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 48:return B=U.audioMid,j=U.videoMid,t.subVideo=c,G={spatialLayer:(null==n?void 0:n.spatialLayer)||0,temporalLayer:0,spatialSubLayer:(null==n?void 0:n.spatialSubLayer)||-1},H={audio:!i.multiChatMode(),video:!0,data:!0,screen:t.isScreen,browser:"chrome-stable",videoMid:j,audioMid:B,sdpInfo:{sdp:null===(g=U)||void 0===g?void 0:g.partialSdp,semantics:null===(y=U)||void 0===y?void 0:y.semantics,type:null===(S=U)||void 0===S?void 0:S.type},streamUserId:t.userId,streamId:t.streamId,config:{enableMediaType:{audio:!!i.multiChatMode()||u,video:c},qualityLayer:G},extra:{enableSendRTT:!0},peerConnectionMode:null===(b=U)||void 0===b?void 0:b.peerConnectionMode,supportMultiVendor:!0},null!==(E=U)&&void 0!==E&&E.peerConnectionId&&(H.peerConnectionId=U.peerConnectionId),K=(z=i._context||{}).subscribeFallbackOption,X=z.userPriority,"number"==typeof K&&(H.config.fallbackOption=K),X.has(t.userId)&&(H.config.priority=X.get(t.userId)),null!==(T=U)&&void 0!==T&&T.allSsrc&&(H.extra.subscribeSSRC=U.allSsrc),e.next=60,null===(k=i._dataChannelSignal)||void 0===k?void 0:k.sendSignaling("subscribe",H);case 60:if(200===(null==(W=e.sent)?void 0:W.code)){e.next=63;break}throw new lM(le.SUBSCRIBE_FAILED,(null==W?void 0:W.message)||"subscribe failed");case 63:return Y=(q=null==W?void 0:W.relayMessage).audioMid,J=q.videoMid,iT(I={},B,Y),iT(I,j,J),Q=I,Es.info("sub midmap",t.userId,Q),t.videoMid=j,t.audioMid=B,t.subMediaType=r,t.streamState=yb.SUB_ED,t.subLayer=G,null===(R=i._monitor)||void 0===R||R.report("rtc_recv_answer",{error_code:0,answer_type:null==W||null===(A=W.relayMessage)||void 0===A?void 0:A.type,sequence_id:(null==W||null===(C=W.relayMessage)||void 0===C?void 0:C.sequenceId)||0,message:null==W||null===(w=W.relayMessage)||void 0===w?void 0:w.sdp,direction:"down",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:(null===(x=v)||void 0===x?void 0:x.peerConnectionId)||""}),e.next=74,null===(O=v)||void 0===O?void 0:O.handleAck({action:yR.subscribe,streamId:t.streamId,audioMid:B,videoMid:j,audioTransceiverInit:null===(N=U)||void 0===N?void 0:N.audioTransceiverInit,videoTransceiverInit:null===(P=U)||void 0===P?void 0:P.videoTransceiverInit,signalingAck:{sdp:null==W||null===(D=W.relayMessage)||void 0===D?void 0:D.sdp,sequenceId:null==W||null===(M=W.relayMessage)||void 0===M?void 0:M.sequenceId},stream:t,sdp:U.sdp,generatorSsrc:!!U.allSsrc});case 74:return e.next=76,aj.all(h);case 76:i.multiChatMode()||(t.subAudio=u),null===(L=i._monitor)||void 0===L||L.report("rtc_subscribe_stat",{result:"success",start:d,message:"unknown",stream_user_id:t.userId}),i._context&&t.statsReport.setRemoteStreamStatsEvtInterval(function(e){return i.emit("onRemoteStreamStats",e)},v),o(null),i.emit("SUB_END",t.streamId),e.next=92;break;case 83:return e.prev=83,e.t0=e.catch(28),e.t0 instanceof Error&&(null===($=i._monitor)||void 0===$||$.report("rtc_subscribe_stat",{result:"fail",start:d,message:e.t0.message,stream_user_id:t.userId})),t.subVideo=l,t.streamState=yb.INIT,e.next=90,null===(Z=v)||void 0===Z?void 0:Z.rollback(t.streamId,t);case 90:a(e.t0),i.emit("SUB_END",t.streamId);case 92:case"end":return e.stop()}},e,null,[[28,83]])}));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)})),function(e,t,r){return f.apply(this,arguments)})},{key:"_handleSubStreamQueue",value:function(e){var t,r=this;if(null!==(t=this._subStreamQueue[e])&&void 0!==t&&t.length){Es.info("_subStreamQueue","streamId: %o, exec",e);var n=this._subStreamQueue[e].shift(),i=n.fn,o=n.args,a=n.resolve,s=n.reject;i.apply(this,o).then(a,s).finally(function(){return r._handleSubStreamQueue(e)})}else Es.warn("_subStreamQueue","streamId: %o, END",e)}},{key:"controlMessage",value:(v=a2(a0().mark(function e(t){var r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Es.info("controlMessage()","params: %o",t),n=t,"transcode"===t.type&&(n.roomId=this._roomId),e.next=5,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("controlMessage",n);case 5:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"updateUserAttributes",value:(p=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Es.info("updateUserAttributes()","attributes: %o",t),e.next=3,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("updateUserAttributes",{roomId:this._roomId,sessionId:this._sessionId,attributes:t});case 3:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"updateSubTrack",value:(_=a2(a0().mark(function e(t,r,n){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._updateSubTrack(t,r,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t,r){return _.apply(this,arguments)})},{key:"updateSubTrackLayer",value:(h=a2(a0().mark(function e(t,r){var n,i,o;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Es.info("updateSubTrack()","subLayer: %o",r),t.subLayer.spatialLayer!==r.spatialLayer||t.subLayer.spatialSubLayer!==r.spatialSubLayer){e.next=4;break}return Es.warn("updateSubTrack()","subLayer no change"),e.abrupt("return");case 4:return i={roomId:this._roomId,streamList:[t.streamId],streamId:t.streamId,streamUserId:t.userId,config:{qualityLayer:r}},e.next=7,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("updateSubscribe",i);case 7:if(200===(null==(o=e.sent)?void 0:o.code)){e.next=10;break}throw new lM(le.UPDATE_TRACK_FAILED,(null==o?void 0:o.message)||"update track failed");case 10:return t.subLayer=r,e.abrupt("return",t);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"updateSubPriority",value:(l=a2(a0().mark(function e(t,r){var n,i,o;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Es.info("updateSubPriority()","priority: %o",r),t.priority!==r){e.next=4;break}return Es.warn("updateSubPriority()","priority no change"),e.abrupt("return",t);case 4:return i={roomId:this._roomId,streamList:[t.streamId],streamId:t.streamId,streamUserId:t.userId,config:{priority:r}},e.next=7,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("updateSubscribe",i);case 7:if(200===(null==(o=e.sent)?void 0:o.code)){e.next=10;break}throw new lM(le.UPDATE_TRACK_FAILED,(null==o?void 0:o.message)||"update track failed");case 10:return t.priority=r,e.abrupt("return",t);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"_updateSubTrack",value:(d=a2(a0().mark(function e(t,r,n){var i,o,a,s,c,u,d,l;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Es.info("updateSubTrack()","mediaType: %o",r),Eu("updateSubTrack()",t),!this.multiChatMode()||r!==lh.AUDIO){e.next=5;break}return Es.warn("updateSubTrack","multiChatMode mediaType only audio"),e.abrupt("return",t);case 5:return a=0,a=n===yY.SUB?t.subMediaType|r:t.subMediaType-(t.subMediaType&r),Es.info("updateSubTrack","prev: %o, direction: %o, mediaType: %o, newMediaType: %o",t.subMediaType,n,r,a),t.subMediaType===a&&Es.info("updateSubTrack","mediaType no change"),s=!1,c=!1,vc(a)&&(c=!0),vu(a)&&(s=!0),u={roomId:this._roomId,streamList:[t.streamId],config:{enableMediaType:{video:s,audio:!!this.multiChatMode()||c}}},e.next=15,null===(i=this._dataChannelSignal)||void 0===i?void 0:i.sendSignaling("updateSubscribe",u);case 15:if(200===(null==(d=e.sent)?void 0:d.code)){e.next=18;break}throw new lM(le.UPDATE_TRACK_FAILED,(null==d?void 0:d.message)||"update track failed");case 18:return this.multiChatMode()||(null===(l=t.observer)||void 0===l||l.setUnmuteAudio(c),t.subAudio=c),null===(o=t.observer)||void 0===o||o.setUnmuteVideo(s),t.subVideo=s,t.subMediaType=a,e.abrupt("return",t);case 23:case"end":return e.stop()}},e,this)})),function(e,t,r){return d.apply(this,arguments)})},{key:"subscribe4pushTrack",value:(u=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Es.info("subscribe4pushTrack()","streamInfo: %o",r),Eu("subscribe4pushTrack()",t),t.subAudio=!0,e.next=5,null===(n=this._handler)||void 0===n?void 0:n.subscribe(t,{multiChatMode:this.multiChatMode()});case 5:if(a=e.sent){e.next=8;break}throw new lM(le.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 8:return s=a.audioMid,c=a.videoMid,(u=[]).push(new aj(function(e,r){var n=setTimeout(function(){return r(new lM(le.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))},6e4);t.on("ontrack",function r(i){"audio"===i.mediaType&&(Es.success("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))})})),d=function(e){t.ontrack(e)},null===(i=this._handler)||void 0===i||i.on("ontrack",d),this._ontrackCallbackMap.set(t,d),e.next=17,null===(o=this._handler)||void 0===o?void 0:o.handleAck({action:yR.pushtrack,streamId:t.streamId,audioMid:s,videoMid:c,stream:t,audioTransceiverInit:null==a?void 0:a.audioTransceiverInit,videoTransceiverInit:null==a?void 0:a.videoTransceiverInit,signalingAck:null==r?void 0:r.message,sdp:a.sdp});case 17:return e.next=19,aj.all(u);case 19:this._context&&t.statsReport.setRemoteStreamStatsEvtInterval(function(e){return l.emit("onRemoteStreamStats",e)},this._handler);case 20:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"unsubscribe4removeTrack",value:(c=a2(a0().mark(function e(t,r,n){var i,o,a,s,c,u,d;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Eu("unsubscribe4removeTrack()",t),Es.info("unsubscribe4removeTrack()","sequenceId: ",r.sequenceId,"trackType: ",n),!(r.sequenceId<t.sequenceId)){e.next=5;break}return Es.warn("unsubscribe4removeTrack()","sequenceId return"),e.abrupt("return");case 5:return u=!!((c=n+1)&lh.AUDIO),d=!!(c&lh.VIDEO),e.next=10,null===(i=this._handler)||void 0===i?void 0:i.handleAck({action:yR.removetrack,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 10:null===(o=t.observer)||void 0===o||o.setPushTrack(!1),null===(a=t.observer)||void 0===a||a.setUnmuteAudio(!u),t.subAudio=!u,null===(s=t.observer)||void 0===s||s.setUnmuteVideo(!d),t.subVideo=!d,t.subMediaType=t.subMediaType-(t.subMediaType&c),t.virtual&&(t.clean(),t.resetHasSubscribed(),t.statsReport.unsubscribe());case 17:case"end":return e.stop()}},e,this)})),function(e,t,r){return c.apply(this,arguments)})},{key:"unsubscribe",value:(s=a2(a0().mark(function e(t,r){var n,i,o=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>2&&void 0!==o[2]&&o[2],Eu("unsubscribe()",t),!n){e.next=4;break}return e.abrupt("return",this._unsubscribe(t,r));case 4:if(!this.multiChatMode()||!vu(r)){e.next=6;break}return e.abrupt("return",this._unsubscribe(t,r));case 6:if(i=t.subMediaType-(t.subMediaType&r),this.multiChatMode()||i!==gH.NONE){e.next=9;break}return e.abrupt("return",this._unsubscribe(t,r));case 9:return e.abrupt("return",this._updateSubTrack(t,r,yY.UNSUB));case 10:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"_unsubscribe",value:(a=a2(a0().mark(function e(t,r){var n,i,o,a,s,c;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._subConfig.muteReplaceUnsub){e.next=2;break}return e.abrupt("return",this._updateSubTrack(t,r,yY.UNSUB));case 2:return a={roomId:this._roomId,streamId:t.streamId,userId:t.userId},s=t.vendorHandler||this.handler,null===(n=this._dataChannelSignal)||void 0===n||n.sendSignaling("unsubscribe",a).catch(function(){}),t.streamState=yb.INIT,this._subStreamQueue[t.streamId]&&(this._sion(e){return(0,e.resolve)(null)}),delete this._subStreamQueue[t.streamId]),t.subVideo=!1,null===(i=t.observer)||void 0===i||i.setSubscribeVideo(!1),this.multiChatMode()||null===(o=t.observer)||void 0===o||o.setSubscribeAudio(!1),e.next=12,null==s?void 0:s.handleAck({action:yR.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 12:c=e.sent,this._subResolves.forEach(function(e){return e(0)}),Es.info("unsubscribe","clean unsub ".concat(t.userId)),t.clean(),this.removeOnTrackListener(t),t.statsReport.unsubscribe();case 18:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"removeOnTrackListener",value:function(e){var t=this._ontrackCallbackMap.get(e);if(t){var r=e.vendorHandler||this._handler;null==r||r.off("ontrack",t),this._ontrackCallbackMap.delete(e)}}},{key:"handleRemoveStream",value:(o=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Eu("handleRemoveStream()",t),t.subVideo=!1,t.streamState!==yb.INIT){e.next=4;break}return e.abrupt("return");case 4:this.unsubscribe(t,lh.AUDIO_AND_VIDEO,!0);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"leave",value:(i=a2(a0().mark(function e(){var t,r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Es.info("leave()"),this._stopJoinRoom5xxRetry(),this._joinRoomFailed("leave_room"),"connected"!==this.connectionState){e.next=20;break}return t={Authorization:this._authorization,roomId:this._roomId,sessionId:this._sessionId},e.next=7,this._joinLeaveLock.lock();case 7:return r=e.sent,e.prev=8,e.next=11,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("leaveRoom",t);case 11:r(),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(8),r(),e.t0;case 18:e.next=21;break;case 20:return e.abrupt("return",aj.reject(new lM(le.NOT_CONNECTED_YET,"server not connected")));case 21:case"end":return e.stop()}},e,this,[[8,14]])})),function(){return i.apply(this,arguments)})},{key:"subscribePublicStream",value:(n=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=this._handler)||void 0===r?void 0:r.subscribe(t,{multiChatMode:!1});case 2:if(s=e.sent){e.next=5;break}throw new lM(le.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 5:return c=p9(),u=s.audioMid,d=s.videoMid,e.t0=this._context.appId,e.t1=t.streamId,e.t2=u,e.t3=d,e.t4={sdp:null==s?void 0:s.partialSdp,semantics:null==s?void 0:s.semantics,type:null==s?void 0:s.type},e.next=15,fL();case 15:return e.t5=e.sent,e.t6=window.navigator.userAgent,e.t7=ft.VERSION,e.t8=v4.getDeviceId(),e.t9=this._context.appId,e.t10=this._businessId,e.t11=this._context.useCloudProxy,e.t12={supportedCodecs:e.t5,deviceType:"web",userAgent:e.t6,sdkVersion:e.t7,deviceId:e.t8,appId:e.t9,businessId:e.t10,enableCloudProxy:e.t11},e.t13={enableMediaType:{audio:!0,video:!0},qualityLayer:{spatialLayer:0,temporalLayer:0}},l={appId:e.t0,streamId:e.t1,audio:!0,video:!0,data:!0,audioMid:e.t2,videoMid:e.t3,sdpInfo:e.t4,params:e.t12,config:e.t13},e.next=27,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("startPullStream",l);case 27:return h=e.sent,_=[],this._subResolves[t.streamId]=[],_.push(new aj(function(e,r){g._subResolves[t.streamId].push(e);var n=setTimeout(function(){return r(new lM(le.TIME_OUT,"wait video timeout for streamId: ".concat(t.streamId)))},6e4);t.on("ontrack",function r(i){"video"===i.mediaType&&(Es.success("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(n),e(0))})})),_.push(new aj(function(e,r){g._subResolves[t.streamId].push(e);var n=setTimeout(function(){return r(new lM(le.TIME_OUT,"wait audio timeout for streamId: ".concat(t.streamId)))},6e4);t.on("ontrack",function r(i){"audio"===i.mediaType&&(Es.success("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))})})),p=function(e){t.ontrack(e)},null===(i=this._handler)||void 0===i||i.on("ontrack",p),this._ontrackCallbackMap.set(t,p),f=(v=null==h?void 0:h.relayMessage).sequenceId,m=v.sdp,t.videoMid=d,t.audioMid=u,t.sequenceId=f,t.streamState=yb.SUB_ED,t.subAudio=!0,t.subVideo=!0,e.next=44,null===(o=this._handler)||void 0===o?void 0:o.handleAck({action:yR.subscribe,streamId:t.streamId,audioMid:u,videoMid:d,audioTransceiverInit:null==s?void 0:s.audioTransceiverInit,videoTransceiverInit:null==s?void 0:s.videoTransceiverInit,signalingAck:{sdp:m,sequenceId:f},stream:t});case 44:return e.next=46,aj.all(_);case 46:null===(a=this._monitor)||void 0===a||a.report("rtc_subscribe_stat",{result:"success",start:c,message:"unknown",stream_user_id:t.userId}),this._context&&t.statsRepor g.emit("onRemoteStreamStats",e)},this._handler);case 48:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"unsubscribePublicStream",value:(r=a2(a0().mark(function e(t){var r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Eu("unsubscribePublicStream()",t),n={appId:this._context.appId,streamId:t.streamId},e.prev=2,e.next=5,null===(i=this._dataChannelSignal)||void 0===i?void 0:i.sendSignaling("stopPullStream",n);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return t.streamState=yb.INIT,t.subVideo=!1,t.subAudio=!1,e.next=14,null===(r=this._handler)||void 0===r?void 0:r.handleAck({action:yR.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 14:t.clean(),this.removeOnTrackListener(t),t.statsReport.unsubscribe();case 17:case"end":return e.stop()}},e,this,[[2,7]])})),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){var e,t,r;Es.info("destroy()"),this._joinRoomFailed("leave_room"),this._token=void 0,this._roomId=void 0,this._clientId=void 0,this._authorization=void 0,this._sessionId="",this._stopJoinRoom5xxRetry(),null===(e=this._handler)||void 0===e||e.destroy(),this._handler=void 0,null===(t=this._dataChannelSignal)||void 0===t||t.destroy(),this._dataChannelSignal=void 0,this._connectionManager.destroy(),null===(r=this._monitor)||void 0===r||r.set({connection_id:""}),this._removeSignalEventHandler(),this.removeAllListeners(),this.connectionState="disconnected"}},{key:"sendUserMessage",value:function(e,t){var r;return null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendP2PMessage({to:e,from:this._userInfo.userId,room:this._roomId,app:this._context.appId,msg:t})}},{key:"sendRoomMessage",value:function(e){var t;return null===(t=this._dataChannelSignal)||void 0===t?void 0:t.sendSignaling("customMessage",e)}},{key:"_joinRoomWithRetry",value:function(e,t,r){var n=this;return new aj(function(i,o){n._dataChannelSignal.s){n.emit("onJoinRoomAck",e),i(e)}).catch(function(a){if(r=r||new y1,a.code>=500&&a.code<600&&p9()-r.initTs<6e4){var s,c=r.getRetryDelay();return Es.warn("_joinRoomWithRetry",a4(s="joinRoom failed(code: ".concat(a.code,"), will retry after ")).call(s,c,"ms")),void(n._joinRoom5xxTimer=window.setTimeout(function(){delete n._joinRoom5xxTimer,n._joinRoomWithRetry(e,t,r).then(i).catch(o)},c))}o(a)})})}},{),delete this._joinRoom5xxTimer)}},{key:"_addConnectHandler",value:function(){var e=this;this._connectionManager.on("connected",function(t){var r,n,i;Es.info("connectStateChange","connected"),e.connectionState="connected",null===(r=e._dataChannelSignal)||void 0===r||r.destroy(),null===(n=e._handler)||void 0===n||n.destroy(),e._handler=yM(e._context,t.pc),e._dataChannelSignal=t.signaling,e.supportConcurrent="chrome"===(null===(i=e._handler)||void 0===i?void 0:i.name),e._addSignalEventHandler(),e.isReconnecting&&(e._reportJoinRoomStart(),e._callJoinRoom(!0))}),this._connectionManager.on("disconnected",function(t){e.connectionState="disconnected",Es.error("connectStateChange","disconnected. %o",t),e.isReconnecting&&e.safeEmit(yX.RECONNECT_FAILED)}),this._connectionManager.on("connecting",function(){var t;e.isReconnecting=!1,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e.connectionState="connecting",Es.info("connectStateChange","connecting")}),this._connectionManager.on("reconnecting",function(){var t;e.connectionState="disconnected",e.isReconnecting=!0,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e.connectionState="connecting",Es.warn("connectStateChange","reconnecting"),e.safeEmit("reconnecting")}),this._connectionManager.on("connectWidthTcp",function(){e.safeEmit(yX.ON_ICE_CONNECT_WITH_TCP)}),["__onGetIceConfigHook","__(t,function(){return e.emit(t)})})}},{key:"_reportJoinRoomStart",value:function(){var e;this._joinRoomStartTs=p9(),this.emit("__joinRoomStartReport"),null===(e=this._monitor)||void 0===e||e.report("join_room",{type:"begin",start:this._joinRoomStartTs,result:!1,reason:""},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC})}},{key:"_joinRoomSuccess",value:function(e){var t,r;this._joinReject&&this._joinResolve&&(this._joinResolve(e),delete this._joinReject,delete this._joinResolve),this._joinRoomStartTs&&(this.emit("__joinRoomSuccessReport"),null===(t=this._monitor)||void 0===t||t.report("join_room",{type:"end",start:this._joinRoomStartTs,result:!0,reason:""},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC}),null===(r=this._monitor)||void 0===r||r.report("rtc_join_room",{error_code:0,deviceModel:"web",deviceManufacturer:"web",elapse:p9()-this._joinRoomStartTs}),delete this._joinRoomStartTs)}},{key:"_joinRoomFailed",value:function(e,t){var r;this._joinReject&&this._joinResolve&&(this._joinReject(new lM(t||le.JOIN_ROOM_FAILED,e)),delete this._joinReject,delete this._joinResolve),this._joinRoomStartTs&&(this.emit("__joinRoomFailedReport"),null===(r=this._monitor)||void 0===r||r.report("join_room",{type:"end",start:this._joinRoomStartTs,result:!1,reason:e},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC}),delete this._joinRoomStartTs)}},{key:"multiChatMode",value:function(){var e;return null===(e=this._roomAttributes)||void 0===e?void 0:e.multiChatMode}},{key:"sendForwardStreamSignal",value:(t=a2(a0().mark(function e(t,r,n){var i,o,a=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o={forwardStreamType:t,roomId:r},("start"===t||"update"===t)&&(o.dstRoomInfos=null==n?void 0:se(n).call(n,function(e){return{dstRoomId:e.roomId,dstToken:vt.token2auth(a._context.appId,e.roomId,a._clientId,e.token)}})),e.abrupt("return",null===(i=this._dataChannelSignal)||void 0===i?void 0:i.sendSignaling("forwardStream",o));case 4:case"end":return e.stop()}},e,this)})),function(e,r,n){return t.apply(this,arguments)})},{key:"handler",get:function(){return this._handler}},{key:"roomAttributes",get:function(){return this._roomAttributes},set:function(e){this._roomAttributes=e}},{key:"vendorConfig",get:function(){return this._vendorConfig}}]),k}();function El(e,t,r){var n=r.value;return r.value=a2(a0().mark(function e(){var r,i,o,a=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._handler||"connected"!==this._state){e.next=6;break}for(i=Array(r=a.length),o=0;o<r;o++)i[o]=a[o];return e.next=4,n.apply(this,i);case 4:e.next=7;break;case 6:throw new lM(le.NOT_CONNECTED_YET,"error in ".concat(t,": try again after joined"));case 7:case"end":return e.stop()}},e,this)})),r}function Eh(e,t,r){var n=r.value;return r.value=a2(a0().mark(function e(){var t,r,i,o,a=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._pubSubLock.lock();case 2:for(t=e.sent,this.supportConcurrent&&t(),e.prev=4,i=Array(r=a.length),o=0;o<r;o++)i[o]=a[o];return e.next=8,n.apply(this,i);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,this.supportConcurrent||t(),e.finish(9);case 12:case"end":return e.stop()}},e,this,[[4,,9,12]])})),r}Ea([function(e,t,r){var n=r.value;return r.value=a2(a0().mark(function e(){var t,r,i,o,a=this,s=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=Array(t=s.length),i=0;i<t;i++)r[i]=s[i];return o=!1,e.abrupt("return",new aj(function(){var e=a2(a0().mark(function e(t,i){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.on("INTERRUPT",function(){o=!0,i(new lM(le.OPERATION_CANCEL,"operation not finish when leave"))}),e.prev=1,e.next=4,n.apply(a,r);case 4:t(e.sent),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),o||i(e.t0);case 11:case"end":return e.stop()}},e,null,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e)})),r}],Ed.prototype,"join",1),Ea([Eh,El],Ed.prototype,"publish",1),Ea([Eh,El],Ed.prototype,"updatePubTrack",1),Ea([Eh,El],Ed.prototype,"unpublish",1),Ea([Eh,El],Ed.prototype,"subscribe",1),Ea([El],Ed.prototype,"controlMessage",1),Ea([El],Ed.prototype,"updateUserAttributes",1),Ea([El],Ed.prototype,"updateSubTrack",1),Ea([El],Ed.prototype,"updateSubTrackLayer",1),Ea([El],Ed.prototype,"updateSubPriority",1),Ea([Eh,El],Ed.prototype,"subscribe4pushTrack",1),Ea([Eh,El],Ed.prototype,"unsubscribe4removeTrack",1),Ea([Eh,El],Ed.prototype,"unsubscribe",1),Ea([El],Ed.prototype,"handleRemoveStream",1),Ea([Eh],Ed.prototype,"subscribePublicStream",1),Ea([Eh],Ed.prototype,"unsubscribePublicStream",1);var E_,Ep,Ev,Ef,Em,Eg,Ey,ES,Eb,EE,ET,Ek,EI,ER,EA,EC=(EI=a2(a0().mark(function e(t,r,n,i){var o,a,s,c,u,d,l,h,_,p,v,f,m,g;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u="",d=-1,l="video"===t?null==n||null===(o=n.videoTrack)||void 0===o?void 0:o.getOrgTrack():null==n||null===(a=n.audioTrack)||void 0===a?void 0:a.getOrgTrack(),h="video"===t?null==n||null===(s=n.videoTransceiver)||void 0===s?void 0:s.receiver:null==n||null===(c=n.audioTransceiver)||void 0===c?void 0:c.receiver,e.prev=5,e.t0=null==r?void 0:r.pc,!e.t0){e.next=11;break}return e.next=10,f1(null==r?void 0:r.pc,l);case 10:e.t0=e.sent;case 11:return v=cS(_=(p=e.t0)||[]).call(_,function(e){return"inbound-rtp"===e.type}),e.next=15,null==h?void 0:h.getStats();case 15:if(f=e.sent,m=[],null==f||f.forEach(function(e){return m.push(e.type)}),null==r||!r.pc||0!==(null==p?void 0:p.length)||0===m.length){e.next=22;break}return e.next=21,f1(r.pc);case 21:g=e.sent;case 22:u=a6({type:t,reports:se(p).call(p,function(e){return e.type}),reports2:m,pc:(null==r?void 0:r.pc)||null,track:(null==l?void 0:l.id)||null,bytes:null==v?void 0:v.bytesReceived,framesReceived:null==v?void 0:v.framesReceived,packetsReceived:null==v?void 0:v.packetsReceived,allReports:g}),e.next=29;break;case 25:e.prev=25,e.t1=e.catch(5),d=-999,u=e.t1.mseeage||a6(e.t1);case 29:null==i||i.report("rtc_invoke_status",{sdk_api_name:"first_frame_recv_timeout",error_code:d,message:u,stream_id:(null==n?void 0:n.streamId)||"",stream_user_id:null==n?void 0:n.userId,elapse:0}),e.next=34;break;case 32:e.prev=32,e.t2=e.catch(0);case 34:case"end":return e.stop()}},e,null,[[0,32],[5,25]])})),function(e,t,r,n){return EI.apply(this,arguments)}),Ew=(ER=a2(a0().mark(function e(t,r,n,i){var o,a,s,c,u,d,l,h,_,p,v,f,m,g;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u="",d=-1,l="video"===t?null==n||null===(o=n.videoTrack)||void 0===o?void 0:o.getTrack("preprocessing"):null==n||null===(a=n.audioTrack)||void 0===a?void 0:a.getTrack("preprocessing"),h="video"===t?null==n||null===(s=n.videoTransceiver)||void 0===s?void 0:s.sender:null==n||null===(c=n.audioTransceiver)||void 0===c?void 0:c.sender,e.prev=5,e.t0=null==r?void 0:r.pc,!e.t0){e.next=11;break}return e.next=10,f1(null==r?void 0:r.pc,l);case 10:e.t0=e.sent;case 11:return v=cS(_=(p=e.t0)||[]).call(_,function(e){return"outbound-rtp"===e.type}),e.next=15,null==h?void 0:h.getStats();case 15:if(f=e.sent,m=[],null==f||f.forEach(function(e){return m.push(e.type)}),null==r||!r.pc||0!==p.length||0===m.length){e.next=22;break}return e.next=21,f1(r.pc);case 21:g=e.sent;case 22:u=a6({type:t,reports:se(p).call(p,function(e){return e.type}),reports2:m,pc:(null==r?void 0:r.pc)||null,track:(null==l?void 0:l.id)||null,bytes:null==v?void 0:v.bytesSent,framesSent:null==v?void 0:v.framesSent,packetsSent:null==v?void 0:v.packetsSent,allReports:g}),e.next=29;break;case 25:e.prev=25,e.t1=e.catch(5),d=-999,u=e.t1.mseeage||a6(e.t1);case 29:null==i||i.report("rtc_invoke_status",{sdk_api_name:"first_frame_send_timeout",error_code:d,message:u,stream_id:(null==n?void 0:n.streamId)||"",stream_user_id:null==n?void 0:n.userId,elapse:0}),e.next=34;break;case 32:e.prev=32,e.t2=e.catch(0);case 34:case"end":return e.stop()}},e,null,[[0,32],[5,25]])})),function(e,t,r,n){return ER.apply(this,arguments)}),Ex=new h1("RecvFrameObserver",0),EO=function(e){dy(a,fT.exports.EventEmitter);var t,r,n,i,o=dC(a);function a(e,t){var r;return iE(this,a),iT(dn(r=o.call(this)),"_audioEventSessionId",vn()),iT(dn(r),"_videoEventSessionId",vn()),iT(dn(r),"_handler",void 0),iT(dn(r),"_stream",void 0),iT(dn(r),"_firstAudioFrameTimer",void 0),iT(dn(r),"_firstVideoFrameTimer",void 0),iT(dn(r),"_transportDelayInterval",void 0),iT(dn(r),"_transportDelay",void 0),iT(dn(r),"_firstVideoFrameInterval",void 0),iT(dn(r),"_firstAudioFrameInterval",void 0),iT(dn(r),"_isScreen",!1),iT(dn(r),"_audioFirstFrameState",0),iT(dn(r),"_videoFirstFrameState",0),iT(dn(r),"_timeout",1e4),iT(dn(r),"_currentAudioRecv",{startTime:0,eventSessionId:0,type:"login"}),iT(dn(r),"_currentVideoRecv",{startTime:0,eventSessionId:0,type:"login"}),iT(dn(r),"_login",!1),iT(dn(r),"_unMuteAudio",!1),iT(dn(r),"_enableAudio",!1),iT(dn(r),"_unMuteVideo",!1),iT(dn(r),"_enableVideo",!1),iT(dn(r),"_remoteUnmuteAudio",!1),iT(dn(r),"_remoteUnmuteVideo",!1),iT(dn(r),"_audioExternal",!1),iT(dn(r),"_pushAudio",!1),iT(dn(r),"_videoExternal",!1),iT(dn(r),"_pushVideo",!1),iT(dn(r),"_autoSubscribeVideo",!1),iT(dn(r),"_autoSubscribeAudio",!1),iT(dn(r),"_autoSubscribe",!1),iT(dn(r),"_publishVideo",!1),iT(dn(r),"_publishAudio",!1),iT(dn(r),"_subscribeAudio",!1),iT(dn(r),"_subscribeVideo",!1),iT(dn(r),"_subscribe",!1),iT(dn(r),"_pushTrack",!1),iT(dn(r),"_multiChatMode",!1),iT(dn(r),"_monitor",void 0),r._stream=e,r._handler=t,r.getTransportDelay(),r._monitor=pZ(e.engineId),r}return ib(a,[{key:"beginRecvFrame",value:(i=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:i=this._transportDelay,o=!0,cA(n=["login","unmute","subscribe","push_track"]).call(n,r)>=0&&(i=0,o=!1),"audio"===t?(o||this._audioEventSessionId++,this._currentAudioRecv={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:r},_={media_type:t,event_type:"begin_recv",type:r,is_screen:!(null===(a=this._stream)||void 0===a||!a.isScreen),start:null===(s=this._currentAudioRecv)||void 0===s?void 0:s.startTime,event_session_id:this._audioEventSessionId,stream_user_id:null===(c=this._stream)||void 0===c?void 0:c.userId,transport_delay:i,vendor_mode:(null===(u=this._stream)||void 0===u?void 0:u.vendorCode)||0,pc_session_id:(null===(d=this._stream)||void 0===d?void 0:d.pcSessionId)||(null===(l=this._handler)||void 0===l?void 0:l.peerConnectionId)},this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=window.setTimeout(function(){EC("audio",E._handler,E._stream,E._monitor),E.stopRecvFrame("audio","timeout"),E._firstAudioFrameInterval&&window.clearInterval(E._firstAudioFrameInterval)},this._timeout),Ex.info("rtcFirstFrameRecv",a6(_)),null===(h=this._monitor)||void 0===h||h.report("rtc_first_frame",_),this._watchForFirstAudioFrameRecv(),this._audioFirstFrameState=1,this._login=!0,this._unMuteAudio=!0,this._enableAudio=!0,this._remoteUnmuteAudio=!0):"video"===t&&(o||this._videoEventSessionId++,this._currentVideoRecv={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:r},b={media_type:t,event_type:"begin_recv",type:r,is_screen:!(null===(p=this._stream)||void 0===p||!p.isScreen),start:null===(v=this._currentVideoRecv)||void 0===v?void 0:v.startTime,event_session_id:this._videoEventSessionId,stream_user_id:null===(f=this._stream)||void 0===f?void 0:f.userId,transport_delay:i,vendor_mode:(null===(m=this._stream)||void 0===m?void 0:m.vendorCode)||0,pc_session_id:(null===(g=this._stream)||void 0===g?void 0:g.pcSessionId)||(null===(y=this._handler)||void 0===y?void 0:y.peerConnectionId)},this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=window.setTimeout(function(){EC("video",E._handler,E._stream,E._monitor),E.stopRecvFrame("video","timeout"),E._firstVideoFrameInterval&&window.clearInterval(E._firstVideoFrameInterval)},this._timeout),this._watchForFirstVideoFrameRecv(),Ex.info("rtcFirstFrameRecv",a6(b)),null===(S=this._monitor)||void 0===S||S.report("rtc_first_frame",b),this._videoFirstFrameState=1,this._login=!0,this._unMuteVideo=!0,this._enableVideo=!0,this._remoteUnmuteVideo=!0);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"stopRecvFrame",value:function(e,t){if("audio"===e){if(1===this._audioFirstFrameState){var r,n,i,o,a,s,c,u,d={event_type:"recv_end",media_type:e,is_screen:!(null===(r=this._stream)||void 0===r||!r.isScreen),start:null===(n=this._currentAudioRecv)||void 0===n?void 0:n.startTime,reason:t,result:!1,stream_user_id:null===(i=this._stream)||void 0===i?void 0:i.userId,event_session_id:this._audioEventSessionId,type:null===(o=this._currentAudioRecv)||void 0===o?void 0:o.type,vendor_mode:(null===(a=this._stream)||void 0===a?void 0:a.vendorCode)||0,pc_session_id:(null===(s=this._stream)||void 0===s?void 0:s.pcSessionId)||(null===(c=this._handler)||void 0===c?void 0:c.peerConnectionId)};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioRecv,Ex.info("rtcFirstFrameRecv",a6(d)),null===(u=this._monitor)||void 0===u||u.report("rtc_first_frame",d),this._audioFirstFrameState=2}}else if("video"===e){if(1!==this._videoFirstFrameState)return;var l,h,_,p,v,f,m,g,y={event_type:"recv_end",media_type:e,is_screen:!(null===(l=this._stream)||void 0===l||!l.isScreen),start:null===(h=this._currentVideoRecv)||void 0===h?void 0:h.startTime,reason:t,result:!1,stream_user_id:null===(_=this._stream)||void 0===_?void 0:_.userId,event_session_id:this._videoEventSessionId,type:null===(p=this._currentVideoRecv)||void 0===p?void 0:p.type,vendor_mode:(null===(v=this._stream)||void 0===v?void 0:v.vendorCode)||0,pc_session_id:(null===(f=this._stream)||void 0===f?void 0:f.pcSessionId)||(null===(m=this._handler)||void 0===m?void 0:m.peerConnectionId)};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoRecv,Ex.info("rtcFirstFrameRecv",a6(y)),null===(g=this._monitor)||void 0===g||g.report("rtc_first_frame",y),this._videoFirstFrameState=2}}},{key:"recvFrameFinish",value:(n=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:if(r=this._transportDelay,"audio"!==t){e.next=19;break}if(1===this._audioFirstFrameState){e.next=6;break}return e.abrupt("return");case 6:if(this._currentAudioRecv){e.next=8;break}return e.abrupt("return");case 8:l=(d=this._currentAudioRecv).type,h=d.startTime,cA(n=["login","unmute","subscribe","push_track"]).call(n,l)>=0&&(r=0),_={event_type:"recv_end",media_type:t,start:h,result:!0,is_screen:!(null===(i=this._stream)||void 0===i||!i.isScreen),stream_user_id:null===(o=this._stream)||void 0===o?void 0:o.userId,event_session_id:this._audioEventSessionId,type:l,transport_delay:r,vendor_mode:(null===(a=this._stream)||void 0===a?void 0:a.vendorCode)||0,pc_session_id:(null===(s=this._stream)||void 0===s?void 0:s.pcSessionId)||(null===(c=this._handler)||void 0===c?void 0:c.peerConnectionId)},delete this._currentAudioRecv,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),Ex.info("rtcFirstFrameRecv",a6(_)),null===(u=this._monitor)||void 0===u||u.report("rtc_first_frame",_),this.emit("recvAudioFirstFrame"),this._audioFirstFrameState=3,e.next=33;break;case 19:if("video"!==t){e.next=33;break}if(1===this._videoFirstFrameState){e.next=22;break}return e.abrupt("return");case 22:if(this._currentVideoRecv){e.next=24;break}return e.abrupt("return");case 24:E=(b=this._currentVideoRecv).type,T=b.startTime,cA(p=["login","unmute","subscribe","push_track"]).call(p,E)>=0&&(r=0),k={event_type:"recv_end",media_type:t,is_screen:!(null===(v=this._stream)||void 0===v||!v.isScreen),start:T,result:!0,stream_user_id:null===(f=this._stream)||void 0===f?void 0:f.userId,event_session_id:this._videoEventSessionId,type:E,transport_delay:r,vendor_mode:(null===(m=this._stream)||void 0===m?void 0:m.vendorCode)||0,pc_session_id:(null===(g=this._stream)||void 0===g?void 0:g.pcSessionId)||(null===(y=this._handler)||void 0===y?void 0:y.peerConnectionId)},delete this._currentVideoRecv,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),Ex.info("rtcFirstFrameRecv",a6(k)),null===(S=this._monitor)||void 0===S||S.report("rtc_first_frame",k),this.emit("recvVideoFirstFrame"),this._videoFirstFrameState=3;case 33:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"setLogin",value:function(e){var t,r,n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};this._login!==e&&(this._login=e,e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&o.audio&&this.beginRecvFrame("audio","login"),e&&null!==(r=this._stream)&&void 0!==r&&r.hasVideo&&o.video&&this.beginRecvFrame("video","login"),!e&&null!==(n=this._stream)&&void 0!==n&&n.hasAudio&&this.stopRecvFrame("audio","leave_room"),!e&&null!==(i=this._stream)&&void 0!==i&&i.hasVideo&&this.stopRecvFrame("video","leave_room"))}},{key:"setUnmuteAudio",value:function(e){var t,r,n;if(this._unMuteAudio!==e){this._unMuteAudio=e;var i=!(null===(t=this._stream)||void 0===t||!t.hasAudio);null!==(r=this._stream)&&void 0!==r&&r.audioHasCapture&&null!==(n=this._stream)&&void 0!==n&&n.audioHasPublish&&(this._unMuteAudio&&i?this.beginRecvFrame("audio","unmute"):i&&this.stopRecvFrame("audio","mute"))}}},{key:"setRemoteUnmuteAudio",value:function(e){this._remoteUnmuteAudio!==e&&(this._remoteUnmuteAudio=e,this._remoteUnmuteAudio?this.beginRecvFrame("audio","remote_unmute"):this.stopRecvFrame("audio","remote_mute"))}},{key:"setEnableAudio",value:function(e){var t;this._enableAudio!==e&&(this._enableAudio=e,this._enableAudio?this.beginRecvFrame("audio","enable"):null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","disable"))}},{key:"setUnmuteVideo",value:function(e){var t,r,n;if(this._unMuteVideo!==e){this._unMuteVideo=e;var i=!(null===(t=this._stream)||void 0===t||!t.hasVideo);null!==(r=this._stream)&&void 0!==r&&r.videoHasCapture&&null!==(n=this._stream)&&void 0!==n&&n.videoHasPublish&&(this._unMuteVideo&&i?this.beginRecvFrame("video","unmute"):i&&this.stopRecvFrame("video","mute"))}}},{key:"setHandler",value:function(e){this._handler=e}},{key:"setRemoteUnmuteVideo",value:function(e){this._remoteUnmuteVideo!==e&&(this._remoteUnmuteVideo=e,this._remoteUnmuteVideo?this.beginRecvFrame("video","remote_unmute"):this.stopRecvFrame("video","remote_mute"))}},{key:"setEnableVideo",value:function(e){this._enableVideo!==e&&(this._enableVideo=e,this._enableVideo?this.beginRecvFrame("video","enable"):this.stopRecvFrame("video","disable"))}},{key:"setExternalAudioSource",value:function(e){this._audioExternal=e}},{key:"setPushAudio",value:function(e){var t;this._audioExternal&&this._pushAudio!==e&&(this._pushAudio=e),this._pushAudio&&this.beginRecvFrame("audio","push"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.beginRecvFrame("audio","push")}},{key:"setExternalVideoSource",value:function(e){this._videoExternal=e}},{key:"setPushVideo",value:function(e){var t;this._videoExternal&&this._pushVideo!==e&&(this._pushVideo=e),this._pushVideo&&this.beginRecvFrame("video","push"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.beginRecvFrame("video","push")}},{key:"setPublishVideo",value:function(e){var t;this._publishVideo!==e&&(this._publishVideo=e),this._publishVideo&&this.beginRecvFrame("video","publish"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame("video","unpublish")}},{key:"setPublishAudio",value:function(e){var t;this._publishAudio!==e&&(this._publishAudio=e),this._publishAudio&&this.beginRecvFrame("audio","publish"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","unpublish")}},{key:"setAutoSubscribe",value:function(e){this._autoSubscribe=e}},{key:"setAutoSubscribeVideo",value:function(e){this._autoSubscribeVideo=e}},{key:"setAutoSubscribeAudio",value:function(e){this._autoSubscribeAudio=e}},{key:"setSubscribeAudio",value:function(e){var t,r;this._autoSubscribeAudio||this._subscribeAudio===e||(this._subscribe=e,e&&null!==(r=this._stream)&&void 0!==r&&r.hasAudio&&this.beginRecvFrame("audio","subscribe")),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","unsubscribe")}},{key:"setSubscribeVideo",value:function(e){var t,r;this._autoSubscribeVideo||this._subscribeVideo===e||(this._subscribeVideo=e,e&&null!==(r=this._stream)&&void 0!==r&&r.hasVideo&&this.beginRecvFrame("video","subscribe")),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame("video","unsubscribe")}},{key:"setPushTrack",value:function(e){var t;this._pushTrack!==e&&(e&&!this._isScreen&&this.beginRecvFrame("audio","push_track"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","remove_track"))}},{key:"setMultiChatMode",value:function(e){this._multiChatMode=e}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"_watchForFirstVideoFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval(a2(a0().mark(function n(){var i,o,a,s,c,u,d,l;return a0().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(i=e._handler)||void 0===i||!i.pc||null===(o=e._stream)||void 0===o||null===(a=o.videoTrack)||void 0===a||!a.getTrack()){n.next=12;break}return n.next=3,f1(null===(s=e._handler)||void 0===s?void 0:s.pc,null===(c=e._stream)||void 0===c||null===(u=c.videoTrack)||void 0===u?void 0:u.getTrack());case 3:if(!(l=cS(d=n.sent).call(d,function(e){return"inbound-rtp"===e.type}))||!(l.framesReceived>t||l.packetsReceived>r)){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=l.framesReceived,r=l.packetsReceived,n.abrupt("return");case 10:e.recvFrameFinish("video"),window.clearInterval(e._firstVideoFrameInterval);case 12:case"end":return n.stop()}},n)})),200)}},{key:"_watchForFirstAudioFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval(a2(a0().mark(function n(){var i,o,a,s,c,u,d,l;return a0().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(i=e._handler)||void 0===i||!i.pc||null===(o=e._stream)||void 0===o||null===(a=o.audioTrack)||void 0===a||!a.getOrgTrack()){n.next=12;break}return n.next=3,f1(null===(s=e._handler)||void 0===s?void 0:s.pc,null===(c=e._stream)||void 0===c||null===(u=c.audioTrack)||void 0===u?void 0:u.getOrgTrack());case 3:if(!(l=cS(d=n.sent).call(d,function(e){return"inbound-rtp"===e.type}))||!(l.totalSamplesReceived>t||l.packetsReceived>r)){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=l.totalSamplesReceived,r=l.packetsReceived,n.abrupt("return");case 10:e.recvFrameFinish("audio"),window.clearInterval(e._firstAudioFrameInterval);case 12:case"end":return n.stop()}},n)})),200)}},{key:"getTransportDelay",value:(r=a2(a0().mark(function e(){var t=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelayIntl();case 2:window.clearInterval(this._transportDelayInterval),this._transportDelayInterva2:case"end":return e.stop()}},e)})),2e3);case 4:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getTransportDelayIntl",value:(t=a2(a0().mark(function e(){var t,r,n,i,o;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc){e.next=7;break}return e.next=3,f1(null===(r=this._handler)||void 0===r?void 0:r.type&&"connected"===e.dtlsState}),(o=cS(n).call(n,function(e){return"candidate-pair"===e.type&&"succeeded"===e.state&&e.id===(null==i?void 0:i.selectedCandidatePairId)}))&&(this._transportDelay=Math.round(1e3*o.currentRoundTripTime/2));case 7:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"reset",value:function(){this._currentAudioRecv={startTime:0,eventSessionId:0,type:"login"},this._currentVideoRecv={startTime:0,eventSessionId:0,type:"login"},this._login=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._remoteUnmuteAudio=!1,this._remoteUnmuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoSubscribeVideo=!1,this._autoSubscribeAudio=!1,this._autoSubscribe=!1,this._subscribeAudio=!1,this._subscribeVideo=!1,this._subscribe=!1,this._pushTrack=!1,this._multiChatMode=!1,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._transportDelayInterval&&window.clearInterval(this._transportDelayInterval)}},{key:"audioFirstFrameReceived",get:function(){return 3===this._audioFirstFrameState}},{key:"FirstFrameReceived",get:function(){return 3===this._audioFirstFrameState}}]),a}(),EN=new h1("SendFrameObserver",0),EP=function(){var e,t;function r(e,t){iE(this,r),iT(this,"_audioEventSessionId",vn()),iT(this,"_videoEventSessionId",vn()),iT(this,"_pcSessionId",void 0),iT(this,"_handler",void 0),iT(this,"_firstAudioFrameTimer",void 0),iT(this,"_firstVideoFrameTimer",void 0),iT(this,"_stream",void 0),iT(this,"_firstVideoFrameInterval",void 0),iT(this,"_firstAudioFrameInterval",void 0),iT(this,"_currentAudioSend",{startTime:0,eventSessionId:0,type:"login"}),iT(this,"_currentVideoSend",{startTime:0,eventSessionId:0,type:"login"}),iT(this,"_login",!1),iT(this,"_publisher",!1),iT(this,"_unMuteAudio",!1),iT(this,"_enableAudio",!1),iT(this,"_unMuteVideo",!1),iT(this,"_enableVideo",!1),iT(this,"_audioExternal",!1),iT(this,"_pushAudio",!1),iT(this,"_videoExternal",!1),iT(this,"_pushVideo",!1),iT(this,"_autoPublish",!1),iT(this,"_publish",!1),iT(this,"_timeout",1e4),iT(this,"_audioFirstFrameState",0),iT(this,"_videoFirstFrameState",0),iT(this,"_monitor",void 0),this._stream=e,this._handler=t,this._monitor=pZ(e.engineId)}return ib(r,[{key:"beginSendFrame",value:function(e,t){var r=this;if("audio"===e){this._audioEventSessionId++,this._currentAudioSend={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:t};var n,i,o,a,s,c,u={event_type:"begin_send",media_type:e,is_screen:!(null===(n=this._stream)||void 0===n||!n.isScreen),type:t,start:null===(i=this._currentAudioSend)||void 0===i?void 0:i.startTime,event_session_id:this._audioEventSessionId,vendor_mode:(null===(o=this._stream)||void 0===o?void 0:o.vendorCode)||0,pc_session_id:(null===(a=this._stream)||void 0===a?void 0:a.pcSessionId)||(null===(s=this._handler)||void 0===s?void 0:s.peerConnectionId)};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=window.setTimeout(function(){Ew("audio",r._handler,r._stream,r._monitor),r.stopSendFrame("audio","timeout"),r._firstAudioFrameInterval&&window.clearInterval(r._firstAudioFrameInterval)},this._timeout),EN.info("rtcFirstFrameSend",a6(u)),null===(c=this._monitor)||void 0===c||c.report("rtc_first_frame",u),this._watchForFirstAudioFrameSend(),this._audioFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteAudio=!0,this._pushAudio||(this._enableAudio=!0)}else if("video"===e){this._videoEventSessionId++,this._currentVideoSend={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:t};var d,l,h,_,p,v,f={event_type:"begin_send",media_type:e,is_screen:!(null===(d=this._stream)||void 0===d||!d.isScreen),type:t,start:null===(l=this._currentVideoSend)||void 0===l?void 0:l.startTime,event_session_id:this._videoEventSessionId,vendor_mode:(null===(h=this._stream)||void 0===h?void 0:h.vendorCode)||0,pc_session_id:(null===(_=this._stream)||void 0===_?void 0:_.pcSessionId)||(null===(p=this._handler)||void 0===p?void 0:p.peerConnectionId)};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=window.setTimeout(function(){Ew("video",r._handler,r._stream,r._monitor),r.stopSendFrame("video","timeout"),r._firstVideoFrameInterval&&window.clearInterval(r._firstVideoFrameInterval)},this._timeout),this._watchForFirstVideoFrameSend(),EN.info("rtcFirstFrameSend",a6(f)),null===(v=this._monitor)||void 0===v||v.report("rtc_first_frame",f),this._videoFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteVideo=!0,this._pushVideo||(this._enableVideo=!0)}}},{key:"stopSendFrame",value:function(e,t){if("audio"===e){if(1===this._audioFirstFrameState){var r,n,i,o,a,s,c,u={event_type:"sent_end",media_type:e,is_screen:!(null===(r=this._stream)||void 0===r||!r.isScreen),start:null===(n=this._currentAudioSend)||void 0===n?void 0:n.startTime,reason:t,result:!1,event_session_id:this._audioEventSessionId,type:null===(i=this._currentAudioSend)||void 0===i?void 0:i.type,vendor_mode:(null===(o=this._stream)||void 0===o?void 0:o.vendorCode)||0,pc_session_id:(null===(a=this._stream)||void 0===a?void 0:a.pcSessionId)||(null===(s=this._handler)||void 0===s?void 0:s.peerConnectionId)};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioSend,EN.info("rtcFirstFrameSend",a6(u)),null===(c=this._monitor)||void 0===c||c.report("rtc_first_frame",u),this._audioFirstFrameState=2}}else if("video"===e){if(1!==this._videoFirstFrameState)return;var d,l,h,_,p,v,f,m={event_type:"sent_end",media_type:e,start:null===(d=this._currentVideoSend)||void 0===d?void 0:d.startTime,is_screen:!(null===(l=this._stream)||void 0===l||!l.isScreen),reason:t,result:!1,event_session_id:this._videoEventSessionId,type:null===(h=this._currentVideoSend)||void 0===h?void 0:h.type,vendor_mode:(null===(_=this._stream)||void 0===_?void 0:_.vendorCode)||0,pc_session_id:(null===(p=this._stream)||void 0===p?void 0:p.pcSessionId)||(null===(v=this._handler)||void 0===v?void 0:v.peerConnectionId)};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoSend,EN.info("rtcFirstFrameSend",a6(m)),null===(f=this._monitor)||void 0===f||f.report("rtc_first_frame",m),this._videoFirstFrameState=2}}},{key:"sendFrameFinish",value:function(e){if("audio"===e){if(1===this._audioFirstFrameState&&this._currentAudioSend){var t,r,n,i,o,a=this._currentAudioSend,s=a.type,c=a.startTime,u={event_type:"sent_end",media_type:e,is_screen:!(null===(t=this._stream)||void 0===t||!t.isScreen),start:c,result:!0,event_session_id:this._audioEventSessionId,type:s,vendor_mode:(null===(r=this._stream)||void 0===r?void 0:r.vendorCode)||0,pc_session_id:(null===(n=this._stream)||void 0===n?void 0:n.pcSessionId)||(null===(i=this._handler)||void 0===i?void 0:i.peerConnectionId)};delete this._currentAudioSend,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),EN.info("rtcFirstFrameSend",a6(u)),null===(o=this._monitor)||void 0===o||o.report("rtc_first_frame",u),this._audioFirstFrameState=3}}else if("video"===e){if(1!==this._videoFirstFrameState||!this._currentVideoSend)return;var d,l,h,_,p,v=this._currentVideoSend,f=v.type,m=v.startTime,g={event_type:"sent_end",media_type:e,is_screen:!(null===(d=this._stream)||void 0===d||!d.isScreen),start:m,result:!0,event_session_id:this._videoEventSessionId,type:f,vendor_mode:(null===(l=this._stream)||void 0===l?void 0:l.vendorCode)||0,pc_session_id:(null===(h=this._stream)||void 0===h?void 0:h.pcSessionId)||(null===(_=this._handler)||void 0===_?void 0:_.peerConnectionId)};delete this._currentVideoSend,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),EN.info("rtcFirstFrameSend",a6(g)),null===(p=this._monitor)||void 0===p||p.report("rtc_first_frame",g),this._videoFirstFrameState=3}}},{key:"setLogin",value:function(e){if(this._login!==e){var t,r;this._login=e,e&&(null!==(t=this._stream)&&void 0!==t&&t.videoTrack&&this.beginSendFrame("video","login"),null!==(r=this._stream)&&void 0!==r&&r.audioTrack&&this.beginSendFrame("audio","login")),!e&&this._audioSending&&this.stopSendFrame("audio","leave_room"),!e&&this._videoSending&&this.stopSendFrame("video","leave_room")}}},{key:"setPublish",value:function(e){if(this._publish!==e){var t,r,n,i;this._publish=e,e&&((null===(t=this._stream)||void 0===t?void 0:t.videoTrack)&&(null===(r=this._stream)||void 0===r?void 0:r.pubVideo)&&this.beginSendFrame("video","publish"),(null===(n=this._stream)||void 0===n?void 0:n.audioTrack)&&(null===(i=this._stream)||void 0===i?void 0:i.pubAudio)&&this.beginSendFrame("audio","publish")),!e&&this._audioSending&&this.stopSendFrame("audio","unpublish"),!e&&this._videoSending&&this.stopSendFrame("video","unpublish")}}},{key:"setUnmuteAudio",value:function(e){var t;this._unMuteAudio!==e&&(this._unMuteAudio=e,null!==(t=this._stream)&&void 0!==t&&t.audioHasCapture&&(e&&this.beginSendFrame("audio","unmute"),!e&&this._audioSending&&this.stopSendFrame("audio","mute")))}},{key:"setEnableAudio",value:function(e){var t;this._enableAudio!==e&&null!==(t=this._stream)&&void 0!==t&&t.pubAudio&&(this._enableAudio=e,e&&this.beginSendFrame("audio","enable"),!e&&this._audioSending&&this.stopSendFrame("audio","disable"))}},{key:"setUnmuteVideo",value:function(e){var t;this._unMuteVideo!==e&&(this._unMuteVideo=e,null!==(t=this._stream)&&void 0!==t&&t.videoHasCapture&&(e&&this.beginSendFrame("video","unmute"),!e&&this._videoSending&&this.stopSendFrame("video","mute")))}},{key:"setEnableVideo",value:function(e){var t;this._enableVideo!==e&&null!==(t=this._stream)&&void 0!==t&&t.pubVideo&&(this._enableVideo=e,e&&this.beginSendFrame("video","enable"),!e&&this._videoSending&&this.stopSendFrame("video","disable"))}},{key:"setExternalAudioSource",value:function(e){this._audioExternal!==e&&(this._audioExternal=e,e&&(this._audioSending&&this.stopSendFrame("audio","disable"),this._enableAudio=!1),e||(this._audioSending&&this.stopSendFrame("audio","stop_push"),this._pushAudio=!1))}},{key:"setPushAudio",value:function(e){this._pushAudio!==e&&(this._pushAudio=e,e&&this.beginSendFrame("audio","push"),!e&&this._audioSending&&this.stopSendFrame("audio","stop_push"))}},{key:"setExternalVideoSource",value:function(e){this._videoExternal!==e&&(this._videoExternal=e,e&&(this._videoSending&&this.stopSendFrame("video","disable"),this._enableVideo=!1),e||(this._videoSending&&this.stopSendFrame("video","stop_push"),this._pushVideo=!1))}},{key:"setPushVideo",value:function(e){this._pushVideo!==e&&(this._pushVideo=e,e&&this.beginSendFrame("video","push"),!e&&this._videoSending&&this.stopSendFrame("video","stop_push"))}},{key:"setAutoPublish",value:function(e){this._autoPublish=e}},{key:"setPublisher",value:function(e){this._publisher!==e&&(this._publisher=e,!e&&this._audioSending&&this.stopSendFrame("audio","audience"),!e&&this._videoSending&&this.stopSendFrame("video","audience"))}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"setPCSessionId",value:function(e){this._pcSessionId=e}},{key:"setHandler",value:function(e){this._handler=e}},{key:"_getFirstVideoFrameStats",value:(t=a2(a0().mark(function e(){var t,r,n,i,o,a,s,c;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc||null===(r=this._stream)||void 0===r||null===(n=r.videoTrack)||void 0===n||!n.getTrack("preprocessing")){e.next=6;break}return e.next=3,f1(null===(i=this._handler)||void 0===i?void 0:i.pc,null===(o=this._stream)||void 0===o||null===(a=o.videoTrack)||void 0===a?void 0:a.getTrack("preprocessing"));case 3:return c=cG(s=e.sent).call(s,function(e){return"outbound-rtp"===e.type}),e.abrupt("return",c);case 6:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_getFirstAudioFrameStats",value:(e=a2(a0().mark(function e(){var t,r,n,i,o,a,s;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc||null===(r=this._stream)||void 0===r||null===(n=r.audioTrack)||void 0===n||!n.getTrack("preprocessing")){e.next=5;break}return e.next=3,f1(null===(i=this._handler)||void 0===i?void 0:i.pc,null===(o=this._stream)||void 0===o||null===(a=o.audioTrack)||void 0===a?void 0:a.getTrack("preprocessing"));case 3:return s=e.sent,e.abrupt("return",cS(s).call(s,function(e){return"outbound-rtp"===e.type}));case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_watchForFirstVideoFrameSend",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval(a2(a0().mark(function n(){var i,o,a;return a0().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e._getFirstVideoFrameStats();case 2:if(i=n.so+=e.framesSent,a+=e.packetsSent}),!(i&&i.length>0&&(o>t||a>r))){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=o,r=a,n.abrupt("return");case 10:e.sendFrameFinish("video"),window.clearInterval(e._firstVideoFrameInterval);case 12:case"end":return n.stop()}},n)})),100)}},{key:"_watchForFirstAudioFrameSend",value:function(){var e=this,t=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval(a2(a0().mark(function r(){var n;return a0().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e._getFirstAudioFrameStats();case 2:if(!((n=r.sent)&&n.packetsSent>t)){r.next=9;break}if(-1!==t){r.next=7;break}return t=n.packetsSent,r.abrupt("return");case 7:e.sendFrameFinish("audio"),window.clearInterval(e._firstAudioFrameInterval);case 9:case"end":return r.stop()}},r)})),100)}},{key:"reset",value:function(){this._login=!1,this._publisher=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoPublish=!1,this._publish=!1,this._audioFirstFrameState=0,this._videoFirstFrameState=0,this._currentAudioSend={startTime:0,eventSessionId:0,type:"login"},this._currentVideoSend={startTime:0,eventSessionId:0,type:"login"},window.clearTimeout(this._firstAudioFrameTimer),window.clearTimeout(this._firstVideoFrameTimer),window.clearInterval(this._firstAudioFrameInterval),window.clearInterval(this._firstVideoFramhis._stream,delete this._handler}},{key:"_audioSending",get:function(){return 1===this._audioFirstFrameState}},{key:"_videoSending",get:function(){return 1===this._videoFirstFrameState}}]),r}(),ED=(iT(EA={},"audio",{delay:1200,stallRadio:.3}),iT(EA,"video",{delay:1200,stallRadio:.6}),iT(EA,"screen_audio",{delay:1600,stallRadio:.8}),iT(EA,"screen_video",{delay:1600,stallRadio:.8}),EA),EM=function(){function e(){iE(this,e),iT(this,"_preUplinkStats",new sF),iT(this,"_preDownlinkStats",new sF),iT(this,"_timer",void 0),iT(this,"_delayTimer",void 0),iT(this,"_msc",void 0),iT(this,"reportor",void 0)}return ib(e,[{key:"updateUplinkStats",value:function(e){var t=e.audioStats,r=e.videoStats,n=e.isScreen;if(t.sendKBitrate>0&&t.rtt){var i,o,a=n?"screen_audio":"audio",s=t.rtt,c=t._fractionLost,u=t._retransmittedRate,d=this._getQosLevel(s,c||0,u||0),l=this._preUplinkStats.get(a)||[d];this._preUplinkStats.set(a,a$(i=a4(o=[]).call(o,ud(l),[d])).call(i,-2))}if(r.sentKBitrate>0&&r.rtt){var h,_,p=n?"screen_video":"video",v=r._fractionLost,f=r.rtt,m=r._sendBandWidth,g=r._retransmittedRate;0===m&&(v=Math.max(.65,v));var y=this._getQosLevel(f,v||0,g||0),S=this._preUplinkStats.get(p)||[y];this._preUplinkStats.set(p,a$(h=a4(_=[]).call(_,ud(S),[y])).call(h,-2))}this._startNetworkQualityReport()}},{key:"updateDownlinkStats",value:function(e,t){if(t){var r,n,i=this._getStreamActiveState(t),o=i.audioActive,a=i.videoActive,s=e.audioStats,c=e.videoStats,u=e.isScreen,d=e.userId;if(o){if(0===s.receivedKBitrate)r=lE.VBAD;else{var l=s.rtt,h=s.audioLossRate,_=s.stallDuration,p=s.statsInterval,v=s.e2eDelay,f=this._getQosLevel(l,h||0,c._retransmittedRate||0),m=this._getDownlinkQoE(u?"screen_audio":"audio",_/p,v);r=this._getNetworkQuality(f,m)}}if(a){if(0===c.receivedKBitrate||0===c.rtt)n=lE.VBAD;else{var g=c.rtt,y=c.videoLossRate,S=c.stallDuration,b=c.statsInterval,E=c.e2eDelay,T=c._retransmittedRate,k=this._getQosLevel(g,y||0,T||0),I=this._getDownlinkQoE(u?"screen_video":"video",S/b,E);n=this._getNetworkQuality(k,I)}}var R=r&&n?Math.ceil((r+n)/2):r||n;if(R){var A,C,w,x=a4(A="".concat(d)).call(A,u?"_screen":""),O=this._preDownlinkStats.get(x)||[R];this._preDownlinkStats.set(x,a$(C=a4(w=[]).call(w,ud(O),[R])).call(C,-2)),this._startNetworkQualityReport()}}}},{key:"setMSC",value:function(e){this._msc=e}},{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._delayTimer&&(window.clearTimeout(this._delayTimer),delete this._delayTimer),this._preUplinkStats.clear(),this._preDownlinkStats.clear()}},{key:"_startNetworkQualityReport",value:function(){var e=this;this._delayTimer||this._timer||(this._preUplinkStats.size>0||this._preDownlinkStats.size>0)&&(this._delayTimer=window.setTimeout(function(){delete e._delayTimer,e._reportNetworkQuality(),e._timer=window.setInterval(function(){e._reportNetworkQuality()},2e3)},300))}},{key:"_reportNetworkQuality",value:function(){var e,t,r,n,i,o=this;if(c1(e=["connected","connecting"]).call(e,null===(t=this._msc)||void 0===t||null===(r=t.handler)||void 0===r?void 0:r.getConnectionState())){var a,s,c,u=this._getBetterQualityAndRemoveOldest("audio","up"),d=this._getBetterQualityAndRemoveOldest("video","up");n=u&&d?Math.ceil((u+d)/2):u||d||this._getBetterQualityAndRemoveOldest("screen_video","up")||this._getBetterQualityAndRemoveOldest("screen_audio","up")||lE.EXCELLENT;var l=cG(a=se(s=uc(hN(c=this._pQualityAndRemoveOldest(e,"down")})).call(a,function(e){re.call(l,function(e,t){return t+e},0)/l.length)||lE.UNKNOWN}else n=i=lE.DOWN;navigator.onLine||(n=lE.DOWN,i=lE.DOWN),"function"==typeof this.reportor&&this.reportor(n,i)}},{key:"_getNetworkQuality",value:function(e,t){return 1===t?Math.max(e-2,1):2===t?e:Math.min(e+1,5)}},{key:"_getQosLevel",value:function(e,t,r){var n;return n=(!e||e<=250)&&t<=.15?1:(!e||e<=500)&&t<=.3?2:(!e||e<=750)&&t<=.45?3:(!e||e<=1e3)&&t<=.6?4:5,r>.5?n=Math.max(n,4):r>.35?n=Math.max(n,3):r>.15&&(n=Math.max(n,2)),n}},{key:"_getUplinkQoE",value:function(e,t){var r=0;switch(e){case"audio":case"video":r=t<.05?1:t<.1?2:3;break;case"screen_video":case"screen_audio":r=t<.04?1:t<.08?2:3}return r}},{key:"_getDownlinkQoE",value:function(e,t,r){var n=ED[e];return t>n.stallRadio||r>n.delay||t>n.stallRadio/2&&r>n.delay/2?3:(t>n.stallRadio/2||n.delay,2)}},{key:"_getBetterQualityAndRemoveOldest",value:function(e,t){var r=lE.UNKNOWN,n="up"===t?this._preUplinkStats:this._preDownlinkStats,i=G(i).call(i,function(e){return e});o.length>0&&(r=Math.min.apply(Math,ud(o))),i.shift(),0===i.length&&n.delete(e)}return r}},{key:"_getStreamActiveState",value:function(e){var t=e.subMediaType,r=e._attributes,n=e.subVideo;return{audioActive:e.subAudio&&vc(t)&&r.localaudio&&r.audiostream,videoActive:n&&vu(t)&&r.localvideo&&r.videostream}}}]),e}(),EL=function(){function e(t){iE(this,e),iT(this,"_timer",void 0),iT(this,"_remoteVideoSizeCache",{}),iT(this,"_remoteScreenSizeCache",{}),iT(this,"onchange",void 0),this._room=t,this._start()}return ib(e,[{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._remoteVideoSizeCache={},this._remoteScreenSizeCache={}}},{key:"_start",value:function(){var e=this;this._timer||(this._timer=window.setInterval(function(){var t={},r={};e._room.remoteStreams.forEach(function(n,i){n.forEach(function(n){var o,a=null===(o=n.videoTrack)||void 0===o?void 0:o.getTrack();if(a){var s=n.isScreen?e._remoteScreenSizeCache:e._remoteVideoSizeCache,c=s[i]||{},u=c.width,d=c.height,l=a.getSettings(),h=l.width,_=void 0===h?0:h,p=l.height,v=void 0===p?0:p;(void 0===d?0:d)===v&&(void 0===u?0:u)===_||"function"==typeof e.onchange&&e.onchange(i,n.isScreen,_,v),delete s[i],(n.isScreen?r:t)[i]={width:_,height:v}}})}),sJ(e._remoteVideoSizeCache).forEach(function(t){"function"==typeof e.onchange&&e.onchange(t,!1,0,0)}),sJ(e._remoteScreenSizeCache).forEach(function(t){"function"==typeof e.onchange&&e.onchange(t,!0,0,0)}),e._remoteVideoSizeCache=t,e._remoteScreenSizeCache=r},1e3))}}]),e}(),EU=uc((new TextEncoder).encode("subt")),EV={1:le.SUBTITLE_ERR_POSTPROCESS,2:le.SUBTITLE_ERR_CONNECTION_ERROR,3:le.SUBTITLE_ERR_PROCESS_ERROR},EF=new h1("SubtitleTool",1),EB=function(e){if(e.extraInfo)try{var t,r=JSON.parse(e.extraInfo);r.source_language&&cA(t=["zh","en","ja"]).call(t,r.source_language)}catch(e){}else{var n,i,o=(null===(n=navigator.language)||void 0===n?void 0:n.substring(0,2))||"";cA(i=["zh","en","ja"]).call(i,o)>-1&&(e.extraInfo=a6({source_language:o}))}},Ej=function(){var e,t,r;function n(e){var t,r,i;iE(this,n),iT(this,"_taskId",void 0),iT(this,"_appId",void 0),iT(this,"_roomId",void 0),iT(this,"_userId",void 0),iT(this,"onEvent",void 0),iT(this,"onMessage",void 0),iT(this,"_preConfig",void 0),iT(this,"_timer",void 0),this._room=e,this._appId=null===(t=this._room._roomInfo)||void 0===t?void 0:t.appId,this._roomId=null===(r=this._room._roomInfo)||void 0===r?void 0:r.roomId,this._userId=null===(i=this._room._roomInfo)||void 0===i?void 0:i.userInfo.userId}return ib(n,[{key:"start",value:(r=a2(a0().mark(function e(t){var r=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(EF.info("start","Invoke config: %o",t),fd(t.mode,"mode",[lw.ASR_ONLY,lw.ASR_AND_TRANSLATION]),t.mode!==lw.ASR_AND_TRANSLATION||-1!==cA(EH).call(EH,t.targetLanguage||"")){e.next=4;break}throw new lM(le.INVALID_PARAMS,"Invalid targetLanguage.");case 4:if(!this._taskId){e.next=6;break}throw new lM(le.SUBTITLE_ALREADY_ON,"Already turned on subtitle");case 6:return this._preConfig=t,this._taskId=(Date.now().toString()+this._roomId+this._userId).substring(0,20),e.next=10,this._room.subtitleControlMessage(this._genSubtitleSignaling("started",t,this._taskId));case 10:this._preConfig=t,this._timer=self.setTimeout(function(){var e;null===(e=r.onEvent)||void 0===e||e.call(r,{event:lx.ERROR,errorCode:le.TIME_OUT,errorMessage:"start subtitle timeout."}),delete r._timer,r.stop()},3e4);case 12:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"update",value:(t=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(fd(t.mode,"mode",[lw.ASR_ONLY,lw.ASR_AND_TRANSLATION]),t.mode!==lw.ASR_AND_TRANSLATION||-1!==cA(EH).call(EH,t.targetLanguage||"")){e.next=3;break}throw new lM(le.INVALID_PARAMS,"Invalid targetLanguage.");case 3:if(!this._taskId){e.next=5;break}throw new lM(le.SUBTITLE_ALREADY_ON,"Already started subtitle");case 5:if(this._taskId){e.next=7;break}throw new lM(le.SUBTITLE_NOT_TURNED_ON,"Start subtitle first.");case 7:if((null===(r=this._preConfig)||void 0===r?void 0:r.mode)===t.mode&&this._preConfig.targetLanguage===t.targetLanguage){e.next=11;break}return this._preConfig=t,e.next=11,this._room.subtitleControlMessage(this._genSubtitleSignaling("update",t,this._taskId));case 11:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"stop",value:function(){var e=this;EF.info("stop","Invoke"),this._taskId&&this._room.subtitleControlMessage({type:"subtitle",action:"stopped",appId:this._appId,roomId:this._roomId,userId:this._userId,taskId:this._taskId}).finally(function(){var t;delete e._taskId,null===(t=e.onEvent)||void 0===t||t.call(e,{event:lx.STOPPED}),e._clearTimer()})}},{key:"reconnect",value:(e=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._taskId||!this._preConfig){e.next=5;break}return e.next=3,this._room.subtitleControlMessage({type:"subtitle",action:"stopped",appId:this._appId,roomId:this._roomId,userId:this._userId,taskId:this._taskId});case 3:delete this._taskId,this.start(this._preConfig);case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"getConfig",value:function(){return this._preConfig}},{key:"destroy",value:function(){EF.info("destroy","Invoke"),this.stop(),delete this._preConfig,delete this._taskId}},{key:"onResult",value:function(e){var t,r=e.body,n=r.error,i=r.errorMessage,o=r.eventType;if(0!==n){var a,s=new lM(EV[n]||le.SUBTITLE_ERR_UNKNOWN,i||"");null===(a=this.onEvent)||void 0===a||a.call(this,{event:lx.ERROR,errorCode:s.code,errorMessage:s.message}),this._clearTimer()}else"SubtitleStarted"===o&&(null===(t=this.onEvent)||void 0===t||t.call(this,{event:lx.STARTED}),this._clearTimer())}},{key:"onMessageRecv",value:function(e){if(this._taskId&&this._preConfig){var t=EG(e);if(t&&t.length>0){var r,n=this._preConfig,i=n.mode,o=n.targetLanguage,a=[];t.forEach(function(e){i===lw.ASR_ONLY?e.mode===i&&a.push(e):i===lw.ASR_AND_TRANSLATION&&(e.language!==o&&e.mode!==lw.ASR_ONLY||a.push(e),e.mode===lw.ASR_ONLY&&e.language===o&&a.push(dr(dr({},e),{},{mode:lw.ASR_AND_TRANSLATION})))}),a.length>0&&(null===(r=this.onMessage)||void 0===r||r.call(this,a))}return!!t}return!1}},{key:"_genSubtitleSignaling",value:function(e,t,r){return{taskId:r,type:"subtitle",action:e,roomId:this._roomId,appId:this._appId,userId:this._userId,subtitleMeta:{subtitleConfig:{mode:t.mode,usersConfig:[{userId:this._userId,targetLanguages:[t.targetLanguage||""]}]},vendorConfig:{typthis._timer),delete this._timer)}}]),n}(),EG=function(e){var t=e.message;if(t instanceof ArrayBuffer&&t.byteLength>8)try{var r=new DataView(t,0),n=0;if(EU.every(function(e){return r.getUint8(n++)===e})){var i=r.getUint32(n);if(n+=4,i===r.byteLength-8){var o=vt.ab2str(a$(t).call(t,8)),a=JSON.parse(o),s=a.data;if("subtitle"===a.type)return s}}}catch(e){}return!1},EH=["zh","zh-Hant","tn","vi","iu","it","id","hi","en","ho","he","es","el","uk","ur","tk","tr","ti","ty","tl","to","th","ta","te","sl","sk","ss","eo","sm","sg","st","sv","ja","tw","qu","pt","pa","no","nb","nr","my","bn","mn","mh","mk","ml","mr","ms","lu","ro","lt","lv","lo","kj","hr","kn","ki","cs","ca","nl","ko","ht","gu","ka","kl","km","lg","kg","fi","fj","fr","ru","ng","de","tt","da","ts","cv","fa","bs","pl","bi","nd","ba","bg","az","ar","af","sq","ab","os","ee","et","ay","lzh","am","ckb","cy","gl","ha","hy","ig","kmr","ln","nso","ny","om","sn",o))||o);return n&&o&&to(t,r,o),o},EK=function(){var e,t,r,n,i,o;function a(e){iE(this,a),iT(this,"_forwardDstRooms",new sF),iT(this,"forwardStreamState","stopped"),iT(this,"_monitor",void 0),this._room=e,this._monitor=pZ(this._room.id)}return ib(a,[{key:"startForwardStream2Rooms",value:(o=a2(a0().mark(function e(t){var r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("running"!==this.forwardStreamState&&"paused"!==this.forwardStreamState){e.next=2;break}throw new lM(le.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke startForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:return e.next=4,this._sendForwardStreamSignaling("start",this._room.roomInfo.roomId,t);case 4:return r=e.sent,this._updateDstRooms(t,r),n=this._transformForwardStreamResult(r),this.forwardStreamState="running",e.abrupt("return",n);case 9:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"updateForwardStream2Rooms",value:(i=a2(a0().mark(function e(t){var r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("stopped"!==this.forwardStreamState){e.next=2;break}throw new lM(le.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke updateForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:if(r=this._mockForwardStreamResult(t),"running"!==this.forwardStreamState){e.next=7;break}return e.next=6,this._sendForwardStreamSignaling("update",this._room._roomInfo.roomId,t);case 6:r=e.sent;case 7:return this._updateDstRooms(t,r),n=this._transformForwardStreamResult(r),e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"stopForwardStream2Rooms",value:(n=a2(a0().mark(function e(){var t,r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("stopped"!==this.forwardStreamState){e.next=2;break}throw new lM(le.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke stopForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:if(r=this._mockForwardStreamResult([]),"running"!==this.forwardStreamState){e.next=7;break}return e.next=6,this._sendForwardStreamSignaling("stop",this._room._roomInfo.roomId);case 6:r=e.sent;case 7:if(this._updateDstRooms([],r),!(ud(hN(t=this._forwardDstRooms).call(t)).length>0)){e.next=10;break}throw new lM(le.UNEXPECTED_ERROR,"stopforwardstream failed: ".concat(a6(r)));case 10:return n=this._transformForwardStreamResult(r),this.forwardStreamState="stopped",e.abrupt("return",n);case 13:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"pauseForwardStream2AllRooms",value:(r=a2(a0().mark(function e(){var t,r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("paused"!==this.forwardStreamState&&"stopped"!==this.forwardStreamState){e.next=2;break}throw new lM(le.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke pauseForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));case 2:return e.next=4,this._sendForwardStreamSignaling("stop",this._room._roomInfo.roomId);case 4:return t=e.sent,r=this._transformForwardStreamResult(t),this.forwardStreamState="paused",e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"resumeForwardStream2AllRooms",value:(t=a2(a0().mark(function e(){var t,r,n,i,o=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o.length>0&&void 0!==o[0]&&o[0]||!c1(t=["running","stopped"]).call(t,this.forwardStreamState)){e.next=3;break}throw new lM(le.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke resumeForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));case 3:return r=this._getDstRooms(),e.next=6,this._sendForwardStreamSignaling("start",this._room._roomInfo.roomId,r);case 6:return n=e.sent,this._updateDstRooms(r,n),i=this._transformForwardStreamResult(n),this.forwardStreamState="running",e.abrupt("return",i);case 11:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"resumeFromReconnect",value:function(){var e=this;"running"===this.forwardStreamState&&this.resumeForwardStream2AllRooms(!0).then(function(t){t.forEach(function(t){t.state===lO.FORWARD_STREAM_STATE_FAILURE&&e._room.safeEmit(yX.ON_FORWARD_STREAM_ERROR,t)})})}},{key:"onForwardDstRoomUserKick",value:function(e){var t=[{dstRoomId:e.dstRoomId,code:200,forwardStreamType:"stop"}];this._updateDstRooms([],t),this._room.safeEmit(yX.ON_FORWARD_STREAM_ERROR,{roomId:e.dstRoomId,state:lO.FORWARD_STREAM_STATE_FAILURE,error:lN.FORWARD_STREAM_ERROR_REMhis.forwardStreamState="stopped"}},{key:"_mockForwardStreamResult",value:function(e){var t=this,r=[];return this._forwardDstRooms.forEach(function(e,t){r.push({dstRoomId:t,forwardStreamType:"stop",code:200})}),e.forEach(function(e){var n,i=d3(r).call(r,function(t){return t.dstRoomId===e.roomId});-1===i?r.push({dstRoomId:e.roomId,forwardStreamType:"start",code:e.roomId===(null===(n=t._room.roomInfo)||void 0===n?void 0:n.roomId)?400:200}):r[i].forwardStreamType="update"}),r}},{key:"_transformForwardStreamResult",value:function(e){e||(e=[]);var t,r=[],n=u2(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=i.dstRoomId,a=i.code,s={roomId:o,state:lO.FORWARD_STREAM_STATE_SUCCESS,error:lN.FORWARD_STREAM_ERROR_OK};200===a||(400===a?(s.state=lO.FORWARD_STREAM_STATE_FAILURE,s.error=lN.FORWARD_STREAM_ERROR_REMOTE_KICKED):a>=700&&a<800?(s.state=lO.FORWARD_STREAM_STATE_FAILURE,s.error=lN.FORWARD_STREAM_ERROR_INVALID_TOKEN):(s.state=lO.FORWARD_STREAM_STATE_FAILURE,s.error=lN.FORWARD_STREAM_ERROR_RESPONSE)),r.push(s)}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"_updateDstRooms",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===(null==r?void 0:r.length)&&this._forwardDstRooms.clear(),r.forEach(function(r){var n=r.dstRoomId,i=r.code,o=r.forwardStreamType;if(200===i){if("stop"===o)t._forwardDstRooms.delete(n);else{var a,s=cS(e).call(e,function(e){return e.roomId===n});if(!s&&!t._forwardDstRooms.has(n))throw new lM(le.UNEXPECTED_ERROR,"unknow roomid ".concat(n," in signaling return"));var c=null!==(a=t._forwardDstRooms.get(n))&&void 0!==a?a:{token:void 0};c=s8(c,s),t._forwardDstRooms.set(n,c)}}else t._forwardDstRooms.has(n)&&t._forwardDstRooms.delete(n)})}},{key:"_getDstRooms",value:function(){var e=[];rete.push({roomId:r,token:t.token})}),e}},{key:"_sendForwardStreamSignaling",value:(e=a2(a0().mark(function e(t,r,n){var i,o,a,s,c,u,d,l,h;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(ll(n,function(e){return e.roomId}),null===(o=this._monitor)||void 0===o||o.report("rtc_forward_stream",{type:"begin",dction(e){return'"'.concat(e,'"')}).join(",")," }"),event_session_id:i})),e.next=4,this._room._mediaServerClient.sendForwardStreamSignal(t,r,n);case 4:if(s=e.sent,c=[],200===(null==s?void 0:s.code)){e.next=9;break}throw"stop"!==t&&(null==n||n.forEach(function(e){c.push({dst_room_id:e.roomId,result:"server error ".concat(null==s?void 0:s.code)})}),null===(u=this._monitor)||void 0===u||u.report("rtc_forward_stream",{type:"end",dst_rooms:a6(c),event_session_id:i})),new lM(le.UNEXPECTED_ERROR,"server side internal error, error code: ".concat(s));case 9:return"stop"!==t&&(null===(d=s.forwardStretRoomId,result:"dst room lost"})}),null===(l=s.forwardStreamResults)||void 0===l||l.forEach(function(e){var t=cS(c).call(c,function(t){return t.dst_room_id===e.dstRoomId});t&&(200===e.code?"update"===e.forwardStreamType?t.result="update":t.result="success":t.result="server error ".concat(e.code))}),null===(h=this._monitor)||void 0===h||h.report("rtc_forward_stream",{type:"end",dst_rooms:a6(c),event_session_id:i})),e.abrupt("return",s.forwardStreamResults);case 11:case"end":return e.stop()}},e,this)})),function(t,r,n){return e.apply(this,arguments)})}]),a}();function EX(e,t,r){var n=r.value;return r.value=a2(a0().mark(function e(){var r,i,o,a,s=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=this._room._roomInfo)||void 0===r||!r.roomId){e.next=7;break}for(o=Array(i=s.length),a=0;a<i;a++)o[a]=s[a];return e.next=4,n.apply(this,o);case 4:return e.abrupt("return",e.sent);case 7:throw new lM(le.NOT_CONNECTED_YET,"error in ".concat(t,": try again after joined"));case 8:case"end":return e.stop()}},e,this)})),r}Ez([EX],EK.prototype,"startForwardStream2Rooms",1),Ez([EX],EK.prototype,"updateForwardStream2Rooms",1),Ez([EX],EK.prototype,"stopForwardStream2Rooms",1),Ez([EX],EK.prototype,"pauseForwardStream2AllRooms",1),Ez([EX],EK.prototype,"resumeForwardStream2AllRooms",1);var EW=new h1("Room",1),Eq={audiostream:!0,extaudio:!1,extvideo:!1,localaudio:!0,localvideo:!1,videoDescriptions:[],videostream:!1,publishTime:0},EY=function(e){dy(O,fR);var t,r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x=dC(O);function O(e,t){var r;return iE(this,O),iT(dn(r=x.call(this)),"id",void 0),iT(dn(r),"_mediaServerClient",void 0),iT(dn(r),"_localStream",void 0),iT(dn(r),"_localScreenStream",void 0),iT(dn(r),"_remoteUsers",new sF),iT(dn(r),"_remoteStreams",new sF),iT(dn(r),"_remoteStreamStreamIdUserIdMap",{}),iT(dn(r),"_virtualStreams",[]),iT(dn(r),"_context",void 0),iT(dn(r),"_sessionId",void 0),iT(dn(r),"_connectionLostTimer",void 0),iT(dn(r),"_serverConfig",void 0),iT(dn(r),"_roomConfig",void 0),iT(dn(r),"_roomInfo",void 0),iT(dn(r),"_userDuplicateLoginTimerMap",new sF),iT(dn(r),"_networkQualityManager",void 0),iT(dn(r),"_videoSizeObserver",void 0),iT(dn(r),"_hasPublished",!1),iT(dn(r),"_subtitleTool",void 0),iT(dn(r),"_csrcUserIdMap",void 0),iT(dn(r),"_publishOnDemandItem",void 0),iT(dn(r),"_onceTriggerBySignal",!1),iT(dn(r),"_pubTransceiverReady",!1),iT(dn(r),"_publishOnDemandBusy",!1),iT(dn(r),"_monitor",void 0),iT(dn(r),"_forwardStreamManager",void 0),EW.info("constructor","invoke"),r.id=t.id,r._roomConfig=e,r._mediaServerClient=new Ed(t),r._networkQualityManager=new EM,r._networkQualityManager.reportor=r._reportNetworkQuality.bind(dn(r)),r._videoSizeObserver=new EL(dn(r)),r._videoSizeObserver.onchange=r._emitVideoSizeChange.bind(dn(r)),r._context=t,r._csrcUserIdMap={},r._monitor=pZ(r.id),r._forwardStreamManager=new EK(dn(r)),r._addHandlerEventHandler(),r}return ib(O,[{key:"hasScreenPublished",get:function(){var e;return null===(e=this._localScreenStream)||void 0===e?void 0:e.hasPuvoid 0===e?void 0:e.hasPublished}},{key:"connectionState",get:function(){return this._mediaServerClient.connectionState}},{key:"remoteUsers",get:function(){return this._remoteUsers}},{key:"remoteStreams",get:function(){return this._remoteStreams}},{key:"localStream",get:function(){return this._localStream}},{key:"localScreenStream",get:function(){return this._localScreenStream}},{key:"roomInfo",get:function(){return this._roomInfo}},{key:"roomConfig",set:function(e){this._roomConfig=e}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,N,P=this;null===(e=this._mediaServerClient)||void 0===e||e.on(yV.ON_ADD_STREAM,this._onAddStream.bind(this)),null===(t=this._mediaServerClient)||void 0===t||t.on(yV.ON_ADD_STREAM_LIST,function(e){Array.isArray(null==e?void 0:e.streamList)&&e.streamList.forEach(function(e){return P._onAddStream(e)})}),null===(r=this._mediaServerClient)||void 0===r||r.on(yV.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null===(n=this._mediaServerClient)||void 0===n||n.on(yV.ON_REMOVE_STREAM_LIST,function(e){Array.isArray(null==e?void 0:e.streamList)&&e.streamList.forEach(function(e){return P._onRemoveStream(e)})}),null===(i=this._mediaServerClient)||void 0===i||i.on(yV.USER_CONNECTION,this._onUserConnection.bind(this)),null===(o=this._mediaServerClient)||void 0===o||o.on(yV.USER_CONNECTION_LIST,function(e){Array.isArray(null==e?void 0:e.userList)&&e.userList.forEach(function(e){return P._onUserConnection(e)})}),null===(a=this._mediaServerClient)||void 0===a||a.on(yV.USER_DISCONNECTION,this._onUserDisconnection.bind(this)),null===(s=this._mediaServerClient)||void 0===s||s.on(yV.USER_DISCONNECTION_LIST,function(e){Array.isArray(null==e?void 0:e.userList)&&e.userList.forEach(function(e){return P._onUserDisconnection(e)})}),null===(c=this._mediaServerClient)||void 0===c||c.on(yV.ON_UPDATE_ROOM_ATTRIBUTES,this._onUpdateRoomAttributes.bind(this)),null===(u=this._mediaServerClient)||void 0===u||u.on(yV.ON_UPDATE_USER_ATTRIBUTES,this._onUpdateUserAttributes.bind(this)),null===(d=this._mediaServerClient)||void 0===d||d.on(yV.ON_UPDATE_STREAM_ATTRIBUTES,this._onUpdateStreamAttributes.bind(this)),null===(l=this._mediaServerClient)||void 0===l||l.on(yV.ON_PUSH_TRACK,this._onPushTrack.bind(this)),null===(h=this._mediaServerClient)||void 0===h||h.on(yV.ON_REMOVE_TRACK,this._onRemoveTrack.bind(this)),null===(_=this._mediaServerClient)||void 0===_||_.on(yV.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null===(p=this._mediaServerClient)||void 0===p||p.on(yV.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null===(v=this._mediaServerClient)||void 0===v||v.on(yV.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null===(f=this._mediaServerClient)||void 0===f||f.on(yV.POST_PROCESSING_MESSAGE,this._onPostProcessingMessage.bind(this)),null===(m=this._mediaServerClient)||void 0===m||m.on(yV.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null===(g=this._mediaServerClient)||void 0===g||g.on(yV.STREAM_CONTROL_MESSAGE,this._onStreamControlMessage.bind(this)),null===(y=this._mediaServerClient)||void 0===y||y.on(yV.ON_STREAM_FAILED,this._onStreamFailed.bind(this)),null===(S=this._mediaServerClient)||void 0===S||S.on(yF.RSCP,function(e,t){cS(e).call(e,function(e){var t,r,n;return null==e||null===(t=e.StreamIds)||void 0===t?void 0:c1(t).call(t,null===(r=P._localStream)||void 0===r||null===(n=r.stream)||void 0===n?void 0:n.id)})&&(t?P._pubTransceiverReady=!0:P._onceTriggerBySignal=!0,t&&P._onceTriggerBySignal||(P._publishOnDemandItem=e),P._pubTransceiverReady&&P._onPublishOnDemand())}),null===(b=this._mediaServerClient)||void 0===b||b.on(yF.RTT,this._onRTT.bind(this)),null===(E=this._mediaServerClient)||void 0===E||E.on(yF.SSC,this._onSSC.bind(this)),null===(T=this._mediaServerClient)||void 0===T||T.on(yB.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),null===(k=this._mediaServerClient)||void 0===k||k.on(yB.ENDOR_CONNECTION_STATE_CHANGE,e)}),null===(I=this._mediaServerClient)||void 0===I||I.on(yV.ON_SPEAKER_CHANGE,this._onMeetingSpeakerChange.bind(this)),null===(R=this._mediaServerClient)||void 0===R||R.on("onRemoteStreamStats",function(e){P._networkQualityManager.updateDownlinkStats(e,P._findRemoteStreamByScreen(e.userId,e.isScreen)),P.emit(yX.ON_REMOTE_STREAM_STATS,vd(e))}),null===(A=this._mediaServerClient)||void 0===A||A.on(yX.RESUBSCRIBE,function(e){P.emit(yX.RESUBSCRIBE,e)}),null===(C=this._mediaServerClient)||void 0===C||C.on(yX.RECONNECT_FAILED,function(){P.emit(yX.RECONNECT_FAILED)}),null===(w=this._mediaServerClient)||void 0===w||w.on("joinSuccess",this._onJoinSucc.bind(this)),null===(x=this._mediaServerClient)||void 0===x||x.on(yV.ON_FORWARD_DST_ROOM_USER_KICK,this._forwardStreamManager.onForwardDstRoomUserKick.bind(this._forwardStreamManager)),null===(O=this._mediaServerClient)||void 0===O||O.on(yX.ON_REJOIN_WITH_TCP,function(){P.emit(yX.ON_REJOIN_WITH_TCP)}),null===(N=this._mediaServerClient)||void 0===Nemit(yX.ON_ICE_CONNECT_WITH_TCP)})}},{key:"_onLocalStreamStats",value:function(e){this._networkQualityManager.updateUplinkStats(e),this.emit(yX.ON_LOCAL_STREAM_STATS,vd(e))}},{key:"id 0===e||e.removeAllListeners()}},{key:"connect",value:(w=a2(a0().maase 2:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"join",value:(C=a2(a0().mark(function e(t,r,n,i,o){var a,s,c;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null===(a=this._monitor)||void 0===a||a.set({rtc_app_id:t,room_id:r,user_id:i.userId}),EW.info("join()"),this._mediaServerClient.setLiveControlMessage(o),this._roomInfo={appId:t,roomId:r,token:n,userInfo:i,roomProfile:this._roomConfig.roomProfileType},this.setSessionId(),e.prev=5,e.next=8,this._mediaServerClient.join(this._roomInfo);case 8:return null!==(s=(c=e.sent).roomAttributes)&&void 0!==s&&s.multiChatMode&&this._handleFFAudioTrack(),this._initSubtitleTool(),e.abrupt("return",{users:c.clients,streams:c.streams});case 14:if(e.prev=14,e.t0=e.catch(5),e.t0.code===le.OPERATION_CANCEL){e.next=18;break}throw e.t0;case 18:case"end":return e.stop()}},e,this,[[5,14]])})),function(e,t,r,n,i){return C.apply(this,arguments)})},{key:"publishScreen",value:(A=a2(a0().mark(function e(t,r,n,i,o){var a,s,c,u,d,l,h,_,p,v,f,m;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(EW.info("publishScreen()"),this._localScreenStream||(this._localScreenStream=new yE(this._context),null!==(a=this._mediaServerClient)&&void 0!==a&&null!==(s=a.vendorConfig)&&void 0!==s&&s.enableMultiVendor&&(this._localScreenStream.pcSessionId=hF()),this._localScreenStream.isScreen=!0,this._mediaServerClient.handler&&(this._localScreenStream.observer=new EP(this._localScreenStream,this._mediaServerClient.handler))),c=!1,u=!1,d=!1,l=!1,!this._localScreenStream.videoTrack&&r?(r instanceof gk&&(u=!0),c=!0):this._localScreenStream.videoTrack&&!r&&(c=!1),!this._localScreenStream.audioTrack&&n?(n instanceof gI&&(l=!0),d=!0):this._localScreenStream.audioTrack&&!n&&(d=!1),this._localScreenStream.videoTrack=r,this._localScreenStream.audioTrack=n,this._localScreenStream.videoEncodeConfig=t,i&&(vc(i)&&(this._localScreenStream.pubAudio=o===yq.PUB),vu(i)&&(this._localScreenStream.pubVideo=o===yq.PUB),EW.info("publishScreen mediaType","pubAudio: %o, pubVideo: %o",this._localScreenStream.pubAudio,this._localScreenStream.pubVideo)),this._localScreenStream.pubAudio||this._localScreenStream.pubVideo){e.next=18;break}if(null===(h=this._localScreenStream)||void 0===h||!h.hasPublished){e.next=17;break}return e.abrupt("return",this.unpublishScreen());case 17:return e.abrupt("return");case 18:if(this._localScreenStream.hasPublished){e.next=24;break}return null===(_=this._localScreenStream.observer)||void 0===_||_.setPublish(!0),e.next=22,this._mediaServerClient.publish(this._localScreenStream);case 22:e.next=28;break;case 24:return u?null===(p=this._localScreenStream.observer)||void 0===p||p.setPushVideo(c):null===(v=this._localScreenStream.observer)||void 0===v||v.setEnableVideo(c),l?null===(f=this._localScreenStream.observer)||void 0===f||f.setPushAudio(d):null===(m=this._localScreenStream.observer)||void 0===m||m.setEnableAudio(d),e.next=28,this.updatePubScreenTrack();case 28:this._localScreenStream.pubAudio||this._localScreenStream.pubVideo?this._localScreenStream.startReport(this._onLocalStreamStats.bind(this),this._mediaServerClient.handler):this._localScreenStream.stopReport("unpublish screen");case 29:case"){return A.apply(this,arguments)})},{key:"updatePubScreenTrack",value:(R=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(EW.info("updatePubScreenTrack","Invoke updatePubScreenTrack"),!this._localScreenStream){e.next=4;break}return e.next=4,this._mediaServerClient.updatePubTrack(this._localScreenStream);case 4:case"end":return e.stop()}},e,this)})),function(){return R.apply(this,arguments)})},{key:"unpublishScreen",value:(I=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(EW.info("unpublish","Invoke unpublishScreen"),!this._localScreenStream){e.next=8;break}return null===(t=this._localScreenStream.observer)||void 0===t||t.setPublish(!1),e.next=5,this._mediaServerClient.unpublish(this._localScreenStream);case 5:this._localScreenStream.stopReport("unpublish screen"),this._localScreenStream.clean(),this._localScreenStream=void 0;case 8:case"end":return e.stop()}},e,this)})),function(){return I.apply(this,arguments)})},{key:"liveControlMessage",value:(k=a2(a0().mark(function e(t){var r,n=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return EW.info("controlMessage","Invoke controlMessage"),null===(r=t.transcodeMeta)||voifo&&(e.roomID=n.roomInfo.roomId)}),e.next=4,this._mediaServerClient.controlMessage(t);case 4:this._mediaServerClient.setLiveControlMessage("stopped"===t.action?void 0:t);case 5:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"publicStreamControlMessage",value:(T=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"stopped"===t.action&&delete t.publicStreamMeta,e.next=3,this._mediaServerClient.controlMessage(t);case 3:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"subtitleConte"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"updateUserAttributes",value:(b=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return EW.info("updateUserAttributes","Invoke updateUserAttributes"),t.role&&this._roomInfo&&(this._roomInfo.userInfo.role=t.role),e.next=4,this._mediaServerClient.updateUserAttributes(t);case 4:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"publish",value:(S=a2(a0().mark(function e(t,r,n,i,o,a){var s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=E.length>6&&void 0!==E[6]&&E[6],EW.info("publish","Invoke publish"),c=!1,this._localStream||(this._localStream=new yE(this._context),null!==(u=this._mediaServerClient)&&void 0!==u&&null!==(d=u.vendorConfig)&&void 0!==d&&d.enableMultiVendor&&(this._localStream.pcSessionId=hF()),this._mediaServerClient.handler&&(this._localStream.observer=new EP(this._localStream,this._mediaServerClient.handler)),c=!0,this._localStream.vendorCode=(null===(l=this._mediaServerClient.vendorConfig)||void 0===l?void 0:l.vendorCode)||0),this._localStream.videoTrack=n,this._localStream.audioTrack=i,this._localStream.videoEncodeConfig=t,this._localStream.enableSimulcast=r,o&&(vc(o)&&(this._localStream.pubAudio=a===yq.PUB),vu(o)&&(this._localStream.pubVideo=a===yq.PUB),EW.info("publish mediaType","pubAudio: %o, pubVideo: %o",this._localStream.pubAudio,this._localStream.pubVideo)),this._localStream.hasPublished){e.next=26;break}if(this._localStream.pubAudio||this._localStream.pubVideo){e.next=12;break}return e.abrupt("return");case 12:return e.prev=12,s?null===(h=this._localStream.observer)||void 0===h||h.setLogin(!0):c&&(_=!!this._localStream.videoTrack,p=!!this._localStream.audioTrack,v=this._localStream.videoTrack instanceof gk,f=this._localStream.audioTrack instanceof gI,this._roomConfig.isAutoPublish&&!this._hasPublished?(_&&(v?null===(m=this._localStream.observer)||void 0===m||m.setPushVideo(!0):null===(g=this._localStream.observer)||void 0===g||g.setEnableVideo(!0)),p&&(f?null===(y=this._localStream.observer)||void 0===y||y.setPushAudio(!0):null===(S=this._localStream.observer)||void 0===S||S.setEnableAudio(!0))):null===(b=this._localStream.observer)||void 0===b||b.setPublish(!0)),e.next=16,this._mediaServerClient.publish(this._localStream);case 16:this._hasPublished=!0,this.emit(yX.ON_PUBLISH_RESULT,{isScreen:!1,state:lc.PUBLISH_SUCC}),e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(12),this.emit(yX.ON_PUBLISH_RESULT,{isScreen:!1,state:lc.PUBLISH_FAIL}),e.t0;case 24:e.next=28;break;case 26:return e.next=28,this.updatePubTrack();case 28:this._localStream.pubAudio||this._localStream.pubVideo?this._localStream.startReport(this._onLocalStreamStats.bind(this),this._mediaServerClient.handler):this._localStream.stopReport("unpublish");case 29:case"end":retur){return S.apply(this,arguments)})},{key:"updatePubTrack",value:(y=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(EW.info("updatePubTrack","Invoke updatePubTrack"),!this._localStream){e.next=4;break}return e.next=4,this._mediaServerClient.updatePubTrack(this._localStream);case 4:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"unpublish",value:(g=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(EW.info("unpublish","Invoke unpublish"),!this._localStream){e.next=7;break}return e.next=4,this._mediaServerClient.unpublish(this._localStream);case 4:this._localStream.stopReport("unpublish"),this._localStream.clean(),this._localStream=void 0;case 7:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"subscribe",value:(m=a2(a0().mark(function e(t,r,n){var i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return EW.info("subscribe","remoteStream %o",t),i=void 0,n&&(i=this._getSubLayer(n,t)),e.next=5,this._mediaServerClient.subscribe(t,r,i);case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return m.apply(this,arguments)})},{key:"updateSubTrack",value:(f=a2(a0().mark(function e(t,r,n,i){var o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(EW.info("updateSubTrack","Invoke updateSubTrack"),!i){e.next=4;break}return e.next=4,null===(a=this._mediaServerClient)||void 0===a?void 0:a.updateSubTrackLayer(t,i);case 4:return e.abrupt("return",null===(o=this._mediaServerClient)||void 0===o?void 0:o.updateSubTrack(t,r,n));case 5:case"){return f.apply(this,arguments)})},{key:"updateSubVideoConfig",value:(v=a2(a0().mark(function e(t,r){var n,i,o,a,s;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=this._findRemoteStreamByScreen(t,!1))&&a.hasSubscribed&&!((null==a||null===(n=a.attributes)||void 0===n||null===(i=n.videoDescriptions)||void 0===i?void 0:i.length)<=1)){e.next=3;break}return e.abrupt("return");case 3:return s=this._getSubLayer(r,a),a.originalStreamIndex=s.spatialLayer,e.abrupt("return",null===(o=this._mediaServerClient)||void 0===o?void 0:o.updateSubTrackLayer(a,s));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"_getSubLayer",value:function(e,t){for(var r,n,i,o,a,s,c,u=null==t?void 0:t.attributes,d=u.videoDescriptions,l=u.subVideoDescriptions,h=Array.isArray(l)?l:d,_=-1,p=e.width*e.height,v=0;v<(null==h?void 0:h.length);v++)if(p>=(null===(r=h[v])||void 0===r?void 0:r.width)*(null===(n=h[v])||void 0===n?void 0:n.height)){_=v;break}var f=h[0];if(-1===_)f=h[_=h.length-1];else if(0!==_){var m=h[_-1].width*h[_-1].height,g=(m-p)/(m-h[_].width*h[_].height);f=g<.1?h[_-1]:h[_],_=g<.1?_-1:_}return c=null!==(i=null===(o=f)||void 0===o?void 0:o.sub_index)&&void 0!==i?i:-1,{spatialLayer:null!==(a=null===(s=f)||void 0===s?void 0:s.video_index)&&void 0!==a?a:_,spatialSubLayer:c}}},{key:"unsubscribe",value:(p=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return EW.info("unsubscribe","Invoke unsubscribe"),e.next=3,this._mediaServerClient.unsubscribe(t,r);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"startSubtitle",value:(_=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._subtitleTool){e.next=5;break}return e.next=3,this._subtitleTool.start(t);case 3:e.next=6;break;case 5:throw new lM(le.INVOKED_BEFORE_JOIN_ROOM,"join first");case 6:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"stopSubtitle",value:(h=a2(a0().mark(fuase 1:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"startForwardStream2Rooms",value:(l=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.startForwardStream2Rooms(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"updateForwardSte"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"stopForwardStream2Rooms",value:(u=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.stopForwardStream2Rooms());case 1:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"pauseForwardStream2AllRooms",value:(c=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.pauseForwardStream2AllRooms());case 1:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"resumeForwardStreae"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"leave",value:(a=a2(a0().mark(function e(){var t,r,n,i,o,a,s,c,u,d,l,h=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=h.length>0&&void 0!==h[0]&&h[0],EW.info("leave","Invoke leave"),n=p9(),null===(t=this._subtitleTool)||void 0===t||t.destroy(),delete this._subtitleTool,e.prev=5,s=u2(dN(a=this._remoteStreams).call(a));try{for(s.s();!(c=s.n()).done;)u=c.value,Array.isArray(u)&&u.forEach(function(e){var t;null===(t=e.observer)||void 0===t||t.setLogin(!1)})}catch(e){s.e(e)}finally{s.f()}return this._localStream&&(null===(d=this._localStream.observer)||void 0===d||d.setLogin(!1)),e.next=11,this._mediaServerClient.leave().catch(function(){});case 11:this.destroy(),null===(i=this._monitor)||void 0===i||i.report("rtc_leave_room",{error_code:0,message:"",elapse:p9()-n}),null===(o=this._monitor)||void 0===o||o.set({room_id:"",user_id:"",rtc_session_id:"",rtc_vid:""}),e.next=24;break;case 16:if(e.prev=16,e.t0=e.catch(5),!r){e.next=22;break}throw e.t0;case 22:this.destroy();case 23:e.t0 instanceof Error&&(null===(l=this._monitor)||void 0===l||l.report("rtc_leave_room",{error_code:-1,message:e.t0.message,elapse:p9()-n}));case 24:case"end":return e.stop()}},e,this,[[5,16]])})),function(){return a.apply(this,arguments)})},{key:"updateRemoteUserPriority",value:function(e){var t,r=this;null===(t=this.remoteStreams.get(e))||void 0===t||t.forEach(function(t){var n=(r._context||{}).userPriority;t.hasSubscribed&&n.has(e)&&r._mediaServerClient.updateSubPriority(t,n.get(e))})}},{key:"destroy",value:function(){EW.info("destroy","Invoke destroy"),p3(this.id,"room_destroy","".concat(Error().stack)),null===(e=this._subtitleTool)||void 0===e||e.destroy(),delete this._subtitleTool,this._mediaServerClient.destroy(),this._removeHandlerEventHandler(),this._roomInfo=void 0,this._remoteUsers=new sF;var e,t,r,n,i=u2(this._remoteStreams);try{for(i.s();!(t=i.n()).done;){var o=u3(t.value,rEach(function(e){e&&e.destroy()})}}catch(e){i.e(e)}finally{ih(function(e){null==e||e.clean()}),this._remoteStreams=new sF,this._localStream&&(null===(r=this._localStream)||void 0===r||r.clean(),this._localStream=void 0),this._localScreenStream&&(null===(n=this._localScreenStream)||void 0===n||n.clean(),this._localScreenStream=void 0),this._removeHandlerEventHandler(),clearTimeout(this._connectionLostTimer),this._userDuplicateLoginTimerMap.forEach(function(e){clearTimeout(e)}),this._userDuplicateLoginTimerMap.clear(),this._networkQualityManager.destroy(),this._videoSizeObserver.destroy(),this._csrcUserIdMap={},this._virtualStreams=[],this._remoteStreamStreamIdUserIdMap={},this._forwardStreamManager.clear()}},{key:"updateToken",value:(o=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return EW.info("updateToken","Invoke updateToken"),this._roomInfo&&(this._roomInfo.token=t),e.prev=2,e.next=5,this._mediaServerClient.updateToken(t);case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(2),this.safeEmit(yX.ON_ROOM_ERROR,{errorCode:le.UPDATE_TOKEN_WITH_INVALID_TOKEN}),e.t0;case 11:case"end":return e.stop()}},e,this,[[2,7]])})),function(e){return o.apply(this,arguments=r?void 0:r.sendUserMessage(e,t)}},{key:"setSessionId",value:function(){var e;this._sessionId=hU(),this._mediaServerClient._sessionId=this._sessionId,null===(e=this._monitor)||void 0===e||e.set({rtc_session_id:this._sessionId})}},{key:"sendRoomMessage",value:(i=a2(a0().mark(function e(t){var r,n,i,o,a,s=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.length>1&&void 0!==s[1]&&s[1],a={clientId:null===(r=this._roomInfo)||void 0===r?void 0:r.userInfo.userId,binary:o,message:"",roomId:null===(n=this._roomInfo)||void 0===n?void 0:n.roomId},!o){e.next=8;break}return e.next=5,vt.ab2b64str(t);case 5:a.message=e.sent,e.next=9;break;case 8:a.message=t;case 9:return e.abrupt("return",null===(i=this._mediaServerClient)||void 0===i?void 0:i.sendRoomMessage(a));case 10:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"_onJoinSucc",value:function(e){var t,r,n,i=this,o=e.joinRes,a=e.reconnect;EW.info("_onJoinSucc()","invoke. ".concat(a?"[reconnect]":"")),this._serverConfig=o.config,this._mediaServerClient.roomAttributes=o.roomAttributes;var s=[],c=[],u=[],d=[],l=[];null===(t=o.clientsDetail)||void 0===t||t.forEach(function(e){if(e.attributes&&(e.attributes.serverMuteVideo&&i.safeEmit(yX.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&i.safeEmit(yX.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio})),e.clientId!==o.clientId){var t=i._remoteUsers.get(e.clientId);t?t._stillExist=!0:s.push(e)}});var h,_=u2(dN(r=this._remoteUsers).call(r));try{for(_.s();!(h=_.n()).done;){var p=h.value;p._stillExist||c.push({clientId:p.userId}),delete p._stillExist}}catch(e){_.e(e)}finally{_.f()}o.streams.forEach(function(e){var t=i._findRemoteStreamByScreen(e.clientId,e.screen);t?(t.stillExist=!0,t.streamId=e.streamId,l.push(e)):d.push(e)});var v,f=u2(dN(n=this._remoteStreams).call(n));try{for(f.s();!(v=f.n()).done;){var m=v.value;Array.isArray(m)&&m.forEach(function(e){e.stillExist?delete e.stillExist:u.push({clientId:e.userId,streamId:e.streamId,message:yL.clientDisconnected})})}}catch(e){f.e(e)}finally{f.f()}c.forEach(function(e){return i._onUserDisconnection(e)}),s.forEach(function(e){return i._onUserConnection(e)}),u.forEach(function(e){return._onAddStren i._onUpdateStreamAttributes(e)}),a&&this._handleSendOrRecvStreamAfterReconnect()}},{key:"_handleSendOrRecvStreamAfterReconnect",value:function(){var e,t,r,n,i,o=this;this._localStream&&(this._localStream.clean(),this._localStream.vendorCode=(null===(r=this._mediaServerClient.vendorConfig)||void 0===r?void 0:r.vendorCode)||0,null===(n=this._localStream.observer)||void 0===n||n.setLogin(!0),this._mediaServerClient.publish(this._localStream).catch(function(e){})),this._localScreenStream&&(this._localScreenStream.clean(),null===(i=this._localScreenStream.observer)||void 0===i||i.setLogin(!0),this._mediaServerClient.publish(this._localScreenStream).catch(function(e){}));var a,s=u2(dN(t=this._remoteStreams).call(t));try{for(s.s();!(a=s.n()).done;){var c=a.value;Array.isArray(c)&&c.forEach(function(){var e=a2(a0().mark(function e(t){var r,n,i,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.hasSubscribed){e.next=15;break}return t.resetHasSubscribed(),e.prev=2,EW.info(a4(r="start resubscribe ".concat(t.userId," with ")).call(r,t.subMediaType)),e.next=6,o._mediaServerClient.subscribe(t,t.subMediaType);case 6:EW.info(a4(n="success resubscribe ".concat(t.userId," with ")).call(n,t.subMediaType)),o.safeEmit(yX.RESUBSCRIBE,{stream:t}),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(2),EW.error(a4(i=a4(a="failed resubscribe ".concat(t.userId," with ")).call(a,t.subMediaType,", error:")).call(i,e.t0)),t.clean(),null==t||t.resetHasSubscribed();case 15:case"end":return e.stop()}},e,null,[[2,10]])}));return function(t){return e.apply(this,arguments)}}())}}catch(e){s.e(e)}finally{s.f()}null===(e=this._subtitleTool)||void 0===e||e.reconnect(),this._forwardStreamManager.resumeFromReconnect()}},{key:"_handleFFAudioTrack",value:function(){var e,t,r,n,i=null===(e=this._mediaServerClient)||void 0===e||null===(t=e.handler)||void 0===t?void 0:t.audioTrack4ff,o=null===(r=this._mediaServerClient)||void 0===r||null===(n=r.handler)||void 0===n?void 0:n.getTransceivers();if(i&&Arr||void 0===t?void 0:t.track)===i});if(a){var s=new yT(this._context,"ff-stream","ff-stream",!1,!1,Eq);s.virtual=!0,s.audioTransceiver=a,s.audioMid="0",s.audioTrack=gU(i),this._virtualStreams.push(s),this.safeEmit(yX.SUBSCRIBE_PUSH_TRACK,{stream:s})}}}},{key:"_findRemoteStream",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?cS(r).call(r,function(e){return e.streamId===t}):null}},{key:"_findRemoteStreamByScreen",value:function(e,t){var r=this._remoteStreams.get(e);retunction(e){return e.isScreen===t}):null}},{key:"_onAddStream",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.needEmit,i=void 0===n||n,o=r.fromSignal,a=void 0===o||o,s=r.virtual,c=void 0!==s&&s;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var u=this._roomConfig,d=u.isAutoSubscribeAudio,l=u.isAutoSubscribeVideo,h=this._findRemoteStreamByScreen(e.clientId,e.screen);if(h&&h.streamId!==e.streamId){var _,p=null===(_=this._remoteStreams.get(e.clientId)){return e.streamId!==h.streamId});h.clean(),this._remoteStreams.set(e.clientId,p||[])}var v=this._findRemoteStream(e.clientId,e.streamId);if(this._remoteStreamStreamIdUserIdMap[e.streamId]=e.clientId,v)v.attributes=e.attributes;else if((v=new yT(this._context,e.clientId,e.streamId,e.screen,!1,e.attributes)).virtual=c,this._initStreamListeners(v),!c){var f=this._remoteStreams.get(e.clientId);f?f.push(v):this._remoteStreams.set(e.clientId,[v])}if(this._mediaServerClient.handler&&(v.observer=new EO(v,this._mediaServerClient.handler)),!v.isScreen&&l&&(a&&v.hasVideo&&(v.attributes.extvideo?(null===(m=v.observer)||void 0===m||m.setExternalVideoSource(!0),null===(g=v.observer)||void 0===g||g.setPushVideo(!0)):(null===(y=v.observer)||void 0===y||y.setExternalVideoSource(!1),null===(S=v.observer)||void 0===S||S.setPublishVideo(!0))),a&&v.hasAudio&&d&&!this._mediaServerClient.roomAttributes.multiChatMode&&(v.attributes.extaudio?(null===(b=v.observer)||void 0===b||b.setExternalAudioSource(!0),null===(E=v.observer)||void 0===E||E.setPushAudio(!0)):(null===(T=v.observer)||void 0===T||T.setExternalAudioSource(!1),null===(k=v.observer)||void 0===k||k.setPublishAudio(!0))),i&&!a)){var m,g,y,S,b,E,T,k,I,R=this._roomConfig,A=R.isAutoSubscribeAudio,C=R.isAutoSubscribeVideo;null===(I=v.observer)||void 0===I||I.setLogin(!0,{audio:!!A&&!this.multiChatMode,video:!!C})}return i&&this.safeEmit(yV.ON_ADD_STREAM,{stream:v}),v}}},{key:"_onUserConnection",value:function(e){var t;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var r=this._userDuplicateLoginTimerMap.get(e.clientId);if("number"==typeof r)return this._userDuplicateLoginTimerMap.delete(e.clientId),void self.clearTimeout(r);var n={userId:e.clientId,extraInfo:e.attributes.extra_info};this._remoteUsers.set(e.clientId,dr({},n)),this.safeEmit(yV.USER_CONNECTION,{userInfo:n}),e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(yX.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(yX.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}}},{key:"_onUserDisconnection",value:function(e){var t,r=this,n=e.clientId,i=e.tag,o=e.code;if(n){if(n===(null===(t=this.roomInfo)||void 0===t?void 0:t.userInfo.userId)){var a=null;i===yj.kickedByAdmin?a=le.KICKED_OUT:i===yj.onUserTokenDidExpire?a=le.TOKEN_EXPIRED:i===yj.userDuplicateLogin&&(a=le.DUPLICATE_LOGIN),o===yG.roomDismissByAdmin&&(a=le.ROOM_DISMISS),a&&this.safeEmit(yX.ON_ROOM_ERROR,{errorCode:a})}else{var s=li.DROPPED;i===yj.userLeave?s=li.QUIT:i===yj.kickedByAdmin?s=li.KICKED_BY_ADMIN:i===yj.roleChanged&&(s=li.SWITCH_TO_INVISIBLE);var c=function(){var e;r._remoteUsers.delete(n),null===(e=r._remoteStrea,message:yL.clientDisconnected})}),r._remoteStreams.delete(n),r.safeEmit(yX.ON_USER_LEAVE,{userInfo:{userId:n},reason:s})};if(i===yj.userDuplicateLogin){var u=this._userDuplicateLoginTimerMap.get(n);u&&self.clearTimeout(u);var d=self.setTimeout(c,5e3);this._userDuplicateLoginTimerMap.set(n,d)}else c()}}}},{key:"_onRemoveStream",value:function(e){var t,r=this;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var n=this._remoteStreams.get(e.clientId);if(n){var i,o,a,s=cS(n).call(n,function(t){return t.streamId===e.streamId});s&&(null===(i=this._mediaServerClient)||void 0===i||i.handleRemoveStream(s,e).then(function(){var t=r._remoteStreams.get(e.clientId);t&&(t=cG(t).call(t,function(t){return t.streamId!==e.streamId||(t.clean(),!1)}),r._remoteStreams.set(e.clientId,t))}).finally(function(){r.safeEmit(yV.ON_REMOVE_STREAM,{stream:s,reason:e.message,callback:function(){return s.destroy()}})}),s.hasVideo&&(null===(o=s.observer)||void 0===o||o.setPublishVideo(!1)),s.hasAudio&&!this._mediaServerClient.roomAttributes.multiChatMode&&(null===(a=s.observer)||void 0===a||a.setPublishAudio(!1)))}}}},{key:"_onUpdateUserAttributes",value:function(e){e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(yX.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(yX.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}},{key:"_onUpdateRoomAttributes",value:function(e){var t;e.roomAttributes&&(this._mediaServerClient.roomAttributes=dr(dr({},this._mediaServerClient.roomAttributes),e.roomAttributes)),null!==(t=e.roomAttributes)&&void 0!==t&&t.multiChatMode&&this._handleFFAudioTrack()}},{key:"_onUpdateStreamAttributes",value:function(e){var t=this._roomConfig,r=t.isAutoSubscribeAudio,n=t.isAutoSubscribeVideo,i=e.clientId,o=e.streamId,a=e.attributes,s=this._findRemoteStream(i,o);if(s){var c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R=s.attributes,A=dr(dr({},R),a),C=!1,w=A.localaudio!==R.localaudio,x=!1,O=!1,N=A.localvideo!==R.localvideo,P=!1,D=gH.NONE,M=gH.NONE;A.audiostream!==R.audiostream&&(C=A.localaudio,x=!!A.audiostream,A.audiostream?D|=lh.AUDIO:M|=lh.AUDIO),A.videostream!==R.videostream&&(O=A.localvideo,P=!!A.videostream,A.videostream?D|=lh.VIDEO:M|=lh.VIDEO),D&&this.safeEmit(yX.ON_USER_PUBLISH_STATE_CHANGE,{userId:i,mediaType:D,isScreen:s.isScreen,pubState:yq.PUB,remoteStream:s}),M&&this.safeEmit(yX.ON_USER_PUBLISH_STATE_CHANGE,{userId:i,mediaType:M,isScreen:s.isScreen,pubState:yq.UNPUB,remoteStream:s}),s.attributes=A,A.localaudio!==R.localaudio&&(A.localaudio?(r&&A.audiostream&&(A.extaudio?(null===(c=s.observer)||void 0===c||c.setExternalAudioSource(!0),null===(u=s.observer)||void 0===u||u.setPushAudio(!0)):(null===(d=s.observer)||void 0===d||d.setExternalAudioSource(!1),null===(l=s.observer)||void 0===l||l.setEnableAudio(!0))),this.safeEmit(yX.ON_USER_START_AUDIO_CAPTURE,{userId:i},s)):(A.extaudio?(null===(h=s.observer)||void 0===h||h.setExternalAudioSource(!0),null===(_=s.observer)||void 0===_||_.setPushAudio(!1)):(null===(p=s.observer)||void 0===p||p.setExternalAudioSource(!1),null===(v=s.observer)||void 0===v||v.setEnableAudio(!1)),s.isScreen||this.safeEmit(yX.ON_USER_STOP_AUDIO_CAPTURE,{userId:i}))),A.localvideo!==R.localvideo&&(A.localvideo?(n&&A.videostream&&(A.extvideo?(null===(f=s.observer)||void 0===f||f.setExternalVideoSource(!0),null===(m=s.observer)||void 0===m||m.setPushVideo(!0)):(null===(g=s.observer)||void 0===g||g.setExternalVideoSource(!1),null===(y=s.observer)||void 0===y||y.setEnableVideo(!0))),this.safeEmit(yX.ON_USER_START_VIDEO_CAPTURE,{userId:i})):(A.extvideo?(null===(S=s.observer)||void 0===S||S.setExternalVideoSource(!0),null===(b=s.observer)||void 0===b||b.setPushVideo(!1)):(null===(E=s.observer)||void 0===E||E.setExternalVideoSource(!1),null===(T=s.observer)||void 0===T||T.setEnableVideo(!1)),s.isScreen||this.safeEmit(yX.ON_USER_STOP_VIDEO_CAPTURE,{userId:i}))),C&&!w&&(null===(k=s.observer)||void 0===k||k.setRemoteUnmuteAudio(x)),O&&!N&&(null===(I=s.observer)||void 0===I||I.setRemoteUnmuteVideo(P))}}},{key:"_onPushTrack",value:function(e){var t,r,n,i=this;if(null!==(n=e.streamId)&&void 0!==n&&d9(n).call(n,"audio_mux")){var o=this._onAddStream(dr(dr({},e),{},{attributes:Eq}),{needEmit:!1,fromSignal:!1,virtual:!0});o&&this._mediaServerClient.subscribe4pushTrack(o,e).then(function(){i.safeEmit(yX.SUBSCRIBE_PUSH_TRACK,{stream:o}),cribe","push track failed %o",e)})}else null===(t=this._monitor)||void 0===t||t.report("rtc_error",{message:a4(r="onPushTrack, userId: ".concat(e.clientId,", ")).call(r,e.streamId),error_code:y$.TRACK_ERROR})}},{key:"_onRemoveTrack",value:function(e){var t,r=e.clientId,n=e.streamId,i=e.message,o=e.trackType;EW.info("_onRemoveTrack","remove track: %o",r);var a=this._findRemoteStream(r,n);a&&(a.removeTrack=!0,null===(t=this._mediaServerClient)||void 0===t||t.unsubscribe4removeTrack(a,i,o),this.emit(yX.REMOVE_PUSH_TRACK,{stream:a,mediaType:o+1}))}},{key:"_onMeetingSpeakerChange",value:function(e){if(Array.isArray(null==e?void 0:e.speakerCsrcInfo)){var t={};null==e||e.speakerCsrcInfo.forEach(function(e){var r=e.csrc,n=e.userId;e.isScreen||(t[r]=n)}),this._csrcUserIdMap=t}Array.isArray(e.muxStreamInUse)&&this._virtualStreams.forEach(function(t){var r;null!==(r=e.muxStreamInUse)&&void 0!==r&&c1(r).call(r,t.streamId)?t.virtualOccupy=!0:t.virtualOccupy=!1})}},{key:"getActiveSpeakerInMultiChatMode",value:function(){var e=this,t=[];return this._virtualStreams.forEach(function(r){var n,i=null===(n=r.audioTransceiver)||void 0===n?void 0:n.receiver;if(i){var o=u3(i.getContributingSources()||[],1)[0];if(o){var a=o.audioLevel,s=o.source;e._csrcUserIdMap[s]&&t.push({userId:e._csrcUserIdMap[s],audioLevel:a})}}}),t.length&&dQ(t).call(t,function(e,t){return e.audioLevel-t.audioLevel}),t}},{key:"_onReconnecting",value:function(){var e,t,r,n=this;if(this._roomInfo){var i,o=u2(dN(r=this._remoteStreams).call(r));try{for(o.s();!(i=o.n()).done;){var a=i.ach(function(e){return e.clean()})}}catch(e){o.e(e)}finally{o.f()}this._virtualStreams.forEach(function(e){n.emit(yX.REMOVE_PUSH_TRACK,{stream:e,mediaType:lh.AUDIO}),e.clean()}),this._virtualStreams=[],null===(e=this.localStream)||void 0===e||e.clean(),null===(t=this.localScreenStream)||void 0===t||t.clean()}}},{key:"_onConnectionStateChange",value:function(e){var t,r=this;if(e.next===Ec.DISCONNECTED)t=lp.CONNECTION_STATE_DISCONNECTED;else if(e.next===Ec.CONNECTED)clearTimeout(this._connectionLostTimer),t=this._mediaServerClient.isReconnecting?lp.CONNECTION_STATE_RECONNECTED:lp.CONNECTION_STATE_CONNECTED;else{if(e.next!==Ec.CONNECTING)return;this._mediaServerClient.isReconnecting?(t=lp.CONNECTION_STATE_RECONNECTING,this._onReconnecting()):t=lp.CONNECTION_STATE_CONNECTING}e.prev===Ec.CONNECTED&&e.next===Ec.DISCONNECTED&&(this._connstate:lp.CONNECTION_STATE_LOST})},1e4)),this._networkQualityManager.setMSC(this._mediaServerClient),this.safeEmit(yB.ON_CONNECTION_STATE_CHANGE,{state:t})}},{key:"_initStreamListeners",value:funcon("ontrack",function(e){e.track}),e.on("onSEIMessage",function(r){var n;t.emit(yX.ON_SEI_MESSAGED_RECEIVED,{sei:r,remoteStreamKey:{userId:e.userId,roomId:null===(n=t._roomInfo)||void 0===n?void 0:n.roomId,streamIndex:e.isScreen?ll.STREAM_INDEX_SCREEN:ll.STREAM_INDEX_MAIN}})}safeEmit(yV.ON_CUSTOM_MESSAGE,e)}},{kD,{userId:e.from,message:e.msg})}},{key:"_onUserBinaryMessageReceived",value:function(e){var t,r={userId:e.from,message:e.msg};null!==(t=this._subtitleTool)&&void 0!==t&&t.onMessageRecv(r)||this.safeEmit(yV.USER_BINARY_MESSAGE_RECEIVED,r)}},{key:"_initSubtitleTool",value:function(){var e=this;this._subtitleTool=new Ej(this),this._subtitleTool.onEvent=function(t){e.emit(yX.ON_SUBTITLE_STATE_CHANGED.ON_SUBTITLE_MESSAGE_RECEIVED,t)}}},{key:"_onPostProcessingMessage",value:function(e){if(e.body){if("subtitleCallback"!==e.type){var t,r=e.body,n=r.error||0,i=yW.START,o=["success","parameter error","subscription timeout","ffmpeg error","cdn error","publish error"];if("2.0"===r.protocol){switch(r.eventType){case"TranscodeStarted":0!==r.error&&(i=yW.START_FAILED);break;case"TranscodeStateChanged":i=0!==r.error?yW.START_FAILED:yW.START_SUCCESS;break;case"TranscodeStopped":i=0!==r.error?yW.STOP_FAILED:yW.STOP_SUCCESS;break;case"TranscodeUpdated":i=0!==r.error?yW.UPDATE_FAILED:yW.UPDATE_SUCCESS}this.safeEmit(yV.POST_PROCESSING_MESSAGE,{code:n,protocol:r.protocol,error:r.error,eventType:i,message:o[n]})}this.safeEmit(yV.POST_PROCESSING_MESSAGE,{code:n,message:o[n],type:e.type})}else null===(t=this._subtitleTool)||void 0===t||t.onResult(e)}}},{k.ON_USER_TOKEN_WILL_EXPIRE,null)}},{key:"_onStreamFailed",value:(n=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,d,l;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("publish"!==t.type){e.next=11;break}if(s=void 0,(null===(r=this.localStream)||void 0===r?void 0:r.streamId)===t.streamId?s=this.localStream:(null===(n=this.localScreenStream)||void 0===n?void 0:n.streamId)===t.streamId&&(s=this.localScreenStream),s){e.next=5;break}return e.abrupt("return");case 5:return null===(i=s)||void 0===i||i.clean(),e.next=8,null===(o=this._mediaServerClient)||void 0===o?void 0:o.unpublish(s).catch(function(){});case 8:null===(a=this._mediaServerClient||a.publish(s).catch(function(){}),e.next=20;break;case 11:if("subscribe"!==t.type||(c=this._remoteStreamStreamIdUserIdMap[t.streamId],!(u=this._findRemoteStream(c,t.streamId)))){e.next=20;break}return e.next=17,null===(d=this._mediaServerClient)||void 0===d?void 0:d.unsubscribe(u,lh.AUDIO_AND_VIDEO);case 17:return e.next=19,null===(l=this._mediaServerClient)||void 0===l?void 0:l.subscribe(u,u.subMediaType,u.subLayer);case 19:this.safeEmit(yX.RESUBSCRIBE,{stream:u});case 20:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"_onStreamControlMessage",value:function(e){var t,r;e.type===yU.PushLimitWarn&&(null!==(t=this._localStream)&&void 0!==t&&t.pubAudio||null!==(r=this._localStream)&&void 0!==r&&r.pubVideo||this.unpublish())}},{key:"_onPublishOnDemand",value:(r=a2(a0().mark(function e(){var t,r,n,i,o,a,s,c,u,d,l,h,_,p,v;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._publishOnDemandItem&&!this._publishOnDemandBusy&&!1!==(null===(t=this._serverConfig)||void 0===t||null===(r=t.engine_VPM)||void 0===r||null===(n=r.ondemand)||void 0===n?void 0:n.enable)){e.next=2;break}return e.abrupt("return");case 2:if(null===(i=this._localStream)||void 0===i||!i.enableSimulcast||null===(o=this._localStream)||void 0===o||!o.videoTransceiver){e.next=16;break}return this._publishOnDemandBusy=!0,u=this._publishOnDemandItem,this._publishOnDemandItem=void 0,d=[],l=null===(s=this._localStream)||void 0===s?void 0:s.stream.id,Array.isArray((_=(h=null===(c=this._localStream)||void 0===c?void 0:c.videoTransceiver.sender).getParameters()).encodings)&&Array.isArray(u)&&(v={},EW.info("_onPublishOnDemand exec","usedDescriptions: %o",u),u.forEach(function(e){var t;null!=e&&null!==(t=e.StreamIds)&&void 0!==t&&c1(t).call(t,l)&&(v[null==e?void 0:e.Metadata.VideoIndex]=!0)}),_.encodings=se(p=_.encodings).call(p,function(e){return e.rid&&(v[e.rid]?e.active=!0:e.active=!1,d[Number(e.rid)]=e.active),e}),this._context&&(this._context.activeSimStreams=d)),e.next=13,h.setParameters(_);case 13:this._publishOnDemandBusy=!1,e.next=18;break;case 16:if(null!==(a=this._localStream)&&void 0!==a&&a.videoTransceiver){e.next=18;break}return e.abrupt("return");case 18:this._onPublishOnDemand();case 19:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"_onRTT",value:function(e){var t=e.StreamIds,r=e.Metadata;if(t.length&&r){var n,i=t[0];null!==(n=this._context)&&void 0!==n&&n.streamRTT&&(this._context.streamRTT[i]={audio:r.audio_rtt,video:r.video_rtt})}}},{key:"_onSSC",value:function(e){var t=e.StreamIds,r=e.Metadata,n=t[0],i=this._remoteStreamStreamIdUserIdMap[n],o=this._findRemoteStream(i,n),a={userId:i,isScreen:!!o&&o.isScreen,beforeVideoIndex:r.ssc_items[0].prev_layer_id,afterVideoIndex:r.ssc_items[0].cur_layer_id,beforeEnable:0!==r.ssc_items[0].prev_video_open,afterEnable:0!==r.ssc_items[0].cur_video_open,reason:r.ssc_items[0].change_reason};this.emit(yX.ON_SIMULCAST_SUBSCRIBE_FALLBACK,a)}},{.emit(yX.ON_NETWORK_QUALITY,e,t)}},{key:"_emitVideoSizeChange",value:function(e,t,r,n){var i;this.emit(yX.ON_REMOTE_VIDEO_SIZE_CHANGED,{roomId:null===(i=this.roomInfo)||void 0===i?void 0:i.roomId,userId:e,streamIndex:t?ll.STREAM_INDEX_SCREEN:ll.STREAM_INDEX_MAIN},{width:r,heigd 0===e?void 0:e.multiChatMode()}},{key:"setAudioEncodeMaxBitrate",value:(t=a2(a0().mark(function e(t,r){var n,i,o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=t===ll.STREAM_INDEX_MAIN?this.localStream:this.localScreenStream)||!n.pubAudio||null==(o=null===(i=n.audioTransceiver)||void 0===i?void 0:i.sender.getParameters())||!o.encodings.length){e.next=7;break}return o.encodings[0].maxBitrate=1e3*r,e.next=7,null===(a=n.audioTransceiver)||void 0===a?void 0:a.sender.setParameters(o);case 7:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})}]),O}(),EJ=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement(e);return t.id&&(r.id=t.id)h(function(e){r.classList.add(e)}),t.style&&s8(r.style,t.style),t.attributes&&lB(t.attributes).forEach(function(e){var t=u3(e,2),n=t[0],i=t[1];"muted"===n?r.muted=!0:r.setAttribute(n,i)}),r},EQ=new h1("Player",0),EZ=["play","playing","pause","ended","error","seeking","seeked","waiting","canplay","canplaythrough","durationchange","volumechange","loadedmetadata","loadeddata","loadstart","timeupdate"],E$={playsinline:"","webkit-playsinline":""},E0={playsinline:"","webkit-playsinline":"","x5-playsinline":"","x5-video-player-type":"h5","x-webkit-airplay":"allow",preload:"",muted:""},E1=function(e){dy(n,fT.exports.EventEmitter);var t,r=dC(n);function n(e,t){iE(this,n),iT(dn(i=r.call(this)),"_containerDom",void 0),iT(dn(i),"_videoDom",void 0),iT(dn(i),"__cumulativeTime",void 0),iT(dn(i),"userId",void 0),iT(dn(i),"renderMode",void 0),iT(dn(i),"mirrorType",lv.MIRROR_TYPE_NONE),iT(dn(i),"isScreen",void 0),iT(dn(i),"isLocal",void 0),iT(dn(i),"played",!1),iT(dn(i),"_needLoad",!1),iT(dn(i),"_emitPlayFailed",!1),iT(dn(i),"_videoContainer",void 0),iT(dn(i),"_safari15VideoTimer",void 0),iT(dn(i),"_monitor",void 0),iT(dn(i),"_onLocalTrackMute",void 0),iT(dn(i),"_onInterruptionEnd",void 0),iT(dn(i),"_needResume",!1),iT(dn(i),"emitVideoEvent",function(e){var t,r,n={type:"video",rawEvent:e,readyState:(null===(t=i._videoDom)||void 0===t?void 0:t.readyState)||0,userId:i.userId,eventName:e.type,currentTime:(null===(r=i._videoDom)||void 0===r?void 0:r.currentTime)||0,isScreen:i.isScreen};switch(i.emit("playback_event",n),e.type){case"canplay":case"loadeddata":i._internalPlay();break;case"playing":EQ.info("VideoPlayerPlaying","[userId-".concat(i.userId,"] video element playing"));break;case"pause":EQ.info("VideoPlayerPause","[userId-".concat(i.userId,"] video element pause")),i._needResume&&(EQ.info("VideoPlayerPause","[userId-".concat(i.userId,"] video element resume")),i._internalPlay(),i._needResume=!1)}}),iT(dn(i),"_internalPlay",function(){var e;if(null!==(e=i._videoDom)&&void 0!==e&&e.paused){var t=i._videoDom.play();null!=t&&t.then&&t.then(function(){var e;i.isLocal&&vN&&!i._needLoad&&(null===(e=i._videoDom)||void 0===e||e.load(),i._needLoad=!0)}).catch(function(e){var t,r,n,o,a,s;i._emitPlayFailed||("AbortError"!==e.name?(i._emitPlayFailed=!0,null===(t=i._monitor)||void 0===t||t.report("rtc_error",{message:a4(r="video autoplay failed, userId: ".concat(i.userId,", ")).call(r,e.name),error_code:y$.AUTOPLAY_FAILED}),i.emit("playback_event",{type:"video",rawEvent:e,readyState:(null===(n=i._videoDom)||void 0===n?void 0:n.readyState)||0,userId:i.userId,eventName:"autoplay-error",currentTime:(null===(o=i._videoDom)||void 0===o?void 0:o.currentTime)||0,isScreen:i.isScreen})):null===(a=i._monitor)||void 0===a||a.report("rtc_error",{message:a4(s="video autoplay failed, userId: ".concat(i.userId,", ")).call(s,e.name),error_code:y$.AUTOPLAY_FAILED}))})}}),i.engineId=e;var i,o=t.renderDom;i._monitor=pZ(e);var a=t.userId,s=t.isScreen?ld.RENDER_MODE_FIT:ld.RENDER_MODE_HIDDEN;i.renderMode=void 0!==t.renderMode?t.renderMode:s;var c="string"==typeof o?document.getElementById(o):o;if(!c)throw new lM(le.CANT_FIND_DOM,"can't find dom");return i._videoContainer=document.createElement("div"),i._videoContainer.style.width="100%",i._videoContainer.style.height="100%",i._videoContainer.style.position="relative",i._videoContainer.style.overflow="hidden",i._containerDom=c,i.userId=a,i.isLocal=!!t.isLocal,i.isScreen=!!t.isScreen,i._initVideo(),i}return ib(n,[{key:"_initVideo",value:function(){var e,t=this;this._videoDom||(this._videoDom=EJ("video",{style:{width:"100%",height:"100%"},attributes:E0}),this._videoDom.id=a4(e="".concat(this.userId,"_")).call(e,p7()),this.setRenderMode(this.renderMode),this.mirror(this.mirrorType===lv.MIRROR_TYPE_RENDER)),this._videoContainer.appendChild(this._videoDom),this._containerDom.appendChild(this._videoContainer),this._initLMute=function(){t._needRinterruption"),t._internalPlay()},go.on(gi.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),go.on(gi.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),go.on(gi.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd)}},{key:"_initListeners",value:function(){var e=this;this._videoDom&&EZ.forEach(function(t){var r;null===(r=e._videoDom)||void 0===r||r.addEventListener(t,e.emitVideoEvent)})}},{key:"_removeListeners",value:function(){var ventListener(t,e.emitVideoEvent)})}},{key:"_recordFrame",value:function(e){var t,r=this,n=e.isScreen?1.5:.55;if(vx){if(null===(t=this._videoDom)||void 0===t||!t.requestVideoFrameCallback)return;this._videoDom.requestVideoFrameCallback(function t(i,o){var a=o.presentationTime;if(e.recordedVideoFrames||(e.recordedVideoFrames=[]),r.__cumulativeTime){var s,c=(a-r.__cumulativeTime)%2e3,u=c>1e3*n;null===(s=e.recordedVideoFrames)||void 0===s||s.push({playTime:a,isStall:u,stallCount:u?1:0,stallDuration:c})}r.__cumulativeTime=a,r._videoDom.requestVideoFrameCallback(t)})}else this.on("playback_event",function(t){var i;if("timeupdate"===t.eventName){if(0===(null===(i=r._videoDom)||void 0===i?void 0:i.currentTime))return;if(void 0===r.__cumulativeTime)return void(r.__cumulativeTime=r._videoDom.currentTime);if(e.recordedVideoFrames||(e.recordedVideoFrames=[]),r._videoDom.currentTime>r.__cumulativeTime){var o=Math.floor(1e3*(r._videoDom.currentTime-r.__cumulativeTime)),a=r._videoDom.currentTime-r.__cumulativeTime>n;e.recordedVideoFrames.push({playTime:r._videoDom.currentTime,isStall:a,stallCount:a?1:0,stallDuration:o%2e3})}r.__cumulativeTime=r._videoDom.currentTime}})}},{key:"_recordPause",value:function(e){var t=this;void 0===e.statsReport.isPaused&&this.on("playback_event",function(r){if("pause"===r.eventName)e.statsReport.isPaused=!0,e.statsReport.pauseStart=p9();else if("timeupdate"===r.eventName){var n;if((null===(n=t._videoDom)||void 0===n||!n.paused)&&e.statsReport.isPaused){e.statsReport.isPaused=!1;var i=p9()-(e.statsReport.pauseStart||0);i>500&&(e.statsReport.pauseDuration+=i)}}})}},{key:"setRenderMode",value:function(e){this.renderMode=e,this._videoDom&&(this.renderMode===ld.RENDER_MODE_FIT?this._videoDom.style.objectFit="contain":this.renderMode===ld.RENDER_MODE_FILL?this._videoDom.style.objectFit="fill":this._videoDom.style.objectFit="cover")}},{key:"playVideo",value:(t=a2(a0().mark(function e(t,r){var n,i,o,a,s=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this._videoDom,EQ.info("playVideo","play video track: ".concat(this.userId)),!(o&&o.srcObject instanceof MediaStream&&o.srcObject.getTrackById(null===(n=t.getTrack())||void 0===n?void 0:n.id))){e.next=5;break}try{p3(this.engineId,"playVideo","play video repeatedly",0,this.userId)}catch(e){}return e.abrupt("return");case 5:o||(this._initVideo(),o=this._videoDom),EQ.info("playVideo","play video by dom: ".concat(null===(i=o)||void 0===i?void 0:i.id)),(a=new MediaStream).addTrack(t.getTrack("preprocessing")),o.srcObject=a,o&&!this._containerDom.contains(this._videoContainer)&&this._containerDom.appendChild(this._videoContainer),o&&!this._videoContainer.contains(o)&&this._videoCoction(){return s._internalPlay()}),r&&ft.VIDEO_STALL&&(this._recordFrame(r),this._recordPause(r),r.statsReport.player=this),this.played=!0;case 15:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"updateSrcObject",value:function(e){var t=e.getTrack();if(t&&this._videoDom){var r=new MediaStream;r.addTrack(t),this._videoDom.srcObject=r}}},{key:"removeTrack",value:function(){var e,t=null===(e=this._videoDom)||void 0===e?void 0:e.srcObject;if(t){var r=t.getVideoTracach(function(e){t.removeTrack(e)})}}},{key:"manuallyPlay",value:function(){if(EQ.info("Invoke VideoPlayer.manuallyPlay",this.userId,this.isScreen),this._emitPlayFailed=!1,!this._videoDom)throw new lM(le.INVALID_PARAMS,"Player not found");return 0!==this._videoDom.readyState||vF?this._videoDom.play():aj.resolve()}},{key:"mirror",value:function(e){var t;EQ.info("mirror",a4(t="".concat(this.userId," set mirror: ")).call(t,e)),this.mirrorType=e?lv.MIRROR_TYPE_RENDER:lv.MIRROR_TYPE_NONE,this._videoDom&&(this._videoDom.style.transform=e?"rotateY(180deg)":"")}},{key:"stop",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this._containerDom;EQ.info("stop","stop video track: ".concat(this.userId)),this._videoDom&&(t||(this._videoDom.srcObject=null),null!=r&&r.contains(this._videoContainer)&&r.removeChild(this._videoContainer),null!==(e=this._videoContainer)&&void 0!==e&&e.contains(this._videoDom)&&this._videoContainer.removeChild(this._videoDom)),this.__cumulativeTime=void 0,this.played=!1}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];EQ.info("destroy","video player: ".concat(this.userId)),this.stop(e),dm(df(n.prototype),"removeAllListeners",this).call(this),this._removeListeners(),go.off(gi.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),go.off(gi.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),go.off(gi.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd),this._videoDom&&delete this._videoDom,this._safari15VideoTimer&&(window.clearInterval(this._safari15VideoTimer),this._safari15VideoTimefunction(){return this._videoDom}}]),n}(),E2=function(e){dy(i,fT.exports.EventEmitter);var t,r,n=dC(i);function i(e,t){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{divId:void 0,muted:!1,isScreen:!1},a=o.divId,s=o.muted,c=o.isScreen;if(iE(this,i),iT(dn(r=n.call(this)),"_containerDom",void 0),iT(dn(r),"_audioDom",void 0),iT(dn(r),"_fakeAudioDom",void 0),iT(dn(r),"userId",void 0),iT(dn(r),"muted",!1),iT(dn(r),"_emitPlayFailed",!1),iT(dn(r),"played",!1),iT(dn(r),"isScreen",void 0),iT(dn(r),"_wechatTimer",void 0),iT(dn(r),"_edgeTimer",void 0),iT(dn(r),"_monitor",void 0),iT(dn(r),"_pasued",!0),iT(dn(r),"emitAudioEvent",function(e){var t,n,i={type:"audio",rawEvent:e,readyState:(null===(t=r._audioDom)||void 0===t?void 0:t.readyState)||0,userId:r.userId,eventName:e.type,currentTime:(null===(n=r._audioDom)||void 0===n?void 0:n.currentTime)||0};"playing"===e.type&&EQ.info("AudioPlayerPlaying","[userId-".concat(r.userId,"] audio element playing")),"pause"===e.type&&(EQ.info("AudioPlayerPause","[userId-".concat(r.userId,"] audio element pause")),r._pasued||r._internalPlay()),vG&&vF&&("canplay"===e.type?(clearTimeout(r._wechatTimer),r._wechatTimer=window.setTimeout(function(){r._autoPlayError("wechat")},500)):"playing"===e.type&&clearTimeout(r._wechatTimer)),vB&&vL&&"error"===e.type&&(clearTimeout(r._edgeTimer),r._edgeTimer=window.setTimeout(function(){var e;0===(null===(e=r._audioDom)||void 0===e?void 0:e.currentTime)&&r._autoPlayError("edge")},500)),r.emit("playback_event",i)}),iT(dn(r),"_internalPlay",function(){if(p3(r.engineId,"_internalPlay",{paused:null===(i=r._audioDom)||void 0===i?void 0:i.paused}),null!==(o=r._audioDom)&&void 0!==o&&o.paused)try{var e,t,n,i,o,a,s=r._audioDom.play(),c=gu.getAudioContextInstance();if("suspended"===c.state){var u=c.resume(),d=setTimeout(function(){var e;"suspended"===c.state&&(r._autoPlayError("AudioContext cannot resume"),null===(e=r._monitor)||void 0===e||e.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(r.userId,": Cannot resume the AudioContext"),error_code:y$.AUTOPLAY_F.then(function(){clearTimeout(d)})}null!==(a=s)&&void 0!==a&&a.then&&(vG&&vB&&(s=s.then(function(){return new aj(function(e){setTimeout(a2(a0().mark(function t(){var n;return a0().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return null===(n=r._audioDom)||void 0===n||n.pause(),r._audioDom.volume=1,t.next=4,r._audioDom.play();case 4:e();case 5:case"end":return t.stop()}},t)})),500)})})),s.then(function(){p3(r.engineId,"_internalPlay successfully",{userId:r.userId}),r._pasued=!1}).catch(function(e){var t,n,i;r._autoPlayError(e),null===(t=r._monitor)||void 0===t||t.report("rtc_error",{message:a4(n=a4(i="audio autoplay failed, userId: ".concat(r.userId,": ")).call(i,e.message," ")).call(n,e.name),error_code:y$.AUTOPLAY_FAILED})}))}catch(i){r._autoPlayError(i),null===(e=r._monitor)||void 0===e||e.report("rtc_error",{message:a4(t=a4(n="audio autoplay failed, userId: ".concat(r.userId,": ")).call(n,i.message," ")).call(t,i.name),error_code:y$.AUTOPLAY_FAILED})}}),r.engineId=e,a){var u=document.getElementById(a);if(!u)throw new lM(le.CANT_FIND_DOM,"can't find dom");r._containerDom=u}else r._containerDom=document.body;return r.userId=t,r.muted=s,r.isScreen=c,r._monitor=pZ(e),r._initAudio(),r}return ib(i,[{key:"_initAudio",value:function(){var e;this._audioDom||(this._audioDom=EJ("audio",{style:{display:"none"},attributes:E$}),this._audioDom.volume=this.muted?0:1,this._audioDom.muted=this.muted,this._audioDom.id=a4(e="".concat(this.userId,"_")).call(e,p7()),this._containerDom.appendChild(this._audioDom)),this._initListeners()}},{key:"_initListeners",value:function(){var e=this;this._audioDom&&EZ.forEach(function(t){var r;null===(r=e._audioDom)||void 0===r||r.addEventListener(t,e.emitAudioEvent)})}},{key:"_removeListeners",value:function(){var e=this;this._audioDom&&(EZ.forEach(function(t){var r;null===(r=e._audioDom)||void 0===r||r.removeEventListener(t,e.emitAudioEvent)}),this._audioDom.removeEventListener("canplay",this._internalPlay),this._audioDom.removeEventListener("loadeddata",this._internalPlay))}},{key:"playAudio",value:(r=a2(a0().mark(function e(t){var r,n,i,o,a,s=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(EQ.info("playAudio","play audio track: ".concat(this.userId)),!((o=this._audioDom)&&o.srcObject instanceof MediaStream&&o.srcObject.getTrackById(null===(r=t.getTrack())||void 0===r?void 0:r.id))){e.next=4;break}return e.abrupt("return");case 4:o||(this._initAudio(),o=this._audioDom),a=new MediaStream,t instanceof gG.RemoteAudioTrack?(this._fakeAudioDom=new Audio,this._fakeAudioDom.muted=!0,this._fakeAudioDom.srcObject=new MediaStream([t.getOrgTrack()]),a.addTrack(t.getTrack())):a.addTrack(t.getTrack("preprocessing")),vG&&vB&&(this._audioDom.volume=0),o.srcObject=a,null===(n=o)||void 0===n||n.addEventListener("canplay",this._internalPlay),null===(i=o)||void 0===i||i.addEventListener("loadeddata",this._internalPlay),setTimeout(function(){return s._internalPlay()}),this.played=!0;case 13:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_autoPlayError",value:function(e){var t,r;this._emitPlayFailed||(this._emitPlayFailed=!0,this.emit("playback_event",{type:"audio",rawEvent:e,readyState:(null===(t=this._audioDom)||void 0===t?void 0:t.readyState)||0,userId:this.userId,eventName:"autoplay-error",currentTime:(null===(r=this._audioDom)||void 0===r?void 0:r.currentTime)||0}))}},{key:"pause",value:function(){if(!this._audioDom)throw new lM(le.INVALID_PARAMS,"Player not found");this._pasued=!0,this._audioDom.pause()}},{key:"manuallyPlay",value:function(){var e,t=this;if(EQ.info("Invoke AudioPlayer.manuallyPlay"),this._emitPlayFailed=!1,!this._audioDom)throw new lM(le.INVALID_PARAMS,"Player not found");if(!this.played)return aj.resolve();this._audioDom.volume=1,this._audioDom.muted=!1,null===(e=this._fakeAudioDom)||void 0===e||e.play();var r=[],n=this._audioDom.play();null!=n&&n.then&&r.push(n);var i=gu.getAudioContextInstance();if("suspended"===i.state){var o=i.resume();null!=o&&o.then&&r.push(o)}(r.length>0?aj.all(r):aj.resolve(n)).then(function(){t._pasued=!1})}},{key:"setPlaybackDevice",value:(t=a2(a0().mark(function e(t){var r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return EQ.info("setPlaybackDevice","setPlaybackDevice: ".concat(t)),e.next=3,gr.enumerateAudioPlaybackDevices();case 3:if(c1(n=se(r=e.sent).call(r,function(e){return e.deviceId})).call(n,t)&&this._audioDom&&this._audioDom.setSinkId){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this._audioDom.setSinkId(t);case 9:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"stop",value:function(){var e=this._containerDom;EQ.info("stopAudio","stop audio track: ".concat(this.userId)),this._audioDom&&(this._audioDom.srcObject=null,null!=e&&e.contains(this._audioDom)&&e.removeChild(this._audioDom)),this._fakeAudioDom&&(this._fakeAudioDom.srcObject=null,this._fakeAudioDom=void 0),this.played=!1}},{key:"domElement",get:function(){return this._audioDom}},{key:"destroy",value:function(){EQ.info("destroy","audio player: ".concat(this.userId)),this.stop(),dm(df(i.prototype),"removeAllListeners",this).call(this),this._removeListeners(),this._audioDom&&(this._audioDom.srcObject=null,delete this._audioDom),this._edgeTimer&&clearTimeout(this._edgeTimer)}}]),i}();function E3(e,t,r,n){var i,o=(i=a2(a0().mark(function e(t,i){var o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(o=null==n?void 0:n.get(i))&&(o=null===(a=o)||void 0===a?void 0:cS(a).call(a,function(e){return e.isScreen===r})),!t){e.next=9;break}if(!t.played){e.next=8;break}return e.next=6,t.manuallyPlay();case 6:e.next=9;break;case 8:o&&(t instanceof E1&&o.videoTrack&&t.playVideo(o.videoTrack,o),t instanceof E2&&o.audioTrack&&t.playAudio(o.audioTrack));case 9:case"end":return e.stop()}},e)})),function(e,t){return i.apply(this,arguments)});if(t)return o(e.gection(e,t){return a.push(o(e,t))}),aj.a"x"!==new URL("http://x",void 0).host}),E6=/[^\0-\u007E]/,E8=/[.\u3002\uFF0E\uFF61]/g,E7="Overflow: input needs wider integers to process",E9=RangeError,Te=I(E8.exec),Tt=Math.floor,Tr=String.fromCharCode,Tn=I("".charCodeAt),Ti=I([].join),To=I([].push),Ta=I("".replace),):(,Td(e/==c),a=0,u++}}a++,o++}return Ti(n,"")},T_=eN("iterator"),Tp="URLSearchParams",Tv=Tp+"Iterator",Tf=rV.set,Tm=rV.getterFor(Tp),Tg=rV.getterFor(Tv) l[e];var t=Ty(l,e);return t&&t.value},Tb=TS("fetch"),TE=TS("Request"),TT=TS("Headers"),Tk=TE&&TE.prototype,TI=TT&&TT.prototype,TR=l.RegExp,TA=l.TypeError,TC=l.decodeURIComponent,Tw=l.encodeURIComponent,Tx=I("".charAt),TO=I([].join),TN=I([].push),TP=I("".replace),TD=I([].shift),TM=I([].splice),TL=I("".split){t-f]{2}){"+t+"})","gi")),TB);return r}},TG=/[!'()~]|%20/g,TH={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20TK=funv,iterator:alues"=eof e?"?"===Tx(e,0)?TU(e,1):e::function(e)(this.entri{key:Tj(TDey)+"="gth=0,thisunction(rguments[0]:void 0;Tf(this,new TWkey:tW(].kekey===ri].k;)if||TN(turn e.kength;)n((t=r[i++]).value,t.key,this)},keys:function(){return new TX(this,"keys")},values:function()ction(){return new TX(this,"entries")}},{enumerable:!0}),ry(TY,T_,TY.entries,{name:"entries"}),ry(TY,"toString",function(){return Tm(this).serialize()},{enumerable:!0}),rx(Tq,Tp),tt({global:!0,constructor:!0,forced:!E4},{URLSearchParams:Tq}),!E4&&w:B(0,tW(r)),headers:B(0,t)})}return e};if(w(Tb)&&tt({global:!0,enumerable:guments.length>1guments.length>1?TZ(arguments[1]):{})};Tk.constructor=T$,T$.prototype=Tk,tt({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:T$})}}var T0,T1=function(e,t,[t])?"xn--"+Th(r):r);return Ti(n,".")},T5={URLSearchParams:Tq,getState:Tm},T4=rV.set,T6=rV.getterFor("URL"),T8=T5.URLSearchParams,T7=T5.getState,T9=l.URL,ke=l.TypeError,kt=l.parseInt,kr=Math.floor,kn=Math.pow,ki=I("".charAt),ko=I(/./.exec),ka=I([].join),ks=I(1..toString),kc=I([].pop),ku=I([].push),kd=I("".replace),kl=I([].shift),kh=I("".split),k_=I("".slice),kp=I("".toLowerCase),kv=I([].unshift),kf="Invalid scheme",km="Invalid host",kg="Invalid port",ky=/[a-z]/i,kS=/[\d+-.a-z]/i,kb=/\d/,kE=/^0x/i,kT=/^[0-7]+$/,kk=/^\d+$/,kI=/^[\da-f]+$/i,kR=/[\0\t\n\r #%/:<>?@[\\\]^|]/,kA=/[\0\t\n\r #/:<>?@[\\\]^|]/,kC=/^[\u0000-\u0020]+ngth;n++)s+=r[n]*kn(256,3-n);return s},kO=function(e){var t,r,n,i,o,a,=null,l=0,h=function(){return ki(e,l)};if(":"==h()){if(":"!=ki(e,1))return;l+=2,d=++u}for(;h();){if(8==u)return;if(":"!=h()){for(t=r=0;r<4&&ko(kI,h());)t=16*t+kt(h(),16),l++,r++;if("."==h()){if(0==r||(l-=r,u>6))return;for(n=0;h();){if(i=null,n>0){if(!("."==h()&&n<4))return;l++}if(!ko(kb,h()))return;for(;ko(kb,h());){if(o=kt(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;l++}c[u]=256*c[u]+i,2!=++n&&4!=n||u++}if(4!=n)return;break}if(":"==h()){if(l++,!h())return}else if(h())return;c[u++]=t}else{if(null!==d)return;l++,d=++u}}if(null!==d)for(a=u-d,u=7;0!=u&&a>0;)s=c[u],c[u--]=c[d+a-1],c[d+-n&&&&(t+=":")));return"["+t+"]"}return e},kD={},kM=s6({},kD,{" ":1,'"':1,"<":1,">":1,"`":1}),kL=s6({},kM,{"#":1,"?":1,"{":1,"}":1}),kU=s6({},kL,{"/":1,":":1,";":1,"=":1,"@"127&&!eT(t,e)?e:encodeURIComponent(e)},kF={ftp:21,file:nue,0ki(e,2))||"\\"===t||"?"===t||"#"===t)},kG={},kH={},kz={},kK={},kX={},kW={},kq={},kY={},kJ={},kQ={},kZ={},k$={},k0={},k1={},k2={},)).bindURL(this),this.searchParams=o}};k9.prototype={type:"URL",parse:function(e,t,r){var n,i,o,a,s=t||kG,c=0,u="",d=!1,l=!1,h=!1;for(e=tW(e),t||(this.scheme="",this.username="",this.password="",this.host=null,this.port=null,this.path=[],this.query=null,this.fragment=null,this.cannotBeABaseURL=!1,e=kd(e,kC,"")),n=us(e=kd(e,kw,""));c<=n.length;){switch(i=n[c],s){case kG:if(!i||!ko(ky,i)){if(t)return kf;s=kz;continue}u+=kp(i),s=kH;break;case kH:if(i&&(ko(kS,i)||"+"==i||"-"==i||"."==i))u+=kp(i);else{if(":"!=i){if(t)return kf;u="",s=kz,c=0;continue}if(t&&(this.isSpecial()!=eT(kF,u)||"file"==u&&(this.includesCredentials()||null!==this.port)||"file"==this.scheme&&!this.host))return;if(this.scheme=u,t)return void(this.isSpecial()&&kF[this.scheme]==this.port&&(this.port=null));u="","file"==this.scheme?s=k1:this.isSpecial()&&r&&r.scheme==this.scheme?s=kK:this.isSpecial()?s=kY:"/"==n[c+1]?(s=kX,c++):(this.cannotBeABaseURL=!0,ku(this.path,""),s=k6)}break;case kz:if(!r||r.cannotBeABaseURL&&"#"!=i)return kf;if(r.cannotBeABaseURL&&"#"==i){this.scheme=r.scheme,this.path=rp(r.path),this.query=r.query,this.fragment="",this.cannotBeABaseURL=!0,s=k7;break}s="file"==r.scheme?k1:kW;continue;case kK:if("/"!=i||"/"!=n[c+1]){s=kW;continue}s=kJ,c++;break;case kX:if("/"==i){s=kQ;break}s=k4;continue;case kW:if(this.scheme=r.scheme,i==T0)this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=rp(r.path),this.query=r.query;else if("/"==i||"\\"==i&&this.isSpecial())s=kq;else if("?"==i)this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=rp(r.path),this.query="",s=k8;else{if("#"!=i){this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=rp(r.path),this.path.length--,s=k4;continue}this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=rp(r.path),this.query=r.query,this.fragment="",s=k7}break;case kq:if(this.isSpecial()&&("/"==i||"\\"==i))s=kJ;else{if("/"!=i){this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,s=k4;continue}s=kQ}break;case kY:if(s=kJ,"/"!=i||"/"!=ki(u,c+1))continue;c++;break;case kJ:if("/"!=i&&"\\"!=i){s=kQ;continue}break;case kQ:if("@"==i){d&&(u="%40"+u),d=!0,o=us(u);for(var _,p,v=0;v<o.length;v++){var f=o[v];if(":"!=f||h){var m=kV(f,kU);h?this.password+=m:this.username+=m}else h=!0}u=""}else if(i==T0||"/"==i||"?"==i||"#"==i||"\\"==i&&this.isSpecial()){if(d&&""==u)return"Invalid authority";c-=us(u).length+1,u="",s=kZ}else u+=i;break;case kZ:case k$:if(t&&"file"==this.scheme){s=k3;continue}if(":"!=i||l){if(i==T0||"/"==i||"?"==i||"#"==i||"\\"==i&&this.isSpecial()){if(this.isSpecial()&&""==u)return km;if(t&&""==u&&(this.includesCredentials()||null!==this.port))return;if(a=this.parseHost(u))return a;if(u="",s=k5,t)return;continue}"["==i?l=!0:"]"==i&&(l=!1),u+=i}else{if(""==u)return km;if(a=this.parseHost(u))return a;if(u="",s=k0,t==k$)return}break;case k0:if(!ko(kb,i)){if(i==T0||"/"==i||"?"==i||"#"==i||"\\"==i&&this.isSpecial()||t){if(""!=u){var g=kt(u,10);if(g>65535)return kg;this.port=this.isSpecial()&&g===kF[this.scheme]?null:g,u=""}if(t)return;s=k5;continue}return kg}u+=i;break;case k1:if(this.scheme="file","/"==i||"\\"==i)s=k2;else{if(!r||"file"!=r.scheme){s=k4;continue}if(i==T0)this.host=r.host,this.path=rp(r.path),this.query=r.query;else if("?"==i)this.host=r.host,this.path=rp(r.path),this.query="",s=k8;else{if("#"!=i){kj(ka(rp(n,c),""))||(this.host=r.host,this.path=rp(r.path),this.shortenPath()),s=k4;continue}this.host=r.host,this.path=rp(r.path),this.query=r.query,this.fragment="",s=k7}}break;case k2:if("/"==i||"\\"==i){s=k3;break}r&&"file"==r.scheme&&!kj(ka(rp(n,c),""))&&(kB(r.path[0],!0)?ku(this.path,r.path[0]):this.host=r.host),s=k4;continue;case k3:if(i==T0||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&kB(u))s=k4;else if(""==u){if(this.host="",t)return;s=k5}else{if(a=this.parseHost(u))return a;if("localhost"==this.host&&(this.host=""),t)return;u="",s=k5}continue}u+=i;break;case k5:if(this.isSpecial()){if(s=k4,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i){if(t||"#"!=i){if(i!=T0&&(s=k4,"/"!=i))continue}else this.fragment="",s=k7}else this.query="",s=k8;break;case k4:if(i==T0||"/"==i||"\\"==i&&this.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(_=kp(_=u))||"%2e."===_||".%2e"===_||"%2e%2e"===_?(this.shortenPath(),"/"==i||"\\"==i&&this.isSpecial()||ku(this.path,"")):"."===(p=u)||"%2e"===kp(p)?"/"==i||"\\"==i&&this.isSpecial()||ku(this.path,""):("file"==this.scheme&&!this.path.length&&kB(u)&&(this.host&&(this.host=""),u=ki(u,0)+":"),ku(this.path,u)),u="","file"==this.scheme&&(i==T0||"?"==i||"#"==i))for(;this.path.length>1&&""===this.path[0];)kl(this.path);"?"==i?(this.query="",s=k8):"#"==i&&(this.fragment="",s=k7)}else u+=kV(i,kL);break;case k6:"?"==i?(this.query="",s=k8):"#"==i?(this.fragment="",s=k7):i!=T0&&(this.path[0]+=kV(i,kD));break;case k8:t||"#"!=i?i!=T0&&("'"==i&&this.isSpecial()?this.query+="%27":this.query+="#"==i?"%23":kV(i,kD)):(this.fragment="",s=k7);break;case k7:i!=T0&&(this.fragment+=kV(i,kM))}c++}},parseHost:function(e){var t,r,n;if("["==ki(e,0)){if("]"!=ki(e,e.length-1)||!(t=kO(k_(e,1,-1))))return km;this.host=t}else if(this.isSpecial()){if(ko(kR,e=T3(e))||null===(t=kx(e)))return km;this.host=t}else{if(ko(kA,e))return km;for(t="",r=us(e),n=0;n<r.length;n++)t+=kV(r[n],kD);this.hcannotBeABaseURL||"fn""!=this.:function(){scheme&&1==a&&(c+=hrow ke(t)this.host)+(col:function:function(e){this.parse(tW(e)+":",kG)},getUsername:function(){return this.username},setUsername:function(e){var t=us(tW(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=kV(t[r],kU)}},getPassword:functiength;r+ull===e?"":null===t?kP(e):kP(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,kZ)},getHostname:function(){var e=this.hostis.canno e=this.(e))?this.poaseURL?e[0]:eURL||(this.path=[],this.parse(e,k5))},getSearch:function(){var e=trse(e,k8)),this.searchParams.update()},getSearchParams:function(){revar e=th,this.py=this.sgetSearchParams(),tt](e)},configurable:!0,enumerable:!0}};if(O&&(T1(It,"href",Ir("serialize","setHref")),T1(It,"origin",Ir("getOrigin")),T1(It,"protocol",Ir("getProtocol","setProtocol")),T1(It,"username",Ir("getUsername","setUsername")),T1(It,"password",Ir("getPassword","setPassword")),T1(It,"host",Ir("getHost","setHost")),T1(It,"hostname",Ir("getHostname","setHostname")),T1(It,"port",Ir("getPort","setPort")),T1(It,"pathname",Ir("getPathname","setPathname")),T1(It,"search",Ir("getSearch","setSearch")),T1(It,"searchParams",Ir("getSearchParams")),T1(It,"hash",Ir("getHash","setHash"))),ry(It,"toJSON",function(){return T6(this).serializunction(){return T6(this).serialize()},{enumerable:!0}),T9){var In=T9.createObjectURL,Ii=T9.revokeObjectURL;In&&ry(Ie,"createObjectURL",eJ(In,T9)),Ii&&ry(Ie,"revokeObjectURL",eJ(Ii,T9))}rx(Ie,"URL"),tt({global:!0,constructor:!0,forced:!E4,sham:!O},{URL:Ie});var Io=J.URL,Ia=(Ik=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Audio(Io.createObjectURL(new Blob([t],r))),e.prev=1,n.muted=!0,e.next=5,n.play();case 5:return n.pause(),e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e,t){return Ik.apply(this,arguments)}),Is=function(e,t,r,n){for(var i,o=n>1?void 0:n?cq(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&to(t,r,o),o},Ic=function(){var e,t,r;function n(e,t){iE(this,n),iT(this,"_sharedAudioContext",new AudioContext),iT(this,"_audioDestination",this._sharedAudioContext.createMediaStreamDestination()),iT(this,"_localGainNode",this._sharedAudioContext.createGain()),iT(this,"_bufferGainNode",this._sharedAudioContext.createGain()),iT(this,"_audioBufferSource",void 0),iT(this,"_localSource",void 0),iT(this,"_context",void 0),iT(this,"_failedAudioList",[]),iT(this,"_startingIds",new sF),iT(this,"_revokeURLs",new fO),iT(this,"mixingMap",new sF),iT(this,"resourcesCache",new sF),iT(this,"volumeConfig",new sF),iT(this,"cachedBuffer",[]),iT(this,"id","AudioMixingManager"),this.engineId=t,this._context=e,this._localGainNode.gain.value=1}return ib(n,[{key:"mixMediaStream",value:function(e){this._localSource&&this._localSource.disconnect(this._localGainNode),this._localSource=this._sharedAudioContext.createMediaStreamSource(e),this._localSource.connect(this._localGainNode).connect(this._audioDestination)}},{key:"startAudioMixing",value:(r=a2(a0().mark(function e(t,r,n){var i,o,a,s,c,u,d,l,h,_,p,v,f,m=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this._startingIds.get(t)){e.next=3;break}return e.abrupt("return");case 3:if(this._startingIds.set(t,t),i=n.playCount,fd(o=n.type,"mixingType",En(f4)),a=this._context.getLocalAudioTrack()){e.next=9;break}return e.abrupt("return");case 9:if((s=a.getTrack("preprocessing"))&&this.mixMediaStream(new MediaStream([s])),null!=(c=this.mixingMap.get(t))&&c.audioNode){c.audioNode.pause(),this._context.emitMessage({mixId:t,state:f6.AUDIO_MIXING_STATE_STOPPED,error:lt.AUDIO_MIXING_ERROR_OK});try{c.gainNode.disconnect(this._audioDestination),c.audioSource.disconnect(c.gainNode)}catch(e){}}if(!(d=this.resourcesCache.get(t))||d.filePath!==r){e.next=18;break}u=d.getAudioNode(),e.next=31;break;case 18:return e.next=20,fetch(r,{mode:"cors",credentials:"include"}).then(function(e){if(e.ok)return e.arrayBuffer();throw m._context.emitMessage({mixId:t,state:f6.AUDIO_MIXING_STATE_FAILED,error:lt.AUDIO_MIXING_ERROR_START_FAILED}),new lM(le.LOAD_RESOURCES_FAILED,e.statusText)});case 20:return l=e.sent,cu(r).call(r,"mp3")?h={type:"audio/mpeg"}:cu(r).call(r,"aac")&&(h={type:"audio/aac"}),e.next=24,Ia(l,h);case 24:if(e.sent){e.next=28;break}throw this._context.emitMessage({mixId:t,state:f6.AUDIO_MIXING_STATE_FAILED,error:lt.AUDIO_MIXING_ERROR_START_FAILED}),new lM(le.LOAD_RESOURCES_FAILED,"invalid audio resource");case 28:(u=new Audio).crossOrigin="anonymous",u.src=Io.createObjectURL(new Blob([l],h));case 31:return i<=0?u.loop=!0:i>0&&(_=i,u.onended=function(){--_>0?u.play():(m.mixingMap.delete(t),m._context.emitMessage({mixId:t,state:f6.AUDIO_MIXING_STATE_FINISHED,error:lt.AUDIO_MIXING_ERROR_OK}))}),e.prev=32,e.next=35,u.play();case 35:e.next=42;break;case 37:e.prev=37,e.t0=e.catch(32),this._failedAudioList.push(u),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:ll.STREAM_INDEX_MAIN,mediaType:lh.AUDIO});case 42:if(this._startingIds.delete(t),p=this._sharedAudioContext.createMediaElementSource(u),v=this._sharedAudioContext.createGain(),f=this.volumeConfig.get(t),v.gain.value=f?f/100:1,p.connect(v).connect(this._audioDestination),this.mixingMap.set(t,{audioSource:p,audioNode:u,gainNode:v,type:"file"}),o===f4.PUBLISH)try{v.disconnect(this._sharedAudioContext.destination)}catch(e){}else v.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],n.type),this._context.emitMessage({mixId:t,state:f6.AUDIO_MIXING_STATE_PLAYING,error:lt.AUDIO_MIXING_ERROR_OK});case 52:case"end":return e.stop()}},e,this,[[32,37]])})),function(e,t,n){return r.apply(this,arguments)})},{key:"stopAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&"file"===t.type&&(this.mixingMap.delete(e),t.audioNode.pause(),t.audioSource.disconnect(t.gainNode),t.gainNode.disconnect(this._audioDestination),this._context.emitMessage({mixId:e,state:f6.AUDIO_MIXING_STATE_STOPPED,error:lt.AUDIO_MIXING_ERROR_OK}))}},{key:"pauseAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:f6.AUDIO_MIXING_STATE_PAUSED,error:lt.AUDIO_MIXING_ERROR_OK}),t.audioNode.pause())}},{key:"resumeAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:f6.AUDIO_MIXING_STATE_PLAYING,error:lt.AUDIO_MIXING_ERROR_OK}),t.audioNode.play())}},{key:"preloadAudioMixing",value:(t=a2(a0().mark(function e(t,r){var n,i,o=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAudioMixing(t),e.next=3,fetch(r,{mode:"cors",credentials:"include"}).then(function(e){if(e.ok)return e.arrayBuffer();throw new lM(le.LOAD_RESOURCES_FAILED,e.statusText)}).catch(function(e){if(o._context.emitMessage({mixId:t,state:f6.AUDIO_MIXING_STATE_FAILED,error:lt.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),e instanceof lM)throw e;throw new lM(le.LOAD_RESOURCES_FAILED,"Load resources failed",e)});case 3:return n=e.sent,cu(r).call(r,"mp3")?i={type:"audio/mpeg"}:cu(r).call(r,"aac")&&(i={type:"audio/aac"}),e.next=7,Ia(n,i);case 7:if(e.sent){e.next=11;break}throw this._context.emitMessage({mixId:t,state:f6.AUDIO_MIXING_STATE_FAILED,error:lt.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),new lM(le.LOAD_RESOURCES_FAILED,"Load resources failed");case 11:return this._context.emitMessage({mixId:t,state:f6.AUDIO_MIXING_STATE_PRELOADED,error:lt.AUDIO_MIXING_ERROR_OK}),this.resourcesCache.set(t,{getAudioNode:function(){var e=Io.createObjectURL(new Blob([n],i));return o._revokeURLs.add(e),new Audio(e)},filePath:r,duration:0}),e.next=15,new aj(function(e){var r=Io.createObjectURL(new Blob([n],i)),a=new Audio(r);a.addEventListener("durationchange",function(){var n=o.resourcesCache.get(t);n&&(n.duration=a.duration,o.resourcesCache.set(t,n)),Io.revokeObjectURL(r),e(null)})});case 15:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,argumehas(e)&&this.resourcesCache.delete(e)}},{key:"getAudioMixingVolume",value:function(e){var t=this.mixingMap.get(e);return t?100*t.gainNode.gain.value:0}},{key:"setAudioMixingVolume",value:function(e,t){t<0?t=0:t>400&&(t=400),this.volumeConfig.set(e,t);var r=this.mixingMap.get(e);r&&(r.gainNode.gain.value=Number(t)/100)}},{key:"getAudioMixingDuration",value:function(e){var t=this.mixingMap.get(e),r=this.resourcesCache.get(e);return t||r?t?1e3*t.audioNode.duration:r?1e3*r.duration:0:0}},{key:"getAudioMixingCurrentPosition",value:function(e){var t=this.mixingMap.get(e);return t?1e3*t.audioNode.currentTime:0}},{key:"setAudioMixingPosition",value:function(e,t){var r=this.mixingMap.get(e);r&&(r.audioNode.currentTime=t/1e3,r.audioNode.play())}},{key:"enableAudioMixingBuffer",value:function(e){fd(e,"type",En(f4));var t=this._context.getLocalAudioTrack();if(t){var r=t.getTrack("preprocessing");if(r&&this.mixMediaStream(new MediaStream([r])),e===f4.PUBLISH)try{this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(e){}else this._bufferGainNode.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],e),this._bufferGainNode.connect(this._audioDestination),this._context.emitMessage({mixId:-1,state:f6.AUDIO_MIXING_STATE_PCM_ENABLED,error:lt.AUDIO_MIXING_ERROR_OK})}}},{key:"disableAudioMixingBuffer",value:function(){if(this.cachedBuffer=[],this._audioBufferSource){try{this._audioBufferSource.disconnect(this._bufferGainNode),this._bufferGainNode.disconnect(this._audioDestination),this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(e){}finally{this._audioBufferSource=void 0}this._context.updateLocalAudioTrack(),this._context.emitMessage({mixId:-1,state:f6.AUDIO_MIXING_STATE_PCM_DISABLED,error:lt.AUDIO_MIXING_ERROR_OK})}}},{key:"pushAudioMixingBuffer",value:function(e){var t=this;if(!(this._audioBufferSource&&(this.cachedBuffer.push(e),this.cachedBuffer.length>0))){this._audioBufferSource=this._sharedAudioContext.createBufferSource(),this._audioBufferSource.buffer=e,this._audioBufferSource.connect(this._bufferGainNode);try{this._audioBufferSource.start()}catch(e){this._failedAudioList.push(this._audioBufferSource)}this._audioBufferSource.onended=function(){var e;if(null===(e=t._audioBufferSource)||void 0===e||e.disconnect(t._bufferGainNode),t._audioBufferSource=void 0,t.cachedBuffer.length){var r=t.cachedBuffer.shift();r&&t.pushAudioMixingBuffer(r)}}}}},{key:"stopAll",value:function(){var e=this;if(this._localSource)try{this._localSource.disconnect(this._localGainNode),delete this._localSource}catch(e){}this.mixingMap.forEach(function(t,r){e.stopAudioMixing(r)})}},{key:"mixTrack",get:function(){return this._audioDestination.stream.getAudioTracks()[0]}},{key:"sharedAudioContext",get:function(){return this._sharedAudioContext}},{key:"resumeLocalPlay",value:(e=a2(a0().mark(function e(){var t,r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=u2(this._failedAudioList),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=24;break}if(i=n.value,e.prev=6,!(i instanceof HTMLAudioElement)){e.next=13;break}return i.muted=!1,e.next=11,i.play();case 11:e.next=14;break;case 13:i.start();case 14:e.next=22;break;case 16:return e.prev=16,e.t0=e.catch(6),t.push(i),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:ll.STREAM_INDEX_MAIN,mediaType:lh.AUDIO}),e.abrupt("break",24);case 22:e.next=4;break;case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(2),r.e(e.t1);case 29:return e.prev=29,r.f(),e.finish(29);case 32:this._failedAudioList=t;case 33:case"end":return e.stop()}},e,this,[[2,26,29,32],[6,16]])})),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){var e=this._sharedAudioContext;"closed"!==e.state&&"function"==typeof e.close&&e.close(),this.cachedBuffer=[],this.mixingMap.clear(),this.resourcesCache.clear(),this.volumeConfig.clear(),this._startingIds=new sF,this._revokeURLs.forEach(function(e){Io.revokeObjectURL(e)})}}]),n}();Is([p1("id","filePath","options")],Ic.prototype,"startAudioMixing",1),Is([p1("id")],Ic.prototype,"stopAudioMixing",1),Is([p1("id")],Ic.prototype,"pauseAudioMixing",1),Is([p1("id")],Ic.prototype,"resumeAudioMixing",1),Is([p1("id")],Ic.prototype,"preloadAudioMixing",1),Is([p1("id")],Ic.prototype,"unloadAudioMixing",1),Is([p1("id")],Ic.prototype,"getAudioMixingVolume",1),Is([p1("id","volume")],Ic.prototype,"setAudioMixingVolume",1),Is([p1("id")],Ic.prototype,"getAudioMixingDuration",1),Is([p1("id")],Ic.prototype,"getAudioMixingCurrentPosition",1),Is([p1("id","position")],Ic.prototype,"setAudioMixingPosition",1),Is([p1("type")],Ic.prototype,"enableAudioMixingBuffer",1),Is([p1()],Ic.prototype,"disableAudioMixingBuffer",1),Is([p1("buffer")],Ic.prototype,"pushAudioMixingBuffer",1);var Iu=((II=Iu||{}).NORMAL_USER="normalUser",II.SILENT_USER="silentUser",II),Id=new h1("RTMClient",1),Il=function(e){dy(c,fT.exports.EventEmitter);var t,r,n,i,o,a,s=dC(c);function c(e){var t;return iE(this,c),iT(dn(t=s.call(this)),"_dataChannelSignal",void 0),iT(dn(t),"_handler",void 0),iT(dn(t),"_dataChannelSignalState",Ec.DISCONNECTED),iT(dn(t),"_loginSessionId",null),iT(dn(t),"_userId",null),iT(dn(t),"_token",null),iT(dn(t),"_loginResolveCallback",void 0),iT(dn(t),"_loginRejectCallback",void 0),iT(dn(t),"_wait_login_token",!1),iT(dn(t),"_serverParamsCache",void 0),iT(dn(t),"id",void 0),iT(dn(t),"_connectionManager",void 0),iT(dn(t),"isReconnecting",!1),t._ctx=e,t.id=e.id,t._connectionManager=new Eo(e),t._addConnectHandler(),t}return ib(c,[{key:"login",value:function(e,t){var r=this;return new aj(function(n,i){var o;if(Id.info("login","invoke login, token: %o, userId: %o",e,t),r._loginSessionId)throw new lM(le.ALREADY_LOGIN,"Already logined");if(r._loginResolveCallback)throw new lM(le.LOGIN_FAILED,"Is logging in, please try again later.");r._userId=t,r._token=e,null===(o=pZ(r.id))||void 0===o||o.set({rtm_user_id:t}),r._loginResolveCallback=n,r._loginRejectCallback=i,r._dataChannelSignal?r._login():r.connect().then(function(){r._login()})})}},{key:"logout",value:(a=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new lM(le.NOT_LOGIN,"login first");case 2:return e.next=4,null===(t=this._dataChannelSignal)||void 0===t?void 0:t.sendSignaling("logout",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId},{functionType:So.C2RTM}).catch(function(){});case 4:this._clearState();case 5:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"updateLoginToken",value:(o=a2(a0().mark(function e(t){var r=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._token=t,e.abrupt("return",new aj(function(e,t){r._wait_login_token?(r._loginResolveCallback=e,r._loginRejectCallback=t,r._login()):e()}));case 2:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(i=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new lM(le.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.next=5,this._dataChannelSignal.sendSignaling("getPeerOnlineStatus",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,peerUserId:t},{functionType:So.C2RTM});case 5:return r=e.sent,e.abrupt("return",null==r?void 0:r.status);case 7:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(n=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new lM(le.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.abrupt("return",this._dataChannelSignal.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:t,room:"",msg:r}));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"setServerParams",value:(r=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,fu(t,"signature"),fu(r,"url"),this._loginSessionId&&this._userId){e.next=5;break}throw new lM(le.NOT_LOGIN,"login first");case 5:return this._checkDataChannelSignal(),e.next=8,this._dataChannelSignal.sendSignaling("setServerParams",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,signature:t,url:r},{functionType:So.C2RTM}).catch(function(e){throw new lM(le.UNEXPECTED_ERROR,e.msg)});case 8:this._serverParamsCache={signature:t,url:r},this.emit("onServerParamsSetResult"),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(0),this.emit("onServerParamsSetResult",e.t0),e.t0;case 16:case"end":return e.stop()}},e,this,[[0,12]])})),function(e,t){return r.apply(this,arguments)})},{key:"sendServerMessage",value:(t=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new lM(le.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.abrupt("return",this._dataChannelSignal.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:"",room:"",type:y9.BUSINESS_SERVER,msg:t}));case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;Id.info("destroy","invoke."),dm(df(c.prototype),"removeAllListeners",this).call(this),this._loginResolveCallback&&this._loginRejectCallback&&(this._loginRejectCallback(new lM(le.LOGIN_FAILED,"logout")),delete this._loginResolveCallback,delete this._loginRejectCallback),null===(e=this._dataChannelSignal)||void 0===e||e.destroy(),delete this._dataChannelSignal,this._clearState(),this._connectionManager.destroy(),delete this._serverParamsCache}},{key:"_login",value:function(){var e=this;if(this._userId){var t=p7();this._checkDataChannelSignal(),this._dataChannelSignal.sendSignaling("login",{Token:vt.token2auth(this._ctx.appId,null,this._userId,this._token),timestamp:Date.now(),loginSessionId:t,params:{deviceType:"web",userAgent:window.navigator.userAgent,sdkVersion:ft.VERSION,deviceId:v4.getDeviceId(),appId:this._ctx.appId,userId:this._userId}},{functionType:So.C2RTM}).then(function(){"function"==typeof e._loginResolveCallback&&e._loginResolveCallback(),e._loginSessionId=t,pj.setRtsSessionId(e.id,t),e._wait_login_token=!1,e._serverParamsCache&&e.setServerParams(e._serverParamsCache.signature,e._serverParamsCache.url)}).catch(function(t){var r,n,i=t||{},o=i.code,a=i.message;e._wait_login_token=!1,o>=700&&o<800?708===o?(r=le.INVALID_PARAMS,n="Invalid userId"):(r=le.INVALID_TOKEN,n="Invalid token",e._wait_login_token=!0,e._loginRejectCallback||e.emit("onRTMTokenError")):(r=le.LOGIN_FAILED,n="login failed"),"function"==typeof e._loginRejectCallback&&e._loginReallback,delete e._loginRejectCallback})}}},{key:"connect",value:function(){var e=this;return new aj(function(t,r){e._connectionManager.once("connected",function(){return t()}),e._connectionManager.once("disconnected",r),e._connectionManager.connect()})}},{key:"_checkDataChannelSignal",value:function(){if(!this._dataChannelSignal||this._dataChannelSignalState!==Ec.CONNECTED)throw new lM(le.NOT_CONNECTED_YET,"datachannel not connect")}},{key:"_addConnectHandler",value:function(){var e=this;this._connectionManager.on("connected",function(t){var r,n;e._dataChannelSignalState=Ec.CONNECTED,Id.info("connectStateChange","connected"),null===(r=e._handler)||void 0===r||r.destroy(),null===(n=e._dataChannelSignal)||void 0===n||n.destroy(),e._handler=yM(e._ctx,t.pc),e._dataChannelSignal=t.signaling,e._addSignalEventHandler(),e.isReconnecting&&e._login()}),this._connectionManager.on("disconnected",function(t){e._dataChannelSignalState=Ec.DISCONNECTED,Id.warn("connectStateChange","disconnected. %o",t),e.isReconnecting&&(e.emit("onUserDisconnection"),e._clearState())}),this._connectionManager.on("connecting",function(){var t;e.isReconnecting=!1,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e._dataChannelSignalState=Ec.CONNECTING,Id.info("connectStateChange","connecting")}),this._connectionManager.on("reconnecting",function(){var t;e.isReconnecting=!0,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e._dataChannelSignalState=Ec.CONNECTING,Id.warn("connectStateChange","reconnecting")})}},{key:"_addSignalEventHandler",value:function(){var e,t,r,n=this;null===(e=this._dataChannelSignal)||void 0===e||e.on(yV.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,function(e){n.emit("onUserMessageReceivedOutsideRoom",{userId:e.from,message:e.msg})}),null===(t=this._dataChannelSignal)||void 0===t||t.on(yV.USEeRoom",{userId:e.from,message:e.msg})}),null===(r=this._dataChannelSignal)||void 0===r||r.on(yV.USER_DISCONNECTION,function(){n.emit("onUserDisconnection"),n._clearState()})}},{key:"_clearState",value:function(){this._userId=null,this._token=null,this._loginSessionId=null,pj.setRtsSessionId(this.id,"")}}]),c}(),Ih=function(){function e(t){iE(this,e),iT(this,"_roomId",void 0),iT(this,"_constraints",{}),iT(this,"_profile",void 0),iT(this,"_customMaxBitrate",0),this._appId=t}return ib(e,[{key:"setRoomId",value:function(e){this._rs._profile=e,this._customMaxBitrate=0}},{key:"customMaxBitrate",get:function(){return this._customMaxBitrate}},{key:"setCustomMaxBitrate",value:function(e){var t=v4.getEngineWebConfig(this._appId,this._roomId||"").audio_encode;this._customMaxBitrate=null!=t&&t.bitrate?0:1e3*e}},{key:"getOpusConfigStr",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=v4.getEngineWebConfig(this._appId,this._roomId||"").audio_encode,n=this.getConstraints(),i=n.sampleRate,o=n.channelCount,a="number"==typeof i?i:null==i?void 0:i.exact,s="number"==typeof o?o:null==o?void 0:o.exact,c={};t.split(";").forEach(function(e){var t=u3(e.split("="),2),r=t[0],n=t[1];r&&n&&(c[r]=n)});var u=(null==r?void 0:r.bitrate)||this._customMaxBitrate||this._getConfigByAudioProfile().bitrate;u&&(c.maxaveragebitrate=u);var d=(null==r?void 0:r.enc_sample_rate)||a;d&&(c["sprop-maxcapturerate"]=d);var l=(null==r?void 0:r.playback_rate)||a;return l&&(c.maxplaybackrate=l),(s&&s>1||null!=r&&r.stereo)&&(c["sprop-stereo"]=1,c.stereo=1),null!=r&&n a4(t="".concat(e,"=")).call(t,c[e])}).joinraints=dr(dr({},this._constraints),e)}},{key:"getConstraints",value:function(){var e=dr({},this._constraints),t=v4.getEngineWebConfig(this._appId,this._roomId||"").audio_capture;vh(null==t?void 0:t.sample_rate)||(e.sampleRate=t.sample_rate),vh(null==t?void 0:t.channel)||(e.channelCount=t.channel),vh(null==t?void 0:t.agc)||(e.autoGainControl=t.agc),vh(null==t?void 0:t.ans)||(e.noiseSuppression=t.ans),vh(null==t?void 0:t.aec)||(e.echoCancellation=t.aec);var r=this._getConfigByAudioProfile(),n=r.sampleRate,i=r.channel;return vh(e.sampleRate)&&!vh(n)&&(e.sampleRate=n),vh(e.channelCount)&&!vh(i)&&(e.channelCount=i),e}},{key:"_getConfigByAudioProfile",value:function(){var e={};switch(this._profile){case lI.fluent:e.sampleRate=16e3,e.bitrate=24e3;break;case lI.standard:e.sampleRate=48e3,e.bitrate=48e3;break;case lI.hd:e.sampleRate=48e3,e.bitrate=128e3,e.channel=2;break;case lI.standardStereo:e.sampleRate=48e3,e.bitrate=8e4,e.channel=2;break;case lI.hdMono:e.sampleRate=48e3,e.bitrate=128e3}return e}}]),e}(),I_=function(e){dy(o,fR);var t,r,n,i=dC(o);function o(e,t,r){var n,a=r.businessId;return iE(this,o),iT(dn(n=i.call(this)),"_mediaServerClient",void 0),iT(dn(n),"_appId",void 0),iT(dn(n),"remoteStreams",void 0),iT(dn(n),"_businessId",void 0),iT(dn(n),"_ctx",void 0),n.id=e,n._appId=t,n.remoteStreams=new sF,n._businessId=a,n._ctx={id:n.id,appId:n._appId,avSync:!0,audioProfileManager:new Ih(n._appId),useCloudProxy:!1,userPriority:new sF,joinRoomConfig:new v8(n.id)},n}return ib(o,[{key:"connect",value:(n=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._mediaServerClient=new Ed(this._ctx),this._businessId&&(this._mediaServerClient.businessId=this._businessId),this._bindEvents(),e.next=5,this._mediaServerClient.connect();case 5:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"startPlayPublicStream",value:(r=a2(a0().mark(function e(t){var r,n=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.remoteStreams.get(t)){e.next=2;break}throw new lM(le.REPEAT_PLAY,"repeat play public media stream");case 2:return(r=new yT(this._ctx,t,t,!1,!0,{audiostream:!0,localaudio:!0,videostream:!0,localvideo:!0,extaudio:!1,extvideo:!1,videoDescriptions:[]})).on("onSEIMessage",function(e){if(e instanceof Uint8Array)for(var t=function(e){var t=new DataView(e.buffer);if(t.byteLength<=4||65535!==t.getUint16(0))return{seiCount:1,seis:[e]};for(var r={seiCount:0,seis:[]},n=!1,i=2;i<t.byteLength;){var o=t.getUint16(i);if(i+=2,t.byteLength-i<o){n=!0;break}var a=new Uint8Array(e.buffer,i,o);if(i+=o,t.byteLength-i>0&&t.byteLength-i<=2){n=!0;break}r.seiCount++,r.seis.push(a)}return n&&(r.seiCount=1,r.seis=[e]),r}(e),i=0;i<t.seiCount;i++)n.emit(yX.ON_SEI_MESSAGED_RECEIVED,{sei:t.seis[i],publicStreamId:r.streamId})}),e.next=6,this._mediaServerClient.subscribePublicStream(r);case 6:return this.remoteStreams.set(t,r),e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"stopPlayPublicStream",value:function(e){var t=this.remoteStreams.get(e);if(t)return this.remoteStreams.delete(e),this._mediaServerClient.unsubscribePublicStream(t)}},{key:"destroy",value:function(){var e;this.remoteStreams.forEach(function(e){e.clean()}),this.remoteStreams=new sF,null===(e=this._mediaServerClient)||void 0===e||e.destroy(),this.removeAllListeners()}},{key:"_handleReconnected",value:(t=a2(a0().mark(function e(){var t,r,n,i=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=u2(this.remoteStreams);try{for(n=function(){var e=u3(r.value,1)[0];i.remoteStreams.delete(e),i.startPlayPublicStream(e).then(function(){var t=i.remoteStreams.get(e);i.safeEmit(yX.RESUBSCRIBE,{stream:t})})},t.s();!(r=t.n()).done;)n()}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_bindEvents",value:function(){var e,t,r=this;null===(e=this._mediaServerC){e.reconnect&&r._handleReconnected()}),null===(t=this._mediaServerClient)||void 0===t||t.on("onRemoteStreamStats",function(e){r.emit("onRemoteStreamStats",e)})}}]),o}(),Ip=new h1("AudioDeviceManager",1),Iv=function(e){dy(c,fT.exports.EventEmitter);var t,r,n,i,o,a,s=dC(c);function c(e){var t;return iE(this,c),iT(dn(t=s.call(this)),"_audioLevelFetcher",void 0),iT(dn(t),"_playbackDeviceTestTimer",void 0),iT(dn(t),"_audioElement",void 0),iT(dn(t),"_audioTrack",void 0),iT(dn(t),"_mediaRecorder",void 0),iT(dn(t),"_recoderTimer",void 0),iT(dn(t),"_isAudioPlaybackDeviceTesting",!1),iT(dn(t),"_isAudioDeviceRecordTesting",!1),iT(dn(t),"_audioCaptureAndRecoderResolve",void 0),iT(dn(t),"_onAutoplayFailed",void 0),iT(dn(t),"_audioPlaybackDeviceId",void 0),t._extensionManager=e,t}return ib(c,[{key:"audioTrack",get:function(){return this._audioTrack}},{key:"startAudioPlaybackDeviceTest",value:(a=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAudioPlaybackDeviceTesting&&!this._isAudioDeviceRecordTesting){e.next=2;break}throw new lM(le.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 2:return this._isAudioPlaybackDeviceTesting=!0,Ip.info("startAudioPlaybackDeviceTest()","Invoke"),e.prev=4,e.next=7,this._playAudioFile(t,{loop:!0});case 7:e.next=14;break;case 9:throw e.prev=9,e.t0=e.catch(4),Ip.error("startAudioPlaybackDeviceTest()","error",e.t0),this.stopAudioPlaybackDeviceTest(),e.t0;case 14:this._startEmitAudioPlaybackDeviceTestVolume(r);case 15:case"end":return e.stop()}},e,this,[[4,9]])})),function(e,t){return a.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){this._isAudioPlaybackDeviceTesting&&(Ip.info("stopAudioPlaybackDeviceTest()","Invoke"),this._isAudioPlaybackDeviceTesting=!1,this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement())}},{key:"startAudioDeviceRecordTest",value:(o=a2(a0().mark(function e(t,r,n){var i,o=this,a=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.length>3&&void 0!==a[3]?a[3]:3e4,window.MediaRecorder){e.next=3;break}throw new lM(le.NOT_SUPPORTED,"Your browser does not support MediaRecorder.");case 3:if(!this._isAudioDeviceRecordTesting&&!this._isAudioPlaybackDeviceTesting){e.next=5;break}throw new lM(le.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 5:return this._isAudioDeviceRecordTesting=!0,Ip.info("startAudioDeviceRecordTest()","Invoke"),this._recoderTimer=window.setTimeout(function(){Ip.info("startAudioDeviceRecordTest()","".concat(i,'ms automatic call method "stopAudioDeviceRecordAndPlayTest"')),o._stopAudioCaptureAndRecoder()},i),e.prev=8,this._onAutoplayFailed=r,e.next=12,this._startAudioCaptureAndRecoder(t,null!=n?n:100);case 12:e.next=19;break;case 14:throw e.prev=14,e.t0=e.catch(8),this._isAudioDeviceRecordTesting=!1,delete this._onAutoplayFailed,e.t0;case 19:delete this._audioCaptureAndRecoderResolve;case 20:case"end":return e.stop()}},e,this,[[8,14]])})),function(e,t,r){return o.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){Ip.info("stopAudioDeviceRecordAndPlayTest()","Invoke"),void 0!==this._recoderTimer&&(clearTimeout(this._recoderTimer),delete this._recoderTimer),this._stopAudioCaptureAndRecoder()}},{key:"stopAudioDevicePlayTest",value:function(){this._isAudioDeviceRecordTesting&&(Ip.info("stopAudioDevicePlayTest()","Invoke"),this._isAudioDeviceRecordTesting=!1,this.stopAudioDeviceRecordAndPlayTest(),this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement()),delete this._onAutoplayFailed}},{key:"getRecordTrack",value:function(){return this._audioTrack}},{key:"setSinkId",value:(i=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Ip.info("setSinkId()","Invoke"),void 0!==HTMLAudioElement.prototype.setSinkId){e.next=3;break}throw new lM(le.NOT_SUPPORTED,"setSinkId not supported by current browser");case 3:return e.next=5,gr.getDeviceById(t);case 5:if(r=e.sent){e.next=8;break}throw new lM(le.INVALID_DEVICE_ID,"audio playback device id ".concat(t," is invalid"));case 8:return this._audioPlaybackDeviceId=t,this._setAudioCtxSinkId(),e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"getSinkId",value:function(){return this._audioPlaybackDeviceId}},{key:"destroy",value:function(){Ip.info("destroy()","Invoke"),dm(df(c.prototype),"removeAllListeners",this).call(this),this.stopAudioPlaybackDeviceTest(),this.stopAudioDevicePlayTest()}},{key:"_playAudioFile",value:(n=a2(a0().mark(function e(t,r){var n,i=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Ip.info("_playAudioFile()",a4(n="Invoke url=".concat(t,"; loop=")).call(n,r.loop)),e.abrupt("return",new aj(function(e,n){var o=EJ("audio",{attributes:{src:t,crossOrigin:"anonymous"}});i._audioElement=o,o.loop=r.loop,i._audioLevelFetcher=new gc(o),o.onplaying=function(){o.onplaying=null,Ip.info("_playAudioFile()","onplaying"),e()},o.onerror=function(){var e=a2(a0().mark(function e(t){var r,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Ip.error("_playAudioFile()","onerror",t),i=t.message||(null==o||null===(r=o.error)||void 0===r?void 0:r.message),n(new lM(le.LOAD_RESOURCES_FAILED,"Failed to play recorded audio".concat(i?", reason: ".concat(i):".")));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),i._setAudioCtxSinkId().then(function(){var e,t;return null===(e=o.play())||void 0===e||null===(t=e.catch)||void 0===t?void 0:t.call(e,function(e){Ip.warn("_playAudioFile()","autoplay error",e);var t,r=a4(t="Failed to play recorded audio, ".concat(e.name,": ")).call(t,e.message);"NotAllowedError"===e.name&&i._onAutoplayFailed?i._onAutoplayFailed(function(){var e;return aj.all([null===(e=i._audioLevelFetcher)||void 0===e?void 0:e.resume(),o.play()])}):n(new lM(le.LOAD_RESOURCES_FAILED,r))})})}));case 2:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)})},{key:"_destroyAudioElement",value:function(){this._audioElement&&(Ip.info("_destroyAudioElement()","Invoke"),this._audioElement.onplaying=null,this._audioElement.onerror=null,this._audioElement.src="",delete this._audioElement,"function"==typeof this._audioCaptureAndRecoderResolve&&this._audioCaptureAndRecoderResolve())}},{key:"_startEmitAudioPlaybackDeviceTestVolume",value:function(e){var t=this;e=Math.max(e,100),this._audioElement&&(Ip.info("_startEmitAudioPlaybackDeviceTestVolume()","start timer(".concat(e,"ms)")),this._playbackDeviceTestTimer=self.setInterval(function(){t._audioLevelFetcher&&t.emit("onAudioPlaybackDeviceTestVolume",t._audioLevelFetcher.getAudioLevel())},e))}},{key:"_stopEmitAudioPlaybackDeviceTestVolume",value:function(){var e;void 0!==this._playbackDeviceTestTimer&&(Ip.info("_stopEmitAudioPlaybackDeviceTestVolume()","stop timer"),self.clearInterval(this._playbackDeviceTestTimer),delete this._playbackDeviceTestTimer),null===(e=this._audioLevelFetcher)||void 0===e||e.destroy(),delete this._audioLevelFetcher}},{key:"_startAudioCaptureAndRecoder",value:(r=a2(a0().mark(function e(t,r){var n,i=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gD({},this._extensionManager);case 2:return this._audioTrack=e.sent,this._audioTrack.setVolume(r),n=new MediaStream([this._audioTrack.getTrack("preprocessing")]),Ip.info("startAudioDeviceRecordTest()","create microphone track success!"),e.abrupt("return",new aj(function(e,r){"function"==typeof MediaRecorder.isTypeSupported&&(o=cS(a=["audio/webm","audio/mp4"]).call(a,function(e){return MediaRecorder.isTypeSupported(e)}),Ip.info("startAudioDeviceRecordTest()","use mimeType: ".concat(o))),i._mediaRecorder=new MediaRecorder(n,o?{mimeType:o}:void 0);var o,a,s=i._mediaRecorder.mimeType;i._mediaRecorder.ondataavailable=function(){var n=a2(a0().mark(function n(o){var a,c;return a0().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!i._isAudioDeviceRecordTesting){n.next=16;break}return Ip.info("startAudioDeviceRecordTest()","get recorded file(mimeType: ".concat(s,").")),c=new Blob([o.data],{type:s}),n.prev=3,n.next=6,i._playAudioFile(Io.createObjectURL(c),{loop:!1});case 6:n.next=11;break;case 8:return n.prev=8,n.t0=n.catch(3),n.abrupt("return",r(n.t0));case 11:i._startEmitAudioPlaybackDeviceTestVolume(t),null===(a=i._audioElement)||ion(){i.stopAudioDevicePlayTest(),e()}),i._audioCaptureAndRecoderResolve=e,n.next=17;break;case 16:e();case 17:case"end":return n.stop()}},n,null,[[3,8]])}));return function(e){return n.apply(this,aED,e.message||"mediaRecorder error"))},i._audioCaptureAndRecoderResolve=e,i._mediaRecorder.start()}));case 7:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"_stopAudioCaptureAndRecoder",value:function(){var e;this._mediaRecorder&&("recording"===this._mediaRecorder.state&&this._mediaRecorder.stop(),delete this._mediaRecorder),null===(e=this._audioTrack)||void 0===e||e.close(),delete this._audioTrack}},{key:"_setAudioCtxSinkId",value:(t=a2(a0().mark(function e(){var t,r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._audioPlaybackDeviceId){"default"===t&&(t="");try{null===(r=gu.getAudioContextInstance())||void 0===r||null===(n=r.setSinkId)||void 0===n||n.call(r,t),Ip.info("setSinkId","ctx.sinkId=".concat(t))}catch(e){Ip.error("setSinkId",a4(i="failed, ".concat(e.name," - ")).call(i,e.message))}}case 2:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),c}(),If=new h1("VideoSnapshot",1),Im=function(e){var t=null==e?void 0:e.domElement;if(t&&!t.paused&&4===t.readyState)return t},Ig=(IR=a2(a0().mark(function e(t,r,n){var i,o,a,s,c,u,d,l;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(i=document.createElement("canvas")).getContext("2d")){e.next=4;break}throw Error("canvas.getContext error");case 4:if(a=function(e,t,n){return t=t||e.width,n=n||e.height,i.width=t,i.height=n,r?o.setTransform(-1,0,0,1,t,0):o.setTransform(1,0,0,1,0,0),o.drawImage(e,0,0,t,n),o.getImageData(0,0,t,n)},s=Date.now(),!(c=Im(n))){e.next=16;break}return If.info("takeSnapshot","VideoPlayer already set."),e.next=11,a(c,c.videoWidth,c.videoHeight);case 11:return u=e.sent,If.info("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),e.abrupt("return",u);case 16:if(!window.ImageCapture||"live"!==(d=new window.ImageCapture(t)).track.readyState||!d.track.enabled||d.track.muted){e.next=29;break}return If.info("takeSnapshot","use ImageCapture"),e.t0=a,e.next=23,d.grabFrame();case 23:return e.t1=e.sent,e.next=26,(0,e.t0)(e.t1);case 26:return l=e.sent,If.info("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),e.abrupt("return",l);case 29:return If.info("takeSnapshot","use temp video"),e.abrupt("return",new aj(function(e,r){var n=new MediaStream([t]),i=document.createElement("video");i.setAttribute("playsinline",""),i.muted=!0,document.body.appendChild(i),i.onplaying=function(){var r=a(i,i.videoWidth,i.videoHeight);If.info("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),e(r),n.removeTrack(t),i.srcObject=null,i.load()},i.onerror=r,i.srcObject=n,i.play()}));case 31:case"end":return e.stop()}},e)})),function(e,t,r){return IR.apply(this,arguments)}),Iy=function(){return{url:"",video:{codec:lC.H264,width:640,height:360,fps:15,gop:2,kBitRate:IS(640,360,15)},audio:{codec:"AAC",kBitRate:64,sampleRate:48e3,channels:2,AACProfile:lA.LC},layout:{regions:[],appData:"",backgroundColor:"#000000"}}};function IS(e,t,r){return e*t<=288e3?r<=15?800:1200:e*t<=864e3?r<=15?1200:1800:e*t<=1152e3?r<=15?1600:2400:e*t<=2592e3?r<=15?2500:3750:r<=15?3300:5e3}function Ib(e){if("string"!=typeof e||!/^rtmps?:\/\//.test(e))throw new lM(le.INVALID_PARAMS,"Invalid rtmp address")}function IE(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(null==e||!e.length)throw new lM(le.INVALID_PARAMS,"regions should not be empty.");var t,r=u2(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if("string"!=typeof n.userId)throw new lM(le.INVALID_PARAMS,"region.userId(".concat(n.userId,") should be a string."));if("boolean"!=typeof n.isScreenStream)throw new lM(le.INVALID_PARAMS,"region.isScreenStream(".concat(n.isScreenStream,") should be a boolean."))}}catch(e){r.e(e)}finally{r.f()}}function IT(e,t){var r,n,i,o=function(e,r){var n=s2(e).call(e,function(e,t){return ction(e,t){return null==e?void 0:e[t]},Iy());return n&&r(n)?n:i},a=function(e){return e%2==0?e:e+1},s=a(o(["video","width"],function(e){return e>=2&&e<=1920})),c=a(o(["video","height"],function(e){return e>=2&&e<=1920})),u=o(["video","fps"],function(e){return e>=1&&e<=60}),d=(null===(r=t.video)||void 0===r?void 0:r.kBitRate)||0,l=o(["audio","sampleRate"],function(e){var t;return!!cS(t=[32e3,44100,48e3]).call(t,function(t){return t===e||t/1e3===e})});return{type:"transcode",action:e,transcodeMeta:{transcode:{url:t.url},control:{protocol:","codec"],function(e){return"AAC"===e}),bitRate:1e3*o(["audio","kBitRate"],function(e){return e>=32&&e<=192}),sampleRate:l<100?1e3*l:l,channels:o(["audio","channels"],function(e){var t;return c1(t=[1,2]).call(t,e)}),profile:o(["audio","AACProfile"],function(e){var t;return c1(t=[lA.LC,lA.HEv1,lA.HEv2]).call(t,e)})},video:{codec:o(["video","codec"],function(e){var t;return c1(t=["H264","H265"]).c,"gop"],function(e){return e>=1&&e<=5})*u,bitRate:1e3*(d>=16&&d<=1e4?d:IS(s,c,u)),width:s,height:c},layout:{canva9a-fA-F]{6}|[0-9a-fA-F]{3})$/.test(e)})},regions:(null===(n=t.layout)||void 0===n||null===(i=n.regions)||void 0===i?void 0:se(i).call(i,function(e){var t,r;return{alpha:!e.alpha||Number(e.alpha)>1||0>=Number(e.alpha)?1:Number(e.alpha),uid:e.userId,zorder:!e.zorder||0>Number(e.zorder)||Number(e.zorder)>100?0:Number(e.zorder),x:!e.x||Number(e.x)>=1||0>Number(e.x)?0:Number(e.x),y:!e.y||Number(e.y)>=1||0>Number(e.y)?0:Number(e.y),w:!e.w||Number(e.w)>1||0>=Number(e.w)?1:Number(e.w),h:!e.h||Number(e.h)>1||0>=Number(e.h)?1:Number(e.h),renderMode:e.renderMode&&c1(t=[1,2,3]).call(t,e.renderMode)?e.renderMode:1,contentControl:e.contentControl&&c1(r=[0,1,2]).call(r,e.contentControl)?e.contentControl:0,screen:!!e.isScreenStream}}))||[],app_data:o(["layout","appData"],function(e){return"string"==typeof e})}}}}var Ik,II,IR,IA,IC={getDefaultValue:Iy,checkStartParams:function(e){var t;Ib(e.url),IE(null===(t=e.layout)||void 0===t?void 0:t.regions)},checckUpdateParams:function(e){var t;e.url&&Ib(e.url),IE(null===(t=e.layout)||void 0===t?void 0:t.regions)},getStartParams:function(e){rction(e){return IT("layoutChanged",e)}},Iw=function(e){IA&&clearTimeout(IA),IA=setTimeout(function(){var t,r=u2(e);try{for(r.s();!(t=r.n()).done;){var n=u3(t.value,2),i=n[0],o=n[1];null!=i&&d9(i).call(i,"mux")&&o.pause()}}catch(e){r.e(e)}finally{r.f()}var a,s=u2(e);try{for(s.s();!(a=s.n()).done;){var c=u3(a.value,2),u=c[0],d=c[1];null!=u&&d9(u).call(u,"mux")&&d.manuallyPlay()}}catch(e){s.e(e)}finally{s.f()}},2e3)},Ix=function(e,t,r,n){for(var i,o=n>1?void 0:n?cq(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&to(t,r,o),o},IO=new h1("Engine",0),IN=function(e){dy(eT,fR);var t,r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,N,P,D,M,L,U,V,F,B,j,G,H,z,K,X,W,q,Y,J,Q,Z,$,ee,et,er,en,ei,eo,ea,es,ec,eu,ed,el,eh,e_,ep,ev,ef,em,eg,ey,eS,eb,eE=dC(eT);function eT(e,t,r){var n,i;return iE(this,eT),iT(dn(n=eE.call(this)),"monitor",void 0),iT(dn(n),"_room",void 0),iT(dn(n),"_publicStreamManager",void 0),iT(dn(n),"_appId",void 0),iT(dn(n),"_businessId",void 0),iT(dn(n),"_visibility",!0),iT(dn(n),"_localVideoTrack",void 0),iT(dn(n),"_localAudioTrack",void 0),iT(dn(n),"_localImgVideoTrack",void 0),iT(dn(n),"_localImgScreenTrack",void 0),iT(dn(n),"_localScreenVideoTrack",void 0),iT(dn(n),"_localScreenAudioTrack",void 0),iT(dn(n),"_tempMixingAudioTrack",void 0),iT(dn(n),"_localAudioVolume",100),iT(dn(n),"_localScreenAudioVolume",100),iT(dn(n),"_remoteAudioVolume",new sF),iT(dn(n),"_remoteScreenAudioVolume",new sF),iT(dn(n),"_publicAudioVolume",new sF),iT(dn(n),"_videoPlayer",void 0),iT(dn(n),"_screenPlayer",void 0),iT(dn(n),"_remoteVideoPlayer",new sF),iT(dn(n),"_remoteScreenPlayer",new sF),iT(dn(n),"_remoteAudioPlayer",new sF),iT(dn(n),"_remoteScreenAudioPlayer",new sF),iT(dn(n),"_publicStreamAudioPlayer",new sF),iT(dn(n),"_publicStreamVideoPlayer",new sF),iT(dn(n),"_publicStreamIds",new sF),iT(dn(n),"_roomConfig",void 0),iT(dn(n),"_videoStreamConstraints",fo),iT(dn(n),"_audioStreamConstraints",{}),iT(dn(n),"_enableSimulcast",!1),iT(dn(n),"_videoStreamEncodeConfig",[fo]),iT(dn(n),"_screenStreamEncodeConfig",[fa]),iT(dn(n),"_dummyMainImage",void 0),iT(dn(n),"_dummyScreenImage",void 0),iT(dn(n),"_trackSourceType",void 0),iT(dn(n),"_liveTranscodeConfig",void 0),iT(dn(n),"_startCloudProxyTimestamp",void 0),iT(dn(n),"_localVideoDeviceId",void 0),iT(dn(n),"_localAudioDeviceId",void 0),iT(dn(n),"_pauseAllSubscribeState",{audio:void 0,video:void 0,resumeStreamIds:{}}),iT(dn(n),"_audioVolumeIndicationTimer",void 0),iT(dn(n),"_dummyMainTimer",void 0),iT(dn(n),"_dummyScreenTimer",void 0),iT(dn(n),"_audioPropertiesReportTimer",null),iT(dn(n),"_mirrorType",lv.MIRROR_TYPE_RENDER),iT(dn(n),"_audioMixingManager",void 0),iT(dn(n),"_pubLock",void 0),iT(dn(n),"_rtmClient",void 0),iT(dn(n),"_messageStatisticsObserver",void 0),iT(dn(n),"_tempRoomInfo",void 0),iT(dn(n),"_originIceConfigRequestUrls",void 0),iT(dn(n),"_originConfigServerUrls",void 0),iT(dn(n),"_originLogServerUrl",void 0),iT(dn(n),"_extensionManager",void 0),iT(dn(n),"_audioDeviceManager",void 0),iT(dn(n),"_remoteVideoConfig",new sF),iT(dn(n),"_cameraCapturing",!1),iT(dn(n),"_interruptCameraCapture",!1),iT(dn(n),"_micCapturing",!1),iT(dn(n),"_interruptMicCapture",!1),iT(dn(n),"_config",void 0),iT(dn(n),"_needClosePreTrack",!1),iT(dn(n),"_ctx",void 0),iT(dn(n),"_updateMixAudioTrack",(i=a2(a0().mark(function e(t){var r,i,o=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>1&&void 0!==o[1]?o[1]:f4.PLAYOUT_AND_PUBLISH,IO.info("_updateMixAudioTrack()"),n._localAudioTrack){e.next=5;break}return t&&(n._tempMixingAudioTrack={track:t,type:i}),e.abrupt("return");case 5:if(t?(n._localAudioTrack.mixType=i,n._localAudioTrack.mixedAudioTrack=t):(delete n._localAudioTrack.mixType,delete n._localAudioTrack.mixedAudioTrack),null===(r=n._room)||void 0===r||!r.hasPublished){e.next=9;break}return e.next=9,n._updatePublish();case 9:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})),iT(dn(n),"_onAudioMixingMessage",function(e){n.safeEmit(vI.onAudioMixingStateChanged,e)}),iT(dn(n),"_onAudioMixingAutoplayFailed",function(e){n.safeEmit(vI.onAutoplayFailed,e)}),n.id=t,n._appId=e,n._pubLock=new yK("pubLock"),n._addDeviceEventHandler(),n._extensionManager=new gl(t),n._audioDeviceManager=new Iv(n._extensionManager),n._audioMixingManager=new Ic({getLocalAudioTrack:function(){return n._localAudioTrack},updateLocalAudioTrack:n._updateMixAudioTrack,emitMessage:n._onAudioMixingMessage,onAutoPlayFailed:n._onAudioMixingAutoplayFailed},t),n._ctx={id:t,appId:e,avSync:!0,streamRTT:{},useCloudProxy:!1,audioProfileManager:new Ih(e),userPriority:new sF,expectedIDC:null==r?void 0:r.expectedIDC,joinRoomConfig:new v8(t)},window.__rtc_engine__=dn(n),window["__rtc_engine__".concat(Math.floor(100*Math.random()+1))]=dn(n),n._trackSourceType={video:lr.VIDEO_SOURCE_TYPE_INTERNAL,screenVideo:lr.VIDEO_SOURCE_TYPE_INTERNAL,audio:ln.AUDIO_SOURCE_TYPE_INTERNAL,screenAudio:ln.AUDIO_SOURCE_TYPE_INTERNAL},n._config=r,n._rtmClient=new Il(n._ctx),n._handleRTMClient(n._rtmClient),n._handleAudioDeviceManager(),n._messageStatisticsObserver=new pG(t),n.monitor=pZ(t),pj.createRTSMsgReportor(n.id),n._getServerConfig(),n}return ib(eT,[{key:"appId",get:function(){return this._appId},set:function(e){this._appId=e}},{key:"updateToken",value:(eb=a2(a0().mark(function e(t){var r,n,i,o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("updateToken()","token: %s",t),fu(t,"token"),!this.waitForNewToken||!this._tempRoomInfo){e.next=8;break}return i=(n=this._tempRoomInfo).config,o=n.userInfo,a=n.roomId,delete this._tempRoomInfo,e.next=7,this.joinRoom(t,a,o,i);case 7:return e.abrupt("return",e.sent);case 8:if(this._room){e.next=10;break}throw new lM(le.UPDATE_TOKEN_BEFORE_JOIN,"update token before join room");case 10:return e.next=12,null===(r=this._room)||void 0===r?void 0:r.updateToken(t);case 12:case"end":return e.stop()}},e,this)})),function(e){return eb.apply(this,arguments)})},{key:"setVideoCaptureDevice",value:(eS=a2(a0().mark(function e(t){var r,n,i,o=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("setVideoCaptureDevice()","deviceId: %s",t),fu(t,"deviceId"),this._localVideoDeviceId=t,this._localVideoTrack){e.next=5;break}return e.abrupt("return");case 5:return r=b_({},this._videoStreamConstraints),"user"===t||"environment"===t||"left"===t||"right"===t?(delete r.deviceId,r.facingMode=t):r.deviceId={exact:t},vG&&vO&&vZ>=85&&vZ<=91&&(null===(n=this._videoPlayer)||void 0===n||n.removeTrack()),this._needClosePreTrack=this._needClosePreTrack||vG&&vO,this._needClosePreTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),delete this._localVideoTrack),IO.info("setVideoCaptureDevice()","start createCameraVideoTrack..."),e.next=13,gN(r,this._extensionManager).catch(function(e){if(o._localVideoTrack&&!o._localVideoTrack.dummy)return IO.warn("setVideoCaptureDevice()","createCameraVideoTrack failed, stop pre VideoTrack."),o._removeLocalTrackEvents(o._localVideoTrack),o._localVideoTrack.close(),delete o._localVidn(e){return o._needClosePreTrack=!0,e}).catch(a2(a0().mark(function t(){var r;return a0().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return IO.error("setVideoCaptureDevice()","createCameraVideoTrack failed, rollback."),t.next=3,gN(o._videoStreamConstraints,o._extensionManager);case 3:throw r=t.sent,o._switchTrack(r),e;case 6:case"end":return t.stop()}},t)})));throw e});case 13:return i=e.sent,IO.success("setVideoCaptureDevice()","createCameraVideoTrack success."),this._videoStreamConstraints=r,this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close()),e.next=19,this._switchTrack(i);case 19:case"end":return e.stop()}},e,this)})),function(e){return eS.apply(this,arguments)})},{key:"setAudioCaptureDevice",value:(ey=a2(a0().mark(function e(t){var r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("setAudioCaptureDevice()","deviceId: %s",t),fu(t,"deviceId"),this._localAudioDeviceId=t,this._localAudioTrack){e.next=5;break}return e.abrupt("return");case 5:return this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),this._localAudioTrack.close(),this._removeLocalTrackEvents(this._localAudioTrack),e.prev=8,this._micCapturing=!0,e.next=12,gD(this._ctx.audioProfileManager.getConstraints(),this._extensionManager);case 12:if(i=e.sent,!this._interruptMicCapture){e.next=18;break}return this._interruptMicCapture=!1,i.close(),this._localAudioTrack=void 0,e.abrupt("return");case 18:if(this._initLocalTrackEvents(i),this._localAudioTrack=i,this._localAudioTrack.setVolume(this._localAudioVolume),this._room){e.next=23;break}return e.abrupt("return");case 23:if(null===(r=this._room)||void 0===r||null===(n=r.localStream)||void 0===n||!n.pubAudio){e.next=26;break}return e.next=26,this._updatePublish();case 26:return e.prev=26,this._micCapturing=!1,e.finish(26);case 29:case"end":return e.stop()}},e,this,[[8,,26,29]])})),function(e){return ey.apply(this,arguments)})},{key:"_addDeviceEventHandler",value:function(){gr.on(vI.onVideoDeviceStateChanged,this._onVideoDeviceStateChange.bind(this)),gr.on(vI.onAudioDeviceStateChanged,this._onAudioDeviceStateChange.bind(this))}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,N,P,D,M=this;null===(e=this._room)||void 0===e||e.on(yV.ON_ADD_STREAM,this._onAddStream.bind(this)),null===(t=this._room)||void 0===t||t.on(yV.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null===(r=this._room)||void 0===r||r.on(yV.USER_CONNECTION,this._onUserConnection.bind(this)),null===(n=this._room)||void 0===n||n.on(yX.ON_USER_LEAVE,this._onUserLeave.bind(this)),null===(i=this._room)||void 0===i||i.on(yX.ON_ROOM_ERROR,this._onRoomError.bind(this)),null===(o=this._room)||void 0===o||o.on(yX.ON_NETWORK_QUALITY,this._onNetworkQuality.bind(this)),null===(a=this._room)||void 0===a||a.on(yV.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null===(s=this._room)||void 0===s||s.on(yV.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null===(c=this._room)||void 0===c||c.on(yV.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null===(u=this._room)||void 0===u||u.on(yV.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null===(d=this._room)||void 0===d||d.on(yV.POST_PROCESSING_MESSAGE,function(e){"2.0"===e.protocol?M._onStreamMixingEvent({error:e.error,event:e.eventType,message:e.message}):"publicStreamCallback"===e.type?M._onPushPublicStreamResult(e):"transcodeStatusCallback"===e.type&&M._onLiveTranscodingResult(e)}),null===(l=this._room)||void 0===l||l.on(yB.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),null===(h=this._room)||void 0===h||h.on(yB.ON_VENDOR_CONNECTION_STATE_CHANGE,function(e){return M.safeEmit(vI.onVendorConnectionStateChanged,e)}),null===(_=this._room)||void 0===_||_.on(yX.RESUBSCRIBE,this._onResubscribe.bind(this)),null===(p=this._room)||void 0===p||p.on(yX.SUBSCRIBE_PUSH_TRACK,this._onSubscribePushTrack.bind(this)),null===(v=this._room)||void 0===v||v.on(yX.REMOVE_PUSH_TRACK,this._onRemovePushTrack.bind(this)),null===(f=this._room)||void 0===f||f.on(yX.ON_PUBLISH_RESULT,function(e){var t;null!==(t=M._room)&&void 0!==t&&t._roomConfig.isAutoPublish&&M.safeEmit(vI.onAutoPublishResult,e)}),null===(m=this._room)||void 0===m||m.on(yX.ON_REMOTE_STREAM_STATS,function(e){M.safeEmit(vI.onRemoteStreamStats,e)}),null===(g=this._room)||void 0===g||g.on(yX.ON_LOCAL_STREAM_STATS,function(e){M.safeEmit(vI.onLocalStreamStats,e)}),null===(y=this._room)||void 0===y||y.on(yX.ON_SUBTITLE_STATE_CHANGED,function(e){M.safeEmit(vI.onSubtitleStateChanged,e)}),null===(S=this._room)||void 0===S||S.on(yX.ON_SUBTITLE_MESSAGE_RECEIVED,function(e){M.safeEmit(vI.onSubtitleMessageReceived,e)}),null===(b=this._room)||void 0===b||b.on(yX.ON_USER_PUBLISH_STATE_CHANGE,this._onUserPublishStateChange.bind(this)),null===(E=this._room)||void 0===E||E.on(yX.ON_USER_START_AUDIO_CAPTURE,function(e,t){var r=e.userId;M._updateAudioPlayerState(t),M.safeEmit(vI.onUserStartAudioCapture,{userId:r})}),null===(T=this._room)||void 0===T||T.on(yX.ON_USER_STOP_AUDIO_CAPTURE,function(e){var t=e.userId;M.safeEmit(vI.onUserStopAudioCapture,{userId:t})}),null===(k=this._room)||void 0===k||k.on(yX.ON_USER_START_VIDEO_CAPTURE,function(e){var t=e.userId;M.safeEmit(vI.onUserStartVideoCapture,{userId:t})}),null===(I=this._room)||void 0===I||I.on(yX.ON_USER_STOP_VIDEO_CAPTURE,function(e){var t=e.userId;M.safeEmit(vI.onUserStopVideoCapture,{userId:t})}),null===(R=this._room)||void 0===R||R.on(yX.ON_SEI_MESSAGED_RECEIVED,function(e){M.safeEmit(vI.onSEIMessageReceived,e)}),null===(A=this._room)||void 0===AEmit(vI.onRemoteVideoSizeChanged,e,t)}),null===(C=this._room)||void 0===C||C.on(yX.ON_SIMULCAST_SUBSCRIBE_FALLBACK,function(e){return M.safeEmit(vI.onSimulcastSubscribeFallback,e)}),null===(w=this._room)||void 0===w||w.on(yX.RECONNECT_FAILED,function(){M.safeEmit(vI.onError,{errorCode:le.RECONNECT_FAILED})}),null===(x=this._room)||void 0===x||x.on(yX.ON_VIDEO_STREAM_BANNED,function(e){M.safeEmit(vI.onVideoStreamBanned,{uid:e.uid,banned:e.banned})}),null===(O=this._room)||voidamBanned,{uid:e.uid,banned:e.banned})}),null===(N=this._room)||void 0===N||N.on(yX.ON_FORWARD_STREAM_ERROR,function(e){M.safeEmit(vI.onForwardStreamError,e)}),null===(P=this._room)||void 0===P||P.on(yX.ON_REJOIN_WITH_TCP,function(){M.safeEmit(vI.onRejoinWithTcp)}),null===(D=this._room)||void 0===D||D.on(yX.ON_ICE_CONNECT_WITH_TCP,function(){M.safeEmit(vI.onIceConnectWithTcp)})}},{key:"safeEmit",value:function(e){for(var t,r,n,i,o=arguments.length,a=Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return(null==(r=fn("FORCE_ENABLED_REPORT_CALLBACKS"))||!c1(r).call(r,e))&&c1(t=[vI.onRemoteStreamStats,vI.onLocalStreamStats,vI.onAudioVolumeIndication,vI.onLocalAudioPropertiesReport,vI.onRemoteAudioPropertiesReport]).call(t,e)||p2(this.id,e,a),(n=dm(df(eT.prototype),"safeEmit",this)).call.apply(n,a4(i=[this,e]).call(i,a))}},{key:"_removeHandlerEventHandler",value:function(){var e;null===(e=this._room)||void 0===e||e.removeAllListeners()}},{key:"connect",value:(eg=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._room){e.next=2;break}return e.abrupt("return",!1);case 2:return this._room=new EY({isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:lk.communication},this._ctx),this._addHandlerEventHandler(),e.next=6,this._room.connect(this._appId);case 6:case"end":return e.stop()}},e,this)})),function(){return eg.apply(this,arguments)})},{key:"joinRoom",value:(em=a2(a0().mark(function e(t,r,n,i){var o,a,s,c,u,d;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:var l;if(IO.info("joinRoom()","token: %o roomId: %o, userInfo: %o, roomConfig: %o",t,r,n,i),fv(t)||fu(t,"token"),ff(r),fh(n,"userInfo"),fm(n.userId),fv(n.extraInfo)||fu(n.extraInfo,"userInfo.extraInfo",1,200),fh(l=i=b_({isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:lk.communication},i),"roomConfig"),fs(l.isAutoPublish,"roomConfig.isAutoPublish"),fs(l.isAutoSubscribeAudio,"roomConfig.isAutoSubscribeAudio"),fs(l.isAutoSubscribeVideo,"roomConfig.isAutoSubscribeVideo"),fv(l.roomProfileType)||fd(l.roomProfileType,"roomConfig",[lk.communication,lk.chat,lk.chatRoom,lk.coHost,lk.meeting,lk.classRoom]),(null===(o=this._room)||void 0===o?void 0:o.connectionState)!==Ec.CONNECTED){e.next=8;break}throw new lM(le.REPEAT_JOIN,"Already joined");case 8:return this._room||(this._room=new EY(i,this._ctx),this._addHandlerEventHandler()),this._room.roomConfig=i,a=this._liveTranscodeConfig&&IC.getStartParams(this._liveTranscodeConfig),s=dr(dr({},n),{},{businessId:this._businessId,role:this._visibility?Iu.NORMAL_USER:Iu.SILENT_USER}),e.prev=12,this._ctx.useCloudProxy&&(this._startCloudProxyTimestamp=Date.now()),EB(s),e.next=17,this._room.join(this._appId,r,t,s,a);case 17:return u=e.sent,this._roomConfig=i,this._ctx.audioProfileManager.setRoomId(r),this._tempRoomInfo&&delete this._tempRoomInfo,null!==(c=i)&&void 0!==c&&c.isAutoPublish&&(this._visibility?this._updatePublish({invokeByJoinRoom:!0,mediaType:lh.AUDIO_AND_VIDEO}):this.safeEmit(vI.onAutoPublishResult,{isScreen:!1,state:lc.PUBLISH_FAIL})),pj.setRoomId(this.id,r),pj.setUserId(this.id,n.userId),e.abrupt("return",u);case 27:throw e.prev=27,e.t0=e.catch(12),e.t0.code===le.INVALID_TOKEN&&(this._tempRoomInfo={config:i,roomId:r,userInfo:s}),null===(d=this._room)||void 0===d||d.destroy(),delete this._room,e.t0;case 33:case"end":return e.stop()}},e,this,[[12,27]])})),function(e,t,r,n){return em.apply(this,arguments)})},{key:"leaveRoom",value:(ef=a2(a0().mark(function e(){var t,r,n,i=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],IO.info("leaveRoom()"),!t){e.next=7;break}return e.next=5,null===(r=this._room)||void 0===r?void 0:r.leave(t);case 5:e.next=8;break;case 7:null===(n=this._room)||void 0===n||n.leave(t).catch();case 8:this._removeHandlerEventHandler(),this._ctx.audioProfileManager.setRoomId(),this._liveTranscodeConfig&&this.stopLiveTranscoding(),this._room=void 0,this._remoteAudioPlayer.forEach(function(e){return e.destroy()}),this._remoteAudioPlayer=new sF,this._remoteScreenAudioPlayer.forEach(function(e){return e.destroy()}),this._remoteScreenAudioPlayer=new sF,this._remoteScreenPlayer.forEach(function(e){return e.destroy()}),this._remoteScreenPlayer=new sF,this._remoteVideoPlayer.forEach(function(e){return e.destroy()}),this._remoteVideoPlayer=new sF,this._roomConfig=void 0,this._publicStreamIds=new sF,pj.setRoomId(this.id,""),pj.setUserId(this.id,"");case 24:case"end":return e.stop()}},e,this)})),function(){return ef.apply(this,arguments)})},{key:"destroy",value:function(){var e,t,r;IO.info("destroy()"),this.removeAllListeners(),this._removeHandlerEventHandler(),null===(e=this._room)||void 0===e||e.destroy(),this._room=void 0,null===(t=this._videoPlayer)||void 0===t||t.destroy(),this._videoPlayer=void 0,this._screenPlayer=void 0,this._videoStreamConstraints={},this._videoStreamEncodeConfig=[fo],this._screenStreamEncodeConfig=[fa],this._pauseAllSubscribeState={audio:void 0,video:void 0,resumeStreamIds:{}},this._messageStatisticsObserver.destroy(),this.monitor.destroy(),pj.destroyRTSMsgReportor(this.id),clearInterval(this._audioVolumeIndicationTimer),clearInterval(this._dummyMainTimer),clearInterval(this._dummyScreenTimer),this._audioVolumeIndicationTimer=void 0,this._stopAudioPropertiesReport(),this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close(),this._localAudioTrack=void 0),this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),this._localVideoTrack=void 0),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close(),this._localScreenAudioTrack=void 0),this._localScreenVideoTrack&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close(),this._localScreenVideoTrack=void 0),this._localImgVideoTrack&&(this._localImgVideoTrack.stop(),this._localImgVideoTrack=void 0),this._localImgScreenTrack&&(this._localImgScreenTrack.stop(),this._localImgScreenTrack=void 0),this._remoteAudioPlayer.forEach(function(e){return e.destroy()}),this._remoteAudioPlayer=new sF,this._remoteScreenAudioPlayer.forEach(function(e){return e.destroy()}),this._remoteScreenAudioPlayer=new sF,this._remoteScreenPlayer.forEach(function(e){return e.destroy()}),this._remoteScreenPlayer=new sF,this._remoteVideoPlayer.forEach(function(e){return e.destroy()}),this._remoteVideoPlayer=new sF,this._publicStreamAudioPlayer.forEach(function(e){return e.destroy()}),this._publicStreamAudioPlayer=new sF,this._publicStreamVideoPlayer.forEach(function(e){return e.destroy()}),this._publicStreamVideoPlayer=new sF,this._roomConfig=void 0,this._audioMixingManager.destroy(),this._rtmClient.destroy(),null===(r=this._publicStreamManager)||void 0===r||r.destroy(),this._publicStreamIds=new sF,this._audioDeviceManager.destroy(),this._remoteVideoConfig=new sF,this._ctx.userPriority.clear(),this._extensionManager.destroy(),this._cameraCapturing=!1,this._micCapturing=!1,this._interruptCameraCapture=!1,this._interruptMicCapture=!1,this._ctx.avSync=!0,this._localAudioVolume=100,this._localScreenAudioVolume=100,this._remoteAudioVolume.clear(),this._remoteScreenAudioVolume.clear(),this._publicAudioVolume.clear()}},{key:"publishStream",value:(ev=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("publishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!vu(t)||this._localVideoTrack||!this._localImgVideoTrack){e.next=7;break}return e.next=6,function(e,t){return gx.apply(this,arguments)}(this._localImgVideoTrack,this._extensionManager);case 6:this._localVideoTrack=e.sent;case 7:return e.next=9,this._updatePublish({mediaType:t});case 9:case"end":return e.stop()}},e,this)})),function(e){return ev.apply(this,arguments)})},{key:"unpublishStream",value:(ep=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("unpublishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!r){e.next=5;break}return e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.unpublish());case 5:return e.next=7,this._updatePublish({mediaType:t,pubState:yq.UNPUB});case 7:case"end":return e.stop()}},e,this)})),function(e,t){return ep.apply(this,arguments)})},{key:"publishScreen",value:(e_=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("publishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.prev=3,!vu(t)||this._localScreenVideoTrack||!this._localImgScreenTrack){e.next=8;break}return e.next=7,function(e,t){return gO.apply(this,arguments)}(this._localImgScreenTrack,this._extensionManager);case 7:this._localScreenVideoTrack=e.sent;case 8:return e.next=10,this._updateScreenPublish({mediaType:t,pubState:yq.PUB});case 10:e.next=19;break;case 12:if(e.prev=12,e.t0=e.catch(3),!(e.t0 instanceof lM)){e.next=18;break}throw e.t0;case 18:throw new lM(le.UNEXPECTED_ERROR,"unexpected error",e.t0);case 19:case"end":return e.stop()}},e,this,[[3,12]])})),function(e){return e_.apply(this,arguments)})},{key:"unpublishScreen",value:(eh=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("unpublishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.next=5,this._updateScreenPublish({mediaType:t,pubState:yq.UNPUB});case 5:case"end":return e.stop()}},e,this)})),function(e){return eh.apply(this,arguments)})},{key:"subscribeStream",value:(el=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("subscribeStream()","userId: %o, mediaType: %o",t,r),e.abrupt("return",this._subscribe(!1,t,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return el.apply(this,arguments)})},{key:"_subscribe",value:(ed=a2(a0().mark(function e(t,r,n){var i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._checkMediaType(n),this._assertNotInRoom(),n!==lh.AUDIO||null===(i=this._room)||void 0===i||!i.multiChatMode){e.next=5;break}return IO.warn("subscribeStream()","due to multiChatMode return"),e.abrupt("return");case 5:if(d=null==(u=this._room.remoteStreams.get(r))?void 0:cS(u).call(u,function(e){return e.isScreen===t})){e.next=9;break}throw new lM(le.STREAM_NOT_EXIST,"stream not exist");case 9:return l=this._pauseAllSubscribeState.audio,h=this._pauseAllSubscribeState.video,this._pauseAllSubscribeState.audio&&(n-=n&lh.AUDIO),this._pauseAllSubscribeState.video&&(n-=n&lh.VIDEO),IO.warn("subscribeStream()","due to pauseAll mediaType: %o",n),_=d.hasSubscribed,p=this._remoteVideoConfig.get(r)||(null===(o=this._roomConfig)||void 0===o?void 0:o.remoteVideoConfig),d.originalMediaType=n,e.next=19,this._room.subscribe(d,n,p);case 19:vc(n)&&this._updateAudioPlayerState(d),vu(n)&&this._updateVideoPlayerState(d),v=0,f=0,l!==this._pauseAllSubscribeState.audio&&(this._pauseAllSubscribeState.audio?v|=lh.AUDIO:f|=lh.AUDIO),h!==this._pauseAllSubscribeState.video&&(this._pauseAllSubscribeState.video?v|=lh.VIDEO:f|=lh.VIDEO),v&&this.pauseAllSubscribedStream(v),f&&this.resumeAllSubscribedStream(f),this._pauseAllSubscribeState.resumeStreamIds[d.streamId]=d.streamId,!t&&(null!==(a=this._roomConfig)&&void 0!==a&&a.isAutoSubscribeAudio||null!==(s=this._roomConfig)&&void 0!==s&&s.isAutoSubscribeVideo)&&(d.audioTrack||d.videoTrack)&&(m={userId:r,isScreen:!1,state:ls.SUBSCRIBE_SUCC},this.safeEmit(vI.onAutoSubscribeResult,m)),null!==(c=this._room)&&void 0!==c&&c.multiChatMode||_||!vc(n)||!d.hasAudio||null===(g=d.observer)||void 0===g||g.setSubscribeAudio(!0),!_&&vu(n)&&d.hasVideo&&(null===(y=d.observer)||void 0===y||y.setSubscribeVideo(!0));case 31:case"end":return e.stop()}},e,this)})),function(e,t,r){return ed.apply(this,arguments)})},{key:"unsubscribeStream",value:(eu=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:IO.info("unsubscribeStream()","userId: %o, mediaType: %o",t,r),this._unsubscribe(!1,t,r);case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eu.apply(this,arguments)})},{key:"subscribeScreen",value:(ec=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("subscribeScreen() userId: %o, mediaType: %o",t,r),e.abrupt("return",this._subscribe(!0,t,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return ec.apply(this,arguments)})},{key:"unsubscribeScreen",value:(es=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:IO.info("unsubscribeScreen() userId: %o, mediaType: %o",t,r),this._unsubscribe(!0,t,r);case 2:case"end":return e.stop()}},e,this)})),function(e,t){return es.apply(this,arguments)})},{key:"_unsubscribe",value:function(e,t,r,n){var i,o=this;if(this._checkMediaType(r),this._assertNotInRoom(),r!==lh.AUDIO||null===(i=this._room)||void 0===i||!i.multiChatMode){var a,s=this._room.remoteStreams.get(t),c=null==s?void 0:cS(s).call(s,function(t){return t.isScreen===e});if(null==c||!c.hasSubscribed)throw new lM(le.STREAM_NOT_EXIST,"stream not exist");return vG&&vZ&&vZ>=85&&vZ<=91&&r!==lh.AUDIO&&(null===(a=e?this._remoteScreenPlayer.get(t):this._remoteVideoPlayer.get(t))||void 0===a||a.stop()),this._room.unsubscribe(c,r).then(function(){n||delete o._pauseAllSubscribeState.resumeStreamIds[c.streamId]})}IO.warn("subscribeStream()","due to multiChatMode return")}},{key:"setRemoteVideoConfig",value:(ea=a2(a0().mark(function e(t,r){var n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("setRemoteVideoConfig() userId: %o, remoteVideoConfig: %o",t,r),fm(t),function(e){if("number"!=typeof(null==e?void 0:e.width)||"number"!=typeof(null==e?void 0:e.height))throw new lM(le.INVALID_PARAMS,"remoteVideoConfig must contain width, height, frameRate")}(r),this._remoteVideoConfig.set(t,r),e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.updateSubVideoConfig(t,r).then(function(){}));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return ea.apply(this,arguments)})},{key:"startVideoCapture",value:(eo=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,d,l,h,_=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("startVideoCapture()","deviceId: %s",t),fv(t)||fu(t,"deviceId"),t=t||this._localVideoDeviceId,this._localVideoDeviceId=t,this._trackSourceType.video!==lr.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new lM(le.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 6:if(!(this._cameraCapturing||this._localVideoTrack&&!this._localVideoTrack.dummy)){e.next=8;break}throw new lM(le.REPEAT_CAPTURE,"Has already capture");case 8:return a=this._videoStreamConstraints,t&&("user"===t||"environment"===t||"left"===t||"right"===t?a.facingMode=t:a.deviceId={exact:t},this._videoStreamConstraints=a),s={},e.prev=11,this._cameraCapturing=!0,e.next=15,gN(a,this._extensionManager);case 15:if(u=e.sent,!this._interruptCameraCapture){e.next=22;break}throw this._interruptCameraCapture=!1,this._removeLocalTrackEvents(u),this._localVideoTrack=void 0,u.close(),new lM(le.INTERRUPT,"interrupt by stopVideoCapture");case 22:if(this._initLocalTrackEvents(u),this._localVideoTrack=u,null===(c=this._videoPlayer)||void 0===c||c.playVideo(u),(d=null==u?void 0:u.getTrack())&&(l={width:(s=d.getSettings()).width,height:s.height},this._lamIndex:ll.STREAM_INDEX_MAIN,info:l})})),this._room){e.next=29;break}return e.abrupt("return",s);case 29:return e.prev=29,this._cameraCapturing=!1,e.finish(29);case 32:return h=this._room._roomConfig.isAutoPublish,(null!==(r=this._room)&&void 0!==r&&null!==(n=r.localStream)&&void 0!==n&&n.pubVideo||h)&&(this._visibility?this._updatePublish():this.safeEmit(vI.onAutoPublishResult,{isScreen:!1,state:lc.PUBLISH_FAIL})),null===(i=this._room.localStream)||void 0===i||null===(o=i.observer)||void 0===o||o.setEnableVideo(!0),e.abrupt("return",s);case 36:case"end":return e.stop()}},e,this,[[11,,29,32]])})),function(e){return eo.apply(this,arguments)})},{key:"stopVideoCapture",value:(ei=a2(a0().mark(function e(){var t,r,n,i,o,a,s,c;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("stopVideoCapture()"),!this._cameraCapturing){e.next=5;break}return this._interruptCameraCapture=!0,IO.warn("stopVideoCapture()","capturing"),e.abrupt("return");case 5:if(this._trackSourceType.video!==lr.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=7;break}throw new lM(le.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 7:if(null===(t=this._videoPlayer)||void 0===t||t.stop(),this._localVideoTrack&&(this._localVideoTrack.dummy||((s=this._extensionManager.getPluginByName(gd.PRE_PROCESSING,"RTCBeautyExtension"))&&s.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),this._localImgVideoTrack?(null===(c=this._localVideoTrack)||void 0===c||c.setTrack(this._localImgVideoTrack,this._extensionManager),this._localVideoTrack.dummy=!0):this._localVideoTrack=void 0)),this._room){e.next=11;break}return e.abrupt("return");case 11:if(null===(r=this._room)||void 0===r||null===(n=r.localStream)||void 0===n||!n.pubVideo){e.next=14;break}return e.next=14,this._updatePublish();case 14:null===(i=this._room)||void 0===i||null===(o=i.localStream)||void 0===o||null===(a=o.observer)||void 0===a||a.setEnableVideo(!1);case 15:case"end":return e.stop()}},e,this)})),function(){return ei.apply(this,arguments)})},{key:"startAudioCapture",value:(en=a2(a0().mark(function e(t){var r,n,i,o,a,s,c;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("startAudioCapture()","deviceId: $o",t),fv(t)||fu(t,"deviceId"),t=t||this._localAudioDeviceId,this._localAudioDeviceId=t,this._trackSourceType.audio!==ln.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new lM(le.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 6:if(!this._micCapturing&&!this._localAudioTrack){e.next=8;break}throw new lM(le.REPEAT_CAPTURE,"Has already capture");case 8:return t&&this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),a={},e.prev=10,this._micCapturing=!0,e.next=14,gD(this._ctx.audioProfileManager.getConstraints(),this._extensionManager);case 14:if(s=e.sent,!this._interruptMicCapture){e.next=21;break}throw this._interruptMicCapture=!1,this._removeLocalTrackEvents(s),s.close(),this._localAudioTrack=void 0,new lM(le.INTERRUPT,"interrupt by stopAudioCapture");case 21:if(this._initLocalTrackEvents(s),this._localAudioTrack=s,this._localAudioTrack.setVolume(this._localAudioVolume),this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack),s.getOrgTrack()&&(a=s.getOrgTrack().getSettings()),this._room){e.next=28;break}return e.abrupt("return",a);case 28:return e.prev=28,this._micCapturing=!1,e.finish(28);case 31:return c=this._room._roomConfig.isAutoPublish,(null!==(r=this._room)&&void 0!==r&&null!==(n=r.localStream)&&void 0!==n&&n.pubAudio||c)&&(this._visibility?this._updatePublish():this.safeEmit(vI.onAutoPublishResult,{isScreen:!1,state:lc.PUBLISH_FAIL})),null===(i=this._room.localStream)||void 0===i||null===(o=i.observer)||void 0===o||o.setEnableAudio(!0),e.abrupt("return",a);case 35:case"end":return e.stop()}},e,this,[[10,,28,31]])})),function(e){return en.apply(this,arguments)})},{key:"stopAudioCapture",value:(er=a2(a0().mark(function e(){var t,r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("stopAudioCapture()"),!this._micCapturing){e.next=5;break}return this._interruptMicCapture=!0,IO.warn("stopAudioCapture()","capturing"),e.abrupt("return");case 5:if(this._trackSourceType.audio!==ln.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=7;break}throw new lM(le.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 7:if(this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close()),this._localAudioTrack=void 0,this._audioMixingManager.stopAll(),this._room){e.next=12;break}return e.abrupt("return");case 12:if(null===(t=this._room)||void 0===t||null===(r=t.localStream)||void 0===r||!r.pubAudio){e.next=15;break}return e.next=15,this._updatePublish();case 15:null===(n=this._room.localStream)||void 0===n||null===(i=n.observer)||void 0===i||i.setEnableAudio(!1);case 16:case"end":return e.stop()}},e,this)})),function(){return er.apply(this,arguments)})},{key:"getAudioMixingManager",value:function(){return IO.info("getAudioMixingManager()","invoke"),this._audioMixingManager}},{key:"startScreenCapture",value:(et=a2(a0().mark(function e(){var t,r,n,i,o,a,s,c,u,d,l,h,_,p,v,f=this,m=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=m.length>0&&void 0!==m[0]?m[0]:{},IO.info("startScreenCapture()","config: %o",c),d=void 0!==(u=c.enableAudio)&&u,this._trackSourceType.screenVideo!==lr.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=5;break}throw new lM(le.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 5:if(this._trackSourceType.screenAudio!==ln.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=7;break}throw new lM(le.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 7:return e.next=9,function(){return gL.apply(this,arguments)}(d,this._extensionManager,this._screenStreamEncodeConfig[0]);case 9:if(h=(l=u3(e.sent,2))[0],null==(_=l[1])||_.setVolume(this._localScreenAudioVolume),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close()),null===(t=this._localScreenAudioTrack)||void 0===t||t.close(),delete this._localScreenAudioTrack,this._localScreenVideoTrack=h,null!==(r=this._screenStreamEncodeConfig[0])&&void 0!==r&&r.contentHint&&h.setContentHint(null===(p=this._screenStreamEncodeConfig[0])||void 0===p?void 0:p.contentHint),(v=null==h?void 0:h.getTrack())&&setTimeout(function(){var e=v.getSettings(),t={width:e.width,height:e.height};h.resolution=t,f.safeEmit(vI.onLocalVideoSizeChanged,{streamIndex:ll.STREAM_INDEX_SCREEN,info:{width:e.width,height:e.height}})},500),_&&(this._localScreenAudioTrack=_,this._initLocalTrackEvents(_)),null===(n=this._screenPlayer)||void 0===n||n.playVideo(this._localScreenVideoTrack),this._initLocalTrackEvents(this._localScreenVideoTrack,!0),!(null!==(i=this._room)&&void 0!==i&&null!==(o=i.localScreenStream)&&void 0!==o&&o.pubAudio||null!==(a=this._room)&&void 0!==a&&null!==(s=a.localScreenStream)&&void 0!==s&&s.pubVideo)){e.next=27;break}return e.next=27,this._updateScreenPublish();case 27:case"end":return e.stop()}},e,this)})),function(){return et.apply(this,arguments)})},{key:"stopScreenCapture",value:(ee=a2(a0().mark(function e(){var t,r,n,i,o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("stopScreenCapture()"),null===(t=this._screenPlayer)||void 0===t||t.stop(),this._localScreenVideoTrack&&(this._localScreenVideoTrack.dummy||(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close(),this._localImgScreenTrack&&(null===(a=this._localScreenVideoTrack)||void 0===a||a.setTrack(this._localImgScreenTrack,this._extensionManager),this._localScreenVideoTrack.dummy=!0))),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close()),this._localScreenAudioTrack=void 0,!(null!==(r=this._room)&&void 0!==r&&null!==(n=r.localScreenStream)&&void 0!==n&&n.pubAudio||null!==(i=this._room)&&void 0!==i&&null!==(o=i.localScreenStream)&&void 0!==o&&o.pubVideo)){e.next=8;break}return e.next=8,this._updateScreenPublish();case 8:case"end":return e.stop()}},e,this)})),function(){return ee.apply(this,arguments)})},{key:"setLocalVideoPlayer",value:function(e,t){if(IO.info("setLocalVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),fd(e,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),t&&t.renderDom){var r,n,i,o,a,s,c=dr(dr({userId:this._getUserId()},t),{},{isLocal:!0});if(fy(c),e===ll.STREAM_INDEX_MAIN&&!this._videoPlayer)return this._videoPlayer=new E1(this.id,c),this._initPlayerEvents(this._videoPlayer,!1,e),this._videoPlayer.mirror(!!this._mirrorType),this._localVideoTrack&&!this._localVideoTrack.dummy&&(null===(i=this._config)||void 0===i?void 0:i.autoPlayPolicy)!==lR.PLAY_MANUALLY&&this._videoPlayer.playVideo(this._localVideoTrack),(null===(o=this._room)||void 0===o?void 0:o.localStream)&&(this._room.localStream.videoDom=this._videoPlayer.domElement),this._videoPlayer.domElement;if(e===ll.STREAM_INDEX_SCREEN&&!this._screenPlayer)return this._screenPlayer=new E1(this.id,dr(dr({},c),{},{isScreen:!0,isLocal:!0})),this._initPlayerEvents(this._screenPlayer,!1,e),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(null===(a=this._config)||void 0===a?void 0:a.autoPlayPolicy)!==lR.PLAY_MANUALLY&&this._screenPlayer.playVideo(this._localScreenVideoTrack),(null===(s=this._room)||void 0===s?void 0:s.localScreenStream)&&(this._room.localScreenStream.videoDom=this._screenPlayer.domElement),this._screenPlayer.domElement;if(t&&void 0!==t.renderMode){var u=e===ll.STREAM_INDEX_MAIN?this._videoPlayer:this._screenPlayer;null==u||u.setRenderMode(t.renderMode)}}else e===ll.STREAM_INDEX_MAIN?(null===(r=this._videoPlayer)||void 0===r||r.destroy(!0),delete this._videoPlayer):(null===(n=this._screenPlayer)||void 0===n||n.destroy(),delete this._screenPlayer)}},{key:"startLiveTranscoding",value:($=a2(a0().mark(function e(t){var r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("startLiveTranscoding()","transcode: %o",t),IC.checkStartParams(t),this._liveTranscodeConfig=t,!((n=null===(r=this._room)||void 0===r?void 0:r.roomInfo)&&n.roomId.length+n.userInfo.userId.length>126)){e.next=6;break}throw new lM(le.INVALID_PARAMS,"The roomId+userId must be within 126 bytes");case 6:if(e.prev=6,this.safeEmit(vI.onStreamMixingEvent,{event:yW.START,error:0,message:""}),!this._room||this._room.connectionState!==Ec.CONNECTED){e.next=11;break}return e.next=11,null===(i=this._room)||void 0===i?void 0:i.liveControlMessage(IC.getStartParams(this._liveTranscodeConfig));case 11:e.next=20;break;case 13:if(e.prev=13,e.t0=e.catch(6),!(e.t0 instanceof lM)){e.next=19;break}throw e.t0;case 19:throw new lM(le.UNEXPECTED_ERROR,"unexpected error",e.t0);case 20:case"end":return e.stop()}},e,this,[[6,13]])})),function(e){return $.apply(this,arguments)})},{key:"updateLiveTranscoding",value:(Z=a2(a0().mark(function e(t){var r,n,i,o;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("updateLiveTranscoding()","transcode: %o",t),this._liveTranscodeConfig){e.next=3;break}return e.abrupt("return");case 3:return delete(i=b_({},t)).audio,null===(r=i.video)||void 0===r||delete r.codec,null===(n=i.video)||void 0===n||delete n.gop,IC.checckUpdateParams(i),this._liveTranscodeConfig=b_(this._liveTranscodeConfig,i),e.prev=9,this.safeEmit(vI.onStreamMixingEvent,{event:yW.UPDATE,error:0,message:""}),e.next=13,null===(o=this._room)||void 0===o?void 0:o.liveControlMessage(IC.getUpdateParams(this._liveTranscodeConfig));case 13:e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(9),!(e.t0 instanceof lM)){e.next=21;break}throw e.t0;case 21:throw new lM(le.UNEXPECTED_ERROR,"unexpected error",e.t0);case 22:case"end":return e.stop()}},e,this,[[9,15]])})),function(e){return Z.apply(this,arguments)})},{key:"stopLiveTranscoding",value:(Q=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("stopLiveTranscoding()"),this._liveTranscodeConfig){e.next=3;break}return e.abrupt("return");case 3:return delete this._liveTranscodeConfig,e.prev=4,this.safeEmit(vI.onStreamMixingEvent,{event:yW.STOP,error:0,message:""}),e.next=8,null===(t=this._room)||void 0===t?void 0:t.liveControlMessage({action:"stopped",type:"transcode"});case 8:e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),!(e.t0 instanceof lM)){e.next=16;break}throw e.t0;case 16:throw new lM(le.UNEXPECTED_ERROR,"unexpected error",e.t0);case 17:case"end":return e.stop()}},e,this,[[4,10]])})),function(){return Q.apply(this,arguments)})},{key:"startSubtitle",value:(J=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("startSubtitle()","config: %o",t),this._assertNotInRoom(),e.next=4,null===(r=this._room)||void 0===r?void 0:r.startSubtitle(t);case 4:case"end":return e.stop()}},e,this)})),function(e){return J.apply(this,arguments)})},{key:"stopSubtitle",value:function(){var e;IO.info("stopSubtitle()","invoke"),null===(e=this._room)||void 0===e||e.stopSubtitle()}},{key:"setBusinessId",value:function(e){return IO.info("setBusinessId()","businessId: %s",e),!("string"!=typeof e)&&!this._room&&(this.monitor.set({rtc_business_id:e}),this._businessId=e,!0)}},{key:"setUserVisibility",value:(Y=a2(a0().mark(function e(t){var r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("setUserVisibility()","enable: %o",t),t=!!t,this._visibility!==t){e.next=4;break}return e.abrupt("return");case 4:if(this._room){e.next=7;break}return this._visibility=t,e.abrupt("return");case 7:if(this._assertNotInRoom(),this._room.localStream&&(null===(n=this._room.localStream.observer)||void 0===n||n.setPublisher(t)),e.t0=!t,!e.t0){e.next=13;break}return e.next=13,this._room.unpublish();case 13:return e.next=15,this._room.updateUserAttributes({role:t?Iu.NORMAL_USER:Iu.SILENT_USER});case 15:this._visibility=t,t&&null!==(r=this._roomConfig)&&void 0!==r&&r.isAutoPublish&&this._updatePublish({mediaType:lh.AUDIO_AND_VIDEO});case 17:case"end":return e.stop()}},e,this)})),function(e){return Y.apply(this,arguments)})},{key:"_initPlayerEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ll.STREAM_INDEX_MAIN,i=n===ll.STREAM_INDEX_SCREEN;e.on("playback_event",function(n){switch(n.eventName){case"timeupdate":return;case"loadeddata":if("audio"===n.type){var o,a,s=e.userId.replace("_screen",""),c=null===(o=t._room)||void 0===o||null===(a=o.remoteStreams.get(s))||void 0===a?void 0:cS(a).call(a,function(e){return e.isScreen===i}),u=function(){r?t.safeEmit(vI.onFirstPublicStreamAudioFrameDecoded,{publicStreamId:s}):(t.safeEmit(vI.onAudioFirstFrameDecoded,{userId:s,isScreen:i}),t.safeEmit(vI.onRemoteAudioFirstFrame,{userId:s,isScreen:i})),t.monitor.report("first_remote_audio_render",{stream_id:"",stream_user_id:s||""},{isScreen:i})};c&&c.observer&&!c.observer.audioFirstFrameReceived?c.observer.once("recvAudioFirstFrame",u):u()}else{var d,l,h={userId:e.userId,height:(null===(d=e.domElement)||void 0===d?void 0:d.videoHeight)||0,width:(null===(l=e.domElement)||void 0===l?void 0:l.videoWidth)||0,isScreen:i};r?(h.publicStreamId=h.userId,delete h.userId,delete h.isScreen,t.safeEmit(vI.onFirstPublicStreamVideoFrameRendered,h),t.safeEmit(vI.onFirstPublicStreamVideoFrameDecoded,h)):e.isLocal||(t.safeEmit(vI.onVideoFirstFrameRendered,h),t.safeEmit(vI.onVideoFirstFrameDecoded,h),t.safeEmit(vI.onRemoteVideoFirstFrame,h)),t.monitor.report("first_remote_video_render",{stream_id:"",stream_user_id:n.userId||""},{isScreen:i})}break;case"autoplay-error":return r&&(n.publicStreamId=n.userId),p3(t.id,"autoplay-error",e instanceof E1?"video":"audio",0,n.userId||""),void t.safeEmit(vI.onAutoplayFailed,{userId:n.userId,kind:e instanceof E1?"video":"audio",mediaType:e instanceof E1?lh.VIDEO:lh.AUDIO,streamIndex:e.isScreen?ll.STREAM_INDEX_SCREEN:ll.STREAM_INDEX_MAIN})}t.safeEmit(vI.onPlayerEvent,n)})}},{key:"_initLocalTrackEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];["track-ended","track-mute","track-unmute"].forEach(function(r){var n;e.on(r,(n=a2(a0().mark(function e(n){var i,o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.monitor.report("rtc_error",{message:a4(i="track-".concat(r," mediaType: ")).call(i,n.getTrack().kind),error_code:y$.TRACK_ERROR}),o=!1,n!==t._localScreenAudioTrack&&n!==t._localScreenVideoTrack||(o=!0),a=n.getTrack().kind,t.safeEmit({"track-ended":vI.onTrackEnded,"track-mute":vI.onTrackMute,"track-unmute":vI.onTrackUnmute}[r],{kind:a,isScreen:o}),!vj&&!vU){e.next=13;break}if("track-mute"!==r||(go.emit(gi.ON_IOS_LOCAL_TRACK_MUTE,a),"audio"!==a)){e.next=12;break}return e.next=11,t.stopAudioCapture();case 11:t.startAudioCapture();case 12:"track-unmute"===r&&go.emit(gi.ON_IOS_LOCAL_TRACK_UNMUTE,a);case 13:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)}))}),e.on("resolution-change",function(e){t._extensionManager.getPlConstraints)||void 0===r||r.call(t,e)}),t.safeEmit(vI.onLocalVideoSizeChanged,{streamIndex:r?ll.STREAM_INDEX_SCREEN:ll.STREAM_INDEX_MAIN,info:e})})}moveAllListeners("resolution-change")}},{key:"setRemoteVideoPlayer",value:function(e,t){IO.info("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),fd(e,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),fy(t);var r,n,i,o=t.userId;if(e===ll.STREAM_INDEX_MAIN){if(null===(a=this._remoteVideoPlayer.get(o))||void 0===a||a.destroy(),!t.renderDom)return;var a,s,c,u=new E1(this.id,t);this._initPlayerEvents(u,!1,e),this._remoteVideoPlayer.set(o,u);var d=null===(s=this._room)||void 0===s||null===(c=s.remoteStreams.get(o))||void 0===c?void 0:cS(c).call(c,function(e){return!e.isScreen});return d&&(this._updateVideoPlayerState(d),d.videoDom=u.domElement),u.domElement}if(null===(r=this._remoteScreenPlayer.get(o))||void 0===r||r.destroy(),t.renderDom){var l=new E1(this.id,dr(dr({},t),{},{isScreen:!0}));this._remoteScreenPlayer.set(o,l),this._initPlayerEvents(l,!1,e);var h=null===(n=this._room)||void 0===n||null===(i=n.remoteStreams.get(o))||void 0===i?void 0:cS(i).call(i,function(e){return e.isScreen});return h&&(this._updateVideoPlayerState(h),h.videoDom=l.domElement),l.domElement}}},{key:"setLocalVideoMirrorType",value:function(e){IO.info("setLocalVideoMirrorType()","mirrorType: %o",e),fd(e,"mirrorType",[lv.MIRROR_TYPE_NONE,lv.MIRROR_TYPE_RENDER]),this._mirrorType=e,this._videoPlayer&&this._videoPlayer.mirror(!!e)}},{key:"setAudioPlaybackDevice",value:(q=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("setAudioPlaybackDevice()","deviceId: %s",t),fu(t,"deviceId"),e.next=4,this._audioDeviceManager.setSinkId(t);case 4:r=e.sent,this._remoteAudioPlayer.forEach(function(e){e.setPlaybackDevice(t)}),this._remoteScreenAudioPlayer.forEach(function(e){e.setPlaybackDevice(t)}),this.safeEmit(vI.onAudioPlaybackDeviceChanged,r),this.monitor.report("rtc_audio_device",{audio_event:"playout_device_switch",message:a6(r),error_code:0});case 9:case"end":return e.stop()}},e,this)})),function(e){return q.apply(this,arguments)})},{key:"play",value:(W=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=g.length>1&&void 0!==g[1]?g[1]:lh.AUDIO_AND_VIDEO,a=g.length>2?g[2]:void 0,IO.info("play()","userId: %s, mediaType: %s, streamIndex: %s",t,o,a),s=!t||t===this._getUserId()||"local_user"===t,c=void 0===a||a===ll.STREAM_INDEX_MAIN,u=void 0===a||a===ll.STREAM_INDEX_SCREEN,d=o!==lh.VIDEO,l=o!==lh.AUDIO,h=[],s&&l&&(c&&this._localVideoTrack&&(null===(_=this._videoPlayer)||void 0===_||_.mirror(!!this._mirrorType),h.push(null===(p=this._videoPlayer)||void 0===p?void 0:p.manuallyPlay())),u&&this._localScreenVideoTrack&&h.push(null===(v=this._screenPlayer)||void 0===v?void 0:v.manuallyPlay())),t===(null===(r=this._audioMixingManager)||void 0===r?void 0:r.id)&&h.push(this._audioMixingManager.resumeLocalPlay()),f=null===(n=this._room)||void 0===n?void 0:n.remoteStreams,l&&c&&h.push(E3(this._remoteVideoPlayer,t,!1,f)),l&&u&&h.push(E3(this._remoteScreenPlayer,t,!0,f)),d&&c&&h.push(E3(this._remoteAudioPlayer,t,!1,f)),l&&u&&h.push(E3(this._remoteScreenAudioPlayer,t,!0,f)),m=null===(i=this._publicStreamManager)||void 0===i?void 0:i.remoteStreams,d&&h.push(E3(this._publicStreamVideoPlayer,t,!1,m)),l&&h.push(E3(this._publicStreamAudioPlayer,t,!1,m)),e.abrupt("return",aj.all(h).then(function(){}));case 20:case"end":return e.stop()}},e,this)})),function(e){return W.apply(this,arguments)})},{key:"pauseAllSubscribedStream",value:(X=a2(a0().mark(function e(t){var r,n,i,o,a,s=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("pauseAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),vc(t)&&(s._pauseAllSubscribeState.audio=!0),vu(t)&&(s._pauseAllSubscribeState.video=!0),this._room){e.next=6;break}return e.abrupt("return",aj.resolve());case 6:n=[],i=u2(dN(r=this._room.remoteStreams).call(r));try{for(i.s();!(o=i.n()).done;)a=o.value,Array.isArray(a)&&a.forEach(function(e){if(e.hasSubscribed){s._pauseAllSubscribeState.resumeStreamIds[e.streamId]=e.streamId;var r=s._unsubscribe(e.isScreen,e.userId,t,!0);r&&n.push(r)}})}catch(e){i.e(e)}finally{i.f()}return e.abrupt("return",aj.all(n).then(function(){}));case 10:case"end":return e.stop()}},e,this)})),function(e){return X.apply(this,arguments)})},{key:"resumeAllSubscribedStream",value:(K=a2(a0().mark(function e(t){var r,n,i,o,a,s=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.info("resumeAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),vc(t)&&(s._pauseAllSubscribeState.audio=!1),vu(t)&&(s._pauseAllSubscribeState.video=!1),this._room){e.next=6;break}return e.abrupt("return",aj.resolve());case 6:n=[],i=u2(dN(r=this._room.remoteStreams).call(r));try{for(i.s();!(o=i.n()).done;)a=o.value,Array.isArray(a)&&a.forEach(function(e){if(s._pauseAllSubscribeState.resumeStreamIds[e.streamId]){delete s._pauseAllSubscribeState.resumeStreamIds[e.streamId];var r=s._subscribe(e.isScreen,e.userId,t);r&&n.push(r)}})}catch(e){i.e(e)}finally{i.f()}return e.abrupt("return",aj.all(n).then(function(){var e,t;null===(e=s._room)||void 0===e||null===(t=e.remoteStreams)||void 0===t||t.forEach(fState(e),s._updateVideoPlayerState(e)})})}));case 10:case"end":return e.stop()}},e,this)})),function(e){return K.apply(this,arguments)})},{key:"sendUserMessage",value:(z=a2(a0().mark(function e(t,r){var n,i,o,a=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return fm(t),fS(r),this._assertNotInRoom(),o=Date.now(),e.abrupt("return",null===(n=this._room)||void 0===n||null===(i=n.sendUserMessage(t,r))||void 0===i?void 0:i.then(function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!1,o,e),e.id}).catch(function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!1,o,e),e}));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return z.apply(this,arguments)})},{key:"sendUserBinaryMessage",value:(H=a2(a0().mark(function e(t,r){var n,i,o,a=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return fm(t),f_(r,"message"),fS(r),this._assertNotInRoom(),o=Date.now(),e.abrupt("return",null===(n=this._room)||void 0===n||null===(i=n.sendUserMessage(t,r))||void 0===i?void 0:i.then(function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!0,o,e),e.id}).catch(function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!0,o,e),e}));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return H.apply(this,arguments)})},{key:"sendRoomMessage",value:(G=a2(a0().mark(function e(t){var r,n,i,o=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return fS(t),this._assertNotInRoom(),i=Date.now(),e.abrupt("return",null===(r=this._room)||void 0===r||null===(n=r.sendRoomMessage(t))||void 0===n?void 0:n.then(function(e){var t,r;return o._messageStatisticsObserver.countRoomMessage(!0,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!1,i),e}).catch(function(e){var t,r;throw o._messageStatisticsObserver.countRoomMessage(!1,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!1,i),e}));case 4:case"end":return e.stop()}},e,this)})),function(e){return G.apply(this,arguments)})},{key:"sendRoomBinaryMessage",value:(j=a2(a0().mark(function e(t){var r,n,i,o=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return fS(t),this._assertNotInRoom(),i=Date.now(),e.abrupt("return",null===(r=this._room)||void 0===r||null===(n=r.sendRoomMessage(t,!0))||void 0===n?void 0:n.then(function(e){var t,r;return o._messageStatisticsObserver.countRoomMessage(!0,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!0,i),e}).catch(function(e){var t,r;throw o._messageStatisticsObserver.countRoomMessage(!1,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!0,i),e}));case 4:case"end":return e.stop()}},e,this)})),function(e){return j.apply(this,arguments)})},{key:"setAudioCaptureConfig",value:(B=a2(a0().mark(function e(){var t,r=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:{},IO.info("setAudioCaptureConfig()","config: %o",t),delete t.deviceId,fp(t),this._shouldUpdateAudioConf("setAudioCaptureConfig")&&this._ctx.audioProfileManager.updateConstraints(t);case 5:case"end":return e.stop()}},e,this)})),function(){return B.apply(this,arguments)})},{key:"setVideoCaptureConfig",value:(F=a2(a0().mark(function e(){var t,r=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},IO.info("setVideoCaptureConfig()","config: %o",t),e.abrupt("return",this._setVideoCaptureConfig(t));case 3:case"end":return e.stop()}},e,this)})),function(){return F.apply(this,arguments)})},{key:"_setVideoCaptureConfig",value:(V=a2(a0().mark(function e(){var t,r,n,i=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(delete(r=i.length>0&&void 0!==i[0]?i[0]:{}).deviceId,fp(r),n=dr(dr({},r),{},{deviceId:this._videoStreamConstraints.deviceId}),!this._localVideoTrack){e.next=7;break}return e.next=7,this._localVideoTrack.updateVideoCaptureConfig(n);case 7:return this._videoStreamConstraints=n,e.abrupt("return",(null===(t=this._localVideoTrack)||void 0===t?void 0:t.getTrack().getSettings())||{});case 9:case"end":return e.stop()}},e,this)})),function(){return V.apply(this,arguments)})},{key:"enableSimulcastMode",value:function(e){var t;return IO.info("enableSimulcastMode()","enabled: %o",e),this._enableSimulcast=e,14!==(null==vY?void 0:vY[0])&&(null!==(t=this._room)&&void 0!==t&&t.hasPublished,!0)}},{key:"setVideoEncoderConfig",value:(U=a2(a0().mark(function e(t){var r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(IO.info("setVideoEncoderConfig()"," descriptions: %o",t),Array.isArray(t)||(t=[t]),function(e){var t,r=u2(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;fc(null==n?void 0:n.maxKbps,"maxKbps"),fb(null==n?void 0:n.width,"width"),fb(null==n?void 0:n.height,"height"),fb(null==n?void 0:n.frameRate,"frameRate")}}catch(e)(t=cG(t).call(t,function(e){return!!e})),t.length>3&&(t=a$(t).call(t,0,3)),n=1;n<t.length;n++)vp(t[0].width),vp(t[n].width);dQ(t).call(t,function(e,t){return t.maxKbps-e.maxKbps}),this._setVideoCaptureConfig(dr({},t[0])),this._videoStreamEncodeConfig=t,this._updateDummyCaptureImage(ll.STREAM_INDEX_MAIN),null!==(r=this._room)&&void 0!==r&&r.hasPublished&&this._updatePublish();case 11:case"end":return e.stop()}},e,this)})),function(e){return U.apply(this,arguments)})},{key:"setScreenEncoderConfig",value:(L=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:IO.info("setScreenEncoderConfig()","description: %o",t),this._screenStreamEncodeConfig=[t],this._localScreenVideoTrack&&(this._localScreenVideoTrack.updateVideoCaptureConfig(t),t.contentHint&&this._localScreenVideoTrack.setContentHint(t.contentHint)),this._updateDummyCaptureImage(ll.STREAM_INDEX_SCREEN),null!==(r=this._room)&&void 0!==r&&r.hasScreenPublished&&this._updateScreenPublish();case 5:case"end":return e.stop()}},e,this)})),function(e){return L.apply(this,arguments)})},{key:"sendSEIMessage",value:function(e,t,r){if(IO.info("sendSEIMessage()","streamIdex: %o, message: %o, repeatCount: %o",e,t,r),!fY())throw new lM(le.NOT_SUPPORTED,"Browser does not support sending SEI");fd(e,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),fc(r,"repeatCount",0,30);var n="string"==typeof t?new Uint8Array(vt.str2ab(t)):t;if(t.length){if(e===ll.STREAM_INDEX_MAIN){if(null===(o=this._room)||void 0===o||null===(a=o.localStream)||void 0===a||!a.hasPublished)return;i=null===(s=this._room)||void 0===s?void 0:s.localStream}else{if(null===(c=this._room)||void 0===c||null===(u=c.localScreenStream)||void 0===u||!u.hasPublished)return;i=null===(d=this._room)||void 0===d?void 0:d.localScreenStream}if(n.byteLength>4096)IO.warn("sei size must not bigger than 4KB");else{var i,o,a,s,c,u,d,l=p7();i.seiList.push({content:n,uuid:l,repeatCount:r}),setTimeout(function(){var e;if(i){var t,r=d3(e=i.seiList).call(e,function(e){return e.uuid===l});r&&cV(t=i.seiList).call(t,r,1)}},2e3)}}else IO.warn("sei message must not be empty")}},{key:"setAudioVolumeIndicationInterval",value:function(e){var t=this;IO.info("setAudioVolumeIndicationInterval()","interval %o: ",e),("number"!=typeof e||e<200)&&(e=200);var r=[];this._audioVolumeIndicationTimer&&clearInterval(this._audioVolumeIndicationTimer),this._audioVolumeIndicationTimer=setInterval(function(){r=[],null===(e=t._room)||void 0===e||e.remoteStreams.forEach(function(e,t){var n;if(0!==e.length){var i=cS(e).call(e,function(e){return!e.isScreen}),o=null==i||null===(n=i.audioTrack)||void 0===n?void 0:n.getAudioLevel();r.push({userId:t,volume:o||0})}});var e,n,i=null===(n=t._localAudioTrack)||void 0===n?void 0:n.getAudioLevel();r.push({userId:t._getUserId(),volume:i||0}),t.safeEmit(vI.onAudioVolumeIndication,{speakers:r})},e)}},{key:"_sendActiveSpeaker",value:function(e,t){if(this._room&&this._room.remoteUsers.size>=1){var r,n,i,o=e[0],a=s2(t).call(t,function(e,t){return e&&e.audioPropertiesInfo.nonlinearVolume>t.audioPropertiesInfo.nonlinearVolume?e:t},void 0);(i=o?a?o.audioPropertiesInfo.nonlinearVolume>a.audioPropertiesInfo.nonlinearVolume?o:a:o:a)&&i.audioPropertiesInfo.nonlinearVolume>-35&&(r=i.streamKey?this._room.remoteUsers.get(i.streamKey.userId):null===(n=this._room._roomInfo)||void 0===n?void 0:n.userInfo)&&this.safeEmit(vI.onActiveSpeaker,{userId:r.userId,extraInfo:r.extraInfo})}}},{key:"enableAudioPropertiesReport",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};IO.info("enableAudioPropertiesReport()","config %o: ",t);var r=t.enableInBackground,n=void 0===r||r,i=t.interval,o=void 0===i?100:i;this._stopAudioPropertiesReport(),o<=0||(o=Math.max(100,o),this._audioPropertiesReportTimer=self.setInterval(function(){if(n||"hidden"!==document.visibilityState){var t=[],r=e._audioDeviceManager.getRecordTrack()||e._localAudioTrack;if(r){var i=r.getAudioLevel();t.push({streamIndex:ll.STREAM_INDEX_MAIN,audioPropertiesInfo:{linearVolume:i,nonlinearVolume:vs(i)}})}if(e._localScreenAudioTrack){var o=e._localScreenAudioTrack.getAudioLevel();t.push({streamIndex:ll.STREAM_INDEX_SCREEN,audioPropertiesInfo:{linearVolume:o,nonlinearVolume:vs(o)}})}if(e.safeEmit(vI.onLocalAudioPropertiesReport,t),e._room){var a,s=[];null!==(a=e._room)&&void 0!==a&&a.multiChatMode?e._room.getActiveSpeakerInMultiChatMode().forEach(function(t){var r,n,i=255*t.audioLevel;s.push({streamKey:{userId:t.userId,streamIndex:ll.STREAM_INDEX_MAIN,roomId:null===(r=e._room)||void 0===r||null===(n=r._roomInfo)||void 0===n?void 0:n.roomId},audioPropertiesInfo:{linearVolume:i,nonlinearVolume:vs(i)}})}):e._room.remoteStreams.forEach(function(t,r){t.forEach(function(t){if(t.audioTrack){var n,i,o=t.audioTrack.getAudioLevel();s.push({streamKey:{userId:r,streamIndex:t.isScreen?ll.STREAM_INDEX_SCREEN:ll.STREAM_INDEX_MAIN,roomId:null===(n=e._room)||void 0===n||null===(i=n.roomInfo)||void 0===i?void 0:i.roomId},audioPropertiesInfo:{linearVolume:o,nonlinearVolume:vs(o)}})}})}),e.safeEmit(vI.onRemoteAudioPropertiesReport,.streamIndex!==ll.STREAM_INDEX_SCREEN}))}}},o))}},{key:"setVideoSourceType",value:(M=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k,I,R,A;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.print("setVideoSourceType()","index: %o, videoSourceType: %o",t,r),fd(t,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),fd(r,"VideoSourceType",[lr.VIDEO_SOURCE_TYPE_EXTERNAL,lr.VIDEO_SOURCE_TYPE_INTERNAL]),n=t===ll.STREAM_INDEX_MAIN?"video":"screenVideo",this._trackSourceType[n]===r){e.next=26;break}if(this._trackSourceType[n]=r,IO.print("setVideoSourceType",a4(i="set ".concat(n," source type to ")).call(i,r)),!this._localVideoTrack||t!==ll.STREAM_INDEX_MAIN||(u=!1,r===lr.VIDEO_SOURCE_TYPE_EXTERNAL&&(u=!0,(d=this._extensionManager.getPluginByName(gd.PRE_PROCESSING,"RTCBeautyExtension"))&&d.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close()),null===(o=this._videoPlayer)||void 0===o||o.stop(),this._localVideoTrack=void 0,l=null===(a=this._room)||void 0===a?void 0:a._roomConfig.isAutoPublish,u?null===(h=this._room)||void 0===h||null===(_=h.localStream)||void 0===_||null===(p=_.observer)||void 0===p||p.setEnableVideo(!1):null===(v=this._room)||void 0===v||null===(f=v.localStream)||void 0===f||null===(m=f.observer)||void 0===m||m.setPushVideo(!1),!(null!==(s=this._room)&&void 0!==s&&null!==(c=s.localStream)&&void 0!==c&&c.pubVideo||l))){e.next=17;break}return e.next=17,this._updatePublish();case 17:if(!this._localScreenVideoTrack||t!==ll.STREAM_INDEX_SCREEN||(b=!1,r===lr.VIDEO_SOURCE_TYPE_EXTERNAL&&(b=!0,this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close()),null===(g=this._screenPlayer)||void 0===g||g.stop(),this._localScreenVideoTrack=void 0,b?null===(E=this._room)||void 0===E||null===(T=E.localScreenStream)||void 0===T||null===(k=T.observer)||void 0===k||k.setEnableVideo(!1):null===(I=this._room)||void 0===I||null===(R=I.localScreenStream)||void 0===R||null===(A=R.observer)||void 0===A||A.setPushVideo(!1),null===(y=this._room)||void 0===y||null===(S=y.localScreenStream)||void 0===S||!S.pubVideo)){e.next=26;break}return e.next=26,this._updateScreenPublish();case 26:case"end":return e.stop()}},e,this)})),function(e,t){return M.apply(this,arguments)})},{key:"setExternalVideoTrack",value:(D=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l,h,_;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.print("setExternalVideoTrack()","index: %o, track: %o",t,r),fd(t,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),fl(r),t!==ll.STREAM_INDEX_MAIN){e.next=15;break}if(this._trackSourceType.video===lr.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new lM(le.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 6:return e.next=8,function(e,t){return gV.apply(this,arguments)}(r,this._extensionManager);case 8:if(this._localVideoTrack=e.sent,this._initLocalTrackEvents(this._localVideoTrack),null===(n=this._videoPlayer)||void 0===n||n.playVideo(this._localVideoTrack),s=null===(i=this._room)||void 0===i?void 0:i._roomConfig.isAutoPublish,!(null!==(o=this._room)&&void 0!==o&&null!==(a=o.localStream)&&void 0!==a&&a.pubVideo||s)){e.next=15;break}return e.next=15,this._updatePublish();case 15:if(t!==ll.STREAM_INDEX_SCREEN){e.next=27;break}if(this._trackSourceType.screenVideo===lr.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=18;break}throw new lM(le.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 18:return e.next=20,function(e,t){return gB.apply(this,arguments)}(r,this._extensionManager);case 20:if(this._localScreenVideoTrack=e.sent,this._initLocalTrackEvents(this._localScreenVideoTrack,!0),null===(c=this._screenPlayer)||void 0===c||c.playVideo(this._localScreenVideoTrack),null===(u=this._room)||void 0===u||null===(d=u.localScreenStream)||void 0===d||null===(l=d.observer)||void 0===l||l.setPushVideo(!0),null===(h=this._room)||void 0===h||null===(_=h.localScreenStream)||void 0===_||!_.pubVideo){e.next=27;break}return e.next=27,this._updateScreenPublish();case 27:case"end":return e.stop()}},e,this)})),function(e,t){return D.apply(this,arguments)})},{key:"setAudioSourceType",value:(P=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l,h,_,p,v,f,m,g,y,S,b,E,T,k;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.print("setAudioSourceType()","index: %o, audioSourceType: %o",t,r),fd(t,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),fd(r,"audioSourceType",[ln.AUDIO_SOURCE_TYPE_EXTERNAL,ln.AUDIO_SOURCE_TYPE_INTERNAL]),n=t===ll.STREAM_INDEX_MAIN?"audio":"screenAudio",this._trackSourceType[n]===r){e.next=24;break}if(this._trackSourceType[n]=r,IO.print("setVideoSourceType",a4(i="set ".concat(n," source type to ")).call(i,r)),!this._localAudioTrack||t!==ll.STREAM_INDEX_MAIN||(c=!1,this._trackSourceType.audio===ln.AUDIO_SOURCE_TYPE_EXTERNAL&&(c=!0,this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close()),this._localAudioTrack=void 0,u=null===(o=this._room)||void 0===o?void 0:o._roomConfig.isAutoPublish,c?null===(d=this._room)||void 0===d||null===(l=d.localStream)||void 0===l||null===(h=l.observer)||void 0===h||h.setEnableAudio(!1):null===(_=this._room)||void 0===_||null===(p=_.localStream)||void 0===p||null===(v=p.observer)||void 0===v||v.setPushAudio(!1),!(null!==(a=this._room)&&void 0!==a&&null!==(s=a.localStream)&&void 0!==s&&s.pubAudio||u))){e.next=16;break}return e.next=16,this._updatePublish();case 16:if(!this._localScreenAudioTrack||t!==ll.STREAM_INDEX_SCREEN||(g=!1,this._trackSourceType.audio===ln.AUDIO_SOURCE_TYPE_EXTERNAL&&(g=!0,this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close()),this._localScreenAudioTrack=void 0,g?null===(y=this._room)||void 0===y||null===(S=y.localScreenStream)||void 0===S||null===(b=S.observer)||void 0===b||b.setEnableAudio(!1):null===(E=this._room)||void 0===E||null===(T=E.localScreenStream)||void 0===T||null===(k=T.observer)||void 0===k||k.setPushAudio(!1),null===(f=this._room)||void 0===f||null===(m=f.localScreenStream)||void 0===m||!m.pubAudio)){e.next=24;break}return e.next=24,this._updateScreenPublish();case 24:case"end":return e.stop()}},e,this)})),function(e,t){return P.apply(this,arguments)})},{key:"setExternalAudioTrack",value:(N=a2(a0().mark(function e(t,r){var n,i,o,a,s,c,u,d,l,h,_,p;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.print("setExternalAudioTrack()","index: %o, track: %o",t,r),fd(t,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),fl(r),t!==ll.STREAM_INDEX_MAIN){e.next=16;break}if(this._trackSourceType.audio===ln.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new lM(le.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 6:return e.next=8,function(e,t){return gF.apply(this,arguments)}(r,this._extensionManager);case 8:if(this._localAudioTrack=e.sent,this._localAudioTrack.setVolume(this._localAudioVolume),this._initLocalTrackEvents(this._localAudioTrack),u=null===(n=this._room)||void 0===n?void 0:n._roomConfig.isAutoPublish,null===(i=this._room)||void 0===i||null===(o=i.localStream)||void 0===o||null===(a=o.observer)||void 0===a||a.setPushAudio(!0),!(null!==(s=this._room)&&void 0!==s&&null!==(c=s.localStream)&&void 0!==c&&c.pubAudio||u)){e.next=16;break}return e.next=16,this._updatePublish();case 16:if(t!==ll.STREAM_INDEX_SCREEN){e.next=28;break}if(this._trackSourceType.screenAudio===ln.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=19;break}throw new lM(le.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 19:return e.next=21,function(e,t){return gj.apply(this,arguments)}(r,this._extensionManager);case 21:if(this._localScreenAudioTrack=e.sent,this._localScreenAudioTrack.setVolume(this._localScreenAudioVolume),this._initLocalTrackEvents(this._localScreenAudioTrack),null===(d=this._room)||void 0===d||null===(l=d.localScreenStream)||void 0===l||null===(h=l.observer)||void 0===h||h.setPushAudio(!0),null===(_=this._room)||void 0===_||null===(p=_.localScreenStream)||void 0===p||!p.pubAudio){e.next=28;break}return e.next=28,this._updateScreenPublish();case 28:case"end":return e.stop()}},e,this)})),function(e,t){return N.apply(this,arguments)})},{key:"login",value:(O=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("login()","token: %o, userInfo: %o",t,r),fv(t)||fu(t,"token"),fm(r),e.abrupt("return",this._rtmClient.login(t,r));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return O.apply(this,arguments)})},{key:"logout",value:(x=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("logout()"),e.abrupt("return",this._rtmClient.logout());case 2:case"end":return e.stop()}},e,this)})),function(){return x.apply(this,arguments)})},{key:"updateLoginToken",value:(w=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("updateLoginToken()","token: %o",t),fv(t)||fu(t,"token"),e.abrupt("return",this._rtmClient.updateLoginToken(t));case 3:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(C=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("getPeerOnlineStatus()","userId: %o",t),fm(t),e.abrupt("return",this._rtmClient.getPeerOnlineStatus(t));case 3:case"end":return e.stop()}},e,this)})),function(e){return C.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(A=a2(a0().mark(function e(t,r){var n,i=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return fm(t),fS(r),n=Date.now(),e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then(function(e){return i._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!1,n,e),e.id}).catch(function(e){throw i._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!1,n,e),e}));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return A.apply(this,arguments)})},{key:"sendUserBinaryMessageOutsideRoom",value:(R=a2(a0().mark(function e(t,r){var n,i=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return fm(t),f_(r,"message"),fS(r),n=Date.now(),e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then(function(e){return i._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!0,n,e),e.id}).catch(function(e){throw i._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!0,n,e),e}));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return R.apply(this,arguments)})},{key:"setServerParams",value:(I=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.info("setServerParams()","signature: %o, url: %0",t,r),e.abrupt("return",this._rtmClient.setServerParams(t,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return I.apply(this,arguments)})},{key:"sendServerMessage",value:(k=a2(a0().mark(function e(t){var r,n=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return fu(t,"message"),fS(t),r=Date.now(),e.abrupt("return",this._rtmClient.sendServerMessage(t).then(function(e){n._messageStatisticsObserver.countServerMessage(!0,!1,r,e)}).catch(function(e){throw n._messageStatisticsObserver.countServerMessage(!1,!1,r,e),e}));case 4:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"sendServerBinaryMessage",value:(T=a2(a0().mark(function e(t){var r,n=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f_(t,"message"),fS(t),r=Date.now(),e.abrupt("return",this._rtmClient.sendServerMessage(t).then(function(e){n._messageStatisticsObserver.countServerMessage(!0,!0,r,e)}).catch(function(e){throw n._messageStatisticsObserver.countServerMessage(!1,!0,r,e),e}));case 4:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"startCloudProxy",value:function(e){if(this._room)throw new lM(le.START_CLOUD_PROXY_AFTER_JOIN,"[startCloudProxy] should be invoke before join room ");IO.info("startCloudProxy()",e),fu(e.logProxy,"logProxy"),fu(e.accessProxy,"accessProxy"),fu(e.configProxy,"configProxy"),this._originIceConfigRequestUrls=fn("ICE_CONFIG_REQUEST_URLS"),this._originLogServerUrl=fn("LOG_SERVER_URL"),this._originConfigServerUrls=fn("CONFIG_REQUEST_DOMAINS"),fr("ICE_CONFIG_REQUEST_URLS",e.accessProxy),fr("LOG_SERVER_URL",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://".concat(e)),"".concat(e,"/video/v1/webrtc_log/")}(e.logProxy)),fr("CONFIG_REQUEST_DOMAINS",[e.configProxy]),v4.clearAccessNode(this._appId),v4.clearAccessUrls(),this._ctx.useCloudProxy=!0}},{key:"stopCloudProxy",value:function(){var e;if(this._room)throw new lM(le.STOP_CLOUD_PROXY_BEFORE_LEAVE,"[stopCloudProxy] should be invoke after leave room ");IO.info("stopCloudProxy()"),fr("ICE_CONFIG_REQUEST_URLS",null===(e=this._originIceConfigReques/AccessInfo?Action=GetAccessInfo","")})),fr("LOG_SERVER_URL",this._originLogServerUrl),fr("CONFIG_REQUEST_DOMAINS",this._originConfigServerUrls),v4.clearAccessNode(this._appId),v4.clearAccessUrls(),this._ctx.useCloudProxy=!1,this._startCloudProxyTimestamp=void 0}},{key:"startPushPublicStream",value:(E=a2(a0().mark(function e(t,r){var n,i,o,a=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),fg(t),this._assertNotInRoom(),!this._publicStreamIds.get(t)){e.next=5;break}throw new lM(le.REPEAT_PUSH,"repeat push public media stream");case 5:return o=fi(t,"started",r),e.abrupt("return",null===(n=this._room)||void 0===n||null===(i=n.publicStreamControunction(){a._publicStreamIds.set(t,t)}));case 7:case"end":return e.stop()}},e,this)})),function(e,t){return E.apply(this,arguments)})},{key:"updatePublicStreamParam",value:(b=a2(a0().mark(function e(t,r){var n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),fg(t),this._assertNotInRoom(),i=fi(t,"layoutChanged",r),e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.publicStreamControlMessage(i));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return b.apply(this,arguments)})},{key:"stopPushPublicStream",value:(S=a2(a0().mark(function e(t){var r,n=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.print("startPushPublicStream()","publicStreamId: %o",t),fg(t),this._assertNotInRoom(),e.abrupt("return",null===(r=this._room)||void 0===r?void 0:r.publicStreamControlMessage({type:"publicstream",acnction(){n._publicStreamIds.delete(t)}));case 4:case"end":return e.stop()}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"startPlayPublicStream",value:(y=a2(a0().mark(function e(t){var r,n,i,o,a,s,c=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(fg(t),this._publicStreamManager){e.next=8;break}return this._publicStreamManager=new I_(this.id,this._appId,{businessId:this._businessId}),this._publicStreamManager.on(yX.RESUBSCRIBE,function(e){var t=e.stream;if(t){var r,n=c._publicStreamAudioPlayer.get(t.streamId);n&&t.audioTrack&&(n.stop(),n.playAudio(null===(r=e.stream)||void 0===r?void 0:r.audioTrack));var i,o=c._publicStreamVideoPlayer.get(t.streamId);o&&t.videoTrack&&o.playVideo(null===(i=e.stream)||void 0===i?void 0:i.videoTrack)}}),null===(r=this._publicStreamManager)||void 0===r||r.on("onRemoteStreamStats",function(e){e.publicStreamId=e.userId,delete e.userId,delete e.isScreen,c.safeEmit(vI.onPublicStreamStats,e)}),null===(n=this._publicStreamManager)||void 0===n||n.on(yX.ON_SEI_MESSAGED_RECEIVED,function(e){c.safeEmit(vI.onPublicStreamSEIMessageReceived,e)}),e.next=8,this._publicStreamManager.connect();case 8:return e.next=10,this._publicStreamManager.startPlayPublicStream(t);case 10:i=e.sent,(o=this._publicStreamVideoPlayer.get(t))&&null!=i&&i.videoTrack&&o.playVideo(i.videoTrack,i),(a=this._publicStreamAudioPlayer.get(t))||null==i||!i.audioTrack||(a=new E2(this.id,t,{muted:(null===(s=this._config)||void 0===s?void 0:s.autoPlayPolicy)===lR.VIDEO_ONLY,isScreen:!1}),this._initPlayerEvents(a,!0),a.playAudio(i.audioTrack),this._publicStreamAudioPlayer.set(t,a));case 15:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"stopPlayPublicStream",value:(g=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._publicStreamManager){e.next=2;break}return e.abrupt("return");case 2:this._publicStreamManager.stopPlayPublicStream(t),(r=this._publicStreamAudioPlayer.get(t))&&(r.destroy(),this._publicStreamAudioPlayer.delete(t));case 5:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"setAudioProfile",value:(m=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:IO.info("setAudioProfile()","profile: %o",t),this._shouldUpdateAudioConf("setAudioProfile")&&this._ctx.audioProfileManager.setAudioProfile(t);case 2:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"setAudioEncodeMaxBitrate",value:(f=a2(a0().mark(function e(t){var r,n,i,o,a,s;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.print("setAudioEncodeMaxBitrate()",t),fc(t,"maxBitrate",6,256),this._ctx.audioProfileManager.setCustomMaxBitrate(t),!this._ctx.audioProfileManager.customMaxBitrate){e.next=10;break}if(!vw||!(null!==(r=this._room)&&void 0!==r&&null!==(n=r.localStream)&&void 0!==n&&n.pubAudio||null!==(i=this._room)&&void 0!==i&&null!==(o=i.localScreenStream)&&void 0!==o&&o.pubAudio)){e.next=6;break}throw new lM(le.NOT_SUPPORTED,"Your browser does not support set audio encode maxBitrate dynamically.");case 6:return e.next=8,null===(a=this._room)||void 0===a?void 0:a.setAudioEncodeMaxBitrate(ll.STREAM_INDEX_MAIN,t);case 8:return e.next=10,null===(s=this._room)||void 0===s?void 0:s.setAudioEncodeMaxBitrate(ll.STREAM_INDEX_SCREEN,t);case 10:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"setPublicStreamVideoPlayer",value:function(e,t){IO.print("setPublicStreamVideoPlayer()","publicStreamId: %o, videoPlayerOption: %o",e,t);var r,n,i,o,a=this._publicStreamVideoPlayer.get(e);if(null===(r=a)||void 0===r||r.destroy(),null!=t&&t.renderDom){a=new E1(this.id,dr(dr({},t),{},{userId:e})),this._initPlayerEvents(a,!0),this._publicStreamVideoPlayer.set(e,a);var s=null===(n=this._publicStreamManager)||void 0===n||null===(i=n.remoteStreams)||void 0===i?void 0:i.get(e);null!=s&&s.videoTrack&&(null===(o=this._config)||void 0===o?void 0:o.autoPlayPolicy)!==lR.PLAY_MANUALLY&&a.playVideo(s.videoTrack,s)}else this._publicStreamVideoPlayer.delete(e)}},{key:"setDummyCaptureImagePath",value:(v=a2(a0().mark(function e(t,r){var n=this;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new aj(function(e,i){fu(r,"filePath");var o=new Image;o.crossOrigin="anonymous",o.src=r,o.onload=function(){t===ll.STREAM_INDEX_MAIN?n._dummyMainImage=o:n._dummyScreenImage=o;try{n._updateDummyCaptureImage(t),e()}catch(e){i(new lM(le.UNUNEXPECTED_ERROR,"Load image error"))}}));case 1:case"end":return e.stop()}},e)})),function(e,t){return v.apply(this,arguments)})},{key:"_updateDummyCaptureImage",value:function(e){var t,r;if(e===ll.STREAM_INDEX_MAIN?(t=this._dummyMainImage,r=this._videoStreamEncodeConfig[0]):(t=this._dummyScreenImage,r=this._screenStreamEncodeConfig[0]),t){var n,i,o=document.createElement("canvas"),a=o.getContext("2d"),s=vp(r.width),c=vp(r.height);if(!a)throw new lM(le.UNEXPECTED_ERROR,"Not support canvas");!s||!c||t.width<=s&&t.height<=c?(n=t.width,i=t.height):(n=Math.min(s,t.width*c/t.height),i=Math.min(c,t.height*s/t.width)),o.width=n,o.height=i,a.drawImage(t,0,0,t.width,t.height,0,0,n,i);var u=window.setInterval(function(){t&&a.drawImage(t,0,0,t.width,t.height,0,0,n,i)},200);e===ll.STREAM_INDEX_MAIN?(clearInterval(this._dummyMainTimer),this._dummyMainTimer=u):(clearInterval(this._dummyScreenTimer),this._dummyScreenTimer=u);var d,l,h,_,p=o.captureStream(5).getVideoTracks()[0];e===ll.STREAM_INDEX_MAIN?(this._localImgVideoTrack=p,null!==(d=this._localVideoTrack)&&void 0!==d&&d.dummy&&(null===(l=this._localVideoTrack)||void 0===l||l.setTrack(this._localImgVideoTrack,this._extensionManager))):(this._localImgScreenTrack=p,null!==(h=this._localScreenVideoTrack)&&void 0!==h&&h.dummy&&(null===(_=this._localScreenVideoTrack)||void 0===_||_.setTrack(this._localImgScreenTrack,this._extensionManager)))}}},{key:"_addListenExtensionEvent",value:function(e){var t,r=this;e.on("re-capture-audio",function(){r._localAudioTrack&&r.stopAudioCapture().then(function(){r.startAudioCapture()})}),e.on("re-capture-video",function(){r._localVideoTrack&&!r._localVideothen(function(){r.startVideoCapture()})}),e.on("reset-video-effect",(t=a2(a0().mark(function e(t,n){var i,o,a;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r._localVideoTrack||r._localVideoTrack.dummy){e.next=17;break}return r._localVideoTrack&&r._removeLocalTrackEvents(r._localVideoTrack),e.prev=2,e.next=5,r._localVideoTrack.generatePreProcessingTrack(r._extensionManager);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),n(e.t0);case 10:if(r._initLocalTrackEvents(r._localVideoTrack),null!==(i=r._videoPlayer)&&void 0!==i&&i.played&&(r._videoPlayer.stop(),r._videoPlayer.playVideo(r._localVideoTrack),r._videoPlayer.mirror(!!r._mirrorType)),r.safeEmit(vI.onLocalStreamTrackChangedByExtension,{streamIndex:ll.STREAM_INDEX_MAIN,type:"video"}),t(),null===(o=r._room)||void 0===o||null===(a=o.localStream)||void 0===a||!a.pubVideo){e.next=17;break}return e.next=17,r._updatePublish();case 17:t();case 18:case"end":return e.stop()}},e,null,[[2,7]])})),function(e,r){return t.apply(this,arguments)}))}},{key:"registerExtension",value:(p=a2(a0().mark(function e(t){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.monitor=this.monitor,e.prev=1,e.next=4,t.isSupported();case 4:if(e.sent){e.next=7;break}throw Error("This extension is not supported.");case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(1),Error("This extension is not supported.");case 12:return e.next=14,t.init({videoCaptureConfig:this._videoStreamConstraints});case 14:this._extensionManager.register(t),this._addListenExtensionEvent(t);case 16:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return p.apply(this,argumen JSON.parse(a6(IC.getDefaultValue()))}},{key:"_updatePublish",value:(_=a2(a0().mark(function e(){var t,r,n=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},IO.info("_updatePublish()","config: %o",t),t=dr(dr({},{mediaType:void 0,invokeByJoinRoom:!1,pubState:yq.PUB}),t),this._visibility){e.next=6;break}throw new lM(le.NO_PUBLISH_PERMISSION,"no publish permission");case 6:return e.next=8,this._pubLock.lock();case 8:if(r=e.sent,this._room&&this._room.connectionState===Ec.CONNECTED){e.next=12;break}return r(),e.abrupt("return");case 12:return e.prev=12,e.next=15,this._room.publish(this._videoStreamEncodeConfig,this._enableSimulcast,this._localVideoTrack,this._localAudioTrack,t.mediaType,t.pubState,t.invokeByJoinRoom);case 15:this._videoPlayer&&this._room.localStream&&(this._room.localStream.videoDom=this._videoPlayer.domElement),e.next=25;break;case 18:if(e.prev=18,e.t0=e.catch(12),!(e.t0 instanceof lM)){e.next=24;break}throw e.t0;case 24:throw new lM(le.UNEXPECTED_ERROR,"unexpected error",e.t0);case 25:return e.prev=25,r(),e.finish(25);case 28:case"end":return e.stop()}},e,this,[[12,18,25,28]])})),function(){return _.apply(this,arguments)})},{key:"startAudioPlaybackDeviceTest",value:(h=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.print("startAudioPlaybackDeviceTest()","filePath: %o, indicationInterval: %o",t,r),fu(t,"filePath"),fc(r,"indicationInterval"),e.next=5,this._audioDeviceManager.startAudioPlaybackDeviceTest(t,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){IO.info("stopAudioPlaybackDeviceTest()"),this._audioDeviceManager.stopAudioPlaybackDeviceTest()}},{key:"startAudioDeviceRecordTest",value:(l=a2(a0().mark(function e(t,r){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return IO.print("startAudioDeviceRecordTest()","indicationInterval: %o",t),fc(t,"indicationInterval"),e.next=4,this._audioDeviceManager.startAudioDeviceRecordTest(t,r,this._localAudioVolume);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){IO.info("stopAudioDeviceRecordAndPlayTest()"),this._audioDeviceManager.stopAudioDeviceRecordAndPlayTest()}viceManager.stopAudioDevicePlayTest()}},{key:"setRemoteUserPriority",value:function(e,t){var r;IO.print("setRemoteUserPriority()","userId: %o, priority: %o",e,t);try{fm(e),fd(t,"priority",[lb.HIGH,lb.MEDIUM,lb.LOW])}catch(e){return!1}return this._ctx.userPriority.set(e,t),null===(r=this._room)||void 0===r||r.updateRemoteUserPriority(e),!0}},{key:"takeLocalSnapshot",value:(d=a2(a0().mark(function e(t){var r,n;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.print("takeLocalSnapshot()","streamIndex: %o",t),fd(t,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),r=t===ll.STREAM_INDEX_MAIN?this.localVideoTrack:this.localScreenVideoTrack){e.next=5;break}throw new lM(le.INVOKED_BEFORE_CAPTURE,"capture first");case 5:return n=t===ll.STREAM_INDEX_MAIN?this._videoPlayer:this._screenPlayer,e.abrupt("return",Ig(r.getTrack("preprocessing"),(null==n?void 0:n.mirrorType)===lv.MIRROR_TYPE_RENDER,n));case 7:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"takeRemoteSnapshot",value:(u=a2(a0().mark(function e(t,r){var n,i,o,a,s,c;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(IO.print("takeRemoteSnapshot()","id: %o, streamIndex: %o",t,r),fu(t,"id"),fd(r,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),c=(null===(n=this._room)||void 0===n||null===(i=n.remoteStreams.get(t))||void 0===i||null===(o=cS(i).call(i,function(e){return e.isScreen===(r===ll.STREAM_INDEX_SCREEN)}))||void 0===o?void 0:o.videoTrack)||(null===(a=this._publicStreamManager)||void 0===a||null===(s=a.remoteStreams.get(t))||void 0===s?void 0:s.videoTrack)){e.next=6;break}throw new lM(le.STREAM_NOT_EXIST,"stream not exist");case 6:return e.abrupt("return",Ig(c.getTrack(),!1,r===ll.STREAM_INDEX_MAIN?this._remoteVideoPlayer.get(t):this._remoteScreenPlayer.get(t)));case 7:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"setSubscribeFallbackOption",value:function(e){IO.info("setSubscribeFallbackOption()","option: %o",e);try{fd(e,"option",[lS.DISABLE,lS.VIDEO_STREAM_LOW,lS.AUDIO_ONLY])}catch(e){return!1}return!this._room&&(this._ctx.subscribeFallbackOption=e,!0)}},{key:"getLocalStreamTrack",value:function(e,t){var r,n,i,o=this;if(e===ll.STREAM_INDEX_MAIN?(n="video"===t?this.localVideoTrack:this.localAudioTrack,i=function(){var e;return null===(e=o._room)||void 0===e?void 0:e.localStream}):(n="video"===t?this.localScreenVvoid 0===e?void 0:e.localScreenStream}),n){var a=n instanceof gG.LocalAudioTrack&&n.mixedAudioTrack?n.mixedAudioTrack:n.getTrack("preprocessing");if(a){var s=i();return this._reportMsTrackEvent(a,(null==s||null===(r=s.stream)||void 0===r?void 0:r.id)||"local"),a}}}},{key:"getRemoteStreamTrack",value:function(e,t,r){var n,i,o,a,s,c,u,d=(null===(c=this._room)||void 0===c?void 0:c.remoteStreams.get(e))||[];if(d&&d.length&&(t=.call(d,function(e){return!e.isScreen}),u="video"===r?null===(i=n)||void 0===i?void 0:i.videoTrack:null===(o=n)||void 0===o?void 0:o.audioTrack):(n=cS(d).call(d,function(e){return e.isScreen}),u="video"===r?null===(a=n)||void 0===a?void 0:a.videoTrack:null===(s=n)||void 0===s?void 0:s.audioTrack),u)){var l=u.getTrack();if(l&&n){var h=n.streamId;return this._reportMsTrackEvent(l,h),l}}}},{key:"getPublicStreamTrack",value:function(e,t){if(this._publicStreamManager&&this._publicStreamManager.remoteStreams){var r=this._publicStreamManager.remoteStreams.get(e);if(r){var n="video"===t?r.videoTrack:r.audioTrack;if(n){var i=n.getTrack();if(i){var o=r.streamId;return this._reportMsTrackEvent(i,o),i}}}}}},{key:"setRemoteStreamRenderSync",value:function(e){return!this._room&&(this._ctx.avSync=!!e,!0)}},{key:"setCaptureVolume",value:function(e,t){var r,n,i;(fd(e,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),t=fE(t,"volume",0,400),e===ll.STREAM_INDEX_SCREEN)?(null===(r=this._localScreenAudioTrack)||void 0===r||r.setVolume(t),this._localScreenAudioVolume=t):(null===(n=this._localAudioTrack)||void 0===n||n.setVolume(t),null===(i=this._audioDeviceManager.audioTrack)||void 0===i||i.setVolume(t),this._localAudioVolume=t)}},{key:"setPlaybackVolume",value:function(e,t,r){var n,i,o;if(fm(e),fd(t,"streamIndex",[ll.STREAM_INDEX_MAIN,ll.STREAM_INDEX_SCREEN]),r=fE(r,"volume",0,400),null!==(n=this._room)&&void 0!==n&&n.multiChatMode);else{var a=t===ll.STREAM_INDEX_SCREEN;a?this._remoteScreenAudioVolume.set(e,r):this._remoteAudioVolume.set(e,r),null===(i=this._room)||void 0===i||null===(o=i.remoteioTrack)||void 0===t||t.setVolume(r))})}}},{key:"setPublicStreamVolume",value:function(e,t){var r,n,i;fu(e,"publicStreamId"),t=fE(t,"volume",0,400),this._publicAudioVolume.set(e,t),null===(r=this._publicStreamManager)||void 0===r||null===(n=r.remoteStreams.get(e))||void 0===n||null===(i=n.audioTrack)||void 0===i||i.setVolume(t)}},{key:"startForwardStreamToRooms",value:(c=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach(function(e){ff(e.roomId)}),this._assertNotInRoom(),e.next=4,this._room.startForwardStream2Rooms(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"updateForwardStreamToRooms",value:(s=a2(a0().mark(function e(t){var r;return a0().wrap(function(e){for(;;)switch(rn t.forEach(function(e){ff(e.roomId)}),this._assertNotInRoom(),e.next=4,this._room.updateForwardStream2Rooms(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"stopForwardStreamToRooms",value:(a=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.stopForwardStream2Rooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"pauseForwardStreamToAllRooms",value:(o=a2(a0().mark(function e(){var t;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.pauseForwardStream2AllRooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"resumeForwardS5:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"_reportMsTrackEvent",value:function(e,t){var r=this;if(!e.hookStop){e.hookStop=!0;var n=e.stop;e.stop=function(){p3(r.id,"stop",t,0,t),n.call(e)}}}},{key:"_updateScreenPublish",value:(n=a2(a0().mark(function e(){var t,r,n=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},IO.info("_updateScreenPublish()"),t=dr(dr({},{mediaType:void 0,pubState:yq.PUB}),t),e.next=6,this._pubLock.lock();case 6:if(r=e.sent,this._room&&this._room.connectionState===Ec.CONNECTED){e.next=10;break}return r(),e.abrupt("return");case 10:return e.prev=10,e.next=13,this._room.publishScreen(this._screenStreamEncodeConfig,this._localScreenVideoTrack,this._localScreenAudioTrack,t.mediaType,t.pubState);case 13:this._screenPlayer&&this._room.localScreenStream&&(this._room.localScreenStream.videoDom=this._screenPlayer.domElement),e.next=23;break;case 16:if(e.prev=16,e.t0=e.catch(10),!(e.t0 instanceof lM)){e.next=22;break}throw e.t0;case 22:throw new lM(le.UNEXPECTED_ERROR,"unexpected error",e.t0);case 23:return e.prev=23,r(),e.finish(23);case 26:case"end":return e.stop()}},e,this,[[10,16,23,26]])})),function(){return n.apply(this,arguments)})},{key:"_updateAudioPlayerState",value:function(e){IO.info("_updateAudioPlayerState()");var t,r=e.userId,n=e.isScreen,i=n?this._remoteScreenAudioPlayer:this._remoteAudioPlayer,o=i.get(r);if(e.audioTrack&&e.attributes.audiostream&&e.subAudio){var a,s,c,u=n?null!==(a=this._remoteScreenAudioVolume.get(r))&&void 0!==a?a:100:null!==(s=this._remoteAudioVolume.get(r))&&void 0!==s?s:100;if(e.audioTrack.setVolume(u),!o){o=new E2(this.id,r,{muted:(null===(d=this._config)||void 0===d?void 0:d.autoPlayPolicy)===lR.VIDEO_ONLY,isScreen:n}),this._initPlayerEvents(o,!1,n?ll.STREAM_INDEX_SCREEN:ll.STREAM_INDEX_MAIN),i.set(r,o);var d,l=this._audioDeviceManager.getSinkId();l&&o.setPlaybackDevice(l)}(null===(c=this._config)||void 0===c?void 0:c.autoPlayPolicy)!==lR.PLAY_MANUALLY&&o.playAudio(e.audioTrack),vx&&vU&&Iw(this._remoteAudioPlayer)}else null===(t=o)||void 0===t||t.stop()}},{key:"_updateVideoPlayerState",value:function(e){IO.info("_updateVideoPlayerState()");var t,r,n=e.userId;(t=e.isScreen?this._remoteScreenPlayer.get(n):this._remoteVideoPlayer.get(n),e.videoTrack)?t&&(null===(r=this._config)||void 0===r?void 0:r.autoPlayPolicy)!==lR.PLAY_MANUALLY&&t.playVideo(e.videoTrack,e):null!=t&&t.played&&(null==t||t.stop())}},{key:"_onAddStream",value:(r=a2(a0().mark(function e(t){var r,n,i,o,a,s,c,u,d;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.stream).videoDom=null===(r=this._remoteVideoPlayer.get(n.userId))||void 0===r?void 0:r.domElement,o=(i=null==n?void 0:n.attributes).localaudio,a=i.audiostream,s=i.localvideo,c=i.videostream,u=gH.NONE,a&&(u|=lh.AUDIO),c&&(u|=lh.VIDEO),!u){e.next=12;break}return e.next=9,new aj(function(e){return setTimeout(e)});case 9:null!=n&&n.isScreen?this.safeEmit(vI.onUserPublishScreen,{userId:n.userId,mediaType:u}):(this.safeEmit(vI.onUserPublishStream,{userId:n.userId,mediaType:u,videoStreamDescriptions:null==n||null===(d=n.attributes)||void 0===d?void 0:d.videoDescriptions}),this._handleAutoSubscribe(n,!0)),this.safeEmit("onAddStream",{userId:n.userId,mediaType:u,isScreen:!(null==n||!n.isScreen)}),null!=n&&n.isScreen||(o&&this.safeEmit(vI.onUserStartAudioCapture,{userId:n.userId}),s&&this.safeEmit(vI.onUserStartVideoCapture,{userId:n.userId}));case 12:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_handleAutoSubscribe",value:function(e,t){var r,n,i,o,a=gH.NONE;null!==(i=this._roomConfig)&&void 0!==i&&i.isAutoSubscribeAudio&&(a|=lh.AUDIO),null!==(o=this._roomConfig)&&void 0!==o&&o.isAutoSubscribeVideo&&(a|=lh.VIDEO),a&&(t&&vc(a)&&(null===(r=e.observer)||void 0===r||r.setAutoSubscribeAudio(!0)),t&&vu(a)&&(null===(n=e.observer)||void 0===n||n.setAutoSubscribeVideo(!0)),this._subscribe(!1,e.userId,a))}},{key:"_onRemoveStream",value:function(e){var t,r=this,n=e.stream,i=null!==(t=ID[e.reason])&&void 0!==t?t:l_.STREAM_REMOVE_REASON_OTHER,o=n.isScreen?vI.onUserUnpublishScreen:vI.onUserUnpublishStream,a=gH.NONE;n.attributes.audiostream&&(a|=lh.AUDIO),n.attributes.videostream&&(a|=lh.VIDEO),a!==gH.NONE&&(this.safeEmit(o,{userId:n.userId,mediaType:a,reason:i}),this.safeEmit("onRemoveStream",{userId:n.userId,isScreen:n.isScreen})),"function"==typeof e.callback&&e.callback(),this._getRemotePlayer(n.userId,n.isScreen).forEach(function(e){n.isScreen?(r._remoteScreenPlayer.delete(n.userId),r._remoteScreenAudioPlayer.delete(n.userId)):(r._remoteAudioPlayer.delete(n.userId),r._remoteVideoPlayer.delete(n.userId)),null==e||e.destroy()})}},{key:"_onUserConnection",v{return t.safeEmit(vI.onUserJoined,e)})}},{key:"_onUserLeave",value:function(e){var t=this,r=e.userInfo;this._getRemotePlayer(r.userId,!0).forEach(function(e){t._remoteScreenAudioPlayer.delete(r.userId),t._remoteScreenPlayer.delete(r.userId),null==e||e.destroy()}),this._getRemotePlayer(r.userId,!1).forEach(function(e){t._remoteAudioPlayer.delete(r.userId),t._remoteVideoPlayer.delete(r.userId),null==e||e.destroy()}),this.safeEmit(vI.onUserLeave,e)}},{key:"_onRoomError",value:function(e){var t;this.safeEmit(vI.onError,e),null===(t=this._room)||void 0===t||t.destroy(),this._room=void 0}},{key:"_onNetworkQuality",value:function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];this.safeEmit.apply(this,a4(e=[vI.onNetworkQuality]).call(e,r))}},{key:"_onConnectionStateChange",value:function(e){if(void 0!==this._startCloudProxyTimestamp&&this._ctx.useCloudProxy&&e.state===lp.CONNECTION_STATE_CONNECTED&&this.safeEmit(vI.onCloudProxyConnected,{interval:Date.now()-this._startCloudProxyTimestamp}),this.safeEmit(vI.onConnectionStateChanged,e),e.state===lp.CONNECTION_STATE_RECONNECTING){var t,r=u2(this._remoteAudioPlayer);try{for(r.s();!(t=r.n()).done;){var n=u3(t.value,2),i=n[0],o=n[1];null!=i&&d9(i).call(i,"mux")&&o.stop()}}catch(e){r.e(e)}finally{r.f()}}}},{key:"_getRemotePlayer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lh.AUDIO_AND_VIDEO,n=(t?this._remoteScreenAudioPlayer:this._remoteAudioPlayer).get(e),i=(t?this._remoteScreenPlayer:this._remoteVideoPlayer).get(e),o=[];return r&lh.AUDIO&&o.push(n),r&lh.VIDEO&&o.push(i),o}},{his._audioPropertiesReportTimer=null)}},{key:"_onResubscribe",value:function(e){e.stream&&(this._getRemotePlayer(e.stion(e){return null==e?void 0:e.stop()}),this._updateAudioPlayerState(e.stream),this._updateVideoPlayerState(e.stream)his._updateAudioPlayerState(e.stream)}},{key:"_onRemovePushTrack",value:function(e){var t=this;if(e.stream){this._updateAudioPlayerState(e.stream);var r=e.stream;this._getRemotePlayer(r.userId,r.isScreen,e.mediaType).forEach(function(n){e.mediaType&lh.AUDIO&&(r.isScreen?t._remoteScreenAudioPlayer.delete(r.userId):t._remoteAudioPlayer.delete(r.userId)),r.isScreen?e.mediaType&lh.VIDEO&&t._remoteScreenPlayer.delete(r.userId):e.mediaType&lh.VIDEO&&t._remoteVideoPlayer.delete(r.userId),null==n||n.destroy()})}}},{key:"_onVideoDeviceStateChange",value:function(e){this.safeEmit(vI.onVideoDeviceStateChanged,e)}},{key:"_onAudioDeviceStateChange",value:function(e){this.safeEmit(vI.onAudioDeviceStateChanged,e)}},{key:"_onUserPublishStateChange",value:function(e){var t,r=this,n=e.userId,i=e.isScreen,o=e.mediaType,a=e.pubState,s=e.remoteStream,c={userId:nction(){r._updateAudioPlayerState(s)}),i)?a===yq.PUB?this.safeEmit(vI.onUserPublishScreen,c):this.safeEmit(vI.onUserUnpublishScreen,dr(dr({},c),{},{reason:l_.STREAM_REMOVE_REASON_UNPUBLISH})):a===yq.PUB?(c.videoStreamDescriptions=null==s||null===(t=s.attributes)||void 0===t?void 0:t.videoDescriptions,this.safeEmit(vI.onUserPublishStream,c),this._handleAutoSubscribe(s,!0)):this.safeEmit(vI.onUserUnpublishStream,dr(dr({},c),{},{reason:l_.STREAM_REMOVE_REASON_UNPUBLISH}))}},{key:"_onCustomMessage",value:function(e){var t=e.message;e.binary?this.safeEmit(vI.onRoomBinaryMessageReceived,{userId:e.clientId,message:t}):this.safeEmit(vI.onRoomMessageReceived,{userId:e.clientId,message:t})}},{key:"_onUserMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(vI.onUserMessageReceived,e)}},{key:"_onUserBinaryMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(vI.onUserBinaryMessageReceived,e)}},{key:"_onLiveTranscodingResult",value:function(e){this.safeEmit(vI.onLiveTranscodingResult,e)}},{key:"_onStreamMixingEvent",value:function(e){this.safeEmit(vI.onStreamMixingEvent,e)){this.safeEmit(vI.onTokenWillExpire)}},{key:"_onPushPublicStreamResult",value:function(e){this.safeEmit(vI.onPushPublicStreamResult,e)}},{key:"_handleRTMClient",value:function(e){var t=this;e.on("onUserMessageReceivedOutsideRoom",function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(vI.onUserMessageReceivedOutsideRoom,e)}),e.on("onUserBinaryMessageReceivedOutsideRoom",function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(vI.onUserBinaryMessageReceivedOutsideRoom,e)}),e.on("onUserDisconnection",function(){t.safeEmit(vI.onError,{errorCode:le.RTM_DUPLICATE_LOGIN})}),e.on("onRTMTokenError",function(){t.safeEmit(vI.onError,{errorCode:le.RTM_TOKEN_ERROR})}),e.on("onServerParamsSetResult",function(e){t.safeEmit(vI.onServerParamsSetResult,null==e?void 0:function(){return!!this._tempRoomInfo}},{key:"localAudioTrack",get:function(){return this._localAudioTrack}},{key:"localVideoTrack",get:function(){return this._localVideoTrack}},{key:"localScreenAudioTrack",get:function(){return this._localScreenAudioTrack}},{key:"localScreenVideoTrack",get:function(){return this._localScreenVideoTrack}},{key:"remoteStreams",get:function(){var e,t,r=[];return null!==(e=this._room)&&void 0!==e&&e.remoteStreams&&(null===(t=this._room)||void 0===t||t.remoteStreams.forEach(function(e){Array.isArray(e)&&e.forEach(function(e){r.push({userId:e.userId,isScreen:e.isScreen,hasVideo:e.hasVideo,hasAudio:e.hasAudio,videoStreamDescriptions:e.attributes.videoDescroid 0===n?void 0:n.iceConnectionState}},{key:"remoteUsers",get:function(){var e,t,r=[];return null!==(e=this._room)&&void 0!==e&&e.remoteUsers&&(null===(t=this._rofunction(e){r.push({userId:e.userId})})),r}},{key:"multiChatMode",get:function(){var e,t;return!(null===(e=this._room)||void 0===e||null===(t=e._mediaServerClient)||void 0===t||!t.roomAttributes.multiChatMode)}},{key:"_handleAudioDeviceManager",value:function(){var e=this;this._audioDeviceManager.on("onAudioPlaybackDeviceTestVolume",function(t){e.safeEmit(vI.onAudioPlaybackDeviceTestVolume,t)})}},{key:"_assertNotInRoom",value:function(){if(!this._room||this._room.connectionState!==Ec.CONNECTED)throw new lM(le.NOT_CONNECTED_YET,"server not connected")}},{key:"_checkMediaType",value:function(e){fd(e,"mediaType",[lh.AUDIO,lh.VIDEO,lh.AUDIO_AND_VIDEO])}},{key:"_getUserId",value:function(){var e,t;return(null===(e=this._room)||void 0===e||null===(t=e.roomInfo)||void 0===t?void 0:t.userInfo.userId)||"local_user"}},{key:"_switchTrack",value:(t=a2(a0().mark(function e(t){var r,n,i;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._initLocalTrackEvents(t),this._localVideoTrack=t,null!==(r=this._videoPlayer)&&void 0!==r&&r.played&&(this._videoPlayer.stop(),this._videoPlayer.playVideo(t),this._videoPlayer.mirror(!!this._mirrorType)),null===(n=this._room)||void 0===n||null===(i=n.localStream)||void 0===i||!i.pubVideo){e.next=6;break}return e.next=6,this._updatePublish();case 6:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_shouldUpdateAudioConf",value:function(e){var t,r,n,i=(null===(t=this._room)||void 0===t?void 0:t.hasPublished)||(null===(r=this._room)||void 0===r||null===(n=r.localStream)||void 0===n?void 0:n.pubAudio)||this._localAudioTrack&&this._localAudioTrack.sourceType===gh.INTERNAL;if(i){var o="engine.".concat(e," should be called before publishing or capturing.");p3(this.id,e,o)}return!i}},{key:"_getServerConfig",value:function(){var e=this;p4({engineId:this.id,appId:this.appId,sdkVersion:fn("VERSION"),requestDomains:fn("CONFIG_REQUEST_DOMAINS"),keys:["rts_report","web_join_room"]}).then(function(t){t.rts_report&&pj.setConfig(t.rts_report),e._ctx.joinRoomConfig.setServerConfig(t.web_join_room)})}}]),eT}();Ix([p1()],IN.prototype,"updateToken",1),Ix([p1()],IN.prototype,"setVideoCaptureDevice",1),Ix([p1()],IN.prototype,"setAudioCaptureDevice",1),Ix([function(e,t,r){if("function"==typeof r.value){var n=r.value;r.value=function(){for(var e,t=pZ(this.id),r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];return null==t||t.set({room_id:i[1],user_id:null===(e=i[2])||void 0===e?void 0:e.userId}),n.apply(this,i)}}},p1()],IN.prototype,"connect",1),Ix([p1()],IN.prototype,"joinRoom",1),Ix([p1()],IN.prototype,"leaveRoom",1),Ix([p1()],IN.prototype,"destroy",1),Ix([p1()],IN.prototype,"publishStream",1),Ix([p1()],IN.prototype,"unpublishStream",1),Ix([p1()],IN.prototype,"publishScreen",1),Ix([p1()],IN.prototype,"unpublishScreen",1),Ix([p1()],IN.prototype,"subscribeStream",1),Ix([p1()],IN.prototype,"unsubscribeStream",1),Ix([p1()],IN.prototype,"subscribeScreen",1),Ix([p1()],IN.prototype,"unsubscribeScreen",1),Ix([p1()],IN.prototype,"setRemoteVideoConfig",1),Ix([p1()],IN.prototype,"startVideoCapture",1),Ix([p1()],IN.prototype,"stopVideoCapture",1),Ix([p1()],IN.prototype,"startAudioCapture",1),Ix([p1()],IN.prototype,"stopAudioCapture",1),Ix([p1()],IN.prototype,"getAudioMixingManager",1),Ix([p1()],IN.prototype,"startScreenCapture",1),Ix([p1()],IN.prototype,"stopScreenCapture",1),Ix([p1()],IN.prototype,"setLocalVideoPlayer",1),Ix([p1()],IN.prototype,"startLiveTranscoding",1),Ix([p1()],IN.prototype,"updateLiveTranscoding",1),Ix([p1()],IN.prototype,"stopLiveTranscoding",1),Ix([p1()],IN.prototype,"startSubtitle",1),Ix([p1()],IN.prototype,"stopSubtitle",1),Ix([p1()],IN.prototype,"setBusinessId",1),Ix([p1()],IN.prototype,"setUserVisibility",1),Ix([p1()],IN.prototype,"setRemoteVideoPlayer",1),Ix([p1()],IN.prototype,"setLocalVideoMirrorType",1),Ix([p1()],IN.prototype,"setAudioPlaybackDevice",1),Ix([p1()],IN.prototype,"play",1),Ix([p1()],IN.prototype,"pauseAllSubscribedStream",1),Ix([p1()],IN.prototype,"resumeAllSubscribedStream",1),Ix([p1()],IN.prototype,"sendUserMessage",1),Ix([p1()],IN.prototype,"sendUserBinaryMessage",1),Ix([p1()],IN.prototype,"sendRoomMessage",1),Ix([p1()],IN.prototype,"sendRoomBinaryMessage",1),Ix([p1()],IN.prototype,"setAudioCaptureConfig",1),Ix([v_("4.51"),p1()],IN.prototype,"setVideoCaptureConfig",1),Ix([p1()],IN.prototype,"enableSimulcastMode",1),Ix([p1()],IN.prototype,"setVideoEncoderConfig",1),Ix([p1()],IN.prototype,"setScreenEncoderConfig",1),Ix([p1()],IN.prototype,"sendSEIMessage",1),Ix([v_("4.42"),p1()],IN.prototype,"setAudioVolumeIndicationInterval",1),Ix([p1()],IN.prototype,"enableAudioPropertiesReport",1),Ix([p1()],IN.prototype,"setVideoSourceType",1),Ix([p1()],IN.prototype,"setExternalVideoTrack",1),Ix([p1()],IN.prototype,"setAudioSourceType",1),Ix([p1()],IN.prototype,"setExternalAudioTrack",1),Ix([p1()],IN.prototype,"login",1),Ix([p1()],IN.prototype,"logout",1),Ix([p1()],IN.prototype,"updateLoginToken",1),Ix([p1()],IN.prototype,"getPeerOnlineStatus",1),Ix([p1()],IN.prototype,"sendUserMessageOutsideRoom",1),Ix([p1()],IN.prototype,"sendUserBinaryMessageOutsideRoom",1),Ix([p1()],IN.prototype,"setServerParams",1),Ix([p1()],IN.prototype,"sendServerMessage",1),Ix([p1()],IN.prototype,"sendServerBinaryMessage",1),Ix([p1()],IN.prototype,"startCloudProxy",1),Ix([p1()],IN.prototype,"stopCloudProxy",1),Ix([p1()],IN.prototype,"startPushPublicStream",1),Ix([p1()],IN.prototype,"updatePublicStreamParam",1),Ix([p1()],IN.prototype,"stopPushPublicStream",1),Ix([p1("streamId")],IN.prototype,"startPlayPublicStream",1),Ix([p1("streamId")],IN.prototype,"stopPlayPublicStream",1),Ix([p1()],IN.prototype,"setAudioProfile",1),Ix([p1()],IN.prototype,"setAudioEncodeMaxBitrate",1),Ix([p1()],IN.prototype,"setPublicStreamVideoPlayer",1),Ix([p1()],IN.prototype,"setDummyCaptureImagePath",1),Ix([p1()],IN.prototype,"registerExtension",1),Ix([p1()],IN.prototype,"startAudioPlaybackDeviceTest",1),Ix([p1()],IN.prototype,"stopAudioPlaybackDeviceTest",1),Ix([p1()],IN.prototype,"startAudioDeviceRecordTest",1),Ix([p1()],IN.prototype,"stopAudioDeviceRecordAndPlayTest",1),Ix([p1()],IN.prototype,"stopAudioDevicePlayTest",1),Ix([p1()],IN.prototype,"setRemoteUserPriority",1),Ix([p1()],IN.prototype,"takeLocalSnapshot",1),Ix([p1()],IN.prototype,"takeRemoteSnapshot",1),Ix([p1()],IN.prototype,"setSubscribeFallbackOption",1),Ix([p1()],IN.prototype,"getLocalStreamTrack",1),Ix([p1()],IN.prototype,"getRemoteStreamTrack",1),Ix([p1()],IN.prototype,"getPublicStreamTrack",1),Ix([p1()],IN.prototype,"setRemoteStreamRenderSync",1),Ix([p1()],IN.prototype,"startForwardStreamToRooms",1),Ix([p1()],IN.prototype,"updateForwardStreamToRooms",1),Ix([p1()],IN.prototype,"stopForwardStreamToRooms",1),Ix([p1()],IN.prototype,"pauseForwardStreamToAllRooms",1),Ix([p1()],IN.prototype,"resumeForwardStreamToAllRooms",1);var IP,ID={"client unpublished":l_.STREAM_REMOVE_REASON_UNPUBLISH,"publish failed":l_.STREAM_REMOVE_REASON_PUBLISH_FAILED,"stream removed":l_.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED,"client disconnected":l_.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED,"client republish":l_.STREAM_REMOVE_REASON_REPUBLISH},IM=new h1("VERTC",0);hz.storeKey=a4(IP="".concat(Date.now(),"-")).call(IP,v4.getDeviceId()),pH({rtc_sdk_version:ft.VERSION,device_id:v4.getDeviceId(),log_cache_key:hz.storeKey}),pz(ft.LOG_SERVER_URL);var IL=1,IU=function(e,t){IM.info("createEngine","Invoke VERTC.createEngine"),fu(e,"appId");var r=(IL++).toString();return p$(r,{rtc_app_id:e,auto_play_policy:null==t?void 0:t.autoPlayPolicy}),new IN(e,r,t)},IV=function(e){if(IM.info("destroyEngine","Invoke VERTC.destroyEngine"),!(e instanceof IN))throw new lM(le.INVALID_ENGINE,"Invalid engine object");e.destroy(),p0(e.monitor)},IF=(n=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gr.enumerateDevices());case 1:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)}),IB=(i=a2(a0().mark(function e(){var t,r,n,i,o,a,s=arguments;return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=s.length>0&&void 0!==s[0]?s[0]:{video:!0,audio:!0}).video,n=t.audio,i={video:!1,audio:!1},!r){e.next=14;break}return e.prev=4,e.next=7,gr.getPermissions({video:!0,force:!0});case 7:o=e.sent,i.video=o.video,o.video||(i.videoExceptionError=o.reason),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(4);case 14:if(!n){e.next=25;break}return e.prev=15,e.next=18,gr.getPermissions({audio:!0,force:!0});case 18:a=e.sent,i.audio=a.audio,a.audio||(i.audioExceptionError=a.reason),e.next=25;break;case 23:e.prev=23,e.t1=e.catch(15);case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}},e,null,[[4,12],[15,23]])})),function(){return i.apply(this,arguments)}),Ij=(o=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gr.enumerateAudioCaptureDevices());case 1:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)}),IG=(a=a2(a0().mark(function e(){return a0().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gr.enumerateVideoCaptureDevices());case 1:case"end":return e.stop()}},e)})),function(){return a.applcase 1:case"end":return e.stop()}},e)})),function(){return s.apply(this,arguments)}),Iz=function(){return ft.VERSION},IK=function(){return pW("isSupported",0,""),fM()},IX=function(){return pW("getSupportedCodecs",0,""),fV()},IW=function(e){var t=e.logLevel,r=e.LogfileSize;t&&(hz.logLevel=t),r&&(hz.LogfileSize=r)},Iq=function(e){hz.download(e)};function IY(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[){return e instanceof IN?"[ENGINE]":e}))}function IJ(e,t){return function(){pW(t,0,IY.apply(void 0,arguments));var r=e.apply(void 0,arguments);return"function"==typeof(null==r?void 0:r.then)?r.then(function(e){return pq(t,0,IY(e)),e}).catch(function(e){throw pq(t,e.code,e.message),e}):(pq(t,0,IY(r)),r)}}var IQ=new(ib(function e(){iE(this,e),iT(this,"getSdkVersion",IJ(Iz,"getSdkVersion")),iT(this,"createEngine",IJ(IU,"createEngine")),iT(this,"destroyEngine",IJ(IV,"destroyEngine")),iT(this,"enumerateDevices",IJ(IF,"enumerateDevices")),iT(this,"enableDevices",IJ(IB,"enableDevices")),iT(this,"enumerateAudioCaptureDevices",IJ(Ij,"enumerateAudioCaptureDevices")),iT(this,"enumerateVideoCaptureDevices",IJ(IG,"enumerateVideoCaptureDevices")),iT(this,"enumerateAudioPlaybackDevices",IJ(IH,"enumerateAudioPlaybackDevices")),iT(this,"getParameter",fn),iT(this,"setParameter",fr),iT(this,"isSupported",IJ(IK,"isSupported")),iT(this,"getSupportedCodecs",IJ(IX,"getSupportedCodecs")),iT(this,"events",vI),iT(this,"ErrorCode",le),iT(this,"platform","VolcEngine"),iT(this,"commitInfo","release_455<1c3e6b4*>"),iT(this,"downloadLog",IJ(Iq,"downloadLog")),iT(this,"setLogConfig",IJ(IW,"setLogConfig"))}))}}]);