(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[587],{b8Ce:function(e,t,a){"use strict";a.r(t),a.d(t,"OfficeFluidOneDsSink",();var n=a("3qFY"),s=a("3M/p"),i=a("bgLm"),r=a("USFr"),d="Office.Telemetry.OTelJS.EventThrottled";ar c=function(){function e(e,t){this._sinkName=e,this._telemetrySink=t,this.name="EventThrottler",this._totalEventsInLastInterval=0,this._singleEventInLastInterval={},this._eventThrottleReported={},this._lastIntervalStart=Date.now(),this._maxNamedEventsPerSecond={}}return e.prototype.setSingleEventThrottle=function(e){this._maxSingleEventPerSecond=e},e.prototype.setTotalEventThrottle=e.prototype.setNamedEventThrottle=e.prototype.processEvent=function(e){var t=e.eventName;if(t===d)return!0;var a=!0;return Date.now()-this._lastIntervalStart>1e3&&(this._lastIntervalStart=Date.now(),this._totalEventsInLastInterval=0,this._singleEventInLastInterval={}),this._singleEventInLastInterval[t]=this._singleEventInLastInterval[t]+1||1,t in this._maxNamedEventsPerSecond?a=this.applyThrottle(this._singleEventInLastInterval[t],this._maxNamedEventsPerSecond[t],"MaxNamedEventsPerSecond",t):o(this._maxSingleEventPerSecond)&&(a=this.applyThrottle(this._singleEventInLastInterval[t],this._maxSingleEventPerSecond,"MaxSingleEventsPerSecond",t)),o(this._maxTotalEventsPerSecond)&&(this._totalEventsInLastInterval++,a&&(a=this.applyThrottle(this._totalEventsInLastInterval,this._maxTotalEventsPerSecond,"MaxTotalEventsPerSecond",t))),a},e.prototype.applyThrottle=function(e,t,a,n){return!(e>t&&(e===t+1&&this._telemetrySink&&!this._eventThrottleReported[n]&&(this._eventThrottleReported[n]=!0,this._telemetrySink.sendTelemetryEvent({eventName:d,telemetryProperties:{ariaTenantToken:r.a,nexusTenantToken:1723},eventFlags:{diagnosticLevel:110},dataFields:[Object(s.d)("SinkName",this._sinkName||""),Object(s.d)("ThrottledEvent.Name",n),Object(s.c)(a,t)]})),Object(i.b)(2,1,(),1))},e}(),l=a("svub"),h=a("oeGp");let u;class v{constructor(e){this.context=e,this.createOneDsSink=()=>{if(!u){u=new n.a([],{endpointUrl:this.getOneDsEndpointUrl()}),u.setFullEventsEnabled(!0);let e=new c("_",u);e.setSingleEventThrottle(100),e.setTotalEventThrottle(1e3),u.addPreprocessor(e),this.setPartADataFields(this.context)}return u},this.shutdown=this.setPartADataFields=this.getOneDsEndpointUrl=()=>{switch(this.audience){case"Automation":case"SyntheticTraffic":case"Local":case"Development":case"Staging":case"Dogfood":case"Preview":case"Microsoft":case"Production":case"GCC":return l.a.PUBLIC;case"GCC-High":return l.a.USGOV_DOJ;case"DoD":return l.a.USGOV_DOD;default:throw new Error("Unexpected audience value provided")}},this.audience=e.audience}getReleaseAudienceGroup(e){if(e)switch(e){case"Automation":case"SyntheticTraffic":case"Local":case"Development":case"Staging":case"Dogfood":case"Preview":case"Microsoft":case"Production":return e;case"GCC":case"GCC-High":case"DoD":return"Production"}}isGuidtermineIdentitySpace(e,t){return t||(this.isGuid(e)?"UserObjectId":this.isOrgIdPuid(e)?"OrgIdPuid":void 0)}addDataFieldIfNeeded(e,t,a){const n=Object(h.a)(a,t);n&&e.push(n)}extractPartADataFields(e){var t;const a=[];this.addDataFieldIfNeeded(a,"App.Platform",e.appPlatform||"Web"),this.addDataFieldIfNeeded(a,"App.Name",e.appName||"Fluid"),this.addDataFieldIfNeeded(a,"App.Version",e.appVersion),this.addDataFieldIfNeeded(a,"Release.AudienceGroup",this.getReleaseAudienceGroup(e.audience)),this.addDataFieldIfNeeded(a,"Session.Id",e.sessionId),this.addDataFieldIfNeeded(a,"Culture.UiLanguage",e.uiLanguage),this.addDataFieldIfNeeded(a,"User.IsAnonymous",!e.user),this.addDataFieldIfNeeded(a,"User.TenantId",null===(t=e.user)||void 0===t?void 0:t.tenantId),this.addDataFieldIfNeeded(a,"User.TenantGroup",e.user&&"Commercial");const n=e.user&&(e.user.id?e.user.id:e.user.oid);return this.addDataFieldIfNeeded(a,"User.PrimaryIdentityHash",n),this.addDataFieldIfNeeded(a,"User.PrimaryIdentitySpace",e.user&&this.determineIdentitySpace(n,e.user.userIdSpace)),a}}}}]);
//# sourceMappingURL=officeflonedssink.4a83b84ec1b86e4f9084.chunk.v7.js.map