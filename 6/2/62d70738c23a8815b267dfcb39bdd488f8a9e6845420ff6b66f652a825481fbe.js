"use strict";(self.webpackChunkreportEmbed=self.webpackChunkreportEmbed||[]).push([["map"],{7300:function(zt,yt,g){g.d(yt,{$_:function(){return u},Gj:function(){return r},J4:function(){return C},Lx:function(){return U},TY:function(){return N},Xy:function(){return c},aY:function(){return Z},b5:function(){return y},bq:function(){return d},e9:function(){return T},pL:function(){return lt},qV:function(){return ut},qh:function(){return j},rL:function(){return k},t6:function(){return s},up:function(){return M},w9:function(){return f}});var x=g(26514),Y=g(98801),E=g(38094),z=g(71485),D=g(49772),F=g(53543),I=g(8591),B=g(1849),tt=g(83527),b=g(8261),vt=g(44916),J=g(29925),H=g(20907),et=g(51912),bt=g(14253),Q=g(2570),k=60,ut=(0,J.CH)("tooltip-overlay"),U=.4,f=200,M={min:1,max:20};function d(){return{strokeWidth:F.Bj,lineJoin:tt.LS,style:b.SQ,markerProperties:(0,D.tp)(),shadeArea:!1,stepped:!1,lineChartType:vt.GE}}function r(L,A){void 0===A&&(A=!1);var at=Y.v.getThemeColor(L,Q.uQ),rt=(0,z.bT)({style:L,labelColor:at,textClassName:"smallLightLabel"}).fontProperties,w=(0,x.pi)((0,x.pi)({},rt),{show:!1,showByDefault:!0,position:B.d7,displayUnits:0,precision:Q.NZ,fontProperties:rt,titleFontProperties:rt,detailFontProperties:rt,labelDensity:Q.go,leaderLines:!1,minimumOffset:void 0,maximumOffset:void 0,bold:!1,italic:!1,underline:!1});return A?(w.enableBackground=!0,w.backgroundColor=Y.v.getThemeColor(L,et.U),w.backgroundTransparency=Q.r_):w.enableBackground=!1,w.enableValueDataLabel=!0,w.enableTitleDataLabel=!1,w.enableDetailDataLabel=!1,w.titleLabelDisplayUnits=0,w.titleLabelPrecision=Q.NZ,w.titleCustomFormatString=Q.M3,w.detailCustomFormatString=Q.M3,w.valueCustomFormatString=Q.M3,w.detailLabelDisplayUnits=0,w.detailLabelPrecision=Q.NZ,w.optimizeLabelDisplay=!1,w.labelContainerMaxWidth=f,w.labelContentLayout="SingleLine",w.horizontalAlignment="center",w.leaderLineStyle=Q.JA,w.leaderLineWidth=Q.Hj,w.leaderLineTransparency=Q.Xx,w}function s(L){var A=Y.v.getThemeColor(L,Q.uQ),at=(0,z.bT)({style:L,labelColor:A,textClassName:"smallLightLabel"}).fontProperties;return{show:!1,seriesColor:A,seriesPosition:I.F2,fontProperties:at,seriesWordWrap:!1,seriesMaximumWidth:20,defaultSeriesWidth:20,showLabelPerSeries:!1,enableBackground:!1,bold:!1,italic:!1,underline:!1}}function u(L,A){var at=1;if(A)for(var rt=A.length,w=0;w<rt;w++){var it=E.bN,W={text:A[w],fontFamily:L.family,fontSize:H.FP.fromPoint(L.size.pt),fontWeight:it.fontWeight},ht=bt.b.measureSvgTextWidth(W)+2*E.Bo;at=ht>at?ht:at}return at}function c(L){return _.some(L.anomalyDetections,}ction N(L,A,at,rt){var w=A(lt(L,at.data.isScalar));return j.convertSvgXToClientX(w,at.horizontalOffset,at.currentViewport.scale,rt)}function Z(L,A,at,rt){var w=A.xAxisProperties.scale,it=at.node().getBoundingClientRect().left,ot=_.find(L.data,;return Math.floor(N(ot,w,A,it))}var j={convertSvgXToClientX:function(A,at,rt,w){return(A+at)*rt+w},convertSvgYToClientY:;,82174:function(zt,yt,g){g.r(yt),g.d(yt,{Map:function(){return ei},callSafely:function(){return Me},mapsModule:function(){return Tt},timeoutWrapped:function(){return ne},unwrap:function(){return ai},wrap:function(){return Ie},wrappedSetInterval:function(){return de},wrappedSetTimeout:function(){return he}});var x=g(26514),Y=g(25963),E=g(51493),z=g(24640),D=g(98801),F=g(2570),I=g(79752),B=g(71485),tt=g(87810),b=g(20380),vt=g(95062),J=g(31499),H=g(70664),et=g(97628),bt=g(60990),Q=g(11799),k=g(15552),ut=g(57398),U=g(1010),f=g(84983),M=g(46824),d=g(71803),r=g(51033),s=g(69780),u=g(51467),c=g(77497),T=g(51912),C=g(23342),y=g(87941),N=g(49792),Z=g(21157),j=g(26691),lt=g(58012),L=g(6266),A=g(44900),at=g(90016),rt=g(96894),w=g(98129),it=g(48711),ot=g(61414),W=g(53543),ht=g(38094),wt=g(25150),Ct=g(44728),Lt=g(73644),Ft=g(14253),_t=g(32178),jt=g(69071),We=g(26526),Ge=function(){function o(t,e,i,a,n){void 0===e&&(e=!0),void 0===i&&(i=250),void 0===a&&(a=1700),void 0===n&&(n=100),this.callback=t,this.enabled=e,this.distanceFactor=i,this.timeFactor=a,this.sampleTime=n,this.points=[]}return o.prototype.addPoint=function(t,e){for(var i=this.points,a=Date.now();!(_.isEmpty(i)||a-i[0].timestamp<this.sampleTime);)i.shift();i.push({x:t,y:e,timestamp:a})},o.prototype.hasStarted=function(){return this.started},o.prototype.start=function(){var t=this;if(this.enabled&&!(this.points.length<=1)){this.started&&this.stop();var e=d3.easeCubicOut,i=_.last(this.points),a=_.head(this.points),h=i.timestamp-a.timestamp,p=(i.x-a.x)/h,v=(i.y-a.y)/h,m=window.distanceFactor||this.distanceFactor,S=p*m,O=v*m,R=Math.sqrt(Math.pow(p,2)+Math.pow(v,2))*window.timeFactor||this.timeFactor,V=0,G=0;this.started=!0;var nt=d3.timer(function(pt){if(t.stopRequested)t.clearState(),nt.stop();else{var K=Math.min(1,1*pt/R),dt=e(K),X=dt*S-V,st=dt*O-G;V+=X,G+=st,t.callback&&(Math.abs(X)>0||Math.abs(st)>0)&&t.callback(X,st),pt>R&&(t.clearState(),nt.stop())}})}},o.prototype.stop=o.prototype.clearState=o}(),Ue=g(29925),Fe=function(){function o(t,e,i){void 0===i&&(i=!0),this.mapControl=t,this.tooltipService=e,this.inertia=new Ge(null,i),this.inertia.callback=return o.prototype.onMouseDown=function(t){var e=this,a=this.getMousePosition(),n=d3.select(t),l=!1,h=0,p=this.inertia;p.hasStarted()&&p.stop();var v=d3.select(window).on(o.Events.mouseMove,function(){var m=e.getMousePosition(),S=o.getDelta(a,m),O=S[0],R=S[1];l||(h+=Math.abs(O)+Math.abs(R))>o.DragPixelThreshold&&(l=!0,n.classed(o.DraggingCSS.class,!0),e.tooltipService.hide()),p.addPoint(m[0],m[1]),(0,b.M_)(e.mapControl,O,R),a=m}).on(o.Events.mouseup,function(){if(v.on(o.Events.mouseMove,null).on(o.Events.mouseup,null),l){var m=e.getMousePosition();p.addPoint(m[0],m[1]),n.classed(o.DraggingCSS.class,!1);var S=d3.event;S.target===n.node()&&n.on(o.Events.click,function(){(0,We.n)(S),n.on(o.Events.click,null)}),p.start()}})},o.prototype.getMousePosition=function(){var t=o.BodyNode=o.BodyNode||d3.select("body").node();return d3.mouse(t)},o.getDelta=o.DragPixelThreshold=5,o.Events={mouseDown:"mousedown.mapDrag",mouseMove:"mousemove.mapDrag",mouseup:"mouseup.mapDrag",click:"click.mapDrag"},o.DraggingCSS=(0,Ue.CH)("dragging-cursor"),o}(),Ze=function(){eturn o.prototype.init=function(t,e,i,a,n,l,h,p){this.host=h,this.mapControl=t,this.eventManager=p,this.pointLabelText=this.host.getLocalizedString("Generic_Point");var v=this.root=d3.select(e[0]);v.attr("drag-resize-disabled","true").style("display","inline-block").attr("tabindex",-1).attr("focusable",!1);var m=_t.M.isInternetExplorerOrEdge(),S=this.svg=v.append("svg").style("position","absolute").style("pointer-events","none").classed(b.nv,!m);l&&S.attr("tabindex",0).attr("focusable",!0).attr("aria-label",h.getLocalizedString("Visual_Plot")).attr("focus-nav-mode","Hierarchy").attr("aria-multiselectable","true").attr("role","listbox").classed(W.Pg,!m),i&&(this.clearCapture=v),this.bubbleGraphicsContext=S.append("g").classed("mapBubbles",!0),this.sliceGraphicsContext=S.append("g").classed("mapSlices",!0),this.labelBackgroundGraphicsContext=S.append("g").classed(F.u9.class,!0),this.labelGraphicsContext=S.append("g").classed(F.ZL.class,!0),this.sliceLayout=d3.pie().value(function(O){return O.value}),this.arc=d3.arc(),this.style=n,this.clearMaxDataPointRadius(),this.dataLabelsSettings=(0,b.BP)(this.style),this.tooltipService=a},o.prototype.clearHeatMap=function(){this.mapControl&&this.mapControl.layers.clear(),this.heatMapLayer&&(this.heatMapLayer.clear(),this.heatMapLayer.dispose(),this.heatMapLayer=void 0)},o.prototype.setData=function(t){this.mapData=t},o.prototype.clearDataPoints=function(){this.style&&(this.mapData=(0,b.IG)(this.style),this.clearHeatMap())},o.prototype.hideDataPoints=function(){this.svg.style("display","none")},o.prototype.showDataPoints=function(){this.svg.style("display","")},o.prototype.getDataPointCount=function(){return this.mapData?_.filter(this.mapData.dataPoints,function(t){return!!t.location}).length:0},o.prototype.getDataPointPadding=o.prototype.clearMaxDataPointRadius=function(){this.maxDataPointRadius=0},o.prototype.setMaxDataPointRadius=o.prototype.converter=function(t,e,i,a){void 0===a&&(a=!0);var n=this.mapControl,l=t.width/2,h=t.height/2;this.dataLabelsSettings=e;var v=Math.min(t.width,t.height)/384;this.clearMaxDataPointRadius();var m=[],S=[],O=this.mapData?this.mapData.dataPoints:[],R=this.mapData&&this.mapData.hasSize;this.navigableDataPoints=void 0;for(var V=0,G=O.length;V<G;V++){var nt=O[V],pt=nt.categoryValue,K=nt.location;if(K){if((0,b.N2)(K,!0))continue;var dt=n.tryLocationToPixel(new Microsoft.Maps.Location(K.latitude,K.longitude));if(!dt){y.fF.assertFail("tryLocationToPixel failed with the following location: "+JSON.stringify(K));continue}var X=dt.x+l,st=dt.y+h,P=nt.radius*v;this.setMaxDataPointRadius(P);var ft=nt.subDataPoints,Vt=ft.length;if(1===Vt)m.push({x:X,y:st,labeltext:pt,radius:P,fill:(gt=ft[0]).fill,stroke:gt.stroke,strokeWidth:1,tooltipInfo:gt.tooltipInfo,identity:gt.identity,selected:!1,labelFill:e.fontProperties.color,categoryIndex:V,seriesIndex:gt.seriesIndex});else{for(var Et=[],Ot=0;Ot<Vt;Ot++){var gt;y.fF.assertValue(gt=ft[Ot],"Map's subdataPoint array should not be sparse."),Et.push({x:X,y:st,labeltext:pt,radius:P,fill:gt.fill,stroke:gt.stroke,strokeWidth:1,value:R?gt.value:1,tooltipInfo:gt.tooltipInfo,identity:gt.identity,selected:!1,labelFill:e.fontProperties.color,categoryIndex:V,seriesIndex:gt.seriesIndex})}i&&i.applySelectionStateToData(Et),S.push(Et)}}}return i&&i.applySelectionStateToData(m),{bubbleData:m,sliceData:S}},o.prototype.updateInternal=function(t,e,i,a,n,l){return y.fF.assertValue(e,"viewport"),this.mapRendererData=t,this.svg&&this.svg.style("width",e.width.toString()+"px").style("height",e.height.toString()+"px"),this.mapData&&this.mapData.properties.showHeatMap?this.renderHeatMapLayer(t):this.render(t,e,i,a,n)},o.getHeatMapLocations=function(t,e){var i=[],a=!1,n=_.filter(t,function(G){return null!=G.value});if(!_.isEmpty(n)){var l=_.map(n,function(G){return G.value}),h=_.min(l),v=_.max(l)-h;if(v>0){e.intensity=.1;for(var m=_.map(n,function(G){return Math.round((G.value-h)/v*9+1)}),S=0;S<n.length;S++)for(var O=n[S],R=m[S],V=0;V<R;V++)i.push(new Microsoft.Maps.Location(O.location.latitude,O.location.longitude));a=!0}}return a||(i=_.map(t,function(G){return new Microsoft.Maps.Location(G.location.latitude,G.location.longitude)})),i},o.prototype.getPlotAreaLassoSurface=function(){return this.svg},o.prototype.renderHeatMapLayer=function(t){var i,e=this;this.hideDataPoints(),this.mapData.properties.heatMapOptions&&((i=_.clone(this.mapData.properties.heatMapOptions)).intensity=.5);var a=_.filter(this.mapData.dataPoints,,n=o.getHeatMapLocations(a,i);return Microsoft.Maps.loadModule("Microsoft.Maps.HeatMap",function(){e.heatMapLayer?(e.heatMapLayer.clear(),e.heatMapLayer.setLocations(n),e.heatMapLayer.setOptions(i)):(e.heatMapLayer=new Microsoft.Maps.HeatMapLayer(n,i),e.mapControl.layers.insert(e.heatMapLayer))}),{bubbleEventGroup:this.bubbleGraphicsContext,sliceEventGroup:this.sliceGraphicsContext,bubbles:null,slices:null,clearCapture:this.clearCapture,dataPoints:null,root:this.root,navigationEntry:this.clearCapture&&this.clearCapture[0]?this.clearCapture[0][0]:null,visualInstanceId:this.host.instanceId,eventManager:this.eventManager,hostServices:this.host}},o.prototype.render=function(t,e,i,a,n){var l=this.arc,h=a&&a.hasSelection(),p=_t.M.isInternetExplorerOrEdge();this.heatMapLayer&&this.heatMapLayer.clear(),this.showDataPoints();var v=this.bubbleGraphicsContext.selectAll(".bubble").data(t.bubbleData,,m=new Fe(this.mapControl,this.tooltipService),S=v.enter().append("circle").classed("bubble",!0).merge(v);S.classed(W.Pg,!p&&!!a).attr("cx",function(P){return P.x}).attr("cy",function(P){return P.y}).attr("r",function(P){return P.radius}).attr("tabindex",a?0:null).attr("focusable",!!a).attr("aria-selected",function(P){return P.selected}).attr("role","option").attr("aria-label",this.pointLabelText).style("fill",function(P){return P.fill}).style("stroke",function(P){return P.stroke}).style("fill-opacity",function(P){return(0,W.eR)(P.selected,!1,h,!1)}).style("strokeWidth",function(P){return P.strokeWidth}).style("stroke-opacity",function(P){return(0,W.eR)(P.selected,!1,h,!1)}).on("mousedown.drag",function(){return m.onMouseDown(d3.event.target)}),v.exit().remove(),this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.bubbleGraphicsContext,function(P){return y.fF.assertValue(P.data,"Bubble map data for tooltip"),P.data&&P.data.tooltipInfo},function(P){return P.data&&P.data.identity&&[P.data.identity]}),S.style("pointer-events","all"));var O=t.sliceData,R=this.sliceGraphicsContext.selectAll(".sliceContainer").data(O),V=R.enter().append("g").classed("sliceContainer",!0).merge(R);R.exit().remove();var G=this.sliceLayout,nt=V.selectAll(".slice").data(,pt=nt.enter().append("path").classed("slice",!0).merge(nt);pt.classed(W.Pg,!p&&!!a).style("fill",function(P){return P.data.fill}).style("fill-opacity",function(P){return(0,W.eR)(P.data.selected,!1,h,!1)}).style("stroke",function(P){return P.data.stroke}).style("strokeWidth",function(P){return P.data.strokeWidth}).style("stroke-opacity",function(P){return(0,W.eR)(P.data.selected,!1,h,!1)}).style("cursor","default").attr("transform",.attr("d",function(P){return l.innerRadius(0).outerRadius(function(ft){return ft.data.radius})(P)}).attr("tabindex",a?0:null).attr("focusable",!!a).on("mousedown.drag",function(){return m.onMouseDown(d3.event.target)}),nt.exit().remove(),this.updateInternalDataLabels(e,n),this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.sliceGraphicsContext,function(P){return y.fF.assertValue(P.data,"Bubble map slice data for tooltip"),P.data&&P.data.data&&P.data.data.tooltipInfo},function(P){return P.data&&P.data.data&&[P.data.data.identity]}),pt.style("pointer-events","all"));for(var K=t.bubbleData.slice(),dt=0,X=O.length;dt<X;dt++)K.push.apply(K,O[dt]);return{root:this.root,bubbleEventGroup:this.bubbleGraphicsContext,sliceEventGroup:this.sliceGraphicsContext,bubbles:_.isEmpty(t.bubbleData)?null:S,slices:_.isEmpty(t.sliceData)?null:pt,clearCapture:this.clearCapture,dataPoints:K,navigationEntry:this.clearCapture&&this.clearCapture[0]?this.clearCapture[0][0]:null,visualInstanceId:this.host.instanceId,hitTester:new je({dataPoints:K}),eventManager:this.eventManager,hostServices:this.host}},o.prototype.updateInternalDataLabels=function(t,e){var i=this.dataLabelsSettings,a=[];if(i&&(i.show||i.showCategory)){var n=this.createLabelDataPoints();a=new Ct.nu({maximumOffset:F.wh,startingOffset:F.ki}).layout([{labelDataPoints:n,maxNumberOfLabels:n.length}],{width:t.width,height:t.height})}(0,ht.gm)({labelContext:this.labelGraphicsContext,dataLabels:a,backgroundContext:this.labelBackgroundGraphicsContext,numeric:!1,formatMode:!1,onObject:!1})},o.prototype.createLabelDataPoints=function(){var t=this.mapRendererData,e=[],i=t.bubbleData;i=i.concat(_.map(t.sliceData,);for(var a=this.dataLabelsSettings,n=D.v.getThemeColor(this.style,F.pl),l=0,h=i;l<h.length;l++){var p=h[l];y.fF.assertValue(p,"dataPoint should never be null/undefined");var v=p.labeltext,m=a.fontProperties,S=(0,tt.qk)(m,v),O=Ft.b.measureSvgTextWidth(S),R=Ft.b.estimateSvgTextHeight(S);e.push({isPreferred:!0,text:v,textSize:{width:O,height:R},outsideFill:m.color?m.color:n,insideFill:m.color?m.color:n,parentType:0,parentShape:{point:{x:p.x,y:p.y},radius:p.radius,validPositions:o.validLabelPositions},fontProperties:m,identity:void 0,hasBackground:a.enableBackground,backgroundColor:a.backgroundColor,backgroundTransparency:a.backgroundTransparency})}return e},o.prototype.getNavigationOptions=function(){return{helper:this,navigationStrategy:this.navigationStrategy}},o.prototype.getFirstElement=function(){this.navigableDataPoints=this.flattenViewModel();var t=_.find(this.navigableDataPoints,function(e){return!!e});return{element:this.getHtmlElementFromDataPoint(t)}},o.prototype.getNextDataPoint=function(t,e,i){_.isEmpty(this.navigableDataPoints)&&(this.navigableDataPoints=this.flattenViewModel());var a=(0,wt.R)(this.navigableDataPoints,t,e,k.jN.CategoryFirst,i);return{element:this.getHtmlElementFromDataPoint(a)}},o.prototype.flattenViewModel=function(){var t=[];if(this.mapRendererData.bubbleData&&!_.isEmpty(this.mapRendererData.bubbleData)){for(var e=0,i=this.mapRendererData.bubbleData;e<i.length;e++){var a=i[e];t.push({categoryIndex:a.categoryIndex,seriesIndex:a.seriesIndex})}return t}if(this.mapRendererData.sliceData&&!_.isEmpty(this.mapRendererData.sliceData)){for(var n=0,l=this.mapRendererData.sliceData;n<l.length;n++)for(var p=0,v=l[n];p<v.length;p++){var m=v[p];t.push({categoryIndex:m.categoryIndex,seriesIndex:m.seriesIndex})}return t}},o.prototype.getHtmlElementFromDataPoint=function(t){return this.bubbleGraphicsContext.selectAll(".bubble").filter(function(l){return l.seriesIndex===t.seriesIndex&&l.categoryIndex===t.categoryIndex}).node()||this.sliceGraphicsContext.selectAll(".slice").filter(.node()||(y.fF.assertFail("An html element couldn't be found for the given data point in MapBubbleDataPointRenderer.getHtmlElementFromDataPoint()."),null)},o.validLabelPositions=[1,2,4,8],o}(),je=function(){eturn o.prototype.queryRegion=function(t){return _.filter(this.dataPoints,},o}(),Ke=g(99450),xt=g(11051),Qe=function(){function o(){}return o.prototype.layout=function(t,e,i,a){var n=_.map(t,function(st){return{labelDataPoint:st}});if(a||void 0===this.labels){for(var l={labelDataPoints:n,maxNumberOfLabels:n.length},h=0,p=n;h<p.length;h++){var v=p[h];v.labelSize={width:(m=v.labelDataPoint).textSize.width+2*F.Bo,height:m.textSize.height+2*F.d1}}for(var S=new Ct.qC([l],e),O=[],R=[],V=0,G=t;V<G.length;V++){var nt=(m=G[V]).parentShape.polygon;R.push(nt),nt.pixelBoundingRect=i.applyToRect(nt.absoluteBoundingRect())}for(var pt=new $e(R,e),K=0,dt=t;K<dt.length;K++){var m,X=this.getLabelByPolygonPositions(m=dt[K],i,S,pt);null!=X&&O.push(X)}this.labels=O}else this.updateLabelOffsets(i);return _.filter(this.labels,function(st){return st.isVisible})},o.prototype.getLabelPolygon=function(t,e,i,a){return this.getLabelBoundingBox({width:t.textSize.width,height:t.textSize.height},e,i,a)},o.prototype.getLabelBoundingBox=function(t,e,i,a){switch(e){case 1:return(0,xt.aE)(t,i,a);case 2:return(0,xt.B2)(t,i,a);case 4:return(0,xt.t$)(t,i,a);case 8:return(0,xt.F2)(t,i,a);case 128:return(0,xt.Q$)(t,i,a);case 64:return(0,xt.kx)(t,i,a);case 32:return(0,xt.I6)(t,i,a);case 16:return(0,xt.W7)(t,i,a);case 256:return(0,xt.be)(t,i);default:y.fF.assertFail("Unsupported label position")}return null},o.prototype.getLabelByPolygonPositions=function(t,e,i,a){for(var n=0,l=e.getInverse(),h=0;h<2;h++){1===h&&(n=5);for(var p=0,v=t.parentShape.validPositions;p<v.length;p++){var S=this.tryPositionForPolygonPosition(m=v[p],t,e,n,l);if((256!==m||0===h)&&S){var O=e.applyToRect(S);return{text:t.text,secondRowText:t.secondRowText,boundingBox:O,isVisible:!0,fontProperties:{color:t.insideFill},identity:null,selected:!1,hasBackground:!0,textAnchor:"middle",originalPixelOffset:n,isPlacedInsidePolygon:!0,absoluteBoundingBoxCenter:{x:S.left+S.width/2,y:S.top+S.height/2}}}}}for(var V=6;V<=60;){for(var G=0,nt=t.parentShape.validPositions;G<nt.length;G++){var m;if(256!==(m=nt[G])){var pt=t.parentShape.polygon,K=e.applyToPoint(pt.absoluteCentroid()),dt=this.tryPlaceLabelOutsidePolygon(i,m,t,V,K,a,l);if(dt){O=e.applyToRect(dt);var R={text:t.text,secondRowText:t.secondRowText,boundingBox:O,isVisible:!0,fontProperties:{color:t.insideFill},identity:null,selected:!1,hasBackground:!0,isPlacedInsidePolygon:!1,textAnchor:"middle",originalPixelOffset:V,originalPosition:m,originalAbsoluteCentroid:pt.absoluteCentroid(),absoluteBoundingBoxCenter:{x:dt.left+dt.width/2,y:dt.top+dt.height/2}},X=this.calculateStemSource(e,l,pt,O,m,K);return R.leaderLinePoints=this.setLeaderLinePoints(X,this.calculateStemDestination(O,m)),R.absoluteStemSource=l.applyToPoint(X),i.add(O),R}}}V+=10}return null},o.prototype.setLeaderLinePoints=function(t,e){return[[t.x,t.y],[e.x,e.y]]},o.prototype.calculateStemSource=function(t,e,i,a,n,l){var h=i.lineIntersectionPoint(i.absoluteCentroid(),e.applyToPoint({x:a.left+a.width/2,y:a.top+a.height/2}));if(null==h)return l;var p=t.applyToPoint(h);switch(n){case 1:p.y+=5;break;case 2:p.y-=5;break;case 4:p.x+=5;break;case 8:p.x-=5;break;case 128:p.x+=5/xt.nK,p.y+=5/xt.fB;break;case 64:p.x-=5/xt.nK,p.y+=5/xt.fB;break;case 32:p.x+=5/xt.nK,p.y-=5/xt.fB;break;case 16:p.x-=5/xt.nK,p.y-=5/xt.fB;break;case 256:break;default:y.fF.assertFail("Unsupported label position")}return p},o.prototype.calculateStemDestination=function(t,e){var i,a;switch(e){case 1:i=t.left+t.width/2,a=t.top+t.height;break;case 2:i=t.left+t.width/2,a=t.top;break;case 4:i=t.left+t.width,a=t.top+t.height/2;break;case 8:i=t.left,a=t.top+t.height/2;break;case 128:i=t.left+t.width,a=t.top+t.height;break;case 64:i=t.left,a=t.top+t.height;break;case 32:i=t.left+t.width,a=t.top;break;case 16:i=t.left,a=t.top;break;case 256:break;default:y.fF.assertFail("Unsupported label position")}return{x:i,y:a}},o.prototype.tryPositionForPolygonPosition=function(t,e,i,a,n){var l=e.parentShape.polygon,h=i.applyToPoint(l.absoluteCentroid()),p=this.getLabelPolygon(e,t,h,a),v=this.getAbsoluteRectangle(n,p);return l.contains(v)?v:null},o.prototype.tryPlaceLabelOutsidePolygon=function(t,e,i,a,n,l,h){var v=this.getLabelPolygon(i,e,n,a);if(!t.hasConflict(v)){var S=this.getAbsoluteRectangle(h,v);if(!l.hasConflict(S,v))return S}return null},o.prototype.updateLabelOffsets=function(t){for(var e=0,i=this.labels;e<i.length;e++){var a=i[e];if(a.isVisible)if(a.isPlacedInsidePolygon){var n=t.applyToPoint(a.absoluteBoundingBoxCenter),l=a.boundingBox.left+a.boundingBox.width/2-n.x;a.boundingBox.top-=a.boundingBox.top+a.boundingBox.height/2-n.y,a.boundingBox.left-=l}else{var p=t.applyToPoint(a.absoluteStemSource),v=t.applyToPoint(a.originalAbsoluteCentroid);a.boundingBox=this.getLabelBoundingBox({width:a.boundingBox.width,height:a.boundingBox.height},a.originalPosition,v,a.originalPixelOffset),void 0!==a.leaderLinePoints&&(a.leaderLinePoints=this.setLeaderLinePoints(p,this.calculateStemDestination(a.boundingBox,a.originalPosition)))}}},o.prototype.getAbsoluteRectangle=o}(),$e=function(){function o(t,e){for(var i=0,a=0,n=0,l=t;n<l.length;n++){var p=l[n].pixelBoundingRect;p.width>i&&(i=p.width),p.height>a&&(a=p.height)}0===i&&(i=e.width),0===a&&(a=e.height);var v=this.cellSize={width:i*o.cellSizeMultiplier,height:a*o.cellSizeMultiplier};this.columnCount=o.getCellCount(v.width,e.width,1,100),this.rowCount=o.getCellCount(v.height,e.height,1,100);for(var m=[],S=0,O=this.columnCount;S<O;S++){m[S]=[];for(var R=0,V=this.rowCount;R<V;R++)m[S][R]=[]}this.grid=m;for(var G=0,nt=t;G<nt.length;G++)this.add(nt[G])}return o.prototype.hasConflict=function(t,e){for(var i=this.getContainingGridSubsection(e),a=this.grid,n=i.xMin;n<i.xMax;n++)for(var l=i.yMin;l<i.yMax;l++)for(var h=0,p=a[n][l];h<p.length;h++)if(p[h].conflicts(t))return!0;return!1},o.prototype.add=function(t){for(var e=this.getContainingGridSubsection(t.pixelBoundingRect),i=e.xMin;i<e.xMax;i++)for(var a=e.yMin;a<e.yMax;a++)this.grid[i][a].push(t)},o.prototype.getContainingGridSubsection=function(t){return{xMin:o.bound(Math.floor(t.left/this.cellSize.width),0,this.columnCount),xMax:o.bound(Math.ceil((t.left+t.width)/this.cellSize.width),0,this.columnCount),yMin:o.bound(Math.floor(t.top/this.cellSize.height),0,this.rowCount),yMax:o.bound(Math.ceil((t.top+t.height)/this.cellSize.height),0,this.rowCount)}},o.getCellCount=function(t,e,i,a){return o.bound(Math.ceil(e/t),i,a)},o.bound=function(t,e,i){return Math.max(Math.min(t,i),e)},o.cellSizeMultiplier=2,o}();function Ve(o,t,e,i){y.fF.assert(function(){return 8===e.length},"Array length should be 8 to match a rectangular shape"),y.fF.assert("Array length should be 8 to match a rectangular shape");for(var a=!0,n=[o.left,o.right],l=[o.top,o.bottom],p=0;p<n.length;p++)for(var v=0;v<l.length;v++)t(n[p],l[(V=p,G=v,0===V?G:1-G)],4*p+2*v,e,i)||(a=!1);var V,G;return a}function Re(o){var t=new Float64Array(8);return Ve(o,function(a,n,l,h){return h[l]=a,h[l+1]=n,!0},t),new Lt.m(t)}var Ne=function(){eturn o.buildPaths=function(t){var e=[];if(!_.isEmpty(t))for(var i=0,a=t;i<a.length;i++){var n=a[i],l=n.geographic;l&&l.length>2&&e.push(n)}return e},o.prototype.init=function(t,e,i,a,n,l,h,p){this.host=h,this.mapControl=t,this.polygonInfo=new b.n9;var v=_t.M.isInternetExplorerOrEdge();this.eventManager=p,this.pointLabelText=this.host.getLocalizedString("Generic_Point");var m=this.root=d3.select(e[0]);m.attr("drag-resize-disabled","true").attr("tabindex",-1).attr("focusable",!1);var S=this.svg=m.append("svg").style("position","absolute").style("pointer-events","none").classed(b.nv,!v);l&&S.attr("tabindex",0).attr("focusable",!0).attr("aria-label",h.getLocalizedString("Visual_Plot")).attr("focus-nav-mode","Hierarchy").attr("aria-multiselectable","true").attr("role","listbox").classed(W.Pg,!v),i&&(this.clearCapture=m),this.shapeGraphicsContext=S.append("g").classed("mapShapes",!0),this.labelGraphicsContext=S.append("g").classed(F.ZL.class,!0),this.style=n,this.clearMaxShapeDimension(),this.dataLabelsSettings=(0,b.BP)(this.style),this.tooltipService=a},o.prototype.setData=o.prototype.clearDataPoints=function(){this.style&&(this.mapData=(0,b.IG)(this.style))},o.prototype.hideDataPoints=function(){this.svg.style("display","none")},o.prototype.showDataPoints=o.prototype.getDataPointCount=function(){return this.mapData?_.filter(this.mapData.dataPoints,.length:0},o.prototype.converter=function(t,e,i,a,n){if(void 0===a&&(a=!0),void 0===n&&(n=!0),!n&&this.mapRendererData)return this.mapRendererData;this.navigableDataPoints=void 0,this.clearMaxShapeDimension(),this.dataLabelsSettings=e;for(var h=[],p=this.mapData?this.mapData.dataPoints:[],v=0,m=p.length;v<m;v++){var S=p[v],O=S.subDataPoints[0],R=S.paths;if(!_.isEmpty(R)){for(var V=S.value,G=S.categoryValue,nt=O.identity,pt=nt.getKey(),K=void 0,dt=void 0,X=R.length;X-- >0;){var st=R[X];if(st&&st.absoluteBounds){this.setMaxShapeDimension(st.absoluteBounds.width,st.absoluteBounds.height);var P={left:st.absoluteBounds.left,top:st.absoluteBounds.top,right:st.absoluteBounds.left+st.absoluteBounds.width,bottom:st.absoluteBounds.top+st.absoluteBounds.height};K?(P.left<K.left&&(K.left=P.left),P.top<K.top&&(K.top=P.top),P.right>K.right&&(K.right=P.right),P.bottom>K.bottom&&(K.bottom=P.bottom)):(K={left:P.left,top:P.top,right:P.right,bottom:P.bottom},dt=[]),dt.push({boundingRect:P,path:st.absolute})}else y.fF.assertFail("MapShapeRenderer.converter encountered an invalid path"),R.splice(X,1)}if(_.isEmpty(R))continue;var ft=R[o.getIndexOfLargestShape(R)].absolute,Vt=_.map(R,.join(" "),gt=void 0;this.mapData.properties.showStroke&&(gt=_.map(R,.join(" ")),h.push({mainShapePointArray:ft,path:Vt,reducedPath:gt,fill:O.fill,stroke:O.stroke,strokeWidth:1,tooltipInfo:O.tooltipInfo,identity:nt,selected:!1,key:JSON.stringify({id:pt}),labeltext:G,catagoryLabeltext:null!=V?V.toString():void 0,categoryIndex:v,seriesIndex:O.seriesIndex,absoluteCenter:{x:(K.left+K.right)/2,y:(K.top+K.bottom)/2},globalBoundingRect:K,pathsWithBounds:dt})}}return i&&i.applySelectionStateToData(h),{shapeData:h}},o.prototype.useReducedPaths=function(t){return this.mapData.properties.showStroke&&t<o.ReducedPathScaleLimit},o.prototype.updateInternal=function(t,e,i,a,n,l){y.fF.assertValue(e,"viewport"),this.mapRendererData=t,this.svg&&this.svg.style("width",e.width.toString()+"px").style("height",e.height.toString()+"px"),this.polygonInfo.reCalc(this.mapControl,e.width,e.height);var h=this.polygonInfo.scale,p=this.polygonInfo.transform,v=(0,b.oT)(),m=p,S=v,O=this.useReducedPaths(h);if(O){var R=_.clone(m.matrix);R.m00=R.m11=h/o.ReducedPathScale,m=new Ke.wx(R),S=(0,b.x6)(o.ReducedPathZoomLevel)}this.shapeGraphicsContext.attr("transform",this.polygonInfo.transformToString(m));var V=function(mt,Nt,At){return mt?-At:Nt?At:0},G=e.width/2,nt=function(mt,Nt,At){var Ut=p.applyToPoint(mt.absoluteCenter),Zt=p.applyToPoint({x:mt.absoluteCenter.x-Nt,y:mt.absoluteCenter.y}),Wt=p.applyToPoint({x:mt.absoluteCenter.x+Nt,y:mt.absoluteCenter.y}),Kt=Math.abs(Ut.x-G),Xt=Math.abs(Zt.x-G),Gt=Math.abs(Wt.x-G);return V(Xt<Kt,Gt<Kt,At)},pt=this.shapeGraphicsContext.selectAll("path").data(t.shapeData,function(ct){return ct.key}).style("transform",function(ct){return"translateX(".concat(nt(ct,v,S),"px)")}),K=O?function(ct){return ct.reducedPath}:function(ct){return ct.path},dt=new Fe(this.mapControl,this.tooltipService),X=pt.enter().append("path").classed("shape",!0).attr("aria-selected",function(ct){return ct.selected}).attr("role","option").attr("aria-label",this.pointLabelText).attr("d",K).on("mousedown.drag",.merge(pt),st=O?h/o.ReducedPathScale:this.polygonInfo.scale,P=a&&a.hasSelection();X.classed(W.Pg,!!a).attr("tabindex",a?0:null).attr("focusable",!!a).style("fill",function(ct){return ct.fill}).style("fill-opacity",function(ct){return(0,W.eR)(ct.selected,!1,P,!1)}).style("outline-width","".concat(1/st,"px"));var gt,St,ft=this.mapData.properties.strokeColor,Vt=this.mapData.properties.strokeWidth;this.style.isHighContrast?(gt=function(mt){return mt.stroke},St=:this.mapData.properties.showStroke?(gt=St=function(mt){return(Vt||mt.strokeWidth)/st}):(gt=null,St=null),X.style("stroke",gt).style("stroke-width",St),(i||this.lastRenderUsedReducedPaths!==O)&&X.attr("d",K),this.lastRenderUsedReducedPaths=O,pt.exit().remove(),this.updateInternalDataLabels(e,n);var Ot=new qe({absMapSize:v,applyOffset:V,dataPoints:t.shapeData,mapControl:this.mapControl,offset:S,transform:m,translateX:nt,viewport:e});if(i)return this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.shapeGraphicsContext,function(ct){return y.fF.assertValue(ct.data,"Filled map data for tooltip"),ct.data&&ct.data.tooltipInfo},function(ct){return ct.data&&ct.data.identity&&[ct.data.identity]}),X.style("pointer-events","all")),{root:this.root,shapeEventGroup:this.shapeGraphicsContext,shapes:X,clearCapture:this.clearCapture,dataPoints:t.shapeData,navigationEntry:this.clearCapture&&this.clearCapture[0]?this.clearCapture[0][0]:null,visualInstanceId:this.host.instanceId,hitTester:Ot,eventManager:this.eventManager,hostServices:this.host,widthDivisor:st};l&&l.bindHitTester(Ot)},o.prototype.getDataPointPadding=o.prototype.getEnclosingBounds=function(){var t,e=this.mapData&&this.mapData.dataPoints;if(!_.isEmpty(e))for(var i=0,a=e;i<a.length;i++){var l=a[i].paths;if(!_.isEmpty(l))for(var h=0,p=l;h<p.length;h++){var v=p[h];v.geographic&&(t=(0,b.wu)(t,v.adjustedBounds))}}return t},o.getIndexOfLargestShape=function(t){for(var e=0,i=0,a=0,n=t.length;a<n;a++){var h=new Lt.m(t[a].absolute),p=Math.abs(Lt.m.calculateAbsolutePolygonArea(h.polygonPoints));p>i&&(e=a,i=p)}return e},o.prototype.updateInternalDataLabels=function(t,e){var i=this.dataLabelsSettings,a=[];if(i&&(i.show||i.showCategory)){var n=this.createLabelDataPoints();void 0===this.labelLayout&&(this.labelLayout=new Qe),a=this.labelLayout.layout(n,{width:t.width,height:t.height},this.polygonInfo.transform,e)}this.drawLabelStems(this.labelGraphicsContext,a,i.show,i.showCategory),(0,ht.ng)({context:this.labelGraphicsContext,dataLabels:a,onObject:!1}),(0,ht.x5)({labelContext:this.labelGraphicsContext,dataLabels:a,twoRows:i.show&&i.showCategory,formatMode:!1,onObject:!1})},o.prototype.getPlotAreaLassoSurface=o.prototype.clearMaxShapeDimension=o.prototype.setMaxShapeDimension=function(t,e){this.maxShapeDimension=Math.max(t,this.maxShapeDimension),this.maxShapeDimension=Math.max(e,this.maxShapeDimension)},o.prototype.createLabelDataPoints=function(){var e=[];if(this.filledMapDataLabelsEnabled)for(var a=this.dataLabelsSettings,n=0,l=this.mapRendererData.shapeData;n<l.length;n++){var h=l[n],p=void 0,v=void 0,m=0,S=!1;if(this.dataLabelsSettings.show&&!this.dataLabelsSettings.showCategory){if(void 0===(p=h.catagoryLabeltext))continue}else if(this.dataLabelsSettings.showCategory&&!this.dataLabelsSettings.show){if(void 0===(p=h.labeltext))continue}else if(this.dataLabelsSettings.showCategory&&this.dataLabelsSettings.show){if(v=h.labeltext,void 0===(p=h.catagoryLabeltext)&&void 0===v)continue;S=!0}var O=(0,B.bT)({style:this.style,textClassName:"smallLightLabel",noColor:!0}).fontProperties;if(S){var R=(0,tt.qk)(O,v);m=Ft.b.measureSvgTextWidth(R)}var V=(0,tt.qk)(O,p),G=Ft.b.measureSvgTextWidth(V),nt=Ft.b.estimateSvgTextHeight(V);v&&void 0!==h.labeltext&&void 0!==h.catagoryLabeltext&&(nt*=2);var pt=D.v.getThemeColor(this.style,F.pl),K={parentType:2,parentShape:{polygon:new Lt.m(h.mainShapePointArray),validPositions:o.validLabelPolygonPositions},text:p,secondRowText:v,textSize:{width:Math.max(G,m),height:nt},insideFill:a.fontProperties.color,outsideFill:a.fontProperties.color?a.fontProperties.color:pt,isPreferred:!1,identity:void 0,hasBackground:!0,fontProperties:a.fontProperties};e.push(K)}return e},o.prototype.drawLabelStems=function(t,e,i,a){var l=D.v.getThemeColor(this.style,b.jj);(0,ht.z8)(t,e,function(p,v){return p.identity?p.identity.getKeyWithoutHighlight():v},l)},o.prototype.getNavigationOptions=o.prototype.getFirstElement=function(){this.navigableDataPoints=this.flattenViewModel();var t=_.find(this.navigableDataPoints,;return{element:this.getHtmlElementFromDataPoint(t)}},o.prototype.getNextDataPoint=function(t,e,i){_.isEmpty(this.navigableDataPoints)&&(this.navigableDataPoints=this.flattenViewModel());var a=(0,wt.R)(this.navigableDataPoints,t,e,k.jN.CategoryFirst,i);return{element:this.getHtmlElementFromDataPoint(a)}},o.prototype.flattenViewModel=function(){var t=[];if(this.mapRendererData.shapeData)for(var e=0,i=this.mapRendererData.shapeData;e<i.length;e++){var a=i[e];t.push({categoryIndex:a.categoryIndex,seriesIndex:a.seriesIndex})}return t},o.prototype.getHtmlElementFromDataPoint=function(t){return this.shapeGraphicsContext.selectAll(".shape").filter(.node()||(y.fF.assertFail("An html element couldn't be found for the given data point in MapShapeDataPointRenderer.getHtmlElementFromDataPoint()."),null)},o.validLabelPolygonPositions=[256,2,1,8,4,16,32,64,128],o.ReducedPathScale=.0078125,o.ReducedPathScaleLimit=.03125,o.ReducedPathZoomLevel=4,o}(),qe=function(){function o(t){this.absMapSize=t.absMapSize,this.applyOffset=t.applyOffset,this.lazyCalculateTranslations=!1,this.mapControl=t.mapControl,this.offset=t.offset,this.originalDataPoints=t.dataPoints,this.transform=t.transform,this.translateX=t.translateX,this.viewport=t.viewport}return o.prototype.queryRegion=function(t){var e=this.transformAndTranslateSelectionRectangle(t);if(!e)return[];this.lazyCalculateTranslations||(this.dataPoints=this.calculateTranslations(this.originalDataPoints),this.lazyCalculateTranslations=!0);for(var i=[],a=0,n=this.dataPoints;a<n.length;a++){var l=n[a],h=Lt.m.translateX(e,-l.translation);if(Lt.m.polygonBoundsOverlap(h,Re(l.mapShape.globalBoundingRect)))for(var p=0,v=l.mapShape.pathsWithBounds;p<v.length;p++){var m=v[p];if(Lt.m.polygonBoundsOverlap(h,Re(m.boundingRect))&&h.overlapPath(m.path)){i.push(l.mapShape);break}}}return i},o.prototype.transformAndTranslateSelectionRectangle=function(t){var e=this,i=new Float64Array(8),a=new Float64Array(8),n={x:0,y:0},l=this.transform.applyToPoint(n).x;n.x+=this.absMapSize;var h=this.transform.applyToPoint(n).x;if(!Ve(t,function(O,R,V,G,nt){var dt=new Microsoft.Maps.Point(O-e.viewport.width/2,R-e.viewport.height/2),X=e.mapControl.tryPixelToLocation(dt,Microsoft.Maps.PixelReference.viewport);if(!X)return!1;i[V]=X.latitude,i[V+1]=X.longitude;var st=e.applyOffset(O<l,O>h,e.offset);return nt[V]=st,nt[V+1]=0,!0},i,a))return null;for(var v=(0,b.Sc)(i,this.absMapSize),m=0;m<v.length;m++)v[m]+=a[m];return new Lt.m(v)},o.prototype.calculateTranslations=function(t){for(var e=[],i=0,a=t;i<a.length;i++){var n=a[i];e.push({mapShape:n,translation:this.translateX(n,this.absMapSize,this.offset)})}return e},o}(),re=at.b$.parseNumber,ei=function(){function o(t){this.isDestroyed=!1,this.warnings=[],this.maxLevelOfDetail=b.Ch,this.minLevelOfDetail=b.z8,t.filledMap?(this.dataPointRenderer=new Ne(t.filledMapDataLabelsEnabled,t.tooltipsEnabled),this.filledMapDataLabelsEnabled=t.filledMapDataLabelsEnabled,this.isFilledMap=!0):(this.dataPointRenderer=new Ze(t.tooltipsEnabled),this.isFilledMap=!1),this.mapCredentials=b.Zr.BingKey,this.mapControlFactory=t.mapControlFactory,this.behavior=t.behavior,this.tooltipsEnabled=t.tooltipsEnabled,this.disableZooming=t.disableZooming,this.disablePanning=t.disablePanning,this.isLegendScrollable=!!t.behavior,this.viewChangeThrottleInterval=t.viewChangeThrottleInterval,this.enableCurrentLocation=t.enableCurrentLocation,this.boundsHaveBeenUpdated=!1,this.rescaleMap=t.rescaleMap,this.shouldSetSavedLocation=!0,this.dataPointLassoSelect=t.dataPointLassoSelect}return o.prototype.init=function(t){y.fF.assertValue(t,"options");var e=this.element=t.element;this.pendingGeocodingRender=0,this.eventManager=new lt.B(d3.select(e.get(0))),this.featureSwitches=t.featureSwitches,this.currentViewport=t.viewport,this.currentViewport.scale=this.currentViewport.scale||1,t.style||j.f.assertFail("Map style is missing"),this.style=t.style,this.host=t.host,this.behavior&&(this.interactivityService=(0,k.ub)(this.host)),this.legend=(0,Q.OG)(e,t.interactivity&&t.interactivity.isInteractiveLegend,this.interactivityService,this.isLegendScrollable,void 0,this.style,this.host),this.geoTaggingAnalyzerService=(0,N.P)().create(t.host.getLocalizedString.bind(t.host)),this.tooltipService=(0,ut.r)(this.host),this.host.locale&&(this.locale=this.host.locale()),this.geocoder=this.host.geocoder(),this.promiseFactory=this.host.promiseFactory(),this.mapTheme=f.uH,this.resetBounds(),this.isDestroyed=!1},o.prototype.destroy=function(){this.isDestroyed=!0;var t=this.mapControl;t&&(this.mapControl=void 0,setTimeout(function(){return t.dispose()},o.MapControlDisposeDelay)),this.geocodingContext&&this.geocodingContext.timeout&&this.geocodingContext.timeout.resolve(null)},o.prototype.createCurrentLocation=function(t){var a,e=this;(0,C.hi)().addClass("mapCurrentLocation").appendTo(t).on("click",function(){e.isCurrentLocation?(a&&e.mapControl.entities.remove(a),e.updateInternal(!1,!1),e.isCurrentLocation=!1):e.host.geolocation().getCurrentPosition(function(n){var l=new Microsoft.Maps.Location(n.coords.latitude,n.coords.longitude);a&&e.mapControl.entities.remove(a),a=(0,b.DT)(l),e.mapControl.entities.push(a),e.updateMapView(l,11),e.isCurrentLocation=!0})})},o.prototype.addDataPoint=function(t,e){if(t===this.geocodingContext){var i;if(--t.dataPointsRemaining,!_.isEmpty(e.paths))for(var a=0,n=e.paths;a<n.length;a++)i=(0,b.wu)(i,n[a].adjustedBounds);if(!i){var h=e.location;i={west:h.longitude,east:h.longitude,north:h.latitude,south:h.latitude}}this.updateBounds(i),this.scheduleRedraw()}},o.prototype.geocodingFailed=function(t){!this.isDestroyed&&t===this.geocodingContext&&--t.dataPointsRemaining<=0&&this.scheduleRedraw()},o.prototype.scheduleRedraw=function(){var t=this;y.fF.assert("geocodingContext.dataPointsRemaining underflow"),this.pendingGeocodingRender&&this.geocodingContext.dataPointsRemaining<=0&&(clearTimeout(this.pendingGeocodingRender),this.pendingGeocodingRender=0),!this.pendingGeocodingRender&&this.mapControl&&(this.pendingGeocodingRender=setTimeout(function(){t.updateInternal(!0,!0),t.pendingGeocodingRender=0},this.geocodingContext.dataPointsRemaining<=0?0:o.ScheduleRedrawInterval))},o.prototype.enqueueGeoCode=function(t,e,i){var a=this,n=this.geocoder.tryGeocodeImmediate(e.queryLocation,0,!1,void 0).then(function(l){a.initiateGeocoding(l,n,e,t,i)},function(l){a.initiateGeocoding(void 0,n,e,t,i)})},o.prototype.completeGeoCode=function(t,e,i){e.location=i,this.addDataPoint(t,e)},o.prototype.enqueueGeoCodeAndGeoShape=function(t,e,i,a){var n=this,l=function(p){n.completeGeoCodeAndGeoShape(t,e,i,p)};this.geocoder.tryGeocodeImmediate(e.queryLocation,0,!1,void 0).then(function(h){n.initiateGeocoding(void 0,l,e,t,a)})},o.prototype.completeGeoCodeAndGeoShape=function(t,e,i,a){e.location=a,this.enqueueGeoShape(t,e,i)},o.prototype.initiateGeocoding=function(t,e,i,a,n){var l=this;t?e(t):this.geocoder.geocode(i.queryLocation,0,!1,void 0,{timeout:a.timeout.promise,credentials:this.mapCredentials}).then(function(h){!l.isDestroyed&&a===l.geocodingContext&&((0,b.N2)(h,!0)?(l.warningsSet&&!n.invalidLatLongCoordinatesFound&&(l.warnings.push(new u.zI),l.host.setWarnings(l.warnings)),n.invalidLatLongCoordinatesFound=!0,l.geocodingFailed(a)):e(h))},function(h){return l.geocodingFailed(a)})},o.prototype.enqueueGeoShape=function(t,e,i){var a=this;y.fF.assertValue(e.location,"cachedLocation"),this.geocoder.tryGeocodeBoundaryImmediate({latitude:e.location.latitude,longitude:e.location.longitude,category:this.geocodingCategory,levelOfDetail:i.level,maxGeoData:i.maxPolygons,entityType:e.location.entityType},0,!1,void 0).then(function(n){a.initiateGeoboundary(void 0,e,t,i)})},o.prototype.initiateGeoboundary=function(t,e,i,a){var n=this;t?this.completeGeoShape(i,e,a,t):this.geocoder.geocodeBoundary({latitude:e.location.latitude,longitude:e.location.longitude,category:this.geocodingCategory,levelOfDetail:a.level,maxGeoData:a.maxPolygons,entityType:e.location.entityType},0,!1,void 0,{timeout:i.timeout.promise,credentials:this.mapCredentials}).then(function(l){!n.isDestroyed&&l&&i===n.geocodingContext&&n.completeGeoShape(i,e,a,l)},function(l){return n.geocodingFailed(i)})},o.prototype.completeGeoShape=function(t,e,i,a){(0,b.Yb)(a.locations),e.paths=Ne.buildPaths(a.locations),this.addDataPoint(t,e)},o.prototype.getOptimumLevelOfDetail=function(t,e,i){var a=this.dataPointRenderer.getDataPointCount();if(0===a)return this.minLevelOfDetail;var n=this.dataPointRenderer.getDataPointPadding(),l=this.dataPointRenderer.getEnclosingBounds&&this.dataPointRenderer.getEnclosingBounds();if(l)l.west=i.west,l.east=i.east;else if(1===a){var h;switch(this.geocodingCategory){case b.yV.Continent:h=130;break;case b.yV.CountryRegion:h=90;break;case b.yV.StateOrProvince:h=25;break;case b.yV.County:h=3;break;case b.yV.City:h=.7;break;case b.yV.PostalCode:h=.3;break;case b.yV.Place:h=.1;break;default:h=.04}l={west:i.west-h/2,north:this.maxLatitude,east:i.east+h/2,south:this.minLatitude}}else l={west:i.west,north:this.maxLatitude,east:i.east,south:this.minLatitude};for(var p=b.Ch;p>=b.z8;p--){var v=(0,b.Jy)(l.north,l.west,p,{unconstrained:!0}),m=(0,b.Jy)(l.south,l.east,p,{unconstrained:!0});if(Math.abs(m.x-v.x)+n<=t&&Math.abs(v.y-m.y)+n<=e)return p}return this.minLevelOfDetail},o.prototype.getMapView=function(t,e){var i=this.getSmallestEnclosingLongitudeRange(),a=(0,b.q1)((i.west+i.east)/2),n=this.getOptimumLevelOfDetail(t,e,i);n<=b.z8&&(a=0);var l=(0,b.Jy)(this.maxLatitude,a,n),h=(0,b.Jy)(this.minLatitude,a,n);return{center:(0,b.n8)((l.x+h.x)/2,(h.y+l.y)/2,n),levelOfDetail:n}},o.prototype.getSmallestEnclosingLongitudeRange=function(){var t=this.longitudes;if(_.isEmpty(t))return{west:0,east:0};if(1===t.length)return{west:t[0].west,east:t[0].east};t.sort(;var e=t[0].west,i=_.maxBy(t,function(v){return v.east}).east;if(i-e<=180)return{west:e,east:i};for(var a=e,n=i,l=n-a,h=1;h<t.length;++h){e=t[h].west;var p=(i=Math.max(i,t[h-1].east+360))-e;p<l&&(a=e,n=i,l=p)}return{west:a,east:n}},o.prototype.resetBounds=function(){this.boundsHaveBeenUpdated=!1,this.minLatitude=b.w6,this.maxLatitude=b.jv,this.longitudes=[]},o.prototype.updateBounds=function(t){var e=t.west,i=t.east,a=t.south,n=t.north,l=i-e;e=(0,b.q1)(e),this.longitudes.push({west:e,east:i=e+l}),this.boundsHaveBeenUpdated=!0,a<this.minLatitude&&(this.minLatitude=a),n>this.maxLatitude&&(this.maxLatitude=n)},o.prototype.renderLegend=function(t){var e=t.position;this.legend.setPosition(void 0!==e?e:s.tV.Top),this.legend.drawLegend(t,this.currentViewport)},o.calculateGroupSizes=function(t,e,i,a,n){for(var h=e.length,p=0,v=t.values[0].values.length;p<v;++p){var m=null;if(a>=0)for(var S=0;S<h;++S){var O=e[S].values[a].values[p];O&&(null===m?m=O:m+=O)}i.push(m),m&&(n?(n.min=Math.min(n.min,m),n.max=Math.max(n.max,m)):n={min:m,max:m})}return n},o.calculateRadius=function(t,e,i,a){var n,l;if(void 0===a&&(a=1),null==t||null==e)return a*o.MarkerRadiusDefault;var p=i===r.x9?o.MarkerRadiusDefault:o.MarkerRadiusMin;i===r.d7&&(i=e.min>=0||e.max<=0?r.VE:r.Ku),i===r.VE&&(t&&(t=Math.abs(t)),e={min:0,max:Math.max(null!==(n=Math.abs(e.max))&&void 0!==n?n:0,null!==(l=Math.abs(e.min))&&void 0!==l?l:0)});var m=((t=Math.min(Math.max(t,e.min),e.max))-e.min)/(e.max-e.min||1);return y.fF.assert("valueRatio must be between 0 and 1"),a*((o.MarkerRadiusMax-p)*Math.sqrt(m)+p)},o.getGeocodingCategory=function(t,e){var i;if(i=e.getFieldTypeFromDescriptor(t.type))return i;if(i=e.getFieldType(t.displayName))return i;var l=t.roles;if(l)for(var h=Object.keys(l),p=0,v=h.length;p<v;++p){var m=e.getFieldType(h[p]);if(m)return m}},o.hasSizeField=function(t,e){if(_.isEmpty(t))return!1;for(var i=0,a=t.length;i<a;i++){var n=t[i].source.roles;if(!n&&i===e&&t[i].source.type.numeric)return!0;if(n)for(var l=Object.keys(n),h=0,p=l.length;h<p;h++)if("Size"===l[h])return!0}return!1},o.shouldEnumerateDataPoints=function(t,e,i){var a=(0,rt.c5)(t,"Series"),l=(0,rt.c5)(t,e?"Size":"Gradient");return(a||!l)&&!(i&&i.showHeatMap)},o.shouldEnumerateHeatMap=function(t,e){return!(t&&t.dataPoints&&t.dataPoints.length>1||e)},o.shouldEnumerateCategoryLabels=function(t,e,i){return(!t||e)&&!(i&&i.showHeatMap)},o.prototype.getMapSettingsCard=function(t,e){var i=this,l=E.jM.mapStyles,h=(0,x.pi)((0,x.pi)({},E.jM.mapControls),l),p=new L.CQ(new L.lg("mapSettings"),"Visual_AzureMapsMapSettings",h,function(m){return t.getLocalizedString(m)});return p.addGroup("style",function(v){v.withDisplayName("Style"),v.addSimpleSlice("style",new L.uY({descriptor:h.mapTheme,value:e.mapTheme}).build(),function(m){return m.withCustomDisplayName("Style")}).addSimpleSlice("showLabels",new L.bd({descriptor:h.showLabels,value:e.showLabels}).build())}),p.addGroup("controls",function(v){v.withDisplayName("Controls"),v.addSimpleSlice("autoZoom",new L.bd({descriptor:h.autoZoom,value:e.autoZoomEnabled}).build()).addSimpleSlice("showZoomButtons",new L.bd({descriptor:h.showZoomButtons,value:e.showZoomButtons}).build());var m=o.shouldEnumerateHeatMap(i.data&&i.data.legendData,i.isFilledMap);i.plotLassoManager&&(!m||!e.showHeatMap)&&v.addSimpleSlice("showLassoButton",new L.bd({descriptor:h.showLassoButton,value:e.showLassoButton}).build()),v.addSimpleSlice("geocodingCulture",new L.uY({descriptor:h.geocodingCulture,value:e.geocodingCulture||d.gA}).build())}),p.build()},o.prototype.getLegendCard=function(t,e,i,a){return(0,Q.ZF)({legendData:e},t,a,!i)},o.prototype.getBubblesCard=function(t){var e=this,i=function(v){return e.host.getLocalizedString(v)},a=E.jM.bubbles,n=E.jM.dataPoint,l=[n.fill,n.showAllDataPoints,n.defaultColor,a.bubbleSize,a.markerRangeType],h=new L.CQ(new L.lg("bubbles"),"Visual_Bubbles",l,i);return h.withDescription("Visual_BubblesDescription"),t&&!t.showHeatMap&&h.addGroup("size",function(p){var v;p.withDisplayName("Role_DisplayName_Size");var m={get:function(V){return e.host.getLocalizedString(V)},getOptional:function(V){return e.host.getLocalizedString(V)},format:function(V){return e.host.getLocalizedString(V)}},S=_.map(r.ar,,O=null!==(v=S.find()&&void 0!==v?v:{value:r.x9,displayName:e.host.getLocalizedString("Visual_MarkerRangeType_Deprecated")};p.addSimpleSlice("markerRangeType",new L.uY({descriptor:a.markerRangeType,items:S,value:O}).build(),function(R){var V;return R.withDisabled(!(null!==(V=e.data)&&void 0!==V&&V.hasSize))}),p.addSimpleSlice("size",new L.JN({descriptor:a.bubbleSize,value:(0,H.yn)(t.bubbleSizeMultiplier),localize:i,options:{minValue:{type:0,value:H.Ad.min},maxValue:{type:1,value:H.Ad.max}}}).build())}),this.addDataPointsDetails(t,h,i),h.build()},o.prototype.getFillColorsCard=function(t){var e=this,i=function(p){return e.host.getLocalizedString(p)},a=E.jM.dataPoint,n=[a.fill,a.showAllDataPoints,a.defaultColor],l=new L.CQ(new L.lg("fillcolors"),"Visual_FillColors",n,i);return this.addDataPointsDetails(t,l,i),l.build()},o.prototype.addDataPointsDetails=function(t,e,i){var a=this,n=this.data;!n||!o.shouldEnumerateDataPoints(this.dataView,this.isFilledMap,t)||e.addGroup("colors",function(l){if(l.withDisplayName("Visual_Colors"),n.hasSeries){var h={groupBuilder:l,dataPoints:(0,Q.l3)(n.legendData),seriesColorProps:E.jM.dataPoint,localize:i,featureSwitches:a.featureSwitches};return(0,z.y0)(h)}var p={groupBuilder:l,colorProps:E.jM.dataPoint,featureSwitches:a.featureSwitches,hostService:a.host,options:{dataView:a.dataView,style:a.style,categories:_.map(n.dataPoints,function(v){var m=v.subDataPoints[0];return{color:(0,c.ci)(m.fill),displayName:v.categoryValue,identity:m.identity}}),fillInstanceKind:3}};(0,z.jN)(p)})},o.prototype.getCategoryLabelCard=function(t,e,i,a){if(o.shouldEnumerateCategoryLabels(this.isFilledMap,this.filledMapDataLabelsEnabled,i)){var n=E.jM.categoryLabels;return(0,B.Zu)({cardName:"Visual_CategoryLabels",dataLabelSettings:e,isShowCategory:!1,localize:function(p){return t.getLocalizedString(p)},props:n,revertToDefaultProps:n,showBackground:!0,showValueColor:!0,style:a})}},o.prototype.getHeatMapCard=function(){var t=this;if(this.data&&o.shouldEnumerateHeatMap(this.data.legendData,this.isFilledMap)&&(!this.data.legendData||_.isEmpty(this.data.legendData.dataPoints))){var i=this.data.properties,a=n=E.jM.heatMap,l=new L.CQ(new L.lg("heatmap"),"Visual_HeatMap",n,a),h=M.XT;return i.heatMapOptions&&i.heatMapOptions.unit&&i.heatMapOptions.unit===M.zH&&(h=M.dw),l.addTopLevelToggle("show",function(){return new L.bd({descriptor:(0,x.pi)((0,x.pi)({},n.show),{selector:null}),value:i.showHeatMap}).build()}).addGroup("colors",function(p){p.withDisplayName("Visual_Colors").addSimpleSlice("color0",new L.BT({descriptor:(0,x.pi)((0,x.pi)({},n.color0),{selector:null,instanceKind:1}),value:{value:i.heatMapOptions&&i.heatMapOptions.colorGradient["0.20"]}}).build()).addSimpleSlice("color50",new L.BT({descriptor:(0,x.pi)((0,x.pi)({},n.color50),{selector:null,instanceKind:1}),value:{value:i.heatMapOptions&&i.heatMapOptions.colorGradient[.65]}}).build()).addSimpleSlice("color100",new L.BT({descriptor:(0,x.pi)((0,x.pi)({},n.color100),{selector:null,instanceKind:1}),value:{value:i.heatMapOptions&&i.heatMapOptions.colorGradient["1.00"]}}).build())}).addGroup("options",function(p){p.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice("radius",new L.JN({descriptor:(0,x.pi)((0,x.pi)({},n.filterRadius),{selector:null}),value:i.heatMapOptions&&i.heatMapOptions.radius,localize:a,options:{minValue:{type:0,value:1},maxValue:{type:1,value:h},unitSymbol:et.e_}}).build()).addSimpleSlice("displayUnits",new L.uY({descriptor:(0,x.pi)((0,x.pi)({},n.unit),{selector:null}),value:i.heatMapOptions&&i.heatMapOptions.unit}).build(),.addSimpleSlice("transparency",L.JN.getTransparencySliderBuilder({descriptor:(0,x.pi)((0,x.pi)({},n.transparency),{selector:null}),value:i.heatMapOptions&&Math.round(100*(1-i.heatMapOptions.opacity)),localize:a}).build())}),l.build()}},o.prototype.getFormattingModel=function(){var t=this,e=this.data?this.data.dataLabelSettings:(0,b.BP)(this.style),i=this.data?this.data.properties:(0,b.IG)(this.style).properties;return new L.Nq(function(){return t.getLegendCard(t.host,t.data&&t.data.legendData,t.hasSeries,t.featureSwitches)},function(){return t.getCategoryLabelCard(t.host,e,i,t.style)},.build()},o.prototype.enumerateObjectInstances=function(t){var e=new vt.G,i=this.data?this.data.dataLabelSettings:(0,b.BP)(this.style),a=this.data?this.data.properties:(0,b.IG)(this.style).properties;if(this.dataView){var n=o.shouldEnumerateHeatMap(this.data.legendData,this.isFilledMap);switch(t.objectName){case"dataPoint":o.shouldEnumerateDataPoints(this.dataView,this.isFilledMap,a)&&o.enumerateDataPoints(e,this.data.legendData,this.data,this.dataView,this.style);break;case"categoryLabels":o.shouldEnumerateCategoryLabels(this.isFilledMap,this.filledMapDataLabelsEnabled,a)&&(0,B.dH)(e,i,!0,this.featureSwitches,!0,void 0,this.style);break;case"legend":this.hasSeries&&(0,Q.Rh)({enumeration:e,legendData:this.data.legendData},this.featureSwitches);break;case"labels":this.filledMapDataLabelsEnabled&&(0,B.lw)({enumeration:e,dataLabelsSettings:i,show:!0,displayUnits:!0,precision:!0,style:this.style,bold:!0,italic:!0,underline:!0},this.featureSwitches);break;case"bubbles":o.enumerateBubbles(e,a);break;case"mapControls":this.enumerateMapControls(e,n);break;case"mapStyles":this.enumerateMapStyles(e);break;case"heatMap":n&&this.enumerateHeatMap(e)}return e.complete()}},o.enumerateDataPoints=function(t,e,i,a,n){i&&(i.hasSeries?(0,z.Hr)({enumeration:t,dataPoints:(0,Q.l3)(e)}):(0,z.R_)({enumeration:t,dataView:a,style:n,categories:_.map(i.dataPoints,function(l){var h=l.subDataPoints[0];return{color:(0,c.ci)(h.fill),displayName:l.categoryValue,identity:h.identity}}),fillInstanceKind:3}))},o.enumerateBubbles=function(t,e){e&&(e&&e.showHeatMap||t.pushInstance({selector:null,properties:{bubbleSize:(0,H.yn)(e.bubbleSizeMultiplier),markerRangeType:e.markerRangeType},objectName:"bubbles",validValues:{bubbleSize:{numberRange:{min:-30,max:100}},markerRangeType:r.$m}}))},o.prototype.enumerateMapControls=function(t,e){if(this.data){var i={autoZoom:this.data.properties.autoZoomEnabled,showZoomButtons:this.data.properties.showZoomButtons};this.plotLassoManager&&(!e||!this.data.properties.showHeatMap)&&(i.showLassoButton=this.data.properties.showLassoButton),i.geocodingCulture=this.data.properties.geocodingCulture,t.pushInstance({selector:null,properties:i,objectName:"mapControl"})}},o.prototype.enumerateMapStyles=function(t){this.data&&t.pushInstance({selector:null,properties:{mapTheme:this.data.properties.mapTheme,showLabels:this.data.properties.showLabels},objectName:"mapStyles"})},o.prototype.enumerateHeatMap=function(t){if(this.data&&(!this.data.legendData||_.isEmpty(this.data.legendData.dataPoints))){var e=this.data.properties,i=M.XT;e.heatMapOptions&&e.heatMapOptions.unit&&e.heatMapOptions.unit===M.zH&&(i=M.dw),t.pushInstance({selector:null,properties:{show:e.showHeatMap,filterRadius:e.heatMapOptions&&e.heatMapOptions.radius,unit:e.heatMapOptions&&e.heatMapOptions.unit,transparency:e.heatMapOptions&&Math.round(100*(1-e.heatMapOptions.opacity)),color0:e.heatMapOptions&&e.heatMapOptions.colorGradient["0.20"],color50:e.heatMapOptions&&e.heatMapOptions.colorGradient[.65],color100:e.heatMapOptions&&e.heatMapOptions.colorGradient["1.00"]},objectName:"heatMap",validValues:{filterRadius:{numberRange:{min:1,max:i}}}})}},o.prototype.update=function(t){return(0,x.mG)(this,void 0,A.J,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return null==t.resizeMode?[3,1]:(this.onResizingInternal(t),[3,3]);case 1:return[4,this.onDataChangedInternal(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},o.prototype.onDataChangedInternal=function(t,e){return void 0===e&&(e=!0),(0,x.mG)(this,void 0,A.J,function(){var i,a,n,l,h,p,m,S,O,R,V,G,nt=this;return(0,x.Jh)(this,function(pt){switch(pt.label){case 0:return y.fF.assertValue(t,"options"),this.viewMode=t&&t.viewMode,this.resetBounds(),this.geocodingContext&&this.geocodingContext.timeout&&this.geocodingContext.timeout.resolve(null),this.geocodingContext={timeout:this.promiseFactory.defer(),dataPointsRemaining:0},i=this.geocodingContext,this.behavior&&this.behavior.resetZoomPan(),a=this.dataView=t&&t.dataViews&&t.dataViews[0],n=this.isFilledMap,this.warnings=[],this.warningsSet=!1,l=(0,b.IG)(this.style),a?(l=this.data=o.converter({dataView:a,geoTaggingAnalyzerService:this.geoTaggingAnalyzerService,isFilledMap:n,style:this.style,warnings:this.warnings}),this.dataPointRenderer.setData(l),this.hasSeries=l.hasSeries,[4,this.ensureMap()]):[3,2];case 1:if(pt.sent(),this.isDestroyed)return[2];if(this.mapControl){if((h=l.properties.mapTheme)!==this.mapTheme&&(this.mapControl.setMapType((0,b.N0)(h)),this.mapTheme=h),(p=this.mapControl.getOptions()).showZoomButtons!==l.properties.showZoomButtons||l.properties.minZoom&&p.minZoom!==l.properties.minZoom||l.properties.maxZoom&&p.maxZoom!==l.properties.maxZoom)return m=this.mapControl,this.mapControl=void 0,this.dataPointRenderer.clearDataPoints(),m.dispose(),setTimeout(function(){nt.root.empty(),nt.initializeMapControl(),e&&setTimeout(250)},o.MapControlDisposeDelay),[2];if(l.properties.autoZoomEnabled&&!this.autoZoomWasEnabled?(l.properties.savedLatitude=void 0,l.properties.savedLongitude=void 0,l.properties.savedZoomLevel=void 0,this.persistZoomPanState(!0)):!l.properties.autoZoomEnabled&&this.autoZoomWasEnabled&&(this.updateZoomPanStateFromControl(),this.persistZoomPanState(!0)),this.autoZoomWasEnabled=l.properties.autoZoomEnabled,this.renderLegend(this.data.legendData),this.geocodingCategory=l.geocodingCategory,this.isDestroyed||i!==this.geocodingContext)return[2];for(S=void 0,n&&(S=(0,b.o)(this.geocodingCategory,l.dataPoints.length)),i.dataPointsRemaining=l.dataPoints.length,O=0,R=l.dataPoints;O<R.length;O++)(V=R[O]).location?n&&!V.paths?this.enqueueGeoShape(i,V,S):this.addDataPoint(i,V):null!=(G=V.categoryValue)&&""!==G?n?this.enqueueGeoCodeAndGeoShape(i,V,S,l):this.enqueueGeoCode(i,V,l):this.geocodingFailed(i);this.updateInternal(!0,!0)}return n&&(!this.geocodingCategory||!this.geoTaggingAnalyzerService.isGeoshapable(this.geocodingCategory))&&this.warnings.push(new u.Gh),l.invalidLatLongCoordinatesFound&&this.warnings.push(new u.zI),[3,3];case 2:this.clearDataPoints(),this.renderLegend((0,Q.Fe)(this.style)),this.dataPointRenderer.setData(l),this.updateInternal(!0,!0),pt.label=3;case 3:return this.host.setWarnings(this.warnings),this.warningsSet=!0,[2]}})})},o.converter=function(t){if(o.isMatrixCase(t.dataView))return o.convertMatrix(t);var e=t.style,i=E.jM.general.formatString,a=(0,bt.G)(t.dataView,{colorOptions:{valueRole:"Size",visualStyle:e},formatStringProp:i}),n=a.data,l=a.objects,h=[],p=n.hasSeries(),v=n.hasValues("Size"),m=null,S=a.objects.getStaticObjects(),O=(100-(0,w.NA)(S,E.jM.dataPoint.transparency,100*(1-o.innerGeometryAlpha)))/100,R=t.isFilledMap,V=!1,G=o.getMapPropertiesFromObjects(S,e,!p,t);if(n.hasCategories()){var nt=[],pt=void 0;if(v){for(var K=void 0,dt=void 0,X=0,st=n.getCategoryCount();X<st;X++){for(var P=void 0,ft=0,Vt=n.getSeriesCount();ft<Vt;ft++){var gt=n.getValue("Size",X,ft);null==P&&null!=gt&&(P=0),null!=P&&(P+=gt)}nt.push(P),null!=P&&((void 0===K||P<K)&&(K=P),(void 0===dt||P>dt)&&(dt=P))}pt=void 0!==K&&void 0!==dt?{max:dt,min:K}:void 0}var St=n.hasCompositeCategories()&&n.hasCategoryWithRole("X")&&n.hasCategoryWithRole("Y"),Et=n.hasCategoryWithRole("Category");if(Et&&(m=o.getGeocodingCategory(_.last(t.dataView.categorical.categories).source,t.geoTaggingAnalyzerService)),St||Et)for(X=0,st=n.getCategoryCount();X<st;X++){var Ot={components:[],culture:G.geocodingCulture},Rt=void 0,ct=void 0,mt=[],Nt=void 0,At=void 0,Ut=void 0,Zt=void 0,Wt=void 0;if(Et){for(var Kt=n.getAllCategoryDisplayNamesForRole("Category"),Xt=n.getAllCategoryValuesForRole("Category",X),Gt=l.getAllCategoryFormatStringsForRole("Category"),oe=_.map(t.dataView.categorical.categories,,se=[],Yt=0;Yt<Xt.length;++Yt){var te=Kt[Yt],Jt=Xt[Yt],Qt=oe[Yt],Dt=(0,it.WU)(Jt,Gt[Yt]);se.unshift(Dt),Ot.components.push({query:Jt&&Dt,category:Qt}),mt.push({displayName:te,value:Dt})}if(Rt=se.join(", "),n.hasValues("Y")&&n.hasValues("X")){var Pt=re(n.getFirstNonNullValueForCategory("Y",X)),Bt=re(n.getFirstNonNullValueForCategory("X",X));null!=Pt&&_.isFinite(Pt)&&null!=Bt&&_.isFinite(Bt)&&(ct={latitude:Pt,longitude:Bt}),Nt={displayName:n.getValueDisplayName("Y"),value:(0,it.WU)(Pt,l.getValueFormatString("Y"))},At={displayName:n.getValueDisplayName("X"),value:(0,it.WU)(Bt,l.getValueFormatString("X"))}}}else{Pt=re(n.getCategoryValue("Y",X));var kt=(0,it.WU)(Pt,l.getCategoryFormatString("Y")),ge=(Bt=re(n.getCategoryValue("X",X)),(0,it.WU)(Bt,l.getCategoryFormatString("X")));Ae(Pt,Bt)&&(Rt=kt+", "+ge,ct={latitude:Pt,longitude:Bt},Nt={displayName:n.getCategoryDisplayName("Y"),value:kt},At={displayName:n.getCategoryDisplayName("X"),value:ge})}var le=v?nt[X]:void 0;if((0,b.N2)(ct,St))V=!0;else{var ue=[];for(Vt=n.getSeriesCount(),!v&&!p&&(Vt=1),ft=0;ft<Vt;ft++){var be=p?n.getSeriesName(ft):void 0;if(!p||v||!o.hasNoValuesAtInteresection(a,["Tooltips","X","Y"],X,ft)){var ce=a.colors.createBySeries(ft,X),ee=(0,c.WV)(ce);ee||(ce=a.colors.createBySeries(ft,X,void 0,!0),ee=(0,c.WV)(ce));var $t=o.getSubDataPointStrokeColor(ee,e),we=(0,c.U8)(o.adjustSubDataPointFillColor(ee,e,O));p&&(Ut={displayName:n.getSeriesDisplayName(),value:(0,it.WU)(be,l.getSeriesFormatString())});var ie=void 0;if(v){ie=n.getValue("Size",X,ft);var Ce=n.getFormatString("Size",X,ft)||a.objects.getValueFormatString("Size");Zt={displayName:n.getValueDisplayName("Size"),value:(0,it.WU)(ie,Ce)}}if(n.hasValues("Gradient")){var Se=n.getValue("Gradient",X,ft),pe=a.objects.getValueFormatString("Gradient");Wt={displayName:n.getValueDisplayName("Gradient"),value:(0,it.WU)(Se,pe)}}var Mt=[];_.isEmpty(mt)||Mt.push.apply(Mt,mt||[]),Ut&&Mt.push(Ut),Nt&&Mt.push(Nt),At&&Mt.push(At),Zt&&Mt.push(Zt),Wt&&Mt.push(Wt),(0,U.VT)(a,Mt,X,ft,i);var me=a.identities.createForDataPoint(X,ft,v?["Size"]:void 0);(ie||!v||0===ie&&R)&&ue.push({value:ie,fill:we,stroke:$t,identity:me,tooltipInfo:Mt,seriesIndex:ft})}}(le||!v||0===le&&R)&&ue.length>0&&h.push({queryLocation:Ot,value:le,categoryValue:Rt,subDataPoints:ue,radius:o.calculateRadius(le,pt,G.markerRangeType,G.bubbleSizeMultiplier),location:ct})}}}var Ht={dataPoints:h,geocodingCategory:m,hasSeries:p,hasSize:v,properties:G,dataLabelSettings:o.calculateDataLabelSettings(t.dataView,R,e),legendData:(0,Q.pq)({dataView:t.dataView,style:e,showByDefault:!0}),invalidLatLongCoordinatesFound:V},Pe=D.v.getDataColorByIndex(e,0),qt=(0,c.X6)(Pe,.33);return Ht.properties.heatMapOptions={opacity:1-(0,w.NA)(S,E.jM.heatMap.transparency,0)/100,radius:(0,w.NA)(S,E.jM.heatMap.filterRadius,10),unit:(0,w.NA)(S,E.jM.heatMap.unit,M.aA),colorGradient:{"0.20":(0,w.W7)(S,E.jM.heatMap.color0,qt(0)),.65:(0,w.W7)(S,E.jM.heatMap.color50,qt(.5)),"1.00":(0,w.W7)(S,E.jM.heatMap.color100,qt(1))}},Ht.properties.heatMapOptions.radius="meters"===Ht.properties.heatMapOptions.unit?Math.min(Ht.properties.heatMapOptions.radius,M.dw):Math.min(Ht.properties.heatMapOptions.radius,M.XT),Ht},o.getMapPropertiesFromObjects=function(t,e,i,a){var n={bubbleSizeMultiplier:(0,H.HN)((0,w.NA)(t,E.jM.bubbles.bubbleSize,1)),markerRangeType:(0,w.NA)(t,E.jM.bubbles.markerRangeType,r.x9),autoZoomEnabled:(0,w.NA)(t,E.jM.mapControls.autoZoom,!0),savedLatitude:(0,w.NA)(t,E.jM.mapControls.centerLatitude),savedLongitude:(0,w.NA)(t,E.jM.mapControls.centerLongitude),savedZoomLevel:(0,w.NA)(t,E.jM.mapControls.zoomLevel),defaultDataPointColor:(0,w.W7)(t,E.jM.dataPoint.defaultColor,e.colorPalette.dataColors.getColorByIndex(0).value),fill:(0,w.W7)(t,E.jM.dataPoint.fill,e.colorPalette.dataColors.getColorByIndex(0).value),mapTheme:o.getMapThemeFromObjects(t,e),showHeatMap:i&&(0,w.NA)(t,E.jM.heatMap.show),showZoomButtons:(0,w.NA)(t,E.jM.mapControls.showZoomButtons,!1),showLassoButton:(0,w.NA)(t,E.jM.mapControls.showLassoButton,!1),minZoom:(0,w.NA)(t,E.jM.mapControls.minZoom,void 0),maxZoom:(0,w.NA)(t,E.jM.mapControls.maxZoom,void 0),showLabels:(0,w.NA)(t,E.jM.mapStyles.showLabels,!0),showStroke:(0,w.NA)(t,Y.Vh.stroke.show,!1),strokeColor:(0,w.W7)(t,Y.Vh.stroke.color,void 0),strokeWidth:(0,w.NA)(t,Y.Vh.stroke.width,void 0),geocodingCulture:(0,w.NA)(t,E.jM.mapControls.geocodingCulture,void 0)};return n.geocodingCulture&&!(0,d._h)(n.geocodingCulture)&&(n.geocodingCulture=void 0,a.warnings.push(new u.aV)),n},o.convertMatrix=function(t){var e=t.dataView.metadata.objects,i=t.dataView.matrix,a=t.style,n=[],l=i.rows.root.children;if(!l)return(0,b.IG)(a);var K,h=(100-(0,w.NA)(e,E.jM.dataPoint.transparency,100*(1-o.innerGeometryAlpha)))/100,p=l.length,v={},m=0,S=i.rows.root.childIdentityFields,O=i.rows.levels[0].sources[0],R=E.jM.general.formatString,V=D.v.create(a,E.jM.dataPoint.fill),G=!1,nt=o.getMapPropertiesFromObjects(e,a,!1,t),pt=o.calculateRadius(void 0,void 0,nt.markerRangeType,nt.bubbleSizeMultiplier);if(!_.isEmpty(i.valueSources)){K=[];for(var dt=0;dt<i.valueSources.length;++dt){var X=i.valueSources[dt];X.roles.Tooltips&&K.push({displayName:X.displayName,valueIndex:dt})}}var st,P,ft,Vt,gt,St=i.rows.levels[1];if(null!=St&&!_.isEmpty(St.sources)&&(st=St.sources,St.sources.length>=2)){var Et=St.sources[0],Ot=St.sources[1];Et&&Et.roles.X?(P=Et,Vt=0):Et&&Et.roles.Y&&(ft=Et,gt=0),Ot&&Ot.roles.X?(P=Ot,Vt=1):Ot&&Ot.roles.Y&&(ft=Ot,gt=1)}for(var Rt,ct=0;ct<p;ct++){var mt=l[ct],Nt=mt.children,At=mt.value,Ut=(0,I.xq)(At,O,E.jM.general.formatString),Zt=V.getColorForSeriesValue(mt.objects,S,At),Wt=(0,c.WV)(Zt);Wt||(Zt=V.getColorForSeriesValue(mt.objects,S,At,void 0,!0),Wt=(0,c.WV)(Zt));var Kt=o.getSubDataPointStrokeColor(Wt,a),Xt=(0,c.U8)(o.adjustSubDataPointFillColor(Wt,a,h)),Gt={displayName:O.displayName,value:Ut};if(st&&st[0].roles.Category){var oe=st[st.length-1];Rt=o.getGeocodingCategory(oe,t.geoTaggingAnalyzerService);for(var se=0,Yt=Nt.length;se<Yt;se++){var te=Nt[se],ve=(Jt=(new ot.dw).withColumnIdentity(te.identity,oe.queryName)).createSelectionId().getKey(),Qt=Jt.withColumnIdentity(mt.identity,O.queryName).createSelectionId();null==(Dt=v[ve])&&(Dt=m++,v[ve]=Dt);var Pt=[],Bt={components:[],culture:nt.geocodingCulture},kt=void 0;if(te.levelValues&&1!==te.levelValues.length){for(var le=_.map(st,function(ae){return ae.displayName}),ue=_.map(te.levelValues,function(ae){return ae.value}),be=_.map(st,function(ae){return(0,w.NA)(ae.objects,{objectName:"general",propertyName:"formatString"})}),ce=_.map(st,,ee=[],$t=0;$t<ue.length;++$t){var we=le[$t],Se=ce[$t],pe=(0,it.WU)(ue[$t],be[$t]);ee.unshift(pe),Bt.components.push({query:pe,category:Se}),Pt.push({displayName:we,value:pe})}kt=ee.join(", ")}else kt=(0,I.xq)(te.value,oe,R),Pt.push({displayName:oe.displayName,value:kt}),Bt.components.push({query:kt,category:Rt});(Mt=n[Dt])||(n[Dt]=Mt={categoryValue:kt,queryLocation:Bt,radius:pt,subDataPoints:[],value:void 0}),Gt&&Pt.push(Gt),Mt.subDataPoints.push({fill:Xt,stroke:Kt,identity:Qt,value:void 0,tooltipInfo:Pt,seriesIndex:ct})}}else if(O&&O.roles.Category&&O.roles.Series){Rt=o.getGeocodingCategory(O,t.geoTaggingAnalyzerService);var me=(Qt=(new ot.dw).withColumnIdentity(mt.identity,O.queryName).createSelectionId()).getKey();null==(Dt=v[me])&&(Dt=m++,v[me]=Dt),(Mt=n[Dt])||(n[Dt]=Mt={categoryValue:Ut,queryLocation:{components:[{query:Ut,category:Rt}]},radius:pt,subDataPoints:[],value:void 0}),Pt=[],Gt&&Pt.push(Gt),Mt.subDataPoints.push({fill:Xt,stroke:Kt,identity:Qt,value:void 0,tooltipInfo:Pt,seriesIndex:ct})}else{if(!(P&&P.roles.X&&ft&&ft.roles.Y))return(0,b.IG)(a);for(var Ht=0,Pe=Nt.length;Ht<Pe;Ht++){var qt=Nt[Ht],Le=re(qt.levelValues[Vt].value),De=re(qt.levelValues[gt].value);if(Ae(De,Le)){var xe,Te,Ee,Jt,Dt,Mt,Be=(0,I.xq)(Le,P,R),ye=(0,I.xq)(De,ft,R),ze=(Pt=[],kt=ye+", "+Be,(Jt=(new ot.dw).withColumnIdentity(qt.identity,ft.queryName)).createSelectionId().getKey());if(Qt=Jt.withColumnIdentity(mt.identity,O.queryName).createSelectionId(),(0,b.N2)(Ee={latitude:De,longitude:Le},!0)){G=!0;continue}if(xe={displayName:ft.displayName,value:ye},Te={displayName:P.displayName,value:Be},null==(Dt=v[ze])&&(Dt=m++,v[ze]=Dt),(Mt=n[Dt])||(n[Dt]=Mt={categoryValue:kt,queryLocation:{components:[{query:kt,category:Rt}]},radius:pt,subDataPoints:[],value:void 0,location:Ee}),Gt&&Pt.push(Gt),xe&&Pt.push(xe),Te&&Pt.push(Te),!_.isEmpty(K))for(var Oe=0,ke=K;Oe<ke.length;Oe++){var He=ke[Oe];Pt.push({displayName:He.displayName,value:(0,it.WU)(qt.values[He.valueIndex].value)})}Mt.subDataPoints.push({fill:Xt,stroke:Kt,identity:Qt,value:void 0,tooltipInfo:Pt,seriesIndex:ct})}}}}return{dataPoints:n,hasSeries:!0,geocodingCategory:Rt,hasSize:!1,properties:nt,dataLabelSettings:o.calculateDataLabelSettings(t.dataView,t.isFilledMap,a),legendData:(0,Q.PP)({dataView:t.dataView,colorHelper:V,style:a,formatStringProp:R,showByDefault:!0}),invalidLatLongCoordinatesFound:G}},o.getMapThemeFromObjects=function(t,e){return e.isHighContrast?f.IZ:(0,w.NA)(t,E.jM.mapStyles.mapTheme,f.uH)},o.adjustSubDataPointFillColor=function(t,e,i){return void 0===i&&(i=o.innerGeometryAlpha),t.A=e.isHighContrast?void 0:i,t},o.getSubDataPointStrokeColor=function(t,e){return e.isHighContrast?D.v.getThemeColor(e,T.fA):(0,c.Bx)((0,c._j)(t,o.StrokeDarkenColorValue))},o.isMatrixCase=o.calculateDataLabelSettings=function(t,e,i){var a=(0,b.BP)(i),n=t.metadata&&t.metadata.objects;if(!n)return a;if(a.showCategory=(0,w.NA)(n,Y.Vh.categoryLabels.show,a.showCategory),e){a.precision=(0,w.NA)(n,Y.Vh.labels.labelPrecision,a.precision),a.precision=a.precision!==F.NZ&&a.precision<0?0:a.precision,a.displayUnits=(0,w.NA)(n,Y.Vh.labels.labelDisplayUnits,a.displayUnits);var l=n.labels;l&&(a.show=void 0!==l.show?l.show:a.show,void 0!==l.color&&(a.fontProperties=(0,tt.ED)(a.fontProperties,{color:l.color.solid.color})))}else{var h=n.categoryLabels;h&&(0,B.ww)(h,a,void 0,i)}var p=D.v.create(i);return a.enableBackground=(0,w.NA)(n,E.jM.categoryLabels.enableBackground,!0),a.backgroundColor=p.getColorForProperty(n,E.jM.categoryLabels.backgroundColor,F.lp),a.backgroundTransparency=(0,w.NA)(n,E.jM.categoryLabels.backgroundTransparency,100*b.Bz)/100,a},o.hasNoValuesAtInteresection=function(t,e,i,a){for(var n=!1,l=0,h=e;l<h.length;l++){var p=h[l];if(t.data.hasValues(p)&&(n=!0,!_.every(t.data.getAllValuesForRole(p,i,a),))return!1}return n},o.prototype.swapLogoContainerChildElement=function(){var t=this.element.find(".LogoContainer");if(t){var e=t.find("a");if(null==e)return;var i=$("<div>");e.children().clone().appendTo(i),e.remove(),i.appendTo(t)}},o.prototype.onResizingInternal=function(t){var e=t.viewport;e.scale=e.scale||1,(this.currentViewport.width!==e.width||this.currentViewport.height!==e.height||this.currentViewport.scale!==e.scale)&&(this.currentViewport=e,this.data&&this.data.legendData&&this.mapControl&&(this.renderLegend(this.data.legendData),this.updateInternal(!1,!1),(0,b.ml)(this.mapControl)))},o.prototype.ensureMap=function(){var t=this;return this.ensuringMap?this.ensuringMap.promise:(this.ensuringMap=(0,Z.p)().defer(),this.mapControlFactory||(this.mapControlFactory=(0,b.$f)(this.promiseFactory,this.host.loader())),this.mapControlFactory.ensureMap(this.locale).then(function(){t.isDestroyed||(Ie(),t.initializeMapControl(),t.enableCurrentLocation&&t.createCurrentLocation(t.element))}))},o.prototype.createMapControl=function(t,e){var i={credentials:b.Zr.BingKey,mapTypeId:(0,b.N0)(this.mapTheme),disableZooming:this.disableZooming,disablePanning:this.disablePanning,enableClickableLogo:!1,showDashboard:!0,showMapTypeSelector:!1,showLocateMeButton:!1,showZoomButtons:!1,showScalebar:!1,showTrafficButton:!1,allowHidingLabelsOfRoad:!0,enableInertia:!1};e&&(i=(0,x.pi)((0,x.pi)({},i),e));var a=this.mapControlFactory.createMapControl(t,i),n=a.getZoomRange();return n&&(null!=n.min&&n.min>this.minLevelOfDetail&&(this.minLevelOfDetail=n.min),null!=n.max&&n.max<this.maxLevelOfDetail&&(this.maxLevelOfDetail=n.max)),a},o.prototype.initializeMapControl=function(){var e,t=this,i=null===(e=this.data)||void 0===e?void 0:e.properties,a=this.data?{showZoomButtons:i.showZoomButtons,mapTypeId:(0,b.N0)(i.mapTheme),minZoom:i.minZoom,maxZoom:i.maxZoom}:null;if(!this.root&&(this.root=(0,C.hi)().addClass(o.MapContainer.cssClass).css("position","absolute").appendTo(this.element[0]),!this.disableZooming)){var l,n=!1,p=function(){n&&(t.mapControl.setOptions({disableZooming:!1}),n=!1)},v=this.root[0];v.addEventListener("mouseup",function(V){0!==t.viewMode&&V.target.classList.contains("MicrosoftMap")&&(t.mapControl.setOptions({disableZooming:!0}),n=!0,l||(l=setTimeout())},!0),v.addEventListener("mouseup",p,!1)}var m=this.root,S=this.createMapControl(m[0],a);if(this.data&&i.mapTheme&&(this.mapTheme=i.mapTheme),this.data&&null!=i.autoZoomEnabled&&(this.autoZoomWasEnabled=i.autoZoomEnabled),this.mapControl=S,this.streetsideManager=new ii(S,function(V){if(V)t.dataPointRenderer.hideDataPoints();else{t.updateInternal(!0,!0),t.dataPointRenderer.showDataPoints(),t.updateZoomPanStateFromControl();var G=t.data.properties;G&&t.updateMapView(new Microsoft.Maps.Location(G.savedLatitude,G.savedLongitude),G.savedZoomLevel)}}),this.dataPointRenderer.init(S,m,!!this.behavior,this.tooltipService,this.style,this.interactivityService,this.host,this.eventManager),this.behavior&&this.dataPointLassoSelect&&this.dataPointRenderer.getPlotAreaLassoSurface){var O=this.dataPointRenderer.getPlotAreaLassoSurface(),R=d3.select(m[0]);this.plotLassoManager=new J.oW(!0),this.plotLassoManager.init([O,R],O,this.host,this.featureSwitches),this.lassoSelectionBehavior=new J.lk(this.behavior),this.plotLassoManager.behaviors.push(this.lassoSelectionBehavior),this.plotLassoManager.setUiScale(this.currentViewport.scale)}this.updateMapView(new Microsoft.Maps.Location(25,0),this.minLevelOfDetail),void 0!==this.viewChangeThrottleInterval?Microsoft.Maps.Events.addThrottledHandler(S,"viewchange",function(){t.onViewChanged()},this.viewChangeThrottleInterval):Microsoft.Maps.Events.addHandler(S,"viewchange",function(){t.onViewChanged()}),Microsoft.Maps.Events.addHandler(S,"viewchangeend",function(){t.onViewChangeEnded()}),this.streetsideManager.start(),this.pendingGeocodingRender||this.updateInternal(!0,!0),this.ensuringMap.resolve()},o.prototype.onViewChanged=function(){!this.mapControl||this.streetsideManager.InStreetsideMode||this.data&&this.data.properties.showHeatMap||(this.updateOffsets(!1,!1),this.behavior&&this.behavior.viewChanged(),this.swapLogoContainerChildElement())},o.prototype.onViewChangeEnded=function(){!this.mapControl||this.streetsideManager.InStreetsideMode||(this.onViewChanged(),this.data&&!1===this.data.properties.autoZoomEnabled&&(this.updateZoomPanStateFromControl(),this.persistZoomPanState(!1)),this.dataPointRenderer.updateInternalDataLabels(this.currentViewport,!0))},o.prototype.getMapViewPort=function(){var t=this.currentViewport,e=this.legend.getMargins();if(this.rescaleMap){var a=this.currentViewport.scale;if(a)return{width:(t.width-e.width)*a,height:(t.height-e.height)*a}}return{width:t.width-e.width,height:t.height-e.height}},o.prototype.updateInternal=function(t,e){var i=this.data&&this.data.properties;if(this.mapControl&&i){var a=this.element.children(o.MapContainer.selector),n=this.getMapViewPort();if(a.height(n.height),a.width(n.width),this.rescaleMap&&(a.css("transform","scale("+1/this.currentViewport.scale+")"),a.css("transform-origin","left top")),this.updateOffsets(t,e),this.behavior&&this.behavior.mapKeyboardAccessibility(this.host,this.data.properties.showZoomButtons),!this.behavior||!this.behavior.hasReceivedZoomOrPanEvent())if(this.shouldSetSavedLocation&&!1===i.autoZoomEnabled&&null!=i.savedLatitude&&null!=i.savedLongitude&&null!=i.savedZoomLevel)this.updateMapView(new Microsoft.Maps.Location(i.savedLatitude,i.savedLongitude),i.savedZoomLevel),this.shouldSetSavedLocation=!1;else if(this.boundsHaveBeenUpdated&&!0===i.autoZoomEnabled){var l=this.getMapView(n.width,n.height);this.updateMapView(l.center,l.levelOfDetail),this.shouldSetSavedLocation=!0}}},o.prototype.updateMapView=function(t,e){this.mapControl&&(e=Math.min(Math.max(e,this.minLevelOfDetail),this.maxLevelOfDetail),this.mapControl.setView({center:t,zoom:e,animate:!0,labelOverlay:this.data.properties.showLabels?Microsoft.Maps.LabelOverlay.visible:Microsoft.Maps.LabelOverlay.hidden}))},o.prototype.updateMapViewOnFocus=function(){var t=this.getMapViewPort(),e=this.getMapView(t.width,t.height);this.updateMapView(e.center,e.levelOfDetail)},o.prototype.updateOffsets=function(t,e){var i=this;if(!this.streetsideManager.InStreetsideMode){var n,a=this.dataView,l=this.getMapViewPort();n=a?this.dataPointRenderer.converter(l,this.data.dataLabelSettings,this.interactivityService,this.tooltipsEnabled,t):{bubbleData:[],shapeData:[],sliceData:[]};var h=this.dataPointRenderer.updateInternal(n,l,t,this.interactivityService,e,this.behavior);if(this.plotLassoManager&&(this.plotLassoManager.setUiScale(this.currentViewport.scale),this.syncLassoButton()),h&&(h.focusCallback=,(0,Q.xz)(d3.select(this.root[0]),this.legend),this.interactivityService&&h){var p=this.dataPointRenderer.getNavigationOptions();this.interactivityService.bind(h.dataPoints,this.behavior,h,{navigationOptions:p,pointSourceKey:"map"})}}},o.prototype.onClearSelection=function(){this.interactivityService.clearSelection(),this.updateOffsets(!1,!1)},o.prototype.onRestoreSelection=function(t){return!!this.interactivityService&&this.interactivityService.restoreSelection(t.selection)},o.prototype.clearDataPoints=function(){this.dataPointRenderer.clearDataPoints(),this.legend.drawLegend((0,Q.Fe)(this.style),this.currentViewport)},o.prototype.updateZoomPanStateFromControl=function(){var t=this.data&&this.data.properties;if(t){var e=this.mapControl.getCenter();t.savedLatitude=e.latitude,t.savedLongitude=e.longitude,t.savedZoomLevel=this.mapControl.getZoom()}},o.prototype.persistZoomPanState=function(t){var e=this.data&&this.data.properties,i=e&&e.autoZoomEnabled,a=e&&e.showZoomButtons,n=e&&e.showLassoButton;y.fF.assert("autoZoom state should be resolved"),e&&0!==this.viewMode&&(i||y.fF.assert("valid zoom/pan values"),this.host.persistProperties({replace:[{objectName:"mapControls",selector:null,properties:i?{autoZoom:!0,showZoomButtons:a,showLassoButton:n}:{autoZoom:!1,showZoomButtons:a,centerLatitude:e.savedLatitude,centerLongitude:e.savedLongitude,zoomLevel:e.savedZoomLevel,showLassoButton:n}}]},t))},o.prototype.syncLassoButton=function(){var t=this,i=d3.select(this.root[0]).select(b.PN);if(!i.empty()){var a=[];this.lassoButtonShouldExist()&&a.push(1);var n=i.selectAll(b.Kq).data(a),l=n.enter().append("a").classed(b.mS,!0).classed(b.Gs,!0).attr("id",b.eP).attr("title",this.host.getLocalizedString(b.TM)).attr("role","button").attr("aria-label",this.host.getLocalizedString(b.TM)).on("click",;l.append("div").classed(b.RR,!0).classed(b.tE,this.style.isHighContrast),l.merge(n).classed(b.tE,this.style.isHighContrast||this.data&&(0,f.VW)(this.data.properties.mapTheme)),n.exit().remove()}},o.prototype.lassoButtonShouldExist=function(){var t,e=null===(t=this.data)||void 0===t?void 0:t.properties;return this.data&&!e.showHeatMap&&e.showLassoButton},o.MapContainer={cssClass:"mapControl",selector:".mapControl"},o.innerGeometryAlpha=.6,o.StrokeDarkenColorValue=63.75,o.ScheduleRedrawInterval=3e3,o.MapControlDisposeDelay=1e3,o.MarkerRadiusMin=2,o.MarkerRadiusDefault=6,o.MarkerRadiusMax=20,o}();function Ae(o,t){return null!=o&&_.isFinite(o)&&null!=t&&_.isFinite(t)}var ne,Tt,he,de,ii=function(){function o(t,e){this.mapControl=t,this.changedMode=e,this.InStreetsideMode=this.mapControl.getMapTypeId()===Microsoft.Maps.MapTypeId.streetside}return o.prototype.start=function(){var t=this;Microsoft.Maps.Events.addHandler(this.mapControl,"maptypechanged",function(e){return t.mapTypeChanged(e)})},o.prototype.mapTypeChanged=function(t){if(t.newMapTypeId===Microsoft.Maps.MapTypeId.streetside){if(this.InStreetsideMode)return;this.changeMode(!0)}else{if(!this.InStreetsideMode)return;this.startTransitionToRoadTimeout()}},o.prototype.cancelTransitionToRoadTimeout=o.prototype.startTransitionToRoadTimeout=function(){var t=this;this.transitionToRoadTimeout||(this.transitionToRoadTimeout=setInterval(function(){t.mapControl.getMapTypeId()!==Microsoft.Maps.MapTypeId.streetside?null!=t.mapControl.tryLocationToPixel(new Microsoft.Maps.Location(0,0))&&t.changeMode(!1):t.cancelTransitionToRoadTimeout()},b.h$))},o.prototype.changeMode=o}();function ai(){ne&&(Tt.setTimeout=he,Tt.setInterval=de,Tt=void 0,ne=void 0)}function Ie(){if(void 0===ne){ne=!1,Tt=Microsoft.Maps;var o=_.isFunction(Tt&&Tt.setTimeout),t=_.isFunction(Tt&&Tt.setInterval);if(Tt&&o&&t)try{he=Tt.setTimeout,de=Tt.setInterval,Tt.setTimeout=function(e,i){return he.apply(this,[function(){return Me(e)},i])},Tt.setInterval=function(e,i){return de.apply(this,[i])},ne=!0}catch(e){Tt.setTimeout=he,Tt.setInterval=de,j.f.error("Unable to wrap Microsoft.Maps.setTimeout",!1,void 0,{error:e&&e.stack||JSON.stringify(e)})}else j.f.error("Unable to wrap Microsoft.Maps.setTimeout",!1,void 0,{gotMapsModule:!!Tt,setTimeoutIsFunction:o,setIntervalIsFunction:t})}}function Me(o){try{return o.apply(null)}catch(t){j.f.error("Exception in Microsoft.Maps timeout callback",!1,void 0,{error:t&&t.stack||JSON.stringify(t)})}}},58012:function(zt,yt,g){g.d(yt,{B:function(){return D}});var x=g(87941),Y=g(90016),E="BubblingEventListeners",z="BubblingEventManager",D=function(){function J(H){this.root=H,this.registeredBubblingEvents={},this.registeredCapturedEvents={},this.rootNode=H.node(),(0,Y.aT)(this.rootNode,z,this)}return J.prototype.ensureEventRegistered=function(H,et){var bt=this,Q=et?this.registeredCapturedEvents:this.registeredBubblingEvents;if(!Q[H]){Q[H]=!0;var k=et?b:vt,ut="".concat(H,".").concat(z);et&&(ut+="Capture"),this.root.on(ut,et)}},J.prototype.on=function(H,et,bt,Q){var k=et);this.ensureEventRegistered(k,!!Q);var ut=I(H,!0);if(ut){var U=ut[k];U||(ut[k]=U={bubbling:{},captured:{}}),(Q?U.captured:U.bubbling)[et]=bt}},J}();function I(J,H){var et=(0,Y.aT)(J,E);if(!et){if(!H)return;(0,Y.aT)(J,E,et={})}return et}function B(J){for(var H in J){var et=J[H];et&&et()}}function tt(J,H){for(var et=J.node(),bt=d3.event,Q=bt.target;Q;){var k=I(Q,!1);if(k){var ut=k[bt.type];ut&&H(ut)}if(Q===et)break;x.fF.assert("BubblingEventManagers cannot overlap"),Q=Q.parentElement}}function b(J){var H=[];tt(J,;for(var et=H.length;et-- >0;)B(H[et])}function vt(J){tt(J,}},24640:function(zt,yt,g){g.d(yt,{Hr:function(){return H},R_:function(){return b},jN:function(){return J},k2:function(){return vt},xr:function(){return et},y0:function(){return bt}});var x=g(26514),Y=g(87941),E=g(6266),z=g(89516),D=g(98129),F=g(89521),I=g(45696),B=g(37584),tt=g(39523);function b(k){if(k.dataView){var ut=k.enumeration,U=k.categories,f=k.supportDataPointTransparency,M=k.dataView.metadata&&k.dataView.metadata.objects,d=!!k.noDefaultFillColor,r=(0,D.NA)(M,tt.zK.dataPoint.showAllDataPoints,!!k.showAllDataPoints),s=k.dataPointTransparency,u=(0,D.W7)(M,B.mi.dataPoint.fill);if(!u)u=(0,D.W7)(M,B.mi.dataPoint.defaultColor)||k.style.colorPalette.dataColors.getColorByIndex(0).value;var T=k.fillInstanceKind;null==T&&(T=3);var C={solid:{color:u}},y={objectName:"dataPoint",selector:{data:[(0,I.Ue)(1)]},properties:{}};if(d||(_.assign(y.properties,{fill:C}),y.propertyInstanceKind={fill:T}),1&T&&(y.altConstantValueSelector=null),f&&_.assign(y.properties,{transparency:s}),_.assign(y.properties,{showAllDataPoints:r}),ut.pushInstance(y),r)for(var lt=function(rt,w){var it=U[rt],ot=it.color?it.color:C.solid.color,W=(0,z.fd)(it.identity.getSelector());k.multipleRole&&(W=(0,z.d9)(W),Y.fF.assert(function(){return!!W.data},"expect categories to have some data identity"),W.data.unshift((0,F.Yp)([k.multipleRole]))),ut.pushInstance({objectName:"dataPoint",displayName:it.displayName,selector:W,properties:{fill:{solid:{color:ot}}},propertyInstanceKind:{fill:1}})},L=0,A=U.length;L<A;L++)lt(L)}}function vt(k,ut,U){if(k.dataView){var f={fill:{objectName:"dataPoint",propertyName:"fill"},showAllDataPoints:{objectName:"dataPoint",propertyName:"showAllDataPoints"}},M=new E.CQ(new E.lg("colors"),"Visual_Colors",f,function(d){return U.getLocalizedString(d)});return M.addGroup("colors",function(d){J({colorProps:f,featureSwitches:ut,groupBuilder:d,hostService:U,options:k})}),M.build()}}function J(k){var ut=k.groupBuilder,U=k.colorProps,f=k.featureSwitches,M=k.options,d=M.categories,r=M.dataView.metadata&&M.dataView.metadata.objects,s=(0,D.NA)(r,tt.zK.dataPoint.showAllDataPoints,!!M.showAllDataPoints),u=(0,D.W7)(r,B.mi.dataPoint.fill);u||(u=(0,D.W7)(r,B.mi.dataPoint.defaultColor)||M.style.colorPalette.dataColors.getColorByIndex(0).value);var T=M.fillInstanceKind;null==T&&(T=3);var N,C={solid:{color:u}},y={value:u};if(1&T&&(N=null),U.fill){var Z=(0,x.pi)((0,x.pi)({},U.fill),{selector:{data:[(0,I.Ue)(1)]},altConstantValueSelector:N,instanceKind:T});M.noDefaultFillColor?M.hideShowAllToggle&&ut.addSimpleSlice("defaultColor",new E.tL({descriptor:Z,value:void 0}).build(),function(L){return L.withCustomDisplayName("PropertyPane_ConditionalFormatting_DialogLauncherSliceTitle")}):ut.addSimpleSlice("defaultColor",new E.BT({descriptor:Z,value:y}).build(),}U.showAllDataPoints&&!M.hideShowAllToggle&&ut.addSimpleSlice(M.disableShowAllToggle?"showAllDisabled":"showAll",new E.bd({descriptor:(0,x.pi)((0,x.pi)({},tt.zK.dataPoint.showAllDataPoints),{selector:{data:[(0,I.Ue)(1)]},altConstantValueSelector:N}),value:(0,D.NA)(r,tt.zK.dataPoint.showAllDataPoints,!!M.showAllDataPoints)}).build(),;var lt=function(A){for(var at=function(ot,W){var ht=d[ot],wt=(0,z.fd)(ht.identity.getSelector());M.multipleRole&&(wt=(0,z.d9)(wt),Y.fF.assert("expect categories to have some data identity"),wt.data.unshift((0,F.Yp)([M.multipleRole])));var Ct=f.onObjectFormatPaneUid?"datapoint":ht.displayName;Ct=M.disableShowAllToggle?"".concat(Ct,"Disabled"):Ct,ut.addSimpleSlice(Ct,new E.BT({descriptor:(0,x.pi)((0,x.pi)({},U.fill),{selector:wt,instanceKind:1}),value:{value:ht.color||C.solid.color}}).build(),function(Lt){return A?Lt.withCustomDisplayName(ht.displayName,!1).withDisabled(M.disableShowAllToggle).withHidden(!s):Lt.withCustomDisplayName(ht.displayName,!1).withDisabled(M.disableShowAllToggle)})},rt=0,w=d.length;rt<w;rt++)at(rt)};f.onObject?lt(f.onObject):s&&lt()}function H(k){for(var ut=k.enumeration,U=k.dataPoints,f=0,M=U.length;f<M;f++){var d=U[f];ut.pushInstance({objectName:"dataPoint",displayName:d.displayName,selector:(0,z.fd)(d.identity.getSelector()),properties:{fill:{solid:{color:d.color}}},propertyInstanceKind:{fill:1}})}}function et(k,ut,U){var f={fill:{objectName:"dataPoint",propertyName:"fill"}},M=d=new E.CQ(new E.lg("colors"),"Visual_Colors",f,M);return d.addGroup(void 0,,d.build()}function bt(k,ut){for(var U=k.groupBuilder,f=k.dataPoints,M=k.seriesColorProps,d=k.localize,r=k.featureSwitches,s=function(C,y){var N=f[C],Z={value:N.color},j=N.displayName||d("DataPointColorTitle"),lt=(0,z.fd)(N.identity.getSelector()),L=void 0;r.onObjectFormatPaneUid?(L="datapoint",ut&&(L="".concat(L,"-").concat(C))):L=j,U.addSimpleSlice(L,new E.BT({descriptor:(0,x.pi)((0,x.pi)({},M.fill),{selector:lt,instanceKind:1}),value:Z}).build(),function(A){return A.withCustomDisplayName(j,!1).withDisabled(ut&&!(0,z.fS)(ut,lt))})},u=0,c=null==f?void 0:f.length;u<c;u++)s(u)}},15568:function(zt,yt,g){g.d(yt,{_I:function(){return B},_u:function(){return tt},qQ:function(){return I}});var x=g(26514),Y=g(7300),E=g(14253),z=g(1849),D=g(2570),F=g(87810);function I(f,M,d){var r=function(f,M,d){var r=U(f,M,"width"),s=U(f,M,"height"),u=d.parentShape;return{width:r,height:s,top:null!=u&&u.rect?u.rect.top:0,left:null!=u&&u.rect?u.rect.left:0}}(f,M,d),s=Math.floor(function(f,M,d){var r=M.parentShape,s=f.optimizeLabelDisplay?f.labelContainerMaxWidth:Y.w9;if(f.position===z.d7&&!f))return s;var u=function(f){if(null==f||!f.rect)return f;var M={horizontalBuffer:2*D.Bo,verticalBuffer:2*D.d1},d=M.horizontalBuffer,r=M.verticalBuffer,s=(0,x.pi)((0,x.pi)({},f.rect),{width:f.rect.width-d,height:f.rect.height-r});return(0,x.pi)((0,x.pi)({},f),{rect:s})}(r);return function(f,M,d){if(null==M||!M.rect)return!1;var r=d.width,s=d.height,u=M.rect,c=u.width,T=u.height;switch(f.labelOrientation){case 1:return r<=c&&s<=T;case 0:return r<=T&&s<=c;default:return!0}}(f,u,d)||null==r||!r.orientation?s:f.labelOverflow?f.labelOverflow&&!f.optimizeLabelDisplay?Y.w9:s:Math.min(s,1===f.labelOrientation?u.rect.width:u.rect.height)}(M,d,r));(function(f,M,d){switch(f.position){case z.EZ:case z.FY:case z.yJ:return f.labelOverflow&&f.optimizeLabelDisplay||M.width>=d;case z.aE:case z.wv:case z.di:return f.optimizeLabelDisplay&&M.width>=d;case z.d7:return f.optimizeLabelDisplay;default:return!1}})(M,r,s)&&tt(f,s,M.labelContentLayout)}function B(f,M){var d=(0,F.qk)(f,M);return{width:E.b.measureSvgTextWidth(d),height:E.b.estimateSvgTextHeight(d,!0)}}function tt(f,M,d,r){void 0===r&&(r=0);for(var s=f.length,u=M,c=0,T=0,C=f;T<C.length;T++){var y=C[T],N=Math.floor(u/s);if(y.textSize.width>=N){var Z=(0,F.qk)(y.fontProperties,y.text);y.text=E.b.getTailoredTextOrDefault(Z,N),Z.text=y.text;var j=y.textSize.width;y.textSize={width:E.b.measureSvgTextWidth(Z),height:E.b.estimateSvgTextHeight(Z,!0)},c+=j-y.textSize.width}s--}if((u-=c)<0)!function(f,M){if(!(f>=0)){var d=M.every(;if(d)for(;f<0&&M.length>1;)f+=M.pop().textSize.width}}(u,f);else{var lt=function(f,M){return"SingleLine"===M?f.reduce(0):Math.max.apply(Math,f.map()}(f,d);lt>M&&r<5&&tt(f,M,d,r+1)}}function U(f,M,d){for(var r=0,s=0,u=f;s<u.length;s++){var T=u[s].textSize[d];"SingleLine"===(null==M?void 0:M.labelContentLayout)?r+=T+D.uM:r=Math.max(r,T)}return r}},25150:function(zt,yt,g){g.d(yt,{R:function(){return Y}});var x=g(15552);function Y(E,z,D,F,I){var B,vt,J,H,tt=z,b=D;switch(I){case x.x0.PreviousCategory:case x.x0.NextCategory:if(F===x.jN.SeriesOnly)break;J=I===x.x0.PreviousCategory?-1:1,vt=_.filter(E,function(et){return et.seriesIndex===D}),(H=J+_.findIndex(vt,)>=vt.length&&(H=0),H<0&&(H=vt.length-1),tt=vt[H].categoryIndex;break;case x.x0.NextSeries:case x.x0.PreviousSeries:if(F===x.jN.CategoryOnly)break;(H=(J=I===x.x0.PreviousSeries?-1:1)+_.findIndex(E,)>=E.length&&(H=0),H<0&&(H=E.length-1),tt=(B=[E[H].categoryIndex,E[H].seriesIndex])[0],b=B[1]}return{categoryIndex:tt,seriesIndex:b}}},95062:function(zt,yt,g){g.d(yt,{G:function(){return E}});var x=g(87941),Y=g(89516),E=function(){eturn z.prototype.pushInstance=function(D,F){void 0===F&&(F=!0),x.fF.assertValue(D,"instance");var I=this.instances;I||(I=this.instances=[]);var B=this.containerIdx;if(null!=B&&(D.containerIdx=B),F)for(var tt=0,b=I;tt<b.length;tt++){var vt=b[tt];if(this.canMerge(vt,D))return this.extend(vt,D,"properties"),this.extend(vt,D,"validValues"),this}return I.push(D),this},z.prototype.pushContainer=function(D){x.fF.assertValue(D,"container");var F=this.containers;F||(F=this.containers=[]);var I=F.push(D);return this.containerIdx=I-1,this},z.prototype.popContainer=z.prototype.complete=function(){if(this.instances){var D={instances:this.instances},F=this.containers;return F&&(D.containers=F),D}},z.prototype.canMerge=function(D,F){return x.fF.assertValue(D,"x"),x.fF.assertValue(F,"y"),D.objectName===F.objectName&&D.containerIdx===F.containerIdx&&(0,Y.fS)(D.selector,F.selector)},z.prototype.extend=function(D,F,I){x.fF.assertValue(D,"target"),x.fF.assertValue(F,"source"),x.fF.assertValue(I,"propertyName");var B=F[I];if(B){var tt=D[I];for(var b in tt||(tt=D[I]={}),B)tt[b]||(tt[b]=B[b])}},z.merge=function(D,F){var I=z.normalize(D),B=z.normalize(F);if(!I||!B)return I||B;x.fF.assertValue(I,"xNormalized"),x.fF.assertValue(B,"yNormalized");for(var tt=I.containers?I.containers.length:0,b=0,vt=B.instances;b<vt.length;b++){var J=vt[b];I.instances.push(J),null!=J.containerIdx&&(J.containerIdx+=tt)}var H=B.containers;return _.isEmpty(H)||(I.containers?Array.prototype.push.apply(I.containers,H):I.containers=H),I},z.normalize=function(D){return x.fF.assertAnyValue(D,"x"),_.isArray(D)?{instances:D}:D},z.getContainerForInstance=function(D,F){return x.fF.assertValue(D,"enumeration"),x.fF.assertValue(F,"instance"),x.fF.assertValue(D.containers,"containers"),x.fF.assert("no container found in containers collection"),D.containers[F.containerIdx]},z}()},70664:function(zt,yt,g){g.d(yt,{Ad:function(){return Y},HN:function(){return E},U4:function(){return x},yn:function(){return z}});var x={min:1,max:3},Y={min:-30,max:100};function E(D){return x.min+(null!=D?D:0)/100*x.max}function z(D){return Math.round((D-x.min)/x.max*100)}},44728:function(zt,yt,g){g.d(yt,{qC:function(){return et},nu:function(){return bt}});var x=g(26514),Y=g(87941),E=g(64365),z=g(44888),D=g(2570),F=g(87810),I=g(11051);function B(d,r,s){var c=d.labelDataPoint.parentShape;if(null!=c)switch(r){case 1:case 32:switch(c.orientation){case 1:case 2:return(0,I.Vq)(d.labelSize,c.rect,s);case 3:case 4:return(0,I.um)(d.labelSize,c.rect,s)}case 2:case 64:switch(c.orientation){case 1:return(0,I.jb)(d.labelSize,c.rect,s);case 2:return(0,I.ug)(d.labelSize,c.rect,s);case 3:return(0,I.e6)(d.labelSize,c.rect,s);case 4:return(0,I.QS)(d.labelSize,c.rect,s)}case 4:case 128:switch(c.orientation){case 1:return(0,I.ug)(d.labelSize,c.rect,s);case 2:return(0,I.jb)(d.labelSize,c.rect,s);case 3:return(0,I.QS)(d.labelSize,c.rect,s);case 4:return(0,I.e6)(d.labelSize,c.rect,s)}case 8:switch(c.orientation){case 1:return(0,I.O5)(d.labelSize,c.rect,s);case 2:return(0,I.ZN)(d.labelSize,c.rect,s);case 3:return(0,I._f)(d.labelSize,c.rect,s);case 4:return(0,I.cx)(d.labelSize,c.rect,s)}case 16:switch(c.orientation){case 1:return(0,I.ZN)(d.labelSize,c.rect,s);case 2:return(0,I.O5)(d.labelSize,c.rect,s);case 3:return(0,I.cx)(d.labelSize,c.rect,s);case 4:return(0,I._f)(d.labelSize,c.rect,s)}default:Y.fF.assertFail("Unsupported label position")}return null}var b=g(70679),vt=g(49803),J=g(69327),H=g(15568),et=function(){function d(r,s){this.viewport=s;for(var u=0,c=0,T=0,C=r;T<C.length;T++)for(var N=0,Z=C[T].labelDataPoints;N<Z.length;N++){var lt=Z[N].labelSize;lt.width>u&&(u=lt.width),lt.height>c&&(c=lt.height)}0===u&&(u=s.width),0===c&&(c=s.height);var L=this.cellSize={width:u*d.cellSizeMultiplier,height:c*d.cellSizeMultiplier};this.columnCount=d.getCellCount(L.width,s.width,1,100),this.rowCount=d.getCellCount(L.height,s.height,1,100);for(var A=[],at=0,rt=this.columnCount;at<rt;at++){A[at]=[];for(var w=0,it=this.rowCount;w<it;w++)A[at][w]=[]}this.grid=A}return d.prototype.add=function(r){var s=this;Y.fF.assert(function(){return(0,E.bA)(r.left,0)&&(0,E.bl)(r.left+r.width,s.viewport.width)&&(0,E.bA)(r.top,0)&&(0,E.bl)(r.top+r.height,s.viewport.height)},"LabelArrangeGrid.add received a rectangle outside the grid");for(var u=this.getContainingGridSubsection(r),c=u.xMin;c<u.xMax;c++)for(var T=u.yMin;T<u.yMax;T++)this.grid[c][T].push(r)},d.prototype.addCheckSeries=function(r){for(var s=this.getContainingGridSubsection(r),u=s.xMin;u<s.xMax;u++)for(var c=s.yMin;c<s.yMax;c++)this.grid[u][c].push(r)},d.prototype.hasConflict=d.prototype.tryPositionInViewport=function(r){if(this.isCloseToGridViewport(r)&&(this.isWithinGridViewport(r)||(r=this.tryMoveInsideViewport(r)),r&&!this.hasCollision(r)))return r},d.prototype.trySeriesLabelPositionInViewport=function(r){if(this.isCloseToGridViewport(r)&&(this.isWithinGridViewport(r)||(r=this.trySeriesLabelMoveInsideViewport(r)),r&&!this.hasCollision(r)))return r},d.prototype.hasCollision=function(r){for(var s=this.getContainingGridSubsection(r),u=this.grid,c=z.HL,T=s.xMin;T<s.xMax;T++)for(var C=s.yMin;C<s.yMax;C++)for(var y=0,N=u[T][C];y<N.length;y++)if(c(N[y],r))return!0;return!1},d.prototype.isWithinGridViewport=function(r){return r.left>=0&&r.top>=0&&r.left+r.width<=this.viewport.width&&r.top+r.height<=this.viewport.height},d.prototype.isCloseToGridViewport=function(r){return r.left+r.width>=0-r.width&&r.top+r.height>=-r.height&&r.left<=this.viewport.width+r.width&&r.top<=this.viewport.height+r.height},d.prototype.tryMoveInsideViewport=function(r){var s=(0,z.d9)(r),u=this.viewport;if(!(r.width>u.width||r.height>u.height))return r.left<0?s.left=0:r.left+r.width>u.width&&(s.left-=r.left+r.width-u.width),r.top<0?s.top=0:r.top+r.height>u.height&&(s.top-=r.top+r.height-u.height),s},d.prototype.trySeriesLabelMoveInsideViewport=function(r){var s=(0,z.d9)(r),u=this.viewport;if(!(r.height>u.height))return r.left<0&&(s.left=0),r.top<0?s.top=0:r.top+r.height>u.height&&(s.top-=r.top+r.height-u.height),s},d.prototype.getContainingGridSubsection=function(r){return{xMin:d.bound(Math.floor(r.left/this.cellSize.width),0,this.columnCount),xMax:d.bound(Math.ceil((r.left+r.width)/this.cellSize.width),0,this.columnCount),yMin:d.bound(Math.floor(r.top/this.cellSize.height),0,this.rowCount),yMax:d.bound(Math.ceil((r.top+r.height)/this.cellSize.height),0,this.rowCount)}},d.getCellCount=function(r,s,u,c){return d.bound(Math.ceil(s/r),u,c)},d.bound=d.cellSizeMultiplier=2,d}(),bt=function(){function d(r){this.startingOffset=r.startingOffset,this.maximumOffset=r.maximumOffset,null!=r.offsetIterationDelta?(Y.fF.assert("label offset delta must be greater than 0"),this.offsetIterationDelta=r.offsetIterationDelta):this.offsetIterationDelta=d.defaultOffsetIterationDelta,this.horizontalPadding=null!=r.horizontalPadding?r.horizontalPadding:d.defaultHorizontalPadding,this.verticalPadding=null!=r.verticalPadding?r.verticalPadding:d.defaultVerticalPadding,this.shrinkLeaderLinesForBestFit=!!r.shrinkLeaderLinesForBestFit,this.drawLeaderLinesIgnoreOffset=!!r.drawLeaderLinesIgnoreOffset,this.allowLeaderLines=!!r.allowLeaderLines,this.attemptToMoveLabelsIntoViewport=!!r.attemptToMoveLabelsIntoViewport}return d.prototype.computeLabelSize=function(r,s){var u=function(rt){var w={width:0,height:0},it=rt.textSize,ot=it.width,W=it.height;return 0===s?(w.width=W,w.height=ot):(w.width=ot,w.height=W),r.wordBreak&&(w.height+=rt.fontProperties.size.px),w},c={width:0,height:0};if((0,J.r)(r))for(var T=r.labelDataPointContents.length,C=0;C<T;C++){var N=r.contentLayout,Z=u(r.labelDataPointContents[C]),j=Z.width,lt=Z.height,L=0===s;if("MultiLine"===N)if(L){var A=0!==C?D.i1:0;c.width=Math.max(c.width,lt),c.height+=j+A}else A=0!==C?D.i1:0,c.width=Math.max(c.width,j),c.height+=lt+A;else"SingleLine"===N&&(L?(A=0!==C?D.uM:0,c.width=Math.max(c.width,j),c.height+=lt+A):(c.width+=j+(A=0!==C?D.uM:0),c.height=Math.max(c.height,lt)))}else c=u(r);return r.hasBackground?0===s?{width:c.width+2*D.d1,height:c.height+2*D.Bo}:{width:c.width+2*D.Bo,height:c.height+2*D.d1}:c},d.prototype.layout=function(r,s){for(var c=[],T=0,C=r;T<C.length;T++){for(var y=C[T],N=_.map(y.labelDataPoints,,Z=y.labelOrientation,j=0,lt=N;j<lt.length;j++){var L=lt[j];L.hasBeenRendered=!1,L.labelSize=this.computeLabelSize(L.labelDataPoint,Z)}c.push({labelDataPoints:N,maxNumberOfLabels:y.maxNumberOfLabels,labelOrientation:y.labelOrientation,offset:y.offset})}for(var A=[],at=new et(c,s),rt=c.length>1,w=0,it=c;w<it.length;w++){for(var ot=it[w],W=ot.maxNumberOfLabels,ht=(N=_.clone(ot.labelDataPoints),[]),wt=(Z=ot.labelOrientation,N.length-1),Ct=W;wt>=0&&Ct>0;wt--)N[wt].labelDataPoint.isPreferred&&(ht.unshift(N.splice(wt,1)[0]),Ct--);if(ht.length>0&&(W-=(Ft=this.positionDataLabels(ht,s,at,W,Z,rt,ot.offset)).length,A=A.concat(Ft)),N.length>0){var Ft=this.positionDataLabels(N,s,at,W,Z,rt,ot.offset);A=A.concat(Ft)}}return this.filterLabelInstancesByVisibility(A)},d.prototype.filterLabelInstancesByVisibility=function(r){return _.filter(r,function(u){return(0,vt.CC)(c=u)?c.labelContents.some(:c.isVisible;var c})},d.prototype.drawLeaderLinesOnIteration=function(r,s){if(!this.allowLeaderLines)return!1;var u=s.labelDataPoint;return!((0,J.r)(u)?u.labelDataPointContents.every(function(T){return _.isEmpty(T.text)}):_.isEmpty(u.text))&&(!(!this.drawLeaderLinesIgnoreOffset||!s.enableLeaderLine)||r>this.startingOffset)},d.prototype.determineMaximumOffset=function(r,s){var u,c=null!==(u=null==s?void 0:s.max)&&void 0!==u?u:this.maximumOffset;return r>=c?r:c},d.prototype.positionDataLabels=function(r,s,u,c,T,C,y){for(var N,Z=[],j=this.offsetIterationDelta,lt=0,L=0,A=null!==(N=null==y?void 0:y.min)&&void 0!==N?N:this.startingOffset,at=this.determineMaximumOffset(A,y),rt=A;rt<=at&&L<c;){for(var w=0,it=r;w<it.length;w++){var ot=it[w];if(!ot.hasBeenRendered){var ht=void 0;if(1===ot.labelDataPoint.parentType)ht=this.tryPositionForRectPositions(ot,u,rt,lt,T,C);else{var wt=this.drawLeaderLinesOnIteration(rt,ot);ht=this.tryPositionForPointPositions(ot,u,rt,wt,T)}if(ht&&(Z.push(ht),L++),!(L<c))break}}rt+=j,lt+=j}return Z},d.prototype.tryPositionForRectPositions=function(r,s,u,c,T,C){var y=this,N=r.labelDataPoint,lt=function(it,ot,W){void 0===W&&(W=0),function(it){var ot,W,ht,wt;if(it>0&&(0,J.r)(N)){var Ct=0===T?null!==(W=null===(ot=r.labelSize)||void 0===ot?void 0:ot.height)&&void 0!==W?W:0:null!==(wt=null===(ht=r.labelSize)||void 0===ht?void 0:ht.width)&&void 0!==wt?wt:0;(0,H._u)(N.labelDataPointContents,Ct*(1-it),"SingleLine"===N.contentLayout?"SingleLine":"MultiLine"),r.labelSize=y.computeLabelSize(N,T)}}(W);var ht=d.tryPositionRect(s,it,r,u,c,ot);return ht&&function(it,ot){var ht=!!(224&it);return!(7&it&&!function(d,r,s,u){var c=r.parentShape.rect,T=(0,z.rr)(d,{left:s,right:s,top:u,bottom:u});return(0,z.BD)(c,{x:T.left,y:T.top})&&(0,z.BD)(c,{x:T.left+T.width,y:T.top+T.height})}(ot,N,y.horizontalPadding,y.verticalPadding)||ht&&!function(d,r,s){var u=r.parentShape.rect;if(!(0,z.HL)(d,u))return!1;var c=(0,z.wf)(d,u),T=.09,C=(0,E.GG)(c.top,d.top,T)&&(0,E.GG)(c.height,d.height,T),y=(0,E.GG)(c.left,d.left,T)&&(0,E.GG)(c.width,d.width,T),N=_.includes([1,2],r.parentShape.orientation);if(!y&&!C||s&&(N&&!C||!N&&!y))return!1;if(y&&C)return!0;var Z=function(d,r){var s=r.width*r.height,u=d.width*d.height,c=Math.max(s,u);if(0===c)return 0;var T=Math.min(s,u),C=0!==T?T:c,y=(0,z.wf)(r,d);return y.width*y.height/C}(d,u)>=.2,j=!1;return C?j=0===u.width||u.width/d.width>b.w:y&&(j=0===u.height||u.height/d.height>b.w),Z&&j}(ot,N,C))}(it,ht)?(s.add(ht),r.hasBeenRendered=!0,y.createLabelInstanceForRectPosition(N,T,ht,it)):null},L=N.parentShape.validPositions,A=function w(it,ot,W){void 0===ot&&(ot=!1),void 0===W&&(W=0);for(var Ct=ot?.03*(W+1):0,Lt=0,Ft=L;Lt<Ft.length;Lt++){var jt=lt(Ft[Lt],it,Ct);if(jt)return jt}return!ot||W>=33.333333333333336?null:w(it,ot,W+1)},at=A(!1);if(at)return at;if(this.attemptToMoveLabelsIntoViewport){var rt=A(!0);if(rt)return rt}},d.prototype.createLabelInstanceForRectPosition=function(r,s,u,c){var T=!!(231&c),C={boundingBox:u,tooltip:r.tooltip,isVisible:!0,identity:r.identity,key:r.key,hasBackground:r.hasBackground,labelOrientation:s,backgroundColor:r.backgroundColor,backgroundTransparency:r.backgroundTransparency};if((0,J.r)(r)){var N=r.labelDataPointContents.map(function(j){return{text:j.text,role:j.role,transparency:j.transparency,fontProperties:(0,F.ED)(j.fontProperties,{color:(lt=j,T?lt.insideFill:lt.outsideFill)}),isVisible:!0,textSize:j.textSize};var lt});return(0,x.pi)((0,x.pi)({},C),{labelContents:N,wordBreak:r.wordBreak,contentLayout:r.contentLayout,textAnchor:"unset",alignment:r.alignment})}var Z=T?r.insideFill:r.outsideFill;return(0,x.pi)((0,x.pi)({},C),{text:r.text,fontProperties:(0,F.ED)(r.fontProperties,{color:Z}),selected:!1,isTotal:r.isTotal,isCategory:r.isCategory})},d.tryPositionRect=function(r,s,u,c,T,C){var y=[1,32].includes(s),N=y?T:c,Z=B(u,s,N);return y&&0===u.labelDataPoint.parentShape.orientation?this.checkLabelPosition(r,Z,C)||this.checkLabelPosition(r,B(u,s,-N),C):this.checkLabelPosition(r,Z,C)},d.checkLabelPosition=function(r,s,u){return r.hasConflict(s)?u?r.tryPositionInViewport(s):null:s},d.prototype.getLeaderLinePoints=function(r,s,u){var c=function(d,r,s){var u=d.left,c=d.top;switch(r){case 1:u+=d.width/2,c+=d.height;break;case 2:u+=d.width/2;break;case 4:u+=d.width,c+=2*d.height/3;break;case 8:c+=2*d.height/3;break;case 32:u+=d.width,c+=d.height/2;break;case 16:c+=d.height/2;break;case 128:u+=d.width,c+=d.height;break;case 64:c+=d.height}return[[s.point.x,s.point.y],[u,c]]}(r,s,u);if(!this.shrinkLeaderLinesForBestFit)return c;var C=(r.height+2*D.d1)/2,y=c[0],N=y[0],Z=y[1],j=c[1],A=j[0]-N,at=j[1]-Z,rt=Math.sqrt(Math.pow(A,2)+Math.pow(at,2)),w=(rt-C/2)/rt;return[[N,Z],[N+A*w,Z+at*w]]},d.prototype.tryPositionForPointPositions=function(r,s,u,c,T){for(var C=this,y=r.labelDataPoint,N=function(w,it,ot){var W=d.tryPositionPoint(s,w,r,u,ot);if(W){512===w?s.addCheckSeries(W):s.add(W),r.hasBeenRendered=!0;var ht=c?C.getLeaderLinePoints(W,w,it):null;return(0,J.r)(y)?{boundingBox:W,labelContents:y.labelDataPointContents.map(function(Ct,Lt){return{text:Ct.text,role:Ct.role,transparency:Ct.transparency,fontProperties:(0,F.ED)(Ct.fontProperties,{color:256===w?Ct.insideFill:Ct.outsideFill}),isVisible:!0,textSize:Ct.textSize}}),tooltip:y.tooltip,hasBackground:!!y.hasBackground,labelOrientation:T,key:y.key,identity:y.identity,leaderLinePoints:ht,backgroundColor:y.backgroundColor,backgroundTransparency:y.backgroundTransparency,wordBreak:y.wordBreak,contentLayout:y.contentLayout,alignment:y.alignment,selected:!1,textAnchor:"unset",leaderLineProperties:y.leaderLineProperties}:{boundingBox:W,text:y.text,tooltip:y.tooltip,isVisible:!0,isInsideParent:256===w,identity:y.identity,key:y.key,fontProperties:(0,F.ED)(y.fontProperties,{color:256===w?y.insideFill:y.outsideFill}),selected:!1,leaderLinePoints:ht,hasBackground:!!y.hasBackground,labelOrientation:T,backgroundColor:y.backgroundColor,backgroundTransparency:y.backgroundTransparency,wordBreak:y.wordBreak,isTotal:y.isTotal,isCategory:y.isCategory}}},Z=y.parentShape,j=Z.validPositions,lt=0,L=j;lt<L.length;lt++)if(at=N(L[lt],Z,!1))return at;var at;return this.attemptToMoveLabelsIntoViewport&&!_.isEmpty(j)&&(at=N(j[0],Z,!0))?at:null},d.tryPositionPoint=function(r,s,u,c,T){var C=(0,b.c)(u.labelSize,u.labelDataPoint.parentShape,s,c);return r.hasConflict(C)?T?512===s?r.trySeriesLabelPositionInViewport(C):r.tryPositionInViewport(C):null:C},d.defaultOffsetIterationDelta=2,d.defaultHorizontalPadding=2,d.defaultVerticalPadding=2,d}()},70679:function(zt,yt,g){g.d(yt,{c:function(){return z},w:function(){return E}});var x=g(87941),Y=g(11051),E=.02;function z(D,F,I,B){switch(I){case 1:return(0,Y.aE)(D,F.point,F.radius+B);case 2:return(0,Y.B2)(D,F.point,F.radius+B);case 4:return(0,Y.t$)(D,F.point,F.radius+B);case 8:return(0,Y.F2)(D,F.point,F.radius+B);case 32:return(0,Y.I6)(D,F.point,F.radius+B);case 16:return(0,Y.W7)(D,F.point,F.radius+B);case 128:return(0,Y.Q$)(D,F.point,F.radius+B);case 64:return(0,Y.kx)(D,F.point,F.radius+B);case 256:return(0,Y.be)(D,F.point);case 512:return(0,Y.BV)(D,F.point);default:x.fF.assertFail("Unsupported label position")}return null}},11051:function(zt,yt,g){g.d(yt,{B2:function(){return z},BV:function(){return J},F2:function(){return F},I6:function(){return I},O5:function(){return ut},Q$:function(){return tt},QS:function(){return bt},Vq:function(){return d},W7:function(){return B},ZN:function(){return k},_f:function(){return f},aE:function(){return E},be:function(){return vt},cx:function(){return U},e6:function(){return Q},fB:function(){return Y},jb:function(){return et},kx:function(){return b},nK:function(){return x},t$:function(){return D},ug:function(){return H},um:function(){return M}});var x=Math.cos(45),Y=Math.sin(45);function E(r,s,u){return{left:s.x-r.width/2,top:s.y-u-r.height,width:r.width,height:r.height}}function z(r,s,u){return{left:s.x-r.width/2,top:s.y+u,width:r.width,height:r.height}}function D(r,s,u){return{left:s.x-u-r.width,top:s.y-r.height/2,width:r.width,height:r.height}}function F(r,s,u){return{left:s.x+u,top:s.y-r.height/2,width:r.width,height:r.height}}function I(r,s,u){return{left:s.x-Y*u-r.width,top:s.y+x*u,width:r.width,height:r.height}}function B(r,s,u){return{left:s.x+Y*u,top:s.y+x*u,width:r.width,height:r.height}}function tt(r,s,u){return{left:s.x-Y*u-r.width,top:s.y-x*u-r.height,width:r.width,height:r.height}}function b(r,s,u){return{left:s.x+Y*u,top:s.y-x*u-r.height,width:r.width,height:r.height}}function vt(r,s){return{left:s.x-r.width/2,top:s.y-r.height/2,width:r.width,height:r.height}}function J(r,s){return{left:s.x,top:s.y-r.height/2,width:r.width,height:r.height}}function H(r,s,u){return{left:s.left+s.width/2-r.width/2,top:s.top+u,width:r.width,height:r.height}}function et(r,s,u){return{left:s.left+s.width/2-r.width/2,top:s.top+s.height-u-r.height,width:r.width,height:r.height}}function bt(r,s,u){return{left:s.left+s.width-r.width-u,top:s.top+s.height/2-r.height/2,width:r.width,height:r.height}}function Q(r,s,u){return{left:s.left+u,top:s.top+s.height/2-r.height/2,width:r.width,height:r.height}}function k(r,s,u){return{left:s.left+s.width/2-r.width/2,top:s.top-r.height-u,width:r.width,height:r.height}}function ut(r,s,u){return{left:s.left+s.width/2-r.width/2,top:s.top+s.height+u,width:r.width,height:r.height}}function U(r,s,u){return{left:s.left+s.width+u,top:s.top+s.height/2-r.height/2,width:r.width,height:r.height}}function f(r,s,u){return{left:s.left-r.width-u,top:s.top+s.height/2-r.height/2,width:r.width,height:r.height}}function M(r,s,u){return{left:s.left+s.width/2-r.width/2+u,top:s.top+s.height/2-r.height/2,width:r.width,height:r.height}}function d(r,s,u){return{left:s.left+s.width/2-r.width/2,top:s.top+s.height/2-r.height/2+u,width:r.width,height:r.height}}},57398:function(zt,yt,g){g.d(yt,{r:);var x=g(87941),Y=g(26514),E=g(32178);function D(B){var tt=B.tooltips();return x.fF.assertValue(tt,"visualHostTooltipService"),new I(tt)}var I=function(){function B(tt,b){var k,ut;void 0===b&&(b=1e3),this.visualHostTooltipService=tt,this.tooltipEventsRegistrator=(k=function(){function U(f,M){var d=this;this.handleTouchDelay=M,this.handleTouchTooltipHideDelay=2e3,this.preventContextMenuHandler=function(r){r.preventDefault(),r.stopPropagation(),d.visualElement&&d.visualElement.removeEventListener("contextmenu",d.preventContextMenuHandler,!0)},this.ignoreMouseoutEvent=!1,this.forceRefreshData=!1,this.visualHostTooltipService=f,this.rootNode=this.visualHostTooltipService.container()}return U.prototype.showTooltip=function(f,M,d,r,s,u,c,T){if(this.canDisplayTooltip(f,u)){this.visualElement&&this.visualElement.removeEventListener("contextmenu",this.preventContextMenuHandler,!0);var C=d3.event;this.visualElement=$(C.target).parent().get(0),f&&this.visualElement&&this.visualHostTooltipService.isTouchScreenOptimizedEnabled()&&(this.ignoreMouseEventsTimeoutId&&clearTimeout(this.ignoreMouseEventsTimeoutId),this.visualElement.addEventListener("contextmenu",this.preventContextMenuHandler,!0)),this.touchOriginTooltipShowing=f;var y=this.makeTooltipEventArgs(f);if(y){var N;if((r||f||this.forceRefreshData)&&(this.forceRefreshData=!1,null==(N=M(y))))return void(s&&this.visualHostTooltipService.hide({isTouchEvent:f,immediately:!1}));var Z=d(y),j=Z&&Z.map(function(A){return(0,Y.pi)((0,Y.pi)({},A.getSelectorsByColumn()),{exclude:A.exclude})}),lt=Z&&Z.map(,L=d3.event;"touch"===L.pointerType&&(L.tooltip=!0),this.visualHostTooltipService.show({coordinates:y.coordinates,isTouchEvent:f,dataItems:N,identities:j,roles:lt,suppressAnnouncements:c,showByDefaultOverride:T}),f&&!this.visualHostTooltipService.isTouchScreenOptimizedEnabled()&&this.startTouchHideTooltipTimeout()}}},U.prototype.hideTooltip=function(f,M){"pointerleave"===M&&f||"mouseout"===M&&this.ignoreMouseoutEvent||(this.touchOriginTooltipShowing=!1,clearTimeout(this.handleTouchTooltipHideId),this.visualHostTooltipService.hide({isTouchEvent:f,immediately:"pointerdown"===M}))},U.prototype.getCoordinates=function(f){for(var r,d=d3.event;r=d.sourceEvent;)d=r;var s=f.getBoundingClientRect(),u=d.clientX,c=d.clientY;if(null==u||null==c){var T=d3.event;x.fF.assert("only non-mouse/touch events (e.g., 'keydown') should get here");var y=T.target.getBoundingClientRect();u=y.left+y.width/2,c=y.top+y.height/2}return[u-s.left-f.clientLeft,c-s.top-f.clientTop]},U.prototype.makeTooltipEventArgs=function(f){var M=this.getCoordinates(this.rootNode),d=f?document.elementFromPoint(M[0],M[1]):d3.event.target;return{data:d3.select(d).datum(),coordinates:M,elementCoordinates:this.getCoordinates(d),context:d,isTouchEvent:f}},U.prototype.startTouchHideTooltipTimeout=function(){var f=this;this.handleTouchTooltipHideId&&clearTimeout(this.handleTouchTooltipHideId),this.handleTouchTooltipHideId=setTimeout(this.handleTouchTooltipHideDelay)},U.prototype.startIgnoreMouseEventsTimeout=function(){var f=this;this.ignoreMouseEventsTimeoutId&&clearTimeout(this.ignoreMouseEventsTimeoutId),this.ignoreMouseEventsTimeoutId=setTimeout(function(){f.visualElement&&f.visualElement.removeEventListener("contextmenu",f.preventContextMenuHandler,!0),f.ignoreMouseEventsTimeoutId=void 0,f.forceRefreshData=!0},this.handleTouchDelay)},U.prototype.canDisplayTooltip=function(f,M){return!(!f&&("pointerdown"===M||this.touchOriginTooltipShowing||void 0!==this.ignoreMouseEventsTimeoutId))},U}(),ut=function(){eturn U.prototype.unregisterEvents=U.prototype.registerEvents=U.prototype.hasPointerTypeTouch=U.prototype.onPointerEnd=function(){if(this.tooltipServiceDelegate.startIgnoreMouseEventsTimeout(),this.visualHostTooltipService.visible()&&this.visualHostTooltipService.isTouchScreenOptimizedEnabled())this.tooltipServiceDelegate.ignoreMouseoutEvent=!0;else{var f=d3.event;this.tooltipServiceDelegate.hideTooltip(this.hasPointerTypeTouch(f),f.type)}},U.prototype.moveThresholdReached=function(f,M){var d=f-this.initialX,r=M-this.initialY;return Math.sqrt(d*d+r*r)>this.moveThreshold},U.prototype.registerTooltipEvents=function(f,M,d,r,s,u){var T,c=this;f.on("pointerover.tooltip",function(){var C=d3.event;c.hasPointerTypeTouch(C)||c.tooltipServiceDelegate.showTooltip(c.hasPointerTypeTouch(C),M,d,!0,!1,C.type,s,u)}),f.on("keydown.tooltip",function(){var C=d3.event;E.M.isCtrlOrMeta(C)&&72===C.keyCode&&(C.target===T&&c.visualHostTooltipService.visible()?c.tooltipServiceDelegate.hideTooltip(!1,C.type):c.tooltipServiceDelegate.showTooltip(c.hasPointerTypeTouch(C),M,d,!0,!1,C.type,s,u),T=C.target,C.preventDefault())}),f.on("pointerleave.tooltip",function(){var C=d3.event;c.tooltipServiceDelegate.hideTooltip(c.visualHostTooltipService.isTouchScreenOptimizedEnabled()&&c.hasPointerTypeTouch(C),C.type)}),f.on("mouseout.tooltip",function(){var C=d3.event;c.tooltipServiceDelegate.hideTooltip(c.visualHostTooltipService.isTouchScreenOptimizedEnabled()&&c.hasPointerTypeTouch(C),C.type)}),f.on("pointermove.tooltip",function(){var C=d3.event;c.tooltipServiceDelegate.ignoreMouseoutEvent=!1,c.visualHostTooltipService.visible()||!c.hasPointerTypeTouch(C)?c.tooltipServiceDelegate.showTooltip(c.hasPointerTypeTouch(C),M,d,r,!0,C.type,s,u):c.moveThresholdReached(C.screenX,C.screenY)&&c.tooltipServiceDelegate.hideTooltip(c.hasPointerTypeTouch(C),C.type)}),f.on("pointerdown.tooltip",function(){var C=d3.event;c.initialX=C.screenX,c.initialY=C.screenY,c.tooltipServiceDelegate.showTooltip(c.hasPointerTypeTouch(C),M,d,!0,!c.visualHostTooltipService.isTouchScreenOptimizedEnabled(),C.type,s,u)}),f.on("pointerup.tooltip",function(){return c.onPointerEnd()}),f.on("pointercancel.tooltip",function(){return c.onPointerEnd()})},U}(),{create:function(f){var M=new k(f.visualHostTooltipService,f.handleTouchDelay);return new ut(M,f.visualHostTooltipService)}}).create({visualHostTooltipService:this.visualHostTooltipService,handleTouchDelay:b})}return B.prototype.addTooltip=function(tt,b,vt,J,H,et){x.fF.assertValue(tt,"selection"),(et||this.visualHostTooltipService.enabled())&&this.tooltipEventsRegistrator.registerEvents(tt,b,vt,J,H,et)},B.prototype.removeTooltips=B.prototype.hide=B.prototype.visible=B.prototype.isTouchScreenOptimizedEnabled=B}()}}]);