(() => {
  const $q = window.sg.common.$q;
  const swiperManager = window.sg.common.swiperManager;
  const utils = window.sg.common.utils;
  const video = window.sg.common.video;
  //const lazyLoad = window.sg.common.lazyLoad;
  //feature-benefit
  const selector = {
    featureBenefit: '.feature-benefit',
    swiper: '.feature-benefit .feature-benefit__swiper',
    swiperDisclaimer: '.feature-benefit__disclaimer-wrap .feature-benefit__disclaimer',
    dropdown: '.feature-benefit__dropdown',
    dropdownBtn: '.feature-benefit__dropdown-select',
    dropdownList: '.feature-benefit__dropdown-item',
  };

  const el = {
    window: null,
    featureBenefit: null,
    swiper: null,
    swiperDisclaimer: null,
  };

  class FeatureBenefitDropDown {
    constructor(component) {
      this.ele = {
        window: $q(window),
        section: $q(component),
        btn: null,
        list: null,
      };

      this.setProperty();

      this.eventOutClick = this.OutClick.bind(this);

      FeatureBenefitDropDown.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.btn = this.ele.section.find(selector.dropdownBtn);
      this.ele.list = this.ele.section.find(selector.dropdownList);
    }

    init() {
      this.bindEvents();
    }

    reInit() {
      this.setProperty();

      this.bindEvents();
    }

    bindEvents() {
      this.ele.btn.off('click').on('click', () => {
        if (this.ele.section.hasClass('active')) {
          this.close();
        } else {
          this.open();
        }
      });
    }

    OutClick(event) {
      if ($q(event.target).closest(this.ele.section.target[0]).target.length <= 0) {
        this.close();
      }
    }

    open() {
      this.ele.section.addClass('active');
      this.ele.btn.attr('aria-expanded', true);
      this.ele.window.on('click', this.eventOutClick);
    }

    close() {
      this.ele.section.removeClass('active');
      this.ele.btn.attr('aria-expanded', false);
      this.ele.window.off('click', this.eventOutClick);
    }

    static makeInstance() {
      if (FeatureBenefitDropDown.instance === undefined) {
        FeatureBenefitDropDown.instances = new WeakMap();
      }

      $q(`${selector.featureBenefit} ${selector.dropdown}`).target.forEach((element) => {
        if (!FeatureBenefitDropDown.instances.has(element)) {
          new FeatureBenefitDropDown(element);
        } else {
          const instances =  FeatureBenefitDropDown.instances.get(element);
          instances.reInit();
        }
      });
    }
  }

  class FeatureBenefitImg {
    constructor() {
      this.ele = {
        window: $q(window),
        section: null,
        img: null,
      };

      this.setProperty();

      this.winHeight = utils.getViewPort().height;

      this.init();
    }

    setProperty() {
      this.ele.section = $q(`${selector.featureBenefit} .s-scroll-img`);
      this.ele.img = this.ele.section.find('.image');
    }

    init() {
      this.bindEvents();

      this.setClass();
    }

    reInit() {
      this.setProperty();

      this.setClass();
    }

    bindEvents() {
      this.ele.window.on('scroll', () => {
        this.setClass();
      });

      this.ele.window.on('resize', ;
    }

    setClass() {
      this.ele.img.target.forEach((img) => {
        const data = img.getBoundingClientRect();

        if (data.bottom > 0 && data.top + (data.height * 0.5) < this.winHeight) {
          if (!img.classList.contains('s-move-img')) {
            img.classList.add('s-move-img');
          }
        } else {
          if (img.classList.contains('s-move-img')) {
            if (data.bottom < 0 || data.top > this.winHeight) {
              img.classList.remove('s-move-img');
            }
          }
        }
      });
    }

    static makeInstance() {
      if (FeatureBenefitImg.instance === undefined) {
        FeatureBenefitImg.instance = new FeatureBenefitImg();
      } else {
        FeatureBenefitImg.instance.reInit();
      }
    }
  }

  class FeatureBenefitVideo {
    constructor(component) {
      this.selector = {
        videoOpen: '.feature-benefit__btn-play',
        videoClose: '.video-close',
        videoJS: 'div.video',
      };

      this.ele = {
        btnOpen: $q(component),
        popup: null,
        btnClose: null,
        videoJS: null,
      };

      this.setProperty();

      FeatureBenefitVideo.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.popup = $q(`#${this.ele.btnOpen.attr('data-div-id')}`);
      this.ele.btnClose = this.ele.popup.find(this.selector.videoClose);
      this.ele.videoJS = this.ele.popup.find(this.selector.videoJS).target[0];
    }

    init() {
      this.bindEvents();
    }

    reInit() {
      this.setProperty();

      this.bindEvents();
    }

    bindEvents() {
      this.ele.btnOpen.off('click').on('click', () => {
        this.openPop();
      });

      this.ele.btnClose.off('click').on('click', () => {
        this.closePop();
      });
    }

    openPop() {
      this.ele.popup.css({
        display: 'block',
      });

      this.ele.popup.focus();

      const feature = this.ele.popup.closest(selector.featureBenefit);

      if (feature.hasClass('feature-benefit--video-layer')) {
        utils.hiddenScroll();
      }

      feature.addClass('s-video-on');

      video.init(this.ele.videoJS);
    }

    closePop(isfocus = true) {
      if (this.ele.popup.css('display') !== 'block') {
        return;
      }

      this.ele.popup.css({
        display: '',
      });

      if (isfocus) {
        this.ele.btnOpen.focus();
      }

      const feature = this.ele.popup.closest(selector.featureBenefit);

      if (feature.hasClass('feature-benefit--video-layer')) {
        utils.visibleScroll();
      }

      feature.removeClass('s-video-on');

      video.dispose(this.ele.videoJS);
    }

    static callClosePop(element) {
      if (FeatureBenefitVideo.instances.has(element)) {
        const instances =  FeatureBenefitVideo.instances.get(element);
        instances.closePop();
      }
    }

    static makeInstance() {
      if (FeatureBenefitVideo.instance === undefined) {
        FeatureBenefitVideo.instances = new WeakMap();
      }

      $q(`${selector.featureBenefit} .feature-benefit__btn-play`).target.forEach((element) => {
        if (!FeatureBenefitVideo.instances.has(element)) {
          new FeatureBenefitVideo(element);
        } else {
          const instances =  FeatureBenefitVideo.instances.get(element);
          instances.reInit();
        }
      });
    }
  }

  class FeatureBenefitSwiper {
    constructor(component) {
      this.selector = {
        prev: '.swiper-button-prev',
        next: '.swiper-button-next',
        active: '.swiper-slide-active',
        img: '.feature-benefit__img-wrap',
        text: '.feature-benefit__text-wrap',
      };

      this.el = {
        swiper: $q(component),
        prev: null,
        next: null,
      };

      this.swiper = null;

      this.handler = {
        resize: () => {
          if (this.el.prev.target.length && this.el.next.target.length) {
            let top = 0;

            const active = this.el.swiper.find(this.selector.active);
            const img = active.find(this.selector.img);
            const text = active.find(this.selector.text);

            if (!active.target.length) {
              return;
            }

            if (img.target.length > 0) {
              top = -active.offset().top + img.offset().top + img.height() / 2;
            } else {
              top = -active.offset().top + text.offset().top + text.outerHeight() / 2 + this.el.prev.height() / 2;
            }

            if (!this.swiper.params) {
              return;
            }
            
            if (!this.swiper.params.autoHeight) {
              top = this.el.swiper.closest('.feature-benefit__inner').height() / 2;
            }

            this.el.prev.css({
              'top': `${top}px`,
            });
            this.el.next.css({
              'top': `${top}px`,
            });
          }
        },
        imageLoaded: (evt) => {
          $q(evt.target).off('load', this.handler.imageLoaded);
          this.handler.resize();
        },
      };

      FeatureBenefitSwiper.instances.set(component, this);
      this.init();
    }
    
    init() {
      this.setProperty();
      this.bindEvents();
    }

    reInit() {
      this.setProperty();
      this.bindEvents();
    }

    bindEvents() {
      el.window.off('resize', this.handler.resize).on('resize', this.handler.resize);

      this.el.swiper.find('.image > .image__main').off('load', this.handler.imageLoaded).on('load', this.handler.imageLoaded);

      const featureBenefit = this.el.swiper.closest(selector.featureBenefit);
      const disclaimer = featureBenefit.find(selector.swiperDisclaimer);

      swiperManager.slideChangeTransitionEnd(this.el.swiper.target[0], (swipe, index) => {
        disclaimer.removeClass('js-disc-active');
        disclaimer.eq(index).addClass('js-disc-active');

        this.handler.resize();
      });

      swiperManager.slideChange(this.el.swiper.target[0], (swipe) => {
        FeatureBenefitVideo.callClosePop($q(swipe.slides[swipe.previousIndex]).find('.feature-benefit__btn-play').target[0]);
      });
    }

    setProperty() {
      this.swiper = swiperManager.getSwiper(this.el.swiper.target[0]);

      this.el.prev = this.el.swiper.find(this.selector.prev);
      this.el.next = this.el.swiper.find(this.selector.next);
    }
  }

  // let instances = null;
  FeatureBenefitSwiper.instances = new WeakMap();

  // init
  const init = () => {
    el.window = $q(window);

    $q(selector.swiper).target.forEach((ele) => {
      new FeatureBenefitSwiper(ele);
    });
    
    FeatureBenefitImg.makeInstance();

    FeatureBenefitVideo.makeInstance();

    FeatureBenefitDropDown.makeInstance();
  };

  const reInit = () => {
    el.featureBenefit = $q(selector.featureBenefit);
    //lazyLoad.setLazyLoad();

    $q(selector.swiper).target.forEach((ele) => {
      if (!$q(ele).height()) {
        return;
      }

      if (FeatureBenefitSwiper.instances.has(ele)) {
        swiperManager.slideReInit(ele);
        const instances = FeatureBenefitSwiper.instances.get(ele);
        instances.reInit();
      } else {
        swiperManager.slideInit(ele);
        new FeatureBenefitSwiper(ele);
      }
    });

    window.sg.common.image.initAll();

    // bindEvents();

    FeatureBenefitImg.makeInstance();

    FeatureBenefitVideo.makeInstance();

    FeatureBenefitDropDown.makeInstance();
  };


  $q.ready(init);
  //
  window.sg.components.featureBenefit = {
    init,
    reInit,
  };
})();

(() => {
  const libs = window.sg.common.libs;
  const $q = window.sg.common.$q;
  const utils = window.sg.common.utils;
  const video = window.sg.common.video;

  const selector = {
    section: '.feature-benefit-banner',
    btn: '.feature-benefit-banner__cta .js-video-play',
    pop: '.feature-benefit-banner__video',
    video: '.feature-benefit-banner__video div.video',
    close: '.feature-benefit-banner__close',
  };

  class FeatureBenefitBanner {
    constructor(component) {
      this.ele = {
        section: $q(component),
        btn: null,
        pop: null,
      };
      
      this.setProperty();

      if (this.ele.pop.target.length <= 0) {
        return;
      }

      this.event = {
        focusLock: this.eventFocusLock.bind(this),
      };

      FeatureBenefitBanner.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.btn = this.ele.section.find(selector.btn);
      this.ele.pop = this.ele.section.find(selector.pop);
      this.ele.video = this.ele.section.find(selector.video).target[0];
      this.ele.close = this.ele.section.find(selector.close);

      this.isLayer = this.ele.pop.hasClass('js-layer-type-video');
    }

    eventFocusLock(e) {
      if (e.keyCode === libs.keyCode.TAB_KEY) {
        if (e.shiftKey === false && this.ele.close.target[0] === document.activeElement) {
          this.ele.pop.focus();
        } else if (e.shiftKey === true && this.ele.pop.target[0] === document.activeElement) {
          this.ele.close.focus();
        }
      }
    }

    openPopup() {
      this.ele.pop.css({
        display: 'block',
      });

      video.init(this.ele.video);

      if (this.isLayer) {
        this.ele.section.on('keydown', this.event.focusLock);
        this.ele.pop.attr('tabindex', 0);
        this.ele.pop.focus();
      }

      if (this.ele.pop.hasClass('js-layer-type-video')) {
        utils.hiddenScroll();
      }
    }

    closePopup() {
      this.ele.pop.css({
        display: 'none',
      });

      video.dispose(this.ele.video);

      if (this.isLayer) {
        this.ele.section.off('keydown', this.event.focusLock);
        this.ele.pop.attr('tabindex', '');
        this.ele.btn.focus();
      }

      if (this.ele.pop.hasClass('js-layer-type-video')) {
        utils.visibleScroll();
      }
    }

    init() {
      this.bindEvents();
    }

    reInit() {
      this.setProperty();

      this.bindEvents();

      if (this.ele.pop.target.length <= 0) {
        return;
      }
    }

    bindEvents() {
      this.ele.btn.off('click').on('click', () => {
        this.openPopup();
      });

      this.ele.close.off('click').on('click', () => {
        this.closePopup();
      });

      if (this.ele.video.getAttribute('data-video-type') === 'mp4' && this.ele.video.getAttribute('data-video-embed') === 'true') {
        this.ele.video.querySelector('video').addEventListener('play', ;
      }
    }
  }

  function reInit() {
    $q(selector.section).target.forEach((element) => {
      if (FeatureBenefitBanner.instances.has(element)) {
        const instances =  FeatureBenefitBanner.instances.get(element);
        instances.reInit();
      }
    });
  }
  
  function init() {
    $q(selector.section).target.forEach((element) => {
      if (!FeatureBenefitBanner.instances.has(element)) {
        new FeatureBenefitBanner(element);
      }
    });
  }
  
  FeatureBenefitBanner.instances = new WeakMap();

  window.sg.components.featureBenefitBanner = { reInit };

  $q.ready(init);
  
  $q.load(init);
})();

(() => {
  const $q = window.sg.common.$q;
  const KEY_CODE = window.sg.common.constants.KEY_CODE;
  const utils = window.sg.common.utils;
  const swiperManager = window.sg.common.swiperManager;
  const lazyLoad = window.sg.common.lazyLoad;
  const video = window.sg.common.video;
  const isVerticalVisible = window.sg.common.utils.isVerticalVisible;

  const selector = {
    section: '.feature-benefit-bundle',
  };

  class FeatureBenefitBundle {
    constructor(sectionEl) {
      this.timeID = null;
      this.desktopFlag = false;
      this.mobileFlag = false;
      this.playEl = null;
      this.playFlag = false;
      this.isVideo = false;
      this.activeIndex = null;

      this.ele = {
        window: $q(window),
        section: $q(sectionEl),
        list: null,
        listWrap: null,
        indicator: null,
        item: null,
        itemCta: null,
        image: null,
        imageWrap: null,
        disclaimer: null,
        bundleVideo: null,
        allVideoEl: null,
      };

      this.selector = {
        swiperContainer: '.swiper-container',
        list: '.feature-benefit-bundle__list',
        listWrap: '.feature-benefit-bundle__list-wrap',
        indicator: '.indicator',
        item: '.feature-benefit-bundle__item',
        itemCta: '.feature-benefit-bundle__item-cta',
        imageWrap: '.feature-benefit-bundle__image',
        image: '.feature-benefit-bundle__item .feature-benefit-bundle__image > .image',
        disclaimer: '.feature-benefit-bundle__disclaimer .list-type',
        bundleVideo: '.feature-benefit-bundle__video',
        allVideoEl: '.feature-benefit-bundle__video .video',
        checkSize: '.feature-benefit-bundle__image > .image, .feature-benefit-bundle__image .video',
        loadImage: '.image .image__main',
      };

      this.handler = {
        CheckInViewport: this.CheckInViewport.bind(this),
        resize: () => {
          if (this.timeID) {
            clearTimeout(this.timeID);
          }

          this.timeID = setTimeout(this.handler.timeResize, 10);
        },

        timeResize: () => {
          if (utils.getCurrentDevice() === 'desktop') {
            if (this.desktopFlag === false) {
              this.desktopFlag = true;
              this.mobileFlag = false;

              // this.ele.item = this.ele.section.find(this.selector.item);
              this.ele.itemCta.off('click').on('click', this.handler.eventHandler);
              this.ele.itemCta.off('keydown').on('keydown', this.handler.eventHandler);
              this.ele.section.find('.swiper-slide-focus').attr('tabindex', '0');

              this.handler.CheckInViewport();

              if (this.activeIndex === null) {
                this.activeIndex = 0;
              }

              if (!this.ele.section.find('.js-item-active').hasClass('swiper-slide-active')) {
                this.ele.section.find('.js-item-active').addClass('swiper-slide-active');
              }

              window.sg.common.image.initAll();
              lazyLoad.initAll();
            }

            // checkSize
            let maxHeight = 0;
            this.ele.list.css({
              height: '',
            });

            const oriHeight = this.ele.listWrap.outerHeight();

            this.ele.section.find(this.selector.checkSize).target.forEach((ele) => {
              const height = $q(ele).outerHeight();
              if (maxHeight < height) {
                maxHeight = height;
              }
            });

            this.ele.list.css({
              height: `${maxHeight + 2}px`,
            });

            if (oriHeight < maxHeight) {
              this.ele.imageWrap.css({
                height: `${maxHeight}px`,
              });
            }
          } else {
            if (this.mobileFlag === false) {
              this.desktopFlag = false;
              this.mobileFlag = true;

              this.handler.CheckInViewport();

              window.sg.common.image.initAll();
              lazyLoad.initAll();

              if (this.activeIndex === null) {
                this.activeIndex = 0;
              }

              swiperManager.slideUpdate(this.ele.section.find(this.selector.swiperContainer).target[0]);
              this.handler.slideSetting();
            }

            this.ele.list.css({
              height: '',
            });

            this.ele.section.find(this.selector.item).css({
              height: '',
            });

            this.ele.section.find(this.selector.imageWrap).css({
              height: '',
            });

            swiperManager.slideUpdate(this.ele.section.find(this.selector.swiperContainer).target[0]);
            this.handler.arrowPosition(this.activeIndex);
          }
        },

        eventHandler: (event) => {
          if (event.type === 'keydown' && event.keyCode !== KEY_CODE.ENTER) {
            return;
          }
          const current = $q(event.target);
          const item = current.closest(this.selector.item);
          const activeVideoWrap = item.find(this.selector.bundleVideo);

          this.ele.item.removeClass('js-item-active');
          this.ele.item.removeClass('swiper-slide-active');

          item.addClass('js-item-active');
          item.addClass('swiper-slide-active');

          this.ele.disclaimer.removeClass('js-disc-active');
          let idx = item.index();
          if(this.ele.indicator.index() === 0) {
            idx = item.index() - 1;
          }
          this.ele.disclaimer.eq(idx).addClass('js-disc-active');

          this.handler.setSelected();

          this.handler.controlVideo(activeVideoWrap.find('.video'));

          this.activeIndex = idx;
        },

        setSelected: () => {
          this.ele.item.target.forEach((item) => {
            const itemCta = $q(item).find('.feature-benefit-bundle__item-cta');

            if ($q(item).hasClass('js-item-active')) {
              if ($q(item).find('.video').target.length) {
                itemCta.attr('aria-label','play video, selected');
                $q(item).find('video').attr('tabindex', '0');
              } else {
                itemCta.attr('aria-label','selected');
              }
              if ($q(item).find('.feature-benefit-bundle__image').target.length){
                $q(item).find('.feature-benefit-bundle__image').attr('aria-hidden', false);
              }
            } else {
              if ($q(item).find('.video').target.length) {
                itemCta.attr('aria-label','play video, unselected');
                $q(item).find('video').attr('tabindex', '-1');
              } else {
                itemCta.attr('aria-label','unselected');
              }
              if ($q(item).find('.feature-benefit-bundle__image').target.length){
                $q(item).find('.feature-benefit-bundle__image').attr('aria-hidden', true);
              }
            }
          });
        },

        setFirstVideo: () => {
          this.ele.section.find(this.selector.item).target.forEach((item) => {
            const $item = $q(item);
            if ($item.hasClass('swiper-slide-active') && $item.find('.video').target.length > 0) {
              if ($item.find('.video').find('video').target.length <= 0) {
                window.sg.common.lazyLoad.forceLoad($item.find('.video').target[0]);
              }
              this.handler.controlVideo($item.find('.video'));
            }
          });
          this.handler.setSelected();
        },

        slideChangeTransitionEnd: (swiper, index) => {
          const swiperEl = $q(swiper.wrapperEl);

          const disclaimer = swiperEl.closest(this.selector.list).find('.feature-benefit-bundle__disclaimer>ul>li');
          const swiperSlide = swiperEl.find('.swiper-slide');

          const activeVideoWrap = swiperSlide.eq(index).find(this.selector.bundleVideo);

          disclaimer.removeClass('js-disc-active');
          disclaimer.eq(index).addClass('js-disc-active');

          swiperSlide.removeClass('js-item-active');
          swiperSlide.eq(index).addClass('js-item-active');

          this.handler.controlVideo(activeVideoWrap.find('.video'), 'slide');

          swiperSlide.find('.feature-benefit-bundle__image').attr('aria-hidden', true);
          swiperSlide.eq(index).find('.feature-benefit-bundle__image').attr('aria-hidden', false);
        },

        playAfterload: (event) => {
          if (event.target.autoplay === true){
            event.target.play();
          }
        },

        controlVideo: (targetEl, type) => {
          if (this.playFlag === true && this.playEl !== null) {
            this.playEl.attr('aria-hidden', true);
            const video = this.playEl.find('video');
            video.attr('tabindex', -1);
            video.target[0].pause();

            if (type === 'slide') {
              if (video.target[0].currentTime !== 0) {
                video.target[0].currentTime = 0;
              }
            }

            this.playFlag = false;
            this.playEl = null;
          }

          if (targetEl.target.length) {
            targetEl.attr('aria-hidden', false);
            targetEl.find('video').attr('tabindex', '0');
            setTimeout(() => {
              targetEl.removeAttr('tabindex');
            }, 500);

            // video.init(videoEl);
            // video.stop(videoEl);

            const videoEl = targetEl.target[0];
            const video = targetEl.find('video').target[0];

            if (type !== 'slide') {
              video.pause();
              if (video.currentTime !== 0) {
                video.currentTime = 0;
              }
            }
            
            if (JSON.parse(videoEl.dataset.videoData).autoplay) {
              if (video.readyState === 0) {
                video.removeEventListener('loadeddata', this.handler.playAfterload);
                video.addEventListener('loadeddata', this.handler.playAfterload);
              } else {
                setTimeout(() => {
                  video.play();
                }, 150);
              }
            } else {
              video.load();
            }

            this.playEl = targetEl;
            this.playFlag = true;
          }
        },

        checkImageLoad: (evt) => {
          swiperManager.slideUpdate(this.ele.section.find(this.selector.swiperContainer).target[0]);

          this.handler.resize();

          $q(evt.target).off('load', this.handler.checkImageLoad);
        },

        slideMove: (e) => {
          const slideArrow = $q(e.target).closest('.arrow-indicator');
          const slideTarget = $q(e.target).closest('.basic-swiper').target[0];

          if (slideArrow.hasClass('arrow-indicator--next')) {
            slideTarget.swiper.slideNext();
          } else {
            slideTarget.swiper.slidePrev();
          }
        },

        slideSetting: () => {
          this.ele.section.find(this.selector.swiperContainer).target.forEach((element) => {
            swiperManager.slideInitEnd(element, this.handler.slideInitEnd);
            element.swiper.params.navigation.nextEl = '.arrow-indicator--next',
            element.swiper.params.navigation.prevEl = '.arrow-indicator--prev',
            element.swiper.navigation.init();
            element.swiper.on('slideChange', this.handler.slideChange);
          });
        },

        slideInitEnd: () => {
          setTimeout( 800);
        },

        slideChange: () => {
          const idx = this.ele.section.find(this.selector.swiperContainer).target[0].swiper.activeIndex;
          this.handler.arrowPosition(idx);

          this.activeIndex = idx;

          if (this.activeIndex + 1 === this.ele.section.find(this.selector.swiperContainer).find('.swiper-slide').target.length) {
            this.ele.section.find(this.selector.swiperContainer).find('.arrow-indicator--prev').focus();
          }

          if (this.activeIndex === 0) {
            this.ele.section.find(this.selector.swiperContainer).find('.arrow-indicator--next').focus();
          }
        },

        arrowPosition: (idx) => {
          const imageArea = this.ele.section.find('.feature-benefit-bundle__item').eq(idx).find('.feature-benefit-bundle__image');
          const targetArrow = this.ele.section.find('.arrow-indicator-wrap');

          const wrapHeight = this.ele.section.find('.feature-benefit-bundle__item').eq(idx).height();
          const imageHeight = imageArea.height();
          const calcHeight = wrapHeight - imageHeight + (imageHeight / 2);

          if (imageArea.target.length > 0) {
            targetArrow.css({
              'top': `${calcHeight}px`,
            });
          } else {
            targetArrow.css({
              'top': '50%',
            });
          }
        },
      };

      FeatureBenefitBundle.instances.set(sectionEl, this);
      this.init();
    }

    CheckInViewport() {
      if (isVerticalVisible(this.ele.section.target[0])) {
        this.ele.window.off('scroll', this.handler.CheckInViewport);
        this.handler.setFirstVideo();
      }
    }

    init() {
      this.setProperty();
      this.bindEvents();
    }

    reInit() {
      this.desktopFlag = false;
      this.mobileFlag = false;
      this.playEl = null;
      this.playFlag = false;
      this.isVideo = false;

      this.unBindEvents();
      this.init();
    }

    setProperty() {
      this.ele.list = this.ele.section.find(this.selector.list);
      this.ele.listWrap = this.ele.section.find(this.selector.listWrap);
      this.ele.indicator = this.ele.section.find(this.selector.indicator);
      this.ele.imageWrap = this.ele.section.find(this.selector.imageWrap);
      this.ele.item = this.ele.section.find(this.selector.item);
      this.ele.itemCta = this.ele.section.find(this.selector.itemCta);
      this.ele.disclaimer = this.ele.section.find(this.selector.disclaimer);

      this.ele.allVideoEl = this.ele.section.find(this.selector.allVideoEl);
      this.ele.allVideoEl.target.forEach((ele) => {
        if (ele.dataset.videoData.autoplay !== true) {
          video.stop(ele);
        }
        this.isVideo = true;
        ele.setAttribute('aria-hidden', true);
        $q(ele).find('video').attr('tabindex', -1);
      });
    }

    bindEvents() {
      this.ele.window.on('resize', this.handler.resize);
      this.ele.window.off('scroll', this.handler.CheckInViewport).on('scroll', this.handler.CheckInViewport);
      this.ele.section.find(this.selector.swiperContainer).target.forEach(;

      this.handler.resize();
      this.ele.section.find(this.selector.loadImage).on('load', this.handler.checkImageLoad);
    }

    unBindEvents() {
      this.ele.window.off('resize', this.handler.resize);
      this.ele.section.find(this.selector.loadImage).off('load', this.handler.checkImageLoad);
    }
  }

  FeatureBenefitBundle.instances = new WeakMap();

  const init = () => {
    $q(selector.section).target.forEach((element) => {
      new FeatureBenefitBundle(element);
    });
  };

  const reInit = () => {
    lazyLoad.initAll();

    $q(selector.section).target.forEach((element) => {
      const selctionEl = $q(element);
      const swiperEl = selctionEl.find('.swiper-container').target[0];
      const videoEl = selctionEl.find('div.video').target[0];

      if (videoEl) {
        video.init(videoEl);
      }

      if (FeatureBenefitBundle.instances.has(element)) {
        swiperManager.slideReInit(swiperEl);
        FeatureBenefitBundle.instances.get(element).reInit();
      } else {
        swiperManager.slideInit(swiperEl);
        new FeatureBenefitBundle(element);
      }
    });
  };

  $q.ready(init);

  window.sg.components.featureBenefitBundle = {
    init,
    reInit,
  };
})();

(() => {
  // const libs = window.sg.common.libs;
  const $q = window.sg.common.$q;
  const utils = window.sg.common.utils;
  const lazyLoad = window.sg.common.lazyLoad;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;

  const selector = {
    section: '.feature-benefit-full-bleed',
    videoWrap: 'div.video',
    videoLargeCta: '.button-controller',
    videoSmallCta: '.button-auto-loop',
  };

  class FeatureBenefitFullBleed {
    constructor(component) {
      this.ele = {
        section: $q(component),
        window: $q(window),
      };

      this.setProperty();

      this.handler = {
        videoToggle: this.videoToggle.bind(this),
        resize: this.resize.bind(this),
      };

      FeatureBenefitFullBleed.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.videoWrap = this.ele.section.find(selector.videoWrap);
      this.ele.video = this.ele.videoWrap.find('.video-player').target[0];
      this.ele.videoLargeCta = this.ele.section.find(selector.videoLargeCta);
      this.ele.videoSmallCta = this.ele.section.find(selector.videoSmallCta);
      this.videoTime = this.ele.section.find('.feature-benefit-full-bleed__figure').hasClass('video--under5s') ? 'under' : 'over';

      if (BREAKPOINTS.MOBILE < utils.getViewPort().width) {
        this.desktopFlag = true;
        this.mobileFlag = false;
      } else {
        this.desktopFlag = false;
        this.mobileFlag = true;
      }

      if (this.ele.videoWrap.target.length > 0) {
        this.videoConfig = JSON.parse(this.ele.videoWrap.target[0].dataset.videoData);

        if (this.videoTime === 'under') {
          if (this.videoConfig.loop === false) {
            this.videoLargeControll = true;
            this.ele.videoSmallCta.attr('tabindex', '-1');
            this.ele.videoSmallCta.attr('aria-hidden', true);
            this.ele.videoSmallCta.hide();
          } else {
            this.ele.videoLargeCta.addClass('is-hidden--large');
            this.ele.videoLargeCta.attr('tabindex', '-1');
            this.ele.videoLargeCta.attr('aria-hidden', true);
          }
        } else {
          this.ele.videoLargeCta.addClass('is-hidden--large');
          this.ele.videoLargeCta.attr('tabindex', '-1');
          this.ele.videoLargeCta.attr('aria-hidden', true);
        }
      }
    }

    init() {
      this.bindEvents();
    }

    reInit() {
      this.setProperty();

      this.bindEvents();
    }

    bindEvents() {
      if (this.ele.videoWrap.target.length > 0) {
        this.videoToggle(true);
        this.ele.videoSmallCta.off('click', this.handler.videoToggle).on('click', this.handler.videoToggle);
        this.ele.videoLargeCta.off('click', this.handler.videoToggle).on('click', this.handler.videoToggle);
        this.ele.window.off('resize', this.handler.resize).on('resize', this.handler.resize);
        this.videoEvt();
      }
    }

    resize() {
      if (BREAKPOINTS.MOBILE < utils.getViewPort().width) {
        if (this.desktopFlag === false) {
          this.desktopFlag = true;
          this.mobileFlag = false;

          if (this.ele.videoWrap.target.length > 0) {
            setTimeout(() => {
              if (this.videoState === true) {
                this.videoPlay();
              } else {
                this.videoPause();
              }
            }, 500);
          }
        }
      } else {
        if (this.mobileFlag === false) {
          this.mobileFlag = true;
          this.desktopFlag = false;
          if (this.ele.videoWrap.target.length > 0) {
            setTimeout(() => {
              if (this.videoState === true) {
                this.videoPlay();
              } else {
                this.videoPause();
              }
            }, 500);
          }
        }
      }
    }

    videoEvt(){
      $q(this.ele.video).off('ended').on('ended', () => {
        if (this.videoConfig.loop === false) {
          this.videoState = false;
          this.videoCtaSet(false);
        }
      });
    }

    videoCtaSet(play){
      if (play === true) {
        this.ele.videoSmallCta.addClass('is-play');
        this.ele.videoSmallCta.find('.hidden').text('stop video');
        if (this.videoLargeControll === true) {
          this.ele.videoLargeCta.addClass('is-hidden--large');
          this.ele.videoLargeCta.attr('tabindex', '-1');
          this.ele.videoLargeCta.attr('aria-hidden', true);
        }
      } else {
        this.ele.videoSmallCta.removeClass('is-play');
        this.ele.videoSmallCta.find('.hidden').text('play video');
        if (this.videoLargeControll === true) {
          this.ele.videoLargeCta.removeClass('is-hidden--large');
          this.ele.videoLargeCta.removeAttr('tabindex');
          this.ele.videoLargeCta.removeAttr('aria-hidden');
        }
      }
    }

    videoToggle(first = false) {
      if (first === true) {
        if (this.videoConfig.autoplay === true) {
          this.videoPlay();
        }
      } else {
        if (this.videoLargeControll === true) {
          if(this.ele.videoLargeCta.hasClass('is-hidden--large')) {
            this.videoPause();
          } else {
            this.videoPlay();
          }
        } else {
          if(this.ele.videoSmallCta.hasClass('is-play')) {
            this.videoPause();
          } else {
            this.videoPlay();
          }
        }
      }
    }

    videoPlay(){
      this.videoState = true;
      this.ele.video.play();
      this.videoCtaSet(true);
    }

    videoPause(){
      this.videoState = false;
      this.ele.video.pause();
      this.videoCtaSet(false);
    }
  }

  function init() {
    lazyLoad.setLazyLoad();

    $q(selector.section).target.forEach((element) => {
      if (FeatureBenefitFullBleed.instances.has(element)) {
        const instances =  FeatureBenefitFullBleed.instances.get(element);
        instances.reInit();
      } else {
        const videoWrapTarget = $q(element).find(selector.videoWrap).target;
        if (videoWrapTarget.length) {
          videoWrapTarget[0].addEventListener('videoInit', () => {
            new FeatureBenefitFullBleed(element);
          });
        } else {
          new FeatureBenefitFullBleed(element);
        }
      }
    });
  }

  FeatureBenefitFullBleed.instances = new WeakMap();

  window.sg.components.featureBenefitFullBleed = {
    init,
    reInit: init,
  };

  $q.ready(init);
})();

(() => {
  const utils = window.sg.common.utils;
  const $q = window.sg.common.$q;
  const swiperManager = window.sg.common.swiperManager;
  const video = window.sg.common.video;
  const lazyLoad = window.sg.common.lazyLoad;
  const KEY_CODE = window.sg.common.constants.KEY_CODE;
  const setMobileFocusLoop = window.sg.common.utils.setMobileFocusLoop;
  const removeMobileFocusLoop = window.sg.common.utils.removeMobileFocusLoop;

  const selector = {
    gallery: '.feature-benefit-gallery>.feature-benefit-gallery__inner',
    swiper: '.feature-benefit-gallery__inner .swiper-container',
    disclaimer: '.feature-benefit-gallery__disclaimer .feature-benefit-gallery__item',
    swiperSlide: '.swiper-slide',
    swiperDimmed: '.dimm-layer .swiper-dimmed',
    swiperButtonPrev: '.swiper-button-prev',
    swiperButtonNext: '.swiper-button-next',
    activeSlide: '.swiper-slide-active',
    slideClickList: '.swiper-box .swiper-slide .swiper-img',
    slideVideoClickList: '.swiper-dimmed .swiper-slide a',
    galleryLayer: '.dimm-layer',
    galleryLayerClose: '.feature-benefit-gallery__close',
    video: 'div.video',
    videoClose: 'button.video-close',
  };

  const el = {
    window: null,
    gallery: null,
    activeBtn: null,
  };
  
  const handler = {
    dragDisabled(event) {
      event.stopPropagation();
    },

    focusDimm(event) {
      if (event.keyCode === KEY_CODE.TAB) {
        requestAnimationFrame(() => {
          const $wrap = $q(document.activeElement).closest(selector.galleryLayer);
          if ($wrap.target.length === 0) {
            const $component = $q(event.target).closest('.feature-benefit-gallery');
            if (event.shiftKey) {
              $component.find(selector.galleryLayerClose).focus();
            } else {
              if ($component.find('div.video-disabled').target.length === 0) {
                $component.find('.dimm-layer .swiper-button-prev:not(.swiper-button-disabled), .dimm-layer .swiper-button-next:not(.swiper-button-disabled)').eq(0).focus();
              } else {
                $component.find('.dimm-layer .swiper-slide-active .video[tabindex="0"]').focus();
              }
            }
          }
        });
      }
    },

    focus(target) {
      target.off();
  
      const prev = target.find(selector.swiperButtonPrev);
      const active = target.find(selector.activeSlide);

      if (active.hasClass('video-on')) {
        const vidoeElement = active.find(selector.video).target[0];
        const swiperDimmed = target.find(selector.swiperDimmed);
        swiperDimmed.addClass('video-disabled');
        el.activeSlide = active;
        
        video.init(vidoeElement);
        
        active.on('mousedown', handler.dragDisabled);

        vidoeElement.focus();
      } else {
        if (prev.hasClass('swiper-button-disabled')) {
          target.find(selector.swiperButtonNext).focus();
        } else {
          prev.focus();
        }
      }
    },
    
  };

  const bindEvents = () => {
    let timer = 0;

    el.gallery.find('.image > .image__main').on('load', () => {
      clearTimeout(timer);

      timer = setTimeout(() => {
        swiperManager.slideUpdate(el.gallery.find(selector.swiper).target[0]);

        lazyLoad.setLazyLoad();
      }, 100);
    });

    el.gallery.target.forEach((element) => {
      const gallery = $q(element);
      const swiper = gallery.find(selector.swiper);

      swiperManager.slideRemove(swiper.target[0]);
      
      swiper.find(selector.slideClickList).target.forEach(;
      
      if ($q(swiper.target[0]).find('.swiper-slide').target.length === 1) {
        swiperManager.slideInit(swiper.target[0],{
          'followFinger': false,
        });

        gallery.find('.indicator').hide();
      } else {
        swiperManager.slideInit(swiper.target[0]);
      }

      const layer =  gallery.find(selector.galleryLayer);
      const slideClickList = swiper.find(selector.slideClickList);
      const slideVideoClickList = swiper.find(selector.slideVideoClickList);
      const layerList = layer.find(selector.swiperSlide);
    
      let autoFlag = false;

      const swiperEl = swiperManager.getSwiper(gallery.find('.swiper-container:not(.swiper-dimmed)').target[0]);

      if (swiperEl.autoplay.running === true) {
        autoFlag = true;
      }
      
      slideClickList.target.forEach((a) => {
        const $qa = $q(a);
        const layerSwiper = layer.find(selector.swiperDimmed).target[0];

        $qa.off('click');
        $qa.off('keydown');

        $qa.on('click', (evt) => {
          evt.stopPropagation();

          layerList.removeClass('swiper-slide-active');
          layerList.eq(Number($q(evt.target).closest(selector.slideClickList).attr('data-custom-clickIndex'))).addClass('swiper-slide-active');

          layer.show();
          setMobileFocusLoop(layer.target[0]);
          if (layer.target.length > 0) {
            utils.hiddenScroll();
          }

          el.activeBtn = $qa;

          if (autoFlag === true) {
            el.autoplaying = swiperEl.autoplay.running;

            setTimeout(() => {
              swiperEl.autoplay.stop();
            }, 400);
          }

          swiperManager.slideUpdate(layerSwiper);
          const $layerSwiper = $q(layerSwiper);
          $layerSwiper.closest('.feature-benefit-gallery').off('keydown', handler.focusDimm).on('keydown', handler.focusDimm);
          $layerSwiper.find('.swiper-button-next, .swiper-button-prev').on('click', (event) => {
            requestAnimationFrame(() => {
              if (layerSwiper.swiper.isEnd) {
                $layerSwiper.find('.swiper-button-prev').focus();
              } else if (layerSwiper.swiper.isBeginning) {
                $layerSwiper.find('.swiper-button-next').focus();
              } else {
                event.target.focus();
              }
            });
          });
          handler.focus(layer);
        });
      });

      slideVideoClickList.target.forEach((a) => {
        const $qa = $q(a);
        const li = $qa.parent();
        const vidoeElement = $qa.parent().find(selector.video).target[0];
        const close = li.find(selector.videoClose);

        $qa.off('click');
        $qa.on('click', (event) => {
          event.preventDefault();
          
          video.init(vidoeElement);

          el.swiperDimmed.addClass('video-disabled');
          el.activeSlide = li;

          el.activeSlide.on('mousedown', handler.dragDisabled);

          removeMobileFocusLoop();
          setMobileFocusLoop(li.target[0]);
          vidoeElement.focus();
        });

        close.off('click');
        close.on('click' , (event) => {
          event.preventDefault();
          el.swiperDimmed.removeClass('video-disabled');
          
          // lazyLoad
          video.dispose(vidoeElement);
          lazyLoad.setLazyLoad();

          el.activeSlide.off();
          el.activeSlide = null;
          
          removeMobileFocusLoop();
          setMobileFocusLoop(el.swiperDimmed.target[0]);

          el.swiperDimmed.find('.swiper-slide-active a.btn-video').focus();
        });
      });

      // disclaimer setup
      const disclaimer = gallery.children(selector.disclaimer);
      disclaimer.removeClass('swiper-slide-active');
      disclaimer.eq(0).addClass('swiper-slide-active');

      swiperManager.slideChangeTransitionEnd(swiper.target[0], (swipe, index) => {
        disclaimer.removeClass('swiper-slide-active');
        disclaimer.eq(index).addClass('swiper-slide-active');
      });

      const layerClose = layer.find(selector.galleryLayerClose);

      layerClose.off('click');
      layerClose.on('click', (event) => {
        event.preventDefault();

        layer.hide();
        utils.visibleScroll();

        el.activeBtn.focus();
        el.activeBtn = null;

        if (autoFlag === true && el.autoplaying !== null) {
          swiperEl.autoplay.start();
          el.autoplaying = null;
        }

        if (el.activeSlide) {
          if (el.activeSlide.find(selector.video).target.length !== 0) {
            video.dispose(el.activeSlide.find(selector.video).target[0]);
          }
        }

        el.swiperDimmed.removeClass('video-disabled');
        layer.closest('.feature-benefit-gallery').off('keydown', handler.focusDimm);

        removeMobileFocusLoop();
      });
    });
  };


  let instances = null;

  // init
  const init = () => { 
    el.window = $q(window);
    el.gallery = $q(selector.gallery);

    el.swiperDimmed = $q(selector.swiperDimmed);

    if (!el.gallery.target.length) {
      return;
    }
    
    instances = new WeakMap();
    instances.set(el.gallery.target[0], {});

    bindEvents();
  };

  const reInit = () => {
    el.gallery = $q(selector.gallery);

    if (instances.get(el.gallery.target[0])) {
      el.gallery.find('.basic-swiper').target.forEach(;
    } else {
      el.gallery.find('.basic-swiper').target.forEach((element) => {
        swiperManager.slideInit(element);
      });
    }

    bindEvents();
  };

  $q.ready(init);

  window.sg.components.featureBenefitGallery = {
    init,
    reInit,
  };
})();

(() => {
  const libs = window.sg.common.libs;
  const $q = window.sg.common.$q;
  const video = window.sg.common.video;
  const lazyLoad = window.sg.common.lazyLoad;

  const selector = {
    section: '.feature-benefit-half-text.feature-benefit-half-text--video',
    btn: '.feature-benefit-half-text__btn-play',
    pop: '.feature-benefit-full-bleed__video',
    video: 'div.video',
    videoWrap: '.feature-benefit-half-text__video',
    popup: '.feature-benefit-half-text .popup-video',
    close: '.video-area__btn-close',
  };

  class FeatureBenefitHalfText {
    constructor(component) {
      this.ele = {
        window: $q(window),
        section: $q(component),
        btn: null,
        pop: null,
      };

      this.setProperty();

      this.event = {
        focusLock: this.eventFocusLock.bind(this),
      };

      FeatureBenefitHalfText.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.btn = this.ele.section.find(selector.btn);
      this.ele.pop = $q(`#${this.ele.btn.attr('data-div-id')}`);
      this.ele.video = this.ele.pop.find(selector.video).target[0];
      this.ele.close = this.ele.pop.find(selector.close);
      this.ele.videoWrap = this.ele.section.find(selector.videoWrap);
      this.ele.popup = this.ele.section.find(selector.popup);
      this.ele.popupClose = this.ele.section.find(selector.popupClose);


      this.isExpend = this.ele.section.hasClass('feature-benefit-half-text--video-expand');
      this.isLayer = this.ele.section.hasClass('feature-benefit-half-text--video-layer');

      this.popup = window.sg.common.popupVideo;
    }

    eventFocusLock(e) {
      if (e.keyCode === libs.keyCode.TAB_KEY) {
        if (e.shiftKey === false && this.ele.close.target[0] === document.activeElement) {
          e.preventDefault();
          this.ele.pop.focus();
        } else if (e.shiftKey === true && this.ele.pop.target[0] === document.activeElement) {
          e.preventDefault();
          this.ele.close.focus(); 
        }
      }
    }

    openPopup() {
      if(this.isLayer) {
        this.popup.open(this.ele.popup.target[0], 0, this.ele.popup);
      } else {
        video.init(this.ele.video);
        this.ele.btn.attr('aria-selected', 'true');
        this.ele.videoWrap.addClass('video-open');

        if (this.isExpend) {
          this.ele.pop.stop().animate({
            opacity: '1',
          }, 300);
        } else {
          this.ele.section.on('keydown', this.event.focusLock);
          this.ele.pop.attr('tabindex', 0);
          this.ele.pop.focus();
        }
      }
    }

    closePopup() {
      this.ele.btn.attr('aria-selected', 'false');

      if (!this.isLayer) {
        if (this.isExpend) {
          this.ele.pop.stop().animate({
            opacity: '0',
          }, 300, () => {
            this.ele.videoWrap.removeClass('video-open');

            this.ele.pop.css({
              opacity: '',
            });

            video.dispose(this.ele.video);
          });
        } else {
          this.ele.pop.removeClass('active');
          this.ele.videoWrap.removeClass('video-open');
          this.ele.section.off('keydown', this.event.focusLock);
          this.ele.pop.attr('tabindex', '');

          video.dispose(this.ele.video);
        }
      }

      this.ele.btn.focus();
    }

    init() {
      this.bindEvents();
    }

    reInit() {
      this.setProperty();
      if (this.ele.video) {
        video.init(this.ele.video);
      }

      this.bindEvents();
    }
    
    bindEvents() {
      this.ele.btn.off('click').on('click', () => {
        this.openPopup();
      });

      this.ele.close.off('click').on('click', () => {
        this.closePopup();
      });
    }
  }

  function init() {
    $q(selector.section).target.forEach((element) => {
      if (!FeatureBenefitHalfText.instances.has(element)) {
        new FeatureBenefitHalfText(element);
      }
    });

    window.sg.common.popupVideo.initAll();
  }

  function reInit() {
    $q(selector.section).target.forEach((element) => {
      if (FeatureBenefitHalfText.instances.has(element)) {
        const instances =  FeatureBenefitHalfText.instances.get(element);
        instances.reInit();
      } else {
        lazyLoad.setLazyLoad();

        const instances =  new FeatureBenefitHalfText(element);
        instances.reInit();
      }
    });

    window.sg.common.popupVideo.initAll();
  }
  
  FeatureBenefitHalfText.instances = new WeakMap();

  window.sg.components.featureBenefitHalfText = {
    init,
    reInit,
  };

  $q.ready(init);
  
  $q.load(init);
})();

(() => {
  const $q = window.sg.common.$q;
  const lazyLoad = window.sg.common.lazyLoad;

  class FeatureBenefitTab {
    constructor(element) {
      this.ele = {
        'component': $q(element),
        'wrap': null,
        'btns': null,
        'tabPanel': null,
        'outDisclaimer': null,
      };

      this.setProperty();

      this.eventResize = this.resize.bind(this);

      this.handler = {
        loadImg: null,
        hover: (event) => {
          this.ele.wrap.find('.feature-benefit-tab-list__anchor--active');
          $(event.currentTarget).addClass('feature-benefit-tab-list__anchor--active');
        },
        focusout: () => {
          this.ele.wrap.find('.feature-benefit-tab-list__anchor--active').removeClass('feature-benefit-tab-list__anchor--active');
          this.ele.wrap.find('.feature-benefit-tab-list__anchor[aria-selected="true"]').addClass('feature-benefit-tab-list__anchor--active');
        },
      };

      FeatureBenefitTab.instances.set(element, this);

      this.init();
    }

    setProperty() {
      this.ele.wrap = this.ele.component.find('.feature-benefit-tab__content');
      this.ele.btns = this.ele.wrap.find('.feature-benefit-tab-list__anchor');
      this.ele.tabPanel = this.ele.wrap.find('.feature-benefit-tab-panel');
      this.ele.outDisclaimer = this.ele.component.find('.feature-benefit-tab__disclaimers');
      this.isFadeChange = this.ele.component.hasClass('feature-benefit-tab--inside') ;
    }

    init() {
      this.bindEvents();

      this.resize();
    }

    reInit() {
      this.setProperty();

      this.bindEvents();

      this.resize();
    }

    resize() {
      if (this.isFadeChange && this.nowIdx != null) {
        this.ele.wrap.css({
          height: `${this.ele.tabPanel.eq(this.nowIdx).height()}px`,
        });
      }
    }

    bindEvents() {
      this.ele.btns.off('click').on('click', (event) => {
        const $qbtn = $q(event.currentTarget);
        const tabIdx = $qbtn.index();

        this.setChange($qbtn, tabIdx);
      });

      this.ele.btns.off('mouseenter', this.handler.hover).on('mouseenter', this.handler.hover);
      this.ele.btns.off('focusin', this.handler.hover).on('focusin', this.handler.hover);

      this.ele.btns.off('mouseleave', this.handler.focusout).on('mouseleave', this.handler.focusout);
      this.ele.btns.off('focusout', this.handler.focusout).on('focusout', this.handler.focusout);

      $q(window).off('resize', this.eventResize).on('resize', this.eventResize);
    }
    
    changeTab ($qbtn) {
      const $qoldBtn = this.ele.wrap.find('.feature-benefit-tab-list__anchor[aria-selected="true"]');
      $qoldBtn.attr('aria-selected', false);
      $qoldBtn.removeClass('feature-benefit-tab-list__anchor--active');
      $qbtn.addClass('feature-benefit-tab-list__anchor--active');
      $qbtn.attr('aria-selected', true);
    }

    changeDisclaimer(tabIdx) {
      if (this.ele.outDisclaimer.target.length !== 0) {
        this.ele.outDisclaimer.find('.feature-benefit-tab__disclaimer--active').removeClass('feature-benefit-tab__disclaimer--active');
        this.ele.outDisclaimer.find(`.feature-benefit-tab__disclaimer:nth-child(${tabIdx + 1})`).addClass('feature-benefit-tab__disclaimer--active');
      }
    }
    
    changeTabBody(tabIdx) {
      this.nowIdx = tabIdx;
      if (this.isFadeChange) {
        const $qnowPanel = this.ele.tabPanel.eq(tabIdx);
        $qnowPanel.addClass('feature-benefit-tab-panel--active');

        $qnowPanel.css({
          opacity: 0,
          zIndex: 1,
          position: 'absolute',
        });

        //lazyImg
        this.ele.component.find('.responsive-img').off('load', this.handler.loadImg);

        this.handler.loadImg = (function(event = null) {
          this.ele.wrap.css({
            height: `${$qnowPanel.height()}px`,
          });
          
          if (event !== null) {
            const $el = $q(event.target || event.srcElement);
            $el.off('load', this.handler.loadImg);
          }
        }).bind(this);

        $qnowPanel.find('.lazy-load').target.forEach(( el ) => {
          lazyLoad.setLazyLoad();
          $q(el).on('load', this.handler.loadImg);
        });

        this.handler.loadImg();

        //animate fade
        this.ele.tabPanel.target.forEach((ele, idx) => {
          if (idx !== tabIdx) {
            const $qele = $q(ele);
            $qele.stop();
            $qele.animate({
              opacity: 0,
            }, 500);
          }
        });

        $qnowPanel.stop();

        $qnowPanel.animate({
          opacity: 1,
        }, 500, () => {
          this.ele.tabPanel.target.forEach((ele, idx) => {
            if (idx !== tabIdx) {
              $q(ele).removeClass('feature-benefit-tab-panel--active');
            }
          });
          this.ele.tabPanel.css({
            opacity: '',
            zIndex: '',
            position: '',
          });
        });
      } else {
        this.ele.tabPanel.removeClass('feature-benefit-tab-panel--active');
        this.ele.tabPanel.eq(tabIdx).addClass('feature-benefit-tab-panel--active');
        lazyLoad.setLazyLoad();
      }
      
      this.ele.tabPanel.target.forEach((ele, idx) => {
        if (idx !== tabIdx) {
          $q(ele).attr('aria-hidden', true);
        } else {
          $q(ele).attr('aria-hidden', false);
        }
      });
    }
    
    setChange($qbtn, tabIdx) {
      if ($qbtn.attr('aria-selected') === 'true') {
        return;
      }

      this.changeTab($qbtn);

      this.changeDisclaimer(tabIdx);
      
      this.changeTabBody(tabIdx);
    }
  }

  function init() {
    $q('.feature-benefit-tab').target.forEach((element) => {
      if (!FeatureBenefitTab.instances.has(element)) {
        new FeatureBenefitTab(element);
      }
    });
  }
  
  function reInit() {
    lazyLoad.setLazyLoad();
    
    $q('.feature-benefit-tab').target.forEach((element) => {
      if (FeatureBenefitTab.instances.has(element)) {
        const instances =  FeatureBenefitTab.instances.get(element);
        instances.reInit();
      } else {
        new FeatureBenefitTab(element);
      }
    });
  }

  FeatureBenefitTab.instances = new WeakMap();

  $q.ready(() => {
    init();
    
    window.sg.components.featureBenefitTab = {
      init,
      reInit,
    };
  });
})();

(() => {
  const $q = window.sg.common.$q;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;
  const swiperManager = window.sg.common.swiperManager;
  const video = window.sg.common.video;

  const selector = {
    components: '.three-column-carousel',
    jsVideo: '.swiper-container .video video',
    figure: '.swiper-container .three-column-carousel__content figure',
    picture: '.three-column-carousel__picture',
    textField: '.three-column-carousel__text',
  };

  const weakmap = new WeakMap();
  
  const el = {
    window: null,
    components: null,
    jsVideo: null,
    figure: null,
    textField: null,
  };

  let rtime;
  let timeout = false;
  let resizeFlg = false;

  const delta = 200;
  
  const handler = {
    resizeEl(){
      if (BREAKPOINTS.MOBILE < utils.getViewPort().width) {
        if (resizeFlg ===  false) {
          resizeFlg = true;

          $q('.three-column-carousel__figure .video').target.forEach((item) => {
            video.dispose(item);
            video.init(item);
          });
        }

        $q(selector.components).target.forEach((item) => {
          const compEle = $q(item);
          compEle.find(selector.jsVideo).css({
            'height': '',
          });

          $q(selector.figure).css({
            'height': '',
          });

          compEle.find(selector.picture).css({
            
            'height': '',
          });

          let hv = 0;

          compEle.find('.video-bg').css({
            'height': '',
          });

          compEle.find('.video-bg').target.forEach((element) => {
            const pH = $q(element).height();
            if (hv < pH) {
              hv = pH;
            }
          });

          compEle.find('.video-bg').css({
            'height': `${hv}px`,
          });
          
          let hp = 0;
          compEle.find(selector.picture).target.forEach((element) => {
            const pH = $q(element.parentNode).height();
            if (hp < pH) {
              hp = pH;
            }
          });

          compEle.find(selector.picture).target.forEach((element) => {
            $q(element.parentNode).css({
              'height': `${hp}px`,
            });
          });

          
          compEle.find(selector.textField).css({
            'height': '',
          });

          let ht = 0;
          compEle.find(selector.textField).target.forEach((element) => {
            const pH = $q(element).outerHeight();
            if (ht < pH) {
              ht = pH;
            }
          });

          compEle.find(selector.textField).target.forEach((element) => {
            $q(element).css({
              'height': `${ht}px`,
            });
          });
        });
      }else{
        if (resizeFlg === true) {
          resizeFlg = false;

          $q('.three-column-carousel__figure .video').target.forEach((item) => {
            video.dispose(item);

            video.init(item);
          });
        }

        $q(selector.figure).css({
          'height': '',
        });

        $q(selector.textField).css({
          'height': '',
        });
      }
    },

    checkResize() {
      rtime = new Date();

      if (timeout === false) {
        timeout = true;

        setTimeout(() => {
          handler.resizeEnd();
        }, delta);
      }
    },

    scrollImageCheck: () => {
      // handler.resize();
      // let cnt = 0;

      el.components.target.forEach((el) => {
        const top = $q(el).offset().top;
        if (top < window.innerHeight * .8 && top > - window.innerHeight * .8) {
          // weakmap.get(el).check = true;
          handler.resize();
        }
        // handler.resize();
        // if (weakmap.get(el).check) {
        //   cnt += 1;
        // }
      });
      // if (cnt === el.components.target.length) {
      //   el.window.off('scroll', handler.scrollImageCheck);
      // }
    },

    resizeEnd() {
      if (new Date() - rtime < delta) {
        setTimeout(() => {
          handler.resizeEnd();
        }, delta);
      } else {
        timeout = false;

        handler.resizeEl();
      }  
    },
    
    resize: 
  };

  function bindEvents() {
    el.window.on('resize', handler.resize);

    el.window.on('scroll', handler.scrollImageCheck);
  }

  const init = () => {
    el.components = $q(selector.components);
    el.components.target.forEach(;

    el.jsVideo = $q(selector.jsVideo);
    el.picture = $q(selector.picture);
    el.textField = $q(selector.textField);

    const total = el.jsVideo.target.length;

    if (total === 0 && el.picture.target.length === 0 && el.textField.target.length === 0) {
      return;
    }

    bindEvents();
  };
  
  const reInit = () => {
    el.components.target.forEach((el) => {
      weakmap.get(el).check = false;
    });

    el.window.off('resize', handler.resize);

    el.window.off('scroll', handler.scrollImageCheck);

    $q('.three-column-carousel__figure .video').target.forEach((item) => {
      video.dispose(item);

      video.init(item);
    });

    if (BREAKPOINTS.MOBILE < utils.getViewPort().width) {
      $q(selector.components).find('.basic-swiper').target.forEach((sw) => {
        if (sw.swiper === undefined) {
          swiperManager.slideInit(sw);
        } else {
          swiperManager.slideReInit(sw);
        }
      });
    }

    init();
  };

  $q.load(() => {
    if(!$q(selector.components).target.length){
      return;
    }

    handler.resize();
  });

  // $q.ready(init);
  $q.ready(() => {
    if(!$q(selector.components).target.length){
      return;
    }

    el.window = $q(window);

    init();
  });

  window.sg.components.featureBenefitThreeColumn = {
    init,
    reInit,
  };
})();

(() => {
  const $q = window.sg.common.$q;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;
  const lazyLoad = window.sg.common.lazyLoad;
  
  const selector = {
    section: '.two-column',
    figure: '.two-column__figure',
    title: '.two-column__title',
    subTitle: '.two-column__sub-title',
    text: '.two-column__text',
    cta: '.two-column__cta',
    ctaWrap: '.two-column__cta-wrap',
    disclaimer: '.two-column__disclaimer',
    subHeadline: '.two-column__headline, .two-column__sub-headline',
  };

  class FeatureBenefitTwoColumn {
    constructor(component) {
      this.el = {
        window: $q(window),
        section: $q(component),
      };

      this.setProperty();

      this.eventResize = this.resize.bind(this);

      FeatureBenefitTwoColumn.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.matchEl = [];
      this.matchEl[0] = this.el.section.find(selector.figure);
      this.matchEl[1] = this.el.section.find(selector.title);
      this.matchEl[2] = this.el.section.find(selector.subTitle);
      this.matchEl[3] = this.el.section.find(selector.text);
      this.matchEl[4] = this.el.section.find(selector.cta);
      this.matchEl[5] = this.el.section.find(selector.ctaWrap);
      this.matchEl[6] = this.el.section.find(selector.disclaimer);

      this.desktopFlag = false;
      this.mobileFlag = false;
    }

    init() {
      this.bindEvents();

      this.resize();
    }

    reInit() {
      this.setProperty();

      this.bindEvents();

      this.resize();
    }

    resize() {
      this.removeHeight();

      if (BREAKPOINTS.MOBILE < utils.getViewPort().width) {
        if (this.desktopFlag === false) {
          this.desktopFlag = true;
          this.mobileFlag = false;

          this.setDesktopClass();
        }

        this.setHeight();
      } else {
        if (this.mobileFlag === false) {
          this.mobileFlag = true;
          this.desktopFlag = false;

          this.setMobileClass();
        }
      }
    }

    bindEvents() {
      this.el.window.off('resize', this.eventResize).on('resize', this.eventResize);

      this.matchEl[0].find('img').target.forEach(;
    }

    removeHeight() {
      this.matchEl.forEach(;
    }

    setMobileClass() {
      this.matchEl.forEach(($obj, idx) => {
        $obj.target.forEach((el) => {
          const $el = $q(el);

          this.removeNoData($el);
        });

        if (idx === 1 || idx === 2) {
          $obj.target.forEach((el) => {
            const $el = $q(el);

            if ($el.find(selector.subHeadline).target.length === 0) {
              this.setNoData($el);
            } else {
              this.removeNoData($el);
            }
          });
        } else if (idx === 5) {
          $obj.target.forEach((el) => {
            const $el = $q(el);
            
            if ($el.find(selector.cta).eq(0).height() === 0 && $el.find(selector.cta).eq(1).height() === 0) {
              this.setNoData($el);
            } else {
              this.removeNoData($el);
            }
          });
        } else {
          $obj.target.forEach((el) => {
            const $el = $q(el);

            if ($el.height() === 0) {
              this.setNoData($el);
            } else {
              this.removeNoData($el);
            }
          });
        }
      });
    }

    setDesktopClass() {
      this.matchEl.forEach(($obj, idx) => {
        const heightArr = [];
        const setFlag = $obj.eq(0).find(selector.subHeadline).target.length === 0 && $obj.eq(1).find(selector.subHeadline).target.length === 0;

        $obj.target.forEach((el) => {
          const $el = $q(el);

          this.removeNoData($el);
          heightArr.push($el.height());
        });

        const maxHeight = Math.max.apply(null, heightArr);

        if (idx === 1 || idx === 2) {
          if (setFlag) {
            this.setNoData($obj);
          } else {
            this.removeNoData($obj);
          }
        } else {
          if (maxHeight === 0) {
            this.setNoData($obj);
          } else {
            this.removeNoData($obj);
          }
        }
      });
    }
    
    setHeight() {
      this.matchEl.forEach(($obj, idx) => {
        const heightArr = [];
        const setFlag = $obj.eq(0).find(selector.subHeadline).target.length === 0 && $obj.eq(1).find(selector.subHeadline).target.length === 0;

        $obj.target.forEach((el) => {
          heightArr.push($q(el).height());
        });

        const maxHeight = Math.max.apply(null, heightArr);

        if (idx === 1 || idx === 2) {
          if (!setFlag) {
            this.setMaxHeight($obj, maxHeight);
          } else {
            $obj.css({
              height: '',
            });
          }
        } else {
          if (maxHeight !== 0) {
            this.setMaxHeight($obj, maxHeight);
          } else {
            $obj.css({
              height: '',
            });
          }
        }
      });
    }

    setMaxHeight(item, max) {
      item.css({
        height: `${max}px`,
      });
    }

    
    removeNoData  }

  function init() {
    $q(selector.section).target.forEach((element) => {
      if (!FeatureBenefitTwoColumn.instances.has(element)) {
        new FeatureBenefitTwoColumn(element);
      }
    });
  }

  function reInit() {
    lazyLoad.setLazyLoad();
    
    $q(selector.section).target.forEach((element) => {
      if (FeatureBenefitTwoColumn.instances.has(element)) {
        const instances =  FeatureBenefitTwoColumn.instances.get(element);
        instances.reInit();
      } else {
        new FeatureBenefitTwoColumn(element);
      }
    });
  }


  FeatureBenefitTwoColumn.instances = new WeakMap();

  $q.ready(() => {
    init();
    
    window.sg.components.featureBenefitTwoColumn = {
      reInit,
    };
  });
})();

(() => {
  const $q = window.sg.common.$q;
  const video = window.sg.common.video;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;
  const lazyLoad = window.sg.common.lazyLoad;
  const popupVideo = window.sg.common.popupVideo;
  const setMobileFocusLoop = window.sg.common.utils.setMobileFocusLoop;
  const removeMobileFocusLoop = window.sg.common.utils.removeMobileFocusLoop;

  const selector = {
    section: '.feature-benefit-video-kv',
    btnOpen: '.feature-benefit-video-kv__cta .js-video-play',
    btnClose: '.feature-benefit-video-kv__close',
    videoPop: '.feature-benefit-video-kv__video',
    VideoJSWrap: '.feature-benefit-video-kv__video-wrap',
    beforeAfterImg: '.feature-benefit-video-kv__figure .image',
    videoJS: 'div.video',
    layerTypeVideo: 'feature-benefit-video-kv--layer',
    layerTypeVideoMobile: 'feature-benefit-video-kv--layer-mobile',
  };

  class FeatureBenefitVideoKv {
    constructor(component) {
      this.ele = {
        window: $q(window),
        section: $q(component),
        btnOpen: null,
        btnClose: null,
        videoPop: null,
        VideoJSWrap: null,
        beforeAfterImg: null,
        videoJS: null,
      };

      this.setProperty();

      this.isPcMode = BREAKPOINTS.MOBILE < utils.getViewPort().width;
      this.eventResize = this.resize.bind(this);

      FeatureBenefitVideoKv.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.btnOpen = this.ele.section.find(selector.btnOpen);
      this.ele.btnClose = this.ele.section.find(selector.btnClose);
      this.ele.videoPop = this.ele.section.find(selector.videoPop);
      this.ele.VideoJSWrap = this.ele.section.find(selector.VideoJSWrap);
      this.ele.beforeAfterImg = this.ele.section.find(selector.beforeAfterImg);
      this.ele.videoJS = this.ele.section.find(selector.videoJS).target[0] || null;
      this.ele.popupVideoEl =  this.ele.section.find('.popup-video').target[0];

      this.isVideo = this.ele.section.find('video').target.length !== 0;
      this.videoFlg = false;
      this.clickFlg = false;

      if (this.ele.videoJS !== null && this.ele.videoJS.getAttribute('data-video-type') === 'mp4') {
        this.isVideo = true;
      }
    }

    init() {
      this.bindEvents();
    }

    reInit() {
      this.setProperty();

      this.bindEvents();
    }

    bindEvents() {
      const videoEndBind = this.endVideoCallBack.bind(this);
      this.ele.btnOpen.off('click').on('click',(e) => {
        if (this.ele.section.hasClass(selector.layerTypeVideo)) {
          const callCta = e.currentTarget;
          popupVideo.open(this.ele.popupVideoEl, 0, callCta);
          setTimeout(() => {
            if ($q('[data-aria-hidden]').target.length <= 0) {
              setMobileFocusLoop(this.ele.popupVideoEl);
            }
          }, 400);
        } else {
          this.setOpenClass();

          if (this.ele.videoJS !== null) {
            video.init(this.ele.videoJS);
          }

          if (this.isVideo) {
            this.ele.section.find('video').target.forEach((el) => {
              el.removeEventListener('ended', videoEndBind);
              el.addEventListener('ended', videoEndBind);
              el.currentTime = 0;
              el.play();
            });
          }
        }
      });

      this.ele.btnClose.off('click').on('click',() => {
        if (this.isVideo) {
          this.ele.section.find('video').target.forEach((el) => {
            el.removeEventListener('ended', videoEndBind);
            el.pause();
          });
        }

        this.setCloseClass();
      });

      if (this.ele.popupVideoEl) {
        this.ele.popupVideoEl.addEventListener('popupVideoClose', () => {
          if ($q('[data-aria-hidden]').target.length > 0) {
            removeMobileFocusLoop();
          }
          this.setCloseClass();
        });
      }

      this.ele.window.off('resize', this.eventResize).on('resize', this.eventResize);
    }

    resize() {
      const nowPcMode = BREAKPOINTS.MOBILE < utils.getViewPort().width;

      if (this.ele.section.hasClass('feature-benefit-video-kv--layer-mobile') && this.isPcMode !== nowPcMode) {
        this.setCloseClass(false);

        this.isPcMode = nowPcMode;
      }
    }

    scrollToggle() {
      if (BREAKPOINTS.MOBILE > utils.getViewPort().width) {
        if (this.videoFlg === false) {
          utils.hiddenScroll();

          this.videoFlg = true;
        } else {
          utils.visibleScroll();

          this.videoFlg = false;
        }
      } else {
        utils.visibleScroll();

        this.videoFlg = false;
      }
    }

    setOpenClass() {
      this.ele.videoPop.stop();

      this.ele.videoPop.css({
        display: 'block',
        opacity: 0,
      });
      this.ele.videoPop.attr('tabindex',0);
      this.ele.videoPop.focus();

      this.ele.videoPop.animate({
        opacity: 1,
      }, 500,;

      if (this.ele.section.hasClass(selector.layerTypeVideoMobile)) { //dimm  mp4 ..
        this.scrollToggle();
      }
    }

    setCloseClass(isFocus = true) {
      if (!this.ele.section.hasClass(selector.layerTypeVideo)) {
        if(isFocus === false && this.ele.videoPop.css('display') === 'none'){
          return;
        }

        this.ele.section.find('video').t();
        });

        if (this.ele.videoJS !== null) {
          video.dispose(this.ele.videoJS);
        }
        //close popup
        this.ele.videoPop.stop();
        this.ele.videoPop.animate({
          opacity: 0,
        }, 500, () => {
          this.ele.videoPop.css({
            opacity: '',
            display: '',
          });
        });

        if (this.ele.section.hasClass(selector.layerTypeVideoMobile)) {
          if (this.videoFlg === true) {
            this.scrollToggle();
          }
        }

        //move focus
        if (isFocus) {
          this.ele.btnOpen.focus();
        }
      }

      //change img
      this.ele.beforeAfterImg.eq(0).css({
        display: 'none',
      });
      this.ele.beforeAfterImg.eq(1).css({
        display: 'block',
      });
      lazyLoad.setLazyLoad();

      //change text
      const closeTxt = this.ele.btnOpen.attr('data-close-txt');

      if (closeTxt) {
        this.ele.btnOpen.target[0].innerHTML = closeTxt;
      }
    }

    endVideoCallBack() {
      if (this.ele.section.hasClass('feature-benefit-video-kv--layer-mobile') && this.isPcMode) {
        this.setCloseClass();
      }
    }
  }

  function init() {
    $q(selector.section).target.forEach((element) => {
      if (!FeatureBenefitVideoKv.instances.has(element)) {
        new FeatureBenefitVideoKv(element);
      }
    });
  }

  function reInit() {
    lazyLoad.setLazyLoad();

    $q(selector.section).target.forEach((element) => {
      if (FeatureBenefitVideoKv.instances.has(element)) {
        const instances =  FeatureBenefitVideoKv.instances.get(element);
        instances.reInit();
      } else {
        new FeatureBenefitVideoKv(element);
      }
    });
  }

  FeatureBenefitVideoKv.instances = new WeakMap();

  $q.ready(() => {
    init();

    window.sg.components.featureBenefitVideoKv = {
      reInit,
    };
  });
})();

(() => {
  const $q = window.sg.common.$q;
  const $window = $q(window);

  const selector = {
    section: '.ftd15-interactive-single-feature',
    controlDrag: '.horizontal-slide button, .vertical-slide button',
    controlShow: '.button-controller',
    controlVideo: '.button-auto-loop:not(.before)',
    controlVideoB: '.button-auto-loop.before',
    controlWrap: '.ftd15-interactive-single-feature__controller',
    before: '.ftd15-interactive-single-feature__before-contents',
    after: '.ftd15-interactive-single-feature__after-contents',
    focusGo: '.ftd15-interactive-single-feature__video-title', //   video     focus  
  };

  function changeVideo ($btns,state) {
    if (state === 'stop') {
      $btns.target.forEach((btn) => {
        btn.classList.remove('is-play');
        if (btn.dataset.anLa) {
          btn.setAttribute('an-la',`${btn.dataset.anLa}:play video`);
        }
      });
    } else {
      $btns.target.forEach((btn) => {
        btn.classList.add('is-play');
        if (btn.dataset.anLa) {
          btn.setAttribute('an-la',`${btn.dataset.anLa}:stop video`);
        }
      });
    }
  }

  class InteractiveSingleDrag { // to >> ftd16-interactive-multi-feature.js
    constructor(el) {
      const controlDrag = el.querySelector(selector.controlDrag);
      if (controlDrag === null) {
        return false;
      }
      
      this.els = {
        el,
        controlDrag,
      };

      this.motionType = null;

      this.handler = {
        touchDownControl: () => {
          $window.off('mousemove', this.handler.touchMoveControl).on('mousemove', this.handler.touchMoveControl);
          window.removeEventListener('touchmove', this.handler.touchMoveControl);
          window.addEventListener('touchmove', this.handler.touchMoveControl, { passive: false });

          $window.off('mouseup', this.handler.touchUpControl).on('mouseup', this.handler.touchUpControl);
          $window.off('touchend', this.handler.touchUpControl).on('touchend', this.handler.touchUpControl);
        },
        touchMoveControl: (event) => {
          event.preventDefault();
          if (this.motionType === 'horizontal') {
            this.moveClipImg(event.pageX || event.touches[0].pageX, 'px');
          } else {
            this.moveOpacityImg(event.clientY || event.touches[0].clientY, 'px');
          }
        },
        touchUpControl: () => {
          $window.off('mousemove', this.handler.touchMoveControl);
          window.removeEventListener('touchmove', this.handler.touchMoveControl);
          $window.off('mouseup', this.handler.touchUpControl);
          $window.off('touchend', this.handler.touchUpControl);
        },
        keydownControl: (event) => {
          const code = window.sg.common.constants.KEY_CODE;
          if (this.motionType === 'horizontal') {
            const now = parseFloat(this.els.controlDrag.parentNode.style.left || 50);
            if (event.keyCode === code.LEFT) {
              this.moveClipImg(now - 5, '%');
            } else if (event.keyCode === code.RIGHT) {
              this.moveClipImg(now + 5, '%');
            }
          } else {
            const now = parseFloat(this.els.controlDrag.style.top || 50);
            if (event.keyCode === code.UP) {
              event.preventDefault();
              this.moveOpacityImg(now - 5, '%');
            } else if(event.keyCode === code.DOWN) {
              event.preventDefault();
              this.moveOpacityImg(now + 5, '%');
            }
          }
        },
        resizeHorizon: () => {
          this.moveClipImg(parseFloat(this.els.controlDrag.parentNode.style.left || 50), '%');
        },
      };

      InteractiveSingleDrag.instances.set(this.els.el, this);

      this.init();
    }

    init() {
      this.motionType = this.els.el.querySelector('.vertical-slide') ? 'vertical' : 'horizontal';

      this.bindEvents();
    }

    bindEvents() {
      if (this.motionType === 'horizontal') {
        $window.off('resize', this.handler.resizeHorizon).on('resize', this.handler.resizeHorizon);
      }
      
      const $afterImg = this.els.el.querySelector(`${selector.after} .image__main`);
      if ($afterImg.classList.contains('image--loaded')) {
        this.motionController();
      } else {
        $afterImg.addEventListener('load',() => {
          this.motionController();
        });
      }

      const $controlDrag = $(this.els.controlDrag);
      $controlDrag.off('mousedown',this.handler.touchDownControl).on('mousedown',this.handler.touchDownControl);
      $controlDrag.off('touchstart',this.handler.touchDownControl).on('touchstart',this.handler.touchDownControl);
      $controlDrag.off('keydown',this.handler.keydownControl).on('keydown',this.handler.keydownControl);
    }

    
    moveOpacityImg(touchY, unit) {
      const barRect = this.els.controlDrag.parentNode.getBoundingClientRect();
      const move = touchY - barRect.top;
      let perY = (unit === 'px') ? (move / barRect.height) : (touchY / 100);

      if (perY < 0) {
        perY = 0;
      } else if (perY > 1) {
        perY = 1;
      }

      this.els.controlDrag.style.top = `${perY * 100}%`;
      this.els.el.querySelector(selector.after).style.opacity = perY;
    }

    moveClipImg(move, unit){
      const $img = this.els.el.querySelector(selector.before);
      let pxX = null;
      let perX = null;

      if (unit === 'px') { //when px
        pxX = move - this.els.el.getBoundingClientRect().left;
        if(pxX < 0){
          pxX = 0;
        } else if(pxX > this.els.el.offsetWidth){
          pxX = this.els.el.offsetWidth;
        }
        perX = pxX / this.els.el.offsetWidth;
      } else { //when %
        if(move < 0){
          move = 0;
        } else if(move > 100){
          move = 100;
        }
        move = move / 100;
        pxX = this.els.el.offsetWidth * move;
        perX = move;
      }

      this.els.controlDrag.parentNode.style.left = `${perX * 100}%`;
      $img.style.clip = `rect(0px, ${pxX}px, ${this.els.el.offsetHeight + 1}px, 0px)`;
    }

    motionController() {
      if (this.els.el.classList.contains('controller-showed')) {
        return;
      }
      this.els.el.classList.add('controller-showed');

      if(this.motionType === 'horizontal') {
        InteractiveSingleDrag.bezierMove([400,50,500,50,400], (idx,per) => {
          if (idx === 0) {
            this.moveClipImg(50 - (50 * per), '%');
          } else if (idx === 2) {
            this.moveClipImg(100 * per, '%');
          } else if (idx === 4) {
            this.moveClipImg(100 - (50 * per), '%');
          } else if (idx === 5) {
            this.moveClipImg(50, '%');
          }
        }, [0.02, 0.01, 0.47, 1]);
      } else {
        InteractiveSingleDrag.bezierMove([500,50,500], (idx,per) => {
          if (idx === 0) {
            this.moveOpacityImg(100 * per, '%');
          } else if (idx === 2) {
            this.moveOpacityImg(100 - (100 * per), '%');
          } else if (idx === 3) {
            this.moveOpacityImg(0, '%');
          }
        }, [0.02, 0.01, 0.47, 1]);
      }
    }

    static bezierMove(times, callback, bezier) {
      const frame = 20;
      const accrue = [];
      let idx = 0;
      let pass = 0;
      let timer = null;

      times.forEach((time,idx) => {
        if (idx === 0) {
          accrue[0] = time;
        } else {
          accrue[idx] = accrue[idx - 1] + time;
        }
      });

      timer = setInterval(() => {
        pass += frame;
        
        if (pass > accrue[idx]) {
          idx++;
        }

        let per = null;
        if (idx === 0) {
          per = pass / times[0];
        } else {
          per = (pass - accrue[idx - 1]) / times[idx];
        }

        const per2 = 1 - per;
        const move = 3 * (Math.pow(per2, 2) * per) * bezier[1] + 3 * (per2 * Math.pow(per, 2)) * bezier[3] + Math.pow(per, 3) * 1;

        callback(idx, move);

        if (pass > accrue[accrue.length - 1]) {
          clearInterval(timer);
          timer = null;
        }
      }, frame);
    }
  }
  class InteractiveSingleFeature { // to >> ftd16-interactive-multi-feature.js
    constructor(el) {
      this.els = {
        el,
      };

      this.handler = {
        clickShowBtn: () => {
          this.showAfter();
        },
        videoPlayStop: (event) => {
          if (event.currentTarget.classList.contains('is-play')) {
            this.videoStop();
          } else {
            this.videoPlay();
          }
        },
        clickSwitch: () => {
          this.isAfterAuto = true;
          this.isBeforeAuto = true;

          if (this.els.switchBtn.classList.contains('on')) {
            this.showAfter();
            this.els.$controlWrap.removeClass('is-show--small-before');
            if (this.els.switchBtn.dataset.anLa) {
              this.els.switchBtn.setAttribute('an-la',`${this.els.switchBtn.dataset.anLa}:off`);
            }
          } else {
            this.hideAfter();
            this.els.$controlWrap.addClass('is-show--small-before');
            if (this.els.switchBtn.dataset.anLa) {
              this.els.switchBtn.setAttribute('an-la',`${this.els.switchBtn.dataset.anLa}:on`);
            }
          }
        },
      };
      
      InteractiveSingleFeature.instances.set(this.els.el, this);

      this.init();
    }

    init() {
      this.els.$el = $q(this.els.el);
      this.els.switchBtn = this.els.el.querySelector('.switch-v2__button');
      this.els.$controlShow = this.els.$el.find(selector.controlShow);
      this.els.$controlVideo = this.els.$el.find(selector.controlVideo);
      this.els.$controlWrap = this.els.$el.find(selector.controlWrap);

      this.els.afterDiv = this.els.el.querySelector(selector.after);
      this.els.beforeDiv = this.els.el.querySelector(selector.before);

      //set tagging
      changeVideo(this.els.$el.find(`${selector.controlVideo},${selector.controlVideoB}`),'stop');
      this.els.$el.find('.switch-v2__button').target.forEach((el) => {
        if (el.dataset.anLa) {
          if (el.classList.contains('on')) {
            el.setAttribute('an-la',`${el.dataset.anLa}:off`);
          } else {
            el.setAttribute('an-la',`${el.dataset.anLa}:on`);
          }
        }
      });

      // set video property : after Video (default)
      this.isShowLarge = true;
      this.isHideSmall = true;
      this.els.afterVideo = this.els.el.querySelector(`${selector.after} .video`);
      if (this.els.afterVideo) {
        this.isAfterLoop = JSON.parse(this.els.afterVideo.dataset.videoData).loop;
        this.isAfterAuto = this.els.afterDiv.classList.contains('video--autoplay');
        const isAfterShort = this.els.afterDiv.classList.contains('video--under5s');

        if (this.els.$controlWrap.hasClass('tap')) {
          this.isHideSmall = isAfterShort;
        } else if(this.els.$controlWrap.hasClass('video-play')) {
          this.isShowLarge = (
            (isAfterShort && this.isAfterAuto === false && this.isAfterLoop === false)
            || (isAfterShort && this.isAfterAuto === true && this.isAfterLoop === false)
          );
          this.isHideSmall = this.isShowLarge;
        }
      }

      // set video property : switch has before Video
      if (this.els.switchBtn) {
        this.els.$controlVideoB = this.els.$el.find(selector.controlVideoB);

        this.els.beforeVideo = this.els.el.querySelector(`${selector.before} .video`);
        if (this.els.beforeVideo) {
          this.isBeforeLoop = JSON.parse(this.els.beforeVideo.dataset.videoData).loop;
          this.isBeforeAuto = this.els.beforeDiv.classList.contains('video--autoplay');
          this.isBeforeShort = this.els.beforeDiv.classList.contains('video--under5s');
        }
      }

      this.bindEvents();

      this.initVideoPlay();
    }

    bindEvents() {
      this.els.$controlShow.off('click',this.handler.clickShowBtn).on('click',this.handler.clickShowBtn);
      this.els.$controlVideo.off('click',this.handler.videoPlayStop).on('click',this.handler.videoPlayStop);

      if (this.els.switchBtn) {
        $q(this.els.switchBtn).off('click',this.handler.clickSwitch).on('click',this.handler.clickSwitch);
        this.els.$controlVideoB.off('click',this.handler.videoPlayStop).on('click',this.handler.videoPlayStop);
      }
    }

    initVideoPlay() {
      if (this.els.switchBtn) {
        if (this.els.switchBtn.classList.contains('on')) {
          if (this.isAfterAuto) {
            this.showAfter(false);
          }
        } else {
          if (this.isBeforeAuto) {
            this.hideAfter(false);
          }
        }
      } else if (this.isAfterAuto) {
        this.showAfter(false);
      }
    }

    showAfter(focusMove = true) {
      this.els.$el.find(selector.before).addClass('contents-hidden');

      if (this.els.switchBtn === null) {
        this.els.$controlWrap.addClass('is-hidden--large');
      }

      if (this.els.beforeVideo) {
        window.sg.common.video.destroy(this.els.beforeVideo);
        this.els.beforeDiv.classList.remove('is-show--video');
        changeVideo(this.els.$controlVideoB,'stop');
      }

      if (this.els.afterVideo) {
        const isAfterStop = (this.els.switchBtn && this.isAfterAuto === false);
        if (isAfterStop) {
          changeVideo(this.els.$controlVideo,'stop');
          return;
        }

        if (this.isHideSmall === false) {
          this.els.$controlWrap.addClass('is-show--small');
        }

        this.videoInitAfter();

        if (focusMove && this.els.switchBtn === null) {
          const goFocus = this.els.$el.find(`.is-show--small ${selector.controlVideo}`);
          if (goFocus.target.length > 0) {
            goFocus.focus();
          } else {
            this.els.$el.find(`${selector.after} ${selector.focusGo}`).attr('tabindex',0).focus();
          }
        }
      }
    }

    hideAfter(focusMove = true) {
      this.els.$el.find(selector.before).removeClass('contents-hidden');

      if (this.isShowLarge) {
        this.els.$controlWrap.removeClass('is-hidden--large');
      }

      if (this.els.afterVideo) {
        window.sg.common.video.destroy(this.els.afterVideo);
        this.els.afterDiv.classList.remove('is-show--video');
        changeVideo(this.els.$controlVideo,'stop');
        if (this.isHideSmall || this.els.$controlWrap.hasClass('tap')) {
          this.els.$controlWrap.removeClass('is-show--small');
        }
      }

      if(this.els.beforeVideo && this.isBeforeAuto) {
        this.videoInitBefore();
      }

      if (focusMove && this.els.switchBtn === null && $q(document.activeElement).closest(selector.section).target.length > 0) {
        const goFocus = this.els.$el.find(`.is-show--small ${selector.controlVideo}`);
        if (goFocus.target.length > 0) {
          goFocus.focus();
        } else {
          this.els.$controlShow.focus();
        }
      }
    }

    videoPlay(){
      if (this.els.switchBtn) {
        if (this.els.switchBtn.classList.contains('on') === false) {
          const videoEl = this.els.beforeVideo;
          if (videoEl.innerText.trim() === '') {
            this.videoInitBefore();
          } else {
            window.sg.common.video.play(videoEl);
            changeVideo(this.els.$controlVideoB,'play');
          }
        } else {
          const videoEl = this.els.afterVideo;
          if (videoEl.innerText.trim() === '') {
            this.videoInitAfter();
          } else {
            window.sg.common.video.play(videoEl);
            changeVideo(this.els.$controlVideo,'play');
          }
        }
      } else {
        const videoEl = this.els.afterVideo;
        if (videoEl.innerText.trim() === '') {
          this.showAfter();
        } else {
          window.sg.common.video.play(videoEl);
          changeVideo(this.els.$controlVideo,'play');
        }
      }
    }

    videoStop(){
      if (this.els.switchBtn && this.els.switchBtn.classList.contains('on') === false) {
        const videoEl = this.els.beforeVideo.querySelector('video');
        videoEl.pause();
        changeVideo(this.els.$controlVideoB,'stop');
      } else {
        const videoEl = this.els.afterVideo.querySelector('video');
        videoEl.pause();
        changeVideo(this.els.$controlVideo,'stop');
      }
    }

    videoInitAfter(){
      window.sg.common.video.init(this.els.afterVideo);
      this.els.afterDiv.classList.add('is-show--video');
      requestAnimationFrame(() => {
        window.sg.common.video.play(this.els.afterVideo);
        changeVideo(this.els.$controlVideo,'play');
  
        if(this.isAfterLoop !== true) {
          $q(this.els.afterVideo).find('video').off('ended').on('ended',() => {
            if(this.els.switchBtn){
              window.sg.common.video.destroy(this.els.afterVideo);
              this.els.afterDiv.classList.remove('is-show--video');
              changeVideo(this.els.$controlVideo,'stop');
            } else {
              this.hideAfter();
            }
          });
        }
      });
    }

    videoInitBefore(){ //use only Toggle
      window.sg.common.video.init(this.els.beforeVideo);
      this.els.beforeDiv.classList.add('is-show--video');
      requestAnimationFrame(() => {
        window.sg.common.video.play(this.els.beforeVideo);
        changeVideo(this.els.$controlVideoB,'play');
  
        if(this.isBeforeLoop !== true) {
          $q(this.els.beforeVideo).find('video').off('ended').on('ended',() => {
            window.sg.common.video.destroy(this.els.beforeVideo);
            this.els.beforeDiv.classList.remove('is-show--video');
            changeVideo(this.els.$controlVideoB,'stop');
          });
        }
      });
    }
  }

  InteractiveSingleDrag.instances = new WeakMap();
  InteractiveSingleFeature.instances = new WeakMap();

  const interactiveSingleFeature = {
    initAll() {
      [...document.querySelectorAll(selector.section)].forEach((el) => {
        if (el.querySelector(selector.controlDrag)) {
          if (!InteractiveSingleDrag.instances.has(el)) {
            new InteractiveSingleDrag(el);
          }
        } else {
          if (!InteractiveSingleFeature.instances.has(el)) {
            new InteractiveSingleFeature(el);
          }
        }
      });
    },
  };

  window.sg.components.interactiveSingleFeature = interactiveSingleFeature;
  $q.ready(() => interactiveSingleFeature.initAll());
})();

(() => {
  const $q = window.sg.common.$q;
  const isVisible = window.sg.common.utils.isVisible;
  const swiperManager = window.sg.common.swiperManager;
  const $window = $q(window);

  const selector = {
    section: '.ftd16-interactive-multi-feature__top',
    controlDrag: '.horizontal-slide button, .vertical-slide button',
    controlShow: '.button-controller',
    controlVideo: '.button-auto-loop:not(.before)',
    controlVideoB: '.button-auto-loop.before',
    controlWrap: '.ftd16-interactive-multi-feature__controller',
    before: '.ftd16-interactive-multi-feature__before-contents',
    after: '.ftd16-interactive-multi-feature__after-contents',
    focusGo: '.ftd16-interactive-multi-feature__video-title', //   video     focus  
  };

  const selectorM = {
    section: '.ftd16-interactive-multi-feature',
    controlHwrap: 'ftd16-interactive-multi-feature--horizontal-slide',
  };

  function changeVideo ($btns,state) {
    if (state === 'stop') {
      $btns.target.forEach((btn) => {
        btn.classList.remove('is-play');
        if (btn.dataset.anLa) {
          btn.setAttribute('an-la',`${btn.dataset.anLa}:play video`);
        }
      });
    } else {
      $btns.target.forEach((btn) => {
        btn.classList.add('is-play');
        if (btn.dataset.anLa) {
          btn.setAttribute('an-la',`${btn.dataset.anLa}:stop video`);
        }
      });
    }
  }

  class InteractiveMultiFeature {
    constructor(element) {
      this.el = {
        section: $q(element),
      };

      this.timer = null;

      this.handler = {
        bindSwiper: this.bindSwiper.bind(this),
        motionPreview: this.motionPreview.bind(this),
      };

      InteractiveMultiFeature.instances.set(element, this);
      this.init();
    }

    setElements() {
      this.el.swiper = this.el.section.find('.ftd16-interactive-multi-feature__swiper-container');
      this.el.indiNumber = this.el.section.find('.indicator__current-number span:nth-child(1)');

      this.el.swiper.find(`.${selectorM.controlHwrap} .ftd16-interactive-multi-feature__before-contents img,.${selectorM.controlHwrap} .ftd16-interactive-multi-feature__after-contents img`).target.forEach((img) => {
        img.draggable = false;
      });

      if (this.el.swiper.find('.swiper-slide').target.length <= 1) {
        this.el.section.find('.indicator, .indicator--number').hide();
      } else {
        this.el.section.find('.indicator, .indicator--number').css({
          display: '',
        });
      }
    }

    init() {
      this.setElements();
      this.bindEvents();
    }

    reInit() {
      this.setElements();
      this.bindEvents();
    }

    bindEvents() {
      swiperManager.slideInitEnd(this.el.swiper.target[0],this.handler.bindSwiper);
    }

    bindSwiper() {
      const swiper = this.el.swiper.target[0].swiper;
      const isIndiNumber = this.el.indiNumber.target.length > 0;

      this.el.section.find('.indicator__total-number span:nth-child(1)').text(swiper.slides.length);
      this.el.section.find(selector.controlDrag).addClass('button-controller--scroll');

      [...document.querySelectorAll(selector.section)].forEach((el) => {
        if (el.querySelector(selector.controlDrag)) {
          if (!InteractiveSingleDrag.instances.has(el)) {
            new InteractiveSingleDrag(el);
          }
        } else {
          if (!InteractiveSingleFeature.instances.has(el)) {
            new InteractiveSingleFeature(el);
          }
        }
      });

      if(isVisible(this.el.swiper.find('.swiper-wrapper .swiper-slide:first-child').target[0])){
        this.motionPreview();
      } else {
        document.addEventListener('scroll', this.handler.motionPreview);
        window.addEventListener('resize', this.handler.motionPreview);
        window.addEventListener('orientationchange', this.handler.motionPreview);
      }

      swiper.on('slideChange',() => {
        if (isIndiNumber) {
          this.el.indiNumber.text(swiper.activeIndex + 1);
        }

        changeVideo($q(swiper.slides[swiper.activeIndex]).find(`${selector.controlVideo},${selector.controlVideoB}`),'stop');

        setTimeout(() => {
          this.singleIn(swiper.slides[swiper.activeIndex]);
          this.singleOut(swiper.slides[swiper.previousIndex]);
        },swiper.params.speed);
      });
    }

    singleIn(slide) {
      const sligle = slide.querySelector(selector.section);
      if (slide.querySelector('.video--autoplay') !== null) {
        if (InteractiveSingleFeature.instances.has(sligle)) {
          InteractiveSingleFeature.instances.get(sligle).initVideoPlay();
        }
      } else if (InteractiveSingleDrag.instances.has(sligle)) {
        InteractiveSingleDrag.instances.get(sligle).motionController();
      }
    }

    singleOut(slide) {
      const sligle = slide.querySelector(selector.section);
      if (InteractiveSingleFeature.instances.has(sligle)) {
        const ins = InteractiveSingleFeature.instances.get(sligle);
        if (ins.els.switchBtn) {
          if (ins.initSwitchActive) {
            if (ins.els.switchBtn.classList.contains('on') === false) {
              $q(ins.els.switchBtn).trigger('click');
            }
          } else {
            if (ins.els.switchBtn.classList.contains('on')) {
              $q(ins.els.switchBtn).trigger('click');
            }
          }

          changeVideo(ins.els.$controlVideo,'stop');
          [...sligle.querySelectorAll('.video')].forEach((vi) => {
            window.sg.common.video.destroy(vi);
            $q(vi).closest(`${selector.before},${selector.after}`).removeClass('is-show--video');
          });
          if (sligle.querySelector('.ftd16-interactive-multi-feature__after-contents.video--autoplay') === null) {
            ins.isAfterAuto = false;
          }
          if (sligle.querySelector('.ftd16-interactive-multi-feature__before-contents.video--autoplay') === null) {
            ins.isBeforeAuto = false;
          }
        } else {
          ins.hideAfter(false);
        }
      } else {
        const ins = InteractiveSingleDrag.instances.get(sligle);
        if (ins.motionType === 'horizontal') {
          ins.moveClipImg(50,'%');
        } else {
          ins.moveOpacityImg(0,'%');
        }
      }
    }

    motionPreview() {
      const firstSlide = this.el.swiper.find('.swiper-wrapper .swiper-slide:first-child');
      if (firstSlide.hasClass('isView')) {
        document.removeEventListener('scroll', this.handler.motionPreview);
        window.removeEventListener('resize', this.handler.motionPreview);
        window.removeEventListener('orientationchange', this.handler.motionPreview);
        return;
      }

      if(isVisible(firstSlide.target[0])){
        firstSlide.addClass('isView');
        this.singleIn(firstSlide.target[0]);
      }
    }
  }
  class InteractiveSingleDrag { // from << ftd15-interactive-single-feature.js
    constructor(el) {
      const controlDrag = el.querySelector(selector.controlDrag);
      if (controlDrag === null) {
        return false;
      }

      this.els = {
        el,
        controlDrag,
      };

      this.motionType = null;

      this.handler = {
        touchDownControl: () => {
          $window.off('mousemove', this.handler.touchMoveControl).on('mousemove', this.handler.touchMoveControl);
          window.removeEventListener('touchmove', this.handler.touchMoveControl);
          window.addEventListener('touchmove', this.handler.touchMoveControl, { passive: false });

          $window.off('mouseup', this.handler.touchUpControl).on('mouseup', this.handler.touchUpControl);
          $window.off('touchend', this.handler.touchUpControl).on('touchend', this.handler.touchUpControl);
        },
        touchMoveControl: (event) => {
          event.preventDefault();
          if (this.motionType === 'horizontal') {
            this.moveClipImg(event.pageX || event.touches[0].pageX, 'px');
          } else {
            this.moveOpacityImg(event.clientY || event.touches[0].clientY, 'px');
          }
        },
        touchUpControl: () => {
          $window.off('mousemove', this.handler.touchMoveControl);
          window.removeEventListener('touchmove', this.handler.touchMoveControl);
          $window.off('mouseup', this.handler.touchUpControl);
          $window.off('touchend', this.handler.touchUpControl);
        },
        keydownControl: (event) => {
          const code = window.sg.common.constants.KEY_CODE;
          if (this.motionType === 'horizontal') {
            const now = parseFloat(this.els.controlDrag.parentNode.style.left || 50);
            if (event.keyCode === code.LEFT) {
              this.moveClipImg(now - 5, '%');
            } else if (event.keyCode === code.RIGHT) {
              this.moveClipImg(now + 5, '%');
            }
          } else {
            const now = parseFloat(this.els.controlDrag.style.top || 50);
            if (event.keyCode === code.UP) {
              event.preventDefault();
              this.moveOpacityImg(now - 5, '%');
            } else if(event.keyCode === code.DOWN) {
              event.preventDefault();
              this.moveOpacityImg(now + 5, '%');
            }
          }
        },
        resizeHorizon: () => {
          this.moveClipImg(parseFloat(this.els.controlDrag.parentNode.style.left || 50), '%');
        },
      };

      InteractiveSingleDrag.instances.set(this.els.el, this);

      this.init();
    }

    init() {
      this.motionType = this.els.el.querySelector('.vertical-slide') ? 'vertical' : 'horizontal';

      this.bindEvents();
    }

    bindEvents() {
      if (this.motionType === 'horizontal') {
        $window.off('resize', this.handler.resizeHorizon).on('resize', this.handler.resizeHorizon);
      }

      const $afterImg = this.els.el.querySelector(`${selector.after} .image__main`);
      if ($afterImg.classList.contains('image--loaded')) {
        if (this.motionType === 'horizontal') {
          this.moveClipImg(50, '%');
        } else {
          this.moveOpacityImg(0, '%');
        }
      } else {
        $afterImg.addEventListener('load',() => {
          if (this.motionType === 'horizontal') {
            this.moveClipImg(50, '%');
          } else {
            this.moveOpacityImg(0, '%');
          }
        });
      }

      const $controlDrag = $(this.els.controlDrag);
      $controlDrag.off('mousedown',this.handler.touchDownControl).on('mousedown',this.handler.touchDownControl);
      $controlDrag.off('touchstart',this.handler.touchDownControl).on('touchstart',this.handler.touchDownControl);
      $controlDrag.off('keydown',this.handler.keydownControl).on('keydown',this.handler.keydownControl);
    }


    moveOpacityImg(touchY, unit) {
      const barRect = this.els.controlDrag.parentNode.getBoundingClientRect();
      const move = touchY - barRect.top;
      let perY = (unit === 'px') ? (move / barRect.height) : (touchY / 100);

      if (perY < 0) {
        perY = 0;
      } else if (perY > 1) {
        perY = 1;
      }

      this.els.controlDrag.style.top = `${perY * 100}%`;
      this.els.el.querySelector(selector.after).style.opacity = perY;
    }

    moveClipImg(move, unit){
      const $img = this.els.el.querySelector(selector.before);
      let pxX = null;
      let perX = null;

      if (unit === 'px') { //when px
        pxX = move - this.els.el.getBoundingClientRect().left;
        if(pxX < 0){
          pxX = 0;
        } else if(pxX > this.els.el.offsetWidth){
          pxX = this.els.el.offsetWidth;
        }
        perX = pxX / this.els.el.offsetWidth;
      } else { //when %
        if(move < 0){
          move = 0;
        } else if(move > 100){
          move = 100;
        }
        move = move / 100;
        pxX = this.els.el.offsetWidth * move;
        perX = move;
      }

      this.els.controlDrag.parentNode.style.left = `${perX * 100}%`;
      $img.style.clip = `rect(0px, ${pxX}px, ${this.els.el.offsetHeight + 1}px, 0px)`;
    }

    motionController() {
      if (this.els.el.classList.contains('controller-showed')) {
        return;
      }
      this.els.el.classList.add('controller-showed');

      if(this.motionType === 'horizontal') {
        InteractiveSingleDrag.bezierMove([400,50,500,50,400], (idx,per) => {
          if (idx === 0) {
            this.moveClipImg(50 - (50 * per), '%');
          } else if (idx === 2) {
            this.moveClipImg(100 * per, '%');
          } else if (idx === 4) {
            this.moveClipImg(100 - (50 * per), '%');
          } else if (idx === 5) {
            this.moveClipImg(50, '%');
          }
        }, [0.02, 0.01, 0.47, 1]);
      } else {
        InteractiveSingleDrag.bezierMove([500,50,500], (idx,per) => {
          if (idx === 0) {
            this.moveOpacityImg(100 * per, '%');
          } else if (idx === 2) {
            this.moveOpacityImg(100 - (100 * per), '%');
          } else if (idx === 3) {
            this.moveOpacityImg(0, '%');
          }
        }, [0.02, 0.01, 0.47, 1]);
      }
    }

    static bezierMove(times, callback, bezier) {
      const frame = 20;
      const accrue = [];
      let idx = 0;
      let pass = 0;
      let timer = null;

      times.forEach((time,idx) => {
        if (idx === 0) {
          accrue[0] = time;
        } else {
          accrue[idx] = accrue[idx - 1] + time;
        }
      });

      timer = setInterval(() => {
        pass += frame;

        if (pass > accrue[idx]) {
          idx++;
        }

        let per = null;
        if (idx === 0) {
          per = pass / times[0];
        } else {
          per = (pass - accrue[idx - 1]) / times[idx];
        }

        const per2 = 1 - per;
        const move = 3 * (Math.pow(per2, 2) * per) * bezier[1] + 3 * (per2 * Math.pow(per, 2)) * bezier[3] + Math.pow(per, 3) * 1;

        callback(idx, move);

        if (pass > accrue[accrue.length - 1]) {
          clearInterval(timer);
          timer = null;
        }
      }, frame);
    }
  }
  class InteractiveSingleFeature { // from << ftd15-interactive-single-feature.js
    constructor(el) {
      this.els = {
        el,
      };

      this.handler = {
        clickShowBtn: () => {
          this.showAfter();
        },
        videoPlayStop: (event) => {
          if (event.currentTarget.classList.contains('is-play')) {
            this.videoStop();
          } else {
            this.videoPlay();
          }
        },
        clickSwitch: () => {
          this.isAfterAuto = true;
          this.isBeforeAuto = true;

          if (this.els.switchBtn.classList.contains('on')) {
            this.showAfter();
            this.els.$controlWrap.removeClass('is-show--small-before');
            if (this.els.switchBtn.dataset.anLa) {
              this.els.switchBtn.setAttribute('an-la',`${this.els.switchBtn.dataset.anLa}:off`);
            }
          } else {
            this.hideAfter();
            this.els.$controlWrap.addClass('is-show--small-before');
            if (this.els.switchBtn.dataset.anLa) {
              this.els.switchBtn.setAttribute('an-la',`${this.els.switchBtn.dataset.anLa}:on`);
            }
          }
        },
      };

      InteractiveSingleFeature.instances.set(this.els.el, this);

      this.init();
    }

    init() {
      this.els.$el = $q(this.els.el);
      this.els.switchBtn = this.els.el.querySelector('.switch-v2__button');
      this.els.$controlShow = this.els.$el.find(selector.controlShow);
      this.els.$controlVideo = this.els.$el.find(selector.controlVideo);
      this.els.$controlWrap = this.els.$el.find(selector.controlWrap);

      this.els.afterDiv = this.els.el.querySelector(selector.after);
      this.els.beforeDiv = this.els.el.querySelector(selector.before);

      //set tagging
      changeVideo(this.els.$el.find(`${selector.controlVideo},${selector.controlVideoB}`),'stop');
      this.els.$el.find('.switch-v2__button').target.forEach((el) => {
        if (el.dataset.anLa) {
          if (el.classList.contains('on')) {
            el.setAttribute('an-la',`${el.dataset.anLa}:off`);
          } else {
            el.setAttribute('an-la',`${el.dataset.anLa}:on`);
          }
        }
      });

      // set video property : after Video (default)
      this.isShowLarge = true;
      this.isHideSmall = true;
      this.els.afterVideo = this.els.el.querySelector(`${selector.after} .video`);
      if (this.els.afterVideo) {
        this.isAfterLoop = JSON.parse(this.els.afterVideo.dataset.videoData).loop;
        this.isAfterAuto = this.els.afterDiv.classList.contains('video--autoplay');
        const isAfterShort = this.els.afterDiv.classList.contains('video--under5s');

        if (this.els.$controlWrap.hasClass('tap')) {
          this.isHideSmall = isAfterShort;
        } else if(this.els.$controlWrap.hasClass('video-play')) {
          this.isShowLarge = (
            (isAfterShort && this.isAfterAuto === false && this.isAfterLoop === false)
            || (isAfterShort && this.isAfterAuto === true && this.isAfterLoop === false)
          );
          this.isHideSmall = this.isShowLarge;
        }
      }

      // set video property : switch has before Video
      if (this.els.switchBtn) {
        this.els.$controlVideoB = this.els.$el.find(selector.controlVideoB);

        this.els.beforeVideo = this.els.el.querySelector(`${selector.before} .video`);
        if (this.els.beforeVideo) {
          this.isBeforeLoop = JSON.parse(this.els.beforeVideo.dataset.videoData).loop;
          this.isBeforeAuto = this.els.beforeDiv.classList.contains('video--autoplay');
          this.isBeforeShort = this.els.beforeDiv.classList.contains('video--under5s');
        }

        this.initSwitchActive = this.els.switchBtn.classList.contains('on');
      }

      this.bindEvents();

      // this.initVideoPlay();
    }

    bindEvents() {
      this.els.$controlShow.off('click',this.handler.clickShowBtn).on('click',this.handler.clickShowBtn);
      this.els.$controlVideo.off('click',this.handler.videoPlayStop).on('click',this.handler.videoPlayStop);

      if (this.els.switchBtn) {
        $q(this.els.switchBtn).off('click',this.handler.clickSwitch).on('click',this.handler.clickSwitch);
        this.els.$controlVideoB.off('click',this.handler.videoPlayStop).on('click',this.handler.videoPlayStop);
      }
    }

    initVideoPlay() {
      if (this.els.switchBtn) {
        if (this.els.switchBtn.classList.contains('on')) {
          if (this.isAfterAuto) {
            this.showAfter(false);
          }
        } else {
          if (this.isBeforeAuto) {
            this.hideAfter(false);
          }
        }
      } else if (this.isAfterAuto) {
        this.showAfter(false);
      }
    }

    showAfter(focusMove = true) {
      this.els.$el.find(selector.before).addClass('contents-hidden');

      if (this.els.switchBtn === null) {
        this.els.$controlWrap.addClass('is-hidden--large');
      }

      if (this.els.beforeVideo) {
        window.sg.common.video.destroy(this.els.beforeVideo);
        this.els.beforeDiv.classList.remove('is-show--video');
        changeVideo(this.els.$controlVideoB,'stop');
      }

      if (this.els.afterVideo) {
        const isAfterStop = (this.els.switchBtn && this.isAfterAuto === false);
        if (isAfterStop) {
          changeVideo(this.els.$controlVideo,'stop');
          return;
        }

        if (this.isHideSmall === false) {
          this.els.$controlWrap.addClass('is-show--small');
        }

        this.videoInitAfter();

        if (focusMove && this.els.switchBtn === null) {
          const goFocus = this.els.$el.find(`.is-show--small ${selector.controlVideo}`);
          if (goFocus.target.length > 0) {
            goFocus.focus();
          } else {
            this.els.$el.find(`${selector.after} ${selector.focusGo}`).attr('tabindex',0).focus();
          }
        }

        this.els.afterVideo.querySelector('video').addEventListener('loadeddata', () => {
          this.els.$el.find(selector.before).addClass('contents-hidden');
        });
      }
    }

    hideAfter(focusMove = true) {
      this.els.$el.find(selector.before).removeClass('contents-hidden');

      if (this.isShowLarge) {
        this.els.$controlWrap.removeClass('is-hidden--large');
      }

      if (this.els.afterVideo) {
        window.sg.common.video.destroy(this.els.afterVideo);
        this.els.afterDiv.classList.remove('is-show--video');
        changeVideo(this.els.$controlVideo,'stop');
        if (this.isHideSmall || this.els.$controlWrap.hasClass('tap')) {
          this.els.$controlWrap.removeClass('is-show--small');
        }
      }

      if(this.els.beforeVideo && this.isBeforeAuto) {
        this.videoInitBefore();
      }

      if (focusMove && this.els.switchBtn === null && $q(document.activeElement).closest(selector.section).target.length > 0) {
        const goFocus = this.els.$el.find(`.is-show--small ${selector.controlVideo}`);
        if (goFocus.target.length > 0) {
          goFocus.focus();
        } else {
          this.els.$controlShow.focus();
        }
      }
    }

    videoPlay(){
      if (this.els.switchBtn) {
        if (this.els.switchBtn.classList.contains('on') === false) {
          const videoEl = this.els.beforeVideo;
          if (videoEl.innerText.trim() === '') {
            this.videoInitBefore();
          } else {
            window.sg.common.video.play(videoEl);
            changeVideo(this.els.$controlVideoB,'play');
          }
        } else {
          const videoEl = this.els.afterVideo;
          if (videoEl.innerText.trim() === '') {
            this.videoInitAfter();
          } else {
            window.sg.common.video.play(videoEl);
            changeVideo(this.els.$controlVideo,'play');
          }
        }
      } else {
        const videoEl = this.els.afterVideo;
        if (videoEl.innerText.trim() === '') {
          this.showAfter();
        } else {
          window.sg.common.video.play(videoEl);
          changeVideo(this.els.$controlVideo,'play');
        }
      }
    }

    videoStop(){
      if (this.els.switchBtn && this.els.switchBtn.classList.contains('on') === false) {
        const videoEl = this.els.beforeVideo.querySelector('video');
        videoEl.pause();
        changeVideo(this.els.$controlVideoB,'stop');
      } else {
        const videoEl = this.els.afterVideo.querySelector('video');
        videoEl.pause();
        changeVideo(this.els.$controlVideo,'stop');
      }
    }

    videoInitAfter(){
      window.sg.common.video.init(this.els.afterVideo);
      this.els.afterDiv.classList.add('is-show--video');
      requestAnimationFrame(() => {
        window.sg.common.video.play(this.els.afterVideo);
        changeVideo(this.els.$controlVideo,'play');

        if(this.isAfterLoop !== true) {
          $q(this.els.afterVideo).find('video').off('ended').on('ended',() => {
            if(this.els.switchBtn){
              window.sg.common.video.destroy(this.els.afterVideo);
              this.els.afterDiv.classList.remove('is-show--video');
              changeVideo(this.els.$controlVideo,'stop');
            } else {
              this.hideAfter();
            }
          });
        }
      });
    }

    videoInitBefore(){ //use only Toggle
      window.sg.common.video.init(this.els.beforeVideo);
      this.els.beforeDiv.classList.add('is-show--video');
      requestAnimationFrame(() => {
        window.sg.common.video.play(this.els.beforeVideo);
        changeVideo(this.els.$controlVideoB,'play');

        if(this.isBeforeLoop !== true) {
          $q(this.els.beforeVideo).find('video').off('ended').on('ended',() => {
            window.sg.common.video.destroy(this.els.beforeVideo);
            this.els.beforeDiv.classList.remove('is-show--video');
            changeVideo(this.els.$controlVideoB,'stop');
          });
        }
      });
    }
  }


  const init = () => {
    $q(selectorM.section).target.forEach((element) => {
      if (InteractiveMultiFeature.instances.has(element)) {
        InteractiveMultiFeature.instances.get(element).reInit();
      } else {
        new InteractiveMultiFeature(element);
      }
    });
  };

  InteractiveSingleDrag.instances = new WeakMap();
  InteractiveSingleFeature.instances = new WeakMap();
  InteractiveMultiFeature.instances = new WeakMap();

  $q.ready(init);

  window.sg.components.InteractiveMultiFeature = {
    init,
  };
})();

(() => {
  const $q = window.sg.common.$q;

  class Ftd14KeyFeatureIcon {
    constructor(el) {
      this.els = {
        el,
        columnEls: el.querySelectorAll('.ftd14-key-feature-icon__column'),
      };

      this.init();
    }

    init() {
      if (Ftd14KeyFeatureIcon.instances.has(this.els.el)) {
        return;
      }

      Ftd14KeyFeatureIcon.instances.set(this.els.el, this);

      this.bindEvents();

      this.setCardHeight();
    }

    bindEvents() {
      [...this.els.columnEls].forEach((el) => {
        el.addEventListener('click', () => {
          const target = el.getAttribute('href').trim();
          if (target.startsWith('#')) {
            if (document.querySelector('.pd-header-navigation-keep')) {
              window.sg.components.pdHeaderNavigation.scrollToAnchor(target);
            } else if (document.querySelector('.pd11-anchor-nav-keep')) {
              window.sg.components.pdAnchorNav.scrollToAnchor(target);
            }
          }
        });
      });
    }

    setCardHeight() {
      if (window.sg.common.utils.getCurrentDevice() === 'mobile') {
        const listArr = this.els.columnEls;

        let h = 0;
        let tempList = [];

        listArr.forEach((el, idx) => {
          if (h < el.clientHeight) {
            h = el.clientHeight;
          }
          tempList.push(el);
          if (idx === listArr.length - 1) {
            tempList.forEach((tEl) => {
              tEl.style.height = `${h}px`;
            });

            h = 0;
            tempList = [];
          }
        });
      }
    }
  }

  Ftd14KeyFeatureIcon.instances = new WeakMap();

  const ftd14KeyFeatureIcon = {
    initAll() {
      [...document.querySelectorAll('.ftd14-key-feature-icon')].forEach((el) => {
        if (!Ftd14KeyFeatureIcon.instances.has(el)) {
          new Ftd14KeyFeatureIcon(el);
        .components.ftd14KeyFeatureIcon = ftd14KeyFeatureIcon;
  $q.ready(() => ftd14KeyFeatureIcon.initAll());
})();

(() => {
  const $q = window.sg.common.$q;
  const scrollbar = window.sg.common.scrollbar;
  const utils = window.sg.common.utils;
  const swiperManager = window.sg.common.swiperManager;


  let tradeInPopupEls = {};
  let focusTargetEl = false;
  let categorySwiper = null;

  const selector = {
    section: '.trade-in-popup',
    close: '.trade-in-popup__close',
    tradeinSelect: '.trade-in-select',
    placeholder: '.trade-in-select__placeholder',
    tradeinSelectOptions: '.trade-in-select__options',
    chooseSelect: '.trade-in-popup__tradeIn-select__choose-wrap',
    focusEl: 'a:not([style*="display: none"]):not([style*="display:none"]), button:not([style*="display: none"]):not([style*="display:none"]), button:not(.swiper-button-disabled), input',
  };

  const newDropdownInitArray = [];

  function init() {
    const tradeInPopup = document.querySelector('.trade-in-popup');

    if (!tradeInPopup) {
      return;p);

    bindEvents();
    categorySwiperReInit();
  }

  function reInit() {
    init();
  }

  function setElements(el) {
    tradeInPopupEls = {
      el,
      $el: $q(el),
      contentsEl: el.querySelector('.trade-in-popup__contents'),
      stepEls: el.querySelectorAll('.trade-in-popup__contents > div'),
      currentStepEl: el.querySelector('.trade-in-popup__contents > div:first-of-type'),
      showStepEl: el.querySelector('.trade-in-popup__step--show > div:first-of-type'),
      closeCtaEl: el.querySelector('.trade-in-popup__btn-close'),
      tooltipEls: el.querySelectorAll('.trade-in-popup__condition-list-item-tooltip'),
      closeEl: el.querySelector('.trade-in-popup__close'),
      sehkConditionWrapEl: el.querySelector('.trade-in-popup__sehk-condition-wrap'),
      promoCodeEl: el.querySelector('.trade-in-popup__promo'),
      tradeinSelectOptions: el.querySelectorAll('.trade-in-select__options'),
      dropdownSearchInput: el.querySelector('.trade-in-select .text-field-v2__input'),
      dropdownTypeSearch: el.querySelector('.trade-in-select.is-input-txt'),
    };

    tradeInPopupEls.$placeholder = tradeInPopupEls.$el.find('.trade-in-select__placeholder');
    tradeInPopupEls.$tradeinSelectOptions = tradeInPopupEls.$el.find('.trade-in-select__options');
    tradeInPopupEls.$chooseSelect = tradeInPopupEls.$el.find('.trade-in-popup__tradeIn-select__choose-wrap');
    tradeInPopupEls.$inputDelete = tradeInPopupEls.$el.find('.text-field-v2__input-icon');
    tradeInPopupEls.$categoryWrap = tradeInPopupEls.$el.find('.trade-in-popup__tradeIn-category-swiper');

    [...tradeInPopupEls.contentsEl.querySelectorAll('.scrollbar')].forEach((scrollbarEl) => {
      scrollbar.init(scrollbarEl);
    });
    categorySwiperReInit();
  }

  function showStep(selector) {
    tradeInPopupEls.stepEls.forEach((stepEls) => {
      stepEls.classList.remove('trade-in-popup__step--show');
    });
    tradeInPopupEls.currentStepEl = tradeInPopupEls.el.querySelector(selector);
    tradeInPopupEls.currentStepEl.classList.add('trade-in-popup__step--show');
    tradeInPopupEls.currentStepEl.querySelectorAll('a, button, input:not([type="hidden"]), textarea')[0].focus();
    resizePopup();
    setRecaptcha();
    window.sg.common.lazyLoad.setLazyLoad();
  }

  function setRecaptcha() {
    const setRecaptcha = () => {
      const recaptchaIframeEl = tradeInPopupEls.currentStepEl.querySelector('.trade-in-popup__recaptcha-iframe-wrap iframe');
      const src = recaptchaIframeEl.getAttribute('src');
      const regex = /[?&]k=(.+?)&/gi;
      const key = src.match(regex)[0].replace(regex, '$1');

      const iFrameEls = [...document.querySelectorAll('iframe[title*="reCAPTCHA"]')];
      const closest = window.sg.common.utils.closest;

      for (let i = 0; i < iFrameEls.length; i++) {
        if (iFrameEls[i].getAttribute('src').indexOf(key) > -1
          && iFrameEls[i] !== recaptchaIframeEl
          && !closest(iFrameEls[i], '.trade-in-popup')) {
          const recaptchaChallengeEl = iFrameEls[i].parentElement.parentElement;

          recaptchaChallengeEl.classList.add('recaptcha-challenge-popup');
          recaptchaChallengeEl.removeAttribute('data-aria-hidden');
          recaptchaChallengeEl.removeAttribute('aria-hidden');
          window.removeEventListener('blur', setRecaptcha);
          break;
        }
      }
    };

    if (tradeInPopupEls.currentStepEl.querySelector('.trade-in-popup__recaptcha-iframe-wrap')) {
      window.removeEventListener('blur', setRecaptcha);
      window.addEventListener('blur', setRecaptcha);
    }
  }

  function categorySwiperReInit() {
    if ( tradeInPopupEls.$categoryWrap.find('.swiper-slide').target.length && tradeInPopupEls.$categoryWrap.width() > 0 ) {
      if ( categorySwiper === undefined || categorySwiper === null || categorySwiper === false ) {
        swiperManager.slideReInit( tradeInPopupEls.$categoryWrap.find('.swiper-container').target[0] );
      } else {
        swiperManager.update( tradeInPopupEls.$categoryWrap.find('.swiper-container').target[0] );
      }
      categorySwiper = swiperManager.getSwiper( tradeInPopupEls.$categoryWrap.find('.swiper-container').target[0] );
      categoryLayout();
    } else {
      categorySwiper = null;
    }
  }

  function bindEvents() {
    bindTradeInSelectEvent();

    [...tradeInPopupEls.tooltipEls].forEach((el) => {
      el.removeEventListener('click', tooltipEvent); 
      el.addEventListener('click', tooltipEvent);
    
      el.addEventListener('focusout', () => {
        el.classList.remove('trade-in-popup__condition-list-item-tooltip--show');
      });
    });

    if (tradeInPopupEls.el.querySelector('.trade-in-popup__new-dropdo'.trade-in-popup__new-dropdown')].forEach(() => {
        newDropdownInitArray.push(false);
      });
    }

    tradeInPopupEls.closeCtaEl.removeEventListener('click', closePopup);
    tradeInPopupEls.closeCtaEl.addEventListener('click', closePopup);

    tradeInPopupEls.closeEl.removeEventListener('click', closePopup);
    tradeInPopupEls.closeEl.addEventListener('click', closePopup);

    const closeBtn = document.querySelector(`${selector.section} ${selector.close}`);
    closeBtn.removeEventListener('keydown', keydownCloseBtn);
    closeBtn.addEventListener('keydown', keydownCloseBtn);

    const layer = document.querySelector(`${selector.section}`);
    layer.removeEventListener('keydown', keydownLayer);
    layer.addEventListener('keydown', keydownLayer);



    // sehk-condition-step   
    const handler = {
      sehkChangeRadio: (event) => {
        const btn = event.target;
        const $wrap = $q(btn).closest('.trade-in-popup__issue-list-item');
        const $checks = $wrap.find('.checkbox-v2__input');
        const isNot = $checks.target[0] === btn;
        if (isNot) {
          $wrap.find('.checkbox-v2__input:checked').target.forEach((el) => {
            if(el !== $checks.target[0]){
              el.checked = false;
            }
          });
        } else {
          $checks.target[0].checked = false;
        }
      },
      sehkGoToStep: (event) => {
        let step = null;
        if(event.currentTarget.classList.contains('trade-in-popup__btn-back')){
          step = tradeInPopupEls.sehkConditionWrapEl.querySelectorAll('.is-opened, .is-closed').length - 2;
        } else {
          step = $q(event.currentTarget).closest('.trade-in-popup__issue-list-item').index();
        }
        if (step < 0) {
          step = 0;
        }
        goToStep(step);
      },
    };

    if(tradeInPopupEls.sehkConditionWrapEl) {
      tradeInPopupEls.sehkConditionWrapEl.querySelectorAll('.checkbox-v2__input').forEach((el) => {
        el.removeEventListener('change', handler.sehkChangeRadio);
        el.addEventListener('change', handler.sehkChangeRadio);
      });
      tradeInPopupEls.sehkConditionWrapEl.querySelectorAll('.trade-in-popup__btn-back, .trade-in-popup__issue-list-item-button-wrap button').forEach((el) => {
        el.removeEventListener('click', handler.sehkGoToStep);
        el.addEventListener('click', handler.sehkGoToStep);
      });
    }

    window.addEventListener('resize', () => {
      resizePopup();
    });

    if (tradeInPopupEls.showStepEl) {
      tradeInPopupEls.showStepEl.querySelector('.trade-in-select .text-field-v2__input').removeEventListener('input', searchKeyword);
      tradeInPopupEls.showStepEl.querySelector('.trade-in-select .text-field-v2__input').addEventListener('input', searchKeyword);
      tradeInPopupEls.showStepEl.querySelector('.text-field-v2__input-icon').removeEventListener('click', searchKeywordHide);
      tradeInPopupEls.showStepEl.querySelector('.text-field-v2__input-icon').addEventListener('click', searchKeywordHide);
    }
  }

  function resizePopup() {
    const bufferHeight = Math.round((tradeInPopupEls.currentStepEl.getBoundingClientRect().top - tradeInPopupEls.contentsEl.getBoundingClientRect().top) * 2 + tradeInPopupEls.currentStepEl.querySelector('.trade-in-popup__btn-wrap').getBoundingClientRect().height);

    tradeInPopupEls.currentStepEl.querySelector('.scrollbar__wrap').style.maxHeight = `${window.innerHeight - bufferHeight}px`;

    [...tradeInPopupEls.currentStepEl.querySelectorAll('.scrollbar')].forEach((scrollbarEl) => {
      scrollbar.resize(scrollbarEl);
    });
    categorySwiperReInit();
  }

  function showPopup(targetEl = false) {
    focusTargetEl = targetEl;

    tradeInPopupEls.el.style.display = 'block';
    tradeInPopupEls.currentStepEl.classList.add('trade-in-popup__step--show');

    const firstFocusEl = tradeInPopupEls.currentStepEl.querySelectorAll('a, button, input:not([type="hidden"]), textarea')[0];
    firstFocusEl.focus();

    utilsShow();

    resizePopup();
    setRecaptcha();
  }

  function closePopup() {
    tradeInPopupEls.currentStepEl.classList.remove('trade-in-popup__step--show');
    tradeInPopupEls.el.removeAttribute('style');

    utilsHide();

    originFocus();
  }

  function bindTooltipEvent() {
    tradeInPopupEls.conditionList = tradeInPopupEls.el.querySelectorAll('.trade-in-popup__condition-list');
    tradeInPopupEls.tooltipEls = tradeInPopupEls.el.querySelectorAll('.trade-in-popup__condition-list-item-tooltip');

    [...tradeInPopupEls.tooltipEls].forEach((el) => {
      el.removeEventListener('click', tooltipEvent); 
      el.addEventListener('click', tooltipEvent);
    
      el.addEventListener('focusout', () => {
        el.classList.remove('trade-in-popup__condition-list-item-tooltip--show');
      });
    });

    [...tradeInPopupEls.conditionList].forEach((el) => {
      if ( !el.querySelector('.trade-in-popup__condition-list-item-tooltip') ) {
        return;
      }
      el.querySelectorAll('.trade-in-popup__condition-list-item-check-wrap').forEach((wrap) => {
        if ( !wrap.querySelector('.trade-in-popup__condit(event) {
    event.target.parentElement.classList.toggle('trade-in-popup__condition-list-item-tooltip--show');
  }
  
  function bindTradeInSelectEvent() {
    tradeInPopupEls.$placeholder = tradeInPopupEls.$el.find('.trade-in-select__placeholder');
    tradeInPopupEls.$tradeinSelectOptions = tradeInPopupEls.$el.find('.trade-in-select__options');
    
    tradeInPopupEls.$placeholder.off('click', activeSelect).on('click', activeSelect);
    tradeInPopupEls.$tradeinSelectOptions.off('click', activeOption).on('click', activeOption);
  }

  function bindDropdownEvent() {
    const brandDropdown = tradeInPopupEls.el.querySelector('.trade-in-popup__brand-dropdown-wrap .trade-in-popup__dropdown');
    const brandDropdownBtn = brandDropdown.querySelector('.trade-in-popup__dropdown--select-field');
    const brandDropdownList = brandDropdown.querySelector('.trade-in-popup__dropdown--select-list');
    const brandDropdownItem = brandDropdown.querySelectorAll('.trade-in-popup__dropdown--select-item');

    let selectedBrandItemIndex = -1;

    brandDropdownBtn.addEventListener('click', () => {
      if (brandDropdownBtn.classList.contains('trade-in-popup__dropdown--select-field-open')) {
        brandDropdownBtn.classList.remove('trade-in-popup__dropdown--select-field-open');
      } else {
        brandDropdownBtn.classList.add('trade-in-popup__dropdown--select-field-open');
        scrollbar.resize(brandDropdownList);

        document.addEventListener('click', closeDropdown);
      }
    });

    [...brandDropdownItem].forEach((item, index) => {
      item.addEventListener('click', () => {
        if (selectedBrandItemIndex >= 0) {
          brandDropdownItem[selectedBrandItemIndex].classList.remove('trade-in-popup__dropdown--select-item-selected');
        }
        brandDropdownBtn.querySelector('.trade-in-popup__dropdown--select-field-name').textContent = item.querySelector('.trade-in-popup__dropdown--select-item-name').textContent;
        item.classList.add('trade-in-popup__dropdown--select-item-selected');
        selectedBrandItemIndex = index;
        brandDropdownBtn.classList.remove('trade-in-popup__dropdown--select-field-open');
      });
    });

    const modelDropdown = tradeInPopupEls.el.querySelector('.trade-in-popup__model-dropdown-wrap .trade-in-popup__dropdown');
    const modelDropdownBtn = modelDropdown.querySelector('.trade-in-popup__dropdown--select-field');
    const modelDropdownList = modelDropdown.querySelector('.trade-in-popup__dropdown--select-list');
    const modelDropdownSearchWrap = modelDropdownList.querySelector('.trade-in-popup__dropdown--search-wrap');
    const modelDropdownSearchInput = modelDropdownList.querySelector('.trade-in-popup__dropdown--search-input');

    modelDropdownBtn.addEventListener('click', () => {
      if (modelDropdownBtn.classList.contains('trade-in-popup__dropdown--select-field-open')) {
        modelDropdownBtn.classList.remove('trade-in-popup__dropdown--select-field-open');
      } else {
        modelDropdownBtn.classList.add('trade-in-popup__dropdown--select-field-open');
        scrollbar.resize(modelDropdownList);

        document.addEventListener('click', closeDropdown);
      }
    });

    modelDropdownSearchInput.addEventListener('focus', () => {
  DropdownSearchInput.addEventListener('blur', () => {
      modelDropdownSearchWrap.classList.remove('focus');
    });

    modelDropdownSearchInput.addEventListener('input', () => {
      const inputKeyword = modelDropdownSearchInput.value.replace(/^\s+$/, '').toLowerCase();
      if (inputKeyword !== '') {
        modelDropdownSearchWrap.classList.add('active');
      } else {
        modelDropdownSearchWrap.classList.remove('active');
      }

      [...modelDropdownList.querySelectorAll('.trade-in-popup__dropdown--select-item')].forEach((item) => {
        if (item.querySelector('.trade-in-popup__dropdown--select-item-name').textContent.toLowerCase().includes(inputKeyword) || item.querySelector('.trade-in-popup__dropdown--select-item-price').textContent.toLowerCase().includes(inputKeyword)) {
          item.classList.remove('hide');
        } else {
          item.classList.add('hide');
        }
      });

      scrollbar.resize(modelDropdownList);
    });

    bindModelDropdownItemEvent();
  }

  function bindModelDropdownItemEvent() {
    const targetBtn = tradeInPopupEls.el.querySelector('.trade-in-popup__model-dropdown-wrap .trade-in-popup__dropdown .trade-in-popup__dropdown--select-field');
    const modelDropdownItem = tradeInPopupEls.el.querySelectorAll('.trade-in-popup__model-dropdown-wrap .trade-in-popup__dropdown .trade-in-popup__dropdown--select-item');

    let selectedModelItemIndex = -1;
    tradeInPopupEls.el.querySelector('.trade-in-popup__model-dropdown-wrap .trade-in-popup__dropdown .trade-in-popup__dropdown--search-input').value = '';
    tradeInPopupEls.el.querySelector('.trade-in-popup__model-dropdown-wrap .trade-in-popup__dropdown .trade-in-popup__dropdown--search-wrap').classList.remove('active');

    [...modelDropdownItem].forEach((el, index) => {
      el.addEventListener('click', () => {
        if (selectedModelItemIndex >= 0) {
          modelDropdownItem[selectedModelItemIndex].classList.remove('trade-in-popup__dropdown--select-item-selected');
        }

        targetBtn.querySelector('.trade-in-popup__dropdown--select-field-name').textContent = el.querySelector('.trade-in-popup__dropdown--select-item-name').textContent;
        targetBtn.querySelector('.trade-in-popup__dropdown--select-field-price').textContent = el.querySelector('.trade-in-popup__dropdown--select-item-price').textContent;
        el.classList.add('trade-in-popup__dropdown--select-item-selected');
        selectedModelItemIndex = index;
        targetBtn.classList.remove('trade-in-popup__dropdown--select-field-open');
      });
    });
  }

  function closeDropdown(e) {
    [...tradeInPopupEls.el.querySelectorAll('.trade-in-popup__dropdown')].forEach((el) => {
      if (utils.closest(e.target, '.trade-in-popup__dropdown') !== el) {
        el.querySelector('.trade-in-popup__dropdown--select-field').classList.remove('trade-in-popup__dropdown--select-field-open');
      }
    });

    removeDocumentEvent();
  }

  function removeDocumentEvent() {
    let isOpenAnyDropdown = false;
    [...tradeInPopupEls.el.querySelectorAll('.trade-in-popup__dropdown')].forEach((el) => {
      if (el.querySelector('.trade-in-popup__dropdown--select-field').classList.contains('trade-in-popup__dropdown--select-field-open')) {
        isOpenAnyDropdown = true;
      }
    });

    if (!isOpenAnyDropdown) {
      document.removeEventListener('click', closeDropdown);
    }
  }

  function activeSelect(event) {
    const eTarget = $q(event.target).closest(selector.placeholder);
    const hasInput = $q(event.target).closest('.text-field-v2');
    const itemSelect = eTarget.closest(selector.tradeinSelect);

    if (!itemSelect.hasClass('is-opened')) {
      itemSelect.closest(selector.chooseSelect).siblings().target.forEach((el) => {
        const $el = $q(el);
        if ($el.find(selector.tradeinSelect).hasClass('is-opened')) {
          closeSelect($el.find(selector.placeholder));
        }
      });
      openSelect(eTarget);
    } else {
      if ( hasInput.target.length === 0 ) {
        closeSelect(eTarget);
      }
    }
  }

  function openSelect(item) {
    const itemSelect = item.closest(selector.tradeinSelect);
    const itemSelectOption = itemSelect.find(selector.tradeinSelectOptions);
    const globalText = JSON.parse(itemSelect.target[0].dataset.globalText);
    const fieldInput = itemSelect.find('.text-field-v2__input');

    item.attr('aria-expanded', true);
    item.find('.hidden').text(globalText.Collapse);
    itemSelect.addClass('is-opened');
    itemSelectOption.attr('aria-hidden', false);

    window.sg.common.textFieldv2.initAll();
    /* P6 Modify =>       0.3  */
    setTimeout(() => {
      tradeInPopupEls.$tradeinSelectOptions = tradeInPopupEls.$el.find('.trade-in-select__options');
      tradeInPopupEls.$tradeinSelectOptions.off('click', activeOption).on('click', activeOption);
      fieldInput.focus();
    }, 300);
  }

  function closeSelect(item) {
    const itemSelect = item.closest(selector.tradeinSelect);
    const itemSelectOption = itemSelect.find(selector.tradeinSelectOptions);
    const globalText = JSON.parse(itemSelect.target[0].dataset.globalText);

    item.attr('aria-expanded', false);
    item.find('.hidden').text(globalText.Expand);
    itemSelect.removeClass('is-opened');
    itemSelectOption.attr('aria-hidden', true);
  }

  function activeOption(event) {
    tradeInPopupEls.$chooseSelect = tradeInPopupEls.$el.find('.trade-in-popup__tradeIn-select__choose-wrap');

    const item = $q(event.target).closest(`${selector.tradeinSelectOptions} li`);
    const itemWrap = item.closest(selector.tradeinSelect);

    itemWrap.find(`${selector.tradeinSelectOptions} li`).removeClass('is-selected');
    item.addClass('is-selected');

    if (!itemWrap.hasClass('is-selected')) {
      itemWrap.addClass('is-selected');
    }

    itemWrap.find('.trade-in-select__placeholder-name span').text(item.find('.trade-in-popup__tradeIn-select__choose-name').target[0].textContent);

    activeSelect(item.closest(selector.tradeinSelect).find(selector.placeholder));
  }

  
  function keydownLayer(evt) {
    if (evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode) {
      const firstEl = document.querySelector(`${selector.section}`).querySelector('.trade-in-popup__step--show').querySelectorAll('a, button, input:not([type="hidden"]), textarea')[0];
      if (evt.target === firstEl) {
        evt.preventDefault();
        document.querySelector(`${selector.section} ${selector.close}`).focus();
      }
      
      const radioCheck = firstEl.getAttribute('type');
      const GroupCheck = firstEl.getAttribute('name');
      if (radioCheck === 'radio' && GroupCheck === evt.target.getAttribute('name')) {
        evt.preventDefault();
        document.querySelector(`${selector.section} ${selector.close}`).focus();
      }
    }
  }

  function searchKeyword() {
    const inputKeyword = tradeInPopupEls.dropdownSearchInput.value.replace(/^\s+$/, '').toLowerCase();
    tradeInPopupEls.dropdownTypeSearch.querySelectorAll('.trade-in-select__options li').forEach((item) => {
      const selectNameValue = item.querySelector('.trade-in-popup__tradeIn-select__choose-name') !== null ? item.querySelector('.trade-in-popup__tradeIn-select__choose-name').textContent.toLowerCase().includes(inputKeyword) : false;
      const selectPriceValue = item.querySelector('.trade-in-popup__tradeIn-select__choose-price') !== null ? item.querySelector('.trade-in-popup__tradeIn-select__choose-price').textContent.toLowerCase().includes(inputKeyword) : false;
      if (selectNameValue || selectPriceValue) {
        item.classList.remove('hide');
      } else {
        item.classList.add('hide');
      }
    });
  }

  function searchKeywordHide() {
    tradeInPopupEls.dropdownTypeSearch.querySelectorAll('.trade-in-select__options li').forEach((item) => {
      item.classList.remove('hide');
    });
  }
 
  function keydownCloseBtn(evt) {
    if (!evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode) {
      evt.preventDefault();
      document.querySelector(`${selector.section}`).querySelector('.trade-in-popup__step--show').querySelectorAll('a, button, input:not([type="hidden"]), textarea')[0].focus();
    }
  }


  function originFocus() {
    if (focusTargetEl) {
      focusTargetEl.focus();
    } else {
      utils.buyingFocus('tradeInPopup');
    }
  }

  function utilsShow() {
    utils.popupControl.open(closePopup);
    utils.hiddenScroll();
    utils.setMobileFocusLoop(tradeInPopupEls.el);
  }

  function utilsHide() {
    utils.popupControl.close();
    utils.visibleScroll();
    utils.removeMobileFocusLoop();
  }

  function bindNewDropdownEvent(index) {
    const newDropdown = tradeInPopupEls.el.querySelectorAll('.trade-in-popup__new-dropdown')[index];
    const newDropdownSelectField = newDropdown.querySelector('.trade-in-popup__new-dropdown--select-field');

    if (!newDropdownInitArray[index]) {
      newDropdownInitArray[index] = true;
      newDropdown.classList.remove('hide');

      newDropdownSelectField.classList.add('open');
      newDropdownSelectField.setAttribute('aria-expanded', 'true');
      newDropdownSelectField.focus();
      scrollbar.resize(newDropdown.querySelector('.scrollbar'));

      newDropdown.querySelector('.trade-in-popup__new-dropdown--select-field').addEventListener('click', () => {
        if (newDropdownSelectField.classList.contains('open')) {
          newDropdownSelectField.classList.remove('open');
          newDropdownSelectField.setAttribute('aria-expanded', 'false');
        } else {
          newDropdownSelectField.classList.add('open');
          newDropdownSelectField.setAttribute('aria-expanded', 'true');
        }

        scrollbar.resize(newDropdown.querySelector('.scrollbar'));

        [...tradeInPopupEls.el.querySelectorAll('.trade-in-popup__new-dropdown')].forEach((dropdown) => {
          if (dropdown !== newDropdown) {
            dropdown.querySelector('.trade-in-popup__new-dropdown--select-field').classList.remove('open');
          }
        });
      });
    }

    [...newDropdown.querySelectorAll('.trade-in-popup__new-dropdown--select-item-wrap')].forEach((button) => {
      button.addEventListener('click', () => {
        newDropdownSelectField.innerText = button.querySelector('.trade-in-popup__new-dropdown--select-item-name').innerText;
        newDropdownSelectField.classList.remove('open');
        newDropdownSelectField.focus();
      });
    });
  }

  function showWarningMessage() {
    tradeInPopupEls.el.querySelector('.trade-in-popup__seca-imei-wrap .trade-in-popup__seca-imei--warning-message-wrap').classList.add('show');

    resizePopup();
  }

  function showDeviceList() {
    tradeInPopupEls.el.querySelector('.trade-in-popup__seca-imei-wrap .trade-in-popup__brand-list-wrap').classList.add('show');

    resizePopup();
  }

  function bindSecaSelectDropdownEvent(index) {
    resizePopup();

    const secaSelectDropdownContainerEl = tradeInPopupEls.el.querySelector('.trade-in-popup__seca-select-wrap .trade-in-popup__seca-select--dropdown-container');
    const targetDropdown = secaSelectDropdownContainerEl.querySelectorAll('.trade-in-popup__seca-select--dropdown')[index];
    const btn = targetDropdown.querySelector('.trade-in-popup__seca-select--dropdown-select-field');

    btn.addEventListener('click', () => {
      if (btn.classList.contains('open')) {
        btn.classList.remove('open');
        btn.setAttribute('aria-expanded', 'false');
      } else {
        [...secaSelectDropdownContainerEl.querySelectorAll('.trade-in-popup__seca-select--dropdown .trade-in-popup__seca-select--dropdown-select-field')].forEach((el) => {
          el.classList.remove('open');
        });

        btn.classList.add('open');
        btn.setAttribute('aria-expanded', 'true');
        scrollbar.resize(targetDropdown.querySelector('.scrollbar'));
      }
    });

    const items = targetDropdown.querySelectorAll('.trade-in-popup__seca-select--dropdown-select-item-name');
    [...items].forEach((el) => {
      el.addEventListener('click', () => {
        targetDropdown.classList.add('selected');
        btn.classList.remove('open');
        btn.setAttribute('aria-expanded', 'false');
        btn.innerText = el.innerText;
        btn.focus();
      });
    });
  }

  function setSearchDropdown(el) {
    scrollbar.init(el.querySelector('.scrollbar'));

    const searchFieldInput = el.querySelector('.trade-in-popup__search-dropdown-input');

    el.classList.add('open');

    searchFieldInput.addEventListener('focus', () => {
      el.classList.add('open');
      el.querySelector('.trade-in-popup__search-dropdown-search-field').classList.remove('active');
      [...el.querySelectorAll('.trade-in-popup__search-dropdown-item')].forEach((item) => {
        item.classList.remove('hide');
      });
      searchFieldInput.value = '';

      el.parentElement.nextElementSibling.classList.remove('show');
    });

    searchFieldInput.focus();

    searchFieldInput.addEventListener('input', () => {
      const inputKeyword = searchFieldInput.value.replace(/^\s+$/, '').toLowerCase();
      if (inputKeyword !== '') {
        el.querySelector('.trade-in-popup__search-dropdown-search-field').classList.add('active');
      } else {
        el.querySelector('.trade-in-popup__search-dropdown-search-field').classList.remove('active');
      }

      [...el.querySelectorAll('.trade-in-popup__search-dropdown-item')].forEach((item) => {
        if (item.querySelector('.trade-in-popup__search-dropdown-item-btn').textContent.toLowerCase().includes(inputKeyword)) {
          item.classList.remove('hide');
        } else {
          item.classList.add('hide');
        }
      });

      scrollbar.resize(el.querySelector('.scrollbar'));
    });

    [...el.querySelectorAll('.trade-in-popup__search-dropdown-item-btn')].forEach((btn) => {
      btn.addEventListener('click', () => {
        searchFieldInput.value = btn.innerText;
        el.classList.remove('open');
        console.log('el.parentElement: ', el.parentElement);
        el.parentElement.nextElementSibling.classList.add('show');
      });
    });
  }

  /**
   * sehk-condition-step  step 
   * @param {number} step  
   * @example window.sg.components.hubbleTrandeinPopup.goToStep(2);
   */
  function goToStep(step) {
    const $items = $q('.trade-in-popup__sehk-condition-wrap .trade-in-popup__issue-list-item').target;
    $items.forEach((el, idx) => {
      if(idx === step){
        el.classList.remove('is-closed');
        el.classList.add('is-opened');
      }else if(idx < step){
        el.classList.add('is-closed');
        el.classList.remove('is-opened');
      }else{
        el.classList  function showPromoCode() {
    tradeInPopupEls.promoCodeEl.classList.add('show');
  }

  function hidePromoCode() {
    tradeInPopupEls.promoCodeEl.classList.remove('show');
  }

  function setMaxHeight(item) {
    const heightArr = [];

    item.forEach((el) => {
      const $el = $q(el);

      $el.css({
        'height': '',
      });
      heightArr.push($el.outerHeight());
    });

    const maxHeight = Math.max.apply(null, heightArr);

    item.forEach((el) => {
      const $el = $q(el);

      $el.css({
        'height': `${maxHeight}px`,
      });
    });
  }

  function categoryLayout() {
    const itemSize = tradeInPopupEls.$categoryWrap.find('.swiper-slide').target.length;
    if ( (utils.getCurrentDevice() === 'desktop' && itemSize <= 3) || (utils.getCurrentDevice() === 'mobile' && itemSize <= 3) ) {
      tradeInPopupEls.$categoryWrap.closest('.trade-in-popup__tradeIn-category').addClass('s-layout-initial');
    } else {
      tradeInPopupEls.$categoryWrap.closest('.trade-in-popup__tradeIn-category').removeClass('s-layout-initial');
    }

    const radioWrap = tradeInPopupEls.$categoryWrap.find('.trade-in-radio__label');
    setMaxHeight( radioWrap.target );

    tradeInPopupEls.$categoryWrap.find('.swiper-button-prev').css({ display: '' });
    tradeInPopupEls.$categoryWrap.find('.s-bg-left').css({ display: '' });
    tradeInPopupEls.$categoryWrap.find('.swiper-button-next').css({ display: '' });
    tradeInPopupEls.$categoryWrap.find('.s-bg-right').css({ display: '' });
  }

  window.sg.components.tradeInPopup = {
    init,
    reInit,
    showStep,
    resizePopup,
    showPopup,
    closePopup,
    bindTooltipEvent,
    bindTradeInSelectEvent,
    bindDropdownEvent,
    bindModelDropdownItemEvent,
    bindNewDropdownEvent,
    showWarningMessage,
    showDeviceList,
    bindSecaSelectDropdownEvent,
    goToStep,
    showPromoCode,
    hidePromoCode,
    setSearchDropdown,
  };

  $q.ready(() => init());
})();

(() => {
  const $q = window.sg.common.$q;
  const getCurrentDevice = window.sg.common.utils.getCurrentDevice;
  const getCurrentMediaType = window.sg.common.utils.getCurrentMediaType;
  const scrollbar = window.sg.common.scrollbar;
  const triggerEvent = window.sg.common.utils.triggerEvent;
  const extend = window.sg.common.utils.extend;
  const addEventListener = window.sg.common.utils.addEventListener;
  const removeAllEventListeners = window.sg.common.utils.removeAllEventListeners;
  const utils = window.sg.common.utils;
  const bezierEasing = window.BezierEasing;
  const isRtl = window.sg.common.utils.isRtl;
  const closest = window.sg.common.utils.closest;
  const detectTransitionEndEvent = window.sg.common.utils.detectTransitionEndEvent;
  const getNormalizedScrollLeft = window.sg.common.utils.getNormalizedScrollLeft;
  const setNormalizedScrollLeft = window.sg.common.utils.setNormalizedScrollLeft;
  const detectScrollType = window.sg.common.utils.detectScrollType;

  class TariffPopup {
    constructor(el) {
      this.els = {
        el,
        contentsEl: null,
        contentsPlanEl: null,
        contentsPlanDetailsEl: null,
        contentsPlanSelectedEl: null,
        contentsFormEl: null,
        popupCloseBtnEl: null,
      };

      this.step = 0;
      this.chooseTabs = [];
      this.chooseTabIndex = 0;
      this.tabXMove = 0;
      this.prevBtnWidth = 0;
      this.isInTransition = false;
      this.device = '';
      this.isSeeMoreInfoOpend = false;
      this.planDetailsDescHeights = [];

      this.init();
    }

    open(targetEl) {
      this.focusTargetEl = targetEl;

      this.els.el.style.display = 'block';

      this.updateElements();
      this.resize();

      this.setFocusFirstFocusableEl();

      utils.popupControl.open(closePopup);
      utils.hiddenScroll();
      utils.setMobileFocusLoop(this.els.el);
    }

    close() {
      if (this.els.contentsPlanEl) {
        this.els.contentsPlanEl.style.display = 'block';
      }

      if (this.els.contentsPlanSelectedEl) {
        this.els.contentsPlanSelectedEl.style.display = 'none';
      }
      
      if (this.els.contentsFormEl) {
        this.els.contentsFormEl.style.display = 'none';
      }

      this.step = 0;

      if (this.els.checkboxEls) {
        [...this.els.checkboxEls].forEach((el) => {
          el.querySelector('input').checked = false;
          el.classList.remove('tariff-popup__checkbox--checked');
        });
      }

      if (this.els.filterCheckboxEls) {
        [...this.els.filterCheckboxEls].forEach((el) => {
          if(!el.classList.contains('is-active')) {
            el.classList.add('is-active');
          }
          el.querySelectorAll('input').forEach((chk) => {
            chk.checked = false;
          });
          el.querySelectorAll('input')[0].checked = true;
        });
      }

      if (this.els.disclaimerCtaEl) {
        this.els.disclaimerCtaEl.classList.remove('tariff-popup__table-disclaimer-cta--open');
      }

      if (this.els.submitBtnEl) {
        this.els.submitBtnEl.disabled = true;
        this.els.submitBtnEl.classList.remove('tariff-popup__btn-submit--active');
      }

      if (this.els.radioEls) {
        [...this.els.radioEls].forEach((el) => {
          el.querySelector('input').checked = false;
          el.classList.remove('tariff-popup__radio--checked');
        });
      }

      if (this.els.planDetailItemEls) {
        [...this.els.planDetailItemEls].forEach((el) => {
          if (el.style.display === 'block') {
            el.style.display = 'none';
          }
        });
      }

      if (this.els.planDetailViewMoreBtnEls) {
        [...this.els.planDetailViewMoreBtnEls].forEach((el) => {
          el.style.display = 'inline-block';
        });
      }

      if (this.els.nextBtnEl) {
        this.els.nextBtnEl.disabled = true;
        this.els.nextBtnEl.classList.add('cta--disabled');
      }

      if (this.isBc) {
        window.sg.components.hubblePdPopup.closePopup();
      }

      this.els.el.style.display = 'none';

      utils.popupControl.close();
      utils.visibleScroll();
      utils.removeMobileFocusLoop();

      this.setOriginFocus();
    }

    getCurrentContentsEl() {
      if (this.step === 0) {
        if (!this.isSeeMoreInfoOpend) {
          return this.els.contentsPlanEl;
        } else {
          return this.els.contentsPlanDetailsEl;
        }
      } else if (this.step === 1) {
        return this.els.contentsPlanSelectedEl;
      } else if (this.step === 2) {
        return this.els.contentsFormEl;
      }

      return null;
    }

    getFirstFocusableEl() {
      const currentContentsEl = this.getCurrentContentsEl();

      if (currentContentsEl) {
        return currentContentsEl.querySelectorAll('a, button, input:not([type="hidden"]), textarea')[0];
      }
    }

    setFocusFirstFocusableEl() {
      const firstFocusEl = this.getFirstFocusableEl();

      if (firstFocusEl) {
        firstFocusEl.focus();
      }
    }

    init() {
      if (!this.els.el || TariffPopup.instances.has(this.els.el)) {
        return;
      }

      TariffPopup.instances.set(this.els.el, this);

      this.device = getCurrentMediaType();
      this.isRtl = isRtl();
      this.isBc = this.els.el.classList.contains('bc-tariff-popup');

      this.getElements(this.step);
      this.bindEvents();
      this.show(this.step);
      this.selectChoose(this.chooseTabIndex);
      this.updateElements();
    }

    reInit(step, isSeeMoreInfo) {
      if (this.step !== 0 && step === 0 && isSeeMoreInfo) {
        this.reInit(0);
      }

      this.getElements(step, isSeeMoreInfo);
      this.show(step, isSeeMoreInfo);
      this.unBindEvents();
      this.bindEvents();

      if (step === 0 && !isSeeMoreInfo) {
        this.selectChoose(this.chooseTabIndex);
        this.updateElements();
      }

      window.sg.common.lazyLoad.setLazyLoad();
    }

    getElements(step, isSeeMoreInfo) {
      this.els.contentsEl = this.els.el.querySelector('.tariff-popup__contents');
      this.els.contentsPlanEl = this.els.el.querySelector('.tariff-popup__contents-plan');
      this.els.contentsPlanDetailsEl = this.els.el.querySelector('.tariff-popup__contents-plan-details');
      this.els.contentsPlanSelectedEl = this.els.el.querySelector('.tariff-popup__contents-plan-selected');
      this.els.contentsFormEl = this.els.el.querySelector('.tariff-popup__contents-form');
      this.els.popupCloseBtnEl = this.els.el.querySelector('.tariff-popup__close');

      const isWearableBc = !!document.querySelector('.wearable-bc');

      // popup
      if (this.isBc || isWearableBc) {
        scrollbar.reInit(this.els.contentsPlanEl.querySelector('.scrollbar'));
        scrollbar.reInit(this.els.contentsPlanDetailsEl.querySelector('.scrollbar'));
        scrollbar.reInit(this.els.contentsPlanSelectedEl.querySelector('.scrollbar'));
        scrollbar.reInit(this.els.contentsFormEl.querySelector('.scrollbar'));
      }

      let els = {};

      if (step === 0) {
        if (!isSeeMoreInfo) {
          els = {
            planInnerWrapEl: this.els.el.querySelector('.tariff-popup__contents-plan .tariff-popup__inner-wrap'),
            planInnerWrapScrollEl: this.els.el.querySelector('.tariff-popup__contents-plan .tariff-popup__inner-wrap > .scrollbar__wrap'),
            planBtnWrapEl: this.els.el.querySelector('.tariff-popup__contents-plan .tariff-popup__btn-wrap'),
            nextBtnEl: this.els.el.querySelector('.tariff-popup__btn-next'),
            prevBtnEl: this.els.el.querySelector('.tariff-popup__btn-prev'),
            closeBtnEls: this.els.el.querySelectorAll('.tariff-popup__btn-close'),
            choosePanelEls: this.els.el.querySelectorAll('.tariff-popup__choose-panel'),
            tabWrapEls: this.els.el.querySelectorAll('.tariff-popup__tab-wrap'),
            radioEls: this.els.el.querySelectorAll('.tariff-popup__radio'),
            planDetailItemEls: this.els.el.querySelectorAll('.tariff-popup__plan-detail-item'),
            planDetailViewMoreBtnEls: this.els.el.querySelectorAll('.tariff-popup__plan-detail-view-more'),
            chooseTabEls: [],
            filterCheckboxEls: this.els.el.querySelectorAll('.tariff-popup__filter'),
            filterCheckboxBtn: this.els.el.querySelectorAll('.tariff-popup__filter-btn'),
            filterCheckbox: this.els.el.querySelectorAll('.tariff-popup__filter .checkbox-v2'),
          };

          [...this.els.el.querySelectorAll('.tariff-popup__choose-item')].forEach((el, index) => {
            els.chooseTabEls.push({
              chooseItemBtnEl: el.querySelector('.tariff-popup__choose-item-btn'),
              chooseTooltipEl: el.querySelector('.tariff-popup__choose-tooltip'),
              chooseTooltipBtnEl: el.querySelector('.tariff-popup__choose-tooltip__btn'),
              choosePanelEl: els.choosePanelEls[index],
              tabWrapEl: els.tabWrapEls[index],
              tabListEl: els.tabWrapEls[index].querySelector('.tariff-popup__tab-list'),
              tabListWrapEl: els.tabWrapEls[index].querySelector('.tariff-popup__tab-list-wrap'),
              tabListAreaEl: els.tabWrapEls[index].querySelector('.tariff-popup__tab-list-area'),
              tabListPrevBtnEl: els.tabWrapEls[index].querySelector('.tariff-popup__tab-list-prev'),
              tabListNextBtnEl: els.tabWrapEls[index].querySelector('.tariff-popup__tab-list-next'),
              tabListGlLeftEl: els.tabWrapEls[index].querySelector('.tariff-popup__tab-list-gl-left'),
              tabListGlRightEl: els.tabWrapEls[index].querySelector('.tariff-popup__tab-list-gl-right'),
              tabItemEls: els.tabWrapEls[index].querySelectorAll('.tariff-popup__tab-item'),
              tabPanelWrapEl: els.tabWrapEls[index].querySelector('.tariff-popup__tab-panel-wrap'),
              tabPanelItemEls: els.tabWrapEls[index].querySelectorAll('.tariff-popup__tab-panel-item'),
            });
          });

          this.chooseTabs = [];

          for (let i = 0; i < els.chooseTabEls.length; i++) {
            this.chooseTabs.push({
              tabIndex: 0,
              tabXPosition: 0,
              tabListIndex: 0,
              tabListMaxIndex: 0,
            });
          }
        } else {
          els = {
            planDetailsInnerWrapEl: this.els.el.querySelector('.tariff-popup__contents-plan-details .tariff-popup__inner-wrap'),
            planDetailsInnerWrapScrollEl: this.els.el.querySelector('.tariff-popup__contents-plan-details .tariff-popup__inner-wrap > .scrollbar__wrap'),
            planDetailsBtnWrapEl: this.els.el.querySelector('.tariff-popup__contents-plan-details .tariff-popup__btn-wrap'),
            planDetailsTitleEls: this.els.el.querySelectorAll('.tariff-popup__plan-details-title'),
            planSeeMoreInfoBtnEls: this.els.el.querySelectorAll('.tariff-popup__plan-see-more-info'),
            planDetailsBackBtnEl: this.els.el.querySelector('.tariff-popup__btn-back'),
          };
        }

        this.isSeeMoreInfoOpend = false;
      } else if (step === 1) {
        els = {
          planSelectedInnerWrapEl: this.els.el.querySelector('.tariff-popup__contents-plan-selected .tariff-popup__inner-wrap'),
          planSelectedInnerWrapScrollEl: this.els.el.querySelector('.tariff-popup__contents-plan-selected .tariff-popup__inner-wrap > .scrollbar__wrap'),
          planSelectedBtnWrapEl: this.els.el.querySelector('.tariff-popup__contents-plan-selected .tariff-popup__btn-wrap'),
          prevBtnEl: this.els.el.querySelector('.tariff-popup__btn-prev'),
          submitBtnEl: this.els.el.querySelector('.tariff-popup__btn-submit'),
          checkboxEls: this.els.el.querySelectorAll('.tariff-popup__checkbox'),
          disclaimerEl: this.els.el.querySelector('.tariff-popup__table-disclaimer'),
          disclaimerCtaEl: this.els.el.querySelector('.tariff-popup__table-disclaimer-cta'),
        };
      } else if(step === 2) {
        els = {
          formInnerWrapEl: this.els.el.querySelector('.tariff-popup__contents-form .tariff-popup__inner-wrap'),
          formInnerWrapScrollEl: this.els.el.querySelector('.tariff-popup__contents-form .tariff-popup__inner-wrap > .scrollbar__wrap'),
          formBtnWrapEl: this.els.el.querySelector('.tariff-popup__contents-form .tariff-popup__btn-wrap'),
          nextBtnEl: this.els.el.querySelector('.tariff-popup__btn-next'),
          closeBtnEls: this.els.el.querySelectorAll('.tariff-popup__btn-close'),
          disclaimerEl: this.els.el.querySelector('.tariff-popup__disclaimer'),
        };
      }

      extend(this.els, els);
      this.step = step;
    }

    normalizeScrollLeft(el, scrollLeft) {
      if (this.isRtl) {
        switch (detectScrollType()) {
        case 'negative':
          return -(el.clientWidth - el.scrollWidth + scrollLeft);
        case  return scrollLeft;
        }
      }

      return scrollLeft;
    }

    getVw() {
      return Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    }

    updateElements() {
      const vw = this.getVw();

      if (this.els.chooseTabEls[this.chooseTabIndex].tabItemEls[0]) {
        if (getCurrentMediaType() === 'desktop-over') {
          this.tabXMove = this.els.chooseTabEls[this.chooseTabIndex].tabItemEls[0].parentElement.offsetWidth * 4;
          this.prevBtnWidth = 30;
        } else {
          this.tabXMove = (this.els.chooseTabEls[this.chooseTabIndex].tabItemEls[0].parentElement.offsetWidth * 4) / (vw / 100);
          this.prevBtnWidth =  (30 * vw / 1440) / (vw / 100);
        }
      }

      this.els.chooseTabEls.forEach((els, index) => {
        if (this.step === 0 && els.tabItemEls.length > 0) {
          if (getCurrentMediaType().indexOf('desktop') > -1) {
            let i = 0;
            while(els.tabItemEls.length - 5 >  4 * i) {
              i++;
            }

            this.chooseTabs[index].tabListIndex = 0;
            this.chooseTabs[index].tabListMaxIndex = i;
            this.chooseTabs[index].tabXPosition = 0;

            for (let j = 1; j <= i + 1; j++) {
              if (this.chooseTabs[index].tabIndex <= 4 * j) {
                this.chooseTabs[index].tabListIndex = j - 1;
                if (this.chooseTabs[index].tabIndex === 4 * j && this.chooseTabs[index].tabListIndex < this.chooseTabs[index].tabListMaxIndex) {
                  this.chooseTabs[index].tabListIndex++;
                }
                break;
              }
            }

            [...els.tabItemEls].forEach((el, i) => {
              el.setAttribute('aria-hidden', 'true');
              el.setAttribute('tabIndex', -1);

              if (i >= this.chooseTabs[index].tabListIndex * 4 && i <= this.chooseTabs[index].tabListIndex * 4 + 3) {
                els.tabItemEls[i].setAttribute('aria-hidden', 'false');
                els.tabItemEls[i].removeAttribute('tabindex');
              }

              el.parentElement.classList.remove('hide-divider');
            });

            els.tabItemEls[4 * this.chooseTabs[index].tabListIndex].parentElement.classList.add('hide-divider');

            if (els.tabItemEls[4 * this.chooseTabs[index].tabListIndex + 5]) {
              els.tabItemEls[4 * this.chooseTabs[index].tabListIndex + 5].parentElement.classList.add('hide-divider');
            }

            if (this.chooseTabs[index].tabListIndex > 0) {
              els.tabListPrevBtnEl.style.display = '';
            } else {
              els.tabListPrevBtnEl.style.display = 'none';
            }

            if (this.chooseTabs[index].tabListMaxIndex > 0 && this.chooseTabs[index].tabListIndex < this.chooseTabs[index].tabListMaxIndex) {
              els.tabListNextBtnEl.style.display = '';
            } else {
              els.tabListNextBtnEl.style.display = 'none';
            }

            this.chooseTabs[index].tabXPosition = -(this.tabXMove * this.chooseTabs[index].tabListIndex);
            if (this.chooseTabs[index].tabListIndex > 0) {
              this.chooseTabs[index].tabXPosition += this.prevBtnWidth;
            }

            setNormalizedScrollLeft(els.tabListAreaEl, this.normalizeScrollLeft(els.tabListAreaEl, 0));

            if (this.isRtl) {
              this.chooseTabs[index].tabXPosition = -this.chooseTabs[index].tabXPosition;
            }

            if (getCurrentMediaType() === 'desktop-over') {
              els.tabListEl.style.transform = `translate3d(${this.chooseTabs[index].tabXPosition}px, 0, 0)`;
            } else {
              els.tabListEl.style.transform = `translate3d(${this.chooseTabs[index].tabXPosition}vw, 0, 0)`;
            }
          } else if (getCurrentDevice() === 'mobile'){
            els.tabListEl.style.removeProperty('transform');

            [...els.tabItemEls].forEach((el) => {
              el.setAttribute('aria-hidden', 'false');
              el.removeAttribute('tabindex');
            });

            const scrollLeft = els.tabItemEls[0].parentElement.getBoundingClientRect().width * this.chooseTabs[index].tabIndex;
            setNormalizedScrollLeft(els.tabListAreaEl, this.normalizeScrollLeft(els.tabListAreaEl, scrollLeft));

            this.updateMobileTabList(els);
          }
        }
      });
    }

    updateMobileTabList(els) {
      if (getCurrentDevice() === 'mobile') {
        if (!els) {
          els = this.els.chooseTabEls[this.chooseTabIndex];
        }

        const spacing = 4 * this.getVw() / 360;

        if (getNormalizedScrollLeft(els.tabListAreaEl) >= spacing) {
          els.tabListGlLeftEl.classList.add('tariff-popup__tab-list-gl--active');
          !this.isRtl ? els.tabListPrevBtnEl.style.display = '' : els.tabListNextBtnEl.style.display = '';
        } else {
          els.tabListGlLeftEl.classList.remove('tariff-popup__tab-list-gl--active');
          !this.isRtl ? els.tabListPrevBtnEl.style.display = 'none' : els.tabListNextBtnEl.style.display = 'none';
        }

        if (els.tabListAreaEl.scrollWidth - els.tabListAreaEl.offsetWidth <= getNormalizedScrollLeft(els.tabListAreaEl) + spacing) {
          els.tabListGlRightEl.classList.remove('tariff-popup__tab-list-gl--active');
          !this.isRtl ? els.tabListNextBtnEl.style.display = 'none' : els.tabListPrevBtnEl.style.display = 'none';
        } else {
          els.tabListGlRightEl.classList.add('tariff-popup__tab-list-gl--active');
          !this.isRtl ? els.tabListNextBtnEl.style.display = '' : els.tabListPrevBtnEl.style.display = '';
        }
      }
    }

    resize() {
      if (this.device !== getCurrentMediaType()) {
        this.updateElements();
        this.device = getCurrentMediaType();
      }

      this.updateMobileTabList();
      this.setMaxHeight();
    }

    setMaxHeight() {
      const contentsEl = this.els.contentsEl;
      let innerWrapEl;
      let innerWrapScrollEl;
      let btnWrapEl;

      if (this.step === 0) {
        innerWrapEl = this.els.planInnerWrapEl;
        innerWrapScrollEl = this.els.planInnerWrapScrollEl;
        btnWrapEl = this.els.planBtnWrapEl;

        if (this.isSeeMoreInfoOpend) {
          innerWrapScrollEl.style.maxHeight = `${window.innerHeight - ((innerWrapEl.getBoundingClientRect().top - contentsEl.getBoundingClientRect().top) * 2) - btnWrapEl.getBoundingClientRect().height}px`;
          innerWrapEl = this.els.planDetailsInnerWrapEl;
          innerWrapScrollEl = this.els.planDetailsInnerWrapScrollEl;
          btnWrapEl = this.els.planDetailsBtnWrapEl;
          innerWrapScrollEl.style.height = `${this.els.planInnerWrapScrollEl.getBoundingClientRect().height}px`;
        }
      } else if (this.step === 1){
        innerWrapEl = this.els.planSelectedInnerWrapEl;
        innerWrapScrollEl = this.els.planSelectedInnerWrapScrollEl;
        btnWrapEl = this.els.planSelectedBtnWrapEl;
      } else if (this.step === 2) {
        innerWrapEl = this.els.formInnerWrapEl;
        innerWrapScrollEl = this.els.formInnerWrapScrollEl;
        btnWrapEl = this.els.formBtnWrapEl;
      }

      innerWrapScrollEl.style.maxHeight = `${window.innerHeight - ((innerWrapEl.getBoundingClientRect().top - contentsEl.getBoundingClientRect().top) * 2) - btnWrapEl.getBoundingClientRect().height}px`;
      scrollbar.resize(innerWrapEl);
    }

    selectChoose(index) {
      if (index < 0 || !this.els.chooseTabEls[index].chooseItemBtnEl || !this.els.chooseTabEls[index].choosePanelEl) {
        return;
      }

      [...this.els.chooseTabEls].forEach((el) => {
        el.chooseItemBtnEl && el.chooseItemBtnEl.parentElement && el.chooseItemBtnEl.parentElement.classList.remove('active');
        el.choosePanelEl && el.choosePanelEl.classList.remove('active');
        el.chooseItemBtnEl && el.chooseItemBtnEl.setAttribute('aria-selected', 'false');
        el.choosePanelEl && el.choosePanelEl.setAttribute('aria-hidden', 'true');
      });

      this.els.chooseTabEls[index].chooseItemBtnEl.parentElement.classList.add('active');
      this.els.chooseTabEls[index].chooseItemBtnEl.setAttribute('aria-selected', 'trues');

      this.els.chooseTabEls[index].choosePanelEl.classList.add('active');
      this.els.chooseTabEls[index].choosePanelEl.setAttribute('aria-hidden', 'false');
      this.chooseTabIndex = index;

      this.selectTab(this.chooseTabs[index].tabIndex);
    }

    selectTab(index) {
      if (index < 0 || !this.els.chooseTabEls[this.chooseTabIndex].tabItemEls[index] || !this.els.chooseTabEls[this.chooseTabIndex].tabPanelItemEls[index]) {
        return;
      }

      this.els.chooseTabEls.forEach((els) => {
        [...els.tabItemEls].forEach((el) => {
          el.parentElement.classList.remove('tariff-popup__tab-item-wrap--active');
          el.setAttribute('aria-selected', 'false');
        });
      });

      const els = this.els.chooseTabEls[this.chooseTabIndex];

      [...this.els.radioEls].forEach((el) => {
        el.querySelector('input').checked = false;
        el.classList.remove('tariff-popup__radio--checked');
      });

      this.els.nextBtnEl.disabled = true;
      this.els.nextBtnEl.classList.add('cta--disabled');

      if (getCurrentDevice() === 'mobile') {
        const elRect = els.tabListAreaEl.getBoundingClientRect();
        const tabItemRect = els.tabItemEls[index].getBoundingClientRect();
        const vw = this.getVw();

        const spacing = (56 * vw / 360);
        if (tabItemRect.right + spacing > elRect.right) {
          this.scrollTo(els.tabListAreaEl, tabItemRect.right - elRect.right + spacing);
        } else if (tabItemRect.left - spacing < elRect.left) {
          this.scrollTo(els.tabListAreaEl, -((elRect.left - tabItemRect.left) + spacing));
        }
      }

      els.tabItemEls[index].parentElement.classList.add('tariff-popup__tab-item-wrap--active');
      els.tabItemEls[index].setAttribute('aria-selected', 'true');

      [...els.tabPanelItemEls].forEach((el) => {
        el.classList.remove('tariff-popup__tab-panel-item--active');
        el.setAttribute('aria-hidden', 'true');
      });

      if (this.chooseTabs[this.chooseTabIndex].tabIndex !== index) {
        [...this.els.planDetailItemEls].for        el.style.display = 'none';
          }
        });

        [...this.els.planDetailViewMoreBtnEls].forEach((el) => {
          el.style.display = 'inline-block';
        });
      }

      els.tabPanelItemEls[index].classList.add('tariff-popup__tab-panel-item--active');
      els.tabPanelItemEls[index].setAttribute('aria-hidden', 'false');
      this.chooseTabs[this.chooseTabIndex].tabIndex = index;
      this.setMaxHeight();
    }

    scrollTo(el, scrollLeft, duration = 300, easing = bezierEasing(0.4, 0.0, 0.2, 1.0))  {
      const curScrollLeft = getNormalizedScrollLeft(el);
      const contentsMaxScrollLeft = el.scrollWidth - el.getBoundingClientRect().width;

      if (curScrollLeft + scrollLeft > contentsMaxScrollLeft) {
        scrollLeft = contentsMaxScrollLeft - curScrollLeft;
      }

      if (curScrollLeft + scrollLeft < 0) {
        scrollLeft = -curScrollLeft;
      }

      const render = (p) => {
        setNormalizedScrollLeft(el, curScrollLeft + (scrollLeft * p));
      };

      if (duration > 0) {
        if (!this.isAnim) {
          this.animate(render, duration, easing);
        }
      } else {
        render(1);
      }
    }

    animate(render, duration, easing) {
      const start = Date.now();
      this.isAnim = true;
      this.isContentsDragging = false;

      const animation = () => {
        const p = (Date.now() - start) / duration;

        if (p > 1) {
          render(1);
          this.isAnim = false;
        } else {
          requestAnimationFrame(animation);
          render(easing(p));
        }
      };

      requestAnimationFrame(animation);
    }

    unBindEvents() {
      if (this.step === 0) {
        if (!this.isSeeMoreInfoOpend) {
          [...this.els.chooseTabEls].forEach((els) => {
            removeAllEventListeners(els.chooseItemBtnEl, 'click');
            removeAllEventListeners(els.tabListPrevBtnEl, 'click');
            removeAllEventListeners(els.tabListNextBtnEl,'click');

            [...els.tabItemEls].forEach((el) => {
              removeAllEventListeners(el, 'click');
            });

            removeAllEventListeners(els.tabListAreaEl,'scroll');

            if (els.chooseTooltipBtnEl) {
              removeAllEventListeners(els.chooseTooltipBtnEl, 'click');
            }
          });

          [...this.els.radioEls].forEach((el) => {
            removeAllEventListeners(el,'click');
          });

          [...this.els.planDetailViewMoreBtnEls].forEach((el) => {
            removeAllEventListeners(el,'click');
          });

          [...this.els.filterCheckboxBtn].forEach((el) => {
            removeAllEventListeners(el,'click');
          });

          [...this.els.closeBtnEls].forEach((el) => {
            removeAllEventListeners(el,'click');
          });
        } else {
          [...this.els.planDetailsTitleEls].forEach((el) => {
            removeAllEventListeners(el, 'click');
          });

          removeAllEventListeners(this.els.planDetailsBackBtnEl, 'click');
        }
      } else if (this.step === 1) {
        [...this.els.checkboxEls].forEach((el) => {
          removeAllEves(this.els.disclaimerCtaEl,'click');
      } else if (this.step === 2) {
        [...this.els.closeBtnEls].forEach((el) => {
          removeAllEventListeners(el,'click');
        });
      }

      removeAllEventListeners(this.els.popupCloseBtnEl, 'click');
      removeAllEventListeners(this.els.popupCloseBtnEl, 'keydown');
      removeAllEventListeners(this.els.el, 'keydown');
      window.removeEventListener('resize', this.resize);
    }

    bindEvents() {
      this.close = this.close.bind(this);
      this.handleCloseButtonKeyDown = this.handleCloseButtonKeyDown.bind(this);
      this.handleContentsKeyDown = this.handleContentsKeyDown.bind(this);
      this.resize = this.resize.bind(this);

      if (this.step === 0) {
        if (!this.isSeeMoreInfoOpend) {
          [...this.els.chooseTabEls].forEach((els, index) => {
            addEventListener(els.chooseItemBtnEl, 'click', () => {
              this.selectChoose(index);
              this.updateMobileTabList(els);
            });

            addEventListener(els.tabListPrevBtnEl, 'click', () => {
              if (getCurrentDevice() === 'desktop') {
                if (!this.isAnim && this.chooseTabs[index].tabListIndex > 0) {
                  this.chooseTabs[index].tabListIndex--;

                  if (!this.isRtl) {
                    this.chooseTabs[index].tabXPosition += + this.tabXMove;

                    if (this.chooseTabs[index].tabListIndex === 0) {
                      this.chooseTabs[index].tabXPosition -= this.prevBtnWidth;
                    }
                  } else {
                    this.chooseTabs[index].tabXPosition -= + this.tabXMove;

                    if (this.chooseTabs[index].tabListIndex === 0) {
                      this.chooseTabs[index].tabXPosition += this.prevBtnWidth;
                    }
                  }

                  els.tabListEl.style.transitionDuration = '.3s';
                  if (getCurrentMediaType() === 'desktop-over') {
                    els.tabListEl.style.transform = `translate3d(${this.chooseTabs[index].tabXPosition}px, 0, 0)`;
                  } else {
                    els.tabListEl.style.transform = `translate3d(${this.chooseTabs[index].tabXPosition}vw, 0, 0)`;
                  }

                  this.isAnim = true;

                  if (this.chooseTabs[index].tabListIndex === 0) {
                    els.tabListPrevBtnEl.style.display = 'none';
                  }

                  if (this.chooseTabs[index].tabListIndex < this.chooseTabs[index].tabListMaxIndex) {
                    els.tabListNextBtnEl.style.display = '';
                  }

                  [...els.tabItemEls].forEach((el, i) => {
                    el.setAttribute('aria-hidden', 'true');
                    el.setAttribute('tabindex', -1);

                    if (i >= this.chooseTabs[index].tabListIndex * 4 && i <= this.chooseTabs[index].tabListIndex * 4 + 3) {
                      el.setAttribute('aria-hidden', 'false');
                      el.removeAttribute('tabindex');
                    }

                    el.parentElement.classList.remove('hide-divider');
                  });

                  els.tabItemEls[4 * this.chooseTabs[index].tabListIndex].parentElement.classList.add('hide-divider');

                  if (els.tabItemEls[4 * this.chooseTabs[index].tabListIndex + 5]) {
                    els.tabItemEls[4 * this.chooseTabs[index].tabListIndex + 5].parentElement.classList.add('hide-divider');
                  }

                  setTimeout(() => {
                    this.chooseTabs[index].tabIndex = this.chooseTabs[index].tabListIndex * 4;
                    this.selectTab(this.chooseTabs[index].tabIndex);
                    els.tabListEl.style.transitionDuration = '0s';
                    this.isAnim = false;

                    els.tabItemEls[this.chooseTabs[index].tabIndex].focus();
                  }, 300);
                }
              } else {
                const els = this.els.chooseTabEls[this.chooseTabIndex];
                const tabListAreaRect = els.tabListAreaEl.getBoundingClientRect();
                const tabItemEls = els.tabItemEls;

                for (let i = tabItemEls.length - 1; i >= 0; i--) {
                  const el = tabItemEls[i];
                  const elRect = el.getBoundingClientRect();
                  const spacing = 4 * this.getVw() / 360;

                  if (!this.isRtl) {
                    if (elRect.left - spacing <= tabListAreaRect.left - spacing) {
                      this.scrollTo(els.tabListAreaEl, -(tabListAreaRect.left - elRect.left + spacing));
                      break;
                    }
                  } else {
                    if (elRect.right + spacing >= tabListAreaRect.right + spacing) {
                      this.scrollTo(els.tabListAreaEl, elRect.right - tabListAreaRect.right + spacing);
                      break;
                    }
                  }
                }
              }
            });

            addEventListener(els.tabListNextBtnEl,'click', () => {
              if (getCurrentDevice() === 'desktop') {
                if (!this.isAnim && this.chooseTabs[index].tabListIndex < this.chooseTabs[index].tabListMaxIndex) {
                  this.chooseTabs[index].tabListIndex++;

                  if (!this.isRtl) {
                    this.chooseTabs[index].tabXPosition -= this.tabXMove;

                    if (this.chooseTabs[index].tabListIndex - 1 === 0) {
                      this.chooseTabs[index].tabXPosition += this.prevBtnWidth;
                    }
                  } else {
                    this.chooseTabs[index].tabXPosition += this.tabXMove;

                    if (this.chooseTabs[index].tabListIndex - 1 === 0) {
                      this.chooseTabs[index].tabXPosition -= this.prevBtnWidth;
                    }
                  }

                  els.tabListEl.style.transitionDuration = '.3s';
                  if (getCurrentMediaType() === 'desktop-over') {
                    els.tabListEl.style.transform = `translate3d(${this.chooseTabs[index].tabXPosition}px, 0, 0)`;
                  } else {
                    els.tabListEl.style.transform = `translate3d(${this.chooseTabs[index].tabXPosition}vw, 0, 0)`;
                  }

                  this.isAnim = true;

                  if (els.tabListPrevBtnEl.style.display === 'none') {
                    els.tabListPrevBtnEl.style.display = '';
                  }

                  if (this.chooseTabs[index].tabListIndex === this.chooseTabs[index].tabListMaxIndex) {
                    els.tabListNextBtnEl.style.display = 'none';
                  }

                  [...els.tabItemEls].forEach((el, i) => {
                    el.setAttribute('aria-hidden', 'true');
                    el.setAttribute('tabindex', -1);

                    if (i >= this.chooseTabs[index].tabListIndex * 4 && i <= this.chooseTabs[index].tabListIndex * 4 + 3) {
                      el.setAttribute('aria-hidden', 'false');
                      el.removeAttribute('tabindex');
                    }

                    el.parentElement.classList.remove('hide-divider');
                  });

                  els.tabItemEls[4 * this.chooseTabs[index].tabListIndex].parentElement.classList.add('hide-divider');

                  if (els.tabItemEls[4 * this.chooseTabs[index].tabListIndex + 5]) {
                    els.tabItemEls[4 * this.chooseTabs[index].tabListIndex + 5].parentElement.classList.add('hide-divider');
                  }

                  setTimeout(() => {
                    this.chooseTabs[index].tabIndex = this.chooseTabs[index].tabListIndex * 4;
                    this.selectTab(this.chooseTabs[index].tabIndex);
                    els.tabListEl.style.transitionDuration = '0s';
                    this.isAnim = false;

                    els.tabItemEls[this.chooseTabs[index].tabIndex].focus();
                  }, 300);
                }
              } else {
                const els = this.els.chooseTabEls[this.chooseTabIndex];
                const tabListAreaRect = els.tabListAreaEl.getBoundingClientRect();
                const tabItemEls = els.tabItemEls;

                for (let i = 0; i < tabItemEls.length; i++) {
                  const el = tabItemEls[i];
                  const elRect = el.getBoundingClientRect();
                  const spacing = 4 * this.getVw() / 360;

                  if (!this.isRtl) {
                    if (elRect.right + spacing >= tabListAreaRect.right + spacing) {
                      this.scrollTo(els.tabListAreaEl, elRect.right - tabListAreaRect.right + spacing);
                      break;
                    }
                  } else {
                    if (elRect.left - spacing <= tabListAreaRect.left - spacing) {
                      this.scrollTo(els.tabListAreaEl, -(tabListAreaRect.left - elRect.left + spacing));
                      break;
                    }
                  }
                }
              }
            });

            [...els.tabItemEls].forEach((el, i) => {
              addEventListener(el,'click', (e) => {
                e.preventDefault();

                if (this.step === 0 && getCurrentMediaType().indexOf('desktop') > -1 && i !== 0 && i % 4 === 0 && this.chooseTabs[index].tabListIndex < this.chooseTabs[index].tabListMaxIndex) {
                  triggerEvent(els.tabListNextBtnEl, 'cl;
                }
              });
            });

            addEventListener(els.tabListAreaEl,'scroll', () => {
              this.updateMobileTabList(els);
            });
            
            if (els.chooseTooltipBtnEl) {
              addEventListener(els.chooseTooltipBtnEl, 'click', () => {
                if (!els.chooseTooltipEl.classList.contains('tooltip--active')) {
                  els.chooseTooltipEl.classList.add('tooltip--active');
                  els.chooseTooltipBtnEl.setAttribute('aria-expanded', 'true');
                } else {
                  els.chooseTooltipEl.classList.remove('tooltip--active');
                  els.chooseTooltipBtnEl.setAttribute('aria-expanded', 'false');
                }
              });
            }
          });

          [...this.els.radioEls].forEach((el) => {
            addEventListener(el,'click', (e) => {
              if (e.target.tagName && e.target.tagName.toUpperCase() === 'INPUT') {
                [...this.els.radioEls].forEach((el) => {
                  el.classList.remove('tariff-popup__radio--checked');
                });

                el.classList.add('tariff-popup__radio--checked');
                this.els.nextBtnEl.disabled = false;
                this.els.nextBtnEl.classList.remove('cta--disabled');
              }
            });
          });

          [...this.els.planDetailViewMoreBtnEls].forEach((el) => {
            addEventListener(el,'click', () => {
              const planDetailItemEls = el.parentElement.querySelectorAll('.tariff-popup__plan-detail-item');
              if (!el.classList.contains('less')) {
                for (let i = 6; i < planDetailItemEls.length; i++) {
                  planDetailItemEls[i].style.display = 'block';
                }

                el.classList.add('less');
              } else {
                for (let i = 6; i < planDetailItemEls.length; i++) {
                  planDetailItemEls[i].style.display = 'none';
                }

                el.classList.remove('less');
              }

              const radioEl = closest(el, '.tariff-popup__radio');
              scrollbar.resize(this.els.planInnerWrapEl);
              scrollbar.scrollTo(this.els.planInnerWrapEl, 0, this.els.chooseTabEls[this.chooseTabIndex].tabWrapEl.offsetTop + radioEl.offsetTop, true);
            });
          });

          [...this.els.closeBtnEls].forEach((el) => {
            addEventListener(el,'click', this.close);
          });
          
          [...this.els.filterCheckboxBtn].forEach((el) => {
            addEventListener(el,'click', () => {
              const current = el.closest('.tariff-popup__filter');
              if(current.classList.contains('is-active')) {
                current.classList.remove('is-active');
              } else {
                current.classList.add('is-active');
              }
         ;

          [...this.els.filterCheckbox].forEach((el) => {
            addEventListener(el,'click', () => {
              scrollbar.resize(this.els.planInnerWrapEl);
            });
          });

          addEventListener(this.els.disclaimerCtaEl,'click', () => {
            if (!this.els.disclaimerCtaEl.classList.contains('tariff-popup__table-disclaimer-cta--open')) {
              this.els.disclaimerCtaEl.classList.add('tariff-popup__table-disclaimer-cta--open');
            } else {
              this.els.disclaimerCtaEl.classList.remove('tariff-popup__table-disclaimer-cta--open');
            }
  
            scrollbar.resize(this.els.planSelectedInnerWrapEl);
          });
        } else {
          [...this.els.planDetailsTitleEls].forEach((el, index) => {
            addEventListener(el, 'click', () => {
              const descEl = el.parentElement.querySelector('.tariff-popup__plan-details-desc');

              if (el.parentElement.classList.contains('expand')) {
                el.parentElement.classList.remove('expand');
                descEl.style.maxHeight = '0';
              } else {
                el.parentElement.classList.add('expand');
                descEl.style.display = 'block';
                descEl.style.maxHeight = `${this.planDetailsDescHeights[index]}px`;
              }

              const transitionEndEvent = detectTransitionEndEvent(descEl);

              if (transitionEndEvent) {
                const handleTransitionEnd = () => {
                  this.setMaxHeight();
                  descEl.removeEventListener(transitionEndEvent, handleTransitionEnd);
                };

                descEl.addEventListener(transitionEndEvent, handleTransitionEnd);
              } else {
                setTimeout(this.setMaxHeight.bind(this), 200);
              }
            });
          });

          addEventListener(this.els.planDetailsBackBtnEl, 'click', () => {
            this.els.contentsPlanEl.style.visibility = '';
            this.els.contentsPlanEl.setAttribute('aria-hidden', 'false');
            this.els.contentsPlanDetailsEl.style.display = 'none';

            this.isSeeMoreInfoOpend = false;

            this.setFocusFirstFocusableEl();
          });
        }
      } else if (this.step === 1) {
        [...this.els.checkboxEls].forEach((el) => {
          addEventListener(el,'click', (e) => {
            if (e.target.tagName && e.target.tagName.toUpperCase() === 'INPUT') {
              if (!el.classList.contains('tariff-popup__checkbox--checked')) {
                el.classList.add('tariff-popup__checkbox--checked');
              } else {
                el.classList.remove('tariff-popup__checkbox--checked');
              }
            }
          });
        });

        addEventListener(this.els.disclaimerCtaEl,'click', () => {
          if (!this.els.disclaimerCtaEl.classList.contains('tariff-popup__table-disclaimer-cta--open')) {
            this.els.disclaimerCtaEl.classList.add('tariff-popup__table-disclaimer-cta--open');
          } else {
            this.els.disclaimerCtaEl.classList.remove('tariff-popup__table-disclaimeectedInnerWrapEl);
        });
      } else if (this.step === 2) {
        [...this.els.closeBtnEls].forEach((el) => {
          addEventListener(el,'click', this.close);
        });
      }

      addEventListener(this.els.popupCloseBtnEl, 'click', this.close);
      addEventListener(this.els.popupCloseBtnEl, 'keydown', this.handleCloseButtonKeyDown);
      addEventListener(this.els.el, 'keydown', this.handleContentsKeyDown);
      window.addEventListener('resize', this.resize);
    }

    show(step, isSeeMoreInfo) {
      if (step === 0) {
        if (!isSeeMoreInfo) {
          [...this.els.planDetailItemEls].forEach((el) => {
            if (el.style.display === 'block') {
              el.style.display = 'none';
            }
          });

          [...this.els.planDetailViewMoreBtnEls].forEach((el) => {
            el.classList.remove('less');
          });

          this.els.nextBtnEl.disabled = true;
          this.els.nextBtnEl.classList.add('cta--disabled');

          for (let i = 0; i < this.els.radioEls.length; i++) {
            if (this.els.radioEls[i].classList.contains('tariff-popup__radio--checked')) {
              this.els.nextBtnEl.disabled = false;
              this.els.nextBtnEl.classList.remove('cta--disabled');
              break;
            }
          }
          if (this.els.contentsPlanDetailsEl) {
            this.els.contentsPlanDetailsEl.style.display = 'none';
          }

          if (this.els.contentsPlanSelectedEl) {
            this.els.contentsPlanSelectedEl.style.display = 'none';
          }
          
          if (this.els.contentsFormEl) {
            this.els.contentsFormEl.style.display = 'none';
          }

          this.els.contentsPlanEl.style.visibility = '';
          this.els.contentsPlanEl.setAttribute('aria-hidden', 'false');
          this.els.contentsPlanEl.style.display = 'block';

          this.step = 0;
        } else {
          this.els.contentsPlanEl.style.visibility = 'hidden';
          this.els.contentsPlanEl.setAttribute('aria-hidden', 'true');

          this.els.contentsPlanDetailsEl.style.display = 'block';

          this.isSeeMoreInfoOpend = true;

          const descEls = this.els.el.querySelectorAll('.tariff-popup__plan-details-desc');
          this.planDetailsDescHeights = [];

          [...descEls].forEach((el, index) => {
            el.style.maxHeight = '';

            this.planDetailsDescHeights[index] = el.getBoundingClientRect().height;

            el.style.position = 'relative';
            el.style.visibility = 'visible';

            if (el.parentElement.classList.contains('expand')) {
              el.style.maxHeight = `${this.planDetailsDescHeights[index]}px`;
            } else {
              el.style.maxHeight = 0;
            }
          });
        }

        this.setMaxHeight();
        this.setFocusFirstFocusableEl();
      } else if (step === 1) {
        [...this.els.checkboxEls].forEach((el) => {
          el.querySelector('input').checked = false;
          el.classList.remove('tariff-popup__checkbox--checked');
        });

        if (this.els.disclaimerCtaEl) {
          this.els.disclaimerCtaEl.classList.remove('tariff-popup__table-disclaimer-cta--open');
        }

        if (!this.isBc) {
          this.els.submitBtnEl.disabled = true;
          this.els.submitBtnEl.classList.remove('tariff-popup__btn-submit--active');
        }

        if (this.els.contentsPlanEl) {
          this.els.contentsPlanEl.style.display = 'none';
        }

        if (this.els.contentsPlanDetailsEl) {
          this.els.contentsPlanDetailsEl.style.display = 'none';
        }
        
        if (this.els.contentsFormEl) {
          this.els.contentsFormEl.style.display = 'none';
        }

        this.els.contentsPlanSelectedEl.style.display = 'block';
        this.step = 1;
        this.setMaxHeight();
        this.setFocusFirstFocusableEl();
      } else if(step === 2) {
        if (this.els.contentsPlanEl) {
          this.els.contentsPlanEl.style.display = 'none';
        }

        if (this.els.contentsPlanDetailsEl) {
          this.els.contentsPlanDetailsEl.style.display = 'none';
        }

        if(this.els.contentsPlanSelectedEl) {
          this.els.contentsPlanSelectedEl.style.display = 'none';
        }

        this.els.contentsFormEl.style.display = 'block';
        this.step = 2;
        this.setMaxHeight();
        this.setFocusFirstFocusableEl();
      }

      window.sg.common.lazyLoad.setLazyLoad();
    }

    handleContentsKeyDown(e) {
      if (e.shiftKey && window.sg.common.constants.KEY_CODE.TAB === e.keyCode) {
        const firstFocusableEl = this.getFirstFocusableEl();

        if (firstFocusableEl && e.target === firstFocusableEl) {
          e.preventDefault();
          this.els.popupCloseBtnEl.focus();
        }
      }
    }

    handleCloseButtonKeyDown(e) {
      if (!e.shiftKey && window.sg.common.constants.KEY_CODE.TAB === e.keyCode) {
        e.preventDefault();
        this.setFocusFirstFocusableEl();
      }
    }

    setOriginFocus() {
      if (this.focusTargetEl && this.focusTargetEl instanceof Element) {
        this.focusTargetEl.focus();
      } else if (this.isBc) {
        document.querySelector('.pd-buying-tool [data-target-popup="tariffPopup"]').focus();
      } else {
        utils.buyingFocus('tariffPopup');
      }
    }
  }

  TariffPopup.instances = new WeakMap();

  function showPopup(targetEl = null) {
    TariffPopup.instances.get(document.querySelector('.tariff-popup')).open(targetEl);
    window.sg.common.lazyLoad.setLazyLoad();
  }

  function closePopup() {
    TariffPopup.instances.get(document.querySelector('.tariff-popup')).close();
  }

  const tariffPopup = {
    init() {
      const el = document.querySelector('.tariff-popup');
      if (!TariffPopup.instances.has(el)) {
        new TariffPopup(el);
      }
    },
    // step = 0,   Step ReInit  
    // step = 0, isSeeMoreInfo = true,   Step  See More Info ReInit  
    // step = 1,   Step ReInit  
    reInit(step = 0, isSeeMoreInfo = false) {
      const el = document.querySelector('.tariff-popup');
      if (!TariffPopup.instances.has(el)) {
        new TariffPopup(el).reInit(step, isSeeMoreInfo);
      } else {
        TariffPopup.instances.get(el).reInit(step, isSeeMoreInfo);
      }
    },
    // step = 0,   Step 
    // step = 0, isSeeMoreInfo = true,   Step  See More Info 
    // step = 1,   Step 
    show(step = 0, isSeeMoreInfo = false) {
      const el = document.querySelector('.tariff-popup');
      if (TariffPopup.instances.has(el)) {
        TariffPopup.instances.get(el).show(step, isSeeMoreInfo);
      }
    },
    showPopup,
    closePopup,
  };

  window.sg.components.tariffPopup = tariffPopup;
  $q.ready(tariffPopup.init);
})();

(() => {
  const $q = window.sg.common.$q;
  const scrollbar = window.sg.common.scrollbar;
  const utils = window.sg.common.utils;

  let sielTradeInPopupEls = {};
  let currentStep = 0;

  function init() {
    const sielTradeInPopup = document.querySelector('.siel-trade-in-popup');

    if (!sielTradeInPopup) {
      return;
    }

    setElements(sielTradeInPopup);

    bindEvents();
  }

  function setElements(el) {
    sielTradeInPopupEls = {
      el,
      closeEl: el.querySelector('.siel-trade-in-popup__close'),
      cancelEl: el.querySelector('.siel-trade-in-popup__btn-cancel'),
      popupLoopingStartEl: el.querySelector('.siel-trade-in-popup--start'),
      popupLoopingEndEl: el.querySelector('.siel-trade-in-popup--end'),
    };

    currentStep = 0;
  }

  function bindEvents() {
    sielTrade closePopup();
    });

    sielTradeInPopupEls.cancelEl.addEventListertEl.addEventListener('focus', () => {
      sielTradeInPopupEls.closeEl.focus();
    });

    sielTradeInPopupEls.popupLoopingEndEl.addEventListener('focus', () => {
      sielTradeInPopupEls.el.querySelector('.text-field-v2__input').focus();
    });

    window.addEventListener('resize', () => {
      resizePopup();
    });

    resizePopup();
  }

  function resizePopup() {
    const winHeight = window.innerHeight;
    const titleHeight = sielTradeInPopupEls.el.querySelector('.siel-trade-in-popup__title').getBoundingClientRect().height;
    const btnWrapHeight = sielTradeInPopupEls.el.querySelector('.siel-trade-in-popup__btn-wrap').getBoundingClientRect().height;
    const calHeight = winHeight - titleHeight - btnWrapHeight;
    if (utils.getCurrentDevice() === 'desktop') {
      if (calHeight < 640) {
        sielTradeInPopupEls.el.querySelector('.scrollbar__wrap').style.height = `${winHeight - titleHeight - btnWrapHeight}px`;
      } else {
        sielTradeInPopupEls.el.querySelector('.scrollbar__wrap').style.height = '640px';
      }
    } else {
      sielTradeInPopupEls.el.querySelector('.scrollbar__wrap').style.height = `${winHeight - titleHeight - btnWrapHeight}px`;
    }

    scrollbar.resize(sielTradeInPopupEls.el.querySelector('.scrollbar'));
  }

  function showPopup() {
    sielTradeInPopupEls.el.style.display = 'block';

    utilsShow();

    resizePopup();
  }

  function closePopup() {
    sielTradeInPopupEls.el.removeAttribute('style');

    utilsHide();

    originFocus();
  }

  function originFocus() {
    const pddCheck = document.querySelector('.pdd-buying-tool');
    if (pddCheck) {
      document.querySelector('.pdd-buying-tool [data-target-popup="sielTradeInPopup"]').focus();
    } else {
      document.querySelector('.pd-buying-tool [data-target-popup="sielTradeInPopup"]').focus();
    }
  }

  function utilsShow() {
    utils.popupControl.open(closePopup);
    utils.hiddenScroll();
  }

  function utilsHide() {
    utils.popupControl.close();
    utils.visibleScroll();
  }

  function showStep(type) {
    sielTradeInPopupEls.el.querySelectorAll('.siel-trade-in-popup-option')[currentStep].classList.add('show');

    if (type === 'last') {
      changeRadio();

      // if (currentStep === 2) {
      //   currentStep = currentStep + 1;
      // }

      sielTradeInPopupEls.el.querySelectorAll('.siel-trade-in-popup-option')[currentStep + 1].classList.add('show');
      sielTradeInPopupEls.el.querySelector('.siel-trade-in-popup-option__headline-btn').addEventListener('click', () => {
        if (sielTradeInPopupEls.el.querySelector('.siel-trade-in-popup-option__type-guide-wrap').classList.contains('show')) {
          hideGuide();
        } else if (sielTradeInPopupEls.el.querySelector('.siel-trade-in-popup-option__type-guide-wrap').classList.contains('hide')) {
          showGuide();
        } else {
          sielTradeInPopupEls.el.querySelector('.siel-trade-in-popup-option__type-guide-wrap').classList.add('show');
        }
      });

      sielTradeInPopupEls.el.querySelector('.siel-trade-in-popup__disclaimer-wrap').classList.add('show');
    }

    currentStep = currentStep + 1;

    // resizePopup();

    // goScroll();
  }

  function goScroll(current) {
    const targetScrollTop = sielTradeInPopupEls.el.querySelectorAll('.siel-trade-in-popup-option')[current].offsetTop;
    scrollbar.scrollTo(sielTradeInPopupEls.el.querySelector('.scrollbar'), 0, targetScrollTop, true);
  }

  function showGuide() {
    const guideArea = sielTradeInPopupEls.el.querySelector('.siel-trade-in-popup-option__type-guide-wrap');
    const guideBtn = sielTradeInPopupEls.el.querySelector('#guide-btn');

    guideArea.classList.remove('hide');
    guideArea.classList.add('show');

    guideBtn.setAttribute('xlink:href','#close-up-regular');
    guideBtn.setAttribute('href','#close-up-regular');
  }

  function hideGuide() {
    const guideArea = sielTradeInPopupEls.el.querySelector('.siel-trade-in-popup-option__type-guide-wrap');
    const guideBtn = sielTradeInPopupEls.el.querySelector('#guide-btn');

    guideArea.classList.remove('show');
    guideArea.classList.add('hide');

    guideBtn.setAttribute('xlink:href','#open-down-regular');
    guideBtn.setAttribute('href','#open-down-regular');
  }

  function changeRadio() {
    [...sielTradeInPopupEls.el.querySelectorAll('.radio-v2__input')].forEach((radio) => {
      radio.addEventListener('change', () => {
        [...sielTradeInPopupEls.el.querySelectorAll('.radio-v2')].forEach((el) => {
          el.classList.remove('active');
        });

        radio.parentElement.classList.add('active');
      });
    });
  }

  window.sg.components.sielTradeInPopup = {
    init,
    showPopup,
    showStep,
    closePopup,
    resizePopup,
    goScroll,
  };

  $q.ready(() => init());
})();

(() => {
  const selector = { 
    loading: '.pd-page-loading',
  };

  const el = {
    loading: null,
  };

  class PdPageLoading {
    constructor() {
      this.templateHtml = 
      `<div class="pd-page-loading">
        <div class="circular-progress circular-progress--light-bg">
          <div class="circular-progress__a"></div>
          <div class="circular-progress__b"></div>
        </div>
      </div>
      `;
      document.body.insertAdjacentHTML('beforeend', this.templateHtml);
      el.loading = documen  if (!PdPageLoading.instance) {
      PdPageLoading.instance = new PdPageLoading();
    } else {
      el.loading.style.display = 'block';
    }
  }

  function hide() {
    if (PdPageLoading.instance) {
      el.loading.style.display = 'none';
    }
  }

  window.sg.components.pdPageLoading = {
    show,
    hide,
  };
})();

(() => {
  const $q = window.sg.common.$q;
  const scrollbar = window.sg.common.scrollbar;
  const utils = window.sg.common.utils;

  const selector = {
    section: '.vd-trade-in-popup',
  };

  class VDTradeInPopup {
    constructor(element) {
      this.selector = {
        layer: '.layer-popup__inner',
        stepsClass: '.vd-trade-in-popup__step',
        closeButton: '.vd-trade-in-popup__close',
        conditionRadioButton: '.radio-v2__input[name=conditioncheck]',
        conditionGroup: '[data-condition-group=conditionCheckInfo]',
        scrollbar: '.scrollbar',
      };

      this.el = {
        component: $q(element),
        currentStepEl: null,
        focusTargetEl: null,
      };

      VDTradeInPopup.instances.set(element, this);

      this.init();
    }

    init() {
      this.setElements();
      this.bindEvents();
      this.setScrollbar();
    }

    reInit() {
      this.setElements();
      this.setScrollbar();
      this.setScrollbar();
    }

    setElements() {
      this.el.steps = this.el.component.find(this.selector.stepsClass);
      this.el.scrollbars = this.el.component.find(this.selector.scrollbar);
      this.el.conditionRadioButton = this.el.component.find(this.selector.conditionRadioButton);
      this.el.conditionGroup = this.el.component.find(this.selector.conditionGroup);
      this.el.closeButton = this.el.component.find(this.selector.closeButton);
    }

    bindEvents() {
      this.el.conditionRadioButton.off('change', this.checkConditionInfo.bind(this)).on('change', this.checkConditionInfo.bind(this));
    }

    checkConditionInfo(e) {
      const targetId = e.target.id;

      this.el.conditionGroup.target.forEach((el) => {
        const $el = $q(el);
        if( el.getAttribute('data-condition-id') === targetId ) {
          $el.show();
        } else {
          $el.hide();
        }
      });
    }

    showPopup(focusTargetEl) {
      this.focusTargetEl = focusTargetEl;
      this.el.component.show();

      if( !this.el.currentStepEl ) {
        this.el.currentStepEl = this.el.steps.target[0];
      }

      this.el.closeButton.off('click', this.closePopup.bind(this)).on('click', this.closePopup.bind(this));

      this.setScrollbar();

      utils.popupControl.open(closePopup);
      utils.hiddenScroll();

      this.setStepAfter();
    }

    closePopup() {
      this.el.component.hide();
      this.el.component.offLayerFocus();

      utils.visibleScroll();

      this.setOriginFocus();
    }

    showStep(cls) {
      this.el.steps.target.forEach((item) => {
        const $item = $q(item);

        if ($item.hasClass(cls)) {
          $item.show();
          this.el.currentStepEl = $item.target[0];
        } else {
          $item.hide();
        }
      });

      this.setStepAfter();
    }

    setStepAfter() {
      this.el.component.setLayerFocus(this.selector.layer, this.selector.closeButton);
      this.setFocusFirstFocusableEl();
      this.setScrollbar();
    }

    setScrollbar() {
      this.el.scrollbars.target.forEach((el) => {
        scrollbar.reInit(el);
      });
    }

    getFirstFocquerySelectorAll('a, button, input:not([type="hidden"]), textarea')[0];
      }
    }

    setFocusFirstFocusableEl() {
      const firstFocusEl = this.getFirstFocusableEl();

      if (firstFocusEl) {
        firstFocusEl.focus();
      }
    }

    setOriginFocus() {
      if (this.focusTargetEl && this.focusTargetEl instanceof Element) {
        this.focusTargetEl.focus();
        this.focusTargetEl = null;
      }
    }
  }

  VDTradeInPopup.instances = new WeakMap();



  function init() {
    $q(selector.section).target.forEach((element) => {
      if (!VDTradeInPopup.instances.has(element)) {
        new VDTradeInPopup(element);
      }
    });
  }

  function reInit() {
    $q(selector.section).target.forEach((element) => {
      if (VDTradeInPopup.instances.has(element)) {
        VDTradeInPopup.instances.get(element).reInit();
      }
    });
  }

  function showPopup(focusTargetEl = null) {
    $q(selector.section).target.forEach((element) => {
      if (VDTradeInPopup.instances.has(element)) {
        VDTradeInPopup.instances.get(element).showPopup(focusTargetEl);
      }
    });
  }

  function closePopup() {
    $q(selector.section).target.forEach((element) => {
      if (VDTradeInPopup.instances.has(element)) {
        VDTradeInPopup.instances.get(element).closePopup();
      }
    });
  }

  function showStep(activeCls) {
    $q(selector.section).target.forEach((element) => {
      if (VDTradeInPopup.instances.has(element)) {
        VDTradeInPopup.instances.get(element).showStep(activeCls);
      }
    });
  }

  function closeAlertPopup(id) {
    const targetPopup = document.querySelector(`#${id}`);

    if( targetPopup ) {
      window.sg.components.create(targetPopup).close(this);
    }
  }

  window.sg.components.VDTradeInPopup = {
    init,
    reInit,
    showPopup,
    closePopup,
    showStep,
    closeAlertPopup,
  };

  $q.ready(init);
})();

(() => {
  const $q = window.sg.common.$q;
  const swiperManager = window.sg.common.swiperManager;

  const selector = {
    section: '.usp-banner',
    desc: '.usp-banner__desc',
    contents: '.usp-banner__contents',
  };

  const el = {
    section: null,
    contents: null,
  };

  const tagging = () => {
    el.section.find(selector.desc).target.forEach((ele) => {
      const eachEle = $q(ele);
      
      const track = eachEle.attr('data-an-page-track');
      const text = eachEle.attr('data-an-headline-text');

      eachEle.find('a').target.forEach((desc) => {
        desc.setAttribute('an-tr',`ft17_usp banner-${track}-text-link`);
        desc.setAttribute('an-ca','content click');
        desc.setAttribute('an-ac','feature');
        desc.setAttribute('an-la',`usp banner:${text}`);
      });
    });

    el.section.target.forEach((ele) => {
      const sectonEl = $q(ele);
      if (sectonEl.hasClass('usp-banner--bg-dynamic')) {
        const containerEl = sectonEl.find('.swiper-container');
        const swiper = swiperManager.getSwiper(containerEl.target[0]);
        const transitionEndHandler = () => {
          if (containerEl.find('.swiper-slide-active').hasClass('dynamic--bg-light-gray')) {
            sectonEl.addClass('dynamic--bg-light-gray');
            sectonEl.removeClass('dynamic--bg-blue');
          } else if (containerEl.find('.swiper-slide-active').hasClass('dynamic--bg-blue')) {
            sectonEl.addClass('dynamic--bg-blue');
            sectonEl.removeClass('dynamic--bg-light-gray');
          }
        };
        
        swiper.on('transitionEnd', transitionEndHandler);
        transitionEndHandler();
      }
    });
  };

  const setTextAlign = () => {
    el.contents.target.forEach((ele) => {
      const contentsEl = $q(ele);
      if (contentsEl.find('.usp-banner__icon').target.length === 1){
        if (window.sg.common.utils.getDirection() === 'ltr') {
          contentsEl.find('.usp-banner__desc').css({
            'text-align': 'left',
          });
        } else if (window.sg.common.utils.getDirection() === 'rtl') {
          contentsEl.find('.usp-banner__desc').css({
            'text-align': 'right',
          });
        }
      }
    });
  };

  const init = () => {
    window.sg.common.image.initAll();

    el.section = $q(selector.section);
    el.contents = $q(selector.contents);

    if (!el.section.target.length) {
      return;
    }

    if (!el.contents.target.length) {
      return;
    }

    tagging();

    if (window.sg.common.utils.getCurrentDevice() === 'mobile') {
      setTextAlign();
    }
  };

  const reInit = () => {
    $q(selector.section).find('.basic-swiper').target.forEach((sw) => {
      if(!swiperManager.getSwiper(sw)){
        swiperManager.slideInit(sw);
      }else{
        swiperManager.slideReInit(sw);
      }
    });

    tagging();
  };

  $q.ready(init);

  window.sg.components.uspBanner = {
    init,
    reInit,
  };
})();

(() => {
  const $q = window.sg.common.$q;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;
  const selector = {
    section: '.product-support',
  };

  class ProductSupport {
    constructor(component) {
      this.selector = {
        tooltipWrap: '.product-support__manuals-downloads__tooltip',
        tooltipCta: '.product-support__manuals-downloads__tooltip-cta',
        tooltipClose: '.product-support__manuals-downloads__tooltip-layer-close',
        tooltipLayer: '.product-support__manuals-downloads__tooltip-layer',
        tooltipCls: 'product-support__manuals-downloads__tooltip--open',
        itemBox: '.product-support__manuals-downloads__item',
        sameHeight: ['.product-support__manuals-downloads__item-box', '.product-support__manuals-downloads__info'],
      };

      this.el = {
        component: $q(component),
        window: $q(window),
      };

      this.handler = {
        setTooltip: this.setTooltip.bind(this),
        resize: this.resize.bind(this),
        outClick: this.outClick.bind(this),
      };

      ProductSupport.instances.set(component, this);

      this.init();
    }

    setElements() {
      this.el.tooltipCta = this.el.component.find(this.selector.tooltipCta);
      this.el.tooltipClose = this.el.component.find(this.selector.tooltipClose);
      this.el.tooltipWrap = this.el.component.find(this.selector.tooltipWrap);
      this.el.itemBox = this.el.component.find(this.selecg = false;
      this.mobileFlag = false;

      console.log('tooltipcta = ', this.el.tooltipCta);
    }

    init() {
      this.setElements();

      this.bindEvents();

      this.resize();
    }

    reInit() {
      this.init();
    }

    setTooltip(event) {
      const activeTooltip = $q(event.target).closest{
        this.openTooltip(activeTooltip);
      }
    }

    openTooltip(activeLayer) {
      activeLayer.addClass(this.selector.tooltipCls);
    }

    closeTooltip(activeLayer) {
      activeLayer.removeClass(this.selector.tooltipCls);
    }

    outClick(event) {
      if ($q(event.target).closest(this.selector.tooltipCta).target.length) {
        return;
      }

      if (!$q(event.target).closest(this.selector.tooltipLayer).target.length) {
        this.closeTooltip(this.el.tooltipWrap);
      }
    }

    setHeight() {
      this.selector.sameHeight.forEach((item) => {
        const setHeightArr = [];

        this.el.itemBox.target.forEach((a) => {
          setHeightArr.push($q(a).find(item).outerHeight());
        });

        const maxHeight = Math.max.apply(null, setHeightArr);

        this.el.itemBox.target.forEach((b) => {
          $q(b).find(item).css({
            'height': `${Math.floor(maxHeight)}px`,
          });
        });
      });
    }

    setDefault() {
      this.selector.sameHeight.forEach((item) => {
        this.el.itemBox.target.forEach((a) => {
          $q(a).find(item).css({
            'height': '',
          });
        });
      });
    }

    resize() {
      this.setDefault();

      if (BREAKPOINTS.MOBILE < utils.getViewPort().width) {
        if (this.desktopFlag === false) {
          this.desktopFlag = true;
          this.mobileFlag = false;

          this.unbindTooltip();

          this.closeTooltip(this.el.tooltipWrap);
        }

        this.setHeight();
      } else {
        if (this.mobileFlag === false) {
          this.mobileFlag = true;
          this.desktopFlag = false;

          this.bindTooltip();
        }
      }
    }

    bindEvents() {
      this.el.window.off('resize', this.handler.resize).on('resize', this.handler.resize);
    }

    unbindTooltip() {
      this.el.window.off('click', this.handler.outClick);

      this.el.tooltipCta.off('click', this.handler.setTooltip);
    }

    bindTooltip() {
      this.el.window.on('click', this.handler.outClick);

      this.el.tooltipCta.on('click', this.handler.setTooltip);

      this.el.tooltipClose.target.forEach((item) => {
        const $item = $q(item);

        $item.on('click', () => {
          this.closeTooltip($item.closest(this.selector.tooltipWrap));
        });
      });
    }
  }

  const init = () => {
    $q(selector.section).target.forEach((element) => {
      if (!ProductSupport.instances.has(element)) {
        new ProductSupport(element);
      }
    });

    if (window.sg.components.supportContainer !== undefined) {
      window.sg.components.supportContainer.resize();
    }
  };

  const reInit = () => {
    $q(selector.section).target.forEach((element) => {
      if (ProductSupport.instances.has(element)) {
        ProductSupport.instances.get(element).reInit();
      } else {
        new ProductSupport(element);
      }
    });

    if (window.sg.components.supportContainer !== undefined) {
      window.sg.components.supportContainer.resize();
    }
  };

  ProductSupport.instances = new WeakMap();

  $q.ready(init);

  window.sg.components.productSupport = {
    init,
    reInit,
  };
})();

(() => {
  const $q = window.sg.common.$q;
  const selector = { section: '.spec-highlight' };

  class SpecHighlight {
    constructor(component) {
      this.selector = {
        section: selector.section,
        moreBtn: '.spec-highlight__button',
        content: '.spec-highlight__container',
        buttonWrap: '.spec-highlight__button-wrap',
        headline: '.spec-highlight__headline',
        tabItem: '.tab__item',
      };

      this.ele = {
        section: $q(component),
        moreBtn: null,
        content: null,
      };

      this.handler = {
        setViewMore: this.setViewMore.bind(this),
        setHideAll: this.setHideAll.bind(this),
        clickTab: this.clickTab.bind(this),
      };

      this.setProperty();

      SpecHighlight.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.moreBtn = this.ele.section.find(this.selector.moreBtn).eq(0);
      this.ele.hideBtn = this.ele.section.find(this.selector.moreBtn).eq(1);
      this.ele.content = this.ele.section.find(this.selector.content);
      this.ele.headline = this.ele.section.find(this.selector.headline);
      this.ele.tabItemBtn = this.ele.section.find(this.selector.tabItem).find('button');
    }

    init() {
      this.bindEvents();
    }

    reInit() {
      this.setProperty();

      this.bindEvents();
    }

    toggleViewMore() {
      if (this.ele.content.css('display') === 'none') {
        this.setViewMore();
      } else {
        this.setHideAll();
      }
    }

    setViewMore(){
      const focusEl = this.ele.content.find('a').target[0] || this.ele.hideBtn.target[0];

      this.ele.moreBtn.closest(this.selector.buttonWrap).addClass('spec-highlight__button-wrap--active');
      this.ele.hideBtn.closest(this.selector.buttonWrap).removeClass('spec-highlight__button-wrap--active');

      this.ele.content.stop().slideDown(300, () => {
        this.ele.content.removeAttr('style');
        thi     if (this.ele.headline.target.length > 0) {
          this.ele.headline.attr('tabindex', '0');
          this.ele.headline.focus();

          this.ele.headline.on('blur', () => {
            this.ele.headline.removeAttr('tabindex');
          });
        } else {
          focusEl.focus();
        }
      });
    }

    setHideAll() {
      this.ele.hideBtn.closest(this.selector.buttonWrap).addClass('spec-highlight__button-wrap--active');
      this.ele.moreBtn.closest(this.selector.buttonWrap).removeClass('spec-highlight__button-wrap--active');

      this.ele.content.slideUp(300, () => {
        this.ele.content.removeAttr('style');
        this.ele.content.css({
          display: 'none',
        });

        this.ele.moreBtn.focus();
        if (this.ele.headline.target.length > 0) {
          if (this.ele.headline.attr('tabindex')) {
            this.ele.headline.removeAttr('tabindex');
          }
        }
      });
    }

    clickTab(e) {
      const targetId = e.target.getAttribute('aria-controls');
      this.ele.section.find('[role="tabpanel"]').removeClass('is-active');
      this.ele.section.find(`#${targetId}`).addClass('is-active');
    }

    bindEvents() {
      this.ele.moreBtn.off('click', this.handler.setViewMore).on('click', this.handler.setViewMore);
      this.ele.hideBtn.off('click', this.handler.setHideAll).on('click', this.handler.setHideAll);
      this.ele.tabItemBtn.off('click', this.handler.clickTab).on('click', this.handler.clickTab);
    }
  }

  function init() {
    $q(selector.section).target.forEach((element) => {
      if (!SpecHighlight.instances.has(element)) {
        new SpecHighlight(element);
      }
    });
  }

  function reInit() {
    $q(selector.section).target.forEach((element) => {
      if (SpecHighlight.instances.has(element)) {
        const instances =  SpecHighlight.instances.get(element);
        instances.reInit();
      } else {
        new SpecHighlight(element);
      }
    });
  }

  /**
  //  @param       : component Element
  //  @discription : ViewMore toggle open,close
  //  @example : window.sg.components.specHighlight.toggleViewMore((document.querySelector('.spec-highlight')))
  **/
  function toggleViewMore(element) {
    if (SpecHighlight.instances.has(element)) {
      const instances =  SpecHighlight.instances.get(element);
      instances.toggleViewMore();
    }
  }

  SpecHighlight.instances = new WeakMap();

  window.sg.components.specHighlight = {
    init,
    reInit,
    toggleViewMore,
  };

  $q.ready(init);
})();

;(function (win, $) {
	'use strict';
	
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const namespace = window.sg.components.dynamic;
	
	const oldProductYn = $("#navOldProductYn").val();
	const mdaUseYn = $("#mdaUseYn").val();
	const b2bSpecEmptyYn = ($("#b2bSpecEmptyYn").val() === "Y")?true : false;
	const isB2b = ($("#b2bFlag").val() === "Y")?true : false;
	
	function emptySpec(){
		if(isB2b && ($("#b2bSpecEmptyYn").val() === "Y")){
			$(".spec-highlight__container").show();
			$(".spec-highlight__button-wrap").remove();
		}
	}
	
	$(function() {
		if (mdaUseYn === "Y" && oldProductYn === "Y") {
			window.sg.components.specHighlight.toggleViewMore((document.querySelector('.spec-highlight')));
		}
		
		if(isB2b && b2bSpecEmptyYn){
			emptySpec();
		}
	});
	
	namespace.specHighlight = (function() {
		return {
			emptySpec : emptySpec
		}
	})();
})(window, window.jQuery);

(() => {
  const $q = window.sg.common.$q;

  class Pdd09ProductReviewHighlight {
    constructor(el) {
      this.els = {
        el,
        tabEl: el.querySelector('.tab'),
        tabItemEls: el.querySelectorAll('.tab__item-title'),
        reviewWrapEls: el.querySelectorAll('.pdd09-product-review-highlight__review-wrap'),
        ctaEls: el.querySelectorAll('.pdd09-product-review-highlight__cta-wrap .cta'),
      };

      this.tab = window.sg.common.tab;

      this.init();
    }

    init() {
      if (Pdd09ProductReviewHighlight.instances.has(this.els.el)) {
        return;
      }

      Pdd09ProductReviewHighlight.instances.set(this.els.el, this);

      this.bindEvents();
    }

    bindEvents() {
      this.els.tabEl.addEventListener('tabSelect', (e) => {
        [...this.els.reviewWrapEls].forEach((el, index) => {
          if (index === e.detail) {
            el.classList.add('active');
          } else {
            el.classList.remove('active');
          }
        });
      });

      [...this.els.ctaEls].forEach((el) => {
        el.addEventListener('click', () => {
          if (el.classList.contains('go-international')) {
            this.tab.selectTab(this.els.tabEl, 1);
            this.els.tabItemEls[1].focus();
          } else if (el.classList.contains('go-domestic')) {
            this.tab.selectTab(this.els.tabEl, 0);
            this.els.tabItemEls[0].focus();
          }
        });
      });
    }
  }

  Pdd09ProductReviewHighlight.instances = new WeakMap();

  const pdd09ProductReviewHighlight = {
    initAll() {
      [...document.querySelectorAll('.pdd09-product-review-highlight')].forEach((el) => {
        if (!Pdd09ProductReviewHighlight.instances.has(el)) {
          new Pdd09ProductReviewHighlight(el);
        }
      });
    },
  };

  window.sg.components.pdd09ProductReviewHighlight = pdd09ProductReviewHighlight;
  $q.ready(() => pdd09ProductReviewHighlight.initAll());
})();

var componentReviewHeighlight = {};
;(function (win, $) {

 
	
	if('undefined' === typeof win.sg) {
		win.sg = {};
	}

	if('undefined' === typeof win.sg.aem) {
		win.sg.aem = {};
	}

	if('undefined' === typeof win.sg.aem.components) {
		win.sg.aem.components = {};
	}
	
	if('undefined' === typeof win.sg.aem.components.product) {
		win.sg.aem.components.product = {};
	}

	const namespace = win.sg.aem.components.product;
	const isVisible = window.sg.common.utils.isVisible;  // 
	let siteCode = $("#siteCode").val();
	let detailNodePath = $("#navDetailRootNodePath").val(); 
	const modelcode = modelCodeToSelector($('#modelCode').val());
	const reviewNode =  '.pd-g-product-review-highlight';
	let isVDatReviewHighlight = ($("#isVDatReviewHighlight").val() === 'true');
	let tempTitleatReviewHighlight = $("#tempTitle").val();
	let useAplaut = $("#aplautYn").val() === 'Y'? true : false;
	let resultTab1 = '';
	let resultTab2 = '';
	let htmllast="/";
	if( location.href.indexOf(".html") > -1){
		htmllast= ".html";
	}

	let vdBvList = ["ca_fr", "mx", "co", "br", "ar", "cl", "pe", "id", "es", "hu", "se", "dk", "fi", "no", "fr", "pt", "ro", "bg", "at", "be", "be_fr", "rs", "hr", "si", "ae_ar", "il", "sa", "tr", "eg", "n_africa", "ca", "au", "nz", "my", "uk", "ie", "nl", "ae", "sa_en", "levant", "pk", "za", "sg", "vn", "th", "ph", "ch", "ch_fr", "levant_ar", "ua", "sk", "cz"];
	let vdBvSet = new Set(vdBvList);
	let isvdBv = vdBvSet.has(siteCode);
	
	let vdLTRBvList = ["ca_fr", "mx", "co", "br", "ar", "cl", "pe", "id", "es", "hu", "se", "dk", "fi", "no", "fr", "pt", "ro", "bg", "at", "be", "be_fr", "rs", "hr", "si", "tr", "n_africa", "ca", "au", "nz", "my", "uk", "ie", "nl", "ae", "sa_en", "levant", "pk", "za", "sg", "vn", "th", "ph", "ch", "ch_fr", "ua", "sk", "cz"];
	let vdLTRBvSet = new Set(vdLTRBvList);
	let isvdLTRBv = vdLTRBvSet.has(siteCode);

	resultTab1 = detailNodePath + reviewNode + '.' + modelcode+'.' + siteCode +'.pd-g-product-review-highlight-tab1'+ htmllast;
	resultTab2 = detailNodePath + reviewNode + '.' + modelcode+'.' + siteCode +'.pd-g-product-review-highlight-tab2'+ htmllast;
	//   URL
	resultTab3 = detailNodePath + reviewNode + '.' + modelcode+'.' + siteCode +'.pd-g-product-review-highlight-tab3'+ htmllast;
	
	function escapeHtml(text) {
		let newText = text;
		if(isNotNull(newText)){
			newText = newText
				.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;")
				.replace(/"/g, "&quot;")
				.replace(/'/g, "&#039;");
		}
		return newText;
	};
	
	function tabIframeGrid() {
		let bvRTLFlagValue = $("#bvRTLFlag").val();

		//LTR case   
		if(bvRTLFlagValue != "Y") {
			//VD   
			if(isvdLTRBv) {
				//   
				console.log("tabIframeGrid()!!!");
				
				//tab1(domestic reviews) iframe src  
				
				if (document.querySelector('#domestic_reviews_tab_iframe')) {
					console.log("domestic_reviews_tab_iframe!!!");
					document.querySelector('#domestic_reviews_tab_iframe').src = resultTab1;
				}

				//tab2(international reviews) iframe src 
				if (document.querySelector('#international_reviews_tab_iframe')) {
					console.log("international_reviews_tab_iframe!!!");
					document.querySelector('#international_reviews_tab_iframe').src = resultTab2;
				}
			}
		}
	}
	
	
	$(function() {
		tabIframeGrid();
    });	

	var isClick1 = false;
	var isClick2 = false;
	var isHeaderNavigationReviewClick = false;
	var isHeaderNavigationReviewClick1 = false;
	var isHeaderNavigationReviewClick2 = false;
	var isHeaderNavigationReviewClickReal = false;
	var isHeaderNavigationReviewScroll = false;
	
	function setFrameHeightTab11() {
		if (domestic_reviews_tab_iframe.document != null) {
			document.all.domestic_reviews_tab_iframe.style.height = domestic_reviews_tab_iframe.document.body.scrollHeight + 50 + "px";
		}
}
	
	function setFrameHeightTab22() {
		if (international_reviews_tab_iframe.document != null) {
			document.all.international_reviews_tab_iframe.style.height = international_reviews_tab_iframe.document.body.scrollHeight + 50 + "px";
		}
}

	//BV     
	function replaceBVArea() {
		
		$.ajax({
			type : "GET",
			url : resultTab1,
			dataType: "html",
			success : function (data) {
				const $virtualDom = $('<div></div>').append(data);
				const bvReviewContents = $virtualDom.find('#review');
				//console.log("replaceBVArea  $virtualDom=["+$virtualDom+"]");
				//console.log("replaceBVArea  bvReviewContents=["+bvReviewContents+"]");
				
				//      
				$('#review').replaceWith(bvReviewContents);

			},
			complete : function() {
				//console.log("replaceBVArea finish! ");
			}
		});
	}
	
	//reviewsContainer ID    
	function checkReviewArea() {
		//  
		//console.log("  checkReviewArea() befer:: isHeaderNavigationReviewScroll=["+isHeaderNavigationReviewScroll+"]");
		

		if(!isHeaderNavigationReviewScroll) {
			//console.log("  checkReviewArea() after:: isHeaderNavigationReviewScroll=["+isHeaderNavigationReviewScroll+"]");
			
			if(isvdLTRBv) {
				//VD    
				if(!isVDatReviewHighlight) {
					//VD  IM   (    .)
					//console.log("!isVDatReviewHighlight :: scroll event !!!  checkReviewArea()  ");
					if(document.querySelector(".pd-g-product-review-highlight") != null && document.querySelector(".pd-g-product-review-highlight").style != null) {
						if (isVisible(document.querySelector(".pd-g-product-review-highlight"))) {
							//console.log("!isVDatReviewHighlight :: scroll event !!!  checkReviewArea() :: check OK!!! ");
				 
							replaceBVArea();
							
							//    
							isHeaderNavigationReviewScroll = true;
						} else {
							//console.log("!isVDatReviewHighlight :: scroll event !!!  checkReviewArea() :: nope!!! ");
						}
					} else {
						//console.log("!isVDatReviewHighlight :: pd-g-product-review-highlight none !!! ");
					}
					
				} else {
					//VD (    .)  
					//console.log("isVDatReviewHighlight :: scroll event !!!  checkReviewArea()  ");
					if(document.querySelector(".pdd09-product-review-highlight__header-wrap") != null && document.querySelector(".pdd09-product-review-highlight__header-wrap").style != null) {
						if (isVisible(document.querySelector(".pdd09-product-review-highlight__header-wrap"))) {
							//console.log("isVDatReviewHighlight  true  :: scroll event !!!  checkReviewArea() :: check OK!!! ");
							
							replaceBVArea();
							
							//    
							isHeaderNavigationReviewScroll = true;
						} else {
							//console.log("isVDatReviewHighlight   true  :: scroll event !!!  checkReviewArea() :: nope!!! ");
						}
					} else {
						//console.log("isVDatReviewHighlight   true  :: pd-g-product-review-highlight none !!! ");
					}
				}
			} else {
				//VD    (de, ba, mk, pl, ua)
				 
				if(document.querySelector(".pd-g-product-review-highlight") != null && document.querySelector(".pd-g-product-review-highlight").style != null) {
					if (isVisible(document.querySelector(".pd-g-product-review-highlight"))) {
						//console.log("isvdLTRBv false   checkReviewArea() :: check OK!!! ");
						 
						replaceBVArea();
						
						//    
						isHeaderNavigationReviewScroll = true;
					} else {
						//console.log("isvdLTRBv false     checkReviewArea() :: nope!!! ");
					}
				} else {
					//console.log("!isVDatReviewHighlight :: pd-g-product-review-highlight none !!! ");
				}
				
			}
 		}
	}//:~ function checkReviewArea() 
	
	//   
	document.addEventListener('scroll', () => {
		let bvRTLFlagValue = $("#bvRTLFlag").val();

		//LTR case   
		if(bvRTLFlagValue != "Y" && !useAplaut) {
			//VD   
			if(isvdLTRBv) {
				//VD   
				// VD   (TODO :    isVDatReviewHighlight   )
				if(!isVDatReviewHighlight) {
					//console.log("document.addEventListener('scroll')  checkReviewArea()");
					checkReviewArea();
				} else {
					checkReviewArea();
				}
			} else {
				//VD    
				//    
				//console.log("document.addEventListener('scroll') isvdLTRBv false checkReviewArea()");
				checkReviewArea();
			}
		}
    });
	
	$(document).off("click","#domesticReviews");
	$(document).on("click", "#domesticReviews", function(){
		console.log("domesticReviews tab click!!!");
		if(!isClick1) {
			//setFrameHeightTab11();
			//$("#domestic_reviews_tab_iframe", window.parent.document).height(document.body.scrollHeight);
		}
		isClick1 = true;
	});
	
	$(document).off("click","#internationalReviews");
	$(document).on("click", "#internationalReviews", function(){
		console.log("internationalReviews tab click!!!");
		if(!isClick2) {
			setFrameHeightTab22();
			$("#international_reviews_tab_iframe", window.parent.document).height(international_reviews_tab_iframe.document.body.scrollHeight);
		}
		isClick2 = true;
	});
	
 
	componentReviewHeighlight = (function () {
		return {
			tabIframeGrid: tabIframeGrid
		}
	})();
 
})(window, $);
(() => {
  const $q = window.sg.common.$q;
  const $window = $q(window);
  const utils = window.sg.common.utils;

  const selector = {
    section: '.pdd24-product-recommendation',
  };
  class Pdd24ProductrRcommendation {
    constructor(element) {
      this.ele = {
        section: $q(element),
      };

      this.selector = {
        swiperContainer: '.lineup-card__data-swiper',
      };
      
      this.deviceSize = null;
      this.swiperReinit = true;
      
      this.isVisible = window.sg.common.utils.isVisible;
      this.isChangeHeight = false; 
      this.prevDevice = utils.getCurrentDevice();

      this.handler = {
        handleResize: this.handleResize.bind(this),
      };

      Pdd24ProductrRcommendation.instances.set(element, this);

      this.init();
    }

    init() {
      this.setElements();
      this.bindEvents();
      this.handleSliedReInit();
      this.handler.handleResize();
    }

    
    reInit() {
      this.setElements();
      this.bindEvents();
      this.handleSliedReInit();
      this.handler.handleResize();
    }

    setElements() {
      this.ele.lineup = this.ele.section.find('.lineup-card');
      this.ele.swiperContainer = this.ele.lineup.find(this.selector.swiperContainer);
    }

    maxHeightSame(maxSelectorArr){
      let max = 0;
      maxSelectorArr.forEach((sel) => {
        max = 0;
        const $setEl = this.ele.swiperContainer.find(sel);
        $setEl.target.forEach((el) => {
          const h = el.getBoundingClientRect().height;
          if(h > max){
            max = h;
          }
        });

        $setEl.css({
          height: `${max}px`,
        });
      });
    }

    bindEvents() {
      $window.off('resize',this.handler.handleResize).on('resize',this.handler.handleResize);
    }

    setMaxHeight(){
      if(this.isVisible(this.ele.section.target[0] ) && !this.isChangeHeight){
        this.isChangeHeight = true;
        const maxSelector = [
          '.lineup-card__name',
          '.lineup-card__info',
          '.lineup-card__badge-repairability',
          '.lineup-card__fiche',
          '.lineup-card__price',
          '.linep';

        // set card style
        if(this.ele.lineup.target.length){
          this.ele.swiperContainer.find(`${maxSelector.join()}, ${promotionItem}, .lineup-card__item-wrap`).css({
            height: '',
          });

          this.maxHeightSame(maxSelector);
        }
      }
    }

    handleResize() {
      const newDevice = window.sg.common.utils.getCurrentDevice();
      if (newDevice !== this.deviceSize) {
        this.deviceSize = newDevice;
        this.handleSliedReInit();
      }
      
      this.setMaxHeight();
      clearTimeout(this.delayResize);
      this.delayResize = null;
      this.delayResize = setTimeout(() => {
        this.isChangeHeight = false;
        this.setMaxHeight();
      }, 100);
    }

    handleSliedReInit() {
      const activeSlide = document.querySelector('.pdd24-product-recommendation__swiper-area .lineup-card__data-swiper');
      if (this.swiperReinit && activeSlide !== null) {
        window.sg.common.swiperManager.slideReInit(activeSlide);
      }
    }
  }

  const init = () => {
    $q(selector.section).target.forEach((element) => {
      if (Pdd24ProductrRcommendation.instances.has(element)) {
        Pdd24ProductrRcommendation.instances.get(element).reInit(true);
      } else {
        new Pdd24ProductrRcommendation(element);
      }
    });
  };

  const reInit = () => {
    $q(selector.section).target.forEach((element) => {
      if (Pdd24ProductrRcommendation.instances.has(element)) {
        Pdd24ProductrRcommendation.instances.get(element).reInit();
      } else {
        new Pdd24ProductrRcommendation(element);
      }
    });
  };

 
  Pdd24ProductrRcommendation.instances = new WeakMap();

  //$q.ready(init);
  $q.load(init);
 
  window.sg.components.Pdd24ProductrRcommendation = {
    init,
    reInit,
  };
})();

var productRecommendationPD = {};
(function ($) {
	let requestId = `${siteCode}:${Math.floor(new Date/1000)}:${Math.floor(100000 + Math.random() * 900000)}`;
	
	function getSearchProductCardForBDCApi(modelCode) {
		let BDCApiHost = "https://api-recommender.bigdata.samsung.com";
		let apiUrl = "/prodrec/recommendation";
		
		let pageType = "pdp_similar_product";
		let guid = "";
		let saId = "";
		let visitorId = "";
		let num = 6;// max 20
		
		let hasRecommendations = false;
		
		if(commonLoginCheck()){
			guid = $.cookies.get("guid",{domain:".samsung.com"});
			saId = $.cookies.get("sa_id",{domain:".samsung.com"});
			visitorId = $.cookies.get("s_ecid",{domain:".samsung.com"});
		}
		let consent = $.cookies.get("cmapi_cookie_privacy",{domain:".samsung.com"});
		// let recent_list = $.cookies.get("recent_list",{domain:".samsung.com"})
		let recent_list = cookies.getCookie("recent_list");
		let visitorIdList = [];
		$.each(cookies.getCookies(), function(k, v) {
			if (k.indexOf('AMCV_') != -1) {
		 		visitorIdList.push(v.toString());
			}
		})
		
		const headers = {
			"requestId": requestId,
			"country": siteCode,
			"num": num
		};
		const bdcParam = {
			"pageType": pageType,
			"guid": guid,
			"saId": saId,// "sa_id"  (  )
			"visitorId": visitorId,
			"visitorIdList": visitorIdList,
			"consent" : consent,// cmapi_cookie_privacy
			"recentList": recent_list,
			"targetModel": modelCode,
			"rewardPoint": ""
		};
						
		$.ajax({
			headers: headers,
			url: BDCApiHost + apiUrl,
			type: "POST",
			data: JSON.stringify(bdcParam),
			xhrFields: { withCredentials: true },
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			async: false,
			cache: true,
			success: function (data, status, xhr) {
				if(xhr.status == 200){
					if(data.recommendations && data.recommendations.length > 0){
						const productList = data.recommendations;
						requestId = data.requestId;
						
						buildProductRecommendation(productList);
						hasRecommendations = true;
					}else{
						hasRecommendations = false;
					}
				}
			},
			error : function(){
				
			},
			complete : function (data){
				if(hasRecommendations){
					$(".pdd24-product-recommendation__swiper-area").show();
					$(".pdd24-product-recommendation__no-item").hide();
				}else{
					var breadcrumbUrl = $(".breadcrumb li").eq($(".breadcrumb li").length-2).find("a").attr("href");
					$(".pdd24-product-recommendation__no-item-cta .cta").attr("href", breadcrumbUrl);
					
					$(".pdd24-product-recommendation__swiper-area").hide();
					$(".pdd24-product-recommendation__no-item").show();
				}
			}
		});
	}
	
	function buildProductRecommendation(productList) {
		const $productRecommendation = $(".pdd24-product-recommendation");
		var productRecommendationTemplate = "";
		var productListData = [];
		
		if (productList != null) {
			for (let pl = 0; pl < productList.length; pl++) {
				let tempProduct = productList[pl].product;
				let tempModelCode = productList[pl].model;
				
				if (tempProduct.modelList != null && tempProduct.modelList.length > 0) {
					let selectedIndex = 0;
					
					for (let cnt = 0; cnt < tempProduct.modelList.length; cnt++) {
						const tempModel = tempProduct.modelList[cnt];
//						if (tempModel.selected && tempModel.selected === "Y") {
//							selectedIndex = cnt;
//						}
						if(tempModel.modelCode == tempModelCode){
							selectedIndex = cnt;
						}
					}
					
					tempProduct.frontModelIdx = selectedIndex;
//					tempProduct = getProductInfo(tempProduct);
					productListData[tempProduct.familyId] = tempProduct;
					
					productRecommendationTemplate += buildProductCard(tempProduct, pl, true);
				}
			}
			$productRecommendation.html(getRecommendedProductSwiperWrapperHtml(productRecommendationTemplate));
			
			window.sg.components.Pdd24ProductrRcommendation.reInit(); //PD Recommendation 
		}
		
	}
	
	function getProductInfo(product) {
		const tempProduct = product;

		const tmpOptionListInModel = {};
		for (let mi in tempProduct.modelList) {
			const tmpModel = tempProduct.modelList[mi];
			const tmpFmyChipList = tmpModel.fmyChipList;
			
			const LOWEST_WAS_PRICE_STRIKETHROUGH_SITE_CODE = ["pl", "gr", "si", "fi", "hr", "it", "se", "no", "dk", "fr"]; // lowestWasPrice strikethrough siteCode master up to fi
			const isStrikethroughRmSite = $.inArray(siteCode, LOWEST_WAS_PRICE_STRIKETHROUGH_SITE_CODE) >= 0 ? true : false;

			if (!tmpModel.displayName) { // Product Name SKU  
				tempProduct.modelList[mi].displayName = "";
			}
			tmpModel.ctaTypeUpperCase = (tmpModel.ctaType || "").toUpperCase();

			for (let fci in tmpFmyChipList) {
				//fmyChipCode "  
				const thisOptionKey = tmpFmyChipList[fci].fmyChipType + '+' +
					tmpFmyChipList[fci].fmyChipCode.replace("\"", "").replace("&quot;", "") + '+' +
					tmpFmyChipList[fci].fmyChipLocalName.replace("\"", "").replace("&quot;", "");

				if (!tmpOptionListInModel[thisOptionKey]) {
					tmpOptionListInModel[thisOptionKey] = mi;
				} else {
					tmpOptionListInModel[thisOptionKey] += "," + mi;
				}
			}
			// SEF, SEBN, SEDA(rs, al, mk, ba  ), SENA, SEPOL, SEH ( pl )
			//  price(, msrp price )     lowestWasPrice    
			// [EPP] epp meta  
			// lowestwasprice  price   , promotion price   
			tmpModel['lowestWasPriceUseYn'] = "N";
			if((
				 (isStrikethroughRmSite || siteCode === "ro" )
				)
			&& isNotNull(tmpModel.lowestWasPrice)
			&& isNotNull(tmpModel.promotionPrice)
			&& (parseFloat(tmpModel.lowestWasPrice) <= parseFloat(tmpModel.price) && parseFloat(tmpModel.promotionPrice) < parseFloat(tmpModel.lowestWasPrice))
			){
				console.log("modelCode [{}] origin price::{}", tmpModel.modelCode, tmpModel.price);
				console.log("origin priceDisplay::"+tmpModel.priceDisplay);
				console.log("origin saveText::"+tmpModel.saveText);
				//[EPP] lowestWasPrice 
				tmpModel.price = tmpModel.lowestWasPrice;
				tmpModel.priceDisplay = currencyComma(tmpModel.lowestWasPrice, priceCurrency);
				if(siteCode === "hr"){
					tmpModel.priceDisplay = currencyComma(tmpModel.lowestWasPrice, priceCurrency)+" ("+euroToKunaPrice(tmpModel.lowestWasPrice)+")";
				}
				if(isNotNull(tmpModel.msrpPrice)){
					tmpModel.msrpPrice = tmpModel.lowestWasPrice;
					console.log("after msrpPrice::"+tmpModel.msrpPrice);
				}
				tmpModel.saveText = parseFloat(tmpModel.lowestWasPrice) - parseFloat(tmpModel.promotionPrice);
				tmpModel.lowestWasPriceUseYn = "Y";
				console.log("after price::"+tmpModel.price);
				console.log("after priceDisplay::"+tmpModel.priceDisplay);
				console.log("after saveText::"+tmpModel.saveText);
			}
		}

		/*
		 * viewOptionObj :    
		 * optionTypeList :      (  index     )
		 */
		const optionTypeList = [];
		const viewOptionObj = {};
		if (tempProduct.chipOptions) {
			for (let a = 0; a < tempProduct.chipOptions.length; a++) {
				const optionData = tempProduct.chipOptions[a];
				const optionTypeTmp = optionData.fmyChipType;

				const optionListInType = optionData.optionList;
				for (let opl in optionListInType) {
					const thisOptionKey = optionData.fmyChipType + '+' +
						optionListInType[opl].optionCode.replace("\"", "").replace("&quot;", "") + '+' +
						optionListInType[opl].optionLocalName.replace("\"", "").replace("&quot;", "");
					if (tmpOptionListInModel[thisOptionKey] != null) {
						optionListInType[opl].modelIdx = tmpOptionListInModel[thisOptionKey];
					}
				}
				viewOptionObj[optionTypeTmp] = {};
				viewOptionObj[optionTypeTmp]["optionList"] = optionListInType;

				optionTypeList.push(optionTypeTmp);
			}
		}
		tempProduct.viewOptionObj = viewOptionObj;
		tempProduct.optionTypeList = optionTypeList;

		return tempProduct;
	}
	
	function escapeHtml(text) {
		var newText = text;
		if (newText) {
			newText = newText
				.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;")
				.replace(/"/g, "&quot;")
				.replace(/'/g, "&#039;");
		}
		return newText;
	};
	
	function buildProductCard(product, swiperIdx, wrapUse) {
		const frontModel = product.modelList[product.frontModelIdx];
		var productRecommendationCardItemHtml = "";
		
		let ctaType = frontModel.ctaTypeUpperCase;
		
		var price = "";
		var discountPrice = "";
		if (frontModel.price) {
			price = frontModel.price;
		}
		if (frontModel.promotionPrice) {
			discountPrice = frontModel.promotionPrice;
		}
		const displayNameAttr = escapeHtml((frontModel.displayName || "").replace(/<br>/ig, " ").replace(/<sup>/ig, " "));
		const dataModelCodeAttr = `data-modelcode="${frontModel.modelCode}"`;
		const dataModelNameAttr = `data-modelname="${frontModel.modelName}"`;

		// pre order, buy now, add to cart  
		const taggingAttrForBuy =
			`data-pimsubtype="${(product.categorySubTypeEngName || "").toLowerCase()}" data-pvitype="${(frontModel.pviTypeName || "").toLowerCase()}" data-pvisubtype="${(frontModel.pviSubtypeName || "").toLowerCase()}" 
			data-modelrevenue="${price}" data-modelprice="${price}" data-modelqty="1" data-modelcurrency="${priceCurrency}" data-modeldisplay="${displayNameAttr}" data-discountprice="${discountPrice}" ${dataModelCodeAttr} ${dataModelNameAttr}`;
		
		let taggingAttr =
			`{"an-tr":"pdd24_product card case-product detail-index-indication","an-ca":"indication","an-ac":"carousel","an-la":"carousel:index:${swiperIdx}"}`;
		
		productRecommendationCardItemHtml += `
											<div class="lineup-card__item-inner">
												<div class="lineup-card__header-badge">
													${buildBadge(frontModel)}
												</div>
												${buildProductCardImage(product)}
												<div class="lineup-card__content">
							                        <div class="lineup-card__name">
							                        	<a href="${frontModel.pdpUrl}" class="lineup-card__name-link">${frontModel.displayName}</a>
							                        </div>
							                        <div class="lineup-card__fiche">${energyLabelBuild(frontModel)}</div>
							                        ${repairbilityBuild(frontModel)}
							                        <div class="lineup-card__price">${buildPriceArea(frontModel)}</div>
							                        <div class="lineup-card__rating">${buildRating(frontModel)}</div>
							                        <div class="lineup-card__cta">${buildCta(product)}</div>
						                        
						                    	</div><!--/* .lineup-card__content End */-->
											</div><!--/* .lineup-card__item-inner End */-->`;
		
		if(wrapUse){
			productRecommendationCardItemHtml =`<div class="lineup-card__item-wrap swiper-slide" role="listitem" data-tagging='${taggingAttr}'>
													${productRecommendationCardItemHtml}
												</div><!--/* .lineup-card__item-wrap End */-->`;
		}
		
		return productRecommendationCardItemHtml;
	}
	
	function buildBadge(tempModel){
		let badgeHtml = "";
		let badgeClass = "";
		let badgeText = "";
		let badgeFlag = false;
		
		if(isNotNull(tempModel.topFlags) && isNotNull(tempModel.topFlags.iconTypeCd)){
			if(tempModel.topFlags.iconTypeCd === "N"){
				badgeText = Granite.I18n.get("new");
				badgeClass = " badge-icon--bg-color-blue";
				badgeFlag = true;
			} else if(tempModel.topFlags.iconTypeCd === "H"){
				badgeText = Granite.I18n.get("hot");
				badgeClass = " badge-icon--bg-color-red";
				badgeFlag = true;
			} else if(tempModel.topFlags.iconTypeCd === "B"){
				badgeText = Granite.I18n.get("best seller");
				badgeClass = " badge-icon--bg-color-orange";
				badgeFlag = true;
			}
		}
		if(badgeFlag){
			badgeHtml = `<span class="lineup-card__header-badge-txt">${badgeText}</span>`;
		}
		return badgeHtml;
	}
	
	function buildProductCardImage(product) {
		var frontModel = product.modelList[product.frontModelIdx];
		let imageItemHtml = "";
		let ctaType = frontModel.ctaTypeUpperCase;
		
		var price = "";
		var discountPrice = "";
		if (frontModel.price) {
			price = frontModel.price;
		}
		if (frontModel.promotionPrice) {
			discountPrice = frontModel.promotionPrice;
		}

		const displayNameAttr = escapeHtml((frontModel.displayName || "").replace(/<br>/ig, " ").replace(/<sup>/ig, " "));
		const dataModelCodeAttr = `data-modelcode="${frontModel.modelCode}"`;
		const dataModelNameAttr = `data-modelname="${frontModel.modelName}"`;
		const dataRequestidAttr = `data-requested="${requestId}"`;

		let taggingAttr =
			`an-ca="product click" an-ac="recommended product" an-la="image click" an-tr="pdd24_product card case-product detail-product card click-product_click4" ${dataModelNameAttr} ${dataModelCodeAttr} ${dataRequestidAttr}`;
		
		if (frontModel.thumbUrl) {
			const thumbImage = frontModel.thumbUrl;
			const thumbAlt = frontModel.thumbUrlAlt || "";
			const desktopImagePreset = "?$180_180_PNG$";
			const mobileImagePreset = "?$200_200_PNG$";
			const lazyloadPreset = "?$LazyLoad_Home_PNG$";
			
			imageItemHtml +=
				`<!--/* Preset desktop: 180_180, mobile: 200_200 */-->
				<a href="${frontModel.pdpUrl}" class="lineup-card__image-link" ${taggingAttr}>
				<div class="image">
					<img class="image__preview lazy-load responsive-img" data-desktop-src="${thumbImage+desktopImagePreset}" data-mobile-src="${thumbImage+mobileImagePreset}" alt="${thumbAlt}" role="img" data-comp-name="image">
					<img class="image__main lazy-load responsive-img" data-desktop-src="${thumbImage+desktopImagePreset}" data-mobile-src="${thumbImage+mobileImagePreset}" alt="${thumbAlt}" role="img" data-comp-name="image">
				</div>
				</a>`;
		}
		const cardImageHtml =
			`<div class="lineup-card__image">
				${imageItemHtml}
			</div>`;
		return cardImageHtml;
	};
	
	function energyLabelBuild(frontModel){
		var energyLabelHtml = "";
		var eneryLabelTaggingAttr = `an-ca="option click" an-ac="recommended product" an-la="product fiche" an-tr="pdd24_product card case-product detail-product fiche-option_click1"`;
		energyLabelHtml +=
			'<div class="badge-energy-label">';
			
		var energySplitUrl,ficheSplitUrl = "";
		if(isNotNull(frontModel.energyFileUrl)){
			energySplitUrl = frontModel.energyFileUrl.split("/");
		}
		if(isNotNull(frontModel.ficheFileUrl)){
			ficheSplitUrl = frontModel.ficheFileUrl.split("/");
		}
		if(isNotNull(frontModel.energyLabelGrade) && isNotNull(frontModel.energyLabelClass1) && isNotNull(frontModel.newEnergyLabel) && frontModel.newEnergyLabel !== "Y"){
			energyLabelHtml += 
				'<div class="fiche-badge">';
			if(isNotNull(frontModel.ficheFileUrl)){
				energyLabelHtml +=
					'<a href="'+frontModel.ficheFileUrl+'" target="_blank" aria-label="'+Granite.I18n.get("Product Fiche")+' '+ficheSplitUrl[ficheSplitUrl.length-1]+': '+ Granite.I18n.get("Open in a new window")+'" class="cta-text" ' + eneryLabelTaggingAttr + '>'+
						Granite.I18n.get("Product Fiche")+
					'</a>';
			}
			energyLabelHtml +=
					'<a class="badge '+frontModel.energyLabelClass2+'" href="'+frontModel.energyFileUrl+'" aria-label="'+frontModel.energyLabelGrade+' '+energySplitUrl[energySplitUrl.length-1]+': '+ Granite.I18n.get("Open in a new window")+'" target="_blank" aria-label="'+Granite.I18n.get("Open in a new window")+'" ' + eneryLabelTaggingAttr + '>'+
						'<span class="badge__grade--with-text '+frontModel.energyLabelClass1+'">'+
							'<span class="hidden">'+frontModel.energyLabelGrade+'</span>'+
						'</span>'+
					'</a>';
			energyLabelHtml += 
				'</div>';
		}else if(isNotNull(frontModel.energyLabelGrade) && isNotNull(frontModel.energyLabelClass1) && isNotNull(frontModel.energyFileUrl) && frontModel.newEnergyLabel=="Y"){
			energyLabelHtml += 
				'<div class="badge-energy-label">';
			if(isNotNull(frontModel.ficheFileUrl)){
				energyLabelHtml +=
					'<a class="badge-energy-label__text" href="'+frontModel.ficheFileUrl+'" target="_blank" aria-label="'+Granite.I18n.get("PRODUCT INFORMATION SHEET")+' '+ficheSplitUrl[ficheSplitUrl.length-1]+': '+Granite.I18n.get("Open in a new window")+'" ' + eneryLabelTaggingAttr + '>' +
						Granite.I18n.get("PRODUCT INFORMATION SHEET") +
					'</a>';

				let energyLabelClass = "";
				if(frontModel.energyLabelClass){ //energyLabelClass 
					energyLabelClass = frontModel.energyLabelClass;
				}else{ //energyLabelClass 
					energyLabelClass = frontModel.energyLabelClass1;
				}
				energyLabelHtml += 
					'<a class="badge-energy-label__badge '+energyLabelClass+'" href="'+frontModel.energyFileUrl+'" target="_blank" aria-label="'+frontModel.energyLabelGrade+' '+energySplitUrl[energySplitUrl.length-1]+': '+ Granite.I18n.get("Open in a new window")+'"' + eneryLabelTaggingAttr + '>'+
						frontModel.energyLabelGrade +
					'</a>';
			}
			energyLabelHtml += 
				'</div>';
		}
		energyLabelHtml +=
			'</div>';
		
		return energyLabelHtml;
	}
	
	function repairbilityBuild(frontModel){
		var repairbilityHtml = "";
		//	Repairbility STR
		repairbilityHtml +=
			'<div class="lineup-card__badge-repairability">';
			
		/* // repairability      */
		if(isNotNull(frontModel.repairabilityIndex)){
			var repairabilityIndex = Number(frontModel.repairabilityIndex);
			var repairabilityAlt = Granite.I18n.get("Repairability Index : {0} / 10", [repairabilityIndex] );
			
			if(siteCode=="fr" || siteCode=="test"){
				var reparabiliteUrl = isNotNull(frontModel.repairabilityIndexPdfUrl) ? frontModel.repairabilityIndexPdfUrl :'/fr/indice-reparabilite/';
				var tempArr = reparabiliteUrl.split("/");
				var reparabiliteFileName = tempArr[tempArr.length-1];
				let taggingAttr = `an-tr="product:option-product detail-repairability index-option_click4" an-ca="option click" an-ac="recommended product" an-la="repairability index"`;
				
				repairbilityHtml += 
					'<a href="'+ reparabiliteUrl +'" target="_blank" aria-label="Indice de rparabilit" '+ taggingAttr +'>'+
						'<div class="image">'+
							'<img class="image__main responsive-img" data-desktop-src="//images.samsung.com/is/image/samsung/fr/icon/repairability/Light_83x50/'+repairabilityIndex+'.svg" data-mobile-src="//images.samsung.com/is/image/samsung/fr/icon/repairability/Light_130x78/'+repairabilityIndex+'.svg" alt="alt text" role="img" data-comp-name="image">'+
						'</div>'+
					'</a>'
			}else{
				repairbilityHtml += 
					'<span class="badge-repairability">'+
						'<img class="badge-repairability__image" src="//images.samsung.com/is/image/samsung/'+ siteCode +'/icon/consumer/repairability_index_'+ repairabilityIndex +'.png" alt="'+repairabilityAlt+'">'+
					'</span>';
			}
			
		}
		repairbilityHtml +=
			'</div>';
		
		return repairbilityHtml;
	}
	
	function buildPriceArea(frontModel){
		var productCardTemplate = "";
		var currency = $("#priceCurrency").val();
		var price = frontModel.price;
		var promotionPrice = frontModel.promotionPrice;
		var priceDisplay = "";
		
		if(price){
			priceDisplay = currencyComma(price, currency);
			
			if(promotionPrice){
				if(parseFloat(price) > parseFloat(promotionPrice) && parseFloat(promotionPrice) > 0){
					priceDisplay = currencyComma(promotionPrice, currency);
				}
			}
		}
		
		var productCardTemplate = `${priceDisplay}`;
		
		return productCardTemplate;
	}
	
	function buildRating(frontModel){
		let ratingHtml = "";
		var item = "";
		var ratings = frontModel.ratings;
		if(fnIsNull(ratings)){ 
			ratings = 0; 
			frontModel.ratings = 0;
		}
		
		const dataModelCodeAttr = `data-modelcode="${frontModel.modelCode}"`;
		const dataModelNameAttr = `data-modelname="${frontModel.modelName}"`;
		
		let taggingAttr =
			`an-ca="review" an-ac="recommended product" an-la="read review" an-tr="pdd24_product card case-product detail-review-review1" ${dataModelNameAttr} ${dataModelCodeAttr}`;

		// rating  
		var tmpCount = Math.pow(10,1);
		ratings = Math.round(ratings*tmpCount)/tmpCount;

		var ratingValue = parseFloat(ratings).toFixed(1),
		fullStarCnt = parseInt(ratings),
		cutStarWidthStyleNum = 0;
		cutStarWidthStyleNum = parseInt((ratingValue-fullStarCnt)*100);
		
		if(ratingValue !== "0.0"){
			frontModel.ratings = ratingValue;
		}

		for(var j=0; j<fullStarCnt;j++){
			item+='<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 100%;"></span></span>';
		}
		if(fullStarCnt < 5 && fullStarCnt > 0){
			item+='<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: ' + cutStarWidthStyleNum + '%;"></span></span>';
			for(var k=4;k>fullStarCnt;k--){
				item+='<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>';
			}
		} else if ( fullStarCnt === 0 ){
			for(var empty_idx=0;empty_idx<5;empty_idx++){
				item+='<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>';
			}
		}
		frontModel.ratingHtml = item;
		frontModel.ratingsText = Granite.I18n.get("{0} out of {1} Stars",["<span>"+frontModel.ratings+"</span>","5"],siteCode);

		if(frontModel.ratings!=null && frontModel.ratings!=''){
			var ratingEmptyCls = "";
			if(frontModel.ratings == '0'){
				ratingEmptyCls = ' rating--empty';
			}
			var reviewUrl = '/'+siteCode+'/common/review/'+frontModel.modelCode+'/';
			if(frontModel.reviewUrl!=null && frontModel.reviewUrl!=''){
				reviewUrl = frontModel.reviewUrl;
			}
			
			ratingHtml +=
				`<!--/* rating       */-->
            	<!-- /*  Empty: .rating--empty  */ -->
            	<a href="${reviewUrl}" class="lineup-card__rating-link" ${taggingAttr}>
            	<span class="rating rating--dense${ratingEmptyCls}">
            		<span class="rating__inner">
            			<span class="rating__star-list">
            				${frontModel.ratingHtml}
                    	</span>
                   		<strong class="rating__point"><span class="hidden">Product Ratings : </span><span>${frontModel.ratings}</span></strong>
                	</span>
              	</span>
              	</a>`;
		}
		
		
		return ratingHtml;
	}
	
	function buildCta(product){
		const frontModel = product.modelList[product.frontModelIdx];
		const isSimplePD = product.simplePdYN === "Y" ? true : false;
		
		let buyingPDUrl = frontModel.originPdpUrl;
		let modelName = frontModel.modelName;
		let modelCode = frontModel.modelCode;
		if(isSimplePD){
			buyingPDUrl = frontModel.originPdpUrl + "buy/";
		}
		
		let ctaHtml = "";
		
		ctaHtml += `<a class="cta cta--outlined cta--black cta--dense" href="${buyingPDUrl}" aria-label="Link Title" an-ca="product click" an-ac="recommended product" an-la="learn more click" an-tr="pdd24_product card case-product detail-learn more click-product_click4"
						data-modelname="${modelName}" data-modelcode="${modelCode}" data-requested="${requestId}">
						${Granite.I18n.get("Learn more")}
					</a>`
		
		return ctaHtml;
	}
	
	function getRecommendedProductSwiperWrapperHtml(swiperWrapperHtml){
		var productRecommendationInnerHtml = "";
		var productRecommendationCardHtml = "";
		
		productRecommendationInnerHtml += `<div class="pdd24-product-recommendation__inner">`;
		var productRecommendationTitle = `<div class="pdd24-product-recommendation__title">${Granite.I18n.get("Looking for alternatives?")}</div>`;
		
		productRecommendationCardHtml += `<div class="pdd24-product-recommendation__swiper-area">
											<div class="lineup-card">
												<div class="lineup-card__swiper">
													<div class="lineup-card__data-swiper swiper-container basic-swiper" data-swiper-option='{
										                "slidesPerView":2,
										                "breakpoints": {
										                  "768": {
										                    "slidesPerView":3
										                  }
										                },
										                "keepWrapper":true,
										                "pagination":true,
										                "componentEl":".pdd24-product-recommendation__swiper-area",
										                "followFinger":true,
										                "watchOverflow":true,
										                "offTxtAccesibility":"true"
										              }'>
														<div class="swiper-wrapper" role="list">
															${swiperWrapperHtml}
														</div><!--/* .swiper-wrapper End */-->
													</div><!--/* .lineup-card__data-swiper End */-->
													<div class="lineup-card__button-box">
														<button type="button" class="lineup-card__data-swiper-prev swiper-button-prev"
															an-ca="indication" an-ac="carousel" an-la="carousel:arrow:left" an-tr="pdd24_product card case-product detail-arrow-indication">
															<span class="hidden">Previous</span>
															<svg class="icon" focusable="false" aria-hidden="true">
								                    			<use xlink:href="#previous-bold" href="#previous-bold"></use>
								                  			</svg>
														</button>
														<button type="button" class="lineup-card__data-swiper-next swiper-button-next"
															an-ca="indication" an-ac="carousel" an-la="carousel:arrow:right" an-tr="pdd24_product card case-product detail-arrow-indication">
															<span class="hidden">Next</span>
															<svg class="icon" focusable="false" aria-hidden="true">
																<use xlink:href="#next-bold" href="#next-bold"></use>
															</svg>
														</button>
													</div>
													<div class="indicator dot-indicator">
														<div class="indicator-wrap">
															<div class="indicator__list-wrap">
																<div class="indicator__list" role="list">
																	<div class="div-for-accessibility" role="listitem">
																		<!--/* (22.07.05) :  role="tab" (.indicator__item)   role="tabpanel"  id   aria-controls="{ tabpanel  id}"   */-->
																		<button class="indicator__item">
																			<span class="indicator__dot-wrap">
																				<span class="indicator__dot">
									icator__dot-inner"></span>
																				</span> <!--/* (21/05/06 ) dialog  indicator text      element  text  */-->
																				<span class="hidden">Indicator 1</span>
																			</span>
																		</button>
																	</div>
																</div>
														</div>
													</div>
												</div><!--/* .lineup-card__swiper End */-->
											</div><!--/* .lineup-card End */-->
										</div><!--/* .pdd24-product-recommendation__swiper-area */-->`;
		
		
		
		productRecommendationInnerHtmonInnerHtmtml;
		
		return productRecommendationInnerHtml;
	}

	var isNotNull = function(_str){
		return !fnIsNull(_str);
	};
	
	productRecommendationPD = (function(){
		return {
			getSearchProductCardForBDCApi : getSearchProductCardForBDCApi
		}
	})();
	
})(window.jQuery);
/* eslint-disable */
/*! Copyright 2019, Akamai Technologies, Inc. All Rights Reserved. akamai-viewer-0.7.1 */
!function(a){var b=Date.now||function(){return+new Date},c={},d=1;a.core?core.effect||(core.effect={}):a.core={effect:{}},core.effect.Animate={requestAnimationFrame:function(){var b=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame,c=!!b;if(b&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(b.toString())&&(c=!1),c)return function(a,c){b(a,c)};var d={},e=0,f=1,g=nul c Date,b=d;d={},e=0;for(var c in b)b.hasOwnProperty(c)&&(b[c](a),h=a);a-h>2500&&(clearInterval(g),g=null)},1e3/60)),c}}(),stop:function(a){var b=null!=c[a];return b&&(c[a]=null),b},isRunning:function(a){return null!=c[a]},start:function(a,e,f,g,h,i){var j=b(),k=j,l=0,m=0,n=d++;if(i||(i=document.body),n%20==0){var o={};for(var p in c)o[p]=!0;c=o}var q=function(d){var o=!0!==d,p=b();if(!c[n]||e&&!e(n))return c[n]=null,void(f&&f(60-m/((p-j)/1e3),n,!1));if(o)for(var r=Math.round((p-k)/(1e3/60))-1,s=0;s<Math.min(r,4);s++)q(!0),m++;g&&(l=(p-j)/g)>1&&(l=1);var t=h?h(l):l;!1!==a(t,p,o)&&1!==l||!o?o&&(k=p,core.effect.Animate.requestAnimationFrame(q,i)):(c[n]=null,f&&f(60-m/((p-j)/1e3),n,1===l||null==g))};return c[n]=!0,core.effect.Animate.requestAnimationFrame(q,i),n}}}(this);var Scroller;!function(){Scroller=function(a,b){this.__callback=a,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3};for(var c in b)this.options[c]=b[c]};var a(a/=.5)<1?.5*Math.pow(g:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeigt:null,__zoomcheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(a,b,c,d){var e=this;a&&(e.__clientWidth=a),b&&(e.__clientHeight=b),c&&(e.__contentWidth=c),d&&(e.__contentHeight=d),e.__computeScrollMax(),e.scrollTo(e.__scrollLeft,e.__scrollTop,!0)},setPosition:function(a,b){var c=this;c.__clientLeft=a||0,c.__clientTop=b||0},setSnapSize:function(a,b){var c=this;c.__snapWidth=a,c.__snapHeight=b},activatePullToRefresh:function(a,b,c,d){var e=this;e.__refreshHeight=a,e.__refreshActivate=b,e.__refreshDeactivate=c,e.__refreshStart=d},finishPullToRefresh:function(){var a=this;a.__refreshActive=!1,a.__refreshDeactivate&&a.__refreshDeactivate(),a.scrollTo(a.__scrollLeft,a.__scrollTop,!0)},getValues:function(){var a=this;return{left:a.__scrollLeft,top:a.__scrollTop,zoom:a.__zoomLevel}},getScrollMax:function(){var a=this;return{left:a.__maxScrollLeft,top:a.__maxScrollTop}},zoomTo:function(a,b,c,d){var e=this;if(!e.options.zooming)throw new Error("Zooming is not enabled!");e.__isDecelerating&&(core.effect.Animate.stop(e.__isDecelerating),e.__isDecelerating=!1);var f=e.__zoomLevel;null==c&&(c=e.__clientWidth/crollTop)*a/h(g,h,a,b)},zoomBy:function(a,b,c,d){var e=this;e.zoomTo(e.__zoomLevel*a,b,c,d)},scrollTo:function(a,b,c,d){var e=this;if(e.__isDecelerating&&(core.effect.Animate.stop(e.__isDecelerating),e.__isDecelerating=!1),null!=d&&d!==e.__zoomLevel){if(!e.options.zooming)throw new Error("Zooming is not enabled!");a*=d,b*=d,e.__computeScrollMax(d)}else d=e.__zoomLevel;e.options.scrollingX?e.options.paging?a=Math.round(a/e.__clientWidth)*e.__clientWidth:e.options.snapping&&(a=Math.round(a/e.__snapWidth)*e.__snapWidth):a=e.__scrollLeft,e.options.scrollingY?e.options.paging?b=Math.round(b/e.__clientHeight)*e.__clientHeight:e.options.snapping&&(b=Math.round(b/e.__snapHeight)*e.__snapHeight):b=e.__scrollTop,a=Math.max(Math.min(e.__maxScrollLeft,a),0),b=Math.max(Math.min(e.__maxScrollTop,b),0),a===e.__scrollLeft&&b===e.__scrollTop&&(c=!1),e.__publish(a,b,d,c)},scrollBy:function(a,b,c){var d=this,e=d.__isAnimating?d.__scheduledLeft:d.__scrollLeft,f=d.__isAnimating?d.__scheduledTop:d.__scrollTop;d.scrollTo(e+(a||0),f+(b||0),c)},doMouseZoom:function(a,b,c,d){var e=this,f=a>0?.97:1.03;return e.zoomTo(e.__zoomLevel*f,!1,c-e.__clientLeft,d-e.__clientTop)},doTouchStart:function(a,b){if(null==a.length)throw new Error("Invalid touch list: "+a);if(b instanceof Date&&(b=b.valueOf()),"number"!=typeof b)throw new Error("Invalid timestamp value: "+b);var c=this;c.__isDecelerating&&(core.effect.Animate.stop(c.__isDecelerating),c.__isDecelerating=!1),c.__isAnimating&&(core.effect.Animate.stop(c.__isAnimating),c.__isAnimating=!1);var d,e,f=1===a.length;f?(d=a[0].pageX,e=a[0].pageY):(d=Math.abs(a[0].pageX+a[1].pageX)/2,e=Math.abs(a[0].pageY+a[1].pageY)/2),c.__initialTouchLeft=d,c.__initialTouchTop=e,c.__zoomLevelStart=c.__zoomLevel,c.__lastTouchLeft=d,c.__lastTouchTop=e,c.__lastTouchMove=b,c.__lastScale=1,c.__enableScrollX=!f&&c.options.scrollingX,c.__enableScrollY=!f&&c.options.scrollingY,c.__isTracking=!0,c.__isDragging=!f,c.__isSingleTouch=f,c.__positions=[]},doTouchMove:function(a,b,c){if(null==a.length)throw new Error("Invalid touch list: "+a);if(b instanceof Date&&(b=b.valueOf()),"number"!=typeof b)throw new Error("Invalid timestamp value: "+b);var d=this;if(d.__isTracking){var e,f;2===a.length?(e=Math.abs(a[0].pageX+a[1].pageX)/2,f=Math.abs(a[0].pageY+a[1].pageY)/2):(e=a[0].pageX,f=a[0].pageY);var g=d.__positions;if(d.__isDragging){var h=e-d.__lastTouchLeft,i=f-d.__lastTouchTop,j=d.__scrollLeft,k=d.__scrollTop,l=d.__zoomLevel;if(null!=c&&d.options.zooming){var m=l;if(l=l/d.__lastScale*c,l=Math.max(Math.min(l,d.options.maxZoom),d.options.minZoom),m!==l){var n=e-d.__clientLeft,o=f-d.__clientTop;j=(n+j)*l/m-n,k=(o+k)*l/m-o,d.__computeScrollMax(l)}}if(d.__enableScrollX){j-=h;var p=d.__maxScrollLeft;(j>p||j<0)&&(d.options.bouncing?j+=h/2:j=j>p?p:0)}if(d.__enableScrollY){k-=i;var q=d.__maxScrollTop;(k>q||k<0)&&(d.options.bouncing?(k+=i/2,d.__enableScrollX||null==d.__refreshHeight||(!d.__refreshActive&&k<=-d.__refreshHeight?(d.__refreshActive=!0,d.__refreshActivate&&d.__refreshActivate()):d.__refreshActive&&k>-d.__refreshHeight&&(d.__refreshActive=!1,d.__refreshDeactivate&&d.__refreshDeactivate()))):k=k>q?q:0)}g.length>60&&g.splice(0,30),g.push(j,k,b),d.__publish(j,k,l)}else{var r=d.options.locking?3:0,s=Math.abs(e-d.__initialTouchLeft),t=Math.abs(f-d.__initialTouchTop);d.__enableScrollX=d.options.scrollingX&&s>=r,d.__enableScrollY=d.options.scrollingY&&t>=r,g.push(d.__scrollLeft,d.__scrollTop,b),d.__isDragging=(d.__enableScrollX||d.__enableScrollY)&&(s>=5||t>=5)}d.__lastTouchLeft=e,d.__lastTouchTop=f,d.__lastTouchMove=b,d.__lastScale=c}},doTouchEnd:function(a){if(a instanceof Date&&(a=a.valueOf()),"number"!=typeof a)throw new Error("Invalid timestamp value: "+a);var b=this;if(b.__isTracking){if(b.__isTracking=!1,b.__isDragging&&(b.__isDragging=!1,b.__isSingleTouch&&b.options.animating&&a-b.__lastTouchMove<=100)){for(var c=b.__positiastTouchMove-100;f-=3)e=f;if(e!==d){var g=c[d]-c[e],h=b.__scrollLeft-c[e-2],i=b.__scrollTop-c[e-1];b.__decelerationVelocityX=h/g*(1e3/60),b.__decelerationVelocityY=i/g*(1e3/60);var j=b.options.paging||b.options.snapping?4:1;(Math.abs(b.__decelerationVelocityX)>j||Math.abs(b.__decelerationVelocityY)>j)&&(b.__refreshActive||b.__startDeceleration(a))}}b.__isDecelerating||(b.__refreshActive.__refreshActive&&(b.__refreshActive=!1,b.__refreshDeactivate&&b.__refreshDeactivate()))),b.__positions.length=0}},__publish:function(c,d,e,f){var g=this,h=g.__isAnimating;if(h&&(core.effect.Animate.stop(h),g.__isAnimating=!1),f&&g.options.animating){g.__scheduledLeft=c,g.__scheduledTop=d,g.__scheduledZoom=e;var i=g.__scrollLeft,j=g.__scrollTop,k=g.__zoomLevel,l=c-i,m=d-j,n=e-k,o=function(a,b,c){c&&(g.__scrollLeft=i+l*a,g.__scrollTop=j+m*a,g.__zoomLevel=k+n*a,g.__callback&&g.__callback(g.__scrollLeft,g.__scrollTop,g.__zoomLevel))},p=function(a){return g.__isAnimating__isAnimating=!1),g.options.zooming&&g.__computeScrollMax()};g.__isAnimating=core.effect.Animate.start(o,p,q,g.options.animationDuration,h?a:b)}else g.__scheduledLeft=g.__scrollLeft=c,g.__scheduledTop=g.__scrollTop=d,g.__scheduledZoom=g.__zoomLevel=e,g.__callback&&g.__callback(c,d,e),g.options.zooming&&g.__computeScrollMax()},__computeScrollMax:function(a){var b=this;null==a&&(a=b.__zoomLevel),b.__maxScrollLeft=Math.max(b.__contentWidth*a-b.__clientWidth,0),b.__maxScrollTop=Math.max(b.__contentHeight*a-b.__clientHeight,0)},__startDeceleration:function(a){var b=this;if(b.options.paging){var c=Math.max(Math.min(b.__scrollLeft,b.__maxScrollLeft),0),d=Math.max(Math.min(b.__scrollTop,b.__maxScrollTop),0),e=b.__clientWidth,f=b.__clientHeight;b.__minDecelerationScrollLeft=Math.floor(c/e)*e,b.__minDecelerationScrollTop=Math.floor(d/f)*f,b.__maxDecelerationScrollLeft=Math.ceil(c/e)*e,b.__maxDecelerationScrollTop=Math.ceil(d/f)*f}else b.__minDecelerationScrollLeft=0,b.__minDecelerationScrollTop=0,b.__maxDecelerationScrollLeft=b.__maxScrollLeft,b.__maxDecelerationScrollTop=b.__maxScrollTop;var g=function(a,c,d){b.__stepThroughDeceleration(d)},h=b.options.snapping?4:.1,i=function(){return Math.abs(b.__decelerationVelocityX)>=h||Math.abs(b.__decelerationVelocityY)>=h},j=function(a,c,d){b.__isDecelerating=!1,b.scrollTo(b.__scrollLeft,b.__scrollTop,b.options.snapping)};b.__isDecelerating=core.effecelerationVg"===e?c?a(c).find(b):(d=h.querySelectorAll(b),new i(dNodeList&&b instanceof g.NodeList?new i(b,b):b.constructor===Array?new i(var a=0,a.shoestringData.evenstring=i,a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.merge=function(a,b){var c,d,e;for(c];return a=d.url)&(f+="&"),URICompsetRequesttHeader((e in d.heasetRequestHeader(4===g.readyState){var a=(g.responseText||"").replace(/^\s+|\s+$/g,"");if(0===g.status.toString().indexOf("0"))return d.cancel(a,g.status,g);if(g.status.toString().match(/^(4|5)/)&&RegExp.$1)return d.efunction(),a.post=functionl(a[c],c,a[c]);c++);return a},a.inAr.length;)tListener("d.each(functthis.shoestringData||(this.shoestringData={}),this.shoestringData[a]=b}):this[0]&&thiringData={}}s.className&&tnction(){c.n"string"!=tyd=function(b){return"string"!=typeof unthis.childrch(funct c.push(thisa.cssExceph=c(a,d[f][h;i<j;i++on b(a){retur[d].length;g<h;g++)a.style[c[d][g]]=e}}(),a.fn.css=function(b,c){if(n.filter=fd.concat(c[a])}),a(d)},a.fn.first=function(){return this.eq(0)},a.fn.get=function(a){if(void 0===a){for(var b=[],c=0;c<this.length;c++)b.push(this[c]);return b}return t;return von(this,"hvar b="";if(;else b=a.ous.each(functin d=this,void)},a.fn.insertB)})},a.fn.d.nodeType){barentNode);-1===a.inArray(this,d)&&c.push(this)}),a(c)},a.fn.offset=function(){return{top:this[0].offsetTop,left:this[0].offsetLentNode)&&11!==brn this.each(func0,d=b.lengthld):this.appendCrev=function(){vaadOnly",tabindex:"tabIndex"},a.fn.prop=function(b,c){if(this[0])return b=a.propFix[b]||b,void 0!==c?this.each(function(){this[b]=c}):this[0][b]},a.fn.removeAttr=function(a){return this.each(function(){tthis.className(b){va.parentNode)if(1=Node(!0):putTypeTeste=function(){vatest(c)||(fn.wrapInner=function(b){returreturn!1};var h=a.preventDefauubble=!0},f=e.apply(amespace,a._a(c.length)for(var a,d,g,h=0,i=c.length;h<i;h++)a=c[h].split("."),d=af.call(this)})},a.fn.off=a.fn.unbind,a.fn.one=function(b,c){var d=b.split(" ");return this.each(function(){for(var b,e={},f=a(this),g=0,h=d.length;g<h;g++)b=d[g],e[b]=function(b){var d=a(this);for(var f in e)d.unbind)})},a.fn.triggeStartDelay=(this.options.autoplay||{}).delay||parseInt(this.$initial.attr("data-auto-rotate-delay"),10)||e.autoRotateStartDel,b(a).bind("resize",function(){c))),this.options.controls&s),this.autoRotateStartDay")),this.options.)).append(this.coa){var b=this.options.cons.autoRotate();break;case=function(){var a=this.$current,b=a[0],c=b.width,d=b.height,e=this.element.clientWidth,f=e/c*d;return!!(c&&d&&b.complete)&&((this.canvas.width!==e||this.canvas.height!==f||e&&f)&&(this.canvas.width=e,this.canvas.height=f),this.canvasCtx.drawImage(b,0,0,e,f),!0)},e.prototype.createImages=function(){var a,c,d;if(this.$initial.length<1)throw new Error("At least one image required$initial.length){.attr("data-src-templatlement.append(d),this.$rende"),this.$current=this.$imagoaded(a,b.target,bthis.autoIntervalutostartTimeout),this.$element.removeClass("spinning"),this.autoInterval=void 0,this.$elementclosest(".tau-conttouchend",this.release.binthis.cursorGrab();var e=this.$element[0].clientWidth/this.frames;this.rotateThreshold=e/(this.options.sensitivity||1),d=this.getPoint(a),this.downX=d.x,this.downY=d.y,this.downIndex=this.index,c.bind("mousemove",this.mouseMoveBinding),c.bind("touchmove",this.touchMoveBinding)}},e.prototype.slow=function(){if(!this.path.isSufficient())return void this.clearSlowInterval();this.rotate({x:this.path.last().x+this.velocity,y:this.path.last().y}),this.velocity>0?(this.velocity=this.velocity-this.decelVal(),this.velocity<=0&&this.clearSlowInterval()):(this.velocity=this.velocity+this.decelVal(),this.velocity>=0&&this.clearSlowInterval())},e.prototype.decell=void 0},e.prototype.deelocity(this.decelTe?this.$elemenownX,c=a.y-th"false"!==a&&(/^[0-9]+$/.test(a)?parseInt(a,10):/^[0-9]+a,function(a,c,d){return a.push(b(c,d)),a},[])},d.reduce,"'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"}}("uow:exports,this.jQuery),function(a,b){var c=function(){r(a,b){toss.tossing(a,!1);var d,e,f=0,g=a.scrollLeft,h=a.scrollTop,i={top:"+0",left:"+0",duration:,i.top,i.duration),c(m);a.scrollLeft=d,a.scrollTop=e,i.finished&&i.finished(),toss.tossing(a,!1)}else i.finished&&i.finished()};return c(m),{top:e,left:d,duration:i.duration,easing:i.easing}};var d={};toss.tossrguments,m=!0,n="scroll-snap-type",o=a.CSS&&a.CSS.supports&&(a.CSS.supports(n,"mandatory")||a.CSS.supports("-webkit-"+n,"mandatory")||a.CSS.supports("-ms-"+n,"mandatory"));return scrollLeft,b=D.width(),c=E[1]?E[1].offsetLeft:f(E.eq(0)),d=Math.round(a/c)*c,e=b-B.width();d>e&&(d=e),a!==d&&(o?(h(B[0],d),h(B[0],d,"after")):i(B[0],d)),O=!1}function n(){var a=B[0].scrollLeft,b=E.length,c=D.width();void 0===M&&(M=Math.round(a/c*b)),N&&clearTimeout(N),N=setTimeout(function(){j(),i(B[0],E[M].offsetLeft,!0),M=N=void 0},50)}function p(a){var b=B[0].scrollLeft,d=D.width(),e=f(B),g=d-e-5;return a?b>=g?(z.addClass(c+"-looping"),s()):q():0===b?(z.addClass(c+"-looping"),t()):r()}function q(){i(B[0],B[0].scrollLeft+D.width()/F,!1,function(){B.trigger(c+".after-next")})}function r(){i(B[0],B[0].scrollLeft-D.width()/F,!1,function(){B.trigger(c+".after-prev")})}function s(){i(B[0],0)}function t(){i(B[0],D.width()-B.width())}function u(b,c,d){void 0!==a.toss?a.toss(b,{ly=this,z=b(y),A=z.is("[dking");if("string"!=typeof d){var J=G.find("."+c+"_nav_inner");if(J.length||(J=b('<div class="'+c+'_nav_ndTo(G)),B.atnapper_nextprev"><li class="snappeclass="snapper_nextsnapper_nextprev_item"><a href="#next" class="snapper_nextprev_next">Next</a></li></ul>'),L=b(".snapper_nextprev_contain",y);d("click",function(c){clearTimeout(x);var d=b(this).attr("href");if(b(this).is(".snapper_nextprev_next"))return c.preventDefault(),p(!0);if(b(this).is(".snapper_nextprev_prev"))return c.preventDefault(),p(!1);if(0===d.indexOf("#")&&d.length>1){c.preventDefault();var e=b(d,y);e.length&&(i(B[0],e[0].offsetLeft),I&&"replaceState"in a.history&&a.history.replaceState({},document.title,d))}}),b(this).bind("keydown",function(a){37!==a.keyCode&&38!==dClass(O),v.data("lockedZoom",lockedZoom=!0),K.attr("tabindex","0"),K[0].focus()}}function o(){return L[0].offsetWidth*f.magnification}function p(){if(v.data("zoomed")){if(f.disabled)return!1;"inline"===f.placement&&J.add(L).css({width:L[0].offsetWidth+"px",height:parseFloat(getComputedStyle(L[0]).height)+"px"}),M.addClass(H),b(C).css("width",o()+"px"),b(w).trigger.css({width:"",height:""}),b(C).css("width",""),b(w).trigger(c+".after-zoom-out")}function q(){function a(){f.placement=d,h(),b(w).unbind(c+".after-zoom-out",a)}var d=f.placement;"inline"!==d&&(b(w).bind(c+".after-zoom-out",a),f.placement="inline",h())}function r(){if(f.disabled&&!v.data("zoomed"))return!1;k(),l(function(){n(),p(),m()})}function s(a){"touchstart"===a.type&&(S=!0),S&&"mouseenter"===a.type||"mouseenter"===a.type&&!S&&!T||v.data("lockedZoom")||R||(R=!0,J.addClass(I),Q=setTimeout(function(){J.removeClass(I),k(),l(function(){p(),P=!0,u(a)})},f.delay))}function t(a){J.removeClass(I),clearTimeout(Q),P=!1,!1!==f.hoverZoomWithoutClick||S||(T=!1),S&&"mouseleave"===a.type&&(S=!1)}function u(a){if(P){if(S&&"mousemove"===a.type)return;var b=a.touches?a.touches[0]:a;a.preventDefault();var c=b.clientX-a.target.getBoundingClientRect().left,d=b.clientY-a.target.getBoundingClientRect().top;if(f.placement.match(/loupe",left:c+"px","margin-left":e,"margin-top":g})})}var h=a.target.offsetWidth,i=a.target.offsetHeight,j=C.offsetWidth,k=C.offsetHeight,l=K[0].offsetWidth,m=K[0].offsetHeight;K[0].scrollLeft=c/h*(j-l),K[0].schis).find("a")equires an anchor ele source");var B=v.find("img")H=(A[0].innerText,c+"-zoomed"),I=c+"-delay",J=b(C).closest(".enlarge_contain"),K=J,L=b(C).closearent",M);var  the image marked with the cla,T=f.hoverZoomWiter(L),function(){J.append('<i class="enlarge_loader"><i></i></i>')}(),h(),i(),A.bind("keydown",function(a){13!==a.keyCode&&32!==a.keyCode||q(),32===a.keyCode&&(a.preventDefault(),b(this).trigger("click"))}).bind("click",function(a){a.preventDefault(),r()}),b(a).bind("resize",function(a){v.data("lockedZoom")&&r()}),b(a.document).bind("",function(a){R=!1,N&&!v.data("lockedZoom")&ages)+'"\n\t\t\t\tsrcset="'+c._srcset(a,b.images)+'"\n\t\t\t\tsizesions(c.defaultOptions,b);tle="'+a.alt+'">\n\t\t\t\t'+Akamai.Util.map(a.urls,function(a){return c._renderImg(a,d)}).join("\n")+"\n\t\t\t</div>\n\t\t")},c.defaultOptions={autoplay:{enabled:!1,delay:1e3},controls:{arrows:!1,play:!1,text:{left:"Rotate Left",right:"Rotate Right",play:"Spin Object"}},frames:72,images:Akamai.Image.defaultConfig,interval:3e3,reverse:!1,sensitivity:1,template:void 0},c&b()},c.prototype.getIndex=function(){return this._comp.index},Akamai.Advanceable.extend(c),c.prototype.next,c.prototype.previous,c.prototype.play=function(){this._comp.autoRotate()},c.prototype.pause=function(){this._comp.stopAutoRotate()},c.prototype.getElement=function:1},c.prototype.getState=function(){return this._comp.autoInterval?c.States.Playing:c.States.Paused},a.Akamai=a.Akamai||{},a.Akamai.Spin360=c}("undefined"==typeof exports?window:exports,this.jQuery),function(e MagnifierImpl")}a.prototype.updateOptions=function(a){throw new Error("magnifier updateOptions not implemented")},a.prototype.zoomIn=function(){throw new Error("magnifier zoomIn not implemented")},a.prototype.zoomOut=function(){throw new Error("magnifier zoomOut not implemented")},a.prototype.isMagnified=function(){throw new Error("magnifier isMagnified not implemented")},a.prototype.toggleZoom=function(){throw new Error("magnifier toggleZoom not implemented")},a.prototype.render=function(a,b,c,d,e){throw new Error("magnifier render not implemented")};var b="undefined"==typeof exports?window:exports;b.Akamai=b.Akamai||{},b.Akamai.MagnifierImpl=a}(),function(){function a(a,b){this._$el=$(a),this._$el.enlarge(b)}a.prototype=Object.create(Akamai.MagnifierImpl.prototype),a.prototype.constructor=a,a.prototype.updateOptions=function(a){this._$el.enlarge("updateOptions",a)},a.prototype.zoomIn=function(){this._$el.enlarge("in")},a.prototype.zoomOut=function(){this._$el.enlarge("out")},a.prototype.isMagnified=function(){return this._$el.enlarge("isZoomed")},a.prototype.toggleZoom=function(){this.isMagnified()?this.zoomOut():this.zoomIn()},a.render=function(a,b,c,d,e){return"\n\t\t\t<div "+b+'>\n\t\t\t\t<div class="enlarge_contain">\n\t\t\t\t\t<img src="'+c+'"\n\t\t\t\t\t\tsrcset="'+e+'"\n\t\t\t\t\t\tsizes="'+a.image.sizes+'">\n\t\t\t\t</div>\n\t\t\t\t<a href="'+d+'"\n\t\t\t\t\tclass="enlarge_btn"\n\t\t\t\t\ttitle="'+a+a.buttonText+"\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t"};var b="undefined"==typeof exports?window:exports;b.Akamai=b.Akamai||{},b.Akamai.MagnifierImplEnlarge=a}(),function(){function a(a,b){var c=this;c.element=a,c.handler=b,this.reset()}function b(a,b){this._$el=$(a),this._options=b,this._container=this._$el.get(0),this._content=this._$el.children().get(0),this._imgCast=$(this._content).find("div").get(0),this._zoomInBtn=this._$el.find("a.scroller-zoom-in").get(0),this._zoomOutBtn=this._$el.find("a.scroller-zoom-out").get(0),this._magnification=1;var c=this;this.scroller=new Scroller(this._renderer(),{zooming:b.enabled,minZoom:1,maxZoom:b.magnification,animationDuration:b.animationDuration});var d=this._container.getBoundingClientRect();this.scroller.setPositiontTop),this._installEventHandlers(),this._updateButtonStates(),setTimeout(function(){c._onResize()})}a.prototype.onDown=function(a){a.target==this.element&&(this.isDown?this.reset():(this.down.x=a.clientX,this.down.y=a.clientY,this.down.timestamp=newe=function(){this.isMovclientY,this.up.timestamp=new Date,!this.isMoved&&this.down.x===this.up.x&&this.down.y===this.up.y&&this.up.timestamp.getTime()-this.down.timestamp.getTime()<=500&&this.handler()),this.reset()},a.prototype.reset=function(a,b){this.down={x:-1/0,y:-1/0,timestamp:new Date(0)},this.isDown=!1,this.isMoved=!1,this.up={x:1/0,y:1/0,timestamp:new Date}},b.prototype=Object.create(Akamai.MagnifierImpl.prototype),b.prototype.constructor=b,b.prototype.updateOptions=function(a){var b=this._container.getBoundingClientRect();this.scroller.setPosition(b.left+this._container.clientLeft,b.top+this._container.clientTop),this._onResize(),this._zoomBy(1/this._options.magnification,!1)},b.prototype.zoomIn=function(){this._zoomBy(this._options.incrementalZoomFactor)},b.prototype.cyclicZoom=function(){this._magnification>=this._options.magnification?this._zoomBy(1/this._options.magnification):this.zoomIn()},b.prototype.zoomOut=function(){this._zoomBy(1/this._options.incrementalZoomFactor)},b.prototype.isMagnified=function(){return this._magnification>1},b.prototype.toggleZoom=function(){throw new Error("zoom toggle behavior is undefined in scroller mode")},b.render=function(a,b,c,d,e){return"\n\t\t\t<div "+b+'>\n\t\t\t\t<div>\n\t\t\t\t\t<img src="'+c+'"\n\t\t\t\t\tsrcset="'+e+'"\n\t\t\t\t\tsizes="'+a.image.sizes+'">\n\t\t\t\t\t<div></div>\n\t\t\t\t</div>\n\t\t\t\t<a href="'+d+'"\n\t\t\t\t\tclass="scroller-zoom-in"\n\t\t\t\t\ttitle="'+a.zoomInBtnText+'">\n\t\t\t\t\t'+a.zoomInBtnText+'\n\t\t\t\t</a>\n\t\t\t\t<a href="'+d+'"\n\t\t\t\t\tclass="scroller-zoom-out"\n\t\t\t\t\ttitle="'+a.zoomOutBtnText+'">\n\t\t\t\t\t'+a.zoomOutBtnText+"\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t"},b.prototype._zoomBy=function(a,b){var c=this,a=Number(a);void 0===b&&(b=this._options.animateZoom),1===a||1===this._magnification&&a<1||this._magnification===this._options.magnification&&a>1||(this.scroller.zoomTo(this._magnification*a,this._options.animateZoom),setTimeout(function(){c._onZoom()},this._options.animationDuration))},b.prototype._onZoom=function(){var a=this._magnification;this._magnification=Number(this.scroller.getValues().zoom.toFixed(2)),this._updateButtonStates(),a>this._magnification?this._$el.trigger("scroller.after-zoom-out"):a<this._magnification&&this._$el.trigger("scroller.after-zoom-in")},b.prototype._renderer=function(){var a,b=document.documentElement.style,c=thiototype.toString.call(opera)?a="presto":"MozAppearance"in b?a="gecko":"WebkitAppearance"in b?a="webkit":"string"==typeof navigator.cpuClass&&(a="trident");var d={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[a],e=document.createElement("div"),f=d+"Perspective",g=d+"Transform";return void 0!==e.style[f]?function(a,b,d){c._content.style[g]="translate3d("+-a+"px,"+-b+"px,0) scale("+d+")"}:void 0!==e.style[g]?function(a,b,d){c._content.style[g]="translate("+-a+"px,"+-b+"px) scale("+d+")"}:function(a,b,d){c._content.style.marginLeft=a?-a/d+"px":"",c._content.style.marginTop=b?-b/d+"px":"",c._content.style.zoom=d||""}},b.prototype._onResize=function(){this.scroller.setDimensions(this._container.clientWidth,this._container.clientHeight,this._container.clientWidth,this._container.clientHeight)},b.prototype._installEventHandlers=function(){var b=this,c=new a(this._imgCast,function(){b.cyclicZoom()});window.addEventListener("resize",function(a){b._onResize(a)},!1),this._zoomInBtn.addEventListener("click",function(a){a.preventDefault(),b.zoomIn()},!1),this._zoomOutBtn.addEventListener("click",function(a){a.preventDefault(),b.zoomOut()},!1),"ontouchstart"in window?(b._container.addEventListener("touchstart",function(a){if(a.touches[0].target!=b._$el.find("a.scroller-zoom-in").get(0)&&a.touches[0].target!=b._$el.find("a.scroller-zoom-out").get(0)&&!(a.touches[0]&&a.touches[0].target&&a.touches[0].target.tagName.match(/input|textarea|select/i))){b.scroller.doTouchStart(a.touches,a.timeStamp);for(var d=0;d<a.touches.length;d++)c.onDown(a.touches[d]);a.preventDefault()}},!1),document.addEventListener("touchmove",function(a){b.scroller.doTouchMove(a.touches,a.timeStamp,a.scale),c.onMove()},!1),document.addEventListener("touchend",function(a){b.scroller.doTouchEnd(a.timeStamp),b._onZoom();for(var d=0;d<a.changedTouches.length;d++)c.onUp(a.changedTouches[d])},!1),document.addEventListener("touchcancel",function(a){b.scroller.doTouchEnd(a.timeStamp),b._onZoom();for(var d=0;d<a.changedTouches.length;d++)c.onUp(a.changedTouches[d])},!1)):(b._container.addEventListener("mousedown",function(a){a.target.tagName.match(/input|textarea|select/i)||(b.scroller.doTouchStart([{pageX:a.pageX,pageY:a.pageY}],a.timeStamp),c.onDown(a))},!1),document.addEventListener("mousemove",function(a){c.isDown&&(b.scroller.doTouchMove([{pageX:a.pageX,pageY:a.pageY}],a.timeStamp),c.onMove())},!1),document.addEventListener("mouseup",function(a){c.isDown&&(b.scroller.doTouchEnd(a.timeStamp),c.onUp(a))},!1))},b.prototype._updateButtonStates=function(){1===this._magnification?($(this._$el).addClass("scroller-zoom-out-max"),$(this._$el).removeClass("scroller-zoom-in-max")):this._magnification===this._options.magnification?($(this._$el).addClass("scroller-zoom-in-max"),$(this._$el).removeClass("scroller-zoom-out-max")):($(this._$el).removeClass("scroller-zoom-in-max"),$(this._$el).removeClass("scroller-zoom-out-max"))};var c="undefined"==typeof exports?window:exports;c.Akamai=c.Akamai||{},c.Akamai.MagnifierImplScroller=b}(),function(a,b){var c=Akamai.Util.component("Magnifier",function(a,b){this._options.disabled=!this._options.enabled,
this._options.mode===c.MODE_ANIMATED_ZOOM?this._impl=new Akamai.MagnifierImplScroller(a,b):this._impl=new Akamai.MagnifierImplEnlarge(a,b)});c.prototype._updateOptions=function(a){a||(this._options=this._originalOptions),this._options=Akamai.Util.extend(!0,this._options,a),this._options.disabled=!this._options.enablc.defaultOptions,thupdateOptions(this._options)},c._componentEventMapping={"enlarge.after-zoom-in":"in","enlarge.after-zoom-out":"out","scroller.after-zoom-in":"in","scroller.after-zoom-out":"out"},c.MODE_HOVER_ZOOM="hoverzoom",c.MODE_ANIMATED_ZOOM="animd:!0,magnification:3,image:Akamai.Image.defaultConfig,delay:300,buttonText:"Toggle Image Magnification",flyout:{width:200,height:200},hoverZoomWithoutClick:!0,plaincrementalZoomFactor:3,animateZoom:!0,animationDuration:250,zoomInBtnText:"Zoom In",zoomOutBtnText:"Zoom Out"},Akamai.Sourceable.extendStatic(c),c.render=function(a,b){var d=Akamai.Util.options(c.defaultOptions,b),e=c._dataAttr,f=c._fallbackSrc(a.url,d.image),g=c._largestSrc(a.url,d.image),h=c._srcset(a.url,d.image),i=d.image.sizes;return(d.mode===c.MODE_ANIMATED_ZOOM?Akamai.MagnifierImplScroller:Akamai.MagnifierImplEnlarge).render(d,e,f,g,h,i)},c.prototype.in=function(){this._impl.zoomIn()},c.prototype.out=function(){this._impl.zoomOut()},c.prototype.isMagnified=function(){return this._impl.isMagnified()},c.prototype.toggle=function(){this._impl.toggleZoom()},a.Akamai=a.Akamai||{},a.Akamai.Magnifier=c}("undefined"==typeof exports?window:exports,this.jQuery),function(a,b){var c=Akamai.Util.component("VideoImpl",function(a,b){throw new Error("Not allowed to instantiate VideoImpl")});c.render=function(a,b){throw new Error("VideoImpl.render not implemented")},a.Akamai=a.Akamai||{},a.Akamai.VideoImpl=c}("undefined"==,this.jQuery),function(a,b){var c=Akamai.Util.component("VideoImplPristine",function(a,b){});c.prototype=Object.create(Akamai.VideoImpl.prototype),c.prototype.constructor=c,c.render=function(a,b){var c=Akamai.Util.options(Akamai.Video.defaultOptions,b),d=a.url,e=a.poster||"",f=a.mime?'type="'+a.mime+'"':"",g=[c.loop?"loop":"",c.autoplay?"autoplay":"",c.controls?"controls":"",c.muted?"muted":"","playsinline"];return Akamai.Util.trim("\n\t\t\t<div "+Akamai.Video._dataAttr+">\n\t\t\t\t<video "+g.join(" ")+' poster="'+e+'" preload="metadata">\n\t\t\t\t\t<source src="'+d+'" '+f+" />\n\t\t\t\t</video>\n\t\t\t</div>\n\t\t")},a.Akamai=a.Akamai||{},a.Akamai.VideoImplPristine=c}("undefined"==typeof exports?window:exports,this.jQuery),function(a,b){var c=Akamai.Util.component("VideoImplIm",function(a,b){var d=Akamai.Util.options(Akamai.Video.defaultOptions,b);c._validateOptions(d)});c.prototype=Object.create(Akamai.VideoImpl.prototype),c.prototype.constructor=c,c._validateOptionamai.Video._dataAttr+">\n\t\t\t\t<video "+i.join(" ")+' poster="'+g+'" preload="metadata">\n\t\t\t\t\t<source src="'+f+j+"imformat=vp9&imwidth="+e+'" type="video/webm" />\n\t\t\t\t\t<source src="'+f+j+"iai=a.Akamai||{},a.Akamai.VideoImplIm=c}("undefined"==typeof exports?window:exports,this.jQuery),function(a,b){var c=Akamai.Util.component("Video",function(a,b){if(this._comp=this._$el.length&&void 0,this._$videoElement=this._$el.find("video"),this._videoElement=this._Element.play||!this._videoElement.pause)return this._unsupportedAPI=!0,void this._unsupported(.States.Playing),this._$el.bind("akamai-video-play",function(){this._setSt(this)).bind("aka={play:{to:"play",setor:"video"},seeked:{tototype._updateOptions=function._unsupportedAPI},c.prototype.play=function(){this._unsupported()||this._videoElement.play()},c.prototype.pause=function(){this._unsupported()||this.nd(this)))},a.Akamai=a.Akamai||{},a.Akamai.Video=c}("undefined"==typeof exports?window:exports,this.jQuery),function(a,b){var c=Akamai.Util.component("Carousel",functons.slideshow.autostart&&setTimeout(funr_pane").removeClass("no-scroll")}.bind(this)),this._$el.bind(this.constructor._stopSlideshowEvents.join(" "),this.stopSlideshow.bind(this))});c._stopSlideshowEvents=["akamai-magnifier-in","akamai-magnifier-out","akamai-spin360-goto","akamai-video-play","akamai-video-seek"],c.prototype._handleAutoplayables=function(){var a=function(a){return!!b(a.getElement()).closest("["+this.constructor.activeItemAttr+"]").length}.bind(this);this._videos.concat(this._spitate()==b.constructor.States.Playing?(b._carouse._options,"Carousel"),thin360,video:Aon(a,b){return"akamaspin360', or 'video'\n\t\t\t");return'\n\t\t\t<div class="snapper_item" id="'+c._uniqueItemId(a,b)+'">\n\t\t\t\t'+c.renderMapping[a.type].render(a,d[e])+"\n\t\t\t</div>\n\t\t"},c._renderThumbnailAnchor=function(a,b,d,e){var f="",g=a.alt||"";f="video"===a.type?a.poster||b.reduce(function),i=c._srcset(f,e.images),j=e.imag":'\n\t\tions.aspectratio,this),c=this._$el.find(".snapper_item");c.each(function(){var c,d=b(this),e=d.find("img, video").eq(0);e.bind("load loadedmetadata",loadBinding=function(){clearTimeout(c),AspectAttributes(d.find("canvas")):a._setAspectAttributes(e)}),c=setTimeout(loadBinding,5e3)}),c.eq(0).finb),e=[""+c._dataAttr,ata-snapper-deeplinking="false"',d.arrows?"data-snapper-nextprev":""];return c.counter++,Akamat\t\t'+Akamai.Util.map(a,f\t</div>\n\t\t\t\t</\t\t\t</div>\n\t\t")},c.prototype.getSpin360s=function(){return this._spins},c.prototype.getMagnifirototype._adjustWidth=function(){this._$fullscreen.css("width","auto !important");var a=this._$fullscreen.widtotype.exit=function(){this._useNandefined"==typeof exports?window:exports,this.jQuery),function(a,b){var c=Akamai.Util.component("Viewer",!0,function(a,b){this._updateSizesOptions(!0),this._onRetions(this._options),this._withData(function(b){b&&(this._checkJSONUrls(b),b=Akamai.Util.escapeJSONVals(b),this._options.items.dathis._options.carousel),this.),this._setBreakpoints(),this._ai.Util.extend(!0,this._optiori&&this._options.items.uri.leimit(b.items,c)||a(b.items)}"JSON data size exceeds ns."),!0))},c.prototype._setBreakpoints=function(a){var b=[];for(var cstener("resize",function()",d=window.matchMedia(c);dgetCurrentMinWidth=functionreakpoints,c=d._options.fullsc,{},b);return d<=a&&(e=Akamai.Util.extend(!0,e,c[d])),e},Akamai.Util.extend(!0,{},this._originalOptions)):d._originalOptions},c._extendCarouselOptions=function(a){var b=Akamai.Util.extend(!0,{},a.carousel||{});return Akamai.Util.extend(!0,b,{magnifier:a.magnifier,spin360:a.spin360,video:a.video,fullscreen:a.fullscreen})},c.prototype._updateOptions=fuc&&!this._urlHostnameMatch(a))throw new Error("The URL `"+a+"` does not match this ,c.protot00,renderAll:!1,tags:voidusel.defaultOptions,maai.Util.trim("\n\t\t\t<dn(" "):c._renderTag(.prototype.switchTag=function(a){if(-1==this.getTags().indexOf(a))return void Akamai.Util.log("tatr+'="'+a+'"]',e=this._$el.find(d);if(e.length)this._showViewer(e);else{var f=this._resolveBreakpointOptions(),g=c._extendCarouselOptions(f),h=b(this.constructor._renderTag(this._tagMapping[a],g,!0)),i=h.find("img"),j=i.length,k=0;h.css("display","none"),i.bind("load",function(){if(++k===j){i.unbind("load");var a=Akamai.Carousel.createMany(h[0],g);a.forEach(function(a){a.goto(a.getIndex())}),this._carousels=this._carousels.concat(a),this._showViewer(h,a)}}.bind(this)),this._$el.append(h)}},c.prototype._showViewer=function(a,b){this._$el.find("["+this.constructor._tagAttr+"]").css("display","none").removeClass("focused"),a.css("display","block").addClass("focused"),b&&b.map(function(a){a.refresh()}),this._fullscreen.addButton(),this._trigger("switch-tag")},c.prototype.getTags=function(){if(this._tags)return this._tags;var a=[];for(var b in this._tagMapping)this._tagMapping.hasOwnProperty(b)&&b!==c._firstRenderTag&&a.push(b);return this._tags=a},a.Akamai=a.Akamai||{},a.Akamai.Viewer=c}("undefined"==typeof exports?window:exports,this.jQuery),function(a,b){b.fn.akamaiViewer=function(a){this.each(function(b,c){new Akamai.Viewer(c,a)})}}("undefined"==typeof exports?window:exports,this.jQuery);

(() => {
  const $q = window.sg.common.$q;
  const utils = window.sg.common.utils;
  const libs = window.sg.common.libs;
  const addEventListener = utils.addEventListener;
  const removeAllEventListeners = utils.removeAllEventListeners;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const lazyLoad = window.sg.common.lazyLoad;
  const setMobileFocusLoop = utils.setMobileFocusLoop;
  const removeMobileFocusLoop = utils.removeMobileFocusLoop;
  const swiperManager = window.sg.common.swiperManager;
  const scrollbar = window.sg.common.scrollbar;

  let pdBuyingToolEls = {};
  const isBindingEvent = {};
  let focusEl = null;
  let activeList on inyingToolEls = {
      el,
      tradeInLearnMorePopupBtnEl: el.querySelector('[data-target-popup="tradeInLearnMorePopup"]'),
      hubbleCareinfoPopupBtnEl: el.querySelector('[data-target-popup="hubbleCareinfoPopup"]'),
      upgradeLearnMorePopupBtnEl: el.querySelector('[data-target-popup="upgradeLearnMorePopup"]'),
      manufacturerInfoPopupBtnEl: el.querySelector('[data-target-popup="manufacturerInfoPopup"]'),
      cancelReturnPolicyPopupBtnEl: el.querySelector('[data-target-popup="cancelReturnPolicyPopup"]'),
      warrantyPolicyPopupBtnEl: el.querySelector('[data-target-popup="warrantyPolicyPopup"]'),
      leasingLearnmorePopupBtnEl: el.querySelector('[data-target-popup="leasingLearnmorePopup"]'),
      deliveryPickupPopupBtnEl: el.querySelectorAll('.pd-delivery-pickup__button .cta, .pd-delivery-pickup__edit-button.cta'),
    };
  }

  function showPdPopup(target) {
    window.sg.components[target].showPopup();
  }

  funct
    bindPdTooltipEvent();
    bindAddOnProductEvent();
    bindGiftCardEvent();
    chipSelectEvent();
    bindComboOfferEvent();
  }

  function bindGiftCardEvent() {
    if (pdBuyingToolEls.el.querySelector('.pd-select-option--gift-card')) {
      [...pdBuyingToolEls.el.querySelectorAll('.pd-select-option--gift-card .pd-select-option__item input')].forEach((el, i) => {
        el.addEventListener('click', () => {
          if (i === (pdBuyingToolEls.el.querySelectorAll('.pd-select-option--gift-card .pd-select-option__item input').length - 1)) {
            pdBuyingToolEls.el.querySelector('.pd-select-option--gift-card .pd-select-option__input-wrap').classList.add('show');
          } else {
            pdBuyingToolEls.el.querySelector('.pd-select-option--gift-card .pd-select-option__input-wrap').classList.remove('show');
          }
        });
      });
    }

    if (pdBuyingToolEls.el.querySelector('.pd-select-option--personalized-message')) {
      pdBuyingToolEls.el.querySelector('.pd-select-option--personalized-message textarea').addEventListener('input', (e) => {
        checkByte(e.target);
      });
    }
  }

  function checkByte(el) {
    const maxByte = 390;
    const textVal = el.value;
    const textLen = textVal.length;
    let totalByte = 0;

    for (let i = 0; i < textLen; i++) {
      const eachChar = textVal.charAt(i);
      const uniChar = escape(eachChar);
      if (uniChar.length > 4) {
        totalByte += 2;
      } else {
        totalByte += 1;
      }
    }

    if (totalByte > maxByte) {
      el.value = personalizedMessage;
    } else {
      pdBuyingToolEls.el.querySelector('.pd-select-option--personalized-message .pd-select-option__input--char-count span:first-of-type').innerText = totalByte;
      personalizedMessage = el.value;
    }
  }

  function bindShowPdPopupEvent() {
    if (isBindingEvent.tradeInLearnMorePopupBtnEl) {
      removeAllEventListeners(pdBuyingToolEls.tradeInLearnMorePopupBtnEl, 'click');
      isBindingEvent.tradeInLearnMorePopupBtnEl = false;
    }

    if (isBindingEvent.hubbleCareinfoPopupBtnEl) {
      removeAllEventListeners(pdBuyingToolEls.hubbleCareinfoPopupBtnEl, 'click');
      isBindingEvent.hubbleCareinfoPopupBtnEl = false;
    }

    if (isBindingEvent.upgradeLearnMorePopupBtnEl) {
      removeAllEventListeners(pdBuyingToolEls.upgradeLearnMorePopupBtnEl, 'click');
      isBindingEvent.upgradeLearnMorePopupBtnEl = false;
    }

    if (isBindingEvent.manufacturerInfoPopupBtnEl) {
      removeAllEventListeners(pdBuyingToolEls.manufacturerInfoPopupBtnEl, 'click');
      isBindingEvent.manufacturerInfoPopupBtnEl = false;
    }

    if (isBindingEvent.cancelReturnPolicyPopupBtnEl) {
      removeAllEventListeners(pdBuyingToolEls.cancelReturnPolicyPopupBtnEl, 'click');
      isBindingEvent.cancelReturnPolicyPopupBtnEl = false;
    }

    if (isBindingEvent.warrantyPolicyPopupBtnEl) {
      removeAllEventListeners(pdBuyingToolEls.warrantyPolicyPopupBtnEl, 'click');
      isBindingEvent.warrantyPolicyPopupBtnEl = false;
    }

    if (isBindingEvent.leasingLearnmorePopupBtnEl) {
      removeAllEventListeners(pdBuyingToolEls.leasingLearnmorePopupBtnEl, 'click');
      isBindingEvent.leasingLearnmorePopupBtnEl = false;
    }

    setElements(document.querySelector('.pd-buying-tool'));

    if (pdBuyingToolEls.tradeInLearnMorePopupBtnEl) {
      addEventListener(pdBuyingToolEls.tradeInLearnMorePopupBtnEl, 'click', (e) => {
        showPdPopup(e.target.dataset.targetPopup);
      });

      isBindingEvent.tradeInLearnMorePopupBtnEl = true;
    }

    if (pdBuyingToolEls.hubbleCareinfoPopupBtnEl) {
      addEventListener(pdBuyingToolEls.hubbleCareinfoPopupBtnEl, 'click', (e) => {
        showPdPopup(e.target.dataset.targetPopup);
      });

      isBindingEvent.hubbleCareinfoPopupBtnEl = true;
    }


    if (pdBuyingToolEls.upgradeLearnMorePopupBtnEl) {
      addEventListen    showPdPopup(e.target.dataset.targetPopup);
      });

      isBindingEvent.upgradeLearnMorePopupBtnEl = true;
    }

    if (pdBuyingToolEls.manufacturerInfoPopupBtnEl) {
      addEventListener(pdBuyingToolEls.manufacturerInfoPopupBtnEl, 'click', (e) => {
        showPdPopup(e.target.dataset.targetPopup);
      });

      isBindingEvent.manufacturerInfoPopupBtnEl = true;
    }


    if (pdBuyingToolEls.cancelReturnPolicyPopupBtnEl) {
      addEventListener(pdBuyingToolEls.cancelReturnPolicyPopupBtnEl, 'click', (e) => {
        showPdPopup(e.target.dataset.targetPopup);
      });

      isBindingEvent.cancelReturnPolicyPopupBtnEl = true;
    }


    if (pdBuyingToolEls.warrantyPolicyPopupBtnEl) {
      addEventListener(pdBuyingToolEls.warrantyPolicyPopupBtnEl, 'click', (e) => {
        showPdPopup(e.target.dataset.targetPopup);
      });

      isBindingEvent.warrantyPolicyPopupBtnEl = true;
    }


    if (pdBuyingToolEls.leasingLearnmorePopupBtnEl) {
      addEventListener(pdBuyingToolEls.leasingLearnmorePopupBtnEl, 'click', (e) => {
        showPdPopup(e.target.dataset.targetPopup);
      });

      isBindingEvent.leasingLearnmorePopupBtnEl = true;
    }

    if (pdBuyingToolEls.deliveryPickupPopupBtnEl) {
      pdBuyingToolEls.deliveryPickupPopupBtnEl.forEach((el) => {
        addEventListener(el, 'click', (e) => {
          if ($q(e.currentTarget).closest('.pd-delivery-pickup__item').index() === 0) {
            openPopup(document.querySelector('.pdd23-edd-popup'), e.currentTarget);
          }
          e.preventDefault();
        });
      });
    }
  }

  function layerPopupResize() {
    const scrollWrapHeight = document.querySelector('.pdd23-edd-popup').querySelector('.scrollbar__wrap').clientHeight;
    const scrollInnerHeight = document.querySelector('.pdd23-edd-popup').querySelector('.scrollbar__contents').scrollHeight;

    if (scrollWrapHeight < scrollInnerHeight) {
      document.querySelector('.pdd23-edd-popup').querySelector('.layer-popup__inner').classList.add('is-overflow');
    } else {
      document.querySelector('.pdd23-edd-popup').querySelector('.layer-popup__inner').classList.remove('is-overflow');
    }
  }

  function chipSelectEvent() {
    [...pdBuyingToolEls.el.querySelectorAll('.pd-select-option__list--color-chip .pd-option-selector input')].forEach((el) => {
      el.addEventListener('change', () => {
        pdBuyingToolEls.el.querySelector('.pd-select-option__color-name span').innerText = el.closest('.pd-option-selector').querySelector('.pd-option-selector__label .hidden').innerText;
      });
    });
  }

  function bindPdTooltipEvent() {
    const $tooltipEle = document.querySelector('.pd-buying-tool .pd-select-option__tooltip');
    const $tooltipCtaEle = document.querySelector('.pd-buying-tool .pd-select-option__tooltip__cta');
    const $tooltipMsgEle = document.querySelector('.pd-buying-tool .pd-select-option__tooltip__message');
    const $tooltipMsgCloseEle = document.querySelector('.pd-buying-tool .pd-select-option__tooltip__close');

    const outsideClickListener = (e) => {
      if ((e.type === 'mouseleave' && !$tooltipEle.classList.contains('is-click')) ||
        (e.type === 'click' && !$tooltipCtaEle.contains(e.target) && !$tooltipMsgEle.contains(e.target)) ||
        (e.type === 'click' && $tooltipMsgCloseEle.contains(e.target)) ||
        (e.type === 'focusout' && (!$tooltipCtaEle.contains(e.relatedTarget) && !$tooltipMsgEle.contains(e.relatedTarget)))) {
        $tooltipEle.classList.remove('is-active');
        $tooltipEle.classList.remove('is-click');
        $tooltipMsgEle.setAttribute('tabindex', -1);
        removeOutsideClickListener();
      }
    };

    const removeOutsideClickListener = () => {
      document.removeEventListener('click', outsideClickListener);
      $tooltipCtaEle.removeEventListener('mouseleave', outsideClickListener);
      $tooltipCtaEle.removeEventListener('focusout', outsideClickListener);
      $tooltipMsgEle.removeEventListener('mouseleave', outsideClickListener);
      $tooltipMsgEle.removeEventListener('focusout', outsideClickListener);
      $tooltipMsgCloseEle.removeEventListener('click', outsideClickListener);
    };

    const tooltipCtaMouseEnterHandler = (e) => {
      $tooltipEle.classList.add('is-active');
      $tooltipMsgEle.setAttribute('tabindex', 0);
      addEventListener($tooltipCtaEle, 'mouseleave', outsideClickListener);
      addEventListener($tooltipCtaEle, 'focusout', outsideClickListener);
      addEventListener($tooltipMsgEle, 'focusout', outsideClickListener);
      e.stopPropagation();
    };

    const tooltipCtaClickHandler = (e) => {
      $tooltipEle.classList.add('is-click');
      $tooltipEle.classList.add('is-active');
      $tooltipMsgEle.setAttribute('tabindex', 0);
      addEventListener($tooltipCtaEle, 'focusout', outsideClickListener);
      addEventListener($tooltipMsgEle, 'focusout', outsideClickListener);
      addEventListener($tooltipMsgCloseEle, 'click', outsideClickListener);
      addEventListener(document, 'click', outsideClickListener);
      e.stopPropagation();
    };

    if ($tooltipCtaEle) {
      $tooltipCtaEle.removeEventListener('click',tooltipCtaClickHandler);
      addEventListener($tooltipCtaEle, 'click', tooltipCtaClickHandler);

      $tooltipCtaEle.removeEventListener('mouseenter',tooltipCtaMouseEnterHandler);
      addEventListener($tooltipCtaEle, 'mouseenter', tooltipCtaMouseEnterHandler);
    }
  }

  function bindAddOnProductEvent() {
    const priceSummaryWrapEl = pdBuyingToolEls.el.querySelector('.add-on-product__price-summary-wrap');
    if (priceSummaryWrapEl) {
      const iconBtn = priceSummaryWrapEl.querySelector('.add-on-product__price-summary-icon');
      iconBtn.addEventListener('click', () => {
        if (priceSummaryWrapEl.classList.contains('open')) {
          priceSummaryWrapEl.classList.remove('open');
          iconBtn.setAttribute('aria-expanded', 'false');
        } else {
          priceSummaryWrapEl.classList.add('open');
          iconBtn.setAttribute('aria-expanded', 'true');
        }
      });
    }
  }

  function bindComboOfferEvent() {
    const comboOfferWrap = pdBuyingToolEls.el.querySelector('.pd-offer-child');
    if (comboOfferWrap) {
      const toggleBtn = document.querySelectorAll('[data-js-action="pdOfferToggle"]');
      toggleBtn.forEach((btn) => {
        btn.addEventListener('click', (e) => {
          const $comboOfferWrap = $q(e.target).closest('.pd-offer-child');
          const hiddenText = $comboOfferWrap.find('.hidden');
          const globalText = JSON.parse(hiddenText.target[0].dataset.globalText);
          let $toggleBtn = $q(e.target);
          if(e.target.getAttribute('data-js-action') !== 'pdOfferToggle' ){
            $toggleBtn = $q(e.target).closest('[data-js-action="pdOfferToggle"]');
          }
          
          if ($comboOfferWrap.hasClass('open')) {
            $comboOfferWrap.removeClass('open');
            $toggleBtn.attr('aria-expanded', 'false');
            hiddenText.text(globalText.Expand);
          } else {
            $q('.pd-offer-child').removeClass('open');
            $q('[data-js-action="pdOfferToggle"]').attr('aria-expanded', 'false');
            $q('[data-js-action="pdOfferToggle"]').find('.hidden').text(globalText.Expand);

            $comboOfferWrap.addClass('open');
            $toggleBtn.attr('aria-expanded', 'true');
            lazyLoad.setLazyLoad();
            hiddenText.text(globalText.Collapse);
          }
        });
      });
    }
  }

  function openPopup(target, callEl) {
    if (callEl) {
      if (callEl.closest('.pd-delivery-pickup__item')) {
        activeList = callEl.closest('.pd-delivery-pickup__item');
      }
    }
    activePopup = $q(target);

    $q(window).off('resize', layerPopupResize).on('resize', layerPopupResize);
  }

  function closePopup(target) {
    if ($q(activeList).target.length > 0) {
      if (target === false) {
        $q(activeList).find('.pd-delivery-pickup__content').show();
        $q(activeList).find('.pd-delivery-pickup__content-summarized').hide();
        focusEl = activeList.querySelector('.pd-delivery-pickup__button .cta');
      } else {
        $q(activeList).find('.pd-delivery-pickup__content').hide();
        $q(activeList).find('.pd-delivery-pickup__content-summarized').show();
        focusEl = activeList.querySelector('.pd-delivery-pickup__edit-button.cta');
      }
    }
    
    $q(focusEl).focus();
    focusEl = null;

    if (activePopup !== null) {
      activePopup.hide();
      activePopup = null;
    }
  }

  function openAddOnLearnMore(callEl){
    const addOnLearnMorePopup = pdBuyingToolEls.el.querySelector('.add-on__layer-learn-more');

    if (callEl) {
      focusEl = callEl;
    }

    utils.hiddenScroll();

    $q(addOnLearnMorePopup).show();
    lazyLoad.setLazyLoad();
    $q(addOnLearnMorePopup).on('keydown', focusLock);
    $q(addOnLearnMorePopup).find('.add-on-popup__close').off('click').on('click', closeAddOnLearnMore);

    swiperManager.slideUpdate($q(addOnLearnMorePopup).find('.basic-swiper').target[0]);
    swiperManager.slideReInit($q(addOnLearnMorePopup).find('.basic-swiper').target[0]);

    let focusableEl = null;

    if ($q(addOnLearnMorePopup).find('.swiper-slide').target.length > 1) {
      focusableEl = $q(addOnLearnMorePopup).find('.swiper-button-next').target[0];
    } else {
      $q(addOnLearnMorePopup).find('.swiper-button-prev').attr('tabindex', '-1');
      $q(addOnLearnMorePopup).find('.swiper-button-next').attr('tabindex', '-1');
      focusableEl = $q(addOnLearnMorePopup).find('a, button:not([tabindex="-1"]), input:not([type="hidden"]), textarea').target[0];
    }
    focusableEl.focus();

    if (document.querySelectorAll('[data-aria-hidden]').length <= 0) {
      setMobileFocusLoop(addOnLearnMorePopup);
    }

    popupResize();
    $q(window).off('resize', popupResize).on('resize', popupResize);
  }

  function closeAddOnLearnMore() {
    const addOnLearnMorePopup = pdBuyingToolEls.el.querySelector('.add-on__layer-learn-more');
    utils.visibleScroll();
    if (document.querySelectorAll('[data-aria-hidden]').length > 0) {
      removeMobileFocusLoop();
    }

    if (focusEl !== null) {
      $q(focusEl).focus();
      focusEl = null;
    }

    $q(addOnLearnMorePopup).hide();
    $q(addOnLearnMorePopup).find('.add-on-popup__close').off('click');
    $q(addOnLearnMorePopup).off('keydown', focusLock);

    $q(addOnLearnMorePopup).find('.swiper-button-prev').removeAttr('tabindex');
    $q(addOnLearnMorePopup).find('.swiper-button-next').removeAttr('tabindex');

    popupResize();
    $q(window).off('resize', popupResize);
  }

  function focusLock(e) {
    const addOnLearnMorePopup = pdBuyingToolEls.el.querySelector('.add-on__layer-learn-more');
    if (e.keyCode === libs.keyCode.TAB_KEY) {
      let firstEl = null;

      if ($q(addOnLearnMorePopup).find('.swiper-slide').target.length > 1) {
        if ($q(addOnLearnMorePopup).find('.swiper-button-prev').hasClass('swiper-button-disabled')) {
          firstEl = $q(addOnLearnMorePopup).find('.swiper-button-next').target[0];
        } else {
          firstEl = $q(addOnLearnMorePopup).find('a, button, input:not([type="hidden"]), textarea').target[0];
        }
      } else {
        firstEl = $q(addOnLearnMorePopup).find('a, button:not([tabindex="-1"]), input:not([type="hidden"]), textarea').target[0];
      }

      if (e.shiftKey === false && $q(addOnLearnMorePopup).find('.add-on-popup__close').target[0] === document.activeElement) {
        e.preventDefault();
        firstEl.focus();
      } else if (e.shiftKey === true && firstEl === document.activeElement) {
        e.preventDefault();
        $q(addOnLearnMorePopup).find('.add-on-popup__close').focus();
      } else if (e.shiftKey === true && $q(addOnLearnMorePopup).target[0] === document.activeElement) {
        e.preventDefault();
        $q(addOnLearnMorePopup).find('.add-on-popup__close').focus();
      }
    }
  }

  function popupResize() {
    const addOnLearnMorePopup = pdBuyingToolEls.el.querySelector('.add-on__layer-learn-more');
    const documentHeight = document.documentElement.clientHeight;
    const popupInner = $q(addOnLearnMorePopup).find('.add-on-popup__inner');
    const popupScroll = $q(addOnLearnMorePopup).find('.scrollbar');
    const popupScrollWrap = $q(addOnLearnMorePopup).find('.scrollbar__wrap');

    if (addOnLearnMorePopup.style.display === 'block') {
      if (BREAKPOINTS.MOBILE >= utils.getViewPort().width) {
        const titleHeight = popupScrollWrap.target[0].getBoundingClientRect();
        const calcHeight = parseInt(documentHeight - titleHeight.top);
        popupInner.css({
          'min-height': '',
        });
        popupScroll.css({
          'height': `${calcHeight}px`,
        });
      } else {
        if (documentHeight <= popupInner.taundingClientRect().height) {
          popupInner.css({
            'min-height': `${documentHeight}px`,
            'height': `${documentHeight}px`,
          });

          const wrapHeight = popupInner.target[0].getBoundingClientRect();
          const titleHeight = popupScrollWrap.target[0].getBoundingClientRect();
          const calcHeight = parseInt(wrapHeight.height - titleHeight.top);

          popupScroll.css({
            'height': `${calcHeight}px`,
          });
        } else {
          popupInner.css({
            'min-height': '',
            'height': '',
          });
          popupScroll.css({
            'height': '',
          });
        }
      }
      setTimeout( () => {
        scrollbar.resize(popupScroll.target[0]);
      }, 300);
    } else {
      popupInner.css({
        'min-height': '',
        'height': '',
      });
      popupScroll.css({
        'height': '',
      });
    }
  }

  window.sg.components.pdBuyingTool = { init, bindShowPdPopupEvent, bindPdTooltipEvent, openAddOnLearnMore, openPopup, closePopup, bindComboOfferEvent };

  $q.ready(() => init());
})();

(() => {
  const $q = window.sg.common.$q;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;
  const Video = window.sg.common.video;
  const KEY_CODE = window.sg.common.constants.KEY_CODE;
  const swiperManager = window.sg.common.swiperManager;
  const triggerEvent = window.sg.common.utils.triggerEvent;
  const selector = { section: '.pd-header-gallery' };

  const i18n = (str) => {
    let localText = str;
    // eslint-disable-next-line
    if( typeof Granite !== 'undefined' ) localText = Granite.I18n.get(str);
    return localText;
  };

  class PDheaderGallery {
    constructor(component) {
      this.selector = {
        section: selector.section,
        popup: '.pd-header-gallery__layer-popup',
        popupAR: '.pd-header-gallery__layer-popup.type-ar',
        popupVideo: '.pd-header-gallery__layer-popup.type-video',
        popup360: '.pd-header-gallery__layer-popup.type-360view',
        popupDim: '.pd-header-gallery__layer-dimmed',
        openAR: '.btn-gallery-ar',
        open360: '.btn-360',
        closePopup: '.pd-header-gallery__layer-popup .popup-close',
        qrCode: '.qr-code',
        swiperFocusAble: '.swiper-wrapper, .swiper-button-prev,.swiper-button-next, .zoom-btn',
        swiper: '.pd-header-gallery__item--swiper',
        zoomBtn: '.zoom-btn',
        dimPopupOpen: '.btn-360--new',
        thumbSwiper: '.pd-header-gallery__thumbnail-swiper',
        thumbImage: '.pd-header-gallery__thumbnail-image',
        thumbVideo: '.pd-header-gallery__thumbnail-video',
        thumbItem: '.pd-header-gallery__thumbnail-item',
        tabCta: '.pd-header-gallery__thumbnail-tab .tab__item',
        swiperNext: '.swiper-button-next',
        swiperPrev: '.swiper-button-prev',
        disabledCls: 'swiper-button-disabled',
        nonZoomStateIcon: '.pd-header-gallery__item-view',
        zoomStateIcon: '.pd-header-gallery__item-moving',
        zoomControlBtn: '.pd-header-gallery__item-tab-button',
      };

      this.ele = {
        window: $q(window),
        section: $q(component),
        openVideo: null,
        // popupAR: null,
        closePopup: null,
        swiperFocusAble: null,
      };

      this.arEle = {
        arLink: null,
        arPopup: null,
        arQrCode: null,
      };

      this.openPopupData = null;
      this.vidoeBtnsMoveFirst = null;
      this.isRtl = null;
      this.statePc = BREAKPOINTS.MOBILE < utils.getViewPort().width;
      this.clickTimer = null;
      this.resizeTimer = null;
      this.minZoomStep = 1;
      this.maxZoomStep = 3;
      this.prevZoomStep = this.minZoomStep;
      this.currentZoomStep = this.minZoomStep;

      this.activeIdx = null;

      this.isQrcodeAr = false;
      this.stateRtl = $q('body').css('direction') === 'rtl';

      this.handler = {
        resize: this.resize.bind(this),
        focusLock: this.focusLock.bind(this),
        showGallery: this.showGallery.bind(this),
        clickTab: this.clickTab.bind(this),
        showImageIndi: this.showImageIndi.bind(this),
        setBtnDisable: this.setBtnDisable.bind(this),
        slideActiveMove: this.slideActiveMove.bind(this),
        setImageLoad: this.setImageLoad.bind(this),
        keydownArrow: (event) => {
          if (event.keyCode === KEY_CODE.TAB) {
            requestAnimationFrame(() => {
              if($q(document.activeElement).closest('.swiper-button-prev,.swiper-button-next').target.length === 0){
                this.showHideArrow(false);
              }
            });
          }
        },
        showArrow: () => {
          this.showHideArrow(true);
        },
        touchStartZoom: (event) => {
          if (this.dragZoomImg !== null) {
            event.preventDefault();//when draging, scrollBlock
          }
          cancelAnimationFrame(this.touchStartZoomTimer);
          this.touchStartZoomTimer = requestAnimationFrame(() => {
            const eventX = event.clientX || event.touches[0].clientX;
            const eventY = event.clientY || event.touches[0].clientY;
            this.dragZoomXY = [eventX,eventY];
            this.clickZoomXY = [eventX,eventY];
            this.ele.window.off('touchend',this.handler.touchEndZoom).on('touchend',this.handler.touchEndZoom);
            this.ele.window.off('mouseup',this.handler.touchEndZoom).on('mouseup',this.handler.touchEndZoom);
          });
        },
        touchMove: (event) => {
          let eventX = event.pageX || event.touches[0].pageX;
          let eventY = event.pageY || event.touches[0].pageY;
          if (this.statePc) {
            //moveZoomBtn
            const rect = this.ele.swiper.target[0].getBoundingClientRect();
            const $btn = this.ele.zoomBtn.target[0];
            const top = document.body.scrollTop || document.documentElement.scrollTop;
            $btn.style.left = `${eventX - rect.left - 1}px`;
            $btn.style.top = `${eventY - rect.top - top - 1}px`;
          }

          eventX = event.clientX || event.touches[0].clientX;
          eventY = event.clientY || event.touches[0].clientY;
          if (this.dragZoomXY !== null) { //is draging
            if (this.dragZoomImg !== null) { //is zoom open
              const offX = this.isRtl ? (this.dragZoomXY[0] - eventX) : (eventX - this.dragZoomXY[0]);
              const offY = eventY - this.dragZoomXY[1];
              this.moveZoomImg(offX,offY);
            }

            this.dragZoomXY = [eventX,eventY];
          }
        },
        touchEndZoom: () => {
          requestAnimationFrame(() => {
            const isClick =  10 > Math.max(Math.abs(this.dragZoomXY[0] - this.clickZoomXY[0]), Math.abs(this.dragZoomXY[1] - this.clickZoomXY[1]));
            this.ele.window.off('touchend',this.handler.touchEndZoom);
            this.ele.window.off('mouseup',this.handler.touchEndZoom);

            if (isClick) {
              // const clickX = this.clickZoomXY[0];
              // const clickY = this.clickZoomXY[1];

              clearTimeout(this.clickTimer);
              this.clickTimer = null;
              this.clickTimer = setTimeout(() => { //Defend concurrent events for touchend, mouseup
                this.handleZoomState();
              }, 30);
            }

            this.dragZoomXY = null;
            this.clickZoomXY = null;
          });
        },
        clickZoomControl: (event) => {
          const btn = event.currentTarget.classList;
          if (btn.contains('plus')) {
            this.handleZoomState('plus');
          } else if (btn.contains('minus')) {
            this.handleZoomState('minus');
          } else if (btn.contains('up')) {
            this.moveZoomImg(0,50);
          } else if (btn.contains('down')) {
            this.moveZoomImg(0,-50);
          } else if (btn.contains('left')) {
            this.moveZoomImg(this.isRtl ? -50 : 50,0);
          } else if (btn.contains('right')) {
            this.moveZoomImg(this.isRtl ? 50 : -50,0);
          }
        },
        galleryChange: () => {
          this.nonZoomClass();
          if (this.dragZoomImg !== null) {
            this.handleZoomState('reset');
          }

          this.setImageLoad();
        },
        zoomKeyDown: (event) => {
          if (event.keyCode === KEY_CODE.ENTER) {
            this.handleZoomState();
          }
        },
        dimPopupOpen: () => {
          if (this.openPopupData !== null) {
            this.hidePopup($q(this.openPopupData.popup));
          }

          const $popup = this.ele.section.find('.pd-header-gallery__layer-popup.type-360view-new');
          $popup.addClass('open');
          $popup.setLayerFocus('.btn-close-popup', '.btn-zoomin', false);
          utils.setMobileFocusLoop($popup.target[0]);
          utils.hiddenScroll();
          if($q('.product-detail-kv__gallery-area').css('position') !== 'absolute'){
            this.ele.section.closest('.product-detail-kv__gallery-area').css({
              zIndex: '3100',
            });
          }
          $popup.find('.btn-close-popup').on('click',this.handler.dimPopupClose);
          window.sg.components.PDheaderGallery.openNew360Popup();
        },
        dimPopupClose: () => {
          const $popup = this.ele.section.find('.pd-header-gallery__layer-popup.type-360view-new');
          $popup.removeClass('open');
          $popup.offLayerFocus();
          utils.removeMobileFocusLoop();
          utils.visibleScroll();
          this.ele.section.closest('.product-detail-kv__gallery-area').css({
            zIndex: '',
          });
          $popup.find('.btn-close-popup').off('click',this.handler.dimPopupClose);
          this.ele.dimPopupOpen.focus();
        },
      };

      this.setProperty();

      PDheaderGallery.instances.set(component, this);

      this.init();
    }

    nonZoomClass(isNoZoom = null){
      if(isNoZoom === null) {
        const swiperObj = this.ele.swiper.target[0].swiper;
        isNoZoom = swiperObj.slides[swiperObj.activeIndex].querySelector('.zoom-image') === null;
      }
      if (isNoZoom) {
        this.ele.section.addClass('non-zoom');
      } else {
        this.ele.section.removeClass('non-zoom');
      }
    }

    setProperty() {
      // this.ele.popupAR = this.ele.section.find(this.selector.popupAR);
      this.ele.closePopup = this.ele.section.find(this.selector.closePopup);
      this.ele.swiper = this.ele.section.find(this.selector.swiper);
      this.ele.swiperFocusAble = this.ele.swiper.find(this.selector.swiperFocusAble);
      this.ele.thumbSwiper = this.ele.section.find(this.selector.thumbSwiper);
      this.ele.zoomBtn = this.ele.section.find(this.selector.zoomBtn);
      this.ele.dimPopupOpen = this.ele.section.find(this.selector.dimPopupOpen);
      this.ele.thumbImage = this.ele.section.find(this.selector.thumbImage);
      this.ele.thumbVideo = this.ele.section.find(this.selector.thumbVideo);
      this.ele.swiperImage = this.ele.thumbImage.find(this.selector.thumbSwiper);
      this.ele.swiperVideo = this.ele.thumbVideo.find(this.selector.thumbSwiper);
      this.ele.thumbImageIndi = this.ele.thumbImage.find('.pd-header-gallery__thumbnail-item > a');
      this.ele.openVideo = this.ele.thumbVideo.find('.pd-header-gallery__thumbnail-item > a');
      this.ele.tabCta = this.ele.section.find(this.selector.tabCta).find('.tab__item-title');
      this.ele.thumbPanel = this.ele.section.find('.pd-header-gallery__thumbnail-wrap');
      this.ele.nonZoomStateIcon = this.ele.section.find(this.selector.nonZoomStateIcon);
      this.ele.zoomStateIcon = this.ele.section.find(this.selector.zoomStateIcon);
      this.ele.zoomControlBtn = this.ele.section.find(this.selector.zoomControlBtn);

      if(this.ele.zoomBtn.target.length !== 0){
        this.ele.zoomBtn.target[0].draggable = false;
      }
      this.ele.section.find('.zoom-image .image img.image__main').target.forEach((el) => {
        el.draggable = false;
      });

      this.isRtl = this.ele.section.css('direction') === 'rtl';
      this.clickZoomXY = null;
      this.dragZoomXY = null;
      this.dragZoomImg = null;
      this.touchStartZoomTimer = null;
      this.desktopFlag = false;
      this.mobileFlag = false;

      this.dataInText = this.ele.swiper.attr('data-an-la-in');
      this.dataOutText = this.ele.swiper.attr('data-an-la-out');

      this.setArProperty();
    }

    setArProperty() {
      this.arEle.arLink = this.ele.section.find(this.selector.openAR);
      this.arEle.arPopup = this.ele.section.find(this.selector.popupAR);
      this.arEle.arQrCode = this.arEle.arPopup.find(this.selector.qrCode);
    }

    init() {
      this.setAr();
      this.bindEvents();
      window.sg.common.image.initAll();
      this.resize();
    }

    reInit() {
      this.setProperty();
      this.setAr();
      this.bindEvents();
      window.sg.common.image.initAll();
      this.resize();
    }

    reInitAr() {
      this.setArProperty();
      this.setAr();
      this.bindArEvents();
    }

    setAr() {
      this.isQrcodeAr = false;

      if (/Android/i.test(navigator.userAgent)) {
        this.buildAr('aos');
      } else if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        this.buildAr('ios');
      } else {
        this.isQrcodeAr = true;
        this.setQrCode();
      }
    }

    // android, ios  ar 
    buildAr(type) {
      let targetLink = `https:${this.arEle.arLink.attr('data-ar-href')}`;

      if (type === 'ios') {
        this.arEle.arLink.attr('rel', 'ar');
        targetLink += '.usdz';
      } else {
        targetLink = `intent://arvr.google.com/scene-viewer/1.0?file=${targetLink}.glb#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=https://www.samsung.com;end;`;
      }

      this.arEle.arLink.attr('href', targetLink);
    }

    // qr code 
    setQrCode() {
      const msg = `${window.location.href}?ar`;

      if (!this.arEle.arQrCode.find('svg').length) {
        // eslint-disable-next-line no-undef
        this.arEle.arQrCode.append(QRCode({
          msg,
        }));
      }
    }

    resize() {
      const stateNow = BREAKPOINTS.MOBILE < utils.getViewPort().width;
      // if (this.statePc !== stateNow) {
      //   // if (this.openPopupData !== null && this.openPopupData.popup === this.ele.popupAR.target[0]) {
      //   //   this.hidePopup(this.ele.popupAR, false);
      //   // }
      //
      //   if (this.openPopupData !== null && this.openPopupData.popup === this.arEle.arPopup.target[0]) {
      //     this.hidePopup(this.arEle.arPopup, false);
      //   }
      // }

      if(this.statePc !== stateNow && this.dragZoomImg !== null){
        this.handleZoomState('reset');
      }

      clearTimeout(this.resizeTimer);
      this.resizeTimer = null;
      this.resizeTimer = setTimeout(() => {
        if (stateNow) {
          this.ele.zoomBtn.css({
            height: '',
          });

          if (this.desktopFlag === false) {
            this.desktopFlag = true;
            this.mobileFlag = false;

            this.ele.thumbSwiper.target.forEach((element) => {
              const slides = $q(element).find('.pd-header-gallery__thumbnail-item').target.length;

              if (element.swiper) {
                if (slides <= 6) {
                  swiperManager.slideSwiperDestory(element);
                  $q(element).closest('.pd-header-gallery__thumbnail-wrap').find('.swiper-button-prev, .swiper-button-next').hide();
                  $q(element).closest('.pd-header-gallery__thumbnail-wrap').find('.swiper-button-prev, .swiper-button-next').attr('tabindex', '-1');
                  $q(element).closest('.pd-header-gallery__thumbnail-wrap').find('.swiper-button-prev, .swiper-button-next').attr('aria-disabled', 'true');
                }
              } else {
                if (slides > 6) {
                  swiperManager.slideInit(element);
                } else {
                  $q(element).closest('.pd-header-gallery__thumbnail-wrap').find('.swiper-button-prev, .swiper-button-next').hide();
                  $q(element).closest('.pd-header-gallery__thumbnail-wrap').find('.swiper-button-prev, .swiper-button-next').attr('tabindex', '-1');
                  $q(element).closest('.pd-header-gallery__thumbnail-wrap').find('.swiper-button-prev, .swiper-button-next').attr('aria-disabled', 'true');
                }
              }
            });

            this.ele.swiper.find('.pd-header-gallery__item').target.forEach((element) => {
              if ($q(element).find('.zoom-image').target.length > 0) {
                $q(element).find('.pd-header-gallery__item-wrap').attr('an-la', this.dataInText);
              }
            });
            this.setImageLoad();
          }
        } else {
          const defulatImage = this.ele.swiper.find('.swiper-slide-active').find('.first-image').target.length > 0 ? this.ele.swiper.find('.swiper-slide-active .first-image img') : this.ele.swiper.find('.swiper-slide-active .image img');
          this.ele.zoomBtn.css({
            height: `${defulatImage.offset().height}px`,
            left: 0,
            top: 0,
          });

          if (this.mobileFlag === false) {
            this.mobileFlag = true;
            this.desktopFlag = false;

            this.ele.thumbSwiper.target.forEach((element) => {
              const sw = swiperManager.getSwiper(element);
              const slides = $q(element).find('.pd-header-gallery__thumbnail-item').target.length;

              if (element.swiper) {
                if (slides <= 3) {
                  swiperManager.slideSwiperDestory(element);
                } else {
                  sw.slideTo($q(element).find('.pd-header-gallery__thumbnail-item.active').index(), 100);
                  this.ele.thumbPanel.find('.pd-header-gallery__thumbnail-item > a').off('click', this.handler.slideActiveMove).on('click', this.handler.slideActiveMove);
                }
              } else {
                if (slides > 3) {
                  swiperManager.slideInit(element);
                  swiperManager.getSwiper(element).slideTo($q(element).find('.pd-header-gallery__thumbnail-item.active').index(), 100);
                  this.ele.thumbPanel.find('.pd-header-gallery__thumbnail-item > a').off('click', this.handler.slideActiveMove).on('click', this.handler.slideActiveMove);
                }
              }
            });

            this.ele.swiper.target.forEach((element) => {
              element.swiper.off('slideChange', this.handler.slideActiveMove).on('slideChange', this.handler.slideActiveMove);
            });
            this.setImageLoad();
          }
        }
      }, 400);

      if (this.dragZoomImg !== null) {
        this.moveZoomImg(0,0);
      }

      this.statePc = stateNow;
    }

    bindArEvents() {
      // qr code ar  click event bind
      if (this.isQrcodeAr) {
        this.arEle.arLink.off('click').on('click', (e) => {
          e.preventDefault();
          this.showPopup(this.arEle.arPopup, e.currentTarget);
     ction.find(this.selector.openAR).off('click').on('click', (event) => {
      //   if (this.statePc) {
      //     event.preventDefault();
      //     this.showPopup(this.ele.popupAR, event.currentTarget);
      //   }
      // });
      this.ele.swiper.target.forEach((element) => {
        if (element.swiper) {
          swiperManager.slideReInit(element);
          this.nonZoomClass();
        } else {
          swiperManager.slideInit(element);
          this.nonZoomClass(document.querySelector('.swiper-wrapper .pd-header-gallery__item:first-child .zoom-image') === null);
        }
        requestAnimationFrame(() => {
          element.swiper.off('slideChange', this.handler.galleryChange).on('slideChange', this.handler.galleryChange);
          element.swiper.off('slideChange', this.handler.showImageIndi).on('slideChange', this.handler.showImageIndi);
          element.swiper.off('slideChangeTransitionStart', this.handler.setImageLoad).on('slideChangeTransitionStart', this.handler.setImageLoad);
          $q(element).find('.pd-header-gallery__arrow').on('click', (el) => {
            $q(el.currentTarget).focus();
          });
        });
      });

      this.ele.thumbSwiper.target.forEach((element) => {
        if ($q(element).target[0] === this.ele.swiperImage.target[0]) {
          $q(element).find(this.selector.thumbItem).removeClass('active');
          $q(element).find(this.selector.thumbItem).eq(0).addClass('active');
        }
        if (element.swiper) {
          swiperManager.slideReInit(element);
          $q(element).closest('.pd-header-gallery__thumbnail-wrap').find(this.selector.swiperPrev).addClass('swiper-button-disabled');
          element.swiper.off('slideChange', this.handler.setBtnDisable).on('slideChange', this.handler.setBtnDisable);
        }
      });

      this.ele.section.find(this.selector.open360).off('click').on('click', (event) => {
        const $popup = this.ele.section.find(this.selector.popup360);
        this.showPopup($popup, event.currentTarget);
        window.sg.common.image360.init($popup.find('.image-360').target[0]);
        this.ele.section.find('.pd-header-gallery__control').css({
          'visibility': 'hidden',
        });
      });

      this.ele.openVideo.off('click').on('click', (event) => {
        if (this.statePc === false && this.vidoeBtnsMoveFirst !== null) {
          if (this.vidoeBtnsMoveFirst.end !== null && Math.abs(this.vidoeBtnsMoveFirst.start - this.vidoeBtnsMoveFirst.end) > 15) {
            return;
          }
        }

        this.showPopup(this.ele.section.find(this.selector.popupVideo), event.currentTarget);
      });

      th> {
        this.hidePopup($q(event.currentTarget).closest(this.selector.popup));
      });

      this.ele.window.off('resize', this.handler.resize).on('resize', this.handler.resize);

      this.bindArEvents();

      this.showHideArrow(false);
      // const $swiper = this.ele.section.find('.swiper-wrapper');
      // $swiper.attr('tabindex',0);
      let mouseCheck = false;
      this.ele.swiperFocusAble.on('mouseenter', () => {
        mouseCheck = true;
        this.showHideArrow(true);
      });
      this.ele.swiperFocusAble.off('mouseleave').on('mouseleave', () => {
        mouseCheck = false;
        setTimeout(() => {
          if (mouseCheck === false && 0 > this.ele.swiperFocusAble.target.indexOf(document.activeElement)) {
            this.showHideArrow(false);
            this.ele.zoomBtn.css({
              left: '0',
              top: '0',
            });
          }
        },30);
      });
      this.ele.swiperFocusAble.off('click', this.handler.showArrow).on('click', this.handler.showArrow);
      this.ele.swiperFocusAble.off('focusin').on('focusin', () => {
        this.showHideArrow(true);
      });
      this.ele.swiper.find('.swiper-button-prev,.swiper-button-next').off('keydown', this.handler.keydownArrow).on('keydown',this.handler.keydownArrow);
      if(this.ele.zoomBtn.target.length !== 0){
        const $galleryImgs = this.ele.swiper.find('.swiper-wrapper');
        $galleryImgs.off('touchstart',this.handler.touchStartZoom).on('touchstart',this.handler.touchStartZoom);
        $galleryImgs.off('mousedown',this.handler.touchStartZoom).on('mousedown',this.handler.touchStartZoom);
        $galleryImgs.off('mousemove',this.handler.touchMove).on('mousemove',this.handler.touchMove);
        $galleryImgs.off('touchmove',this.handler.touchMove).on('touchmove',this.handler.touchMove);
        this.ele.zoomBtn.off('keydown',this.handler.zoomKeyDown).on('keydown',this.handler.zoomKeyDown);
        this.ele.section.find('.pd-header-gallery__item-tab-list button, .pd-header-gallery__item-moving button').off('click',this.handler.clickZoomControl).on('click',this.handler.clickZoomControl);
      }

      this.ele.dimPopupOpen.off('click',this.handler.dimPopupOpen).on('click',this.handler.dimPopupOpen);

      this.ele.thumbPanel.find('.swiper-button-prev, .swiper-button-next, .pd-header-gallery__thumbnail-item > a').off('click',this.handler.showGallery).on('click',this.handler.showGallery);
      this.ele.tabCta.off('click',this.handler.clickTab).on('click',this.handler.clickTab);

      const activeTab = this.ele.tabCta.closest('.tab__list').find('.tab__item--active');
      if (activeTab.target.length <= 0 ) {
        if (this.ele.section.find('.pd-header-gallery__thumbnail-wrap.is-active').target.length > 0) {
          window.sg.common.tab.init(this.ele.section.find('.pd-header-gallery__thumbnail-tab .tab').target[0], this.ele.section.find('.pd-header-gallery__thumbnail-wrap.is-active').index() - 1);
        } else {
          window.sg.common.tab.init(this.ele.section.find('.pd-header-gallery__thumbnail-tab .tab').target[0], 0);
          this.ele.section.find('.pd-header-gallery__thumbnail-image').addClass('is-active');
        }
      }
    }

    setImageLoad() {
      this.setOtherImageLoad(this.ele.swiper.target[0]);
      this.setOtherImageLoad(this.ele.section.find('.pd-header-gallery__thumbnail-wrap.is-active').find(this.selector.thumbSwiper).target[0]);
    }

    setOtherImageLoad(element) {
      const activeIndex = element.swiper ? element.swiper.realIndex : $q(element).find('.swiper-slide.active').index();
      const activeSlide = element.swiper ? element.swiper.slides[element.swiper.realIndex] : $q(element).find('.swiper-slide.active');
      const thumbnailActive = [];
      
      if ($q(element).hasClass('pd-header-gallery__item--swiper')) {
        $q(activeSlide).find('.image').target.forEach((el) => {
          if ($q(el).closest('.zoom-image').target.length <= 0) {
            if (!$q(el).hasClass('image--main-loaded')) {
              window.sg.common.lazyLoad.setLazyLoadManually(el);
            }
          }
        });
      } else {
        if (element.swiper) {
          for (let i = activeIndex; i <= activeIndex + 5; i++) {
            thumbnailActive.push(element.swiper.slides[i]);
          }
        } else {
          for (let i = activeIndex; i <= $q(element).find('.swiper-slide').target.length - 1; i++) {
            thumbnailActive.push($q(element).find('.swiper-slide').eq(i).target[0]);
          }
        }
        
        thumbnailActive.forEach((element) => {
          if (!$q(element).find('.image').hasClass('image--main-loaded')) {
            window.sg.common.lazyLoad.setLazyLoadManually(element);
          }
        });
      }
    }

    showGallery(el) {
      const activePanel = $q(el.currentTarget).closest('.pd-header-gallery__thumbnail-wrap');
      const activeItem = activePanel.find('.pd-header-gallery__thumbnail-item.active');
      const currentIdx = activeItem.index();
      const nextItem = activePanel.find(this.selector.thumbItem).eq(currentIdx + 1);
      const prevItem = activePanel.find(this.selector.thumbItem).eq(currentIdx - 1);
      const itemLength = activePanel.find(this.selector.thumbItem).target.length;
      const swiperEl = activePanel.find('.swiper-container.swiper-container-initialized').target[0];
      const currentTarget = el.currentTarget;

      this.ele.gallerySwiper = swiperManager.getSwiper(this.ele.swiper.target[0]);
      this.swiperEl = activePanel.find('.swiper-container').target[0];

      if (el.currentTarget.offsetParent.classList.contains('pd-header-gallery__thumbnail-item')) {
        this.activeIdx = $q(currentTarget).closest(this.selector.thumbItem).index();
        activePanel.find(this.selector.thumbItem).removeClass('active');
        activePanel.find(this.selector.thumbItem).eq(this.activeIdx).addClass('active');
        currentTarget.focus();
      } else {
        if (el.currentTarget === activePanel.find('.swiper-button-next').target[0]) {
          if (prevItem.attr('aria-hidden') === 'true' || currentIdx === 0) {
            this.activeIdx = this.swiperEl.swiper.realIndex;
            activePanel.find(this.selector.thumbItem).removeClass('active');
            activePanel.find(this.selector.thumbItem).eq(this.activeIdx).addClass('active');
          } else {
            this.activeIdx = currentIdx;
          }
        } else if (el.currentTarget === activePanel.find('.swiper-button-prev').target[0]) {
          if (nextItem.attr('aria-hidden') === 'true' || currentIdx === itemLength - 1) {
            this.activeIdx = this.swiperEl.swiper.realIndex + 5;
            activePanel.find(this.selector.thumbItem).removeClass('active');
            activePanel.find(this.selector.thumbItem).eq(this.activeIdx).addClass('active');
          } else {
            this.activeIdx = currentIdx;
          }
        }
        if (activePanel.target[0] === this.ele.section.find('.pd-header-gallery__thumbnail-video').target[0]) {
          this.openPopupData = null;
          this.showPopup(this.ele.section.find(this.selector.popupVideo), activePanel.find('.pd-header-gallery__thumbnail-item').eq(this.activeIdx).find('a').target[0]);
        }

        if (activePanel.find(this.selector.swiperPrev).hasClass(this.selector.disabledCls)) {
          activePanel.find(this.selector.swiperNext).focus();
        } else if (activePanel.find(this.selector.swiperNext).hasClass(this.selector.disabledCls)) {
          activePanel.find(this.selector.swiperPrev).focus();
        }
      }

      if (this.swiperEl === activePanel.find('.pd-header-gallery__thumbnail-image .swiper-container').target[0]) {
        this.ele.gallerySwiper.slideTo(this.activeIdx);
        if (swiperEl && el.currentTarget.offsetParent.classList.contains('pd-header-gallery__thumbnail-item')) {
          this.slideMove(activePanel, this.swiperEl.swiper.realIndex, this.swiperEl.swiper.realIndex);
        }
      } else {
        if (swiperEl && el.currentTarget.offsetParent.classList.contains('pd-header-gallery__thumbnail-item')) {
          this.slideMove(activePanel, this.swiperEl.swiper.realIndex + 1, this.swiperEl.swiper.realIndex - 1);
        }
      }

      if (swiperEl) {
        const nowActive = currentIdx;
        const realActive = this.swiperEl.swiper.realIndex;
        if ($q(currentTarget).hasClass('pd-header-gallery__thumbnail-button')) {
          clearTimeout(this.thumbnailTimer);
          this.thumbnailTimer = null;
          this.thumbnailTimer = setTimeout(() => {
            if (nowActive !== realActive) {
              if ($q(currentTarget).hasClass('swiper-button-next')) {
                if (nowActive < realActive) {
                  if (prevItem.attr('aria-hidden') === 'true' || nowActive === 0) {
                    this.activeIdx = realActive;
                    activePanel.find(this.selector.thumbItem).removeClass('active');
                    activePanel.find(this.selector.thumbItem).eq(this.activeIdx).addClass('active');
                  } else {
                    this.activeIdx = nowActive;
                  }

                  if (this.swiperEl === activePanel.find('.pd-header-gallery__thumbnail-image .swiper-container').target[0]) {
                    this.ele.gallerySwiper.slideTo(this.activeIdx);
                    this.slideMove(activePanel, realActive, realActive);
                  }
                }
              }

              if ($q(currentTarget).hasClass('swiper-button-prev')) {
                if (nowActive > realActive + 5) {
                  if (nextItem.attr('aria-hidden') === 'true' || nowActive === itemLength - 1) {
                    this.activeIdx = realActive + 5;
                    activePanel.find(this.selector.thumbItem).removeClass('active');
                    activePanel.find(this.selector.thumbItem).eq(this.activeIdx).addClass('active');
                  } else {
                    this.activeIdx = nowActive;
                  }

                  if (this.swiperEl === activePanel.find('.pd-header-gallery__thumbnail-image .swiper-container').target[0]) {
                    this.ele.gallerySwiper.slideTo(this.activeIdx);
                    this.slideMove(activePanel, realActive, realActive);
                  }
                }
              }

              if (activePanel.target[0] === this.ele.section.find('.pd-header-gallery__thumbnail-video').target[0]) {
                this.openPopupData = null;
                this.showPopup(this.ele.section.find(this.selector.popupVideo), activePanel.find('.pd-header-gallery__thumbnail-item').eq(this.activeIdx).find('a').target[0]);
              }
            }
          }, 400);
        }
      }

      this.setImageLoad();
    }

    showImageIndi() {
      const activePanel = this.ele.section.find('.pd-header-gallery__thumbnail-wrap.is-active');
      const swiper = this.ele.swiper.target[0].swiper;

      this.activeIdx = swiper.realIndex;
      this.ele.thumbImage.find(this.selector.thumbItem).removeClass('active');
      this.ele.thumbImage.find(this.selector.thumbItem).eq(this.activeIdx).addClass('active');

      if (activePanel.find('.swiper-container').hasClass('swiper-container-initialized')) {
        this.swiperEl = activePanel.find('.swiper-container').target[0];
        this.slideMove(activePanel, this.swiperEl.swiper.realIndex + 1, this.swiperEl.swiper.realIndex - 1);
      }
    }

    slideMove(target, activeItemNext, activeItemPrev) {
      const marginValue = parseInt(target.find('.swiper-container').css('margin-left'));
      const nextItem = target.find('.pd-header-gallery__thumbnail-item').eq(this.activeIdx + 1);
      const prevItem = target.find('.pd-header-gallery__thumbnail-item').eq(this.activeIdx - 1);

      if (this.stateRtl === false) {
        if (nextItem.target.length > 0) {
          if (target.offset().right - marginValue <= target.find('.pd-header-gallery__thumbnail-item').eq(this.activeIdx).offset().right) {
            this.swiperEl.swiper.slideTo(activeItemNext);
          }
        }

        if (prevItem.target.length > 0) {
          if (target.offset().left > prevItem.offset().left) {
            this.swiperEl.swiper.slideTo(activeItemPrev);
          }
        }
      } else {
        if (nextItem.target.length > 0) {
          if (target.offset().left + marginValue >= target.find('.pd-header-gallery__thumbnail-item').eq(this.activeIdx).offset().left) {
            this.swiperEl.swiper.slideTo(activeItemNext);
          }
        }

        if (prevItem.target.length > 0) {
          if (target.offset().right - marginValue < prevItem.offset().right) {
            this.swiperEl.swiper.slideTo(activeItemPrev);
          }
        }
      }
    }


    clickTab(el) {
      const activeTabIdx = $q(el.currentTarget).closest(this.selector.tabCta).index();
      const activePanel = this.ele.thumbPanel.eq(activeTabIdx);
      const swiperEl = activePanel.find('.swiper-container.swiper-container-initialized').target[0];
      const slides = activePanel.find('.pd-header-gallery__thumbnail-item').target.length;

      this.ele.thumbPanel.removeClass('is-active');
      activePanel.addClass('is-active');

      this.activeSlideIdx = null;

      if (activePanel.target[0] === this.ele.thumbImage.target[0]) {
        if (activePanel.find('.active').target.length > 0) {
          if (swiperEl) {
            this.activeSlideIdx = this.ele.swiperImage.target[0].swiper.realIndex;
          }
          this.activeIdx = activePanel.find('.pd-header-gallery__thumbnail-item.active').index();
        }

        if (this.ele.section.find(this.selector.popupVideo).hasClass('open')) {
          $q(this.openPopupData.popup).find('.video-contents').css({
            display: 'none',
          });
          this.hidePopup($q(this.openPopupData.popup), false);
        }

        this.ele.section.find('.pd-header-gallery__control').css({
          'visibility': 'visible',
        });
      } else {
        this.activeSlideIdx = 0;
        this.activeIdx = 0;

        this.videoFirstEl = this.ele.section.find(this.selector.popupVideo).find('.video-contents').eq(0).find('.video');

        const autoplayFlag = JSON.parse(this.videoFirstEl.attr('data-video-data'));

        if (autoplayFlag.autoplay === true) {
          autoplayFlag.autoplay = false;
          this.videoFirstEl.attr('data-video-data', JSON.stringify(autoplayFlag));
          activePanel.find(this.selector.thumbItem).eq(0).find('a').trigger('click');
          autoplayFlag.autoplay = true;
          this.videoFirstEl.attr('data-video-data', JSON.stringify(autoplayFlag));
        } else {
          activePanel.find(this.selector.thumbItem).eq(0).find('a').trigger('click');
        }

        $q(el.currentTarget).focus();

        this.ele.section.find('.pd-header-gallery__control').css({
          'visibility': 'hidden',
        });
      }

      if (swiperEl) {
        this.ele.indiSwiper = swiperManager.getSwiper(swiperEl);
        this.setBtnDisable();
        activePanel.find('.pd-header-gallery__thumbnail-swiper').target[0].swiper.off('slideChange', this.handler.setBtnDisable).on('slideChange', this.handler.setBtnDisable);

        swiperManager.slideUpdate(swiperEl);
        activePanel.find('.swiper-button-prev, .swiper-button-next, .pd-header-gallery__thumbnail-item > a').off('click',this.handler.showGallery).on('click',this.handler.showGallery);

        this.ele.indiSwiper.slideTo(this.activeSlideIdx);

        if (this.statePc === false) {
          if (slides > 3) {
            this.ele.thumbPanel.find('.pd-header-gallery__thumbnail-item > a').off('click', this.handler.slideActiveMove).on('click', this.handler.slideActiveMove);
          }
        }
      }

      this.setImageLoad();
    }

    setBtnDisable() {
      const activePanel = this.ele.section.find('.pd-header-gallery__thumbnail-wrap.is-active');

      if (activePanel.find(this.selector.swiperPrev).hasClass(this.selector.disabledCls)) {
        activePanel.find(this.selector.swiperPrev).attr('aria-disabled', 'true');
        activePanel.find(this.selector.swiperPrev).attr('tabindex', '-1');
        activePanel.find(this.selector.swiperNext).attr('aria-disabled', 'false');
        activePanel.find(this.selector.swiperNext).attr('tabindex', '0');
      } else if (activePanel.find(this.selector.swiperNext).hasClass(this.selector.disabledCls)) {
        activePanel.find(this.selector.swiperNext).attr('aria-disabled', 'true');
        activePanel.find(this.selector.swiperNext).attr('tabindex', '-1');
        activePanel.find(this.selector.swiperPrev).attr('aria-disabled', 'false');
        activePanel.find(this.selector.swiperPrev).attr('tabindex', '0');
      } else {
        activePanel.find(this.selector.swiperPrev).attr('aria-disabled', 'false');
        activePanel.find(this.selector.swiperPrev).attr('tabindex', '0');
        activePanel.find(this.selector.swiperNext).attr('aria-disabled', 'false');
        activePanel.find(this.selector.swiperNext).attr('tabindex', '0');
      }
    }

    slideActiveMove() {
      const activePanel = this.ele.section.find('.pd-header-gallery__thumbnail-wrap.is-active');
      this.swiperEl = activePanel.find('.swiper-container').target[0];
      const swiperEl = activePanel.find('.swiper-container.swiper-container-initialized').target[0];

      if (swiperEl) {
        if (activePanel.find('.pd-header-gallery__thumbnail-item.active').index() === activePanel.find('.pd-header-gallery__thumbnail-item').target.length - 1) {
          if ((this.swiperEl.swiper.translate * -1) !== this.swiperEl.swiper.snapGrid[this.swiperEl.swiper.snapGrid.length - 1]) {
            this.swiperEl.swiper.slideNext();
          }
        }
      }
    }

    setCursorAndSnackBarState() {
      if( this.currentZoomStep === this.minZoomStep ){
        this.ele.zoomBtn.find('.hidden').text('Zoom in');
        this.ele.zoomBtn.find('use').attr('xlink:href','#zoom-in-regular');
        this.ele.zoomBtn.find('use').attr('href','#zoom-in-regular');
      } else if ( this.currentZoomStep === this.maxZoomStep ) {
        this.ele.zoomBtn.find('.hidden').text('Zoom out');
        this.ele.zoomBtn.find('use').attr('xlink:href','#zoom-out-regular');
        this.ele.zoomBtn.find('use').attr('href','#zoom-out-regular');
        this.currentSnackBar.innerText = i18n('Click or tap to zoom out');
      } else if ( this.prevZoomStep < this.currentZoomStep ) {
        this.ele.zoomBtn.find('.hidden').text('Zoom in');
        this.ele.zoomBtn.find('use').attr('xlink:href','#zoom-in-regular');
        this.ele.zoomBtn.find('use').attr('href','#zoom-in-regular');
        this.currentSnackBar.innerText = i18n('Click or tap to zoom in');
      } else if ( this.prevZoomStep > this.currentZoomStep ) {
        this.ele.zoomBtn.find('.hidden').text('Zoom out');
        this.ele.zoomBtn.find('use').attr('xlink:href','#zoom-out-regular');
        this.ele.zoomBtn.find('use').attr('href','#zoom-out-regular');
        this.currentSnackBar.innerText = i18n('Click or tap to zoom out');
      }
    }

    setControllerState() {
      if( (this.currentZoomStep <= this.maxZoomStep) && (this.currentZoomStep > this.minZoomStep) ) {
        this.ele.nonZoomStateIcon.removeClass('is-active');
        this.ele.zoomStateIcon.addClass('is-active');
        this.ele.zoomStateIcon.find('button[disabled]').target.forEach((arrow) => {
          arrow.disabled = false;
        });
      }else {
        this.ele.nonZoomStateIcon.addClass('is-active');
        this.ele.zoomStateIcon.removeClass('is-active');
      }
    }

    setZoomControlBtnState() {
      if( this.currentZoomStep === this.minZoomStep ){
        this.ele.zoomControlBtn.eq(0).removeAttr('disabled');
        if($q(document.activeElement).closest('.pd-header-gallery__item-btn').target.length > 0){
          this.ele.zoomControlBtn.eq(0).focus();
        }
        this.ele.zoomControlBtn.eq(1).attr('disabled','');
      } else if ( this.currentZoomStep === this.maxZoomStep ) {
        this.ele.zoomControlBtn.eq(0).attr('disabled','');
        this.ele.zoomControlBtn.eq(1).removeAttr('disabled');
        this.ele.zoomControlBtn.eq(1).focus();
      } else {
        this.ele.zoomControlBtn.removeAttr('disabled');
      }
    }

    resetZoom() {
      this.prevZoomStep = 1;
      this.currentZoomStep = 1;

      this.ele.swiper.target[0].swiper.allowTouchMove = true;
      this.currentZoomImgContainer.style.display = '';
      const img = this.dragZoomImg.querySelector('.image img.image__main');
      img.style.transform = '';
      this.dragZoomImg = null;
    }

    zoomIn() {
      this.prevZoomStep = this.currentZoomStep;
      this.currentZoomStep++;

      this.ele.swiper.target[0].swiper.allowTouchMove = false;
      if (!$q(this.currentZoomImgContainer).find('.image').hasClass('image--main-loaded')) {
        window.sg.common.lazyLoad.setLazyLoadManually(this.currentZoomImgContainer);
      }

      if( this.currentZoomStep > this.minZoomStep ) {
        this.currentZoomImgContainer.style.display = 'block';
      }

      this.dragZoomImg = this.currentZoomImgContainer;

      this.currentActiveSlideTarget.attr('an-la', this.dataOutText);
    }

    zoomOut() {
      this.prevZoomStep = this.currentZoomStep;
      this.currentZoomStep--;

      this.currentActiveSlideTarget.attr('an-la', this.dataInText);

      if( this.currentZoomStep === this.minZoomStep ) {
        this.resetZoom();
      }
    }

    handleZoomState(flag) {
      if (this.dragZoomImg === null && this.ele.section.hasClass('non-zoom')) return;

      this.currentZoomImgContainer = this.dragZoomImg || this.ele.swiper.target[0].swiper.slides[this.ele.swiper.target[0].swiper.activeIndex].querySelector('.zoom-image');
      this.currentActiveSlideTarget = this.ele.swiper.find('.pd-header-gallery__item').eq(this.ele.swiper.target[0].swiper.realIndex).find('.pd-header-gallery__item-wrap');
      this.currentSnackBar = this.currentZoomImgContainer.querySelector('.snackbar');

      if( flag === 'reset' ) {
        this.resetZoom();
      } else if ( flag === 'plus' ) {
        this.zoomIn();
      } else if ( flag === 'minus' ) {
        this.zoomOut();
      } else if( this.currentZoomStep === this.minZoomStep ) {
        this.zoomIn();
      } else if (this.currentZoomStep === this.maxZoomStep ) {
        this.zoomOut();
      } else if ( this.prevZoomStep < this.currentZoomStep ) {
        this.zoomIn();
      } else if ( this.prevZoomStep > this.currentZoomStep ) {
        this.zoomOut();
      }

      this.setCursorAndSnackBarState();
      this.setControllerState();
      this.setZoomControlBtnState();

      const $zoomImg = this.currentZoomImgContainer.querySelector('img.image__main');
      if ($zoomImg.classList.contains('image--loaded')) {
        this.showZoomXY();
      } else {
        $zoomImg.addEventListener('load',() => {
          this.showZoomXY();
        });
      }
    }

    showZoomXY() {
      if (this.dragZoomImg === null) {
        return;
      }
      const img = this.dragZoomImg.querySelector('.image img.image__main');
      const swiperObj = this.ele.swiper.target[0].swiper;
      const defaultImage = swiperObj.slides[swiperObj.activeIndex].querySelector('.pd-header-gallery__item-wrap > .first-image') !== null ? swiperObj.slides[swiperObj.activeIndex].querySelector('.pd-header-gallery__item-wrap > .first-image img') : swiperObj.slides[swiperObj.activeIndex].querySelector('.pd-header-gallery__item-wrap > .image img');

      img.style.transform = `scale(${(this.currentZoomStep - 1) / (this.maxZoomStep - 1)})`;
      const imgRect = defaultImage.getBoundingClientRect();
      const orgRect = img.getBoundingClientRect();

      img.style.marginTop = `${(orgRect.height - imgRect.height) / -2}px`;
      if (this.isRtl) {
        img.style.marginRight = `${(orgRect.width - imgRect.width) / -2}px`;
      } else {
        img.style.marginLeft = `${(orgRect.width - imgRect.width) / -2}px`;
      }
    }

    moveZoomImg(offX,offY) {
      const swiperObj = this.ele.swiper.target[0].swiper;
      const img = this.dragZoomImg.querySelector('.image img.image__main');
      const defaultImage = swiperObj.slides[swiperObj.activeIndex].querySelector('.pd-header-gallery__item-wrap > .first-image') !== null ? swiperObj.slides[swiperObj.activeIndex].querySelector('.pd-header-gallery__item-wrap > .first-image img') : swiperObj.slides[swiperObj.activeIndex].querySelector('.pd-header-gallery__item-wrap > .image img');
      const imgRect = defaultImage.getBoundingClientRect();
      const orgRect = img.getBoundingClientRect();

      const maxX = -1 * parseInt(orgRect.width - imgRect.width);
      const maxY = -1 * parseInt(orgRect.height - imgRect.height);
      const $arrowWrap = this.ele.zoomStateIcon;

      let moveY = offY + parseInt(img.style.marginTop || 0,0);
      if (moveY >= 0) {
        moveY = 0;
        $arrowWrap.find('.up').target[0].disabled = true;
        $arrowWrap.find('.down').focus();
      } else if (moveY <= maxY) {
        moveY = maxY;
        $arrowWrap.find('.down').target[0].disabled = true;
        $arrowWrap.find('.up').focus();
      } else {
        $arrowWrap.find('.up[disabled],.down[disabled]').target.forEach((arrow) => {
          arrow.disabled = false;
        });
      }
      img.style.marginTop = `ffX + parseInt(img.style.marginRight || 0,0));
        if (moveX >= 0) {
          moveX = 0;
          $arrowWrap.find('.right').target[0].disabled = true;
          $arrowWrap.find('.left').focus();
        } else if (moveX <= maxX) {
          moveX = maxX;
          $arrowWrap.find('.left').target[0].disabled = true;
          $arrowWrap.find('.right').focus();
        } else {
          $arrowWrap.find('.left[disabled],.right[disabled]').target.forEach((arrow) => {
            arrow.disabled = false;
          });
        }
        img.style.marginRight = `${moveX}px`;
      } else {
        let moveX = (offX + parseInt(img.style.marginLeft || 0,0));
        if (moveX >= 0) {
          moveX = 0;
          $arrowWrap.find('.left').target[0].disabled = true;
          $arrowWrap.find('.right').focus();
        } else if (moveX <= maxX) {
          moveX = maxX;
          $arrowWrap.find('.right').target[0].disabled = true;
          $arrowWrap.find('.left').focus();
        } else {
          $arrowWrap.find('.left[disabled],.right[disabled]').target.forEach((arrow) => {
            arrow.disabled = false;
          });
        }
        img.style.marginLeft = `${moveX}px`;
      }
    }

    showHideArrow(state = true) {
      if(state){
        this.ele.section.find('.swiper-button-prev').target[0].style.opacity = '1';
        this.ele.section.find('.swiper-button-nexte {
        this.ele.section.find('.swiper-button-prev').target[0].style.opacity = '';
        this.ele.section.find('.swiper-button-next').target[0].style.opacity = '';
      }
    }

    focusLock(event) {
      if (event.keyCode === KEY_CODE.TAB) {
        setTimeout(() => {
          if ($q(document.activeElement).closest(this.openPopupData.popup).target.length <= 0) {
            this.hidePopup($q(this.openPopupData.popup));
          }
        }, 30);
      }
    }

    showPopup($popup, btn) {
      if (this.openPopupData !== null) {
        this.hidePopup($q(this.openPopupData.popup));
      }

      this.openPopupData = {
        popup: $popup.target[0],
        btn,
      };

      // ar  inner  focus    
      if ($popup.hasClass('type-ar')) {
        if (!this.statePc) {
          return;
        }
        $popup.addClass('open');

        const inner = $popup.find('.ar-popup-inner');
        inner.attr('tabindex', 0);
        inner.focus();
      } else {
        $popup.addClass('open');

        $popup.attr('tabindex', 0);
        setTimeout(() => {
          $popup.focus();
        }, 500);
      }

      this.ele.section.find(this.selector.popupDim).show();
      this.ele.window.off('keydown', this.handler.focusLock).on('keydown', this.handler.focusLock);

      if ($popup.hasClass('type-video')) {
        $popup.find('div.video').target.forEach((video) => {
          Video.destroy(video);
        });

        $popup.find('.video-contents').css({
          display: 'none',
        });

        const $target = $popup.find(`.video-contents[data-btn-id="${btn.getAttribute('data-btn-id')}"]`);
        $target.show();

        Video.init($target.find('div.video').target[0]);
      }
    }

    hidePopup($popup, moveFocus = true) {
      // $popup.hide();

      // ar  inner  tabindex   
      if ($popup.hasClass('type-ar')) {
        const inner = $popup.find('.ar-popup-inner');
        inner.attr('tabindex', '');
      } else {
        $popup.attr('tabindex', '');
      }

      if ($popup.hasClass('type-360view')) {
        if (this.ele.section.find('.pd-header-gallery__control').css('visibility', 'hidden')) {
          this.ele.section.find('.pd-header-gallery__control').css({
            'visibility': 'visible',
          });
        }
      }

      $popup.removeClass('open');

      this.ele.section.find(this.selector.popupDim).hide();
      this.ele.window.off('keydown', this.handler.focusLock);

      $popup.find('div.video').target.forEach((video) => {
        Video.destroy(video);
      });

      if (moveFocus) {
        this.openPopupData.btn.focus();
      }

      this.openPopupData = null;
    }
  }

  function init() {
    $q(selector.section).target.forEach((element) => {
      if (!PDheaderGallery.instances.has(element)) {
        new PDheaderGallery(element);
      } else {
        const instances =  PDheaderGallery.instances.get(element);
        instances.reInit();
      }
    });
  }

  function reInit() {
    $q(selector.section).target.forEach((element) => {
      if (PDheaderGallery.instances.has(element)) {
        const instances =  PDheaderGallery.instances.get(element);
        instances.reInit();
      } else {
        new PDheaderGallery(element);
      }
    });
  }

  function openNew360Popup() {
    if (document.querySelector('script[data-js360]') === null) {
      const headTag = document.getElementsByTagName('head')[0];
      // todo: chk dupl of css, js
      const links = document.getElementsByTagName('link');
      console.log('links: ', links);
      // console.log('popup360.css exist: ', links.find((link) => link.href === 'resources/css/popup360.css'));

      // todo: insert link tag
      const linkTag = document.createElement('link');
      linkTag.type = 'text/css';
      linkTag.rel = 'stylesheet';
      linkTag.href = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/css/popup360.css';
      headTag.appendChild(linkTag);

      // todo: insert script tag
      const scriptTag = document.createElement('script');
      scriptTag.dataset.js360 = true;
      headTag.appendChild(scriptTag);
      scriptTag.onload = () => {
        // initialize
        // eslint-disable-next-line
        if(window.imgSeqViewer){
          // eslint-disable-next-line
          const imgSeq = new imgSeqViewer('#seqContainer');
          imgSeq.init();

          // eslint-disable-next-line
          const spinImageNewUsData = spinImageNewData[0];
          // eslint-disable-next-line
          const spinImageNewFsData = spinImageNewData[1];
          const spinImageUsDataList = [];
          const spinImageFsDataList = [];
              
          if (spinImageNewUsData != null) {
            if(spinImageNewUsData.unfoldSpinImage != null){
              for(let i = 0; i < spinImageNewUsData.unfoldSpinImage.length; i++){
                spinImageUsDataList.push(spinImageNewUsData.unfoldSpinImage[i].largeImgPath);
              }
            }
          }

          if (spinImageNewFsData != null) {
            if(spinImageNewFsData.foldSpinImage != null){
              for(let i = 0; i < spinImageNewFsData.foldSpinImage.length; i++){
                spinImageFsDataList.push(spinImageNewFsData.foldSpinImage[i].largeImgPath);
              }
            }
          }

          if (spinImageUsDataList.length === 0 || spinImageFsDataList.length === 0) {
            $q('.btn-changetype').hide();
          }

          if (spinImageUsDataList.length === 0) {
            window.componentsGallery360(imgSeq, spinImageFsDataList);
          } else {
            window.componentsGallery360(imgSeq, spinImageUsDataList, spinImageFsDataList);
          }
        } else {
          $q('.pd-header-gallery__layer-popup.type-360view-new .btn-close-popup').trigger('click');
        }
      };
      scriptTag.src = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/js/popupnew360.js';
    } else if(window.imgSeqViewer) {
      triggerEvent(window, 'resize');
      return;
    } else {
      $q('.pd-header-gallery__layer-popup.type-360view-new .btn-close-popup').trigger('click');
    }
  }


  PDheaderGallery.instances = new WeakMap();

  window.sg.components.PDheaderGallery = {
    init,
    reInit,
    openNew360Popup,
  };

  $q.ready(init);
})();

(() => {
  const $q = window.sg.common.$q;
  const commonTab = window.sg.common.tab;
  const swiperManager = window.sg.common.swiperManager;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;
  const scrollbar = window.sg.common.scrollbar;
  const optionSelector = window.sg.commo setMobileFocusLoop = utils.setMobileFocusLoop;
  const removeMobileFocusLoop = utils.removeMobileFocusLoop;

  const selector = {
    section: '.pdd16-step-buying',
  };

  class StepBuying {
    constructor(element) {
      this.el = {
        window: $q(window),
        component: $q(element),
      };

      this.winRect = null;
      this.downOptionScroll = null;
      this.resizeTimer = null;
      this.activeTarget = null;
      this.activeCta = null;

      this.handler = {
        setFix: this.setFix.bind(this),
        resize: this.resize.bind(this),
        resizeSwiper: this.resizeSwiper.bind(this),
        slideChange: this.slideChange.bind(this),
        clickViewIcon: this.clickViewIcon.bind(this),
        checkedCheckbox: this.checkedCheckbox.bind(this),
        clickSelect: (event) => {
          this.clickSelect(event.currentTarget);
        },
        clickMoreBtn: this.clickMoreBtn.bind(this),
        clickTab: () => {
          const idx = this.el.tabBtn.target.indexOf(event.currentTarget);
          this.el.swiper.swiper.slideTo(idx);
        },
        clickFooterBtn: () => {
          this.el.swiper.swiper.slideNext();
        },
        swiperTouchStart: (event) => {
          if (this.isPc) {
            this.el.swiper.swiper.allowTouchMove = false;
          } else if($q(event.target).closest('.option-selector').target.length === 0) {
            this.el.swiper.swiper.allowTouchMove = true;
          }
        },
        optionTouchDown: () => {
          this.el.window.off('mousemove',this.handler.optionTouchMove).on('mousemove',this.handler.optionTouchMove);
          this.el.window.off('touchmove',this.handler.optionTouchMove).on('touchmove',this.handler.optionTouchMove);
          this.el.window.off('mouseup',this.handler.optionTouchUp).on('mouseup',this.handler.optionTouchUp);
          this.el.window.off('touchend',this.handler.optionTouchUp).on('touchend',this.handler.optionTouchUp);
          this.downOptionScroll = this.el.swiper.querySelector('.swiper-slide-active .scrollbar__wrap').scrollLeft;
        },
        optionTouchMove: () => {
          scrollbar.scrollTo(this.el.swiper.querySelector('.swiper-slide-active > .scrollbar'), 0);

          if(this.downOptionScroll !== null && this.el.swiper.swiper.allowTouchMove){ // when dragout .option-selector, allowTouchMove = true
            this.el.swiper.swiper.allowTouchMove = false;
          }
        },
        optionTouchUp: () => {
          this.downOptionScroll = null;
          this.el.window.off('mousemove',this.handler.optionTouchMove);
          this.el.window.off('touchmove',this.handler.optionTouchMove);
          this.el.window.off('mouseup',this.handler.optionTouchUp);
          this.el.window.off('touchend',this.handler.optionTouchUp);
        },
        focusLock: this.focusLock.bind(this),
        closePopup: this.closePopup.bind(this),
        slideChangeTransitionEnd: this.slideChangeTransitionEnd.bind(this),
        slideChangeTransitionStart: this.slideChangeTransitionStart.bind(this),
        slideResetTransitionStart: this.slideResetTransitionStart.bind(this),
      };

      StepBuying.instances.set(element, this);
      this.init();
    }

    setElements() {
      this.el.tabBtn = this.el.component.find('.tab__item-title');
      this.el.swiper = this.el.component.find('.pdd16-step-buying__contents .pdd16-step-buying__card-wrap').target[0];
      this.el.StepSwiper = this.el.component.find('.pdd16-step-buying__add-on-list').target[0];
      this.el.StepSwiperSlide = this.el.component.find('.pdd16-step-buying__add-on-list').find('.swiper-slide');
      this.el.footer = this.el.component.find('.pdd16-step-buying__footer');
      this.el.dummyHeaer = this.el.component.find('.pdd16-step-buying__header__dummy');
      this.el.dummyFooter = this.el.component.find('.pdd16-step-buying__footer__dummy');
      this.el.viewIcon = this.el.component.find('.pdd16-step-buying__list-type > a');
      this.el.selectBtn = this.el.component.find('.pdd16-step-buying__card > button.cta:not(.js-cta-stock), .pdd16is.el.selectNum = this.el.component.find('.pdd16-step-buying__evoucher-list li:first-child .pdd16-step-buying__evoucher-title > span');
      this.el.selectClearAll = this.el.component.find('.cta--clear-all');
      this.el.moreBtn = this.el.component.find('.pdd16-step-buying__view-more');
      this.el.tab = this.el.component.find('.tab');
      this.el.checkbox = this.el.component.find('.pdd16-step-buying__tnc-checkbox.is-required .checkbox-v2 input[type="checkbox"]');

      if (this.el.component.hasClass('pdd16-step-buying--default')) {
        this.el.footerBtn = this.el.component.find('.pdd16-step-buying__footer .cta--step');
      } else {
        this.el.footerBtn = $q([]);
      }

      this.el.popup = this.el.component.find('.pdd16-step-buying__layer-learn-more');
      this.el.closePopupCta = this.el.popup.find('.layer-popup__close');

      this.downOptionScroll = null;

      this.el.component.find('.pdd16-step-buying__card-wrap .swiper-slide').target.forEach((slide) => {
        const showCard = slide.querySelectorAll('.pdd16-step-buying__card:nth-child(-n+6)');
        [...showCard].forEach((card) => {
          card.classList.add('is-show');
        });

        $q(showCard[showCard.length - 1]).find('.pdd16-step-buying__tooltip').css({
          'right': 0,
          'left': 'auto',
        });

        if(slide.querySelectorAll('.pdd16-step-buying__card').length <= 6){
          slide.querySelector('.pdd16-step-buying__view-more').style.display = 'none';
        }

        const icon = slide.querySelectorAll('.pdd16-step-buying__list-type > a');
        if(slide.classList.contains('pdd16-step-buying__2column')){
          icon[0].classList.add('on');
          icon[1].classList.remove('on');
        }else{
          icon[0].classList.remove('on');
          icon[1].classList.add('on');
        }
      });

      this.lastSlideIdx = this.el.StepSwiperSlide.target.length > 0 ? this.el.StepSwiperSlide.target.length - 2 : null;
    }

    init() {
      this.setElements();
      if(this.el.swiper.swiper === undefined){
        swiperManager.slideReInit(this.el.swiper);
      }

      this.resize();
      this.bindEvents();
    }

    reInit() {
      this.setElements();
      window.sg.common.lazyLoad.setLazyLoad();
      if(this.el.swiper.swiper === undefined){
        swiperManager.slideReInit(this.el.swiper);
      } else {
        swiperManager.slideUpdate(this.el.swiper);
      }

      if(this.el.StepSwiper.swiper === undefined){
        swiperManager.slideReInit(this.el.StepSwiper);
      } else {
        swiperManager.slideUpdate(this.el.StepSwiper);
      }

      this.resize();
      this.bindEvents();
    }

    slideChangeTransitionStart() {
      this.el.StepSwiperSlide.addClass('changing');
      this.el.StepSwiperSlide.removeClass('changed');

      if (BREAKPOINTS.MOBILE < utils.getViewPort().width) {
        if (this.el.StepSwiperSlide.eq(this.lastSlideIdx).hasClass('swiper-slide-active')) {
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).addClass('changingend');
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).removeClass('changedend');
        }
      } else {
        if (this.el.StepSwiper.swiper.isEnd) {
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).addClass('changingend');
          this.el.StepSwiperSlide.eq(this.lastSlid32eIdx).removeClass('changedend');
        }
      }
    }

    slideChangeTransitionEnd() {
      if (BREAKPOINTS.MOBILE < utils.getViewPort().width) {
        if (this.el.StepSwiperSlide.eq(this.lastSlideIdx).hasClass('swiper-slide-active')) {
          this.el.StepSwiperSlide.removeClass('changing');
          this.el.StepSwiperSlide.addClass('changed');
          
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).removeClass('changingend');
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).addClass('changedend');
        }
      } else {
        if (this.el.StepSwiper.swiper.isEnd) {
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).removeClass('changingend');
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).addClass('changedend');
        } else {
          this.el.StepSwiperSlide.removeClass('changing');
          this.el.StepSwiperSlide.addClass('changed');
          
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).removeClass('changedend');
        }
      }
      
      this.setAccessbility();
    }

    slideResetTransitionStart() {
      if (BREAKPOINTS.MOBILE >= utils.getViewPort().width) {
        if (this.el.StepSwiper.swiper.isEnd) {
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).addClass('changingend');
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).removeClass('changedend');
        } else {
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).removeClass('changingend');
          this.el.StepSwiperSlide.eq(this.lastSlideIdx).removeClass('changedend');
        }
      }
    }

    setSlideAria(slide, flag) {
      const $slide = $q(slide);
      if (flag === true) {
        $slide.attr('aria-hidden', true);
      } else {
        $slide.attr('aria-hidden', false);
      }
    }

    setAccessbility() { //slide aria-hidden set
      this.el.StepSwiperSlide.target.forEach((item) => {
        if ($q(item).hasClass('swiper-slide-active') || $q(item).hasClass('swiper-slide-next')) {
          this.setSlideAria(item, false);
        } else {
          this.setSlideAria(item, true);
        }
      });
    }

    bindEvents() {
      this.el.window.off('scroll',this.handler.setFix).on('scroll',this.handler.setFix);
      this.el.window.off('resize',this.handler.resize).on('resize',this.handler.resize);

      this.el.tabBtn.off('click',this.handler.clickTab).on('click',this.handler.clickTab);
      this.el.viewIcon.off('click',this.handler.clickViewIcon).on('click',this.handler.clickViewIcon);
      this.el.selectBtn.off('click',this.handler.clickSelect).on('click',this.handler.clickSelect);
      this.clickSelect();

      this.el.footerBtn.off('click',this.handler.clickFooterBtn).on('click',this.handler.clickFooterBtn);

      this.el.moreBtn.off('click',this.handler.clickMoreBtn).on('click',this.handler.clickMoreBtn);

      if(this.el.swiper.swiper !== undefined){
        this.el.swiper.swiper.off('slideChange',this.handler.slideChange);
        this.el.swiper.swiper.off('touchStart',this.handler.swiperTouchStart);
      }
      this.el.swiper.swiper.on('slideChange',this.handler.slideChange);
      this.el.swiper.swiper.on('touchStart',this.handler.swiperTouchStart);
      this.tabActive();
      requestAnimationFrame(() => {
        this.setMaxHeight();
      });

      this.el.component.find('.option-selector').target.forEach((el) => {
        optionSelector.reInit($q(el));
      });

      this.el.component.find('.option-selector__wrap--capacity').target.forEach((el) => {
        const capaSlideLength = $q(el).find('.option-selector__swiper-slide').target.length;

        if (capaSlideLength === 1) {
          $q(el).addClass('option-selector__wrap--capacity-single');
        }
      });

      this.el.component.find('.pdd16-step-buying__card-option').target.forEach((option) => {
        const $option = $q(option);
        $option.off('mousedown').on('mousedown',this.handler.optionTouchDown);
        $option.off('touchstart').on('touchstart',this.handler.optionTouchDown);
      });

      this.el.closePopupCta.off('click',this.handler.closePopup).on('click',this.handler.closePopup);
      if (this.el.StepSwiper && this.el.StepSwiper.swiper !== undefined) {
        this.el.StepSwiper.swiper.off('slideChangeTransitionEnd', this.handler.slideChangeTransitionEnd).on('slideChangeTransitionEnd', this.handler.slideChangeTransitionEnd);
        this.el.StepSwiper.swiper.off('transitipSwiper.swiper.off('slideChangeTransitionStart', this.handler.slideChangeTransitionStart).on('slideChangeTransitionStart', this.handler.slideChangeTransitionStart);
        this.el.StepSwiper.swiper.off('slideResetTransitionStart', this.handler.slideResetTransitionStart).on('slideResetTransitionStart', this.handler.slideResetTransitionStart);

        this.setAccessbility();
      }

      this.el.checkbox.off('change', this.handler.checkedCheckbox).on('change', this.handler.checkedCheckbox);
    }

    checkedCheckbox(){
      const checkbox = this.el.checkbox.target.length;
      const checked = this.el.component.find('.pdd16-step-buying__tnc-checkbox.is-required .checkbox-v2 input[type="checkbox"]:checked').target.length;
      const stepButton = this.el.component.find('.cta--step');
      if (checkbox === checked) {
        stepButton.removeClass('cta--disabled');
        stepButton.removeAttr('disabled');
      } else {
        stepButton.addClass('cta--disabled');
        stepButton.attr('disabled', 'true');
      }
    }

    clearAll(){
      this.el.component.find('.pdd16-step-buying__card > .cta--contained.cta--on:not([disabled])').trigger('click');
    }

    clickMoreBtn(event){
      const $more = $q(event.currentTarget).closest('.pdd16-step-buying__view-more');
      const $wrap = $more.closest('.swiper-slide');
      const $cards = $wrap.find('.pdd16-step-buying__card');
      const $hideCard = $wrap.find('.pdd16-step-buying__card:not(.is-show)');

      $more.css({
        display: 'none',
      });
      $cards.addClass('is-show');

      this.setMaxHeight();
      $hideCard.find('.option-selector').target.forEach((el) => {
        optionSelector.reInit($q(el));
      });
      this.resizeSwiper();

      $cards.eq(5).find('.pdd16-step-buying__tooltip').css({
        'right': '',
        'left': '',
      });
      $cards.eq($cards.target.length - 1).find('.pdd16-step-buying__tooltip').css({
        'right': 0,
        'left': 'auto',
      });
    }

    clickSelect(btn = null , noActive = null){
      if(btn !== null){
        if(noActive === null){
          noActive = !btn.classList.contains('cta--on');
        }
        if (noActive) {
          btn.classList.add('cta--on');
          $q(btn).find('span').innerHTML(btn.dataset.textSelected);
        } else {
          btn.classList.remove('cta--on');
          $q(btn).find('span').innerHTML(btn.dataset.text);
        }
      }
      if (this.el.selectNum.target.length > 0) {
        const selectLenght = this.el.component.find('.pdd16-step-buying__card > .cta--contained.cta--on').target.length;
        t slideChange(){
      this.tabActive();
      requestAnimationFrame(() => {
        this.setMaxHeight();
      });
    }

    clickViewIcon(event){
      const $click = $q(event.currentTarget);
      const $btns = $click.closest('.pdd16-step-buying__list-type').find('a');
      const $content = $click.closest('.swiper-slide');

      $btns.removeClass('on');
      $click.addClass('on');

      if(event.currentTarget.getAttribute('aria-label') === '1column'){
        $content.removeClass('pdd16-step-buying__2column');
        $content.addClass('pdd16-step-buying__1column');
        $content.find('.option-selector__wrap--color-chip').attr('data-mobile-view',5);
        $content.find('.option-selector__wrap--capacity').attr('data-mobile-view',2);
      }else{
        $content.removeClass('pdd16-step-buying__1column');
        $content.addClass('pdd16-step-buying__2column');
        $content.find('.option-selector__wrap--color-chip').attr('data-mobile-view',4);
        $content.find('.option-selector__wrap--capacity').attr('data-mobile-view',1);
      }

      $content.find('.option-selector').target.forEach((el) => {
        optionSelector.reInit($q(el));
      });

      this.setMaxHeight();
      this.resizeSwiper();
    }

    resizeSwiper(){
      $q(this.el.swiper).find('.swiper-container, .swiper-wrapper, .swiper-slide').css({
        height: '',
      });
      [...this.el.component.find('.scrollbar').target].forEach((bar) => {
        scrollbar.resize(bar);
      });
      this.el.swiper.swiper.emit('resize');
    }

    sameHeightPc($cardWrap,selector,getReturn = false){
      let heightAll = 0;
      const $sameEl = $cardWrap.find(selector);

      $sameEl.target.forEach((sameEl) => {
        const height = sameEl.getBoundingClientRect().height;

        if (heightAll < height) {
          heightAll = height;
        }
      });

      if(getReturn){
        return heightAll;
      } else {
        $sameEl.css({
          height: `${heightAll}px`,
        });
      }
    }

    optionOneLinePC($nowSlide) {
      const showing = $nowSlide.find('.pdd16-step-buying__card.is-show');
      let itemMaxCount = 0;
      showing.target.forEach((card) => {
        const count = card.querySelectorAll('.option-selector__wrap--color-chip, .option-selector__wrap--capacity').length;
        if (itemMaxCount < count) {
          itemMaxCount = count;
        }
      });
      if (itemMaxCount < 2) {
        if (showing.find('.option-selector__wrap--color-chip').target.length === 0) {
          $nowSlide.find('.scrollbar__contents').addClass('none-color-chip');
        } else {
          $nowSlide.find('.scrollbar__contents').addClass('single-chip');
        }
      }
    }

    optionOneLineMo(cardLeft, cardRight = null) {
      const optionSel = '.option-selector__wrap--color-chip, .option-selector__wrap--capacity';
      let itemMaxCount = null;
      let pairCards = null;

      if(cardRight === null){//last card
        itemMaxCount = cardLeft.querySelectorAll(optionSel).length;
        pairCards = $q(cardLeft);
      } else {
        const optionLeft = cardLeft.querySelectorAll(optionSel);
        const optionRight = cardRight.querySelectorAll(optionSel);
        itemMaxCount = Math.max(optionLeft.length,optionRight.length);
        pairCards = $q([cardLeft, cardRight]);
      }

      if (itemMaxCount < 2) {
        const isNoColor = pairCards.find('.option-selector__wrap--color-chip').target.length === 0;
        if (isNoColor) {
          pairCards.find('.option-selector').addClass('none-color-chip');
        } else {
          pairCards.find('.option-selector').addClass('single-chip');
        }
      }
    }

    setMaxHeight(){
      let $nowSlide = $q(this.el.swiper).find('.swiper-slide-active');
      if($nowSlide.target.length === 0){
        $nowSlide = this.el.component.find('.pdd16-step-buying__tab').eq(0);
      }

      const selectorCard = '.pdd16-step-buying__card';
      const selectorBadge = '.pdd16-step-buying__card-badge';
      const selectorOption = '.pdd16-step-buying__card-option';
      const selectorSeller = '.pdd16-step-buying__card-seller';
      const selectorTopBadge = '.pdd16-step-buying__card-header-badge';
      const selectorPrice = '.pdd16-step-buying__card-price';
      const selectorCta = '.pdd16-step-buying__card-cta';
      const $swiperEl = $q(this.el.swiper);

      $nowSlide.find(`${selectorCard}, ${selectorBadge}, ${selectorOption}, ${selectorSeller}, ${selectorTopBadge}, ${selectorPrice}, ${selectorCta}, .pdd16-step-buying__view-more`).css({
        height: '',
      });
      $swiperEl.find('.none-color-chip').removeClass('none-color-chip');
      $swiperEl.find('.single-chip').removeClass('single-chip');

      if (this.isPc) {
        this.optionOneLinePC($nowSlide);
        this.sameHeightPc($nowSlide,selectorBadge);
        this.sameHeightPc($nowSlide,selectorOption);
        this.sameHeightPc($nowSlide,selectorSeller);
        this.sameHeightPc($nowSlide,selectorTopBadge);
        this.sameHeightPc($nowSlide,selectorPrice);
        this.sameHeightPc($nowSlide,selectorCta);

        const cardHeight = this.sameHeightPc($nowSlide,selectorCard,true);
        $nowSlide.find('.pdd16-step-buying__view-more').css({
          height: `${cardHeight}px`,
        });
        $nowSlide.find('.pdd16-step-buying__card').css({
          height: `${cardHeight}px`,
        });
      } else {
        if($nowSlide.target[0].classList.contains('pdd16-step-buying__2column') === false){
          return;
        }

        const $cards = $nowSlide.find('.pdd16-step-buying__card.is-show');
        $cards.target.forEach((card, idx) => {
          if (idx % 2 === 0) {
            return;
          }

          const cardLeft = $cards.target[idx - 1];
          const cardRight = card;

          this.optionOneLineMo(cardLeft,cardRight);

          [selectorOption,selectorBadge,selectorSeller,selectorTopBadge,selectorPrice, selectorCard, selectorCta].forEach((sameSel) => { // sameHeight Mobile
            let sameLeft = cardLeft.querySelector(sameSel);
            let sameRight = cardRight.querySelector(sameSel);

            if (sameSel === selectorCard) {
              sameLeft = cardLeft;
              sameRight = cardRight;
            }

            if(sameLeft !== null && sameRight !== null){
              const max = Math.max(sameLeft.getBoundingClientRect().height, sameRight.getBoundingClientRect().height);
              sameLeft.style.height = `${max}px`;
              sameRight.style.height = `${max}px`;
            }
          });
        });

        if(($cards.target.length - 1) % 2 === 0){
          this.optionOneLineMo($cards.target[$cards.target.length - 1],null);
        }
      }
    }

    tabActive(){
      const swiperObj = this.el.swiper.swiper;
      const slideEl = this.el.component.find('.pdd16-step-buying__tab').target;
      if (swiperObj === undefined) {
        this.el.footerBtn.text(this.el.swiper.querySelector('.swiper-slide').dataset.buttonText);
      } else {
        this.el.footerBtn.text(slideEl[swiperObj.activeIndex].dataset.buttonText);
      }
      commonTab.selectTab(this.el.tab.target[0],swiperObj.activeIndex);
    }

    resize(){
      this.winRect = utils.getViewPort();
      this.el.dummyHeaer.css({
        height: `${this.el.component.find('.pdd16-step-buying__header').offset().height}px`,
      } utils.getViewPort().widththis.setMaxHeight();
      }

      if(this.isPc){
        if(this.el.swiper.swiper.allowTouchMove){
          this.el.swiper.swiper.allowTouchMove = false;
          this.offFix();
        }
      }else{
        if(this.el.swiper.swiper.allowTouchMove !== true){
          this.el.swiper.swiper.allowTouchMove = true;
        }

        if (this.el.component.find('.pdd16-step-buying__add-on-list .swiper-slide').target.length === 1) {
          this.el.component.find('.pdd16-step-buying__add-on-list').addClass('is-full');
        }
      }
      const $footer = this.el.component.find('.pdd16-step-buying__footer');
      this.el.dummyFooter.css({
        height: `${$footer.offset().height + parseInt(window.getComputedStyle($footer.target[0]).marginTop)}px`,
      });
      if (this.activeTarget !== null) {
        this.popupResize();
      }

      clearTimeout(this.resizeTimer);
      this.resizeTimer = null;
      this.resizeTimer = setTimeout(() => {
        this.resizeSwiper();
      },200);
    }

    offFix(){
      this.el.footer.removeClass('pdd16-step-buying__footer--fixed');
      this.el.component.removeClass('pdd16-step-buying--floating');
    }

    setFix(){
      const off = this.el.component.offset();

      if(this.isPc){
        return;
      }

      if(off.top < 0 && off.bottom > this.winRect.height){
        if(!this.el.component.hasClass('pdd16-step-buying--floating')){
          this.el.component.addClass('pdd16-step-buying--floating');
        }
        if(!this.el.footer.hasClass('pdd16-step-buying__footer--fixed')){
          this.el.footer.addClass('pdd16-step-buying__footer--fixed');
        }
      } else {
        if(this.el.component.hasClass('pdd16-step-buying--floating')){
          this.el.component.removeClass('pdd16-step-buying--floating');
        }
        if(this.el.footer.hasClass('pdd16-step-buying__footer--fixed')){
          this.el.footer.removeClass('pdd16-step-buying__footer--fixed');
        }
      }
    }

    focusLock(e) {
      if (e.keyCode === libs.keyCode.TAB_KEY) {
        let firstEl = null;

        if (this.activeTarget.find('.swiper-slide').target.length > 1) {
          if (this.activeTarget.find('.swiper-button-prev').hasClass('swiper-button-disabled')) {
            firstEl = this.activeTarget.find('.swiper-button-next').target[0];
          } else {
            firstEl = this.activeTarget.find('a, button, input:not([type="hidden"]), textarea').target[0];
          }
        } else {
          firstEl = this.activeTarget.find('a, button:not([tabindex="-1"]), input:not([type="hidden"]), textarea').target[0];
        }

        if (e.shiftKey === false && this.el.closePopupCta.target[0] === document.activeElement) {
          e.preventDefault();
          firstEl.focus();
        } else if (e.shiftKey === true && firstEl === document.activeElement) {
          e.preventDefault();
          this.el.closePopupCta.focus();
        } else if (e.shiftKey === true && this.activeTarget.target[0] === document.activeElement) {
          e.preventDefault();
          this.el.closePopupCta.focus();
        }
      }
    }

    activePopup(focusEl) {
      if (focusEl) {
        this.activeCta = $q(focusEl);
        selector.setFocus = focusEl;
      }

      utils.hiddenScroll();

      this.activeTarget = this.el.popup;
      this.activeTarget.show();
      this.activeTarget.on('keydown', this.handler.focusLock);

      swiperManager.slideUpdate(this.activeTarget.find('.basic-swiper').target[0]);
      swiperManager.slideReInit(this.activeTarget.find('.basic-swiper').target[0]);

      let focusableEl = null;

      if (this.activeTarget.find('.swiper-slide').target.length > 1) {
        focusableEl = this.activeTarget.find('.swiper-button-next').target[0];
      } else {
        this.activeTarget.find('.swiper-button-prev').attr('tabindex', '-1');
        this.activeTarget.find('.swiper-button-next').attr('tabindex', '-1');
        focusableEl = this.activeTarget.find('a, button:not([tabindex="-1"]), input:not([type="hidden"]), textarea').target[0];
      }
      focusableEl.focus();

      if (document.querySelectorAll('[data-aria-hidden]').length <= 0) {
        setMobileFocusLoop(this.activeTarget.target[0]);
      }

      this.popupResize();
    }

    closePopup(){
      utils.visibleScroll();
      if (document.querySelectorAll('[data-aria-hidden]').length > 0) {
        removeMobileFocusLoop();
      }

      if (this.activeCta !== null) {
        this.activeCta.focus();
      }

      this.activeTarget.hide();
      this.activeTarget.off('keydown', this.handler.eventFocusLock);
      $q(this.activeCta).focus();


      this.activeTarget.find('.swiper-button-prev').removeAttr('tabindex');
      this.activeTarget.find('.swiper-button-next').removeAttr('tabindex');

      this.popupResize(false);
      this.activeCta = null;
      this.activeTarget = null;
    }

    popupResize(open = true) {
      const documentHeight = document.documentElement.clientHeight;
      const popupInner = this.activeTarget.find('.layer-popup__inner');
      const popupScroll = this.activeTarget.find('.scrollbar');
      const popupScrollWrap = this.activeTarget.find('.scrollbar__wrap');

   leHeight = popupScrollWrap.target[0].getBoundingClientRect();
          const calcHeight = parseInt(documentHeight - titleHeight.top);
          popupInner.css({
            'min-height': '',
          });
          popupScroll.css({
            'height': `${calcHeight}px`,
          });
        } else {
          if (documentHeight <= popupInner.target[0].getBoundingClientRect().height) {
            popupInner.css({
              'min-height': `${documentHeight}px`,
              'height': `${documentHeight}px`,
            });

            const wrapHeight = popupInner.target[0].getBoundingClientRect();
            const titleHeight = popupScrollWrap.target[0].getBoundingClientRect();
            const calcHeight = parseInt(wrapHeight.hel.css({
              'height': `${calcHeight}px`,
            });
          } else {
            popupInner.css({
              'min-height': '',
              'height': '',
            });
            popupScroll.css({
              'height': '',
            });
          }
        }
        setTimeout( () => {
          scrollbar.resize(popupScroll.target[0]);
        }, 300);
      } else {
        popupInner.css({
          'min-height': '',
          'height': '',
        });
        popupScroll.css({
          'height': '',
        });
      }
    }
  }

  // window.sg.components.stepbuying.init({visibleScrollTop: true});   ) pd03 quick veiw popup open  init  
  const init = (option = {
    visibleScrollTop: true,
  }) => {
    $q(selector.section).target.forEach((element) => {
      $q(element).find('.tab').target.forEach((tb) => {
        commonTab.init(tb);
      });

      if (StepBuying.instances.has(element)) {
        StepBuying.instances.get(element).reInit();
      } else {
        new StepBuying(element);
      }

      $q(element).find('.scrollbar').target.forEach((tb) => {
        scrollbar.reInit(tb);
      });
    });

    if (option.visibleScrollTop) {
      utils.visibleScroll();
      window.scrollTo(0, 0);
    }
  };
  /**
  //  @param       : focus element(value of id attribute)
  //  @description : set focus when closed Popup.
  //  @example : window.sg.components.stepbuying.activePopup(document.querySelector('#id'))
  **/
  const activePopup = (focusEl) => {
    $q(selector.section).target.forEach((element) => {
      if (StepBuying.instances.has(element)) {
        const instances =  StepBuying.instances.get(element);
        instances.activePopup(focusEl);
      }
    });
  };

  function closePopup() {
    $q(selector.section).target.forEach((element) => {
      if (StepBuying.instances.has(element)) {
        const instances =  StepBuying.instances.get(element);
        instances.closePopup();
      }
    });
  }


  StepBuying.instances = new WeakMap();

  $q.ready(init);

  window.sg.components.stepbuying = {
    init,
    clearAll(element){
      if (StepBuying.instances.has(element)) {
        StepBuying.instances.get(element).clearAll();
      }
    },
    cardSelect(btn,active = null){
      const section = $q(btn).closest(selector.section).target[0];
      if (StepBuying.instances.has(section)) {
        StepBuying.instances.get(section).clickSelect(btn,active);
      }
    },
    activePopup,
    closePopup,
  };
})();

(() => {
  const $q = window.sg.common.$q;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;

  const selector = {
    ProductDetailKv: '.product-detail-kv',
    pdBuyingTool: '.pd-select-option',
    checkOut: 'a.cta--contained.checkOut',
    productGallery: '.product-detail-kv .product-detail-kv__gallery-area',
    optionItem: '.pd-select-option__item',
    usEppDiscount: '.us-epp-discount',
  };

  class ProductDetailKv {
    constructor(component) {
      this.selector = {
        section: selector.ProductDetailKv,
        gallery: '.product-detail-kv__gallery-area',
        textField: '.pd-select-option__input-wrap',
        textFieldInput: 'input[type="text"]',
        textFieldClose: '.text-field__text-cancel',
        option: '.option-result',
        optionCloseBtn: '.option-result .option-result__close',
        pdBanner: '.pd-banner',
        tooltipLayer: '.pd-info__sku-layer, .option-result__tooltip',
        tooltipBtn: '.pd-info__sku.option-result__tooltip-close',
      };

      this.ele = {
        window: $q(window),
        section: $q(component),
        gallery: null,
        textFieldInput: null,
        textFieldClose: null,
        optionCloseBtn: null,
        pdBanner: null,
        tooltipLayer: null,
        tooltipBtn: null,
        tooltipClose: null,
        usEppDiscount: null,
      };

      this.isUsEppDiscount = null;
      this.statePc = BREAKPOINTS.MOBILE < utils.getViewPort().width;
      this.resizeTimer = null;
      this.scrollTimer = 0;
      this.scrollOffGallery = false;
      this.popupData = {};

      this.setProperty();

      this.galleryRect = {
        height: null, //gallery height
        start: null, //gallery fix start scrollTop
        padding: null, //when fix, Prevents the content from moving
        attach: null, //when fix, offset navi & banner height
        end: null, //gallery fix end scrollTop
        mode: null, //now fixed state
        resizeTimer: null,
      };

      this.handler = {
        scroll: this.scroll.bind(this),
        resize: this.resize.bind(this),
        optionClose: (event) => {
          this.optionClose(event.currentTarget);
        },
        outClickTooltip: (event) => {
          const $nowClick = $q(event.target);
          this.ele.tooltipLayer.target.forEach((layer) => {
            const $layer = $nowClick.closest(layer);
            if($layer.target.length === 0){
              this.tooltipToggle($layer, false);
            }
          });
        },
        closeBezelPopup: this.closeBezelPopup.bind(this),
        clickCounter: (event) => {
          const $wrap = $q(event.currentTarget).closest('.pd-select-option__counter');
          const $numEl = $wrap.find('.pd-select-option__counter--number');
          let num = parseInt($numEl.target[0].value);
          if (event.currentTarget.classList.contains('icon-minus')) {
            num = num > 1 ? --num : 1;
          } else {
            num = num < 999 ? ++num : 999;
          }
          $numEl.attr('value', num);
          $numEl.target[0].value = num;
        },
        inputCounterNum: (event) => {
          event.target.setAttribute('value', event.target.value);
        },
      };

      ProductDetailKv.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.gallery = this.ele.section.find(this.selector.gallery);
      this.ele.textFieldInput = this.ele.section.find(this.selector.textFieldInput);
      this.ele.textFieldClose = this.ele.section.find(this.selector.textFieldClose);
      this.ele.optionCloseBtn = this.ele.section.find(this.selector.optionCloseBtn);
      this.ele.pdBanner = $q(this.selector.pdBanner);
      this.ele.tooltipLayer = this.ele.section.find(this.selector.tooltipLayer);
      this.ele.tooltipBtn = this.ele.section.find(this.selector.tooltipBtn);
      this.ele.tooltipClose = this.ele.section.find(this.selector.tooltipClose);
      this.ele.usEppBar = $q('.gnb .epp-bar-wrap');
      this.ele.usEppDiscount = $q(selector.usEppDiscount);
      this.ele.counterBtn = this.ele.section.find('.pd-select-option__counter .pd-select-option__counter--btn');
      this.ele.counterNum = this.ele.section.find('.pd-select-option__counter--number');


      this.isUsEppDiscount = this.ele.usEppDiscount.target.length !== 0 && window.sg.components.usEppDiscount !== undefined;

      this.ele.optionCloseBtn.attr('href', 'javascript:void(0);');
    }

    resize() {
      this.statePc = BREAKPOINTS.MOBILE < utils.getViewPort().width;
      this.galleryRect.mode = null;

      this.setGalleryRect();
      this.setGalleryTop();

      clearTimeout(this.resizeTimer);
      this.resizeTimer = null;
      this.resizeTimer = setTimeout(() => {
        this.galleryRect.mode = null;

        this.setGalleryRect();
        this.setGalleryTop();
      }, 400);
    }

    scroll() {
      const nowTime = (new Date()).getTime();
      if (nowTime > this.scrollTimer) {
        this.isUsEppDiscount = this.ele.usEppDiscount.target.length !== 0 && window.sg.components.usEppDiscount !== undefined;
        this.scrollTimer = nowTime + 500;
        this.galleryRect.mode = null;
        this.setGalleryRect();
      }

      this.setGalleryTop();
    }

    changeTextField(event) {
      const $textFieldClose = $q(event.target).closest(this.selector.textField).find(this.selector.textFieldClose);
      if (event.target.value.trim() !== '') {
        $textFieldClose.show();
      } else {
        $textFieldClose.hide();
      }
    }

    clearTextField(event) {
      const $textFieldInput = $q(event.target).closest(this.selector.textField).find(this.selector.textFieldInput);
      $textFieldInput.target[0].value = '';
      $q(event.target).hide();
    }

    setGalleryRect() {
      const top = document.body.scrollTop || document.documentElement.scrollTop;

      this.galleryRect.height = this.ele.gallery.find('.pd-header-gallery').height();

      if (this.statePc) {
        this.ele.section.find('.pd-buying-tool').css({
          minHeight: `${this.galleryRect.height}px`,
        });
      } else {
        this.ele.section.find('.pd-buying-tool').css({
          minHeight: '',
        });
      }

      if (window.sg.components.pdHeaderNavigation) {
        const naviRect = window.sg.components.pdHeaderNavigation.getRect();
        let calcHeight;
        let calcOffTop;
        if (naviRect.height === undefined || naviRect.height === null) {
          calcHeight = parseFloat($q('.pd-header-navigation__dummy').height().toFixed(2));
        } else {
          calcHeight = naviRect.height;
        }

        if (naviRect.offTop === undefined || naviRect.offTop === null) {
          const eppDisHeight = (this.isUsEppDiscount ? this.ele.usEppDiscount.offset().height : 0);
          const eppBarHeight = (this.ele.usEppBar.target.length > 0 ? this.ele.usEppBar.offset().height : 0);
          calcOffTop = parseFloat((eppBarHeight + eppDisHeight).toFixed(2));
        } else {
          calcOffTop = naviRect.offTop;
        }
        this.galleryRect.start = naviRect.start || 0;
        this.galleryRect.padding = calcHeight + calcOffTop;
        this.galleryRect.attach = top + this.ele.section.offset().bottom - this.galleryRect.height;
        this.galleryRect.end = this.galleryRect.attach - calcHeight;
      } else {
        this.galleryRect.start = top + this.ele.section.offset().top;
        this.galleryRect.padding = 0;
        this.galleryRect.end = top + this.ele.section.offset().bottom - this.galleryRect.height;
        this.galleryRect.attach = this.galleryRect.end;
      }

      if (this.statePc) {
        if (this.ele.pdBanner.target.length > 0) {
          this.galleryRect.start += (this.ele.pdBanner.height() >= 0 ? this.ele.pdBanner.height() : 0);
        }
      }

      if (this.isUsEppDiscount) {
        this.galleryRect.end -= Math.max(0,this.ele.usEppDiscount.height() || 0);
        this.galleryRect.end -= Math.max(0,this.ele.usEppBar.height() || 0);
      }
    }

    scrollGalleryOff(state) {
      if (state) {
        this.setGalleryTop(0);
        this.scrollOffGallery = state;
      } else {
        this.scrollOffGallery = state;
        this.resize();
      }
    }

    setGalleryTop(top = document.body.scrollTop || document.documentElement.scrollTop) {
      if (this.scrollOffGallery) {
        return;
      }

      if (!this.statePc) {
        if (this.galleryRect.mode !== 'mobile') {
          this.ele.section.removeClass('product-detail-kv--fixed');
          this.ele.gallery.css({
            position: '',
            top: '',
          });

          this.galleryRect.mode = 'mobile';
        }
      } else if (top > this.galleryRect.end) {
        if (this.galleryRect.mode === 'end') {
          return;
        }

        this.setGalleryRect();

        this.ele.section.addClass('product-detail-kv--fixed');
        this.ele.gallery.css({
          position: 'absolute',
          top: `${this.galleryRect.attach - parseInt(document.body.style.top || 0)}px`,
        });

        this.galleryRect.mode = 'end';
      } else if (top > this.galleryRect.start) {
        if (this.galleryRect.mode === 'start') {
          return;
        }

        this.ele.section.addClass('product-detail-kv--fixed');
        this.ele.gallery.css({
          position: 'fixed',
          top: `${this.galleryRect.padding - 1}px`,
        });

        this.galleryRect.mode = 'start';

      ass('product-detail-kv--fixed');
        this.ele.gallery.css({
          position: '',
          top: '',
        });

        this.galleryRect.mode = 'none';
      }
    }

    optionClose(btn) {
      const $wrap = $q(btn).closest(this.selector.option);
      if ($wrap.target[0].style.display === 'none') {
        return;
      }

      const $inputWrap = $q($wrap.target[0].previousElementSibling);
      if ($inputWrap.hasClass('pd-select-option')) {
        const $input = $inputWrap.find('input.option-result-focus, .text-field input[type="text"]');
        const type = $input.attr('type');
        if (type === 'radio') {
          if ($input.target[0].checked !== true) {
            $input.target[0].checked = true;
            $input.trigger('change');
          }
        } else if (type === 'text') {
          $input.target[0].value = '';
          $input.focus();
        }
      }

      $wrap.stop().slideUp(600, () => {
        $wrap.hide();
        window.sg.components.productDetailKv.resize();
      });
    }

    init() {
      this.bindEvents();
      this.resize();
    }

    reInit() {
      this.setProperty();
      this.bindEvents();
      this.resize();
    }

    tooltipToggle($layer,isShow) {
      if (isShow) {
        $layer.show();
        $layer.attr('tabindex', 0);
        $layer.focus();
        this.ele.window.off('click', this.handler.outClickTooltip).on('click', this.handler.outClickTooltip);
      } else {
        $layer.hide();
        this.ele.window.off('click', this.handler.outClickTooltip);
      }
    }

    openBezelPopup(btn) {
      this.popupData = {
        btn,
        popup: $q(`#${btn.dataset.targetPopup}`),
      };

      this.popupData.popup.css({
        display: 'block',
      });

      this.popupData.popup.setLayerFocus('.layer-popup__close', '.layer-popup__close', false);
      utils.setMobileFocusLoop(this.popupData.popup.target[0]);
      utils.hiddenScroll();
      window.sg.common.scrollbar.resize(this.popupData.popup.find('.scrollbar').target[0]);

      this.popupData.popup.find('.layer-popup__close').off('click',this.handler.closeBezelPopup).on('click',this.handler.closeBezelPopup);
      if (window.sg.common.layerPopupMaxHeight.init(this.popupData.popup.target[0]) === null) {
        window.sg.common.layerPopupMaxHeight.setMax(this.popupData.popup.target[0]);
      }
    }

    closeBezelPopup() {
      this.popupData.popup.css({
        display: '',
      });

      this.popupData.popup.offLayerFocus();
      utils.removeMobileFocusLoop();
      utils.visibleScroll();
      this.popupData.btn.focus();

      this.p  }

    bindEvents() {
      this.ele.textFieldInput.off('keyup').on('keyup', this.changeTextField.bind(this));
      this.ele.textFieldClose.off('click').on('click', this.clearTextField.bind(this));
      this.ele.counterBtn.off('click', this.handler.clickCounter).on('click', this.handler.clickCounter);
      this.ele.counterNum.off('input', this.handler.inputCounterNum).on('input', this.handler.inputCounterNum);

      this.ele.window.off('scroll', this.handler.scroll).on('scroll', this.handler.scroll);
      this.ele.window.off('resize', this.handler.resize).on('resize', this.handler.resize);

      this.ele.tooltipBtn.off('click').on('click', (event) => {
        const $layer = $q((event.currentTarget || event.target).parentNode).find(this.selector.tooltipLayer);
        setTimeout(() => {
          this.tooltipToggle($layer, true);
        }, 30);
      });

      this.ele.tooltipBtn.off('keydown').on('keydown', (event) => {
        const $layer = $q((event.currentTarget || event.target).parentNode).find(this.selector.tooltipLayer);
        if (event.keyCode === window.sg.common.constants.KEY_CODE.ENTER) {
          setTimeout(() => {
            this.tooltipToggle($layer, true);
          }, 30);
        }
      });

      this.ele.tooltipClose.off('click').on('click', (event) => {
        const $layer = $q(event.currentTarget || event.target).closest(this.selector.tooltipLayer);
        this.tooltipToggle($layer, false);
        $layer.target[0].parentNode.querySelector(this.selector.tooltipBtn).focus();
      });

      this.ele.tooltipLayer.off('focusout').on('focusout', (event) => {
        setTimeout(() => {
          const $layer = $q(event.currentTarget || event.target).closest(this.selector.tooltipLayer);
          if ($q(document.activeElement).closest($layer.target[0]).target.length === 0) {
            this.tooltipToggle($layer, false);
          }
        }, 30);
      });
    }

    static callResize() {
      $q(selector.ProductDetailKv).target.forEach((element) => {
        if (ProductDetailKv.instances.has(element)) {
          const instances =  ProductDetailKv.instances.get(element);
          instances.resize();
        }
      });
    }
  }

  class PDbuyingTool {
    constructor(component) {
      this.selector = {
        section: selector.pdBuyingTool,
        optionBox: '.pd-option-selector__label',
        radio: 'input[type="radio"]',
        sameText: '.pd-option-selector__text-wrap',
        sameColor: '.pd-option-selector__label',
        sameColorTitle: '.pd-option-selector__text-wrap',
        message: '.pd-select-option__alert-message',
        disclaimer: '.pd-select-option__item-disclaimer, .pd-select-option__item-info',
        offsetMesage: '.pd-select-option__wrap',
      };

      this.ele = {
        window: $q(window),
        section: $q(component),
        same: null,
        sameColorTitle: null,
        optionBox: null,
        radio: null,
        offsetMesage: null,
      };

      this.stateColor = this.ele.section.find('.pd-select-option__list--color .pd-option-selector__promotion-text').target.length > 0;
      this.showMessageEl = null;
      this.changeBeforChecked = null;
      this.stateWide = null;

      this.setProperty();

      this.handler = {
        resize: this.resize.bind(this),
        click: (event) => {
          if (this.ele.section.hasClass('off-change')) {
            this.changeBeforChecked = this.ele.section.target[0].querySelector(`${selector.optionItem} input:checked`);

            return;
          }
          const item = $q(event.currentTarget).closest(selector.optionItem).target[0];
          this.showMessage(item);
        },
        change: (event) => {
          if (this.changeBeforChecked !== null) {
            this.changeBeforChecked.checked = true;
            this.changeBeforChecked = null;

            return;
          }

          this.changeSelect(event.target);
        },
      };

      PDbuyingTool.instances.set(component, this);

      this.init();
    }

    triggerChange(btn) {
      this.changeBeforChecked = null;
      btn.checked = true;
      this.showMessage($q(btn).closest(selector.optionItem).target[0], false, true);
      this.changeSelect(btn);
    }

    setProperty() {
      if (this.stateColor) {
        this.ele.same = this.ele.section.find(this.selector.sameColor);
        this.ele.sameColorTitle = this.ele.section.find(this.selector.sameColorTitle);
      } else {
        this.ele.same = this.ele.section.find(this.selector.sameText);
      }

      this.ele.optionBox = this.ele.section.find(this.selector.optionBox);
      this.ele.radio = this.ele.section.find(this.selector.radio);
      this.ele.offsetMesage = this.ele.section.find(this.selector.offsetMesage);

      this.careMotion = this.ele.offsetMesage.find('.pd-select-option__list--samsung-care').target.length > 0;
      this.stateWide = this.ele.section.find('.pd-select-option__list--wide').target.length > 0;
    }

    init() {
      this.bindEvents();
      this.resize();
    }

    reInit() {
      this.setProperty();
      this.bindEvents();
      this.resize();
    }

    bindEvents() {
      this.ele.optionBox.off('click', this.handler.click).on('click', this.handler.click);
      this.ele.radio.off('change', this.handler.change).on('change', this.handler.change);

      this.ele.window.off('resize', this.handler.resize).on('resize', this.handler.resize);
    }

    resize() {
      if (this.stateColor) {
        this.sameHeight(this.ele.sameColorTitle);
      }

      this.sameHeight(this.ele.same);

      if (this.showMessageEl !== null && !this.careMotion) {
        this.showMessageEl.finish();
        this.ele.offsetMesage.finish().css({
          paddingBottom: `${this.showMessageEl.height() + parseFloat(this.showMessageEl.css('margin-top'))}px`,
        });
      }
    }

    sameHeight($same) {
      if ($same.target.length <= 0 || this.stateWide) {
        return;
      }

      let lineTop = Math.round($same.target[0].getBoundingClientRect().top);
      let max = 0;
      let cellCount = 0;

      $same.css({
        height: '',
      });

      $same.target.forEach((el, index) => {
        const rect = el.getBoundingClientRect();
        const cellTop = Math.round(rect.top);

        if (index !== 0 && cellTop !== lineTop) {//set Height
          $q($same.target.slice(index - cellCount, index)).css({
            height: `${max}px`,
          });

          lineTop = cellTop;
          max = 0;
          cellCount = 0;
        }

        if (rect.height > max) {
          max = rect.height;
        }

        cellCount++;
      });

      if (cellCount > 1) {
        //set Height
        $q($same.target.slice($same.target.length - cellCount)).css({
          height: `${max}px`,
        });
      }

      ProductDetailKv.callResize();
    }

    changeSelect(btn) {
      const $btn = $q(btn).closest(selector.optionItem);
      this.ele.section.find(selector.optionItem).removeClass('selected');
      $btn.addClass('selected');
    }

    /**
     * @param {element} item
     * @param {number} alertFirst true  , false item disabled 
     * @param {number} optionOff .option-result  
     * @discription :  
     **/
    showMessage(item, alertFirst = false, optionOff = false) {
      const $box = $q(item);
      const $input = $box.find(this.selector.radio);
      conslaimer = $box.find(this.selector.disclaimer);

      let padding = 0;

      $q(`${selector.pdBuyingTool} .pd-select-option__alert-message, ${selector.pdBuyingTool} .pd-select-option__item-disclaimer, ${selector.pdBuyingTool} .pd-select-option__item-info`).target.forEach((element) => {
        if (element.style.display === 'block') {
          const wrap = $q(element).closest(selector.pdBuyingTool).target[0];

          if (PDbuyingTool.instances.has(wrap)) {
            PDbuyingTool.instances.get(wrap).hideMessage();
          }
        }
      });

      if ($message.target.length > 0) {
        if ($input.target[0].disabled || alertFirst) {
          this.showMessageEl = $message;
          padding = this.showAlertMessage($message, $input.attr('aria-label'));
        }
      }

      if (padding === 0 && $disclaimer.target.length > 0) { //show only one message or disclaimer. The meaning of "padding === 0" did not show AlertMessage.
        this.showMessageEl = $disclaimer;
        padding = this.showDisclaimer($disclaimer);
      }

      if (!this.careMotion) {
        this.ele.offsetMesage.finish().animate({
          paddingBottom: `${padding}px`,
        }, 600, () => {
          window.sg.components.productDetailKv.resize();
        });
      }

      if (optionOff === false) {
        if ($box.find('input.option-result-focus').target.length > 0) {
          windoresult__close'));
        }
      }
    }

    showAlertMessage($message, text) {
      const offsetRect = this.ele.offsetMesage.offset();

      $message.find('span').text(text);

      $message.finish().css({
        display: 'block',
        opacity: 0,
      });

      const height = $message.height();

      $message.finish().css({
        height: `${ction.offset().top}px`,
      });

      $message.animate({
        opacity: 1,
      }, 600, () => {
        $message.css({
          opacity: 1,
          height: '',
          top: '',
        });
      });

      return height + parseFloat($message.css('margin-top'));
    }

    showDisclaimer($disclaimer) {
      $disclaimer.finish().css({
        display: 'block',
        opacity: 0,
      });

      const height = $disclaimer.height();

      if (this.careMotion) {
        $disclaimer.css({
          height: 0,
        });

        $disclaimer.animate({
          opacity: 1,opacity: 1,
            height: '',
          });
        });
      } else {
        const offsetRect = this.ele.offsetMesage.offset();

        $disclaimer.css({
          top: `${offsetRect.height - parseFloat(this.ele.offsetMesage.css('padding-bottom')) + offsetRect.top - this.ele.section.offset().top}px`,
        });

        $disclaimer.animate({
     600, () => {
          $disclaimer.css({
            opacity: 1,
            height: '',
            top: '',
          });
        });
      }

      return height + parseFloat($disclaimer.css('margin-top'));
    }

    hideMessage() {
      if (this.ele.offsetMesage.target.length > 0 && this.ele.offsetMesage.target[0].style.paddingBottom === '' && !this.careMotion) {
        return;
      }

      this.ele.section.find(`${this.selector.message}, ${this.selector.disclaimer}`).target.forEach((hide) => {
        if (hide.style.display === 'block') {
          const $hide = $q(hide);
          if (this.careMotion) {
            $hide.finish().animate({
              opacity: '0',
              height: '0',
            }, 600, () => {
              hide.style.display = '';
              hide.style.height = '';
            });
          } else {
            const offsetRect = this.ele.offsetMesage.offset();
            $hide.finish().css({
              top: `${offsetRect.height - parseFloat(this.ele.offsetMesage.css('padding-bottom')) + offsetRect.top - this.ele.section.offset().top}px`,
            });

            $hide.animate({
              opacity: '0',
            }, 600, () => {
              $hide.attr('style', '');
            });
          }
          this.showMessageEl = null;
        }
      });

      if (!this.careMotion) {
        this.ele.offsetMesage.finish().animate({
          paddingBottom: '0px',
        }, 600);
      }
    }
  }

  // const bodyHtml =  $q('html, body');
  // const $qWindow = $q(window);

  // function setCheckOutBtn() {
  //   let contentWrap = null;
  //   let buyingTool = null;
  //   let isFirst = true;
  //   let scrollTop = 0;
  //   const productDetailKv = $q(selector.ProductDetailKv);
  //   const checkOutBtn = productDetailKv.find(selector.checkOut);

  //   // console.log('checkOutBtn ',checkOutBtn);

  //   checkOutBtn.off('click').on('click', (evt) => {
  //     evt.preventDefault();

  //     scrollTop = bodyHtml.scrollTop();

  //     contentWrap = $q($q(evt.target).attr('href'));
  //     contentWrap.show();

  //     const prevButton = contentWrap.find('.cta--black.checkOut');
  //     buyingTool = $q(prevButton.attr('href'));

  //     history.pushState({
  //       page: 2,
  //     }, '', window.location.href);

  //     if (contentWrap.find('.better-together').target.length) {
  //       if (isFirst) {
  //         window.sg.components.betterTogether.reInit();
  //         isFirst = false;
  //       }
  //     }

  //     prevButton.off('click').on('click', (evtPrev) => {
  //       evtPrev.preventDefault();

  //       history.pushState({
  //         page: 1,
  //       }, '', window.location.href);

  //       $qWindow.trigger('popstate');
  //     });

  //     $qWindow.trigger('popstate');
  //   });

  //   $qWindow.off('popstate').on('popstate', () => {
  //     if (buyingTool === null && contentWrap === null) {
  //       return;
  //     }

  //     if (window.history.state.page === 1) {
  //       contentWrap.hide();
  //       buyingTool.show();

  //       productDetailKv.addClass('product-detail-kv--fixed');

  //       bodyHtml.scrollTop(scrollTop);

  //       ProductDetailKv.instances.get(productDetailKv.target[0]).setGalleryTop();

  //       $q(selector.productGallery).css({
  //         'position': 'fixed',
  //         'top': 0,
  //       });

  //       checkOutBtn.focus();
  //     } else if (window.history.state.page === 2) {
  //       bodyHtml.scrollTop(0);

  //       contentWrap.show();
  //       buyingTool.hide();
  //     }
  //   });
  // }

  function init() {
    $q(selector.ProductDetailKv).target.forEach((element) => {
      if (!ProductDetailKv.instances.has(element)) {
        new ProductDetailKv(element);
      }
    });

    $q(selector.pdBuyingTool).target.forEach((element) => {
      if (!PDbuyingTool.instances.has(element)) {
        new PDbuyingTool(element);
      }
    });

    // setCheckOutBtn();
  }

  function reInit() {
    $q(selector.ProductDetailKv).target.forEach((element) => {
      if (ProductDetailKv.instances.has(element)) {
        const instances =  ProductDetailKv.instances.get(element);
        instances.reInit();
      } else {
        new ProductDetailKv(element);
      }
    });

    $q(selector.pdBuyingTool).target.forEach((element) => {
      if (PDbuyingTool.instances.has(element)) {
        const instances =  PDbuyingTool.instances.get(element);
        instances.reInit();
      } else {
        new PDbuyingTool(element);
      }
    });

    // setCheckOutBtn();

    $q(selector.ProductDetailKv).find('.text-field').target.forEach((el) => {
      window.sg.common.textField.init(el);
    });

    $q(selector.ProductDetailKv).find('.text-field-v2').target.forEach((el) => {
      window.sg.common.textFieldv2.reInit(el);
    });
  }

  function resize() {
    $q(selector.ProductDetailKv).target.forEach((element) => {
      if (ProductDetailKv.instances.has(element)) {
        ProductDetailKv.instances.get(element).resize();
      }
    });
  }

  /**
  //  @param       : component element ('.product-detail-kv')
  //  @param       : gallery fixed state true||false
  //  @discription : when scroll, gallery change fixed on off
  //  @example : window.sg.components.productDetailKv.scrollGalleryOff(document.querySelector('.product-detail-kv'),true);
  **/
  function scrollGalleryOff(element, state) {
    if (ProductDetailKv.instances.has(element)) {
      ProductDetailKv.instances.get(element).scrollGalleryOff(state);
    }
  }

  function productFixed() {
    const productDetailKv = $q(selector.ProductDetailKv);
    productDetailKv.addClass('product-detail-kv--fixed');

    ProductDetailKv.instances.get(productDetailKv.target[0]).setGalleryTop();

    $q(selector.productGallery).css({
      'position': 'fixed',
      'top': 0,
    });
  }

  /**
  //  @param       : optionBox element (.pd-select-option__item)
  //  @discription : show Message
  //  @example : window.sg.components.productDetailKv.showMessage(document.querySelector('.pd-select-option__item'));
  **/
  function showMessage(element) {
    const wrap = $q(element).closest(selector.pdBuyingTool).target[0];
    if (PDbuyingTool.instances.hget(wrap).showMessage(element, true);
    }
  }

  /**
  //  @param       : option input element ('.option-result')
  //  @discription : trigger change event
  //  @example : window.sg.components.productDetailKv.triggerChange(document.querySelector('.pd-select-option__item input[type=radio]'));
  **/
  function triggerChange(optionBox) {
    const element = $q(optionBox).closest(selector.pdBuyingTool).target[0];
    if (PDbuyingTool.instances.has(element)) {
      PDbuyingTool.instances.get(element).triggerChange(optionBox);
    }
  }

  /**
  //  @param       : option element ('.option-result')
  //  @discription : close option
  //  @example : window.sg.components.productDetailKv.optionClose(document.querySelector('.option-result__close'));
  **/
  function optionClose(optionBox) {
    const element = $q(optionBox).closest(selector.ProductDetailKv).target[0];
    if (ProductDetailKv.instances.has(element)) {
      ProductDetailKv.instances.get(element).optionClose(optionBox);
    }
  }

  /**
  //  @param       : option element ('.pd-select-option')
  //  @discription : close option
  //  @example : window.sg.components.productDetailKv.scrollGo(document.querySelector('.pd-select-option'));
  **/
  function scrollGo() {
    //not use
  }

  /**
   //  @discription : init akamai 360 viewer
   //  @example : window.sg.components.productDetailKv.init360()
   **/
  function init360() {
    window.sg.common.image360.initAll();
  }

  /**
   //  @param       :     
   //  @discription : .pd-select-option__bezel-type-popup 
   //  @example : window.sg.components.productDetailKv.openBezelPopup(document.querySelector('.pd-select-option__info-link'))
   **/
  function openBezelPopup(btn) {
    const element = $q(btn).closest(selector.ProductDetailKv).target[0];
    if (ProductDetailKv.instances.has(element)) {
      ProductDetailKv.instances.get(element).openBezelPopup(btn);
    }
  }

  ProductDetailKv.instances = new WeakMap();

  PDbuyingTool.instances = new WeakMap();

  window.sg.components.productDetailKv = {
    init,
    reInit,
    resize,
    showMessage,
    productFixed,
    scrollGalleryOff,
    optionClose,
    triggerChange,
    scrollGo,
    init360,
    openBezelPopup,
  };

  $q.ready(init);
})();

/** https://github.com/datalog/qrcode-svg under MIT license */
'use strict';function QRCode(r){var n,t,o,e,a=[],f=[],i=Math.max,u=Math.min,h=Math.abs,v=Math.ceil,c=/^[0-9]*$/,s=/^[A-Z0-9 $%*+.\/:-]*$/,l="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",g=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],d=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],m={L:[0,1],M:[1,0],Q:[2,3],H:[3,2]},p=function(r,n){for(var t=0,o=8;o--;)t=t<<1^285*(t>>>7)^(n>>>o&1)*r;return t},C=function(r,n){for(var t=[],o=r.length,e=o;e;)for(var a=r[o-e--]^t.shift(),f=n.length;f--;)t[f]^=p(n[f],a);return t},w=function(r){for(var n=[function(){return 0==(t+o)%2},function(){return 0==t%2},function(){return 0==o%3},function(){return 0==(t+o)%3},function(){return 0==((t/2|0)+(o/3|0))%2},function(){return 0==t*o%2+t*o%3},function(){return 0==(t*o%2+t*o%3)%2},function(){return 0==((t+o)%2+t*o%3)%2}][r],t=e;t--;)for(var o=e;o--;)f[t][o]||(a[t][o]^=n())},b=function(){for(var r=function(r,n){n[6]||(r+=e),n.shift(),n.push(r)},n=function(n,o,a){return n&&(r(o,a),o=0),r(o+=e,a),t(a)},t=function(r){var n=r[5],t=n>0&&r[4]==n&&r[3]==3*n&&r[2]==n&&r[1]==n;return(t&&r[6]>=4*n&&r[0]>=n?1:0)+(t&&r[0]>=4*n&&r[6]>=n?1:0)},o=0,f=e*e,i=0,u=e;u--;){for(var c=[0,0,0,0,0,0,0],s=[0,0,0,0,0,0,0],l=!1,g=!1,d=0,m=0,p=e;p--;){a[u][p]==l?5==++d?o+=3:d>5&&o++:(r(d,c),o+=40*t(c),d=1,l=a[u][p]),a[p][u]==g?5==++m?o+=3:m>5&&o++:(r(m,s),o+=40*t(s),m=1,g=a[p][u]);var C=a[u][p];C&&i++,p&&u&&C==a[u][p-1]&&C==a[u-1][p]&&C==a[u-1][p-1]&&(o+=3)}o+=40*n(l,d,c)+40*n(g,m,s)}return o+=10*(v(h(20*i-10*f)/f)-1)},A=function(r,n,t){for(;n--;)t.push(r>>>n&1)},M=function(r,n){return r.numBitsCharCount[(n+7)/17|0]},B=function(r,n){return 0!=(r>>>n&1)},x=function(r,n){for(var t=0,o=r.length;o--;){var e=r[o],a=M(e,n);if(1<<a<=e.numChars)return 1/0;t+=4+a+e.bitData.length}return t},D=function(r){if(r<1||r>40)throw"Version number out of range";var n=(16*r+128)*r+64;if(r>=2){var t=r/7|2;n-=(25*t-10)*t-55,r>=7&&(n-=36)}return n},I=function(r,n){for(var t=2;-2<=t;t--)for(var o=2;-2<=o;o--)E(r+o,n+t,1!=i(h(o),h(t)))},H=function(r,n){for(var t=4;-4<=t;t--)for(var o=4;-4<=o;o--){var a=i(h(o),h(t)),f=r+o,u=n+t;0<=f&&f<e&&0<=u&&u<e&&E(f,u,2!=a&&4!=a)}},$=function(r){for(var n=t[1]<<3|r,o=n,a=10;a--;)o=o<<1^1335*(o>>>9);var f=21522^(n<<10|o);if(f>>>15!=0)throw"Assertion error";for(a=0;a<=5;a++)E(8,a,B(f,a));E(8,7,B(f,6)),E(8,8,B(f,7)),E(7,8,B(f,8));for(a=9;a<15;a++)E(14-a,8,B(f,a));for(a=0;a<8;a++)E(e-1-a,8,B(f,a));for(a=8;a<15;a++)E(8,e-15+a,B(f,a));E(8,e-8,1)},O=function(){for(var r=e;r--;)E(6,r,0==r%2),E(r,6,0==r%2);for(var t=function(){var r=[];if(n>1)for(var t=2+(n/7|0),o=32==n?26:2*v((e-13)/(2*t-2));t--;)r[t]=t*o+6;return r}(),o=r=t.length;o--;)for(var a=r;a--;)0==a&&0==o||0==a&&o==r-1||a==r-1&&0==o||I(t[a],t[o]);H(3,3),H(e-4,3),H(3,e-4),$(0),function(){if(!(7>n)){for(var r=n,t=12;t--;)r=r<<1^7973*(r>>>11);var o=n<<12|r;if(t=18,o>>>18!=0)throw"Assertion error";for(;t--;){var a=e-11+t%3,f=t/3|0,i=B(o,t);E(a,f,i),E(f,a,i)}}}()},Q=function(r){if(r.length!=V(n,t))throw"Invalid argument";for(var o=d[t[0]][n],e=g[t[0]][n],a=D(n)/8|0,f=o-a%o,i=a/o|0,u=[],h=function(r){var n=1,t=[];t[r-1]=1;for(var o=0;o<r;o++){for(var e=0;e<r;e++)t[e]=p(t[e],n)^t[e+1];n=p(n,2)}return t}(e),v=0,c=0;v<o;v++){var s=r.slice(c,c+i-e+(v<f?0:1));c+=s.length;var l=C(s,h);v<f&&s.push(0),u.push(s.concat(l))}var m=[];for(v=0;v<u[0].length;v++)for(var w=0;w<u.length;w++)(v!=i-e||w>=f)&&m.push(u[w][v]);return m},S=function(r){for(var n=[],t=(r=encodeURI(r),0);t<r.length;t++)"%"!=r.charAt(t)?n.push(r.charCodeAt(t)):(n.push(parseInt(r.substr(t+1,2),16)),t+=2);return n},V=function(r,n){return(D(r)/8|0)-g[n[0]][r]*d[n[0]][r]},E=function(r,n,t){a[n][r]=t?1:0,f[n][r]=1},R=function(r){for(var n=[],t=0,o=r;t<o.length;t++){var e=o[t];A(e,8,n)}return{modeBits:4,numBitsCharCount:[8,16,16],numChars:r.length,bitData:n}},Z=function(r){if(!c.test(r))throw"String contains non-numeric characters";for(var n=[],t=0;t<r.length;){var o=u(r.length-t,3);A(parseInt(r.substr(t,o),10),3*o+1,n),t+=o}return{modeBits:1,numBitsCharCount:[10,12,14],numChars:r.length,bitData:n}},z=function(r){if(!s.test(r))throw"String contains unencodable characters in alphanumeric mode";var n,t=[];for(n=0;n+2<=r.length;n+=2){var o=45*l.indexOf(r.charAt(n));o+=l.indexOf(r.charAt(n+{modeBits:2,numBitsCharCount:[9,11,13],numChars:r.length,bitData:t}},L=function(r,n,t,o){var e=function(r){return""==r?[]:c.test(r)?[Z(r)]:s.test(r)?[z(r)]:[R(S(r))]}(r);return U(e,n,t,o)},N=function(r,i,u,h){t=i,o=h;for(var v=e=4*(n=r)+17;v--;)a[v]=[],f[v]=[];if(O(),function(r){for(var n=0,t=1,o=e-1,i=o;i>0;i-=2){6==i&&--i;for(var u=0>(t=-t)?o:0,h=0;h<e;++h){for(var v=i;v>i-2;--v)f[u][v]||(a[u][v]=B(r[n>>>3],7-(7&n)),++n);u+=t}}}(Q(u)),0>o){var c=1e9;for(v=8;v--;){w(v),$(v);var s=b();c>s&&(c=s,o=v),w(v)}}w(o),$(o),f=[]},U=function(r,n,t,o,e,a){if(void 0===e&&(e=1),void 0===a&&(a=40),void 0===o&&(o=-1),void 0===t&&(t=!0),!(1<=e&&e<=a&&a<=40)||o<-1||o>7)throw"Invalid value";for(var f=[],i=236,h=[],v=e;;){var c=x(r,v);if(c<=8*V(v,n))break;if(v>=a)throw"Data too long";v++}if(t)for(var s=(l=[m.H,m.Q,m.M]).length;s--;)c<=8*V(v,l[s])&&(n=l[s]);for(var l=0;l<r.length;l++){var g=r[l];A(g.modeBits,4,f),A(g.numChars,M(g,v),f);for(var d=0,p=g.bitData;d<p.length;d++)f.push(p[d])}if(f.length!=c)throw"Assertion error";var C=8*V(v,n);if(f.length>C)throw"Assertion error";if(A(0,u(4,C-f.length),f),A(0,(8-f.length%8)%8,f),f.length%8!=0)throw"Assertion error";for(;f.length<C;)A(i,8,f),i^=253;for(s=f.length;s--;)h[s>>>3]|=f[s]<<7-(7&s);return N(v,n,h,o)};return function(){function n(r){return/^#[0-9a-f]{3}(?:[0-9a-f]{3})?$/i.test(r)}function t(r,n){for(var t in r=document.createElementNS(s,r),n||{})r.setAttribute(t,n[t]);return r}var o,f,i,u,v,c,s="http://www.w3.org/2000/svg",l="",g="string"==typeof r?{msg:r}:r||{},d=g.pal||["#000"],p=h(g.dim)||256,C=[1,0,0,1,c=(c=h(g.pad))>-1?c:4,c],w=n(w=d[0])?w:"#000",b=n(b=d[1])?b:0,A=g.vrb?0:1;for(L(g.msg||"",m[g.ecl]||m.M,0==g.ecb?0:1,g.mtx),v=e+2*c,i=e;i--;)for(u=0,f=e;f--;)a[i][f]&&(A?(u++,a[i][f-1]||(l+="M"+f+","+i+"h"+u+"v1h-"+u+"v-1z",u=0)):l+="M"+f+","+i+"h1v1h-1v-1z");return o=t("svg",{viewBox:[0,0,v,v].join(" "),width:p,height:p,fill:w,"shape-rendering":"crispEdges",xmlns:s,version:"1.1"}),b&&o.appendChild(t("path",{fill:b,d:"M0,0V"+v+"H"+v+"V0H0Z"})),o.appendChild(t("path",{transform:"matrix("+C+")",d:l})),o}()}

(() => {
  const $q = window.sg.common.$q;
  const KEYCODE = window.sg.common.constants.KEY_CODE;
  const selector = {
    section: '.us-epp-discount',
  };

  class UsEppDiscount {
    constructor(element) {
      this.selector = {
        discountTitle: '.us-epp-discount__title',
        selectWrap: '.us-epp-discount__select',
        selectCta: '.us-epp-discount__select-cta',
        selectItem: '.us-epp-discount__select-item input[type="radio"]',
        learnMore: '.us-epp-discount__select-link .cta',
        selectOpenCls: 'us-epp-discout__select--open',
        fixedCls: 'us-epp-discount--fiexd',
      };

      this.el = {
        component: $q(element),
        fixDummy: null,
      };

      this.isFixOnce = false;

      this.handler = {
        toggleLayer: this.toggleLayer.bind(this),
        setFocusLock: this.setFocusLock.bind(this),
        resizeFix: () => {
          if (this.el.fixDummy.target.length > 0) {
            this.el.fixDummy.css({
              height: `${this.el.component.height()}px);

      this.init();
    }

    setElements() {
      this.el.discountTitle = this.el.component.find(this.selector.discountTitle);
      this.el.selectWrap = this.el.component.find(this.selector.selectWrap);
      this.el.selectCta = this.el.component.find(this.selector.selectCta);
      this.el.hiddenText = this.el.selectCta.find('.hidden');
      this.el.selectItem = this.el.component.find(this.selector.selectItem);
      this.el.learnMore = this.el.component.find(this.selector.learnMore);
      this.el.fixDummy = $q(this.el.component.target[0].nextElementSibling);

      this.globalText = this.el.selectCta.target.length > 0 ? JSON.parse(this.el.selectCta.target[0].dataset.globalText) : null;
    }

    init() {
      this.bindEvents();
    }

    reInit() {
      this.setElements();

      this.bindEvents();
    }

    toggleLayer() {
      if (this.el.selectWrap.hasClass(this.selector.selectOpenCls)) {
        this.closeLayer();
      } else {
        this.openLayer();
      }
    }

    openLayer() {
      this.el.selectWrap.addClass(this.selector.selectOpenCls);
      this.el.hiddenText.text(this.globalText.Close);
    }

    closeLayer() {
      this.el.selectWrap.removeClass(this.selector.selectOpenCls);
      this.el.hiddenText.text(this.globalText.Open);
    }

    setFixed(flag) {
      if (this.isFixOnce === false) {
        this.isFixOnce = true;
      }

      if (flag) {
        if (!this.el.component.target[0].classList.contains(this.selector.fixedCls)) {
          this.el.component.addClass(this.selector.fixedCls);
        }
      } else {
        if (this.el.component.target[0].classList.contains(this.selector.fixedCls)) {
          this.el.component.removeClass(this.selector.fixedCls);
        }
      }
    }

    setFocusLock(event) {
      if (event.keyCode === KEYCODE.TAB && event.shiftKey === false) {
        this.el.selectCta.focus();
        this.closeLayer();

        event.preventDefault();
      }
    }

    bindEvents() {
      this.el.selectCta.off('click', this.handler.toggleLayer).on('click', this.handler.toggleLayer);
      this.el.learnMore.off('keydown', this.handler.setFocusLock).on('keydown', this.handler.setFocusLock);
      $q(window).off('resize',this.handler.resizeFix).on('resize',this.handler.resizeFix);
      this.handler.resizeFix();
    }
  }

  const init = () => {
    $q(selector.section).target.forEach((element) => {
      if (!UsEppDiscount.instances.has(element)) {
        new UsEppDiscount(element);
      }
    });
  };

  const reInit = () => {
    $q(selector.section).target.forEach((element) => {
      if (UsEppDiscount.instances.has(element)) {
        UsEppDiscount.instances.get(element).reInit();
      } else {
        new UsEppDiscount(element);
      }
    });
  };

  const closeLayer = () => {
    $q(selector.section).target.forEach((element) => {
      if (UsEppDiscount.instances.has(element)) {
        UsEppDiscount.instances.get(element).closeLayer();
      }
    });
  };

  const setFixed = (activeFlag) => {
    $q(selector.section).target.forEach((element) => {
      if (UsEppDiscount.instances.has(element)) {
        UsEppDiscount.instances.get(element).setFixed(activeFlag);
      }
    });
  };

  UsEppDiscount.instances = new WeakMap();

  $q.ready(init);

  window.sg.components.usEppDiscount = {
    init,
    reInit,
    closeLayer,
    setFixed,
  };
})();

(() => {
  const $q = window.sg.common.$q;
  const selector = { section: '.pd-banner' };

  class PDbanner {
    constructor(component) {
      this.selector = {
        section: selector.section,
        btn: '.pd-banner__toggle',
        hidden: '.hidden',
        content: '.pd-banner__inner',
        contentFade: '.pd-banner__content-wrap',
        contentTitle: '.pd-banner__title',
        timerCloseTxt: '.offer-timer__timer-text',
        timerOpenDay: '.pd-banner__timer .offer-timer__remain-day',
        timerOpenCount: '.pd-banner__timer .offer-timer__counter',
        timerOpenIndia: '.s-timer > span .text',
      };


      this.ele = {
        window: $q(window),
        section: $q(component),
        btn: null,
        hidden: null,
        content: null,
        contentFade: null,
        contentTitle: null,
        timerCloseTxt: null,
        timerOpenDay: null,
        timerOpenCount: null,
      };

      this.timer = null;
      this.colorStyle = null;
      this.isTimeStart = null;
      this.timeEnd = null;
      this.timeStart = null;
      this.timeText = null;
      this.isIndia = null;
      this.isRu = null;

      this.setProperty();

      PDbanner.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.btn = this.ele.section.find(this.selector.btn);
      this.ele.hidden = this.ele.section.find(this.selector.hidden);
      this.ele.content = this.ele.section.find(this.selector.content);
      this.ele.contentFade = this.ele.section.find(this.selector.contentFade);
      this.ele.contentTitle = this.ele.section.find(this.selector.contentTitle);

      this.colorStyle = {
        fold: JSON.parse(this.ele.section.attr('data-fold-data')),
        unfold: JSON.parse(this.ele.section.attr('data-unfold-data')),
      };

      this.timeText = {
        start: this.ele.content.attr('data-start-text') || '',
        end: this.ele.content.attr('data-end-text') || '',
        day: this.ele.content.attr('data-day-text') || '',
      };

      this.setStyle(this.ele.section.hasClass('pd-banner--open'));

      this.isIndia = this.ele.section.hasClass('timer-in');
      this.isRu = this.ele.section.hasClass('timer-ru');
      if (this.isRu) {
        this.ele.remainText = this.ele.section.find('.offer-timer__remain-text');
      }
    }

    init() {
      this.bindEvents();
      this.setCounter();
    }

    setCounter() {
      this.ele.timerCloseTxt = this.ele.section.find(this.selector.timerCloseTxt);
      this.ele.timerOpenDay = this.ele.section.find(this.selector.timerOpenDay);
      this.ele.timerOpenCount = this.ele.section.find(this.isIndia ? this.selector.timerOpenIndia : this.selector.timerOpenCount);

      this.timeStart = PDbanner.dateFormat(this.ele.content.attr('data-start-time'));
      this.timeEnd = PDbanner.dateFormat(this.ele.content.attr('data-end-time'));
      this.isTimeStart = new Date(this.timeStart) - new Date() > 0 ? true : false;

      this.viewTime();

      clearInterval(this.timer);
      this.timer = null;
      this.timer = setInterval(this.viewTime.bind(this), 1000);
    }

    viewTime() {
      let dateMode = PDbanner.counterData(this.isTimeStart ? this.timeStart : this.timeEnd);

      if (dateMode.distance <= 0) {
        if (this.isTimeStart === true) {
          this.isTimeStart = false;
          dateMode = PDbanner.counterData(this.timeEnd);
          this.ele.timerOpenDay = this.ele.section.find(this.selector.timerOpenDay);
          this.ele.section.find('.offer-timer__day').removeClass('offer-timer__day--end');
        } else {
          this.hideBanner();

          return;
        }
      } else {
        if (this.ele.section.css('display') !== 'block') {
          this.ele.section.show();
        }
      }

      const dayPrevTxt = this.isTimeStart ? this.timeText.start : this.timeText.end;
      const dayPartTxt = this.isIndia ? ':' : this.isRu ? ' . ' : ' | ';
      if (dateMode.day > 0) {
        if (this.timeText.day === '') {
          this.ele.timerCloseTxt.text(`${dayPrevTxt} ${dateMode.day}${dayPartTxt}${dateMode.hour}:${dateMode.minute}:${dateMode.second}`);
        } else {
          this.ele.timerCloseTxt.text(`${dayPrevTxt} ${dateMode.day} ${this.timeText.day}${dayPartTxt}${dateMode.hour}:${dateMode.minute}:${dateMode.second}`);
        }
      } else {
        this.ele.timerCloseTxt.text(`${dayPrevTxt} ${dateMode.hour}:${dateMode.minute}:${dateMode.second}`);
      }

      if (this.isIndia) {
        const dayEl = this.ele.timerOpenCount.target[0].parentNode;
        
        if (dateMode.day === 0 && dayEl.style.display !== 'none') {
          dayEl.style.display = 'none';
        } else if (dateMode.day > 0 && dayEl.style.display !== '') {
          dayEl.style.display = '';
        }

        this.ele.timerOpenCount.target.forEach((span, idx) => {
          let dataTime = null;
          switch (idx) {
          case 0: // day
            dataTime = PDbanner.numFormat(dateMode.day);
            break;
          case 1: // hour
            dataTime = dateMode.hour;
            break;
          case 2: // min
            dataTime = dateMode.minute;
            break;
          case 3: // sec
            dataTime = dateMode.second;
            break;
          }

          span.textContent = dataTime;
          const spanTxt = span.nextElementSibling;
          spanTxt.textContent = parseInt(span.textContent) <= 1 ? spanTxt.dataset.textSingular : spanTxt.dataset.textPlural ;
        });
      } else {
        if (dateMode.day > 0) {
          this.ele.timerOpenDay.text(dateMode.day);
        } else if (this.ele.timerOpenDay !== null) {
          this.ele.section.find('.offer-timer__day').addClass('offer-timer__day--end');
          this.ele.timerOpenDay = null;
        }
        if (this.isRu){
          this.ele.remainText.text(`${dayPrevTxt}`);
        }
        this.ele.timerOpenCount.text(`${dateMode.hour}:${dateMode.minute}:${dateMode.second}`);
      }
    }
    
    static counterData(end) {
      const second = 1000;
      const minute = second * 60;
      const hour = minute * 60;
      const day = hour * 24;
      const now = new Date();
      const dDay = new Date(end);
      const distance  = dDay - now;

      return {
        'day': Math.floor(distance / day),
        'hour': PDbanner.numFormat(Math.floor((distance % day) / hour)),
        'minute': PDbanner.numFormat(Math.floor((distance % hour) / minute)),
        'second': PDbanner.numFormat(Math.floor((distance % minute) / second)),
        'distance': distance,
      };
    }

    static numFormat(n) {
      n = Number(n).toString(); if (Number(n) < 10 && n.length === 1) n = `0${n}`;
      return n;
    }

    static dateFormat(d) {
      if (d === null || d === '') {
        return 0;
      } else {
        return `${d.substring(0, 4)}-${d.substring(4, 6)}-${d.substring(6, 8)}T${d.substring(8, 10)}:${d.substring(10)}`;
      }
    }

    hideBanner() {
      this.ele.section.hide();
      clearInterval(this.timer);
      this.timer = null;
      this.isTimeStart = null;
      this.ele.window.trigger('resize');
    }

    reInit() {
      this.setProperty();
      this.bindEvents();
      clearInterval(this.timer);
      this.setCounter();
    }

    bindEvents() {
      this.ele.btn.off('click').on('click', () => {
        if (this.ele.section.hasClass('pd-banner--open')) this.openBanner();
        }
      });
    }

    setStyle(open) {
      if (open) {
        this.ele.section.css({
          background: this.colorStyle.unfold.bgColor,
        });

        this.ele.section.removeClass(`pd-banner--text-${this.colorStyle.fold.textColor}`);
        this.ele.section.addClass(`pd-banner--text-${this.colorStyle.unfold.textColor}`);
      } else {
        this.ele.section.css({
          background: this.colorStyle.fold.bgColor,
        });

        this.ele.section.removeClass(`pd-banner--text-${this.colorStyle.unfold.textColor}`);
        if (this.colorStyle.fold.textColor !== 'black') {
          this.ele.section.addClass(`pd-banner--text-${this.colorStyle.fold.textColor}`);
        }
      }
    }

    openBanner() {
      if (this.timerDayInt < 0) {
        return;
      }
      
      //set height
      this.ele.content.stop();
      this.ele.content.attr('style', '');
      const minHeight = this.ele.content.height();
      this.ele.section.addClass('pd-banner--open');
      const maxHeight = this.ele.content.height();
      this.ele.content.target[0].style.height = `${minHeight}px`;

      //motion
      this.ele.content.animate({
        height: `${maxHeight}px`,
      }, 300, () => {
        this.ele.content.attr('style', '');
      });

      this.ele.contentFade.target[0].style.opacity = 1;

      this.ele.section.attr('aria-expanded', true);
      window.sg.common.lazyLoad.setLazyLoad();

      this.setStyle(true);
    }

    closeBanner(motion = true) {
      if (this.timerDayInt < 0) {
        return;
      }
      this.ele.content.stop();

      if (motion) {//show animation
        //set height
        this.ele.content.attr('style', '');
        const maxHeight = this.ele.content.height();
        this.ele.section.removeClass('pd-banner--open');
        const minHeight = this.ele.content.height();
        this.ele.section.addClass('pd-banner--open');
        this.ele.content.target[0].style.height = `${maxHeight}px`;

        //motion
        this.ele.content.animate({
          height: `${minHeight}px`,
        }, 300, () => {
          this.ele.section.removeClass('pd-banner--open');
          this.ele.content.attr('style', '');
          this.ele.contentTitle.target[0].style.opacity = 0;
          setTimeout(() => {
            this.ele.contentTitle.target[0].style.opacity = 1;
          }, 30);
        });
      } else {//Forcibly close the menu
        this.ele.section.removeClass('pd-banner--open');
        this.ele.content.attr('style', '');
        this.ele.contentTitle.target[0].style.opacity = 1;
      }

      this.ele.contentFade.target[0].style.opacity = 0;

      this.ele.section.attr('aria-expanded', false);

      this.setStyle(false);
    }
  }

  function init() {
    $q(selector.section).target.forEach((element) => {
      if (!PDbanner.instances.has(element)) {
        new PDbanner(element);
      }
    });
  }

  function reInit() {
    $q(selector.section).target.forEach((element) => {
      if (PDbanner.instances.has(element)) {
        const instances =  PDbanner.instances.get(element);
        instances.reInit();
      } else {
        new PDbanner(element);
      }
    });
  }

  function closeBanner(motion = true) {
    $q(selector.section).target.forEach((element) => {
      if (PDbanner.instances.has(element)) {
        const instances =  PDbanner.instances.get(element);
        instances.closeBanner(motion);
      }
    });
  }

  PDbanner.instances = new WeakMap();

  window.sg.components.pdBanner = {
    init,
    reInit,
    closeBanner,
  };

  $q.ready(init);
})();

(() => {
  const $q = window.sg.common.$q;
  const scrollbar = window.sg.common.scrollbar;
  const optionSelector = window.sg.common.OptionSelector;
  const utils = window.sg.common.utils;
  const lazyLoad = window.sg.common.lazyLoad;
  const productDetailKv = window.sg.components.productDetailKv;

  const selector = {
    section: '.better-together',
  };

  const $qWindow = $q(window);

  let hideComponent = null;
  let rootEl = null;
  let buttonEl = null;
  let scTop = null;

  // eslint-disable-next-line no-unused-vars
  let backButton = null;

  
  class BetterTogether {
    constructor(component) {
      this.selector = {
        section: selector.section,
        moreCta: '.better-together__cta-more',
        item: '.better-together__item',
        addItemCta: '.better-together__cta a',
        count: '.better-together__selected-info .number span',
        clearAll: '.better-together__selected-close',
        first: '.better-together__item-selected',
        scrollBar: '.scrollbar',
        optionSelector: '.option-selector__wrap',
        active: 'is-item-visible',
        backCta: '.better-together__back-cta',
      };
      
      this.MOBILE_COUNT = 3;
      this.DESKTOP_COUNT = 10;

      this.ele = {
        section: $q(component),
        item: null,
        addItemCta: null,
        count: null,
        clearAll: null,
        scrollBar: null,
        backCta: null,
      };

      this.handler = {
        clickBackCta: (evt) => {
          evt.preventDefault();

          productDetailKv.scrollGalleryOff(document.querySelector('.product-detail-kv'), false);
          
          history.pushState({
            page: 1, 
          }, '', window.location.href);

          $qWindow.trigger('popstate');
        },

        clickAddItemCta: (evt) => {
          const item = $q(evt.target).closest('.better-together__cta');
          const targetEl = item.find('a');
          const spanEl = item.find('a span');
          const json = JSON.parse(spanEl.target[0].dataset.globalText);

          targetEl.toggleClass('cta--on');
          if (targetEl.hasClass('cta--on')) {
            spanEl.innerHTML(json.selected);
          } else {
            spanEl.innerHTML(json.unSelected);
          }

          this.handler.setCount();
        },
        setCount: () => {
          const cnt = this.ele.section.find(`${this.selector.addItemCta}.cta--on`).target.length;
          this.ele.count.innerHTML(cnt);
        },

        // clickClearAll: () => {
        //   this.ele.section.find(`${this.selector.addItemCta}.cta--on`).trigger('click');
        //   this.handler.setCount();
        // },
      };

      this.init();

      BetterTogether.instances.set(component, this);
    }
    
    setProperty() {
      this.ele.scrollBar = this.ele.section.find(this.selector.scrollBar).target[0];
      this.ele.item = this.ele.section.find(`${this.selector.item}:not(.better-together__item-selected)`);
      this.ele.backCta = this.ele.section.find(this.selector.backCta);
      this.ele.addItemCta = this.ele.section.find(this.selector.addItemCta);
      this.ele.count = this.ele.section.find(this.selector.count);
      this.ele.clearAll = this.ele.section.find(this.selector.clearAll);
    }

    init() {
      this.setProperty();
      this.bindEvents();
      this.more();
    }

    reInit() {
      this.setProperty();
      this.ele.item.removeClass(this.selector.active);
      
      this.ele.backCta.off('click', this.handler.clickBackCta);
      this.ele.addItemCta.off('click', this.handler.clickAddItemCta);
      // this.ele.clearAll.off('click', this.handler.clickClearAll);

      this.bindEvents();
      this.more();
    }

    ctaBind(ele) {
      this.ele.addItemCta = this.ele.section.find(this.selector.addItemCta);
      const ctaEl = $q(ele).find(this.selector.addItemCta);

      if (this.ele.section.hasClass('better-together__selected') || this.ele.section.hasClass('better-together__pre-order')) {
        ctaEl.off('click', this.handler.clickAddItemCta).on('click', this.handler.clickAddItemCta);
      }
    }

    bindEvents() {    
      this.ele.backCta.on('click', this.handler.clickBackCta);

      if (this.ele.section.hasClass('better-together__selected') || this.ele.section.hasClass('better-together__pre-order')) {
        this.ele.addItemCta.off('click', this.handler.clickAddItemCta).on('click', this.handler.clickAddItemCta);
        // this.ele.clearAll.off('click', this.handler.clickClearAll).on('click', this.handler.clickClearAll);
      }
    }

    more() {
      lazyLoad.setLazyLoad();
      
      const temp = this.ele.section.find(`${this.selector.item}:not(.${this.selector.active})`);
      const total = (utils.getCurrentDevice() === 'mobile') ? this.MOBILE_COUNT : this.DESKTOP_COUNT;

      for (let i = 0; i < total; i++) {
        const target = temp.eq(i);
        target.addClass(this.selector.active);
        optionSelector.reInit(target);
      }
      scrollbar.resize(this.ele.scrollBar);
    }

    resizeMore() {
      const total = this.DESKTOP_COUNT;
      const activeList = this.ele.section.find(`.${this.selector.active}`);

      if (activeList.target.length < total) {
        lazyLoad.setLazyLoad();

        const temp = this.ele.section.find(`${this.selector.item}:not(${this.selector.first})`);
        for (let i = 0; i < total; i++) {
          const target = temp.eq(i);
          target.addClass(this.selector.active);
          optionSelector.reInit(target);
        }
  
        scrollbar.resize(this.ele.scrollBar);
      }
    }
  }

  function bindEvents() {
    $qWindow.off('popstate').on('popstate', () => {
      if (!hideComponent) {
        return;
      }
      const temp = [...hideComponent];

      if (window.history.state.page === 1) {
        temp.forEach((ele) => {
          ele.style.display = '';
        });
        
        if (rootEl.target.length) {
          rootEl.hide();
        }

        window.scrollTo(0, scTop);
        // if (fixedCheck) {
        // window.sg.components.productDetailKv.productFixed();
        // }
        
        buttonEl.focus();
      } else {
        // hideComponent.hide();
        temp.forEach((ele) => {
          ele.style.display = 'none';

          if (($q(ele).hasClass('pd-header-navigation') || $q(ele).find('.pd-header-navigation').target.length > 0) && window.sg.components.pdHeaderNavigation !== undefined) {
            const info = window.sg.components.pdHeaderNavigation.getRect();
            if (info.fixMode.indexOf('On') >= 0) {
              const $offsetElement = $('#content');
              $offsetElement.css({
                paddingTop: `${parseFloat($offsetElement.css('padding-top')) - info.height}px`,
              });
            }
          }
        });

        rootEl.show();
    
        if (BetterTogether.instances.has(rootEl.target[0])) {
          const instances =  BetterTogether.instances.get(rootEl.target[0]);
          instances.reInit();
        } else {
          new BetterTogether(rootEl.target[0]);
        }
      }
    });

    if (utils.getCurrentDevice() === 'mobile') {
      $qWindow.off('resize', resizeHander);
      $qWindow.on('resize', resizeHander);
    }
  }

  function init() {
    $q(selector.section).target.forEach((element) => {
      if (!BetterTogether.instances.has(element)) {
        new BetterTogether(element);
      }
    });
    
    if ($q(selector.section).target.length){
      backButton = $q(`${selector.section} .better-together__back-cta`);
      bindEvents();
    }
  }
  
  function reInit() {
    $q(selector.section).target.forEach((element) => {
      window.sg.common.scrollbar.reInit(element.querySelector('.scrollbar'));      

      if (BetterTogether.instances.has(element)) {
        const instances =  BetterTogether.instances.get(element);
        instances.reInit();
      } else {
        new BetterTogether(element);
      }
    });
    
    lazyLoad.setLazyLoad();

    bindEvents();
  }

  function more() {
    $q(selector.section).target.forEach((element) => {
      if (BetterTogether.instances.has(element)) {
        BetterTogether.instances.get(element).more();
      }
    });
  }

  function resizeHander() {
    if (utils.getCurrentDevice() === 'desktop') {
      $qWindow.off('resize', resizeHander);

      $q(selector.section).target.forEach((element) => {
        if (BetterTogether.instances.has(element)) {
          BetterTogether.instances.get(element).resizeMore();
        }
      });
    }
  }
  
  // eslint-disable-next-line no-unused-vars
  let fixedCheck = false;

  function show(componentEl, targetEl, btnEl) {
    const product = $q('.product-detail-kv');
    fixedCheck = product.hasClass('product-detail-kv--fixed');

    productDetailKv.scrollGalleryOff(product.target[0], true);
    
    scTop = window.scrollY;
    hideComponent = targetEl;
    // product-detail-kv--fixed
    rootEl = $q(componentEl);
    buttonEl = $q(btnEl);

    history.pushState({
      page: 2, 
    }, '', window.location.href);

    window.scrollTo(0, 0);

    $qWindow.trigger('popstate');
  }

  function reInitCard(ele) {
    lazyLoad.setLazyLoad();
    
    optionSelector.reInit($q(ele));

    $q(selector.section).target.forEach((element) => {
      if (BetterTogether.instances.has(element)) {
        BetterTogether.instances.get(element).ctaBind(ele);
      } else {
        new BetterTogether(element).ctaBind(ele);
      }
    });
  }

  BetterTogether.instances = new WeakMap();

  window.sg.components.betterTogether = {
    init,
    reInit,
    more,
;
})();

(() => {
  const $q = window.sg.common.$q;
  const instances = new WeakMap();
  const triggerEvent = window.sg.common.utils.triggerEvent;

  const image360 = {
    init(el) {
      if (!el.hasAttribute('data-akamai-viewer')) {
        el = el.querySelector('[data-akamai-viewer]');
      }

      if (!el) {
        return;
      }

      if (!instances.has(el)) {
        // eslint-disable-next-line no-undef
        const image = new Akamai.Viewer(el, {
          carousel: { arrows: false },
          spin360: { reverse: true },
          items: { uri: el.getAttribute('data-spin-uri') },
        });

        instances.set(el, image);
      }

      triggerEvent(window, 'resize');
    },
    initAll() {
      const image360Els = [...document.querySelectorAll('[data-akamai-viewer]')];
      image360Els.forEach((el) => {
        if (el.hasAttribute('data-init-on-loaded')) {
          image360.init(el);
          el.removeAttribute('data-init-on-loaded');
        }
      });
    },
  };

  window.sg.common.image360 = image360;
  $q.ready(image360.initAll);
})();

(() => {
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	
	class BuyingToolOpUtile {
		
		constructor( parent ) {
			this.parent = parent
		}
		
		/**
		 *      
		 */
		afterTotalAPI( sharedObj, selectorObj ) {
			if( sharedObj.finishedFirstSyndi && sharedObj.finishedSecondSyndi && sharedObj.finishedAddOn && sharedObj.finishedSearch ){
				const util = sharedObj.util;
				const isHybrisSplitPDUpgrade = sharedObj.isHybrisSplitPDUpgrade;
				checkingCareAndWarranty(sharedObj, selectorObj );
				settingTradeInPopup( sharedObj, selectorObj );
				divideCareAndWarranty( sharedObj, selectorObj );
				this.settingAfterApiCareDraw( sharedObj, selectorObj );
				this.totalAfterFunction( sharedObj, selectorObj );
				
				settingCalculateDraw( sharedObj, selectorObj );
				changeEmiUrl( sharedObj, selectorObj );
				
				// TNC  
				if(sharedObj.upgradeFlag ){
					
					buyingPdEup.setTncUpgrade();
				}
				
				//  1 reinit();
				this.totalReinit( sharedObj, selectorObj );
				util.gpHybrisGlobalEndPoint(sharedObj, selectorObj);
			}
		}
		
		/**
		 *   1 reinit    
		 */
		totalReinit( sharedObj, selectorObj ){
			const siteCode = sharedObj.siteCode;
			
			window.sg.components.productDetailKv.reInit();
			window.sg.common.icon.update(document.querySelector('.pd-g-product-detail-kv .product-detail-kv'));
			if(window.smg.wtb) {
				window.smg.wtb.common.reInit();
			}
			
			if ($(".pd-header-gallery .btn-360").length > 0 ){
				window.sg.components.productDetailKv.init360();
			}
			if( siteCode === 'in' && window.sg.components.hubblePdPopup ){
				window.sg.components.hubblePdPopup.reinit();
			}
			
			window.sg.components.pdHeaderNavigation.reInit();
			
			if( window.location.search && document.querySelector(".btn-gallery-ar") ){
				if( window.location.search === "?ar" ){ 
					document.querySelector(".btn-gallery-ar").click();
				}
			}
			
			window.sg.components.pdBuyingTool.bindPdTooltipEvent(); // delivery tooltip
			
			/*
			const beforeBadge = $('.pd-g-header-navigation .pd-buying-price .pd-buying-price__badge.mobile');
			if( beforeBadge ){
				beforeBadge.insertAfter('.pd-g-header-navigation .pd-header-navigation__header');
			}
			*/
		}
		
		/**
		 * Delivery  AP  //new-hybris
		 */
		deliveryGetApiData( sharedObj, selectorObj ){
			const deliveryArea = $(selectorObj.buyingToolOptDelivery);
			const drawObj = sharedObj.drawObj;
			const pinCode = deliveryArea.find('#delivery-zipcode').val();
			const view = sharedObj.view;
			const siteCode= sharedObj.siteCode;
			const shopSkuCode = sharedObj.shopSkuCode;
			const commonApiModel = sharedObj.commonApiModel;
			
			if( !pinCode ){
				const errMsg = Granite.I18n.get('Enter your zipcode');
				drawObj.delivery.errorMessage = errMsg;
				drawObj.delivery.inputAttr.value = pinCode;
				view.deliveryDraw(drawObj);
				$(deliveryArea).find('#delivery-zipcode').focus().val('').val(pinCode);
				$(deliveryArea).find('.text-field-v2__text.error').show();
				$(deliveryArea).find('.pd-select-option__tooltip').hide();
				$(deliveryArea).find('.pd-select-option__tooltip').hide();
				$('.option-result.result-delivery').hide();
			} else {
				if( siteCode === 'in' && pinCode.length < 6 ){
					drawObj.delivery.errorMessage = "Please enter a valid Pincode";
					drawObj.delivery.inputAttr.value = pinCode;
					view.deliveryDraw(drawObj);
					$(deliveryArea).find('#delivery-zipcode').focus().val('').val(pinCode);
					$(deliveryArea).find('.text-field-v2__text.error').show();
					$(deliveryArea).find('.pd-select-option__tooltip').hide();
					$(deliveryArea).find('.pd-select-option__tooltip').hide();
					$('.option-result.result-delivery').hide();
				}else{
					drawObj.delivery.errorMessage = null;
					drawObj.delivery.inputAttr.value = pinCode;
					$(deliveryArea).find('.text-field-v2__text.error').hide();
					view.deliveryDraw(drawObj);
					if(sharedObj.isMigrationHybris){
						// new-hybris
						commonApiModel.deliveryNewBybrisAPI( sharedObj, selectorObj , pinCode, shopSkuCode );
					} else {
						if( siteCode === "in" ){
							const apiUrl = "/aemapi/v6/product/serverUTC";
							$.ajax({
								type: "GET",
								url: apiUrl,
								success : function (data, responseText, jqXHR) {
									drawObj.delivery.time = jqXHR.getResponseHeader("Date");
									commonApiModel.deliveryInAPI( sharedObj, selectorObj , pinCode, shopSkuCode );
								}
							});
							
						} else if( siteCode === "us" ){
							commonApiModel.deliveryUsAPI( sharedObj, selectorObj , pinCode, shopSkuCode );
						} else {
							commonApiModel.deliveryAPI( sharedObj, selectorObj , pinCode, shopSkuCode );
						}
					}
				}
			}
		}
		
		selectedUsEpp ( inputData ){
			const sharedObj = inputData.sharedObj;
			const selectorObj = inputData.selectorObj;
			const tmktid =  $.cookies.get('tmktid', {domain : ".samsung.com"});
			const tsgmt =  $.cookies.get('tsgmt', {domain : ".samsung.com"});
			
			
			if( tmktid ){
				sharedObj.drawObj.usEppData.title = 'with ' + tsgmt + ' Discounts';
				sharedObj.drawObj.usEppData.hasSelectBox = false;
				
				sharedObj.view.usEppDraw( sharedObj.drawObj );
				sharedObj.commonApiModel.setUsEppPrice( sharedObj, selectorObj );
			}
			
		}
		
		/**
		 *   Care  
		 */
		settingAfterApiCareDraw( sharedObj, selectorObj ){
			const drawObj = sharedObj.drawObj;
			const view = sharedObj.view;
			const itemSet = drawObj.care.itemSet;
			const careData = sharedObj.finalCareList;
			const badgeList = sharedObj.samsungCareBadgeList;
			const modelCodeKey = {};
            // CRHQ-9202 [B2C][MX][UK] SC+   UI 
			// CRHQ-9703 [B2C][MX][SENA] SC+   UI 
			const isSmcType2 = drawObj.care.isSmcType2,
			      items = drawObj.care.items;

			let count = 0,
			    count2 = 1;

			if (isSmcType2) {
			    let depth1Theft = false,
			        depth1Damage = false;

			    for (let index in careData) {
                    const item = careData[index];
                    const itemCode = item.modelCode;

                    if ( !modelCodeKey[itemCode] ) {
                        let isTheft = item.isTheft;
                        let priceInfo = {};
                        let displayName = Granite.I18n.get('Samsung Care+');
                        let formattedDelPrice = '';
                        let formattedPrice = '';
                        let formattedSavePrice = '';
                        let formattedFromPrice = '';
                        let salePrice  = '';
                        let originalPrice = '';

                        //  
                        let duration = '';
                        let paymentCycle = '';

                        // let isSubscription = false;
                        let msrp_price = null;
                        let sale_price = null;

                        let wasPrice = ''; //CRHQ-8306 [B2C][MX][UK] SC+ 
                        let formattedWasPrice = '';

                        if ( item.displayName ) {
                            displayName = item.displayName;
                        }

                        if ( item.price_info && item.price_info[0] ) {
                            priceInfo = item.price_info[0];
                            msrp_price = priceInfo.msrp_price;
                            sale_price = priceInfo.sale_price;
                            formattedSavePrice = priceInfo.saveText;
                        }

                        if ( msrp_price && msrp_price.duration_value && msrp_price.paymentcycle_value ) {
                            // duration 0  paymentCycle null  monthly
                            if ( msrp_price.duration_value > 0 && msrp_price.paymentcycle_value != null && msrp_price.paymentcycle_value.toLowerCase() == "monthly") {
                                duration = msrp_price.duration_value;
                                paymentCycle = msrp_price.paymentcycle_value.toLowerCase();
                            }
                        }

                        if ( sale_price && sale_price.duration_value && sale_price.paymentcycle_value ) {
                            // duration 0  paymentCycle null  monthly
                            if ( sale_price.duration_value > 0 && sale_price.paymentcycle_value != null && sale_price.paymentcycle_value.toLowerCase() == "monthly") {
                                duration = sale_price.duration_value;
                                paymentCycle = sale_price.paymentcycle_value.toLowerCase();
                            }
                        }

                        //[EPP] care item null  
                        if (null != msrp_price && "undefined" !== typeof msrp_price.wasValue) { //CRHQ-8306
                            if ( msrp_price && null != msrp_price.value ) { // price  
                                originalPrice = msrp_price.value;
                                wasPrice = msrp_price.wasValue;

                                if (msrp_price.formatted_value) {
                                    formattedDelPrice = msrp_price.formatted_value;
                                }

                                if (msrp_price.formatted_wasValue) {
                                    formattedWasPrice = msrp_price.formatted_wasValue;
                                }
                            }

                            if (sale_price && sale_price.value) { // promotionPrice  
                                if ( sale_price.value ) {
                                    salePrice = sale_price.value;
                                }

                                if ( sale_price.formatted_value ) {
                                    formattedPrice = sale_price.formatted_value;
                                }

                                if ( originalPrice && originalPrice === salePrice ) {
                                    formattedDelPrice = '';
                                }
                            } else { // promotionPrice  
                                if ( ( sharedObj.siteCode === 'fi' || sharedObj.siteCode === 'se' || sharedObj.siteCode === 'dk' || sharedObj.siteCode === 'no') && duration && paymentCycle ) {
                                    formattedPrice = Granite.I18n.get( "{0}/month {1}", [formattedDelPrice, duration] );
                                } else {
                                    formattedPrice = formattedDelPrice;
                                }
                            }

                            if ( item.flags && item.flags.is_subscription ) {
                                formattedPrice = Granite.I18n.get( '{0}/month', formattedPrice );
                            }

                            if (parseFloat(wasPrice) != 0 && wasPrice != null) {
                                formattedPrice = '<del>' + formattedWasPrice + '</del><em>' + formattedPrice + '</em>';
                            }

                        } else {
                            if ( msrp_price && msrp_price.value ) { // price  
                                originalPrice = msrp_price.value;

                                if ( msrp_price.formatted_value ) {
                                    formattedDelPrice = msrp_price.formatted_value;
                                }
                            }

                            if (sale_price && sale_price.value) { // promotionPrice  
                                if ( sale_price.value ) {
                                    salePrice = sale_price.value;
                                }

                                if ( sale_price.formatted_value ) {
                                    formattedPrice = sale_price.formatted_value;
                                }

                                if ( originalPrice && originalPrice === salePrice ) {
                                    formattedDelPrice = '';
                                }
                            } else { // promotionPrice  
                                if ( ( sharedObj.siteCode === 'fi' || sharedObj.siteCode === 'se' || sharedObj.siteCode === 'dk' || sharedObj.siteCode === 'no') && duration && paymentCycle ) {
                                    formattedPrice = Granite.I18n.get( "{0}/month {1}", [formattedDelPrice, duration] );
                                } else {
                                    formattedPrice = formattedDelPrice;
                                }
                            }

                            if ( item.flags && item.flags.is_subscription ) {
                                formattedPrice = Granite.I18n.get( '{0}/month', formattedPrice );
                            }

                            if ( salePrice && originalPrice && originalPrice !== salePrice ) { // price, promotionPrice    
                                formattedFromPrice = '<del>' + formattedDelPrice + '</del>' ;
                            }
                        }

                        let badge = '';
                        if( badgeList.length > 0 ){
                            if( badgeList[index].product_tags ){
                                if( badgeList[index].product_tags[0] ){
                                    badge = badgeList[index].product_tags[0];
                                }
                            }
                        }

                        let itemObj = {
                            'index': count,
                            'optionName': displayName,
                            'optionSalePrice': formattedPrice,
                            'optionOriPrice': formattedFromPrice,
                            'optionSavePrice': formattedSavePrice,
                            'specialText': item.long_description,
                            'badge': badge,
                            'paymentCycle': paymentCycle,
                            'oriPriceValue': msrp_price.value,
                            'summary': item.summary
                        };

                        itemSet.push(itemObj);

                        item.displayName = displayName;
                        priceInfo.formattedPrice = formattedPrice;
                        priceInfo.formattedDelPrice = formattedDelPrice;

                        modelCodeKey[itemCode] = itemCode;
                        count++;

                        if (!dep                         "paymentCycle" : paymentCycle,
                                    "optionSalePrice" : "",
                                    "optionOriPrice" : formattedFromPrice,
                                    "optionSavePrice" : formattedSavePrice
                                }
                            );
                            depth1Theft = true;
                            count2++;
                        } else if(!depth1Damage && !isTheft) {
                            items.push(
                                {
                                    "index": count2,
                                    "isTheft": isTheft,
                                    "optionName" : Granite.I18n.get("Accidental Damage"),
                                    "paymentCycle" : paymentCycle,
                                    "optionSalePrice" : "",
                                    "optionOriPrice" : formattedFromPrice,
                                    "optionSavePrice" : formattedSavePrice
                                }
                            );
                            depth1Damage = true;
                            count2++;
                        }

                        const currency = $("#priceCurrency").val();

                        $.map($.grep(items, function(grepItem, index) {return grepItem.isTheft === isTheft}), function(mapItem, index) {
                            if ( !mapItem.itemSet ) {
                                mapItem.itemSet = [];
                            }

                            mapItem.itemSet.push(itemObj);
                        })
                    }
                }
			} else {
                for( var index in careData ){
                    const item = careData[index];
                    const itemCode = item.modelCode;

                    if ( !modelCodeKey[itemCode] ){

                        let priceInfo = {};
                        let displayName = Granite.I18n.get( 'Samsung Care+' );
                        let formattedDelPrice = '';
                        let formattedPrice = '';
                        let formattedSavePrice = '';
                        let formattedFromPrice = '';
                        let salePrice  = '';
                        let originalPrice = '';
                        let prePopup = false; //only it
                        //  
                        let duration = '';
                        let paymentCycle = '';
                        // let isSubscription = false;
                        let msrp_price = null;
                        let sale_price = null;

                        let wasPrice = ''; //CRHQ-8306 [B2C][MX][UK] SC+ 
                        let formattedWasPrice = '';

                        if( item.displayName ){
                            displayName = item.displayName;
                        }

                        if( item.price_info && item.price_info[0] ){
                            priceInfo = item.price_info[0];
                            msrp_price = priceInfo.msrp_price;
                            sale_price = priceInfo.sale_price;
                            formattedSavePrice = priceInfo.saveText;
                        }

                        if( msrp_price && msrp_price.duration_value && msrp_price.paymentcycle_value ){
                            // duration 0  paymentCycle null  monthly
                            if( msrp_price.duration_value > 0 && msrp_price.paymentcycle_value != null && msrp_price.paymentcycle_value.toLowerCase() == "monthly"){
                                duration = msrp_price.duration_value;
                                paymentCycle = msrp_price.paymentcycle_value.toLowerCase();
                            }
                        }

                        if( sale_price && sale_price.duration_value && sale_price.paymentcycle_value ){
                            // duration 0  paymentCycle null  monthly
                            if( sale_price.duration_value > 0 && sale_price.paymentcycle_value != null && sale_price.paymentcycle_value.toLowerCase() == "monthly"){
                                duration = sale_price.duration_value;
                                paymentCycle = sale_price.paymentcycle_value.toLowerCase();
                            }
                        }

                        //[EPP] care item null  
                        if(null != msrp_price && "undefined" !== typeof msrp_price.wasValue){//CRHQ-8306
                            if( msrp_price && msrp_price.value ){// price  
                                originalPrice = msrp_price.value;
                                wasPrice = msrp_price.wasValue;

                                if( msrp_price.formatted_value ){
                                    formattedDelPrice = msrp_price.formatted_value;
                                }
                                if( msrp_price.formatted_wasValue){
                                    formattedWasPrice = msrp_price.formatted_wasValue;
                                }
                            }
                            if(sharedObj.siteCode === 'uk' && parseFloat(msrp_price.value) == 0){
                                formattedPrice = Granite.I18n.get("Free");
                            }else{
                                if( sale_price && sale_price.value ){// promotionPrice  
                                    if( sale_price.value ){
                                        salePrice = sale_price.value;
                                    }
                                    if( sale_price.formatted_value ){
                                        formattedPrice = sale_price.formatted_value;
                                    }
                                    if( originalPrice && originalPrice === salePrice ){
                                        formattedDelPrice = '';
                                    }
                                    // formattedDelPrice='';
                                } else {// promotionPrice  
                                    if( ( sharedObj.siteCode === 'fi' || sharedObj.siteCode === 'se' || sharedObj.siteCode === 'dk' || sharedObj.siteCode === 'no') && duration && paymentCycle ){
                                        formattedPrice = Granite.I18n.get( "{0}/month {1}", [formattedDelPrice, duration] );
                                    }else{
                                        formattedPrice = formattedDelPrice;
                                    }
                                }

                                if( item.flags && item.flags.is_subscription ){
                                    formattedPrice = Granite.I18n.get( '{0}/month', formattedPrice );
                                    // isSubscription = true;
                                }
                                if( salePrice && originalPrice && originalPrice !== salePrice ){// price, promotionPrice    
                                    if( ( sharedObj.siteCode === 'fi' || sharedObj.siteCode === 'se' || sharedObj.siteCode === 'dk' || sharedObj.siteCode === 'no') && duration && paymentCycle ){
                                        formattedPrice = Granite.I18n.get( "{0}/month {1}", [formattedPrice, duration] );
                                    }
                                }
                            }

                            if(sharedObj.siteCode === 'it' && parseFloat(msrp_price.value) == 0){ //CRHQ-89 [B2C] IT - sc+ 0   
                            	var currency = $("#priceCurrency").val();
                            	prePopup = true;
                            	formattedPrice = currencyComma( parseFloat(msrp_price.value), currency ).replace(",00", "");
                            }else{
                            	if(parseFloat(wasPrice) != 0 && wasPrice != null){
                                    formattedPrice = '<del>' + formattedWasPrice + '</del><em>' + formattedPrice + '</em>';
                                }
                            }
                        }else{
                            if( msrp_price && msrp_price.value ){// price  
                                originalPrice = msrp_price.value;

                                if( msrp_price.formatted_value ){
                                    formattedDelPrice = msrp_price.formatted_value;
                                }
                            }

                            if( sale_price && sale_price.value ){// promotionPrice  
                                if( sale_price.value ){
                                    salePrice = sale_price.value;
                                }
                                if( sale_price.formatted_value ){
                                    formattedPrice = sale_price.formatted_value;
                                }
                                if( originalPrice && originalPrice === salePrice ){
                                    formattedDelPrice = '';
                                }
                                // formattedDelPrice='';
                            } else {// promotionPrice  
                                if( ( sharedObj.siteCode === 'fi' || sharedObj.siteCode === 'se' || sharedObj.siteCode === 'dk' || sharedObj.siteCode === 'no') && duration && paymentCycle ){
                                    formattedPrice = Granite.I18n.get( "{0}/month {1}", [formattedDelPrice, duration] );
                                }else{
                                    formattedPrice = formattedDelPrice;
                                }
                            }

                            if( item.flags && item.flags.is_subscription ){
                                formattedPrice = Granite.I18n.get( '{0}/month', formattedPrice );
                                // isSubscription = true;
                            }
                            if( salePrice && originalPrice && originalPrice !== salePrice ){// price, promotionPrice    
                                if( ( sharedObj.siteCode === 'fi' || sharedObj.siteCode === 'se' || sharedObj.siteCode === 'dk' || sharedObj.siteCode === 'no') && duration && paymentCycle ){
                                    formattedPrice = Granite.I18n.get( "{0}/month {1}", [formattedPrice, duration] );
                                }
                                if( sharedObj.siteCode === 'nl' || sharedObj.siteCode === 'be' || sharedObj.siteCode === 'be_fr' || sharedObj.siteCode === 'de' ){
                                    formattedFromPrice = Granite.I18n.get("From {0}", '<del>'+formattedDelPrice+'</del>' );
                                } else {
                                    if( sharedObj.siteCode === 'jp'){
                                        //jp
                                        formattedFromPrice = '( : '+formattedDelPrice+')' ; //sample (:33,583)
                                    } else {
                                        //
                                    formattedFromPrice = '<del>'+formattedDelPrice+'</del>' ;
                                    }
                                }
                            }
                        }

                        let badge = '';
                        if( badgeList.length > 0 ){
                            if( badgeList[index].product_tags ){
                                if( badgeList[index].product_tags[0] ){
                                    badge = badgeList[index].product_tags[0];
                                }
                            }
                        }

                        itemSet.push(
                            {
                                'index' : count+1,
                                'prePopup' : prePopup, //only it
                                'optionName' : displayName,
                                'optionSalePrice' : formattedPrice,
                                'optionOriPrice' : formattedFromPrice,
                                'optionSavePrice' : formattedSavePrice,
                                'specialText' : item.long_description,
                                'badge' : badge,
                                'paymentCycle' : sharedObj.siteCode === 'fr' ? paymentCycle : ''
                            }
                        )

                        item.displayName = displayName;
                        priceInfo.formattedPrice = formattedPrice;
                        priceInfo.formattedDelPrice = formattedDelPrice;

                        modelCodeKey[itemCode] = itemCode;
                        count++;

                    }
                }
			}

			view.productAddOnCare( drawObj );
		}
		
		totalAfterFunction( sharedObj, selectorObj ){
			this.optionExposureRule( sharedObj, selectorObj );
			this.settingPriceDraw( sharedObj, selectorObj );
			this.setSamcolVatFreePrice(sharedObj); 
			this.settingPriceCta ( sharedObj.hasPriceCta, sharedObj, selectorObj, sharedObj.currentUrl );
			this.settingBezelOptionDraw (sharedObj, selectorObj); //VD bezel draw
			this.settingBezelInfo( sharedObj, selectorObj ); //VD bezel color
			this.settingGiftCard( sharedObj, selectorObj ); //PD Gift Card
			this.settingDeliveryPickup( sharedObj, selectorObj ); //PD EDD
			this.settingRecommendation( sharedObj, selectorObj ); //PD Recommendation
		}
		
		/**
		 *     .
	;
			clickTariffPlan( sharedObj, selectorObj );
			clickTradeItorObj );
			clickCombo( sharedObj, selectorObj );
			clickGift( sharedObj, selectorObj );
			clickUpgrade( sharedObj, selectorObj );
			clickCare( sharedObj, selectorObj );
			clickWarranty( sharedObj, selectorObj );
			clickForever( sharedObj, selectorObj );
			clickCTA( sharedObj, selectorObj );
			clickDelivery( sharedObj, selectorObj );
			clickCalculator( sharedObj, selectorObj );
			clickEip( sharedObj, selectorObj );
			clickEipEE( sharedObj, selectorObj );
			clickLinks( sharedObj, selectorObj );
			clickGlallery( sharedObj, selectorObj );
			clickEppDiscount( sharedObj, selectorObj );
			clickAssured( sharedObj, selectorObj );
			clickEmbedAddOn( sharedObj, selectorObj );
			clickGiftCard( sharedObj, selectorObj );
			clickSMB( sharedObj, selectorObj ); // in  , gpv2  
		}
		
		getQuerystring(paramName){
			var _tempUrl = window.location.search.substring(1);
			var _tempArray = _tempUrl.split('&');
			for(var i = 0; i<_tempArray.length; i++) {
				var _keyValuePair = _tempArray[i].split('=');
				if(_keyValuePair[0] === paramName){
					return _keyValuePair[1];
				}
			}
		}
		
		getBrowserName() {
			let name = "Unknown";
			if(navigator.userAgent.indexOf("MSIE")!==-1){
				name = "MSIE";
			}
			else if(navigator.userAgent.indexOf("Firefox")!==-1){
				name = "Firefox";
			}
			else if(navigator.userAgent.indexOf("Opera")!==-1){
				name = "Opera";
			}
			else if(navigator.userAgent.indexOf("Chrome") !== -1){
				name = "Chrome";
			}
			else if(navigator.userAgent.indexOf("Safari")!==-1){
				name = "Safari";
			}
			return name;
		}
		
		/**
		 * String   class       
		 */
		removeClass( original, removeClass ) {
			return original.replace(removeClass,'').replace('  ',' ');
		}
		
		/**
		 * String   class  
		 */
		addClass( original, addClass ) {
			return original += ' ' + addClass;
		}
		
		/**
		 * total key    merge,   
		 */
		merge( total, key, merge, apiType='' ){
			if(!merge) return;
				
			if( total[key] ) {
				$.extend(total[key], merge);
			} else {
				total[key] = merge;
				total[key].apiType = '';
			}
			
			const item = total[key];
			
			if( apiType ){
				item.apiType += ' '+apiType;
			}
			//  add-on    price_info  saveText  
			if( item.price_info && item.price_info.length > 0 ){
				const currency = $("#priceCurrency").val();
				const siteCode = $("#siteCode").val();
				
				for( var index in item.price_info ){
					const priceItem = item.price_info[index];
					let price = '';
					let formattedPrice = '';
					let saveText = '';
					if( priceItem.msrp_price &&  priceItem.msrp_price.value ){
						price = priceItem.msrp_price.value;
						formattedPrice = priceItem.msrp_price.formatted_value;
						if ( formattedPrice === null ) {
							formattedPrice = currencyComma( price, currency );
							priceItem.msrp_price.formatted_value = formattedPrice;
						}
					}
					
					if (priceItem.sale_price && priceItem.sale_price.value ) {
						if ( price !== priceItem.sale_price.value ) {
							if (priceItem.discount_description && priceItem.discount_description.type && "rebate,percentage".indexOf(priceItem.discount_description.type.toLowerCase()) > -1 &&priceItem.discount_description.formatted_value ) {
								saveText = priceItem.discount_description.formatted_value;
							} else {
								saveText = currencyComma(price - priceItem.sale_price.value, currency);
							}
							saveText = Granite.I18n.get("Save {0}", saveText, siteCode);
						}
						price = priceItem.sale_price.value;
						formattedPrice = priceItem.sale_price.formatted_value;
						if ( formattedPrice === null ) {
							formattedPrice = currencyComma(price, currency);
							priceItem.sale_price.formatted_value = formattedPrice;
						}
					}
					
					priceItem.saveText = saveText;
					
					// new-hybris
					if( siteCode === 'nl' || siteCode === 'be' || siteCode === 'be_fr' ){
						if( priceItem.list_price && priceItem.list_price.formatted_value ){
							priceItem.list_price.formatted_value = deleteCurrency( priceItem.list_price.formatted_value, currency).trim();
						}
						
						if( priceItem.msrp_price && priceItem.msrp_price.formatted_value ){
							priceItem.msrp_price.formatted_value = deleteCurrency( priceItem.msrp_price.formatted_value, currency).trim();
						}
						
						if( priceItem.sale_price && priceItem.sale_price.formatted_value ){
							priceItem.sale_price.formatted_value = deleteCurrency( priceItem.sale_price.formatted_value, currency).trim();
						}
						
					}
					
				}
			}
		}
		
		/**
		 *    array    
		 */
		removeElement( removeArray ){
			for( var index in removeArray ){
				const item = removeArray[index];
				if( item && item.length > 0 ){
					$(removeArray).html = '';
					$(removeArray).hide();
				}
			}
		}
		
		/**
		 *     disabled  
		 */
		addDisabledAllNotOneElement( element , sharedObj ){
			const $element = $(element);
			const disabledCtaClass = sharedObj.disabledCtaClass;
			if( $element && $element.length > 0 ){
				const input = $element.find('.option-input:gt(0)');
				if( input.length > 0 ){
					$(input.parent().parent()).addClass(disabledCtaClass);
				}
				
			}
		}
		
		/**
		 *   disabled  
		 */
		addDisabledAllElement( element , sharedObj ){
			const $element = $(element);
			const disabledCtaClass = sharedObj.disabledCtaClass;
			if( $element && $element.length > 0 ){
				const input = $element.find('.option-input');
				if( input.length > 0 ){
					const parent = input.parent().parent();
					input.attr('disabled','true');
					$(parent).addClass(disabledCtaClass);
				}
				
			}
		}
		
		/**
		 *  cta disabled 
		 */
		removeDisabledAllElement( element , sharedObj ){
			const $element = $(element);
			const disabledCtaClass = sharedObj.disabledCtaClass;
			if( $element && $element.length > 0 ){
				const input = $element.find('.option-input');
				if( input.length > 0 ){
					const parent = input.parent().parent();
					input.removeAttr('disabled');
					$(parent).removeClass(disabledCtaClass);
				}
			}
		}
		
		/**
		 * YES , NO     input disabled 
		 */
		addDisabledSecondElement( element , sharedObj ){
			const $element = $(element);
			const disabledClass = sharedObj.disabledCtaClass;
			if( $element && $element.length > 0 ){
				const input = $element.find('.option-input');
				if( input.length > 0 ){
					const $first = $($(input).get(1));
					$first.parent().parent().addClass(disabledClass);
				}
				
			}
		}
		
		/**
		 * YES , NO    input selected 
		 */
		addCheckedFirstElement( element ){
			const $element = $(element);
			if( $element && $element.length > 0 ){
				const input = $element.find('.option-input');
				if( input.length > 0 ){
					const $first = $($(input).get(0));
					$first.attr('checked','checked');
					$first.parent().parent().addClass('selected');
				}
				
			}
		}
		
		/**
		 * YES , NO    input selected
		 */
		addCheckedSecondElement( element ){
			const $element = $(element);
			if( $element && $element.length > 0 ){
				const input = $element.find('.option-input');
				if( input.length > 0 ){
					const $first = $(input).get(1);
					$first.attr('checked','checked');
					$first.parent().parent().addClass('selected');
				}
				
			}
		}
		
		/**
		 * input   selected
		 */
		removeCheckedElement( element ){
			const $element = $(element);
			if( $element && $element.length > 0 ){
				const input = $element.find('.option-input');
				if( input.length > 0 ){
					input.prop('checked',false);
					input.parent().parent().removeClass('selected');
				}
			}
		}
		
		/**
		 *   disabled 
		 */
		disabledOptionElement( element, sharedObj ){
			const $element = $(element);
			const disabledClass = sharedObj.disabledClass;
			const selectedClass = sharedObj.selectedClass;
			
			if( $element && $element.length > 0 ){
				if( !$element.hasClass(disabledClass) ){
					$element.addClass(disabledClass);
				}
				
				if( $element.hasClass(selectedClass) ){
					$element.removeClass(selectedClass);
				}
			}
		}
		
		/**
		 *   select  
		 */
		removeSelectedOptionElement( element, sharedObj ){
			const $element = $(element);
			const selectedClass = sharedObj.selectedClass;
			
			if( $element && $element.length > 0 ){
				if( $element.hasClass(selectedClass) ){
					$element.removeClass(selectedClass);
				}
			}
		}
		
		/**
		 * emi url 
		 */
		getEmiUrl( sharedObj, selectorObj ){
			const salePrice = sharedObj.totalPrice.sale;
			const siteCode = sharedObj.siteCode;
			const financingUrl = sharedObj.financingUrl;
			const emiCalculatorUrl = sharedObj.emiCalculatorUrl;
			
			let emiUrl = '';
			// new-hybris
			if( siteCode === 'uk' || siteCode === 'in' || siteCode === 'id'){
				emiUrl = sharedObj.emiUrl + "/?sku=" + sharedObj.shopSkuCode + "&price=" + salePrice + "&page=simple buying tool:offer";
			} else if( siteCode === 'de' ){
				// new-hybris
				emiUrl = financingUrl;
			} else if ( siteCode === 'pl' || siteCode === 'hu' || siteCode === 'lt' || siteCode === 'ro' || siteCode === 'ua'){
				emiUrl = emiCalculatorUrl;
			} else if( siteCode === 'ee' || siteCode === 'lv'  ){
				emiUrl = 'javascript:void(0);';
			} else {
				emiUrl = financingUrl + "/?total=" + salePrice + "&page=pdp";
			}
			
			return emiUrl;
		}
		
		/**
		 *    enabled 
		 */
		removeDisabledElement( element, sharedObj ){
			const $element = $(element);
			const disabledClass = sharedObj.disabledClass;
			
			if( $element && $element.length > 0 ){
				$element.removeClass(disabledClass);
			}
		}
		
		/**
		 * exchange API   
		 */
		settingExchangeAPIData( data , sharedObj, selectorObj, view ){
			const util = sharedObj.util;
			const drawObj = sharedObj.drawObj;
			const siteCode = sharedObj.siteCode;
			const hasForeverResult = util.hasForeverResult( sharedObj, selectorObj );
			const hasForever = util.hasForever( sharedObj, selectorObj );
			
			let displayModelName = '';
			let displayBrandName = '';
			let exchangePrice = 0;
			let addtionalPrice = 0;
			let totalPrice = 0;
			let specialDiscount = 0;
			
			//CE Trade In
			let partner = '';
			let productCondition = '';
			let productCategory = '';
			
			if( data ){
				if( data.device_info ){
					if( data.device_info.name ){
						displayModelName = data.device_info.name;
					}
					if( data.device_info.brand ){
						displayBrandName = data.device_info.brand;
					}
				}
				//CE Trade In
				if(sharedObj.tradeInType == "CE"){
					if( data.device_info ){
						productCondition = data.device_info.product_condition;
						productCategory = data.device_info.category;
					}
					if(data.partner){
						partner = data.partner;
					}
				}
				
				var modelAndBrand = "";
				if( displayBrandName ){
					modelAndBrand += displayBrandName;
				}
				if( modelAndBrand ){
					modelAndBrand += " | ";
				}
				if( displayModelName ){
					modelAndBrand += displayModelName;
				}
				
				//  , shoptg   
				if( data.estimated_discount ){
					if( data.estimated_discount.exchange_discount ){
						addtionalPrice = parseFloat( data.estimated_discount.exchange_discount.amount );
					}
					if( data.estimated_discount.exchange_value ){
						exchangePrice = parseFloat( data.estimated_discount.exchange_value.amount );
					}
					if( data.estimated_discount.total ){
						totalPrice = parseFloat( data.estimated_discount.total.amount );
					}
					//NOTICE :  uk CE trade in  (     )
					if( sharedObj.tradeInType === 'CE' && siteCode === 'uk' ){
						if(window.location.host.indexOf("p6-pre-qa3.")>-1){
							const totalPriceValue = selectorObj.buyingToolOptTradeIn.find('#pd-trade-in-0').attr('data-total-price');
							totalPrice = parseFloat( totalPriceValue );
						}
					}
				}
				
				if( data.estimated_discount ){
					if( data.estimated_discount.special_discount ) {
						if( data.estimated_discount.special_discount.amount ) {
							specialDiscount = parseFloat( data.estimated_discount.special_discount.amount );
						}
					}
				}
				
				if(sharedObj.tradeInType == "CE"){
					sharedObj.exchangeApiData = {
							'exchangeFlag' : true,
							'modelAndBrand' : modelAndBrand,
							'isUpfront': !data.delayed_gratification,
							'specialDiscount' : specialDiscount,
							'exchangePrice' : exchangePrice,
							'addtionalPrice' : addtionalPrice,
							'totalPrice' : totalPrice,
							'dataQuoteId' : data.dataQuoteId,
							'foreverId' : data.foreverId,
							'partner' : partner,
							'productCondition' : productCondition,
							'productCategory' : productCategory
						}
				}else{
					sharedObj.exchangeApiData = {
							'exchangeFlag' : true,
							'modelAndBrand' : modelAndBrand,
							'isUpfront': !data.delayed_gratification,
							'specialDiscount' : specialDiscount,
							'exchangePrice' : exchangePrice,
							'addtionalPrice' : addtionalPrice,
							'totalPrice' : totalPrice,
							'dataQuoteId' : data.dataQuoteId,
							'foreverId' : data.foreverId
						}
					if (data.withCeTradeUpPopup) { // called by CE(VD/DA) Trade-up popup
						sharedObj.exchangeApiData.withCeTradeUpPopup = true;
					}
				}
				
				util.exchangeResultDraw( sharedObj, selectorObj );
				
				if( hasForever ){
					util.foreverDraw( sharedObj, selectorObj ); // forever     
				}
				
				if( hasForeverResult ){
					view.galaxyForeverResultDraw( drawObj ); // forever     
				}
				
				util.totalAfterFunction( sharedObj, selectorObj );
			}
		}
		
		exchangeResultDraw( sharedObj, selectorObj ){
			const view = sharedObj.view;
			const util = sharedObj.util;
			const priceCurrency = sharedObj.priceCurrency;
			const drawObj = sharedObj.drawObj;
			const siteCode = sharedObj.siteCode;
			const hasOffer = util.hasOffer( sharedObj, selectorObj );
			const hasForeverResult = util.hasForeverResult( sharedObj, selectorObj );
			const exchangeApiData = sharedObj.exchangeApiData; 
			const modelAndBrand = exchangeApiData.modelAndBrand;
			const exchangePrice = exchangeApiData.exchangePrice;
			const addtionalPrice = exchangeApiData.addtionalPrice;
			const totalPrice = exchangeApiData.totalPrice;
			const isUpfront = exchangeApiData.isUpfront;
			//CE Trade In
			const partner = exchangeApiData.partner;
			const productCondition = exchangeApiData.productCondition;
			const productCategory = exchangeApiData.productCategory;
			
			let hasBogo = false;
			let hasCombo = false;
			let displayPrice = 0;
			let dataPrice = 0;
			let discountText1 = null;
			let dataQuoteId = exchangeApiData.dataQuoteId;
			
			if( hasOffer ){
				hasBogo = util.hasBogo( sharedObj, selectorObj );
				hasCombo = util.hasComboResult( sharedObj, selectorObj );
			}
			
			if( exchangeApiData.exchangeFlag ){
				if( exchangePrice ){
					if( hasBogo ||  hasCombo || hasForeverResult ){
						displayPrice = totalPrice - addtionalPrice;
					} else {
						displayPrice = totalPrice;
					}
				} else {
					displayPrice = totalPrice;
				}
				
				let displayCurrencyPrice = currencyComma(displayPrice , priceCurrency);
				if( isUpfront ){
					dataPrice = displayPrice;
					discountText1 = displayCurrencyPrice  + "(" + Granite.I18n.get('Instant Discount') + ")";
				}else{
					discountText1 = displayCurrencyPrice  + "(" + Granite.I18n.get('Assured Value') + ")";
				}
				
				if( hasForeverResult && siteCode === 'in' && exchangeApiData.foreverId ){
					dataQuoteId = exchangeApiData.foreverId; 
				}
				
				var productConditionClassName = ".siel-trade-in-popup-option__condition-check-desc-"+productCondition;
				var productConditionUpperCase = "";
				
				if(sharedObj.tradeInType == "CE"){
					if(productCondition) {
						if(productCategory != "Television" && productCondition == "average"){
							productConditionUpperCase = "Average";
						}else{
							//product_condition   
							productConditionUpperCase = productCondition[0].toUpperCase() + productCondition.slice(1, productCondition.length);
						}
					}
				}
				if(sharedObj.tradeInType == "CE"){
					if(siteCode === 'in'){
						drawObj.tradeInResult = {
								'hasComponent' : true,
								'textTitleCe' : "Congratulations your exchange has been applied",
								'textCe' : "Get exchange value of up to "+totalPrice+" on your old product <br> By: <strong>"+partner+"<strong>",
								'description' : "Actual Exchange discount will depend upon Product Evaluation results",
								'tooltip' : productConditionUpperCase+"("+totalPrice+")<br> "+ $(productConditionClassName).text(),
								'dataQuoteId' : dataQuoteId,
								'isUpfront' : isUpfront,
								'discountText1' : discountText1,
								'dataPrice' : dataPrice
							}
					}else if(siteCode === 'uk'){
						let description = `Get ${currencyComma(totalPrice,priceCurrency)} off your order instantly for recycling your TV`;
						if( sharedObj.categoryTypeCode === '08030000' || sharedObj.categoryTypeCode === '08010000' || sharedObj.categoryTypeCode === '08070000' || sharedObj.categoryTypeCode === '07010000' ){
							switch( sharedObj.categoryTypeCode ){
								case '08030000':
									description = `Get ${currencyComma(totalPrice,priceCurrency)}</span> for recycling your refrigerator</strong>`;
									break;
								case '08010000':
									description = `Get ${currencyComma(totalPrice,priceCurrency)}</span> for recycling your laundry device</strong>`;
									break;
								case '08070000':
									description = `Get ${currencyComma(totalPrice,priceCurrency)}</span> for recycling your vacuum</strong>`;
									break;
								case '07010000':
									description = `Get ${currencyComma(totalPrice,priceCurrency)}</span> for recycling your monitor</strong>`;
									break;
								default:
									break;
							}
						}
						drawObj.tradeInResult = {
								'hasComponent' : true,
								'discountText1' : discountText1,
								'description' : description,
								'dataPrice' : dataPrice,
								'dataQuoteId' : dataQuoteId,
								'isUpfront' : isUpfront
							}
					}
					 
				}else{
					if (exchangeApiData.withCeTradeUpPopup) {
						let ctI18nHint = "b2c_" + sharedObj.ceTradeUpPopup.productCategoryGroup;
						if (!CeTradeUpPopup.config.view.showDiscountAmount.inResultBanner) {
							discountText1 = "";
						} else {
							let key = CeTradeUpPopup.config.shop.isCashbackSite ? "\"{0}\" (Assured Value)" : "\"{0}\" (Instant Discount)";
							discountText1 = Granite.I18n.get(key, [displayCurrencyPrice], ctI18nHint);
						}
						let desc = "";
						if (CeTradeUpPopup.config.view.showDiscountAmount.inResultDescription) {
							desc = Granite.I18n.get('Get {0} off you order instantly for recycling your device', [displayCurrencyPrice], ctI18nHint);
						}
						drawObj.tradeInResult = {
							'hasComponent' : true,
							'discountText1' : discountText1,
							'description' : desc,
							'dataPrice' : dataPrice,
							'dataQuoteId' : dataQuoteId,
							'isUpfront' : isUpfront
						};
					} else {
						drawObj.tradeInResult = {
							'hasComponent' : true,
							'displayModelName' : Granite.I18n.get("Your Trade-in") + " : " +  modelAndBrand,
							'discountText1' : discountText1,
							'description' : Granite.I18n.get('*Actual trade-in discount might differ from estimated discount.'),
							'dataPrice' : dataPrice,
							'dataQuoteId' : dataQuoteId,
							'isUpfront' : isUpfront
						}
					}
				}
				
				window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-trade-in-0"));
				
				view.tradeInResultDraw( drawObj );
				
				if( drawObj.deliveryResult.priorityText !== null && drawObj.tradeInResult.isUpfront === true ) {
					$(selectorObj.buyingToolOptDeliveryResult).find('.delivery-priority').hide();
				} else if( drawObj.deliveryResult.priorityText !== null && drawObj.tradeInResult.isUpfront === false ) {
					$(selectorObj.buyingToolOptDeliveryResult).find('.delivery-priority').show();
				}
				
				window.sg.components.pdBuyingTool.bindPdTooltipEvent(); // delivery tooltip
			}
		}
		
		foreverDraw( sharedObj, selectorObj ){
			const foreverData = sharedObj.foreverFinanceInfo;
			const productPrice = foreverData.productPrice ? parseFloat(foreverData.productPrice) : 0;
			const assuredBuyBack = foreverData.assuredBuyBack ? parseFloat(foreverData.assuredBuyBack ) : 0;
			const tenureValue = foreverData.tenureValue ? parseFloat(foreverData.tenureValue ) : 0;
			const carePrice = foreverData.carePrice ? parseFloat(foreverData.carePrice ) : 0;
			const drawObj = sharedObj.drawObj;
			const priceCurrency = sharedObj.priceCurrency;
			const view = sharedObj.view;
			const util = sharedObj.util;
			const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
			const tradeInPrice = sharedObj.drawObj.tradeInResult.dataPrice;
			
			let exchangeDiscount = 0;
			let foreverPrice = 0;
			let description = '';
			let learnMoreCta = {};
			let customsObj = {};
			
			if( hasTradeInResult ){
				exchangeDiscount = tradeInPrice;
				foreverData.tradeinCheckFlag = true;
				foreverData.tradeinprice = tradeInPrice;
				if( tradeInPrice == 0 ){
					foreverData.tradeinDiscountYn = true // 
				} else {
					foreverData.tradeinDiscountYn = false // 
				}
				
			}
			
			foreverPrice = ( productPrice + carePrice - exchangeDiscount -assuredBuyBack )/tenureValue;
				
			foreverData.foreverPrice = foreverPrice;
			
			customsObj.layerTarget = '#hubble-forever-learnmore-layer'; //     
			learnMoreCta = util.getAttrCta( Granite.I18n.get('Learn more'), 'javascript:;', '_self', '', customsObj, '' );
			
			description = Granite.I18n.get('Pay {0} per month and own the device for {1} months.', [ currencyComma( foreverPrice, priceCurrency ) , tenureValue ] )
			drawObj.galaxyForever = {
				'hasComponent' : foreverData.foreverFlag,
				'title' : Granite.I18n.get('Galaxy Forever'),
				'description' : description,
				'learnMoreCta' : learnMoreCta,
				'yesAttr' : {
					'class' : 'hubble-pd-popup-opener',
					'text': Granite.I18n.get('YES'),
					'subText': null,
					'layerTarget' : "#hubble-galaxy-forever-layer"
				},
				'noAttr' : {
					'class' : 'hubble-pd-popup-opener',
					'text': Granite.I18n.get('NO'),
					'layerTarget':null,
					'eventType' : 'forever'
				}
			}
			
			view.galaxyForeverDraw( drawObj );
		}
		
		/**
		 *           
		 */
		optionExposureRule( sharedObj, selectorObj ){
			const siteCode = sharedObj.siteCode;
			let checkingRule = {};
			let doubleCheckOptoin = {};

			switch (siteCode) {
				case 'uk':
					//           ,       //new-hybris
					checkingRule = {
						'tariffOption' : ['tradeIn','upgrade','care','warranty'],
						'tradeIn' : ['tariffOption','upgrade'],
						'upgrade' : ['tariffOption','tradeIn','combo','accessory'],
						'care' : ['tariffOption'],
						'warranty' : ['tariffOption'],
						'combo' : ['upgrade']
					}
					
					//         
					//         .( price  )
					doubleCheckOptoin = {
						'tariffOption': ['tradeIn','upgrade','care','warranty','price'],
						'tradeIn': ['tariffOption','upgrade','price'],
						'upgrade' : ['tariffOption','tradeIn','combo','price'],
						'care' : ['tariffOption'],
						'warranty' : ['tariffOption'],
						'combo' : ['upgrade','price'],
						'accessory' : ['upgrade','price']
					}
					
					this.checkingDiabledEnabled( sharedObj, selectorObj, checkingRule, doubleCheckOptoin );
					
					break;
				case 'de': // new-hybris
					checkingRule = {
						'tariffOption' : ['tradeIn','upgrade','care','warranty','calculate'],
						'tradeIn' : ['tariffOption','warranty'],
						'upgrade' : ['tariffOption','warranty'],
						'care' : ['tariffOption','warranty'],
						'warranty' : ['tariffOption','tradeIn','upgrade','care']
					}
					
					doubleCheckOptoin = {
						'tariffOption': ['tradeIn','upgrade','care','warranty','price'],
						'tradeIn': ['tariffOption','warranty','price'],
						'upgrade' : ['tariffOption','warranty','price'],
						'care' : ['tariffOption','warranty'],
						'warranty' : ['tariffOption','tradeIn','upgrade','care'],
						'calculate' : ['tariffOption']
					}
					
					this.checkingDiabledEnabled( sharedObj, selectorObj, checkingRule, doubleCheckOptoin );
	
					break;
				// CRHQ-7964
				case 'fr': 
					checkingRule = {
						'tariffOption' : ['tradeIn','between'],
						'tradeIn' : ['financing','tariffOption'],
						'between' : ['care','warranty','bogo','combo','financing','accessory','tariffOption'],
						'care' : ['between','warranty'],
						'warranty' : ['between','care']
					}
					doubleCheckOptoin = {
						'tariffOption' : ['tradeIn','between'],
						'between' : ['care','warranty','tariffOption'],
						'care' : ['between','warranty'],
						'warranty' : ['between','care'],
						'bogo' : ['between','price'],
						'combo' : ['between','price'],
						'financing' : ['tradeIn','between'],
						'accessory' : ['between','price']
					}
					
					this.checkingDiabledEnabled( sharedObj, selectorObj, checkingRule, doubleCheckOptoin );

					break;
				case 'nl': // new-hybris
				case 'be': // new-hybris
				case 'be_fr': // new-hybris
					checkingRule = {
						'tariffPlan' : ['tradeIn','between','care','warranty','bogo','combo','accessory'],
						'tradeIn' : ['tariffPlan','between'],
						'between' : ['tariffPlan','tradeIn','care','warranty','bogo','combo','accessory'],
						'care' : ['tariffPlan','between'],
						'warranty' : ['tariffPlan','between'],
						'combo' : ['tariffPlan','between']
					}
					
					doubleCheckOptoin = {
						'tariffPlan' : ['tradeIn','between','care','warranty','combo','price'],
						'tradeIn' : ['tariffPlan','between','price'],
						'between' : ['tariffPlan','tradeIn','care','warranty','combo'],
						'care' : ['tariffPlan','between'],
						'warranty' : ['tariffPlan','between'],
						'bogo' : ['tariffPlan','between','price'],
						'combo' : ['tariffPlan','between','price'],
						'accessory' : ['tariffPlan','between','price']
					}
					
					this.checkingDiabledEnabled( sharedObj, selectorObj, checkingRule, doubleCheckOptoin );
					
					break;
				case 'in':
					checkingRule = {
						'forever' : ['accessory']
					}
					doubleCheckOptoin = {}
					
					this.checkingDiabledEnabled( sharedObj, selectorObj, checkingRule, doubleCheckOptoin );

					break;
				case 'it':
                    //           ,      
                    checkingRule = {
                        'between' : ['accessory','care','tradeIn']
                    }
                    
                    //         
                    //         .( price  )
                    doubleCheckOptoin = {
						'accessory': ['between'],
                        'care': ['between'],
                        'tradeIn' : ['between']
                    }
                    
                    this.checkingDiabledEnabled( sharedObj, selectorObj, checkingRule, doubleCheckOptoin );
                    
                    break;
				case 'ru':
                    //           ,      
                    checkingRule = {
                        'between' : ['accessory','care','tradeIn']
                    }
                    
                    //         
                    //         .( price  )
                    doubleCheckOptoin = {
						'accessory': ['between'],
                        'care': ['between'],
                        'tradeIn' : ['between']
                    }
                    
                    this.checkingDiabledEnabled( sharedObj, selectorObj, checkingRule, doubleCheckOptoin );
                    
                    break;
    			case 'es':
                    //           ,      
                    checkingRule = {
                        'upgrade' : ['accessory','care','tradeIn']
                    }
                    
                    //         
                    //         .( price  )
                    doubleCheckOptoin = {
						'accessory': ['upgrade'],
                        'care': ['upgrade'],
                        'tradeIn' : ['upgrade']
                    }
                    
                    this.checkingDiabledEnabled( sharedObj, selectorObj, checkingRule, doubleCheckOptoin );
                    
                    break;    
				case 'au':
					checkingRule = {
						'tariffOption' : ['upgrade'],
						'tradeIn' : ['upgrade'],
						'upgrade' : ['tariffOption','tradeIn','care','accessory'],
						'care' : ['upgrade'],
						'accessory' : ['upgrade']
					}
					
					doubleCheckOptoin = {
						'tariffOption': ['upgrade'],
						'tradeIn': ['upgrade'],
						'upgrade' : ['tariffOption','tradeIn','care','accessory'],
						'care' : ['upgrade'],
						'accessory' : ['upgrade']
					}
					
					this.checkingDiabledEnabled( sharedObj, selectorObj, checkingRule, doubleCheckOptoin );
	
					break;
			}
			
		}
		
		/**
		 * checkingRule doubleCheckOptoin   disabled, enabeld 
		 */
		checkingDiabledEnabled( sharedObj, selectorObj, checkingRule, doubleCheckOptoin ){
			const drawObj= sharedObj.drawObj;
			
ariffOption,
				'tradeIn' : this.disabledTradeIn,
				'upgrade' : this.disabledUpgrade,
				'between' : this.disabledBetween,
				'care' : this.disabledCare,
				'warranty' : this.disabledWarranty,
				'bogo' : this.disabledBogo,
				'combo' : this.disabledCombo,
				'calculate' : this.disabledCalculate,
				'financing' : this.disabledFinancing,
				'tariffPlan' : this.disabledTariffPlan,
				'accessory' :  this.disabledAccessory
			}
			
			const enabledTargetComponent = {
				'tariffOption' : this.enabledTariffOption,
				'tradeIn' : this.enabledTradeIn,
				'upgrade' : this.enabledUpgrade,
				'between' : this.enabledBetween,
				'care' : this.enabledCare,
				'warranty' : this.enabledWarranty,
				'bogo' : this.enabledBogo,
				'combo' : this.enabledCombo,
				'calculate' : this.enabledCalculate,
				'financing' : this.enabledFinancing,
				'tariffPlan' : this.enabledTariffPlan,
				'accessory': this.enabledAccessory
			}
			
			//     .
			const hasComponent = {
				'tariffOption' : this.hasTariffOptionResult( sharedObj, selectorObj ),
				'tradeIn' : this.hasTradeInResult( sharedObj, selectorObj ),
				'upgrade' : this.hasUpgradeResult( sharedObj, selectorObj ),
				'between' : this.hasBetweenResult( sharedObj, selectorObj ),
				'care' : this.hasCareResult( sharedObj, selectorObj ),
				'warranty' : this.hasWarrantyResult( sharedObj, selectorObj ),
				'warrantyVd' : this.hasWarrantyVdResult( sharedObj, selectorObj ),
				'combo' : this.hasComboResult( sharedObj, selectorObj ),
				'tariffPlan' : this.hasTariffPlanResult( sharedObj, selectorObj ),
				'price' : !drawObj.price.priceWrapper.hasPriceWrapper,
				'forever':this.hasForeverResult( sharedObj, selectorObj )
			}
			
			for( var key in checkingRule ){
				if( hasComponent[key] ){
					//     diabeld     disabled  
					// checkingName    disalbed     
					
					const checkingName = checkingRule[key]; 
					
					for( var index in checkingName ){
						const disabledItem = checkingName[index];
						disabeldTargetComponent[disabledItem].call(this,sharedObj, selectorObj);
					}
				} else {
					//      enabled 
					const checkingName = checkingRule[key];
					
					for( var checkingNameIndex in checkingName ){
						const enabledItem = checkingName[checkingNameIndex]; // enabled
																	//  
						const doubleCheckList = doubleCheckOptoin[enabledItem];
						let hasOtherComponent = false;
						
						// doubleCheckList  false enabled 
						for( var doubleIndex in doubleCheckList ){
							const doubleCheckItem = doubleCheckList[doubleIndex];
							const hasDoubledCheckItemResult = hasComponent[doubleCheckItem];
							
							if( hasOtherComponent ) {
								break;
							}
							
							if( hasDoubledCheckItemResult ){
								hasOtherComponent = true;
							}
						}
						
						//    enabled
						if( !hasOtherComponent ){
							enabledTargetComponent[enabledItem].call(this,sharedObj, selectorObj);
						}
					}
				}
			}
 		}
		
		disabledAccessory( sharedObj, selectorObj ){
			sharedObj.accessoryDisabled = true;
		}
		
		enabledAccessory( sharedObj, selectorObj ){
			sharedObj.accessoryDisabled = false;
		}
		
		disabledFinancing( sharedObj, selectorObj ){
			const financingArea = $(selectorObj.buyingToolPriceBar.find('.cost-box__description'));
			financingArea.hide();
			financingArea.addClass('removed');
		}
		
		enabledFinancing( sharedObj, selectorObj ){
			const financingArea = $(selectorObj.buyingToolPriceBar.find('.cost-box__description'));
			financingArea.show();
			financingArea.removeClass('removed');
		}

		disabledCalculate( sharedObj, selectorObj ){
			const calculateArea = $(selectorObj.buyingToolCalculate);
			calculateArea.hide();
		}
		
		enabledCalculate( sharedObj, selectorObj ){
			const calculateArea = $(selectorObj.buyingToolCalculate);
			calculateArea.show();
		}
		
		// combo 
		disabledCombo( sharedObj, selectorObj ){
			const drawObj = sharedObj.drawObj;
			const comboList = drawObj.offer.combo;
			const comboArea = selectorObj.buyingToolOptOffer.find('.pd-offer__item.compoBundle');
			const comboBundleArea = $(selectorObj.buyingToolOptOffer.find('.pd-offer__selected-bundle-wrap'));
			
			this.disabledOptionElement( comboArea ,sharedObj );
			
			for(var index in comboList ){
				const comboItem = comboList[index];
				if( comboItem.item.bundleList ){
					comboItem.item.bundleList = [];
				}
			}
			comboBundleArea.remove();
		}
		
		enabledCombo( sharedObj, selectorObj ){
			const comboArea = selectorObj.buyingToolOptOffer.find('.pd-offer__item.compoBundle');
			this.removeDisabledElement( comboArea ,sharedObj );
		}
		
		hasComboResult( sharedObj, selectorObj ){
			
			const disabledClass = sharedObj.disabledClass;
			const comboArea = $(selectorObj.buyingToolOptOffer.find('.pd-offer__item.compoBundle'));
			let hasComboResult = false;
			
			if( comboArea.length > 0 && !$(comboArea.get(0)).hasClass(disabledClass) ){
				for( var index = 0; index < comboArea.length; index++ ){
					const item = $(comboArea.get(index));
					if( item.find('.pd-offer__selected-bundle').length > 0 ) {
						hasComboResult = true;
						break;
					}
				}
			}
			
			return hasComboResult;
		}
		// new-hybris
		hasGiftResult( sharedObj, selectorObj ){
			let hasGiftResult = false;
			const disabledClass = sharedObj.disabledClass;
			 
			// new-hybris
			if($("#shopIntegrationFlag").val() == 'Hybris-new'){
				if(sharedObj.drawObj.offer.gift.item != undefined && sharedObj.drawObj.offer.gift.item.bundleList){
					hasGiftResult = true;
				}
			}
			else{
				const giftArea = $(selectorObj.buyingToolOptOffer.find('.pd-offer__item.giftBundle'));
				
				
				if( giftArea.length > 0 && !$(giftArea.get(0)).hasClass(disabledClass) ){
					for( var index = 0; index < giftArea.length; index++ ){
						const item = $(giftArea.get(index));
						if( item.find('.pd-offer__selected-bundle').length > 0 ) {
							hasGiftResult = true;
							break;
						}
					}
				}
			}
			
			return hasGiftResult;
		}
		
		// bogo 
		disabledBogo( sharedObj, selectorObj ){
			const bogoArea = selectorObj.buyingToolOptOffer.find('.pd-offer__item.bogo');
			
			this.disabledOptionElement( bogoArea ,sharedObj );
		}
		
		enabledBogo( sharedObj, selectorObj ){
			const bogoArea = selectorObj.buyingToolOptOffer.find('.pd-offer__item.bogo');
			
			this.removeDisabledElement( bogoArea ,sharedObj );
		}
		
		hasBogo( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const bogoArea = selectorObj.buyingToolOptOffer.find('.pd-offer__item.bogo');
			
			return bogoArea.hasClass( hasComponentClass ) && !bogoArea.hasClass( disabledClass );
		}
		
		// tariffPlan  
		disabledTariffPlan( sharedObj, selectorObj ){
			const tariffPlanArea = selectorObj.buyingToolOptTariffPlan;

			this.disabledOptionElement( tariffPlanArea ,sharedObj );
			this.removeSelectedOptionElement( tariffPlanArea ,sharedObj );
			this.removeCheckedElement( tariffPlanArea );
			this.addDisabledAllElement( tariffPlanArea, sharedObj );
		}
		
		enabledTariffPlan( sharedObj, selectorObj ){
			const tariffPlanArea = selectorObj.buyingToolOptTariffPlan;
			
			this.removeDisabledElement( tariffPlanArea ,sharedObj );
			this.removeDisabledAllElement( tariffPlanArea, sharedObj );
		}
		
		hasTariffPlan( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const tariffPlanArea = selectorObj.buyingToolOptTariffPlan;
			
			return tariffPlanArea.hasClass( hasComponentClass ) && !tariffPlanArea.hasClass( disabledClass );
		}

		hasTariffPlanResult( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const selectedClass = sharedObj.selectedClass;
			const tariffPlanArea = selectorObj.buyingToolOptTariffPlan;
			
			return tariffPlanArea.hasClass( hasComponentClass ) && !tariffPlanArea.hasClass( disabledClass ) && tariffPlanArea.hasClass( selectedClass );
		}
		
		addTariffPlanResult( sharedObj, selectorObj ){
			const tariffPlanArea = selectorObj.buyingToolOptTariffPlan;
			const selectedClass = sharedObj.selectedClass
			tariffPlanArea.addClass( selectedClass );
		}
		
		removeTariffPlanResult( sharedObj, selectorObj ){
			const tariffPlanArea = selectorObj.buyingToolOptTariffPlan;
			const selectedClass = sharedObj.selectedClass;
			tariffPlanArea.removeClass( selectedClass );
			this.removeTariffPlanSelectedClass(sharedObj, selectorObj );
		}
		
		removeTariffPlanSelectedClass( sharedObj, selectorObj ){
			const tariffPlanArea = selectorObj.buyingToolOptTariffPlan;
			const tariffPlanSelectedClasss = sharedObj.tariffPlanSelectedClass;
			$(tariffPlanArea).find('.option-input').removeClass( tariffPlanSelectedClasss );
		}
		
		// Between  
		disabledBetween( sharedObj, selectorObj ){
			const betweewnArea = selectorObj.buyingToolOptBetween;
			
			this.removeSelectedOptionElement( betweewnArea ,sharedObj );
			this.removeCheckedElement( betweewnArea );
			this.disabledOptionElement( betweewnArea ,sharedObj );
			this.addDisabledAllElement( betweewnArea, sharedObj );
		}
		
		enabledBetween( sharedObj, selectorObj ){
			const betweewnArea = selectorObj.buyingToolOptBetween;
			
			this.removeDisabledElement( betweewnArea ,sharedObj );
			this.removeDisabledAllElement( betweewnArea, sharedObj );
			
		}
		
		hasBetween( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const betweenArea = selectorObj.buyingToolOptBetween;
			
			return betweenArea.hasClass( hasComponentClass ) && !betweenArea.hasClass( disabledClass );
		}

		hasBetweenResult( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const selectedClass = sharedObj.selectedClass;
			const disabledClass = sharedObj.disabledClass;
			const betweenArea = $(selectorObj.buyingToolOptBetween);
			
			return betweenArea.hasClass( hasComponentClass ) && !betweenArea.hasClass( disabledClass ) && betweenArea.hasClass( selectedClass );
		}
		
		addBetweenResult( sharedObj, selectorObj ){
			const betweenArea = $(selectorObj.buyingToolOptBetween);
			const selectedClass = sharedObj.selectedClass
			betweenArea.addClass( selectedClass );
		}
		
		removeBetweenResult( sharedObj, selectorObj ){
			const betweenArea = $(selectorObj.buyingToolOptBetween);
			const selectedClass = sharedObj.selectedClass
			betweenArea.removeClass( selectedClass );
		}
		
		// Warranty  
		disabledWarranty( sharedObj, selectorObj ){
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const warrantyArea = selectorObj.buyingToolOptWarranty;
			
			this.disabledOptionElement( warrantyArea ,sharedObj );
			this.removeCheckedElement( warrantyArea );
			this.addDisabledAllElement( warrantyArea, sharedObj );
			
			drawObj.warrantyResult = {
				'hasComponent' : false,
				'displayModelName' : null,
				'discountText1' : null,
				'description1' : null,
				'dataPrice' : null,
				'dataSalePrice' : null,
				'dataModelName' : null,
				'dataModelCode' : null,
				'dataId' : null,
				'savedPrice' : null
			}
			
			view.warrantyResultDraw( drawObj );
		}

		enabledWarranty( sharedObj, selectorObj ){
			const warrantyArea = selectorObj.buyingToolOptWarranty;
			this.removeDisabledAllElement( warrantyArea, sharedObj );
			
			this.removeDisabledElement( warrantyArea ,sharedObj );
		}
		
		hasWarranty( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const warrantyArea = selectorObj.buyingToolOptWarranty;
			
			return warrantyArea.hasClass( hasComponentClass ) && !warrantyArea.hasClass( disabledClass );
		}
	
		hasWarrantyResult( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const warrantyResultArea = selectorObj.buyingToolOptWarrantyResult;
			
			return warrantyResultArea.hasClass( hasComponentClass ) && !warrantyResultArea.hasClass( disabledClass );
		}
		
		// WarrantyVd  
		disabledWarrantyVd( sharedObj, selectorObj ){
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const warrantyVdArea = selectorObj.buyingToolOptWarrantyVd;
			
			this.disabledOptionElement( warrantyAreaVd ,sharedObj );
			this.removeCheckedElement( warrantyAreaVd );
			this.addDisabledAllElement( warrantyAreaVd, sharedObj );
			
			drawObj.warrantyVdResult = {
				'hasComponent' : false,
				'displayModelName' : null,
				'discountText1' : null,
				'description1' : null,
				'dataPrice' : null,
				'dataSalePrice' : null,
				'dataModelName' : null,
				'dataModelCode' : null,
				'dataId' : null,
				'savedPrice' : null
			}
			
			view.warrantyVdResultDraw( drawObj );
		}

		enabledWarrantyVd( sharedObj, selectorObj ){
			const warrantyVdArea = selectorObj.buyingToolOptWarrantyVd;
			this.removeDisabledAllElement( warrantyVdArea, sharedObj );
			
			this.removeDisabledElement( warrantyVdArea ,sharedObj );
		}
		
		hasWarrantyVd( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const warrantyVdArea = selectorObj.buyingToolOptWarrantyVd;
			
			return warrantyVdArea.hasClass( hasComponentClass ) && !warrantyVdArea.hasClass( disabledClass );
		}
	
		hasWarrantyVdResult( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const warrantyVdResultArea = selectorObj.buyingToolOptWarrantyVdResult;
			
			return warrantyVdResultArea.hasClass( hasComponentClass ) && !warrantyVdResultArea.hasClass( disabledClass );
		}
		
		hasForever( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const foreverArea = selectorObj.buyingToolOptGalaxyForever;
			
			return foreverArea.hasClass( hasComponentClass ) && !foreverArea.hasClass( disabledClass );
		}
	
		hasForeverResult( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const foreverResultArea = selectorObj.buyingToolOptGalaxyForeverResult;
			
			return foreverResultArea.hasClass( hasComponentClass ) && !foreverResultArea.hasClass( disabledClass );
		}
		

		hasAssuredBuyBack( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const assuredArea = selectorObj.buyingToolOptAssuredBuyBack;
			
			return assuredArea.hasClass( hasComponentClass ) && !assuredArea.hasClass( disabledClass );
		}
	
		hasAssuredBuyBackResultResult( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const assuredResultArea = selectorObj.buyingToolOptAssuredBuyBackResult;
			
			return assuredResultArea.hasClass( hasComponentClass ) && !assuredResultArea.hasClass( disabledClass );
		}
		
		// Care  
		disabledCare( sharedObj, selectorObj ){
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const careArea = selectorObj.buyingToolOptCare;
			
			this.disabledOptionElement( careArea ,sharedObj );
			this.removeCheckedElement( careArea );
			this.addDisabledAllElement( careArea, sharedObj );
			
			drawObj.careResult = {
				'hasComponent' : false,
				'description' : null,
				'dataPrice' : null,
				'dataSalePrice' : null,
				'dataModelName' : null,
				'dataModelCode' : null,
				'dataId' : null,
				'price' : null,
				'disclaimer' : null,
				'savedPrice' : null
			}
			
			view.careResultDraw( drawObj );
		}
		
		enabledCare( sharedObj, selectorObj ){
			const careArea = selectorObj.buyingToolOptCare;
			
			this.removeDisabledElement( careArea ,sharedObj );
			this.removeDisabledAllElement( careArea, sharedObj );
		}
		
		hasCare( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const careArea = selectorObj.buyingToolOptCare;
			
			return careArea.hasClass( hasComponentClass ) && !careArea.hasClass( disabledClass );
		}

		hasCareResult( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const careResultArea = selectorObj.buyingToolOptCareResult;
			
			return careResultArea.hasClass( hasComponentClass ) && !careResultArea.hasClass( disabledClass );
		}
		
		// upgrade 
		disabledUpgrade( sharedObj, selectorObj ){
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const upgradeArea = selectorObj.buyingToolOptUpgrade;
			
			this.disabledOptionElement( upgradeArea ,sharedObj );
			this.removeCheckedElement( upgradeArea );
			this.addDisabledAllElement( upgradeArea, sharedObj );
			
			drawObj.upgradeResult = {
				'hasComponent' : false,
				'displayModelName' : null,
				'discountText1' : null,
				'description1' : null,
				'description2' : null,
				'dataId' : [],
				'dataPrice' : null
			}
			
			view.upgradeResultDraw( drawObj );
		}
		
		enabledUpgrade( sharedObj, selectorObj ){
			const upgradeArea = selectorObj.buyingToolOptUpgrade;
			
			this.removeDisabledElement( upgradeArea ,sharedObj );
			this.removeDisabledAllElement( upgradeArea, sharedObj );
			
		}
		
		hasUpgrade( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const upgradeArea = selectorObj.buyingToolOptUpgrade;
			
			return upgradeArea.hasClass( hasComponentClass ) && !upgradeArea.hasClass( disabledClass )
		}

		hasUpgradeResult( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const upgradeResultArea = selectorObj.buyingToolOptUpgradeResult;
			
			return upgradeResultArea.hasClass( hasComponentClass ) && !upgradeResultArea.hasClass( disabledClass )
		}
		
 		// TradeIn   
		disabledTradeIn( sharedObj, selectorObj ){
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const tradeInArea = selectorObj.buyingToolOptTradeIn;
			
			this.disabledOptionElement( tradeInArea ,sharedObj );
			this.addDidrawObj.tradeInResult = {
				'hasComponent' : false,
				'displayModelName' : null,
				'discountText1' : null,
				'discountText2' : null,
				'discountText3' : null,
				'description' : null,
				'dataPrice' : null,
				'dataCashBack' : null,
				'dataQuoteId' : null,
				'dataId' : []
			}
			
			view.tradeInResultDraw( drawObj );
		}
		
		enabledTradeIn( sharedObj, selectorObj ){
			const tradeInArea = selectorObj.buyingToolOptTradeIn;
			
			this.removeDisabledElement( tradeInArea ,sharedObj );
			this.removeDisabledAllElement( tradeInArea, sharedObj );
		}
		
		hasTradeIn( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const tradeInArea = selectorObj.buyingToolOptTradeIn;
			
			return tradeInArea.hasClass( hasComponentClass ) && !tradeInArea.hasClass( disabledClass )
		}

		hasTradeInResult( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const tradeInResultArea = selectorObj.buyingToolOptTradeInResult;
			
			return tradeInResultArea.hasClass( hasComponentClass ) && !tradeInResultArea.hasClass( disabledClass )
		}
		
		// tariffOption  
		disabledTariffOption( sharedObj, selectorObj ){
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const tariffOptionArea = selectorObj.buyingToolOptTariff;
			
			this.disabledOptionElement( tariffOptionArea ,sharedObj );
			this.addDisabledAllElement( tariffOptionArea, sharedObj );
			this.removeCheckedElement( tariffOptionArea );
			
			drawObj.tariffOptionResult = {
				'hasComponent' : false,
				'description' : null,
				'dataPrice' : null,
				'price' : null,
				'disclaimer': null,
				'dataSimskuCode' : null,
		ToolOptTariff;
			
			this.removeDisabledElement( tariffOptionArea ,sharedObj );
			this.removeDisabledAllElement( tariffOptionArea, sharedObj );
		}
		
		hasTariffOption( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const tariffOptionArea = selectorObj.buyingToolOptTariff;
			
			return tariffOptionArea.hasClass( hasComponentClass ) && !tariffOptionArea.hasClass( disabledClass )
		}

		hasTariffOptionResult( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const tariffOptionResultArea = selectorObj.buyingToolOptTariffResult;
			
			return tariffOptionResultArea.hasClass( hasComponentClass ) && !tariffOptionResultArea.hasClass( disabledClass )
		}
		
		hasFinancing( sharedObj, selectorObj ){
			const financingArea = $(selectorObj.buyingToolPriceBar.find('.cost-box__description'));
			return financingArea.length > 0 && !financingArea.hasClass('removed');
		}
		
		hasOffer( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const offerArea = selectorObj.buyingToolOptOffer;
			
			return offerArea.hasClass( hasComponentClass ) && !offerArea.hasClass( disabledClass )
		}
		
		hasAcessory ( sharedObj, selectorObj ){
			return sharedObj.addonsFlag && !sharedObj.accessoryDisabled;
		}
		
		hasDeliveryResult ( sharedObj, selectorObj ){
			
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const deliveryResultArea = selectorObj.buyingToolOptDeliveryResult;
			
			return deliveryResultArea.hasClass( hasComponentClass ) && !deliveryResultArea.hasClass( disabledClass )
		}
		
		getImgAttr ( pcPath, MoPath, alt, customsObj = {} ){
			
			const sdfUtile = window.sg.sdf.util;
			
			const changPcPath = this.imgDomain(pcPath);
			const changMoPath = this.imgDomain(MoPath);
			const lazySrcPc = sdfUtile.previewImageSrc(changPcPath, alt);
			const lazySrcMo = sdfUtile.previewImageSrc(changMoPath, alt);
				
			let imgAttr = {
				'srcPc' : changPcPath,
				'srcMo' : changMoPath,
				'lazySrcPc' : lazySrcPc,
				'lazySrcMo' : lazySrcMo,
				'alt' : alt
			}
			
			for (var key in customsObj ) {
				imgAttr[key] = customsObj[key];
			}
			return imgAttr;
		} 
		
		getAttrCta ( text, linkPath, outLinkType, cssWrapper, customsObj = {}, newWindowClass='new-window' ){
			let attrCta = {};
			let wrapperClass = [cssWrapper];
			
			if( !text ){
				text = null;
			}
			attrCta.text = text;
			if( linkPath ) {
				attrCta.href = linkPath;
			}
			
			if( outLinkType === '_blank' ) {
				const title = Granite.I18n.get( "Open in a new window" );
				attrCta.target ='_blank';
				wrapperClass.push(newWindowClass);
				attrCta.title = title;
			}
			
			attrCta.class = wrapperClass.join(' ');
			
			
			for (var key in customsObj ) {
				if(key =='anla') {
					attrCta['an-la'] = customsObj[key];
				} else {
					attrCta[key] = customsObj[key];
				}
				
			}
			
			return attrCta;
		}
		
		nonCheckError( bindObj ,callFunction ){
			try {
				callFunction.apply(bindObj);
			} catch (e) {
				console.log(e);
			}
		}
		
		escapeHtml(str) {
			var map = {
				'&': '&amp;',
				'<': '&lt;',
				'>': '&gt;',
				'"': '&quot;',
				"'": '&#039;'
			};
			return str.replace(/[&<>"']/g, function(m) { return map[m]; });
		}
		
		imgDomain (imgUrl, iconFl) {
			var newUrl = "";
			var useScene7domain = $('#scene7domain').val();
			if ( imgUrl ){
				if ( imgUrl.indexOf("http:") > -1 || imgUrl.indexOf("//stg-images.samsung.com/") > -1 || imgUrl.indexOf("//images.samsung.com/") > -1 || imgUrl.indexOf("image.samsung.com/") > -1) {
					newUrl = imgUrl;
				} else {
					if (iconFl) useScene7domain = useScene7domain.replace('/image/', '/content/');
					newUrl = useScene7domain + imgUrl;
				}
			}
			
			return newUrl;
		}
		
		isNotEmptyArray ( inputArr ) {
			return inputArr && inputArr.length > 0 && inputArr[0];
		}

		isNotEmpty ( value ) {
			if( (typeof value !== "number" && value === "") || value === null || value === undefined || ( value !== null && typeof value === "object" && !Object.keys(value).length ) ){
				return false
			}else{
				return true
			}
		}
		
		formattingPrice ( price ){
			if(parseFloat(price) < 0){
				price = 0;
			}else{
				if(String(price).indexOf('.') > -1){
					price = price.toFixed(2);
				}
			}
			return price;
		}
		
		hasComponent( element, sharedObj ){
			const hasComponentClass = sharedObj.hasComponentClass;
			const disabledClass = sharedObj.disabledClass;
			const $element = $(element);
			let result = false;
			if( $element.length > 0 ){
				result = $element.hasClass(hasComponentClass) && !$element.hasClass(disabledClass)
			}
			return result;
		}
		// new-hybris
		settingPriceDraw( sharedObj, selectorObj ) {
			const siteCode = sharedObj.siteCode;
			const util = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const hasBetween  = drawObj.between.hasComponent;
			const productPriceInfo = sharedObj.proudctPriceInfo;
			const priceCurrency = sharedObj.priceCurrency;
			const shopIntegrationFlag = $("#shopIntegrationFlag").val();
			
			const hasBetweenResult = util.hasBetweenResult( sharedObj, selectorObj );
			const hasFinancing = util.hasFinancing( sharedObj, selectorObj );
			const paymentMethods = sharedObj.paymentMethods;
			const energyArea = selectorObj.buyingToolPriceBar.find('.cost-box__badge');
			const newEnergyArea = selectorObj.buyingToolPriceBar.find('.cost-box__new-badge'); // 
			
			const hasUpgradeResult = util.hasUpgradeResult( sharedObj, selectorObj );
			
			
			const priceWrapper = drawObj.price.priceWrapper;
			const proOrignalPriceFormatted = sharedObj.proudctPriceInfo.orignalPriceFormatted;
			const proSalePriceFormatted = sharedObj.proudctPriceInfo.salePriceFormatted;
			const proRowSavePrice = sharedObj.proudctPriceInfo.rowCodeformattedPriceSave;
			
			const summaryPrice = priceWrapper.info.summaryPrice;
			
			//duration  0    
			let duration = sharedObj.drawObj.careResult.dataDuration;
			//paymentCycle  monthly   
			let paymentcycle = sharedObj.drawObj.careResult.dataPaymentcycle;
			
			let productOrignalPrice = parseFloat(productPriceInfo.orignalPrice);
			let productSalePrice = parseFloat(productPriceInfo.salePrice);
			let productSalePriceFormatted = productPriceInfo.salePriceFormatted;
			let productSavePrice = productOrignalPrice - productSalePrice;
			
			sharedObj.getOptoinPrice = false;
			
			//SMB 1     
			if( productPriceInfo.productCartCount > 1 ){
				productOrignalPrice = parseFloat(productPriceInfo.orignalPrice) * productPriceInfo.productCartCount;
				productSalePrice = parseFloat(productPriceInfo.salePrice) * productPriceInfo.productCartCount;
				productSalePriceFormatted = currencyComma(productSalePrice, priceCurrency)
				productSavePrice = productOrignalPrice - productSalePrice;
				sharedObj.getOptoinPrice = true;
			}
			
			let totalPrice = {
					original : productOrignalPrice,
					sale : productSalePrice,
					saved : productSavePrice
				}
			
			drawObj.priceAnchor.priceWrapper.info = {};
			drawObj.price.priceWrapper.info = {};
			
			if(sharedObj.giftCard.isGiftCard){
				totalPrice.original = parseFloat(sharedObj.giftCard.selectedPrice);
				totalPrice.sale = parseFloat(sharedObj.giftCard.selectedPrice);
				totalPrice.saved = parseFloat(totalPrice.original) - parseFloat(totalPrice.sale);
			}
			
			if(sharedObj.isBezel && !sharedObj.bezelDummyCode){
				var selectedBezelColor = sharedObj.selectedBezelColor;
				var selectedBezelPriceOriginal = 0;
				var selectedBezelPriceSale = 0;
				var selectedBezelPriceSaved = 0;
				
				if(shopIntegrationFlag === 'Hybris-new'){
					//   
					if(selectedBezelColor){
						if(selectedBezelColor.hasOwnProperty('price')){
							selectedBezelPriceOriginal = selectedBezelColor.price.value;
						}
						if(selectedBezelColor.hasOwnProperty('promotionPrice')){
							if(selectedBezelColor.promotionPrice.value > 0 && selectedBezelColor.promotionPrice.value < selectedBezelPriceOriginal){
								//   promotionPrice  price   promotionPrice  
								selectedBezelPriceSale = selectedBezelColor.promotionPrice.value;
							}else {
								//promotionPrice   0    
								selectedBezelPriceSale = selectedBezelPriceOriginal;
							} 
						}else{
							//promotionPrice  
							selectedBezelPriceSale = selectedBezelPriceOriginal;
						}
						if(selectedBezelPriceOriginal > selectedBezelPriceSale){
							selectedBezelPriceSaved = selectedBezelPriceOriginal - selectedBezelPriceSale;
						}
					}
				}else if(shopIntegrationFlag === 'Hybris' || shopIntegrationFlag === 'Hybris-intg'){
					//   
					if(selectedBezelColor.hasOwnProperty('price')){
						if(selectedBezelColor.price != null){
							selectedBezelPriceOriginal = selectedBezelColor.price;
						}
					}
					if(selectedBezelColor.hasOwnProperty('promotionPrice') && selectedBezelColor.promotionPrice != null){
						if(selectedBezelColor.promotionPrice > 0 && selectedBezelColor.promotionPrice < selectedBezelPriceOriginal){
							//   promotionPrice  price   promotionPrice  
							selectedBezelPriceSale = selectedBezelColor.promotionPrice;
						}else {
							//promotionPrice   0    
							selectedBezelPriceSale = selectedBezelPriceOriginal;
						} 
					}else{
						//promotionPrice     null 
						selectedBezelPriceSale = selectedBezelPriceOriginal;
					}
					if(selectedBezelPriceOriginal > 0){
						if(selectedBezelPriceOriginal > selectedBezelPriceSale){
							selectedBezelPriceSaved = selectedBezelPriceOriginal - selectedBezelPriceSale;
						}
					}
				}
				//2022            X
				if(sharedObj.sellingWithBazel){
					//2022     
					totalPrice.original = parseFloat(totalPrice.original);
					totalPrice.sale = parseFloat(totalPrice.sale);
					totalPrice.saved = parseFloat(totalPrice.original) - parseFloat(totalPrice.sale);
				}else{
					//2022      +    
					totalPrice.original = parseFloat(totalPrice.original) + parseFloat(selectedBezelPriceOriginal);
					totalPrice.sale = parseFloat(totalPrice.sale) + parseFloat(selectedBezelPriceSale);
					totalPrice.saved = parseFloat(totalPrice.original) - parseFloat(totalPrice.sale);
				}
			}
			
			//     ,    
			if( energyArea.length > 0 ){
				priceWrapper.hasEnergyLabel = true;
				let fiche = energyArea.find('.cost-box__pf-link');
				let label = energyArea.find('.badge');
				let repair = energyArea.find('.badge-repairability a');
				let repairImage = newEnergyArea.find('.badge-repairability img');
				var customsObj = {};
				
				if( fiche.length > 0 ){
					fiche = $(fiche.get(0));
					priceWrapper.ficheAttr = this.getAttrCta( fiche.text(), fiche.attr('href'), fiche.attr('target'));
				}
				
				if( label.length > 0 ){
					label = $(label.get(0));
					priceWrapper.hasEnergyLabel = true;
					priceWrapper.labelAttr = this.getAttrCta( label.find('.hidden').text(), label.attr('href'), label.attr('target'), label.attr('class'));
					priceWrapper.labelAttr.spanClass = label.find('.badge__grade--with-text').attr('class');
				}
				
				if( repair.length > 0 ){
					repair = $(repair.get(0));
					repairImage = $(repairImage.get(0));
					customsObj.desktopSrc = repairImage.attr('data-desktop-src');
					customsObj.mobileSrc = repairImage.attr('data-mobile-src');
					if($("#anchorContainer").hasClass("bg-black")){
						customsObj.desktopSrc = customsObj.desktopSrc.replace("Light_83x50", "Dark_60x36");
						customsObj.mobileSrc = customsObj.desktopSrc.replace("Light_130x78", "Dark_88x52");
					}
					customsObj.alt = repairImage.attr('alt');
					customsObj.anla = repair.attr('an-la');
					priceWrapper.repairAttr = this.getAttrCta( repair.text(), repair.attr('href'), repair.attr('target'), '', customsObj);
				}
			}
			
			// (   )    ,    
			if( newEnergyArea.length > 0 ){
				priceWrapper.hasNewEnergyLabel = true;
				let fiche = newEnergyArea.find('.badge-energy-label__text');
				let label = newEnergyArea.find('.badge-energy-label__badge');
				let repair = newEnergyArea.find('.badge-repairability a');
				let repairImage = newEnergyArea.find('.badge-repairability img');
				var customsObj = {};
				
				if( fiche.length > 0 ){
					fiche = $(fiche.get(0));
					priceWrapper.ficheAttr = this.getAttrCta( fiche.text(), fiche.attr('href'), fiche.attr('target'));
				}
				
				if( label.length > 0 ){
					label = $(label.get(0));
					priceWrapper.hasNewEnergyLabel = true;
					priceWrapper.labelAttr = this.getAttrCta( label.text(), label.attr('href'), label.attr('target'), label.attr('class'));
					priceWrapper.labelAttr.spanClass = label.attr('class');
				}
				
				if( repair.length > 0 ){
					repair = $(repair.get(0));
					repairImage = $(repairImage.get(0));
					customsObj.desktopSrc = repairImage.attr('data-desktop-src');
					customsObj.mobileSrc = repairImage.attr('data-mobile-src');
					if($("#anchorContainer").hasClass("bg-black")){
						customsObj.desktopSrc = customsObj.desktopSrc.replace("Light_83x50", "Dark_60x36");
						customsObj.mobileSrc = customsObj.desktopSrc.replace("Light_130x78", "Dark_88x52");
					}
					customsObj.alt = repairImage.attr('alt');
					customsObj.anla = repair.attr('an-la');
					priceWrapper.repairAttr = this.getAttrCta( repair.text(), repair.attr('href'), repair.attr('target'), '', customsObj);
				}
			}
			
			//      .
			if (!priceWrapper.hasPriceWrapper){
				view.productPriceTotalDraw(drawObj, sharedObj.isOptClicked);
				return ; 
			}
			
			if(siteCode !== "ae" && siteCode !== "ae_ar"){
				// Between     
				selectedOptionPrice( productSalePriceFormatted, hasBetween, selectorObj );
			}
			
			let fromSebn = '';
			let fromSeg = '';
			
			if(siteCode === "nl" || siteCode === "be" || siteCode === "be_fr"){ //new-hybris
				fromSebn = "From";
				priceWrapper.info.fromText = fromSebn;
			}
			
			if(siteCode === "de"){ //new-hybris
				fromSeg = "From";
				priceWrapper.info.fromText = fromSeg;
			}
			
			// usEppPrice    
			if( productPriceInfo.usEppPrice ){
				totalPrice.sale = parseFloat(totalPrice.sale) - parseFloat(productPriceInfo.usEppPrice);
			}
			
			settingBogoPrice( sharedObj, selectorObj, totalPrice );
			settingCarePrice( sharedObj, selectorObj, totalPrice );
			settingWarrantyPrice( sharedObj, selectorObj, totalPrice );
			settingWarrantyVdPrice( sharedObj, selectorObj, totalPrice );
			settingTradeInPrice( sharedObj, selectorObj, totalPrice );
			// [COMP6FE-1500][COMP6FE-1501] SEAU,SENA total price update .
			if(siteCode !== "au" && siteCode !== "se" && siteCode !== "no" && siteCode !== "fi" && siteCode !== "dk" && siteCode !== "uk"){
				settingTariffOptionPrice( sharedObj, selectorObj, totalPrice );
			}
			settingComboPrice( sharedObj, selectorObj, totalPrice );
			settingGiftPrice( sharedObj, selectorObj, totalPrice );
			settingAssuredPrice( sharedObj, selectorObj, totalPrice );
			settingEmbedAddOnPrice( sharedObj, selectorObj, totalPrice );
			if( siteCode === 'uk' || siteCode === 'au' ){
				settingTariffOptionPriceUK( sharedObj, selectorObj, totalPrice );
			}
			
			totalPrice.saved = parseFloat(totalPrice.original) - parseFloat(totalPrice.sale);
			//    
			totalPrice.original = this.formattingPrice(totalPrice.original);
			totalPrice.saved = this.formattingPrice(totalPrice.saved);
			totalPrice.sale = this.formattingPrice(totalPrice.sale);
			
			sharedObj.totalPrice = totalPrice;

			var isLeasingArea = (siteCode === "be" || siteCode === "be_fr" || siteCode === "nl" || siteCode === "fr");
			
			if( hasBetweenResult && !isLeasingArea ){
				var leaseingArea = selectorObj.buyingToolOptBetween.find('#pd-leasing-1');
				
				var tenureUnit = leaseingArea.attr('data-tenure-unit');
				var tenureVlue = parseFloat(leaseingArea.attr('data-tenure-value'));
				var monthlyRate = parseFloat(leaseingArea.attr('data-monthly-value'));
				var downPayment = parseFloat(leaseingArea.attr('data-payment-value'));

				/*if(siteCode !== 'nl'){
					priceWrapper.info.orignalPrice = currencyComma(totalPrice.original, priceCurrency);
				}*/
				
				
				if(siteCode === 'it'){
					// :  BC  
					//Granite.I18n.get("Advance", null, i18n_hint) + " "
					// leasingInfoHtml += currencyComma(upfront,currency) + " " + Granite.I18n.get("Monthly fee of", null, i18n_hint) + " " + currencyComma(monthly,currency) + " " + Granite.I18n.get("for",null,i18n_hint) + " " + months + " " + Granite.I18n.get("months", null, i18n_hint);
					priceWrapper.info.totalPrice = Granite.I18n.get("Advance") + " " + currencyComma(downPayment,priceCurrency) + " " + Granite.I18n.get("Monthly fee of") + " " + currencyComma(monthlyRate,priceCurrency) + " " + Granite.I18n.get("for") + " " + tenureUnit + " " + Granite.I18n.get("months");
					//priceWrapper.info.totalPrice = currencyComma(downPayment, priceCurrency) + ' + ' + tenureVlue + ' x '+ currencyComma(monthlyRate, priceCurrency) + '/' + Granite.I18n.get(tenureUnit);
				} else if(siteCode === 'ru') {
					//3,549  /month     BC  (Granite.I18n.get("{0}/month", currencyComma(monthly,currency), i18n_hint);)
					priceWrapper.info.totalPrice = Granite.I18n.get("{0}/month", currencyComma(monthlyRate,priceCurrency));
				} else {
					//  (GP)
					priceWrapper.info.totalPrice = currencyComma(downPayment, priceCurrency) + ' + ' + tenureVlue + ' x '+ currencyComma(monthlyRate, priceCurrency) + '/' + Granite.I18n.get(tenureUnit);
				}
				
			} else if(hasUpgradeResult) {
				
			// BC  
			/*
			function eupInfoGrid(){     ()
			if(BC_MODEL.promotionPrice && BC_MODEL.promotionPrice != 0){
			var month = 24;
			var MM = ((BC_MODEL.promotionPrice -(BC_MODEL.promotionPrice * 0.1)) / month).toFixed(2);
			var AA = (BC_MODEL.promotionPrice * 0.1) + (((BC_MODEL.promotionPrice - (BC_MODEL.promotionPrice * 0.1)) / month) - MM) * month;

			var summaryHtml = currencyComma(AA, currency) +" ahora + " + Granite.I18n.get("{0}/month",currencyComma(MM, currency),i18n_hint);
			*/
			
 
				if(siteCode === 'es'){
					if(productSalePrice && productSalePrice != 0) {
						var month = 24;
						var MM = ((productSalePrice -(productSalePrice * 0.1)) / month).toFixed(2);
						var AA = (productSalePrice * 0.1) + (((productSalePrice - (productSalePrice * 0.1)) / month) - MM) * month;

						priceWrapper.info.totalPrice = currencyComma(AA, priceCurrency) +" ahora + " + Granite.I18n.get("{0}/month",currencyComma(MM, priceCurrency));
					} else {
						//productSalePrice   productOrignalPrice     
						if(productOrignalPrice && productOrignalPrice != 0) {
							var month = 24;
							var MM = ((productOrignalPrice -(productOrignalPrice * 0.1)) / month).toFixed(2);
							var AA = (productOrignalPrice * 0.1) + (((productOrignalPrice - (productOrignalPrice * 0.1)) / month) - MM) * month;

							priceWrapper.info.totalPrice = currencyComma(AA, priceCurrency) +" ahora + " + Granite.I18n.get("{0}/month",currencyComma(MM, priceCurrency));
						}
					}
				}
				
			} else {
				if( fromSebn ){
					priceWrapper.info.vatText = '( '+ Granite.I18n.get('VAT Included') + ' )';
				}
				if( totalPrice.saved > 0 ){
					if(!sharedObj.getOptoinPrice ){
						//    
						if( productPriceInfo.monthlyPriceInfo && productPriceInfo.monthlyPriceInfo.monthlyPrice ){
							const monthlyPrice = productPriceInfo.monthlyPriceInfo.monthlyPrice;
							const tenureVal = productPriceInfo.monthlyPriceInfo.tenureVal ? productPriceInfo.monthlyPriceInfo.tenureVal : 0;
							const interest = productPriceInfo.monthlyPriceInfo.interest ? productPriceInfo.monthlyPriceInfo.interest : 0;
							//hybris     
							if( sharedObj.isMigrationHybris ){
								if(siteCode=="id"){
									priceWrapper.info.totalPrice =  Granite.I18n.get("pd From {0}/mo", currencyCommaExcep(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
								}else if(sharedObj.isLowestInstallmentInterest){
									priceWrapper.info.totalPrice =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, interest]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
								}else if(siteCode === "ro"){
									priceWrapper.info.totalPrice =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
								}else if(sharedObj.isMonthlySENA){
									priceWrapper.info.totalPrice =  currencyComma(totalPrice.sale, priceCurrency) + ' '+ Granite.I18n.get("or") + ' ' + Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]);
								}else if(sharedObj.isSECZ){
									priceWrapper.info.totalPrice =  currencyComma(totalPrice.sale, priceCurrency);
									priceWrapper.info.totalPriceMonthly =  Granite.I18n.get("product detail From {0}/mo", currencyComma(monthlyPrice, priceCurrency));
									//drawObj.priceAnchor.priceWrapper.info.totalPrice = Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
									priceWrapper.info.totalPriceAnchor = Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
								}else{
									priceWrapper.info.totalPrice =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
								}
							} else {
								if(siteCode=="id"){
									priceWrapper.info.totalPrice =  Granite.I18n.get("pd From {0}/mo", currencyCommaExcep(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
								}else if(sharedObj.isLowestInstallmentInterest){
									priceWrapper.info.totalPrice =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, interest]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
								}else if(siteCode === "hk" || siteCode === "hk_en"){
									priceWrapper.info.totalPrice =  currencyComma(totalPrice.sale, priceCurrency);
									priceWrapper.info.totalPriceMonthly = Granite.I18n.get("or interest-free instalments from {0} /mo*",[currencyComma(monthlyPrice, priceCurrency)]);
									priceWrapper.info.disclaimerText = Granite.I18n.get("*Based on {0}-month instalments, rounded to the nearest cents. Other repayment periods are available",[tenureVal]);
									drawObj.priceAnchor.priceWrapper.info.totalPriceMonthly = priceWrapper.info.totalPriceMonthly;
								}else if(siteCode === "hu"){
									var hufMonthlyPrice = parseInt(monthlyPrice).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
									var hufInterest = parseFloat(interest) < 1 ? (parseFloat(interest)*100).toString().slice(0,interest.length-1) : interest;
									priceWrapper.info.totalPrice =  Granite.I18n.get("pd From {0}/mo", hufMonthlyPrice) + ' Ft / ' + Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, hufInterest]) + ' ' + Granite.I18n.get("pd or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
								}else if(siteCode === "my"){
									priceWrapper.info.totalPrice =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
								}else if(sharedObj.isMonthlySENA){
									priceWrapper.info.totalPrice =  currencyComma(totalPrice.sale, priceCurrency) + ' '+ Granite.I18n.get("or") + ' ' + Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]);
								}else if(siteCode === "it"){
									priceWrapper.info.totalPrice =  currencyComma(totalPrice.sale, priceCurrency);
									priceWrapper.info.totalPriceMonthly =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]);
									drawObj.priceAnchor.priceWrapper.info.totalPriceMonthly = priceWrapper.info.totalPriceMonthly;
								}else{
									priceWrapper.info.totalPrice =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
								}
							}
							const embedAddonArea = selectorObj.buyingToolOptEmbedAddon;
							if( sharedObj.isEmbedAddOn ){
								embedAddonArea.attr('data-leasing-price', priceWrapper.info.totalPrice);
							}

							sharedObj.isLeasingPrice = priceWrapper.info.totalPrice;
						}else {
							if(siteCode !="hr"){
								//  totalPrice.sale format ()
								priceWrapper.info.totalPrice = currencyComma(totalPrice.sale, priceCurrency);
							} else if(siteCode =="hr"){
								// only hr
								//priceWrapper.info.totalPrice = proSalePriceFormatted;
								priceWrapper.info.totalPrice = proSalePriceFormatted.replace('(', '<span class="pd-buying-price__new-price-eur"> (').replace(')', ')</span>');
							}
							if(siteCode =="br") {
								if(sharedObj.savingInformation){
									priceWrapper.info.totalPrice = sharedObj.taxPriceDisplay + '  vista ' + sharedObj.savingInformation;
									priceWrapper.info.orignalPrice = '';
									priceWrapper.info.savePrice  = sharedObj.storeText;
									drawObj.priceAnchor.priceWrapper.info.orignalPrice = sharedObj.storeText;
									drawObj.priceAnchor.priceWrapper.info.savePrice = '';
								} else {
									priceWrapper.info.totalPrice = sharedObj.taxPriceDisplay + '  vista ';
									priceWrapper.info.orignalPrice = '';
									priceWrapper.info.savePrice  = sharedObj.storeText;
									drawObj.priceAnchor.priceWrapper.info.orignalPrice = sharedObj.storeText;
									drawObj.priceAnchor.priceWrapper.info.savePrice = '';
								}
							}
							//co vatFreePrice    
							this.setSamcolVatFreePrice(sharedObj);
						}
					} else {
						priceWrapper.info.totalPrice = currencyComma(totalPrice.sale, priceCurrency);
						if( (siteCode === 'fi' || siteCode === 'se' ||siteCode === 'dk' ||siteCode === 'no') && paymentcycle ){
							priceWrapper.info.description = Granite.I18n.get("Amount to pay immediately today then {0}<br/>for your Samsung Care+ insurance.", sharedObj.drawObj.careResult.dataPromotionPrice);
						}
					}
					if( fromSebn || fromSeg  ){
						if( fromSebn && productPriceInfo.listPrice != null && productPriceInfo.listPrice > 0 ){
							//NOTICE : SEBN Gpv2 new hybris  ?       
							/*
							priceWrapper.info.orignalPrice = Granite.I18n.get("Listprice") + " " + currencyComma(productPriceInfo.listPrice,priceCurrency);
							drawObj.priceAnchor.priceWrapper.info.orignalPrice = Granite.I18n.get("Listprice") + " " + currencyComma(productPriceInfo.listPrice,priceCurrency);
							*/
							drawObj.priceAnchor.priceWrapper.info.noLineOrignal = Granite.I18n.get("Listprice") + " " + currencyComma(productPriceInfo.listPrice,priceCurrency);
							if(productPriceInfo.orignalPrice != null && productPriceInfo.orignalPrice > 0 && productPriceInfo.salePrice != null && productPriceInfo.salePrice > 0){//msrpPrice, price, promotionPrice     
								priceWrapper.info.orignalPrice =  Granite.I18n.get("From {0}", currencyComma(totalPrice.original, priceCurrency) );
								drawObj.priceAnchor.priceWrapper.info.orignalPrice = Granite.I18n.get("From {0}", '<del>'+currencyComma(totalPrice.original, priceCurrency)+'</del>' );
							}
							
						} else {
								priceWrapper.info.orignalPrice =  Granite.I18n.get("From {0}", currencyComma(totalPrice.original, priceCurrency) );
								drawObj.priceAnchor.priceWrapper.info.orignalPrice = Granite.I18n.get("From {0}", '<del>'+currencyComma(totalPrice.original, priceCurrency)+'</del>' );
							}							
					} else {
						if((siteCode === "pe" || siteCode === "cl" || siteCode === "mx" || siteCode === "co") && productPriceInfo.monthlyPriceInfo.monthlyPrice){
							drawObj.priceAnchor.priceWrapper.info.disclaimer = "*Aplican condiciones";
						}
						if(siteCode === "ca" || siteCode === "ca_fr"){
							if(sharedObj.categoryTypeCode.slice(0,2) !== "08"){
								if(sharedObj.savingInformation){
									drawObj.priceAnchor.priceWrapper.info.savingInformation = '<p class="pd-buying-price__text-saving-info">'+sharedObj.savingInformation+'</p>';
								}
							}
						}else{
							if(siteCode !="hr" && siteCode !="ro"){
								if(siteCode =="jp"){
									priceWrapper.info.orignalPrice = '( : '+currencyComma(totalPrice.original, priceCurrency)+')'; //sample (:33,583)
									drawObj.priceAnchor.priceWrapper.info.orignalPrice = '( : '+currencyComma(totalPrice.original, priceCurrency)+')'; //sample (:33,583)
								} else {
									//COMP6FE-1599 [EPP] SEPOL MSRP Price 
									if (!($('#isEppPage').val() === 'true' && siteCode === "pl") ){									
										if(sharedObj.isNewElementLowestWasPrice === true && sharedObj.isNewElementLowestWasPriceSetting === false) {
											//pl  lowestWasPrice     
											priceWrapper.info.orignalPrice = '';
											drawObj.priceAnchor.priceWrapper.info.orignalPrice = '';//del 
											//priceWrapper.info.hasNoLowestWasPrice = true;
											//priceWrapper.info.hasLowestWasPrice = false;
										} else {
											// 
											priceWrapper.info.orignalPrice = currencyComma(totalPrice.original, priceCurrency);
											drawObj.priceAnchor.priceWrapper.info.orignalPrice = '<del>'+currencyComma(totalPrice.original, priceCurrency)+'</del>';
											priceWrapper.info.hasNoLowestWasPrice = false;
											priceWrapper.info.hasLowestWasPrice = true;
											if(siteCode =="pl" && sharedObj.isNewElementLowestWasPriceSetting === true){
												priceWrapper.info.lowestWasPricetext = Granite.I18n.get("Lowest price 30 days before the discount:");
												drawObj.priceAnchor.priceWrapper.info.lowestWasPricetext = Granite.I18n.get("Lowest price 30 days before the discount:");
											} else if(siteCode =="it" && sharedObj.isNewElementLowestWasPriceSetting === true){
												//NOTICE :       											
												//priceWrapper.info.orignalPrice = '';
												//drawObj.priceAnchor.priceWrapper.info.orignalPrice = '';//del 
											}
										}
									}
								}
							} else if(siteCode =="hr"){
								//only hr
								priceWrapper.info.orignalPrice = proOrignalPriceFormatted;
								drawObj.priceAnchor.priceWrapper.info.orignalPrice = '<del>'+proOrignalPriceFormatted+'</del>';
							} else if(siteCode =="ro"){
								priceWrapper.info.orignalPrice = Granite.I18n.get("RRP {0}",currencyComma(totalPrice.original, priceCurrency)); //"PR " + currencyComma(totalPrice.original, priceCurrency)
								drawObj.priceAnchor.priceWrapper.info.orignalPrice = Granite.I18n.get("RRP {0}",currencyComma(totalPrice.original, priceCurrency));  //"PR " + currencyComma(totalPrice.original, priceCurrency);

								// CRHQ-9137 [B2C] RO(SEROM) Omibus  - tradein  
								const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
								if(hasTradeInResult){
									drawObj.priceAnchor.priceWrapper.info.orignalPrice = "";
									priceWrapper.info.orignalPrice = "";
								}
							}
							if(siteCode =="br") {
								if(sharedObj.savingInformation){
									priceWrapper.info.orignalPrice = '';
									priceWrapper.info.savePrice  = sharedObj.storeText;
									drawObj.priceAnchor.priceWrapper.info.orignalPrice = sharedObj.storeText;
									drawObj.priceAnchor.priceWrapper.info.savePrice = '';
								} else {
									priceWrapper.info.totalPrice = sharedObj.taxPriceDisplay + '  vista ';
									priceWrapper.info.orignalPrice = '';
									priceWrapper.info.savePrice  = sharedObj.storeText;
									drawObj.priceAnchor.priceWrapper.info.orignalPrice = sharedObj.storeText;
									drawObj.priceAnchor.priceWrapper.info.savePrice = '';
								}
							}
							//co vatFreePrice    
							this.setSamcolVatFreePrice(sharedObj);
						}
					}
					if( fromSebn === '' ){
						if( !this.hasComponent( selectorObj.buyingToolOptTariffResult, sharedObj ) ){
							if(siteCode === "in") {
								priceWrapper.info.orignalPriceAddText = "MRP (Inclusive of all taxes)";
							}
							if(siteCode === "ca" || siteCode === "ca_fr"){
								if(sharedObj.categoryTypeCode.slice(0,2) !== "08"){
									if(sharedObj.savingInformation){
										drawObj.priceAnchor.priceWrapper.info.savingInformation = '<p class="pd-buying-price__text-saving-info">'+sharedObj.savingInformation+'</p>';
									}
								}
							}else if(siteCode === "hr"){
								priceWrapper.info.savePrice =Granite.I18n.get("Save {0}",currencyComma(totalPrice.saved, "eur"))+" ("+euroToKunaPrice(totalPrice.saved)+")";
							}else if(siteCode !== "ro"){
								if(siteCode === "br"){
									if(sharedObj.savingInformation){
										priceWrapper.info.savePrice = ""; //NOTICE :     . 
										priceWrapper.info.orignalPrice = '';
										priceWrapper.info.savePrice  = sharedObj.storeText;
										drawObj.priceAnchor.priceWrapper.info.orignalPrice = sharedObj.storeText;
										drawObj.priceAnchor.priceWrapper.info.savePrice = '';
									} else {
										//  
										//priceWrapper.info.savePrice =Granite.I18n.get("Save {0}",currencyComma(totalPrice.saved, priceCurrency));
										priceWrapper.info.totalPrice = sharedObj.taxPriceDisplay + '  vista ';
										priceWrapper.info.orignalPrice = '';
										priceWrapper.info.savePrice  = sharedObj.storeText;
										drawObj.priceAnchor.priceWrapper.info.orignalPrice = sharedObj.storeText;
										drawObj.priceAnchor.priceWrapper.info.savePrice = '';
									}
								} else {
									if(siteCode === "co" && sharedObj.vatEligible === true) {
										//  
										priceWrapper.info.savePrice =''; //co sharedObj.vatEligible true  save .
										drawObj.priceAnchor.priceWrapper.info.savePrice = ''; //co sharedObj.vatEligible true  save .
									} else {
										//COMP6FE-1599 [EPP] SEPOL MSRP Price  : saveText 
										if (!($('#isEppPage').val() === 'true' && siteCode === "pl")){										
											if(sharedObj.isNewElementLowestWasPrice === true && sharedObj.isNewElementLowestWasPriceSetting === false) {
												drawObj.priceAnchor.priceWrapper.info.savePrice = '';
												priceWrapper.info.savePrice = '';
											} else {
												//  
												priceWrapper.info.savePrice =Granite.I18n.get("Save {0}",currencyComma(totalPrice.saved, priceCurrency));
												if(siteCode =="pl" && sharedObj.isNewElementLowestWasPriceSetting === true){
													priceWrapper.info.lowestWasPricetext = Granite.I18n.get("Lowest price 30 days before the discount:");
													drawObj.priceAnchor.priceWrapper.info.lowestWasPricetext = Granite.I18n.get("Lowest price 30 days before the discount:");
												} else if(siteCode =="it" && sharedObj.isNewElementLowestWasPriceSetting === true){
													//   save %        del 
													priceWrapper.info.savePrice = Granite.I18n.get("Save the {0}%",getDiscountRate(totalPrice.saved, totalPrice.original));
													drawObj.priceAnchor.priceWrapper.info.savePrice = Granite.I18n.get("Save the {0}%",getDiscountRate(totalPrice.saved, totalPrice.original));
												}
											}
										}
									}
								}
								
								//COMP6FE-1599 [EPP] SEPOL MSRP Price  : Listprice 
								if ($('#isEppPage').val() === 'true' && siteCode === "pl") {
									let msrpPrice = '';
									if (productPriceInfo.listPrice > 0 ) {
										msrpPrice = ' ' + currencyComma(productPriceInfo.listPrice,priceCurrency);
										drawObj.priceAnchor.priceWrapper.info.noLineOrignal = Granite.I18n.get("Listprice") + msrpPrice;
										priceWrapper.info.orignalPrice = '';
										drawObj.priceAnchor.priceWrapper.info.orignalPrice = '';
									}
								}
								
								//co vatFreePrice    
								this.setSamcolVatFreePrice(sharedObj);
							}
						}
					}

					// [COMP6FE-1500][COMP6FE-1501] SEAU,SENA total price update .
					if((siteCode === 'au' || siteCode === 'fi' || siteCode === 'se' ||siteCode === 'dk' ||siteCode === 'no') && sharedObj.isHybrisSplitPDTariff){
						priceWrapper.info.savePrice =Granite.I18n.get("Save {0}",currencyComma(totalPrice.saved, priceCurrency));
					}

					/* CRHQ-7964 [B2C][BC][MX][FR] Enable SIM Tariff display for Simple PD for A series smartphones */
					if(siteCode == 'fr' && sharedObj.drawObj.tariffOptionResult.hasComponent){
						priceWrapper.info.savePrice =Granite.I18n.get("Save {0}",currencyComma(totalPrice.saved, priceCurrency));
					}
					
					const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
					if(siteCode == 'fr' && hasTradeInResult && sharedObj.commonTradein){
						drawObj.price.priceWrapper.info.hasLowestWasPrice = true;
						drawObj.price.priceWrapper.info.hasNoLowestWasPrice = false;
						priceWrapper.info.savePrice = Granite.I18n.get("Save {0}",currencyComma(totalPrice.saved, priceCurrency));
						priceWrapper.info.orignalPrice = currencyComma(totalPrice.original, priceCurrency);
						drawObj.priceAnchor.priceWrapper.info.orignalPrice = '<del>'+currencyComma(totalPrice.original, priceCurrency)+'</del>' ; 
					} 
					
					if($.inArray(siteCode, ['dk'])!== -1 && hasTradeInResult){ // CRHQ-9187
						drawObj.price.priceWrapper.info.withTradeIn = `${Granite.I18n.get("with trade-in")}`;      // CRHQ-9405
						drawObj.priceAnchor.priceWrapper.info.disclaimer = `${Granite.I18n.get("with trade-in")}`; // CRHQ-9405
					}

					priceWrapper.info.unformattedSavePrice = totalPrice.saved;
					
				} else {
				//new-hybris
					if( siteCode === "nl" || siteCode === "be" || siteCode === "be_fr" ) {
						// new-hybris
						if( sharedObj.isMigrationHybris ){
							if( productPriceInfo.listPrice > 0 ){
								drawObj.priceAnchor.priceWrapper.info.noLineOrignal = Granite.I18n.get("Listprice") + " " + currencyComma(productPriceInfo.listPrice,priceCurrency);
							}
						} else {
							if( productPriceInfo.orignalPrice < productPriceInfo.listPrice ) {
								drawObj.priceAnchor.priceWrapper.info.noLineOrignal = Granite.I18n.get("Listprice") + " " + currencyComma(productPriceInfo.listPrice,priceCurrency);
							}
						}
					}
					//COMP6FE-1599 [EPP] SEPOL MSRP Price  : Listprice 
					if ($('#isEppPage').val() === 'true' && siteCode === "pl") {
						let msrpPrice = '';
						if (productPriceInfo.listPrice > 0 ) {
							msrpPrice = ' ' + currencyComma(productPriceInfo.listPrice,priceCurrency);
							drawObj.priceAnchor.priceWrapper.info.noLineOrignal = Granite.I18n.get("Listprice") + msrpPrice;
						}
					}					
					if((siteCode === "pe" || siteCode === "cl" || siteCode === "mx" || siteCode === "co") && productPriceInfo.monthlyPriceInfo.monthlyPrice){
						drawObj.priceAnchor.priceWrapper.info.disclaimer = "*Aplican condiciones";
					}
					if( totalPrice.original ){
						//  api priceFormatted    
						if( !sharedObj.getOptoinPrice && proSalePriceFormatted ){
							if(sharedObj.isBezel || sharedObj.giftCard.isGiftCard){
								priceWrapper.info.totalPrice = currencyComma(totalPrice.sale, priceCurrency);
								if(siteCode == "hr" && sharedObj.isBezel){
									var newPriceEur = priceWrapper.info.totalPrice + " (" + euroToKunaPrice(totalPrice.sale).replace(" ",".") + ")";
									priceWrapper.info.totalPrice = newPriceEur.replace('(', '<span class="pd-buying-price__new-price-eur"> (').replace(')', ')</span>');
								}
							}else{
								if(siteCode !="hr"){
									//  
									priceWrapper.info.totalPrice = proSalePriceFormatted;
								} else if(siteCode =="hr"){
									//only hr
									//priceWrapper.info.totalPrice = proSalePriceFormatted;
									priceWrapper.info.totalPrice = proSalePriceFormatted.replace('(', '<span class="pd-buying-price__new-price-eur"> (').replace(')', ')</span>');
								}
								if(siteCode =="br") {
									if(sharedObj.savingInformation){
										priceWrapper.info.totalPrice = sharedObj.taxPriceDisplay + '  vista ' + sharedObj.savingInformation;
										priceWrapper.info.orignalPrice = '';
										priceWrapper.info.savePrice  = sharedObj.storeText;
										drawObj.priceAnchor.priceWrapper.info.orignalPrice = sharedObj.storeText;
										drawObj.priceAnchor.priceWrapper.info.savePrice = '';
									} else {
										priceWrapper.info.totalPrice = sharedObj.taxPriceDisplay + '  vista ';
										priceWrapper.info.orignalPrice = '';
										priceWrapper.info.savePrice  = sharedObj.storeText;
										drawObj.priceAnchor.priceWrapper.info.orignalPrice = sharedObj.storeText;
										drawObj.priceAnchor.priceWrapper.info.savePrice = '';
									}
								}
								
								//co vatFreePrice    
								this.setSamcolVatFreePrice(sharedObj);
							}
						} else {
							priceWrapper.info.totalPrice = currencyComma(totalPrice.original, priceCurrency);
						}
						if( !sharedObj.getOptoinPrice ){
							if( productPriceInfo.monthlyPriceInfo && productPriceInfo.monthlyPriceInfo.monthlyPrice ){
								const monthlyPrice = productPriceInfo.monthlyPriceInfo.monthlyPrice;
								const tenureVal = productPriceInfo.monthlyPriceInfo.tenureVal ? productPriceInfo.monthlyPriceInfo.tenureVal : 0;
								const interest = productPriceInfo.monthlyPriceInfo.interest ? productPriceInfo.monthlyPriceInfo.interest : 0;
								//hybris     
								if( sharedObj.isMigrationHybris ){
									if(siteCode=="id"){
										priceWrapper.info.totalPrice = Granite.I18n.get("pd From {0}/mo", currencyCommaExcep(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' ' + proSalePriceFormatted;
									}else if(sharedObj.isLowestInstallmentInterest){
										priceWrapper.info.totalPrice =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, interest]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
									}else if(siteCode === "ro"){
										priceWrapper.info.totalPrice =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
									}else if(sharedObj.isMonthlySENA){
										priceWrapper.info.totalPrice =  currencyComma(totalPrice.sale, priceCurrency) + ' '+ Granite.I18n.get("or") + ' ' + Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]);
									}else if(sharedObj.isSECZ){
										priceWrapper.info.totalPrice =  proSalePriceFormatted;
										priceWrapper.info.totalPriceMonthly =  Granite.I18n.get("product detail From {0}/mo", currencyComma(monthlyPrice, priceCurrency));
										priceWrapper.info.totalPriceAnchor =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' '+ proSalePriceFormatted;
									}else{
										priceWrapper.info.totalPrice = Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' ' + proSalePriceFormatted;
									}
								} else{
									if(siteCode=="id"){
										priceWrapper.info.totalPrice = Granite.I18n.get("pd From {0}/mo", currencyCommaExcep(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
									}else if(sharedObj.isLowestInstallmentInterest){
										priceWrapper.info.totalPrice =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, interest]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
									}else if(siteCode === "hk" || siteCode === "hk_en"){
										priceWrapper.info.totalPrice =  currencyComma(totalPrice.sale, priceCurrency);
										priceWrapper.info.totalPriceMonthly = Granite.I18n.get("or interest-free instalments from {0} /mo*",[currencyComma(monthlyPrice, priceCurrency)]);
										priceWrapper.info.disclaimerText = Granite.I18n.get("*Based on {0}-month instalments, rounded to the nearest cents. Other repayment periods are available",[tenureVal]);
										drawObj.priceAnchor.priceWrapper.info.totalPriceMonthly = priceWrapper.info.totalPriceMonthly;
									}else if(siteCode === "hu"){
										var hufMonthlyPrice = parseInt(monthlyPrice).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
										var hufInterest = parseFloat(interest) < 1 ? (parseFloat(interest)*100).toString().slice(0,interest.length-1) : interest;
										priceWrapper.info.totalPrice =  Granite.I18n.get("pd From {0}/mo", hufMonthlyPrice) + ' Ft / ' + Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, hufInterest]) + ' ' + Granite.I18n.get("pd or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
									}else if(siteCode === "my"){
										priceWrapper.info.totalPrice = Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
									}else if(sharedObj.isMonthlySENA){
										priceWrapper.info.totalPrice =  currencyComma(totalPrice.sale, priceCurrency) + ' '+ Granite.I18n.get("or") + ' ' + Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]);
									}else if(siteCode === "it"){
										priceWrapper.info.totalPrice =  currencyComma(totalPrice.sale, priceCurrency);
										priceWrapper.info.totalPriceMonthly =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]);
										drawObj.priceAnchor.priceWrapper.info.totalPriceMonthly = priceWrapper.info.totalPriceMonthly;
									}else{
										priceWrapper.info.totalPrice = Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
									}
								}
								const embedAddonArea = selectorObj.buyingToolOptEmbedAddon;
								if( sharedObj.isEmbedAddOn ){
									embedAddonArea.attr('data-leasing-price', priceWrapper.info.totalPrice);
								}
								sharedObj.isLeasingPrice = priceWrapper.info.totalPrice;
							}
						}
						if( (siteCode === 'fi' || siteCode === 'se' ||siteCode === 'dk' ||siteCode === 'no') && paymentcycle ){
							priceWrapper.info.description = Granite.I18n.get("Amount to pay immediately today then {0}<br/>for your Samsung Care+ insurance.", sharedObj.drawObj.careResult.dataPromotionPrice);
						}
					}else if( (siteCode === 'uk' || siteCode === 'au') && sharedObj.drawObj.tariffOptionResult.hasComponent && totalPrice.sale === 0 ){
						drawObj.price.priceWrapper.info.summaryPrice = drawObj.price.priceWrapper.info.totalPrice = currencyComma(totalPrice.sale, priceCurrency);
					}
				}
				
				//salePrice - sales_pitch
				if(siteCode == "in" && sharedObj.promotionSalesPitch){
					var ceExchangePrice = parseFloat(totalPrice.sale) - parseFloat(sharedObj.promotionSalesPitch);
					priceWrapper.info.ceExchangePrice = "From "+currencyComma(ceExchangePrice,priceCurrency)+" with exchange*";
				}
				
				//store API     , store API X , searchAPI   (uk tariff price 0  )
				if( (!totalPrice.sale && !totalPrice.original && sharedObj.proudctPriceInfo.orignalPriceFormatted) 
						&& !( (siteCode === 'uk' || siteCode === 'au') && sharedObj.drawObj.tariffOptionResult.hasComponent && totalPrice.sale === 0) ){
					if( proSalePriceFormatted !== proOrignalPriceFormatted ){
						priceWrapper.info.orignalPrice = proOrignalPriceFormatted;
					}
					if( proRowSavePrice ){
						priceWrapper.info.savePrice = proRowSavePrice;
					}
					if( productPriceInfo.monthlyPriceInfo && productPriceInfo.monthlyPriceInfo.monthlyPrice ){
						const monthlyPrice = productPriceInfo.monthlyPriceInfo.monthlyPrice;
						const tenureVal = productPriceInfo.monthlyPriceInfo.tenureVal ? productPriceInfo.monthlyPriceInfo.tenureVal : 0;
						const interest = productPriceInfo.monthlyPriceInfo.interest ? productPriceInfo.monthlyPriceInfo.interest : 0;
						//hybris     
						if(siteCode=="id"){
							priceWrapper.info.totalPrice = Granite.I18n.get("pd From {0}/mo", currencyCommaExcep(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' ' + proSalePriceFormatted;
						}else if(sharedObj.isLowestInstallmentInterest){
							priceWrapper.info.totalPrice =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, interest]) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
						}else if(siteCode === "hk" || siteCode === "hk_en"){
							priceWrapper.info.totalPrice =  currencyComma(totalPrice.sale, priceCurrency);
							priceWrapper.info.totalPriceMonthly = Granite.I18n.get("or interest-free instalments from {0} /mo*",[currencyComma(monthlyPrice, priceCurrency)]);
							priceWrapper.info.disclaimerText = Granite.I18n.get("*Based on {0}-month instalments, rounded to the nearest cents. Other repayment periods are available",[tenureVal]);
							drawObj.priceAnchor.priceWrapper.info.totalPriceMonthly = priceWrapper.info.totalPriceMonthly;
						}else if(siteCode === "hu"){
							var hufMonthlyPrice = parseInt(monthlyPrice).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
							var hufInterest = parseFloat(interest) < 1 ? (parseFloat(interest)*100).toString().slice(0,interest.length-1) : interest;
							priceWrapper.info.totalPrice =  Granite.I18n.get("pd From {0}/mo", hufMonthlyPrice) + ' Ft / ' + Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, hufInterest]) + ' ' + Granite.I18n.get("pd or") + ' '+currencyComma(totalPrice.sale, priceCurrency);
						}else if(siteCode === "ro"){
							priceWrapper.info.totalPrice = Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("or") + ' ' + proSalePriceFormatted;
						}else if(siteCode === "my"){
							priceWrapper.info.totalPrice = Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("or") + ' ' + proSalePriceFormatted;
						}else if(sharedObj.isMonthlySENA){
							priceWrapper.info.totalPrice =  proSalePriceFormatted + ' '+ Granite.I18n.get("or") + ' ' + Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]);
						}else if(sharedObj.isSECZ){
							priceWrapper.info.totalPrice = proSalePriceFormatted;
							priceWrapper.info.totalPriceMonthly = Granite.I18n.get("product detail From {0}/mo", currencyComma(monthlyPrice, priceCurrency));
							priceWrapper.info.totalPriceAnchor =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' ' + proSalePriceFormatted;
						}else if(siteCode === "it"){
							priceWrapper.info.totalPrice = proSalePriceFormatted;
							priceWrapper.info.totalPriceMonthly =  Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' ' + proSalePriceFormatted;
							drawObj.priceAnchor.priceWrapper.info.totalPriceMonthly = priceWrapper.info.totalPriceMonthly;
						}else{
							priceWrapper.info.totalPrice = Granite.I18n.get("From {0}/mo", currencyComma(monthlyPrice, priceCurrency)) + ' ' + Granite.I18n.get("for {0} mos",[tenureVal]) + ' ' + Granite.I18n.get("or") + ' ' + proSalePriceFormatted;
						}
						const embedAddonArea = selectorObj.buyingToolOptEmbedAddon;
						if( sharedObj.isEmbedAddOn ){
							embedAddonArea.attr('data-leasing-price', priceWrapper.info.totalPrice);
						}
						sharedObj.isLeasingPrice = priceWrapper.info.totalPrice;
					} else {
						priceWrapper.info.totalPrice = proSalePriceFormatted;
					}
				}
				
				//CRHQ-8349 [B2C] PD navigation      
				if(priceWrapper.info.totalPrice){
					drawObj.priceAnchor.priceWrapper.info.totalPrice = priceWrapper.info.totalPrice.replace(currencyComma(totalPrice.sale, priceCurrency), '<span class="pd-buying-price__new-price-currency">'+currencyComma(totalPrice.sale, priceCurrency)+'</span>');
				}
			}
			
			// fr fr  4x,3x  & tax Price  
			if(siteCode === "fr" && hasFinancing && paymentMethods ){
				const payMent = paymentMethods.simulation_plans;
				let cost = '';
				if( payMent ){
					for(var obj in payMent){
						const simulation = Object.keys(payMent[obj]);
						cost = currencyComma(payMent[obj][simulation].installment_amount.value, priceCurrency);
						let firstText = priceWrapper.info.text;
						
						if( !firstText ){
							priceWrapper.info.text = Granite.I18n.get("{0} sans frais par Carte bancaire :**", simulation) + ' ' + cost;
						} else {
							priceWrapper.info.text2 = Granite.I18n.get("{0} sans frais par Carte bancaire :**", simulation) + ' ' + cost;
						}
					}
				}
			}
			if(sharedObj.categoryTypeCode.slice(0,2) !== "08"){
				if(sharedObj.savingInformation){
					priceWrapper.info.savingInformation = sharedObj.savingInformation;
				}
			}
			
			if( siteCode === 'nl' || siteCode === 'be' || siteCode === 'be_fr' ){
				if( sharedObj.backOrderMessage ){
					priceWrapper.info.text3 = sharedObj.backOrderMessage;
				}
			}
			const isOldHybris = (sharedObj.apiFlag === "Hybris" || sharedObj.apiFlag === "Hybris-intg");
			if(isOldHybris) {
				if(sharedObj.stockLevelStatusDisplay) {
					if(sharedObj.stockLevelStatusDisplay != '') {
						priceWrapper.info.text2 = sharedObj.stockLevelStatusDisplay;
					}
				}
				
				const isHybris = (("Y" === globalShopInfo.shopServiceYN && "Y" === sharedObj.isCart) || "Hybris-intg" === sharedObj.apiFlag ) && "Y" !== sharedObj.oldProductYn;
				
				if(isHybris && globalShopInfo.reservedMsg) {
					if(typeof globalShopInfo.reservedMsg  != "undefined" && globalShopInfo.reservedMsg  != null && globalShopInfo.reservedMsg  != '') {
						priceWrapper.info.text3 = globalShopInfo.reservedMsg;
					}
				}
			} else if( siteCode === 'pe' || siteCode === 'mx') {
				if(sharedObj.stockLevelStatusDisplay) {
					if(sharedObj.stockLevelStatusDisplay != '') {
						priceWrapper.info.text3 = sharedObj.stockLevelStatusDisplay;
					}
				}
			}
			
			priceWrapper.info.summaryPrice = summaryPrice;
			priceWrapper.info.salePriceFormatted = proSalePriceFormatted ? proSalePriceFormatted : proOrignalPriceFormatted;
			if( priceWrapper.info.orignalPrice !== priceWrapper.info.summaryPrice ){ //    
				priceWrapper.info.summaryPrice = priceWrapper.info.totalPrice;
			}
			
			if(sharedObj.proudctPriceInfo.salesPitch ){
				priceWrapper.info.salesPitch = sharedObj.proudctPriceInfo.salesPitch;
			}

			/**
            * overPrice   minOrderEntryValue   
            */
			if( sharedObj.drawObj.tradeInResult.priceOverFlag && (siteCode === 'nl' || siteCode === 'be' || siteCode === 'be_fr' || siteCode === 'sg' || siteCode === 'vn' || siteCode === 'id'|| siteCode === 'fr' ||  siteCode === 'de' || siteCode === 'sa' || siteCode === 'sa_en') ){ //CRHQ-8480
                drawObj.price.priceWrapper.info.totalPrice = currencyComma( sharedObj.minOrderEntryValue, priceCurrency );
                drawObj.priceAnchor.priceWrapper.info.totalPrice = currencyComma( sharedObj.minOrderEntryValue, priceCurrency );
				if(siteCode == 'fr'){//CRHQ-8480
					drawObj.priceAnchor.priceWrapper.info.totalPrice = currencyComma( sharedObj.minOrderEntryValue, priceCurrency ); 
				}
            }

    		//23.01.17 [EPP] O2O  : walk out, home delivery qty  
            if( $('#isEppPage').val() === 'true' && window.sg.epp && window.sg.epp.common && window.sg.epp.common.isPosStore){
                drawObj.price.priceWrapper.info.walkoutQtyText = Granite.I18n.get('Walk Out') + ' (' + Granite.I18n.get('Qty') + ' : ' + sharedObj.walkoutQty.toLocaleString() + ')';
                drawObj.price.priceWrapper.info.homeDeliveryQtyText = Granite.I18n.get('Home Delivery') + ' (' + Granite.I18n.get('Qty') + ' : ' + sharedObj.homeDeliveryQty.toLocaleString() + ')';
            }
            

			drawObj.priceAnchor.priceWrapper.info = $.extend({}, drawObj.price.priceWrapper.info, drawObj.priceAnchor.priceWrapper.info );
            //sk, cz  heade navigation  (priceWrapper.info.totalPriceAnchor)  . 
			if(sharedObj.isSECZ) {
				if(priceWrapper.info.totalPriceAnchor) {
					drawObj.priceAnchor.priceWrapper.info.totalPrice = priceWrapper.info.totalPriceAnchor;
				}
			}
			
			view.productPriceTotalDraw(drawObj, sharedObj.isOptClicked);
		}

		//only co

		setSamcolVatFreePrice(sharedObj, drawObj, priceWrapper) {
			const siteCode= sharedObj.siteCode;
			if(siteCode =="co" && sharedObj.vatEligible === true) {
				drawObj.priceAnchor.priceWrapper.info.hasSamcolVatFreePrice = true;
				drawObj.priceAnchor.priceWrapper.info.samcolVatFreePrice = sharedObj.proudctPriceInfo.vatFreePriceFormatted;
				priceWrapper.info.hasSamcolVatFreePrice = true;
				priceWrapper.info.samcolVatFreePrice = sharedObj.proudctPriceInfo.vatFreePriceFormatted;
				//orignalPrice      
				if(priceWrapper.info.orignalPrice && priceWrapper.info.orignalPrice != null && priceWrapper.info.orignalPrice !=='') {
					//console.log('setSamcolVatFreePrice(sharedObj, drawObj, priceWrapper)!!!');
					drawObj.priceAnchor.priceWrapper.info.hasOrignalPrice = true;
					priceWrapper.info.hasOrignalPrice = true;
					drawObj.priceAnchor.priceWrapper.info.hasNoOrignalPrice = false;
					priceWrapper.info.hasNoOrignalPrice = false;
				} else {
					drawObj.priceAnchor.priceWrapper.info.hasOrignalPrice = false;
					priceWrapper.info.hasOrignalPrice = false;
					drawObj.priceAnchor.priceWrapper.info.hasNoOrignalPrice = true;
					priceWrapper.info.hasNoOrignalPrice = true;
				}
			} else {
				drawObj.priceAnchor.priceWrapper.info.hasNoSamcolVatFreePrice = true;
				drawObj.priceAnchor.priceWrapper.info.hasSamcolVatFreePrice = false;
				priceWrapper.info.hasNoSamcolVatFreePrice = true;
				priceWrapper.info.hasSamcolVatFreePrice = false;
				if(sharedObj.isNewElementLowestWasPrice === true && sharedObj.isNewElementLowestWasPriceSetting === false) {
					priceWrapper.info.hasNoLowestWasPrice = true;
					priceWrapper.info.hasLowestWasPrice = false;
				} else {
					priceWrapper.info.hasNoLowestWasPrice = false;
					priceWrapper.info.hasLowestWasPrice = true;
				}
			}
		}
		
		//only co   totalAfterFunction( sharedObj, selectorObj )   
		setSamcolVatFreePrice(sharedObj) {
			const drawObj = sharedObj.drawObj;
			const siteCode= sharedObj.siteCode;
			if(siteCode =="co" && sharedObj.vatEligible === true) {
				drawObj.priceAnchor.priceWrapper.info.hasSamcolVatFreePrice = true;
				drawObj.priceAnchor.priceWrapper.info.samcolVatFreePrice = sharedObj.proudctPriceInfo.vatFreePriceFormatted;
				drawObj.price.priceWrapper.info.hasSamcolVatFreePrice = true;
				drawObj.price.priceWrapper.info.samcolVatFreePrice = sharedObj.proudctPriceInfo.vatFreePriceFormatted;
				//orignalPrice      
				if(priceWrapper.info.orignalPrice && priceWrapper.info.orignalPrice != null && priceWrapper.info.orignalPrice !=='') {
					//console.log('setSamcolVatFreePrice(sharedObj, drawObj, priceWrapper)!!!');
					drawObj.priceAnchor.priceWrapper.info.hasOrignalPrice = true;
					drawObj.price.priceWrapper.info.hasOrignalPrice = true;
					drawObj.priceAnchor.priceWrapper.info.hasNoOrignalPrice = false;
					drawObj.price.priceWrapper.info.hasNoOrignalPrice = false;
				} else {
					drawObj.priceAnchor.priceWrapper.info.hasOrignalPrice = false;
					drawObj.price.priceWrapper.info.hasOrignalPrice = false;
					drawObj.priceAnchor.priceWrapper.info.hasNoOrignalPrice = true;
					drawObj.price.priceWrapper.info.hasNoOrignalPrice = true;
				}
			} else {
				drawObj.priceAnchor.priceWrapper.info.hasNoSamcolVatFreePrice = true;
				drawObj.priceAnchor.priceWrapper.info.hasSamcolVatFreePrice = false;
				drawObj.price.priceWrapper.info.hasNoSamcolVatFreePrice = true;
				drawObj.price.priceWrapper.info.hasSamcolVatFreePrice = false;
			}
		}
		
		/**
		 *   
		 */
		specialTagging( sharedObj, selectorObj ){
			const apiChangeModelCode = sharedObj.modelCode;
			const apiChangeModelName = sharedObj.modelName;
			const apiChangeDisplayName = sharedObj.displayName;
			const pvitype = sharedObj.pvitype.toLowerCase();
			const pvisubtype = sharedObj.pvisubtype.toLowerCase();
			const pimsubtype = sharedObj.pimsubtype.toLowerCase();
			const orignalPrice = sharedObj.proudctPriceInfo.orignalPrice;
			const salePrice = sharedObj.proudctPriceInfo.salePrice;
			
			$(document).find('.add-special-tagging').each(function( index, item ){
				if(!$(item).attr('data-modelcode') && apiChangeModelCode){
					$(item).attr('data-modelcode', apiChangeModelCode);
				}
				if(!$(item).attr('data-modelname') && apiChangeModelName && $(item).attr('data-modelcode') && $(item).attr('data-modelcode').indexOf( apiChangeModelCode ) > -1 ){
					$(item).attr('data-modelname', apiChangeModelName.toLowerCase());
				}
				if(!$(item).attr('data-modelprice') && salePrice && $(item).attr('data-modelcode') && $(item).attr('data-modelcode').indexOf( apiChangeModelCode ) > -1 ){
					$(item).attr('data-modelprice', orignalPrice);
				}
				
				if(!$(item).attr('data-modelrevenue') && salePrice && $(item).attr('data-modelcode') && $(item).attr('data-modelcode').indexOf( apiChangeModelCode ) > -1 ){
					$(item).attr('data-modelrevenue', orignalPrice);
				}
				
				if(!$(item).attr('data-discountprice') && salePrice && $(item).attr('data-modelcode') && $(item).attr('data-modelcode').indexOf( apiChangeModelCode ) > -1 ){
					$(item).attr('data-discountprice', salePrice);
				}
				
				if(!$(item).attr('data-modeldisplay') && apiChangeDisplayName && $(item).attr('data-modelcode') && $(item).attr('data-modelcode').indexOf( apiChangeModelCode ) > -1 ){
					$(item).attr('data-modeldisplay', apiChangeDisplayName.toLowerCase());
				}
				if(!$(item).attr('data-pvitype') && pvitype){
					$(item).attr('data-pvitype', pvitype);
				}
				if(!$(item).attr('data-pvisubtype') && pvisubtype){
					$(item).attr('data-pvisubtype', pvisubtype);
				}
				if(!$(item).attr('data-pimsubtype') && pimsubtype){
					$(item).attr('data-pimsubtype', pimsubtype);
				}
				
				if(!$(item).attr('data-modelqty')){
					$(item).attr('data-modelqty', '1');
				}
			});
			
		}
		/**
		 * Gpv2, Hybris CTA  
		 */
		settingPriceCta( hasProduct, sharedObj, selectorObj, learnMoreUrl ) {
			const wtbCtaBtnYn = sharedObj.wtbCtaBtnYn;
			const drawObj = sharedObj.drawObj;
			const view = sharedObj.view;
			const apiChangeStockStatus = sharedObj.apiChangeStockStatus;
			const priceCurrency = sharedObj.priceCurrency;
			
			// CTA  
			if( wtbCtaBtnYn !== 'Y' ){
				nonUseWtbCtaBtnYn( hasProduct, sharedObj, selectorObj, learnMoreUrl )
			} else {
				useWtbCtaBtnYn( hasProduct, sharedObj, selectorObj, learnMoreUrl )
			}
			
			this.changeUsCta( sharedObj, selectorObj );
			this.settingForBusiness( sharedObj, selectorObj );
			this.settingReserveInStore( sharedObj, selectorObj );
			//this.settingBespokeCta( sharedObj, selectorObj );
			if(sharedObj.stockLevelStatus == 'INSTOCK' && $("#personalizeCheckStatus").val() !== undefined && $("#personalizeCheckStatus").val() == "Y"){
				this.settingPersonalizeTvCta( sharedObj, selectorObj );
			}
			this.checkingCtaCount( sharedObj, selectorObj );
			
			const price = drawObj.price;
			const configuratorUrl = sharedObj.configuratorUrl;
			const ctaLocalText = sharedObj.ctaLocalText;
			const ctaEngText = sharedObj.ctaEngText;
			const configuratorUseYn = sharedObj.configuratorUseYn;
			const tempTitle = $('#tempTitle').val();
			let isCtaEngText = false;
			if( configuratorUseYn === 'Y' ){
				if( tempTitle === 'page-standard-pd' ){
					if( configuratorUrl !== '' && configuratorUrl !== null ){
						price.anchorNaviAttr.href = configuratorUrl;
						price.containedAttr.href = configuratorUrl;
						price.anchorNaviAttr.class = price.containedAttr.class = 'configuratorUse-y';
					}else{
						price.anchorNaviAttr.class = price.containedAttr.class = 'cta--disabled configuratorUse-y';
					}
					if( ctaLocalText !== '' && ctaLocalText !== null ){
						price.anchorNaviAttr.text = price.containedAttr.text = ctaLocalText;
					}
					if( ctaEngText !== '' && ctaEngText !== null ){
						isCtaEngText = true;
					}
					$('.pd-g-product-detail-kv').hide();
				}
			}
			
			// embed addon - VD sound category ( new vd   )
			const isVDSTEPBUYING = sharedObj.addonStepBuying04 || sharedObj.addonStepBuying0701;
			const soundbarCategory = sharedObj.soundbarCategoryData;
			if( isVDSTEPBUYING && !sharedObj.newEmbedVDCountry && soundbarCategory && soundbarCategory.categoryTotalCount === 1 && !sharedObj.hasGift ){
				// related    soundbar 1 , PD soundbar    addtocart cta 
				if( sharedObj.embedAddonSelected && sharedObj.embedAddonSelected.length > 0 ){
					price.anchorNaviAttr.class = price.containedAttr.class = price.anchorNaviAttr.class.replace(' tg-continue', '');
					price.anchorNaviAttr.ctaType = price.containedAttr.ctaType = price.anchorNaviAttr.ctaType.replace(' continue', '');
				}
			}
			
			view.productCtaDraw( drawObj );
			this.settingCtaTagging ( sharedObj, selectorObj );
			this.specialTagging( sharedObj, selectorObj );
			
			const summaryPrice = selectorObj.buyingToolPriceBar.find('.summary__product-price');
			if(sharedObj.embedAddonSelected && sharedObj.embedAddonSelected.length > 0){ // EmbedAddon    
				summaryPrice.show();
			}else{
				// leasing   embed addon      ,    leasing   
				const leasingPrice = selectorObj.buyingToolOptEmbedAddon.attr('data-leasing-price');
				if(leasingPrice){
					if(summaryPrice.html() === drawObj.price.priceWrapper.info.totalPrice){
						$('.pd-buying-price .pd-buying-price__wrap .pd-buying-price__new-price').html(leasingPrice);
						$('.pd-buying-tool__cost-box .cost-box__price .cost-box__price-now').html(leasingPrice);
					}
				}
				summaryPrice.hide();
			}
			
			// uk, au tariff
			if( siteCode === 'uk' || siteCode === 'au' ){
            	let showText = false;
            	const saveNaviPrice = $('.pd-buying-price__save');
            	const saveSummaryPrice = $('.cost-box__price-save');
            	const naviPrice = $('.pd-buying-price__new-price'); 
            	const summaryPrice = $('.cost-box__price-now');
            	const priceText = naviPrice.html();
            	
            	if( siteCode === 'uk' && drawObj.tariffOptionResult.hasComponent ){
	            	naviPrice.html(`Upfront Cost : ${priceText}`);
	            	summaryPrice.html(`Upfront Cost : ${priceText}`);
            	}
            	
            	if( drawObj.tariffOptionResult.hasComponent && drawObj.tradeInResult.hasComponent ){
            		if( drawObj.careResult.hasComponent ){ // tariff + tradein + care
        				if( parseInt(sharedObj.tariffPrice) + drawObj.careResult.dataSalePrice - drawObj.tradeInResult.dataPrice < 0 ){
    	            		showText = true;
    	            	}
            		}else{ // tariff + tradein
            			if( parseInt(sharedObj.tariffPrice) - drawObj.tradeInResult.dataPrice < 0 ){
    	            		showText = true;
    	            	}
            		}
            	}
            	
            	const costBoxCtaWrap = $('.pd-buying-tool__cost-box');
            	if( showText ){
            		const html = `<p class="cost-box__error-message">Sorry, we are unable to proceed due to the current product combination. Please select another device to trade-in or change your Sim Plan selection.</p>`;
            		if( costBoxCtaWrap.find('.cost-box__error-message').length > 0 ){
            			costBoxCtaWrap.find('.cost-box__error-message').html(html);
            		}else{
            			costBoxCtaWrap.find('.cost-box__cta-wrap').after(html);
            		}
            		$('.cost-box__cta a').addClass('cta--disabled');
            		$('.pd-buying-price__cta a').addClass('cta--disabled');
            		
            	}else{
            		costBoxCtaWrap.find('.cost-box__error-message').remove();
            	}
            	
            	if( siteCode === 'uk' && drawObj.tradeInResult.hasComponent ){
            		if( saveNaviPrice.length > 0 ){
            			saveNaviPrice.html(`Save ${currencyComma(drawObj.tradeInResult.dataPrice, priceCurrency)}`);
            			saveSummaryPrice.html(`Save ${currencyComma(drawObj.tradeInResult.dataPrice, priceCurrency)}`);
            		}else{
            			const naviHtml = `<div class="pd-buying-price__save">Save ${currencyComma(drawObj.tradeInResult.dataPrice, priceCurrency)}</div>`;
            			const summaryHtml = `<strong class="cost-box__price-save"><span class="hidden">Price </span>Save ${currencyComma(drawObj.tradeInResult.dataPrice, priceCurrency)}</strong>`;
            			$('.pd-buying-price .pd-buying-price__was').after(naviHtml);
            			$('.pd-buying-tool__cost-box .cost-box__price-original').after(summaryHtml);
            		}
            	}
            	
            	if( drawObj.tariffOptionResult.hasComponent ){
            		$('.pd-buying-price .pd-buying-price__was').hide();
            		$('.pd-buying-price .pd-buying-price__save').hide();
            		$('.pd-buying-tool__cost-box .cost-box__price-original').hide();
            		$('.pd-buying-tool__cost-box .cost-box__price-save').hide();
            	}
            }
			
			selectorObj.buyingTool.find('#apiChangeStockStatus').val(apiChangeStockStatus);
		}
		/**
		 * VD bezel color 
		 */
		settingBezelInfo( sharedObj, selectorObj ) {
			const modelCode = sharedObj.modelCode;
			const siteCode = sharedObj.siteCode;
			
			/*
			//CRHQ-8863 [B2C] VD bezel  admin   -  
			// 2022   
			var is2022siteCode = ["nl","be","be_fr","lv","lt","ee","ch","ch_fr","at","ro","hu","mx"];
			// 2022   
			var is2022modelCode = modelCode.indexOf("85LS03B") > -1 || modelCode.indexOf("75LS03B") > -1 || modelCode.indexOf("65LS03B") > -1 || modelCode.indexOf("55LS03B") > -1 || 
									modelCode.indexOf("50LS03B") > -1 || modelCode.indexOf("43LS03B") > -1 || modelCode.indexOf("32LS03B") > -1;
			
			if(!sharedObj.useBezelOptionDraw){
				if(is2022siteCode.includes(siteCode) && is2022modelCode){
					sharedObj.sellingWithBazel = true;
				}
			}
			*/
			
			//bezel    disabled 
			var totalBezelOption = $(".option-bezelcolor .pd-option-selector");
			if(totalBezelOption.length > 0){
				for(var i=0; i<totalBezelOption.length; i++){
					var disabledClass = totalBezelOption.eq(i).attr("data-disabled");
					totalBezelOption.eq(i).parent().addClass(disabledClass);
				}
			}
			
			if(sharedObj.sellingWithBazel){
				if($("#option-bezelcolor .pd-select-option__wrap").length == 0){ //  2022    OOS   cta   
					this.settingPriceCta ( sharedObj.hasPriceCta, sharedObj, selectorObj, sharedObj.currentUrl );
				}
			}
			
			if($("#option-bezelcolor .pd-select-option__wrap").length > 0 && !sharedObj.isBezel){ //      
				sharedObj.isBezel = true;
				
				var bezelColors = $("input[id^='pd-color-multi']");
				
				for(var i=0; i < bezelColors.length; i++){
					sharedObj.bezelColorArray.push(bezelColors[i]);
					if(bezelColors[0].dataset.bezelmodelcode == "dummyCode"){
						bezelColors[0].dataset.bezelmodelcode = modelCode;
					}
					sharedObj.bezelModelCodeList += bezelColors[i].dataset.bezelmodelcode;
					sharedObj.bezelModelPatternCodeList += bezelColors[i].dataset.bezelmodelpatterncode;
					
					if(i < bezelColors.length-1){
						sharedObj.bezelModelCodeList += ',';
						sharedObj.bezelModelPatternCodeList += ',';
					}
				}
				
				this.bezelModelCodeApiCall(sharedObj);
				//$("input[id^=pd-color-multi]")[0].click(); //   
			}
		}
		
		bezelModelCodeApiCall(sharedObj){
			//bezelModelCode api 
			const apiDomain = $("#storeDomain").val();
			const siteCode = sharedObj.multistoreSiteCd;
			const modelCode = sharedObj.bezelModelCodeList;
			const shopIntegrationFlag = $("#shopIntegrationFlag").val();
			const bezelModelCodeArrayList = modelCode.split(",");
			sharedObj.bezelModelCodeArrayList = bezelModelCodeArrayList;
			var apiURL = "";
			
			// epp shop 
			const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : siteCode;
			let shopParm = '';
			if( $('#shopParmLang').val() ){
				shopParm=`&lang=${$('#shopParmLang').val()}`;
			}
			var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};
			
			if(shopIntegrationFlag === 'Hybris-new'){
				apiURL = `${apiDomain}/tokocommercewebservices/v2/${siteCodeWithEpp}/products?productCodes=${modelCode}&fields=SIMPLE_INFO`+shopParm;
				
				$.ajax({
					url: apiURL,
					type: 'GET',
					cache: true,
					crossDomain: true,
					xhrFields: _xhrFields,
					dataType: 'json',
					timeout: 20000,
					success : function (data, status, xhr) {
						if(xhr.status == 200){
							bezelModelCodeInfo(sharedObj, data);
						}
					},
					error : function( XMLHttpRequest, textStatus, errorThrown ){},
					complete : function(){
						if($("input[id^=pd-color-multi]").length > 0){
							$("input[id^=pd-color-multi]")[0].click(); //   
						}
					}
				});
			}else if(shopIntegrationFlag === 'Hybris' || shopIntegrationFlag === 'Hybris-intg'){
				apiURL = `${apiDomain}/${siteCodeWithEpp}/servicesv2/getSimpleProductsInfo?productCodes=${modelCode}`;
				//apiURL = `https://shop.samsung.com/${siteCode}/servicesv2/getSimpleProductsInfo?productCodes=${modelCode}`;
				
				if(sharedObj.hybrisJsonYn === 'Y') {
					$.ajax({
						url: apiURL,
						type: "GET",
						dataType: 'json',
						cache:true,
						crossDomain : true,
						timeout : 10000,
						xhrFields: {withCredentials: true},
						success: function (data, status, xhr) {
							if(xhr.status == 200){
								bezelModelCodeInfo(sharedObj, data);
							}
						},
						error : function(){},
						complete : function (){
							//afterHybrisApi( sharedObj, selectorObj );
							if($("input[id^=pd-color-multi]").length > 0){
								$("input[id^=pd-color-multi]")[0].click(); //   
							}
						} 
					});
				} else {
					$.ajax({
						url: apiURL,
						type: "GET",
						dataType: 'jsonp',
						jsonpCallback:"jQuery1910499421933433041_" + "111",
						cache:true,
						crossDomain : true,
						timeout : 10000,
						xhrFields: {withCredentials: true},
						success: function (data, status, xhr) {
							if(xhr.status == 200){
								bezelModelCodeInfo(sharedObj, data);
							}
						},
						error : function(){},
						complete : function (){
							//afterHybrisApi( sharedObj, selectorObj );
							if($("input[id^=pd-color-multi]").length > 0){
								$("input[id^=pd-color-multi]")[0].click(); //   
							}
						}
					});
				}
			}/*else if(shopIntegrationFlag === 'GPv2'){
				var bezelSkuList = "";
				
				for(var i=0; i<bezelModelCodeArrayList.length; i++){
					sharedObj.bezelSkuArrayList.push(bezelModelCodeArrayList[i].slice(0,-3)); //sku => modelCode  3 
				}
				bezelSkuList = bezelSkuArrayList.join(",");
				
				apiURL = `${apiDomain}/v4/configurator/syndicated-product-linear?skus=${bezelSkuList}`;
				
				$.ajax({
					headers: {
						'Cache-Control' : 'no-cache',
						'Content-Type' : 'application/json',
						'Access-Control-Allow-Origin' : '*'
					},
					url: apiURL,
					type: 'GET',
					dataType: 'json',
					timeout: 20000,
					xhrFields: { withCredentials: true },
					success : function (data, status, xhr) {
						if(xhr.status == 200){
							bezelModelCodeInfo(sharedObj, data);
						}
					},
					error : function( XMLHttpRequest, textStatus, errorThrown ){},
					complete : function (){
						$("input[id^=pd-color-multi]")[0].click(); //   
					} 
				});
			}*/
			
			function bezelModelCodeInfo(sharedObj, obj){
				const shopIntegrationFlag = $("#shopIntegrationFlag").val();
				var bezelModelCodeArray = sharedObj.bezelModelCodeArray; //     
				
				if(shopIntegrationFlag === 'Hybris-new'){
					var bezelModelCodeData = obj;
					
					for(var i=0; i<bezelModelCodeData.length; i++){
						sharedObj.bezelModelCodeArray.push(bezelModelCodeData[i]);
					}
				}else if(shopIntegrationFlag === 'Hybris' || shopIntegrationFlag === 'Hybris-intg'){
					var bezelModelCodeData = obj.productDatas;
					
					for(var i=0; i<sharedObj.bezelModelCodeArrayList.length; i++){ //,   
						for(var j=0; j<bezelModelCodeData.length; j++){
							if(sharedObj.bezelModelCodeArrayList[i] == bezelModelCodeData[j].productCode){
								sharedObj.bezelModelCodeArray.push(bezelModelCodeData[j]);
							}
						}
					}
				}/*else if(shopIntegrationFlag === 'GPv2'){
					var bezelModelCodeData = obj.products;
					console.log(bezelModelCodeData);
					
					for(var i=0; i<sharedObj.bezelSkuArrayList.length; i++){ //,   
						var existSku = false;
						for(var j=0; j<bezelModelCodeData.length; j++){
							if(sharedObj.bezelSkuArrayList[i] == bezelModelCodeData[j]){
								existSku = true;
								sharedObj.bezelModelCodeArray.push(bezelModelCodeData[j]);
							}
							//  sku     
							if(j==bezelModelCodeData.length-1 && !existSku){
								sharedObj.bezelModelCodeArray.push('');
							}
						}
					}
				}*/
				
				var bezelColorIndex = sharedObj.bezelColorIndex; //  0
				sharedObj.selectedBezelColor = bezelModelCodeArray[bezelColorIndex]; //        
			}
		}
		
		
		/**
		 * PD Gift Card 
		 */
		settingGiftCard( sharedObj, selectorObj ) {
			if($(".pd-select-option--gift-card").length > 0 && !sharedObj.giftCard.isGiftCard) {
				const siteCode = sharedObj.siteCode;
				const pdMultiLanguageYN = sharedObj.pdMultiLanguageYN;
				const pdHrefLang = sharedObj.pdHrefLang;
				const loginJwt = $.cookies.get("jwt_"+sharedObj.countryIsoCode, {domain : ".samsung.com"});
				
				var guid = $.cookies.get("guid",{domain:".samsung.com"});
				var flpe = $.cookies.get("flpe", {domain : ".samsung.com"});
				var jsonflpe = {};
				if(flpe && guid) {
					// CryptoJS   
					const keyone = $("#cookieKey").val();
					var parsekeyone = CryptoJS.enc.Utf8.parse(keyone); //  utf8  1 
					
					// 1  guid  2   
					var enkeyone = CryptoJS.AES.encrypt(guid, parsekeyone,{
						mode: CryptoJS.mode.ECB,
						padding: CryptoJS.pad.Pkcs7
					});
					
					// CryptoJS   
					const keytwo = (enkeyone+keyone).substring(0, 32); // 2   AES256  32Byte      
					var parsekeytwo = CryptoJS.enc.Utf8.parse(keytwo); //  utf8  1 

					//     2  .
					var dekeytwo = CryptoJS.AES.decrypt(flpe, parsekeytwo,{
						mode: CryptoJS.mode.ECB,
						padding: CryptoJS.pad.Pkcs7
					});
					var deflpe = CryptoJS.enc.Utf8.stringify(dekeytwo);
					
					//   url  json  
					jsonflpe = JSON.parse(decodeURIComponent(deflpe));
				}

				const firstName = jsonflpe.firstName;
				const lastName = jsonflpe.lastName;
				var myEmail = jsonflpe.emailAddr;
    	    	
				sharedObj.giftCard.isGiftCard = true;
				sharedObj.giftCard.cartGiftCardCode = sharedObj.modelCode;
				/* hybirs api    
				$("#gift-card-amount-0").attr("data-price", sharedObj.giftCard.minPrice);
				$("#gift-card-amount-1").attr("data-price", sharedObj.giftCard.maxPrice);
				
				$("#gift-card-amount-0").siblings().text(sharedObj.giftCard.minPriceFormatted);
				$("#giite.I18n.get( "minPrice{0} maxPrice{1} priceIncrement{2}", [sharedObj.giftCard.minPriceFormatted, sharedObj.giftCard.maxPriceFormatted, sharedObj.giftCard.priceIncrementFormatted] );
				*/
				
				//    
				sharedObj.giftCard.selectedPrice = sharedObj.giftCard.minPrice;
				var inputAmountText = Granite.I18n.get( "minPrice{0} maxPrice{1} priceIncrement{2}", [sharedObj.giftCard.minPriceFormatted, sharedObj.giftCard.maxPriceFormatted, sharedObj.giftCard.priceIncrementFormatted] );
				var errorText = Granite.I18n.get("Please enter only numbers. {0} {1}", [sharedObj.giftCard.minPriceFormatted, sharedObj.giftCard.maxPriceFormatted]);
				
				$(".pd-select-option--gift-card .text-field-v2__hint").text(inputAmountText);
				$(".pd-select-option--gift-card .text-field-v2__text").text(errorText);
				
				if(guid == null || guid == ""){
					$(".checkbox-v2").hide();
				}
				
				//  ,  
    	    	$(document).on("click", "#email-checkbox", function(){
    	    		//   ( jwt+countryIsoCode  null  guid )
    	    		if(guid != null && guid != ""){
    	    			if($("#email-checkbox").is(':checked')){
    	    				if (myEmail != null && myEmail) {
    	    					sharedObj.giftCard.emailValid = true;
    	    					$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(0).hide();
    	    					$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(1).hide();
    	    					$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(2).hide();
    	    				}
            	    		sharedObj.giftCard.email = myEmail;
            	    		sharedObj.giftCard.firstName = firstName;
            	    		sharedObj.giftCard.lastName = lastName;
            	    		
        	    			$("#email-address-input").val(myEmail);
        	    			$("#first-name-input").val(firstName);
        	    			$("#last-name-input").val(lastName);
        	    			
        	    			$("#email-address-input").parent().parent().addClass("active");
        	    			$("#first-name-input").parent().parent().addClass("active");
        	    			$("#last-name-input").parent().parent().addClass("active");
        	    			
        	    		}else{
        	    			sharedObj.giftCard.emailValid = false;
        	    			sharedObj.giftCard.email = "";
            	    		sharedObj.giftCard.firstName = "";
            	    		sharedObj.giftCard.lastName = "";
            	    		
        	    			$("#email-address-input").val("");
        	    			$("#first-name-input").val("");
        	    			$("#last-name-input").val("")
        	    			
        	    			$("#email-address-input").parent().parent().removeClass("active");
        	    			$("#first-name-input").parent().parent().removeClass("active");
        	    			$("#last-name-input").parent().parent().removeClass("active");
        	    		}
    	    		}else{
    	    			
    	    		}
    	    	});
    	    	
				//    (10~500 5)
				$(document).on("change keyup paste", "#gift-card-amount-input", function(key){
					var regNumber = /[^0-9]/g; // 
					var inputAmount = $("#gift-card-amount-input").val();
					
					sharedObj.giftCard.inputAmount = inputAmount.replace(regNumber,"");
					$("#gift-card-amount-input").val(sharedObj.giftCard.inputAmount);
				});
				
				//Personalized message
				$(document).on("focusout", "#personalized-message-input", function(key){
					sharedObj.giftCard.personalizedMessage = $("#personalized-message-input").val();
				});
				
				//  
				var inputEmail;
				
				$(document).on("focusout", "#email-address-input", function(key){
					inputEmail = $("#email-address-input").val();
					var regEmail = /^([0-9a-zA-Z_\.-]+)@([0-9a-zA-Z_-]+)(\.[0-9a-zA-Z_-]+){1,2}$/; // 
					
	    	    	if(!regEmail.test(inputEmail)){
	    	    		sharedObj.giftCard.emailValid = false;
	    	    		$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(0).show();
	    	    	}else{
	    	    		sharedObj.giftCard.emailValid = true;
	    	    		sharedObj.giftCard.email = $("#email-address-input").val();
	    	    		$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(0).hide();
	    	    	}
				});
				
				//First name, Last name
				$(document).on("focusout", "#first-name-input", function(key){
					sharedObj.giftCard.firstName = $("#first-name-input").val();
					if(sharedObj.giftCard.firstName == ""){
						$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(1).show();
					}else{
						$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(1).hide();
					}
				});
				$(document).on("focusout", "#last-name-input", function(key){
					sharedObj.giftCard.lastName = $("#last-name-input").val();
					if(sharedObj.giftCard.lastName == ""){
						$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(2).show();
					}else{
						$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(2).hide();
					}
				});
				
			}
		}
		
		/**
		 * PD EDD
		 */
		settingDeliveryPickup( sharedObj, selectorObj ) {
			if($(".pd-select-option--delivery-pickup").length > 0 && !sharedObj.deliveryPickup.isDeliveryPickup) {
				sharedObj.deliveryPickup.isDeliveryPickup = true;
				
				const siteCode = sharedObj.siteCode;
				const modelCode = sharedObj.modelCode;
				
				//EDD category 
				if( $(".pd-select-option--delivery-pickup").length > 0 ){
					if((sharedObj.categoryTypeCode.startsWith('01') || sharedObj.categoryTypeCode.startsWith('08') || sharedObj.categoryTypeCode.startsWith('04')) && sharedObj.blockEddDisplay == "N"){
						$(".pd-select-option--delivery-pickup").show();
					}
				}
				
				$(document).on("click", ".pd-delivery-pickup__button .cta, .pd-delivery-pickup__edit-button", function(){
					// open : window.sg.components.eddPopup.activePopup(document.querySelector('#    id'))
					window.sg.components.eddPopup.activePopup($(this));
				});
				
			}
		}
		
		/**
		 * PD Recommendation 
		 */
		settingRecommendation( sharedObj, selectorObj ) {
			const modelCode = sharedObj.modelCode;
			const siteCode = sharedObj.siteCode;
			const useRecommendation = sharedObj.useRecommendation;
			const notUseRecommendation = sharedObj.notUseRecommendation;
			
			if(useRecommendation && !notUseRecommendation.includes(siteCode)){
				if(sharedObj.productType != "A"){
					if(sharedObj.stockLevelStatus != "INSTOCK" && sharedObj.stockLevelStatus != "BACKORDERED" && sharedObj.stockLevelStatus != "PREORDER" && sharedObj.stockLevelStatus != "LOWSTOCK"){
						productRecommendationPD.getSearchProductCardForBDCApi(modelCode);
					}else{
						$(".pdd24-product-recommendation").hide();
					}
				}else{
					$(".pdd24-product-recommendation").hide();
				}
			}
		}
		
		/**
		 * US  delivery api   CTA   
		 */
		changeUsCta( sharedObj, selectorObj ){
			const util = sharedObj.util;
			const pfAllUrl = sharedObj.pfAllUrl;
			const siteCode = sharedObj.siteCode;
			const drawObj = sharedObj.drawObj;
			const price = drawObj.price;
			
			if( siteCode === 'us' && drawObj.delivery.errorMessage ){
				price.containedAttr  = util.getAttrCta( Granite.I18n.get("SEE SIMILAR PRODUCTS IN STOCK"), pfAllUrl, '_self', '', {} );
				price.anchorNaviAttr = util.getAttrCta( Granite.I18n.get("SEE SIMILAR PRODUCTS IN STOCK"), pfAllUrl, '_self', '', {} );
			}
		}
		
		settingReserveInStore( sharedObj, selectorObj ){
			const price = sharedObj.drawObj.price;
			const util = sharedObj.util;
			const siteCode = sharedObj.siteCode;
			
			if( sharedObj.hasReserveInStore ){
				price.reserveInStoreAttr = {
					'text': Granite.I18n.get('Reserve In Store').toUpperCase(),
					'class' : null,
					'href' : sharedObj.apiDomain+'/'+sharedObj.siteCode+'/reserve-online/reserve-now-product?productCode='+sharedObj.modelCode,
					'title' : null,
					'target' : '_self'
				}
			}
		}
		settingForBusiness( sharedObj, selectorObj ){
			const price = sharedObj.drawObj.price;
			const util = sharedObj.util;
			const siteCode = sharedObj.siteCode;
			
			if( sharedObj.hasEbtButtonUse ){
				price.outlinedAttr = util.getAttrCta( Granite.I18n.get("For Business"), 'javascript:;', '_self', 'tg-for-business', {'ctaType' : 'for-business'} );
				if( price.containedAttr.class && price.containedAttr.class.indexOf('js-cta-buy') > -1 ){
					if( siteCode === 'br' ){
						// br   cta 
						price.anchorNaviAttr = {};
						price.containedAttr = {};
					} else {
						//    cta   
						price.wtbAttr = $.extend({}, price.wtbAtt, price.containedAttr );
						price.containedAttr = {};
					}
				}
			}
		}
		
		// Bespoke CTA  
		/*settingBespokeCta( sharedObj, selectorObj ){
			const price = sharedObj.drawObj.price;
			const util = sharedObj.util;
			if( sharedObj.hasBespokeCta ){					
				price.bespokeAttr = util.getAttrCta( Granite.I18n.get('Customize yours'), $('#bespokeCtaLink').val(), '_self', 'tg-bespoke', {'title' :  Granite.I18n.get('Customize yours')});
			}
		}*/
		
		settingPersonalizeTvCta( sharedObj, selectorObj ){
			if( !sharedObj.setPersonalizeTv && sharedObj.hasPersonalizeTv ){ //  instock 
				sharedObj.setPersonalizeTv = true;
				
				//ispersonalizetv api 
				const siteCode = sharedObj.siteCode;
				const modelCode = sharedObj.modelCode;
				let personalizeTvApiDomain = "https://vdapi.samsung.com";
				
				if(window.location.href.indexOf("pre-qa") > -1){
					personalizeTvApiDomain = "https://vdapi.samsung.com";
				}else if(window.location.href.indexOf("d6-aem") > -1){
					personalizeTvApiDomain = "http://dev-vdapi.samsung.com";
				}else if(window.location.href.indexOf("s6-aem") > -1){
					personalizeTvApiDomain = "https://stg-vdapi.samsung.com";
				}
				
				var param = {"modelCode": modelCode};
				var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};
				xhrFields: _xhrFields,

				$.ajax({
					url: personalizeTvApiDomain+"/tvs/tvpersonalize/api/tvapps/appserver/ispersonalizetv",
					type: "GET",
					dataType: "text",
					data: param,
					async : false,
					xhrFields: _xhrFields,
					contentType: "application/json",
					success: function(data){
						if(data == "Available"){
							$.ajax({
								url: "/"+sharedObj.siteCode+"/tvs/personalize-my-tv/",
								type: "GET",
								datatype: "json",
								data: {"sku": modelCode, "type": "apps"},
								success: function(data, status, xhr){
									if(xhr.status == "200"){
										$("#personalizeMyTv").show();
									}
								},
								error: function (request, status, error) {
								}
							});
						}else{
							$("#personalizeMyTv").hide();
						}
					},
					error: function (request, status, error) {
					}
				});
			}
		}
		
		checkingCtaCount( sharedObj, selectorObj ){
			const price = sharedObj.drawObj.price;
			//  cta 2  cost-box__cta-wrap--business 
			let ctaCount = 0;
			if( price.outlinedAttr.text){
				ctaCount++;
			}
			if( price.containedAttr.text){
				ctaCount++;
			}
			if( price.reserveInStoreAttr.text){
				ctaCount++;
			}			
			if( price.bespokeAttr.text){
				ctaCount++;
			}
			
			if( ctaCount >= 2 && !sharedObj.hasBespokeCta){
				price.ctaWrapperClass = 'cost-box__cta-wrap--business';
			}else if(ctaCount >= 2 && sharedObj.hasBespokeCta){
				price.ctaWrapperClass = 'cost-box__cta-wrap--bespoke';
			}
		}
		
		checkingDeliveryCode( sharedObj, selectorObj ){
			const util = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const siteCode = sharedObj.siteCode;
			const pdProductType = sharedObj.pdProductType;
			const deliveryArea = selectorObj.buyingToolOptDelivery;
			const delPinCode = $(deliveryArea.find('#delivery-zipcode')).val();
			const hasDeliveryResult = util.hasDeliveryResult( sharedObj, selectorObj );
			
			let result = true;
			
			if( ( siteCode === 'in' && pdProductType !== 'PHONE' ) ){
				if( !hasDeliveryResult || !delPinCode ){
					const msg = Granite.I18n.get("Enter your zipcode");
					//$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-care");
					// confirmPopup(msg,'error');
					drawObj.delivery.errorMessage = msg;
					drawObj.delivery.inputAttr.value = delPinCode;
					view.deliveryDraw(drawObj);
					$(deliveryArea).find('.text-field-v2__text.error').show();
					$(deliveryArea).find('#delivery-zipcode').focus().val('').val(delPinCode);
					$(deliveryArea).find('.pd-select-option__tooltip').hide();
					$('.option-result.result-delivery').hide();
					result = false;
				} else {
					drawObj.delivery.errorMessage = null;
					$(deliveryArea).find('.text-field-v2__text.error').hide();
					view.deliveryDraw(drawObj);
				}
			}
			
			return result;
		}
		
		//Gift Card    
		checkingRecipientInfo( sharedObj ){
			const util = sharedObj.util;
			let result = true;
			
			if(sharedObj.giftCard.isGiftCard){
				result = sharedObj.giftCard.amountValid && sharedObj.giftCard.emailValid && sharedObj.giftCard.firstName != "" && sharedObj.giftCard.lastName != "";
				if(!sharedObj.giftCard.amountValid)	{
					if($("#gift-card-amount-2").prop("checked")){
						var errorText = Granite.I18n.get("Please enter only numbers. {0} {1} check", [sharedObj.giftCard.minPriceFormatted, sharedObj.giftCard.maxPriceFormatted]);
						$(".pd-select-option--gift-card .text-field-v2__text").text(errorText);
						$(".pd-select-option--gift-card .text-field-v2__text.error").show();
						$("#gift-card-amount-input").focus();
					}
				}else{
					if(!sharedObj.giftCard.emailValid){
						$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(0).show();
						$("#email-address-input").focus();
					}else{
						if(sharedObj.giftCard.firstName == ""){
							$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(1).show();
							$("#first-name-input").focus();
						}else{
							if(sharedObj.giftCard.lastName == ""){
								$(".pd-select-option--delivery-details .text-field-v2__text.error").eq(2).show();
								$("#last-name-input").focus();
							}
						}
					}
				}
			}
			
			return result;
		}
		
		/**
		 * Common   
		 */
		settingCommonPopupTagging( target, sharedObj, selectorObj ){
			let anTr = '';
			let anCa = 'option click';
			let anAc = 'pd buying tool';
			let anLa = '';
			
			if( target === 'combo' ){
				anTr='header(pim)_offer option:bundle offer-'+sharedObj.pageTrackPd+'-delete-confirm'
				anLa="bundle offer:delete option:"
			} else if ( target === 'tradeIn'){
				anTr='header(pim)_trade in-'+sharedObj.pageTrackPd+'-delete-confirm'
				anLa="trade in:delete option:"
				if( sharedObj.isMultiTradeIn ){
					anTr='header(pim)_trade in-'+sharedObj.pageTrackPd+'-option_click'+Number(sharedObj.checkedIndex)+1;
				}
			} else if ( target === 'care'){
				anTr='header(pim)_service option selector-'+sharedObj.pageTrackPd+'-text-button'
				anLa="samsung care:delete option:"
			} else if ( target === 'upgrade'){
				anTr='header(pim)_service option selector-'+sharedObj.pageTrackPd+'}-cta-link'
				anLa="upgrade program:delete option:"
			} else if ( target === 'tariffOption'){
				anTr='header(pim)_service option selector tariff-'+sharedObj.pageTrackPd+'}-popup-button'
				anLa="tariff:delete option:"
			} else if ( target === 'forever'){
				anTr='header(pim)_service option selector galaxy forever-'+sharedObj.pageTrackPd+'}-popup-button'
				anLa="galaxy forever:delete option:"
			} else if ( target === 'assured'){
				anTr='header(pim)_service option selector assured buy back-'+sharedObj.pageTrackPd+'}-popup-button'
				anLa="assured buy back:delete option:"
			}
			
			$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--outlined').attr('an-tr',anTr).attr('an-ca',anCa).attr('an-ac',anAc).attr('an-la',anLa+'no')
			$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained').attr('an-tr',anTr).attr('an-ca',anCa).attr('an-ac',anAc).attr('an-la',anLa+'yes')
		}
		
		settingWishlistTagging( sharedObj, selectorObj ){
			const pageTrack = sharedObj.pageTrackPd;
			const $pcTarget = $(selectorObj.buyingToolInfoWishlist.find('.pd-wishlist-cta'));
			const $moTarget = $(".pd-header-gallery").find(".pd-info__wishlist .pd-wishlist-cta");
			
			if( $pcTarget && $pcTarget.length > 0 ){
				let anTr = 'header(pim)_product Info-'+pageTrack+'-image-action';
				let anCa = 'account';
				let anAc = 'wishlist';
				let anLa = '';
				
				const className = $pcTarget.attr('class') ? $pcTarget.attr('class') : '';
				if( className.indexOf('tg-add-wishlist') > -1 ){
					anLa = 'add to wishlist';
				} else if( className.indexOf('tg-remove-wishlist') > -1 ) {
					anLa = 'remove from wishlist';
				}
				
				$pcTarget.attr('an-tr',anTr).attr('an-ca',anCa).attr('an-ac',anAc).attr('an-la',anLa)
				$moTarget.attr('an-tr',anTr).attr('an-ca',anCa).attr('an-ac',anAc).attr('an-la',anLa)
			}
			
		}
		/**
		 * CTA 
		 */	
		settingCtaTagging ( sharedObj, selectorObj ){
			const $naviCta = $('.pd-header-navigation .pd-buying-price__cta .cta');
			const $priceBarCta = selectorObj.buyingToolPriceBar.find('.cta');
			const pageTrack = sharedObj.pageTrackPd;
			const modelCodeList = [sharedObj.modelCode];
			const modelNameList = [sharedObj.modelName];
			const displayNameList = [sharedObj.displayName];
			const modelRevenueList = [sharedObj.proudctPriceInfo.orignalPrice];
			const modelDiscountpriceList = [sharedObj.proudctPriceInfo.salePrice];
			const modelPviTypeNameList = [sharedObj.pvitype.toLowerCase()];
			const modelPviSubtypeNameList = [sharedObj.pvisubtype.toLowerCase()];
			const modelCategorySubTypeEngNameList = [sharedObj.pimsubtype.toLowerCase()];
			const modelQtyList = ['1'];
			
			let taggingModelCodeList = '';
			let taggingModelNameList = '';
			let taggingModelDisplayList = '';
			let taggingModelRevenueList = '';
			let taggingModelDiscountpriceList = '';
			let taggingModelPviTypeName = '';
			let taggingModelPviSubtypeName = '';
			let taggingModelCategorySubTypeEngName = '';
			let taggingQty = '';
			
			
			if( sharedObj.util.hasTradeInResult( sharedObj, selectorObj ) ){
				modelCodeList.push('trade-in');
				modelNameList.push('trade-in');
				displayNameList.push('trade-in');
				modelPviTypeNameList.push('shop program');
				modelPviSubtypeNameList.push('trade-in');
				modelCategorySubTypeEngNameList.push('trade-in');
				modelRevenueList.push('0');
				modelDiscountpriceList.push('0');
				modelQtyList.push('0');
			}
			
			if( sharedObj.util.hasUpgradeResult( sharedObj, selectorObj ) ){
				modelCodeList.push('upgrade');
				modelNameList.push('upgrade');
				displayNameList.push('upgrade');
				modelPviTypeNameList.push('shop program');
				modelPviSubtypeNameList.push('upgrade');
				modelCategorySubTypeEngNameList.push('upgrade');
				modelRevenueList.push('0');
				modelDiscountpriceList.push('0');
				modelQtyList.push('0');
			}
			
			if( sharedObj.util.hasCareResult( sharedObj, selectorObj ) ){
				modelCodeList.push(sharedObj.drawObj.careResult.dataModelCode);
				modelNameList.push(sharedObj.drawObj.careResult.dataModelCode);
				displayNameList.push(sharedObj.drawObj.careResult.dataModelCode);
				modelRevenueList.push(sharedObj.drawObj.careResult.dataPrice);
				modelDiscountpriceList.push(sharedObj.drawObj.careResult.dataSalePrice);
				modelPviTypeNameList.push('shop program');
				modelPviSubtypeNameList.push('samsung care');
				modelCategorySubTypeEngNameList.push('insurance');
				modelQtyList.push('1');
			}
			
			if( sharedObj.util.hasWarrantyResult( sharedObj, selectorObj ) ){
				modelCodeList.push(sharedObj.drawObj.warrantyResult.dataModelCode);
				modelNameList.push(sharedObj.drawObj.warrantyResult.dataModelCode);
				displayNameList.push(sharedObj.drawObj.warrantyResult.dataModelCode);
				modelRevenueList.push(sharedObj.drawObj.warrantyResult.dataPrice);
				modelDiscountpriceList.push(sharedObj.drawObj.warrantyResult.dataSalePrice);
				modelPviTypeNameList.push('shop program');
				modelPviSubtypeNameList.push('samsung care');
				modelCategorySubTypeEngNameList.push('warranty');
				modelQtyList.push('1');
			}
			
			if( sharedObj.util.hasTariffOptionResult( sharedObj, selectorObj ) ){
				modelCodeList.push(sharedObj.drawObj.tariffOptionResult.dataModelCode);
				modelNameList.push(sharedObj.drawObj.tariffOptionResult.dataModelCode);
				displayNameList.push(sharedObj.drawObj.tariffOptionResult.dataModelCode);
				modelPviTypeNameList.push('shop program');
				modelPviSubtypeNameList.push('tariff');
				modelCategorySubTypeEngNameList.push('tariff');
				modelRevenueList.push('0');
				modelDiscountpriceList.push('0');
				modelQtyList.push('0');
			}
			
			if( sharedObj.util.hasForeverResult( sharedObj, selectorObj ) ){
				modelCodeList.push('forever');
				modelNameList.push('forever');
				displayNameList.push('forever');
				modelPviTypeNameList.push('shop program');
				modelPviSubtypeNameList.push('forever');
				modelCategorySubTypeEngNameList.push('forever');
				modelRevenueList.push(sharedObj.drawObj.galaxyForeverResult.dataPrice);
				modelDiscountpriceList.push(sharedObj.drawObj.galaxyForeverResult.dataPrice);
				modelQtyList.push('1');
			}
			
			if( sharedObj.util.hasBogo( sharedObj, selectorObj ) ){
				modelCodeList.push(sharedObj.drawObj.offer.bogo.item.modelCode);
				modelNameList.push(sharedObj.drawObj.offer.bogo.item.modelName);
				displayNameList.push(sharedObj.drawObj.offer.bogo.item.displayName);
				if( sharedObj.drawObj.offer.bogo.item.price.price ){
					modelRevenueList.push( Number(sharedObj.drawObj.offer.bogo.item.price.price) * 1 );
					modelDiscountpriceList.push('0');
				}
				modelPviTypeNameList.push(sharedObj.drawObj.offer.bogo.item.pviTypeName);
				modelPviSubtypeNameList.push(sharedObj.drawObj.offer.bogo.item.pviSubtypeName);
				modelCategorySubTypeEngNameList.push(sharedObj.drawObj.offer.bogo.item.categorySubTypeEngName);
				modelQtyList.push('1');
			}
			
			if( sharedObj.util.hasGiftResult( sharedObj, selectorObj ) ){
				const giftModelResultList = sharedObj.drawObj.offer.gift.item.bundleList;
				
				if( giftModelResultList && giftModelResultList.length > 0 ){
					for( var indexGiftR in giftModelResultList ){
						const giftResultItem = giftModelResultList[indexGiftR];
						modelCodeList.push(giftResultItem.dataModelCode);
						modelNameList.push(giftResultItem.dataModelName);
						displayNameList.push(giftResultItem.dataDisplayName);
						modelRevenueList.push(giftResultItem.dataPrice);
						modelDiscountpriceList.push(giftResultItem.dataSalePrice);
						modelPviTypeNameList.push(giftResultItem.pviTypeName);
						modelPviSubtypeNameList.push(giftResultItem.pviSubtypeName);
						modelCategorySubTypeEngNameList.push(giftResultItem.categorySubTypeEngName);
						modelQtyList.push('1');
					}
				}
			}
			
			if( sharedObj.util.hasComboResult( sharedObj, selectorObj ) ){
				if( sharedObj.drawObj.offer.combo && sharedObj.drawObj.offer.combo.length > 0 ){
					for( var comboIndex in sharedObj.drawObj.offer.combo ){
						const comboModelResultList = sharedObj.drawObj.offer.combo[comboIndex].item.bundleList;
						
						if( comboModelResultList && comboModelResultList.length > 0 ){
							for( var indexComboR in comboModelResultList ){
								const comboResultItem = comboModelResultList[indexComboR];
								modelCodeList.push(comboResultItem.dataModelCode);
								modelNameList.push(comboResultItem.dataModelName);
								displayNameList.push(comboResultItem.dataDisplayName);
								modelRevenueList.push(comboResultItem.dataPrice);
								modelDiscountpriceList.push(comboResultItem.dataSalePrice);
								modelPviTypeNameList.push(comboResultItem.pviTypeName);
								modelPviSubtypeNameList.push(comboResultItem.pviSubtypeName);
								modelCategorySubTypeEngNameList.push(comboResultItem.categorySubTypeEngName);
								modelQtyList.push('1');
							}
						}
					}
				}
			}
			
			if( sharedObj.util.hasAssuredBuyBackResultResult( sharedObj, selectorObj ) ){
				modelCodeList.push(sharedObj.drawObj.assuredBuyBackResult.dataSku);
				modelNameList.push(sharedObj.drawObj.assuredBuyBackResult.dataModelName);
				displayNameList.push(sharedObj.drawObj.assuredBuyBackResult.displayModelName);
				modelPviTypeNameList.push('shop program');
				modelPviSubtypeNameList.push('galaxy assured');
				modelCategorySubTypeEngNameList.push('galaxy assured');
				modelRevenueList.push(sharedObj.drawObj.assuredBuyBackResult.dataPrice);
				modelDiscountpriceList.push(sharedObj.drawObj.assuredBuyBackResult.dataSalePrice);
				modelQtyList.push('1');
			}
			
			const embedAddonSelected = sharedObj.embedAddonSelected;
			if( embedAddonSelected && embedAddonSelected.length > 0 ){
				for( const item of embedAddonSelected ){
					modelCodeList.push(item.modelCode);
					modelNameList.push(item.modelName);
					displayNameList.push(item.name);
					modelPviTypeNameList.push(item.pviType);
					modelPviSubtypeNameList.push(item.pviSubtype);
					modelCategorySubTypeEngNameList.push(item.categorySubType ? item.categorySubType.toLowerCase() : '');
					modelRevenueList.push(item.revenue);
					modelDiscountpriceList.push(item.finalPriceValue);
					modelQtyList.push('1');
				}
			}
			
			taggingModelCodeList = modelCodeList.join(',');
			taggingModelDisplayList = displayNameList.join(';');
			taggingModelNameList = modelNameList.join(',');
			taggingModelRevenueList = modelRevenueList.join(',');
			taggingModelPviTypeName = modelPviTypeNameList.join(',');
			taggingModelPviSubtypeName = modelPviSubtypeNameList.join(',');
			taggingModelCategorySubTypeEngName = modelCategorySubTypeEngNameList.join(',');
			taggingModelDiscountpriceList = modelDiscountpriceList.join(',');
			taggingQty = modelQtyList.join(',');
			
			const tariffTarget = $('section.tariff-popup .tariff-popup__btn-submit');
			
			// new-hybris
			if( sharedObj.siteCode === 'uk' && tariffTarget.length > 0){
				// tariffOption uk  ,  CTA     
				
				tariffTarget.attr('data-modelcode',taggingModelCodeList);
				tariffTarget.attr('data-modeldisplay',taggingModelDisplayList);
				tariffTarget.attr('data-modelname',taggingModelNameList);
				tariffTarget.attr('data-modelrevenue',taggingModelRevenueList);
				tariffTarget.attr('data-modelprice',taggingModelRevenueList);
				tariffTarget.attr('data-pvitype',taggingModelPviTypeName);
				tariffTarget.attr('data-pvisubtype',taggingModelPviSubtypeName);
				tariffTarget.attr('data-pimsubtype',taggingModelCategorySubTypeEngName);
				tariffTarget.attr('data-discountprice',taggingModelDiscountpriceList);
				tariffTarget.attr('data-modelqty',taggingQty);
				
				if( !sharedObj.util.hasTariffOptionResult( sharedObj, selectorObj ) ){
					tariffTarget.attr('data-modelrevenue', tariffTarget.attr('data-modelrevenue') +',0');
					tariffTarget.attr('data-modelprice', tariffTarget.attr('data-modelprice')  +',0');
					tariffTarget.attr('data-discountprice', tariffTarget.attr('data-discountprice')  +',0');
					tariffTarget.attr('data-pvitype', tariffTarget.attr('data-pvitype')  +',shop program');
					tariffTarget.attr('data-pvisubtype', tariffTarget.attr('data-pvisubtype')  +',tariff');
					tariffTarget.attr('data-pimsubtype', tariffTarget.attr('data-pimsubtype')  +',tariff');
					tariffTarget.attr('data-modelqty', tariffTarget.attr('data-modelqty')  +',0');
				} 
			}
			
			if( $naviCta && $naviCta.length > 0 ){
				
				let anTr = '';
				let anCa = '';
				let anAc = '';
				let anLa = '';
				let ariaLabel = '';
				let multiData = false;
				
				const className = $naviCta.attr('class') ? $naviCta.attr('class') : '';
				
				 if( className.indexOf('configuratorUse-y') > -1 ) {
					if( sharedObj.ctaEngText !== '' && sharedObj.ctaEngText !== null ) {
						anTr = 'pdd01_anchor nav-'+ pageTrack+'-cta-buy page';
						anCa = 'buy cta';
						anAc = sharedObj.ctaEngText;
						anLa = sharedObj.ctaEngText;
					}
				} else if( className.indexOf('tg-continue') > -1 ){
					anTr = 'pdd01_anchor nav-'+ pageTrack+'-cta-cart';
					anCa = 'ecommerce';
					anAc = 'addToCart';
					anLa = 'secondary navi:add to cart';
					
					multiData = true;
					
				} else if( className.indexOf('tg-wtb') > -1 ) {
					anTr = 'pdd01_anchor nav-'+ pageTrack+'-cta-where to buy';
					anCa = 'buy cta';
					anAc = 'where to buy';
					anLa = 'where to buy';
				} else if( className.indexOf('tg-add-to-cart') > -1 || className.indexOf('tg-checkout') > -1 ) {
					anTr = 'pdd01_anchor nav-'+ pageTrack+'-cta-cart page';
					anCa = 'ecommerce';
					anAc = 'addToCart';
					ariaLabel = Granite.I18n.get("Add to cart")+':'+sharedObj.displayName;
					if( className.indexOf('tg-add-to-cart') > -1 ){
						if(sharedObj.siteCode === 'br'){
							anCa = 'buy cta';
							anAc = 'buy now';
							anLa = 'buy now';
						}else{
							anLa = 'secondary navi:add to cart';
						}						
					} else if( className.indexOf('tg-checkout') > -1 ){
						anLa = 'secondary navi:checkout';
						if( className.indexOf('tg-between') > -1 ){
							anLa = 'secondary navi:lease';
						}
					}
					
					multiData = true;
					
				} else if( className.indexOf('tg-pre-order') > -1 ) {
					anTr = 'pdd01_anchor nav-'+ pageTrack+'-cta-cart page';
					anCa = 'ecommerce';
					anAc = 'addToCart';
					anLa = 'secondary navi:pre order';
					
					multiData = true;
					
				} else if( className.indexOf('tg-out-stock') > -1 ) {
					anTr = 'pdd01_anchor nav-'+ pageTrack+'-cta-stock alert';
					anCa = 'buy cta';
					anAc = 'stock alert';
					anLa = 'stock alert';
					$naviCta.attr('data-antr','pdd01_anchor nav-'+ pageTrack+'-cta-stock alert popup');
					
				} else if( className.indexOf('tg-subscription') > -1 ) {
					
					const tariffEngName = selectorObj.buyingToolOptTariffPlan.find('.option-input.this-checked').attr("data-eng-name") ? selectorObj.buyingToolOptTariffPlan.find('.option-input.this-checked').attr("data-eng-name").toLowerCase() :'';
					
					anTr = 'pdd01_anchor nav-'+ pageTrack+'-cta-subscription';
					anCa = 'buy cta';
					anAc = 'buy with subscription:carrier:'+tariffEngName;
					anLa = 'buy with subscription:carrier:'+tariffEngName;
					
				} else if( className.indexOf('tg-buy-now') > -1 ) {
					
					anTr = 'pdd01_anchor nav-'+ pageTrack+'-cta-buy page';
					anCa = 'buy cta';
					anAc = 'buy now';
					anLa = 'buy now';
					
				} else if( className.indexOf('tg-learn-more') > -1 ) {
					anTr = 'pdd01_anchor nav-'+ pageTrack+'-cta-learn more';
					anCa = 'product click';
					anAc = 'pd buying tool';
					anLa = 'learn more click';
					
				}
				
				$naviCta.attr('an-tr',anTr).attr('an-ca',anCa).attr('an-ac',anAc).attr('an-la',anLa);
				
				if(ariaLabel){
					$naviCta.attr('aria-label',ariaLabel);
				}
				
				if( taggingModelDiscountpriceList ){
					$naviCta.attr('data-discountprice',taggingModelDiscountpriceList);
				}

				if( multiData ){
					if( taggingModelCodeList ){
						$naviCta.attr('data-modelcode',taggingModelCodeList);
					}
					if( taggingModelDisplayList ){
						$naviCta.attr('data-modeldisplay',taggingModelDisplayList);
					}
					if( taggingModelNameList ){
						$naviCta.attr('data-modelname',taggingModelNameList);
					}
					if( taggingModelRevenueList ){
						$naviCta.attr('data-modelrevenue',taggingModelRevenueList);
					}
					if( taggingModelRevenueList ){
						$naviCta.attr('data-modelprice',taggingModelRevenueList);
					}
					
					if( taggingModelPviTypeName ){
						$naviCta.attr('data-pvitype',taggingModelPviTypeName);
					}
					
					if( taggingModelPviSubtypeName ){
						$naviCta.attr('data-pvisubtype',taggingModelPviSubtypeName);
					}
					
					if( taggingModelCategorySubTypeEngName ){
						$naviCta.attr('data-pimsubtype',taggingModelCategorySubTypeEngName);
					}
					
					if( taggingQty ){
						$naviCta.attr('data-modelqty',taggingQty);
					}
				}
				
			}
			
			if( $priceBarCta && $priceBarCta.length > 0 ){
				
				for( var ctaIndex = 0; ctaIndex < $priceBarCta.length; ctaIndex++ ){
					const $targetData = $($priceBarCta.get(ctaIndex));
					const className = $targetData.attr('class') ? $targetData.attr('class') : '';
					
					let anTr = '';
					let anCa = '';
					let anAc = '';
					let anLa = '';
					let ariaLabel = '';
					
					let multiData = false;
					
					if( className.indexOf('tg-continue') > -1 ){
						anTr = 'header(pim)_price bar-'+ pageTrack+'-button-text';
						anCa = 'ecommerce';
						anAc = 'addToCart';
						anLa = 'pd buying tool:add to cart';

						multiData = true;
					} else if( className.indexOf('tg-wtb') > -1 ) {
						anTr = 'header(pim)_price bar-'+ pageTrack+'-button-where to buy';
						anCa = 'buy cta';
						anAc = 'where to buy';
						anLa = 'pd buying tool:where to buy';
					} else if( className.indexOf('tg-add-to-cart') > -1 || className.indexOf('tg-checkout') > -1 ) {
						anTr = 'header(pim)_price bar-'+ pageTrack+'-button-cart';
						anCa = 'ecommerce';
						anAc = 'addToCart';
						ariaLabel = Granite.I18n.get("Add to cart")+':'+sharedObj.displayName;
						if( className.indexOf('tg-add-to-cart') > -1 ){
							if(sharedObj.siteCode === 'br'){
								anCa = 'buy cta';
								anAc = 'buy now';
								anLa = 'buy now';
							}else{
								anLa = 'pd buying tool:add to cart';
							}						
						} else if( className.indexOf('tg-checkout') > -1 ){
							anLa = 'buying tool:checkout';
							if( className.indexOf('tg-between') > -1 ){
								anLa = 'buying tool:lease';
							}
						}
						
						multiData = true;
					} else if( className.indexOf('tg-pre-order') > -1 ) {
						anTr = 'header(pim)_price bar-'+ pageTrack+'-buy-cart';
						anCa = 'ecommerce';
						anAc = 'addToCart';
						anLa = 'pd buying tool:pre order';
						
						multiData = true;
					} else if( className.indexOf('tg-out-stock') > -1 ) {
						anTr = 'header(pim)_price bar-'+ pageTrack+'-button-alert';
						anCa = 'buy cta';
						anAc = 'stock alert';
						anLa = 'pd buying tool:stock alert';
						$targetData.attr('data-antr','header(pim)_price bar-'+ pageTrack+'-text-alert');
						
					} else if( className.indexOf('tg-subscription') > -1 ) {
						
						const tariffEngName = selectorObj.buyingToolOptTariffPlan.find('.option-input.this-checked').attr("data-eng-name") ? selectorObj.buyingToolOptTariffPlan.find('.option-input.this-checked').attr("data-eng-name").toLowerCase() :'';
						
						anTr = 'header(pim)_price bar-'+ pageTrack+'-button-subscription';
						anCa = 'buy cta';
						anAc = 'buy with subscription:carrier:'+tariffEngName;
						anLa = 'pd buying tool:'+tariffEngName;
					} else if( className.indexOf('tg-buy-now') > -1 ) {
						
						anTr = 'header(pim)_price bar-'+ pageTrack+'-buy-cart';
						anCa = 'ecommerce';
						anAc = 'addToCart';
						anLa = 'pd buying tool:buy now';
						
						multiData = true;
					} else if( className.indexOf('tg-learn-more') > -1 ) {
						anTr = 'header(pim)_price bar-'+ pageTrack+'-cta-learn more';
						anCa = 'product click';
						anAc = 'pd buying tool';
						anLa = 'learn more click';
					} else if ( className.indexOf('tg-for-business') > -1  ){
						anTr = 'header(pim)_price bar-'+ pageTrack+'-cta-forbusiness';
						anCa = 'buy cta';
						anAc = 'for business';
						anLa = 'pd buying tool:for business';
					} else if ( className.indexOf('tg-bespoke') > -1  ){
						anTr = 'header(pim)_price bar-'+ pageTrack+'-cta-bespoke';
						anCa = 'content click';
						anAc = 'feature';
						anLa = 'pd buying tool:customize yours';
					}
					$targetData.attr('an-tr',anTr).attr('an-ca',anCa).attr('an-ac',anAc).attr('an-la',anLa);
					
					if(ariaLabel){
						$targetData.attr('aria-label',ariaLabel);
					}
					
					if( taggingModelDiscountpriceList ){
						$targetData.attr('data-discountprice',taggingModelDiscountpriceList);
					}
					
					if( multiData ){
						if( taggingModelCodeList ){
							$targetData.attr('data-modelcode',taggingModelCodeList);
						}
						if( taggingModelDisplayList ){
							$targetData.attr('data-modeldisplay',taggingModelDisplayList);
						}
						if( taggingModelNameList ){
							$targetData.attr('data-modelname',taggingModelNameList);
						}
						if( taggingModelRevenueList ){
							$targetData.attr('data-modelrevenue',taggingModelRevenueList);
						}
						if( taggingModelRevenueList ){
							$targetData.attr('data-modelprice',taggingModelRevenueList);
						}
						
						if( taggingModelPviTypeName ){
							$targetData.attr('data-pvitype',taggingModelPviTypeName);
						}
						
						if( taggingModelPviSubtypeName ){
							$targetData.attr('data-pvisubtype',taggingModelPviSubtypeName);
						}
						
						if( taggingModelCategorySubTypeEngName ){
							$targetData.attr('data-pimsubtype',taggingModelCategorySubTypeEngName);
						}
						
						if( taggingQty ){
							$targetData.attr('data-modelqty',taggingQty);
						}
					}
				}
			}
			const beforeBadge = $('.pd-g-header-navigation .pd-buying-price .pd-buying-price__badge.mobile');
			if( beforeBadge ){
				beforeBadge.insertAfter('.pd-g-header-navigation .pd-header-navigation__header');
			}
			if( $('.pd-g-header-navigation .pd-buying-price__badge.mobile').length > 1 ){
				$('.pd-g-header-navigation .pd-buying-price__badge.mobile').eq(1).remove();
			}
		}
		
		settingBezelOptionDraw( sharedObj, selectorObj ){
			const siteCode = sharedObj.siteCode;
			const useBezelOptionDraw = sharedObj.useBezelOptionDraw; //shop api     true
			
			if(useBezelOptionDraw && (sharedObj.categoryTypeCode.startsWith('04') || sharedObj.categoryTypeCode.startsWith('07'))){
				const drawObj = sharedObj.drawObj;
				const view = sharedObj.view;
				
				drawObj.bezelOption = {
						'hasComponent' : sharedObj.noneTypeList.length > 0 || sharedObj.modernTypeList.length > 0 || sharedObj.beveledTypeList.length > 0 || sharedObj.freestyleList.length > 0,
						'sellingWithBazel': sharedObj.sellingWithBazel,
						'noneSellingWithBazel': !sharedObj.sellingWithBazel,
						'bezelImageClass': sharedObj.bezelImageClass,
						'title' : null,
						'description' : null,
						'noneType' : sharedObj.noneTypeList.length > 0 && sharedObj.modernTypeList.length == 0 && sharedObj.beveledTypeList.length == 0,
						'modernType' : sharedObj.modernTypeList.length > 0,
						'beveledType' : sharedObj.beveledTypeList.length > 0,
						'bezel' : sharedObj.noneTypeList.length > 0 || sharedObj.modernTypeList.length > 0 || sharedObj.beveledTypeList.length > 0,
						'freestyle' : sharedObj.freestyleList.length > 0,
						'noneTypeList' : sharedObj.noneTypeList,
						'modernTypeList': sharedObj.modernTypeList,
						'beveledTypeList': sharedObj.beveledTypeList,
						'freestyleList': sharedObj.freestyleList
					}
				
				view.bezelOptionDraw( drawObj );
				this.settingBezelInfo( sharedObj, selectorObj );
			}
		}
		
		/**
		 * Trade In  
		 */
		settingTradeInDraw( data, sharedObj, selectorObj, tradeInFlag ){
			const util  = sharedObj.util;
			const tradeInUrl = sharedObj.tradeInUrl;
			const siteCode = sharedObj.siteCode;
			const tradeinText = sharedObj.tradeinText;
			const drawObj = sharedObj.drawObj;
			const apiFlag = sharedObj.apiFlag;
			const view = sharedObj.view;
			const priceCurrency = sharedObj.priceCurrency;
			const isGPv2AndHyIntg = sharedObj.isGPv2AndHyIntg;
			const isHybrisSplitPD = sharedObj.isHybrisSplitPD; 
			const isHybrisSplitPDTradeIn = sharedObj.isHybrisSplitPDTradeIn;
			const stockLevelStatus = sharedObj.stockLevelStatus;
			const tradeInType = sharedObj.tradeInType; //trade_in_type
			const promotionSalesPitch = sharedObj.promotionSalesPitch; //sales_pitch
			const isVDSTEPBUYING = $("#categorySubTypeCode").val().length > 2 && $("#categorySubTypeCode").val().substring(0,2) === "04" ? true : false;
			
			let isDirectLink = false;  // my, ae, ae_ar  
			let directLinkUrl = '';
			let isPopup = false;
			let maxDiscount = 0;
			// API  data.maxDiscount    
			if(data){
				if(data.maxDiscount !== undefined) {
					maxDiscount = data.maxDiscount;
				}
				
				// my, ae, ae_ar     URL   
				if(data.directOutLink === true) {
					isDirectLink = true;
					isPopup = false;
				} else {
					isPopup = true;
				}
			}
			
			// URL       ? 
			/**
			if( stockLevelStatus == 'INSTOCK' || stockLevelStatus == 'LOWSTOCK' ){
				if(isDirectLink) {
					isDirectLink = true;
				} 
			} else {
				isDirectLink = false;
			}
			**/
			
			let title = '';
			let hasCeTradein = false;
			let hasExchange = true; // result    (hasCeTradein )
			let description = '';
			let learnMoreTarget = '_self';
			let learnMoreText = '';
			let learnMoreHref = 'javascript:;';
			let learnMoreCta = {};
			let learnMoreClass = '';
			let customsObj = {};
			let yesAttr = {};
			let noAttr = {};
			let subTextYes = '';
			let subTextNo = '';

			// fr, in max     max value .
			if( siteCode === 'in' || siteCode === 'fr' ){
				maxDiscount = sharedObj.tradeinSaveValue;
			}

			if( tradeInFlag && (isGPv2AndHyIntg || (isHybrisSplitPD && isHybrisSplitPDTradeIn))){
				//  
				description = tradeinText;
				
				// CRHQ-3830 [B2C] SEIB(PT) split pd  , CRHQ-4179
				if(siteCode === 'pt' || siteCode === 'es' || siteCode === 'th') {
					maxDiscount = 0;
				}
				if( maxDiscount && maxDiscount > 0 ){
                    var disCountPrice;
                  // new-hybris
                    if(siteCode == "be" || siteCode =="be_fr" || siteCode =="nl"){
						disCountPrice = currencyCommaExcep(maxDiscount, priceCurrency)
                    }else if(siteCode == "jp"){
						disCountPrice = currencyComma(parseFloat(maxDiscount), priceCurrency)
					}else{
						disCountPrice = currencyComma(maxDiscount, priceCurrency)
                    }
					subTextYes = Granite.I18n.get("Save up to") + ' ' +  disCountPrice;
					if( siteCode === 'co' ){
						subTextYes = Granite.I18n.get("Save up to") + '<br/>' + disCountPrice;
					}
					subTextNo = null;
					title = Granite.I18n.get("Want up to {0} off? Try trading in your current phone!", currencyComma(maxDiscount, priceCurrency) );
					//[24.01.12]epp only co tradein title 
					if( siteCode === 'co' && $('#isEppPage').val() === 'true' ){
						title = "Selecciona plan recambio y obtn un 10% de descuento inmediato";
					}					
				} else {
					title = Granite.I18n.get("TRADE-IN");
				}
				
				
				if( tradeInUrl ){
					learnMoreTarget = '_blank';
					learnMoreHref = tradeInUrl;
					learnMoreText = Granite.I18n.get("Learn more");
				}
				
				yesAttr = {
					'text': Granite.I18n.get('YES'),
					'eventType' : 'tradein',
					'layerTarget' : 'tradeInPopup',
					'subText' : subTextYes,
					'isDirectLink':isDirectLink,
					'isPopup' : isPopup
				}
				noAttr = {
					'text': Granite.I18n.get('NO'),
					'layerTarget' : 'deleteTradeInPopUp',
					'subText' : subTextNo,
					'eventType' : 'tradein'
				}
				
				//  
				//  
				if (data.withCeTradeUpPopup) { // for CE(VD/DA) Trade-up popup
					maxDiscount = data.maxDiscount || 0; // VD/DA   maxDiscount   
					let maxDiscountText = currencyComma(maxDiscount, priceCurrency);
					let ctI18nHint = "b2c_" + sharedObj.ceTradeUpPopup.productCategoryGroup;
					title = Granite.I18n.get("Want up to \"{0}\" off? Recycle your old device for an instant discount", [maxDiscountText], ctI18nHint);
					description = "";
					if (CeTradeUpPopup.config.view.useServiceDescription) {
						description = Granite.I18n.getVar("Trade-up service description", ctI18nHint);
					}
					yesAttr.subText = "";
					if (CeTradeUpPopup.config.view.showDiscountAmount.inYesCta) {
						yesAttr.subText = Granite.I18n.get("(Save up to \"{0}\")", [maxDiscountText], ctI18nHint);
					}
					yesAttr.text = Granite.I18n.getVar("Yes", ctI18nHint);
					noAttr.text = Granite.I18n.getVar("No", ctI18nHint);
					if (data.learnMoreOutlink) {
						learnMoreHref = data.learnMoreOutlink;
						learnMoreTarget = "_blank";
					} else {
						learnMoreHref = "javascript:;"; // to be specified by click event on CeTradeUpPopup
						learnMoreTarget = "_self";
					}
					learnMoreText = Granite.I18n.get("Learn more");
				}
				else if ( apiFlag.indexOf('GPv2') > -1 ){
					if(siteCode === "in" && tradeInType !== "CE"){ // tradeInType CE  
						title= Granite.I18n.get("Exchange your device");
						if(promotionSalesPitch){
							description = `Exchange any product and get benefits up to ${currencyComma(promotionSalesPitch, priceCurrency)}*`;
							subTextYes = Granite.I18n.get("Save up to") + ' ' +  currencyComma(promotionSalesPitch, priceCurrency);
						}
						yesAttr = {
							'class' : "trade-in-exchange",
							'eventType' : 'exchange',
							'text': Granite.I18n.get('YES'),
							'subText' : subTextYes,
							'layerTarget' : 'instantExchangePopupHubble',
							'isDirectLink':isDirectLink,
							'isPopup' : true
						}
						noAttr = {
							'text': Granite.I18n.get('NO'),
							'layerTarget' : 'deleteTradeInPopUp',
							'eventType' : 'exchange'
						}
						
						learnMoreTarget = '';
						learnMoreHref = '';
						learnMoreText = '';
						
					}else if(siteCode === "in" && tradeInType === "CE"){	//tradeInType CE   
						title = 'Exchange';
						description = '';
						if(promotionSalesPitch){
							description = `Exchange any product and get benefits up to ${currencyComma(promotionSalesPitch, priceCurrency)}*`;
							subTextYes = Granite.I18n.get("Save up to") + ' ' +  currencyComma(promotionSalesPitch, priceCurrency);
						}
						
						yesAttr = {
							'class' : "trade-in-exchange",
							'eventType' : 'exchange',
							'text': Granite.I18n.get('YES'),
							'subText' : subTextYes,
							'layerTarget' : 'sielTradeInPopup',
							'isDirectLink':isDirectLink,
							'isPopup' : true
						}
						noAttr = {
							'text': Granite.I18n.get('NO'),
							'layerTarget' : 'deleteTradeInPopUp',
							'eventType' : 'exchange'
						}
						
						learnMoreTarget = '';
						learnMoreHref = '';
						learnMoreText = '';
						
						hasCeTradein = true;
						hasExchange = false;
						
					}else if(siteCode === "id"){
						// new-hybris
						description = Granite.I18n.get("Download the Exchange Add application to do an HP test. If you pass the test, the HP IMEI will be recorded in our data and consumers can enjoy a special price exchange.");
						
						learnMoreTarget = '';
						learnMoreHref = '';
						learnMoreText = '';
						
					} else if(siteCode === "ae" || siteCode === "ae_ar"){
						
						learnMoreHref = 'javascript:;';
						learnMoreText = Granite.I18n.get("Learn more");
						customsObj.layerTarget = 'tradeInLearnMorePopup';
							
						description = Granite.I18n.get("Go to samsungtradein.ae, evaluate the old device and receive the Trade in code.");
					}
					
				} else {
					if( isHybrisSplitPDTradeIn ){
						if( Granite.I18n.get("SplitPD TradeIn Description") !== "SplitPD TradeIn Description" ){
							description = Granite.I18n.get("SplitPD TradeIn Description");
						}
					}
					if( siteCode === 'ru' || siteCode === 'za'){
						learnMoreHref = 'javascript:;';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_self';
						customsObj.layerTarget = 'tradeInLearnMorePopup';
						if( siteCode === 'za' ){
							yesAttr.text = Granite.I18n.get('Yes, please');
							noAttr.text = Granite.I18n.get('No, thanks');
						}
					} else if( siteCode === 'nz' ){
						learnMoreHref = 'https://www.samsung.com/nz/galaxytradein';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
						description = Granite.I18n.get("Only devices with a quoted trade-in price that is less than the price of the device that you intend to buy are available for instant trade-in");
					} else if( siteCode === 'se' || siteCode === 'dk' || siteCode === 'fi' || siteCode === 'no' ){
						//[COMP6FE-1484] se tradeIn 
						learnMoreHref = 'javascript:;';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_self';
						customsObj.layerTarget = 'tradeInLearnMorePopup';
						yesAttr.text = Granite.I18n.get('Yes please');
						noAttr.text = Granite.I18n.get('No thanks');
					} else if( siteCode === 'es' || siteCode === 'pt' ){
						learnMoreHref = 'javascript:;';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_self';
						customsObj.layerTarget = 'tradeInLearnMorePopup';
						yesAttr.text = Granite.I18n.get('Yes, please');
						noAttr.text = Granite.I18n.get('No, thanks');
						if( $('#categoryGroupCode').val() === '04000000' ){
							if( siteCode === 'es' ){
								learnMoreText = Granite.I18n.get("Learn more(TV)");
							}
							title = Granite.I18n.get("TRADE-IN(TV)");
							description = Granite.I18n.get("SplitPD TradeIn Description(TV)");
							yesAttr.text = Granite.I18n.get('YES');
							noAttr.text = Granite.I18n.get('NO');
							
							// learn more popup
							if( siteCode === 'es' ){
								$('.trade-in-learn-more-popup .trade-in-learn-more-popup__title').html(Granite.I18n.get('How trade-in works(TV)'));
							}
							const itemList  = [
								{title : Granite.I18n.get('Trade-In Learn More popup title_1(TV)'), desc : Granite.I18n.get('Trade-In Learn More popup desc_1(TV)')},
								{title : Granite.I18n.get('Trade-In Learn More popup title_2(TV)'), desc : Granite.I18n.get('Trade-In Learn More popup desc_2(TV)')},
								{title : Granite.I18n.get('Trade-In Learn More popup title_3(TV)'), desc : Granite.I18n.get('Trade-In Learn More popup desc_3(TV)')},
								{title : Granite.I18n.get('Trade-In Learn More popup title_4(TV)') === 'Trade-In Learn More popup title_4(TV)' ? '' : Granite.I18n.get('Trade-In Learn More popup title_4(TV)'), 
								  desc : Granite.I18n.get('Trade-In Learn More popup desc_4(TV)') === 'Trade-In Learn More popup desc_4(TV)' ? '' : Granite.I18n.get('Trade-In Learn More popup desc_4(TV)')}
							];
							itemList.forEach(function(elem, idx){
								if( elem.title && elem.desc ){
									$('.trade-in-learn-more-popup .trade-in-learn-more-popup__list .trade-in-learn-more-popup__list-item-text-title').eq(idx).html(elem.title);
									$('.trade-in-learn-more-popup .trade-in-learn-more-popup__list .trade-in-learn-more-popup__list-item-text-desc').eq(idx).html(elem.desc);
								}
							});
							$('.trade-in-learn-more-popup .trade-in-learn-more-popup__disclaimer').html(Granite.I18n.get('Trade-In disclaimer(TV)'));
						}
					} else if( siteCode === 'sg' ){
						// COMP6FE-1502 sg tradeIn 
						learnMoreHref = 'https://www.samsung.com/sg/tradeup/';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
						title= Granite.I18n.get("Samsung Trade-in"); 
						description = Granite.I18n.get("Get more discount on your new Galaxy when you trade-in.");
						yesAttr.text = Granite.I18n.get('Yes please');
						noAttr.text = Granite.I18n.get('No thanks');
					} else if( siteCode === 'it' ){
						learnMoreHref = 'https://www.samsung.com/it/offer/mobile-trade-in/';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
					} else if( siteCode === 'pt' ){
						learnMoreHref = 'https://www.samsung.com/pt/campanha-retomas/';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
					}  else if( siteCode === 'ca' || siteCode === 'ca_fr' ){
						learnMoreHref = `https://www.samsung.com/${siteCode}/trade-in-program/`;
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
					}  else if( siteCode === 'au' ){
						//[COMP6FE-1495] Au Multi TradeIn     
						title= Granite.I18n.get("Samsung Trade-in"); 
						description = Granite.I18n.get("Try trading in your current phone and get an instant discount on your new Galaxy.");
						yesAttr.text = Granite.I18n.get('Yes please');
						noAttr.text = Granite.I18n.get('No thanks');

						learnMoreHref = 'https://www.samsung.com/au/tradeup/';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
					}   else if( siteCode === 'my' ){
						if( $('#isEppPage').val() === 'true' ){
							learnMoreHref = '/my/multistore/' + $('#eppCompanyCode').val() + '/offers_epp/epp-trade-in/';
						} else {
							learnMoreHref = 'https://shop.samsung.com/my/trade-in/';
						}
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
					} else if( siteCode === 'ae' ||  siteCode === 'ae_ar' ){
						//COMP6FE-1498 SGE AE, AE_AR TradeIn   
						title= Granite.I18n.get("Samsung Trade-in"); 
						description = Granite.I18n.get("Try trading in your current phone and get an instant discount on your new Galaxy.");
						yesAttr.text = Granite.I18n.get('Yes please');
						noAttr.text = Granite.I18n.get('No thanks');
						
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';

                        // CRHQ-8616 [B2C][MX][AE] Trade-in     
						let learnMoreLastUrl = "";

                        // CRHQ-8889 [B2C][MX][AE] SGE Trade-in  
						if ( '04010000' === sharedObj.categoryTypeCode ) {
                            learnMoreLastUrl = "tv-trade-in/";
                            title = Granite.I18n.get("Trade-in your old device and get guaranteed cashback");
						} else {
						    learnMoreLastUrl = "mobile-trade-in/";

						    if ( '01000000' === $('#categoryGroupCode').val() ) {
						        title = Granite.I18n.get("Trade-in up to 3 old devices and get cashback");
						    }
						}

						if(siteCode === 'ae'){
							learnMoreHref = 'https://www.samsung.com/ae/offer/' + learnMoreLastUrl;
						} else if(siteCode === 'ae_ar'){
							learnMoreHref = 'https://www.samsung.com/ae_ar/offer/' + learnMoreLastUrl;
						}
						
						if(isDirectLink) {
							directLinkUrl = 'https://samsungtradein.ae/';
							yesAttr = {
								'class' : "noname",
								'eventType' : 'directLink',
								'text': Granite.I18n.get('Yes please'),
								'subText' : subTextYes,
								'layerTarget' : 'none',
								'isDirectLink':isDirectLink,
								'href' : directLinkUrl,
								'isPopup' : false
							}
							noAttr = {
								'text': Granite.I18n.get('No thanks'),
								'layerTarget' : 'none',
								'eventType' : 'tradein'
							}
							
							learnMoreTarget = '';
							learnMoreHref = '';
							learnMoreText = ''
						}

					} else if(siteCode === 'ch' || siteCode === 'ch_fr'){
					/*
						learnMoreHref = `https://www.samsung.com/${siteCode}/trade-in/`;
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
						title= Granite.I18n.get("Samsung Trade-in");
						description = Granite.I18n.get("Try trading in your current phone and get an instant discount on your new Galaxy.");
					*/
					    // CRHQ-6788 [B2C][BC][IM] Trade-in CX improvement - SEAS
					    learnMoreHref = 'javascript:;';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_self';
						customsObj.layerTarget = 'tradeInLearnMorePopup';
						title= Granite.I18n.get("Samsung Trade-in");
						description = Granite.I18n.get("Try trading in your current phone and get an instant discount on your new Galaxy.");
					} else if( siteCode === 'hu' ){
						//COMP6FE-1485 HU(SEH) Trade In 
						yesAttr.text = Granite.I18n.get('Yes please');
						noAttr.text = Granite.I18n.get('No thanks');
						title= Granite.I18n.get("Samsung Trade-in");
						description = Granite.I18n.get("Try trading in your current phone and get an instant discount on your new Galaxy.");
					} else if(siteCode === 'vn'){
						//[COMP6FE-1482] Vn TradeIn 
						yesAttr.text = Granite.I18n.get('Yes please');
						noAttr.text = Granite.I18n.get('No thanks');
						learnMoreHref = 'https://www.samsung.com/vn/offer/len-doi-sieu-pham/';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
						title= Granite.I18n.get("Samsung Trade-in");
						description = Granite.I18n.get("Try trading in your current phone and get an instant discount on your new Galaxy.");
					} else if( siteCode === 'nl' || siteCode === 'be' || siteCode === 'be_fr' ){
						//[COMP6FE-1499] SEBN instant discount  Trade-In  
						yesAttr.text = Granite.I18n.get('Yes please');
						noAttr.text = Granite.I18n.get('No thanks');
						title= Granite.I18n.get("Samsung Trade-in");
						description = Granite.I18n.get("Get more discount on your new Galaxy when you trade-in.");
					} else if( siteCode === 'hk' || siteCode === 'hk_en' ){
						//[COMP6FE-1504] HK, HK_EN TradeIn  
						yesAttr.text = Granite.I18n.get('Yes please');
						noAttr.text = Granite.I18n.get('No thanks');
						title= Granite.I18n.get("Samsung Trade-in");
						learnMoreHref = 'javascript:;';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_self';
						customsObj.layerTarget = 'tradeInLearnMorePopup';
					} else if( siteCode === 'at' ){
						if($('#categoryGroupCode').val() === '04000000'){
							title= Granite.I18n.get("Trade-Up");
							learnMoreHref = 'https://www.samsung.com/at/tvs/trade-up/';
						}else if($('#categoryGroupCode').val() === '01000000'){
							learnMoreHref = 'javascript:;';
							learnMoreTarget = '_self';
							customsObj.layerTarget = 'tradeInLearnMorePopup';
						}else if($('#categoryGroupCode').val() === '08000000'){
							title= Granite.I18n.get("Trade-Up");
							learnMoreHref = 'https://www.samsung.com/at/offer/trade-up-bonus/';
						}
					} else if( siteCode === 'fr' ){
						if( $('#isEppPage').val() === 'true' ){
							description = `Bnficiez d'une remise immdiate pour la reprise d'un smartphone ou d'une tablette`;
						} else {
                            // CRHQ-6975 [B2C][BC][Spoke] FR Trade in  installment 
                            // CRHQ-7191 [B2C][BC][IM] FR trade in  
							description = `Bnficiez dune remise immdiate pour la reprise danciens appareils`;
						}
						
					} else if( siteCode === 'uk' && tradeInType === 'CE' ){
						yesAttr.layerTarget = 'sielTradeInPopup';
						learnMoreHref = 'https://www.samsung.com/uk/tvs/trade-up/';
						if( isVDSTEPBUYING || sharedObj.categoryTypeCode === '08030000' || sharedObj.categoryTypeCode === '08010000' || sharedObj.categoryTypeCode === '08070000' || sharedObj.categoryTypeCode === '07010000' ){
							learnMoreHref = 'https://www.samsung.com/uk/tv-and-home-appliances-trade-up/';
						}
						if( sharedObj.ceHeadlineText ){
							title = sharedObj.ceHeadlineText;
							yesAttr.subText = sharedObj.ceSubText;
						}
					} else if( siteCode === 'cl' ){
						yesAttr.text = Granite.I18n.get('YES') + ' (Solo clientes de Regin Metropolitana)';
						description = Granite.I18n.get("Trade in actualmente es solo para Regin Metropolitana.");
					} else if(siteCode === 'pe'){
						learnMoreHref = 'https://www.samsung.com/pe/plan-canje-galaxy/';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
					} else if(siteCode === 'de') {
					    //CRHQ-8100 [B2C][MX][DE] Trade-in    IMEI  
					    title = Granite.I18n.get("Trade-In");
					    description = Granite.I18n.get("Want up to {0} off? Try trading in your current phone!", currencyComma(maxDiscount, priceCurrency) );
					} else if(siteCode === 'pl') {
						learnMoreHref = 'https://www.samsung.com/pl/trade-in/';
					} else if( siteCode === 'ro') {
						title = Granite.I18n.get("TRADE-IN");
					    description = Granite.I18n.get("TRADE-IN description");
						yesAttr.text = Granite.I18n.get('Yes please');
						noAttr.text = Granite.I18n.get('No thanks');
						subTextYes = Granite.I18n.get("Save up to (Trade-in)") + ' ' +  disCountPrice;
						learnMoreText = Granite.I18n.get("Learn More (Trade-in)");
						learnMoreHref = 'https://www.samsung.com/ro/trade-in/';
					} else if( siteCode === 'jp') {
						yesAttr.text = Granite.I18n.get('Yes please');
						noAttr.text = Granite.I18n.get('No thanks');
						title= Granite.I18n.get("Samsung Trade-in");
						description = Granite.I18n.get("TRADE-IN description");
						learnMoreText = Granite.I18n.get("Learn More (Trade-in)");
						learnMoreHref = 'https://www.samsung.com/jp/trade-in/';
					}
				}
				
				learnMoreCta= util.getAttrCta ( learnMoreText, learnMoreHref, learnMoreTarget, learnMoreClass, customsObj, '' );
				drawObj.tradeIn = {
					'hasComponent' : tradeInFlag, // 3  
					'hasCeTradein' : hasCeTradein,   //in CE trade in  true  
					'hasExchange' : hasExchange,
					'title' : title,
					'learnMoreCta' :  learnMoreCta,
					'description' : description,
					'yesAttr' : yesAttr,
					'noAttr' : noAttr
				}
				
				view.tradeInDraw( drawObj );
				util.totalAfterFunction( sharedObj, selectorObj );
			}
		}
		
		/**
		 * Gp, Hybris, Global  , Api  ,    1   
		 */
		gpHybrisGlobalEndPoint( sharedObj, selectorObj ){
			pageTaggingChange( sharedObj, selectorObj );
			this.settingCtaTagging ( sharedObj, selectorObj );
			this.specialTagging( sharedObj, selectorObj );
			
			//    
			if($(".pd-select-option__color-name").length > 0 ){
				var multiColorText = $(".pd-select-option__list--color-chip .option-input.checked").data("colorname");
				if(multiColorText != null && multiColorText != "" && typeof multiColorText != "undefined"){
					multiColorText = multiColorText.replace(/\&/g, ", ");
					$("#multiColorText").text(multiColorText);
				}
			}

			//packagePD EnerygyLabel, Repairability   reinit  
			window.onload = function(){
				if(document.querySelectorAll(".pd-header-navigation__combo-package-wrap").length > 0){
					window.sg.common.icon.redrawSvgs(document.querySelector(".pd-header-navigation__combo-package-wrap"));
				}
				if(document.querySelectorAll(".combo-package").length > 0){
					window.sg.common.icon.redrawSvgs(document.querySelector(".combo-package"));
				}
				if(siteCode === 'fr'){
					window.sg.common.image.initAll(); //RI  
				}
				window.sg.components.pdHeaderNavigation.reInit();
			}
		}
		
		/**
		 *   
		 */
		initGlobalVal ( sharedObj, selectorObj ){
			const drawObj = sharedObj.drawObj; 
				
			sharedObj.childCheckList = [];
			sharedObj.samsungCareList = [];
			sharedObj.samsungCareBadgeList = [];
			sharedObj.addOnInfoTemp = [];
			sharedObj.addOnInfo = [];
			sharedObj.bogoModelList = [];
			sharedObj.bogoSearchList = [];
			sharedObj.setComboPopupData = [];
			sharedObj.globalComboData = [];
			sharedObj.reCallSyndi = [];
			sharedObj.totalSkuList = {};
			sharedObj.eupData = {};
			sharedObj.addOnApiList = {};
			
			sharedObj.addonDate = '';
			sharedObj.pdUpgrade = '';
			
			drawObj.offer.offerList = [];
			drawObj.offer.combo = [];
			drawObj.offer.gift = [];
			drawObj.offer.promotionMessage = [];
			drawObj.offer.promotionFinance = [];
			drawObj.offer.promotionSmartclub = [];
			
			//CRHQ-8807 Offer Child
            drawObj.offer.childList = [];
			
			drawObj.usEppData.selectList = [];
            
            drawObj.tradeInResult.list = []; //[COMP6FE-1495] Au Multi TradeIn  
			
			sharedObj.comboFlag = false;
			sharedObj.tradeInFlag = false;
			sharedObj.upgradeEligible = false;
			sharedObj.upgradeFlag = false;
			sharedObj.bogoFlag = false;
			sharedObj.financingEligible = false;
			sharedObj.promotionFinancingFlag = false;
			sharedObj.emcPromotionIcon = false;
			sharedObj.addonsFlag = false;
			sharedObj.samsungCareFlag = false;
			sharedObj.warrantyFlag = false;
			sharedObj.checkingComboSearchFlag = false;
			sharedObj.checkingBogoSearchFlag = false;
			sharedObj.hasAddonApiData = false;
			
		}
		
		/**
		 *    
		 */
		setPriceProudctPriceInfo( sharedObj, selectorObj, inputObj ){
			const isGpv2 = sharedObj.isGpv2;
			const price = inputObj.price;
			const priceDisplay = inputObj.priceDisplay;
			const promotionPrice = inputObj.promotionPrice;
			const promotionPriceDisplay = inputObj.promotionPriceDisplay;
			const leasingInfo = inputObj.leasingInfo;
			const saveText = inputObj.saveText;
			const tradeInPriceText = inputObj.tradeInPriceText;
			const priceCurrency = sharedObj.priceCurrency;
			const siteCode = sharedObj.siteCode;
			
			if( price ){
				sharedObj.proudctPriceInfo.orignalPrice = price;
			}
			
			if( priceDisplay ){
				sharedObj.proudctPriceInfo.orignalPriceFormatted = priceDisplay;
			} else if( price ) {
				sharedObj.proudctPriceInfo.orignalPriceFormatted = currencyComma(price, priceCurrency);
			}
			
			if( promotionPrice ){
				sharedObj.proudctPriceInfo.salePrice = promotionPrice;
			} else {
				sharedObj.proudctPriceInfo.salePrice = price;
			}
			
			if( promotionPriceDisplay ){
				sharedObj.proudctPriceInfo.salePriceFormatted = promotionPriceDisplay;
			} else if( promotionPrice ) {
				sharedObj.proudctPriceInfo.salePriceFormatted = currencyComma( promotionPrice , priceCurrency);
			} else {
				sharedObj.proudctPriceInfo.salePriceFormatted = sharedObj.proudctPriceInfo.orignalPriceFormatted;
			}
			
			if( isGpv2 && leasingInfo && leasingInfo.monthlyRate ){
				sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice = leasingInfo.monthlyRate;
				sharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal = leasingInfo.tenureVal;
			}
			
			if( !isGpv2 && monthlyPriceInfo && monthlyPriceInfo.leasingMonthly ){
				sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice = monthlyPriceInfo.leasingMonthly;
				sharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal = monthlyPriceInfo.leasingMonths;
			}
			
			if( saveText ){
				sharedObj.proudctPriceInfo.rowCodeformattedPriceSave = saveText;
			}
			
			// tradeInPriceText      
			if( tradeInPriceText ){
				sharedObj.proudctPriceInfo.salePriceFormatted = tradeInPriceText;
			}
			// new-hybris
			if( siteCode === 'nl' || siteCode === 'be' || siteCode === 'be_fr' ){
				const listPriceFormatted = sharedObj.proudctPriceInfo.listPriceFormatted;
				const orignalPriceFormatted = sharedObj.proudctPriceInfo.orignalPriceFormatted;
				const salePriceFormatted = sharedObj.proudctPriceInfo.salePriceFormatted;
				const monthlyPriceFormatted = sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice;
				
				if( listPriceFormatted ){
					sharedObj.proudctPriceInfo.listPriceFormatted = deleteCurrency( listPriceFormatted, sharedObj.priceCurrency).trim();
				}
				if( orignalPriceFormatted ){
					sharedObj.proudctPriceInfo.orignalPriceFormatted = deleteCurrency( orignalPriceFormatted, sharedObj.priceCurrency).trim();				
				}
				if( salePriceFormatted ){
					sharedObj.proudctPriceInfo.salePriceFormatted = deleteCurrency( salePriceFormatted, sharedObj.priceCurrency).trim();
				}
				if( monthlyPriceFormatted ){
					sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice = deleteCurrency( monthlyPriceFormatted, sharedObj.priceCurrency).trim();
				}
			}
		}
		
		/**
		 * POPUP component async load CRHQ-6341 Trade-in CX improvement
		 */
		loadComponent(componentName){
			var asyncUrl = location.pathname;
			if (asyncUrl.indexOf(".html") != -1) {
				asyncUrl = asyncUrl.replace(".html","");
			}else{
				var lastChar = asyncUrl[asyncUrl.length - 1];
				if( lastChar == "/"){
					asyncUrl = asyncUrl.slice(0, -1);
				}
			}
			
			var sleep = function(ms) {
				const wakeUpTime = Date.now() + ms;
				while (Date.now() < wakeUpTime) {}
			}
			
			//epp   
			if($('#isEppPage').val() === 'true'){
				asyncUrl = window.sg.components.dynamic.detailSharedObj.detailNodePath.replace('.dynamic','');
			}
			
			var componentUrl =  asyncUrl+".async."+componentName+"/";
			if (location.pathname.indexOf(".html") > 0 ) { 
				componentUrl =  asyncUrl+".async."+componentName+".html";
			}	
			
			if( $("#hubble-"+componentName+"-layer").length <= 0 ){
				$.ajax({
					type : "GET",
					url : componentUrl,
					dataType: "html",
					async : false,
					success : function (data) {
						if(data.indexOf('<link') > -1 && data.indexOf('"text/css">') > -1){
							var cssstr=data.substring(data.indexOf('<link'),data.indexOf('"text/css">')+12);
							data=data.replace(cssstr,"");
							$("#wrap").append(cssstr);
						}
						sleep(100);
						$("#wrap").append(data);
					},
					error  : function(data){  
					},
					complete : function() {
					}
				});
			}
			if( componentName=="commontradein"){
				window.sg.common.textFieldv2.initAll();
			}
		}
		
		//CRHQ-8032 
		isCommonTradeinCheck(){
			const sharedObj = window.sg.components.dynamic ? window.sg.components.dynamic.detailSharedObj : null;
			const categoryGroupCode=$("#categoryGroupCode").val();
			const categoryTypeCode = $("#categoryTypeCode").val();
			//CRHQ-7403
			const categorySubTypeCode =$("#categorySubTypeCode").val();
			//CRHQ-7403
			let hasCommonTradeInCategory = false;
			if(categoryGroupCode=="01000000"){
				hasCommonTradeInCategory = true;
			}else if(categorySubTypeCode=="03010100" && siteCode === 'fr' ){
				hasCommonTradeInCategory = true;
			}else if( categoryTypeCode == '03010000' && $.inArray(siteCode,['se','no','dk','fi']) !== -1){
				hasCommonTradeInCategory = true;
			}else if( categoryTypeCode == '04010000' && $.inArray(siteCode,['ae','ae_ar']) !== -1){
				hasCommonTradeInCategory = true;
			} else if (siteCode == 'vn'){
				if(!categoryTypeCode.startsWith('0805')){
					hasCommonTradeInCategory = true;
				}
			} else if ($.inArray(siteCode, ['be', 'be_fr', 'nl']) !== -1){
				// CE_TRADE_UP      common Trade-In 
				if(sharedObj){
					if(!(sharedObj.ceTradeUpPopup && sharedObj.ceTradeUpPopup.isEnabled)){
						hasCommonTradeInCategory = true;
					}
				}
			}

			const tempTitle = $("#tempTitle").val();//page-standard-pd X
			const isCommonTradein = $("#isCommonTradein").val();
			let isCommonTradeinCheck =(isCommonTradein == "Y");
			let commonTradeinCheckYn=false;
			
			if(isCommonTradeinCheck && hasCommonTradeInCategory && (tempTitle=="page-buying-pd" || tempTitle=="page-standard-pd")){
				commonTradeinCheckYn=true;
			}
			return commonTradeinCheckYn;
		}

		validateQuantity(quantity, sharedObj, selectorObj, isFirst = false){
			const errorArea = selectorObj.buyingToolOptSMBQuantity.find('.smb-error-text');
			if( errorArea.length == 0 ){
				return;
			}
			let smbMinQty = 1;
			let smbMaxQty = 999;
			const ecomStoreType = $('#ecomStoreType').val();
			if( ecomStoreType ){
				// Min Max api .. static 
				if( ecomStoreType === 'ADS' ){
					smbMinQty = 1;
					smbMaxQty = 99;
				}
				if( ecomStoreType === 'SMB' ){
					smbMinQty = 5;
					smbMaxQty = 99;
				}
				
				if( ecomStoreType === 'D2K' ){
					smbMinQty = 1;
					smbMaxQty = 200;
				}
			}
			sharedObj.proudctPriceInfo.smbMinQty = smbMinQty;
			sharedObj.proudctPriceInfo.smbMaxQty = smbMaxQty;
			
			errorArea.hide();
			if( quantity ){
				if( quantity > sharedObj.proudctPriceInfo.netavailable ){
					errorArea.text(Granite.I18n.get('There is only {0} Stock available. (Final Stock available at check out)',[sharedObj.proudctPriceInfo.netavailable]));
					errorArea.show();
					quantity = sharedObj.proudctPriceInfo.netavailable;
					selectorObj.buyingToolOptSMBQuantity.find('#counterText').val(quantity);
				}
				
				if( quantity < sharedObj.proudctPriceInfo.smbMinQty || quantity > sharedObj.proudctPriceInfo.smbMaxQty ){
					if(!isFirst){
						errorArea.text(Granite.I18n.get('Please input range between {0} to {1}', [sharedObj.proudctPriceInfo.smbMinQty,sharedObj.proudctPriceInfo.smbMaxQty]));
						errorArea.show();
					}
					
					quantity = quantity < sharedObj.proudctPriceInfo.smbMinQty ? sharedObj.proudctPriceInfo.smbMinQty : sharedObj.proudctPriceInfo.smbMaxQty;
					selectorObj.buyingToolOptSMBQuantity.find('#counterText').val(quantity);
				}
				
				sharedObj.proudctPriceInfo.productCartCount = parseInt(quantity);
				sharedObj.util.settingPriceDraw( sharedObj, selectorObj );
			}
			
		}
	}

	//only hr(kn   ) -    
	function kunaToEuroPrice(saveText) {
		let tempDecimalPoint = Math.pow(10, 2);
		let euroPriceTemp = Number(saveText)*0.1327228084146261;
		euroPriceTemp = Math.round(euroPriceTemp * tempDecimalPoint) / tempDecimalPoint;
		return currencyComma(euroPriceTemp, "EUR");
	}
	
	//only hr (  kn)
	function euroToKunaPrice(saveText) {
		let tempDecimalPoint = Math.pow(10, 2);
		let euroPriceTemp = Number(saveText)*7.53450;
		euroPriceTemp = Math.round(euroPriceTemp * tempDecimalPoint) / tempDecimalPoint;
		return currencyComma(euroPriceTemp, "HRK");
	}

	//only it  
	function getDiscountRate(saveText, originalPrice) {
		//console.log('saveText=['+saveText+']');
		//console.log('originalPrice=['+originalPrice+']');
		//console.log('originalPrice-saveText=['+(originalPrice-saveText)+']');
		let tempDecimalPoint = Math.pow(10, 2);
		let discountRateTemp = Number(saveText) / Number(originalPrice) * tempDecimalPoint;
		//console.log(discountRateTemp);
		discountRateTemp = Number(discountRateTemp).toFixed(2);
		//console.log(discountRateTemp);
		//  
		discountRateTemp = discountRateTemp.replace('.', ',');
		//console.log(discountRateTemp);
		return discountRateTemp;
	}
	
	/**
	 *   page  
	 */
	function pageTaggingChange( sharedObj, selectorObj ) {
		
		digitalData.product.model_code = sharedObj.modelCode ? sharedObj.modelCode.replace(/&/g, ' and ').replace(/  /g,' ') : '';
		digitalData.product.model_name = sharedObj.modelName ? sharedObj.modelName.replace(/&/g, ' and ').replace(/  /g,' ') : '';
		digitalData.product.list_price = sharedObj.proudctPriceInfo.orignalPrice;
		digitalData.product.displayName = sharedObj.displayName ? sharedObj.displayName.replace(/&/g, ' and ').replace(/  /g,' ') : '';
		digitalData.product.pd_type = sharedObj.stockLevelStatus && sharedObj.stockLevelStatus !=='NOORDER' ? 'sale' : 'no sale';
		digitalData.product.products =sharedObj.modelName ? sharedObj.modelName.replace(/&/g, ' and ').replace(/  /g,' ') : '';

		
		// set pageName
		let lastIndex = 0;
		let lastText = '';
		let pageName = digitalData.page.pageInfo.siteCode;
		if(digitalData.page.pathIndicator.depth_2 != ""){
			pageName += ":" + digitalData.page.pathIndicator.depth_2;
			lastIndex = 2;
			lastText = digitalData.page.pathIndicator.depth_2;
		}
			
		if(digitalData.page.pathIndicator.depth_3 != ""){
			pageName += ":" + digitalData.page.pathIndicator.depth_3;
			lastIndex = 3;
			lastText = digitalData.page.pathIndicator.depth_3;
		}
			
		if(digitalData.page.pathIndicator.depth_4 != ""){
			pageName += ":" + digitalData.page.pathIndicator.depth_4;
			lastIndex = 4;
			lastText = digitalData.page.pathIndicator.depth_4;
		}
			
		if(digitalData.page.pathIndicator.depth_5 != ""){
			pageName += ":" + digitalData.page.pathIndicator.depth_5;
			lastIndex = 5;
			lastText = digitalData.page.pathIndicator.depth_5;
		}
		
		const currentPdpUrl = sharedObj.currentPdpUrl ? sharedObj.currentPdpUrl.split("/") : [];
		
		if( currentPdpUrl && currentPdpUrl.length > 0 ){
			let lastURL = '';
			
			for( let indexPdp in currentPdpUrl ){
				if( currentPdpUrl[indexPdp] ){
					lastURL = currentPdpUrl[indexPdp];
				}
			}
			lastURL = lastURL.replace(/&/g, ' and ').replace(/  /g,' ');
			
			digitalData.page.pathIndicator['depth_'+lastIndex] = lastURL;
			pageName = pageName.replace( lastText, lastURL );
			
			if( sharedObj.isSimplePDP ){
				pageName += ":buy";
			}
		}
	}
	
	
	/**
	 * wtbCtaBtnYn Y  CTA 
	 */
	function nonUseWtbCtaBtnYn( hasProduct, sharedObj, selectorObj, currentUrl ){
		const util = sharedObj.util;
		const drawObj = sharedObj.drawObj;
		const isSimplePDP = sharedObj.isSimplePDP;
		const siteCode = sharedObj.siteCode;
		const modelName = sharedObj.modelName;
		const $tariffPlanList = selectorObj.buyingToolOptTariffPlan.find('ul li');
		const modelCode = sharedObj.modelCode;
		const pdRemoveTagTxt = sharedObj.pdRemoveTagTxt ? sharedObj.pdRemoveTagTxt.replace('&quot;','"') : '';
		const wtbSrc = sharedObj.wtbSrc;
		const wtbSubTypeCode = sharedObj.wtbSubTypeCode;
		const shopSkuCode = sharedObj.shopSkuCode;
		const tariffPlanArea = $( selectorObj.buyingToolOptTariffPlan);
		const hasTariffPlanResult = util.hasTariffPlanResult( sharedObj, selectorObj );
		const tariffPlanUrl = tariffPlanArea.find('.option-input.this-checked').attr("data-url");
		const shopIntegrationFlag = $("#shopIntegrationFlag").val();
		const isGPv2 = shopIntegrationFlag === "GPv2";
		const isOldHybris = (shopIntegrationFlag === "Hybris" || shopIntegrationFlag === "Hybris-intg");
		const isNewHybris =shopIntegrationFlag === "Hybris-new";
		const wtbUseYn = sharedObj.wtbUseYn;
		const wtbDispFuncUseYN = sharedObj.wtbDispFuncUseYN;
		
		let price = drawObj.price;
		let containedLinkType = '_self';
		let containedCtaClass = '';
		let containedText = '';
		let containedCustom = {};
		
		let stockLevelStatus = sharedObj.stockLevelStatus;
		let originStockLevelStatus = stockLevelStatus;
		let isContinueCtaOrAddToCartCta = false;
		let isAddToCartCta = false;
		
		if(stockLevelStatus == "INSTOCK" || stockLevelStatus == "BACKORDERED" || stockLevelStatus == "PREORDER" || stockLevelStatus == "LOWSTOCK"){
			sharedObj.isPossibleBuy = true;
		}else{
			sharedObj.isPossibleBuy = false;
		}
		
		if(sharedObj.isBezel && sharedObj.isPossibleBuy){
			if(shopIntegrationFlag === 'Hybris-new'){
				var selectedBezelColor = sharedObj.selectedBezelColor;
				if(selectedBezelColor){
					var selectedBezelColorStockStatus = selectedBezelColor.hasOwnProperty('stock') ? selectedBezelColor.stock.stockLevelStatus.toUpperCase() : ""; //   stockLevelStatus   
					stockLevelStatus = selectedBezelColorStockStatus;
				}
				if(stockLevelStatus == ''){
					hasProduct = false;
				}
			}else if(shopIntegrationFlag === 'Hybris' || shopIntegrationFlag === 'Hybris-intg'){
				var selectedBezelColor = sharedObj.selectedBezelColor;
				var selectedBezelColorStockStatus = "";
				if(selectedBezelColor){
					if(selectedBezelColor.hasOwnProperty('stockLevelStatus')){
						if(selectedBezelColor.stockLevelStatus != null){
							selectedBezelColorStockStatus = selectedBezelColor.stockLevelStatus.toUpperCase();//   stockLevelStatus   
						}
					}
				}
				stockLevelStatus = selectedBezelColorStockStatus;
				if(stockLevelStatus == ''){
					hasProduct = false;
				}
			}
		}else if((sharedObj.isBezel && !sharedObj.isPossibleBuy && sharedObj.sellingWithBazel) || (!sharedObj.isBezel && sharedObj.sellingWithBazel)){
			//2022      2022     OOS
			stockLevelStatus = "OUTOFSTOCK";
		}
		
		let anchorNaviLinkType = '_self';
		let anchorNaviCtaClass = '';
		let anchorNaviText = '';
		let anchorNaviCustom = {};
		
		let wtbLinkType = '_self';
		let wtbCtaClass = '';
		let wtbText = '';
		let wtbCustom = {};
		let classType = 'pd-buying-price--cta3';
		let wtbAttrLink = 'javascript:;';
		let containedAttrLink = 'javascript:;';
		let anchorNaviAttrLink = 'javascript:;';
		
		let wtbCtaAttr = {};
		wtbCtaAttr.modelName = modelName;
		wtbCtaAttr.dataTtile = pdRemoveTagTxt;
		wtbCtaAttr.imgSrc = wtbSrc;
		wtbCtaAttr.iaCode = wtbSubTypeCode;
		wtbCtaAttr.dataModelCode = modelCode;
		
		let salesStatus = true;
		let isVtex = (siteCode === "br" || siteCode === "ar" || siteCode === "latin")? true : false ;
		if( isOldHybris ){
			if( globalShopInfo.shopServiceYN === 'N' || !sharedObj.oldHybrisSalesStatus ){
				salesStatus = false;
			}
		}else if( isNewHybris ){
			if( !sharedObj.newHybrisSalesStatus ){
				salesStatus = false;
			}
		}else if( isGPv2 ){
			if( sharedObj.accessoryDisabled ){
				salesStatus = false;
			}
		}else if( isVtex ){
			if(sharedObj.hybrisApiData.shopAPI){
				if(siteCode === 'br' && !sharedObj.hybrisApiData.shopAPI.salesStatus){
					salesStatus = false;
				}else if(siteCode === 'ar' && sharedObj.hybrisApiData.shopAPI.salesStatus !== 'ON_SALES'){
					salesStatus = false;
				}else if(siteCode === 'latin' && sharedObj.hybrisApiData.shopAPI.salesStatus !== 'ON_SALE'){
					salesStatus = false;
				}	
			}else{
				isVtex = false;
			}			
		}
		
		let isWtbCta = false;
		if( wtbUseYn === 'Y' ){
			if( wtbDispFuncUseYN === 'Y' && ( isOldHybris || isNewHybris || isGPv2 || isVtex )){
				if( salesStatus ){ //  O
					isWtbCta = false;
				}else{ //  X
					isWtbCta = true;
				}
			}else{
				isWtbCta = true;
			}
			if( !shopIntegrationFlag ){
				isWtbCta = true;
			}
		}else{
			isWtbCta = false;
		}
		
		if( siteCode === 'mx' ){
			isWtbCta = false;
		}
		
		if( hasProduct ){
			if( isWtbCta ){
				if( stockLevelStatus === 'NOORDER'){
					containedText = anchorNaviText = Granite.I18n.get( 'Where to buy' );
					containedCtaClass = anchorNaviCtaClass = 'js-cta-buy tg-wtb';
					containedCustom = anchorNaviCustom = wtbCtaAttr;
				}else{
					// where to buy    , NOORDER  not for sale    .
					if( siteCode !== 'id' ){
						wtbText = Granite.I18n.get( 'Where to buy' );
						wtbCtaClass = 'js-cta-buy tg-wtb';
						wtbCustom = wtbCtaAttr;
					}
				}
				
			}else{
				if( stockLevelStatus === 'NOORDER'){
					anchorNaviText = containedText = Granite.I18n.get( 'not for sale' );
					anchorNaviCtaClass = containedCtaClass = 'cta--disabled tg-not-for-sale';
				}
			}
			
			// wtb X  
			if( stockLevelStatus === 'NOORDER'){
				classType = 'pd-buying-price--cta2';
				if( siteCode === 'in' ){
					anchorNaviCtaClass = containedCtaClass = 'js-cta-stock tg-out-stock';
					anchorNaviText = containedText = Granite.I18n.get( 'Get stock alert' );
					anchorNaviCustom = containedCustom = {
						'moCode' : shopSkuCode
					}
				}

			} else if( stockLevelStatus === 'OUTOFSTOCK' ){
				anchorNaviCtaClass = containedCtaClass = 'js-cta-stock tg-out-stock';
				anchorNaviText = containedText = Granite.I18n.get( 'Get stock alert' );
				anchorNaviCustom = containedCustom = {
					'moCode' : shopSkuCode
				}
				
				checkRewardMsg( sharedObj, selectorObj );

				
			} else if( stockLevelStatus === 'PREORDER' ){
				const ctaType =  'preorder';
				const specialCta = checkingSpecialCta ( ctaType, sharedObj, selectorObj );
				const customedAttr = {};
				
				anchorNaviCtaClass = containedCtaClass = 'js-buy-now';
				customedAttr.moCode = shopSkuCode;
				
				if( specialCta.isSpecial ){
					anchorNaviText = containedText = specialCta.title;
					if( specialCta.ctaType ){
						if( specialCta.ctaType.indexOf('continue') > -1 ){
							anchorNaviCtaClass += ' tg-continue';
							containedCtaClass += ' tg-continue';
							isContinueCtaOrAddToCartCta = true;
						} else if(  specialCta.ctaType.indexOf('checkout') > -1 ) {
							anchorNaviCtaClass += ' tg-checkout';
							containedCtaClass += ' tg-checkout';
							
							if( specialCta.ctaType.indexOf('between') > -1 ) {
								anchorNaviCtaClass += ' tg-between';
								containedCtaClass += ' tg-between';
							}
						}
					}
				} else {
					anchorNaviText = containedText = Granite.I18n.get( 'pre order' );
					anchorNaviCtaClass += ' tg-pre-order';
					containedCtaClass += ' tg-pre-order';
				}
				customedAttr.ctaType = specialCta.ctaType;
				anchorNaviCustom = containedCustom = customedAttr;
				
			} else {
				const ctaType =  'add-cart';
				const specialCta = checkingSpecialCta ( ctaType, sharedObj, selectorObj );
				const customedAttr = {};
				customedAttr.moCode = shopSkuCode;
				
				anchorNaviCtaClass = containedCtaClass = 'js-buy-now';
				
				if( specialCta.isSpecial ){
					anchorNaviText = containedText = specialCta.title;
					if( specialCta.ctaType ){
						if( specialCta.ctaType.indexOf('continue') > -1 ){
							anchorNaviCtaClass += ' tg-continue';
							containedCtaClass += ' tg-continue';
							isContinueCtaOrAddToCartCta = true;
						} else if(  specialCta.ctaType.indexOf('checkout') > -1 ) {
							anchorNaviCtaClass += ' tg-checkout';
							containedCtaClass += ' tg-checkout';
							
							if( specialCta.ctaType.indexOf('between') > -1 ) {
								anchorNaviCtaClass += ' tg-between';
								containedCtaClass += ' tg-between';
							}
						}
					}
				} else {
					anchorNaviText = containedText = Granite.I18n.get( 'Add to cart' );
					anchorNaviCtaClass += ' tg-add-to-cart';
					containedCtaClass += ' tg-add-to-cart';
					isContinueCtaOrAddToCartCta = true;
					isAddToCartCta = true;
				}
				customedAttr.ctaType = specialCta.ctaType;
				anchorNaviCustom = containedCustom = customedAttr;
				
				// lv, lt, ee - delivery 
				if( siteCode === 'lt' || siteCode === 'lv' || siteCode === 'ee'){
					if( stockLevelStatus === 'INSTOCK' || stockLevelStatus === 'BACKORDERED') {
						if(sharedObj.stockCustomMessage ) {
							$('#pd-delivery-msg').html(sharedObj.stockCustomMessage);
							$('#pd-delivery-msg').show();
						}
					}
				}
				
				// SETK - Buy Button Development Request + cn
				if( (siteCode === 'tr' || siteCode === 'cn') && stockLevelStatus === 'INSTOCK'){
					anchorNaviText = containedText = Granite.I18n.get('Buy now');
					anchorNaviAttrLink = containedAttrLink = sharedObj.buyNowUrl;
				}
				
				checkRewardMsg( sharedObj, selectorObj );
			}
			
		} else {
			classType = 'pd-buying-price--cta2';
			if( isWtbCta ){
				containedText = anchorNaviText = Granite.I18n.get( 'Where to buy' );
				containedCtaClass = anchorNaviCtaClass = 'js-cta-buy tg-wtb';
				containedCustom = anchorNaviCustom = wtbCtaAttr;
				
				if( !isSimplePDP ){
					if((siteCode === 'nl' || siteCode === 'be' || siteCode === 'be_fr') && $tariffPlanList.length > 0){
						containedText = Granite.I18n.get( 'BUY WITH SUBSCRIPTION' );
							
						containedCtaClass = 's-cta-item js-tariff-cta tg-subscription';
						containedCustom.style = 'display:none;';
					}
				}
				
			}else{
				anchorNaviText = containedText = Granite.I18n.get( 'not for sale' );
				anchorNaviCtaClass = containedCtaClass = 'cta--disabled tg-not-for-sale';
			}
			
			if( siteCode === 'in' ){
				anchorNaviCtaClass = containedCtaClass = 'js-cta-stock tg-out-stock';
				anchorNaviText = containedText = Granite.I18n.get( 'Get stock alert' );
				anchorNaviCustom = containedCustom = {
					'moCode' : shopSkuCode
				}
			}
		}
		
		if(sharedObj.sellingWithBazel && stockLevelStatus == "OUTOFSTOCK"){
			anchorNaviCtaClass = containedCtaClass = 'cta--disabled js-cta-stock tg-out-stock';
			anchorNaviText = containedText = Granite.I18n.get( 'Out Of Stock' );
			anchorNaviCustom = containedCustom = {
				'moCode' : shopSkuCode
			}
		}
		
		if( hasTariffPlanResult ){
			anchorNaviCtaClass = containedCtaClass = 'js-buy-now is-checked tg-subscription';
			anchorNaviText = containedText = Granite.I18n.get( 'BUY WITH SUBSCRIPTION' );
			anchorNaviAttrLink = containedAttrLink = tariffPlanUrl;
		}
		
		if( sharedObj.hasBespokeCta ){
			if( stockLevelStatus !== 'PREORDER' ){
				anchorNaviCtaClass = containedCtaClass = 'tg-bespoke';
				anchorNaviText = containedText = Granite.I18n.get('Customize yours');
				anchorNaviAttrLink = containedAttrLink = $('#bespokeCtaLink').val();
				anchorNaviLinkType = containedLinkType = '_self';
			}
			if( wtbUseYn === 'Y'){
				wtbText = Granite.I18n.get( 'Where to buy' );
				wtbCtaClass = 'js-cta-buy tg-wtb';
				wtbCustom = wtbCtaAttr;
			}
		}
		
		//   
		stockLevelStatus = originStockLevelStatus;
		
		price.classType = classType;
		price.wtbAttr = util.getAttrCta( wtbText.toUpperCase(), wtbAttrLink, wtbLinkType, wtbCtaClass, wtbCustom );
		price.containedAttr = util.getAttrCta( containedText, containedAttrLink, containedLinkType, containedCtaClass, containedCustom );
		price.anchorNaviAttr = util.getAttrCta( anchorNaviText, anchorNaviAttrLink, anchorNaviLinkType, anchorNaviCtaClass, anchorNaviCustom );
	}
	
	function checkRewardMsg( sharedObj, selectorObj ){
		const siteCode = sharedObj.siteCode;
		// pt, es, fr - rewards message
		if( siteCode === 'pt' || siteCode === 'es' || siteCode === 'fr'){
		
			//epp reward   
			if( $('#isEppPage').val() === 'true' ){
				if( sharedObj.isNotFirstReward ){
					return;
				}
				const searchDomain = $("#searchDomain").val();
				const stage = $("#apiStageInfo").val();
				const storeInfoApiUrl = `${searchDomain}/${stage}/epp/v2/cms/storeinfo`;

				let params = {
					siteCode : $("#siteCode").val(),
					companyCode : $('#eppCompanyCode').val()
				};
				$.ajax({
					url: storeInfoApiUrl,
					type: "GET",
					data: params,
					dataType: "json",
					cache: true,
					crossDomain: true,
					timeout: 20000,
					success: function (data) {
						if( !data.response || !data.response.resultData || !data.response.resultData.storeInfo ){
							return;
						}
						const rewardsDisplayYN = data.response.resultData.storeInfo.rewardsDisplayYN;
						if(rewardsDisplayYN === 'Y'){
							$('#pd-rewards-msg').show();
						}
					}
				});
				
				sharedObj.isNotFirstReward = true;
				
			} else {
				$('#pd-rewards-msg').show();
			}
		}
	}
	
	/**
	 * wtbCtaBtnYn Y CTA 
	 */
	function useWtbCtaBtnYn( hasProduct, sharedObj, selectorObj, currentUrl ){
		
		const util = sharedObj.util;
		const drawObj = sharedObj.drawObj;
		const siteCode = sharedObj.siteCode;
		const modelName = sharedObj.modelName;
		const modelCode = sharedObj.modelCode;
		const pdRemoveTagTxt = sharedObj.pdRemoveTagTxt ? sharedObj.pdRemoveTagTxt.replace('&quot;','"') : '';
		const wtbSrc = sharedObj.wtbSrc;
		const wtbSubTypeCode = sharedObj.wtbSubTypeCode;
		const shopSkuCode = sharedObj.shopSkuCode;
		const tariffPlanArea = $( selectorObj.buyingToolOptTariffPlan);
		const hasTariffPlanResult = util.hasTariffPlanResult( sharedObj, selectorObj );
		const tariffPlanUrl = tariffPlanArea.find('.option-input.this-checked').attr("data-url");
		const shopIntegrationFlag = $("#shopIntegrationFlag").val();
		const isGPv2 = shopIntegrationFlag === "GPv2";
		const isOldHybris = (shopIntegrationFlag === "Hybris" || shopIntegrationFlag === "Hybris-intg");
		const isNewHybris =shopIntegrationFlag === "Hybris-new";
		const wtbUseYn = sharedObj.wtbUseYn;
		const wtbDispFuncUseYN = sharedObj.wtbDispFuncUseYN;
		
		let price = drawObj.price;
		
		let containedLinkType = '_self';
		let containedCtaClass = '';
		let containedText = '';
		let containedCustom = {};
		
		let stockLevelStatus = sharedObj.stockLevelStatus;
		let originStockLevelStatus = stockLevelStatus;
		let isContinueCtaOrAddToCartCta = false;
		let isAddToCartCta = false;
		
		if(stockLevelStatus == "INSTOCK" || stockLevelStatus == "BACKORDERED" || stockLevelStatus == "PREORDER" || stockLevelStatus == "LOWSTOCK"){
			sharedObj.isPossibleBuy = true;
		}else{
			sharedObj.isPossibleBuy = false;
		}
		
		if(sharedObj.isBezel && sharedObj.isPossibleBuy){
			if(shopIntegrationFlag === 'Hybris-new'){
				var selectedBezelColor = sharedObj.selectedBezelColor;
				if(selectedBezelColor){
					var selectedBezelColorStockStatus = selectedBezelColor.hasOwnProperty('stock') ? selectedBezelColor.stock.stockLevelStatus.toUpperCase() : ""; //   stockLevelStatus   
					stockLevelStatus = selectedBezelColorStockStatus;
				}
				if(stockLevelStatus == ''){
					hasProduct = false;
				}
			}else if(shopIntegrationFlag === 'Hybris' || shopIntegrationFlag === 'Hybris-intg'){
				var selectedBezelColor = sharedObj.selectedBezelColor;
				var selectedBezelColorStockStatus = "";
				if(selectedBezelColor){
					if(selectedBezelColor.hasOwnProperty('stockLevelStatus')){
						if(selectedBezelColor.stockLevelStatus != null){
							selectedBezelColorStockStatus = selectedBezelColor.stockLevelStatus.toUpperCase();//   stockLevelStatus   
						}
					}
				}
				stockLevelStatus = selectedBezelColorStockStatus;
				if(stockLevelStatus == ''){
					hasProduct = false;
				}
			}
		}else if(sharedObj.isBezel && !sharedObj.isPossibleBuy && sharedObj.sellingWithBazel){
			//2022      OOS
			stockLevelStatus = "OUTOFSTOCK";
		}
		
		let anchorNaviLinkType = '_self';
		let anchorNaviCtaClass = '';
		let anchorNaviText = '';
		let anchorNaviCustom = {};
		
		let wtbLinkType = '_self';
		let wtbCtaClass = '';
		let wtbText = '';
		let wtbCustom = {};
		
		let anchorNaviAttrLink = 'javascript:;';
		let containedAttrLink = 'javascript:;';
		let wtbAttrLink = 'javascript:;';
		
		let classType = 'pd-buying-price--cta2';
		
		let wtbCtaAttr = {};
		wtbCtaAttr.modelName = modelName;
		wtbCtaAttr.dataTtile = pdRemoveTagTxt;
		wtbCtaAttr.imgSrc = wtbSrc;
		wtbCtaAttr.iaCode = wtbSubTypeCode;
		wtbCtaAttr.dataModelCode = modelCode;
		
		let salesStatus = true;
		let isVtex = (siteCode === "br" || siteCode === "ar" || siteCode === "latin")? true : false ;
		if( isOldHybris ){
			if( globalShopInfo.shopServiceYN === 'N' || !sharedObj.oldHybrisSalesStatus ){
				salesStatus = false;
			}
		}else if( isNewHybris ){
			if( !sharedObj.newHybrisSalesStatus ){
				salesStatus = false;
			}
		}else if( isGPv2 ){
			if( sharedObj.accessoryDisabled ){
				salesStatus = false;
			}
		}else if( isVtex ){
			if(sharedObj.hybrisApiData.shopAPI){
				if(siteCode === 'br' && !sharedObj.hybrisApiData.shopAPI.salesStatus){
					salesStatus = false;
				}else if(siteCode === 'ar' && sharedObj.hybrisApiData.shopAPI.salesStatus !== 'ON_SALES'){
					salesStatus = false;
				}else if(siteCode === 'latin' && sharedObj.hybrisApiData.shopAPI.salesStatus !== 'ON_SALE'){
					salesStatus = false;
				}	
			}else{
				isVtex = false;
			}			
		}
		
		let isWtbCta = false;
		if( wtbUseYn === 'Y' ){
			if( wtbDispFuncUseYN === 'Y' && ( isOldHybris || isNewHybris || isGPv2 || isVtex )){
				if( salesStatus ){ //  O
					isWtbCta = false;
				}else{ //  X
					isWtbCta = true;
				}
			}else{
				isWtbCta = true;
			}
			if( !shopIntegrationFlag ){
				isWtbCta = true;
			}
		}else{
			isWtbCta = false;
		}
		
		if( siteCode === 'mx' ){
			isWtbCta = false;
		}
		
		if( hasProduct ){
			if( isWtbCta ){
				if( stockLevelStatus === 'NOORDER' ){
					anchorNaviCtaClass = containedCtaClass = 'js-cta-buy tg-wtb';
					anchorNaviText = containedText =  Granite.I18n.get( 'Where to buy' );
					anchorNaviCustom = containedCustom = wtbCtaAttr;
				}else{
					wtbCtaClass = 'js-cta-buy tg-wtb ';
					wtbText = Granite.I18n.get( 'Where to buy' );
					wtbCustom = wtbCtaAttr;
					classType = 'pd-buying-price--cta3';
				}
				if( siteCode === 'in' ){
					anchorNaviCtaClass = containedCtaClass = 'js-cta-stock tg-out-stock';
					anchorNaviText = containedText = Granite.I18n.get( 'Get stock alert' );
					anchorNaviCustom = containedCustom = {
						'moCode' : shopSkuCode
					}
				}
			}else{
				if( stockLevelStatus === 'NOORDER' ){
					anchorNaviCtaClass = containedCtaClass = 'cta--disabled no-for-sale tg-not-for-sale';
					anchorNaviText = containedText = Granite.I18n.get( 'not for sale' );
					
					if( siteCode === 'in' ){
						anchorNaviCtaClass = containedCtaClass = 'js-cta-stock tg-out-stock';
						anchorNaviText = containedText = Granite.I18n.get( 'Get stock alert' );
						anchorNaviCustom = containedCustom = {
							'moCode' : shopSkuCode
						}
					}
				}
			}
			
			// wtb X  
			if( stockLevelStatus === 'OUTOFSTOCK' ){
				anchorNaviCtaClass = containedCtaClass = 'js-cta-stock tg-out-stock';
				anchorNaviText = containedText = Granite.I18n.get( 'Get stock alert' );
				anchorNaviCustom = containedCustom = {
					'moCode' : shopSkuCode
				}
				checkRewardMsg( sharedObj, selectorObj );
				
			}else if( stockLevelStatus === 'PREORDER' ){
				const ctaType = 'preorder';
				const specialCta = checkingSpecialCta ( ctaType, sharedObj, selectorObj );
				const customedAttr = {};
				anchorNaviCtaClass = containedCtaClass = 'js-buy-now pre-order';
				customedAttr.moCode = shopSkuCode;
				
				if( specialCta.isSpecial ){
					anchorNaviText = containedText = specialCta.title;
					if( specialCta.ctaType ){
						if( specialCta.ctaType.indexOf('continue') > -1 ){
							anchorNaviCtaClass += ' tg-continue';
							containedCtaClass += ' tg-continue';
							isContinueCtaOrAddToCartCta = true;
						} else if(  specialCta.ctaType.indexOf('checkout') > -1 ) {
							anchorNaviCtaClass += ' tg-checkout';
							containedCtaClass += ' tg-checkout';
							
							if( specialCta.ctaType.indexOf('between') > -1 ) {
								anchorNaviCtaClass += ' tg-between';
								containedCtaClass += ' tg-between';
							}
						}
					}
				}else{
					anchorNaviText = containedText = Granite.I18n.get( 'pre order' );
					anchorNaviCtaClass += ' tg-pre-order';
					containedCtaClass += ' tg-pre-order';
				}
				customedAttr.ctaType = specialCta.ctaType;
				wtbCustom.moCode = shopSkuCode;
				anchorNaviCustom = containedCustom = customedAttr;
				
			}else{
				const ctaType = 'add-cart';
				const specialCta = checkingSpecialCta ( ctaType, sharedObj, selectorObj );
				anchorNaviCtaClass = containedCtaClass = 'js-buy-now';
				
				if(wtbUseYn === 'Y'){
					if( siteCode === 'in' ){
						anchorNaviCtaClass = containedCtaClass = 'js-cta-stock tg-out-stock';
						anchorNaviText = containedText = Granite.I18n.get( 'Get stock alert' );
						anchorNaviCustom = containedCustom = {
							'moCode' : shopSkuCode
						}
					} else {
						classType = 'pd-buying-price--cta3';
						wtbCtaClass = 'js-cta-buy tg-wtb ';
						wtbText = Granite.I18n.get( 'Where to buy' );
						wtbCustom = wtbCtaAttr;
					}
				}
				
				const customedAttr = {};
				customedAttr.moCode = shopSkuCode;
				
				if( specialCta.isSpecial ){
					anchorNaviText = containedText = specialCta.title;
					if( specialCta.ctaType ){
						if( specialCta.ctaType.indexOf('continue') > -1 ){
							anchorNaviCtaClass += ' tg-continue';
							containedCtaClass += ' tg-continue';
							isContinueCtaOrAddToCartCta = true;
						} else if(  specialCta.ctaType.indexOf('checkout') > -1 ) {
							anchorNaviCtaClass += ' tg-checkout';
							containedCtaClass += ' tg-checkout';
							
							if( specialCta.ctaType.indexOf('between') > -1 ) {
								anchorNaviCtaClass += ' tg-between';
								containedCtaClass += ' tg-between';
							}
						}
					}
				} else {
					anchorNaviText = containedText = Granite.I18n.get( 'Add to cart' );
					anchorNaviCtaClass += ' tg-add-to-cart';
					containedCtaClass += ' tg-add-to-cart';
					isContinueCtaOrAddToCartCta = true;
					isAddToCartCta = true;
				}
				customedAttr.ctaType = specialCta.ctaType;
				anchorNaviCustom = containedCustom = customedAttr;
				wtbCustom.moCode = shopSkuCode;
				
				// lv, lt, ee - delivery 
				if( siteCode === 'lt' || siteCode === 'lv' || siteCode === 'ee'){
					if( stockLevelStatus === 'INSTOCK' || stockLevelStatus === 'BACKORDERED') {
						if(sharedObj.stockCustomMessage ) {
							$('#pd-delivery-msg').html(sharedObj.stockCustomMessage);
							$('#pd-delivery-msg').show();
						}
					}
				}
				
				checkRewardMsg( sharedObj, selectorObj );
			}
			
		} else {
			if( wtbUseYn === 'Y' ){
				anchorNaviCtaClass = containedCtaClass = 'js-cta-buy tg-wtb';
				anchorNaviText = containedText = Granite.I18n.get( 'Where to buy' );
				anchorNaviCustom = containedCustom = wtbCtaAttr;
			}else{
				anchorNaviCtaClass = containedCtaClass = 'cta--disabled tg-not-for-sale';
				anchorNaviText = containedText = Granite.I18n.get( 'not for sale' );
			}
			if( siteCode === 'in' ){
				anchorNaviCtaClass = containedCtaClass = 'js-cta-stock tg-out-stock';
				anchorNaviText = containedText = Granite.I18n.get( 'Get stock alert' );
				anchorNaviCustom = containedCustom = {
					'moCode' : shopSkuCode
				}
			}
			classType = 'pd-buying-price--cta1';
		}
		
		if(sharedObj.sellingWithBazel && stockLevelStatus == "OUTOFSTOCK"){
			anchorNaviCtaClass = containedCtaClass = 'cta--disabled js-cta-stock tg-out-stock';
			anchorNaviText = containedText = Granite.I18n.get( 'Out Of Stock' );
			anchorNaviCustom = containedCustom = {
				'moCode' : shopSkuCode
			}
		}

		if( hasTariffPlanResult ){
			anchorNaviCtaClass = containedCtaClass = 'js-buy-now is-checked tg-subscription';
			anchorNaviText = containedText = Granite.I18n.get( 'BUY WITH SUBSCRIPTION' );
			anchorNaviAttrLink = containedAttrLink = tariffPlanUrl;
		}

		if( sharedObj.hasBespokeCta ){
			if( stockLevelStatus !== 'PREORDER' ){
				anchorNaviCtaClass = containedCtaClass = 'tg-bespoke';
				anchorNaviText = containedText = Granite.I18n.get('Customize yours');
				anchorNaviAttrLink = containedAttrLink = $('#bespokeCtaLink').val();
				anchorNaviLinkType = containedLinkType = '_self';
			}
			if( wtbUseYn === 'Y'){
				wtbText = Granite.I18n.get( 'Where to buy' );
				wtbCtaClass = 'js-cta-buy tg-wtb';
				wtbCustom = wtbCtaAttr;
			}
		}

		//   
		stockLevelStatus = originStockLevelStatus;

		price.classType = classType;
		price.wtbAttr = util.getAttrCta( wtbText, wtbAttrLink, wtbLinkType, wtbCtaClass, wtbCustom );
		price.containedAttr = util.getAttrCta( containedText, containedAttrLink, containedLinkType, containedCtaClass, containedCustom );
		price.anchorNaviAttr = util.getAttrCta( anchorNaviText, anchorNaviAttrLink , anchorNaviLinkType, anchorNaviCtaClass, anchorNaviCustom );
		
	}


	/**
	 * Addon  search      care  (  setMainCallBack )
	 */
	function checkingCareAndWarranty(sharedObj, selectorObj ){
		if( !sharedObj.hasAddonApiData ){
			selectorObj.buyingToolOptCare.html('');
			selectorObj.buyingToolOptCare.hide();
			selectorObj.buyingToolOptWarranty.html('');
			selectorObj.buyingToolOptWarranty.hide();
			$(".product-emc-task #emcCare").remove();
		}
	}

	/**
	 *    ()
	 */
	function selectedOptionPrice(displayPrice, flag, selectorObj){
		const target = selectorObj.buyingToolOptMemory;

		if( flag ){
			$(target).find('.pd-option-selector__sub-text').empty();
		}else{
			$(target).find('.pd-select-option__item').each(function(){
				if($(this).find(".option-input").is(":checked")){
					$(this).find(".pd-option-selector__sub-text").html(displayPrice);
					return false;
				}
			});
		}
	}

	/**
	 *      
	 */
	function settingBogoPrice( sharedObj, selectorObj, totalPrice ) {
		const util = sharedObj.util;
		const bogoArea = selectorObj.buyingToolOptOffer.find('.pd-offer__item.bogo');
		const hasOffer = util.hasOffer( sharedObj, selectorObj );
		const hasBogo = util.hasBogo( sharedObj, selectorObj );

		if( hasOffer && hasBogo ){
			const bogoPrice = bogoArea.find('.pd-price').attr('data-price');
			if( bogoPrice ){
				totalPrice.original = parseFloat(totalPrice.original) + parseFloat(bogoPrice);

				//     
				if(!sharedObj.getOptoinPrice){
					sharedObj.getOptoinPrice = true;
				}
			}
		}
	}

	/**
	 *  Care    
	 */
	function settingCarePrice( sharedObj, selectorObj, totalPrice ){
		const hasComponentClass = sharedObj.hasComponentClass;
		const disabledClass = sharedObj.disabledClass;

		const careResultArea = selectorObj.buyingToolOptCareResult;
		const hasCareResult = careResultArea.hasClass(hasComponentClass) && !careResultArea.hasClass(disabledClass);
		const careResultPrice = careResultArea.find('.result-price').attr('data-price');
		const careSaleResultPrice = careResultArea.find('.result-price').attr('data-sale-price');

		if( hasCareResult ){
			totalPrice.original = parseFloat(totalPrice.original) + parseFloat(careResultPrice);
			totalPrice.sale = parseFloat(totalPrice.sale) + parseFloat(careSaleResultPrice);
			//     
			if(!sharedObj.getOptoinPrice){
				sharedObj.getOptoinPrice = true;
			}
		}
	}

	/**
	 *  warranty    
	 */
	function settingWarrantyPrice( sharedObj, selectorObj, totalPrice ){
		const hasComponentClass = sharedObj.hasComponentClass;
		const disabledClass = sharedObj.disabledClass;

		const warrantyResultArea = selectorObj.buyingToolOptWarrantyResult;
		const hasWarrantyResult = warrantyResultArea.hasClass(hasComponentClass) && !warrantyResultArea.hasClass(disabledClass);
		const warrantyResultPrice = warrantyResultArea.find('.result-price').attr('data-price');
		const warrantySaleResultPrice = warrantyResultArea.find('.result-price').attr('data-sale-price');

		if( hasWarrantyResult ){
			totalPrice.original = parseFloat(totalPrice.original) + parseFloat(warrantyResultPrice);
			totalPrice.sale = parseFloat(totalPrice.sale) + parseFloat(warrantySaleResultPrice);

			//     
			if(!sharedObj.getOptoinPrice){
				sharedObj.getOptoinPrice = true;
			}
		}
	}

	/**
	 *  warranty    
	 */
	function settingWarrantyVdPrice( sharedObj, selectorObj, totalPrice ){
		const hasComponentClass = sharedObj.hasComponentClass;
		const disabledClass = sharedObj.disabledClass;

		const warrantyVdResultArea = selectorObj.buyingToolOptWarrantyVdResult;
		const hasWarrantyVdResult = warrantyVdResultArea.hasClass(hasComponentClass) && !warrantyVdResultArea.hasClass(disabledClass);
		const warrantyVdResultPrice = warrantyVdResultArea.find('.option-result__text-wrap').attr('data-price');

		if( hasWarrantyVdResult ){
			totalPrice.original = parseFloat(totalPrice.original) + parseFloat(warrantyVdResultPrice);
			totalPrice.sale = parseFloat(totalPrice.sale) + parseFloat(warrantyVdResultPrice);

			//     
			if(!sharedObj.getOptoinPrice){
				sharedObj.getOptoinPrice = true;
			}
		}
	}

	/**
	 *       
	 */
	function settingTradeInPrice( sharedObj, selectorObj, totalPrice ){
		const util = sharedObj.util;
		const tradeInResultArea = $(selectorObj.buyingToolOptTradeInResult);
		const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
		//CRHQ-6829 vn
		var tradeInResultPrice = null;
		if( siteCode == 'vn'){
		    tradeInResultPrice = tradeInResultArea.find('.option-result__multiple').attr('data-price');
		}else{ //vn-trade-in-popup  vn 
		    tradeInResultPrice = tradeInResultArea.find('.result-price').attr('data-price');
		}
		if( hasTradeInResult && tradeInResultPrice && !sharedObj.drawObj.tradeInResult.priceOverFlag){
			totalPrice.sale = parseFloat(totalPrice.sale) - parseFloat(tradeInResultPrice);

			//     
			if(!sharedObj.getOptoinPrice){
				sharedObj.getOptoinPrice = true;
			}
		}
	}

	function settingAssuredPrice( sharedObj, selectorObj, totalPrice ){
		const util = sharedObj.util;
		const hasAssuredBuyBackResultResult = util.hasAssuredBuyBackResultResult( sharedObj, selectorObj );
		const assuredResultArea = selectorObj.buyingToolOptAssuredBuyBackResult;
		const assuredResultPrice = assuredResultArea.find('.result-price').attr('data-price');
		const assuredSaleResultPrice = assuredResultArea.find('.result-price').attr('data-sale-price');

		if( hasAssuredBuyBackResultResult ){
			totalPrice.original = parseFloat(totalPrice.original) + parseFloat(assuredResultPrice);
			totalPrice.sale = parseFloat(totalPrice.sale) + parseFloat(assuredSaleResultPrice);
			//     
			if(!sharedObj.getOptoinPrice){
				sharedObj.getOptoinPrice = true;
			}
		}
	}

	/**
	 * Gift    
	 */
	function settingGiftPrice( sharedObj, selectorObj, totalPrice ){
		const hasComponentClass = sharedObj.hasComponentClass;
		const disabledClass = sharedObj.disabledClass;
		const giftArea = selectorObj.buyingToolOptOffer.find('.pd-offer__item.giftBundle');
		const offreArea = selectorObj.buyingToolOptOffer;
		const hasOfferArea = offreArea.hasClass(hasComponentClass) && !offreArea.hasClass(disabledClass);

		if( hasOfferArea ){
			for( var index = 0; index < giftArea.length; index ++ ){
				const item = $(giftArea.get(index));
				const hasItem = item.hasClass(hasComponentClass) && !item.hasClass(disabledClass);
				if( hasItem ){
					const priceList = item.find('.pd-offer__selected-bundle');
					for ( var priceIndex = 0;  priceIndex < priceList.length; priceIndex++ ) {
						const priceItem = $(priceList.get(priceIndex)).attr('data-price');
						const priceSaleItem = $(priceList.get(priceIndex)).attr('data-sale-price');
						if( priceItem ){
							totalPrice.original = parseFloat(totalPrice.original) + parseFloat(priceItem);
							totalPrice.sale = parseFloat(totalPrice.sale) + parseFloat(priceSaleItem);

							//     
							if(!sharedObj.getOptoinPrice){
								sharedObj.getOptoinPrice = true;
							}
						}
					}
				}
			}
		}
	}

	/**
	 *     
	 */
	function settingComboPrice( sharedObj, selectorObj, totalPrice ){
		const hasComponentClass = sharedObj.hasComponentClass;
		const disabledClass = sharedObj.disabledClass;
		const comboArea = selectorObj.buyingToolOptOffer.find('.pd-offer__item.compoBundle');
		const offreArea = selectorObj.buyingToolOptOffer;
		const hasOfferArea = offreArea.hasClass(hasComponentClass) && !offreArea.hasClass(disabledClass);

		if( hasOfferArea ){
			for( var index = 0; index < comboArea.length; index ++ ){
				const item = $(comboArea.get(index));
				const hasItem = item.hasClass(hasComponentClass) && !item.hasClass(disabledClass);
				if( hasItem ){
					const priceList = item.find('.pd-offer__selected-bundle');
					for ( var priceIndex = 0;  priceIndex < priceList.length; priceIndex++ ) {
						const priceItem = $(priceList.get(priceIndex)).attr('data-price');
						const priceSaleItem = $(priceList.get(priceIndex)).attr('data-sale-price');
						if( priceItem ){
							totalPrice.original = parseFloat(totalPrice.original) + parseFloat(priceItem);
							totalPrice.sale = parseFloat(totalPrice.sale) + parseFloat(priceSaleItem);

							//     
							if(!sharedObj.getOptoinPrice){
								sharedObj.getOptoinPrice = true;
							}
						}
					}
				}
			}
		}
	}

	/**
	 * Tariff Option    
	 */
	function settingTariffOptionPrice( sharedObj, selectorObj, totalPrice ){
		const hasComponentClass = sharedObj.hasComponentClass;
		const disabledClass = sharedObj.disabledClass;
		const tariffOptionResultArea = $(selectorObj.buyingToolOptTariffResult);
		const hasTariffOptionResult = tariffOptionResultArea.hasClass(hasComponentClass) && !tariffOptionResultArea.hasClass(disabledClass);
		const tariffOptionResultPrice = tariffOptionResultArea.find('.result-price').attr('data-price');

		if( hasTariffOptionResult && tariffOptionResultPrice ){
			/* CRHQ-7964 [B2C][BC][MX][FR] Enable SIM Tariff display for Simple PD for A series smartphones */
			if( sharedObj.siteCode == 'fr' ){
				totalPrice.original = parseFloat(totalPrice.original);
				totalPrice.sale = parseFloat(totalPrice.sale) + parseFloat(tariffOptionResultPrice);
			} else {
				totalPrice.original = parseFloat(totalPrice.original) - parseFloat(sharedObj.proudctPriceInfo.orignalPrice) + parseFloat(tariffOptionResultPrice);
				totalPrice.sale = parseFloat(totalPrice.sale) - parseFloat(sharedObj.proudctPriceInfo.salePrice) + parseFloat(tariffOptionResultPrice);
			}

			//     
			if(!sharedObj.getOptoinPrice){
				sharedObj.getOptoinPrice = true;
			}
		}
	}

	function settingTariffOptionPriceUK( sharedObj, selectorObj, totalPrice ){
		if( sharedObj.drawObj.tariffOptionResult.hasComponent ){
			if( siteCode === 'uk' ){
				totalPrice.original = parseFloat(totalPrice.original) - sharedObj.proudctPriceInfo.orignalPrice + parseFloat(sharedObj.tariffPrice);
				totalPrice.sale = parseFloat(totalPrice.sale) - sharedObj.proudctPriceInfo.salePrice + parseFloat(sharedObj.tariffPrice);
			}else if( siteCode === 'au' ){
				totalPrice.original = parseFloat(totalPrice.original) - parseFloat(sharedObj.tariffPrice);
				totalPrice.sale = parseFloat(totalPrice.sale) - parseFloat(sharedObj.tariffPrice);
			}

			//     
			if(!sharedObj.getOptoinPrice){
				sharedObj.getOptoinPrice = true;
			}
        }
	}

	/**
	 * Embed AddOn    
	 */
	function settingEmbedAddOnPrice( sharedObj, selectorObj, totalPrice ){
		const hasComponentClass = sharedObj.hasComponentClass;
		const disabledClass = sharedObj.disabledClass;

		const embedAddonArea = selectorObj.buyingToolOptEmbedAddon;
		const hasEmbedAddon = embedAddonArea.hasClass(hasComponentClass);
		const embedAddonPrice = parseFloat(embedAddonArea.find('.add-on-product-list-wrap').attr('data-total-price'));
		const embedAddonSalePrice = parseFloat(embedAddonArea.find('.add-on-product-list-wrap').attr('data-total-sale-price'));

		if( hasEmbedAddon && embedAddonPrice ){
			totalPrice.original = parseFloat(totalPrice.original) + embedAddonPrice;
			totalPrice.sale = parseFloat(totalPrice.sale) + embedAddonSalePrice;
			//     
			if(!sharedObj.getOptoinPrice){
				sharedObj.getOptoinPrice = true;
			}
		}
}

	/**
	 * Choose Between   
	 */
	function clickBetween( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};

		//  
		selectorObj.buyingToolOptBetween.on( 'click', '#pd-leasing-0', eventParam, function ( event ) {

			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			
			//only nl
			if( sharedObj.siteCode === 'nl'){
				if(sharedObj.hasRentalInstallment === true) {
					$('.pd-select-option.financing-info-box-area').show(); // 
				}
				$('.pd-select-option.pd-select-option--type-offer').show(); //  
				//        
				//$('#rentalInstallmentFinancing').show();
			}
			
			if( util.hasBetween( sharedObj, selectorObj ) ){
				util.removeBetweenResult( sharedObj, selectorObj );
				util.totalAfterFunction( sharedObj, selectorObj );
			}
		});

		selectorObj.buyingToolOptBetween.on( 'click', '#pd-leasing-1', eventParam, function ( event ) {
			const _this = $(this);
			const payment = _this.attr("data-payment-value");
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const hasBetween = util.hasBetween( sharedObj, selectorObj );
			const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
			
			//only nl
			if( sharedObj.siteCode === 'nl'){
				if(sharedObj.hasRentalInstallment === true) {
					$('.pd-select-option.financing-info-box-area').hide(); // 
				}
				$('.pd-select-option.pd-select-option--type-offer').hide(); //  
				//        
				//$('#rentalInstallmentFinancing').hide();
			}
			
			if( hasBetween ){
				util.addBetweenResult( sharedObj, selectorObj );
				util.totalAfterFunction( sharedObj, selectorObj );
			}

		});
	}

	function clickTariffPlan( sharedObj, selectorObj ){
		const eventParam = {
				'sharedObj' : sharedObj,
				'selectorObj' : selectorObj
		};

		//  
		selectorObj.buyingToolOptTariffPlan.on( 'click', '#pd-carrier-0', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			util.removeTariffPlanResult( sharedObj, selectorObj );
			util.totalAfterFunction( sharedObj, selectorObj );
		});

		//   
		selectorObj.buyingToolOptTariffPlan.on( 'click', '.option-input:not(#pd-carrier-0)', eventParam, function ( event ) {
			const _this = $(this);
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const tariffPlanSelectedClass = sharedObj.tariffPlanSelectedClass;

			if( util.hasTariffPlan(sharedObj,selectorObj) ){
				util.removeTariffPlanSelectedClass( sharedObj, selectorObj );
				_this.addClass(tariffPlanSelectedClass);
				util.addTariffPlanResult( sharedObj, selectorObj );
				util.totalAfterFunction( sharedObj, selectorObj );
			}
		});
	}

	function clickTradeIn( sharedObj, selectorObj ){
		const eventParam = {
				'sharedObj' : sharedObj,
				'selectorObj' : selectorObj
		};

		// Yes   
		//[COMP6FE-1495] Au Multi TradeIn   -     
		selectorObj.buyingToolOpt.on( 'clicpup', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const shopSkuCode = sharedObj.shopSkuCode;
			const hasTradeIn = util.hasTradeIn( sharedObj, selectorObj );
			const hasOffer = util.hasOffer( sharedObj, selectorObj );
			const pdHrefLang = sharedObj.pdHrefLang;
			const pdMultiLanguageYN = sharedObj.pdMultiLanguageYN;
			const storeDomain = sharedObj.apiDomain;
			const prouductSale = sharedObj.proudctPriceInfo.salePrice;
			const hasForeverResult = util.hasForeverResult( sharedObj, selectorObj );
			const tradeInType = sharedObj.tradeInType;
			let hasCommonTradeInCategory = false;
			let hasBogo = false;
			let hasCombo = false;


			event.preventDefault();

			if( !hasTradeIn ){
				return false;
			}
			
			let isCommonTradeinCheck = new window.sg.components.dynamic.BuyingToolOpUtile().isCommonTradeinCheck();//CRHQ-8032
			if(isCommonTradeinCheck){
				if(sharedObj.isMultiTradeIn ){
					const tradeInIndex = $(event.currentTarget).attr('data-trade-index');
					sharedObj.checkedIndex = -1;
					if( !tradeInIndex && sharedObj.drawObj.tradeInResult.list && sharedObj.drawObj.tradeInResult.list.length >= sharedObj.maxTradeInsAllowed ){
						return false;
					}
					if( tradeInIndex ){
						sharedObj.checkedIndex = tradeInIndex;
					}
				}

				new window.sg.components.dynamic.BuyingToolOpUtile().loadComponent("commontradein");
				bc_common_tradeIn.init(sharedObj.modelCode);
			}else{
				if( siteCode === 'in' ) {
					if( hasOffer ){
						hasBogo = util.hasBogo( sharedObj, selectorObj );
						hasCombo = util.hasComboResult( sharedObj, selectorObj );
					}
					if(tradeInType === 'CE'){ //CE trade in
						window.sg.components.sielTradeInPopup.showPopup();
					}else{/* BoGo  bundle option(Combo)    */
						//[24.01.16][EPP] old exchnage setting
						if($('#isEppPage').val() === 'true'){
							if($(".instant-exchange-popup-hubble").length == 0){
								new window.sg.components.dynamic.BuyingToolOpUtile().loadComponent("instant-exchange");
								window.sg.common.textField.initAll();
							}							
						}else{
							if($(".bc-exchange-popup").length == 0){
								new window.sg.components.dynamic.BuyingToolOpUtile().loadComponent("instant-exchange");
							}
						}
						setTimeout(function(){
							if( hasBogo || hasCombo ){
								configuratorExchange.setExchange( true, prouductSale, hasForeverResult );
							}else{
								configuratorExchange.setExchange( false , prouductSale, hasForeverResult);
							}
							
							if($('#isEppPage').val() === 'true'){
								window.sg.components.instantExchangePopupHubble.showPopup();
							}else{
								window.sg.components.bcExchangePopup.showPopup();
							}
						}, 200)
						
					}
				
				}else if( siteCode === 'uk' && tradeInType === 'CE' ){
					//NOTICE :        (p6-pre-qa    ) 
					if(window.location.host.indexOf("p6-pre-qa3.")>-1){
						const totalPriceValue = selectorObj.buyingToolOptTradeIn.find('#pd-trade-in-0').attr('data-total-price');
						if( !totalPriceValue ){
							sielTradeIn.callSkuDevicesAjax(sharedObj);
						}
						window.sg.components.sielTradeInPopup.showPopup();
					}
				}
				// CE(VD/DA) Trade-up popup
				else if (sharedObj.ceTradeUpPopup.isEnabled) {
					window.CeTradeUpPopup.openPopup();
				}else if( siteCode === 'fr' ){
					// fr  leasingFlag    //new-hybris
					if( sharedObj.isMigrationHybris ){
						let leasingFlag = "";
						let util = sharedObj.util;
						const hasBetween = util.hasBetweenResult( sharedObj, selectorObj );
						const salesPrice = sharedObj.proudctPriceInfo.orignalPrice;

						if( hasBetween ){
							leasingFlag = "LEASE";
						}else{
							leasingFlag = "PURCHASE";
						}

						tradeinData.setTradein( salesPrice, leasingFlag );
						tradeinData.showPopup();
					} else {
						//        .
						// exchange/offers   .
						const objParam = {
								"sku" : shopSkuCode
						};
						// epp  
						if( $('#isEppPage').val() === 'true' ){
							objParam["store_id"] = $('#eppCompanyCode').val();
						}

						$.ajax({
							headers: {
								"Cache-Control": "no-cache",
								"Content-Type": "application/json",
								"Access-Control-Allow-Origin" : "*"
							},
							url: storeDomain + "/v1/exchange/offers",
							type: "POST",
							dataType: "json",
							data: JSON.stringify(objParam),
							xhrFields: { withCredentials: true },
							beforeSend : function(xhr){
								/* multi language    */
								if(pdMultiLanguageYN === "Y"){
									xhr.setRequestHeader("x-ecom-locale", pdHrefLang);
								}
							},
							success : function( data ){
								if( data ){
									let leasingFlag = "";
									let util = sharedObj.util;
									const hasBetween = util.hasBetweenResult( sharedObj, selectorObj );
									const salesPrice = sharedObj.proudctPriceInfo.orignalPrice;

									if( hasBetween ){
										leasingFlag = "LEASE";
									}else{
										leasingFlag = "PURCHASE";
									}

									tradeinData.setTradein(data, salesPrice, leasingFlag);
									tradeinData.showPopup();
								}
							},
							error:function(error){
								/*    Layer Popup  */
								var errorText = "";
								if ( error.responseJSON && error.responseJSON.message ) {
									errorText = error.responseJSON.message;
								}
								confirmPopup(errorText);
							}
						});
					}
				} else if( sharedObj.isMultiTradeIn ){
					//[COMP6FE-1495] Au Multi TradeIn  
					const tradeInIndex = $(event.currentTarget).attr('data-trade-index');
					sharedObj.checkedIndex = -1;
				
					// CRHQ-5944 [B2C][BC][IM] SEBN stackable trade in
	                if( !tradeInIndex && sharedObj.drawObj.tradeInResult.list && sharedObj.drawObj.tradeInResult.list.length >= sharedObj.maxTradeInsAllowed ){
	                    return false; // change     , maxTradeInsAllowed  
	                }
				
					if( tradeInIndex ){
						sharedObj.checkedIndex = tradeInIndex;
					}
					tradeinData.showPopup();
				
				} else {
					tradeinData.showPopup();
				}
			}
		});

		let tradeInRemoveHandler = function(shObj, selObj) {
			const sharedObj = shObj;
			const selectorObj = selObj;
			const util = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const hasForever = util.hasForever( sharedObj, selectorObj );
			const hasUpgradeResult = util.hasUpgradeResult( sharedObj, selectorObj );
			
			// window.sg.components.productDetailKv.optionClose(document.querySelector(".remove-trade-in-result"));
			
			if( drawObj.deliveryResult.priorityText !== null && drawObj.tradeInResult.isUpfront === true ) {
				$(selectorObj.buyingToolOptDeliveryResult).find('.delivery-priority').show();
			}

			//[COMP6FE-1495] Au Multi TradeIn  
			if( sharedObj.isMultiTradeIn ){
				if( sharedObj.checkedIndex > -1 ){
				    // CRHQ-8132 [B2C][MX][KZ] New Trade-In Telekom
				    if (sharedObj.siteCode === 'kz_kz' || sharedObj.siteCode === 'kz_ru') {
				        drawObj.tradeInResult.list.forEach( funct})

				        drawObj.tradeInResult.list.splice(0);
				    } else {
					    drawObj.tradeInResult.list.splice(sharedObj.checkedIndex,1);
				    }
					//CRHQ-6172,CRHQ-7418,CRHQ-7531 [B2C][BC][ID] Trade-in CX 
				    const additionalDiscountFlag=drawObj.tradeInResult.additionalDiscountFlag;
				    if( siteCode === 'sg' || siteCode === 'vn' || siteCode === 'id' || additionalDiscountFlag){// CRHQ-8960
						window.sg.components.dynamic.DetailAfterEvent.tradeInResultSpecialPrice(sharedObj, drawObj.tradeInResult);// CRHQ-8578
					}
					for( var index = 0; index < drawObj.tradeInResult.list.length; index++){
						//  index 
						drawObj.tradeInResult.list[index].index = index;
					}
				} else {
					drawObj.tradeInResult.list = [];
				}

				//   
				// CRHQ-5944 [B2C][BC][IM] SEBN stackable trade in
				if( sharedObj.isMultiTradeIn && drawObj.tradeInResult.list && drawObj.tradeInResult.list.length > 0 ){
					drawObj.tradeInResult.dataPrice = drawObj.tradeInResult.list.reduce((sum, item) => sum+ item.dataPrice,0);

					//trade-in  - price + minOrderEntryValue()
					var excessAmount = Number( drawObj.tradeInResult.dataPrice ) - Number( sharedObj.proudctPriceInfo.salePrice );

					if( sharedObj.minOrderEntryValue ){
					    excessAmount += Number( sharedObj.minOrderEntryValue );
					}
					if( siteCode === 'be' || siteCode === 'be_fr' || siteCode === 'nl' || siteCode === 'sg' || siteCode === 'vn' || siteCode === 'my' || siteCode === 'id' || siteCode === 'fr' || siteCode === 'de' || siteCode === 'sa' || siteCode === 'sa_en'){//CRHQ-8480
						drawObj.tradeInResult.totalAmountText = currencyComma( drawObj.tradeInResult.dataPrice, sharedObj.priceCurrency ); //CRHQ-6829 vn tradeIn 
						if( excessAmount > 0 ){
							drawObj.tradeInResult.priceOverFlag = true;
							drawObj.tradeInResult.excessAmount = excessAmount;
                            drawObj.tradeInResult.tenText = currencyComma( sharedObj.minOrderEntryValue, sharedObj.priceCurrency );
						}else{
							drawObj.tradeInResult.priceOverFlag = false;
						}
					}else{
						if( drawObj.tradeInResult.dataPrice > sharedObj.proudctPriceInfo.salePrice ){
							drawObj.tradeInResult.priceOverFlag = true;
						} else {
							drawObj.tradeInResult.priceOverFlag = false;
						}
					}
				}

				//CRHQ-8318 [B2C] AU tradein - max 'yes please' CTA 
				//confirm popup remove   yes please CTA 
				selectorObj.buyingToolOptTradeIn.find('#pd-trade-in-0').closest('.pd-option-selector').removeClass("cta--disabled").prop("disabled",false);

				if(siteCode == "sg"){
					const $addOtherTradeInBtn = selectorObj.buyingToolOptTradeInResult.find('.limit-count');
					if($addOtherTradeInBtn && $addOtherTradeInBtn.length > 0 && !$addOtherTradeInBtn.is(':visible')){
						$addOtherTradeInBtn.show();
					}
				}
			}

			if( !sharedObj.isMultiTradeIn || drawObj.tradeInResult.list.length == 0 ){
				drawObj.tradeInResult = {
					'hasComponent' : false,
					'description' : '',
					'dataPrice' : '',
					'dataCashBack' : '',
					'dataCash' : '',
					'price' : '',
					'disclaimer' : ''
				};

				window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-trade-in-1"));
				//CRHQ-7126-2 //  
				//CRHQ-8944 [B2C][MX][DE] Stackable Trade-In FOC   
				if(siteCode === 'de'){
					if(sharedObj.hasTradeInFreeGiftPromotion || (sharedObj.isMultiTradeIn && sharedObj.hasStackbleTradeInFreeGiftPromotion)){
					sharedObj.hasGift = true;
					window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
					}
				}
			}else if(drawObj.tradeInResult.list.length == 1){
				if(siteCode === 'de'){
					if(sharedObj.isMultiTradeIn && sharedObj.hasStackbleTradeInFreeGiftPromotion && !sharedObj.hasTradeInFreeGiftPromotion){
						sharedObj.hasGift = true;
						window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
					}
				}
			}

			sharedObj.exchangeApiData = {
				exchangeFlag : false
			};
			view.tradeInResultDraw( drawObj );

			if( hasUpgradeResult ){
				view.upgradeResultDraw( drawObj ); // tradeIn   upgrade     
			}

			if( hasForever ){
				util.foreverDraw( sharedObj, selectorObj ); // forever     
			}

			util.totalAfterFunction( sharedObj, selectorObj );

			//[COMP6FE-1495] Au Multi TradeIn   - tradeIn   
			if( sharedObj.isMultiTradeIn ){
				if(!util.hasTradeInResult( sharedObj, selectorObj )){
					delete sharedObj.globalServiceInfo.tradein;
				}
			} else if(sharedObj.globalServiceInfo.tradein) {
				delete sharedObj.globalServiceInfo.tradein;
			}

			const returnFocus = $(selectorObj.buyingToolOptTradeIn).find('input[data-target-popup="deleteTradeInPopUp"]')

			if( returnFocus ){
				returnFocus.focus();
			}

			// CRHQ-8831 (fr) tradein  sc+: monthly hide 
			if( siteCode === 'fr' ){
				if( $('.option-care').hasClass('has-component') ){
					const careList = $('.option-care .pd-select-option__list--samsung-care input');
					careList.each((i, e)=>{
					    if( careList.eq(i).attr('data-paymentcycle') === 'monthly' ){
					    	careList.eq(i).removeAttr('disabled');
					    }
					});
				}
			}
		};

		// No   
		selectorObj.buyingToolOpt.on( 'click', '#pd-trade-in-1, .remove-trade-in-result', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const siteCode = sharedObj.siteCode;
			
			const hasResult = util.hasTradeInResult( sharedObj, selectorObj );
			//window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-trade-in-1")); //  ( )   

			//[COMP6FE-1495] Au Multi TradeIn   -     
			if( sharedObj.isMultiTradeIn ){
				const tradeInIndex = $(event.currentTarget).attr('data-trade-index');
				sharedObj.checkedIndex = -1;
				if( tradeInIndex ){
					sharedObj.checkedIndex = tradeInIndex;
				}
			}

			if( hasResult ){
				// using CE(VD/DA) Trade-up Popup
				//
				if (sharedObj.ceTradeUpPopup.isEnabled) {
					window.CeTradeUpPopup.showResetConfirmPopup(function() {
						tradeInRemoveHandler(sharedObj, selectorObj);
					});
				}
				// otherwise
				//
				else {
					let msg = Granite.I18n.get("Selected options will be reset.")+"<br>"+Granite.I18n.get("Do you want to proceed?");
					if( siteCode === 'ee' || siteCode === 'lv' || siteCode === 'lt' || siteCode === 'pl' || siteCode === 'at' || siteCode === 'kz_kz' || siteCode === 'kz_ru' || siteCode === 'ro'){
						msg = Granite.I18n.get("You're sure you want to delete this item?");
					}else if( siteCode === 'pe' ){
						msg = Granite.I18n.get("Do you want to proceed?");
					}else if( siteCode === 'au' || siteCode === 'jp'){
						msg = ' ';
					}
					$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-trade-in");

					confirmPopup(msg,'delete');
					if( siteCode === 'au' ){
						$(".confirm-popup").find(".confirm-popup__title").html(Granite.I18n.get("Are you sure you want to remove this item?"));
						$(".confirm-popup").find('.cta--black'). html(Granite.I18n.get("Cancel"));
						$(".confirm-popup").find('.cta--emphasis'). html(Granite.I18n.get("Remove"));
					}else if( siteCode === 'kz_kz' || siteCode === 'kz_ru' ){
						$(".confirm-popup").find(".confirm-popup__title").html(Granite.I18n.get("Remove"));
					}I18n.get("Selected options will be reset."));
					}

					if( siteCode === 'pl'){
						$(".confirm-popup").find(".confirm-popup__title").html(Granite.I18n.get("Delete"));
					}

					if( siteCode === 'ro' || siteCode === 'jp'){
						$(".confirm-popup").find(".confirm-popup__title").html(Granite.I18n.get("Selected options will be reset.(Trade-In)"));
					}

					util.settingCommonPopupTagging( 'tradeIn' , sharedObj, selectorObj );
					if(sharedObj.tradeInType =="CE"){
						sielTradeIn.initializeStep("all");
					}
				}
			} else {
				window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-trade-in-1"));
			}

		});

		// learnMore 
		selectorObj.buyingToolOptTradeIn.on( 'click', '.cta[data-target-popup="tradeInLearnMorePopup"]', eventParam, function ( event ) {
			window.sg.components.tradeInLearnMorePopup.showPopup();
		});

		//     
		$('.confirm-popup').on( 'click', '.cta[data-event-type="remove-trade-in"]', eventParam, function ( event ) {
			tradeInRemoveHandler(event.data.sharedObj, event.data.selectorObj);
		});
	}

	function clickTariffOption( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};

		// Yes Tariff Option  
		selectorObj.buyingToolOptTariff.on( 'click', '#pd-tariff-option-0', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const hasComponent = util.hasTariffOption( sharedObj, selectorObj );

			event.preventDefault();

			if( !hasComponent ){
				return false;
			}
			if(sharedObj.isMigrationHybris ){
				tariffData.showPopup();
			} else if( sharedObj.apiFlag === 'GPv2' ) {
				tariffData.setTariff(sharedObj.syndiProductData);
			} else {
				tariffData.showPopup(sharedObj.hybrisApiData.tarriffOption);
			}

		});

		// No   
		selectorObj.buyingToolOpt.on( 'click', '#pd-tariff-option-1, .remove-tariff-option-result', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;

			const hasResult = util.hasTariffOptionResult( sharedObj, selectorObj );

			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-tariff-option-1"));

			if( hasResult ){
				const msg = Granite.I18n.get("Selected options will be reset.")+"<br>"+Granite.I18n.get("Do you want to proceed?");
				$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-tariff-option");
				confirmPopup(msg,'delete');
				util.settingCommonPopupTagging( 'tariffOption' , sharedObj, selectorObj );
			}

		});

		// learnMore 
		selectorObj.buyingToolOptTariff.on( 'click', '.cta[data-target-popup="tariffInfoPopup"]', eventParam, function ( event ) {
			window.sg.components.tariffInfoPopup.showPopup();
		});

		//      
		$('.confirm-popup').on( 'click', '.cta[data-event-type="remove-tariff-option"]', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;

			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-tariff-option-1"));

			drawObj.tariffOptionResult = {
				'hasComponent' : false,
				'displayModelName' : null,
				'discountText1' : null,
				'description1' : null,
				'description2' : null,
				'dataPrice' : null,
				'dataSimskuCode' : null,
				'dataModelCode' : null,
				'dataId' : null
			};

			// CRHQ-8914 [B2C][MX][DE] [SIM-Service] customize free-gift based on the planID
			// CRHQ-5597 [B2C][BC][IM] DE SIM     split : trariff  CRHQ-7126
			if (sharedObj.siteCode === 'de') {
			    var relatedProductsObj = window.sg.components.dynamic.detailSharedObj.relatedProductsObj;
			    var relatedProductsBundle = window.sg.components.dynamic.freeGiftHybrisCommon.relatedProductsBundle;

			    if (sharedObj.hasTariffGift) {
			        if ( util.isNotEmpty(relatedProductsObj) ) {
			            //  
			            relatedProductsBundle = {};
			            sharedObj.hasGift = true;
			            sharedObj.hasGiftBundle = false;
			            window.sg.components.dynamic.freeGiftHybrisCommon.relatedProductsSimpleInfoSuccessCallBackFunc( relatedProductsObj, sharedObj, relatedProductsBundle );
			            window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
			        } else {
			            sharedObj.hasGift = false;
			            window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(false);
			        }
			    }

			    if (sharedObj.hasPlanIDAndFreeGiftPromotion) {
			        sharedObj.hasGift = true;
                    window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
			    }
			}

			view.tariffOpionResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
			if(sharedObj.globalServiceInfo.tariff) {
				delete sharedObj.globalServiceInfo.tariff;
			}
		});
		
	}
	
	function clickGift( sharedObj, selectorObj ){
		const offerArea = selectorObj.buyingToolOptOffer;
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		// Gift Add to basket   //new-hybris
		offerArea.on( 'click', '.pd-offer__item.giftBundle .s-btn-gift-popup', eventParam, function ( event ) {
			const _this = $(this);
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const giftArea = _this.closest('.giftBundle');
			const disabledClass = sharedObj.disabledClass;
			const hasComponent = util.hasOffer( sharedObj, selectorObj ) && !giftArea.hasClass( disabledClass );
			let giveIndex =  $(this).attr("data-gift-idx");
			if( giveIndex === '0' ){
				giveIndex = null; 
			}
			sharedObj.checkedGiftArea = giftArea;
			
			if( hasComponent ){
				if( sharedObj.isGpv2 ){
					window.sg.components.dynamic.freeGiftGPv2.giftPopupGrid( giveIndex );
				} else if( sharedObj.isMigrationHybris ){
					window.sg.components.dynamic.freeGiftNewHybris.giftPopupGrid( giveIndex );
				} else {
					window.sg.components.dynamic.freeGiftHybris.giftPopupGrid( giveIndex );
				}
				

			}
		});
		
		//   
		offerArea.on( 'click', '.pd-offer__item.giftBundle .pd-offer__selected-bundle-cancel', eventParam, function ( event ) {
			const _this = $(this);
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const index = _this.attr('data-event-index');
			const msg = Granite.I18n.get("Selected options will be reset.")+"<br>"+Granite.I18n.get("Do you want to proceed?");
			const util = sharedObj.util;
			
			$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-gift");
			$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-index", index);
			confirmPopup(msg,'delete');
			util.settingCommonPopupTagging( 'combo' , sharedObj, selectorObj );
		});

		//     
		$('.confirm-popup').on( 'click', '.cta[data-event-type="remove-gift"]', eventParam, function ( event ) {
			const _this = $(this);
			const removeIndex = _this.attr('data-event-index');
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const giftList = drawObj.offer.gift.item.bundleList;
			
			giftList.splice(removeIndex,1);
			if( giftList.length < 1 ){
				drawObj.offer.gift.item.hasBundle = false;
				drawObj.offer.gift.item.learnMoreCta.giftIdx = 0; 
			} else {
				for(var bundleListIndex in giftList ){
					const bundleItem = giftList[bundleListIndex];
					bundleItem.dataEventType = bundleListIndex;
				}
			}
			
			view.productOfferDraw( drawObj );
			
		});
		
	}
	
	function clickCombo( sharedObj, selectorObj ){
		const offerArea = selectorObj.buyingToolOptOffer;
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		// Combo Add to basket  
		offerArea.on( 'click', '.pd-offer__item.compoBundle .s-btn-combo-popup', eventParam, function ( event ) {
			const _this = $(this);
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const comboArea = _this.closest('.compoBundle');
			const disabledClass = sharedObj.disabledClass;
			const hasComponent = util.hasOffer( sharedObj, selectorObj ) && !comboArea.hasClass( disabledClass );
			const index = comboArea.attr('data-combo-index');
			const selectedDataIdx = [];
			sharedObj.checkedComboArea = comboArea;
			
			if( hasComponent ){
				if( comboArea.find(".pd-offer__selected-bundle").length > 0 ){
					comboArea.find(".pd-offer__selected-bundle").each(function(){
						selectedDataIdx.push($(this).attr("data-index"));
					});
				}
				
				window.sg.components.dynamic.comboPopup.comboPopupGrid(sharedObj.globalComboData[index],selectedDataIdx);
				window.sg.components.shopComboPopup.showPopup();

			}
		});
		
		//   
		offerArea.on( 'click', '.pd-offer__item.compoBundle .pd-offer__selected-bundle-cancel', eventParam, function ( event ) {
			const _this = $(this);
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const index = _this.attr('data-event-index');
			const msg = Granite.I18n.get("Selected options will be reset.")+"<br>"+Granite.I18n.get("Do you want to proceed?");
			const util = sharedObj.util;
			
			$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-combo");
			$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-index", index);
			confirmPopup(msg,'delete');
			util.settingCommonPopupTagging( 'combo' , sharedObj, selectorObj );
		});

		//     
		$('.confirm-popup').on( 'click', '.cta[data-event-type="remove-combo"]', eventParam, function ( event ) {
			const _this = $(this);
			const targetList = _this.attr('data-event-index').split('-');
			const comboAreaIndex = Number(targetList[1]);
			const comboItemIndex = Number(targetList[2]);
			const view = sharedObj.view;
			const util = sharedObj.util;
			const drawObj = sharedObj.drawObj;
			const comboList = drawObj.offer.combo;
			
			let selectedCombo= null;
			
			for(var index in comboList ){
				const comboItem = comboList[index];
				if( comboItem.comboIndex === comboAreaIndex ){
					selectedCombo = comboItem;
					break;
				}
			}
			
			if( selectedCombo ){
				const bundleList  = selectedCombo.item.bundleList;
				bundleList.splice(comboItemIndex,1)
				if( bundleList.length < 1 ){
					selectedCombo.hasBundle = false;
				}
				
				for(var bundleListIndex in bundleList ){
					const bundleItem = bundleList[bundleListIndex];
					bundleItem.dataEventType = 'combo-'+comboAreaIndex+'-'+bundleListIndex;
				}
			}
			
			view.productOfferDraw( drawObj, true );
			view.tradeInResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
			if(sharedObj.globalServiceInfo.combo) {
				delete sharedObj.globalServiceInfo.combo;
			}
		});
		
	}
	
	function clickUpgrade( sharedObj, selectorObj ){
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		// Yes Upgrade  
		selectorObj.buyingToolOptUpgrade.on( 'click', '#pd-samsung-upgrade-0', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const _this = $(this);
			const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
			const hasCareResult = util.hasCareResult( sharedObj, selectorObj );
			const hasComponent = util.hasUpgrade( sharedObj, selectorObj );
			const eupData = sharedObj.eupData;
			const isHybrisSplitPDUpgrade = sharedObj.isHybrisSplitPDUpgrade;	
			const drawObj = sharedObj.drawObj;
			const view = sharedObj.view;
			
			//  ?  .
			let isHybrisUpgrade = false;
			isHybrisUpgrade = _this.hasClass('hybris-es-yes');
			
			if(isHybrisUpgrade) {
				// /////event.preventDefault();
				
				//  triggerChange       ...
				$('#pd-samsung-upgrade-0').attr('checked','checked');
				$('#pd-samsung-upgrade-1').prop('checked',false);
				
				// TODO : description1    i18n 
				//   
				drawObj.upgradeResult = {
						'hasComponent' : true,
						'displayModelName' : null,
						'discountText1' : null,
						'description1' : 'Con Samsung Upgrade, Disfruta de seguro Gratis! **',
						'description2' : null,
						'dataId' : ['0'],
						'dataPrice' : 0,
						'isHybris' : true,
						'isGp' : false
				};
				
				
				view.upgradeResultHybrisDraw( drawObj );
				window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-upgrade-0"));
				util.totalAfterFunction( sharedObj, selectorObj );
				
				// NOTICE : upgrade    "Con Samsung Upgrade, Disfruta de
				// seguro Gratis! *(disclaimer description)"  et('With Samsung Upgrade, Enjoy Free Insurance!'));
				// NOTICE :    CTA "Financiacin a 24 meses. Tipo
				// Deudor Fijo 0,00%, T.A.E. 0,00%*"  
				$('#pd-rewards-msg').text(Granite.I18n.get('Financing for 24 months. Fixed Debtor Rate 0.00%, T.A.E. 0,00%*'));
				
			} else {
				/* EUP    ->  Trade-In, Samsung Care+   */
				event.preventDefault();
				
				if( !hasComponent ){
					return false;
				}
				
				//   , GP  
				if( hasTradeInResult ){
					if( sharedObj.tradeInSelectCnt === 0) {
						eupData.salePrice = eupData.salePrice - sharedObj.tradeInSelectPrice;
						sharedObj.tradeInSelectCnt++;
					}
				}else{
					if(sharedObj.tradeInSelectCnt === 1){
						eupData.salePrice = eupData.salePrice + sharedObj.tradeInSelectPrice;
						sharedObj.tradeInSelectCnt--;
					}
				}
				
				if( hasCareResult ){
					if( sharedObj.smcSelectCnt === 0 ) {
						eupData.salePrice = eupData.salePrice + sharedObj.smcSelectPrice;
						sharedObj.smcSelectCnt++;
					}
				}else{
					if( sharedObj.smcSelectCnt === 1 ){
						eupData.salePrice = eupData.salePrice - sharedObj.smcSelectPrice;
						sharedObj.smcSelectCnt--;
					}
				}
				buyingPdEup.eupPopupGrid( sharedObj.eupData );
			}

			
			
		});
		
		// No   
		selectorObj.buyingToolOpt.on( 'click', '#pd-samsung-upgrade-1, .remove-upgrade-result', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const _this = $(this);
			const hasResult = util.hasUpgradeResult( sharedObj, selectorObj );
			const drawObj = sharedObj.drawObj;
			const view = sharedObj.view;
			
			
			
			//  ?  .
			let isHybrisUpgrade = false;
			isHybrisUpgrade = _this.hasClass('hybris-es-no');
			
			if(isHybrisUpgrade) {
				// /////event.preventDefault();

				//  triggerChange       ...
				$('#pd-samsung-upgrade-1').attr('checked','checked');
				$('#pd-samsung-upgrade-0').prop('checked',false);
				
				
				//   
				drawObj.upgradeResult = {
						'hasComponent' : false,
						'displayModelName' : null,
						'discountText1' : null,
						'description1' : null,
						'description2' : null,
						'dataId' : [],
						'dataPrice' : null,
						'isHybris' : true,
						'isGp' : false
				};
					 
				view.upgradeResultHybrisDraw( drawObj );
				window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-upgrade-1"));
				util.totalAfterFunction( sharedObj, selectorObj );
				
				//NOTICE : upgrade    "Con Samsung Upgrade, Disfruta de seguro Gratis! *(disclaimer description)"   
				$(selectorObj.buyingToolOptUpgrade).find('.pd-select-option__desc.selected-disclaimer').text('');
				//NOTICE :    CTA "Financiacin a 24 meses. Tipo Deudor Fijo 0,00%, T.A.E. 0,00%*"   ( )
		
				if( $('#isEppPage').val() === 'true' && sharedObj.siteCode ==='es' ){
					$('#pd-rewards-msg').text(Granite.I18n.get('Earn 1% back in rewards (for Rewards members only)_epp'));
				} else {
					$('#pd-rewards-msg').text(Granite.I18n.get('Earn 1% back in rewards (for Rewards members only)'));
				}
			} else {
				window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-upgrade-1"));
				
				//   , GP  
				if( hasResult ){
					const msg = Granite.I18n.get("Selected options will be reset.")+"<br>"+Granite.I18n.get("Do you want to proceed?");
					$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-upgrade");
					confirmPopup(msg,'delete');
					util.settingCommonPopupTagging( 'upgrade' , sharedObj, selectorObj );
				}
				
			}
			

			
		});
		
 
		//      
		$('.confirm-popup').on( 'click', '.cta[data-event-type="remove-upgrade"]', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			drawObj.upgradeResult = {
				'hasComponent' : false,
				'displayModelName' : null,
				'discountText1' : null,
				'description1' : null,
				'description2' : null,
				'dataId' : [],
				'dataPrice' : null,
				'isHybris' : false,
				'isGp' : true
			};
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-upgrade-1"));
			
			view.upgradeResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
		});
		
		
		// learnMore 
		selectorObj.buyingToolOptUpgrade.on( 'click', '.cta[data-target-popup="upgradeLearnMorePopup"]', eventParam, function ( event ) {
			window.sg.components.upgradeLearnMorePopup.showPopup();
		});

	}
	
	function clickAssured( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		// Assure  
		selectorObj.buyingToolOptAssuredBuyBack.on( 'click', '#pd-galaxy-assured-1', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const hasComponent = util.hasAssuredBuyBack( sharedObj, selectorObj );
			
			event.preventDefault();
			
			if( !hasComponent ){
				return false;
			}
			
			let originalSalePrice = '';
			const originalDisplayName = sharedObj.syndiProductData.product_display_name ? sharedObj.syndiProductData.product_display_name : '';
			
			if( sharedObj.proudctPriceInfo.salePrice ){
				originalSalePrice = currencyComma( sharedObj.proudctPriceInfo.salePrice, sharedObj.priceCurrency );
			} else if( sharedObj.proudctPriceInfo.orignalPrice ){
				originalSalePrice = currencyComma( sharedObj.proudctPriceInfo.orignalPrice, sharedObj.priceCurrency );
			}
			
			assuredBuybackData.assuredBuybackGrid( originalDisplayName, originalSalePrice, sharedObj.totalSkuList[sharedObj.assuredSku] );
			
		});
		
		// No   
		selectorObj.buyingToolOptAssuredBuyBack.on( 'click', '#pd-galaxy-assured-0', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			
			const hasResult = util.hasAssuredBuyBackResultResult( sharedObj, selectorObj );
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-galaxy-assured-0"));
			
			if( hasResult ){
				const msg = Granite.I18n.get("Selected options will be reset.")+"<br>"+Granite.I18n.get("Do you want to proceed?");
				$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-assured");
				confirmPopup(msg,'delete');
				
				util.settingCommonPopupTagging( 'assured' , sharedObj, selectorObj );
			}
			
		});
		
		
		//      
		$('.confirm-popup').on( 'click', '.cta[data-event-type="remove-assured"]', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			
			drawObj.assuredBuyBackResult = {
				'hasComponent' : false,
				'dataSku' : null,
				'dataPrice' : null,
				'dataSalePrice' : null
			};
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-galaxy-assured-0"));

			view.assuredBuyBackResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
			
		});
	}
	
	function clickForever( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		// forever  
		selectorObj.buyingToolOptGalaxyForever.on( 'click', '#pd-samsung-galaxy-forever-0', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const hasComponent = util.hasForever( sharedObj, selectorObj );
			const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
			const exchangeApiData = sharedObj.exchangeApiData;
			const priceCurrency = sharedObj.priceCurrency;
			const hasBogo = util.hasBogo( sharedObj, selectorObj );
			const hasCombo = util.hasComboResult( sharedObj, selectorObj );
			
			event.preventDefault();
			
			if( !hasComponent ){
				return false;
			}
			if( hasTradeInResult && exchangeApiData.addtionalPrice && !hasBogo && !hasCombo ){
				const msg = Granite.I18n.get('Along with Galaxy Forever benefit, you will not be entitled for additional exchange bonus ({0}). However, you can avail the regular exchange benefit.',currencyComma( exchangeApiData.addtionalPrice, priceCurrency ));
				$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "open-forever-popup");
				confirmPopup(msg,'delete');
			} else {
				buyingPdForever.foreverPopupGrid( sharedObj.foreverFinanceInfo ); // forever  
			}
			
		});
		
		//      
		$('.confirm-popup').on( 'click', '.cta[data-event-type="open-forever-popup"]', eventParam, function ( event ) {
			buyingPdForever.foreverPopupGrid( sharedObj.foreverFinanceInfo ); // forever  
		});
		
		// No   
		selectorObj.buyingToolOpt.on( 'click', '#pd-samsung-galaxy-forever-1, .remove-forever-result', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			
			const hasResult = util.hasForeverResult( sharedObj, selectorObj );
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-galaxy-forever-1"));
			
			if( hasResult ){
				const msg = Granite.I18n.get("Selected options will be reset.")+"<br>"+Granite.I18n.get("Do you want to proceed?");
				$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-forever");
				confirmPopup(msg,'delete');
				
				util.settingCommonPopupTagging( 'forever' , sharedObj, selectorObj );
			}
		});
		
		// learnMore  >>   
		selectorObj.buyingToolOptWarranty.on( 'click', '.cta[data-target-popup=""]', eventParam, function ( event ) {
			// window.sg.components.hubbleCareinfoPopup.showPopup();
		});
		
		//      
		$('.confirm-popup').on( 'click', '.cta[data-event-type="remove-forever"]', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
			
			drawObj.galaxyForeverResult = {
				'hasComponent' : false,
				'displayModelName' : null,
				'discountText1' : null,
				'description1' : null,
				'description2' : null,
				'dataId' : [],
				'dataPrice' : null
			};
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-galaxy-forever-1"));

			view.galaxyForeverResultDraw( drawObj );
			if( hasTradeInResult ){
				util.exchangeResultDraw( sharedObj, selectorObj );
			}
			
			util.totalAfterFunction( sharedObj, selectorObj );
			
			if( util.hasCare( sharedObj, selectorObj ) ){
				selectorObj.buyingToolOptCare.show(); // care 
				window.sg.components.productDetailKv.reInit(); //   css 
			}
		});
	}
	
	function clickWarranty( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		// Warranty  
		selectorObj.buyingToolOptWarranty.on( 'click', '#pd-samsung-warranty-0', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			
			event.preventDefault();
			
			const hasComponent = util.hasWarranty( sharedObj, selectorObj );
			if( !hasComponent ){
				return false;
			}
			
			configuratorWarranty.setProductInfo( sharedObj.finalWarrantyList );
			
		});
		
		selectorObj.buyingToolOptWarrantyVd.on( 'click', '#pd-extended-warranty-option-0', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			
			event.preventDefault();
			
			const hasComponent = util.hasWarrantyVd( sharedObj, selectorObj );
			if( !hasComponent ){
				return false;
			}
			
			configuratorWarrantyVD.setProductInfo();
			
		});
		
		// No   
		selectorObj.buyingToolOpt.on( 'click', '#pd-samsung-warranty-1, .remove-warranty-result', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			
			const hasResult = util.hasWarrantyResult( sharedObj, selectorObj );
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-warranty-1"));
			
			if( hasResult ){
				const msg = Granite.I18n.get("Selected options will be reset.")+"<br>"+Granite.I18n.get("Do you want to proceed?");
				$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-warranty");
				confirmPopup(msg,'delete');on ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			
			const hasResult = util.hasWarrantyVdResult( sharedObj, selectorObj );
			
			if( hasResult ){
				const msg = Granite.I18n.get("VD_Extended Warranty Popup_Delete Warranty");
				if(siteCode == "mx"){//CRHQ-8470
					$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained').attr("data-event-type", "remove-warranty-vd");
					confirmPopup(msg, "delete", "",document.querySelector(".option-result--extended-warranty-option"));
					const alertlayer = $(".confirm-popup");
					const alertTitle = alertlayer.find(".confirm-popup__title");
					const alertYes = alertlayer.find(".cta--contained");
					const alertNo = alertlayer.find(".cta--outlined");
					alertTitle.html(Granite.I18n.get("Las opciones seleccionadas se eliminaran"));
					alertYes.html(Granite.I18n.get("VD_Extended Warranty_YES"));
					alertNo.html(Granite.I18n.get("VD_Extended Warranty_NO"));
				}else{
					$('.confirm-popup-v2 .confirm-popup-v2__cta-wrap .cta.cta--contained').attr("data-event-type", "remove-warranty-vd");
					confirmPopupV2(msg, 'delete warranty', '', document.querySelector(".option-result--extended-warranty-option"));	
				}
				
			}
		});
		
		// learnMore  >>   
		selectorObj.buyingToolOptWarranty.on( 'click', '.cta[data-target-popup="hubbleCareinfoPopup"]', eventParam, function ( event ) {
			window.sg.components.hubbleCareinfoPopup.showPopup();
		});
		
		//      
		$('.confirm-popup').on( 'click', '.cta[data-event-type="remove-warranty"]', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			drawObj.warrantyResult = {
				'hasComponent' : false,
				'displayModelName' : null,
				'discountText1' : null,
				'description1' : null,
				'dataPrice' : null,
				'dataSalePrice' : null,
				'dataModelName' : null,
				'dataModelCode' : null,
				'dataId' : null,
				'savedPrice' : null
			};
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-warranty-1"));

			view.warrantyResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
		});
		
		$('.confirm-popup-v2,.confirm-popup').on( 'click', '.cta[data-event-type="remove-warranty-vd"]', eventParam, function ( event ) {//CRHQ-8470
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pds.productDetailKv.optionClose(document.querySelector(".option-result--extended-warranty-option"));
			
			drawObj.warrantyVdResult = {
					'hasComponent' : false,
					'title' : null,
					'price' : null,
					'smcCode' : null,
					'description'dResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
			if(siteCode == "mx"){//CRHQ-8470
				$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained').attr("data-event-type", "");	
			}
			//summary    
			$(".summary__product-price").hide();
			$(".pd-buying-tool__cost-box .summary .warranty-wrap").hide();
		});
	}
	
	function clickCare( sharedObj, selectorObj ) {
		const e		 * CRHQ-9202 [B2C][MX][UK] SC+ */
        selectorObj.buyingToolOptCare.on( 'click', '.open-grid', eventParam, function ( event ) {
            const _this = $(this);
            const _targetTag = _this.closest(".pd-option-selector").siblings();
            const _targetUlTag = _this.closest(".pd-select-option__list--samsung-care");

            _targetUlTag.find(".pd-select-option__payment").each(function(index, item){
                if ( !$(item).hasClass('hidden') ) {
                    $(item).addClass('hidden');
                }
            });

            _targetTag.removeClass("hidden");
        });

		// Care  
		selectorObj.buyingToolOptCare.on( 'click', '.open-popup', eventParam, function ( event ) {
			const _this = $(this);
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const isNotGpv2 = sharedObj.isNotGpv2;
			const util = sharedObj.util;

			// CRHQ-9202 [B2C][MX][UK] SC+   UI 
			// CRHQ-9703 [B2C][MX][SENA] SC+   UI 
			const drawObj = sharedObj.drawObj;
			const index = drawObj.care.isSmcType2 ? Number( _this.attr('data-index') ) : Number( _this.attr('data-index') ) - 1;
			const hasComponent = util.hasCare( sharedObj, selectorObj );
			const setPopupData = [];
		
			event.preventDefault();
			
			if( !hasComponent ){
				return false;
			}

			if( isNotGpv2 || sharedObj.isMigrationHybris ){
				const deliveredData = $.extend({}, sharedObj.hybrisCareData);
				let careInfoList = deliveredData.smcs;
				let careItem = careInfoList[index];

				setPopupData.push(careItem); // api  List   1 api    
				deliveredData.smcs = setPopupData;

				if(_this.attr("data-prePopup") == "true"){
					configuratorCare.showPrePopup(deliveredData, _this);
				}else{
					configuratorCare.showPopup(deliveredData, _this); // CRHQ-9703 [B2C][MX][SENA] SC+   UI 
				}

			} else {
				setPopupData.push(sharedObj.finalCareList[index])
				configuratorCare.setProductInfo( setPopupData );
			}
			
			sharedObj.popupReturnObj = _this;
			
		});
		
		// No   
		selectorObj.buyingToolOptCare.on( 'click', '#pd-samsung-care-0', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			// CRHQ-9202 [B2C][MX][UK] SC+   UI 
			// CRHQ-9703 [B2C][MX][SENA] SC+   UI 
			const drawObj = sharedObj.drawObj;
			const isSmcType2 = drawObj.care.isSmcType2;
			const util = sharedObj.util;
			const siteCode = sharedObj.siteCode;
			const hasResult = util.hasCareResult( sharedObj, selectorObj );
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-care-0"));
			
			if( hasResult ){
				if(siteCode === 'pt'){
					const msg = Granite.I18n.get("The selected option will be deleted.")+"<br>"+Granite.I18n.get("Do you want to proceed?");
					$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-care");
					confirmPopup(msg,'delete');
					
					util.settingCommonPopupTagging( 'care' , sharedObj, selectorObj );
				}else{
				    // CRHQ-9202 [B2C][MX][UK] SC+   UI 
				    // CRHQ-9703 [B2C][MX][SENA] SC+   UI 
                    if (isSmcType2) {
                        window.sg.components.productDetailKv.triggerChange(sharedObj.popupReturnObj.closest("li").find(".open-grid").get(0));
                    }

					const msg = Granite.I18n.get("Selected options will be reset.")+"<br>"+Granite.I18n.get("Do you want to proceed?");
					$('.confirm-popup .confirm-popup__cta-wrap .cta.cta--contained.cta--emphasis').attr("data-event-type", "remove-care");
					confirmPopup(msg,'delete');
					
					util.settingCommonPopupTagging( 'care' , sharedObj, selectorObj );
				}
			} else {
			    // CRHQ-9202 [B2C][MX][UK] SC+   UI 
			    // CRHQ-9703 [B2C][MX][SENA] SC+   UI 
                if (isSmcType2) {
                    const _this = $(this);
                    const _targetUlTag = _this.closest(".pd-select-option__list--samsung-care");

                    _targetUlTag.find(".pd-select-option__payment").each(function(index, item){
                        if ( !$(item).hasClass('hidden') ) {
                            $(item).addClass('hidden');
                        }
                    });
                }
			}
			
		});
		
		// learnMore 
		selectorObj.buyingToolOptCare.on( 'click', '.cta[data-target-popup="hubbleCareinfoPopup"]', eventParam, function ( event ) {
			window.sg.components.hubbleCareinfoPopup.showPopup();
		});
		
		selectorObj.buyingToolOptCare.on( 'click', '.cta[data-target-popup="scLearnMorePopup"]', eventParam, function ( event ) {
			window.sg.components.scLearnMorePopup.showPopup();
		});
		
		//      
		$('.confirm-popup').on( 'click', '.cta[data-event-type="remove-care"]', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			drawObj.careResult = {
				'hasComponent' : false,
				'description' : '',
				'dataPrice' : '',
				'dataSalePrice' : '',
				'dataModelName' : '',
				'dataModelCode' : '',
				'dataId' : '',
				'price' : '',
				'disclaimer' : ''
			};
			
			//CRHQ-8831 [B2C] FR tradein <> sc+ monthly  
			if(siteCode === "fr"){
				if($(".pd-select-option.trade-in").length > 0){
					$(".pd-select-option.trade-in input").attr("disabled", false);
				}
			}
			
			// CRHQ-9202 [B2C][MX][UK] SC+   UI 
            if (drawObj.care.isSmcType2) {
			    sharedObj.popupReturnObj.get(0).checked = false;

                const _targetUlTag = $(".option-care ul.pd-select-option__list--samsung-care");

                _targetUlTag.find(".pd-select-option__payment").each(function(index, item){
                    if ( !$(item).hasClass('hidden') ) {
                        $(item).addClass('hidden');
                    }
                });
            }

			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-care-0"));

			view.careResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
		});
	}
	
	function clickEmbedAddOn( sharedObj, selectorObj ){
		const eventParam = {
				'sharedObj' : sharedObj,
				'selectorObj' : selectorObj
		};
		
		selectorObj.buyingToolOptEmbedAddon.on( 'click', 'ul li input', eventParam, function ( event ) {
			const _this = $(this);
			const sharedObj = event.data.sharedObj;
			const services = sharedObj.globalServiceInfo;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const currency = $("#priceCurrency").val();
			const embedAddonWrap = $('.option-embed-addon .add-on-product-list-wrap');
			const totalPrice = parseFloat(embedAddonWrap.attr('data-total-price'));
			const totalSalePrice = parseFloat(embedAddonWrap.attr('data-total-sale-price'));
			const finalPriceWrap = _this.closest('li').find('.add-on-product__final-price');
			const originalPriceWrap = _this.closest('li').find('.add-on-product__original-price');
			const savePriceWrap = _this.closest('li').find('.add-on-product__saving-price');
			const price = parseFloat(finalPriceWrap.attr('data-price'));
			const originalPrice = savePriceWrap.attr('data-save-price') ? parseFloat(originalPriceWrap.attr('data-original-price')) : parseFloat(finalPriceWrap.attr('data-price'));
			const salePrice = parseFloat(finalPriceWrap.attr('data-price'));
			const idx = _this.attr('id');
			const modelName = _this.closest('li').find('.add-on-product__title').attr('data-model-name');
			const modelCode = _this.closest('li').find('.add-on-product__serial-number').attr('data-model-code');

			const embedAddonList = sharedObj.drawObj.embedAddon.itemSet;
			const embedAddonCodeList = [];
			for( const elem of embedAddonList ){
				embedAddonCodeList.push(elem.modelCode);
			}
			let embedAddonPMT = '';
			
			if( _this.is(":checked") ){
				if( services.embedaddon && services.embedaddon.length > 0 ){
					services.embedaddon.push(modelCode);
				}else{
					services.embedaddon = [modelCode];
				}
				embedAddonWrap.attr('data-total-price', totalPrice + originalPrice);
				embedAddonWrap.attr('data-total-sale-price', totalSalePrice + salePrice);
				
				const summaryHTML = `<div class="summary__product-wrap" data-index="${idx}"><p class="summary__product-name">${modelName}</p><p class="summary__product-price">${currencyComma(price, currency)}</p></div>`;
				$('.summary__product-wrap.addon-wrap').append(summaryHTML);
				
				// tagging 
				embedAddonList.filter(elem => {
					if( elem.modelCode === modelCode ){
						sharedObj.embedAddonSelected.push(elem);
					}
				});
				
			}else{
				services.embedaddon = services.embedaddon.filter(function(code){
					return code !== modelCode;
				});
				embedAddonWrap.attr('data-total-price', totalPrice - originalPrice);
				embedAddonWrap.attr('data-total-sale-price', totalSalePrice - salePrice);
				
				// tagging 
				sharedObj.embedAddonSelected = sharedObj.embedAddonSelected.filter(function(elem){
					return elem.modelCode !== modelCode;
				});
			}
			
			sharedObj.embedAddonSelected.forEach((item)=>{
				item["summaryPrice"] = `${currencyComma(item.finalPriceValue, currency)} ${siteCode === 'hr' ? `(${euroToKunaPrice(finalPriceValue)})` : ''}`;
			})
			//  Add On  
			sharedObj.drawObj.price.summaryArea.embedAddonSelected = sharedObj.embedAddonSelected;

			if($("#personalizeMyTv").length > 0){
				sharedObj.pmtModelList = sharedObj.pmtModelList.filter(function(code){ // addon  
					return !embedAddonCodeList.includes(code);
				});
				services.embedaddon.forEach(function(code){
					sharedObj.pmtModelList.push(code);
				});
				sharedObj.pmtModelList.forEach(function(code){
					if( !embedAddonPMT.includes('&option=') && !sharedObj.pmtURL.includes('&option=') ){
						embedAddonPMT += '&option=';
					}
					embedAddonPMT += code + ",";
				});
				if( !sharedObj.pmtURL ){
					sharedObj.pmtURL = $("#personalizeMyTv .cta").attr("href");
				}
				$("#personalizeMyTv .cta").attr("href", sharedObj.pmtURL + embedAddonPMT.slice(0, -1));
			}
			
			util.totalAfterFunction( sharedObj, selectorObj );
		});
		
		selectorObj.buyingToolOptEmbedAddon.on( 'click', '.cta-learn-more', eventParam, function ( event ) {
			const _this = $(this);
			const productIndex = _this.attr("data-model-idx")
			const embedAddonList = sharedObj.drawObj.embedAddon.itemSet;;
			const selectModel = embedAddonList[productIndex];
			const thirdPASeller = selectModel.thirdPASeller;
			const categoryName = selectModel.categorySubType;
			const learnMorePopup = $('#addOnLayerPopupLearnMore');
			learnMorePopup.find('.add-on-popup__title').html(categoryName);
			
			const imageUrl = selectModel.imgSrcList;
			const imageAlt = selectModel.imgAltList;
			let imageListHtml = '';
			for(let idx in imageUrl){
				imageListHtml += `
				<div class="swiper-slide" role="listitem">
					<div class="image">
						<img class="image__preview lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(imageUrl[idx], "$N_240_PNG$", false, true)}" data-mobile-src="${addOnsImgDomain(imageUrl[idx], "$N_400_PNG$", false, true)}" alt="imageAlt[idx]" role="img">
						<img class="image__main lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(imageUrl[idx], "$N_240_PNG$", false, true)}" data-mobile-src="${addOnsImgDomain(imageUrl[idx], "$N_400_PNG$", false, true)}" alt="imageAlt[idx]" role="img">
					</div>
				</div>`;
			}
			const isFollowFinger = imageUrl && imageUrl.length === 1 ? false : true;
			let imageHtml = '';
			imageHtml += `
			<div class="swiper-container basic-swiper" data-swiper-option='{
				"slidesPerView":"1", "keepWrapper":true, "loop":false, "pagination":false,
				"componentEl":".add-on__learn-more-images", "offTxtAccesibility":"true", "centeredSlides": true,
				"centeredSlidesBounds": true, "followFinger": ${isFollowFinger}}'>
				<button type="button" class="swiper-button-prev">
					<span class="hidden">Previous</span>
					<svg class="icon" focusable="false" aria-hidden="true">
						<use xlink:href="#previous-bold" href="#previous-bold"></use>
					</svg>
				</button>
				<div class="swiper-wrapper" role="list">${imageListHtml}</div>
				<button type="button" class="swiper-button-next">
					<span class="hidden">Next</span>
					<svg class="icon" focusable="false" aria-hidden="true">
						<use xlink:href="#next-bold" href="#next-bold"></use>
					</svg>
				</button>
			</div>`;
			learnMorePopup.find('.add-on__learn-more-images').html(imageHtml);
			if( imageUrl.length === 1 ){
				learnMorePopup.find('.swiper-container').attr('')
			}
			
			let uspHtml = '';
			const isGPv2 = $("#shopIntegrationFlag").val() === "GPv2";
			const isNewHybris = $("#shopIntegrationFlag").val() === "Hybris-new";
			const isHybrisIntg = $("#shopIntegrationFlag").val() === "Hybris-intg";
			const isGlobal = !isGPv2 && !isHybrisIntg && !isNewHybris;
			if( isHybrisIntg ){
				const promotionList = [{key: selectModel.tradeIn, value: selectModel.tradeInDesc}, {key: selectModel.premiumCare, value: selectModel.premiumCareDesc},
						{key: selectModel.financing, value: selectModel.financingDesc}, {key: selectModel.upgrade, value: selectModel.upgradeDesc}, {key: (selectModel.storePromotions ? 'Y' : 'N'), value: selectModel.storePromotions}];
				for(let idx in promotionList){
					if(promotionList[idx].key === 'Y'){
						uspHtml += `<li class="add-on__learn-more-feature-item" role="listitem">${promotionList[idx].value}</li>`;
					}
				}
			}else if( isGlobal ){
				if( selectModel.vd3PAMarketingMessage && selectModel.vd3PAMarketingMessage.length > 0 ){
					for(let message of selectModel.vd3PAMarketingMessage){
						uspHtml += `<li class="add-on__learn-more-feature-item" role="listitem">${message}</li>`;
					}
				}
			}
			if( selectModel.uspText && selectModel.uspText.length > 0 ){
				for(let usp of selectModel.uspText){
					uspHtml += `	<li class="add-on__learn-more-feature-item" role="listitem">${usp}</li>`;
				}
			}
			let featureHtml = '';
			if( selectModel.keySummary && selectModel.keySummary.length > 0 ){
				for(let keySummary of selectModel.keySummary){
					if( keySummary.displayType.toLowerCase() === 'feature' ){
						featureHtml += `
							<li class="add-on__learn-more-feature-icon-item">
								<div class="add-on__learn-more-feature-icon-image">
									<div class="image">
										<img class="image__preview lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(keySummary.imgUrl, "$64_64_PNG$")}" data-mobile-src="${addOnsImgDomain(keySummary.imgUrl, "$96_96_PNG$")}" alt="${keySummary.imgAlt}" role="img">
										<img class="image__main lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(keySummary.imgUrl, "$64_64_PNG$")}" data-mobile-src="${addOnsImgDomain(keySummary.imgUrl, "$96_96_PNG$")}" alt="${keySummary.imgAlt}" role="img">
									</div>
								</div>
								<p class="add-on__learn-more-feature-icon-text">${keySummary.title}</p>
							</li>`;
					}
				}
			}
			const contentHtml = `
				<h3 class="add-on__learn-more-title">${selectModel.name}</h3>
				<div class="add-on__learn-more-info">
					<p class="add-on__learn-more-sku">${selectModel.modelCode}</p>
					${thirdPASeller ? `<strong class="add-on__learn-more-seller">Granite.I18n.get('Seller') : thirdPASeller</strong>` : ``}
				</div>
				${selectModel.ratings && selectModel.reviewCount ?
				`<div class="add-on__learn-more-review">
					<span class="rating">
						<span class="rating__inner">
							${gridRating(selectModel.ratings, selectModel.reviewCount)}
						</span>
					</span>
				</div>` : ``}
				<ul class="add-on__learn-more-feature" role="list">
					${uspHtml}
				</ul>
				${selectModel.pdpUrl ? 
				`<div class="add-on__learn-more-cta">
					<a class="cta cta--underline cta--black cta--icon" href="${selectModel.pdpUrl}" aria-label="Link Title" target="_blank">
						${Granite.I18n.get('Product detail')}
						<svg class="icon" focusable="false" aria-hidden="true"><use xlink:href="#outlink-bold" href="#outlink-bold"></use></svg>
					</a>
				</div>` : ``}
				${featureHtml ? 
				`<ul class="add-on__learn-more-feature-icon">
					${featureHtml}
				</ul>` : ``}`;
			learnMorePopup.find('.add-on__learn-more-content').html(contentHtml);
			
			window.sg.components.pdBuyingTool.openAddOnLearnMore(document.querySelector('#addOnLayerPopupLearnMore'));
		});
	}
	
	function clickSMB( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		selectorObj.buyingToolOptSMBQuantity.on( 'click', '.smb-count', eventParam, function ( event ) {
			const quantity = Number($('#counterText').val());
			sharedObj.util.validateQuantity(quantity, sharedObj, selectorObj);
			
		});
		
		selectorObj.buyingToolOptSMBQuantity.on( 'propertychange change keyup paste', '#counterText', function ( event ) {
			const _this = $(this);
			let changeText = _this.val().replace(/[^0-9].*/, "");
			_this.val(changeText);
			
			const quantity = Number(_this.val());
			sharedObj.util.validateQuantity(quantity, sharedObj, selectorObj);
		});
		
		selectorObj.buyingToolOptSMBQuantity.on( 'focusout ', '#counterText', function ( event ) {
			const _this = $(this);
			if(!_this.val() || _this.val() == '0'){
				_this.val(1);
			}
			
		});
		
	}
	
	function clickGiftCard( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		selectorObj.buyingToolOpt.on( 'click', '#gift-card-amount-0, #gift-card-amount-1', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			
			sharedObj.giftCard.amountValid = true;
			sharedObj.giftCard.selectedPrice = $(this).data("price");
			sharedObj.util.settingPriceDraw( sharedObj, selectorObj );
		});
		
		selectorObj.buyingToolOpt.on( 'click', '#gift-card-amount-2', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			
			sharedObj.giftCard.amountValid = false;
		});
		
		selectorObj.buyingToolOpt.on( 'click', '.pd-select-option--gift-card .cta', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			
			var inputAmount = sharedObj.giftCard.inputAmount;
			if(inputAmount < sharedObj.giftCard.minPrice || inputAmount > sharedObj.giftCard.maxPrice || inputAmount%sharedObj.giftCard.priceIncrement > 0){
				sharedObj.giftCard.amountValid = false;
				var errorText = Granite.I18n.get("Please enter only numbers. {0} {1}", [sharedObj.giftCard.minPriceFormatted, sharedObj.giftCard.maxPriceFormatted]);
				$(".pd-select-option--gift-card .text-field-v2__text").text(errorText);
				$(".pd-select-option--gift-card .text-field-v2__text.error").show();
			}else{
				sharedObj.giftCard.amountValid = true;
				$(".pd-select-option--gift-card .text-field-v2__text.error").hide();
				$("#gift-card-amount-2").attr("data-price", sharedObj.giftCard.inputAmount);
				sharedObj.giftCard.selectedPrice = $("#gift-card-amount-2").attr("data-price");
				sharedObj.util.settingPriceDraw( sharedObj, selectorObj );
			}
		});
		$("#gift-card-amount-0").click();
	}
	
	function gridRating(ratings, reviewCount){
		if( !ratings ){ 
			ratings = 0; 
		}
		// rating  
		const tmpCount = Math.pow(10,1);
		ratings = Math.round(ratings*tmpCount)/tmpCount;
		const ratingValue = parseFloat(ratings).toFixed(1),
		fullStarCnt = parseInt(ratings);
		let cutStarWidthStyleNum = 0;
		cutStarWidthStyleNum = parseInt((ratingValue-fullStarCnt)*100);
		if(ratingValue !== "0.0"){
			ratings = ratingValue;
		}
	
		let latingHtml = `	<span class="rating__star-list">`;
		for(var j=0; j<fullStarCnt;j++){
			latingHtml += `		<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" stngHtml += `		<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width:${cutStarWidthStyleNum}%;"></span></span>`;
			for(var k=4;k>fullStarCnt;k--){
				latingHtml += `	<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>`;
			}
		} else if ( fullStarCnt === 0 ){
			for(var empty_idx=0;empty_idx<5;empty_idx++){
				latingHtml += `	<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>`;
			}
		}
		latingHtml += `		</span>
							<strong class="rating__point"><span class="hidden">${Granite.I18n.get('Product Ratings')} : </span><span>${ratings}</span></strong>
							<em class="rating__review-count">(<span class="hidden">${Granite.I18n.get('Number of Ratings')} :</span><span>${reviewCount ? reviewCount : 0}</span>)</em>`;
		return latingHtml;
	}
	
	function addOnsImgDomain(imgUrl, preset, iconFl, usePreset) {
		var newUrl = "";
		var useScene7domain = $("#scene7domain").val();
		if (imgUrl) {
			if (imgUrl.indexOf("?") > -1) { //    add-ons - hybris
				imgUrl = imgUrl.replace("medias","");
				imgUrl = imgUrl.substring(2, imgUrl.indexOf("?"));
				imgUrl = imgUrl.substring(0,imgUrl.lastIndexOf('-'));
				preset = "";
			} else {
				preset = "?" + preset;
			}
			if (imgUrl.indexOf("https:") > -1 || imgUrl.indexOf("http:") > -1 || imgUrl.indexOf("//stg-images.samsung.com/") > -1 || imgUrl.indexOf("//images.samsung.com/") > -1 || imgUrl.indexOf("image.samsung.com/") > -1) {
				newUrl = imgUrl;
			} else {
				if (iconFl) useScene7domain = useScene7domain.replace("/image/", "/content/");
				newUrl = useScene7domain + imgUrl;
			}
		}
		
		if(usePreset && imgUrl.indexOf("?") === -1){
			newUrl += preset;
		}
		
		return newUrl;
	}
	
	function clickCTA( sharedObj, selectorObj ){
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		let clickCnt = 0;
		
		// Continue   
		$(document).off('click', '.pd-buying-tool .js-buy-now[data-cta-type="preorder continue"], .pd-header-navigation .js-buy-now[data-cta-type="preorder continue"], .pd-buying-tool .js-buy-now[data-cta-type="add-cart continue"], .pd-header-navigation .js-buy-now[data-cta-type="add-cart continue"]');
		$(document).on( 'click', '.pd-buying-tool .js-buy-now[data-cta-type="preorder continue"], .pd-header-navigation .js-buy-now[data-cta-type="preorder continue"], .pd-buying-tool .js-buy-now[data-cta-type="add-cart continue"], .pd-header-navigation .js-buy-now[data-cta-type="add-cart continue"]', eventParam, function ( event ) {
			// COMP6FE-1619 [EPP] SIEL Offline  
			if ( !openStorePopup(event.data.sharedObj) ){			
				const sharedObj = event.data.sharedObj;
				const selectorObj = event.data.selectorObj;
				const siteCode = sharedObj.siteCode;
				const util = sharedObj.util;
				const shopIntegrationFlag = $("#shopIntegrationFlag").val();
				
				if( util.checkingDeliveryCode(sharedObj, selectorObj) ){ // delivery  , pincode   clickCnt++
					clickCnt ++;
				}
				if( clickCnt === 1 && util.checkingDeliveryCode(sharedObj, selectorObj) ){
					sharedObj.afterEvent.addToCartCta( null, false );
					if( !sharedObj.isMigrationHybris ){
						if( shopIntegrationFlag === 'Hybris' || shopIntegrationFlag === 'Hybris-intg' || siteCode === 'in' ){ // old-hybris + in
							window.sg.components.dynamic.bridgePageCommonHybris.moveBridgePage(this);
						}else{ // new-hybris, old-hybris  
							window.sg.components.dynamic.bridgePage.moveBridgePage(this);
						}
					} else { // new-hybris
						sharedObj.clickDom = this;
						$("#hubble-care").addClass('gift-hubble-care')
		$(document).off( 'click', '.pd-buying-tool .js-buy-now[data-cta-type="checkout continue"], .pd-header-navigation .js-buy-now[data-cta-type="checkout continue"]');
		$(document).on( 'click',  '.pd-buying-tool .js-buy-now[data-cta-type="checkout continue"], .pd-header-navigation .js-buy-now[data-cta-type="checkout continue"]', eventParam, function ( event ) {
			// COMP6FE-1619 [EPP] SIEL Offline  
			if ( !openStorePopup(event.data.sharedObj) ){			
				const sharedObj = event.data.sharedObj;
				const selectorObj = event.data.selectorObj;
				const util = sharedObj.util;
				const shopIntegrationFlag = $("#shopIntegrationFlag").val();
				
				if( util.checkingDeliveryCode(sharedObj, selectorObj) ){ // delivery  , pincode   clickCnt++
					clickCnt ++;
				}
				if( clickCnt === 1 && util.checkingDeliveryCode(sharedObj, selectorObj) ){
					sharedObj.afterEvent.checkOutCta( null, false );
					if( !sharedObj.isMigrationHybris ){
						if( shopIntegrationFlag === 'Hybris' || shopIntegrationFlag === 'Hybris-intg' ){ // old-hybris
							window.sg.components.dynamic.bridgePageCommonHybris.moveBridgePage(this);
						}else{ // new-hybris, old-hybris  
							window.sg.components.dynamic.bridgePage.moveBridgePage(this);
						}
					} else {// new-hybris
						sharedObj.clickDom = this;
						$("#hubble-care").addClass('gift-hubble-care');
					}
				}
			}
		});
		
		// checkOut Hybris, Gpv2 
		$(document).on( 'click', '.pd-buying-tool .js-buy-now[data-cta-type="checkout"],.pd-buying-tool .js-buy-now[data-cta-type="checkout between"], .pd-header-navigation .js-buy-now[data-cta-type="checkout"], .pd-header-navigation .js-buy-now[data-cta-type="checkout between"]', eventParam, function ( event ) {
			// COMP6FE-1619 [EPP] SIEL Offline  
			if ( !openStorePopup(event.data.sharedObj) ){			
				sharedObj.afterEvent.checkOutCta( null, true );
			}
		});
		
		
		// add-cart Hybris, Gpv2 
		$(document).off( 'click', '.pd-buying-tool .js-buy-now[data-cta-type="add-cart"], .pd-header-navigation .js-buy-now[data-cta-type="add-cart"]');
		$(document).on( 'click', '.pd-buying-tool .js-buy-now[data-cta-type="add-cart"], .pd-header-navigation .js-buy-now[data-cta-type="add-cart"]', eventParam, function ( event ) {
			// COMP6FE-1619 [EPP] SIEL Offline  
			if ( !openStorePopup(event.data.sharedObj) ){			
				const sharedObj = event.data.sharedObj;
				const util = sharedObj.util;
				
				if( util.checkingRecipientInfo( sharedObj ) ){
					sharedObj.afterEvent.addToCartCta( null, true );
				}
			}
			if(sharedObj.siteCode === 'br'){
				var ctaClassName = $(this).parent().attr("class");
				
				if(ctaClassName == "pd-buying-price__cta"){
					callSatellite(sharedObj, digitalData, ".pd-buying-price__cta .cta", "pdd01_anchor nav-product detail-cta-cart page");
				}else if(ctaClassName == "cost-box__cta"){
					callSatellite(sharedObj, digitalData, ".cost-box__cta .cta", "header(pim)_price bar-product detail-button-cart");
				}
			}
		});
		
		// pre-order Hybris, Gpv2 
		$(document).off( 'click', '.pd-buying-tool .js-buy-now[data-cta-type="preorder"], .pd-header-navigation .js-buy-now[data-cta-type="preorder"]');
		$(document).on( 'click', '.pd-buying-tool .js-buy-now[data-cta-type="preorder"], .pd-header-navigation .js-buy-now[data-cta-type="preorder"]', eventParam, function ( event ) {
			// COMP6FE-1619 [EPP] SIEL Offline  
			if ( !openStorePopup(event.data.sharedObj) ){			
				sharedObj.afterEvent.addToCartCta( null, true );
			}
		});
		
		// EBT  
		$(document).on( 'click', '.pd-buying-tool [data-cta-type="for-business"], .pd-header-navigation [data-cta-type="for-business"]', eventParam, function ( event ) {
			//window.sg.components.ebtPopup.showPopup($('.tg-for-business'));
			mailformPopup.showPopup();
		});
	}
	
	function callSatellite(sharedObj, digitalData, cta, antr){
		var obj = {
				"class":"cta cta--contained cta--emphasis add-special-tagging js-buy-now tg-add-to-cart",
				"data-cta-type":"add-cart",
				"data-sku-code":digitalData.product.model_code,
				"an-tr":antr,
				"an-ca":"buy cta",
				"an-ac":"buy now",
				"an-la":"buy now",
				"aria-label":$(cta).text()+":"+digitalData.product.displayName,
				"data-discountprice":parseFloat(sharedObj.totalPrice.sale).toFixed(2),
				"data-modelcode":digitalData.product.model_code,
				"data-modeldisplay":digitalData.product.displayName,
				"data-modelname":digitalData.product.model_name,
				"data-modelrevenue":digitalData.product.list_price,
				"data-modelprice":digitalData.product.list_price,
				"data-pvitype":digitalData.page.pathIndicator.depth_2,
				"data-pvisubtype":digitalData.page.pathIndicator.depth_3,
				"data-pimsubtype":digitalData.page.pathIndicator.depth_4,
				"data-modelqty":"1"
			  }
		
		_satellite.track("buy_cta_dc", obj);
	}
	
	function clickDelivery ( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		//   
		selectorObj.buyingToolOptDelivery.on( 'input', '#delivery-zipcode', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const siteCode = sharedObj.siteCode;
			
			if(siteCode === "in" || siteCode === "id"){
				var _this = $(this);
				_this.val(_this.val().replace(/[^0-9]/g, ""));
			}
			
		});
		
		selectorObj.buyingToolOptDelivery.on( 'keyup', '#delivery-zipcode', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const siteCode = sharedObj.siteCode;
			const util = sharedObj.util;
			const _this = $(this);
			const delPinCode = $(selectorObj.buyingToolOptDelivery).find('#delivery-zipcode').val();
			
				if( event.which === 13 || ( siteCode === 'us' && delPinCode && delPinCode.length === 5) ){
					util.deliveryGetApiData( sharedObj, selectorObj );
				}else{
					if(!(siteCode === "ae" || siteCode === "ae_ar" || siteCode === "us" )){
						_this.val(_this.val().replace(/[^\d].+/, ""));
						if((event.which < 48 || event.which > 57)){
							event.preventDefault();
						}
					}
				}
		});
		
		selectorObj.buyingToolOptDelivery.on( 'click', '.check-zipcode', eventParam, function ( event ) {
			sharedObj.util.deliveryGetApiData( sharedObj, selectorObj );
		});
		
		selectorObj.buyingToolOptDelivery.on( 'keypress', '#delivery-zipcode', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const siteCode = sharedObj.siteCode;
			const _this = $(this);
			
			if(!(siteCode === "ae" || siteCode === "ae_ar" || siteCode === "us" )){
				_this.val(_this.val().replace(/[^\d].+/, ""));
				if((event.which < 48 || event.which > 57)){
					event.preventDefault();
				}
			}
		});
		
		// 
		selectorObj.buyingToolOpt.on( 'click', '.remove-delivery', eventParam, function ( event ) {
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const util = sharedObj.util;
			const drawObj = sharedObj.drawObj;
			const view = sharedObj.view;
			
			const hasResult = util.hasDeliveryResult( sharedObj, selectorObj );
			
			if( hasResult ){
				drawObj.deliveryResult = {
					'hasComponent' : false,
					'mainText' : null,
					'decText' : null,
					'disclaimerList' : [{
						'disclaimer': null
					}]
				}
				$.cookies.del("HA-Deeplink-Zipcode",{domain : ".samsung.com"});
				
				$("#delivery-zipcode").val("");
				view.deliveryResultDraw(drawObj);
				
			}
			
			if( drawObj.delivery.priorityDeliveryText ) {
				$(selectorObj.buyingToolOptDelivery).find('.pd-select-option__tooltip').show();
			}
		});
		
		window.sg.components.pdBuyingTool.bindPdTooltipEvent(); // delivery tooltip
	}
	
	/**
	 *    
	 */
	function clickCalculator ( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		selectorObj.buyingToolCalculate.on( 'click', '.js-install-calc:not(.eip-ee-cal)', eventParam, function ( event ) {
			event.preventDefault();
			
			const _this = $(this);
			const inputUrl = _this.attr('href');
			const emiArea = $('.eip-popup');
			if( emiArea.length > 0 ){
				emiArea.find('iframe').attr('src',inputUrl);
				window.sg.components.eipPopup.showPopup();
			}
		});
		
		selectorObj.buyingToolCalculate.on( 'click', '.js-install-calc.eip-ee-cal', eventParam, function ( event ) {
			event.preventDefault();
			installmentPlansData.getPaymentData( sharedObj.proudctPriceInfo.salePrice, selectorObj.buyingToolCalculate.find('.js-install-calc.eip-ee-cal').get(0) );
		});
	}
	
	/**
	 * Offer  EIP  
	 */
	function clickEip ( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		selectorObj.buyingToolOptOffer.on( 'click', 'a[data-target-popup="eipPopup"]', eventParam, function ( event ) {
			event.preventDefault();
			
			const _this = $(this);
			const inputUrl = _this.attr('href');
			const emiArea = $('.eip-popup');

			if( sharedObj.isMigrationHybris || sharedObj.siteCode === "hu" || sharedObj.siteCode === "sg" || sharedObj.siteCode === "my" || sharedObj.siteCod(sharedObj.modelCode, _this);
				
			} else {
				if( emiArea.length > 0 ){
					emiArea.find('iframe').attr('src',inputUrl);
					window.sg.components.eipPopup.showPopup();
				}
			}
			
		});
	}
	
	/**
	 * EE   
	 */
	function clickEipEE ( sharedObj, selectorObj ) {
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		selectorObj.buyingToolOptOffer.on( 'click', 'a[data-target-popup="eipEEPopup"]', eventParam, function ( event ) {
			event.preventDefault();
			const targetId =  $(event.currentTarget).attr('id');
			installmentPlansData.getPaymentData( sharedObj.proudctPriceInfo.salePrice, selectorObj.buyingToolOptOffer.find('#'+targetId).get(0), sharedObj.shopSkuCode );
		});
	}
	
	
	function clickGlallery( sharedObj, selectorObj ){
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		selectorObj.buyingToolGlallery.on( 'click', '.btn-360', eventParam, function ( event ) {
			window.sg.common.image360.initAll();
		});
	}
	
	
	function clickEppDiscount( sharedObj, selectorObj ){
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		$('.us-epp-discount-keep').on( 'click', '.epp-discount', eventParam, function ( event ) {
			const _this = $(this);
			const storeId = _this.attr('data-store-id');
			callUsPrivateStore( storeId, {'sharedObj' : sharedObj, 'selectorObj' : selectorObj}, sharedObj.util.selectedUsEpp );
			window.sg.components.usEppDiscount.closeLayer();
		});
	}
	
	/**
	 * Manufacture information      
	 */
	function clickLinks( sharedObj, selectorObj ){
		
		const eventParam = {
			'sharedObj' : sharedObj,
			'selectorObj' : selectorObj
		};
		
		/**
		 * manufacture  
		 */
		selectorObj.buyingToolLinks.on( 'click', '.cta[data-target-popup="manufacturerInfoPopup"]', eventParam, function ( event ) {
			const manufacturerArea = $('.manufacturer-info-popup');
			if( manufacturerArea.length > 0 ){
				window.sg.components.manufacturerInfoPopup.showPopup();
			}
		});
		
		/**
		 * Return & Cancel  
		 */
		selectorObj.buyingToolLinks.on( 'click', '.cta[data-target-popup="cancelReturnPolicyPopup"]', eventParam, function ( event ) {
			const cancelArea = $('.cancel-return-policy-popup');
			if( cancelArea.length > 0 ){
				const text= sharedObj.returnPolicyText;
				cancelArea.find('.cancel-return-policy-popup__text').html(text);
				window.sg.components.cancelReturnPolicyPopup.showPopup();
			}
		});
		
		/**
		 * Warrenty  
		 */
		selectorObj.buyingToolLinks.on( 'click', '.cta[data-target-popup="warrantyPolicyPopup"]', eventParam, function ( event ) {
			const warrentyArea = $('.warranty-policy-popup');
			if( warrentyArea.length > 0 ){
				const text= sharedObj.warrantyText;
				warrentyArea.find('.warranty-policy-popup__text').html(text);
				window.sg.components.warrantyPolicyPopup.showPopup();
			}
		});
	}
	
	/**
	 * Installment Calculate 
	 */
	function settingCalculateDraw( sharedObj, selectorObj ) {
		const financeFlag = sharedObj.financeFlag;
		const siteCode = sharedObj.siteCode;
		const promotionFinancingFlag = sharedObj.promotionFinancingFlag;
		const promotionPrice = sharedObj.totalPrice.sale;
		const util = sharedObj.util;
		const view = sharedObj.view;
		const emiTitle = Granite.I18n.get('Calculate Finance');
		const drawObj = sharedObj.drawObj;
		const emiUrl = util.getEmiUrl( sharedObj, selectorObj );
		let hasComponent = false;
		let emiAttr = {};
		
		if(financeFlag === "Y" && financingUrl !== "" && siteCode !== "in" ){
			if( siteCode === "uk" || siteCode === "id" || siteCode === "sk" || siteCode === "cz"){ // new-hybris
				if( promotionFinancingFlag ){
					hasComponent = true;
					emiAttr = util.getAttrCta( emiTitle, emiUrl, '_self', 'js-install-calc', {'layerTarget':'eipPopup'}, '');
				}
			}else if(siteCode === "pl" || siteCode === "hu" || siteCode === "ro" || siteCode === "ua" || siteCode === "ph" || siteCode === "sg" || siteCode === "my" || siteCode === "nz"){
				if( promotionPrice ){
					if ( promotionPrice > 100 ){
						hasComponent = true;
						emiAttr = util.getAttrCta( emiTitle, emiUrl, '_self', 'js-install-calc', {'layerTarget':'eipPopup'}, '');
					}
				}
			} else if(siteCode === "ee" || siteCode === "lv" ){
				hasComponent = true;
				emiAttr = util.getAttrCta( emiTitle, emiUrl, '_self', 'js-install-calc eip-ee-cal', {'layerTarget':'eipEEPopup'}, '');
			} else{
				hasComponent = true;
				emiAttr = util.getAttrCta( emiTitle, emiUrl, '_self', 'js-install-calc', {'layerTarget':'eipPopup'}, '');
			}
		}
		
		drawObj.calculator = {
			'hasComponent' : hasComponent,
			'emiAttr' : emiAttr
		}
		
		view.emiDraw( drawObj );
	}
	
	/**
	 * Offer promotion Finance url  
	 */
	function changeEmiUrl( sharedObj, selectorObj ){
		const util = sharedObj.util;
		const offerArea = selectorObj.buyingToolOptOffer;
		const buyingToolCalculate = $(selectorObj.buyingToolCalculate).find('.js-install-calc');
		const finaceArea = offerArea.find('a[data-target-popup="eipPopup"]');
		const finaceAreaEE = offerArea.find('a[data-target-popup="eipEEPopup"]');
		const emiUrl = util.getEmiUrl( sharedObj, selectorObj );
		finaceArea.attr('href',emiUrl);
		finaceAreaEE.attr('href',emiUrl);
		buyingToolCalculate.attr('href',emiUrl);
		
	}
	function settingTradeInPopup ( sharedObj, selectorObj ){
		const tradeInFlag = sharedObj.tradeInFlag;
		const siteCode = sharedObj.siteCode;
		const storeDomain = sharedObj.apiDomain;
		const shopSkuCode = sharedObj.shopSkuCode;
		const pdMultiLanguageYN = sharedObj.pdMultiLanguageYN;
		const pdHrefLang = sharedObj.pdHrefLang;
		
		if( tradeInFlag && siteCode !== 'fr' && siteCode !== 'in' ){
			const objParam = {
					"sku" : shopSkuCode
			};
			// epp  
			if( $('#isEppPage').val() === 'true' ){
				objParam["store_id"] = $('#eppCompanyCode').val();
			}
			$.ajax({
				headers: {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin" : "*"
				},
				url: storeDomain + "/v1/exchange/offers",
				type: "POST",
				dataType: "json",
				data: JSON.stringify(objParam),
				xhrFields: { withCredentials: true },
				beforeSend : function(xhr){
					/* multi language    */
					if(pdMultiLanguageYN === "Y"){
						xhr.setRequestHeader("x-ecom-locale", pdHrefLang);
					}
				},
				success : function( data ){
					if( data ){
						tradeinData.setTradein(data, "", "");
					}
				},
				error:function(error){
				}
			});
		}
	}
	
	
	/**
	 *   CTA 
	 */
	function checkingSpecialCta ( ctaType, sharedObj, selectorObj ) {
		const stockLevelStatus = sharedObj.stockLevelStatus;
		const siteCode = sharedObj.siteCode;
		const util = sharedObj.util;
		const hasBetweenResult = util.hasBetweenResult( sharedObj, selectorObj );
		const hasUpgradeResult = util.hasBetweenResult( sharedObj, selectorObj );
		const hasAcessory =  util.hasAcessory( sharedObj, selectorObj );
		const hasGift = sharedObj.hasGift;
		const isVDSTEPBUYING = $("#categorySubTypeCode").val().length > 2 && $("#categorySubTypeCode").val().substring(0,2) === "04" ? true : false;
		const typeList = [];
		let title = '';
		let isSpecial = false;
		
		if( stockLevelStatus == 'INSTOCK' || stockLevelStatus == 'BACKORDERED' || stockLevelStatus == 'PREORDER' ){
			
			if( hasBetweenResult ){
				isSpecial = true;
				title = Granite.I18n.get( 'Checkout' );
				typeList.push('checkout');
				typeList.push('between');
			} else if( hasUpgradeResult ){
				if( siteCode !== 'uk' && siteCode !== 'de' ){
					isSpecial = true;
					title = Granite.I18n.get( 'Checkout' );
					typeList.push('checkout');
				} else {
					typeList.push( ctaType );
				}
			} else {
				typeList.push( ctaType );
			}
			
			if( hasAcessory || hasGift ){
				// NOTICE : isEmbedAddOn true  continue   . , bridge    . 
				if( !sharedObj.isEmbedAddOn || (sharedObj.isEmbedAddOn && sharedObj.hasGift) ){
					isSpecial = true;
					if( isVDSTEPBUYING ){
						title = Granite.I18n.get( 'Add to cart' );
					}else{
						title = Granite.I18n.get( 'Continue' );
					}
					typeList.push('continue');
				}
			} 
		}
		
		const result = {
			'title' : title,
			'ctaType' : typeList.join(' '),
			'isSpecial' : isSpecial
		}
		return result;
	}
	
	/**
	 *   Care, Warranty   
	 */
	function divideCareAndWarranty( sharedObj, selectorObj ){
		const pdProductTypeCheckYn = sharedObj.pdProductTypeCheckYn;
		
		if(pdProductTypeCheckYn !== 'Y'){
			if( sharedObj.pdSmcType && sharedObj.pdSmcType === 'type2' ){
				if( sharedObj.addOnApiList.care ){
					sharedObj.finalWarrantyList = sharedObj.addOnApiList.care.list;
				}
			} else {
				if( sharedObj.addOnApiList.care ){
					//EPP PD SC+  null  (care data  price_info  data )
					if ( $('#isEppPage').val() === 'true' ){
						let arrCareList = [];
						for(let qc in sharedObj.addOnApiList.care.list){
							if ( sharedObj.addOnApiList.care.list[qc].price_info ){
								arrCareList.push(sharedObj.addOnApiList.care.list[qc]);
							}
						}
						sharedObj.finalCareList = arrCareList;
					} else {
						sharedObj.finalCareList = sharedObj.addOnApiList.care.list;
					}
				}
			}
		}else{
			if( sharedObj.addOnApiList && sharedObj.addOnApiList.careAndWarranty ){
				for( var index in sharedObj.addOnApiList.careAndWarranty.list ){
					const item = sharedObj.addOnApiList.careAndWarranty.list[index];
					const addOnProductType = item.product_type.toUpperCase();
					if( addOnProductType === 'WARRANTY' ){
						sharedObj.finalWarrantyList.push( item );
					} else if( addOnProductType === "INSURANCE" ){
						sharedObj.finalCareList.push( item );
					}
				}
			}
		}
	}
	
	// COMP6FE-1619 [EPP] SIEL Offline  
	function openStorePopup(sharedObj){
		if ( sharedObj.isStorePopup ){
			const storeMsg = "This product is available to buy in store. Please contact store representative. Thank You!";
			confirmPopup(Granite.I18n.get(storeMsg),"error");
			return true;
		}
		return false;
	}
	
	dynamic.BuyingToolOpUtile = BuyingToolOpUtile;
})();

(() => {
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	const comp = window.sg.sdf.comp;
	
	class BuyingToolOpView {
		
		constructor( selectorObj, sharedObj ) {
			this.selectorObj = selectorObj
			this.sharedObj = sharedObj
		}
		
		/**
		 * usEpp  
		 */
		usEppDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const eppTarget = $('.us-epp-discount-keep').get(0);
			
			//  append 
			eppTarget.innerHTML = '';
			component.invokeTemplate("usEpp", drawObj, eppTarget);
			
			if( drawObj.usEppData.hasComponent ){
				$(eppTarget).addClass('has-component');
				$(eppTarget).show();
			} else {
				$(eppTarget).removeClass('has-component');
				$(eppTarget).hide();
			}
			
			window.sg.components.usEppDiscount.reInit();
			window.sg.common.icon.update(document.querySelector('.us-epp-discount-keep'));
		}
		
		/**
		 * Emi  
		 */
		emiDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const calculateTarget = selectorObj.buyingToolCalculate.get(0);
			
			//  append 
			calculateTarget.innerHTML = '';
			component.invokeTemplate("calculator",drawObj, calculateTarget);
			
			if( drawObj.calculator.hasComponent ){
				$(calculateTarget).addClass('has-component');
				$(calculateTarget).show();
			} else {
				$(calculateTarget).removeClass('has-component');
				$(calculateTarget).hide();
			}
			
		}
		
		/**
		 *   
		 */
		productWishListDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			const pcTarget = selectorObj.buyingToolInfoWishlist.get(0);
			const moTarget = $(".pd-header-gallery").find(".pd-info__wishlist").get(0);
			
			if( pcTarget ){
				pcTarget.innerHTML = '';
				component.invokeTemplate("wishlist",  drawObj, pcTarget);
			}
			
			if( moTarget ){
				moTarget.innerHTML = '';
				component.invokeTemplate("wishlist",  drawObj, moTarget);
			}
			//wishList reInit
			window.sg.components.wishlistIcon.reInit();
			window.sg.common.icon.update(document.querySelector('.pd-g-product-detail-kv .product-detail-kv'));
		}
		
		/**
		 * ajax   
		 */
		productPriceTotalDraw( drawObj, isOptClicked ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			const anchorPriceTextTartget = $('.pd-header-navigation .pd-buying-price').get(0);
			const priceTartget = selectorObj.buyingToolPriceBar.get(0);
			
			//  append 
			if( anchorPriceTextTartget ){
				anchorPriceTextTartget.innerHTML = '';
			}
			if( isOptClicked ){
				$('.product-detail-kv__buying-tool .pd-buying-tool__cost-box').replaceWith(selectorObj.buyingToolPriceBar.get(0));
			}else{
				priceTartget.innerHTML = '';
			}
			component.invokeTemplate("pdBuyingAnchor", drawObj, anchorPriceTextTartget);
			component.invokeTemplate("buyingPrice",drawObj, priceTartget);
			
			window.sg.common.icon.update(document.querySelector('.pd-g-product-detail-kv .product-detail-kv'));
			if(window.smg.wtb) {
				window.smg.wtb.common.reInit();
			}
		}
		
		/**
		 * Delivery Result 
		 */
		deliveryResultDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const deliveryResultTarget = selectorObj.buyingToolOptDeliveryResult.get(0);
			
			//  append 
			deliveryResultTarget.innerHTML = '';
			component.invokeTemplate("deliveryResult",drawObj, deliveryResultTarget);
			
			if( drawObj.deliveryResult.hasComponent ){
				$(deliveryResultTarget).addClass('has-component');
				$(deliveryResultTarget).show();
			} else {
				$(deliveryResultTarget).removeClass('has-component');
				$(deliveryResultTarget).hide();
			}
			
			markupReinit();
		}
		
		/**
		 * Between (hybris splitPD sellout  lease   )
		 */
		betweenDraw( drawObj ){
		    const selectorObj = this.selectorObj;
		    const component = comp.dispatch(selectorObj.buyingTool);
		    

		    const betweenTarget = selectorObj.buyingToolOptBetween.get(0);
		    const betweenTargetEx = $(selectorObj.buyingToolOptBetween.get(0)).find('.pd-select-option__wrap').get(0);

		    //  append 
		    if( betweenTargetEx ){
		        betweenTargetEx.innerHTML = '';
		    }
		    component.invokeTemplate("between",drawObj, betweenTargetEx);
		    
		    if( drawObj.between.hasComponent ){
		        $(betweenTarget).addClass('has-component');
		        $(betweenTarget).show();
		    } else {
		        $(betweenTarget).removeClass('has-component');
		        $(betweenTarget).hide();
		    }
		}

		
		
		/**
		 * Delivery 
		 */
		deliveryDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const deliveryTarget = selectorObj.buyingToolOptDelivery.get(0);
			
			//  append 
			deliveryTarget.innerHTML = '';
			component.invokeTemplate("delivery",drawObj, deliveryTarget);
			
			if( drawObj.delivery.hasComponent ){
				$(deliveryTarget).addClass('has-component');
				$(deliveryTarget).show();
			} else {
				$(deliveryTarget).removeClass('has-component');
				$(deliveryTarget).hide();
			}
			
			markupReinit();
		}
		
		assuredBuyBackDraw ( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const assuredBuyBackTarget = selectorObj.buyingToolOptAssuredBuyBack.get(0);
			
			//  append 
			assuredBuyBackTarget.innerHTML = '';
			component.invokeTemplate("assuredBuyBack",drawObj, assuredBuyBackTarget);
			
			if( drawObj.assuredBuyBack.hasComponent ){
				$(assuredBuyBackTarget).addClass('has-component');
				$(assuredBuyBackTarget).show();
			} else {
				$(assuredBuyBackTarget).removeClass('has-component');
				$(assuredBuyBackTarget).hide();
			}
		}
		
		assuredBuyBackResultDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const assuredBuyBackResultTarget = selectorObj.buyingToolOptAssuredBuyBackResult.get(0);
			
			//  append 
			assuredBuyBackResultTarget.innerHTML = '';
			component.invokeTemplate("assuredBuyBackResult",drawObj, assuredBuyBackResultTarget);
			
			if( drawObj.assuredBuyBackResult.hasComponent ){
				$(assuredBuyBackResultTarget).addClass('has-component');
				$(assuredBuyBackResultTarget).show();
			} else {
				$(assuredBuyBackResultTarget).removeClass('has-component');
				$(assuredBuyBackResultTarget).hide();
			}
			
			markupReinit();
		}
		
		galaxyForeverDraw ( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const galaxyForeverTarget = selectorObj.buyingToolOptGalaxyForever.get(0);
			
			//  append 
			galaxyForeverTarget.innerHTML = '';
			component.invokeTemplate("galaxyForever",drawObj, galaxyForeverTarget);
			
			if( drawObj.galaxyForever.hasComponent ){
				$(galaxyForeverTarget).addClass('has-component');
				$(galaxyForeverTarget).show();
			} else {
				$(galaxyForeverTarget).removeClass('has-component');
				$(galaxyForeverTarget).hide();
			}
		}
		
		/**
		 * Galaxy Forever Result 
		 */
		galaxyForeverResultDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const galaxyForeverResultTarget = selectorObj.buyingToolOptGalaxyForeverResult.get(0);
			
			//  append 
			galaxyForeverResultTarget.innerHTML = '';
			component.invokeTemplate("galaxyForeverResult",drawObj, galaxyForeverResultTarget);
			
			if( drawObj.galaxyForeverResult.hasComponent ){
				$(galaxyForeverResultTarget).addClass('has-component');
				$(galaxyForeverResultTarget).show();
			} else {
				$(galaxyForeverResultTarget).removeClass('has-component');
				$(galaxyForeverResultTarget).hide();
			}
			
			markupReinit();
		}
		
		/**
		 * Upgrade 
		 */
		upgradeDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const upgradeTarget = selectorObj.buyingToolOptUpgrade.get(0);
			
			//  append 
			if( upgradeTarget ){
				upgradeTarget.innerHTML = '';
			}
			component.invokeTemplate("upgrade",drawObj, upgradeTarget);
			
			if( drawObj.upgrade.hasComponent ){
				$(upgradeTarget).addClass('has-component');
				$(upgradeTarget).show();
			} else {
				$(upgradeTarget).removeClass('has-component');
				$(upgradeTarget).hide();
			}
			
		}
		
		/**
		 * Warranty Result 
		 */
		warrantyResultDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const warrantyResultTarget = selectorObj.buyingToolOptWarrantyResult.get(0);
			
			//  append 
			warrantyResultTarget.innerHTML = '';
			component.invokeTemplate("warrantyResult",drawObj, warrantyResultTarget);
			
			if( drawObj.warrantyResult.hasComponent ){
				$(warrantyResultTarget).addClass('has-component');
				$(warrantyResultTarget).show();
			} else {
				$(warrantyResultTarget).removeClass('has-component');
				$(warrantyResultTarget).hide();
			}
			
			markupReinit();
		}
		
		/**
		 * Warranty vd Result 
		 */
		warrantyVdResultDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const warrantyVdResultTarget = selectorObj.buyingToolOptWarrantyVdResult.get(0);
			
			//  append 
			warrantyVdResultTarget.innerHTML = '';
			component.invokeTemplate("warrantyVdResult",drawObj, warrantyVdResultTarget);
			
			if( drawObj.warrantyVdResult.hasComponent ){
				$(warrantyVdResultTarget).addClass('has-component');
				$(warrantyVdResultTarget).show();
			} else {
				$(warrantyVdResultTarget).removeClass('has-component');
				$(warrantyVdResultTarget).hide();
			}
			
			markupReinit();
		}
		
		/**
		 * Care Result 
		 */
		careResultDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const careResultTarget = selectorObj.buyingToolOptCareResult.get(0);
			
			//  append 
			careResultTarget.innerHTML = '';
			component.invokeTemplate("careResult",drawObj, careResultTarget);
			
			if( drawObj.careResult.hasComponent ){
				$(careResultTarget).addClass('has-component');
				$(careResultTarget).show();
			} else {
				$(careResultTarget).removeClass('has-component');
				$(careResultTarget).hide();
			}
			
		}
		
		/**
		 * TariffOption 
		 */
		tariffOpionDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const tariffOptionTarget = selectorObj.buyingToolOptTariff.get(0);
			
			//  append 
			tariffOptionTarget.innerHTML = '';
			component.invokeTemplate("tariffOption",drawObj, tariffOptionTarget);
			
			if( drawObj.tariffOption.hasComponent ){
				$(tariffOptionTarget).addClass('has-component');
				$(tariffOptionTarget).show();
			} else {
				$(tariffOptionTarget).removeClass('has-component');
				$(tariffOptionTarget).hide();
			}
			
		}
		
		/**
		 * TariffOption Result 
		 */
		tariffOpionResultDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const tariffOptionResultTarget = selectorObj.buyingToolOptTariffResult.get(0);
			
			//  append 
			tariffOptionResultTarget.innerHTML = '';
			component.invokeTemplate("tariffOptionResult", drawObj, tariffOptionResultTarget);
			
			if( drawObj.tariffOptionResult.hasComponent ){
				$(tariffOptionResultTarget).addClass('has-component');
				$(tariffOptionResultTarget).show();
			} else {
				$(tariffOptionResultTarget).removeClass('has-component');
				$(tariffOptionResultTarget).hide();
			}
			
			markupReinit();
		}
		
		/**
		 * bezel option 
		 */
		bezelOptionDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const bezelOptionTarget = selectorObj.buyingToolOptBezelOption.get(0);
			
			//  append 
			bezelOptionTarget.innerHTML = '';
			component.invokeTemplate("bezelOption", drawObj, bezelOptionTarget);
			
			if( drawObj.bezelOption.hasComponent ){
				$(bezelOptionTarget).addClass('has-component');
				$(bezelOptionTarget).show();
			} else {
				$(bezelOptionTarget).removeClass('has-component');
				$(bezelOptionTarget).hide();
			}
		}
		
		/**
		 * trade In 
		 */
		tradeInDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const tradeInTarget = selectorObj.buyingToolOptTradeIn.get(0);
			
			//  append 
			tradeInTarget.innerHTML = '';
			component.invokeTemplate("tradeIn", drawObj, tradeInTarget);
			
			if( drawObj.tradeIn.hasComponent ){
				$(tradeInTarget).addClass('has-component');
				$(tradeInTarget).show();
			} else {
				$(tradeInTarget).removeClass('has-component');
				$(tradeInTarget).hide();
			}
		}
		
		/**
		 * trade In Result 
		 */
		tradeInResultDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const tradeInResultTarget = selectorObj.buyingToolOptTradeInResult.get(0);
			
			const siteCode = this.sharedObj.siteCode;
			
			//  append 
			tradeInResultTarget.innerHTML = '';
			component.invokeTemplate("tradeInResult",drawObj, tradeInResultTarget);
			
		    //CRHQ-6829 vn -  , yes,no    
		    if( siteCode == 'vn' ){
				$('.product-detail-kv__buying-tool .pd-buying-tool .pd-select-option.trade-in .pd-select-option__wrap').hide();
		    }
		    //CRHQ-6829 vn -   , yes,no    
		    if( siteCode == 'vn' && ( !drawObj.tradeInResult.list || drawObj.tradeInResult.list.length == 0 ) ){
		        $('.product-detail-kv__buying-tool .pd-buying-tool .pd-select-option.trade-in .pd-select-option__wrap').show();
		    }
			if( drawObj.tradeInResult.hasComponent ){
				$(tradeInResultTarget).addClass('has-component');
				$(tradeInResultTarget).show();
				
				var priceOverFlagAndMaxSize = false;

				if(this.sharedObj.isMultiTradeIn){
                    priceOverFlagAndMaxSize = ((drawObj.tradeInResult.list && drawObj.tradeInResult.list.length >= this.sharedObj.maxTradeInsAllowed) || drawObj.tradeInResult.priceOverFlag);
				}

				//[COMP6FE-1495] Au Multi TradeIn   - 2        Add Another Trade-in 
				// [B2C][BC][IM] SEBN stackable trade in
				if( this.sharedObj.isMultiTradeIn && drawObj.tradeInResult.list && priceOverFlagAndMaxSize ){
				    // CRHQ-5944 [B2C][BC][IM] SEBN stackable trade in -   overPrice  another  (be,be_fr,nl)
					//CRHQ-8134 
				    /*if(siteCode === 'au'){
					    selectorObj.buyingToolOptTradeInResult.find('.limit-count').hide();
					}*/
					//    CRHQ-6172 sg, CRHQ-6829 vn , //CRHQ-8134 
					if(drawObj.tradeInResult.list.length >= this.sharedObj.maxTradeInsAllowed || siteCode == 'vn'){
					    selectorObj.buyingToolOptTradeInResult.find('.limit-count').addClass("cta--disabled").prop("disabled",true);
					    //CRHQ-8318 [B2C] AU tradein - max 'yes please' CTA 
						var isCommonTradein = $("#isCommonTradein").val();
						var isCommonTradeinCheck = (isCommonTradein == "Y");
						if(isCommonTradeinCheck){
							selectorObj.buyingToolOptTradeIn.find('#pd-trade-in-0').closest('.pd-option-selector').addClass("cta--disabled").prop("disabled",true);
						}

						//CRHQ-9892 [B2C] SG - tradein  add   
						if(siteCode == 'sg'){
							const $addOtherTradeInBtn = selectorObj.buyingToolOptTradeInResult.find('.limit-count');
							if($addOtherTradeInBtn && $addOtherTradeInBtn.length > 0 && $addOtherTradeInBtn.is(':visible')){
								$addOtherTradeInBtn.hide();
							}
						}
					}
					
					if( drawObj.tradeInResult.priceOverFlag ){
						if(siteCode === 'au'){
							selectorObj.buyingToolOptTradeInResult.find('.option-result__multiple-price').text(currencyComma(0, this.sharedObj.priceCurrency));
						}
						
						//CRHQ-6829 vn, OverPrice 
                        selectorObj.buyingToolOptTradeInResult.find('.over-price-alert').show();

						//CRHQ-6172 sg
						if( siteCode === 'sg' ){
						    selectorObj.buyingToolOptTradeInResult.find('.desc-target').show();
						}else{
						selectorObj.buyingToolOptTradeInResult.find('.desc-target').hide();
						}

						//CRHQ-9892 [B2C] SG - tradein  add   
						if(siteCode == 'sg'){
							const $addOtherTradeInBtn = selectorObj.buyingToolOptTradeInResult.find('.limit-count');
							if($addOtherTradeInBtn HQ-8866 [B2C] multi tradein -     
						selectorObj.buyingToolOptTradeInResult.find('.limit-count').addClass("cta--disabled").prop("disabled",true);
						selectorObj.buyingToolOptTradeIn.find('#pd-trade-in-0').closest('.pd-option-selector').addClass("cta--disabled").prop("disabled",true);
					} else {
						selectorObj.buyingToolOptTradeInResult.find('.over-price-alert').hide();
						selectorObj.buyingToolOptTradeInResult.find('.desc-target').show();
					}
				} else {
					selectorObj.buyingToolOptTradeInResult.find('.over-price-alert').hide();
				}
	
			} else {
				$(tradeInResultTarget).removeClass('has-component');
				$(tradeInResultTarget).hide();
			}
			
			markupReinit();
		}
		
		/**
		 * upgrade Result 
		 */
		upgradeResultDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const upgradeResultTarget = selectorObj.buyingToolOptUpgradeResult.get(0);
			
			//  append 
			upgradeResultTarget.innerHTML = '';
			component.invokeTemplate("upgradeResult",drawObj, upgradeResultTarget);
			
			if( drawObj.upgradeResult.hasComponent ){
				$(upgradeResultTarget).addClass('has-component');
				$(upgradeResultTarget).show();
			} else {
				$(upgradeResultTarget).hide();
				$(upgradeResultTarget).removeClass('has-component');
			}
			
			markupReinit();
			
		}
		
		
		/**
		 * upgrade Result (hybris only)
		 */
		upgradeResultHybrisDraw( drawObj ){
		    const selectorObj = this.selectorObj;
		    const component = comp.dispatch(selectorObj.buyingTool);
		    
		    const upgradeResultTarget = selectorObj.buyingToolOptUpgradeResult.get(0);
		    
		    //  append 
		    upgradeResultTarget.innerHTML = '';
		    component.invokeTemplate("upgradeResultHybris",drawObj, upgradeResultTarget);
		    
		    if( drawObj.upgradeResult.hasComponent ){
		        $(upgradeResultTarget).addClass('has-component');
		        //$(upgradeResultTarget).show();
		    } else {
		        //$(upgradeResultTarget).hide();
		        $(upgradeResultTarget).removeClass('has-component');
		    }
		    
		    markupReinit();
			
		}
		
		/**
		 * ajax  cta 
		 */
		productCtaDraw( drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const anchorPriceCtaTartget = $('.pd-header-navigation .pd-buying-price').get(0);
			const priceBarTartget = selectorObj.buyingToolPriceBar.get(0);
			
			
			// append 
			
			if( priceBarTartget ){
				priceBarTartget.innerHTML = '';
			}
			if( anchorPriceCtaTartget ){
				anchorPriceCtaTartget.innerHTML = '';
				
				component.invokeTemplate("pdBuyingAnchor",  drawObj, anchorPriceCtaTartget);
				component.invokeTemplate("buyingPrice",drawObj, priceBarTartget);
				
				window.sg.common.icon.update(document.querySelector('.pd-g-product-detail-kv .product-detail-kv'));
				if(window.smg.wtb) {
					window.smg.wtb.common.reInit();
				}
			}
		}
		
		/**
		 * ajax  AddOn Care 
		 */
		productAddOnCare( drawObj ){
			const selectorObj = this.selectorObj;
			
			const component = comp.dispatch(selectorObj.buyingTool);
			
			//  append 
			const targetCare = selectorObj.buyingToolOptCare.get(0);
			targetCare.innerHTML = '';
			
			component.invokeTemplate("care", drawObj, targetCare);
			
			//Care
			if(drawObj.care.hasComponent){
				$(selectorObj.buyingToolOptCare.get(0)).addClass('has-component');
				rowCodeSetting( selectorObj.buyingToolOptCare, drawObj.care.rowText );
				$(selectorObj.buyingToolOptCare.get(0)).show();
			} else {
				$(selectorObj.buyingToolOptCare.get(0)).hide();
			}
			
			//Care Result
			if(drawObj.careResult.hasComponent){
				$(selectorObj.buyingToolOptCare.get(0)).addClass('has-component');
				$(selectorObj.buyingToolOptCareResult.get(0)).show();
			} else {
				$(selectorObj.buyingToolOptCareResult.get(0)).hide();
			}
		}
		
		/**
		 * ajax  AddOn Warranty 
		 */
		productAddOnWarranty( drawObj ){
			const selectorObj = this.selectorObj;
			
			const component = comp.dispatch(selectorObj.buyingTool);
			
			//  append 
			const targetWarranty = selectorObj.buyingToolOptWarranty.get(0);
			targetWarranty.innerHTML = '';
			
			component.invokeTemplate("warranty", drawObj, targetWarranty);
			
			//warranty
			if(drawObj.warranty.hasComponent){
				$(selectorObj.buyingToolOptWarranty.get(0)).show();
			} else {
				$(selectorObj.buyingToolOptWarranty.get(0)).hide();
			}
			
			//Warranty Result
			if(drawObj.warrantyResult.hasComponent){
				$(selectorObj.buyingToolOptWarrantyResult.get(0)).show();
			} else {
				$(selectorObj.buyingToolOptWarrantyResult.get(0)).hide();
			}
			
		}
		
		/**
		 * ajax  Warranty VD 
		 */
		productAddOnWarrantyVd( drawObj ){
			const selectorObj = this.selectorObj;
			
			const component = comp.dispatch(selectorObj.buyingTool);
			
			//  append 
			const targetWarrantyVd = selectorObj.buyingToolOptWarrantyVd.get(0);
			targetWarrantyVd.innerHTML = '';
			
			component.invokeTemplate("warrantyVd", drawObj, targetWarrantyVd);
			
			//warrantyVd
			if(drawObj.warrantyVd.hasComponent){
				$(selectorObj.buyingToolOptWarrantyVd.get(0)).show();
			} else {
				$(selectorObj.buyingToolOptWarrantyVd.get(0)).hide();
			}
			
			//WarrantyVd Result
			if(drawObj.warrantyVdResult.hasComponent){
				$(selectorObj.buyingToolOptWarrantyVdResult.get(0)).show();
			} else {
				$(selectorObj.buyingToolOptWarrantyVdResult.get(0)).hide();
			}
			
		}
		
		/**
		 * ajax  offer 
		 */
		productOfferDraw( drawObj , isComboResult = false ){
			const selectorObj = this.selectorObj;
			
			const component = comp.dispatch(selectorObj.buyingTool);
			
			//  append 
			const target = selectorObj.buyingToolOptOffer.get(0);
			target.innerHTML = '';
			
			checkingHasOffer( drawObj, selectorObj );
			
			component.invokeTemplate("offer", drawObj, target);
			
			offerRowCodeSetting( drawObj, selectorObj );
			
			//CRHQ-8807- child offer add
            if(drawObj.offer.hasComponent && drawObj.offer.hasPackage){
                childOfferRowCodeSetting( drawObj, selectorObj );
            }
			
			//Offer 
			if(drawObj.offer.hasComponent){
				$(selectorObj.buyingToolOptOffer.get(0)).addClass('has-component');
				$(selectorObj.buyingToolOptOffer.get(0)).show();
			} else {
				$(selectorObj.buyingToolOptOffer.get(0)).hide();
			}
			
			window.sg.common.icon.update(document.querySelector('.pd-g-product-detail-kv .product-detail-kv'));
			window.sg.common.lazyLoad.setLazyLoad()
			
		}
		
		/**
		 * Embed Addon 
		 */
		embedAddonDraw( sharedObj, drawObj ){
			const selectorObj = this.selectorObj;
			const component = comp.dispatch(selectorObj.buyingTool);
			
			const target = selectorObj.buyingToolOptEmbedAddon.get(0);
			
			//  append 
			target.innerHTML = '';
			component.invokeTemplate("embedAddon", drawObj, target);
			
			if( drawObj.embedAddon.hasComponent ){
				$('.pd-g-product-detail-kv .option-embed-addon').replaceWith(target);
				if( sharedObj.isLeasingPrice ){
					$('.option-embed-addon').attr('data-leasing-price', sharedObj.isLeasingPrice);
				}
				$('.option-embed-addon .add-on-product').each(function(){
					if( $(this).hasClass('add-on-product--out-of-stock') ){
						$(this).find('input').attr('disabled', 'disabled');
					}
				});
				$(selectorObj.buyingToolOptEmbedAddon.get(0)).addClass('has-component');
				$(selectorObj.buyingToolOptEmbedAddon.get(0)).show();
				if( sharedObj.isOptClicked ){
					sharedObj.util.clickEventListener( sharedObj, selectorObj );
				}
				
			} else {
				$(selectorObj.buyingToolOptEmbedAddon.get(0)).removeClass('has-component');
				$(selectorObj.buyingToolOptEmbedAddon.get(0)).hide();
			}
		}
		
		/**
		 * product   
		 */
		productDraw( drawObj ){
			const selectorObj = this.selectorObj;
			
			const component = comp.dispatch(selectorObj.buyingTool);
			const anchorPriceTextTartget = $('.pd-header-navigation .pd-buying-price').get(0);
			const betweenTarget = $(selectorObj.buyingToolOptBetween.get(0)).find('.pd-select-option__wrap').get(0);
			const priceTartget = selectorObj.buyingToolPriceBar.get(0);
			
			checkingHasOffer( drawObj, selectorObj );
			
			//  append 
			initOptionHtmlInner( selectorObj );
			
			if( anchorPriceTextTartget ){
				component.invokeTemplate("pdBuyingAnchor", drawObj, anchorPriceTextTartget);
				component.invokeTemplate("buyingPrice",drawObj, priceTartget);
			}
			component.invokeTemplate("delivery", drawObj, selectorObj.buyingToolOptDelivery.get(0));
			component.invokeTemplate("deliveryResult", drawObj, selectorObj.buyingToolOptDeliveryResult.get(0));
			component.invokeTemplate("tariffOption", drawObj, selectorObj.buyingToolOptTariff.get(0));
			component.invokeTemplate("tariffOptionResult", drawObj, selectorObj.buyingToolOptTariffResult.get(0));
			//CRHQ-8807- child offer add
			component.invokeTemplate("offer", drawObj, selectorObj.buyingToolOptOffer.get(0));
			component.invokeTemplate("offerFinance", drawObj, selectorObj.buyingToolOptOfferFinance.get(0));
			component.invokeTemplate("care", drawObj, selectorObj.buyingToolOptCare.get(0));
			component.invokeTemplate("careResult", drawObj, selectorObj.buyingToolOptCareResult.get(0));
			component.invokeTemplate("warranty", drawObj, selectorObj.buyingToolOptWarranty.get(0));
			component.invokeTemplate("warrantyResult", drawObj, selectorObj.buyingToolOptWarrantyResult.get(0));
			component.invokeTemplate("bezelOption", drawObj, selectorObj.buyingToolOptBezelOption.get(0));
			component.invokeTemplate("tradeIn", drawObj, selectorObj.buyingToolOptTradeIn.get(0));
			component.invokeTemplate("tradeInResult", drawObj, selectorObj.buyingToolOptTradeInResult.get(0));
			component.invokeTemplate("upgrade", drawObj, selectorObj.buyingToolOptUpgrade.get(0));
			component.invokeTemplate("upgradeResult", drawObj, selectorObj.buyingToolOptUpgradeResult.get(0));
			component.invokeTemplate("galaxyForever",drawObj, selectorObj.buyingToolOptGalaxyForever.get(0));
			component.invokeTemplate("galaxyForeverResult",drawObj, selectorObj.buyingToolOptGalaxyForeverResult.get(0));
			component.invokeTemplate("assuredBuyBack",drawObj, selectorObj.buyingToolOptAssuredBuyBack.get(0));
			component.invokeTemplate("assuredBuyBackResult",drawObj, selectorObj.buyingToolOptAssuredBuyBackResult.get(0));
			component.invokeTemplate("embedAddon", drawObj, selectorObj.buyingToolOptEmbedAddon.get(0));
			component.invokeTemplate("calculator", drawObj, selectorObj.buyingToolCalculate.get(0) );
			component.invokeTemplate("between", drawObj, betweenTarget );
			
			checkingComponent( drawObj, selectorObj );
			offerRowCodeSetting( drawObj, selectorObj );
			
			//CRHQ-8807- child offer add
			if(drawObj.offer.hasPackage)
				childOfferRowCodeSetting( drawObj, selectorObj );
			
			rowCodeSetting( selectorObj.buyingToolOptCare, drawObj.care.rowText );
		}
		/**
		 *    
		 */
		anchorDraw( productTitle ){
			if( productTitle ){
				$(".pd-header-navigation .pd-header-navigation__headline-text").html(productTitle);
			}
		}
		
		/**
		 *   
		 */
		banerDraw( dateStr ){
			if(dateStr){
				//    >>     
				const bannerDateArea = $(".product-offer-banner .product-offer-banner__simple .product-offer-banner__simple-txt-area");
				bannerDateArea.addClass("is-active");
				bannerDateArea.attr("data-start-time", dateStr);
			}
		}
		
		productModel(){
			//    
			let drawObj = {
				'usEppData' : {
					'hasComponent' : false,
					'saveText' : null,
					'title' : null,
					'hasSelectBox' : false,
					'selectList' : [
						{
							'title' : null,
							'storeId': null
						}
					]
					
					
				},
				'between' : {
					'hasComponent' : false,
					'purchase' : {
						'text' : null
					},
					'nonPurchase' : {
						'text' : null,
						'dataLeaseing' : null,
						'tenureUnit': null,
						'tenureValue': null,
						'monthlyValue' : null,
						'paymentValue' : null,
						'paymentModeCode' : null
						
					}
				},
				'betweenResult' : {
					'hasComponent' : false,
					'description' : null,
					'price' : null,
					'disclaimer' : null
				},
				'upgrade' : {
					'hasComponent' : false,
					'isEmbededType' : false,
					'isNotEmbededType' : true,
					'title' : null,
					'description' : null,
					'learnMoreCta' : {
						'class' : null,
						'title' : null,
						'href' : null,
						'target' : null,
						'text' : null,
						'layerTarget' : null
					},
					'yesAttr' : {
						'class' : null,
						'text': null,
						'subText': null,
						'layerTarget' : null
					},
					'noAttr' : {
						'class' : null,
						'text': null,
						'layerTarget':null,
						'eventType' : null
					},
					'embedData' : {
						'listClass' : null,
						'infoData' : [
							{
								'iconLink' : null,
								'title' : null,
								'description' : null
							}
						],
						'tncData' : [
							{
								'index' : 0,
								'dataId' : null,
								'text' : null,
								'isReadOnly' : false
							}
						]
					}
				},
				'upgradeResult' : {
					'hasComponent' : false,
					'displayModelName' : null,
					'discountText1' : null,
					'description1' : null,
					'description2' : null,
					'dataId' : [],
					'dataPrice' : null,
				    'isGp' : true,
				    'isHybris' : false
				},
				'assuredBuyBack' : {
					'hasComponent' : false,
					'title' : null,
					'yesAttr' : {
						'class' : null,
						'text': null,
						'subText': null,
						'layerTarget' : null,
					},
					'noAttr' : {
						'class' : null,
						'text': null,
						'layerTarget':null,
						'eventType' : null
					}
				},
				'assuredBuyBackResult' : {
					'hasComponent' : false,
					'dataSku' : null,
					'dataPrice' : null,
					'dataSalePrice' : null,
					'displayModelName' : null,
					'dataModelName' : null,
					'pviTypeName' : null,
				},
				'galaxyForever' : {
					'hasComponent' : false,
					'title' : null,
					'description' : null,
					'learnMoreCta' : {
						'class' : null,
						'title' : null,
						'href' : null,
						'target' : null,
						'text' : null,
						'layerTarget' : null
					},
					'yesAttr' : {
						'class' : null,
						'text': null,
						'subText': null,
						'layerTarget' : null
					},
					'noAttr' : {
						'class' : null,
						'text': null,
						'layerTarget':null,
						'eventType' : null
					}
				},
				'galaxyForeverResult' : {
					'hasComponent' : false,
					'displayModelName' : null,
					'discountText1' : null,
					'description1' : null,
					'description2' : null,
					'dataId' : [],
					'dataPrice' : null
				},
				'bezelOption': {
					'hasComponent' : false,
					'sellingWithBazel': false,
					'noneSellingWithBazel': true,
					'noneType' : false,
					'modernType' : false,
					'beveledType' : false,
					'bezel' : false,
					'freestyle' : false,
					'noneTypeList' : [{
						'index' : 0,
						'modelCode' : null,
						'modelPatternCode' : null,
						'name' : null,
						'value' : null
					}],
					'modernTypeList': [{
						'index' : 0,
						'modelCode' : null,
						'modelPatternCode' : null,
						'name' : null,
						'value' : null
					}],
					'beveledTypeList': [{
						'index' : 0,
						'modelCode' : null,
						'modelPatternCode' : null,
						'name' : null,
						'value' : null
					}],
					'freestyleList': [{
						'index' : 0,
						'modelCode' : null,
						'modelPatternCode' : null,
						'name' : null,
						'value' : null
					}]
				},
				'tradeIn' : {
					'hasComponent' : false,
					'title' : null,
					'description' : null,
					'hasCeTradein' : false,
					'hasExchange' : true,
					'learnMoreCta' : {
						'class' : null,
						'title' : null,
						'href' : null,
						'target' : null,
						'text' : null,
						'layerTarget' : null
					},
					'yesAttr' : {
						'class' : null,
						'text': null,
						'subText': null,
						'eventType' : null,
						'layerTarget' : null,
						'skuCode' : null,
						'href' : null,
						'isDirectLink' : false,
						'isPopup' : false,
					},
					'noAttr' : {
						'class' : null,
						'text': null,
						'layerTarget':null,
						'eventType' : null,
						'modelCode': null,
						'modelName': null
					}
				},
				'tradeInResult' : {
					'hasComponent' : false,
					'hasCeTradein' : false,
					'textTitleCe' : null,
					'textCe' : null,
					'tooltip' : null,
					'displayModelName' : null,
					'isUpfront' : null, // true : instant , false : deffered
					'discountText1' : null,
					'discountText2' : null,
					'discountText3' : null,
					'specialDiscountText' : null,
					'description' : null,
					'dataPrice' : null, // 
					'dataCashBack' : null, //  
					'dataQuoteId' : null, // tradeIn Id
					'dataId' : [], // tradeIn TNC ,
					'priceOverFlag' : false, // MultiTradeIn       
					'list' : [{
						'index' : 0,
						'displayModelName' : null,
						'discountPriceText' : null,
						'dataPrice' : null,
						'dataCashBack' : null,
						'dataQuoteId' : null,
						'dataId' : [],
						'services' : null
					}] // [COMP6FE-1495] Au Multi TradeIn  
				},
				'care' : {
					'hasComponent' : false,
					'title' : null,
					'description' : null,
					'learnMoreCta' : {
						'class' : null,
						'title' : null,
						'href' : null,
						'target' : null,
						'text' : null,
						'layerTarget' : null
					},
					'yesAttr' : {
						'class' : null,
						'text': null,
						'subText': null,
						'layerTarget' : null
					},
					'noAttr' : {
						'class' : null,
						'text': null,
						'layerTarget':null,
						'eventType' : null
					},
					'itemSet' : [
						{
							'index' : 1,
							'prePopup' : false,
							'optionName' : null,
							'optionSalePrice' : null,
							'optionOriPrice' : null,
							'optionSavePrice' : null,
							'specialText' : null,
							'badge' : null,
							'paymentCycle' : null
						}
					],
					'rowText' : [
						{
							'target' : null,
							'text' : null
						}
					]
				},
				'careResult' : {
					'hasComponent' : false,
					'description' : null,
					'dataPrice' : null,
					'dataSalePrice' : null,
					'dataModelName' : null,
					'dataModelCode' : null,
					'dataId' : null,
					'price' : null,
					'disclaimer' : null,
					'savedPrice' : null
				},
				'warranty' : {
					'hasComponent' : false,
					'title' : null,
					'description' : null,
					'learnMoreCta' : {
						'class' : null,
						'title' : null,
						'href' : null,
						'target' : null,
						'text' : null,
						'layerTarget' : null
					},
					'yesAttr' : {
						'class' : null,
						'text': null,
						'layerTarget' : null
					},
					'noAttr' : {
						'class' : null,
						'text': null,
						'layerTarget':null,
						'eventType' : null
					}
				},
				'warrantyResult' : {
					'hasComponent' : false,
					'displayModelName' : null,
					'discountText1' : null,
					'description1' : null,
					'dataPrice' : null,
					'dataSalePrice' : null,
					'dataModelName' : null,
					'dataModelCode' : null,
					'dataId' : null,
					'savedPrice' : null
				},
				'warrantyVd' : {
					'hasComponent' : false,
					'title' : null,
					'description' : null,
					'learnMoreCta' : {
						'class' : null,
						'title' : null,
						'href' : null,
						'target' : null,
						'text' : null,
						'layerTarget' : null
					},
					'yesAttr' : {
						'class' : null,
						'text': null,
						'layerTarget' : null
					},
					'noAttr' : {
						'class' : null,
						'text': null,
						'layerTarget':null,
						'eventType' : null
					}
				},
				'warrantyVdResult' : {
					'hasComponent' : false,
					'title' : null,
					'price' : null,
					'smcCode' : null,
					'description' : null,
					'priceDisplay' : null
				},
				'emcTask' : [{
					'title' : null,
					'hasArea' : false,
					'srcPc' : null,
					'alt': null,
					'text' : null,
					'careId' : null
				}],
				'embedAddon' : {
					'hasComponent' : false,
					'title' : null,
					'description' : null,
					'itemSet' : []
				},
				'wishList' : {
					'stockLevelStatus' : null,
					'contentWrapperClass' : null,
					'moCode' : null,
					'moName' : null,
					'price' : null,
					'targetId' : null,
					'labelText': null,
					'isSelected' : null
				},
				'offerFinance' : {
					'hasComponent' : false,
					'title' : null,
					'description' : null,
					'learnMoreCta' : {
						'class' : null,
						'title' : null,
						'href' : null,
						'target' : null,
						'text' : null
					}
				},
				'offer' : {
					'hasComponent' : false,
					'hasPackage' : $("#pdPackageYn").val() == 'Y',
					'headline' : null,
					'delightDelivery' : {
						'title' : null,
						'hasItem' : false,
						'item' : {
							'headline' : null,
							'contentWrapperClass' : null,
							'description' : {
								'hasDescription' : false,
								'main' : [{
									'text' : null
								}]
							},
							'learnMoreCta' : {
								'class' : null,
								'title' : null,
								'href' : null,
								'target' : null,
								'text' : null
							},
							'imgAttr' : { 
								'classWapper' : null,
								'srcPc' : null,
								'srcMo' : null,
								'lazySrcPc' : null,
								'lazySrcMo' : null,
								'alt' : null
							}
						}
					},
					'combo' : [{
						'title' : null,
						'comboIndex' : 0,
						'hasItem' : false,
						'item' : {
							'headline' : null,
							'iconName' : null,
							'description' : {
								'hasDescription' : false,
								'main' : [{
									'text' : null
								}],
								'date': null
							},
							'learnMoreCta' : {
								'class' : null,
								'title' : null,
								'href' : null,
								'target' : null,
								'text' : null
							},
							'hasBundle' : false,
							'bundleList' : [
								{
									'headline' : null,
									'deleteTitle' : null,
									'dataPrice' : null,
									'dataSalePrice' : null,
									'dataEventType' : null,
									'dataModelName' : null,
									'dataDisplayName' : null,
									'pviTypeName' : null,
									'pviSubtypeName' : null,
									'categorySubTypeEngName' : null,
									'dataSkuCode' : null,
									'dataModelCode' : null,
									'dataIndex' : null,
									'imgAttr' : { 
										'classWapper' : null,
										'srcPc' : null,
										'srcMo' : null,
										'lazySrcPc' : null,
										'lazySrcMo' : null,
										'alt' : null
									},
									'price' : {
										'original' : null,
										'save' : null,
										'now' : null,
										'dataPrice' : null,
										'dataSalePrice' : null
									}
								}
							],
						}
					}],
					'gift' : {
						'title' : null,
						'giftIndex' : 0,
						'hasItem' : false,
						'item' : {
							'headline' : null,
							'description' : {
								'hasDescription' : false,
								'main' : [{
									'text' : null
								}],
								'date': null
							},
							'learnMoreCta' : {
								'class' : null,
								'title' : null,
								'href' : null,
								'target' : null,
								'giftIdx' : null,
								'text' : null
							},
							'hasBundle' : false,
							'bundleList' : [
								{
									'headline' : null,
									'deleteTitle' : null,
									'dataPrice' : null,
									'dataSalePrice' : null,
									'dataEventType' : null,
									'dataModelName' : null,
									'dataDisplayName' : null,
									'dataSkuCode' : null,
									'dataModelCode' : null,
									'pviTypeName' : null,
									'pviSubtypeName' : null,
									'categorySubTypeEngName' : null,
									'dataIndex' : null,
									'imgAttr' : { 
										'classWapper' : null,
										'srcPc' : null,
										'srcMo' : null,
										'lazySrcPc' : null,
										'lazySrcMo' : null,
										'alt' : null
									},
									'price' : {
										'original' : null,
										'save' : null,
										'now' : null,
										'dataPrice' : null,
										'dataSalePrice' : null
									}
								}
							],
						}
					},
					'bogo' : {
						'title' : null,
						'hasItem' : false,
						'item' : {
							'headline' : null,
							'contentWrapperClass' : null,
							'modelCode' : null,
							'modelName' : null,
							'displayName' : null,
							'pviTypeName' : null,
							'pviSubtypeName' : null,
							'categorySubTypeEngName' : null,
							'description' : {
								'hasDescription' : false,
								'main' : [{
									'text' : null
								}],
								'date': null
							},
							'imgAttr' : { 
								'classWapper' : null,
								'srcPc' : null,
								'srcMo' : null,
								'lazySrcPc' : null,
								'lazySrcMo' : null,
								'alt' : null
							},
							'price' : {
								'hasPrice' : false,
								'price' : null,
								'original' : null,
								'save' : null,
								'now' : null
							}
						}
					},
					'promotionMessage' : [{
						'title' : null,
						'hasItem' : false,
						'item' : {
							'contentWrapperClass' : null,
							'iconAttr' : {
								'src' : null,
								'alt' : null
							},
							'description' : {
								'hasDescription' : false
							},
							'rowText' : [
								{
									'target' : null,
									'text' : null
								}
							]
						}
					}],
					'promotionFinance' : [{
						'title' : null,
						'hasItem' : false,
						'item' : {
							'headline' : null,
							'contentWrapperClass' : null,
							'iconAttr' : {
								'src' : null,
								'alt' : null
							},
							'description' : {
								'hasDescription' : false
							},
							'rowText' : [
								{
									'target' : null,
									'text' : null
								}
							]
						}
					}],
					'promotionSmartclub' : [{
						'title' : null,
						'hasItem' : false,
						'item' : {
							'headline' : null,
							'contentWrapperClass' : null,
							'iconAttr' : {
								'src' : null,
								'alt' : null
							},
							'description' : {
								'hasDescription' : false
							},
							'rowText' : [
								{
									'target' : null,
									'text' : null
								}
							]
						}
					}],
					'childList' : [{
                        'hasComponent' : false,
                        'childCode' : null,
                        'displayName' : null,
                        'combo' : [],
                        'gift' : {},
                        'bogo' : {},
                        'promotionMessage' : [],
                        'promotionFinance' : [],
                        'promotionSmartclub' : []
                      }]
				},
				'tariffOption' : {
					'hasComponent' : false,
					'headline' : null,
					'description' : null,
					'logoList' : [
						{ 
							'src' : null,
							'alt' : null
						}
					]
				},
				'tariffOptionResult' : {
					'hasComponent' : false,
					'displayModelName' : null,
					'discountText1' : null,
					'description1' : null,
					'description2' : null,
					'dataPrice' : null,
					'dataSimskuCode' : null,
					'dataModelCode' : null,
					'dataId' : null
				},
				'delivery' : {
					'hasComponent' : false,
					'headline' : null,
					'label' : null,
					'cancelText' : null,
					'errorMessage' : null,
					'enterText' : null,
					'time' : null,
					'isPriorityDelivery' : false,
					'priorityDeliveryText' : null,
					'priorityDeliveryTooltip' : null,
					'labelClass' : null,
					'ctaClass' : null,
					'inputAttr' : {
						'maxlength':null,
						'disabled':null,
						'value': null
					},
					'submitAttr' :{
						
					}
				},
				'deliveryResult' : {
					'hasComponent' : false,
					'priorityCost' : null,
					'priorityText' : null,
					'mainText' : null,
					'subText': null,
					'decText' : null,
					'disclaimerList' : [{
						'disclaimer': null
					}]
				},
				'price' : {
					'classType' : null,
					'ctaWrapperClass' : null,
					'priceWrapper' : {
						'hasPriceWrapper' : false,
						'hasEnergyLabel' : false,
						'hasNewEnergyLabel' : false,
						'ficheAttr' : {
							'text': null,
							'class' : null,
							'href' : null,
							'title' : null,
							'target' : null
						},
						'labelAttr' : {
							'text': null,
							'class' : null,
							'href' : null,
							'title' : null,
							'target' : null,
							'spanClass' : null
						},
						'repairAttr' : {
							'text': null,
							'class' : null,
							'href' : null,
							'title' : null,
							'target' : null,
							'src' : null,
							'alt' : null,
							'an-la': null
						},
						'info' : {
							'orignalPrice': null,
							'orignalPriceAddText': null,
							'savePrice': null,
							'totalPrice' : null,
							'summaryPrice' : null,
							'vatText':null,
							'text' : null,
							'text2' : null,
							'salesPitch' : null,
							'fromText' : null,
							'monthlyPrice' :null,
							'stockCustomMessage' : null,
							'description' : null,
							'ceExchangePrice' : null,
							'savingInformation' : null,
							'salePriceFormatted' : null
						},
						'isLeasingInfo' : null,
					},
					'bespokeAttr' : { 
						'text': null,
						'class' : null,
						'href' : null,
						'title' : null,
						'target' : null
					},
					'wtbAttr' : { 
						'text': null,
						'class' : null,
						'href' : null,
						'title' : null,
						'target' : null,
						'moCode' : null,
						'dataModelName' : null,
						'dataSku' : null,
						'dataTtile' : null,
						'dataProductCode' : null,
						'imgSrc' : null,
						'iaCode' : null,
						'dataModelCode':null
					},
					'outlinedAttr' : {
						'text': null,
						'class' : null,
						'href' : null,
						'title' : null,
						'ctaType' : null,
						'target' : null
					},
					'containedAttr' : {
						'text': null,
						'class' : null,
						'href' : null,
						'title' : null,
						'ctaType' : null,
						'target' : null,
						'moCode' : null,
						'dataModelName' : null,
						'dataTtile' : null,
						'style' : null,
						'imgSrc' : null,
						'iaCode' : null,
						'dataModelCode':null
					},
					'reserveInStoreAttr' : {
						'text': null,
						'class' : null,
						'href' : null,
						'title' : null,
						'target' : null
					},
					'anchorNaviAttr' : {
						'text': null,
						'class' : null,
						'href' : null,
						'title' : null,
						'ctaType' : null,
						'target' : null,
						'moCode' : null,
						'dataModelName' : null,
						'dataTtile' : null,
						'imgSrc' : null,
						'iaCode' : null,
						'dataModelCode':null
					},
					'summaryArea' : {
						'embedAddonSelected' : null
					}
				},
				'priceAnchor' : {
					'priceWrapper' : {
						'info' : {
							'orignalPrice': null,
							'savePrice': null,
							'totalPrice' : null,
							'noLineOrignal' : null,
							'text' : null,
							'text2' : null,
							'fromText' : null,
							'monthlyPrice' :null,
							'stockCustomMessage' : null,
							'savingInformation' : null
						},
					}
				},
				'calculator' : {
					'hasComponent' : false,
					'emiAttr' : {
						'text': null,
						'class' : null,
						'href' : null,
						'target':null,
						'title' : null,
						'layerTarget' : null
					}
				}
			}
			
			return drawObj;
		}
		
		//22.12.16 [EPP] EAN Code 
		eanCodeDraw(){
			const eanCode = $('#eanCode').val();
			if ( $('p.pd-info__ean').length > 0 ){
				$('p.pd-info__ean').innerHTML = 'EAN : ' + eanCode;
			} else {
				$('p.pd-info__sku').after('<p class="pd-info__ean">EAN : ' + eanCode + '</p>');
			}
		}		
	}
	
	function rowCodeSetting( parent ,rowText ){
		if( rowText && rowText.length > 0 ){
			for ( var index in rowText ){
				const item = rowText[index];
				const $target = $( parent ).find(item.target);
				$target.html(item.text);
			}
		}
	}
	
	function offerRowCodeSetting( drawObj, selectorObj ){
		const offer = drawObj.offer;
		const rowList = [ offer.promotionMessage , offer.promotionFinance, offer.promotionSmartclub ];
		
		for( var offerListIndex in rowList ){
			for( var offerItemIndex in rowList[offerListIndex] ){
				const offerItem = rowList[offerListIndex][offerItemIndex].item;
				const rowCodeList = offerItem.rowText;
				for ( var rowIndex in rowCodeList ){
					const rowCode = rowCodeList[rowIndex];
					const $target = selectorObj.buyingToolOptOffer.find(rowCode.target);
					$target.html(rowCode.text);
				}
			}
		}
 	}
	
	//CRHQ-8807 - child offer add
	function childOfferRowCodeSetting( drawObj, selectorObj ){
		const offer = drawObj.offer;
        const childList = offer.childList;

        for(var cIndex in childList){

            const rowList = [ childList[cIndex].promotionMessage , childList[cIndex].promotionFinance, childList[cIndex].promotionSmartclub ];

    		for( var offerListIndex in rowList ){
    			for( var offerItemIndex in rowList[offerListIndex] ){
    				const offerItem = rowList[offerListIndex][offerItemIndex].item;
    				const rowCodeList = offerItem.rowText;
    				for ( var rowIndex in rowCodeList ){
    					const rowCode = rowCodeList[rowIndex];
    					const $target = selectorObj.buyingToolOptOffer.find(rowCode.target);
    					$target.html(rowCode.text);
    				}
    			}
    		}
        }
		
 	}
	
	/**
	 *  append    
	 */
	function initOptionHtmlInner( selectorObj ){
		const anchorPriceTextTartget = $('.pd-header-navigation .pd-buying-price').get(0);
		const priceTartget = selectorObj.buyingToolPriceBar.get(0);
		const target = selectorObj.buyingToolOptOffer.get(0);
		const careTarget = selectorObj.buyingToolOptCare.get(0);
		const warrantyTarget = selectorObj.buyingToolOptWarranty.get(0);
		const upgradeTarget = selectorObj.buyingToolOptUpgrade.get(0);
		const deliveryTarget = selectorObj.buyingToolOptDelivery.get(0);
		const tariffOptionTarget = selectorObj.buyingToolOptTariff.get(0);
		const bezelOptionTarget = selectorObj.buyingToolOptBezelOption.get(0);
		const tradeInTarget = selectorObj.buyingToolOptTradeIn.get(0);
		const calculatorTarget = selectorObj.buyingToolCalculate.get(0);
		const galaxyTarget = selectorObj.buyingToolOptGalaxyForever.get(0);
		const assuredBuyBackTarget = selectorObj.buyingToolOptAssuredBuyBack.get(0);
		const samsungFinanceTarget = selectorObj.buyingToolOptOfferFinance.get(0);
		const embedAddonTarget = selectorObj.buyingToolOptEmbedAddon.get(0);
		const betweenTargetEx = $(selectorObj.buyingToolOptBetween.get(0)).find('.pd-select-option__wrap').get(0);
		  
		target.innerHTML = '';
		priceTartget.innerHTML = '';
		if( anchorPriceTextTartget ){
			anchorPriceTextTartget.innerHTML = '';
		}
		if( bezelOptionTarget ){
			//bezelOptionTarget.innerHTML = '';
		}
		if( tradeInTarget ){
			tradeInTarget.innerHTML = '';
		}
		if( careTarget ){
			careTarget.innerHTML = '';
		}
		if( warrantyTarget ){
			warrantyTarget.innerHTML = '';
		}
		if( upgradeTarget ){
			upgradeTarget.innerHTML = '';
		}
		if( deliveryTarget ){
			deliveryTarget.innerHTML = '';
		}
		if( tariffOptionTarget ){
			tariffOptionTarget.innerHTML = '';
		}
		if( calculatorTarget ){
			calculatorTarget.innerHTML = '';
		}
		if( galaxyTarget ){
			galaxyTarget.innerHTML = '';
		}
		if( assuredBuyBackTarget ){
			assuredBuyBackTarget.innerHTML = '';
		}
		if( samsungFinanceTarget ){
			samsungFinanceTarget.innerHTML = '';
		}
		if( embedAddonTarget ){
			embedAddonTarget.innerHTML = '';
		}
	    if( betweenTargetEx ){
	        betweenTargetEx.innerHTML = '';
	    }
	}
	
	function markupReinit(){
		window.sg.components.productDetailKv.reInit();
		window.sg.common.icon.update(document.querySelector('.pd-g-product-detail-kv .product-detail-kv'));
	}
	
	/**
	 * offer    
	 */
	function checkingHasOffer( drawObj, selectorObj ){
		let checkgComponent = false;
		if( drawObj.offer.delightDelivery.hasItem ){
			checkgComponent = true;
		} else if( drawObj.offer.combo.length > 0 ){
			checkgComponent = true;
		} else if( drawObj.offer.gift.hasItem ){
			checkgComponent = true;
		} else if( drawObj.offer.bogo.hasItem ){
			checkgComponent = true;
		} else if( drawObj.offer.promotionMessage.length > 0){
			checkgComponent = true;
		} else if( drawObj.offer.promotionFinance.length > 0){
			checkgComponent = true;
		} else if( drawObj.offer.promotionSmartclub.length > 0){
			checkgComponent = true;
		} else if( drawObj.offer.childList.length > 0){ //CRHQ-8807- child offer
			checkgComponent = true;
		}
		drawObj.offer.hasComponent = checkgComponent;
	}
	
	/**
	 *         show Hide        class
	 */
	function checkingComponent( drawObj, selectorObj ){
		
		//Trade In
		if(drawObj.tradeIn.hasComponent){
			$(selectorObj.buyingToolOptTradeIn.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptTradeIn.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptTradeIn.get(0)).hide();
		}
		
		//Trade In Result
		if(drawObj.tradeInResult.hasComponent){
			$(selectorObj.buyingToolOptTradeInResult.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptTradeInResult.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptTradeInResult.get(0)).hide();
		}
		
		//Delivery
		if(drawObj.delivery.hasComponent){
			$(selectorObj.buyingToolOptDelivery.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptDelivery.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptDelivery.get(0)).hide();
		}
		
		//Delivery Result
		if(drawObj.deliveryResult.hasComponent){
			$(selectorObj.buyingToolOptDeliveryResult.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptDeliveryResult.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptDeliveryResult.get(0)).hide();
		}
		
		//Tariff Option
		if(drawObj.tariffOption.hasComponent){
			$(selectorObj.buyingToolOptTariff.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptTariff.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptTariff.get(0)).hide();
		}
		
		//Tariff Option Result
		if(drawObj.tariffOptionResult.hasComponent){
			$(selectorObj.buyingToolOptTariffResult.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptTariffResult.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptTariffResult.get(0)).hide();
		}
		
		//Offer
		if(drawObj.offer.hasComponent){
			$(selectorObj.buyingToolOptOffer.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptOffer.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptOffer.get(0)).hide();
		}
		
		//Care
		if(drawObj.care.hasComponent){
			$(selectorObj.buyingToolOptCare.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptCare.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptCare.get(0)).hide();
		}
		
		//Care Result
		if(drawObj.careResult.hasComponent){
			$(selectorObj.buyingToolOptCareResult.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptCareResult.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptCareResult.get(0)).hide();
		}
		
		//warranty
		if(drawObj.warranty.hasComponent){
			$(selectorObj.buyingToolOptWarranty.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptWarranty.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptWarranty.get(0)).hide();
		}
		
		//Warranty Result
		if(drawObj.warrantyResult.hasComponent){
			$(selectorObj.buyingToolOptWarrantyResult.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptWarrantyResult.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptWarrantyResult.get(0)).hide();
		}
		
		//Upgrade
		if(drawObj.upgrade.hasComponent){
			$(selectorObj.buyingToolOptUpgrade.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptUpgrade.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptUpgrade.get(0)).hide();
		}
		
		//Upgrade Result
		if(drawObj.upgradeResult.hasComponent){
			$(selectorObj.buyingToolOptUpgradeResult.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptUpgradeResult.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptUpgradeResult.get(0)).hide();
		}
		
		//AssuredBuyBack
		if(drawObj.assuredBuyBack.hasComponent){
			$(selectorObj.buyingToolOptAssuredBuyBack.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptAssuredBuyBack.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptAssuredBuyBack.get(0)).hide();
		}
		
		//AssuredBuyBack Result
		if(drawObj.assuredBuyBackResult.hasComponent){
			$(selectorObj.buyingToolOptAssuredBuyBackResult.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptAssuredBuyBackResult.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptAssuredBuyBackResult.get(0)).hide();
		}
		
		//Galaxy
		if(drawObj.galaxyForever.hasComponent){
			$(selectorObj.buyingToolOptGalaxyForever.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptGalaxyForever.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptGalaxyForever.get(0)).hide();
		}
		
		//Galaxy Result
		if(drawObj.galaxyForeverResult.hasComponent){
			$(selectorObj.buyingToolOptGalaxyForeverResult.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptGalaxyForeverResult.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptGalaxyForeverResult.get(0)).hide();
		}
		
		//Embed Addon
		if(drawObj.embedAddon.hasComponent){
			$(selectorObj.buyingToolOptEmbedAddon.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptEmbedAddon.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptEmbedAddon.get(0)).hide();
		}
		
		//Calculator
		if( selectorObj.buyingToolLinks.length === 0 && !drawObj.calculator.hasComponent ){
			$(selectorObj.buyingToolCalculateDivider.get(0)).hide();
		} else {
			$(selectorObj.buyingToolCalculateDivider.get(0)).show();
		}
		
		if(drawObj.calculator.hasComponent){
			$(selectorObj.buyingToolCalculate.get(0)).addClass('has-component');
			$(selectorObj.buyingToolCalculate.get(0)).show();
		} else {
			$(selectorObj.buyingToolCalculate.get(0)).hide();
		}
		
		//Between
		if(drawObj.between.hasComponent){
			$(selectorObj.buyingToolOptBetween.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptBetween.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptBetween.get(0)).hide();
		}

		//Offer 
		if(drawObj.offer.hasComponent){
			$(selectorObj.buyingToolOptOffer.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptOffer.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptOffer.get(0)).hide();
		}
		
		//samsungFinance
		if(drawObj.offerFinance.hasComponent){
			$(selectorObj.buyingToolOptOfferFinance.get(0)).addClass('has-component');
			$(selectorObj.buyingToolOptOfferFinance.get(0)).show();
		} else {
			$(selectorObj.buyingToolOptOfferFinance.get(0)).hide();
		}
	}
	
	dynamic.BuyingToolOpView = BuyingToolOpView;
})();


(() => {
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	class BuyingToolOpAjaxCommon {
		
		/**
		 * price.us api 
		 */
		setUsEppPrice( sharedObj, selectorObj ) {
			const tmktid =  $.cookies.get('tmktid', {domain : ".samsung.com"});
			const modelCode = sharedObj.modelCode;
			if( tmktid ){
				$.ajax({
					headers: {
						"Cache-Control": "no-cache",
						"Content-Type": "application/json",
						"Access-Control-Allow-Origin" : "*"
					},
					url: "https://www.samsung.com/us/shop/price.us",
					type: "POST",
					dataType: "json",
					timeout: 20000,
					data: JSON.stringify({
						"marketId": tmktid,
						"modelCodes": modelCode
					}),
					xhrFields: { withCredentials: true },
					success : function ( data ) {
						if( data && data.length > 0 ){
							for( var index in data ){
								const item = data[index];
								const modelCode = item.prdMdlCd;
								if( sharedObj.modelCode === modelCode && item.prdSavePriceInf ){
									let eppPrice = item.prdSavePriceInf.trim();
									eppPrice = deleteCurrency(eppPrice, sharedObj.priceCurrency);
									sharedObj.drawObj.usEppData.hasComponent = true;
									sharedObj.proudctPriceInfo.usEppPrice = eppPrice;
									sharedObj.drawObj.usEppData.upText = "Save an extra";
									sharedObj.drawObj.usEppData.saveText = currencyComma( eppPrice, sharedObj.priceCurrency);
									sharedObj.view.usEppDraw( sharedObj.drawObj );
									sharedObj.util.settingPriceDraw( sharedObj, selectorObj );
								}
							}
						}
					}
				});
			}
		}
		
		/**
		 * us productJson  
		 */
		setUsProductJson( sharedObj, selectorObj ) {
			$.ajax({
				headers: {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin" : "*"
				},
				url: "https://www.samsung.com/us/consumer/shop/productJson.json",
				type: "GET",
				dataType: "json",
				timeout: 20000,
				xhrFields: { withCredentials: true },
				success : function ( data ) {
					if( data ){
						if( data[sharedObj.modelCode] ){
							const item = data[sharedObj.modelCode];
							const eppMaxSavingPercentage = parseFloat(item.eppMaxSavingPercentage);
							
							sharedObj.drawObj.usEppData.hasComponent = true;
							sharedObj.drawObj.usEppData.upText = "Save up to an extra";
							sharedObj.drawObj.usEppData.saveText = currencyComma( sharedObj.proudctPriceInfo.salePrice*eppMaxSavingPercentage , sharedObj.priceCurrency);
							sharedObj.drawObj.usEppData.title = "with Samsung Discount Program";
							
							sharedObj.view.usEppDraw( sharedObj.drawObj );
							
						}
					}
				}
			});
		}
		
		/**
		 * us EppDiscount  
		 */
		setEppDiscount( sharedObj, selectorObj ) {
			$.ajax({
				headers: {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin" : "*"
				},
				url: "https://www.samsung.com/us/smg/content/samsung/content-library/prepurchase/eppdiscount/epp-discount.json",
				type: "GET",
				dataType: "json",
				timeout: 20000,
				xhrFields: { withCredentials: true },
				success : function ( data ) {
					if( data && data.eppDiscounts ){
						sharedObj.drawObj.usEppData.hasSelectBox = true;
						for( var index in data.eppDiscounts ){
							const item = data.eppDiscounts[index];
							const storeId = item.storeId;
							const label = item.label;
							
							sharedObj.drawObj.usEppData.selectList.push({
								'title' : label,
								'storeId': storeId,
								'index' : index
							})
						}
						sharedObj.view.usEppDraw( sharedObj.drawObj );
					}
				}
			});
		}
		//new-hybris
		callRelatedAndSearch( modelCode, callbackFnc, returnParam = {}, relatedApiParam, searchApiParam ){
			const totalResult = {};
			const finalResult = {};
			this.callRelatedProductAjax( modelCode, ( result, isSuccess, returnParam )=>{
				if( isSuccess ){
					finalResult['relatedAPI'] = result;

					if (result.products != null && result.products.length > 0) {
						for( const item of result.products ){
							const itemModelCode = item.modelcode;
							totalResult[itemModelCode] = {
								relatedAPI : item
							};
						}
					}
					if( Object.keys(totalResult).length > 0 ){
						this.callSearchApiAjax( Object.keys(totalResult), ( result, isSuccess, returnParam )=>{
							if( isSuccess ){
								finalResult['searchAPI'] = result;
								if (result.response.statusCode === 200 && result.response.resultData && result.response.resultData.productList ) {
									const productList = result.response.resultData.productList;
									for( const parentItem of productList ){
										const modelList = parentItem.modelList;
										for( const item of modelList ){
											const modelCode = item.modelCode;
											totalResult[modelCode].searchAPI = {
												categoryData : parentItem,
												modelData : item
											}
										}
									}
								}
							}

							finalResult['totalResult'] = totalResult;

							callbackFnc( finalResult, isSuccess, returnParam );
						}, returnParam, searchApiParam )
					}else { 
						callbackFnc( finalResult, isSuccess, returnParam );
					}
				} else {
					callbackFnc( finalResult, isSuccess, returnParam );
				}
			}, returnParam, relatedApiParam )
		 * //new-hybris
		 */
		callSearchApiAjax( modelList=[], callbackFnc, returnParam = {}, apiParam ){
			const searchDomain = $("#searchDomain").val();
			const siteCode = $("#siteCode").val();
			const stage = $("#apiStageInfo").val();
			const isGpv2 = $("#shopIntegrationFlag") ? $("#shopIntegrationFlag").val().indexOf('GPv2') >-1 : true;
			const isHyIntg = $("#shopIntegrationFlag") ? $("#shopIntegrationFlag").val().indexOf('Hybris-intg') >-1 : true;
			const isHyNew = $("#shopIntegrationFlag") ? $("#shopIntegrationFlag").val().indexOf('Hybris-new') >-1 : true; //new-hybris
			const addonStepBuying04 = $("#categorySubTypeCode").val().length > 2 && $("#categorySubTypeCode").val().substring(0,2) === "04" ? true : false;
			const addonStepBuying0701 = $("#categorySubTypeCode").val().length > 4 && $("#categorySubTypeCode").val().substring(0,4) === "0701" ? true : false;
			const isEmbedAddOn = ($("#shopIntegrationFlag").val() === 'Hybris-new' || $("#shopIntegrationFlag").val() === 'Hybris' || $("#shopIntegrationFlag").val() === 'Hybris-intg') && $("#apiChangeCategoryGroupCode").val() === '08000000' ? true : false;
			const isVDSTEPBUYING = addonStepBuying04 || addonStepBuying0701 || isEmbedAddOn;
			let dotcomMultistore = '';
			
			if( siteCode === 'levant' ){
				dotcomMultistore='jo';
			} else if( siteCode === 'levant_ar' ){
				dotcomMultistore='jo_ar';
			} else if( siteCode === 'n_africa' ){
				dotcomMultistore='ma';
			} else if( ( siteCode === 'ae' || siteCode === 'ae_ar' )){
				//NOTICE : dotcomMultistore     ae, ae_ar, kw, kw_ar, om, om_ar, bh, bh_ar    
				let tempDotcomMultistore = $.cookies.get('estoreSitecode', {domain : ".samsung.com"});
				if(tempDotcomMultistore) {
					if(tempDotcomMultistore === "ae" || tempDotcomMultistore === "ae_ar" || tempDotcomMultistore === "kw" || tempDotcomMultistore === "kw_ar" || tempDotcomMultistore === "om" || tempDotcomMultistore === "om_ar" || tempDotcomMultistore === "bh" || tempDotcomMultistore === "bh_ar" || tempDotcomMultistore === "qa" || tempDotcomMultistore === "qa_ar") {
						dotcomMultistore = tempDotcomMultistore;
					} else {
						dotcomMultistore = siteCode;
					}
				} else {
					dotcomMultistore = siteCode;
				}
			}

			let urlType = '';

			if( isGpv2 ){
				urlType = 'gpv2';
			} else if( isHyIntg ){
				urlType = 'hybris';
			} else if( isHyNew ){
				urlType = 'newhybris';
			} else {
				urlType = 'global';
			}
			
			// epp search  
			const isEPP = $('#isEppPage').val() === 'true';
			const businessType = isEPP ? 'epp/v2': 'b2c';

			const gpSearchUrl = `${searchDomain}/${stage}/${businessType}/product/card/detail/${urlType}`;

			let param = {
				'siteCode' : siteCode,
				'modelList' : modelList.join(','),
				'saleSkuYN':'N',
				'onlyRequestSkuYN' : 'Y'
			};
			
			if(isEPP){
				param.companyCode  = $('#eppCompanyCode').val();
				param.shopSkuYN  = "N";
				
				const eppIsUserGroupPricing = window.sg.epp.common.isUserGroupPricing;
				if(eppIsUserGroupPricing){
					param['groupName'] = window.sg.epp.common.groupName;
				}
				
				//[EPP] in refurbished   selector 
				let offerId = location.pathname.match(/[0-9]{13}/g);
				if ( offerId != null && typeof offerId != 'undefined' && $.trim(offerId) != '' ){
					param['offerId'] = offerId[0];
				}
			}
			
			if( isVDSTEPBUYING ){
				param.vd3PACardYN = 'Y';
			}

			if(!isGpv2){
				param.commonCodeYN = 'N';
			} else {
				param.commonCodeYN = 'Y';
			}

			let result = '';
			let isSuccess = false;
			
			if( apiParam ){
				param = apiParam;
			}

			$.ajax({
				url: gpSearchUrl,
				type: "GET",
				data: param,
				dataType: "json",
				cache: true,
				crossDomain: true,
				timeout: 20000,
				success: function (data) {
					result = data;
					isSuccess = true;
				},
				complete : function (){
					callbackFnc(result, isSuccess, returnParam );
				}
			});
		}
		
		
		/**
		 *   SearchAPI Ajax  //new-hybris
		 */
		callRelatedProductAjax( modelCode, callbackFnc, returnParam = {}, apiParam ){
			let storeDomain = '';
			const siteCode = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : $("#siteCode").val();
			const isOldHybrisCheckService = $("#shopIntegrationFlag").val() === 'Hybris-intg' || $("#shopIntegrationFlag").val() === 'Hybris'; //[COMP6FE-1507] Hybris API    service  .   hybris  
			if( isOldHybrisCheckService && $("#newHyvStoreDomain").val() ){
				storeDomain = $("#newHyvStoreDomain").val();
			} else {
				storeDomain = $("#storeDomain").val();
			}
			const relatedProductsUrl = `${storeDomain}/tokocommercewebservices/v2/${siteCode}/products/${modelCode}/relatedProducts?fields=SIMPLE_INFO`;
			let param = {
				"queryType": "ACCESSORIES"
			};
			let result = '';
			let isSuccess = false;
			
			if( apiParam ){
				param = apiParam;
			}
			
			if( $('#shopParmLang').val() ){
				param['lang']=$('#shopParmLang').val();
			}
			
			var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};

			$.ajax({
				url: relatedProductsUrl,
				type: "GET",
				data: param,
				dataType: "json",
				cache: true,
				crossDomain: true,
				timeout: 10000,
				xhrFields: _xhrFields,
				success: function (data) {
					result = data;
					isSuccess = true;
				},
				complete : function (){
					callbackFnc(result, isSuccess, returnParam );
				}
			});
		}
		
		//  getRelatedProductsSimpleInfo
		callRelatedProductAjaxOldHybris( sharedObj, modelCode, callbackFnc, returnParam = {}, apiParam ){
			const storeDomain = $("#storeDomain").val();
			const siteCode = sharedObj.multistoreSiteCd;
			// epp shop 
			const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : siteCode;
			
			const relatedProductsUrl = `${storeDomain}/${siteCodeWithEpp}/servicesv2/getRelatedProductsSimpleInfo?productCode=${modelCode}`;
			//TODO :     
			let param = {
				"queryType": "ACCESSORIES"
			};
			let result = '';
			let isSuccess = false;
			
			if( apiParam ){
				param = apiParam;
			}
			
			let jsonpCallback = 'Query1910499421933433041_151';
			if( sharedObj.hasGift && !sharedObj.hasBundle ){
				jsonpCallback = 'Query1910499421933433041_152';
			}else if( sharedObj.hasGift && sharedObj.hasBundle ){
				sharedObj.bundleCnt++;
				jsonpCallback = 'Query1910499421933433041_153'+sharedObj.bundleCnt;
			}

			if(sharedObj.hybrisJsonYn === 'Y') {
				$.ajax({
					url: relatedProductsUrl,
					type: "GET",
					data: param,
					dataType: "json",
					cache: true,
					crossDomain: true,
					timeout: 10000,
					xhrFields: {withCredentials: true},
					success: function (data) {
						result = data;
						isSuccess = true;
					},
					complete : function (){
						callbackFnc(result, isSuccess, returnParam );
					}
				});
			} else {
				$.ajax({
					url: relatedProductsUrl,
					type: "GET",
					data: param,
					dataType: 'jsonp',
					jsonpCallback: jsonpCallback,
					cache: true,
					crossDomain: true,
					timeout: 10000,
					xhrFields: {withCredentials: true},
					success: function (data) {
						result = data;
						isSuccess = true;
					},
					complete : function (){
						callbackFnc(result, isSuccess, returnParam );
					}
				});
			}

		}
		
		// new-hybris : relatedCategorizedProducts
		callRelatedProductAjaxAddOns( modelCode, callbackFnc, returnParam = {}, apiParam ){
			const storeDomain = $("#storeDomain").val();
			const siteCode = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : $("#siteCode").val();
			
			let shopParm = '';
			if( $('#shopParmLang').val() ){
				shopParm=`&lang=${$('#shopParmLang').val()}`;
			}

			const relatedProductsUrl = `${storeDomain}/tokocommercewebservices/v2/${siteCode}/products/${modelCode}/relatedCategorizedProducts?fields=SIMPLE_INFO`;
			
			let result = '';
			let isSuccess = false;
			
			let param = '';
			if( apiParam ){
				param = apiParam;
				param.categoryPrefix = 'AEM_';
			}
			
			var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};

			$.ajax({
				url: relatedProductsUrl,
				type: "GET",
				data: param,
				dataType: "json",
				cache: true,  
				crossDomain: true,
				xhrFields: _xhrFields,
				timeout: 10000,
				success: function (data) {
					result = data;
					isSuccess = true;
				},
				complete : function (){
					callbackFnc(result, isSuccess, returnParam );
				}
			});
		}
		
		// old-hybris : getRelatedCategorizedProductsSimpleInfo
		callRelatedProductAjaxAddOnsOldHybris( isNewVD, sharedObj, modelCode, callbackFnc, returnParam = {}, apiParam ){
			const storeDomain = $("#storeDomain").val();
			const siteCode = sharedObj.multistoreSiteCd;
			// epp shop 
			const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : siteCode;

			const relatedProductsUrl = `${storeDomain}/${siteCodeWithEpp}/servicesv2/getRelatedCategorizedProductsSimpleInfo?productCode=${modelCode}`;
			
			let result = '';
			let isSuccess = false;
			
			let param = '';
			if( apiParam ){
				param = apiParam;
			}
			if( isNewVD ){
				param.categoryPrefix = 'AEM_';
			}
			
			let jsonpCallback = "Query1910499421933433041_161";
			if( isNewVD ){
				jsonpCallback = "Query1910499421933433041_162";
			}
			
			if(sharedObj.hybrisJsonYn === 'Y') {
				$.ajax({
					url: relatedProductsUrl,
					type: "GET",
					data: param,
					dataType: "json",
					cache: true,  
					crossDomain: true,
					timeout: 10000,
					xhrFields: {withCredentials: true},
					success: function (data) {
						result = data;
						isSuccess = true;
					},
					complete : function (){
						callbackFnc(result, isSuccess, returnParam );
					}
				});
			} else {
				$.ajax({
					url: relatedProductsUrl,
					type: "GET",
					data: param,
					dataType: 'jsonp',
					jsonpCallback: jsonpCallback,
					cache: true,  
					crossDomain: true,
					timeout: 10000,
					xhrFields: {withCredentials: true},
					success: function (data) {
						result = data;
						isSuccess = true;
					},
					complete : function (){
						callbackFnc(result, isSuccess, returnParam );
					}
				});
			}
			
		}
		
		//vd stepbuying : addon    api
		callSimulatecartAjax( productCodes, callbackFnc, returnParam = {} ){
			let storeDomain = '';
			let siteCode = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : $("#siteCode").val();
			const isOldHybrisCheckService = $("#shopIntegrationFlag").val() === 'Hybris-intg' || $("#shopIntegrationFlag").val() === 'Hybris'; //[COMP6FE-1507] Hybris API    service  .   hybris  
			if( isOldHybrisCheckService && $("#newHyvStoreDomain").val() ){
				storeDomain = $("#newHyvStoreDomain").val();
			} else {
				storeDomain = $("#storeDomain").val();
			}
			
			let shopSiteCode = siteCode;
			if( $('#isEppPage').val() !== 'true' ){
				if (siteCode === "levant") {
					shopSiteCode = "jo";
				} else if (siteCode === "levant_ar") {
					shopSiteCode = "jo_ar";
				} else if (siteCode === "n_africa") {
					shopSiteCode = "ma";
				}
			}
			
			const simulatecartUrl = `${storeDomain}/tokocommercewebservices/v2/${shopSiteCode}/userData/anonymous/simulatecart`;
			const param = {
					"productCodes": productCodes
				};
			const _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};
			let result = '';
			let isSuccess = false;

			$.ajax({
				url: simulatecartUrl,
				type: "GET",
				data: param,
				dataType: "json",
				cache: true,
				crossDomain: true,
				timeout: 10000,
				xhrFields: _xhrFields,
				success: function (data) {
					result = data;
					isSuccess = true;
				},
				complete : function (){
					callbackFnc(result, isSuccess, returnParam );
				}
			});
		}
		
		/**
		 *  Us  Zip Api
		 */
		deliveryUsAPI( sharedObj, selectorObj , pinCode, shopSkuCode ){
			
			const url = sharedObj.apiDomain + '/v4/fulfillment/earliest-available-delivery-dates';
			const dataset="sku="+shopSkuCode+"&postal_code="+pinCode;
			
			// 
			sharedObj.drawObj.deliveryResult = {
				'hasComponent' : false,
				'mainText' : null,
				'decText' : null,
				'disclaimerList' : [{
					'disclaimer': null
				}]
			};
			
			$.ajax({
				headers: {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin": "*"
				},
				type : "GET",
				url : url,
				data: dataset,
				dataType : 'json',
				timeout : 10000,
				crossDomain: true,
				xhrFields: {
					withCredentials: true
				},
				success : function (data) {
					const drawObj = sharedObj.drawObj;
					const deliveryDrawObj = drawObj.delivery;
					const deliveryResultDrawObj = drawObj.deliveryResult;
					
					drawObj.delivery.errorMessage = null;
					
					if(data !== null && data.length > 0){
						let hasData = false;
						
						for( var dataIndex in data ){
							const deliveryItem = data[dataIndex];
							if( deliveryItem.sku && deliveryItem.sku === shopSkuCode && deliveryItem.earliest_available_delivery_date ){
								hasData = true;
								sharedObj.cartPinCode = pinCode;
								deliveryResultDrawObj.hasComponent = true;
								deliveryDrawObj.inputAttr.value = pinCode;
								
								const deliveryDate = new Date( deliveryItem.earliest_available_delivery_date );
								const year = deliveryDate.getUTCFullYear();
								const month = deliveryDate.getUTCMonth();
								const day =  deliveryDate.getUTCDate();
								var monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun','Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
								deliveryResultDrawObj.mainText = Granite.I18n.get('This product is available for delivery in your area');
								deliveryResultDrawObj.disclaimerList = [];
								deliveryResultDrawObj.disclaimerList.push({'disclaimer' : Granite.I18n.get('Earliest delivery : {0}', monthNames[month] + ' ' + day + ', ' +  year )})
								$.cookies.set("HA-Deeplink-Zipcode", pinCode, {domain : ".samsung.com"});
							}
						}
						
						if(!hasData){
							drawObj.delivery.errorMessage = 'This product is currently not available in your area.';
							drawObj.delivery.inputAttr.value = pinCode;
						}
					}else{
						drawObj.delivery.errorMessage = 'This product is currently not available in your area.';
						drawObj.delivery.inputAttr.value = pinCode;
						
					}
					
				},
				error : function( error ){
					const drawObj = sharedObj.drawObj;
					
					drawObj.delivery.errorMessage = 'This product is currently not available in your area.';
					drawObj.delivery.inputAttr.value = pinCode;
					
				}, complete : function (){
					const view = sharedObj.view;
					const drawObj = sharedObj.drawObj;
					const deliveryArea = $(selectorObj.buyingToolOptDelivery);
					const util = sharedObj.util;
					
					view.deliveryResultDraw(drawObj);
					view.deliveryDraw(drawObj);
					if( drawObj.delivery.errorMessage ){
						$(deliveryArea).find('.text-field-v2__text.error').show();
						$(deliveryArea).find('#delivery-zipcode').focus().val('').val(pinCode);
					} else {
						$(deliveryArea).find('.text-field-v2__text.error').hide();
						drawObj.delivery.errorMessage = null;
					}
					util.settingPriceCta( sharedObj.hasPriceCta, sharedObj, selectorObj, sharedObj.currentUrl );
				}
			});
		}
		
		/**
		 *  In   Zip Api
		 */
		deliveryAPI( sharedObj, selectorObj , pinCode, shopSkuCode ){
			
			const storeDomain = sharedObj.apiDomain;
			const pdHrefLang = sharedObj.pdHrefLang;
			const pdMultiLanguageYN = sharedObj.pdMultiLanguageYN;
			const isOldHybris = sharedObj.isOldHybrisCheckService;
			const siteCode = sharedObj.siteCode;
			
			sharedObj.drawObj.delivery.errorMessage = null;
			
			// 
			sharedObj.drawObj.deliveryResult = {
				'hasComponent' : false,
				'mainText' : null,
				'decText' : null,
				'disclaimerList' : [{
					'disclaimer': null
				}]
			};
			let param = {
                    "postal_code": pinCode,
                    "skus": [shopSkuCode]
                }
			let postalCodeCheckUrl = storeDomain + "/v4/configurator/postal-code-check";
			
            // epp  
            if( $('#isEppPage').val() === 'true' ){
                param["store_id"] = $('#eppCompanyCode').val();
            }
            
			if(isOldHybris){
				if(siteCode == "my"){
					param = {
		                    "postCode": pinCode,
		                    "sku": shopSkuCode
		                }
				
					postalCodeCheckUrl = storeDomain + "/" + siteCode + "/servicesv2/postal-code-check/getDeliveryTat";//
				}
				
				$.ajax({
					headers: {
						"Cache-Control": "no-cache",
						"Content-Type": "application/json",
						"Access-Control-Allow-Origin" : "*"
					},
					url: postalCodeCheckUrl,
					type: "GET",
					dataType: "json",
					timeout: 20000,
					data: param,
					xhrFields: { withCredentials: true },
					beforeSend : function(xhr){
						if(pdMultiLanguageYN === "Y"){
							xhr.setRequestHeader("x-ecom-locale", pdHrefLang);
						}
					},
					success : function (data) {
						const drawObj = sharedObj.drawObj;
						const deliveryDrawObj = drawObj.delivery;
						const deliveryResultDrawObj = drawObj.deliveryResult;
						const siteCode = sharedObj.siteCode;
						let errorMessage = '';
						if(data !== null){
							if(data.valid){
								sharedObj.cartPinCode = pinCode;
								deliveryResultDrawObj.hasComponent = true;
								deliveryDrawObj.inputAttr.value = pinCode;
								
								deliveryResultDrawObj.mainText = data.deliveryTurnAroundTime !== null ? data.deliveryTurnAroundTime : "";
								
								/* pinCode    (    ) */
								$.cookies.set("deliveryPincode", pinCode, {domain : ".samsung.com", path : "/"+siteCode});
							}else{
								errorMessage = Granite.I18n.get("Sorry, we do not ship to your zipcode currently.");
							}
						}else{
							errorMessage = Granite.I18n.get("Sorry, we do not ship to your zipcode currently.");
						}
						
						drawObj.delivery.errorMessage = errorMessage;
					},
					error : function( error ){
						const drawObj = sharedObj.drawObj;
						let errorMessage = '';
						if( error.responseJSON ){
							const errmsg = error.responseJSON;
							if( errmsg.message ){
								errorMessage = Granite.I18n.get( errmsg.message );
							}else{
								errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
							}
						}else{
							errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
						}
						
						drawObj.delivery.errorMessage = errorMessage;
					}, complete : function (){
						const view = sharedObj.view;
						const drawObj = sharedObj.drawObj;
						view.deliveryResultDraw(drawObj);
						view.deliveryDraw(drawObj);
						if( drawObj.delivery.errorMessage ){
							$(selectorObj.buyingToolOptDelivery).find('.text-field-v2__text.error').show();
							$(selectorObj.buyingToolOptDelivery).find('#delivery-zipcode').focus().val('').val(pinCode);
						}
					}
				});
				
			}else{
				// 
				$.ajax({
					headers: {
						"Cache-Control": "no-cache",
						"Content-Type": "application/json",
						"Access-Control-Allow-Origin" : "*"
					},
					url: postalCodeCheckUrl,
					type: "POST",
					dataType: "json",
					timeout: 20000,
					data: JSON.stringify(param),
					xhrFields: { withCredentials: true },
					beforeSend : function(xhr){
						if(pdMultiLanguageYN === "Y"){
							xhr.setRequestHeader("x-ecom-locale", pdHrefLang);
						}
					},
					success : function (data) {
						const drawObj = sharedObj.drawObj;
						const deliveryDrawObj = drawObj.delivery;
						const deliveryResultDrawObj = drawObj.deliveryResult;
						const siteCode = sharedObj.siteCode;
						let errorMessage = '';
						
						if(data !== null && data.length > 0){
							if(data[0].is_op_available){
								const dataZero = data[0];
								sharedObj.cartPinCode = pinCode;
								deliveryResultDrawObj.hasComponent = true;
								deliveryDrawObj.inputAttr.value = pinCode;
								
								deliveryResultDrawObj.mainText = Granite.I18n.get("Delivery available. Get it in {0}", (dataZero.turn_around_time !== null ? dataZero.turn_around_time : ""));
								
								if( dataZero.local_dealers && dataZero.local_dealers.length > 0){
									const deliveryInfo = dataZero.local_dealers[0];
									
									deliveryResultDrawObj.decText = deliveryInfo.store_name;
									
									if( deliveryInfo.address ){
										deliveryResultDrawObj.disclaimerList.push({'disclaimer':deliveryInfo.address});
									}
									if( deliveryInfo.contact_number ){
										deliveryResultDrawObj.disclaimerList.push({'disclaimer':deliveryInfo.contact_number});
									}
								}

								/* pinCode    (    ) */
								$.cookies.set("deliveryPincode", pinCode, {domain : ".samsung.com", path : "/"+siteCode});
							}else{
								errorMessage = Granite.I18n.get("Sorry, we do not ship to your zipcode currently.");
							}
						}else{
							errorMessage = Granite.I18n.get("Sorry, we do not ship to your zipcode currently.");
						}
						
						drawObj.delivery.errorMessage = errorMessage;
					},
					error : function( error ){
						const drawObj = sharedObj.drawObj;
						let errorMessage = '';
						if( error.responseJSON ){
							const errmsg = error.responseJSON;
							if( errmsg.message ){
								errorMessage = Granite.I18n.get( errmsg.message );
							}else{
								errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
							}
						}else{
							errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
						}
						
						drawObj.delivery.errorMessage = errorMessage;
					}, complete : function (){
						const view = sharedObj.view;
						const drawObj = sharedObj.drawObj;
						view.deliveryResultDraw(drawObj);
						view.deliveryDraw(drawObj);
						if( drawObj.delivery.errorMessage ){
							$(selectorObj.buyingToolOptDelivery).find('.text-field-v2__text.error').show();
							$(selectorObj.buyingToolOptDelivery).find('#delivery-zipcode').focus().val('').val(pinCode);
						}
					}
				});
			}
		}

		/**
		 * Newhybris zip api //new-hybris
		 */
		deliveryNewBybrisAPI( sharedObj, selectorObj , pinCode, shopSkuCode ){
			let shopParm = '';
			if( $('#shopParmLang').val() ){
				shopParm=`?lang=${$('#shopParmLang').val()}`;
			}
			
			var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};

			if(siteCode != 'id'){
				const apiURL = `${sharedObj.apiDomain}/tokocommercewebservices/v2/${sharedObj.siteCodeWithEpp}/products/${sharedObj.modelCode}/deliveryModes?fields=SIMPLE_INFO&postCode=${pinCode}`+shopParm;
				
				
				sharedObj.drawObj.delivery.errorMessage = null;
				// 
				sharedObj.drawObj.deliveryResult = {
					'hasComponent' : false,
					'priorityText' : null,
					'mainText' : null,
					'decText' : null,
					'disclaimerList' : [{
						'disclaimer': null
					}]
				};
				$.ajax({
					url: apiURL,
					type: "GET",
					dataType : "json",
					timeout: 30000,
					xhrFields: _xhrFields,
					crossDomain : true,
					contentType : "application/json",
					success : function (data) {
						const isAvailable = false; //data.~~
						const deliveryTime = data.deliveryTurnAroundTime; //data.~~
						const storeName = 'storeName'; //data.~~
						const address = 'address'; //data.~~
						const contaceNumber = 'number'; //data.~~

						if( data.valid ){
							sharedObj.drawObj.delivery.inputAttr.value = pinCode
							
							sharedObj.drawObj.deliveryResult = {
								'hasComponent' : data.valid,
								'priorityText' : null,
								'mainText' : Granite.I18n.get("Delivery available. Get it in {0}", deliveryTime),
								'decText' : storeName,
								'disclaimerList' : []
							};
								
							if( address ){
								sharedObj.drawObj.deliveryResult.disclaimerList.push({'disclaimer':address});
							}
							if( contaceNumber ){
								sharedObj.drawObj.deliveryResult.disclaimerList.push({'disclaimer':contaceNumber});
							}
	
							$.cookies.set("deliveryPincode", pinCode, {domain : ".samsung.com", path : "/"+ sharedObj.siteCode});

						} else{
							sharedObj.drawObj.delivery.errorMessage = Granite.I18n.get('Sorry, we do not ship to your zipcode currently.');
						}
						
					},
					error : function( error ){
						const drawObj = sharedObj.drawObj;
						let errorMessage = null;
						if( error.responseJSON ){
							const errmsg = error.responseJSON;
							if( errmsg.message ){
								errorMessage = Granite.I18n.get( errmsg.message );
							}else{
								errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
							}
						} else{
							errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
						}
						drawObj.delivery.errorMessage = errorMessage;
					}, complete : function (){
						const view = sharedObj.view;
						const drawObj = sharedObj.drawObj;
						
						if( drawObj.deliveryResult.priorityCost === 0 ) {
							drawObj.deliveryResult.mainText = null;
						}
						
						view.deliveryResultDraw(drawObj);
						view.deliveryDraw(drawObj);
						
						if( drawObj.delivery.errorMessage ){
							$(selectorObj.buyingToolOptDelivery).find('.text-field-v2__text.error').show();
							$(selectorObj.buyingToolOptDelivery).find('#delivery-zipcode').focus().val('').val(pinCode);
						}
						
						if( drawObj.delivery.priorityDeliveryText ) {
							$(selectorObj.buyingToolOptDelivery).find('.pd-select-option__tooltip').hide();
						}
						
						window.sg.components.pdBuyingTool.bindPdTooltipEvent(); // delivery tooltip
					}
				});
			}else{
				//new-hybris
				const storeWebDomain = $("#storeWebDomain").val();
				const apiURL = `${storeWebDomain}/${sharedObj.siteCodeWithEpp}/servicesv2/postal-code-check/getDeliveryTat?postCode=${pinCode}&sku=${sharedObj.modelCode}`;
				
				var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};
				
				sharedObj.drawObj.delivery.errorMessage = null;
				// 
				sharedObj.drawObj.deliveryResult = {
					'hasComponent' : false,
					'mainText' : null
				};
				$.ajax({
					url: apiURL,
					type: "GET",
					dataType : "json",
					timeout: 30000,
					xhrFields: _xhrFields,
					crossDomain : true,
					contentType : "application/json",
					success : function (data) {
						const isAvailable = false; //data.~~
						const deliveryTime = data.deliveryTurnAroundTime; //data.~~
						const storeName = 'storeName'; //data.~~
						const address = 'address'; //data.~~
						const contaceNumber = 'number'; //data.~~

						if( data.valid ){
							sharedObj.drawObj.delivery.inputAttr.value = pinCode
							
							sharedObj.drawObj.deliveryResult = {
								'hasComponent' : data.valid,
								'mainText' : Granite.I18n.get("Delivery available. Get it in {0}", deliveryTime)
							};
	
							$.cookies.set("deliveryPincode", pinCode, {domain : ".samsung.com", path : "/"+ sharedObj.siteCode});

						} else{
							sharedObj.drawObj.delivery.errorMessage = Granite.I18n.get('Sorry, we do not ship to your zipcode currently.');
						}
						
					},
					error : function( error ){
						const drawObj = sharedObj.drawObj;
						let errorMessage = null;
						if( error.responseJSON ){
							const errmsg = error.responseJSON;
							if( errmsg.message ){
								errorMessage = Granite.I18n.get( errmsg.message );
							}else{
								errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
							}
						} else{
							errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
						}
						drawObj.delivery.errorMessage = errorMessage;
					}, complete : function (){
						const view = sharedObj.view;
						const drawObj = sharedObj.drawObj;
						
						if( drawObj.deliveryResult.priorityCost === 0 ) {
							drawObj.deliveryResult.mainText = null;
						}
						
						view.deliveryResultDraw(drawObj);
						view.deliveryDraw(drawObj);
						
						if( drawObj.delivery.errorMessage ){
							$(selectorObj.buyingToolOptDelivery).find('.text-field-v2__text.error').show();
							$(selectorObj.buyingToolOptDelivery).find('#delivery-zipcode').focus().val('').val(pinCode);
						}
						
						if( drawObj.delivery.priorityDeliveryText ) {
							$(selectorObj.buyingToolOptDelivery).find('.pd-select-option__tooltip').hide();
						}
						
						window.sg.components.pdBuyingTool.bindPdTooltipEvent(); // delivery tooltip
					}
				});
			}
			
		}
		/**
		 * In  Zip Api
		 */
		deliveryInAPI( sharedObj, selectorObj , pinCode, shopSkuCode ){
			const storeDomain = sharedObj.apiDomain;
			// epp  
			let eppParam = '';
			if( $('#isEppPage').val() === 'true' ){
				eppParam = `&store_id=${$('#eppCompanyCode').val()}`;
			}

			const apiUrl = storeDomain + "/v4/configurator/serviceability?postal_code=" + pinCode + "&skus=" + [shopSkuCode] + eppParam;
			
			sharedObj.drawObj.delivery.errorMessage = null;
			
			var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};

			// 
			sharedObj.drawObj.deliveryResult = {
				'hasComponent' : false,
				'priorityText' : null,
				'mainText' : null,
				'decText' : null,
				'disclaimerList' : [{
					'disclaimer': null
				}]
			};
			$.ajax({
				url: apiUrl,
				type: "GET",
				dataType : "json",
				timeout: 30000,
				crossDomain : true,
				xhrFields: _xhrFields,
				contentType : "application/json",
				/*data: JSON.stringify({
					"postal_code": pinCode,
					"skus": [shopSkuCode]
				}),*/
				success : function (data, status, xhr) {
					const drawObj = sharedObj.drawObj;
					const deliveryDrawObj = drawObj.delivery;
					const deliveryResultDrawObj = drawObj.deliveryResult;
					let errorMessage = null;
					if ( xhr.status == 200 ) {
						const externalAttr = data[0].external_attributes;
						if( externalAttr.is_op_available ){
							if ( externalAttr.local_dealers[0] && externalAttr.local_dealers[0].serviceable ) {
								
								if ( data[0].delivery_modes && data[0].delivery_modes.length > 0 ) {
									let deliveryHtml = "";
									for (var i in data[0].delivery_modes) {
										const deliveryModes = data[0].delivery_modes[i];
										const tempProductsData = sharedObj.syndiProductData;
										const stockLevelStatus = sharedObj.stockLevelStatus;
										sharedObj.cartPinCode = pinCode;
										deliveryResultDrawObj.hasComponent = true;
										deliveryDrawObj.inputAttr.value = pinCode;
										
										if ( deliveryModes.custom_properties.delivery_mode_type && deliveryModes.estimated_delivery_date ) {
											const deliveryModeType = deliveryModes.custom_properties.delivery_mode_type;
											const isStandard = deliveryModeType.replace(/ /g,'').toLowerCase() === 'standard';
											const isPriority = deliveryModeType.replace(/ /g,'').toLowerCase() === 'prioritydelivery';
											const date = deliveryModes.estimated_delivery_date;
											const splitDate = Number(date.split("-")[2]);
											let shortDes = '';
											if ( deliveryModes.short_description ) {
												shortDes = deliveryModes.short_description;
											}
											const isSubText = deliveryModes.flags.is_installation_available;
											const subDate = deliveryModes.earliest_installation_date;
											let splitSubDate = "";
											if( isSubText && subDate && isStandard ){
												deliveryResultDrawObj.subText = 'Schedule installation & Demo : By ' + getFomattedDateByKartRocket(subDate, 'priority');
											}
											
											if ( isPriority ) {
												if ( deliveryModes.estimated_delivery_time ) {
													deliveryResultDrawObj.priorityCost = deliveryModes.cost.value;
													
													let time = deliveryModes.estimated_delivery_time;
													let ampm = '';
													if ( time ) {
														time = Number(time.split(":")[0]);
														if (time < 12) {
															ampm = 'AM';
														} else {
															if (time > 12) {
																time = time - 12;
															}
															ampm = 'PM';
														}
													}
													
													let curDate = Number(deliveryDrawObj.time.split(",")[1].trim().substring(0,2));
													let curHours = Number(deliveryDrawObj.time.split("GMT")[0].trim().slice(-8).split(":")[0]) + 5;		// GMT -> IST (+5)
													let curMinutes = Number(deliveryDrawObj.time.split("GMT")[0].trim().slice(-8).split(":")[1]) + 30;	// GMT -> IST (+30)
													if (curMinutes > 59) {
														curHours = curHours + 1;
													}
													if (curHours > 23) {
														curDate = curDate + 1;
													}
													
													let day = '';
													if ( curDate === splitDate ) {
														day = 'Today';
													} else if ( curDate + 1 === splitDate ) {
														day = 'Tomorrow';
													} else {
														day = getFomattedDateByKartRocket(date).split(",")[0];
													}
													
													deliveryResultDrawObj.priorityText = shortDes + ': ' + day + ' by ' + time + ' ' + ampm; // Priority Delivery : Today by 7pm
												}
											}
											
											if ( isStandard ) {
												deliveryResultDrawObj.mainText = shortDes + ': By ' + getFomattedDateByKartRocket(date, 'priority'); // Free Delivery : By Monday 8th Feb
											}
											
										}
									}
								} else {
									errorMessage = Granite.I18n.get('Sorry, we do not ship to your zipcode currently.');
								}
								
								if( externalAttr.local_dealers[0].store_name ){
									deliveryResultDrawObj.decText = externalAttr.local_dealers[0].store_name;
								}
								if( externalAttr.is_cod_available){
									if( JSON.stringify(deliveryResultDrawObj.disclaimerList).indexOf("Cash on delivery is available.") < 0 ) {
										deliveryResultDrawObj.disclaimerList.push({'disclaimer':Granite.I18n.get("Cash on delivery is available.")});
									}
								}else{
									if( JSON.stringify(deliveryResultDrawObj.disclaimerList).indexOf("Cash on delivery is not available for this location.") < 0 ) {
										deliveryResultDrawObj.disclaimerList.push({'disclaimer':Granite.I18n.get("Cash on delivery is not available for this location.")});
									}
								}
								
								/* pinCode    (    ) */
								$.cookies.set("deliveryPincode", pinCode, {domain : ".samsung.com", path : "/"+siteCode});
								
							} else {
								errorMessage = Granite.I18n.get('Sorry, we do not ship to your zipcode currently.');
							}
						} else {
							errorMessage = Granite.I18n.get('Sorry, we do not ship to your zipcode currently.');
						}
					} else {
						errorMessage = Granite.I18n.get('Sorry, we do not ship to your zipcode currently.');
					}
					drawObj.delivery.errorMessage = errorMessage;
				},
				error : function( error ){
					const drawObj = sharedObj.drawObj;
					let errorMessage = null;
					if( error.responseJSON ){
						const errmsg = error.responseJSON;
						if( errmsg.message ){
							errorMessage = Granite.I18n.get( errmsg.message );
						}else{
							errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
						}
					}else{
						errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
					}
					drawObj.delivery.errorMessage = errorMessage;
				}, complete : function (){
					const view = sharedObj.view;
					const drawObj = sharedObj.drawObj;
					
					if( drawObj.deliveryResult.priorityCost === 0 ) {
						drawObj.deliveryResult.mainText = null;
					}
					
					view.deliveryResultDraw(drawObj);
					view.deliveryDraw(drawObj);
					
					if( drawObj.delivery.errorMessage ){
						$(selectorObj.buyingToolOptDelivery).find('.text-field-v2__text.error').show();
						$(selectorObj.buyingToolOptDelivery).find('#delivery-zipcode').focus().val('').val(pinCode);
					}
					
					if( drawObj.deliver{
						$(selectorObj.buyingToolOptDelivery).find('.pd-select-option__tooltip').hide();
					}
					
					if( drawObj.deliveryResult.priorityText !== null && drawObj.tradeInResult.isUpfront === true ) {
						$(selectorObj.buyingToolOptDeliveryResult).find('.delivery-priority').hide();
					} else if( drawObj.deliveryResult.priorityText !== null && drawObj.tradeInResult.isUpfront === false ) {
						$(selectorObj.buyingToolOptDeliveryResult).find('.delivery-priority').show();
					}
					
					window.sg.components.pdBuyingTool.bindPdTooltipEvent(); // delivery tooltip
				}
			});
		}
		// CRHQ-2900 [B2C] IN PD Pincode          
		/*deliveryInAPI( sharedObj, selectorObj , pinCode, shopSkuCode ){
			const isPreqa = sharedObj.isPreqa;
			let apiUrl = "https://smapi.shiprocket.in/v1/samsung/serviceability";  //author,qa,www  
			if(isPreqa && isPreqa === "true" ){
				apiUrl = "https://smapi-uat.shiprocket.in/v1/samsung/serviceability";  //preqa
			}
			
			sharedObj.drawObj.delivery.errorMessage = null;
			// 
			sharedObj.drawObj.deliveryResult = {
				'hasComponent' : false,
				'mainText' : null,
				'decText' : null,
				'disclaimerList' : [{
					'disclaimer': null
				}]
			};
			$.ajax({
				url: apiUrl,
				type: "POST",
				dataType : "json",
				timeout: 30000,
				crossDomain : true,
				contentType : "application/json",
				data: JSON.stringify({
					"postal_code": pinCode,
					"skus": [{"sku" : shopSkuCode, "quantity": 1}]
				}),
				success : function (data) {
					const drawObj = sharedObj.drawObj;
					const deliveryDrawObj = drawObj.delivery;
					const deliveryResultDrawObj = drawObj.deliveryResult;
					let errorMessage = null;
					const dataZero = data.data[0];
					if( data.status === 200 && data.message ==="success") {	
						if( dataZero.is_op_available ){
							if ( dataZero.local_dealers[0].serviceable ) {
								const tempProductsData = sharedObj.syndiProductData;
								const stockLevelStatus = sharedObj.stockLevelStatus;
								sharedObj.cartPinCode = pinCode;
								let isPreOrder = false;
								let isO2O = false;
								deliveryResultDrawObj.hasComponent = true;
								deliveryDrawObj.inputAttr.value = pinCode;

								//check PRE ORDER 
								if( stockLevelStatus === "PREORDER" ){
									isPreOrder = true;
								}
								//check O2O 
								if(tempProductsData.flags.online_to_offline) {
									isO2O = true;
								}
								
								if( isO2O ) {
									if( isPreOrder ) {
										
										deliveryResultDrawObj.mainText = dataZero.custom_shipping_message;
										
										if( dataZero.local_dealers[0] ){
											if( dataZero.local_dealers[0].store_name ){
												deliveryResultDrawObj.decText = dataZero.local_dealers[0].store_name;
											}
											if( dataZero.local_dealers[0].address ){
												deliveryResultDrawObj.disclaimerList.push({'disclaimer':dataZero.local_dealers[0].address});
											}
											if( dataZero.local_dealers[0].contact_number ){
												deliveryResultDrawObj.disclaimerList.push({'disclaimer':dataZero.local_dealers[0].contact_number});
											}
										}
									} else {
										//NORMAL ORDER
										if(dataZero.local_dealers[0]){
											if( dataZero.local_dealers[0].estimated_delivery_date ){
												deliveryResultDrawObj.mainText = 'Free Delivery by '+ getFomattedDateByKartRocket(dataZero.local_dealers[0].estimated_delivery_date);
											} else {
												deliveryResultDrawObj.mainText = 'Free Delivery by ';
											}
											if( dataZero.local_dealers[0].store_name ){
												deliveryResultDrawObj.decText = dataZero.local_dealers[0].store_name;
											}
											if( dataZero.local_dealers[0].address ){
												deliveryResultDrawObj.disclaimerList.push({'disclaimer':dataZero.local_dealers[0].address});
											}
											if( dataZero.local_dealers[0].contact_number ){
												deliveryResultDrawObj.disclaimerList.push({'disclaimer':dataZero.local_dealers[0].contact_number});
											}
										}
									}
								} else {
									if( isPreOrder ) {
										
										deliveryResultDrawObj.mainText = dataZero.custom_shipping_message;
										
										if(dataZero.local_dealers[0]){
											if( dataZero.local_dealers[0].store_name ){
												deliveryResultDrawObj.decText = dataZero.local_dealers[0].store_name;
											}
										}
									} else {
										//NORMAL ORDER
										if( dataZero.local_dealers[0] ){
											
											if( dataZero.local_dealers[0].estimated_delivery_date ){
												deliveryResultDrawObj.mainText = 'Free Delivery by '+ getFomattedDateByKartRocket(dataZero.local_dealers[0].estimated_delivery_date);
											} else {
												deliveryResultDrawObj.mainText = 'Free Delivery by ';
											}
											
											if( dataZero.local_dealers[0].store_name ){
												deliveryResultDrawObj.decText = dataZero.local_dealers[0].store_name;
											}
										}
									}
								}
								
								if( data.data[0].is_cod_available){
									deliveryResultDrawObj.disclaimerList.push({'disclaimer':Granite.I18n.get("Cash on delivery is available.")});
								}else{
									deliveryResultDrawObj.disclaimerList.push({'disclaimer':Granite.I18n.get("Cash on delivery is not available for this location.")});
								}
										
								 pinCode    (    ) 
								$.cookies.set("deliveryPincode", pinCode, {domain : ".samsung.com", path : "/"+siteCode});
							} else {
								errorMessage = Granite.I18n.get('Sorry, we do not ship to your zipcode currently.');
							}
						}else{
							errorMessage = Granite.I18n.get('Sorry, we do not ship to your zipcode currently.');
						}
					}else{
						errorMessage = Granite.I18n.get('Sorry, we do not ship to your zipcode currently.');
					}
					drawObj.delivery.errorMessage = errorMessage;
				},
				error : function( error ){
					const drawObj = sharedObj.drawObj;
					let errorMessage = null;
					if( error.responseJSON ){
						const errmsg = error.responseJSON;
						if( errmsg.message ){
							errorMessage = Granite.I18n.get( errmsg.message );
						}else{
							errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
						}
					}else{
						errorMessage = Granite.I18n.get("We're sorry, an error occurred.");
					}
					drawObj.delivery.errorMessage = errorMessage;
				}, complete : function (){
					const view = sharedObj.view;
					const drawObj = sharedObj.drawObj;
					view.deliveryResultDraw(drawObj);
					view.deliveryDraw(drawObj);
					if( drawObj.delivery.errorMessage ){
						$(selectorObj.buyingToolOptDelivery).find('.text-field-v2__text.error').show();
						$(selectorObj.buyingToolOptDelivery).find('#delivery-zipcode').focus().val('').val(pinCode);
					}
				}
			});
		}*/
		
		externalAjax( sharedObj, selectorObj ){
			const storeDomain = sharedObj.apiDomain;
			const accessToken = sharedObj.accessToken;
			const shopSkuCode = sharedObj.shopSkuCode;
			const pdMultiLanguageYN = sharedObj.pdMultiLanguageYN;
			const pdHrefLang = sharedObj.pdHrefLang;
			const paramObj = {
					"access_token": accessToken,
					"skus": [shopSkuCode]
				}
				
			// epp  
			if( $('#isEppPage').val() === 'true' ){
				paramObj["store_id"] = $('#eppCompanyCode').val();
			}
			
			$.ajax({
				headers : {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin" : "*"
				},
				url : storeDomain + "/v1/exchange/external",
				type : "POST",
				dataType : "json",
				data : JSON.stringify(paramObj),
				timeout : 10000,
				xhrFields: { withCredentials: true },
				beforeSend : function(xhr){
					/* multi language    */
					if(pdMultiLanguageYN === "Y"){
						xhr.setRequestHeader("x-ecom-locale", pdHrefLang);
					}
				},
				success : function (data) {
					if(data !== null && data.length > 0){
						sharedObj.afterEvent.offerAndAddonsDiscount(data, "galaxyapp");
					}
				},
				error : function( error ){
					var errorText = "";
					if ( error.responseJSON && error.responseJSON.message ) {
						errorText = error.responseJSON.message;
					}
					confirmPopup(errorText);
				}, 
				complete : function (){
					history.replaceState({}, null, location.pathname);
				}
			});
		}
		
		exchangeInDataV1Api( sharedObj, selectorObj, initData ){
			const storeDomain = sharedObj.apiDomain;
			const param = {
					"device_info": {
						"imei": initData.IMEI
					},
					"offer_id": initData.notselected_offer_id,
					"device_id": initData.device_id,
					"postal_code": initData.postal_code,
					"sku": sharedObj.shopSkuCode
				}
			
			initData.dataQuoteId = initData.id;
			initData.foreverId = null;
			
			$.ajax({
				headers: {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin" : "*"
				},
				url: storeDomain + "/v1/exchange",
				type: "POST",
				dataType: "json",
				xhrFields: { withCredentials: true },
				crossDomain: true,
				data: JSON.stringify( param ),
				timeout : 5000,
				success : function ( foreverData ) {
					if( foreverData != null ){
						if(foreverData.estimated_discount != null && foreverData.estimated_discount.exchange_discount.amount != null && Number(foreverData.estimated_discount.exchange_discount.amount) != 0){
							initData.estimated_discount.exchange_discount.amount = foreverData.estimated_discount.exchange_discount.amount;
							initData.estimated_discount.total.amount = foreverData.estimated_discount.total.amount;
							
							initData.dataQuoteId = foreverData.id;
							initData.foreverId = initData.id;
							
						}else{
							initData.dataQuoteId = initData.id;
							initData.foreverId = foreverData.id;
						}
					}
				}, 
				complete : function (){
					sharedObj.util.settingExchangeAPIData( initData , sharedObj, selectorObj, sharedObj.view );
				}
				
			});
		}
		//CE Trade In 
		tradeInCeDataV1Api( sharedObj, selectorObj, initData ){
			const storeDomain = sharedObj.apiDomain;
			const param = {
					"device_id": initData.device_id,
					"device_info": {
						"product_condition":$(".radio-v2.active").children("input").val().toLowerCase()
					},
					"offer_id": initData.offer_id,
					"postal_code": initData.postal_code,
					"sku": initData.sku
				}
			
			initData.dataQuoteId = initData.id;
			initData.foreverId = null;
			
			$.ajax({
				headers: {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin" : "*"
				},
				url: storeDomain + "/v1/exchange",
				type: "POST",
				dataType: "json",
				xhrFields: { withCredentials: true },
				crossDomain: true,
				data: JSON.stringify( param ),
				timeout : 5000,
				success : function ( foreverData ) {
					if( foreverData != null ){
						if(foreverData.estimated_discount != null && foreverData.estimated_discount.exchange_discount.amount != null && Number(foreverData.estimated_discount.exchange_discount.amount) != 0){
							initData.estimated_discount.exchange_discount.amount = foreverData.estimated_discount.exchange_discount.amount;
							initData.estimated_discount.total.amount = foreverData.estimated_discount.total.amount;
							
							initData.dataQuoteId = foreverData.id;
							initData.foreverId = initData.id;
							
						}else{
							initData.dataQuoteId = initData.id;
							initData.foreverId = foreverData.id;
						}
					}
				}, 
				complete : function (){
					sharedObj.util.settingExchangeAPIData( initData , sharedObj, selectorObj, sharedObj.view );
				}
				
			});
		}
		
		//      >>   
		calcularAPI( zipCode ){
			const br_apiUrl = 'apiDomain' + "/br/ng/p4v1/calcShippingCost";
			const productCode = 'modelCode';
			const params = {"productCode" : productCode, "zipCode":zipCode};
			
			$.ajax({
				type : "GET",
				url : br_apiUrl,
				data : params,
				dataType : 'jsonp',
				jsonp : 'callback',
				timeout : 5000,
				success : function (data) {
				},
				error : function( error ){
				}
				
			});
		}
		
		
		
		
		waitSearchAPI( sharedObj, selectorObj ){
			if( sharedObj.checkingBogoSearchFlag && sharedObj.checkingComboSearchFlag && sharedObj.checkingAddOnSearchFlag && sharedObj.checkingGiftSearchFlag ){
				this.callSearchApi( sharedObj, selectorObj );
			}
		}
		//new-hybris
		historyBackEvent(){
			var androidYn = "N";
			if(navigator.userAgent.indexOf("Android 4.")!=-1 && navigator.userAgent.indexOf("AppleWebKit")!=-1){
				androidYn = "Y";
			}
			
			var addOnType = "add-on";
			var addOnType2 = "add on";
			var addOnType3 = "-option-select";
			if($(".hubble-addon-page").is(':visible')) {
				//  
				if($(".hubble-addon-page").hasClass("is-gift-type")){
					addOnType = "freegift";
					addOnType2 = "free gift";
					addOnType3 = "-cta-option alert popup";
				} else if(dynamic.detailSharedObj.isVoucher) { //new-hybris
					addOnType = "evoucher";
					addOnType2 = "evoucher";
				}
			}
			
			var checkpopstate = false;
			
			window.addEventListener("popstate", function(event) {
				  if (event) {
				    // Handle page restore. 
					checkpopstate = true;
					$("body").css("display","none");
				    window.location.reload();
				  }
			});
			if(!checkpopstate){
				$("body").css("display","");
			}
			setTimeout(function(){
				// back  
				history.pushState(null, document.title, location.href);
				
				window.addEventListener('popstate', function(event) {//    
					if(!checkpopstate){
						if($("#content").is(":visible")) {
							// buyingtool  
							history.back();
						} else {
							//P6 Modify //new-hybris
							var notifyObj = {
								htmlText: Granite.I18n.get("Your selections will not be saved if you exit. Exit window?", null, i18n_hint),
								btnPrimaryText: Granite.I18n.get("Yes", null, i18n_hint),
								btnGhostText: Granite.I18n.get("No", null, i18n_hint),
								btnPrimaryAttrs: {
									"an-tr": "bridge_" + addOnType2 + "-" + bcPageTrack() + addOnType3,
									"an-ca": "option click",
									"an-ac": "bridge",
									"an-la": addOnType + ":reset option:yes",
									"data-modelcode": dynamic.detailSharedObj.modelCode,
									"data-modeldisplay": dynamic.detailSharedObj.displayName,
									"data-modelname": dynamic.detailSharedObj.modelName,
									"data-modelrevenue": dynamic.detailSharedObj.proudctPriceInfo.salePrice,
									"data-modelprice": dynamic.detailSharedObj.proudctPriceInfo.salePrice,
									"data-pvitype": dynamic.detailSharedObj.pvitype.toLowerCase(),
									"data-pvisubtype": dynamic.detailSharedObj.pvisubtype.toLowerCase(),
									"data-discountprice": dynamic.detailSharedObj.proudctPriceInfo.salePrice,
									"data-pimsubtype": dynamic.detailSharedObj.pimsubtype.toLowerCase(),
									"data-modelqty": "1"
								},
								btnGhostyAttrs: {
									"an-tr": "bridge_" + addOnType2 + "-" + bcPageTrack() + addOnType3,
									"an-ca": "option click",
									"an-ac": "bridge",
									"an-la": addOnType + ":reset option:no",
									"data-modelcode": dynamic.detailSharedObj.modelCode,
									"data-modeldisplay": dynamic.detailSharedObj.displayName,
									"data-modelname": dynamic.detailSharedObj.modelName,
									"data-modelrevenue": dynamic.detailSharedObj.proudctPriceInfo.salePrice,
									"data-modelprice": dynamic.detailSharedObj.proudctPriceInfo.salePrice,
									"data-pvitype": dynamic.detailSharedObj.pvitype.toLowerCase(),
									"data-pvisubtype": dynamic.detailSharedObj.pvisubtype.toLowerCase(),
									"data-discountprice": dynamic.detailSharedObj.proudctPriceInfo.salePrice,
									"data-pimsubtype": dynamic.detailSharedObj.pimsubtype.toLowerCase(),
									"data-modelqty": "1"
								}
							};
							
							bc_confirm.notify(notifyObj, "history-back");
							// confirm event
							$('.confirm-popup').off( 'click', '.cta[data-event-type="history-back"]');
							$('.confirm-popup').on( 'click', '.cta[data-event-type="history-back"]', function (event) {
								
								if($(this).hasClass("cta--contained")){
									
									$("#wrap").removeClass("hubble-content__addon");
									$(".confirm-popup").hide();
									location.reload();								
									
								}else{
									history.pushState(null, document.title, location.href);
									$(".confirm-popup").hide();
									return false;
								}							
								
							});						

						}
					}
				});
			}, 500);
		}
		
		
		/**
		 *  SearchAPI  
		 */
		callSearchApi( sharedObj, selectorObj ){
			
			const siteCode = sharedObj.siteCode;
			var pdStageInfo = sharedObj.pdStageInfo;
			const pdSearchDomain = sharedObj.pdSearchDomain + '/';
			let totalList = [];
			let ajaxModelCodeList = '';
			
			const careAndWarrantySearchList = sharedObj.careAndWarrantySearchList;
			const careSearchList = sharedObj.careSearchList;
			const addOnSearchList = sharedObj.addOnSearchList;
			const giftSearchList = sharedObj.giftSearchList;
			const bogoSearchList = sharedObj.bogoSearchList;
			const comboSearchList = sharedObj.comboSearchList;
			const noComboSearchList = sharedObj.noComboSearchList = [];
			const realComboSearchList = sharedObj.realComboSearchList = [];
			
			for ( var careAndWarrantySearchListIndex in careAndWarrantySearchList ) {
				totalList.push( careAndWarrantySearchList[careAndWarrantySearchListIndex] );
			}
			
			for ( var careSearchListIndex in careSearchList ) {
				totalList.push( careSearchList[careSearchListIndex] );
			}
			
			for ( var addOnSearchListIndex in addOnSearchList ) {
				totalList.push( addOnSearchList[addOnSearchListIndex] );
			}
			
			for ( var giftSearchListIndex in giftSearchList ) {
				totalList.push( giftSearchList[giftSearchListIndex] );
			}
			
			for ( var bogoSearchListIndex in bogoSearchList ) {
				const item = bogoSearchList[bogoSearchListIndex];
				totalList.push( item.sku );
			}
			
			for ( var comboSearchListIndex in comboSearchList ) {
				const comboSearchitem = comboSearchList[comboSearchListIndex];
				const noSearchListTemp = [];
				const realSearchListTemp = [];
				for( var indexItem in comboSearchitem ){
					const item = comboSearchitem[indexItem];
					if( item.sku_source !== 'ecom' ){
						totalList.push( item.sku );
						realSearchListTemp.push( {'sku' : item.sku } );
					} else {
						noSearchListTemp.push( item );
					}
				}
				if( realSearchListTemp.length === 0 ){
					sharedObj.globalComboData.push(noSearchListTemp);
				}
				noComboSearchList.push(noSearchListTemp);
				realComboSearchList.push(realSearchListTemp);
			}
			
			ajaxModelCodeList = totalList.join(',');
			
			if( !ajaxModelCodeList ){
				return false;
			} else {
				sharedObj.finishedSearch = false;
			}
			
			var param = {
				'commonCodeYN' : 'Y',
				'siteCode' : siteCode,
				'modelList' : ajaxModelCodeList,
				'saleSkuYN':'N',
				'onlyRequestSkuYN' : 'Y'
			};
			
			// epp search  
			const isEPP = $('#isEppPage').val() === 'true';
			const businessType = isEPP ? 'epp/v2': 'b2c';
			
			if(isEPP){
				param.companyCode  = $('#eppCompanyCode').val();
				const eppIsUserGroupPricing = window.sg.epp.common.isUserGroupPricing;
				if(eppIsUserGroupPricing){
					param['groupName'] = window.sg.epp.common.groupName;
				}
			}
			
			var url = pdSearchDomain + pdStageInfo + '/'+businessType+'/product/card/detail/gpv2';
			
			$.ajax({
				url: url,
				type: 'GET',
				data : param,
				dataType : 'json',
				cache : true,
				success: function(data, responseText, jqXHR){
					const response = data.response;
					const util = sharedObj.util;
					
					if(response.statusCode === 200){
						const productList = response.resultData.productList;
						for ( var familyIndex in productList ){
							const productItem = productList[familyIndex];
							const modelList = productItem.modelList;
							for( var itemIndex in modelList ){
								const item = modelList[itemIndex];
								util.merge( sharedObj.totalSkuList, item.shopSKU, item , 'searchProductCard');
								
								//      
								if( sharedObj.totalSkuList[item.shopSKU] ){
									sharedObj.totalSkuList[item.shopSKU].categorySubTypeEngName= productItem.categorySubTypeEngName;
									sharedObj.totalSkuList[item.shopSKU].categorySubTypeCode = productItem.categorySubTypeCode;
									sharedObj.totalSkuList[item.shopSKU].familyIndex = familyIndex;
								}
							}
						}
						
						let addOnGiftSearchGPv2 = [];
						if( sharedObj.addOnGift ){
							if( sharedObj.addOnGift.products && sharedObj.addOnGift.products.length > 0 ){
								addOnGiftSearchGPv2 = sharedObj.addOnGift.products.filter(function(elem){
									for( let familyIndex in productList ){
										const productItem = productList[familyIndex]; 
										if( productItem.modelList && productItem.modelList.length > 0 ){
											const modelList = productItem.modelList;
											for( let modelIndex in modelList ){
												if( elem.modelCode === modelList[modelIndex].modelCode ){
													return productList[familyIndex];
												}
											}
										}
									}
								});
							}
						}
						
						let addOnSearchGPv2 = [];
						if( sharedObj.addOnApiList && sharedObj.addOnApiList.addOn ){
							if( sharedObj.addOnApiList.addOn.list && sharedObj.addOnApiList.addOn.list.length > 0 ){
								const addonList = sharedObj.addOnApiList.addOn.list;
								addOnSearchGPv2 = productList.filter(function(elem){
									for( let addonIndex in addonList ){
										for( let familyIndex in productList ){
											const productItem = productList[familyIndex]; 
											if( productItem.modelList && productItem.modelList.length > 0 ){
												const modelList = productItem.modelList;
												for( let modelIndex in modelList ){
													if( addonList[addonIndex].discounted_sku === modelList[modelIndex].shopSKU ){
														return elem;
													}
												}
											}
										}
									}
								});
								sharedObj.addOnSearchGPv2 = addOnSearchGPv2;
							}
						}
					}
				},
				error : function( XMLHttpRequest, textStatus, errorThrown ){
				},
				complete : function (){
					const util = sharedObj.util;
					const bogoSearchList = sharedObj.bogoSearchList;
					const addOnApiList = sharedObj.addOnApiList;
					const realComboSearchList = sharedObj.realComboSearchList;
					
					if( addOnApiList.careAndWarranty && util.isNotEmptyArray( addOnApiList.careAndWarranty.list )){
						for( var careAndWarrantyIndex in addOnApiList.careAndWarranty.list ){
							const item = addOnApiList.careAndWarranty.list[careAndWarrantyIndex];
							const sku =  item.sku;
							if( sharedObj.totalSkuList[sku] ){
								$.extend(item, sharedObj.totalSkuList[sku] );
							}
						}
					}
					
					if( addOnApiList.care && util.isNotEmptyArray( addOnApiList.care.list ) ){
						for( var careIndex in addOnApiList.care.list ){
							const item = addOnApiList.care.list[careIndex];
							const sku =  item.discounted_sku;
							if( sharedObj.totalSkuList[sku] ){
								$.extend(item, sharedObj.totalSkuList[sku] );
							}
						}
					}
					
					if( addOnApiList.addOn && util.isNotEmptyArray( addOnApiList.addOn.list ) ){
						for( var addOnApiListIndex in addOnApiList.addOn.list ){
							const item = addOnApiList.addOn.list[addOnApiListIndex];
							const sku =  item.discounted_sku;
							if( sharedObj.totalSkuList[sku] ){
								$.extend(item, sharedObj.totalSkuList[sku] );
							}
						}
						sharedObj.addOnCategoryList = sharedObj.addOnCategoryList.filter(elem=>{
							if( elem.category.productList.length > 0 ){
								return elem;
							}
						});
					}
					
					if( addOnApiList.addOn && util.isNotEmptyArray( addOnApiList.gift.list ) ){
						let hasGiftApiData = false;
						
						for( var addOnGiftApiListIndex = 0; addOnGiftApiListIndex < addOnApiList.gift.list.length; addOnGiftApiListIndex++ ){
							const item = addOnApiList.gift.list[addOnGiftApiListIndex];
							const sku =  item.discounted_sku;
							const skuData = sharedObj.totalSkuList[sku];
							const inventory = skuData.inventory;
							let isNonStock = false;
							
							if( inventory && inventory.status ){
								isNonStock = inventory.status.toUpperCase() === 'NOORDER' || inventory.status.toUpperCase() === 'OUTOFSTOCK';
							}
							
							// NOORDER, OUTOFSTOCK
							if( isNonStock ){
								addOnApiList.gift.list.splice(addOnGiftApiListIndex--, 1);
							} else {
								if( skuData && skuData.apiType.indexOf('searchProductCard') > -1 ){
									$.extend(item, sharedObj.totalSkuList[sku] );
									hasGiftApiData = true;
								}
							}
							
							
						}
						if( !hasGiftApiData ){
							sharedObj.drawObj.offer.gift.hasItem = false;
							sharedObj.view.productOfferDraw( sharedObj.drawObj ) ;
						}
						
						if( addOnApiList.gift.list.length === 0 ){
							if(sharedObj.hasAddOns ){
								window.sg.components.dynamic.bridgePageCommonHybris.moveBridgePage();
							}else{
								setInterval(function() {
									dynamic.DetailAfterEvent.addToCartCta([], true, true);
								}, 1000);
							}
						}
					}
					
					if( util.isNotEmptyArray( bogoSearchList ) ){
						for( var bogoSearchListIndex in bogoSearchList ){
							const item = bogoSearchList[bogoSearchListIndex];
							const sku =  item.sku;
							if( sharedObj.totalSkuList[sku] ){
								$.extend(item, sharedObj.totalSkuList[sku] );
							}
						}
						bogoDraw( sharedObj, selectorObj, bogoSearchList );
					}
					
					if( util.isNotEmptyArray( comboSearchList ) ){
						for( var comboSearchListIndex in realComboSearchList ){
							const comboSearch = realComboSearchList[comboSearchListIndex];
							for( var comboIndex in comboSearch ){
								const item = comboSearch[comboIndex];
								const sku =  item.sku;
								if( sharedObj.totalSkuList[sku] ){
									$.extend(item, sharedObj.totalSkuList[sku] );
								}
							}
						}
						seachApiOfferGridCombo( sharedObj );
					}
					
					sharedObj.finishedSearch = true;
					sharedObj.util.afterTotalAPI(sharedObj,selectorObj);
				}
			});
			
		}
		
		callAddOnApi ( sharedObj, selectorObj ){
			const shopSkuCode = sharedObj.shopSkuCode;
			const storeDomain = sharedObj.apiDomain;
			const url = storeDomain.replace('/v6/','') + '/v4/configurator/add-ons-linear';
			let dataset="sku="+shopSkuCode+"&expand_details=true";
			
			if( $('#isEppPage').val() === 'true' ){
				dataset += `&store_id=${$('#eppCompanyCode').val()}`;
			}

			sharedObj.finishedAddOn = false;
			
			$.ajax({
				headers: {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin": "*"
				},
				type : "GET",
				url : url,
				data: dataset,
				dataType : 'json',
				timeout : 10000,
				async: true,
				crossDomain: true,
				xhrFields: {
					withCredentials: true
				},
				success : function ( addOnApiData ) {
					let cnt=0;
					for(let i in addOnApiData.expanded.product_tags){
						cnt++;
						const productTags = addOnApiData.expanded.product_tags[i];
						const obj = {
								category: {
									display_name: productTags.formatted_sales_pitch[0] ? productTags.formatted_sales_pitch[0] : productTags.sales_pitch[0],
									id: productTags.id,
									product_tag: productTags.product_tag_name,
									key: cnt,
									order: cnt,
									productList: []
								}
						};
						sharedObj.addOnCategoryList.push(obj);
					}
					
					let tempAddonList = [];
					for( let i in addOnApiData.products ){
						for( let j in sharedObj.addOnInfoTemp ){
							if( addOnApiData.products[i].sku === sharedObj.addOnInfoTemp[j].discounted_sku ){
								tempAddonList.push(addOnApiData.products[i]);
							}
						}
					}
					
					for( let i in sharedObj.addOnCategoryList ){
						for( let j in tempAddonList ){
							for( let k in tempAddonList[j].product_tags ){
								if( sharedObj.addOnCategoryList[i].category.product_tag === tempAddonList[j].product_tags[k] ){
									sharedObj.addOnCategoryList[i].category.productList.push(tempAddonList[j]);
								}
							}
						}
					}
					
					let careAndWarrantySearchList = sharedObj.careAndWarrantySearchList = []; 
					let careSearchList = sharedObj.careSearchList = [];
					let addOnSearchList = sharedObj.addOnSearchList = [];
					let giftSearchList = sharedObj.giftSearchList = [];
					
					const addOnApiList = sharedObj.addOnApiList;
					const util = sharedObj.util;
					const isCare = sharedObj.pdSmcType !=='type2';
					
					if( addOnApiData && addOnApiData.products ){
						sharedObj.hasAddonApiData = true;
					}
					
					for (var apiItemSku in addOnApiData.products ){
						const apiItem = addOnApiData.products[apiItemSku];
						util.merge( sharedObj.totalSkuList, apiItemSku, apiItem, 'addOn' );
					}
					
					if( isCare ){
						if( util.isNotEmptyArray( addOnApiList.careAndWarranty.list ) ){
							const addOnInfo = addOnApiList.careAndWarranty.list;
							for ( var addOnInfoIndex in addOnInfo ) {
								if( addOnInfo[addOnInfoIndex].sku_source !== 'ecom' ){
									careAndWarrantySearchList.push(addOnInfo[addOnInfoIndex].discounted_sku);
								}
							}
						}
						
						if( util.isNotEmptyArray( addOnApiList.care.list ) ){
							const samsungCareList = addOnApiList.care.list;
							for ( var samsungCareListIndex in samsungCareList ) {
								if( samsungCareList[samsungCareListIndex].sku_source !== 'ecom' ){
									careSearchList.push(samsungCareList[samsungCareListIndex].discounted_sku);
								}
							}
						}
					}
					
					if(  util.isNotEmptyArray( addOnApiList.gift.list ) ){
						const addOnGiftTemp = addOnApiList.gift.list;
						for ( var addOnGiftTempIndex in addOnGiftTemp ) {
							if( addOnGiftTemp[addOnGiftTempIndex].discounted_sku ){
								giftSearchList.push(addOnGiftTemp[addOnGiftTempIndex].discounted_sku);
							}
						}
						
						$.extend( sharedObj.addOnGift.expanded, addOnApiData.expanded);
						settingGiftDraw( sharedObj, selectorObj );
					}
					
					if(  util.isNotEmptyArray( addOnApiList.addOn.list ) ){
						const addOnInfoTemp = addOnApiList.addOn.list;
						for ( var addOnInfoTempIndex in addOnInfoTemp ) {
							if( addOnInfoTemp[addOnInfoTempIndex].discounted_sku ){
								addOnSearchList.push(addOnInfoTemp[addOnInfoTempIndex].discounted_sku);
							}
						}
					}
					
				},
				error : function( error ){
					var errorText = "";
					if (error.responseJSON && error.responseJSON.message) {
						errorText = error.responseJSON.message;
						confirmPopup(errorText);
					}
					/*const headerCTA = $('.pd-buying-tool__cost-box .cost-box__cta .tg-continue');
					const summaryCTA = $('.pd-buying-price .pd-buying-price__cta .tg-continue');
					if( headerCTA && summaryCTA ){
						headerCTA.removeClass('tg-continue');
						summaryCTA.removeClass('tg-continue');
					}*/
				},
				complete : function (){
					const commonApiModel  = sharedObj.commonApiModel;
					const addOnApiList = sharedObj.addOnApiList;
					const util = sharedObj.util;
					sharedObj.checkingAddOnSearchFlag = true;
					sharedObj.finishedAddOn = true;
					sharedObj.checkingGiftSearchFlag = true;
					
					if( addOnApiList.careAndWarranty && util.isNotEmptyArray( addOnApiList.careAndWarranty.list )){
						for( var careAndWarrantyIndex in addOnApiList.careAndWarranty.list ){
							const item = addOnApiList.careAndWarranty.list[careAndWarrantyIndex];
							const sku =  item.sku;
							if( sharedObj.totalSkuList[sku] ){
								$.extend(item, sharedObj.totalSkuList[sku] );
							}
						}
					}

					if( addOnApiList.care && util.isNotEmptyArray( addOnApiList.care.list ) ){
						for( var careIndex in addOnApiList.care.list ){
							const item = addOnApiList.care.list[careIndex];
							const sku =  item.discounted_sku;
							if( sharedObj.totalSkuList[sku] ){
								$.extend(item, sharedObj.totalSkuList[sku] );
							}
						}
					}

					if( addOnApiList.addOn && util.isNotEmptyArray( addOnApiList.addOn.list ) ){
						for( var addOnIndex in addOnApiList.addOn.list ){
							const item = addOnApiList.addOn.list[addOnIndex];
							const sku =  item.discounted_sku;
							if( sharedObj.totalSkuList[sku] ){
								$.extend(item, sharedObj.totalSkuList[sku] );
							}
						}
					}
					
					if( addOnApiList.addOn && util.isNotEmptyArray( addOnApiList.gift.list ) ){
						for( var addOnGiftIndex in addOnApiList.gift.list ){
							const item = addOnApiList.gift.list[addOnGiftIndex];
							const sku =  item.discounted_sku;
							if( sharedObj.totalSkuList[sku] ){
								$.extend(item, sharedObj.totalSkuList[sku] );
							}
						}
						
						
					}
					
					commonApiModel.waitSearchAPI( sharedObj, selectorObj );
					sharedObj.util.afterTotalAPI(sharedObj,selectorObj);
				} 
			});
			
			
		}
 		
		/**
		 * WishList  
		 */
		settingWishList( sharedObj, selectorObj ){
			const drawObj = sharedObj.drawObj;
			const countryIsoCode = sharedObj.countryIsoCode;
			const wishList = drawObj.wishList;
			const loginJwt = $.cookies.get("jwt_"+countryIsoCode, {domain : ".samsung.com"});
			const stockLevelStatus = sharedObj.stockLevelStatus;
			const salePrice = sharedObj.proudctPriceInfo.salePrice;
			const loginFlag = commonLoginCheck();
			const storeDomain = sharedObj.apiDomain;
			const anchorMultiLanguageYN = sharedObj.pdMultiLanguageYN;
			const anchorHrefLang = sharedObj.pdHrefLang;
			const view = sharedObj.view;
			const isGPv2 = $("#shopIntegrationFlag").val().indexOf('GPv2') > -1;
			const util = sharedObj.util;
			const siteCode = sharedObj.siteCode;
					
			wishList.stockLevelStatus = stockLevelStatus;
			wishList.price = salePrice;
			wishList.moCode = sharedObj.shopSkuCode ? sharedObj.shopSkuCode : sharedObj.modelCode;
			wishList.moName = sharedObj.modelName;
			wishList.labelText = Granite.I18n.get('add wishlist');
			wishList.targetId='#wishlist-popup';
				
			/* wishlist focusing    */
			
			if (stockLevelStatus === "NOORDER" || stockLevelStatus === "LEARNMORE") {
				wishList.contentWrapperClass = 'js-btn-wishlist js-not-for-sale-wishlist tg-add-wishlist js-learnmore';
			} else {
				if( salePrice ){
					if ( !loginFlag ) {
						wishList.contentWrapperClass = 's-btn-wishlist js-create-wishlist tg-add-wishlist';
						
					} else {
						wishList.contentWrapperClass = 's-btn-wishlist js-select-wishlist tg-add-wishlist';
					}
				}else {
					wishList.contentWrapperClass = 'js-btn-wishlist js-not-for-sale-wishlist js-learnmore tg-add-wishlist';
				}
			}
			
			if( isGPv2 ){
				if( loginFlag ){
					// epp  
					let store_id = "";
					if( $('#isEppPage').val() === 'true' ){
						store_id = `?store_id=${$('#eppCompanyCode').val()}`;
					}
					$.ajax({
						headers: {
							"Cache-Control": "no-cache",
							"Content-Type": "application/json",
							"Access-Control-Allow-Origin" : "*",
							"x-ecom-app-id" : "identity-store-global",
							"x-ecom-jwt" : loginJwt
						},
						url : storeDomain + "/v4/identity/wishlist"+store_id,
						type : "GET",
						dataType : "json",
						timeout : 20000,
						xhrFields: { withCredentials: true },
						beforeSend : function(xhr){
							/* multi language    */
							if(anchorMultiLanguageYN === "Y"){
								xhr.setRequestHeader("x-ecom-locale", anchorHrefLang);
							}
						},
						success : function ( data, responseText, jqXHR ){
							const wishList = sharedObj.drawObj.wishList;
							const shopModelCode = wishList.moCode;
							
							if( data ){
								for(var idx=0; idx<data.length; idx++){
									const addedWishlistInfo = data[idx];
									if( addedWishlistInfo.deleted === false && addedWishlistInfo.sku === shopModelCode){
										wishList.labelText = Granite.I18n.get("Remove wishlist");
										wishList.contentWrapperClass = ('pd-wishlist-cta--on s-btn-wishlist js-select-wishlist is-async tg-remove-wishlist');
										wishList.isSelected = 'true';
										break;
									}
								}
							}
						},
						error: function( XMLHttpRequest, textStatus, errorThrown ){
							/*    Layer Popup  */
						},
						complete : function (){
							const view = sharedObj.view;
							const drawObj = sharedObj.drawObj;
							const util = sharedObj.util;
							view.productWishListDraw( drawObj );
							util.settingWishlistTagging( sharedObj, selectorObj );
							
						} 
					});
				} else {
					view.productWishLtWishListDraw( drawObj );
				util.settingWishlistTagging( sharedObj, selectorObj );
			} else if( $("#shopIntegrationFlag").val() == 'Hybris' && sharedObj.isOldHybrisWishlist.includes(siteCode)){
				view.productWishListDraw( drawObj );
				util.settingWishlistTagging( sharedObj, selectorObj );
			} 
			/*   account      */
			if(loginJwt === null || loginJwt === ""){
				return false;
			}
		}
		
		/**
		 * UpgradeTnc 
		 */
		settinsUpgradeTncData( sharedObj, selectorObj ){
			const modelList = [sharedObj.shopSkuCode];
			const storeDomain = sharedObj.apiDomain;
			// epp  
			let eppParam = '';
			if( isEPP ){
				eppParam = `&store_id=${$('#eppCompanyCode').val()}`;
			}
			var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};


			$.ajax({
				headers: {
					"Cache-Control" : "no-cache",
					"Content-Type" : "application/json",
					"Access-Control-Allow-Origin" : "*"
				},
				url: storeDomain + "/v1/tnc?display=upgrade&tags=" + modelList + "" + eppParam,
				type : "GET",
				dataType : "json",
				xhrFields: _xhrFields,
				timeout : 20000,
				success : function ( data, responseText, jqXHR ){
					if( data ){
						const tncData = [];
						const view = sharedObj.view;
						const drawObj = sharedObj.drawObj;
						for( var tdx=0; tdx<data.length; tdx++ ){
							const dataList =  data[tdx].data;
							if( dataList.is_active === true) {
								tncData.push(
									{
										'index' : tdx,
										'dataId' : dataList.id,
										'text' : dataList.content,
										'isReadOnly' : dataList.read_only === true,
										'is_required': dataList.is_required === true
									}
								)
							}
						}
						
						drawObj.upgrade.embedData.tncData = tncData;
						view.upgradeDraw( drawObj );
						
					}
				}
			});
		}
		
		/**
		 * [EPP] COMP6FE-1619 SIEL Offline   : offline stock  api
		 * api   : EPP , ecomStoreType offline,  OOS   
		 *   : in-stock  Doorstep Delivery, in-stock quantity_available  1 Available In-Store, 
		 */ 
		offlineStockAjax(sharedObj) {
			if ($('#isEppPage').val() === 'true' 
				&& window.sg.epp && window.sg.epp.common && ( window.sg.epp.common.ecomStoreType === "offline" || window.sg.epp.common.ecomStoreType === "offline_reverse_o2o" )
				&& sharedObj.stockLevelStatus.toUpperCase() != "OUTOFSTOCK" )
			{			
				let onAble = false;
				if ( sharedObj.stockLevelStatus.toUpperCase() === "INSTOCK" ){
					onAble = true;
				}		
				let offAble = false;
				const param = {
					"sku" : [sharedObj.shopSkuCode]
				};
				$.ajax({
					type: "POST",
					url: sharedObj.apiDomain + "/v4/configurator/epos/inventory-status",
					dataType: "json",
					data: JSON.stringify(param),
					beforeSend : function(xhr){
						xhr.setRequestHeader("Content-type","application/json");
						xhr.setRequestHeader("x-ecom-app-id", "fulfillment-aem"); 
						xhr.setRequestHeader("x-ecom-app-secret", "NGRjsMLxtDkYAKkghdgbcjUrVGueISJvxaCUvJtkKkQDePVx"); 
						xhr.setRequestHeader("x-store-id", sharedObj.siteCodeWithEpp); 
						xhr.setRequestHeader("x-ecom-jwt", $.cookies.get("jwt_"+$("#countryIsoCode").val(), {domain:".samsung.com"})||'');
					},
					success : function(data) {
						const ivtObj = data.inventory_info;
						if ( ivtObj != null ){
							if ( ivtObj[0].quantity_available >= 1 ){
								offAble = true;
							}
						}
					},
					error : function( XMLHttpRequest, textStatus, errorThrown ){},
					complete : function(){
						if ( onAble || offAble ){
							$("#offlineBadgeSpan").removeClass("badge-icon--bg-color-teal");
							$("#offlineBadgeSpan").removeClass("badge-icon--bg-color-orange");
						}
						if ( onAble && offAble ){
							$("#offlineBadgeSpan").html(Granite.I18n.get("Available In-Store"));
							$("#offlineBadgeSpan").addClass("badge-icon--bg-color-orange");
							sharedObj.isStorePopup = true;
						} else if ( onAble && !offAble ){
							$("#offlineBadgeSpan").html(Granite.I18n.get("Doorstep Delivery"));					
							$("#offlineBadgeSpan").addClass("badge-icon--bg-color-teal");
						}				
					}
				});	
			}
		}		
	}
	
	/**
	 * SearchApi   Combo  
	 */
	function seachApiOfferGridCombo ( sharedObj ){
		const util = sharedObj.util;
		const comboSearchList = sharedObj.comboSearchList;
		const noComboSearchList = sharedObj.noComboSearchList;
		const realComboSearchList = sharedObj.realComboSearchList;
		let hasCombo = false;
		
		if( util.isNotEmptyArray( comboSearchList ) ){
			/* combo    */
			const pdSoftBundleUseYn = sharedObj.pdSoftBundleUseYn;
			
			for ( var comboIndex in comboSearchList ){
				const comboData = comboSearchList[comboIndex];
				const comboDataWithSearch = realComboSearchList[comboIndex];
				const comboDataWithNoSearch = noComboSearchList[comboIndex];
				let setComboPopupList = [];
				
				for( var comboDataIndex in comboData ){
					for( var comboDataWithSearchIndex in comboDataWithSearch ){
						const comboItem = comboData[comboDataIndex];
						const searchComboItem = comboDataWithSearch[comboDataWithSearchIndex];
						
						if( searchComboItem.ctaType && ( searchComboItem.ctaType.toUpperCase() !== 'NOORDER') && comboItem.msrp_price && comboItem.msrp_price.value ){
							hasCombo = true;
							
							if( comboItem.sku === searchComboItem.shopSKU ){
								searchComboItem.thumbUrl = util.imgDomain( searchComboItem.thumbUrl );
								searchComboItem.msrp_price = comboItem.msrp_price;
								searchComboItem.sale_price = comboItem.sale_price;
								searchComboItem.formatted_value = comboItem.formatted_value;
								searchComboItem.sales_pitch = comboItem.sales_pitch;
								searchComboItem.type = comboItem.type;
								setComboPopupList.push( searchComboItem );
							}else{
								if (pdSoftBundleUseYn === "Y" && comboItem.sku_source === "ecom"){
									// search  combo  
									for( var comboDataWithNoSearchIndex in comboDataWithNoSearch ){
										const comboDataWithNoSearchItem = comboDataWithNoSearch[comboDataWithNoSearchIndex];
										
										if( comboItem.sku  === comboDataWithNoSearchItem.sku ){
											setComboPopupList.push(searchComboData[kdx]);
										}
									}
								}
							}
						}
					}
				}
				
				if( util.isNotEmptyArrayearch api       .  
		if( !hasCombo ){
			sharedObj.drawObj.offer.combo = [];
			sharedObj.view.productOfferDraw( sharedObj.drawObj );
		}
	}
	
	/**
	 * SearchApi   Bogo  
	 */
	function bogoDraw ( sharedObj, selectorObj, bogoSearchList ){
		const util = sharedObj.util;
		const priceCurrency = sharedObj.priceCurrency;
		const view = sharedObj.view;
		const drawObj = sharedObj.drawObj;
		
		for ( var itemIndex in bogoSearchList ) {
			
			const modelListOneItem = bogoSearchList[itemIndex];
			const pcPath = modelListOneItem.thumbUrl;
			const alt = modelListOneItem.thumbUrlAlt;
			const offerView = drawObj.offer;
			const pviTypeName = modelListOneItem.pviTypeName ? modelListOneItem.pviTypeName.toLowerCase() : '';
			const pviSubtypeName = modelListOneItem.pviSubtypeName ? modelListOneItem.pviSubtypeName.toLowerCase() : '';
			const categorySubTypeEngName = modelListOneItem.categorySubTypeEngName ? modelListOneItem.categorySubTypeEngName.toLowerCase() : '';
			
			const customsObj = { 'classWapper' : 'image__main responsive-img' };
			let imgAttr = util.getImgAttr ( pcPath, pcPath, alt, customsObj );
			let mainDec = [];
			
			const searchArray = bogoSearchList[itemIndex];
			
			if(searchArray.bogo_sales_pitch ){
				mainDec.push( {'text' : searchArray.bogo_sales_pitch});
			}
			
			/* 20190116 BoGo     */
			let originalPrice = '';
			let savePrice = '';
			let nowPrice = '';
			let price = '';
			
			if( modelListOneItem.price_info && modelListOneItem.price_info.length > 0 ){
				const priceItem = modelListOneItem.price_info[0];
				
				price = priceItem.msrp_price.value;
				originalPrice = priceItem.msrp_price.formatted_value;
				if(siteCode !== 'nl' && siteCode !== 'be' && siteCode !== 'be_fr'){
					savePrice = Granite.I18n.get( 'Save {0}', originalPrice);
				}
				nowPrice = currencyComma(0, priceCurrency);

			}else{
				nowPrice = currencyComma(0, priceCurrency);
			}
			//COMP6FE-1599 [EPP] SEPOL MSRP Price  : $('#isEppPage').val() === 'true' && siteCode === "pl" 
			if ($('#isEppPage').val() === 'true' && siteCode === "pl"){
				originalPrice = '';
				savePrice = '';
			}
			
			const thisTotalItem = {
				'title' : 'bogo',
				'hasItem' : true,
				'item' : {
					'contentWrapperClass' : 'bogo-item',
					'headline' : Granite.I18n.get('Buy 1 Get 1 Free'),
					'modelCode' : modelListOneItem.modelCode,
					'modelName' : modelListOneItem.modelName,
					'displayName' : modelListOneItem.displayName,
					'pviTypeName' : pviTypeName,
					'pviSubtypeName' : pviSubtypeName,
					'categorySubTypeEngName' : categorySubTypeEngName,
					'description' : {
						'hasDescription' : true,
						'main' : mainDec,
						'date' : searchArray.bogo_date
					},
					'imgAttr' : imgAttr,
					'price' : {
						'hasPrice' : true,
						'price' : price,
						'original' : originalPrice,
						'save' : savePrice,
						'now' : nowPrice
					}
				}
			}
			
			offerView.bogo = thisTotalItem;
		}
		
		view.productOfferDraw( drawObj );
	}
	
	function getFomattedDateByKartRocket(date, type){
		var week = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"] ;
		var month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

		var tempDate = new Date(date);
		var formattedDate = week[tempDate.getDay()] + ', ' + month[tempDate.getMonth()] + ' ' + tempDate.getDate();

		if( type === "priority" ){
			var dateStr = "th";
			var endStr = tempDate.getDate().toString().slice(-1);
			if(tempDate.getDate() < 11 || tempDate.getDate() > 13){ // 11~13 th 
				if( endStr === "1" ){
					dateStr = "st";
				} else if( endStr === "2" ){
					dateStr = "nd";
				} else if( endStr === "3" ){
					dateStr = "rd";
				}
			}
			formattedDate = week[tempDate.getDay()] + ' ' + tempDate.getDate() + dateStr  + ' ' + month[tempDate.getMonth()];
		}
		
		return formattedDate;
	}
	
	/**
	 * GIFT    OfferCombo  
	 */
	function settingGiftDraw( sharedObj, selectorObj ){
		
		const drawObj = sharedObj.drawObj;
		const offerView = drawObj.offer;
		const util = sharedObj.util;
		const view = sharedObj.view;
		const addOnGift = sharedObj.addOnGift;
		
		if( sharedObj.giftFlag ){
			const productTags = addOnGift.expanded.product_tags || '';
			if( !( productTags && productTags['GIFT'] && productTags['GIFT'].category === 'addon_group' && productTags['GIFT'].product_tag_name === 'GIFT' ) ){
				sharedObj.hasGift = false;
				return;
			}
			sharedObj.hasGift = true;
			
			/*var customsObj = {};
			customsObj.layerTarget = 'freeGiftPopup';
			customsObj['giftIdx'] = 0;
			let learnMoreCta = util.getAttrCta ( Granite.I18n.get('ADD TO ORDER'), 'javascript:;', '_self', 's-btn-gift-popup', customsObj,'' );

			const headline = productTags['GIFT'].formatted_sales_pitch[0] ? productTags['GIFT'].formatted_sales_pitch[0] : productTags['GIFT'].sales_pitch[0];
			
			offerView.gift = {
				'title' : 'giftBundle',
				'giftIndex' : 0,
				'hasItem' : true,
				'item' : {
					'headline' : headline,
					'description' : {
						'hasDescription' : true,
						'main': null,
						'date': null
					},
					'learnMoreCta' : learnMoreCta
				}
			}
			view.productOfferDraw( drawObj ) ;*/
		}
	}
	
	
	
	dynamic.BuyingToolOpAjaxCommon = BuyingToolOpAjaxCommon;
})();
(() => {
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	
	class BuyingToolOpAjaxHybris {
		productAjax ( sharedObj, selectorObj ) {
			settingHybrisBase(sharedObj, selectorObj);
			settingPriceBaseData( sharedObj, selectorObj, startHybris );
		}
		
		callAddToCartCta( sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift ) {
			hybrisCartCall( sharedObj, accessoryList, selectorObj, isDirect ,isContinue, selectedGift );
		}
		
		callCheckOutCta( sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift ) {
			hybrisCartCall( sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift );
		}
	}
	
	/**
	 * Hybris  
	 */
	function settingHybrisBase(sharedObj, selectorObj){
		const getMultisiteCd = getDotcomMultistore( sharedObj, selectorObj );
		let siteCd = sharedObj.siteCode;
		
		if( getMultisiteCd ){
			siteCd = getMultisiteCd;
		}
		
		sharedObj.multistoreSiteCd = siteCd;
	}
	
	function getDotcomMultistore( sharedObj, selectorObj ){
		let siteCd = '';
		const dotcomMultistore =  $.cookies.get('estoreSitecode', {domain : ".samsung.com"});
		if( sharedObj.siteCode === 'levant' ){
			siteCd='jo';
		} else if( sharedObj.siteCode === 'levant_ar' ){
			siteCd='jo_ar';
		} else if( sharedObj.siteCode === 'n_africa' ){
			siteCd='ma';
		} else if( ( sharedObj.siteCode === 'ae' || sharedObj.siteCode === 'ae_ar' ) && dotcomMultistore && checkDotcomMultistore( dotcomMultistore )){
			//NOTICE : checkDotcomMultistore ==> dotcomMultistore     ae, ae_ar, kw, kw_ar, om, om_ar, bh, bh_ar    
			siteCd = dotcomMultistore;
		}
		
		return siteCd;
	}
	
	function checkDotcomMultistore( inputDotcomMultistore ){
		let result = false;
		let checkSiteCodeList = ["ae", "ae_ar", "kw", "kw_ar", "om", "om_ar", "bh", "bh_ar", "qa", "qa_ar"];
		let checkSiteCodeListSet = new Set(checkSiteCodeList);
		result = checkSiteCodeListSet.has(inputDotcomMultistore);	
		return result;
	}
		 
		
	/**
	 * Hybris shop API/ng/p4v1/getRealTimeProductSimpleInfo)  (Stock / price )
	 */
	function getHyibrisRealTimeProductsInfo(sharedObj, selectorObj, view, currentUrl){
		let siteCd = sharedObj.multistoreSiteCd;
		
		// epp shop 
		siteCd = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : siteCode;
		
		var realTimeUrl = sharedObj.apiDomain + "/" + siteCd + "/ng/p4v1/getRealTimeProductSimpleInfo?productCode=" + sharedObj.modelCode;
		if( sharedObj.siteCode === "py") {
			realTimeUrl = sharedObj.apiDomain + "/ng/p4v1/getRealTimeProductSimpleInfo?productCode=" + sharedObj.modelCode;
		}
		
		if(sharedObj.hybrisJsonYn === 'Y') {
			$.ajax({
				url: realTimeUrl,
				type: "GET",
				dataType: 'json',
				cache:true,
				crossDomain : true,
				timeout : 10000,
				xhrFields: {withCredentials: true},
				success: function(data, responseText, jqXHR){
					realTimeInfoResponse(data, sharedObj, selectorObj, currentUrl);
				},error : function(){
					errorResponse(sharedObj, selectorObj, currentUrl);
				},complete : function (){
					afterHybrisApi( sharedObj, selectorObj );
				} 
			});
		} else {
			$.ajax({
				url: realTimeUrl,
				type: "GET",
				dataType: 'jsonp',
				jsonpCallback:"jQuery1910499421933433041_1385598221584_0",
				cache:true,
				crossDomain : true,
				timeout : 10000,
				xhrFields: {withCredentials: true},
				success: function(data, responseText, jqXHR){
					realTimeInfoResponse(data, sharedObj, selectorObj, currentUrl);
				},error : function(){
					errorResponse(sharedObj, selectorObj, currentUrl);
				},complete : function (){
					afterHybrisApi( sharedObj, selectorObj );
				} 
			});
		}
	} 
	
	/**
	 * Hybris shop API(/servicesv2/getSimpleProductsInfo)  (Stock / price )
	 * 
	 */
	function getHybrisProductsInfo(sharedObj, selectorObj, view, currentUrl){
		const siteCd = sharedObj.multistoreSiteCd;
		const isHybrisSplitPD = sharedObj.isHybrisSplitPD;

		// epp shop 
		const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : siteCd;

		var apiUrl = sharedObj.apiDomain+"/"+siteCodeWithEpp+"/servicesv2/getSimpleProductsInfo?productCodes="+ sharedObj.modelCode;
			
		// pre-qa isHybrisSplitPD  config    qa1  
		if(window.location.href.indexOf("pre-qa") > -1 && isHybrisSplitPD ) {
			///////sharedObj.apiDomain ="https://qa1.shop.samsung.com";
			
		}
		
		// SETK - Buy Button Development Request + cn
		if(siteCd === 'tr' || siteCd === 'cn') {
			var trRealTimeUrl = sharedObj.apiDomain + "/" + siteCodeWithEpp + "/dotcom/v2/products?sku=" + sharedObj.modelCode;
			if(siteCd === 'cn') {
				trRealTimeUrl = sharedObj.apiDomain + "/dotcom/v2/products?sku=" + sharedObj.modelCode;
			}
			var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};

			$.ajax({
				headers : {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin" : "*"
				},
				url: trRealTimeUrl,
				xhrFields: _xhrFields,
				type: "GET",
				dataType: 'xml',
				timeout : 10000,
				success: function(xml) {
					$(xml).find('product').each(function(){
						var modelName = $(this).find("modelName").text();
						var shopLinkUrl = $(this).find("url").text();
						var stockLevelStatus = $(this).find("stockLevelStatus").text();
						var salesStatus = $(this).find("salesStatus").text();
						var price = $(this).find("price").text();
						var priceDisplay = $(this).find("priceDisplay").text();
						
						if(sharedObj.modelCode == modelName) {
							if(stockLevelStatus == "inStock" && salesStatus == "true") {
								stockLevelStatus = stockLevelStatus.toUpperCase();
								sharedObj.stockLevelStatus = stockLevelStatus;
								sharedObj.apiChangeStockStatus = stockLevelStatus;
								sharedObj.hasPriceCta = true;
								sharedObj.buyNowUrl = shopLinkUrl;
								sharedObj.proudctPriceInfo.orignalPrice = price;
								sharedObj.proudctPriceInfo.orignalPriceFormatted = priceDisplay;
								sharedObj.drawObj.price.priceWrapper.hasPriceWrapper = true;
								
								sharedObj.util.settingPriceCta( sharedObj.hasPriceCta, sharedObj, selectorObj, currentUrl );
							}
						} else {
							errorResponse(sharedObj, selectorObj, currentUrl);
						}
						
					})
				},error : function(){
					errorResponse(sharedObj, selectorObj, currentUrl);
				},complete : function (){
					afterHybrisApi( sharedObj, selectorObj );
				}
			});
		} else if(sharedObj.hybrisJsonYn === 'Y') {
			$.ajax({
				url: apiUrl,
				type: "GET",
				dataType: 'json',
				cache:true,
				crossDomain : true,
				timeout : 10000,
				xhrFields: {withCredentials: true},
				success: function(data, responseText, jqXHR){
					simpleInfoResponse(data, sharedObj, selectorObj, currentUrl);
				},error : function(){
					errorResponse(sharedObj, selectorObj, currentUrl);
				},complete : function (){
					afterHybrisApi( sharedObj, selectorObj );
				} 
			});
		} else {
			$.ajax({
				url: apiUrl,
				type: "GET",
				dataType: 'jsonp',
				jsonpCallback:"jQuery1910499421933433041_" + "111",
				cache:true,
				crossDomain : true,
				timeout : 10000,
				xhrFields: {withCredentials: true},
				success: function(data, responseText, jqXHR){
					simpleInfoResponse(data, sharedObj, selectorObj, currentUrl);
				},error : function(){
					errorResponse(sharedObj, selectorObj, currentUrl);
				},complete : function (){
					afterHybrisApi( sharedObj, selectorObj );
				}
			});
		}
	}

	/**
	 * Hybris shop API(/ng/p4v1/getRealTimeProductSimpleInfo) /  
	 */
	function realTimeInfoResponse(data, sharedObj, selectorObj, currentUrl) {
		if(data.resultCode === "0000" && sharedObj.modelCode === data.code){
			sharedObj.hybrisApiData.shopAPI = data; //[COMP6FE-1507] service  . supportedAvailableServices 
			data.apiType = "realtime";
			setCtaNPriceInfo(data, sharedObj, selectorObj, currentUrl);
			
		} else {
			errorResponse(sharedObj, selectorObj, currentUrl);
		}
	}
	
	/**
	 * Hybris shop API(/servicesv2/getSimpleProductsInfo) /  
	 */
	functlag = false;
		if(data.resultCode === "0000" && data.productDatas.length > 0){
			$.each(data.productDatas,function(index, productData){
				if(sharedObj.modelCode === productData.productCode) {
					sharedObj.hybrisApiData.shopAPI = productData; //[COMP6FE-1507] service  . supportedAvailableServices 
					//PD EDD  
					sharedObj.blockEddDisplay = productData.blockEddDisplay && productData.blockEddDisplay != null ? productData.blockEddDisplay : "Y"; // blockEddDisplay  N 
					productData.apiType = "simple";
					setVoucherAndGiftInfo(productData, sharedObj, selectorObj, currentUrl);
					setCtaNPriceInfo(productData, sharedObj, selectorObj, currentUrl);
					successFlag = true;
					return false;
				}
			});

		}
		
		if(!successFlag) { 
			errorResponse(sharedObj, selectorObj, currentUrl);
			sharedObj.oldHybrisSalesStatus = false;
		}
		
		if( data.resultCode === '0000' && data.productDatas[0].resultCode === '0000' && data.productDatas[0].salesStatus === 'ON_SALE' ){
			sharedObj.oldHybrisSalesStatus = true;
		}else{
			sharedObj.oldHybrisSalesStatus = false;
		}
	}
	
	/**
	 * hybris voucher 
	 */
	function setVoucherAndGiftInfo(productData, sharedObj, selectorObj, currentUrl){
		const aemAdditionalInfoTypes = productData.aemAdditionalInfoTypes;
		if( aemAdditionalInfoTypes ){
			for( var i=0; i <aemAdditionalInfoTypes.length; i++ ){
				const additionalInfo = aemAdditionalInfoTypes[i];
				if( additionalInfo ){
					const type = additionalInfo.type.toLowerCase();
					if( type === 'voucher' ){
						sharedObj.voucherdataHybris = additionalInfo.aemAdditionalInfos;
						sharedObj.hasVoucher = true;
					} else if( type === 'gift' ){
						sharedObj.giftdataHybris = additionalInfo.aemAdditionalInfos;
						sharedObj.hasGift = true;
					} else if( type === 'vdcombomessage' ){
						sharedObj.vdcombodataHybris = additionalInfo.aemAdditionalInfos;
					}
					// SplitPD - TradeIn Special Discount
					for( var j=0; j<additionalInfo.aemAdditionalInfos.length; j++ ){
						const aemAdditionalInfo = additionalInfo.aemAdditionalInfos[j];
						if( aemAdditionalInfo ){
							if( aemAdditionalInfo.key && aemAdditionalInfo.value ){
								if( aemAdditionalInfo.key === 'discountValue' ){
									sharedObj.splitPDTradeInSpecial = aemAdditionalInfo.value;
								}
								if( aemAdditionalInfo.key === 'discountmessage' ){
									sharedObj.splitPDTradeInSpecialMsg = aemAdditionalInfo.value;
								}
								if( aemAdditionalInfo.key === 'SELLING_WITH_BEZEL' ){
									const util = sharedObj.util;
									sharedObj.sellingWithBazel = aemAdditionalInfo.value == "true" ? true : false;
									sharedObj.useBezelOptionDraw = true;
									window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjaxOldHybris(sharedObj, sharedObj.modelCode, function (data, isSuccess) {
										var bezelType = '';
										var noneTypeList = [];
										var modernTypeList = [];
										var beveledTypeList = [];
										var freestyleList = [];
										
										if (isSuccess && data.products != null && data.products.length > 0) {
											$.each(data.products, function (idx, obj) {
												var bezelType = obj.aemAdditionalInfoTypes[0].aemAdditionalInfos[0].value === "true" ? obj.aemAdditionalInfoTypes[0].aemAdditionalInfos[0].key.toUpperCase() : '';
												var hasImage = obj.imageUrl != "" ? true : false;
												var hasNotImage = obj.imageUrl == "" ? true : false;
												var bezelImageUrl = obj.imageUrl.replace("$ORIGIN_PNG$","");
												var bezelStock = obj.stocklevel.toUpperCase();
												var disabledClass = " is-disabled";
												if(bezelStock == "INSTOCK" || bezelStock == "BACKORDERED" || bezelStock == "PREORDER" || bezelStock == "LOWSTOCK"){
													disabledClass = "";
												}
												if(sharedObj.bezelImageClass == ""){
													if(hasImage){
														sharedObj.bezelImageClass = "pd-select-option__list--image-button";
													}
												}
												var bezelObj = {
														'index' : idx,
														'modelCode' : obj.modelcode,
														//'modelPatternCode' : '',
														'name' : obj.colorName,
														'value' : obj.colorCode,
														'hasImage' : hasImage,
														'hasNotImage' : hasNotImage,
														'imageUrl' : bezelImageUrl,
														'disabledClass' : disabledClass
													};
												if(bezelType === 'BEZEL_COLOR'){
													noneTypeList.push(bezelObj);
												}else if(bezelType === 'BEZEL_MODERN'){
													modernTypeList.push(bezelObj);
												}else if(bezelType === 'BEZEL_BEVELLED'){
													beveledTypeList.push(bezelObj);
												}else if(bezelType === 'FREESTYLE_COLOR'){
													freestyleList.push(bezelObj);
												}
												
											});
										}
										sharedObj.noneTypeList = noneTypeList;
										sharedObj.modernTypeList = modernTypeList;
										sharedObj.beveledTypeList = beveledTypeList;
										sharedObj.freestyleList = freestyleList;
										util.settingBezelOptionDraw( sharedObj, selectorObj );
									}, null, {"queryType":"ADD_COLOR_FOR_VD"});
								}
							}
						}
					}
				}
			}
		}
	}

	/**
	 * Hybris shop API   
	 */
	function errorResponse(sharedObj, selectorObj, currentUrl){
		const util = sharedObj.util;
		util.settingPriceCta( false, sharedObj, selectorObj, currentUrl );
	}
	
	/**
	 * Hybiris CTA     
	 */
	function setCtaNPriceInfo(productData, sharedObj, selectorObj, currentUrl) {
		const drawObj = sharedObj.drawObj;
		const util = sharedObj.util;
		const priceWrapper = drawObj.price.priceWrapper;
		const priceCurrency = sharedObj.priceCurrency;
		
		let orignalPrice = productData.price;
		//   lowestWasPrice      
		if(sharedObj.isNewElementLowestWasPrice) {
			let tempLowestWasPrice = 0;
			if(productData.lowestWasPrice) {
				
				tempLowestWasPrice = productData.lowestWasPrice.value ? productData.lowestWasPrice.value : 0;
			}
			
			if(productData.lowestWasPrice && productData.lowestWasPrice.value) {
				if(productData.promotionPrice) {
					//productData.promotionPrice     tempLowestWasPrice productData.promotionPrice  
					if(tempLowestWasPrice <= productData.price && tempLowestWasPrice > productData.promotionPrice ) {
						orignalPrice = productData.lowestWasPrice.value ? productData.lowestWasPrice.value : productData.price;
						sharedObj.isNewElementLowestWasPriceSetting = true;
					}
				} else {
					//productData.promotionPrice    
					if(tempLowestWasPrice <= productData.price) {
						orignalPrice = productData.lowestWasPrice.value ? productData.lowestWasPrice.value : productData.price;
					}
				}
			}
		}
		let salePrice = productData.promotionPrice;
		let stockLevelStatus = productData.stockLevelStatus != null ? productData.stockLevelStatus.toUpperCase() : '';
		let stockLevelStatusDisplay = productData.stockLevelStatusDisplay != null ? productData.stockLevelStatusDisplay : '';
		let savingInformation = productData.savingInformation != null ? productData.savingInformation : '';
		let taxPriceDisplay ='';  //only br 
		let installmentPlanStoreText ='';  //only br
		if(sharedObj.siteCode ==='ca' || sharedObj.siteCode ==='ca_fr') {
			sharedObj.savingInformation = savingInformation;
		} else if(sharedObj.siteCode ==='br') {
			//api      SavingInformation
			savingInformation = productData.SavingInformation != null ? productData.SavingInformation : '';
			sharedObj.savingInformation = savingInformation;
			//TaxPriceDisplay
			taxPriceDisplay = productData.TaxPriceDisplay != null ? productData.TaxPriceDisplay : '';
			// haredObj   
			sharedObj.taxPriceDisplay = taxPriceDisplay;
			if(productData.installmentPlan && productData.installmentPlan.storeText) {
				installmentPlanStoreText = lan.storeText : '';
			}
			sharedObj.storeText = installmentPlanStoreText;
		}
		
		
		if( stockLevelStatus == 'LOWSTOCK' ){
			sharedObj.stockLevelStatusDisplay = stockLevelStatusDisplay;
		}
		if( stockLevelStatus == 'INSTOCK' || stockLevelStatus == 'LOWSTOCK' ){
			if( productData.flagPreOrder &&  productData.flagPreOrder === 'Y' ){
				stockLevelStatus = 'PREORDER';
			} else {
				stockLevelStatus = 'INSTOCK';
			}
			
			if( ( sharedObj.siteCode ==='ca' || sharedObj.siteCode ==='ca_fr' ) && productData.reserveNowBtnYn === 'Y' ){
				sharedObj.hasReserveInStore = true;
			}

			
		} else if( stockLevelStatus == 'OUTOFSTOCK' ){
			//cta type : ALL,CART (3rd party   no order  - get stock alert ), hk, hk_en 
			if( productData.apiType === "realtime" && sharedObj.siteCode !== 'hk' && sharedObj.siteCode !== 'hk_en' ){
				stockLevelStatus = 'NOORDER';
			} else {
				stockLevelStatus = 'OUTOFSTOCK';
			}
			
		} else if( stockLevelStatus == '' ){
			stockLevelStatus = 'NOORDER';
		}
		sharedObj.stockLevelStatus = stockLevelStatus;
		sharedObj.apiChangeStockStatus = stockLevelStatus;
		sharedObj.hasPriceCta = true;
		
		// stockLevelStatus  CTA  
		util.settingPriceCta( sharedObj.hasPriceCta, sharedObj, selectorObj, currentUrl );
		
		if( productData.apiType === "realtime" ){
			// /ng/p4v1/getRealTimeProductSimpleInfo    currency  .
			orignalPrice = deleteCurrency(productData.price, priceCurrency).trim();
			salePrice = deleteCurrency(productData.promotionPrice, priceCurrency).trim();
		}
		
		if( !salePrice ){
			salePrice = orignalPrice;
		}
		
		if( salePrice  && Number( salePrice ) !== 0 ){
			if( stockLevelStatus !== 'NOORDER' ){
				priceWrapper.hasPriceWrapper = true;
			} else {
				priceWrapper.hasPriceWrapper = false;
			}
			
			sharedObj.proudctPriceInfo.orignalPrice = orignalPrice;
			
			if( productData.priceFormatted ){
				sharedObj.proudctPriceInfo.orignalPriceFormatted = productData.priceFormatted;
			} else {
				sharedObj.proudctPriceInfo.orignalPriceFormatted = currencyComma(orignalPrice, priceCurrency);
			}
			
			sharedObj.proudctPriceInfo.salePrice = salePrice;
			
			if( productData.promotionPriceFormatted ){
				sharedObj.proudctPriceInfo.salePriceFormatted = productData.promotionPriceFormatted;
			} else if( salePrice === orignalPrice ){
				sharedObj.proudctPriceInfo.salePriceFormatted = sharedObj.proudctPriceInfo.orignalPriceFormatted;
			} else {
				sharedObj.proudctPriceInfo.salePriceFormatted = currencyComma(salePrice, priceCurrency);
			}
		}
		//TRADEIN_TEXT   TRADEIN_TEXT     
		if( sharedObj.isHyIntg && productData.aemAdditionalInfoTypes && productData.aemAdditionalInfoTypes.length > 0 ){
			const aemAdditionalInfoTypes = productData.aemAdditionalInfoTypes;
			for( var addIndex in aemAdditionalInfoTypes ){
				const addItem = aemAdditionalInfoTypes[addIndex];
				if( addItem.type === 'TRADEIN' && addItem.aemAdditionalInfos && addItem.aemAdditionalInfos.length > 0 ){
					for( var itemIndex in addItem.aemAdditionalInfos ){
						const infosItem = addItem.aemAdditionalInfos[itemIndex];
						if( infosItem.key === 'TRADEIN_TEXT' && infosItem.value ){
							sharedObj.proudctPriceInfo.salePriceFormatted = infosItem.value;
						}
					}
				}
			}
		}
		
		if( productData.apiType === "simple" ){
			getLeasingInfo(sharedObj, selectorObj);
		}
		
		priceWrapper.info.summaryPrice = sharedObj.proudctPriceInfo.salePriceFormatted;
	}
	
	
	function getLeasingInfo( sharedObj, selectorObj ) {
		const isHybrisSplitPD = sharedObj.isHybrisSplitPD;
		let siteCode = sharedObj.multistoreSiteCd;
		//[23.12.01] EPP(ae,ae_ar) leasingInfo API 
		let nocacheUrl = "";
		if ($('#isEppPage').val() === 'true' && (siteCode === "ae" || siteCode === "ae_ar")){
			nocacheUrl = "/nocache";
		}		
		// epp shop 
		siteCode = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : siteCode;
	
		var apiUrl = sharedObj.apiDomain+"/"+siteCode+"/servicesv2" + nocacheUrl + "/leasingInfo?productCode="+ sharedObj.modelCode
		// pre-qa isHybrisSplitPD  config    qa1  
		if(window.location.href.indexOf("pre-qa") > -1 && isHybrisSplitPD ) {
			///////sharedObj.apiDomain ="https://qa1.shop.samsung.com";
		}
		
		var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};
        
		if(sharedObj.hybrisJsonYn === 'Y') {
			$.ajax({
				url: apiUrl,
				type: "GET",  
				cache: true,  
				crossDomain : true,  
                xhrFields: _xhrFields,
				dataType: 'json',  
				timeout: 20000,
				success: function( data ){
					setLeasingInfoData( data, sharedObj, selectorObj );
				}
			}); 
		} else {
			$.ajax({
				url: apiUrl,
				type: "GET",  
				cache: true,  
				crossDomain : true,  
                xhrFields: _xhrFields,
				dataType: 'jsonp',  
				jsonpCallback:"jQuery1910499421933433041_" + "171",  
				timeout: 20000,
				success: function( data ){
					setLeasingInfoData( data, sharedObj, selectorObj );
				}
			});
		}
	}
	
	function setLeasingInfoData( data, sharedObj, selectorObj ){
		if( data && data.length > 0 ){
			const leasingItem = data[0];
			sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice = leasingItem.monthly;
			sharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal = leasingItem.months;
			if(siteCode == "hu"){
				sharedObj.proudctPriceInfo.monthlyPriceInfo.interest = leasingItem.interest;
			}
			if(leasingItem.monthly !== null && leasingItem.monthly !== "" && leasingItem.monthly !== undefined) {
				sharedObj.drawObj.price.priceWrapper.isLeasingInfo = true;
			}
			
			sharedObj.util.totalAfterFunction( sharedObj, selectorObj );
		}
		
		if( data && data.length > 0 ){
 
			//it ru lease   (lease            .) 
			$.each(data, function(index, leasingInfoItem){
				// ru month 12   36 . (TODO :    ) 
				if((siteCode != "ru" && leasingInfoItem.months == "24") || (siteCode == "ru" && leasingInfoItem.months == "12")){  		 
						
					sharedObj.proudctPriceInfo.leaseInfo.upfront = leasingInfoItem.upfront != null && leasingInfoItem.upfront != "" ? leasingInfoItem.upfront : 0;
					sharedObj.proudctPriceInfo.leaseInfo.monthly = leasingInfoItem.monthly != null && leasingInfoItem.monthly != "" ? leasingInfoItem.monthly : "";
					sharedObj.proudctPriceInfo.leaseInfo.month  = leasingInfoItem.months != null  && leasingInfoItem.months != ""  ? leasingInfoItem.months  : "";
					
					//return false;  
				}
			});
		 
			
			// lease 
			settingHybrisBetweenDraw( sharedObj, selectorObj );
		}
	}
	
	function setFrontApiInfo(sharedObj, selectorObj, view, currentUrl) {
		const drawObj = sharedObj.drawObj;
		const util = sharedObj.util;
		const kvInfoUseYn = sharedObj.kvInfoUseYn;
		const buyNowUrlYn = sharedObj.buyNowUrlYn;
		const buyNowUrl = sharedObj.buyNowUrl;
		const wtbSiteCode = sharedObj.multistoreSiteCd;
		const configuratorUrl = sharedObj.configuratorUrl;
		const ctaLocalText = sharedObj.ctaLocalText;
		const ctaEngText = sharedObj.ctaEngText;
		const configuratorUseYn = sharedObj.configuratorUseYn;
		const tempTitle = $('#tempTitle').val();
		const shopIntegrationFlag = $("#shopIntegrationFlag").val();
		const isGPv2 = shopIntegrationFlag === "GPv2";
		const isOldHybris = (shopIntegrationFlag === "Hybris" || shopIntegrationFlag === "Hybris-intg");
		const isNewHybris =shopIntegrationFlag === "Hybris-new";
		let wtbUseYn = sharedObj.wtbUseYn;
		const wtbDispFuncUseYN = sharedObj.wtbDispFuncUseYN;
		
		// CTA 
		let containedLinkType = '_self';
		let containedCtaClass = '';
		let containedText;
		let containedCustom = {};
		let containedhref = 'javascript:;';
		
		let anchorNaviLinkType = '_self';
		let anchorNaviCtaClass = '';
		let anchorNaviText;
		let anchorNaviCustom = {};
		let anchorNavihref = 'javascript:;';
		
		let wtbLinkType = '_self';
		let wtbCtaClass = '';
		let wtbText;
		let wtbCustom = {};
		
		let wtbCtaAttr = {};
		wtbCtaAttr.modelName = sharedObj.modelName;
		wtbCtaAttr.dataTtile = sharedObj.pdRemoveTagTxt;
		wtbCtaAttr.imgSrc = sharedObj.wtbSrc;
		wtbCtaAttr.iaCode = sharedObj.wtbSubTypeCode;
		wtbCtaAttr.dataModelCode = sharedObj.modelCode;
		
		let salesStatus = true;
		if( isOldHybris ){
			if( globalShopInfo.shopServiceYN === 'N' || !sharedObj.oldHybrisSalesStatus ){
				salesStatus = false;
			}
		}else if( isNewHybris ){
			if( !sharedObj.newHybrisSalesStatus ){
				salesStatus = false;
			}
		}else if( isGPv2 ){
			if( sharedObj.accessoryDisabled ){
				salesStatus = false;
			}
		}
		
		if( siteCode === 'mx' ){
			wtbUseYn = 'N';
		}
		
		if( buyNowUrlYn ){
			// cn  
			if( buyNowUrl ){
				anchorNaviCtaClass = containedCtaClass = 'js-buy-now tg-buy-now';
				anchorNaviText = containedText = Granite.I18n.get( 'buy now' );
				anchorNavihref = containedhref = buyNowUrl;
			} else {
				anchorNaviCtaClass = containedCtaClass = 'js-cta-buy tg-wtb';
				anchorNaviText = containedText = Granite.I18n.get( 'Where to buy' );
				anchorNaviCustom.modelName = sharedObj.modelName;
				anchorNaviCustom.dataTtile = sharedObj.pdRemoveTagTxt;
				anchorNaviCustom.imgSrc = sharedObj.wtbSrc;
				anchorNaviCustom.iaCode = sharedObj.wtbSubTypeCode;
				anchorNaviCustom.dataModelCode = sharedObj.modelCode;
				containedCustom = anchorNaviCustom;
				if( siteCode === 'mx' ){
					anchorNaviText = containedText = Granite.I18n.get( 'not for sale' );
					anchorNaviCtaClass = containedCtaClass = 'cta--disabled tg-not-for-sale';
				}
			}
		} else {
			if( shopIntegrationFlag ){
				if(wtbUseYn === 'Y'){
					if( wtbDispFuncUseYN === 'Y' && shopIntegrationFlag !== '3rd'){
						if( salesStatus ){ //  O
							containedCustom.moCode = sharedObj.shopSkuCode;
							containedCustom.ctaType = 'add-cart';
							anchorNaviCustom = containedCustom;
							anchorNaviText = containedText = Granite.I18n.get( 'Add to cart' );
							anchorNaviCtaClass = containedCtaClass = 'js-buy-now tg-add-to-cart';
						}else{ //  X
							anchorNaviCtaClass = containedCtaClass = 'js-cta-buy tg-wtb';
							anchorNaviText = containedText = Granite.I18n.get( 'Where to buy' );
							containedCustom = wtbCtaAttr;
							anchorNaviCustom = wtbCtaAttr;
						}
					}else{
						anchorNaviCtaClass = containedCtaClass = 'js-cta-buy tg-wtb';
						anchorNaviText = containedText = Granite.I18n.get( 'Where to buy' );
						containedCustom = wtbCtaAttr;
						anchorNaviCustom = wtbCtaAttr;
					}
				}else{
					anchorNaviText = containedText = Granite.I18n.get( 'not for sale' );
					anchorNaviCtaClass = containedCtaClass = 'cta--disabled tg-not-for-sale';
				}
			} else {
				//global nonApi  
				if( wtbUseYn === 'Y'){
					anchorNaviCtaClass = containedCtaClass = 'js-cta-buy tg-wtb';
					anchorNaviText = containedText = Granite.I18n.get( 'Where to buy' );
					containedCustom = wtbCtaAttr;
					anchorNaviCustom = wtbCtaAttr;
					var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};
					
					// SETK - Buy Button Development Request + cn
					if( wtbSiteCode === 'tr' || wtbSiteCode === 'cn'){
						var trRealTimeUrl = sharedObj.apiDomain + "/" + wtbSiteCode + "/dotcom/v2/products?sku=" + sharedObj.modelCode;
						if(wtbSiteCode === 'cn') {
							trRealTimeUrl = sharedObj.apiDomain + "/dotcom/v2/products?sku=" + sharedObj.modelCode;
						}
						$.ajax({
							headers : {
								"Cache-Control": "no-cache",
								"Content-Type": "application/json",
								"Access-Control-Allow-Origin" : "*"
							},
							url: trRealTimeUrl,
							type: "GET",
							dataType: 'xml',
							xhrFields: _xhrFields,
							timeout : 10000,
							success: function(xml) {
								$(xml).find('product').each(function(){
									var modelName = $(this).find("modelName").text();
									var shopLinkUrl = $(this).find("url").text(); 
									var stockLevelStatus = $(this).find("stockLevelStatus").text();
									var salesStatus = $(this).find("salesStatus").text();
									var price = $(this).find("price").text();
									var priceDisplay = $(this).find("priceDisplay").text();
									
									if(sharedObj.modelCode == modelName) {
										if(stockLevelStatus == "inStock" && salesStatus == "true") {
											stockLevelStatus = stockLevelStatus.toUpperCase();
											sharedObj.stockLevelStatus = stockLevelStatus;
											sharedObj.apiChangeStockStatus = stockLevelStatus;
											sharedObj.hasPriceCta = true;
											sharedObj.buyNowUrl = shopLinkUrl;
											sharedObj.proudctPriceInfo.orignalPrice = price;
											sharedObj.proudctPriceInfo.orignalPriceFormatted = priceDisplay;
											sharedObj.drawObj.price.priceWrapper.hasPriceWrapper = true;
											
											sharedObj.util.settingPriceCta( sharedObj.hasPriceCta, sharedObj, selectorObj, currentUrl );
										}
									} else {
										errorResponse(sharedObj, selectorObj, currentUrl);
									}
									
								})
							},error : function(){
								errorResponse(sharedObj, selectorObj, currentUrl);
							},complete : function (){
								afterHybrisApi( sharedObj, selectorObj );
							}
						});
					}
				} else {
					anchorNaviText = containedText = Granite.I18n.get( 'not for sale' );
					anchorNaviCtaClass = containedCtaClass = 'cta--disabled tg-not-for-sale';
				}
			}
		}
		
		if( configuratorUseYn === 'Y' ){
			if( tempTitle === 'page-standard-pd' ){
				if( configuratorUrl !== '' && configuratorUrl !== null ){
					anchorNavihref = containedhref = configuratorUrl;
					containedCustom.ctaType = '';
					anchorNaviCustom = containedCustom;
					anchorNaviCtaClass = containedCtaClass = 'configuratorUse-y';
				}else{
					anchorNaviCtaClass = containedCtaClass = 'cta--disabled configuratorUse-y';
				}
				if( ctaLocalText !== '' && ctaLocalText !== null ){
					anchorNaviText = containedText = ctaLocalText;
				}
				$('.pd-g-product-detail-kv').hide();
			}
		}
		
		let price = drawObj.price;
		price.wtbAttr = util.getAttrCta( wtbText, 'javascript:;', wtbLinkType, wtbCtaClass, wtbCustom );
		price.containedAttr = util.getAttrCta( containedText, containedhref, containedLinkType, containedCtaClass, containedCustom );
		price.anchorNaviAttr = util.getAttrCta( anchorNaviText, anchorNavihref, anchorNaviLinkType, anchorNaviCtaClass, anchorNaviCustom );
		
		util.settingForBusiness ( sharedObj, selectorObj );
		
		view.productDraw(drawObj);
		util.settingPriceDraw( sharedObj, selectorObj );
		
		sharedObj.commonApiModel.settingWishList( sharedObj, selectorObj );
		util.clickEventListener( sharedObj, selectorObj );
		
	}
	
	let addToCartFlag = false;
	function hybrisCartCall( sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift ) {
		//  
		if(addToCartFlag){
			return;
		} 
		addToCartFlag = true;
		
		let isThirdPartCart = sharedObj.siteCode === "br" || sharedObj.siteCode === "latin" || sharedObj.siteCode === "ar" 
			|| sharedObj.siteCode === "py" ;
		
		//epp cl pe mx co new-hybris 
		if($('#isEppPage').val() === 'true'){
			isThirdPartCart = sharedObj.siteCode === "br" || sharedObj.siteCode === "latin" || sharedObj.siteCode === "ar" || sharedObj.siteCode === "py" ;
		}
		
		if (isThirdPartCart) {
			// 3rd party add to cart
			hybrisAddCart( sharedObj, isDirect, isContinue );	 
		}else if(sharedObj.siteCode != 'tr' && sharedObj.siteCode != 'cn'){ // SETK - Buy Button Development Request + cn
			hybrisAddToCart(sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift);
		}
	}
	
	/* new-Hybris  
	 * id  sebn  
	 * storeWebDomain 
	 */
	var pdd16stepbuyinghtml=$(".pdd16-step-buying").html();//CRHQ-8714
	function hybrisAddToCart( sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift ) {
		//const disabledClass = sharedObj.disabledCtaClass;
		//const leaseYnType = selectorObj.buyingToolOptBetween.hasClass('is-selected') && !selectorObj.buyingToolOptBetween.hasClass(disabledClass);  
		
		const DEBUG = parseInt("1") === 0; // 0 turn off / 1 turn on  
		
		const isNewHybris = $("#shopIntegrationFlag").val() === "Hybris-new";
		
		let param = "";  
		let productIndex = 0;
		let isMoveUrl = true;
		let clearCartFlag = false;
		let postalCode = "";
		let isAddToCartPost = false; //addToCartPostYn Y   true. false(addToCartPostYn  N )  hybrisApiJson .()
		
		var postParam = {
			'products' : []
		};//[COMP6FE-1495] Au Post  cart 
		
		//new-hybris
		if(sharedObj.siteCode == 'id' || sharedObj.siteCode == 'my'){
			postalCode = $("#delivery-zipcode").val();
		}
		
		if(sharedObj.modelCode) {
			
			// 20230616 MSA create-exchange   , CE Trade-up   
			if (sharedObj.exchangeApiData && sharedObj.exchangeApiData.exchangeFlag && sharedObj.ceTradeUpPopup.isEnabled) {

				//     (  "F-"  )
				if (CeTradeUpPopup.context.modelPackage) {

					for (let p of CeTradeUpPopup.context.modelPackage.models) {
						let prodRec = {
							productCode : p.modelCode,
							quantity : 1
						};
						let prodParam = "products[" + productIndex + "]";
						param += prodParam + ".productCode=" + p.modelCode + "&" + prodParam + ".quantity=1";

						if (p.modelCode === CeTradeUpPopup.context.modelCode) {
							prodRec.services = [{
								exchangeId : sharedObj.exchangeApiData.dataQuoteId,
								provider : "EXCHANGE"
							}];
							let svcParam = "&" + prodParam + ".services[0]";
							param += svcParam + ".exchangeId=" + sharedObj.exchangeApiData.dataQuoteId + svcParam + ".provider=EXCHANGE";
						}

						postParam['products'].push(prodRec);

						productIndex++;
					}
				}

				//   
				else {
					const qtyCount = sharedObj.proudctPriceInfo.productCartCount && sharedObj.proudctPriceInfo.productCartCount > 1 ? sharedObj.proudctPriceInfo.productCartCount : 1;
					
					param += 'products[' + productIndex + '].productCode=' + sharedObj.modelCode;
					param += '&products[' + productIndex + '].quantity=' + qtyCount;

					let svcParam = "&products[" + productIndex + "].services[0]";
					param += svcParam + ".exchangeId=" + sharedObj.exchangeApiData.dataQuoteId + svcParam + ".provider=EXCHANGE";

					postParam['products'].push(					{
						productCode : sharedObj.modelCode,
						quantity : qtyCount,
						services : [{
							exchangeId : sharedObj.exchangeApiData.dataQuoteId,
							provider : "EXCHANGE"
						}]
					});

					productIndex++;
				}
			} // end of CETradeUpPopup

			// 20231011 CE Trade-up   
			else {
				const qtyCount = sharedObj.proudctPriceInfo.productCartCount && sharedObj.proudctPriceInfo.productCartCount > 1 ? sharedObj.proudctPriceInfo.productCartCount : 1;

				param += 'products[' + productIndex + '].productCode=' + sharedObj.modelCode;
				param += '&products[' + productIndex + '].quantity=' + qtyCount;

				//[COMP6FE-1495] Au Post  cart 
				postParam['products'].push({
					'productCode' : sharedObj.modelCode,
					'quantity' : qtyCount
				});

				productIndex++;
			}
			
			//new-hybris
			if(((sharedObj.siteCode == 'id' && isNewHybris) || sharedObj.siteCode == 'my') && postalCode != null && postalCode != undefined && postalCode != ""){
				param += '&products[0].postalCode=' + postalCode;
				postParam['products'][0]['postalCode'] = postalCode;
			}
			
			if(sharedObj.giftCard.isGiftCard && sharedObj.giftCard.cartGiftCardCode){
				var giftCardAmount = {
							'key' : 'giftcard_amount',
							'value' : sharedObj.giftCard.selectedPrice
						};
				var giftCardRecipientEmail = {
							'key' : 'giftcard_recipient_email',
							'value' : sharedObj.giftCard.email
						};
				var giftCardRecipient = {
							'key' : 'giftcard_recipient',
							'value' : sharedObj.giftCard.firstName + " " + sharedObj.giftCard.lastName
						};
				var giftCardMessage = {
							'key' : 'giftcard_personalized_message',
							'value' : sharedObj.giftCard.personalizedMessage
						};
				//Gift Card 
				var additionalInfos = [giftCardAmount,giftCardRecipientEmail,giftCardRecipient];
				//Gift Card 
				if(sharedObj.giftCard.personalizedMessage != null && sharedObj.giftCard.personalizedMessage != ""){
					additionalInfos.push(giftCardMessage);
				}
				
				param += '&products[0].productCode=' + sharedObj.giftCard.cartGiftCardCode;
				param += '&products[0].quantity=1';
				postParam['products'][0]['additionalInfos'] = additionalInfos;
			}
		}
		
		if(sharedObj.cartBezelCode){
			param += '&products[' + productIndex + '].productCode=' + sharedObj.cartBezelCode;
			param += '&products[' + productIndex + '].quantity=1';
			postParam['products'].push({
				'productCode' : sharedObj.cartBezelCode,
				'quantity' : 1
			}); 
			productIndex++;
		}
		
		let smcIndex = 0;
		const services =  sharedObj.globalServiceInfo;
		
		// trade in
		//[COMP6FE-1495] Au Multi TradeIn - Cart  
		if( sharedObj.isMultiTradeIn ){
		    /**
            * overPrice  nl, be, be_fr     
            */
			if( sharedObj.drawObj.tradeInResult.priceOverFlag && (siteCode === 'nl' || siteCode === 'be' || siteCode === 'be_fr'|| siteCode === 'sg' || siteCode === 'vn'|| siteCode === 'my' || siteCode === 'id' || siteCode === 'fr' || siteCode === 'de' || siteCode === 'sa' || siteCode === 'sa_en') ){//CRHQ-8480
                sharedObj.drawObj.tradeInResult.priceOverFlag = false;
            }

			if( sharedObj.drawObj.tradeInResult.list && sharedObj.drawObj.tradeInResult.list.length > 0 && !sharedObj.drawObj.tradeInResult.priceOverFlag  ){
				const tradeInList = sharedObj.drawObj.tradeInResult.list;
				smcIndex = tradeInList.length;
				$.each( tradeInList, ( tradeItemIndex, item )=>{
					const tradeItem = item.services;
					if(tradeItem.tradeInType == null || tradeItem.tradeInType == undefined) {
						tradeItem.tradeInType = 'IMEI';
					}
					
					param+=`&products[0].services[${tradeItemIndex}].serviceCode=${encodeURIComponent(tradeItem.tradeinId)}`;  // '+'  
					param+=`&products[0].services[${tradeItemIndex}].additionalInfos[0].key=${tradeItem.tradeInType}`;
					param+=`&products[0].services[${tradeItemIndex}].additionalInfos[0].value=${tradeItem.imeiKey}`;
					//CRHQ-8945
					var tradeinCodeData={
						'serviceCode' : tradeItem.tradeinId,
						'additionalInfos' : [{
							'key' : tradeItem.tradeInType,
							'value' : tradeItem.imeiKey,
						}]
		            };
					let isCommonTradeinCheck = new window.sg.components.dynamic.BuyingToolOpUtile().isCommonTradeinCheck();//CRHQ-8352
		            if (siteCode == 'de' && isCommonTradeinCheck) {
		                tradeinCodeData["serviceCode"] = "T-TEQCYCLE-TRADEIN";
		                tradeinCodeData["serviceType"] = "TRADE_IN";
		                tradeinCodeData.additionalInfos.push({
		                                "key": "deviceSku",
		                                "value": tradeItem.tradeinId
										});
		            }
		            if(siteCode == 'fr' && tradeItem.serviceType){
		                if(tradeItem.serviceType != null && tradeItem.serviceType != undefined) {
		                    tradeinCodeData["serviceType"]= tradeItem.serviceTypeCode;
		                }
		            }
					addServiceToParam(postParam, tradeinCodeData);
		            //CRHQ-8945  
					
					// CRHQ-7213 [B2C][BC] AU trade in journey
                    if(siteCode == 'au' && tradeItem.tradeInPrice != "" && tradeItem.tradeInPrice != undefined ){
                    	postParam['products'][0].services[tradeItemIndex]['additionalInfos'].push({
                            "key": "discountAmount",
                            "value": tradeItem.tradeInPrice
                        });
                    }
                    
					if( (siteCode != "de" && tradeInList.length > 1) || (siteCode == "de" && sharedObj.maxTradeInsAllowed > 1)){
						param+=`&products[0].services[${tradeItemIndex}].addToCartType=APPEND`
						postParam['products'][0].services[tradeItemIndex]['addToCartType'] = 'APPEND'; 
					}
					
					var additionalInfoCnt = 1;
					if(tradeItem.questionAndAnswer != "" && tradeItem.questionAndAnswer != undefined) {  
						param += `&products[0].services[${tradeItemIndex}].additionalInfos[${additionalInfoCnt}].key=questionAndAnswer`;  
						param += `&products[0].services[${tradeItemIndex}].additionalInfos[${additionalInfoCnt}].value=${encodeURIComponent(JSON.stringify(tradeItem.questionAndAnswer))}`;  
						
						postParam['products'][0].services[tradeItemIndex]['additionalInfos'].push({
							'key' : 'questionAndAnswer',
							'value' : JSON.stringify(tradeItem.questionAndAnswer),
						})
						
						additionalInfoCnt++;
						
						$.each(tradeItem.questionAndAnswer, function(questionIndex, questionAndAnswer){  
							param += `&products[0].services[${tradeItemIndex}].assessmentCriteria[${questionIndex}].name=${questionAndAnswer.name}`;  
							param += `&products[0].services[${tradeItemIndex}].assessmentCriteria[${questionIndex}].value=${questionAndAnswer.value}`;
							if( !postParam['products'][0].services[tradeItemIndex]['assessmentCriteria'] ){
								postParam['products'][0].services[tradeItemIndex]['assessmentCriteria'] = [];
							}
							
							postParam['products'][0].services[tradeItemIndex]['assessmentCriteria'].push({
								'name' : questionAndAnswer.name,
								'value' : questionAndAnswer.value,
							})
						});  
					}
					
					if(tradeItem.tradeInAdditionalInfo != null && tradeItem.tradeInAdditionalInfo != undefined){
						$.each(tradeItem.tradeInAdditionalInfo, function(index, tradeInAdditionalInfo){
							param += `&products[0].services[${tradeItemIndex}].additionalInfos[${additionalInfoCnt}].key=${tradeInAdditionalInfo.key}`;  
							param += `&products[0].services[${tradeItemIndex}].additionalInfos[${additionalInfoCnt}].value=${encodeURIComponent(tradeInAdditionalInfo.value)}`;
						
							postParam['products'][0].services[tradeItemIndex]['additionalInfos'].push({
								'key' : tradeInAdditionalInfo.key,
								'value' : tradeInAdditionalInfo.value,
							})
							additionalInfoCnt++;
						});
					}
				})
			}
		} else if(services.tradein && services.tradein.tradeinId && !sharedObj.ceTradeUpPopup.isEnabled) {
			
			smcIndex = 1;
			
			if(!services.tradein.tradeInType) {
				services.tradein.tradeInType = 'IMEI';
			}
				
			param+='&products[0].services[0].serviceCode=' + services.tradein.tradeinId;  
			param+='&products[0].services[0].additionalInfos[0].key=' + services.tradein.tradeInType;
			param+='&products[0].services[0].additionalInfos[0].value=' + services.tradein.imeiKey;
			
			var tradeinCodeData={
                'serviceCode' : services.tradein.tradeinId,
                'additionalInfos' : [{
                    'key' : services.tradein.tradeInType,
                    'value' : services.tradein.imeiKey,
                }]
            };

           
            let isCommonTradeinCheck = new window.sg.components.dynamic.BuyingToolOpUtile().isCommonTradeinCheck();//CRHQ-8032
			// CRHQ-7255 [B2C][BC][IM] SEG multiple tradein 
            if (siteCode == 'de' && isCommonTradeinCheck) {
                tradeinCodeData["serviceCode"] = "T-TEQCYCLE-TRADEIN";
                tradeinCodeData["serviceType"] = "TRADE_IN";
                tradeinCodeData.additionalInfos.push({
                                "key": "deviceSku",
                                "value": services.tradein.tradeinId
                            });
            }
            //CRHQ-6341 [B2C][BC][IM] Trade-in CX improvement - SEUK
            if(siteCode == 'fr' && services.tradein.serviceType){
                if(services.tradein.serviceType != null && services.tradein.serviceType != undefined) {
                    tradeinCodeData["serviceType"]= services.tradein.serviceTypeCode;
                }
            }
			
            addServiceToParam(postParam, tradeinCodeData);

			let additionalInfoCnt = 1;
			
			if(sharedObj.siteCode !== "ca" && sharedObj.siteCode !== "ca_fr"){
				if(services.tradein.questionAndAnswer) {  
					param += '&products[0].services[0].additionalInfos[' + additionalInfoCnt + '].key=questionAndAnswer';  
					param += '&products[0].services[0].additionalInfos[' + additionalInfoCnt + '].value=' + JSON.stringify(services.tradein.questionAndAnswer);
					
					if( isNewHybris ){
						postParam['products'][0].services[0]['additionalInfos'].push({
							'key' : 'questionAndAnswer',
							'value' : encodeURIComponent(JSON.stringify(services.tradein.questionAndAnswer)),
						})
					} else {
						postParam['products'][0].services[0]['additionalInfos'].push({
							'key' : 'questionAndAnswer',
							'value' : JSON.stringify(services.tradein.questionAndAnswer),
						})
					}

					
					additionalInfoCnt++;
					$.each(services.tradein.questionAndAnswer, function(questionIndex, questionAndAnswer){  
						param += '&products[0].services[0].assessmentCriteria[' + questionIndex + '].name=' + questionAndAnswer.name;  
						param += '&products[0].services[0].assessmentCriteria[' + questionIndex + '].value=' + questionAndAnswer.value;
						
						if( !postParam['products'][0].services[0]['assessmentCriteria'] ){
							postParam['products'][0].services[0]['assessmentCriteria'] = [];
						}
						
						postParam['products'][0].services[0]['assessmentCriteria'].push({
							'name' : questionAndAnswer.name,
							'value' : questionAndAnswer.value,
						})
					});
				}
			}

			if(services.tradein.tradeInAdditionalInfo){
				$.each(services.tradein.tradeInAdditionalInfo, function(index, tradeInAdditionalInfo){
					param += '&products[0].services[0].additionalInfos['+ additionalInfoCnt +'].key=' + tradeInAdditionalInfo.key;
					if( isNewHybris ){
						param += '&products[0].services[0].additionalInfos['+ additionalInfoCnt +'].value=' + tradeInAdditionalInfo.value;
						postParam['products'][0].services[0]['additionalInfos'].push({
							'key' : tradeInAdditionalInfo.key,
							'value' : tradeInAdditionalInfo.value,
						})
					}else{
						//old hybris
						param += '&products[0].services[0].additionalInfos['+ additionalInfoCnt +'].value=' + encodeURIComponent(tradeInAdditionalInfo.value);
						postParam['products'][0].services[0]['additionalInfos'].push({
							'key' : tradeInAdditionalInfo.key,
							'value' : tradeInAdditionalInfo.value,
						})
					}
					
					additionalInfoCnt++;
				});
			}
			// CRHQ-7255 [B2C][BC][IM] SEG multiple tradein - de 
			if (sharedObj.siteCode ==="nl" || sharedObj.siteCode ==="be" || sharedObj.siteCode ==="be_fr" || sharedObj.siteCode ==="my" || (sharedObj.siteCode === "de" && !isCommonTradeinCheck)) {
				clearCartFlag = true;
				postParam['clearCart'] = true;
			}
			
			if( siteCode === 'lt' || siteCode === 'lv' || siteCode === 'ee' ){
				if( services.tradein.cartAdditionalInfos && services.tradein.cartAdditionalInfos.length > 0 ){
					const obj = {'key' : 'IMEI', 'value' : services.tradein.imeiKey ? services.tradein.imeiKey : ''}
					tradeinCodeData.additionalInfos = services.tradein.cartAdditionalInfos;
					tradeinCodeData.additionalInfos.unshift(obj);
				}
				tradeinCodeData.targetProductCode = sharedObj.modelCode;
			}
		}
		
		//vn-trade-in-popup
		/* vnTradeInPopup V1 */
		// if(siteCode === 'vn' && $("#categoryGroupCode").val() === '04000000'){
		// 	if($(".option-result--vn .rde')){
		// 		param += '&products[0].services[0].serviceCode=' + encodeURIComponent($(".option-result--vn .result-price").data('productcode'));
		// 		addServiceToParam(postParam, {
		// 			'serviceCode' : encodeURIComponent($(".option-result--vn .result-price").data('productcode'))
		// 		});
		// 	}
		// }
		
		//warranty vd
		if(sharedObj.useWarrantyVd){
			if($(".option-result--extended-warranty-option .option-result__text-wrap").data('model-code')){
				param += '&products[0].services[0].serviceCode=' + encodeURIComponent($(".option-result--extended-warranty-option .option-result__text-wrap").data('model-code'));
				addServiceToParam(postParam, {
					'serviceCode' : encodeURIComponent($(".option-result--extended-warranty-option .option-result__text-wrap").data('model-code'))
				});
			}
		}
		
		// samsung care
		if(services.care && services.care.discounted_sku) {
			param += '&products[0].services[' + smcIndex + '].serviceCode=' + encodeURIComponent(services.care.discounted_sku);
			//[EPP] &EPPONLY post  encodeURIComponent 
			addServiceToParam(postParam, {
				'serviceCode' : $('#isEppPage').val() === 'true' ? services.care.discounted_sku : (services.care.discounted_sku.indexOf("+") > -1 ? services.care.discounted_sku : encodeURIComponent(services.care.discounted_sku))
			});
			
			smcIndex ++;
		}
		
		// tariff plan
		if(services.tariff && services.tariff.tariffId) {
			//new-hybris
			if( isNewHybris ){
				/* CRHQ-7964 [B2C][BC][MX][FR] Enable SIM Tariff display for Simple PD for A series smartphones */
				if(sharedObj.siteCode === "fr"){
					var tariffParm = {};
					tariffParm['planId'] = services.tariff.tariffId;
					tariffParm['serviceType'] = "SIM_PLAN";
					addServiceToParam(postParam, tariffParm);
				}else{
					if( services.tariff && services.tariff.modelCode && services.tariff.simSkuCode ){
						param += '&products[0].services[' + smcIndex + '].planId=' + services.tariff.modelCode;
						param += '&products[0].services[' + smcIndex + '].serviceCode=' + services.tariff.simSkuCode;

						// CRHQ-9555 [B2C][MX]DE] Broadband Tariff 
						if(services.tariff.isBroadbandService){

							/*
							,"services": [{            
								"planId": "O2-1867"
								,"serviceCode": "F-SIMO2"
								,"serviceType": "BROADBAND_PLAN"
								,"additionalInfos":[
									{"key": "streetName", "value": "test street"}
									, {"key": "houseNumber", "value": "123"}
									, {"key": "houseNumberAddition", "Ground Floor": "test street"}
									, {"key": "postCode", "value": "3312"}
									, {"key": "locality", "value": "Berlin street"}
								]   
							}]  					
							*/
							param += '&products[0].services[' + smcIndex + '].serviceType=BROADBAND_PLAN';
							param += (function(){
								return $.map(services.tariff.tariffArr, function(tariffItem, tariffIndex){
									
									return [
										,`&products[0].services[${smcIndex}].additionalInfos[${tariffIndex}].key=${tariffItem.key}`
										,`&products[0].services[${smcIndex}].additionalInfos[${tariffIndex}]${(function(){
											if(tariffItem.key == "houseNumberAddition"){
												return encodeURIComponent(`['Ground Floor']=${tariffItem['Ground Floor']}`);
											}
											return `.value=${tariffItem.value}`;
										})()}`								
									].join("");

								}).join("");
							})();

							addServiceToParam(postParam, {
								'planId' : services.tariff.modelCode,
								'serviceCode' : services.tariff.simSkuCode
								,"serviceType" :  "BROADBAND_PLAN"
								,"additionalInfos" : services.tariff.tariffArr
							});
						} else {
							
							addServiceToParam(postParam, {
								'planId' : services.tariff.modelCode,
								'serviceCode' : services.tariff.simSkuCode
							});
						}
					}
				}
				
				if(sharedObj.siteCode ==="nl" || sharedObj.siteCode ==="be" || sharedObj.siteCode ==="be_fr" || sharedObj.siteCode ==="de" || sharedObj.siteCode ==="fr") {
					clearCartFlag = true;
				}
			}else{
				// [COMP6FE-1500] SEAU cart parameter planId 
				let paramName = "serviceCode=";
				var tariffParm = {};
				
				//CRHQ-5645 [SENA][se,no] SIM   
				if(sharedObj.siteCode === "se" || sharedObj.siteCode === "no" || sharedObj.siteCode === "dk" || sharedObj.siteCode === "au"){//CRHQ-8994 
					/*CRHQ-7221 [B2C][BC][IM] SENA SIM : MSA */
					tariffParm['planId'] = services.tariff.tariffId;
					tariffParm['serviceType'] = "SIM_PLAN";
					//tariffParm['planId'] = services.tariff.partnerId;
					//tariffParm['serviceCode'] = services.tariff.serviceProduct; 
					postParam['clearCart'] = true;
				} else {
					tariffParm['serviceCode'] = services.tariff.tariffId;
				}
				
				param += '&products[0].services[' + smcIndex + '].'+paramName+'' + services.tariff.tariffId;
				$.each(services.tariff.tariffArr, function(tariffIndex, tariffItem) {
					param += '&products[0].services[' + smcIndex + '].additionalInfos[' + tariffIndex + '].key=' + tariffItem.key;  
					param += '&products[0].services[' + smcIndex + '].additionalInfos[' + tariffIndex + '].value=' + tariffItem.value;
					
					if( !tariffParm['additionalInfos'] ){
						tariffParm['additionalInfos'] = [];
							'key': tariffItem.key,
						'value': tariffItem.value,
					})
				})
				
				addServiceToParam(postParam, tariffParm);
			}
			smcIndex ++;
		}
		
		//new-hybris
		//combo
		if( services.combo && services.combo.length > 0 ){
			$.each(services.combo, function(index, comboData){
				param += '&products[' + productIndex + '].productCode=' + comboData.modelCode;  
				param += '&products[' + productIndex + '].quantity=1';
				
				postParam['products'].push({
					'productCode' : comboData.modelCode,
					'quantity' : 1,
				})
				
				productIndex++;			
				if(sharedObj.siteCode ==="nl" || sharedObj.siteCode ==="be" || sharedObj.siteCode ==="be_fr" || sharedObj.siteCode ==="de" || sharedObj.siteCode ==="fr") {
					if(comboData!= null && comboData.modelCode.indexOf('SIM') > -1 ){
						clearCartFlag = true;
					}
				}
        	});  
        }
		
		// embed add on
		if( services.embedaddon && services.embedaddon.length > 0 ){
			$.each(services.embedaddon, function(index, embedAddonData){
				param += '&products[' + productIndex + '].productCode=' + embedAddonData;
				param += '&products[' + productIndex + '].quantity=1';
				
				postParam['products'].push({
					'productCode' : embedAddonData,
					'quantity' : 1,
				})
				
				productIndex++;
			});
		}
		
		// add on
		let addonFlag = false;
		let giftFlag = false;
		if( isContinue ) {
			productIndex = 0;
			param = '';
			postParam['products']=[];
			
			$.each(accessoryList, function(index, accessory){
				param += (param === '' ? '' : '&') + 'products[' + productIndex + '].productCode=' + accessory; 
				param += '&products[' + productIndex + '].quantity=1';
			  
				postParam['products'].push({
					'productCode' : accessory,
					'quantity' : 1,
				})
				
				productIndex++;
				addonFlag = true;
			});
			
			//gift
			if( selectedGift && Object.keys(selectedGift).length > 0 ){
				for( modelCode of selectedGift.modelCode ){
					if( modelCode ){
						param += (param === '' ? '' : '&') + 'products[' + productIndex + '].productCode=' + modelCode;  
						param += '&products[' + productIndex + '].quantity=1';
						productIndex++;
						
						postParam['products'].push({
							'productCode' : modelCode,
							'quantity' : 1,
						})
						
						giftFlag = true;
					}
				}
			}
			
		} else {
			if( !isDirect ){
				isMoveUrl = false;
			}
		}
		
		let cartUrl = sharedObj.cartUrl.indexOf('https://') > -1 || sharedObj.cartUrl.indexOf('http://') > -1 ? sharedObj.cartUrl : sharedObj.apiDomain+sharedObj.cartUrl;
		//ae ae_ar  sharedObj.multistoreSiteCd cart URL replace 
		if(cartUrl !== undefined){
			if(siteCode === "ae"){
				cartUrl = cartUrl.replace("/ae/","/"+sharedObj.multistoreSiteCd+"/");
			} else if(siteCode === "ae_ar"){
				cartUrl = cartUrl.replace("/ae_ar/","/"+sharedObj.multistoreSiteCd+"/");
			}
		}
		
		var storeWebDomain = $("#storeWebDomain").val();
		var apiURL = "";
		
		if( postParam['products'].length == 0 ){
			postParam = {};
		}
        
        // epp shop 
		const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : sharedObj.multistoreSiteCd;
        
		//new-hybris
		if(isNewHybris){
			param = encodeURI(param);
			apiURL = storeWebDomain + "/" + siteCodeWithEpp + "/ng/p4v1/addToCart?" + param;

		}else{
			apiURL = sharedObj.apiDomain + "/" + siteCodeWithEpp + "/ng/p4v1/addToCart?" + param;
		}
		
		//add on gift   clearCartFlag false  
		if(addonFlag || giftFlag) {
		    clearCartFlag = false;
		    apiURL += '&clearCart=false';
			postParam['clearCart'] = false;
		}

		if( clearCartFlag && (isNewHybris || sharedObj.siteCode === 'my') ){
			apiURL += '&clearCart=true';
			postParam['clearCart'] = true;
		}
		
		
		if(sharedObj.addToCartPostYn == 'Y') {
			//json POST    API URL
			if(isNewHybris){
				//param = encodeURI(param);
				apiURL = storeWebDomain + "/" + siteCodeWithEpp + "/servicesv2/addToCart";
 			}else{
				apiURL = sharedObj.apiDomain + "/" + siteCodeWithEpp + "/servicesv2/addToCart";
			}
			
			if (DEBUG) {
				console.log("sharedObj.addToCartPostYn=[" + sharedObj.addToCartPostYn+"]");
				console.log("isNewHybris=[" + isNewHybris+"]");
				console.log("apiURL=[" + apiURL+"]");
			} 
		}
		
		$('.cm-loader').show(); // new-hybris beforeHybris.callAddToCartCta      
				
		// add on   accessory, gift    url 
		if( isContinue && !addonFlag && !giftFlag ){
			if(siteCode === "ae" || siteCode === "ae_ar"){
				if(siteCode === "ae"){
					sharedObj.cartUrl = sharedObj.cartUrl.replace("/ae/","/"+sharedObj.multistoreSiteCd+"/");
				} else if(siteCode === "ae_ar"){
					sharedObj.cartUrl = sharedObj.cartUrl.replace("/ae_ar/","/"+sharedObj.multistoreSiteCd+"/");
				}
				
				let moveUrl = sharedObj.cartUrl.indexOf('https://') > -1 || sharedObj.cartUrl.indexOf('http://') > -1 ? sharedObj.cartUrl : sharedObj.apiDomain+sharedObj.cartUrl;
				
				//epp shop 
				moveUrl = $('#isEppPage').val() === 'true' ? `${$('#storeWebDomain').val()}/${$('#eppCompanyCode').val()}/cart` : moveUrl;
				
				location.href = moveUrl;
			} else {
				// 
				let moveUrl = sharedObj.cartUrl.indexOf('https://') > -1 || sharedObj.cartUrl.indexOf('http://') > -1 ? sharedObj.cartUrl : sharedObj.apiDomain+sharedObj.cartUrl;
				
				//epp shop 
				moveUrl = $('#isEppPage').val() === 'true' ? `${$('#storeWebDomain').val()}/${$('#eppCompanyCode').val()}/cart` : moveUrl;
				
				location.href = moveUrl;
			}
		}else if(sharedObj.addToCartPostYn == 'Y') {
			if (DEBUG) {
				console.log("before isAddToCartPost=[" + isAddToCartPost+"]");
			} 
			isAddToCartPost = true;
			if (DEBUG) {
				console.log("after isAddToCartPost=[" + isAddToCartPost+"]");
			} 
			// au sharedObj.addToCartPostYn    (POST    )
			// [SELL-OUT] PD AU Cart 
			//     AU  hybrisJsonYn ="N"  .          .
			$.ajax({  
				url : apiURL,
				type : "POST",  
				data : JSON.stringify (postParam),
				dataType: 'json',
				xhrFields: { withCredentials: true },
				contentType: 'application/json',
				timeout : 20000,
				beforeSend : function() {
					$('.cm-loader').show();
				},
				success : function (data) {
					if(data.resultCode === "0000" || data.resultCode === "0002") {
						updateTotalCartCount(data.cartCount);
						if( isMoveUrl ){
							let cartUrl = sharedObj.cartUrl.indexOf('https://') > -1 || sharedObj.cartUrl.indexOf('http://') > -1 ? sharedObj.cartUrl : sharedObj.apiDomain+sharedObj.cartUrl;
							//ae ae_ar  sharedObj.multistoreSiteCd cart URL replace 
							if(cartUrl !== undefined){
								if(siteCode === "ae"){
									cartUrl = cartUrl.replace("/ae/","/"+sharedObj.multistoreSiteCd+"/");
								} else if(siteCode === "ae_ar"){
									cartUrl = cartUrl.replace("/ae_ar/","/"+sharedObj.multistoreSiteCd+"/");
								}
							}
							
							//epp shop 
							const cartUrlwithEpp = $('#isEppPage').val() === 'true' ? `${$('#storeWebDomain').val()}/${$('#eppCompanyCode').val()}/cart` : cartUrl;
							const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : sharedObj.multistoreSiteCd;
							const isLeasingArea = (siteCode === "be" || siteCode === "be_fr" || siteCode === "nl" || siteCode === "fr");
							const isLeasingChk = $("#pd-leasing-1").prop("checked");
							const paymentModeCode = sharedObj.drawObj.between.nonPurchase.paymentModeCode;
							if( isLeasingArea && isLeasingChk && paymentModeCode !== null ){
								location.href = storeWebDomain + "/" + siteCodeWithEpp + "/cart/payment/" + paymentModeCode;
							}else{
								location.href = cartUrlwithEpp; 
							}
						} else {
							$('.cm-loader').hide();
							addToCartFlag = false;
						}
					} else {
						$('.cm-loader').hide();
						addToCartFlag = false;
						callErrorPopup(data);
						if((siteCode == "ca" || siteCode == "ca_fr") && !isDirect && !isContinue){//CRHQ-8714
							window.scrollTo(0, 0);
							$(".pdd16-step-buying").hide();
							$(".pdd16-step-buying").html(pdd16stepbuyinghtml);//reset
							$(".pdd16-step-buying").siblings().add($(".pdd16-step-buying").parent().siblings()).show();
							$(".add-ons-evoucher-popup").hide();

							sharedObj.util.clickEventListener( sharedObj, selectorObj );
						}
					}
				},error : function(data){  
					$('.cm-loader').hide();
					addToCartFlag = false;
					callErrorPopup(data); 
				},complete: function () {  
					 
				}
			});
		} else if(isAddToCartPost == false) {
			if(sharedObj.hybrisJsonYn === 'Y') {
				$.ajax({  
					url : apiURL,  
					type : "GET",  
					data : {},  
					dataType: 'json',  
					xhrFields: { withCredentials: true },
					timeout : 10000,  
					beforeSend : function() {
						$('.cm-loader').show();
					},
					success : function (data) {
						
						if(data.resultCode === "0000" || data.resultCode === "0002") {
							updateTotalCartCount(data.cartCount);
							if( isMoveUrl ){
								let cartUrl = sharedObj.cartUrl.indexOf('https://') > -1 || sharedObj.cartUrl.indexOf('http://') > -1 ? sharedObj.cartUrl : sharedObj.apiDomain+sharedObj.cartUrl;
								const isLeasingArea = (siteCode === "be" || siteCode === "be_fr" || siteCode === "nl" || siteCode === "fr");
								const isLeasingChk = $("#pd-leasing-1").prop("checked");
								const paymentModeCode = sharedObj.drawObj.between.nonPurchase.paymentModeCode;
								
								// epp shop 
								const cartUrlwithEpp = $('#isEppPage').val() === 'true' ? `${$('#storeWebDomain').val()}/${$('#eppCompanyCode').val()}/cart` : cartUrl;
								
								if( isLeasingArea && isLeasingChk && paymentModeCode !== null ){
									// epp shop 
									const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : sharedObj.multistoreSiteCd;

									location.href = storeWebDomain + "/" + siteCodeWithEpp + "/cart/payment/" + paymentModeCode;
								}else{
									location.href = cartUrlwithEpp; 
								}
							} else {
								$('.cm-loader').hide();
								addToCartFlag = false;
							}
						} else {
							$('.cm-loader').hide();
							addToCartFlag = false;
							callErrorPopup(data);
						}
						
					},error : function(data){  
						$('.cm-loader').hide();
						addToCartFlag = false;
						callErrorPopup(data);
					}
				});
			} else {
				//jsonp  
				var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};

				$.ajax({  
					url : apiURL,
					type : "GET",  
					data : {},  
					dataType: 'jsonp',
					xhrFields: _xhrFields,  
					jsonp : "callback",  
					timeout : 10000,  
					beforeSend : function() {
						$('.cm-loader').show();
					},
					success : function (data) {
						
						if(data.resultCode === "0000" || data.resultCode === "0002") {
							updateTotalCartCount(data.cartCount);
							if( isMoveUrl ){
								let cartUrl = sharedObj.cartUrl.indexOf('https://') > -1 || sharedObj.cartUrl.indexOf('http://') > -1 ? sharedObj.cartUrl : sharedObj.apiDomain+sharedObj.cartUrl;
								const isLeasingArea = (siteCode === "be" || siteCode === "be_fr" || siteCode === "nl" || siteCode === "fr");
								const isLeasingChk = $("#pd-leasing-1").prop("checked");
								const paymentModeCode = sharedObj.drawObj.between.nonPurchase.paymentModeCode;
								
								// epp shop 
								const cartUrlwithEpp = $('#isEppPage').val() === 'true' ? `${$('#storeWebDomain').val()}/${$('#eppCompanyCode').val()}/cart` : cartUrl;
									
								if( isLeasingArea && isLeasingChk && paymentModeCode !== null ){
									// epp shop 
									const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : sharedObj.multistoreSiteCd;

									location.href = storeWebDomain + "/" + siteCodeWithEpp + "/cart/payment/" + paymentModeCode;
								}else{
									location.href = cartUrlwithEpp; 
								} 
							} else {
								$('.cm-loader').hide();
								addToCartFlag = false;
							}
						} else {
							$('.cm-loader').hide();
							addToCartFlag = false;
							callErrorPopup(data);
						}
					},error : function(data){  
						$('.cm-loader').hide();
						addToCartFlag = false;
						callErrorPopup(data); 
					}
				});
			}
		}
	}

	function hybrisAddCart( sharedObj, isDirect, isContinue ) {
		
		let param = "";  
		
		if(sharedObj.modelCode) {
			param += 'productCode=' + sharedObj.modelCode;
			param += '&quantity=1';

			// 20230616 MSA create-exchange   , CE Trade-up   
			if (sharedObj.exchangeApiData && sharedObj.exchangeApiData.exchangeFlag && sharedObj.ceTradeUpPopup.isEnabled) {
				let svcParam = "&services[0]";
				param += svcParam + ".exchangeId=" + sharedObj.exchangeApiData.dataQuoteId + svcParam + ".provider=EXCHANGE";
			}
		}
		
		const siteCode = sharedObj.multistoreSiteCd;
		
		// epp shop 
		const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : siteCode;

		let shopUrl = sharedObj.apiDomain + "/" + siteCodeWithEpp + "/ng/p4v1/addCart?" + param;
		
		if( sharedObj.siteCode === "ar" || sharedObj.siteCode === "br" ){
			location.href = sharedObj.apiDomain + '/' + sharedObj.siteCodeWithEpp +"/getServicesProduct?productCode=" + sharedObj.modelCode;
		} else if( sharedObj.siteCode === "py" ){
			location.href = sharedObj.apiDomain +"/getServicesProduct?productCode=" + sharedObj.modelCode;
		} else {
			var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};

			$.ajax({  
				url : shopUrl,  
				type : "GET",  
				data : {},  
				dataType: 'jsonp',
				xhrFields: _xhrFields,  
				jsonp : "callback",  
				async: false,  
				timeout : 10000,  
				beforeSend : function() {
					$('.cm-loader').show();
				},
				success : function (data) {
					
					$('.cm-loader').hide();
					if(data.resultCode === "0000") {
						updateTotalCartCount(data.cartCount);
						
						let moveUrl = sharedObj.cartUrl.indexOf('https://') > -1 || sharedObj.cartUrl.indexOf('http://') > -1 ? sharedObj.cartUrl : sharedObj.apiDomain+sharedObj.cartUrl;
						//epp shop 
						moveUrl = $('#isEppPage').val() === 'true' ? `${$('#storeWebDomain').val()}/${$('#eppCompanyCode').val()}/cart` : moveUrl;
						
						location.href = moveUrl;
						//location.href = sharedObj.apiDomain + sharedObj.cartUrl;  
					} else {
						addToCartFlag = false;
						callErrorPopup(data);
					}
					
				},error : function(data){
					$('.cm-le.I18n.get("We're sorry, an error occurred.");
		
		if(data.resultMessage) {
			message = data.resultMessage;
		} else if (data.responseJSON && data.responseJSON.message) {
			message = data.responseJSON.message
		}
		
		if($("#siteCode").val() == "de") {
			if(data) {
				if(data.products && data.products.length > 0) {
					if(data.products[0].productCode && data.products[0].productCode !=null) {
						if(data.products[0].productCode == "V-GIFTCARD"){
							message = data.products[0].resultMessage;
						}
					}
				}
			}
		}
		if(data && data.responseJSON && data.responseJSON.errors && data.responseJSON.errors.length > 0 && data.responseJSON.errors[0] && data.responseJSON.errors[0].type){
			const errorType = data.responseJSON.errors[0].type;
			if(errorType == 'TokoUpgradeProductsError') message = 'Please remove Samsung Flex or Samsung Upgrade to order multiple items, or place a separate order.';
		}
		
		confirmPopup(message, "error");
	}
	
	function afterHybrisApi( sharedObj, selectorObj ){
		const drawObj = sharedObj.drawObj;
		const view = sharedObj.view;
		const isGPv2AndHyIntg = sharedObj.isGPv2AndHyIntg;
		const isHybrisSplitPD = sharedObj.isHybrisSplitPD;
		const isHybrisSplitPDTradeIn = sharedObj.isHybrisSplitPDTradeIn;
		const isHybrisSplitPDSamsungCarePlus = sharedObj.isHybrisSplitPDSamsungCarePlus;
		const isHybrisSplitPDLease = sharedObj.isHybrisSplitPDLease;
		const isHybrisSplitPDUpgrade = sharedObj.isHybrisSplitPDUpgrade;
		const isHybrisSplitPDTariff = sharedObj.isHybrisSplitPDTariff;
		const util = sharedObj.util;
		const categoryGroupCode = $("#categoryGroupCode").val();

		if( siteCode === 'au' ){
			tariffData.setTariff();
		}
		
		sharedObj.util.totalAfterFunction( sharedObj, selectorObj );
		sharedObj.util.clickEventListener( sharedObj, selectorObj );
		
		if( isGPv2AndHyIntg || isHybrisSplitPD){
			//my isGPv2AndHyIntg        (   ...) 
			//if(siteCode !== 'my') {
				//meta splitPdTradeInYn Y      (,  API)
				if(isHybrisSplitPDTradeIn) {
					
					const tempTitle = $("#tempTitle").val();//CRHQ-8032
					let isCommonTradeinCheck = new window.sg.components.dynamic.BuyingToolOpUtile().isCommonTradeinCheck();//CRHQ-8032
					if(isCommonTradeinCheck){
						new window.sg.components.dynamic.BuyingToolOpUtile().loadComponent("commontradein");
						bc_common_tradeIn.init();
					}else{
						// VD or DA on Standard/Buying PD
						if (sharedObj.ceTradeUpPopup.isEnabled && (tempTitle=="page-buying-pd" || tempTitle=="page-standard-pd")) {
							if ($("#ce-trade-up-popup-section").length === 0) {
								let catId = sharedObj.ceTradeUpPopup.productCategoryGroup;
								new window.sg.components.dynamic.BuyingToolOpUtile().loadComponent("ce-tradeup." + catId);
							}
							window.CeTradeUpPopup.init(sharedObj.modelCode);
						}
						// oterwise
						else {
							const categoryTypeCode = $("#categoryTypeCode").val();
							//meta  splitPdYn="Y"  splitPdTradeInYn="Y"    VD/DA trade up    OR     .
							const tradeInExceptedFlag = (siteCode == 'levant' || siteCode == 'levant_ar' || siteCode == 'tw' || (siteCode == 'vn' && categoryTypeCode.startsWith('0805')));

							if(!tradeInExceptedFlag){
								if(typeof tradeinData !== "undefined") {
									tradeinData.setTradein();
								}
							}
						}
					}
				}
				//meta splitPdSamsungCarePlusYn Y      (,  API)
				if(isHybrisSplitPDSamsungCarePlus) {
					settingCare( sharedObj, selectorObj );
				}
				
				//meta splitPdUpgradeYn Y    (only es) 
				if(isHybrisSplitPDUpgrade) {
					settingHybrisUpgradeDraw( sharedObj, drawObj, selectorObj );
				}

				//meta splitPdTariffYn Y      (,  API, only au)
				if(isHybrisSplitPDTariff) {
					settingTariff();
				}
			//}
		}
		
		// lease 
		//settingHybrisBetweenDraw( sharedObj, selectorObj );
		
		settingGift( sharedObj, selectorObj );
		settingAccessory( sharedObj, selectorObj );
		settingPromotion( sharedObj, selectorObj ); //[COMP6FE-1507] Hybris API    service  .   hybris  
		settingDeliveryCheck( sharedObj, selectorObj );
		sharedObj.commonApiModel.settingWishList( sharedObj, selectorObj );
		view.productDraw(drawObj);
		
		util.totalReinit( sharedObj, selectorObj );
		util.gpHybrisGlobalEndPoint(sharedObj, selectorObj);
	}
	
	/**
	 * Gift   
	 */
	function settingGift( sharedObj, selectorObj ){
		if( sharedObj.giftdataHybris.length > 0 ){
			const isHybrisSplitPD = sharedObj.isHybrisSplitPD;
			const isOldHybris = (sharedObj.apiFlag === "Hybris" || sharedObj.apiFlag === "Hybris-intg");
			
			if(isOldHybris) {
				// add on :: free gift 
				window.sg.components.dynamic.freeGiftHybrisCommon.getRelatedProductsSimpleInfo( sharedObj.modelCode );
			} else if(sharedObj.siteCode != 'tr' && sharedObj.siteCode != 'cn') { // SETK - Buy Button Development Request + cn
				//3rd  add on free gift 
				window.sg.components.dynamic.freeGiftHybris.getRelatedProductsSimpleInfo( sharedObj.modelCode );
			}
			
			
		}
	}
	
	/**
	 * AddOn     
	 */
	function settingAccessory( sharedObj, selectorObj ){
		const isHybrisSplitPD = sharedObj.isHybrisSplitPD;
		const isOldHybris = (sharedObj.apiFlag === "Hybris" || sharedObj.apiFlag === "Hybris-intg");
		
		if(isOldHybris) {
			const isVDSTEPBUYING = sharedObj.addonStepBuying04 || sharedObj.addonStepBuying0701;
			if( isVDSTEPBUYING && sharedObj.newEmbedVDCountry ){ // new vd
				window.sg.components.dynamic.bridgePageCommon.getRelatedProductsVdSimpleInfo( sharedObj.modelCode );
			} 
			window.sg.components.dynamic.bridgePageCommon.getRelatedProductsSimpleInfo( sharedObj.modelCode );
		} else if(sharedObj.siteCode != 'tr' && sharedObj.siteCode != 'cn') { // SETK - Buy Button Development Request + cn
			// 3rd addon
			window.sg.components.dynamic.betterTogetherHybris.getRelatedProductsSimpleInfo( sharedObj.modelCode );
		}
	}
	
	/**
	 * Offer promotion    
	 */
	function settingPromotion( sharedObj, selectorObj ){
		//[COMP6FE-1507] Hybris API  , Offer  
		if( sharedObj.isOldHybrisCheckService ){
			if( availableServicesCheck(sharedObj,'BENEFIT') ){
				ajaxOffer(sharedObj,selectorObj);
			}
			if( availableServicesCheck(sharedObj,'SIM') ){
				sharedObj.simpleInfoSIM = true;
			}
		}
	}
	
	function ajaxOffer( sharedObj, selectorObj ){
		const siteCode = sharedObj.multistoreSiteCd;
		
		// epp shop 
		const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : siteCode;
		
		//[COMP6FE-1507] Hybris API  , Offer  
		let storeDomain = '';
		if( $("#newHyvStoreDomain").val() ){
			storeDomain = $("#newHyvStoreDomain").val();
		} else {
			storeDomain = $("#storeDomain").val();
		}
		
		let shopParm = '';
		if( $('#shopParmLang').val() ){
			shopParm=`&lang=${$('#shopParmLang').val()}`;
		}
		
		


		$.ajax({
			url: `${storeDomain}/tokocommercewebservices/v2/${siteCodeWithEpp}/products/${sharedObj.modelCode}/offers?fields=SIMPLE_INFO`+shopParm,
			type: 'GET',
			dataType: 'json',
			cache: true,
			xhrFields: { withCredentials: true },
			crossDomain: true,
			timeout: 20000,
			success : function ( data, responseText, jqXHR ) {
				if( data && data.benefits && data.benefits.length > 0 ){
					const promotionData = data.benefits;
					for( const index in promotionData ){
						const promotion = promotionData[index];
						const type = promotion.type ? promotion.type.toUpperCase() : "";
						if( type === "COMBO"){
							sharedObj.commonApiModel.callRelatedAndSearch( sharedObj.modelCode, settingCombo, { sharedObj, promotion, selectorObj }, { 'queryType' : 'SELECTION_OF_BUNDLE'} );
						} else if( type === "INSTALLMENT" ){
							settingFinance( promotion, index, sharedObj, selectorObj );
						} else if (type === "BOGO"){
							settingBogo( promotion, index, sharedObj, selectorObj );
						} else if( !type ){
							pomoMessage( promotion, index, sharedObj, selectorObj );
						}
					}
					
					//CRHQ-8807 - draw  offer     
					//sharedObj.drawObj.offer.headline = Granite.I18n.get('Offer');
					//sharedObj.view.productOfferDraw( sharedObj.drawObj )
					//window.sg.components.productDetailKv.reInit();
				}
			},
			error : function( XMLHttpRequest, textStatus, errorThrown ){},
			complete : function (){
				
				finishedOfferAPI(sharedObj, selectorObj, 0);
				
				//CRHQ-8807 - packageYn='Y'  childModelList offer  
		        const pdPackageYn = sharedObj.pdPackageYn;
		        const childCnt = sharedObj.pdChildModelCnt;
				
		        //CRHQ-8807
                if(pdPackageYn && childCnt > 0)
                  ajaxChildOffer(sharedObj,selectorObj);
			}
		});
	}
	
	//CRHQ-8807 - packageYn='Y'  childModelList offer  
    function ajaxChildOffer( sharedObj, selectorObj ){
		const siteCode = sharedObj.multistoreSiteCd;
		
		// epp shop 
		const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : siteCode;
		
		//[COMP6FE-1507] Hybris API  , Offer  
		let storeDomain = '';
		if( $("#newHyvStoreDomain").val()){
			storeDomain = $("#newHyvStoreDomain").val();
		} else {
			storeDomain = $("#storeDomain").val();
		}
		
		let shopParm = '';
		if( $('#shopParmLang').val() ){
			shopParm=`&lang=${$('#shopParmLang').val()}`;
		}
		
		
        const packageYn = sharedObj.pdPackageYn;
        const childCnt = sharedObj.pdChildModelCnt;

        const childModelList = [];
        const offerView = sharedObj.drawObj.offer;

        if(childCnt > 0){

            let childOfferOrder = 0; //benefit  , index
            for(let i=0; i < childCnt ; i++){

                let num = (i+1) + ''; 
                if((i+1) < 10)
                    num = '0' + (i+1);
              
                let childId = document.querySelector("#pdChidleModel" + num);
                let childCode = childId.dataset.code;
                let childName = childId.dataset.name;
                let childMain = childId.dataset.main;
                let childDisplayName = childId.dataset.displayName;
                let childSet = {"code":childCode, "name":childName, "main":childMain, "displayName":childDisplayName};
                
                sharedObj.pdChildModelList.push(childSet);
              
              // ajax     async:false    return
                (function(i) {
	        		$.ajax({
	        			url: `${storeDomain}/tokocommercewebservices/v2/${siteCodeWithEpp}/products/${childCode}/offers?fields=SIMPLE_INFO`+shopParm,
	        			type: 'GET',
	        			dataType: 'json',
	        			cache: true,
	        			async:false, 
	        			xhrFields: { withCredentials: true },
	        			crossDomain: true,
	        			timeout: 20000,
	        			success : function ( data, responseText, jqXHR ) {
	        				if( data && data.benefits && data.benefits.length > 0 ){
	        					const promotionData = data.benefits;
	        					
	        					if(childOfferOrder === 0){
	                              offerView.childList = [];
	                            }
	  
	                            let tempChildOffer = {
	                            	  'hasComponent' : true,
	                                  'childCode' : childSet.code,
	                                  'displayName' : childSet.displayName,
	                                  'combo' : [],
	                                  'gift' : {},
	                                  'bogo' : {},
	                                  'promotionMessage' : [],
	                                  'promotionFinance' : [],
	                                  'promotionSmartclub' : []
	                              }
	  
	                            offerView.childList.push(tempChildOffer);
	
	                            let offerGubun = "child";
	                            let childIndex = 0;
	        					for( const index in promotionData ){
	        						const promotion = promotionData[index];
	        						const type = promotion.type ? promotion.type.toUpperCase() : "";
	
	                                //INSTALLMENT     count  - child offer  3 
	                                if(type !== "INSTALLMENT" && type !== "COMBO"){
	                                    childIndex = childIndex + 1;
	                                }
	
	                                if(childIndex < 4){
	                                    let htmlIndex = childOfferOrder + '' + childIndex;
	                              
	            						if (type === "BOGO"){
	            							settingBogo( promotion, htmlIndex, sharedObj, selectorObj, 'child', childOfferOrder);
	            						} else if( !type ){
	            							pomoMessage( promotion, htmlIn                      }
	        					}
	        					//INSTALLMENT, COMBO  offer  ..
	                            let arrChild = sharedObj.drawObj.offer.childList;
	                            if(childIndex  === 0) {
	                                arrChild.splice(ord);
	                                //arrChild.pop();
	                            }
	
	                             childOfferOrder = arrChild.length;
	                             //childOfferOrder = childOfferOrder + 1;
	
	                            //CRHQ-8807 - draw  offer       
	        					//sharedObj.drawObj.offer.headline = Granite.I18n.get('Offer');
	        					//sharedObj.view.productOfferDraw( sharedObj.drawObj )
	        					//window.sg.components.productDetailKv.reInit();
	        					
	        					//child offer  action js  binding  
	        					//window.sg.components.pdBuyingTool.bindComboOfferEvent();
	
	                           
	        				}
	        			},
	        			error : function( XMLHttpRequest, textStatus, errorThrown ){},
	        			complete : function (){
	        				//CRHQ-8807 - draw  offer     
	        				finishedOfferAPI(sharedObj, selectorObj, i+1);
	        			}
	        		});
                })(i);
            }
        }
	}
    
    //**CRHQ-8807 - draw  offer      **/
    function finishedOfferAPI(sharedObj, selectorObj, cnt){
        const drawObj = sharedObj.drawObj;
        const view = sharedObj.view;
        const pdPackageYn = sharedObj.pdPackageYn;
        const pdChildModelCnt = sharedObj.pdChildModelCnt;
 
        let drawYn = false;
        if(pdPackageYn){
            if(pdChildModelCnt == cnt){
              drawYn = true;
            }
        }else{
          drawYn = true;
        }

       
        if(drawYn){

            sharedObj.drawObj.offer.headline = Granite.I18n.get('Offer');
            sharedObj.view.productOfferDraw( sharedObj.drawObj )
            window.sg.components.productDetailKv.reInit();
            //child offer bindComboOfferEvent  binding  
            window.sg.components.pdBuyingTool.bindComboOfferEvent();
          
        }
        
    }
	
	/**
	 * Delivery   
	 */
	function settingDeliveryCheck( sharedObj, selectorObj ){
		const util = sharedObj.util;
		const siteCode = sharedObj.siteCode;
		const deliverySiteCode = sharedObj.deliveryPickup.deliverySiteCode;
		
		if( sharedObj.isOldHybrisCheckService ){
			if( availableServicesCheck(sharedObj,'POSTAL_CODE')){
				settingDelivery(sharedObj, selectorObj);
				if(deliverySiteCode.includes(siteCode)){
					$(".pd-select-option--delivery-pickup").show();
					util.settingDeliveryPickup( sharedObj, selectorObj );
				}
			}
		}
	}
	
	function settingDelivery( sharedObj, selectorObj){
		const siteCode = sharedObj.siteCode;
		const drawObj = sharedObj.drawObj;
		const pdProductType = sharedObj.pdProductType;
		const stockLevelStatus = sharedObj.stockLevelStatus;
		const delivery = drawObj.delivery;
		const util = sharedObj.util;
		
		if( siteCode === 'my' ){
			delivery.hasComponent = true;
			delivery.headline = Granite.I18n.get('Delivery Detail');
			delivery.label = Granite.I18n.get('Enter Zipcode');
			delivery.cancelText = Granite.I18n.get('Delete');
			delivery.enterText = Granite.I18n.get('Search');
			
			/* my  pincode 5  */
			if( siteCode === 'my' ){
				delivery.inputAttr.maxlength = '5';
			}
			
			if( stockLevelStatus === 'NOORDER' || stockLevelStatus === 'OUTOFSTOCK' ){
				delivery.labelClass = 'text-field--disabled';
				delivery.ctaClass = 'cta--disabled';
				delivery.inputAttr.disabled = 'true';
			}
		}
	}
	
	function settingFinance( promotion, index, sharedObj, selectorObj ){
		//[COMP6FE-1507] Hybris API  , Offer  
		const drawObj = sharedObj.drawObj;
		const siteCode = sharedObj.siteCode;
		const offerView = drawObj.offer;
		const emiCalculatorUrl = sharedObj.financingUrl;
		const iconData = getIconData( promotion, sharedObj );
		const iconAlt = iconData.iconAlt;
		
		let contentWrapperClass = 'offer-emi emi-index-'+index;
		let emiMessage = [];
		let imgSrc = '';
		let rowTex= true;
		
		if( emiCalculatorUrl ){
			sharedObj.emiCalculatorUrl = emiCalculatorUrl;
		}
		
		if(promotion.description){
			emiMessage.push( promotion.description);
		}
		
		if( emiMessage.length > 0 ){
			
			imgSrc = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/promotion_icon/finance.svg';
			rowTextContent +='<div class="pd-offer__image-icon">';
			rowTextContent +=   '<div class="image">';
			rowTextContent +=	   '<img class="image__preview lazy-load" data-src="'+imgSrc+'?$LazyLoad_Home_PNG$" alt="'+iconAlt+'">';
			rowTextContent +=	   '<img class="image__main lazy-load" data-src="'+imgSrc+'?$48_48_PNG$" alt="'+iconAlt+'">';
			rowTextContent +=   '</div>';
			rowTextContent +='</div>';
			
			rowTextContent += '<div class="pd-offer-desc">';
			if( siteCode === 'id' || siteCode === 'ee' || siteCode === 'lt' || siteCode === 'lv' || siteCode === 'pl'){
				if(promotion.description) {
					rowTextContent +='<strong class="pd-offer__desc-title">'+promotion.description+'</strong>';
				}
			}
			rowTextContent +=   '<div class="pd-offer__cta">';
			
			/* EMI Type */
			if(siteCode === 'hu' || siteCode === 'sg' || siteCode === 'my' || siteCode === 'nz' || siteCode === 'vn'){
				sharedObj.promotionFinancingFlag = true;
				for( var jdx=0; jdx < emiMessage.length; jdx++ ){
					let emiText = emiMessage[jdx].replace('<u>','').replace('</u>','');
					if( emiText.indexOf('<a') < 0 ){
						if( siteCode === 'in' ){
							rowTextContent += '<strong class="pd-offer__title-text">';
							rowTextContent += emiText +' <br/> EMI also available on Debit cards <br/> ';
							rowTextContent += '<a class="cta cta--underline cta--black add-special-tagging" href="javascript:void(0);" data-target-popup="eipPopup" aria-haspopup="dialog" role="button"'+
									'an-tr="header(pim)_offer option-'+sharedObj.pageTrackPd+'-cta-title"'+
									'an-ca="option click"'+
									'an-ac="pd buying tool"'+
									'an-la="offer:'+emiText.toLowerCase()+'">' + Granite.I18n.get('Learn more') + '</a>';
							rowTextContent += '</strong>';
						} else {
							if( siteCode === 'id' || siteCode === 'ee' || siteCode === 'lt' || siteCode === 'lv' || siteCode === 'pl' ) {
								rowTextContent += '<a class="cta cta--underline cta--black add-special-tagging" href="javascript:void(0);" data-target-popup="eipPopup" aria-haspopup="dialog" role="button"'+
								'an-tr="header(pim)_offer option-'+sharedObj.pageTrackPd+'-cta-title"'+
								'an-ca="option click"'+
								'an-ac="pd buying tool"'+
								'an-la="offer:'+emiText.toLowerCase().replace(/\"/g,"")+'">' + Granite.I18n.get('Learn more') + '</a>';								
							} else {
								// 
								rowTextContent += '<a class="cta cta--underline cta--black add-special-tagging" href="javascript:void(0);" data-target-popup="eipPopup" aria-haspopup="dialog" role="button"'+
								'an-tr="header(pim)_offer option-'+sharedObj.pageTrackPd+'-cta-title"'+
								'an-ca="option click"'+
								'an-ac="pd buying tool"'+
								'an-la="offer:'+emiText.toLowerCase().replace(/\"/g,"")+'">' + emiText + '</a>';
							}
						}
					} else {
						rowTextContent += '<strong class="pd-offer__title-text">';
						rowTextContent+=emiText;
						rowTextContent += '</strong>';
					}
				}
			} else {
				rowTextContent += '<strong class="pd-offer__title-text">';
				for(var mIndex=0; mIndex<emiMessage.length; mIndex++){
					rowTextContent += emiMessage[mIndex];
				}
				rowTextContent += '</strong>';
			}
			
			rowTextContent +=   '</div>';
			rowTextContent += '</div>';
			rowText.push({ 'target' : '.'+ contentWrapperClass.replace(' ','.'), 'text' : rowTextContent});
			
			offerView.promotionFinance.push({
				'title' : 'finance',
				'hasItem' : true,
				'item' : {
					'contentWrapperClass' : contentWrapperClass,
					'iconAttr' : {
						'src' : imgSrc,
						'alt' : iconAlt
					},
					'description' : {
						'hasDescription' : true
					},
					'rowText' : rowText
				}
			});
		}
	}
	
	//CRHQ-8807 - child offer
	function settingBogo ( promotion, index, sharedObj, selectorObj, offerGubun='product', ord=0 ){
		//[COMP6FE-1507] Hybris API  , Offer   - CRHQ-8807(const --> let)
		let offerView = sharedObj.drawObj.offer;
		
		//CRHQ-8807
		if(offerGubun === 'child')
	          offerView = sharedObj.drawObj.offer.childList[ord];
	
		const util = sharedObj.util;
		const pcPath = promotion.image && promotion.image.url ? promotion.image.url : '';
		const alt = promotion.image && promotion.image.altText ? promotion.image.altText : '';
		const customsObj = { 'classWapper' : 'image__main responsive-img' };
		const priceCurrency = sharedObj.priceCurrency;
		const pdTimeformatFront = sharedObj.pdTimeformatFront;

		let imgAttr = util.getImgAttr ( pcPath, pcPath, alt, customsObj );

		let mainDec = [];
		let bodoDate = '';
		
		if(promotion.description ){
			mainDec.push( {'text' : promotion.description});
		}

		if( promotion.startDate && promotion.endDate ){
			if( pdTimeformatFront ){
				bodoDate = dateFormat(promotion.startDate.split('T')[0], pdTimeformatFront) + ' ~ ' + dateFormat(promotion.endDate.split('T')[0], pdTimeformatFront);
			}else{
				bodoDate = promotion.startDate.split('T')[0] + ' ~ ' + promotion.endDate.split('T')[0];
			}
		}

		let originalPrice = '';
		let savePrice = '';
		let nowPrice = '';
		let price = 0; //  bogoPrice;
		
		if( price){
			origin		savePrice = G(0, priceCurrency);
		} else{
			nowPrice = currencyComma(0, priceCurrency);
		}
		
		const thisTotalItem = {
			'title' : 'bogo',
			'hasItem' : true,
			'item' : {
				'contentWrapperClass' : 'bogo-item',
				'headline' : Granite.I18n.get('Buy 1 Get 1 Free'),
				'description' : {
					'hasDescription' : true,
					'main' : mainDec,
					'date' : bodoDate
				},
				'imgAttr' : imgAttr,
				'price' : {
					'hasPrice' : true,
					'price' : price,
					'original' : originalPrice,
					'save' : savePrice,
					'now' : nowPrice
				}
			}
		}
		
		offerView.bogo = thisTotalItem;
	}
	
	function settingCombo( result, isSuccess, returnParam ){

		const sharedObj = returnParam.sharedObj;
		const drawObj = sharedObj.drawObj;
		const offerView = drawObj.offer;
		const offerList = offerView.combo;
		const util = sharedObj.util;
		const view = sharedObj.view;
		const promotion = returnParam.promotion;
		const pdTimeformatFront = sharedObj.pdTimeformatFront;
		const iconData = getIconData( promotion, sharedObj );

		let learnMoreCta = {};
		let comboDate = '';
		let iconImgName = '';
			
		if( iconData.promoIconFlag ){
			iconImgName = iconData.iconImgName;
		}

		let mainDec = [];
		if(promotion.description ){
			mainDec.push( {'text' : promotion.description });
		}else{
			mainDec.push( {'text' : Granite.I18n.get('Select combo bundle option') });
		}
		
		var customsObj = {};
		customsObj.layerTarget = 'shopComboPopup';
		customsObj['comboIdx'] = sharedObj.globalComboData.length;
		learnMoreCta = util.getAttrCta ( Granite.I18n.get('ADD TO ORDER'), 'javascript:;', '_self', 's-btn-combo-popup', customsObj,'' );
		
		if( promotion.startDate && promotion.endDate ){
			if( pdTimeformatFront ){
				comboDate = dateFormat(promotion.startDate.split('T')[0], pdTimeformatFront) + ' ~ ' + dateFormat(promotion.endDate.split('T')[0], pdTimeformatFront);
			}else{
				comboDate = promotion.startDate.split('T')[0] + ' ~ ' + promotion.endDate.split('T')[0];
			}
		}

		const thisTotalItem = {
			'title' : 'compoBundle',
			'comboIndex' : sharedObj.globalComboData.length,
			'hasItem' : true,
			'item' : {
				'headline' : Granite.I18n.get('Bundle options'),
				'iconName' : iconImgName,
				'description' : {
					'hasDescription' : true,
					'main': mainDec,
					'date': comboDate
				},
				'learnMoreCta' : learnMoreCta
			}
		}
		
		offerList.push(thisTotalItem);
			
		view.productOfferDraw(drawObj, true);

		result = window.sg.components.dynamic.comboPopup.setComboData(result.totalResult);
		sharedObj.globalComboData.push(result);
			
	}
	
	//CRHQ-8807 - child offer
	function pomoMessage( promotion, index, sharedObj, selectorObj, offerGubun='product', ord=0 ){
		//CRHQ-8807(const --> let)
		let offerView = sharedObj.drawObj.offer;
		if(offerGubun === 'child')
	          offerView = sharedObj.drawObj.offer.childList[ord];
		
		//[COMP6FE-1507] Hybris API  , Offer  
		const iconData = getIconData( promotion, sharedObj );
		
		let contentWrapperClass = 'offer-promotion promotion-index-'+index;
		let promotionMessage = [];
		let imgSrc = null;
		let rowText = [];
		let rowTextContent = '';
		
		if(promotion.description){
			promotionMessage.push(promotion.description);
		}
		
		if( iconData.promoIconFlag ){
			imgSrc = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/promotion_icon/'+ iconData.iconImgName +'.svg';
		}
		
		for(var jdx=0; jdx<promotionMessage.length; jdx++){
			rowTextContent += promotionMessage[jdx].replace('<a', '<a target=\'_blank\'');
		}
		
		rowText.push({ 'target' : '.'+ contentWrapperClass.replace(' ','.') + ' .pd-offer__desc', 'text' : rowTextContent});
		
		//CRHQ-8807
		offerView.promotionMessage.push({
			'title' : 'promoMessage',
			'hasItem' : true,
			'item' : {
				'contentWrapperClass' : contentWrapperClass,
				'isIcon' : true,
				'iconAttr' : {
					'src' : imgSrc,
					'alt' : iconData.iconAlt
				},
				'description' : {
					'hasDescription' : true
				},
				'rowText' : rowText
			}
		});
	}
	
	function getIconData( promotion, sharedObj ){
		const promotionImgTypeList = sharedObj.promotionImgType ? sharedObj.promotionImgType.split(',') : [];
		
		let iconAlt = '';
		let promoIconFlag =  false;
		let iconImgName = '';

		if( promotion.image ){
			iconAlt = promotion.image.altText;
			iconImgName = promotion.image.url;
			if( iconImgName ){
				for( const name of promotionImgTypeList ){
					if( name === iconImgName ){
						promoIconFlag = true;
						break;
					}
				}
			}
		}

		return {
			iconAlt, promoIconFlag, iconImgName
		}
	}
	
	function availableServicesCheck( sharedObj, serviceName ){
		if( sharedObj.hybrisApiData.shopAPI && sharedObj.hybrisApiData.shopAPI.supportedAvailableServices ){
			for( apiName of sharedObj.hybrisApiData.shopAPI.supportedAvailableServices ){
				if( apiName.toUpperCase() === serviceName.toUpperCase() ){
					return true;
				}
			}
		}
		
		return false;
	}
	
	/**
	 * Care    
	 */
	function settingCare( sharedObj, selectorObj ){
		configuratorCare.setProductInfo();
	}
	
	function settingHybrisBetweenDraw( sharedObj, selectorObj ){
		const siteCode = sharedObj.siteCode;
		const drawObj = sharedObj.drawObj;
		const view = sharedObj.view;
		const isHybrisSplitPDLease = sharedObj.isHybrisSplitPDLease;
		const stockLevelStatus = sharedObj.stockLevelStatus;
 		// TODO : stockLevelStatus     
		const pdUpgrade = sharedObj.pdUpgrade;
		
		let noText = Granite.I18n.get('Up2You Rental');  //Lease  ( it)
		let text = Granite.I18n.get('Purchase');  //Lease   ( it)
		
		//it/ru   (    			let tenureValue = 0;
			let downPayment = sharedObj.proudctPriceInfo.leaseInfo.upfront;
			let tenureUnit = sharedObj.proudctPriceInfo.leaseInfo.month;
			let monthlyRate = sharedObj.proudctPriceInfo.leaseInfo.monthly;
			let dataLeaseingId = "";//... GPv2   hybris cart       .  
			let isViewLease = false;
			//3       
			if(downPayment !=="" && tenureUnit !=="" &&  monthlyRate !=="") {
				isViewLease = true;
			}

			if(siteCode === 'ru') {
				noText = Granite.I18n.get('Buy with Samsung Upgrade'); //Lease  
				text = Granite.I18n.get('Buy Now');  //Lease  
			}  
			
			drawObj.between = {
					'hasComponent' : isViewLease,
					'purchase' : {
						'text' : text
					},
					'nonPurchase' : {
						'text' : noText,
						'dataLeaseing' : dataLeaseingId,
						'tenureUnit': tenureUnit,
						'tenureValue': tenureValue,
						'monthlyValue' : monthlyRate,
						'paymentValue' : downPayment
						
					}
				}
			//drawObj.between     . 
			view.betweenDraw(drawObj);
		}  
		
	}
	
	function settingHybrisUpgradeDraw( sharedObj, drawObj, selectorObj ){
		const siteCode = sharedObj.siteCode;
		const view = sharedObj.view;
		const pdUpgradeLearnMoreUrl = sharedObj.pdUpgradeLearnMoreUrl;  //    . 
		const util  = sharedObj.util;
 		const pdProductType = sharedObj.pdProductType; //    . (uk  )
 		const isHybrisSplitPDUpgrade = sharedObj.isHybrisSplitPDUpgrade;	
 		const stockLevelStatus = sharedObj.stockLevelStatus;
 		
 		if(isHybrisSplitPDUpgrade) {
 			sharedObj.upgradeFlag = true;
 		}
 		const upgradeFlag = sharedObj.upgradeFlag;
		
 		let isEmbededType = false;
 		//let isSplitPDType = false;  //es  
 		let title = '';
 		let description = '';
 		let learnMoreTarget = '_self';
 		let learnMoreText = '';
 		let learnMoreHref = 'javascript:;';
 		let learnMoreCta = {};
 		let learnMoreClass = '';
 		let customsObj = {};
 		let yesAttr = {};
 		let noAttr = {};
 		let embedData = {};
 		description = Granite.I18n.get('Pay for your new Galaxy phone in monthly instalments and be invited to upgrade to the new Galaxy as soon as it launches.');
 		let isSetting = false;
 				//es  (     )
		if(isHybrisSplitPDUpgrade) {
			
			if(siteCode == 'es') {
				learnMoreText = Granite.I18n.get('Learn more');
				customsObj.layerTarget = 'upgradeLearnMorePopup';
				title = Granite.I18n.get('Samsung Upgrade');
				//isSplitPDType = true;
				//isEmbededType = true;
			} else {
				//          
				learnMoreText = Granite.I18n.get('Learn more');
				customsObj.layerTarget = 'upgradeLearnMorePopup';
				title = Granite.I18n.get('Samsung Upgrade');
			}

			if(siteCode == 'es') {
				//    (    )
				if( stockLevelStatus == 'INSTOCK' || stockLevelStatus == 'LOWSTOCK' ){
					isSetting = true;
				}
			} else {
				isSetting = true;
			}
			
			if(isSetting) {
				yesAttr = {
						'class' : 'hybris-es-yes',
						'text': Granite.I18n.get('Samsung Upgrade') 
				}
				noAttr = {
						'class' : 'hybris-es-no',
						'text': Granite.I18n.get('No, thanks'),
						'eventType' : 'eup',
						'modelCode' : 'upgrade',
						'modelName' : 'upgrade'
				}
				
				//  
				learnMoreCta= util.getAttrCta ( learnMoreText, learnMoreHref, learnMoreTarget, learnMoreClass, customsObj, '' );
				
				drawObj.upgrade = {
					'hasComponent' : upgradeFlag,
					'isEmbededType' : isEmbededType,
					'isNotEmbededType' : !isEmbededType,
					'title' : title,
					'learnMoreCta' :  learnMoreCta,
					'description' : description,
					'yesAttr' : yesAttr,
					'noAttr' : noAttr,
					'embedData' : embedData
				}
			}//:~ if(isSetting) {


		}
		
	}

	/**
	 * Tariff    
	 */
	 function settingTariff(){
		configuratorTariff.setProductInfo();
	}
	
	
	/**
	 *   card/detail API 
	 */
	function settingPriceBaseData(sharedObj, selectorObj, callBackFun ){
		
		const pdSearchDomain = sharedObj.pdSearchDomain + '/';
		const isHyIntg = sharedObj.apiFlag === "Hybris-intg";
		const modelCode = sharedObj.modelCode;
		const pdStageInfo = sharedObj.pdStageInfo;
		const dotcomMultistore = getDotcomMultistore( sharedObj, selectorObj );
		
		let addUrl = 'global';
		let isSucceed = false; 
		
		if( isHyIntg ){
			addUrl = 'hybris';
		}
		
		var param = {
			'commonCodeYN' : 'N',
			'siteCode' : sharedObj.siteCode,
			'modelList' : modelCode,
			'saleSkuYN':'N',
			'onlyRequestSkuYN' : 'Y'
		};
		
		if( addUrl === 'global' && dotcomMultistore ){
			param['shopSiteCode'] = dotcomMultistore;
		}
		
		// epp search  
		const isEPP = $('#isEppPage').val() === 'true';
		const businessType = isEPP ? 'epp/v2': 'b2c';
		if(isEPP){
			param.companyCode  = $('#eppCompanyCode').val();
			param.shopSkuYN  = "N";
			
			const eppIsUserGroupPricing = window.sg.epp.common.isUserGroupPricing;
			if(eppIsUserGroupPricing){
				param['groupName'] = window.sg.epp.common.groupName;
			}
		}
		
		var url = pdSearchDomain + pdStageInfo + `/${businessType}/product/card/detail/`+addUrl;
		
		$.ajax({
			url: url,
			type: 'GET',
			data : param,
			dataType : 'json',
			cache : true,
			success: function(data, responseText, jqXHR){
				const modelCode = sharedObj.modelCode;
				const priceCurrency = sharedObj.priceCurrency;
				isSucceed = true;
				
				if( data && data.response && data.response && data.response.resultData && data.response.resultData.productList ){
					const productList = data.response.resultData.productList;
					//const isTvType = sharedObj.categoryTypeCode && sharedObj.categoryTypeCode.substring(0,2) ==='04';
					const siteCode = sharedObj.siteCode;
					
					for( var index in productList ){
						const modelList = productList[index].modelList;
						if( modelList ){
							for( var indexM in modelList  ){
								const modelItem = modelList[indexM];
								const upperStock = modelItem.ctaType ? modelItem.ctaType.toUpperCase() : '';
								sharedObj.stockLevelStatus = upperStock;
								
								if( modelCode === modelItem.modelCode ){
									if(sharedObj.siteCode != 'tr' && sharedObj.siteCode != 'cn') { // SETK - Buy Button Development Request + cn
										if( modelItem.price ){
											sharedObj.proudctPriceInfo.orignalPrice = modelItem.price;
										}
										
										if( modelItem.priceDisplay ){
											sharedObj.proudctPriceInfo.orignalPriceFormatted = modelItem.priceDisplay;
										} else if( modelItem.price ) {
											sharedObj.proudctPriceInfo.orignalPriceFormatted = currencyComma(modelItem.price, priceCurrency);
										}
										
										if( modelItem.promotionPrice ){
											sharedObj.proudctPriceInfo.salePrice = modelItem.promotionPrice;
										} else {
											sharedObj.proudctPriceInfo.salePrice = modelItem.price;
										}
										
										if( modelItem.promotionPriceDisplay ){
											sharedObj.proudctPriceInfo.salePriceFormatted = modelItem.promotionPriceDisplay;
										} else if( modelItem.promotionPrice ) {
							
										} else {
											sharedObj.proudctPriceInfo.salePriceFormatted = sharedObj.proudctPriceInfo.orignalPriceFormatted;
										}
									}
									
									if( /*isTvType && */ modelItem.monthlyPriceInfo && modelItem.monthlyPriceInfo.leasingMonthly ){
										const isMonthlyPriceSite =  siteCode === "au" || siteCode === "nz" || siteCode === "ae" || siteCode === "my" || siteCode === "sg" || siteCode === "ca" || siteCode === "ca_fr" || 
																	siteCode === "it" || siteCode === "se" || siteCode === "dk" || siteCode === "fi" || siteCode === "no" || siteCode === "es" || siteCode === "pt" || 
																	siteCode === "th" || siteCode === "tw" || siteCode === "ru" || siteCode === "ch" || siteCode === "ch_fr";
										
										if( isMonthlyPriceSite ){
											sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice = modelItem.monthlyPriceInfo.leasingMonthly;
											sharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal = modelItem.monthlyPriceInfo.leasingMonths;
										}
									}
									
									if( modelItem.formattedPriceSave ){
										sharedObj.proudctPriceInfo.rowCodeformattedPriceSave = modelItem.formattedPriceSave;
									}
									
									
									if( sharedObj.proudctPriceInfo.salePriceFormatted && upperStock !== 'LEARNMORE' && upperStock !== 'NOORDER' && sharedObj.oldProductYn !== 'Y' ){
										sharedObj.drawObj.price.priceWrapper.hasPriceWrapper = true;
									}
									
									// tradeInPriceText       
									if( modelItem.tradeInPriceText && sharedObj.isHyIntg ){
										sharedObj.proudctPriceInfo.salePriceFormatted = modelItem.tradeInPriceText;
									}
									
									if( productList[index].productGroupId ){
										const reevooArea = selectorObj.buyingTool.find('reevoo-reviewable-badge');
										if( reevooArea.length > 0 ){
											reevooArea.attr('sku','series:'+productList[index].productGroupId);
										}
									}
									
									if( modelItem.configuratorUrl ){
										sharedObj.buyNowUrl = modelItem.configuratorUrl;
									}
									
								}
							}
						}
					}
				}
			},
			error : function( error ){
				console.log(error);
			},
			complete : function (){
				callBackFun( sharedObj, selectorObj, isSucceed );
			}
		});
	}
	
	/**
	 *       
	 */
	function startHybris( sharedObj, selectorObj, callbackData ){
		const view = sharedObj.view;
		const currentUrl = sharedObj.currentUrl;
		const siteCode = sharedObj.siteCode;
		const isHybris = ("Y" === sharedObj.isCart || "Hybris-intg" === sharedObj.apiFlag ) && "Y" !== sharedObj.oldProductYn;
		const isRealTime = siteCode === 'br' || siteCode === 'latin' || siteCode === 'ar' || siteCode === 'py'; // localshop
		const util = sharedObj.util;
		
		if( isHybris ){
			if( isRealTime ){
				getHyibrisRealTimeProductsInfo(sharedObj, selectorObj, view, currentUrl);
			} else {
				getHybrisProductsInfo(sharedObj, selectorObj, view, currentUrl);
			}
		} else {
			// Hybris    Old   
			setFrontApiInfo(sharedObj, selectorObj, view, currentUrl);
			util.totalReinit( sharedObj, selectorObj );
			util.gpHybrisGlobalEndPoint(sharedObj, selectorObj);
		}
	}
	
	//[COMP6FE-1495] Au Post  cart 
	function addServiceToParam(postParam, serviceObj){
		if( !postParam['products'][0].services ){
			postParam['products'][0].services = [];
		}
		postParam['products'][0].services.push(serviceObj)
	}
	
	dynamic.BuyingToolOpAjaxHybris = BuyingToolOpAjaxHybris;
	
})();


(() => {
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	class BuyingToolOpAjaxGPv2 {
		
		productAjax ( sharedObj, selectorObj ) {
			
			const modelCodeList = [sharedObj.shopSkuCode];
			sharedObj.finishedFirstSyndi = false;
			syndicatedAjax( sharedObj, selectorObj, modelCodeList, firstSyndi );
		}
		
		callCheckOutCta( sharedObj, accessoryList, selectorObj, isDirect, isContinue ) {
			const checkOutUrl = sharedObj.checkOutLink; 

			//epp shop 
			const cartUrlwithEpp = $('#isEppPage').val() === 'true' ? `${$('#storeWebDomain').val()}/${$('#eppCompanyCode').val()}/cart` : checkOutUrl;
			
			settingCtaData( sharedObj, selectorObj, accessoryList, cartUrlwithEpp, isDirect, isContinue );
		}
		
		callAddToCartCta ( sharedObj, accessoryList, selectorObj, isDirect, isContinue ){
			const cartUrl = sharedObj.cartUrl; 
			
		ue' ? `${$('#storeWebDomain').val()}/${$('#eppCompanyCode').val()}/cart` : cartUrl;
			
			settingCtaData( sharedObj, selectorObj, accessoryList, cartUrlwithEpp, isDirect, isContinue );
		}
	}
	
	/**
	 * IN Delivery  
	 */
	function getAjaxDate( sharedObj ){
		const apiUrl = "/aemapi/v6/product/serverUTC";
		$.ajax({
			type: "GET",
			url: apiUrl,
			success : function (data, responseText, jqXHR) {
				sharedObj.drawObj.delivery.time = jqXHR.getResponseHeader("Date");
			}
		});
	}
	
	/**
	 * syndi     modelcode  50
	 */
	function syndicatedAjax( sharedObj, selectorObj, modelCodeList, callBackFun ){
		const apiDomain = sharedObj.apiDomain;
		const countryIsoCode = sharedObj.countryIsoCode;
		const pdHrefLang = sharedObj.pdHrefLang;
		const pdMultiLanguageYN = sharedObj.pdMultiLanguageYN;
		const siteCode = sharedObj.siteCode;
		const pdJwtToken = $.cookies.get('jwt_'+countryIsoCode, {domain:'.samsung.com'});
		const skuList = [];
		const priceCurrency = sharedObj.priceCurrency;
		
		let skus = [];
		let count = 0;
		let finishCount = 0;
		let isSucceed = false; 
		let paramObj= '';
		
		getAjaxDate(sharedObj); // In Delivery  
		
		for(var index = 0; index < modelCodeList.length; index++){
			
			const modelCode = modelCodeList[index];
			
			if(count >= 50){
				count = 0;
				skuList.push(skus);
				skus=[];
			}
			skus.push(modelCode);
			count++;
			
			if(index == modelCodeList.length-1){
				skuList.push(skus);
			}
		}
		
		for( var skuIndex = 0; skuIndex < skuList.length; skuIndex++ ){
			let componentoptions="";
			if(siteCode  == "uk" ||  siteCode  == "de") {
				componentoptions=",carrier_attributes";
			}
			if(siteCode === 'fr' ) {
				componentoptions+=",payment_methods"
			}
			if(siteCode === 'in' ) {
				componentoptions+=",delivery_modes"
			}
			paramObj = 'skus=' + skuList[skuIndex].join(',') + '&component=offers,promotion,promotion_price'+componentoptions+'&count=0';
			
			if( $('#isEppPage').val() === 'true' ){
				paramObj += `&store_id=${$('#eppCompanyCode').val()}`;
				
			}
			
			$.ajax({
				headers: {
					'Cache-Control' : 'no-cache',
					'Content-Type' : 'application/json',
					'Access-Control-Allow-Origin' : '*'
				},
				url: apiDomain + '/v4/configurator/syndicated-product-linear',
				data: paramObj,
				type: 'GET',
				dataType: 'json',
				timeout: 20000,
				xhrFields: { withCredentials: true },
				beforeSend : function(xhr){
					if( pdJwtToken ){
						xhr.setRequestHeader('x-ecom-jwt', pdJwtToken);
					}
					if( pdMultiLanguageYN === 'Y' ){
						xhr.setRequestHeader('x-ecom-locale', pdHrefLang);
					}
				},
				success : function ( data, responseText, jqXHR ) {
					if( data && data.total_number_of_products !== 0 ){
						const syndiApiData = sharedObj.syndiApiData;
						isSucceed = true;
						for( var prod in data.products ){
							const item = data.products[prod];

							//formatted_value 
							if( item.price_info && item.price_info[0] ) {
								const msrp_price = item.price_info[0].msrp_price;
								const sale_price = item.price_info[0].sale_price;
								
								if( msrp_price ){
									msrp_price.formatted_value =  currencyComma( msrp_price.value, priceCurrency );
								}
								if( sale_price ){
									sale_price.formatted_value =  currencyComma( sale_price.value, priceCurrency );
								}
							}
						}
						
						$.extend( syndiApiData.products, data.products );
						$.extend( syndiApiData.expanded, data.expanded );
					}
				},
				error : function( XMLHttpRequest, textStatus, errorThrown ){},
				complete : function (){
					finishCount++;
					if( skuList.length == finishCount ){
						callBackFun( sharedObj, selectorObj, isSucceed );
					}
				} 
			});
		}
	}
	
	/**
	 *  syndi  promotions       
	 */
	function settingPromoData( product, sharedObj, drawObj, selectorObj ){
		
		const offer = drawObj.offer;
		const siteCode = sharedObj.siteCode;
		if(siteCode == 'fr'){
			offer.headline = Granite.I18n.get('Offer_PD');
		}else{
			offer.headline = Granite.I18n.get('Offer');
		}
		
		settingDelightDelivery( product, sharedObj, drawObj, selectorObj );
		settingPromotions( product, sharedObj, drawObj, selectorObj );
	}
	
	/**
	 * Commbo  
	 */
	function settingComboDraw ( sharedObj,selectorObj, drawObj ){
		
		const comboFlag = sharedObj.comboFlag;
		const setComboPopupData = sharedObj.setComboPopupData;
		const offerView = drawObj.offer;
		const offerList = offerView.combo;
		const util = sharedObj.util;
		const view = sharedObj.view;
		let learnMoreCta = {};
		let comboIndex = 0;
		
		if( comboFlag ){
			
			for(var idx=0; idx<setComboPopupData.length; idx++){
				var comboItem = setComboPopupData[idx];
				sharedObj.comboSearchList.push(comboItem.comboInfo);
				
				let mainDec = [];
				if(comboItem.comboPitch ){
					mainDec.push( {'text' : comboItem.comboPitch });
				}else{
					mainDec.push( {'text' : Granite.I18n.get('Select combo bundle option') });
				}
				
				var customsObj = {};
				customsObj.layerTarget = 'shopComboPopup';
				customsObj['comboIdx'] = comboIndex;
				learnMoreCta = util.getAttrCta ( Granite.I18n.get('ADD TO ORDER'), 'javascript:;', '_self', 's-btn-combo-popup', customsObj,'' );
				
				const thisTotalItem = {
					'title' : 'compoBundle',
					'comboIndex' : idx,
					'hasItem' : true,
					'item' : {
						'headline' : Granite.I18n.get('Bundle options'),
						'iconName' : comboItem.iconImgName,
						'description' : {
							'hasDescription' : true,
							'main': mainDec,
							'date': comboItem.comboDate
						},
						'learnMoreCta' : learnMoreCta
					}
				}
				
				offerList.push(thisTotalItem);
				comboIndex++;
			}
			
			view.productOfferDraw(drawObj, true);
		}
	}
	
	/**
	 * 2    1   
	 */
	function settingReData ( sharedObj,selectorObj, drawObj ){
		// 3. 2   
		settingComboDraw( sharedObj, selectorObj, drawObj );
		settingNextApi( sharedObj, selectorObj, drawObj );
		settingAddOnCareDraw( sharedObj, selectorObj, drawObj );
		settingAddOnWarrantyDraw( sharedObj, selectorObj, drawObj );
	}
	
	function settingNextApi( sharedObj, selectorObj, drawObj ){
		const samsungCareFlag = sharedObj.samsungCareFlag;
		const warrantyFlag = sharedObj.warrantyFlag;
		const addonsFlag = sharedObj.addonsFlag;
		const giftFlag = sharedObj.giftFlag;
		const pdProductTypeCheckYn = sharedObj.pdProductTypeCheckYn;
		const util  = sharedObj.util;
		const commonApiModel = sharedObj.commonApiModel;
		const addOnInfoTemp = sharedObj.addOnInfoTemp;
		const addOnGiftProduct = sharedObj.addOnGift.products;
		const samsungCareList = sharedObj.samsungCareList;
		const addOnInfo = sharedObj.addOnInfo;
		const afterEvent = sharedObj.afterEvent;
		const bogoFlag = sharedObj.bogoFlag;
		const pdSoftBundleUseYn = sharedObj.pdSoftBundleUseYn;
		const bogoModelList = sharedObj.bogoModelList;
		const pdBogoUseYn = sharedObj.pdBogoUseYn;
		
		let careAndWarranty = {};
		let care = {};
		let addOn = {};
		let gift = {};
		
		sharedObj.checkingBogoSearchFlag = true;
		sharedObj.checkingComboSearchFlag = true;
		
		if(bogoFlag  && pdBogoUseYn !== "N" && pdSoftBundleUseYn !== "Y" && bogoModelList.length > 0){
			sharedObj.bogoSearchList = sharedObj.bogoModelList;
		}
		
		if( samsungCareFlag || warrantyFlag ){
			if( pdProductTypeCheckYn === 'Y' ){
				if( util.isNotEmptyArray( addOnInfo ) ){
					careAndWarranty =  {
						'title' : 'careAndWarranty',
						'list' : addOnInfo
					}
				} else {
					afterEvent.setMainCallBack('careAndWarranty', null);
				}
			}else{
				if( util.isNotEmptyArray( samsungCareList ) ){
					care =  {
						'title' : 'care',
						'list' :samsungCareList
					}
				} else {
					afterEvent.setMainCallBack('care', null);
				}
				
			}
		}
		
		if( addonsFlag ){
			addOn =  {
				'title' : 'addOn',
				'list' :addOnInfoTemp
			}
			sharedObj.hasAddOns = true;
		}
		
		if( giftFlag ){
			gift =  {
				'title' : 'addOnGift',
				'list' :addOnGiftProduct
			}
		}
		
		// addOnApi  SearchAPI    .
		if( samsungCareFlag || warrantyFlag || addonsFlag || giftFlag ){
			
			let addOnApiList = {
				'careAndWarranty' : careAndWarranty,
				'care' : care,
				'addOn' : addOn,
				'gift' : gift
			}
			sharedObj.addOnApiList = addOnApiList;
			
			commonApiModel.callAddOnApi( sharedObj, selectorObj );
		} else {
			sharedObj.checkingAddOnSearchFlag = true;
			sharedObj.checkingGiftSearchFlag = true;
		}
		
		commonApiModel.waitSearchAPI( sharedObj, selectorObj );
	}
	
	/**
	 * Tariff Option   (SEG, SEUK)
	 */
	function settingTariffOptionDraw( product, sharedObj, drawObj, selectorObj ){
		const siteCode = sharedObj.siteCode;
		const expanded = sharedObj.syndiApiData.expanded;
		let tariffOption = drawObj.tariffOption;
		let sortOrderCarrierPlansImageArr = [];  //  (sort_order)
		
		
		if( product.carrier_attributes ){
			const carrierSkuList = product.carrier_attributes.carrier_plans ? product.carrier_attributes.carrier_plans.skus : [];
			const expandedCarrierPlanData = expanded.carrier_attributes && expanded.carrier_attributes.carrier_plans ? expanded.carrier_attributes.carrier_plans : {};
			const expandedCarrier = expanded.carrier_attributes && expanded.carrier_attributes.carriers ? expanded.carrier_attributes.carriers : [];
			const carrierPlansList=[];
			
			for(var dx=0; dx < carrierSkuList.length; dx++){
				
				const carrierPlansData = expandedCarrierPlanData[carrierSkuList[dx]];
				
				if( carrierPlansData ){
					
					if( siteCode === 'de' || siteCode === 'uk'){
						sharedObj.tariffFlag = true;
					}
					
					if(null != carrierPlansData.child_item_groups && carrierPlansData.child_item_groups.length > 0){ //  .
						carrierPlansData.child_skus=carrierPlansData.child_item_groups[0].skus;
					}

					for( var carrierIndex = 0; carrierIndex < expandedCarrier.length; carrierIndex++ ){
						let carrierid=carrierPlansData.carrier;
						if( carrierPlansData.carrier_id ){
							carrierid =carrierPlansData.carrier_id;
						}
						if(carrierid.toUpperCase() == expandedCarrier[carrierIndex].id.toUpperCase()){
							carrierPlansData.carrier= expandedCarrier[carrierIndex];
							break;
						}
					}
					carrierPlansList.push(carrierPlansData);
					product.carrier_attributes.carrier_plans =carrierPlansList;
				}
				// 1)      
				if( carrierPlansData != null && null != carrierPlansData.carrier && null != carrierPlansData.carrier.images.url && "" !== carrierPlansData.carrier.images.url){
					var carrierFlag = true;
					for(var carrIndex=0; carrIndex<sortOrderCarrierPlansImageArr.length; carrIndex++){
						if (carrierPlansData.carrier.images.url === sortOrderCarrierPlansImageArr[carrIndex].images.url) {
							carrierFlag = false;
						}
					}
					if(carrierFlag){
						sortOrderCarrierPlansImageArr.push( carrierPlansData.carrier );  //  array carrier 	
					}
				}
			}
			
			
			// 2) carrier sort_order sort
			sortOrderCarrierPlansImageArr.sort(function (a, b) { 
				return a.sort_order < b.sort_order ? -1 : a.sort_order > b.sort_order ? 1 : 0;  
			});
			
			if(sharedObj.tariffFlag){
				tariffOption.hasComponent = true;
				tariffOption.headline = Granite.I18n.get('Tariff Option');
				tariffOption.description = Granite.I18n.get('Choose your preferred tariff from various providers.');
				let logoList = [];				
				
				if( sortOrderCarrierPlansImageArr.length > 0 ) {
					// IE   '/etc/designs/smg/de/imgs/'  . >>
					//  idx<sortOrderCarrierPlansImageArr.length; idx++){
						let logoItem = {
							'src' : '',
							'alt' : ''
						}
						if(siteCode === 'de'){
							if(sortOrderCarrierPlansImageArr[idx].images.url.indexOf('Telekom') > -1){
								logoItem.src = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/img-carrier-logo-1.png';
								logoItem.alt = 'Telekom';
							} else if(sortOrderCarrierPlansImageArr[idx].images.url.indexOf('Vodaphone') > -1){
								logoItem.src = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/img-carrier-logo-3.png';
								logoItem.alt = 'Vodaphone';
							} else if(sortOrderCarrierPlansImageArr[idx].images.url.indexOf('o2') > -1){
								logoItem.src = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/img-carrier-logo-2.png';
								logoItem.alt = 'o2';
							} else {
								logoItem.src = sortOrderCarrierPlansImageArr[idx].images.url;
								logoItem.alt = '';
							}
						} else if(siteCode === 'uk'){
							logoItem.src = sortOrderCarrierPlansImageArr[idx].images.url;
							logoItem.alt = '';
						}
						if( logoItem.src ){
							logoList.push( logoItem );
						}
					}
				}
				tariffOption.logoList = logoList;
			}
		}
	}
	
	/**
	 * Dlivery   
	 */
	function settingDelivery( product, sharedObj, drawObj, selectorObj ){
		const siteCode = sharedObj.siteCode;
		const pdProductType = sharedObj.pdProductType;
		const stockLevelStatus = sharedObj.stockLevelStatus;
		const delivery = drawObj.delivery;
		const deliveryYN = sharedObj.deliveryYN;
		const pincodeCookie = $.cookies.get('HA-Deeplink-Zipcode',{domain : '.samsung.com'});
		const util = sharedObj.util;
		let deliveryTooltip = '';
		let deliveryTooltipMsg = '';
		
		const expanded = sharedObj.syndiApiData.expanded;
		//  delivery_modes     Delivery Detail    (,   hide)
		if(siteCode === 'in') {
			if( product.delivery_modes && product.delivery_modes.length > 0 ){
				const deliveryModesListData = product.delivery_modes;
				let isDeliveryModes = false;
				let timeList = [];
				
				for(var idx=0; idx<deliveryModesListData.length; idx++){
					const deliveryModesData = expanded.delivery_modes[deliveryModesListData[idx]];
					if(deliveryModesData.custom_properties && deliveryModesData.custom_properties.delivery_mode_type) {
						if(deliveryModesData.custom_properties.delivery_mode_type === 'priority delivery') {
							if(deliveryModesData.time_slot_attributes && deliveryModesData.time_slot_attributes.slot_code 
									&& deliveryModesData.time_slot_attributes.cut_off_hour && deliveryModesData.time_slot_attributes.cut_off_minutes) {
								const timeSlotAttributes = deliveryModesData.time_slot_attributes;
								let cutOffHour = timeSlotAttributes.cut_off_hour;
								if (cutOffHour.length < 2) {
									cutOffHour = '0' + cutOffHour;
								}
								let cutOffMinutes = timeSlotAttributes.cut_off_minutes;
								if (cutOffMinutes.length < 2) {
									cutOffMinutes = '0' + cutOffMinutes;
								}
								let obj = {};
								obj.idx = idx;
								if (timeSlotAttributes.slot_code.includes('SAME')) {
									obj.time = Number(cutOffHour + cutOffMinutes);
								} else {
									obj.time = Number(String(Number(cutOffHour) + 24) + cutOffMinutes);
								}
								timeList.push(obj);
							}
						}
					}
				}
				
				if (timeList.length > 0 && delivery.time !== null) {
					const cur = delivery.time.split("GMT")[0].trim().slice(-8);
					let curHours = Number(cur.split(":")[0]) + 5;		// GMT -> IST (+5)
					let curMinutes = Number(cur.split(":")[1]) + 30;	// GMT -> IST (+30)
					if (curMinutes > 59) {
						curMinutes = curMinutes - 30;
						curHours = curHours + 1;
					}
					if (String(curMinutes).length < 2) {
						curMinutes = "0" + String(curMinutes);
					}
					if (String(curHours).length < 2) {
						curHours = "0" + String(curHours);
					}
					
					let curTime = Number(String(curHours) + String(curMinutes));
					timeList.sort(function(a, b) { // cutoff  
						return a['time'] - b['time'];
					});
					let deliveryIdx = '';
					for (var i in timeList) {
						if (curTime < timeList[i].time) {
							deliveryIdx = timeList[i].idx; //     
							break;
						}
					}
					
					if (deliveryIdx !== '') {
						const timeSlotAttributes = expanded.delivery_modes[deliveryModesListData[deliveryIdx]].time_slot_attributes;
						let hour = Number(timeSlotAttributes.cut_off_hour);
						let ampm = '';
						if (hour < 12) {
							ampm = 'AM';
						} else {
							ampm = 'PM';
							if (hour > 12) {
								hour = hour - 12;
							}
						}
						let day = '';
						if (timeSlotAttributes.slot_code.includes('NEXT')) {
							day = 'Next day';
						} else if (timeSlotAttributes.slot_code.includes('SAME')) {
							day = 'Same day';
						}
						deliveryTooltip = 'Order by ' + hour + ' ' + ampm + ' and get ' + day + ' delivery.*';
						if (expanded.delivery_modes[deliveryModesListData[deliveryIdx]].images.large_image.desc) {
							deliveryTooltipMsg = expanded.delivery_modes[deliveryModesListData[deliveryIdx]].images.large_image.desc.replaceAll("\n", "</br>");
						}
						
						isDeliveryModes = true;
						delivery.isPriorityDelivery = true;
					}
				}
			}
		}
		
		if(siteCode === 'in' || (siteCode === 'id' && pdProductType === 'PHONE') || (siteCode === 'us' && deliveryYN ) ){
			delivery.hasComponent = true;
			delivery.headline = Granite.I18n.get('Delivery Detail');
			delivery.label = Granite.I18n.get('Enter Zipcode');
			delivery.cancelText = Granite.I18n.get('Delete');
			delivery.enterText = Granite.I18n.get('Search');
			
			/* id() , us  pincode 5  */
			if( siteCode === 'id' ){
				delivery.inputAttr.maxlength = '5';
			} else if( siteCode === 'us' ){
				delivery.inputAttr.maxlength = '5';
				
				if( pincodeCookie ){
					delivery.inputAttr.value = pincodeCookie;
					sharedObj.view.deliveryDraw(drawObj);
					util.deliveryGetApiData( sharedObj, selectorObj );
				}
				
			} else {
				delivery.inputAttr.maxlength = '6';
				if( deliveryTooltip !== '' ){
					delivery.priorityDeliveryText = deliveryTooltip;
				}
				if( deliveryTooltipMsg !== '' ){
					delivery.priorityDeliveryTooltip = deliveryTooltipMsg;
				}
			} 
			
			if( stockLevelStatus === 'NOORDER' || stockLevelStatus === 'OUTOFSTOCK' ){
				delivery.labelClass = 'text-field--disabled';
				delivery.ctaClass = 'cta--disabled';
				delivery.inputAttr.disabled = 'true';
			}
		}
	}
	
	function settingDelightDelivery( product, sharedObj, drawObj, selectorObj ){
		const siteCode = sharedObj.siteCode;
		
		if( siteCode === 'in' && product.flags.online_to_offline === true ){
			const offerView = drawObj.offer;
			const util = sharedObj.util;
			const pcImg = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/product-offer-delight-delivery.jpg';
			const imgAlt = 'delight delivery';
			
			const imgAttr = {
				'srcPc' : pcImg,
				'alt' : imgAlt
			}

			let learnMoreCta = {};
			let mainDec = [];
			
			mainDec.push( { 'text' : Granite.I18n.get('1. Free express delivery from your local Samsung plaza') } )
			mainDec.push( { 'text' : Granite.I18n.get('2. Delivery by appointment') })
			mainDec.push( { 'text' : Granite.I18n.get('3. Hassle free installation') })
			
			const learnMoreUrl = '/' + siteCode + '/smart-utsav-delight-delivery/O2O/terms/';
			
			learnMoreCta = util.getAttrCta( Granite.I18n.get('Learn more'), learnMoreUrl, '_self', '', {}, '' );
			
	
			const thisTotalItem = {
				'title' : 'delightDelivery',
				'hasItem' : true,
				'item' : {
					'headline' : Granite.I18n.get('Delight delivery'),
					'description' : {
						'hasDescription' : true,
						'main' : mainDec,
					},
					'learnMoreCta' : learnMoreCta,
					'imgAttr' : imgAttr
				}
			}
			offerView.delightDelivery = thisTotalItem;
		}
	}
	
	// productsData.promotions      1 Syndi 
	function settingPromotions( product, sharedObj, drawObj, selectorObj ){
		const expanded = sharedObj.syndiApiData.expanded;
		
		if( product.promotions && product.promotions.length > 0 ){
			const promotionListData = product.promotions;
			const checkingOfferId = {};
			
			// promotionType   
			for(var idx=0; idx<promotionListData.length; idx++){
				const promotionData = expanded.promotions[promotionListData[idx]];
				const promotionType = promotionData.type ? promotionData.type.toUpperCase() : '';
				const offerdata = expanded.offers[promotionData.offer_id];
				const promotionOfferType = offerdata && offerdata.type ? offerdata.type.toUpperCase() : '';
				const promotionTradeInType = promotionData.trade_in_type ? promotionData.trade_in_type.toUpperCase() : '';
				const promotionSalesPitch = promotionData.sales_pitch.length > 0 ? promotionData.sales_pitch[0] : '';
				if( promotionType ){
					if( promotionType === 'CONFIGURATOROFFER' && promotionOfferType === 'TRADEIN' ){
						sharedObj.tradeInType = promotionTradeInType;
						if(promotionSalesPitch && /^[0-9\\.]*$/.test(promotionSalesPitch.trim())){ // salesPitch    
							sharedObj.promotionSalesPitch = promotionSalesPitch;
						}
						settingTradeInData ( offerdata, sharedObj, drawObj, selectorObj ); // tradeIn 
					}else if( promotionType === 'CONFIGURATORUPGRADE' ){
						settingUpgradeData ( promotionData, sharedObj, drawObj, selectorObj, product ); // upgrade 
					}else if(promotionType === 'CONFIGURATORADDONSAMSUNGCARE'){
						settingAddOnCareData ( promotionData, sharedObj, drawObj, selectorObj ); // Care 
					}else if(promotionType === 'CONFIGURATORADDON'){
						settingAddOnData ( promotionData, sharedObj, drawObj, selectorObj, idx ); // Add On 
					}else if(promotionType === 'CONFIGURATOROFFER' && promotionOfferType === 'COMBO'){
						//  
						if( !checkingOfferId[promotionData.offer_id] ){
							settingOfferComboData ( promotionData, sharedObj, drawObj, selectorObj, offerdata ); // Offer Combo 
							checkingOfferId[promotionData.offer_id] = promotionData.offer_id;
						}
					}else if(promotionType === 'CONFIGURATOROFFER' && promotionOfferType === 'BOGO'){
						if( !checkingOfferId[promotionData.offer_id] ){
							settingOfferBogoData ( promotionData, sharedObj, drawObj, selectorObj, offerdata ); // Offer bogo 
							checkingOfferId[promotionData.offer_id] = promotionData.offer_id;
						}
					}else if(promotionType === 'PRODUCTDETAILSPROMOMESSAGE'){
						settingPomoMessageData ( promotionData, sharedObj, drawObj, selectorObj, idx ); // Offer    
					}else if(promotionType === 'PRODUCTDETAILSFINANCEPLANPROMO'){
						settingPomoFinanceData ( promotionData, sharedObj, drawObj, selectorObj, idx ); //Offer   Financial  
					}else if(promotionType === 'PRODUCTDETAILSSMARTCLUBPROMO'){
						settingPomoSmartClubData ( promotionData, sharedObj, drawObj, selectorObj, idx ); //Offer   SmartClub  
					}else if(promotionType === 'PRODUCTDETAILSSAMSUNGFINANCEPLANPROMO'){
						settingSamsungPomoFinanceData ( promotionData, sharedObj, drawObj, selectorObj, idx );
					}else if(promotionType === 'CONFIGURATORBUYBACK'){
						settingGalaxyForeverData ( promotionData, product, sharedObj, selectorObj );
					}else if(promotionType === 'CONFIGURATORADDONVOUCHER'){
						settingVoucherData ( promotionData, product, sharedObj, selectorObj );
						settingAddOnData ( promotionData, sharedObj, drawObj, selectorObj, idx ); // Add On 
					}else if (promotionType === 'CONFIGURATORASSUREDBUYBACK'){
						if( sharedObj.siteCode ==='in' ){
							settingAssuredBuyBackData ( promotionData, product, sharedObj, selectorObj );
						}
					}
				}
			}
			
			settingRecallSyndi( sharedObj, selectorObj, drawObj ); //   
		}
	}
	
	/**
	 *   Offer + Tradein   tradeinText 
	 */
	function settingTradeInData ( offerdata, sharedObj, drawObj, selectorObj ){
		
		const siteCode = sharedObj.siteCode;
		const util = sharedObj.util;
		let tradeinText = '';
		
		sharedObj.tradeInFlag = true;
		
		if( util.isNotEmptyArray(offerdata.formatted_sales_pitch) ){
			const offerSalesPitch= offerdata.sales_pitch;
			if( offerSalesPitch.length > 0 ){
				tradeinText = offerSalesPitch[0];
			}
			
			if(siteCode === 'pl'){
				//p em  
				tradeinText = tradeinText.replace(/<(\/p|p)([^>]*)>/gi,'').replace(/<(\/em|em)([^>]*)>/gi,'');
			}
		}else{
			
			if(siteCode === 'in'){
				tradeinText = Granite.I18n.get('Buy with exchange');
			}else if(siteCode === 'ae' || siteCode === 'ae_ar'){
				tradeinText = Granite.I18n.get('Generate Trade in code');
			}else{
				tradeinText = Granite.I18n.get('Trade in your old device');
			}
		}
		
		if( offerdata.discount_description && offerdata.discount_description.length > 0 ){
			let max = 0; 
			for( var indexT in offerdata.discount_description ){
				const tradeInItem = offerdata.discount_description[indexT];
				const tradeInType = tradeInItem.type;
				const tradeInValue = tradeInItem.value;
				if( tradeInType === 'Rebate' && tradeInValue ){
					max = Math.max( max, tradeInValue );
				}
			}
			
			sharedObj.tradeinSaveValue = max;
		}
		
		sharedObj.tradeinText = tradeinText;
	}
	
	/**
	 *    upgrade  
	 * upgradeEligible flag, upgradeFlag   childCheckLis 
	 */
	function settingUpgradeData( promotionData, sharedObj, drawObj, selectorObj, productsData ){
		let childCheckList = sharedObj.childCheckList; 
		let eupData = sharedObj.eupData;
		const pdUpgradeUseYn = sharedObj.pdUpgradeUseYn;
		const util = sharedObj.util;
		
		sharedObj.upgradeEligible = true;
		
		if( pdUpgradeUseYn === 'Y'){
			var upgradeInfo = promotionData.discount_description;
			if( upgradeInfo !== null && upgradeInfo.length > 0 ){
				for(var jdx=0; jdx< upgradeInfo.length; jdx++){
					for(var kdx=0; kdx<upgradeInfo[jdx].discounted_skus.length; kdx++){
						const skuData = upgradeInfo[jdx].discounted_skus[kdx];
						const sku = skuData.sku;
						util.merge( sharedObj.totalSkuList, sku, skuData );
						
						childCheckList.push(sku);
						sharedObj.upgradeFlag = true;
						eupData.displayName = productsData.product_display_name;
						eupData.sku = sku;
						eupData.salePrice = productsData.price_info ? productsData.price_info[jdx].sale_price.value : '';
					}
				}
				
			}
		}
	}
	
	/**
	 *   Add on Samsungcare  samsungCareList reCallSyndi 
	 */
	function settingAddOnCareData ( promotionData, sharedObj, drawObj, selectorObj ){
		
		const pdProductTypeCheckYn = sharedObj.pdProductTypeCheckYn;
		const samsungCareBadgeList = sharedObj.samsungCareBadgeList;
		const samsungCareList = sharedObj.samsungCareList;
		const reCallSyndi = sharedObj.reCallSyndi;
		const multiCareYn = sharedObj.multiCareYn;
		const util = sharedObj.util;
		
		if( pdProductTypeCheckYn !== 'Y' ){
			var careInfo = promotionData.discount_description;
			if(careInfo !== null && careInfo.length > 0){
				for(var jdx=0; jdx<careInfo.length; jdx++){
					for(var kdx=0; kdx<careInfo[jdx].discounted_skus.length; kdx++){
						let tempCareInfo = {};
						const infoItem = careInfo[jdx].discounted_skus[kdx];
						const sku = infoItem.sku;
						util.merge( sharedObj.totalSkuList, sku, infoItem );
						
						tempCareInfo.discounted_sku = sku;
						samsungCareList.push(tempCareInfo);
						sharedObj.samsungCareFlag = true;

						// reCallSyndi call  care     
						if( multiCareYn === 'Y' ){
							reCallSyndi.push({ 'sku' : sku });
						}
					}
				}
			}
			if( sharedObj.samsungCareFlag ) {
				if( promotionData.formatted_sales_pitch && promotionData.formatted_sales_pitch.length > 0 ){
					sharedObj.samsungCareSubText = promotionData.formatted_sales_pitch;
				}
			}
			for(let i in promotionData.product_tag_order) {
				samsungCareBadgeList.push(promotionData.product_tag_order[i]);
			}
			samsungCareBadgeList.sort((a,b) => a.product_rank - b.product_rank);
		}
	}
	
	/**
	 *   Add On   API discounted_skus   (offer_type,addonDate )   reCallSyndi 
	 */
	function settingAddOnData ( promotionData, sharedObj, drawObj, selectorObj, idx ){
		
		const pdTimeformatFront = sharedObj.pdTimeformatFront;
		const pdProductTypeCheckYn = sharedObj.pdProductTypeCheckYn;
		const util = sharedObj.util;
		const producttagorder = promotionData.product_tag_order;
		let addOnInfoTemp = sharedObj.addOnInfoTemp;
		let reCallSyndi = sharedObj.reCallSyndi;
		let addonDate = '';
		
		if( promotionData.start_date && promotionData.end_date ){
			if(pdTimeformatFront !== ''){
				addonDate = dateFormat(promotionData.start_date.split('T')[0], pdTimeformatFront) + ' ~ ' + dateFormat(promotionData.end_date.split('T')[0], pdTimeformatFront);
			}else{
				addonDate = promotionData.start_date.split('T')[0] + ' ~ ' + promotionData.end_date.split('T')[0];
			}
		}
		
		sharedObj.addonDate = addonDate;
		
		var careInfo = promotionData.discount_description;
		
		if(careInfo !== null && careInfo.length > 0){
			for(var jdx=0; jdx<careInfo.length; jdx++){
				const discountDecLoop = careInfo[jdx];
				
				for(var kdx=0; kdx<discountDecLoop.discounted_skus.length; kdx++){
					let tempCareInfo = {};
					let discountedSku = discountDecLoop.discounted_skus[kdx];
					let isGift = false;
					const sku = discountedSku.sku;
					tempCareInfo.discounted_sku = sku;
					
					if( sharedObj.hasVoucher ){
						discountedSku.offer_type = 'CONFIGURATORADDONVOUCHER';
					}else{
					discountedSku.offer_type = 'CONFIGURATORADDON';
					}
					discountedSku.addonDate = addonDate;
					discountedSku.product_formatted_sales_pitch = promotionData.formatted_sales_pitch;
					
					
					util.merge( sharedObj.totalSkuList, sku, discountedSku );
					
					if( !sharedObj.hasVoucher ){
						if( producttagorder && producttagorder[sku] && producttagorder[sku].product_tags && producttagorder[sku].product_tags.length > 0 ){
							for( var ldx=0; ldx<producttagorder[sku].product_tags.length; ldx++ ){
								if( producttagorder[sku].product_tags[ldx].toUpperCase() === 'GIFT' ){
									sharedObj.giftDrawData.date = addonDate;
									sharedObj.giftDrawData.dec = promotionData.formatted_sales_pitch;
									if( !promotionData.formatted_sales_pitch && promotionData.sales_pitch ){
										sharedObj.giftDrawData.dec = promotionData.sales_pitch;
									}
									
									sharedObj.addOnGift.products.push(tempCareInfo);
									sharedObj.giftFlag = true;
									isGift = true;
								}
							}
						}
					}
					
					if(pdProductTypeCheckYn !== 'Y'){
						// Y      Addon  >> AddOn Api   
						if( !isGift ){
							if( !sharedObj.addOnInfoTempCache[tempCareInfo.discounted_sku] ){
								addOnInfoTemp.push(tempCareInfo);
								sharedObj.addOnInfoTempCache[tempCareInfo.discounted_sku] = tempCareInfo.discounted_sku;
							}
							
							sharedObj.addonsFlag = true;
						}
					}else{
						//gift  addOn 
						if( !isGift ){
							//   addon, care, warrnaty  
							reCallSyndi.push(discountedSku);
						}
					}
				}
			}
		}
	}
	
	/**
	 *   Offer Combo   (msrp_price,sale_price,formatted_value,offer_type,sales_pitch,type)   reCallSyndi  
	 */
	function settingOfferComboData ( promotionData, sharedObj, drawObj, selectorObj, offerdata ) {
		const pdTimeformatFront = sharedObj.pdTimeformatFront;
		const siteCode = sharedObj.siteCode;
		const reCallSyndi = sharedObj.reCallSyndi;
		const setComboPopupData = sharedObj.setComboPopupData;
		const util = sharedObj.util;
		const priceCurrency = sharedObj.priceCurrency;
		
		let offerCombo = {};
		let iconImgName = promotionData.images && promotionData.images.length > 0 ? promotionData.images[0] : null;
		
		offerCombo.comboInfo = [];
		offerCombo.iconImgName = iconImgName;
		if( promotionData.start_date && promotionData.end_date ){
			if( pdTimeformatFront ){
				offerCombo.comboDate = dateFormat(promotionData.start_date.split('T')[0], pdTimeformatFront) + ' ~ ' + dateFormat(promotionData.end_date.split('T')[0], pdTimeformatFront);
			}else{
				offerCombo.comboDate = promotionData.start_date.split('T')[0] + ' ~ ' + promotionData.end_date.split('T')[0];
			}
		}
		
		if( promotionData.formatted_sales_pitch ){
			offerCombo.comboPitch = promotionData.formatted_sales_pitch;
		}

		if( offerdata.discount_description && offerdata.discount_description.length > 0){
			const offerExpanded = offerdata.expanded; 
				
			for( var kdx in offerdata.discount_description ){
				const offerDiscount = offerdata.discount_description[kdx];
				if( offerDiscount.skus && offerDiscount.skus.length > 0 ){
					
					const skuList = offerDiscount.skus;
					
					for(var jdx=0; jdx<skuList.length; jdx++){
						
						let priceObj = {};
						priceObj.sku = skuList[jdx];
						
						if( offerExpanded && offerExpanded.discounted_skus && offerExpanded.discounted_skus[skuList[jdx]] ){
							const expandedpricedata = offerExpanded.discounted_skus[skuList[jdx]];
							
							let pricedata=0;
							if( expandedpricedata.msrp_price ){
								priceObj.msrp_price = expandedpricedata.msrp_price;
								pricedata =expandedpricedata.msrp_price.value;
							}else{
								priceObj.msrp_price = {};
							}
							if( expandedpricedata.sale_price ){
								priceObj.sale_price = expandedpricedata.sale_price;
							}else{
								priceObj.sale_price = {};
							}
							if( offerDiscount.type.toLowerCase() === 'percentage' ) {
								priceObj.formatted_value = offerDiscount.value + '%';
							} else {
								priceObj.formatted_value = currencyComma(offerDiscount.value, priceCurrency);
							}
							
							
							//20200401
							if(siteCode === 'fr' && offerDiscount.value && ("rebate".indexOf(offerDiscount.type.toLowerCase()) > -1) ){
								if( Number(pricedata) - Number(offerDiscount.value) <= 0 ){
									priceObj.formatted_value = "0";
								}
							}
							
							priceObj.type = offerDiscount.type;
							priceObj.offer_type = offerdata.type = 'COMBO';
							priceObj.sales_pitch = offerdata.sales_pitch && offerdata.sales_pitch.length > 0 ? offerdata.sales_pitch[0] : '';
							
							offerCombo.comboInfo.push(priceObj);
							reCallSyndi.push(priceObj);
							sharedObj.comboFlag = true;
							
							util.merge( sharedObj.totalSkuList, priceObj.sku, priceObj );
						}
					}
				}
			}
			setComboPopupData.push(offerCombo);
		}
	}
	
	/**
	 *   Offer Bogo   ( date,sales_pitch,offer_type )    bogoModelList , reCallSyndi 
	 */
	function settingOfferBogoData ( promotionData, sharedObj, drawObj, selectorObj, offerdata ) {
		const pdBogoUseYn = sharedObj.pdBogoUseYn;
		const pdTimeformatFront = sharedObj.pdTimeformatFront;
		const reCallSyndi = sharedObj.reCallSyndi;
		const bogoModelList = sharedObj.bogoModelList;
		const pdSoftBundleUseYn = sharedObj.pdSoftBundleUseYn;
		const util = sharedObj.util;
		
		let bogoPromotionMsg = '';
		let bogoDate = '';
		
		if( pdBogoUseYn !== 'N' ){
			if( promotionData.start_date && promotionData.end_date ){
				if( pdTimeformatFront ){
					bogoDate = dateFormat(promotionData.start_date.split('T')[0], pdTimeformatFront) + ' ~ ' + dateFormat(promotionData.end_date.split('T')[0], pdTimeformatFront);
				}else{
					bogoDate = promotionData.start_date.split('T')[0] + ' ~ ' + promotionData.end_date.split('T')[0];
				}
			}
			if( promotionData.sales_pitch ){
				bogoPromotionMsg = promotionData.sales_pitch[0];
			}
			
			if( offerdata.discount_description && offerdata.discount_description.length > 0){
				
				for( var kdx in offerdata.discount_description ){
					if( offerdata.discount_description[kdx].skus && offerdata.discount_description[kdx].skus.length > 0 ){
						var skuList = offerdata.discount_description[kdx].skus;
						for(var jdx=0; jdx<skuList.length; jdx++){
							
							let skuItem = {}; 
							skuItem.sku = skuList[jdx];
							skuItem.bogo_date = bogoDate;
							skuItem.bogo_sales_pitch = bogoPromotionMsg;
							
							if(pdSoftBundleUseYn === 'Y'){
								skuItem.offer_type_b = 'BOGO';
								reCallSyndi.push(skuItem);
							}else{
								bogoModelList.push(skuItem);
							}
							
							util.merge( sharedObj.totalSkuList, skuItem.sku, skuItem );
							sharedObj.bogoFlag = true;
						}
					}
				}
			}
		}
	}
	
	/**
	 *   Promotion Message  Offer   
	 */
	function settingPomoMessageData ( promotionData, sharedObj, drawObj, selectorObj, idx ) {
		
		const offerView = drawObj.offer;
		const iconAlt = promotionData.sales_pitch && promotionData.sales_pitch.length > 0 ? promotionData.sales_pitch[0] : '';
		const iconData = getIconName( promotionData, sharedObj );
		const promoIconFlag = iconData.promoIconFlag;
		const iconImgName = iconData.iconImgName;
		
		let contentWrapperClass = 'offer-promotion promotion-index-'+idx;
		let promotionMessage = [];
		let imgSrc = null;
		let rowText = [];
		let rowTextContent = '';
		
		if(promotionData.formatted_sales_pitch !== null && promotionData.formatted_sales_pitch.length > 0){
			promotionMessage = promotionData.formatted_sales_pitch;
		}else if(promotionData.sales_pitch !== null && promotionData.sales_pitch.length > 0){
			promotionMessage = promotionData.sales_pitch;
		}
		
		if( promoIconFlag ){
			imgSrc = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/promotion_icon/'+ iconImgName +'.svg';
		}
		
		for(var jdx=0; jdx<promotionMessage.length; jdx++){
			rowTextContent += promotionMessage[jdx].replace('<a', '<a target=\'_blank\'');
		}
		
		rowText.push({ 'target' : '.'+ contentWrapperClass.replace(' ','.') + ' .pd-offer__desc', 'text' : rowTextContent});
		
		offerView.promotionMessage.push({
			'title' : 'promoMessage',
			'hasItem' : true,
			'item' : {
				'contentWrapperClass' : contentWrapperClass,
				'isIcon' : true,
				'iconAttr' : {
					'src' : imgSrc,
					'alt' : iconAlt
				},
				'description' : {
					'hasDescription' : true
				},
				'rowText' : rowText
			}
		});
	}
	
	/**
	 *   Samsung Finance Plan Promo  Offer   ( SF+ Banner )
	 */
	function settingSamsungPomoFinanceData ( promotionData, sharedObj, drawObj, selectorObj, idx ){
		const siteCode = sharedObj.siteCode;
		let financeplusUrl = sharedObj.financeplusUrl + "?family_id=" + sharedObj.familyCode + "&sku=" + sharedObj.shopSkuCode;
		let target = null;
		if( siteCode === 'in' ){
			financeplusUrl = 'https://www.samsung.com/in/offer/online/finance-plus/';
			target = 'blank';
		}
		
		let promotionMessage = '';
		let description = null;
		sharedObj.financingEligible = true;
		
		if( promotionData.formatted_sales_pitch !== null && promotionData.formatted_sales_pitch.length > 0 ){
			promotionMessage = promotionData.formatted_sales_pitch;
			
		}else if(promotionData.sales_pitch !== null && promotionData.sales_pitch.length > 0){
			promotionMessage = promotionData.sales_pitch;
		}
		
		for(var jdx=0; jdx<promotionMessage.length; jdx++){
			description = promotionMessage[jdx].replace('<u>','').replace('</u>','');
		}
		
		drawObj.offerFinance = {
			'title' : Granite.I18n.get('Samsung Finance+'),
			'hasComponent' : true,
			'description' : description,
			'learnMoreCta' : {
				'class' : null,
				'title' : null,
				'href' : financeplusUrl,
				'target' : target,
				'text' : Granite.I18n.get("Learn more")
			}
		};
		
	}
	
	/**
	 *   Finance Plan Promo  Offer   
	 */
	function settingPomoFinanceData ( promotionData, sharedObj, drawObj, selectorObj, idx ){
		const siteCode = sharedObj.siteCode;
		const offerView = drawObj.offer;
		const iconAlt = promotionData.sales_pitch && promotionData.sales_pitch.length > 0 ? promotionData.sales_pitch[0] : '';
		const emiCalculatorUrl = promotionData.emi_calculator_url ? promotionData.emi_calculator_url : sharedObj.financingUrl;
		const iconData = getIconName( promotionData, sharedObj );
		const promoIconFlag = iconData.promoIconFlag;
		const iconImgName = iconData.iconImgName;
		
		let contentWrapperClass = 'offer-emi emi-index-'+idx;
		let emiMessage = '';
		let imgSrc = '';
		let rowText = [];
		let rowTextContent = '';
		
		sharedObj.financingEligible = true;
		
		if( emiCalculatorUrl ){
			sharedObj.emiCalculatorUrl = emiCalculatorUrl;
		}
		
		if( promotionData.formatted_sales_pitch && promotionData.formatted_sales_pitch.length > 0 ){
			emiMessage = promotionData.formatted_sales_pitch;
		}else if(promotionData.sales_pitch && promotionData.sales_pitch.length > 0){
			emiMessage = promotionData.sales_pitch;
		}
		
		if( emiMessage ){
			
			if( promoIconFlag ){
				imgSrc = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/promotion_icon/'+ iconImgName +'.svg';
				rowTextContent +='<div class="pd-offer__image-icon">';
				rowTextContent +=	'<div class="image">';
				rowTextContent +=		'<img class="image__preview lazy-load" data-src="'+imgSrc+'?$LazyLoad_Home_PNG$" alt="'+iconAlt+'">';
				rowTextContent +=		'<img class="image__main lazy-load" data-src="'+imgSrc+'?$48_48_PNG$" alt="'+iconAlt+'">';
				rowTextContent +=	'</div>';
				rowTextContent +='</div>';
			}
			rowTextContent += '<div class="pd-offer-desc">';
			rowTextContent += 	'<div class="pd-offer__cta">';
			/* EMI Type */
			if( siteCode === 'in' || siteCode === 'uk' || siteCode === 'lt' || siteCode === 'id' ){
				sharedObj.promotionFinancingFlag = true;
				for( var jdx=0; jdx < emiMessage.length; jdx++ ){
					let emiText = emiMessage[jdx].replace('<u>','').replace('</u>','');
					if( emiText.indexOf('<a') < 0 ){
						if( siteCode === 'in' ){
							rowTextContent += '<strong class="pd-offer__title-text">';
							rowTextContent += emiText +' <br/> EMI also available on Debit cards <br/> ';
							rowTextContent += '<a class="cta cta--underline cta--black add-special-tagging" href="javascript:void(0);" data-target-popup="eipPopup" aria-haspopup="dialog" role="button"'+
									'an-tr="header(pim)_offer option-'+sharedObj.pageTrackPd+'-cta-title"'+
									'an-ca="option click"'+
									'an-ac="pd buying tool"'+
									'an-la="offer:'+emiText.toLowerCase()+':learn more">' + Granite.I18n.get('Learn more') + '</a>';
							rowTextContent += '</strong>';
						} else {
							rowTextContent += '<a class="cta cta--underline cta--black add-special-tagging" href="javascript:void(0);" data-target-popup="eipPopup" aria-haspopup="dialog" role="button"'+
							'an-tr="header(pim)_offer option-'+sharedObj.pageTrackPd+'-cta-title"'+
							'an-ca="option click"'+
							'an-ac="pd buying tool"'+
							'an-la="offer:'+emiText.toLowerCase()+':learn more">' + emiText + '</a>';
						}
					}
				}
			} else if( siteCode === 'ee' || siteCode === 'lv' ){
				sharedObj.promotionFinancingFlag = true;
				for( var emiIndex=0; emiIndex < emiMessage.length; emiIndex++ ){
					let emiText = emiMessage[emiIndex].replace('<u>','').replace('</u>','');
					if( emiText.indexOf('<a') < 0 ){
						rowTextContent += '<a class="cta cta--underline cta--black add-special-tagging" href="javascript:void(0);" data-target-popup="eipEEPopup" aria-haspopup="dialog" role="button"'+
						'id="fiance-ee-'+idx+'"'+
						'an-tr="header(pim)_offer option-'+sharedObj.pageTrackPd+'-cta-title"'+
						'an-ca="option click"'+
						'an-ac="pd buying tool"'+
						'an-la="offer:'+emiText.toLowerCase()+':learn more">' + emiText + '</a>';
					}
				}
			} else {
				rowTextContent += '<strong class="pd-offer__title-text">';
				for(var mIndex=0; mIndex<emiMessage.length; mIndex++){
					rowTextContent += emiMessage[mIndex];
				}
				rowTextContent += '</strong>';
			}
			rowTextContent += 	'</div>';
			rowTextContent += '</div>';
			rowText.push({ 'target' : '.'+ contentWrapperClass.replace(' ','.'), 'text' : rowTextContent});
			
			offerView.promotionFinance.push({
				'title' : 'finance',
				'hasItem' : true,
				'item' : {
					'contentWrapperClass' : contentWrapperClass,
					'iconAttr' : {
						'src' : imgSrc,
						'alt' : iconAlt
					},
					'description' : {
						'hasDescription' : true
					},
					'rowText' : rowText
				}
			});
		}
	}
	
	/**
	 *   ProductDetailsSmartClubPromo  Offer   
	 */
	function settingPomoSmartClubData ( promotionData, sharedObj, drawObj, selectorObj, idx ){
		const siteCode = sharedObj.siteCode;
		const offerView = drawObj.offer;
		const iconAlt = promotionData.sales_pitch && promotionData.sales_pitch.length > 0 ? promotionData.sales_pitch[0] : '';
		//const emiCalculatorUrl = promotionData.emi_calculator_url ? promotionData.emi_calculator_url : sharedObj.financingUrl;
		const iconData = getIconName( promotionData, sharedObj );
		const promoIconFlag = iconData.promoIconFlag;
		let iconImgName = iconData.iconImgName;
		
		let contentWrapperClass = 'offer-smart-club smart-club-index-'+idx;
		let smartClubMessage = '';
		let imgSrc = '';
		let rowText = [];
		let rowTextContent = '';
		
		///sharedObj.financingEligible = true;
		
		///if( emiCalculatorUrl ){
		///	sharedObj.emiCalculatorUrl = emiCalculatorUrl;
		///}
		
		if( promotionData.formatted_sales_pitch && promotionData.formatted_sales_pitch.length > 0 ){
			smartClubMessage = promotionData.formatted_sales_pitch;
		}else if(promotionData.sales_pitch && promotionData.sales_pitch.length > 0){
			// formatted_sales_pitch  
			///////smartClubMessage = promotionData.sales_pitch;
		}
		
		///////iconImgName = 'smart_club_logo';  //pre-qa      BC     
		
		if( smartClubMessage ){
			
			//if( promoIconFlag ){
				imgSrc = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/promotion_icon/'+ iconImgName +'.svg';
				rowTextContent +='<div class="pd-offer__image-icon">';
				rowTextContent +=	'<div class="image">';
				rowTextContent +=		'<img class="image__preview lazy-load" data-src="'+imgSrc+'?$LazyLoad_Home_PNG$" alt="'+iconAlt+'">';
				rowTextContent +=		'<img class="image__main lazy-load" data-src="'+imgSrc+'?$48_48_PNG$" alt="'+iconAlt+'">';
				rowTextContent +=	'</div>';
				rowTextContent +='</div>';
			//}
			rowTextContent += '<div class="pd-offer-desc"><div>';
			rowTextContent += '		<h3><strong>Smart Club</strong></h3>';  // GPv2   i18n 
			rowTextContent += 	'<p>';
			
 
				///sharedObj.promotionFinancingFlag = true;
				for( var jdx=0; jdx < smartClubMessage.length; jdx++ ){
					let emiText = smartClubMessage[jdx].replace('<u>','').replace('</u>','');
					if( emiText.indexOf('<a') < 0 ){
						if( siteCode === 'in' ){
 							rowTextContent += smartClubMessage +'';
						} 
					}
				}
	 
			rowTextContent += 	'</p>';
			rowTextContent += '</div>';
			rowText.push({ 'target' : '.'+ contentWrapperClass.replace(' ','.'), 'text' : rowTextContent});
			
			offerView.promotionSmartclub.push({
				'title' : 'smartclub',
				'hasItem' : true,
				'item' : {
					'contentWrapperClass' : contentWrapperClass,
					'iconAttr' : {
						'src' : imgSrc,
						'alt' : iconAlt
					},
					'description' : {
						'hasDescription' : true
					},
					'rowText' : rowText
				}
			});
		}
	}
	
	/**
	 *    return
	 */
	function getIconName( promotionData, sharedObj ){
		const promotionImgType = sharedObj.promotionImgType;
		const promotionImgTypeList = promotionImgType ? promotionImgType.split(',') : [];
		
		let promoIconFlag = false;
		let iconImgName = promotionData.images && promotionData.images.length > 0 ? promotionData.images[0] : '';
		
		if( promotionImgTypeList.length > 0){
			if( iconImgName ){
				for( var listIndex in promotionImgTypeList ){
					if( promotionImgTypeList[listIndex] === iconImgName ){
						promoIconFlag = true;
/*						if( iconImgName === 'cashback' ){
							iconImgName += '-bold';
						} else {
							iconImgName += '-regular';
						}
*/						break;
					}
				}
			}
		}
		
		return {
			'promoIconFlag' : promoIconFlag,
			'iconImgName' : iconImgName
		}
	}
	
	/**
	 * reCallSyndi  Sku  syndi API   .
	 */
	function settingRecallSyndi( sharedObj, selectorObj, drawObj ){
		const reCallSyndi = sharedObj.reCallSyndi;
		const productsData = sharedObj.syndiApiData.products;
		
		//    
		if(reCallSyndi.length > 0){
			const modelCodeList = [];
			for( var index = 0; index < reCallSyndi.length; index++ ) {
				const sku = reCallSyndi[index].sku;
				if( !productsData[sku] ){
					modelCodeList.push(sku);
				}
			}
			// modelCodeList          
			if( modelCodeList.length > 0 ){
				sharedObj.finishedSecondSyndi = false;
				syndicatedAjax( sharedObj, selectorObj, modelCodeList, recalSyndiCallback );
			} else {
				recalSyndiCallback( sharedObj, selectorObj, true )
			}
		} else {
			settingReData( sharedObj, selectorObj, drawObj );
		}
	}
	
	function recalSyndiCallback( sharedObj, selectorObj, callbackData ){
		const reCallSyndi = sharedObj.reCallSyndi;
		const util = sharedObj.util;
		const productsData = sharedObj.syndiApiData.products;
		const drawObj = sharedObj.drawObj;
		if( callbackData ){
			for( var kdx=0; kdx<reCallSyndi.length; kdx++ ){
				
				const syndiItem = reCallSyndi[kdx];
				const productItem = productsData[syndiItem.sku]
				
				if( productItem ){
					
					util.merge( sharedObj.totalSkuList, syndiItem.sku, productItem , 'syndi');
					
					checkingRecallComboBogo( sharedObj, selectorObj, syndiItem, reCallSyndi, productItem );
					checkingRecallAddOnList( sharedObj, selectorObj, syndiItem, reCallSyndi, productItem );
					checkingRecallForever( sharedObj, selectorObj, syndiItem, reCallSyndi, productItem );
					checkingRecallAssuredBuyBack( sharedObj, selectorObj, syndiItem, reCallSyndi, productItem );
				}
				
			}
		
			settingReData( sharedObj, selectorObj, drawObj );
		}
		
		sharedObj.finishedSecondSyndi = true;
		sharedObj.util.afterTotalAPI(sharedObj,selectorObj);
	}
	
	/**
	 * Trade In   in, id ,fr     api    .   popup api    Trade In . 
	 */
	function settingTradeInDraw( sharedObj, drawObj, selectorObj ) {
		const util = sharedObj.util;
		const tradeInFlag = sharedObj.tradeInFlag;
		let giveTradeInFlag = false;
		if( tradeInFlag ){
			//  
			if(siteCode === "in"){
				giveTradeInFlag = true;
			} else if(siteCode === "fr"){
				giveTradeInFlag = true;
			}
		}
		
		util.settingTradeInDraw( {}, sharedObj, selectorObj, giveTradeInFlag );
	}
	
	/**
	 * Upgrade   
	 */
	function settingUpgradeDraw( sharedObj, drawObj, selectorObj ) {
		const upgradeFlag = sharedObj.upgradeFlag;
		const pdUpgradeLearnMoreUrl = sharedObj.pdUpgradeLearnMoreUrl;
		const util  = sharedObj.util;
		const siteCode = sharedObj.siteCode;
		const pdProductType = sharedObj.pdProductType;
		
		let isEmbededType = false;
		let title = '';
		let description = '';
		let learnMoreTarget = '_self';
		let learnMoreText = '';
		let learnMoreHref = 'javascript:;';
		let learnMoreCta = {};
		let learnMoreClass = '';
		let customsObj = {};
		let yesAttr = {};
		let noAttr = {};
		let embedData = {};
		
		if ( upgradeFlag ){
			if(siteCode === 'uk'){
				if( pdUpgradeLearnMoreUrl ){
					learnMoreText = Granite.I18n.get('Learn more');
					learnMoreHref = pdUpgradeLearnMoreUrl;
					learnMoreTarget = '_blank';
				}
			}else if(siteCode === "de"){
				learnMoreText = Granite.I18n.get('Learn more');
				customsObj.layerTarget = 'upgradeLearnMorePopup';
			}
			
			title = Granite.I18n.get('Add Samsung Upgrade Program');
			if(siteCode === 'uk'){
				if(pdProductType !== 'PHONE'){
					description = Granite.I18n.get("Pay for your new TV in monthly installments and be invited to upgrade to the latest TV after months.");
				}else{
					description = Granite.I18n.get('Pay for your new smartphone in monthly instalments and be invited to upgrade to the new smartphone as soon as it launches.');
				}
			}else{
				description = Granite.I18n.get('Pay for your new Galaxy phone in monthly instalments and be invited to upgrade to the new Galaxy as soon as it launches.');
			}
			
			yesAttr = {
				'class' : 'cm-s-popup-opener',
				'text': Granite.I18n.get('YES'),
				'layerTarget' : 'upgradePopup'
			}
			noAttr = {
				'class' : 'cm-s-popup-opener',
				'text': Granite.I18n.get('NO'),
				'eventType' : 'eup',
				'modelCode' : 'upgrade',
				'modelName' : 'upgrade'
			}
			
		}
		
		learnMoreCta= util.getAttrCta ( learnMoreText, learnMoreHref, learnMoreTarget, learnMoreClass, customsObj, '' );
		drawObj.upgrade = {
			'hasComponent' : upgradeFlag,
			'isEmbededType' : isEmbededType,
			'isNotEmbededType' : !isEmbededType,
			'title' : title,
			'learnMoreCta' :  learnMoreCta,
			'description' : description,
			'yesAttr' : yesAttr,
			'noAttr' : noAttr,
			'embedData' : embedData
		}
	}
	
	/**
	 * Samsung Care  >>  + front   
	 */
	function settingAddOnCareDraw ( sharedObj,selectorObj, drawObj ){
		
		const samsungCareFlag = sharedObj.samsungCareFlag;
		const pdProductTypeCheckYn =sharedObj.pdProductTypeCheckYn;
		const pdSmcType =sharedObj.pdSmcType;
		const util  = sharedObj.util;
		const view = sharedObj.view;
		const careLearnMoreUrl = sharedObj.careLearnMoreUrl;
		const tempSamsungCareSubText = sharedObj.samsungCareSubText;
		
		let description = '';
		let learnMoreTarget = '_self';
		let learnMoreText = '';
		let learnMoreHref = 'javascript:;';
		let learnMoreCta = {};
		let learnMoreClass = '';
		let customsObj = {};
		let yesAttr = {};
		let noAttr = {};
		let eventType = 'care';
		let rowText = [];
		let title = '';
		
		let rowCareBodyText = '';
		
		if( tempSamsungCareSubText ){
			if(tempSamsungCareSubText.indexOf("</strong></p>") > -1) {
				rowCareBodyText = tempSamsungCareSubText.substring(tempSamsungCareSubText.indexOf("</strong></p>")+"</strong></p>".length, tempSamsungCareSubText.length);	//body  
			} else if(tempSamsungCareSubText.indexOf("</strong></h2>") > -1) {
				rowCareBodyText = tempSamsungCareSubText.substring(tempSamsungCareSubText.indexOf("</strong></h2>")+"</strong></h2>".length, tempSamsungCareSubText.length);	//body  
			} else if(tempSamsungCareSubText.indexOf("</strong></h3>") > -1) {
				rowCareBodyText = tempSamsungCareSubText.substring(tempSamsungCareSubText.indexOf("</strong></h3>")+"</strong></h3>".length, tempSamsungCareSubText.length);	//body  
			} else if(tempSamsungCareSubText.indexOf("</strong></h4>") > -1) {
				rowCareBodyText = tempSamsungCareSubText.substring(tempSamsungCareSubText.indexOf("</strong></h4>")+"</strong></h4>".length, tempSamsungCareSubText.length);	//body  
			} else if(tempSamsungCareSubText.indexOf("</strong></h5>") > -1) {
				rowCareBodyText = tempSamsungCareSubText.substring(tempSamsungCareSubText.indexOf("</strong></h5>")+"</strong></h5>".length, tempSamsungCareSubText.length);	//body  
			} else if(tempSamsungCareSubText.indexOf("</strong></h1>") > -1) {
				rowCareBodyText = tempSamsungCareSubText.substring(tempSamsungCareSubText.indexOf("</strong></h1>")+"</strong></h1>".length, tempSamsungCareSubText.length);	//body  
			}
		}
		
		if( samsungCareFlag ){
			if( pdSmcType === 'type2' ){
				 sharedObj.warrantyFlag = true;
			} else {
				title = Granite.I18n.get('Samsung Care+');
				
				if(siteCode !== 'fr'){
					if( careLearnMoreUrl ){
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreHref = careLearnMoreUrl;
						learnMoreTarget = '_blank';
					}
				}else{
					learnMoreText = Granite.I18n.get("Learn more");
					customsObj.layerTarget='hubbleCareinfoPopup';
				}
				
				if( sharedObj.samsungCareSubText ){
					description = "temp";
					if( siteCode === 'de' ){
						if( pdProductTypeCheckYn !== 'Y' ){
							rowText.push({'target' : '.pd-select-option__desc' , 'text' : sharedObj.samsungCareSubText });
						}else{
							rowText.push({'target' : '.pd-select-option__desc' , 'text' : rowCareBodyText });
						}
					}else if( siteCode === 'in' ){
						const inTempText = sharedObj.samsungCareSubText.toString().replace(/<(\/p|p)([^>]*)>/gi,"");
						rowText.push({'target' : '.pd-select-option__discount-text' , 'text' : inTempText });
					}else{
						const tempText = '<p>' + sharedObj.samsungCareSubText.toString().replace(/<(\/p|p)([^>]*)>/gi,"") + '</p>';
						rowText.push({'target' : '.pd-select-option__desc' , 'text' : tempText });
					}
				} else {
					description = Granite.I18n.get("Insurance that protects and cares for your phone wherever, whenever.");
				}
				
				yesAttr = {
					'text': Granite.I18n.get('YES'),
					'layerTarget' : 'hubbleCarePopup'
				}
				noAttr = {
					'text': Granite.I18n.get('NO'),
					'eventType' : eventType,
				}
				
				learnMoreCta= util.getAttrCta ( learnMoreText, learnMoreHref, learnMoreTarget, learnMoreClass, customsObj, '' );
				drawObj.care = {
					'hasComponent' : samsungCareFlag,
					'title' : title,
					'learnMoreCta' :  learnMoreCta,
					'description' : description,
					'yesAttr' : yesAttr,
					'noAttr' : noAttr,
					'subText': '',
					'rowText' : rowText,
					'itemSet' : []
				}
			}
		}
		
		view.productAddOnCare( drawObj );
	}
	
	/**
	 * Samsung Warranty  
	 */
	function settingAddOnWarrantyDraw ( sharedObj,selectorObj, drawObj ){
		const warrantyFlag = sharedObj.warrantyFlag;
		const pdProductType = sharedObj.pdProductType;
		const warrantyLearnMoreUrl = sharedObj.warrantyLearnMoreUrl;
		const util  = sharedObj.n = '';
		let learnMoreTarget = '_self';
		let learnMoreText = '';
		let learnMoreHref = 'javascript:;';
		let learnMoreCta = {};
		let learnMoreClass = '';
		let customsObj = {};
		let yesAttr = {};
		let noAttr = {};
		let eventType = 'warranty';
		
		if( warrantyFlag ){
			$(selectorObj.buyingToolOptWarranty.get(0)).addClass('has-component');
			
			if(warrantyLearnMoreUrl ){
				learnMoreText = Granite.I18n.get("Learn more");
				learnMoreHref = warrantyLearnMoreUrl;
				learnMoreTarget = '_blank';
			}
			
			if (siteCode === "de" && (pdProductType == "TV" || pdProductType == "ETC")){
				title = Granite.I18n.get('Garantieverlngerung');
				description = 'Verlngere die Standard-Herstellergarantie deines Samsung Gerts von 2 auf 5 Jahre';
			} else {
				description = Granite.I18n.get("With Extended Warranty, you can enjoy extra protection for your first 12 months. Be covered for unfortunate incidents that are not included in our standard 2 year warranty.");
				
			}
			
			yesAttr = {
				'class' : 'js-extended-layer cm-s-popup-opener is-async js-warranty-pop',
				'text': Granite.I18n.get('YES'),
				'layerTarget' : 'extendedWarrantyPopup'
			};
			
			noAttr = {
				'class' : 'cm-s-popup-opener',
				'text': Granite.I18n.get('NO'),
				'eventType' : eventType
			};
			
			learnMoreCta= util.getAttrCta ( learnMoreText, learnMoreHref, learnMoreTarget, learnMoreClass, customsObj, '' );
		}
		
		drawObj.warranty = {
			'hasComponent' : warrantyFlag,
			'title' : title,
			'learnMoreCta' :  learnMoreCta,
			'description' : description,
			'yesAttr' : yesAttr,
			'noAttr' : noAttr,
			'subText': ''
		}
		
		view.productAddOnWarranty( drawObj );
	}
	
	/**
	 *    
	 */
	function settingBaseData( products, sharedObj, drawObj, selectorObj ){
		const siteCode = sharedObj.siteCode;
		const proudctPriceInfo = sharedObj.proudctPriceInfo;
		const priceWrapper = drawObj.price.priceWrapper;
		const util = sharedObj.util;
		const priceCurrency = sharedObj.priceCurrency;
		
		let stockLevelStatus = '';
		let stockCustomMessage = '';
		
		//    
		if( products.inventory ){
			stockLevelStatus = products.inventory.status.toUpperCase();
			stockCustomMessage = products.inventory.custom_stock_message;
			
			sharedObj.stockLevelStatus = stockLevelStatus;
			sharedObj.apiChangeStockStatus = stockLevelStatus;
			sharedObj.stockCustomMessage = stockCustomMessage;
			drawObj.stockLevelStatus = stockLevelStatus;
			proudctPriceInfo.netavailable = products.inventory.net_available && Number(products.inventory.net_available) > 0 ? Number(products.inventory.net_available) : 1 ;
			
			//smb  min   .
			if( $('#isEppPage').val() === 'true' && selectorObj.buyingToolOptSMBQuantity.length > 0 && proudctPriceInfo.netavailable < proudctPriceInfo.smbMinQty ){
				stockLevelStatus = 'OUTOFSTOCK';
				sharedObj.stockLevelStatus = 'OUTOFSTOCK';
				drawObj.stockLevelStatus = 'OUTOFSTOCK';
			}
		}
		
		//      1   1   ecom_flag  false    . 
		if((siteCode === "pl" && stockLevelStatus === "OUTOFSTOCK") || stockLevelStatus === "NOORDER" || products.flags.ecom_flag !== true){
			util.disabledOptionElement(selectorObj.buyingToolOptTariff, sharedObj);
			util.disabledOptionElement(selectorObj.buyingToolOptUpgrade, sharedObj);
			util.disabledOptionElement(selectorObj.buyingToolOptOffer, sharedObj);
			util.disabledOptionElement(selectorObj.buyingToolOptTradeIn, sharedObj);
			sharedObj.accessoryDisabled = true;
			
			priceWrapper.hasPriceWrapper = false;
		} else {
			priceWrapper.hasPriceWrapper = true;
		}
		
		//     
		if( products.price_info && products.price_info.length > 0 ){
			if( products.flags.ecom_flag ) {
				sharedObj.hasPriceCta = true;
			}
			const priceInfoListData = products.price_info;
			const financeData = products.preferred_finance_plan;
			const categoryTypeCode = sharedObj.categoryTypeCode;
			
			for( var idx=0; idx<priceInfoListData.length; idx++ ){
				const priceItem = priceInfoListData[idx];
				let orignalPrice ='';
				let orignalPriceFormatted = '';
				let salePrice = '';
				let salePriceFormatted = '';
				let listPrice = '';
				let listPriceFormatted = '';
				let priceItemSalesPitch = '';
				
				if( priceItem.msrp_price ){
					orignalPrice = priceItem.msrp_price.value;
					orignalPriceFormatted = priceItem.msrp_price.formatted_value;
				}
				
				if( priceItem.list_price ){
					listPrice = priceItem.list_price.value;
					listPriceFormatted = priceItem.list_price.formatted_value;
				}
				
				/* sales    */
				if( !priceItem.sale_price ){
					salePrice = orignalPrice;
					salePriceFormatted = orignalPriceFormatted;
				} else {
					salePrice = priceItem.sale_price.value;
					salePriceFormatted = priceItem.sale_price.formatted_value;
				}
				
				if( priceItem.sales_pitch ){
					//TODO : 1) sales_pitch length 1    
					//       2) sales_pitch length 2 (2   )  
					//		 2-1)  [0] [1]     br   
					//	     2-2)  [0]     [0]  
					//		 2-3)  [1]     [1]  
					if(priceItem.sales_pitch.length == 1) {
						priceItemSalesPitch = priceItem.sales_pitch[0];
					} else if(priceItem.sales_pitch.length >= 2) {
						if(priceItem.sales_pitch[0] != '' && priceItem.sales_pitch[0] != null && priceItem.sales_pitch[0] != undefined && priceItem.sales_pitch[1] != '' && priceItem.sales_pitch[1] != null && priceItem.sales_pitch[1] != undefined  ) {
							priceItemSalesPitch = priceItem.sales_pitch[0] + '<br />' + priceItem.sales_pitch[1];
						} else if((priceItem.sales_pitch[0] != '' && priceItem.sales_pitch[0] != null && priceItem.sales_pitch[0] != undefined ) && (priceItem.sales_pitch[1] == '' || priceItem.sales_pitch[1] == null || priceItem.sales_pitch[1] == undefined)) {
							priceItemSalesPitch = priceItem.sales_pitch[0];
						} else if((priceItem.sales_pitch[1] != '' && priceItem.sales_pitch[1] != null && priceItem.sales_pitch[1] != undefined ) && (priceItem.sales_pitch[0] == '' || priceItem.sales_pitch[0] == null || priceItem.sales_pitch[0] == undefined)) {
							priceItemSalesPitch = priceItem.sales_pitch[1];
						}
					}
					
					//in pricebar sales_pitch(smart club) epp  
					const isInEPP = $('#isEppPage').val() === 'true' && sharedObj.siteCode==='in';
					if( !isInEPP ){
						proudctPriceInfo.salesPitch = priceItemSalesPitch;
					}
					
				}
				
				proudctPriceInfo.orignalPrice = orignalPrice;
				proudctPriceInfo.orignalPriceFormatted = orignalPriceFormatted;
				proudctPriceInfo.salePrice = salePrice;
				proudctPriceInfo.salePriceFormatted = salePriceFormatted;
				proudctPriceInfo.listPrice = listPrice;
				proudctPriceInfo.listPriceFormatted = listPriceFormatted;
			}
			// tvTypeCode    , fr      pf   
			// const isTvType = categoryTypeCode && categoryTypeCode.substring(0,2) ==='04';
			if ( financeData /*&& isTvType*/ && financeData.installment_amount && financeData.installment_amount !=='NaN' && financeData.tenure.unit ){
				proudctPriceInfo.monthlyPriceInfo.monthlyPrice = financeData.installment_amount;
				proudctPriceInfo.monthlyPriceInfo.tenureVal = financeData.tenure.unit;
			}
		}
		
		if( products.payment_methods ){
			sharedObj.paymentMethods = products.payment_methods;
		}
		
		if( products.flags && products.flags.ecom_flag ){
			sharedObj.proudctEcomFlag = products.flags.ecom_flag;
		}
	}
	
	/**
	 *  Between    
	 */
	function settingBetweenDraw( prouduct, sharedObj, drawObj, selectorObj ) {
		
		const siteCode = sharedObj.siteCode;
		const stockLevelStatus = sharedObj.stockLevelStatus;
		const proudctEcomFlag = sharedObj.proudctEcomFlag;
		
		//     
		if(!(siteCode === "pl" && stockLevelStatus === "OUTOFSTOCK") && stockLevelStatus !== "NOORDER" && proudctEcomFlag === true){
			if( prouduct.price_info !== null && prouduct.price_info.length > 0){
				const priceInfoListData = prouduct.price_info;
				
				for(var idx=0; idx < priceInfoListData.length; idx++){
					
					if(prouduct.flags.is_upgrade_eligible === true && priceInfoListData[idx].leasing_details ){
						let leasingDetails = priceInfoListData[idx].leasing_details;
						let leasingItem = null;
						
						for(var obj in leasingDetails){
							leasingItem = leasingDetails[obj];
						}
						
						if( leasingItem ){
							const tenureUnit = leasingItem.tenure.unit;
							const tenureValue = leasingItem.tenure.value;
							const monthlyRate = leasingItem.monthly_rate.value;
							const downPayment = leasingItem.down_payment.value;
							const pdUpgrade = sharedObj.pdUpgrade;
							
							let noText = '';
							
							if( pdUpgrade ){
								noText = Granite.I18n.get('Upgrade');
							} else {
								noText = Granite.I18n.get('Lease');
							}
							
							drawObj.between = {
								'hasComponent' : true,
								'purchase' : {
									'text' : Granite.I18n.get('Purchase')
								},
								'nonPurchase' : {
									'text' : noText,
									'dataLeaseing' : leasingItem.plan_id,
									'tenureUnit': tenureUnit,
									'tenureValue': tenureValue,
									'monthlyValue' : monthlyRate,
									'paymentValue' : downPayment
									
								}
							}
						}
					}
				}
			}
		}
	}
	
	function settingCtaData( sharedObj, selectorObj, accessoryList, ctaUrl, isDirect, isContinue ) {
		const util = sharedObj.util;
		const drawObj = sharedObj.drawObj;
		const siteCode = sharedObj.siteCode;
		
		const comboView = drawObj.offer.combo;
		const giftView = drawObj.offer.gift;
		const tariffOptionResultView = drawObj.tariffOptionResult;
		const careResultView = drawObj.careResult;
		const warrantyResultView = drawObj.warrantyResult;
		const upgradeResultView = drawObj.upgradeResult;
		const tradeInResultView = drawObj.tradeInResult;
		const betweenNonPurchaseView = drawObj.between.nonPurchase;
		const deliveryArea = selectorObj.buyingToolOptDelivery;
		const galaxyForeverResultView = sharedObj.drawObj.galaxyForeverResult;
		const assuredBuyBackResultView = sharedObj.drawObj.assuredBuyBackResult;
		
		const delPinCode = $(deliveryArea.find('#delivery-zipcode')).val();
		const hasTariffOptionResult = util.hasTariffOptionResult( sharedObj, selectorObj );
		const hasCareResult = util.hasCareResult( sharedObj, selectorObj );
		const hasWarrantyResult = util.hasWarrantyResult( sharedObj, selectorObj );
		const hasUpgradeResult = util.hasUpgradeResult( sharedObj, selectorObj );
		const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
		const hasBetween = util.hasBetweenResult( sharedObj, selectorObj );
		const hasCombo = util.hasComboResult( sharedObj, selectorObj );
		const hasForeverResult = util.hasForeverResult( sharedObj, selectorObj );
		const hasGiftResult = util.hasGiftResult( sharedObj, selectorObj );
		const hasAssuredBuyBackResultResult = util.hasAssuredBuyBackResultResult( sharedObj, selectorObj ); 
		
		const childModelList = {}; //   
		const childCheckList = sharedObj.childCheckList;
		const pdAppId = sharedObj.pdAppId;
		let cartModelCode = sharedObj.shopSkuCode;
		
		// Continue CTA   
		const cartParam = {
			'line_items' : []
		}; 
		const lineitemArray = {
			line_items : []
		};
		
		const consentsArray = {};
		const consentsaccept = {"is_accepted": true};
		
		let tariffLegal = '';
		let tradeInLegal = '';
		let cartQuoteLegal = '';
		let careLegal = '';
		let upgradeLegal = '';
		let pdUpgrade = '';
		let foreverLegal = '';
		let childListParam = '';
		let accessoryListParam = '';
		let careListParam = '';
		let upgradeListParam = '';
		let delPinCodeParam  ='';
		let leaseingParam  ='';
		let flushParam = '';
		let foreverParam = '';
		let assuredParam = '';

		let baseUrl = ctaUrl;
		
		if( $('#isEppPage').val() === 'true' && sharedObj.siteCode==='in' ){
			baseUrl = `${$('#storeWebDomain').val()}/in/web/store/${$('#eppCompanyCode').val()}/cart/`;
		}
		
		if( util.checkingDeliveryCode( sharedObj, selectorObj ) ){
			//   
			if( !isContinue ){
				lineitemArray.sku_id = cartModelCode;
				lineitemArray.quantity = "1";
				if( sharedObj.proudctPriceInfo.productCartCount && sharedObj.proudctPriceInfo.productCartCount > 1 ){
					lineitemArray.quantity = `${sharedObj.proudctPriceInfo.productCartCount}`;
				}
			}
			
			if( hasTariffOptionResult ) {
				const modelCode = tariffOptionResultView.dataModelCode;
				const simskuCode = tariffOptionResultView.dataSimskuCode;
				const dataId = tariffOptionResultView.dataId;
				if( util.isNotEmptyArray( dataId ) ){
					tariffLegal = "," + dataId.join('|');
					$.each( dataId, function( idIndex, tariffLegalInfo ) {
						consentsArray[tariffLegalInfo] = consentsaccept;
					});
				}
				if( modelCode ){
					childModelList[modelCode] = modelCode;
					lineitemArray.line_items.push({"sku_id" : modelCode, "quantity" : "1"});
				}
				if( simskuCode ){
					childModelList[simskuCode] = simskuCode;
					lineitemArray.line_items.push({"sku_id" : simskuCode, "quantity" : "1"});
				}
			}
			
			if( hasTradeInResult ){
				const dataId = tradeInResultView.dataId;
				const dataCartId = tradeInResultView.dataQuoteId;
				if(  util.isNotEmptyArray( dataId )  ){
					tradeInLegal = "," + dataId.join('|');
					$.each( dataId, function( idIndex, tradeLegalInfo) {
						consentsArray[tradeLegalInfo] = consentsaccept;
					});
				}
				
				if( dataCartId ){
					cartQuoteLegal = "&exchange_id=" + dataCartId;
				}
				
				lineitemArray.exchange_id = dataCartId;
			}
			
			if( hasCareResult ){
				const dataId = careResultView.dataId;
				const dataModelCode = careResultView.dataModelCode;
				const careConsentsArray = {};
				
				if(  util.isNotEmptyArray( dataId )  ){
					careLegal = "," + dataId.join('|');
					$.each( dataId, function( idIndex, careLegalInfo ) {
						careConsentsArray[careLegalInfo] = consentsaccept;
					});
				}
				if( dataModelCode ){
					careListParam = "&addChildItem[]=" + dataModelCode + ",1";
					lineitemArray.line_items.push({"sku_id" : dataModelCode, "quantity" : "1", "consents" : careConsentsArray});
				}
			}
			
			if( hasWarrantyResult ){
				const dataId = warrantyResultView.dataId;
				const dataModelCode = warrantyResultView.dataModelCode;
				const warrantyConsentsArray = {};
				if(  util.isNotEmptyArray( dataId )  ){
					careLegal = "," + dataId.join('|');
					$.each( dataId, function( idIndex, careLegalInfo ) {
						warrantyConsentsArray[careLegalInfo] = consentsaccept;
					});
				}
				if( dataModelCode ){
					careListParam = "&addChildItem[]=" + dataModelCode + ",1";
					lineitemArray.line_items.push({"sku_id" : dataModelCode, "quantity" : "1", "consents" : warrantyConsentsArray});
				}
			}
			
			if( hasUpgradeResult ){
				const dataId = upgradeResultView.dataId;
				const eupConsentsArray = {};
				if( util.isNotEmptyArray( dataId ) ){
					upgradeLegal = "," + dataId.join('|');
					$.each( dataId, function( idIndex, eupLegalInfo) {
						eupConsentsArray[eupLegalInfo] = consentsaccept;
					});
				}
				
				for( var childCheckIndex in childCheckList ){
					if( upgradeLegal ){
						upgradeListParam += "&addChildItem[]=" + childCheckList[childCheckIndex] + ",1" + upgradeLegal;
					}else{
						upgradeListParam += "&addChildItem[]=" + childCheckList[childCheckIndex] + ",1";
					}
					lineitemArray.line_items.push({"sku_id" : childCheckList[childCheckIndex], "quantity" : "1", "consents" : eupConsentsArray});
				}
				
				flushParam  = "&flush=true";
				cartParam.flush = true;
			}
			
			if( sharedObj.pdUpgrade ){
				if( siteCode === 'fr' ){
					sharedObj.pdUpgrade = "";
				}else{
					sharedObj.pdUpgrade = "&upgrade=true";
				}
				pdUpgrade = sharedObj.pdUpgrade;
			}
			
			if( hasBetween ){
				leaseingParam = "&finance_plan_id=" + betweenNonPurchaseView.dataLeaseing;
				flushParam = "&flush=true";
				
				cartParam.flush = true;
				lineitemArray.finance_plan_id = betweenNonPurchaseView.dataLeaseing;
			}
			
			if( hasCombo ){
				for( var indexCombo in comboView ){
					const comboItem = comboView[indexCombo].item;
					for ( var indexBundle in comboItem.bundleList ) {
						const bundleItem = comboItem.bundleList[indexBundle];
						const modelCode = bundleItem.dataModelCode;
						if( modelCode ){
							childModelList[modelCode] = modelCode;
							lineitemArray.line_items.push({"sku_id" : modelCode, "quantity" : "1"});
						}
					}
				}
			}
			
			if( hasGiftResult ){
				const gifttem = giftView.item;
				for ( var bunIndex in gifttem.bundleList ) {
					const bundleItem = gifttem.bundleList[bunIndex];
					const modelCode = bundleItem.dataModelCode;
					if( modelCode ){
						childModelList[modelCode] = modelCode;
						lineitemArray.line_items.push({"sku_id" : modelCode, "quantity" : "1"});
					}
				}
			}
			
			if( hasAssuredBuyBackResultResult ){
				const assuredSku = assuredBuyBackResultView.dataSku;
				const assuredConsentsArray = {};
				const dataAssuredId = assuredBuyBackResultView.dataId;
				let assuredLeagal = '';
				
				if( util.isNotEmptyArray( dataAssuredId ) ){
					assuredLeagal = "," + dataAssuredId.join('|');
					$.each( dataAssuredId, function( idIndex, assuredLegalInfo) {
						assuredConsentsArray[assuredLegalInfo] = consentsaccept;
					});
				}
				
				if( assuredSku ){
					assuredParam = '&addChildItem[]=' + assuredSku + assuredLeagal;
					lineitemArray.line_items.push({"sku_id" : assuredSku, "quantity" : "1", "consents" : assuredConsentsArray});
				}
				
			}
			
			if( hasForeverResult ){
				const foreverModelList = galaxyForeverResultView.modelList;
				const foreverId = galaxyForeverResultView.dataId;
				const financePlanId = galaxyForeverResultView.financePlanId;
				
				if( util.isNotEmptyArray( foreverId ) ){
					foreverLegal = "," + foreverId.join('|');
				}
				
				for( var foreverIndex in foreverModelList ){
					foreverParam += "&addChildItem[]=" + foreverModelList[foreverIndex] + ",1";
				}
				
				foreverParam += foreverLegal;
				
				if( financePlanId ){
					foreverParam +='&finance_plan_id='+financePlanId;
				} 
			}
			
			for( var childIndex in childModelList ){
				childListParam += "&addChildItem[]=" + childModelList[childIndex] + ",1";
			}
			
			//   
			for( var accessoryIndex in accessoryList ){
				if( siteCode === 'id') {
					accessoryListParam += "&addChildItem[]=" + accessoryList[accessoryIndex] + ",1";
				} else {
					accessoryListParam += "&addItem[]=" + accessoryList[accessoryIndex] + ",1";
				}
				
				if( sharedObj.hasVoucher && sharedObj.voucherdata.coupons && sharedObj.voucherdata.coupons[0] ){
					accessoryListParam += '&promoCode='+sharedObj.voucherdata.coupons[0]
				}
				lineitemArray.line_items.push({"sku_id" : accessoryList[accessoryIndex], "quantity" : "1"});
			}
			
			if( delPinCode ){
				delPinCodeParam = "&postal_code=" + delPinCode;
				cartParam.postal_code = delPinCode;
			}
			
			// uk, de Tariff, TradeIn 
			if((siteCode === 'de' || siteCode === 'uk') 
					&& (hasTariffOptionResult || hasTradeInResult )){
				flushParam = "&flush=true";
				cartParam.flush = true;
			}
			
			// url    
			if( pdAppId ){
				baseUrl += "?appId="+ sharedObj.pdAppId;
			}
			
			if( Object.keys( consentsArray ).length > 0 ) {
				lineitemArray.consents = consentsArray;
			}
			
			if( Object.keys( lineitemArray ).length > 0 ){
				cartParam.line_items.push( lineitemArray );
			}
			
			//[EPP] in refurbished  : virtualModelCode -> shopSku  
			if ( $('#isEppPage').val() === 'true' && $.trim($('#virtualModelCode').val()) != '' ){
				cartModelCode = $('#originShopSku').val();
			}
			
			//     . CRHQ-1747 06.04   > id  ,    ,  ajax   .
			if( siteCode === 'id' ){
				baseUrl += "?addItem[]=" + cartModelCode + ",1" + tariffLegal + tradeInLegal + childListParam + careListParam + careLegal + upgradeListParam + leaseingParam + cartQuoteLegal + delPinCodeParam + pdUpgrade + flushParam + accessoryListParam + foreverParam;
				window.location.href = baseUrl;
			} else {
				let originalquantity = ",1";
				if( isContinue ) {
					let accParam = '';
					for( var acIndex = 0; acIndex < accessoryList.length; acIndex++ ){
						let prefix = '&';
						if(acIndex == 0) {
							prefix = '?';
						}
						accParam += prefix +"addItem[]=" + accessoryList[acIndex] + originalquantity;
					}
					
					baseUrl += accParam;
				} else {
					if( sharedObj.proudctPriceInfo.productCartCount && sharedObj.proudctPriceInfo.productCartCount > 1 ){
						originalquantity = `,${sharedObj.proudctPriceInfo.productCartCount}`;
					}
					baseUrl += "?addItem[]=" + cartModelCode + originalquantity + tariffLegal + tradeInLegal + childListParam + careListParam + careLegal + upgradeListParam + leaseingParam + cartQuoteLegal + delPinCodeParam + pdUpgrade + flushParam + foreverParam + assuredParam;
				}
				
				//[EPP] in refurbished  :    quantity 
				if ( $('#isEppPage').val() === 'true' && $.trim($('#virtualModelCode').val()) != '' ){
					baseUrl = baseUrl.replace("addItem[]", "flash_skus");
					baseUrl = baseUrl.replace(originalquantity, "");
				}
				
				if( isDirect ){
					window.location.href = baseUrl;
				} else {
					gpv2ShoppingCartCall( sharedObj, cartParam, accessoryList );
				}
				
			}
		}
	}

	function isShopApp() {
		if (typeof window !== 'undefined')
		{
			return (!!(window.EcommAndroidClient || window.flutter_inappwebview));
		}
		return false;
	}

	/**
	 * ajax cart  
	 */
	function gpv2ShoppingCartCall( sharedObj, cartParam, accessoryList ){
		const countryIsoCode = sharedObj.countryIsoCode;
		const siteCode = sharedObj.siteCode;
		var loginJwt = $.cookies.get("jwt_"+countryIsoCode, {domain : ".samsung.com"});
		const url = sharedObj.apiDomain +  "/v4/shopping-carts/";

		var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};

		var headers = {
				"Cache-Control" : "no-cache",
				"Content-Type" : "application/json",
				"Access-Control-Allow-Origin" : "*"
		};

		if( siteCode === 'in' ){
			if (window && window.EcommAndroidClient) { 
				headers['x-ecom-app-id'] ="samsung-mobile-app";
			}
			/*
			if(isShopApp()) {
				headers['x-ecom-app-id'] = "samsung-mobile-app";
			}
			*/
			if (isShopApp()) {
				var ua = navigator.userAgent && navigator.userAgent.toLowerCase();
				var xEcomAppId;
				if (ua.indexOf('android') > -1)
				{
					xEcomAppId = 'samsung-mobile-app'; //for android we will send "samsung-mobile-app"
				}
				else
				{
					xEcomAppId = 'samsung-mobile-app-ios'; //for ios we will send "samsung-mobile-app-ios"     
				}
				headers['x-ecom-app-id'] = xEcomAppId;
			}
		}

		$.ajax({
			headers: headers,
			url: url,
			type: "POST",
			data: JSON.stringify( cartParam ),
			xhrFields: _xhrFields,
			dataType: "json",
			cache: true,
			beforeSend: function(xhr){
				/* jwtToken     */
				if(loginJwt != null && loginJwt != ""){
					xhr.setRequestHeader("x-ecom-jwt", loginJwt);
				}
			},
			timeout: 20000,
			success: function (data, responseText, jqXHR) {
				if( accessoryList && accessoryList.length > 0 ){
					const msg = Granite.I18n.get("The item is added to your cart");
					const PopupType = "addtocart";
					confirmPopup(msg, PopupType);
				}

			},error : function(data){
				console.log('fail add to cart');
			} 
		});
	}
	/**
	 * recall   ComboBogo 
	 */
	function checkingRecallComboBogo( sharedObj, selectorObj, syndiItem, reCallSyndi, productItem ){
		const siteCode = sharedObj.siteCode;
		const util = sharedObj.util;
		const offerView = sharedObj.drawObj.offer;
		const pdSoftBundleUseYn = sharedObj.pdSoftBundleUseYn;
		
		/* COMBO, BOGO    */
		if( pdSoftBundleUseYn === 'Y' ){
			if( productItem.sku_source) {
				syndiItem.sku_source = productItem.sku_source;
				if( productItem.sku_source === 'ecom' ){
					if( syndiItem.offer_type === 'COMBO' ){
						if(productItem.inventory !== null){
							syndiItem.ctaType = productItem.inventory.status;
						}
						
						if(productItem.images !== null && productItem.images.small_image !== null){
							syndiItem.thumbUrl = productItem.images.small_image.url;
							syndiItem.thumbUrlAlt = productItem.images.small_image.desc;
						}
						
						syndiItem.displayName = productItem.product_display_name;
						syndiItem.modelName = productItem.model_name;
						syndiItem.modelCode = productItem.model_code;
						
					} else if(syndiItem.offer_type_b === 'BOGO') {
						
						const pcImg = productItem.images.small_image.url;
						const alt = productItem.images.small_image.desc;
						const customsObj = { 'classWapper' : 'image__main responsive-img' };
						const imgAttr = util.getImgAttr ( pcImg, pcImg, alt, customsObj );
						const priceCurrency = sharedObj.priceCurrency;
						const view = sharedObj.view;
						const drawObj = sharedObj.drawObj;
						
						const bogoPviTypeName = productItem.taxonomy && productItem.taxonomy.product_category ? productItem.taxonomy.product_category.toLowerCase() : '';
						const bogoPviSubtypeName = productItem.taxonomy && productItem.taxonomy.name  ? productItem.taxonomy.name.toLowerCase() : '';
						const bogoCategorySubTypeEngName = productItem.taxonomy && productItem.taxonomy.name  ? productItem.taxonomy.name.toLowerCase() : '';
						const bogoModelCode = productItem.model_code;
						const bogoModelName = productItem.model_name;
						const bogoDisplayName = productItem.product_display_name;
						
						let mainDec = [];
						
						mainDec.push( {'text'  : syndiItem.bogo_sales_pitch } )
						
						let originalPrice = '';
						let savePrice = '';
						let nowPrice = '';
						let price = '';
						
						if(productItem.price_info !== null && productItem.price_info.length > 0){
							price = productItem.price_info[0].msrp_price.value;
							originalPrice = productItem.price_info[0].msrp_price.formatted_value;
							
							if(siteCode !== 'nl' && siteCode !== 'be' && siteCode !== 'be_fr'){
								savePrice = Granite.I18n.get('Save {0}', currencyComma(productItem.price_info[0].sale_price.value, priceCurrency), siteCode)
							}
							nowPrice = currencyComma(0, priceCurrency)
						}
						//COMP6FE-1599 [EPP] SEPOL MSRP Price  : $('#isEppPage').val() === 'true' && siteCode === "pl" 
						if ($('#isEppPage').val() === 'true' && siteCode === "pl"){
							originalPrice = '';
							savePrice = '';
						}
						
						const thisTotalItem = {
							'title' : 'bogo',
							'hasItem' : true,
							'item' : {
								'contentWrapperClass' : 'bogo-item',
								'headline' : Granite.I18n.get('Buy 1 Get 1 Free'),
								'modelCode' : bogoModelCode,
								'modelName' : bogoModelName,
								'displayName' : bogoDisplayName,
								'pviTypeName' : bogoPviTypeName,
								'pviSubtypeName' : bogoPviSubtypeName,
								'categorySubTypeEngName' : bogoCategorySubTypeEngName,
								'description' : {
									'hasDescription' : true,
									'main' : mainDec,
									'date' : syndiItem.bogo_date
								},
								'imgAttr' : imgAttr,
								'price' : {
									'hasPrice' : true,
									'price' : price,
									'original' : originalPrice,
									'save' : savePrice,
									'now' : nowPrice
								}
							}
						}
						
						offerView.bogo = thisTotalItem;
						view.productOfferDraw( sharedObj.drawObj );
					}
				}else{
					if( syndiItem.offer_type_b === 'BOGO' ){
						sharedObj.bogoSearchList.push(syndiItem);
					}
				}
			}else{
				if( syndiItem.offer_type_b === 'BOGO' ){
					sharedObj.bogoSearchList.push(syndiItem);
				}
			}
		}
	}
	
	/**
	 * recall   assuredBuyBack     
	 */
	function checkingRecallAssuredBuyBack( sharedObj, selectorObj, syndiItem, reCallSyndi, productItem ){
		const util = sharedObj.util;
		const view = sharedObj.view;
		if( syndiItem.checkingType && syndiItem.checkingType === 'assuredBuyBack' ){
			let assureBackPrice = '';
			sharedObj.assuredSku = productItem.sku;
			
			if( productItem.price_info && productItem.price_info[0].sale_price && productItem.price_info[0].sale_price.value ){
				assureBackPrice = currencyComma( productItem.price_info[0].sale_price.value, sharedObj.priceCurrency );
			} else if(  productItem.price_info && productItem.price_info[0].msrp_price && productItem.price_info[0].msrp_price.value ){
				assureBackPrice = currencyComma( productItem.price_info[0].msrp_price.value, sharedObj.priceCurrency );
			}
			
			sharedObj.drawObj.assuredBuyBack = {
				'hasComponent' : true,
				'title' : Granite.I18n.get('Galaxy Assured'),
				'yesAttr' : {
					'class' : null,
					'text': Granite.I18n.get('Galaxy Assured(up to 70%)'),
					'subText': assureBackPrice,
					'layerTarget' : 'assuredBuybackPopup'
				},
				'noAttr' : {
					'class' : null,
					'text': Granite.I18n.get('NO'),
					'layerTarget':null,
					'eventType' : 'assuredBuyBack'
				}
			}
			view.assuredBuyBackDraw( sharedObj.drawObj );
		}
	}
	
	/**
	 * recall   forever  
	 */
	function checkingRecallForever( sharedObj, selectorObj, syndiItem, reCallSyndi, productItem ){
		const util = sharedObj.util;
		
		if( syndiItem.checkingType && syndiItem.checkingType === 'forever' ){
			
			const addOnProductType = productItem.product_type.toUpperCase();
			const priceInfo = productItem.price_info;
			const foreverData = sharedObj.foreverFinanceInfo;
				
			let carePrice = 0;
			
			if( addOnProductType === 'INSURANCE' ){
				if( priceInfo && priceInfo.length > 0 ){
					if(priceInfo[0].msrp_price && priceInfo[0].msrp_price.value ) {
						carePrice = priceInfo[0].msrp_price.value;
					}
					if(priceInfo[0].sale_price && priceInfo[0].sale_price.value ) {
						carePrice = priceInfo[0].sale_price.value;
					}
				}
			}
			foreverData.carePrice = carePrice;
			
			util.foreverDraw( sharedObj, selectorObj );
		}
	}
	/**
	 * recall   SMC, Warranty, Addon    
	 */
	function checkingRecallAddOnList( sharedObj, selectorObj, syndiItem, reCallSyndi, productItem ){
		const pdProductTypeCheckYn = sharedObj.pdProductTypeCheckYn;
		const  multiCareYn = sharedObj.multiCareYn;
		
		if(pdProductTypeCheckYn === 'Y' && syndiItem.offer_type === 'CONFIGURATORADDON'){
			if( productItem.product_type ){
				var addOnProductType = productItem.product_type.toUpperCase();
				if(addOnProductType === 'PHYSICAL'){
					var tempCareInfo = {};
					tempCareInfo.discounted_sku = productItem.sku;
					if( !sharedObj.addOnInfoTempCache[tempCareInfo.discounted_sku] ){
						sharedObj.addOnInfoTemp.push(tempCareInfo);
						sharedObj.addonsFlag = true;
						sharedObj.addOnInfoTempCache[tempCareInfo.discounted_sku] = tempCareInfo.discounted_sku;
					}
					
				}else if(addOnProductType === 'INSURANCE' || addOnProductType === 'WARRANTY'){
					if( productItem.sku_source ){
						if(productItem.sku_source === 'ecom'){
							productItem.discounted_sku = productItem.sku;
							if(productItem.images != null && productItem.images.small_image != null){
								productItem.thumbUrl = productItem.images.small_image.url;
								productItem.thumbUrlAlt = productItem.images.small_image.desc;
							}
							productItem.ctaType = productItem.inventory.status;
							productItem.displayName = productItem.product_display_name;
							productItem.modelName =  productItem.model_name;
							productItem.modelCode = productItem.model_code;
							sharedObj.addOnInfo.push(productItem);
						}else{
							productItem.discounted_sku = productItem.sku;
							sharedObj.addOnInfo.push(productItem);
						}
						
						if(addOnProductType === 'INSURANCE'){
							sharedObj.samsungCareFlag = true;
							if( syndiItem.product_formatted_sales_pitch ){
								sharedObj.samsungCareSubText = syndiItem.product_formatted_sales_pitch;
							}
						}else if( addOnProductType === 'WARRANTY'){
							sharedObj.warrantyFlag = true;
						}
					}
				}
			}
		}
	
		//   CONFIGURATORADDONSAMSUNGCARE          
		if(multiCareYn === 'Y') {
			let samsungCareList = sharedObj.samsungCareList;
			if(samsungCareList !== null && samsungCareList.length > 0 ) {
				for (var j in samsungCareList) {
					if (productItem.sku === samsungCareList[j].discounted_sku) {
						samsungCareList[j].custom_properties = productItem.custom_properties;
						samsungCareList[j].images = productItem.images;
						samsungCareList[j].long_description = productItem.long_description;
						samsungCareList[j].short_description = productItem.short_description;
						samsungCareList[j].product_display_name = productItem.product_display_name;
						samsungCareList[j].displayName = productItem.product_display_name;
						samsungCareList[j].modelName = productItem.model_name;
						samsungCareList[j].modelCode = productItem.model_code;
						samsungCareList[j].sku_source = productItem.sku_source;
						samsungCareList[j].sale_price = productItem.sale_price;
						samsungCareList[j].msrp_price = productItem.msrp_price;
						samsungCareList[j].product_type = productItem.product_type;
					}
				}
			}	
		}
	}
	
	/**
	 * galaxyForever   
	 */
	function settingGalaxyForeverData( promotionData, productsData, sharedObj, selectorObj ){
		
		const financeInfo = promotionData.finance_info;
		const reCallSyndi = sharedObj.reCallSyndi;
		const orignalPrice = sharedObj.proudctPriceInfo.orignalPrice;
		const salsePrice = sharedObj.proudctPriceInfo.salePrice;
		const siteCode = sharedObj.siteCode;
		
		let productPrice = '';
		let assuredBuyBack = 0;
		let downPayment = 0;
		let tenureValue = 11;
		let flag = false;
		
		if( financeInfo ){
			const foreverFinanceInfo = financeInfo;
			const discountInfo = promotionData.discount_description;

			if( siteCode === 'in' ){
				flag = true;
			}
			
			foreverFinanceInfo.displayName = productsData.product_display_name;
			foreverFinanceInfo.modelCodeArr = [];
			
			if( discountInfo && discountInfo.length > 0){
				for( var discountInfoIndex in discountInfo ){
					const discountItem = discountInfo[discountInfoIndex];
					for( var skusIndex in discountItem.discounted_skus ){
						const sku = discountItem.discounted_skus[skusIndex].sku;
						foreverFinanceInfo.modelCodeArr.push( sku );
						reCallSyndi.push( 
							{
								'sku' : sku,
								'checkingType' : 'forever'
							}
						);
					}
				}
			} else {
				foreverFinanceInfo.modelCode = productsData.sku;
			}
			
			if( salsePrice ){
				productPrice = salsePrice;
			} else {
				productPrice = orignalPrice;
			}
			
			if( foreverFinanceInfo.assured_buy_back ){
				assuredBuyBack = foreverFinanceInfo.assured_buy_back;
			}
			
			if( foreverFinanceInfo.down_payment ){
				downPayment = foreverFinanceInfo.down_payment;
			}
			
			if( foreverFinanceInfo.tenure && foreverFinanceInfo.tenure.value ){
				tenureValue = foreverFinanceInfo.tenure.value;
			}
			
			foreverFinanceInfo.foreverFlag = flag;
			foreverFinanceInfo.displayName = productsData.product_display_name;
			foreverFinanceInfo.assuredBuyBack = assuredBuyBack;
			foreverFinanceInfo.downPayment = downPayment;
			foreverFinanceInfo.tenureValue = tenureValue;
			foreverFinanceInfo.productPrice = productPrice;
			foreverFinanceInfo.exchangeDiscount = 0;
			foreverFinanceInfo.foreverPrice = null;  //   
			foreverFinanceInfo.carePrice = null;  //   
			foreverFinanceInfo.tradeinCheckFlag = false;
			foreverFinanceInfo.tradeinDiscountYn = false;
			foreverFinanceInfo.tradeinprice = 0;
			
			sharedObj.foreverFinanceInfo = foreverFinanceInfo;
		}
	}
	
	/**
	 *       
	 */
	function firstSyndi( sharedObj, selectorObj, callbackData ){
		
		const util = sharedObj.util;
		const drawObj = sharedObj.drawObj;
		const view = sharedObj.view;
		const currentUrl = sharedObj.currentUrl;
		const shopSkuCode = sharedObj.shopSkuCode;
		const syndiApiData = sharedObj.syndiApiData;
		
		settingSEBNBasePrice( sharedObj, selectorObj );
		
		if( callbackData ){
			if( syndiApiData.products[shopSkuCode] ){
				const product = syndiApiData.products[shopSkuCode];
				sharedObj.syndiProductData = product;
				
				settingBaseData( product, sharedObj, drawObj, selectorObj );
				util.settingPriceCta( sharedObj.hasPriceCta, sharedObj, selectorObj, currentUrl );
				
				// NOORDER, OUTOFSTOCK        
				if( drawObj.price.priceWrapper.hasPriceWrapper ){
					settingDelivery( product, sharedObj, drawObj, selectorObj );
					settingTariffOptionDraw( product, sharedObj, drawObj, selectorObj );
					settingPromoData( product, sharedObj, drawObj, selectorObj );
					settingTradeInDraw( sharedObj, drawObj, selectorObj );
					settingUpgradeDraw( sharedObj, drawObj, selectorObj );
					settingBetweenDraw( product, sharedObj, drawObj, selectorObj );
					settingUsEPPData( sharedObj, selectorObj );
				}
			} else {
				util.settingPriceCta( sharedObj.hasPriceCta, sharedObj, selectorObj, currentUrl );
			}
		} else {
			util.settingPriceCta( sharedObj.hasPriceCta, sharedObj, selectorObj, currentUrl );
		}
		
		// [EPP] COMP6FE-1619 SIEL Offline   : offline stock  api
		sharedObj.commonApiModel.offlineStockAjax(sharedObj);
		
		sharedObj.finishedFirstSyndi = true;
		view.productDraw(drawObj);
		
		util.afterTotalAPI(sharedObj, selectorObj);
		
		sharedObj.commonApiModel.settingWishList( sharedObj, selectorObj );
		util.clickEventListener( sharedObj, selectorObj );
		
	}
	
	function settingSEBNBasePrice( sharedObj, selectorObj ){
		const siteCode = sharedObj.siteCode;
		
		if( gpv2ShopInfo && siteCode === "nl" ){
			sharedObj.util.setPriceProudctPriceInfo( sharedObj, selectorObj, {
				'price' : gpv2ShopInfo.price,
				'priceDisplay' : gpv2ShopInfo.priceDisplay,
				'promotionPrice' : gpv2ShopInfo.promotionPrice,
				'promotionPriceDisplay' : gpv2ShopInfo.promotionPriceDisplay,
				'leasingInfo' : gpv2ShopInfo.leasingInfo,
				'listPrice' : gpv2ShopInfo.listPrice,
				'listPriceDisplay' : gpv2ShopInfo.listPriceDisplay,
				'saveText' : gpv2ShopInfo.saveText,
				'tradeInPriceText' : gpv2ShopInfo.tradeInPriceText
			});
			
			if( sharedObj.proudctPriceInfo.salePriceFormatted ){
				sharedObj.drawObj.price.priceWrapper.hasPriceWrapper = true;
			}
		}
	}
	
	function settingAssuredBuyBackData ( promotionData, product, sharedObj, selectorObj ){
		if( product.price_info && product.price_info.length > 0 ) {
			if( promotionData.discount_description && promotionData.discount_description.length > 0 ) {
				sharedObj.reCallSyndi.push( 
					{
						'sku' : promotionData.discount_description[0].discounted_skus[0].sku,
						'checkingType' : 'assuredBuyBack'
					}
				);
			}
		}
	}
	
	function settingVoucherData ( promotionData, product, sharedObj, selectorObj ) {
		const voucherdata ={};
		const voucherInfo = promotionData.discount_description;
	
		if( promotionData.sales_pitch && promotionData.sales_pitch.length > 0){
			voucherdata.sales_pitch = promotionData.sales_pitch[0];
		}
		if( promotionData.formatted_sales_pitch && promotionData.formatted_sales_pitch.length > 0){
			voucherdata.formatted_sales_pitch = promotionData.formatted_sales_pitch[0];
		}
		
		if( voucherInfo && voucherInfo.length > 0 ){
			voucherdata.discount_description = voucherInfo;
			
			for( var voucherIndex = 0; voucherIndex < voucherInfo.length; voucherIndex++ ){
				const voucherInfoItem = voucherInfo[voucherIndex];
				voucherdata.price = voucherInfoItem.value;
				voucherdata.coupons = voucherInfoItem.coupons;//
			}
		}
		
		
		if( promotionData.terms_and_condition_ids && promotionData.terms_and_condition_ids.length > 0){
			voucherdata.terms_and_condition_ids = promotionData.terms_and_condition_ids;
		}

		sharedObj.voucherdata = voucherdata;
		sharedObj.hasVoucher = true;
	}
	
	function settingUsEPPData( sharedObj, selectorObj ){
		const siteCode = sharedObj.siteCode;
		const eppVerified =  $.cookies.get('epp_verified', {domain : ".samsung.com"});
		const isIM = sharedObj.pdProductType === 'PHONE';
		const tmktid =  $.cookies.get('tmktid', {domain : ".samsung.com"});
		const isEppUser = eppVerified && eppVerified === true;
		
		if( siteCode === 'us' ){
			
			//        
			if( isEppUser ){
				sharedObj.util.selectedUsEpp( {'sharedObj' : sharedObj, 'selectorObj' : selectorObj} );
			} else {
				if( isIM ){
					if( tmktid ){
						sharedObj.util.selectedUsEpp( {'sharedObj' : sharedObj, 'selectorObj' : selectorObj} );
					} else {
						//  
						sharedObj.commonApiModel.setUsProductJson( sharedObj, selectorObj );
						sharedObj.commonApiModel.setEppDiscount( sharedObj, selectorObj );
					}
					
				}
			}
			
		}
	}

	
	dynamic.BuyingToolOpAjaxGPv2 = BuyingToolOpAjaxGPv2;
})();


(() => {
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	
	class BuyingToolOpAjaxNewbris {
	
		constructor(){
			this.newbirsObj = {
				finishedAPIList : {
					firstNewBrisAPI : true,
					offers : true,
					childOffers : true,
					combo : true,
					leasing : true
				},
				commonModel : {
					stockLevelStatus : '',
					stockCustomMessage : '',
					product_display_name : '',
					emcomFlag : false,
					price : {
						listPrice : {
							value : 0,
							formatted_value : ''
						},
						vatFreePrice : {
							value : 0,
							formatted_value : ''
						},
						msrpPrice : {
							value : 0,
							formatted_value : ''
						},
						salePrice : {
							value : 0,
							formatted_value : ''
						},
						leasingInfo : {
							monthlyRate : '',
							tenureVal : '',
							interest : ''
						},
						saveText :'',
						tradeInPriceText : '',
						financePlan : {
							installment_amount : '', //  EIP
							unit : '', //    
						}
					},
					tradeInData : {
						hasData : false,
						formatted_sales_pitch : '',
						sales_pitch : ''
					},
					bogoData : {
						bogoPrice : '',
						bogoSku : ''
					},
					upgradeData : {
						hasData : false,
						sku : ''
					},
					warrantyData : {
						hasData : false,
						skuData : [{
							discounted_sku  : '',
							price_info  : [{
								msrp_price : {
									value : 0,
									formatted_value : ''
								},
								sale_price  : {
									value : 0,
									formatted_value : ''
								},
								saveText :''
							}],
							custom_properties : {
								plan_inclusions : [],
								plan_exclusions  : []
							}
						}],
					},
					warrantyVdData : {
						hasData : false,
						skuData : [{
							discounted_sku  : '',
							price_info  : [{
								msrp_price : {
									value : 0,
									formatted_value : ''
								},
								sale_price  : {
									value : 0,
									formatted_value : ''
								},
								saveText :''
							}],
							custom_properties : {
								plan_inclusions : [],
								plan_exclusions  : []
							}
						}],
					},
					promotionsMsg : [{
						formatted_sales_pitch : '',
						sales_pitch : ''
					}],
					samsungPomoFinanceData : {
						hasData : false,
						formatted_sales_pitch : '',
						sales_pitch : ''
					}, 
					pomoFinanceData : {
						hasData : false,
						formatted_sales_pitch : '',
						sales_pitch : ''
					}
				},
				isExecuted : false,
				apiData : {},
				comboCount : 0
			}
		}

		productAjax ( sharedObj, selectorObj ) {
			const newbirsObj = this.newbirsObj;
			if( sharedObj.isSECZ){
				settingCalculateInstallmentData( sharedObj, selectorObj, newbirsObj);
			}
			settingMultistore( sharedObj, selectorObj, newbirsObj );
			settingDefaultPrice( sharedObj, selectorObj, newbirsObj );
			settingNewHybrisAPI( sharedObj, selectorObj, newbirsObj );
			finishedTotalAPI(sharedObj, selectorObj, newbirsObj);
		}
		
		callAddToCartCta( sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift ) {
			let giftInfo = '';
			if( siteCode === 'uk' ){
				if( sharedObj.globalServiceInfo && sharedObj.globalServiceInfo.gift && sharedObj.globalServiceInfo.gift.modelCode ){
					giftInfo = sharedObj.globalServiceInfo.gift;
				}
			}
			
			const beforeHybris = new dynamic.BuyingToolOpAjaxHybris(); //20210402 sena 
			const services = getServices( sharedObj, accessoryList, selectorObj, isDirect, isContinue );
			const returnParam = {
				clickDom : sharedObj.clickDom
			};
			let modelCode = sharedObj.modelCode;
			let cartUrl = '';
			let callbackFun = '';

			if( isDirect ){
				cartUrl = sharedObj.cartUrl.indexOf('https://') > -1 || sharedObj.cartUrl.indexOf('http://') > -1 ? sharedObj.cartUrl : sharedObj.apiDomain+sharedObj.cartUrl;
				
				//epp shop 
				cartUrl = $('#isEppPage').val() === 'true' ? `${$('#storeWebDomain').val()}/${$('#eppCompanyCode').val()}/cart` : cartUrl;
			}
			
			if( isContinue ){
				modelCode = '';
			}
			
			if( !isContinue ){
				callbackFun = ( result, isSuccess, returnParam  )=>{
					//window.sg.components.dynamic.bridgePage.moveBridgePage( returnParam.clickDom ); 
					window.sg.components.dynamic.bridgePageCommonHybris.moveBridgePage( returnParam.clickDom )
				} 
			}
			if(siteCode !='uk'){ //20210402 sena  , 20210408 id/ph  , 20210524 uk 
				beforeHybris.callAddToCartCta(sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift );
				window.sg.components.dynamic.bridgePageCommonHybris.moveBridgePage( returnParam.clickDom );
			}else{
				if( giftInfo ){
					services.gift = giftInfo;
				}
				addToCartNewHybris( modelCode, cartUrl, callbackFun, services, returnParam );
			}
		}
		
		callCheckOutCta( sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift ) {
			const beforeHybris = new dynamic.BuyingToolOpAjaxHybris(); //20210402 sena 
			const services = getServices( sharedObj, accessoryList, selectorObj, isDirect, isContinue );
			const returnParam = {
				clickDom : sharedObj.clickDom
			};
			let modelCode = sharedObj.modelCode;
			let cartUrl = '';
			let callbackFun = '';
			if( !isDirect ){
				if( siteCode === 'id' ){
					isDirect = true;
				}
			}

			if( isDirect ){
				cartUrl = sharedObj.cartUrl.indexOf('https://') > -1 || sharedObj.cartUrl.indexOf('http://') > -1 ? sharedObj.cartUrl : sharedObj.apiDomain+sharedObj.cartUrl;
				
				//epp shop 
				cartUrl = $('#isEppPage').val() === 'true' ? `${$('#storeWebDomain').val()}/${$('#eppCompanyCode').val()}/cart` : cartUrl;
			}
			if( isContinue ){
				modelCode = '';
			}
			
			if( !isContinue ){
				callbackFun = ( result, isSuccess, returnParam  )=>{
					//window.sg.components.dynamic.bridgePage.moveBridgePage( returnParam.clickDom ) 
					window.sg.components.dynamic.bridgePageCommonHybris.moveBridgePage( returnParam.clickDom )
				} 
			}
			
			const isLeasingChk = $("#pd-leasing-1").prop("checked");
			const isLeasingArea = (siteCode === "be" || siteCode === "be_fr" || siteCode === "nl" || siteCode === "fr");
			if( isLeasingArea && isLeasingChk ){
				beforeHybris.callAddToCartCta(sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift );
			}else if( siteCode !='uk' ){ //20210402 sena  , 20210408 id/ph  , 20210524 uk 
				beforeHybris.callAddToCartCta(sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift );
				window.sg.components.dynamic.bridgePageCommonHybris.moveBridgePage( returnParam.clickDom );
			}else{
				addToCartNewHybris( modelCode, cartUrl, callbackFun, services, returnParam );
			}
		}
	}

	function getServices( sharedObj, accessoryList, selectorObj, isDirect, isContinue ){
		const util = sharedObj.util;
		const drawObj = sharedObj.drawObj;
		const deliveryArea = selectorObj.buyingToolOptDelivery;
		const delPinCode = $(deliveryArea.find('#delivery-zipcode')).val();
		const hasTariffOptionResult = util.hasTariffOptionResult( sharedObj, selectorObj );
		const hasCareResult = util.hasCareResult( sharedObj, selectorObj );
		const hasWarrantyResult = util.hasWarrantyResult( sharedObj, selectorObj );
		const hasUpgradeResult = util.hasUpgradeResult( sharedObj, selectorObj );
		const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
		const hasBetween = util.hasBetweenResult( sharedObj, selectorObj );
		const hasCombo = util.hasComboResult( sharedObj, selectorObj );
		const hasForeverResult = util.hasForeverResult( sharedObj, selectorObj );
		const hasGiftResult = util.hasGiftResult( sharedObj, selectorObj );
		const hasAssuredBuyBackResultResult = util.hasAssuredBuyBackResultResult( sharedObj, selectorObj ); 

		let services = {} //  

		if( util.checkingDeliveryCode( sharedObj, selectorObj ) ){

			if( sharedObj.cartBezelCode ){
				services.bezelCode = sharedObj.cartBezelCode;
				services.isContinue = isContinue;
			}
			
			if( sharedObj.giftCard.cartGiftCardCode ){
				services.giftCardCode = sharedObj.giftCard.cartGiftCardCode;
				services.isContinue = isContinue;
			}
			services.postalCode = delPinCode;

			if( isContinue ){
				if( accessoryList && accessoryList.length > 0 ){
					services.addon = {
						'modelCodeList' : [...accessoryList],
					}
				}
				
				if( hasGiftResult ){
					const giftView = drawObj.offer.gift;
					const gifttem = giftView.item;
					for ( var bunIndex in gifttem.bundleList ) {
						const bundleItem = gifttem.bundleList[bunIndex];
						const modelCode = bundleItem;
						
						if( modelCode.length == 1 ){
							services.gift = {
								'modelCode' : bundleItem
							}
						}else{
							services.gift = {
									'modelCode' : bundleItem
								}
						}
					}
				}
				
			} else {
				
				const embedaddonResult = sharedObj.globalServiceInfo.embedaddon;
				if( embedaddonResult && embedaddonResult.length > 0 ){
					services.embedaddon = embedaddonResult;
				}
				
				if( hasTariffOptionResult ) {
					const tariffOptionResultView = drawObj.tariffOptionResult;
					services.tariff = {
						'modelCode' : tariffOptionResultView.dataModelCode,
						'simSkuCode' : tariffOptionResultView.dataSimskuCode,
						'tnc' : [tariffOptionResultView.dataId]
					}
				}
				
				if( hasTradeInResult ){
					const tradeInResultView = drawObj.tradeInResult;
					services.tradeIn = {
						'plan_id' : tradeInResultView.dataQuoteId
					}					
					if(tradeInResultView.dataId && tradeInResultView.dataId.length > 0) {	//202104023 dataId=undefined
						services.tradeIn['tnc'] = [...tradeInResultView.dataId]
					}					
				}
				// 20230616 CE(VD/DA) TradeUp Popup  
				// 20230616 MSA create-exchange   , CE Trade-up   
				//
				if (sharedObj.exchangeApiData && sharedObj.exchangeApiData.exchangeFlag && sharedObj.ceTradeUpPopup.isEnabled) {
					services.exchange = {
						'exchangeId' : sharedObj.exchangeApiData.dataQuoteId
					};
				}

				if( hasCareResult ){
					const careResultView = drawObj.careResult;
					services.care = {
						'modelCode' : careResultView.dataModelCode,
						'tnc' : [...careResultView.dataId]
					}
				}
				
				if( hasWarrantyResult ){
					const warrantyResultView = drawObj.warrantyResult;
					services.warranty = {
						'modelCode' : warrantyResultView.dataModelCode,
						'tnc' : [...warrantyResultView.dataId]
					}
				}
				
				if( hasUpgradeResult ){
					const upgradeResultView = drawObj.upgradeResult;
					services.upgrade = {
						'modelCode' : sharedObj.childCheckList[0],
						'tnc' : [...upgradeResultView.dataId]
					}
				}
				
				if( hasBetween ){
					const betweenNonPurchaseView = drawObj.between.nonPurchase;
					services.between = {
						'plan_id' : betweenNonPurchaseView.dataLeaseing
					}
				}
				
				if( hasCombo ){
					const comboView = drawObj.offer.combo;
	
					services.combo = {
						'modelCodeList' : [],
					}
	
					for( var indexCombo in comboView ){
						const comboItem = comboView[indexCombo].item;
						for ( var indexBundle in comboItem.bundleList ) {
							const bundleItem = comboItem.bundleList[indexBundle];
							services.combo.modelCodeList.push(bundleItem.dataModelCode);
						}
					}
				}
				
				if( hasGiftResult ){
					const giftView = drawObj.offer.gift;
					const gifttem = giftView.item;
	
					for ( var bunIndex in gifttem.bundleList ) {
						const bundleItem = gifttem.bundleList[bunIndex];
						const modelCode = bundleItem.dataModelCode;
						if( modelCode ){
							services.gift = {
								'modelCode' : modelCode
							}
						}
					}
				}
				
				if( hasAssuredBuyBackResultResult ){
					const assuredBuyBackResultView = sharedObj.drawObj.assuredBuyBackResult;
					services.assuredBuyBack = {
						'modelCode' : assuredBuyBackResultView.dataSku,
						'tnc' : [...assuredBuyBackResultView.dataId]
					}
				}
				
				if( hasForeverResult ){
					const galaxyForeverResultView = sharedObj.drawObj.galaxyForeverResult;
					const foreverModelList = galaxyForeverResultView.modelList;
					services.forever = {
						'modelCodeList' : [...foreverModelList],
						'planId' : galaxyForeverResultView.financePlanId,
						'tnc' : [...galaxyForeverResultView.dataId]
					}
				}
			}
		}
		
		
		return services;

	}

	function finishedTotalAPI(sharedObj, selectorObj, newbirsObj){
		if( !newbirsObj.isExecuted ){
			let totalAPIFinished = true;

			for( const apiCheck in newbirsObj.finishedAPIList ){
				if( !newbirsObj.finishedAPIList[apiCheck] ){
					totalAPIFinished =false;
					break;
				}
			}

			if( totalAPIFinished ){
				newbirsObj.isExecuted = true;
				sharedObj.view.productDraw(sharedObj.drawObj);
				sharedObj.util.totalAfterFunction(sharedObj, selectorObj);
				//giftcard X
				if(sharedObj.categoryTypeCode != "10030000"){
					settingCalculateDraw( sharedObj, selectorObj );
				}
				changeEmiUrl( sharedObj, selectorObj );

				sharedObj.util.totalReinit(sharedObj, selectorObj);
				sharedObj.util.gpHybrisGlobalEndPoint(sharedObj, selectorObj);
				settingNewWishList( sharedObj, selectorObj );
				sharedObj.util.clickEventListener( sharedObj, selectorObj );
				
				//child offer  action js  binding  
				window.sg.components.pdBuyingTool.bindComboOfferEvent();
			}

		}
	}

	function settingNewWishList( sharedObj, selectorObj ){
		const drawObj = sharedObj.drawObj;
		const countryIsoCode = sharedObj.countryIsoCode;
		const wishList = drawObj.wishList;
		const loginJwt = $.cookies.get("jwt_"+countryIsoCode, {domain : ".samsung.com"});
		const stockLevelStatus = sharedObj.stockLevelStatus;
		const salePrice = sharedObj.proudctPriceInfo.salePrice;
		const loginFlag = commonLoginCheck();
		const apiDomain = sharedObj.apiDomain;
		const view = sharedObj.view;
		const util = sharedObj.util;
				
		wishList.stockLevelStatus = stockLevelStatus;
		wishList.price = salePrice;
		wishList.moCode = sharedObj.shopSkuCode ? sharedObj.shopSkuCode : sharedObj.modelCode;
		wishList.moName = sharedObj.modelName;
		wishList.labelText = Granite.I18n.get('add wishlist');
		wishList.targetId='#wishlist-popup';
			
		/* wishlist focusing    */
		
		if (stockLevelStatus === "NOORDER" || stockLevelStatus === "LEARNMORE") {
			wishList.contentWrapperClass = 'js-btn-wishlist js-not-for-sale-wishlist tg-add-wishlist js-learnmore';
		} else {
			if( salePrice ){
				if ( !loginFlag ) {
					wishList.contentWrapperClass = 's-btn-wishlist js-create-wishlist tg-add-wishlist';
					
				} else {
					wishList.contentWrapperClass = 's-btn-wishlist js-select-wishlist tg-add-wishlist';
				}
			}else {
				wishList.contentWrapperClass = 'js-btn-wishlist js-not-for-sale-wishlist js-learnmore tg-add-wishlist';
			}
		}
		
		
		let shopParm = '';
		if( $('#shopParmLang').val() ){
			shopParm=`&lang=${$('#shopParmLang').val()}`;
		}

		
		if( loginFlag ){
			const apiURL = `${apiDomain}/tokocommercewebservices/v2/${sharedObj.siteCodeWithEpp}/users/current/wishlist/default/product/exist?productCode=${sharedObj.modelCode}`+shopParm;
			$.ajax({
				url : apiURL,
				type : "GET",
				dataType : "json",
				timeout : 20000,
				cache: true,
				xhrFields: { withCredentials: true },
				crossDomain: true,
				success : function ( data ){
					const wishList = sharedObj.drawObj.wishList;
					
					if( data && data === 'My Wishlist'){
						wishList.labelText = Granite.I18n.get("Remove wishlist");
						wishList.contentWrapperClass = ('pd-wishlist-cta--on s-btn-wishlist js-select-wishlist is-async tg-remove-wishlist');
						wishList.isSelected = 'true';
					}
				},
				error: function( err ){},
				complete : function (){
					const view = sharedObj.view;
					const drawObj = sharedObj.drawObj;
					const util = sharedObj.util;
					view.productWishListDraw( drawObj );
					util.settingWishlistTagging( sharedObj, selectorObj );
					
				} 
			});
		} else {
			view.productWishListDraw( drawObj );
			util.settingWishlistTagging( sharedObj, selectorObj );
		}
		/*   account      */
		if(loginJwt === null || loginJwt === ""){
			return false;
		}
	}

	function changeEmiUrl( sharedObj, selectorObj ){
		const util = sharedObj.util;
		const offerArea = selectorObj.buyingToolOptOffer;
		const buyingToolCalculate = $(selectorObj.buyingToolCalculate).find('.js-install-calc');
		const finaceArea = offerArea.find('a[data-target-popup="eipPopup"]');
		const finaceAreaEE = offerArea.find('a[data-target-popup="eipEEPopup"]');
		const emiUrl = util.getEmiUrl( sharedObj, selectorObj );
		finaceArea.attr('href',emiUrl);
		finaceAreaEE.attr('href',emiUrl);
		buyingToolCalculate.attr('href',emiUrl);
		
	}

	function settingCalculateDraw( sharedObj, selectorObj ) {
		const financeFlag =  sharedObj.financeFlag;
		const financingUrl = sharedObj.financingUrl;
		const siteCode = sharedObj.siteCode;
		const promotionFinancingFlag = sharedObj.promotionFinancingFlag;
		const promotionPrice = sharedObj.totalPrice.sale;
		const util = sharedObj.util;
		const view = sharedObj.view;
		const emiTitle = Granite.I18n.get('Calculate Finance');
		const drawObj = sharedObj.drawObj;
		const emiUrl = util.getEmiUrl( sharedObj, selectorObj );
		

		let hasComponent = false;
		let emiAttr = {};
		
		if(financeFlag === "Y" && financingUrl !== "" && siteCode !== "in" ){
			if( siteCode === "uk" || siteCode === "id" || siteCode === "lt" || siteCode === "lv" || siteCode === "ee" || siteCode === "pl" || siteCode === "hu" || siteCode === "ro" || siteCode === "ua" || siteCode === "ph" || siteCode === "sg" || siteCode === "my" || siteCode === "nz" || siteCode === "sk" || siteCode === "cz"){
				if( promotionFinancingFlag ){
					hasComponent = true;
					emiAttr = util.getAttrCta( emiTitle, emiUrl, '_self', 'js-install-calc', {'layerTarget':'eipPopup'}, '');
				}
			} else{
				hasComponent = true;
				emiAttr = util.getAttrCta( emiTitle, emiUrl, '_self', 'js-install-calc', {'layerTarget':'eipPopup'}, '');
			}
		}
		
		drawObj.calculator = {
			'hasComponent' : hasComponent,
			'emiAttr' : emiAttr
		}
		
		view.emiDraw( drawObj );
	}

	function settingForTradeInPopup( sharedObj, selectorObj, newbirsObj ){
		if( sharedObj.tradeInFlag && !(siteCode === 'uk' && sharedObj.tradeInType === 'CE') ){
			//[CRHQ-6341] Trade-in CX improvement - SEUK
			const tempTitle = $("#tempTitle").val();//CRHQ-8032
			let isCommonTradeinCheck = new window.sg.components.dynamic.BuyingToolOpUtile().isCommonTradeinCheck();//CRHQ-8032
			if(isCommonTradeinCheck){
				new window.sg.components.dynamic.BuyingToolOpUtile().loadComponent("commontradein");
				bc_common_tradeIn.init();
			}else{
				// VD or DA on Standard/Buying PD
				if (sharedObj.ceTradeUpPopup.isEnabled && (tempTitle=="page-buying-pd" || tempTitle=="page-standard-pd")) {
					if ($("#ce-trade-up-popup-section").length === 0) {
						let catId = sharedObj.ceTradeUpPopup.productCategoryGroup;
						new window.sg.components.dynamic.BuyingToolOpUtile().loadComponent("ce-tradeup." + catId);
					}
					window.CeTradeUpPopup.init(sharedObj.modelCode);
				}
				// oterwise
				else {
					tradeinData.setTradein();
				}
			}
		}
	}

	function settingNewHybrisAPI( sharedObj, selectorObj, newbirsObj ){
		newHybrisAjax( sharedObj, selectorObj, newbirsObj, [sharedObj.modelCode], firstNewHybrisAPI, 'firstNewBrisAPI' );
		finishedTotalAPI(sharedObj, selectorObj, newbirsObj);
	}

	function firstNewHybrisAPI( sharedObj, selectorObj, newbirsObj, isSucceed ){
		const drawObj = sharedObj.drawObj;
		const siteCode = sharedObj.siteCode;

		if( isSucceed ){
			changeAPIData( sharedObj, selectorObj, newbirsObj );
			if(siteCode == 'pe' || siteCode == 'mx'){
				settingStockLevel( sharedObj, selectorObj, newbirsObj );
			}
			if(siteCode == 'fr' && sharedObj.hasRentalInstallment || siteCode != 'fr'){
				settingEIPAndUpgradeData( sharedObj, selectorObj, newbirsObj );
			}
			settingInventory( sharedObj, selectorObj, newbirsObj );
			settingAPIprice( sharedObj, selectorObj, newbirsObj );
			sharedObj.util.settingPriceCta( sharedObj.hasPriceCta, sharedObj, selectorObj, sharedObj.currentUrl );
            //CRHQ-5793
			if(siteCode == 'uk'){
                const productsData = newbirsObj.apiData[sharedObj.modelCode];
                if(productsData.backOrderMessage){
                	var backOrderMessage = productsData.backOrderMessage;
                	$(".pd-select-option__eta-text span").text(backOrderMessage);
                	$(".pd-select-option__eta-text").show();
                }else if(productsData.shippingETA){
                	var etaText = productsData.shippingETA;
                	var idx = etaText.lastIndexOf(',');
                	if(idx > 0 ){
                		etaText = etaText.substring(0,idx);
                	}
                	$(".pd-select-option__eta-text span").text(etaText);
                	$(".pd-select-option__eta-text").show();
                }else{
                	$(".pd-select-option__eta-text").hide();
                }
            }
			if( drawObj.price.priceWrapper.hasPriceWrapper ){
				if(siteCode == 'fr'){
					sharedObj.drawObj.offer.headline = Granite.I18n.get('Offer_PD');
				}else{
					sharedObj.drawObj.offer.headline = Granite.I18n.get('Offer');
				}
				settingDelivery( sharedObj, selectorObj, newbirsObj );
				settingTradeIn( sharedObj, selectorObj, newbirsObj );
				settingWarranty( sharedObj, selectorObj, newbirsObj );
				settingWarrantyVd( sharedObj, selectorObj, newbirsObj );
			}
			
			// [EPP] COMP6FE-1619 SIEL Offline   : offline stock  api
			sharedObj.commonApiModel.offlineStockAjax(sharedObj);
			
			sharedObj.util.settingPriceDraw( sharedObj, selectorObj );
			sharedObj.view.productDraw(sharedObj.drawObj);
		}

		finishedTotalAPI( sharedObj, selectorObj, newbirsObj );
	}

	function settingEIPAndUpgradeData( sharedObj, selectorObj, newbirsObj ){
		const apiDomain = sharedObj.apiDomain;
		const siteCode = sharedObj.siteCode;
		const modelCode = sharedObj.modelCode;
		
		let shopParm = '';
		if( $('#shopParmLang').val() ){
			shopParm=`&lang=${$('#shopParmLang').val()}`;
		}

		const apiURL = `${apiDomain}/tokocommercewebservices/v2/${sharedObj.siteCodeWithEpp}/servicesv2/leasingInfoV2?productCode=${modelCode}`+shopParm;
		
		newbirsObj.finishedAPIList.leasing = false;
		var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};

		$.ajax({
			url: apiURL,
			type: 'GET',
			dataType: 'json',
			cache: true,
			xhrFields: _xhrFields,
			crossDomain: true,
			timeout: 20000,
			success : function ( data ) {
				if( data && data.length > 0  ){
					let upgradeFlag = false;
					let minMonthlyPrice = -1;
					let minMonths = -1;
					//nl only 
					if(sharedObj.hasRentalInstallment === true && siteCode == 'nl') {
						//     
						settingRentalInstallment( sharedObj, selectorObj, newbirsObj, data );
					}
					for( const item of data ) {
						if( item.paymentModeType.toUpperCase() === 'UPGRADE' && !upgradeFlag ){
							sharedObj.eupData.salePrice = item.totalCost;
							sharedObj.eupData.monthlyPrice = item.monthly
							sharedObj.eupData.months = item.months;
							settingUpgrade( sharedObj, selectorObj, newbirsObj );
							upgradeFlag = true;
						} else if ( item.paymentModeType.toUpperCase() === 'LEASING' ){
							if( item.monthly && minMonthlyPrice === -1 ){
								minMonthlyPrice = parseFloat( item.monthly );
							}
							if(siteCode == 'nl') {
								if( item.months && minMonths === -1 ){
									minMonths = parseInt( item.months );
								}
								if(item.paymentModeCode === 'nl-evollisPaymentMode') {
									if( item.months && item.monthly && item.interest && parseInt( item.months ) >= minMonths){
										newbirsObj.commonModel.price.leasingInfo.monthlyRate = item.monthly;
										newbirsObj.commonModel.price.leasingInfo.tenureVal = item.months;
										newbirsObj.commonModel.price.leasingInfo.interest = item.interest;
										//console.log("nl-evollisPaymentMode item.interest="+item.interest);
										newbirsObj.commonModel.price.leasingInfo.upfront = item.upfront;
										newbirsObj.commonModel.price.leasingInfo.paymentModeCode = item.paymentModeCode;
										minMonths =  parseInt( item.months );
									}
								}
							} else {
								// 
								if( item.months &&  item.monthly && parseFloat( item.interest ) === 0 && parseFloat( item.monthly ) <= minMonthlyPrice){
									newbirsObj.commonModel.price.leasingInfo.monthlyRate = item.monthly;
									newbirsObj.commonModel.price.leasingInfo.tenureVal = item.months;
									newbirsObj.commonModel.price.leasingInfo.interest = item.interest;
									newbirsObj.commonModel.price.leasingInfo.upfront = item.upfront;
									newbirsObj.commonModel.price.leasingInfo.paymentModeCode = item.paymentModeCode;
									minMonthlyPrice = parseFloat ( item.monthly );
								}
							}
							getPriceData( sharedObj, selectorObj, newbirsObj );
						}
					}
					settingLeasing( sharedObj, selectorObj, newbirsObj );
				}
			},
			error : function( error ){},
			complete : function (){
				newbirsObj.finishedAPIList.leasing = true;
				finishedTotalAPI(sharedObj, selectorObj, newbirsObj);
			} 
		});

		
	}

	function settingWarranty( sharedObj, selectorObj, newbirsObj ){
		if( newbirsObj.commonModel.warrantyData.hasData ){
			const warrantyFlag = sharedObj.warrantyFlag = true;
			const pdProductType = sharedObj.pdProductType;
			const warrantyLearnMoreUrl = sharedObj.warrantyLearnMoreUrl;
			const util  = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			
			let title = Granite.I18n.get('Extended Warranty');
			let description = '';
			let learnMoreTarget = '_self';
			let learnMoreText = '';
			let learnMoreHref = 'javascript:;';
			let learnMoreCta = {};
			let learnMoreClass = '';
			let customsObj = {};
			let yesAttr = {};
			let noAttr = {};
			let eventType = 'warranty';
			
			if( warrantyFlag ){
				$(selectorObj.buyingToolOptWarranty.get(0)).addClass('has-component');
				
				if(warrantyLearnMoreUrl ){
					learnMoreText = Granite.I18n.get("Learn more");
					learnMoreHref = warrantyLearnMoreUrl;
					learnMoreTarget = '_blank';
				}
				
				if (siteCode === "de" && (pdProductType == "TV" || pdProductType == "ETC")){
					title = Granite.I18n.get('Garantieverlngerung');
					description = 'Verlngere die Standard-Herstellergarantie deines Samsung Gerts von 2 auf 5 Jahre';
				} else {
					description = Granite.I18n.get("With Extended Warranty, you can enjoy extra protection for your first 12 months. Be covered for unfortunate incidents that are not included in our standard 2 year warranty.");
					
				}
				
				yesAttr = {
					'class' : 'js-extended-layer cm-s-popup-opener is-async js-warranty-pop',
					'text': Granite.I18n.get('YES'),
					'layerTarget' : 'extendedWarrantyPopup'
				};
				
				noAttr = {
					'class' : 'cm-s-popup-opener',
					'text': Granite.I18n.get('NO'),
					'eventType' : eventType
				};
				
				learnMoreCta= util.getAttrCta ( learnMoreText, learnMoreHref, learnMoreTarget, learnMoreClass, customsObj, '' );
			}
			
			drawObj.warranty = {
				'hasComponent' : warrantyFlag,
				'title' : title,
				'learnMoreCta' :  learnMoreCta,
				'description' : description,
				'yesAttr' : yesAttr,
				'noAttr' : noAttr,
				'subText': ''
			}

			sharedObj.finalWarrantyList = newbirsObj.commonModel.warrantyData.skuData;


			view.productAddOnWarranty( drawObj );
		}
	}
	
	function settingWarrantyVd( sharedObj, selectorObj, newbirsObj ){
		if( newbirsObj.commonModel.warrantyVdData.hasData ){
			const warrantyFlag = sharedObj.useWarrantyVd;
			const pdProductType = sharedObj.pdProductType;
			
			let warrantyVdLearnMoreUrl = "";
			if(siteCode == 'de'){
				warrantyVdLearnMoreUrl = 'https://www.samsung.com/de/offer/garantieverlaengerung';
			}else if(siteCode == 'mx'){// CRHQ-8470
				warrantyVdLearnMoreUrl = 'https://www.samsung.com/mx/support/samsung-care-plus-da';
			}else if(siteCode == 'fr'){// CRHQ-9143
				warrantyVdLearnMoreUrl = 'https://www.samsung.com/fr/shop-faq/extensions-de-garantie/';
			}
			
			const util  = sharedObj.util;
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			
			let title = Granite.I18n.get('Extended Warranty');
			let description = '';
			let learnMoreTarget = '_self';
			let learnMoreText = '';
			let learnMoreHref = 'javascript:;';
			let learnMoreCta = {};
			let learnMoreClass = '';
			let customsObj = {};
			let yesAttr = {};
			let noAttr = {};
			
			if( warrantyFlag ){
				$(selectorObj.buyingToolOptWarrantyVd.get(0)).addClass('has-component');
				
				learnMoreCta = {
					'learnMoreText': Granite.I18n.get("Learn more"),
					'learnMoreHref': warrantyVdLearnMoreUrl,
					'learnMoreTarget': '_blank'
				}
				
				title = Granite.I18n.get('VD_Extended Warranty_Title');
				description = Granite.I18n.get('VD_Extended Warranty_Description');
				
				yesAttr = {
					'text': Granite.I18n.get('VD_Extended Warranty_YES'),
					'layerTarget' : 'ExtendedWarrantyVdPopup'
				};
				
				noAttr = {
					'text': Granite.I18n.get('VD_Extended Warranty_NO')
				};
				
			}
			
			drawObj.warrantyVd = {
				'hasComponent' : warrantyFlag,
				'title' : title,
				'learnMoreCta' :  learnMoreCta,
				'description' : description,
				'yesAttr' : yesAttr,
				'noAttr' : noAttr,
				'subText': ''
			}
			
			view.productAddOnWarrantyVd( drawObj );
		}
	}
	

	function settingUpgrade( sharedObj, selectorObj, newbirsObj ){
		let childCheckList = sharedObj.childCheckList; 
		let eupData = sharedObj.eupData;
		const updradeData = newbirsObj.commonModel.upgradeData;
		const pdUpgradeUseYn = sharedObj.pdUpgradeUseYn;
		const util = sharedObj.util;
		const pdUpgradeLearnMoreUrl = sharedObj.pdUpgradeLearnMoreUrl;
		const pdProductType = sharedObj.pdProductType;
		
		if( updradeData.hasData ){
			sharedObj.upgradeEligible = true;
		
			if( pdUpgradeUseYn === 'Y'){

				if( updradeData.sku ){
					const sku = updradeData.sku;
					childCheckList.push(sku);
					sharedObj.upgradeFlag = true;
					eupData.displayName = newbirsObj.commonModel.product_display_name;
					eupData.sku = sku;
				}
			}
		}

		let isEmbededType = false;
		let title = '';
		let description = '';
		let learnMoreTarget = '_self';
		let learnMoreText = '';
		let learnMoreHref = 'javascript:;';
		let learnMoreCta = {};
		let learnMoreClass = '';
		let customsObj = {};
		let yesAttr = {};
		let noAttr = {};
		let embedData = {};

		if ( sharedObj.upgradeFlag ){
			if(siteCode === 'uk'){
				if( pdUpgradeLearnMoreUrl ){
					learnMoreText = Granite.I18n.get('Learn more');
					learnMoreHref = pdUpgradeLearnMoreUrl;
					learnMoreTarget = '_blank';
				}
			}else if(siteCode === "de"){
				learnMoreText = Granite.I18n.get('Learn more');
				customsObj.layerTarget = 'upgradeLearnMorePopup';
			}
			
			title = Granite.I18n.get('Add Samsung Upgrade Program');
			if(siteCode === 'uk'){
				if(pdProductType !== 'PHONE'){
					description = Granite.I18n.get("Pay for your new TV in monthly installments and be invited to upgrade to the latest TV after months.");
				}else{
					description = Granite.I18n.get('Pay for your new smartphone in monthly instalments and be invited to upgrade to the new smartphone as soon as it launches.');
				}
			}else{
				description = Granite.I18n.get('Pay for your new Galaxy phone in monthly instalments and be invited to upgrade to the new Galaxy as soon as it launches.');
			}
			
			yesAttr = {
				'class' : 'cm-s-popup-opener',
				'text': Granite.I18n.get('YES'),
				'layerTarget' : 'upgradePopup'
			}
			noAttr = {
				'class' : 'cm-s-popup-opener',
				'text': Granite.I18n.get('NO'),
				'eventType' : 'eup',
				'modelCode' : 'upgrade',
				'modelName' : 'upgrade'
			}
			
		}
		
		learnMoreCta= util.getAttrCta ( learnMoreText, learnMoreHref, learnMoreTarget, learnMoreClass, customsObj, '' );
		sharedObj.drawObj.upgrade = {
			'hasComponent' : sharedObj.upgradeFlag,
			'isEmbededType' : isEmbededType,
			'isNotEmbededType' : !isEmbededType,
			'title' : title,
			'learnMoreCta' :  learnMoreCta,
			'description' : description,
			'yesAttr' : yesAttr,
			'noAttr' : noAttr,
			'embedData' : embedData
		}

		// TNC  
		if(sharedObj.upgradeFlag ){
			buyingPdEup.setTncUpgrade();
		}
	}
	
	function settingLeasing( sharedObj, selectorObj, newbirsObj ){
		const siteCode = sharedObj.siteCode;
		const drawObj = sharedObj.drawObj;
		const view = sharedObj.view;
		const isLeasingArea = (siteCode === "be" || siteCode === "be_fr" || siteCode === "nl" || siteCode === "fr");
		
		let noText = Granite.I18n.get('Lease');  //Lease 
		let text = Granite.I18n.get('Purchase');  //Lease 
		
		if(isLeasingArea) {
			 
			let tenureValue = 0;
			let downPayment = newbirsObj.commonModel.price.leasingInfo.upfront;
			let tenureUnit = newbirsObj.commonModel.price.leasingInfo.tenureVal;
			let monthlyRate = newbirsObj.commonModel.price.leasingInfo.monthlyRate;
			let interest = newbirsObj.commonModel.price.leasingInfo.interest;
			let paymentModeCode = newbirsObj.commonModel.price.leasingInfo.paymentModeCode;
			let isViewLease = false;
			//3       
			if(downPayment !=="" && tenureUnit !=="" &&  monthlyRate !=="") {
				isViewLease = true;
			}
			
			drawObj.between = {
					'hasComponent' : isViewLease,
					'purchase' : {
						'text' : text
					},
					'nonPurchase' : {
						'text' : noText,
						'tenureUnit': tenureUnit,
						'tenureValue': tenureValue,
						'monthlyValue' : monthlyRate,
						'paymentValue' : downPayment,
						'paymentModeCode' : paymentModeCode
						
					}
				}
			view.betweenDraw(drawObj);
		}
	}

	//only nl
	function settingRentalInstallment( sharedObj, selectorObj, newbirsObj, data ){
		const siteCode = sharedObj.siteCode;
		const drawObj = sharedObj.drawObj;
		const view = sharedObj.view;
		const isRentalInstallmentArea = ( siteCode === "nl");
		
 		if(isRentalInstallmentArea) {
			
			if(data && data.length > 0 && data[0] && data[0].months){
				setRentalInstallmentMonths(data, sharedObj, selectorObj, newbirsObj );
			}
		}
	}//:~ function settingRentalInstallment( sharedObj, selectorObj, newbirsObj, data ){
	
	//only nl
	function setRentalInstallmentMonths(data, sharedObj, selectorObj, newbirsObj ) {
		const priceCurrency = sharedObj.priceCurrency;
		let tempValueList = [];
		for( const itemIndex in data ) {
			if ( data[itemIndex].paymentModeType.toUpperCase() === 'LEASING'  &&  data[itemIndex].paymentModeCode === 'nl-santanderPayment'){
				tempValueList.push(data[itemIndex]);
			}
		}
		const valueList = tempValueList;
		if(valueList.length > 1){ // values    
			valueList.sort((a,b)=>{
				if(a.months > b.months){
					return -1;
				}
				if(a.months < b.months){
					return 1;
				}
				return 0;
			})

			let monthlyPrice = '';
			let totalCostPrice = '';
			let modelPrice = '';
			
			let infoText = '';
			if(valueList[0].interest && valueList[0].months) {
				infoText = valueList[0].interest+'% Financiering: In '+ valueList[0].months +' termijnen*';
			}
			if(infoText !== '') {
				$('.financing-info-box__contents-info-text').text(infoText);
			}
			if(valueList[0].monthly) {
				monthlyPrice = currencyCommaExcep(parseFloat(valueList[0].monthly).toFixed(2), priceCurrency).replace(".", "");;
				let infoPrice =  monthlyPrice  + ' p/m';
				$('.financing-info-box__contents-info-price').text(infoPrice);
			} else {
				$('.financing-info-box__contents-info-price').remove();
			}
			$('.pd-select-option.financing-info-box-area').show();
			
			if(valueList[0].totalCost) {
				totalCostPrice =  currencyCommaExcep(parseFloat(valueList[0].totalCost).toFixed(2), priceCurrency).replace(".", "");;
			}
			
			//    
			if(newbirsObj.commonModel.price.salePrice.value) {
				modelPrice = currencyCommaExcep(newbirsObj.commonModel.price.salePrice.value, priceCurrency).replace(".", "");;
				
			} else {
				modelPrice = currencyCommaExcep(newbirsObj.commonModel.price.msrpPrice.value, priceCurrency).replace(".", "");;
			}
			
			let detailTable = '';
			detailTable = `<div class="pd-financing-table__table">
		            <div class="pd-financing-table__thead">
		              <div class="pd-financing-table__tr">
		                <div class="pd-financing-table__th">Totale kredietbedrag</div>
		                <div class="pd-financing-table__th">Debet rentevoet op jaarbasis (vast)</div>
		                <div class="pd-financing-table__th">Jaarlijks kosten-percentage</div>
		                <div class="pd-financing-table__th">Termijnbedrag per maand</div>
		                <div class="pd-financing-table__th">Duur krediet-overeenkomst</div>
		                <div class="pd-financing-table__th">Totaal door de consument te betalen bedrag</div>
		              </div>
		            </div>
		            <div class="pd-financing-table__body">
		              <div class="pd-financing-table__tr">
		                <div class="pd-financing-table__td">${modelPrice}</div>
		                <div class="pd-financing-table__td">${valueList[0].interest}%</div>
		                <div class="pd-financing-table__td">${valueList[0].interest}%</div>
		                <div class="pd-financing-table__td">${monthlyPrice}</div>
		                <div class="pd-financing-table__td">${valueList[0].months} Maanden</div>
		                <div class="pd-financing-table__td">${totalCostPrice}</div>
		              </div>
		            </div>
		          </div>`;
		    $('#rentalInstallmentFinancingTable').html(detailTable);
		    //  
		    $('#rentalInstallmentFinancing').show();
		}else if(valueList.length == 1){
			let monthlyPrice = '';
			let totalCostPrice = '';
			let modelPrice = '';
			
			let infoText = '';
			if(valueList[0].interest && valueList[0].months) {
				infoText = valueList[0].interest+'% Financiering: In '+ valueList[0].months +' termijnen*';
			}
			if(infoText !== '') {
				$('.financing-info-box__contents-info-text').text(infoText);
			}
			if(valueList[0].monthly) {
				monthlyPrice = currencyCommaExcep(parseFloat(valueList[0].monthly).toFixed(2), priceCurrency).replace(".", "");
				let infoPrice =  monthlyPrice  + ' p/m';
				$('.financing-info-box__contents-info-price').text(infoPrice);
			} else {
				$('.financing-info-box__contents-info-price').remove();
			}
			$('.pd-select-option.financing-info-box-area').show();
			
			if(valueList[0].totalCost) {
				totalCostPrice =  currencyCommaExcep(parseFloat(valueList[0].totalCost).toFixed(2), priceCurrency).replace(".", "");;
			}
			
			//    
			if(newbirsObj.commonModel.price.salePrice.value) {
				modelPrice = currencyCommaExcep(newbirsObj.commonModel.price.salePrice.value, priceCurrency).replace(".", "");;
				
			} else {
				modelPrice = currencyCommaExcep(newbirsObj.commonModel.price.msrpPrice.value, priceCurrency).replace(".", "");;
			}
			
			let detailTable = '';
			detailTable = `<div class="pd-financing-table__table">
		            <div class="pd-financing-table__thead">
		              <div class="pd-financing-table__tr">
		                <div class="pd-financing-table__th">Totale kredietbedrag</div>
		                <div class="pd-financing-table__th">Debet rentevoet op jaarbasis (vast)</div>
		                <div class="pd-financing-table__th">Jaarlijks kosten-percentage</div>
		                <div class="pd-financing-table__th">Termijnbedrag per maand</div>
		                <div class="pd-financing-table__th">Duur krediet-overeenkomst</div>
		                <div class="pd-financing-table__th">Totaal door de consument te betalen bedrag</div>
		              </div>
		            </div>
		            <div class="pd-financing-table__body">
		              <div class="pd-financing-table__tr">
		                <div class="pd-financing-table__td">${modelPrice}</div>
		                <div class="pd-financing-table__td">${valueList[0].interest}%</div>
		                <div class="pd-financing-table__td">${valueList[0].interest}%</div>
		                <div class="pd-financing-table__td">${monthlyPrice}</div>
		                <div class="pd-financing-table__td">${valueList[0].months} Maanden</div>
		                <div class="pd-financing-table__td">${totalCostPrice}</div>
		              </div>
		            </div>
		          </div>`;
		    $('#rentalInstallmentFinancingTable').html(detailTable);
		    //  
		    $('#rentalInstallmentFinancing').show();
		}
	}//:~ function setRentalInstallmentMonths(data, sharedObj, selectorObj, newbirsObj ) 

	function settingTradeIn( sharedObj, selectorObj, newbirsObj ){
		const util = sharedObj.util;
		const tradeInData = newbirsObj.commonModel.tradeInData;
		const siteCode = sharedObj.siteCode;

		if( tradeInData.hasData ){
			let giveTradeInFlag = false;
			sharedObj.tradeInFlag = true;
			
			//NOTICE :     p6-pre-qa2    (p6-pre-qa    . ,     .)
			if( siteCode === 'uk' ){
				if(window.location.host.indexOf("p6-pre-qa3.")>-1){
					const isVDSTEPBUYING = sharedObj.addonStepBuying04 || sharedObj.addonStepBuying0701;
					const daCategory = (sharedObj.categoryTypeCode === '08030000' || sharedObj.categoryTypeCode === '08010000' || sharedObj.categoryTypeCode === '08070000' || sharedObj.categoryTypeCode === '07010000') ? true : false;
					if( isVDSTEPBUYING || daCategory ){
						sharedObj.tradeInType = 'CE';
						
						// [epp service] TradeIn API     
						//  giveTradeInFlag  true  new-hybris  fr, uk(CE)      api  
						// giveTradeInFlag = true; 
						sielTradeIn.callSkuDevicesAjax(sharedObj);
					}
				}
			}
			
			if( sharedObj.tradeInFlag ){
				//  
				if(siteCode === "in"){
					giveTradeInFlag = true;
				} else if(siteCode === "fr"){
					// [epp service] TradeIn API     
					// giveTradeInFlag = true;
				}
			}
			
			settingForTradeInPopup( sharedObj, selectorObj, newbirsObj );
			
			// [epp service] TradeIn API     
			//  giveTradeInFlag  true  new-hybris  fr, uk(CE)      api      
			// util.settingTradeInDraw( {}, sharedObj, selectorObj, giveTradeInFlag );
		}
	}

	function settingDelivery( sharedObj, selectorObj, newbirsObj ){
		const siteCode = sharedObj.siteCode;
		const drawObj = sharedObj.drawObj;
		const pdProductType = sharedObj.pdProductType;
		const stockLevelStatus = sharedObj.stockLevelStatus;
		const delivery = drawObj.delivery;
		const deliveryYN = sharedObj.deliveryYN;
		const pincodeCookie = $.cookies.get("HA-Deeplink-Zipcode",{domain : ".samsung.com"});
		const util = sharedObj.util;
		
		if( siteCode === 'in' || (siteCode === 'id' && pdProductType === 'PHONE') || (siteCode === 'us' && deliveryYN ) ){
			delivery.hasComponent = true;
			delivery.headline = Granite.I18n.get('Delivery Detail');
			delivery.label = Granite.I18n.get('Enter Zipcode');
			delivery.cancelText = Granite.I18n.get('Delete');
			delivery.enterText = Granite.I18n.get('Search');
			
			/* id() , us  pincode 5  */
			if( siteCode === 'id' ){
				delivery.inputAttr.maxlength = '5';
			} else if( siteCode === 'us'  ){
				delivery.inputAttr.maxlength = '5';
				
				if( pincodeCookie ){
					delivery.inputAttr.value = pincodeCookie;
					sharedObj.view.deliveryDraw(drawObj);
					util.deliveryGetApiData( sharedObj, selectorObj );
				}
				
			} else {
				delivery.inputAttr.maxlength = '6';
			} 
			
			if( stockLevelStatus === 'NOORDER' || stockLevelStatus === 'OUTOFSTOCK' ){
				delivery.labelClass = 'text-field--disabled';
				delivery.ctaClass = 'cta--disabled';
				delivery.inputAttr.disabled = 'true';
			}
		}
	}

	function settingAPIprice( sharedObj, selectorObj, newbirsObj ){
		if( newbirsObj.commonModel.emcomFlag ){
			if( newbirsObj.commonModel.price.msrpPrice.value ){
				sharedObj.hasPriceCta = true;
			}
			//giftCard  0   
			if(newbirsObj.commonModel.price.msrpPrice.value == 0 && sharedObj.categoryTypeCode == '10030000' && sharedObj.siteCode == 'de'){
				sharedObj.hasPriceCta = true;
			}
			sharedObj.proudctEcomFlag = true;
		}

		getPriceData( sharedObj, selectorObj, newbirsObj );
	};
	
	function settingStockLevel( sharedObj, selectorObj, newbirsObj ){
		const apiDomain = ($('#isEppPage').val() === 'true') ? sharedObj.apiDomain : $("#storeWebDomain").val();
		const siteCode = ($('#isEppPage').val() === 'true') ? sharedObj.siteCodeWithEpp : sharedObj.siteCode;
		const modelCode = sharedObj.modelCode;
		const apiURL = `${apiDomain}/tokocommercewebservices/v2/${siteCode}/products/stockinfo?productCodes=${modelCode}`;
		
		newbirsObj.finishedAPIList["stocklevel"] = false;
		$.ajax({
			url: apiURL,
			type: 'GET',
			cache: true,
			crossDomain: true,
			dataType: 'json',
			timeout: 20000,
			success : function (data, status, xhr) {
				if(xhr.status == 200 && data && data.length > 0 && data[0].code == modelCode && data[0].stock.stockLevelStatus.toUpperCase() == 'INSTOCK'){
					if(data[0].stock.stockLevel == 1) {
						sharedObj.stockLevelStatusDisplay = Granite.I18n.get("There is 1 unit available");
					} else if(data[0].stock.stockLevel >= 2 && data[0].stock.stockLevel <= 9) {
						sharedObj.stockLevelStatusDisplay = Granite.I18n.get("There are {0} units available", data[0].stock.stockLevel);
					} else if(data[0].stock.stockLevel >= 10 && siteCode == 'pe') {
						sharedObj.stockLevelStatusDisplay = Granite.I18n.get("More than 10 units available");
					}
				}
			},
			error : function( XMLHttpRequest, textStatus, errorThrown ){},
			complete : function(){
				newbirsObj.finishedAPIList["stocklevel"] = true;
				finishedTotalAPI(sharedObj, selectorObj, newbirsObj);
			}
		});
	};


	function changeAPIData( sharedObj, selectorObj, newbirsObj ){
		const categorySubTypeCode = $("#categorySubTypeCode").val();
		reinitModel( sharedObj, selectorObj, newbirsObj );
		const item = newbirsObj.apiData[sharedObj.modelCode];
		if( item ){
			if( item.stock ){
				newbirsObj.commonModel.stockLevelStatus = item.stock.stockLevelStatus;
				if(item.stock.stockLevelStatus =='lowStock')
					newbirsObj.commonModel.stockLevelStatus =  'INSTOCK';
			}
			if( item.price ){
				newbirsObj.commonModel.price.msrpPrice.value = item.price.value;
				newbirsObj.commonModel.price.msrpPrice.formatted_value = item.price.formattedValue;
			}
			//   lowestWasPrice      
			if(sharedObj.isNewElementLowestWasPrice && item.lowestWasPrice) {
				let tempLowestWasPrice = item.lowestWasPrice ? item.lowestWasPrice.value : 0;
				
				if( item.promotionPrice ){
					//item.promotionPrice     tempLowestWasPrice item.promotionPrice  
					if(tempLowestWasPrice <= item.price.value && tempLowestWasPrice > item.promotionPrice.value) {
						newbirsObj.commonModel.price.msrpPrice.value = item.lowestWasPrice.value;
						newbirsObj.commonModel.price.msrpPrice.formatted_value = item.lowestWasPrice.formattedValue;
						sharedObj.isNewElementLowestWasPriceSetting = true;
					}
				} else {
					//item.promotionPrice     
					if(tempLowestWasPrice <= item.price.value) {
						newbirsObj.commonModel.price.msrpPrice.value = item.lowestWasPrice.value;
						newbirsObj.commonModel.price.msrpPrice.formatted_value = item.lowestWasPrice.formattedValue;
					}
				}
			}
			if( item.promotionPrice ){
				newbirsObj.commonModel.price.salePrice.value = item.promotionPrice.value;
				newbirsObj.commonModel.price.salePrice.formatted_value = item.promotionPrice.formattedValue;
			}
			
			if(siteCode =='nl' || siteCode =='be' || siteCode =='be_fr'){	//20210402  RRP price 
				if( item.backOrderMessage ){
					sharedObj.backOrderMessage = item.backOrderMessage;
				}
				if(item.msrpPrice) {
					//     
					newbirsObj.commonModel.price.listPrice.value = item.msrpPrice.value;
					newbirsObj.commonModel.price.listPrice.formatted_value = item.msrpPrice.formattedValue;
					//let advicePrice = Granite.I18n.get("Listprice") + " " + currencyComma(newbirsObj.commonModel.price.listPrice.value,priceCurrency);
					//$('.pd-buying-price__advice-price').html(advicePrice);
					//$('.pd-buying-price__advice-price').show();
				} else {
					//  
					if( item.promotionPrice < item.price ){
						newbirsObj.commonModel.price.listPrice.value = item.price.value;
						newbirsObj.commonModel.price.listPrice.formatted_value = item.price.formattedValue;
					}
					//$('.pd-buying-price__advice-price').hide();
				}

			}
			
			//COMP6FE-1599 [EPP] SEPOL MSRP Price  : $('#isEppPage').val() === 'true' && siteCode === "pl" 
			if ($('#isEppPage').val() === 'true' && siteCode === "pl"){
				if(item.msrpPrice) {
					newbirsObj.commonModel.price.listPrice.value = item.msrpPrice.value;
					newbirsObj.commonModel.price.listPrice.formatted_value = item.msrpPrice.formattedValue;					
				}
			}
			
			//only co
			if(siteCode =='co') {
				//sharedObj.vatEligible = item.vatEligible;
				//vatEligible true  . 
				if(item.vatEligible && item.vatEligible === true) {
					sharedObj.vatEligible = true;
					//vatFreePrice   
					if(item.vatFreePrice) {
						newbirsObj.commonModel.price.vatFreePrice.value = item.vatFreePrice.value;
						newbirsObj.commonModel.price.vatFreePrice.formatted_value = item.vatFreePrice.formattedValue;
						//pd-buying-price   pd-buying-price--samcol-only  
						$('.pd-buying-price').addClass('pd-buying-price--samcol-only');
						//option    
						$('#option-device-memory-IM003 .pd-option-selector__sub-text').remove();
						//cost-box   cost-box--samcol  
						$('.cost-box').addClass('cost-box--samcol');
					}
				} else {
					sharedObj.vatEligible = false;
				}
			}
			
			//PD gift card  
			if(item.variablePrice) {
				sharedObj.giftCard.maxPrice = item.variablePrice.priceRange.maxPrice.value;
				sharedObj.giftCard.maxPriceFormatted =  item.variablePrice.priceRange.maxPrice.formattedValue;
				sharedObj.giftCard.minPrice = item.variablePrice.priceRange.minPrice.value;
				sharedObj.giftCard.minPriceFormatted = item.variablePrice.priceRange.minPrice.formattedValue;
				sharedObj.giftCard.priceIncrement = item.variablePrice.priceIncrement.value;
				sharedObj.giftCard.priceIncrementFormatted = item.variablePrice.priceIncrement.formattedValue;

			}
			
			//PD EDD  
			sharedObj.blockEddDisplay = item.blockEddDisplay && item.blockEddDisplay != null ? item.blockEddDisplay : "Y"; // blockEddDisplay  N 
			
			if( item.name || sharedObj.displayName ){
				newbirsObj.commonModel.product_display_name = item.name ? item.name : sharedObj.displayName;
			}
			if( item.salesStatus ){
				newbirsObj.commonModel.emcomFlag = item.salesStatus.toUpperCase() === 'PURCHASABLE';
				sharedObj.newHybrisSalesStatus = newbirsObj.commonModel.emcomFlag;
			}
			if( item.backOrderAdditionalText ){
				newbirsObj.commonModel.stockCustomMessage = item.backOrderAdditionalText;
			}
			if(sharedObj.isLowestInstallmentAmount && item.lowestInstallmentAmount && item.lowestInstallmentAmountTenure){
				newbirsObj.commonModel.price.lowestInstallmentAmount = item.lowestInstallmentAmount;
				newbirsObj.commonModel.price.lowestInstallmentAmountTenure = item.lowestInstallmentAmountTenure;
				if(sharedObj.isLowestInstallmentInterest && item.lowestInstallmentInterest ){
					newbirsObj.commonModel.price.lowestInstallmentInterest  = item.lowestInstallmentInterest;
				}
			}
			if( sharedObj.isSECZ){
				if(sharedObj.calculateInstallmentPeriodicValue != 0 && sharedObj.calculateInstallmentPeriod != 0) {
					newbirsObj.commonModel.price.lowestInstallmentAmount = sharedObj.calculateInstallmentPeriod;
					newbirsObj.commonModel.price.lowestInstallmentAmountTenure = sharedObj.calculateInstallmentPeriodicValue;
				}
			}
			var smcCallYn = false;
			if( item.supportedAvailableServices ){
				for(const serviceName of item.supportedAvailableServices ){
					switch ( serviceName.toUpperCase() ) {
						case 'TRADE_IN':
							newbirsObj.commonModel.tradeInData = {
								hasData : true,
								formatted_sales_pitch : '',
								sales_pitch : ''
							}
							break;
						case 'INSURANCE':
							if( typeof configuratorCare )  {
								if(!smcCallYn) { 
									configuratorCare.setProductInfo();
									smcCallYn = true;
								}
							}
							
							break;
						case 'UPGRADE_ENROLLMENT':
							newbirsObj.commonModel.upgradeData.hasData = true;
							break;
						case 'WARRANTY':
							if(sharedObj.useWarrantyVd){
								newbirsObj.commonModel.warrantyVdData = {
										hasData : sharedObj.useWarrantyVd,
										skuData : [{
											discounted_sku  : '',
											price_info  : [{
												msrp_price : {
													value : 0,
													formatted_value : ''
												},
												sale_price  : {
													value : 0,
													formatted_value : ''
												},
												saveText :''
											}],
											custom_properties : {
												plan_inclusions : [],
												plan_exclusions  : []
											}
										}]
									}
							}else{
								newbirsObj.commonModel.warrantyData = {
										hasData : false,
										skuData : [{
											discounted_sku  : '',
											price_info  : [{
												msrp_price : {
													value : 0,
													formatted_value : ''
												},
												sale_price  : {
													value : 0,
													formatted_value : ''
												},
												saveText :''
											}],
											custom_properties : {
												plan_inclusions : [],
												plan_exclusions  : []
											}
										}],
									}
							}
							break;
						case 'SIM_PLAN':
						case 'BROADBAND_PLAN': // CRHQ-9555
							if( typeof tariffData ){
								tariffData.setTariff({"serviceName" : serviceName.toUpperCase()}); // CRHQ-9555
							}
							break;
						case 'INSTALLATION':
							break;
						case 'BENEFIT':
							ajaxNewBrisOffer(sharedObj, selectorObj, newbirsObj);
							break;
						case 'ACCESSORIES':
							const isVDSTEPBUYING = sharedObj.addonStepBuying04 || sharedObj.addonStepBuying0701;
							if( isVDSTEPBUYING && sharedObj.newEmbedVDCountry ){ // new vd
								window.sg.components.dynamic.bridgePageCommon.getRelatedProductsVdSimpleInfo( sharedObj.modelCode );
							} 
							window.sg.components.dynamic.bridgePageCommon.getRelatedProductsSimpleInfo( sharedObj.modelCode );
							break;
						case 'RENTAL':
							//only nl() 
							//leasingInfoV2      
							sharedObj.hasRentalInstallment = true;
							break;							
						case 'POSTAL_CODE':
							const util = sharedObj.util;
							const siteCode = sharedObj.siteCode;
							const deliverySiteCode = sharedObj.deliveryPickup.deliverySiteCode;
							if(deliverySiteCode.includes(siteCode)){
								$(".pd-select-option--delivery-pickup").show();
								util.settingDeliveryPickup(sharedObj, selectorObj);
							}
							break;
						default:
							break;
					}
				}
			}

			const aemAdditionalInfoTypes = item.aemAdditionalInfoTypes;

			if( aemAdditionalInfoTypes && aemAdditionalInfoTypes.length > 0 ){
				
				var planIDAndFreeGiftPromotionUnAvailable = false;
				var tradeInAndFreeGiftPromotionUnAvailable = false;
				//CRHQ-8944 [B2C][MX][DE] Stackable Trade-In FOC   
				var stackableTradeInAndFreeGiftPromotionUnAvailable = false;
				var giftSelectionSkipPlanIdList = [];
				for( const additionalInfo of aemAdditionalInfoTypes ){
					const type = additionalInfo.type ? additionalInfo.type.toUpperCase() : '';
					if( type === 'VOUCHER' ){
						sharedObj.voucherdataHybris = additionalInfo.aemAdditionalInfos;
						sharedObj.hasVoucher = true;
						window.sg.components.dynamic.bridgePageCommon.getRelatedProductsSimpleInfo( sharedObj.modelCode );
					} else if( type === 'GIFT' ){
						sharedObj.giftdataHybris = additionalInfo.aemAdditionalInfos;
						sharedObj.hasGift = true;
						sharedObj.hasGiftPage = true; // CRHQ-8914 [B2C][MX][DE] [SIM-Service] customize free-gift based on the planID
						window.sg.components.dynamic.freeGiftHybrisCommon.getRelatedProductsSimpleInfo( sharedObj.modelCode );
					} else if( type === 'VDCOMBOMESSAGE' ){
						sharedObj.vdcombodataHybris = additionalInfo.aemAdditionalInfos;
					} else if ( type === 'BOGO' && additionalInfo.aemAdditionalInfos && additionalInfo.aemAdditionalInfos.length > 0 ){
						for( const item of additionalInfo.aemAdditionalInfos ){
							if( item.key === 'skuPrice' ){
								newbirsObj.commonModel.bogoData.bogoPrice = item.value;
							} else if ( item.key === 'skuCode' ){
								newbirsObj.commonModel.bogoData.bogoSku = item.value;
							}
						}
						
					} else if ( type === 'UPGRADE_SKU' && additionalInfo.aemAdditionalInfos && additionalInfo.aemAdditionalInfos.length > 0 ){
						for( const item of additionalInfo.aemAdditionalInfos ){
							if( item.key === 'upgradeSKU' ){
								newbirsObj.commonModel.upgradeData.sku = item.value;
							}
						}
					}else if ( type === 'SPECIALPRICEVALIDITY' ){
						if ( siteCode === 'ee' || siteCode === 'lv' || siteCode === 'lt' ){
							for( const item of additionalInfo.aemAdditionalInfos ){
								if( item.key && item.key.toUpperCase() === 'SPECIALPRICEVALIDITYPERIOD' ){
									sharedObj.proudctPriceInfo.salesPitch = item.value;
								}
							}
						}
					}else if ( type === 'PLANIDANDFREEGIFTPROMOTIONUNAVAILABLE' ){
						planIDAndFreeGiftPromotionUnAvailable = true;
						for( const item of additionalInfo.aemAdditionalInfos ){
							if(item.planIdList && item.planIdList.length > 0){ // CRHQ-7126
								giftSelectionSkipPlanIdList.push(...item.planIdList);
							}
						}
					}else if ( type === 'TRADEINFREEGIFTPROMOTION' ){
						tradeInAndFreeGiftPromotionUnAvailable = true;
					}else if (type === 'SELLING_WITH_BEZEL'){
						const util = sharedObj.util;
						sharedObj.sellingWithBazel = additionalInfo.aemAdditionalInfos[0].value == "true" ? true : false;
						sharedObj.useBezelOptionDraw = true;
						window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjax(sharedObj.modelCode, function (data, isSuccess) {
							var bezelType = '';
							var noneTypeList = [];
							var modernTypeList = [];
							var beveledTypeList = [];
							var freestyleList = [];

							if (isSuccess && data.products != null && data.products.length > 0) {
								$.each(data.products, function (idx, obj) {
									var bezelType = obj.aemAdditionalInfoTypes[0].aemAdditionalInfos[0].value === "true" ? obj.aemAdditionalInfoTypes[0].aemAdditionalInfos[0].key.toUpperCase() : '';
									var hasImage = obj.picture.url != "" ? true : false;
									var hasNotImage = obj.picture.url == "" ? true : false;
									var bezelImageUrl = obj.picture.url.replace("$ORIGIN_PNG$","");
									var bezelStock = obj.stock.stockLevelStatus.toUpperCase();
									var disabledClass = " is-disabled";
									if(bezelStock == "INSTOCK" || bezelStock == "BACKORDERED" || bezelStock == "PREORDER" || bezelStock == "LOWSTOCK"){
										disabledClass = "";
									}
									if(sharedObj.bezelImageClass == ""){
										if(hasImage){
											sharedObj.bezelImageClass = "pd-select-option__list--image-button";
										}
									}
									var bezelObj = {
											'index' : idx,
											'modelCode' : obj.modelcode,
											//'modelPatternCode' : '',
											'name' : obj.colorName,
											'value' : obj.colorCode,
											'hasImage' : hasImage,
											'hasNotImage' : hasNotImage,
											'imageUrl' : bezelImageUrl,
											'disabledClass' : disabledClass
										};
									if(bezelType === 'BEZEL_COLOR'){
										noneTypeList.push(bezelObj);
									}else if(bezelType === 'BEZEL_MODERN'){
										modernTypeList.push(bezelObj);
									}else if(bezelType === 'BEZEL_BEVELLED'){
										beveledTypeList.push(bezelObj);
									}else if(bezelType === 'FREESTYLE_COLOR'){
										freestyleList.push(bezelObj);
									}
									
								});
							}
							sharedObj.noneTypeList = noneTypeList;
							sharedObj.modernTypeList = modernTypeList;
							sharedObj.beveledTypeList = beveledTypeList;
							sharedObj.freestyleList = freestyleList;
							util.settingBezelOptionDraw( sharedObj, selectorObj );
						}, null, {"queryType":"ADD_COLOR_FOR_VD"});
					}
					
					//[EPP] &EPPONLY CRHQ-7126 SEG     Gift skip  
					if($('#isEppPage').val() === 'true' && siteCode === 'de'){
						if ( type === 'TRADEINFREEGIFTPROMOTION' ){
							tradeInAndFreeGiftPromotionUnAvailable = false;
							for( const item of additionalInfo.aemAdditionalInfos ){
								if( item.key && item.key.toLowerCase() === 'tradeinandfreegiftpromotionunavailable' ){
									tradeinandfreegiftpromotionunavailable = JSON.parse(item.value);
								}
							}
						}
					}
					//CRHQ-8944 [B2C][MX][DE] Stackable Trade-In FOC   
					if(siteCode === 'de'){
						if ( type === 'STACKABLETRADEINFREEGIFTPROMOTION' ){
							stackableTradeInAndFreeGiftPromotionUnAvailable = false;
							for( const item of additionalInfo.aemAdditionalInfos ){
								if( item.key && item.key.toLowerCase() === 'stackabletradeinandfreegiftpromotionunavailable' ){
									stackableTradeInAndFreeGiftPromotionUnAvailable = JSON.parse(item.value);
								}
							}
						}
					}

				}
				// CRHQ-5597 [B2C][BC][IM] DE SIM     split : sim,gift
				if(sharedObj.hasGift == true && planIDAndFreeGiftPromotionUnAvailable){
					sharedObj.hasPlanIDAndFreeGiftPromotion = true;
					//CRHQ-7126
					sharedObj.giftSelectionSkipPlanIdList = giftSelectionSkipPlanIdList;
				}
				// CRHQ-7126-2
				if(sharedObj.hasGift == true && tradeInAndFreeGiftPromotionUnAvailable) {
					sharedObj.hasTradeInFreeGiftPromotion = true;
				}
				//CRHQ-8944 [B2C][MX][DE] Stackable Trade-In FOC   
				if(sharedObj.hasGift == true && stackableTradeInAndFreeGiftPromotionUnAvailable) {
					sharedObj.hasStackbleTradeInFreeGiftPromotion = true;
				}
			}
			
			//23.01.17 [EPP] O2O  : walk out, home delivery qty  
			// 1. o2o   
			// 2. shop api  "warehouse" property    isOnline stock level  
			//    isOnline : false(walk out), true(home delivery)
			if( $('#isEppPage').val() === 'true' && window.sg.epp && window.sg.epp.common && window.sg.epp.common.isPosStore){
				sharedObj.walkoutQty = 0;
				sharedObj.homeDeliveryQty = 0;
				if ( item.stock && item.stock.warehouse && item.stock.warehouse != null ){
					item.stock.warehouse.forEach(function(qtyObj, idx){
						if ( qtyObj.isOnline ) {
							sharedObj.homeDeliveryQty += ( qtyObj.stockLevel && qtyObj.stockLevel != null) ? qtyObj.stockLevel : 0;
						} else {
							sharedObj.walkoutQty += ( qtyObj.stockLevel && qtyObj.stockLevel != null) ? qtyObj.stockLevel : 0;
						}
					});
				}
			}			
		}
	}
	
	function ajaxNewBrisOffer( sharedObj, selectorObj, newbirsObj ){
		const apiDomain = sharedObj.apiDomain;
		const siteCode = sharedObj.siteCode;
		const modelCode = sharedObj.modelCode;
		const priceCurrency = sharedObj.priceCurrency;
		
		let shopParm = '';
		if( $('#shopParmLang').val() ){
			shopParm=`&lang=${$('#shopParmLang').val()}`;
		}

		const apiURL = `${apiDomain}/tokocommercewebservices/v2/${sharedObj.siteCodeWithEpp}/products/${modelCode}/offers?fields=SIMPLE_INFO`+shopParm;
		
		newbirsObj.finishedAPIList.offers = false;
		
		


		$.ajax({
			url: apiURL,
			type: 'GET',
			dataType: 'json',
			cache: true,
			xhrFields: { withCredentials: true },
			crossDomain: true,
			timeout: 20000,
			success : function ( data, responseText, jqXHR ) {
				if( data && data.benefits && data.benefits.length > 0 ){
					if( sharedObj.isSECZ){
						//     . 
						if(sharedObj.calculateInstallmentPeriod !== 0) {
							console.log("ajaxNewBrisOffer periodicValue: " + sharedObj.calculateInstallmentPeriodicValue);
							console.log("ajaxNewBrisOffer period: " + sharedObj.calculateInstallmentPeriod);
							let benefit = {
								code : 'Finanace -Calculator',
								description : ''+Granite.I18n.get('product detail offer emi From {0}/mo', currencyComma(sharedObj.calculateInstallmentPeriodicValue,priceCurrency)) +'',
								endDate : null,
								startDate : null,
								type : 'INSTALLMENT',
								count : 1
							};
							data.benefits.unshift(benefit);
						}
					}
					
					settingPomoData ( data.benefits, sharedObj, selectorObj, newbirsObj );
				} else {
					//offers    
					if( sharedObj.isSECZ){
						if(sharedObj.calculateInstallmentPeriod !== 0) {
							//NOTICE : EMI    
							//TODO : description sk, cz     
							console.log("ajaxNewBrisOffer periodicValue: " + sharedObj.calculateInstallmentPeriodicValue);
							console.log("ajaxNewBrisOffer period: " + sharedObj.calculateInstallmentPeriod);
							data.benefits  = [{
								code : 'Finanace -Calculator',
								description : ''+Granite.I18n.get('product detail offer emi From {0}/mo', currencyComma(sharedObj.calculateInstallmentPeriodicValue,priceCurrency)) +'',
								endDate : null,
								startDate : null,
								type : 'INSTALLMENT',
								count : 1
							}];
							settingPomoData ( data.benefits, sharedObj, selectorObj, newbirsObj );
						}
					}
				}
			},
			error : function( XMLHttpRequest, textStatus, errorThrown ){},
			complete : function (){
				newbirsObj.finishedAPIList.offers = true;
				
				//CRHQ-8807 [B2C] Package PD   - offer  
				const pdPackageYn = sharedObj.pdPackageYn;
                const childCnt = sharedObj.pdChildModelCnt;
							
                if(pdPackageYn && childCnt > 0)
                    ajaxNewBrisChildOffer(sharedObj, selectorObj, newbirsObj);
                else
                    newbirsObj.finishedAPIList.childOffers = true;
                
				finishedTotalAPI(sharedObj, selectorObj, newbirsObj);

			} 
		});
	}
	
	 /*CRHQ-8807 add packageYn = 'Y'  childModelList offer API */
	function ajaxNewBrisChildOffer( sharedObj, selectorObj, newbirsObj ){
        const offerView = sharedObj.drawObj.offer;
		const apiDomain = sharedObj.apiDomain;
		const siteCode = sharedObj.siteCode;
		const modelCode = sharedObj.modelCode;

        let shopParm = '';
		if( $('#shopParmLang').val() ){
			shopParm=`&lang=${$('#shopParmLang').val()}`;
		}
      
        const packageYn = sharedObj.pdPackageYn;
        const childCnt = sharedObj.pdChildModelCnt;

        const childModelList = [];
        newbirsObj.finishedAPIList.childOffers = false;
        
        if(childCnt > 0){

            let childOfferOrder = 0;
            for(let i=0; i < childCnt ; i++){
                
                //let childId = $("pdChidleModel0" + (i+1));
                let childId = document.querySelector("#pdChidleModel0" + (i+1));
                let childCode = childId.dataset.code;
                let childName = childId.dataset.name;
                let childMain = childId.dataset.main;
                let childDisplayName = childId.dataset.displayName;
                let childSet = {"code":childCode, "name":childName, "main":childMain, "displayName":childDisplayName};
                
                //childModelList.push(childSet);
                sharedObj.pdChildModelList.push(childSet);

                const apiURL = `${apiDomain}/tokocommercewebservices/v2/${sharedObj.siteCodeWithEpp}/products/${childCode}/offers?fields=SIMPLE_INFO`+shopParm;

                // ajax     async:false    return
                (function(i) {
            		$.ajax({
            			url: apiURL,
            			type: 'GET',
            			dataType: 'json',
            			cache: true,
                        async:false, 
            			xhrFields: { withCredentials: true },
            			crossDomain: true,
            			timeout: 20000,
            			success : function ( data, responseText, jqXHR ) {
            				if( data && data.benefits && data.benefits.length > 0 ){
    
                              if(childOfferOrder === 0)
                              {
                                offerView.childList = [];
                              }
    
                              let tempChildOffer = {
                                    'hasComponent' : true,
                                    'childCode' : childSet.code,
                                    'displayName' : childSet.displayName,
                                    'combo' : [],
                                    'gift' : {},
                                    'bogo' : {},
                                    'promotionMessage' : [],
                                    'promotionFinance' : [],
                                    'promotionSmartclub' : []
                                }
    
                                offerView.childList.push(tempChildOffer);
    
            					settingChildPomoData (data.benefits, sharedObj, selectorObj, newbirsObj, childOfferOrder);
                                childOfferOrder = offerView.childList.length;
                                //childOfferOrder = childOfferOrder + 1;
      
            				}
            			},
            			error : function( XMLHttpRequest, textStatus, errorThrown ){},
            			complete : function (){
    
                          if(i === (childCnt-1)){
    
                            newbirsObj.finishedAPIList.childOffers = true;
                          
                          }    
            			
                          finishedTotalAPI(sharedObj, selectorObj, newbirsObj);
            			} 
            		});
                  
                })(i);
            }

        }
    
	}

	function settingPomoData ( promotionData, sharedObj, selectorObj, newbirsObj ){
		newbirsObj.comboCount = 0;

		if( promotionData && promotionData.length > 0 ){
			for( const index in promotionData ){
				const promotion = promotionData[index];
				const type = promotion.type ? promotion.type.toUpperCase() : "";
				if( type === "COMBO"){
					newbirsObj.finishedAPIList.comboAPIFlag = false;
					newbirsObj.comboCount++;

					sharedObj.commonApiModel.callRelatedAndSearch( sharedObj.modelCode, settingCombo, { sharedObj, promotion, newbirsObj, selectorObj }, { 'queryType' : 'SELECTION_OF_BUNDLE'} );

				} else if( type === "INSTALLMENT" ){
					settingFinance( promotion, index, sharedObj, selectorObj, newbirsObj );
				} else if (type === "BOGO"){
					settingBogo( promotion, index, sharedObj, selectorObj, newbirsObj );
				} else if( !type ){
					settingPomoMessage( promotion, index, sharedObj, selectorObj, newbirsObj );
				}
			}
		}
	}
	
	/*CRHQ-8807 add API   */
	function settingChildPomoData (promotionData, sharedObj, selectorObj, newbirsObj, ord){

        let offerGubun = "child";
		newbirsObj.comboCount = 0;

		if( promotionData && promotionData.length > 0 ){

			let childIndex = 0;
			for( const index in promotionData ){
              const promotion = promotionData[index];
    		  const type = promotion.type ? promotion.type.toUpperCase() : "";

              //INSTALLMENT, COMOBO     count  - child offer  3 
    		  if(type !== "INSTALLMENT" && type !== "COMBO"){
                  childIndex = childIndex + 1;
              }
              
              if(childIndex < 4){
                    let htmlIndex = ord + '' + childIndex;
                    
    				if (type === "BOGO"){
    					settingBogo(promotion, htmlIndex, sharedObj, selectorObj, newbirsObj, 'child', ord);
    				} else if( !type ){
    					settingPomoMessage(promotion, htmlIndex, sharedObj, selectorObj, newbirsObj, 'child', ord);
    				}
                
              }
				
			}
			
			//INSTALLMENT, COMBO  offer  ..
            if(childIndex  === 0) {
                let arrChild = sharedObj.drawObj.offer.childList;
                arrChild.splice(ord);
                //arrChild.pop();
            }
		}
	}
	
	/*CRHQ-8807 child offer  offerGubun, ord   */
	function settingBogo ( promotion, index, sharedObj, selectorObj, newbirsObj, offerGubun='product', ord=0 ){
		let offerView = sharedObj.drawObj.offer;
		//CRHQ-8807
		if(offerGubun === 'child')
	          offerView = sharedObj.drawObj.offer.childList[ord];
		
		const util = sharedObj.util;
		const pcPath = promotion.image && promotion.image.url ? promotion.image.url : '';
		const alt = promotion.image && promotion.image.altText ? promotion.image.altText : '';
		const customsObj = { 'classWapper' : 'image__main responsive-img' };
		const priceCurrency = sharedObj.priceCurrency;
		const pdTimeformatFront = sharedObj.pdTimeformatFront;
		const oriItem = newbirsObj.apiData[sharedObj.modelCode];

		let imgAttr = util.getImgAttr ( pcPath, pcPath, alt, customsObj );

		let mainDec = [];
		let bodoDate = '';
		
		if(promotion.description ){
			mainDec.push( {'text' : promotion.description});
		}

		if( promotion.startDate && promotion.endDate ){
			if( pdTimeformatFront ){
				bodoDate = dateFormat(promotion.startDate.split('T')[0], pdTimeformatFront) + ' ~ ' + dateFormat(promotion.endDate.split('T')[0], pdTimeformatFront);
			}else{
				bodoDate = promotion.startDate.split('T')[0] + ' ~ ' + promotion.endDate.split('T')[0];
			}
		}

		let originalPrice = '';
		let savePrice = '';
		let nowPrice = '';
		let price = newbirsObj.commonModel.bogoData.bogoPrice;
		
		if( price){
			originalPrice = currencyComma(price, priceCurrency);
			if(siteCode !== 'nl' && siteCode !== 'be' && siteCode !== 'be_fr'){
				savePrice = Granite.I18n.get( 'Save {0}', originalPrice);
			}
			nowPrice = currencyComma(0, priceCurrency);

		} else{
			nowPrice = currencyComma(0, priceCurrency);
		}
		//COMP6FE-1599 [EPP] SEPOL MSRP Price  : $('#isEppPage').val() === 'true' && siteCode === "pl" 
		if ($('#isEppPage').val() === 'true' && site: 'bogo',
			'hasItem' : true,
			'item' : {
				'contentWrapperClass' : 'bogo-item',
				'headline' : Granite.I18n.get('Buy 1 Get 1 Free'),
				'description' : {
					'hasDescription' : true,
					'main' : mainDec,
					'date' : bodoDate
				},
				'imgAttr' : imgAttr,
				'price' : {
					'hasPrice' : true,
					'price' : price,
					'original' : originalPrice,
					'save' : savePrice,
					'now' : nowPrice
				}
			}
		}
		
		offerView.bogo = thisTotalItem;
	}

	function settingCombo( result, isSuccess, returnParam ){

		const sharedObj = returnParam.sharedObj;
		const drawObj = sharedObj.drawObj;
		const comboFlag = sharedObj.comboFlag = true;
		const offerView = drawObj.offer;
		const offerList = offerView.combo;
		const util = sharedObj.util;
		const view = sharedObj.view;
		const promotion = returnParam.promotion;
		const pdTimeformatFront = sharedObj.pdTimeformatFront;
		const iconData = getIconData( promotion,sharedObj );
		const selectorObj = returnParam.selectorObj;
		const newbirsObj = returnParam.newbirsObj;
		const siteCode = sharedObj.siteCode;

		let learnMoreCta = {};
		let comboDate = '';
		let iconImgName = '';

		
		if( comboFlag ){
			
			if( iconData.promoIconFlag ){
				iconImgName = iconData.iconImgName;
			}

			let mainDec = [];
			if(promotion.description ){
				mainDec.push( {'text' : promotion.description });
			}else{
				mainDec.push( {'text' : Granite.I18n.get('Select combo bundle option') });
			}
			
			var customsObj = {};
			customsObj.layerTarget = 'shopComboPopup';
			customsObj['comboIdx'] = sharedObj.globalComboData.length;
			learnMoreCta = util.getAttrCta ( Granite.I18n.get('ADD TO ORDER'), 'javascript:;', '_self', 's-btn-combo-popup', customsObj,'' );
			
			if( promotion.startDate && promotion.endDate ){
				if( pdTimeformatFront ){
					comboDate = dateFormat(promotion.startDate.split('T')[0], pdTimeformatFront) + ' ~ ' + dateFormat(promotion.endDate.split('T')[0], pdTimeformatFront);
				}else{
					comboDate = promotion.startDate.split('T')[0] + ' ~ ' + promotion.endDate.split('T')[0];
				}
				//CRHQ-8732 [B2C] ID - combo  date format 
				if(siteCode === 'id'){
					comboDate = promotion.startDate.split('T')[0] + ' ~ ' + promotion.endDate.split('T')[0];
				}
			}

			const thisTotalItem = {
				'title' : 'compoBundle',
				'comboIndex' : sharedObj.globalComboData.length,
				'hasItem' : true,
				'item' : {
					'headline' : Granite.I18n.get('Bundle options'),
					'iconName' : iconImgName,
					'description' : {
						'hasDescription' : true,
						'main': mainDec,
						'date': comboDate
					},
					'learnMoreCta' : learnMoreCta
				}
			}
			
			offerList.push(thisTotalItem);
		}
			
		view.productOfferDraw(drawObj, true);

		result = window.sg.components.dynamic.comboPopup.setComboData(result.totalResult);
		sharedObj.globalComboData.push(result);

		if( newbirsObj.comboCount === sharedObj.globalComboData.length ){
			newbirsObj.finishedAPIList.comboAPIFlag = true;
		}

		finishedTotalAPI(sharedObj, selectorObj, newbirsObj);
			
	}



	function getIconData( promotion, sharedObj ){
		const promotionImgTypeList = sharedObj.promotionImgType ? sharedObj.promotionImgType.split(',') : [];
		
		let iconAlt = '';
		let promoIconFlag =  false;
		let iconImgName = '';

		if( promotion.image ){
			iconAlt = promotion.image.altText;
			iconImgName = promotion.image.url;
			if( iconImgName ){
				for( const name of promotionImgTypeList ){
					if( name === iconImgName ){
						promoIconFlag = true;
						break;
					}
				}
			}
		}

		return {
			iconAlt, promoIconFlag, iconImgName
		}
	}

	function settingFinance( promotion, index, sharedObj, selectorObj, newbirsObj ){
		const drawObj = sharedObj.drawObj;
		const siteCode = sharedObj.siteCode;
		const offerView = drawObj.offer;
		const emiCalculatorUrl = sharedObj.financingUrl;
		const iconData = getIconData( promotion, sharedObj );
		const iconAlt = iconData.iconAlt;
		//const promoIconFlag = iconData.promoIconFlag;
		//const iconImgName = iconData.iconImgName;
		const promoIconFlag = true;
		const iconImgName = 'finance';
		
		let contentWrapperClass = 'offer-emi emi-index-'+index;
		let emiMessage = [];
		let imgSrc = '';
		let rowText = [];
		let rowTextContent = '';
		
		sharedObj.financingEligible = true;
		
		if( emiCalculatorUrl ){
			sharedObj.emiCalculatorUrl = emiCalculatorUrl;
		}
		
		 
		
		if(promotion.description){
			emiMessage.push( promotion.description);

			//      static       
			//const temp = '<p>From 32.75/month. <u>Calculate Finance</u></p>';
			//emiMessage.push( temp);
		}
		
		if( emiMessage.length > 0 ){
			
			if( promoIconFlag ){
				imgSrc = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/promotion_icon/'+ iconImgName +'.svg';
				rowTextContent +='<div class="pd-offer__image-icon">';
				rowTextContent +=	'<div class="image">';
				rowTextContent +=		'<img class="image__preview lazy-load" data-src="'+imgSrc+'?$LazyLoad_Home_PNG$" alt="'+iconAlt+'">';
				rowTextContent +=		'<img class="image__main lazy-load" data-src="'+imgSrc+'?$48_48_PNG$" alt="'+iconAlt+'">';
				rowTextContent +=	'</div>';
				rowTextContent +='</div>';
			}
			rowTextContent += '<div class="pd-offer-desc">';
			if( siteCode === 'id' || siteCode === 'ee' || siteCode === 'lt' || siteCode === 'lv' || siteCode === 'pl'){
				if(promotion.description) {
					rowTextContent +='<strong class="pd-offer__desc-title">'+promotion.description+'</strong>';
				}
				
			}
			rowTextContent += 	'<div class="pd-offer__cta">';
			/* EMI Type */
			if( siteCode === 'in' || siteCode === 'uk' || siteCode === 'lt' || siteCode === 'id' || siteCode === 'lv' || siteCode === 'ee' || siteCode === 'pl' || siteCode === 'hu' || siteCode === 'ro' || siteCode === 'ua' || siteCode === "ph" || siteCode === "sg" || siteCode === "my" || siteCode === "nz" || siteCode === "sk" || siteCode === "cz"){
				sharedObj.promotionFinancingFlag = true;
				for( var jdx=0; jdx < emiMessage.length; jdx++ ){
					let emiText = emiMessage[jdx].replace('<u>','').replace('</u>','');
					if( emiText.indexOf('<a') < 0 ){
						if( siteCode === 'in' ){
							rowTextContent += '<strong class="pd-offer__title-text">';
							rowTextContent += emiText +' <br/> EMI also available on Debit cards <br/> ';
							rowTextContent += '<a class="cta cta--underline cta--black add-special-tagging" href="javascript:void(0);" data-target-popup="eipPopup" aria-haspopup="dialog" role="button"'+
									'an-tr="header(pim)_offer option-'+sharedObj.pageTrackPd+'-cta-title"'+
									'an-ca="option click"'+
									'an-ac="pd buying tool"'+
									'an-la="offer:'+emiText.toLowerCase()+':learn more">' + Granite.I18n.get('Learn more') + '</a>';
							rowTextContent += '</strong>';
						} else {
							if( siteCode === 'id' || siteCode === 'ee' || siteCode === 'lt' || siteCode === 'lv' || siteCode === 'pl') {
								rowTextContent += '<a class="cta cta--underline cta--black add-special-tagging" href="javascript:void(0);" data-target-popup="eipPopup" aria-haspopup="dialog" role="button"'+
								'an-tr="header(pim)_offer option-'+sharedObj.pageTrackPd+'-cta-title"'+
								'an-ca="option click"'+
								'an-ac="pd buying tool"'+
								'an-la="offer:'+emiText.toLowerCase().replace(/\"/g,"")+':learn more">' + Granite.I18n.get('Learn more') + '</a>';								
							} else {
								// (uk style, ua   )
								rowTextContent += '<a class="cta cta--underline cta--black add-special-tagging" href="javascript:void(0);" data-target-popup="eipPopup" aria-haspopup="dialog" role="button"'+
								'an-tr="header(pim)_offer option-'+sharedObj.pageTrackPd+'-cta-title"'+
								'an-ca="option click"'+
								'an-ac="pd buying tool"'+
								'an-la="offer:'+emiText.toLowerCase().replace(/\"/g,"")+':learn more">' + emiText + '</a>';
							}
						}
					} else {
						rowTextContent += '<strong class="pd-offer__title-text">';
						rowTextContent+=emiText;
						rowTextContent += '</strong>';
					}
				}
			} else {
				rowTextContent += '<strong class="pd-offer__title-text">';
				for(var mIndex=0; mIndex<emiMessage.length; mIndex++){
					rowTextContent += emiMessage[mIndex];
				}
				rowTextContent += '</strong>';
			}
			rowTextContent += 	'</div>';
			rowTextContent += '</div>';
			rowText.push({ 'target' : '.'+ contentWrapperClass.replace(' ','.'), 'text' : rowTextContent});
			
			offerView.promotionFinance.push({
				'title' : 'finance',
				'hasItem' : true,
				'item' : {
					'contentWrapperClass' : contentWrapperClass,
					'iconAttr' : {
						'src' : imgSrc,
						'alt' : iconAlt
					},
					'description' : {
						'hasDescription' : true
					},
					'rowText' : rowText
				}
			});
		}
	}
	/*CRHQ-8807 child offer  offerGubun, ord   */
	function settingPomoMessage( promotion, index, sharedObj, selectorObj, newbirsObj, offerGubun='product', ord=0 ){
		const drawObj = sharedObj.drawObj;
		let offerView = drawObj.offer;
		
		//CRHQ-8807
		if(offerGubun === 'child')
	          offerView = sharedObj.drawObj.offer.childList[ord];
		
		const iconData = getIconData( promotion, sharedObj );
		const iconAlt = iconData.iconAlt;
		const promoIconFlag = iconData.promoIconFlag;
		const iconImgName = iconData.iconImgName;
		
		let contentWrapperClass = 'offer-promotion promotion-index-'+index;
		let promotionMessage = [];
		let imgSrc = null;
		let rowText = [];
		let rowTextContent = '';
		
		if(promotion.description){
			promotionMessage.push(promotion.description);
		}
		
		if( promoIconFlag ){
			imgSrc = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/promotion_icon/'+ iconImgName +'.svg';
		}
		
		for(var jdx=0; jdx<promotionMessage.length; jdx++){
			rowTextContent += promotionMessage[jdx].replace('<a', '<a target=\'_blank\'');
		}
		
		rowText.push({ 'target' : '.'+ contentWrapperClass.replace(' ','.') + ' .pd-offer__desc', 'text' : rowTextContent});
		
		offerView.promotionMessage.push({
			'title' : 'promoMessage',
			'hasItem' : true,
			'item' : {
				'contentWrapperClass' : contentWrapperClass,
				'isIcon' : true,
				'iconAttr' : {
					'src' : imgSrc,
					'alt' : iconAlt
				},
				'description' : {
					'hasDescription' : true
				},
				'rowText' : rowText
			}
		});
	}

	function reinitModel( sharedObj, selectorObj, newbirsObj ){
		newbirsObj.commonModel.price = {
			listPrice : {
				value : 0,
				formatted_value : ''
			},
			vatFreePrice : {
				value : 0,
				formatted_value : ''
			},
			msrpPrice : {
				value : 0,
				formatted_value : ''
			},
			salePrice : {
				value : 0,
				formatted_value : ''
			},
			leasingInfo : {
				monthlyRate : '',
				tenureVal : ''
			},
			saveText :'',
			tradeInPriceText : ''
		};
		newbirsObj.commonModel.tariffData = [];
		newbirsObj.commonModel.promotionsMsg = [];
	}

	function settingInventory( sharedObj, selectorObj, newbirsObj ){
		const drawObj = sharedObj.drawObj;
		const model = newbirsObj.commonModel;
		const siteCode = sharedObj.siteCode;
		const proudctPriceInfo = sharedObj.proudctPriceInfo;
		const priceWrapper = drawObj.price.priceWrapper;
		const util = sharedObj.util;
		const priceCurrency = sharedObj.priceCurrency;
		
		let stockLevelStatus = '';

		//    
		if( model.stockLevelStatus ){
			stockLevelStatus = model.stockLevelStatus.toUpperCase();
			sharedObj.stockLevelStatus = stockLevelStatus;
			sharedObj.apiChangeStockStatus = stockLevelStatus;
			drawObj.stockLevelStatus = stockLevelStatus;
		}

		if( model.stockCustomMessage ){
			sharedObj.stockCustomMessage = model.stockCustomMessage;
		}

		//      1   1   ecom_flag  false    . 
		if((siteCode === "pl" && stockLevelStatus === "OUTOFSTOCK") || stockLevelStatus === "NOORDER" || !model.emcomFlag ){
			util.disabledOptionElement(selectorObj.buyingToolOptTariff, sharedObj);
			util.disabledOptionElement(selectorObj.buyingToolOptUpgrade, sharedObj);
			util.disabledOptionElement(selectorObj.buyingToolOptOffer, sharedObj);
			util.disabledOptionElement(selectorObj.buyingToolOptTradeIn, sharedObj);
			sharedObj.accessoryDisabled = true;
			
			priceWrapper.hasPriceWrapper = false;
		} else {
			priceWrapper.hasPriceWrapper = true;
		}
	}

	function settingMultistore( sharedObj, selectorObj, newbirsObj ){
		const getMultisiteCd = getDotcomMultistore( sharedObj, selectorObj );
		sharedObj.multistoreSiteCd = getMultisiteCd ? getMultisiteCd : sharedObj.siteCode;
	}

	function settingDefaultPrice( sharedObj, selectorObj, newbirsObj ){
		const siteCode = sharedObj.siteCode;
		/*
		if( newHybrisShopInfo && siteCode === "nl" ){
			newbirsObj.commonModel.price = {
				listPrice : {
					value : newHybrisShopInfo.listPrice,
					formatted_value : newHybrisShopInfo.listPriceDisplay
				},
				msrpPrice : {
					value : newHybrisShopInfo.price,
					formatted_value : newHybrisShopInfo.priceDisplay
				},
				salePrice : {
					value : newHybrisShopInfo.promotionPrice,
					formatted_value : newHybrisShopInfo.promotionPriceDisplay
				},
				leasingInfo : {
					monthlyRate : newHybrisShopInfo.leasingInfo ? newHybrisShopInfo.leasingInfo.monthlyPrice : '',
					tenureVal :  newHybrisShopInfo.leasingInfo ? newHybrisShopInfo.leasingInfo.tenureVal : ''
				},
				saveText :newHybrisShopInfo.saveText,
				tradeInPriceText : newHybrisShopInfo.tradeInPriceText
			}
			
			getPriceData( sharedObj, selectorObj, newbirsObj );

			if( sharedObj.proudctPriceInfo.salePriceFormatted ){
				sharedObj.drawObj.price.priceWrapper.hasPriceWrapper = true;
			}
		}
		*/
	}
	
	function getPriceData( sharedObj, selectorObj, newbirsObj ){
		let lowestInstallmentAmount = newbirsObj.commonModel.price.lowestInstallmentAmount;
		let lowestInstallmentAmountTenure = newbirsObj.commonModel.price.lowestInstallmentAmountTenure;
		if( sharedObj.isSECZ){
			lowestInstallmentAmount = sharedObj.calculateInstallmentPeriodicValue;
			lowestInstallmentAmountTenure = sharedObj.calculateInstallmentPeriod;
		}
		const lowestInstallmentInterest = newbirsObj.commonModel.price.lowestInstallmentInterest;
		const price = newbirsObj.commonModel.price.msrpPrice.value;
		const priceDisplay = newbirsObj.commonModel.price.msrpPrice.formatted_value;
		const promotionPrice = newbirsObj.commonModel.price.salePrice.value;
		const promotionPriceDisplay = newbirsObj.commonModel.price.salePrice.formatted_value;
		const leasingInfo = newbirsObj.commonModel.price.leasingInfo;
		const saveText = newbirsObj.commonModel.price.saveText;
		const tradeInPriceText = newbirsObj.commonModel.price.tradeInPriceText;
		const priceCurrency = sharedObj.priceCurrency;
		const siteCode = sharedObj.siteCode;
		const vatFreePrice = newbirsObj.commonModel.price.vatFreePrice.value;
		const vatFreePriceDisplay = newbirsObj.commonModel.price.vatFreePrice.formatted_value;

		
		if( price ){
			sharedObj.proudctPriceInfo.orignalPrice = price;
		}
		
		if( priceDisplay ){
			sharedObj.proudctPriceInfo.orignalPriceFormatted = priceDisplay;
		} else if( price ) {
			sharedObj.proudctPriceInfo.orignalPriceFormatted = currencyComma(price, priceCurrency);
		}
		
		if( promotionPrice ){
			sharedObj.proudctPriceInfo.salePrice = promotionPrice;
		} else {
			sharedObj.proudctPriceInfo.salePrice = price;
		}
		
		if( promotionPriceDisplay ){
			sharedObj.proudctPriceInfo.salePriceFormatted = promotionPriceDisplay;
		} else if( promotionPrice ) {
			sharedObj.proudctPriceInfo.salePriceFormatted = currencyComma( promotionPrice , priceCurrency);
		} else {
			sharedObj.proudctPriceInfo.salePriceFormatted = sharedObj.proudctPriceInfo.orignalPriceFormatted;
		}
		
		//only co
		if( sharedObj.vatEligible && vatFreePriceDisplay ){
			sharedObj.proudctPriceInfo.vatFreePrice = vatFreePrice;
			sharedObj.proudctPriceInfo.vatFreePriceFormatted = vatFreePriceDisplay;
		}  
		
		if( leasingInfo && leasingInfo.monthlyRate ){
			sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice = leasingInfo.monthlyRate;
			sharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal = leasingInfo.tenureVal;
			sharedObj.proudctPriceInfo.monthlyPriceInfo.interest = leasingInfo.interest;		//
		}
		if(sharedObj.isLowestInstallmentAmount){
			sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice = lowestInstallmentAmount;
			sharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal = lowestInstallmentAmountTenure;
			if(sharedObj.isLowestInstallmentInterest){
				sharedObj.proudctPriceInfo.monthlyPriceInfo.interest = lowestInstallmentInterest;
			}
		}
		if( sharedObj.isSECZ){
			sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice = lowestInstallmentAmount;
			sharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal = lowestInstallmentAmountTenure;
		}
		
		if( saveText ){
			sharedObj.proudctPriceInfo.rowCodeformattedPriceSave = saveText;
		}
		
		// tradeInPriceText       
		if( tradeInPriceText ){
			sharedObj.proudctPriceInfo.salePriceFormatted = tradeInPriceText;
		}
		//COMP6FE-1599 [EPP] SEPOL MSRP Price  : $('#isEppPage').val() === 'true' && siteCode === "pl" 
		if( siteCode === 'nl' || siteCode === 'be' || siteCode === 'be_fr' || ($('#isEppPage').val() === 'true' && siteCode === "pl") ){
			//const listPriceFormatted = sharedObj.proudctPriceInfo.listPriceFormatted;
			// 
			const listPriceFormatted = newbirsObj.commonModel.price.listPrice.formatted_value;
			const orignalPriceFormatted = sharedObj.proudctPriceInfo.orignalPriceFormatted;
			const salePriceFormatted = sharedObj.proudctPriceInfo.salePriceFormatted;
			const monthlyPriceFormatted = sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice;
			
			if( listPriceFormatted ){
				sharedObj.proudctPriceInfo.listPriceFormatted = deleteCurrency( listPriceFormatted, sharedObj.priceCurrency).trim();
				sharedObj.proudctPriceInfo.listPrice = newbirsObj.commonModel.price.listPrice.value;
			}
			if( orignalPriceFormatted ){
				sharedObj.proudctPriceInfo.orignalPriceFormatted = deleteCurrency( orignalPriceFormatted, sharedObj.priceCurrency).trim();				
			}
			if( salePriceFormatted ){
				sharedObj.proudctPriceInfo.salePriceFormatted = deleteCurrency( salePriceFormatted, sharedObj.priceCurrency).trim();
			}
			if( monthlyPriceFormatted ){
				sharedObj.proudctPriceInfo.monthlyPriceInfo.monthlyPrice = deleteCurrency( monthlyPriceFormatted, sharedObj.priceCurrency).trim();
			}
		}
		
		sharedObj.drawObj.price.priceWrapper.info.summaryPrice = sharedObj.proudctPriceInfo.salePriceFormatted;
	}

	function newHybrisAjax( sharedObj, selectorObj, newbirsObj, modelCodeList, callBackFun, checking ){
		
		const apiDomain = sharedObj.apiDomain;
		const siteCode = sharedObj.siteCode;
		const skuList = [];
		const priceCurrency = sharedObj.priceCurrency;
		const modelCode = modelCodeList[0];
		
		let isSucceed = false; 
		
		let shopParm = '';
		if( $('#shopParmLang').val() ){
			shopParm=`&lang=${$('#shopParmLang').val()}`;
		}

		newbirsObj.finishedAPIList[checking] = false;
		const apiURL = `${apiDomain}/tokocommercewebservices/v2/${sharedObj.siteCodeWithEpp}/products/${modelCode}/**?fields=SIMPLE_INFO`+shopParm;
		var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};

		$.ajax({
			url: apiURL,
			type: 'GET',
			cache: true,
			crossDomain: true,
			xhrFields: _xhrFields,
			dataType: 'json',
			timeout: 20000,
			success : function ( data, responseText, jqXHR ) {
				if( data && data.code ){
					isSucceed = true;
					newbirsObj.apiData[data.code] = data;
				}
			},
			error : function( XMLHttpRequest, textStatus, errorThrown ){
				sharedObj.newHybrisSalesStatus = false;
			},
			complete : function (){
				newbirsObj.finishedAPIList[checking] = true;
				callBackFun( sharedObj, selectorObj, newbirsObj, isSucceed );
			} 
		});
	}

	function getDotcomMultistore( sharedObj, selectorObj ){
		let result = '';
		const dotcomMultistore =  $.cookies.get('estoreSitecode', {domain : ".samsung.com"});
		if( sharedObj.siteCode === 'levant' ){
			result='jo';
		} else if( sharedObj.siteCode === 'levant_ar' ){
			result='jo_ar';
		} else if( sharedObj.siteCode === 'n_africa' ){
			result='ma';
		} else if( ( sharedObj.siteCode === 'ae' || sharedObj.siteCode === 'ae_ar' ) && dotcomMultistore && checkDotcomMultistore( dotcomMultistore )){
			//NOTICE : checkDotcomMultistore ==> dotcomMultistore     ae, ae_ar, kw, kw_ar, om, om_ar, bh, bh_ar   
			result = dotcomMultistore;
		}
		
		return result;
	}

	function checkDotcomMultistore( inputDotcomMultistore ){
		let result = false;
		let checkSiteCodeList = ["ae", "ae_ar", "kw", "kw_ar", "om", "om_ar", "bh", "bh_ar", "qa", "qa_ar"];
		let checkSiteCodeListSet = new Set(checkSiteCodeList);
		result = checkSiteCodeListSet.has(inputDotcomMultistore);	
		return result;
	}
	
	//only sk, cz installment   call  calculateInstallment
	function settingCalculateInstallmentData( sharedObj, selectorObj,newbirsObj ){
		// calculateInstallment API 
		 
		
		let shopParm = '';
		if( $('#shopParmLang').val() ){
			shopParm=`&lang=${$('#shopParmLang').val()}`;
		}
		
		var _xhrFields = { withCredentials: true };
		
		if( sharedObj.isSECZ){
			let apiUrl = '';


			//B2C,EPP
			apiUrl = sharedObj.apiDomain + "/tokocommercewebservices/v2/" + sharedObj.siteCodeWithEpp + "/products/" + sharedObj.modelCode + "/calculateInstallment?fields=DEFAULT"+shopParm;

			$.ajax({
				url : apiUrl,
				type: "GET",
				dataType: "json",
				xhrFields: _xhrFields,
				crossDomain: true,
				async : false,
				timeout: 10000,
				success: function (data) {
					if(data && data.values && data.values.length > 0 && data.values[0] && data.values[0].values){
						setPeriodicValueAndPeriod(data, sharedObj, selectorObj, newbirsObj  );
					}
				},
				error: function (e) {
					//errLayerPop(e);
				}
			});
		}  
	}

	//only sk, cz installment (    periodicValue    )
	function setPeriodicValueAndPeriod(data, sharedObj, selectorObj, newbirsObj ) {
		const valueList = data.values[0].values;
		if(valueList.length > 1){ // values    
			valueList.sort((a,b)=>{
				if(a.periodicValue < b.periodicValue){
					return -1;
				}
				if(a.periodicValue > b.periodicValue){
					return 1;
				}
				if(a.period < b.period){
					return -1;
				}
				if(a.period > b.period){
					return 1;
				}
				return 0;
			})

			 
			//console.log("periodicValue: " + valueList[0].periodicValue);
			//console.log("period: " + valueList[0].period);
			sharedObj.calculateInstallmentPeriodicValue = valueList[0].periodicValue;
			sharedObj.calculateInstallmentPeriod = valueList[0].period;
			newbirsObj.commonModel.price.lowestInstallmentAmount = valueList[0].periodicValue;
			newbirsObj.commonModel.price.lowestInstallmentAmountTenure = valueList[0].period;

		}else if(valueList.length == 1){
			//console.log("periodicValue: " + valueList[0].periodicValue);
			//console.log("period: " + valueList[0].period);
			sharedObj.calculateInstallmentPeriodicValue = valueList[0].periodicValue;
			sharedObj.calculateInstallmentPeriod = valueList[0].period;
			newbirsObj.commonModel.price.lowestInstallmentAmount = valueList[0].periodicValue;
			newbirsObj.commonModel.price.lowestInstallmentAmountTenure = valueList[0].period;
		}
		getPriceData( sharedObj, selectorObj, newbirsObj );
	}

	dynamic.BuyingToolOpAjaxNewbris = BuyingToolOpAjaxNewbris;
})();


(() => {
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	let sharedObj = '';
	let util = '';
	let view = '';
	let drawObj = '';
	let selectorObj = '';
		
	class DetailAfterEventClass {
		
		constructor( inputSharedObj, inputSelectorObj ){
			selectorObj = inputSelectorObj;
			sharedObj = inputSharedObj;
			util = sharedObj.util;
			view = sharedObj.view;
			drawObj = sharedObj.drawObj;
		}
		
		wishlistPopup( addClass, removeClass, labelText ){
			const wishList = drawObj.wishList;
			
			if( addClass ){
				wishList.contentWrapperClass = util.addClass( wishList.contentWrapperClass, addClass );
			}
			
			if( removeClass ){
				wishList.contentWrapperClass = util.removeClass( wishList.contentWrapperClass, removeClass);
			}
			
			if( labelText ){
				wishList.labelText= labelText;
			}
			
			view.productWishListDraw(drawObj);
		}
		
		checkOutCta( accessoryList = [], isDirect = false, isContinue = false, selectedGift ){
			sharedObj.shopApiModel.callCheckOutCta( sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift );
		}
		
		addToCartCta( accessoryList = [] , isDirect = false, isContinue = false, selectedGift ){
			sharedObj.shopApiModel.callAddToCartCta( sharedObj, accessoryList, selectorObj, isDirect, isContinue, selectedGift );
		}
		
		offerAndAddonsDiscount(data, type){
			
			//  
			sharedObj.globalServiceInfo[type] = data;
			if( type === 'tradein' ){
				tradeInResultDraw ( data , sharedObj, selectorObj, view );
			} else if( type === 'tariff' ){
				tariffOptionResultDraw ( data , sharedObj, selectorObj, view );
			} else if ( type ==='combo' ) {
				comboResultDraw ( data , sharedObj, selectorObj, view );
			} else if (type === 'exchange') {
				checkAPiExchange ( data , sharedObj, selectorObj, view );
			} else if(type === 'eup'){
				upgradeResultDraw ( data , sharedObj, selectorObj, view );
			} else if(type === 'care'){
				careResultDraw ( data , sharedObj, selectorObj, view );
			} else if(type === 'warranty'){
				warrantyResultDraw ( data , sharedObj, selectorObj, view );
			} else if(type === 'warrantyVd'){
				warrantyVdResultDraw ( data , sharedObj, selectorObj, view );
			} else if(type === 'forever'){
				foreverResultDraw ( data , sharedObj, selectorObj, view );
			} else if ( type ==='gift' ) {
				giftResultDraw ( data , sharedObj, selectorObj, view );
			} else if ( type ==='assured' ) {
				assuredResultDraw ( data , sharedObj, selectorObj, view );
			} 
		};
		
		/**
		 * trade In popup    Trade In  
		 */
		drawTradeInWithPopup( data ){
			let giveTradeInFlag = false;
			if(data && data.flag){
				giveTradeInFlag = sharedObj.tradeInFlag = true;

				// CRHQ-5944 [B2C][BC] SEBN stackable trade-in
				sharedObj.maxTradeInsAllowed = data.maxTradeInsAllowed; //   
				sharedObj.minOrderEntryValue = data.minOrderEntryValue; // overPrice    
			}
			
			if (sharedObj.siteCode === 'fr' && !data.withCeTradeUpPopup) {
				//  fr    TradeIn  , uk     
				data = {
					maxDiscount : 0,
					directOutLink : false,
				}
			}
			// [epp service] drawTradeInWithPopup        - uk[ce] callSkuDevicesAjax        1  .
			if( !sharedObj.util.hasTradeIn( sharedObj, selectorObj ) ){
				util.settingTradeInDraw( data, sharedObj, selectorObj, giveTradeInFlag );
				window.sg.components.productDetailKv.reInit();
			}
		}
		//new-hybris
		//CRHQ-7964
		newHybrisDrawTariffOption( data, tariffInfo, option ){ // CRHQ-9555

			const defaultOption = $.extend({'isBroadbandService' : false}, option); // CRHQ-9555

			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const siteCode = sharedObj.siteCode;
			const logoList = [];
			if(defaultOption.isBroadbandService){ // CRHQ-9555
				sharedObj.tariffFlag = true;
				drawObj.tariffOption = {// CRHQ-9555
					'hasComponent' : true,
					'headline' : Granite.I18n.get('Tariff Options Broadband'), /* CRHQ-7964 [B2C][BC][MX][FR] Enable SIM Tariff display for Simple PD for A series smartphones */
					'description' : "",
					'logoList' : [],
					'href' : "",
					'yesAttr' : {'text' : Granite.I18n.get('YES')}, // CRHQ-9555
					'noAttr' : {'text' : Granite.I18n.get('No, Thanks')}    // CRHQ-9555
				}
				view.tariffOpionDraw( drawObj );
				window.sg.components.productDetailKv.reInit();
			}else{
				if( data && data.length > 0 ){
					sharedObj.tariffFlag = true;
					
					for( const item of data ){
						let src = item.imgUrl;
						let alt = item.imgAlt;
		
						if( src ){
							//new-hybris
							if(siteCode === 'de'){  // CRHQ-9555 
								if(src.indexOf('Telekom') > -1){
									src = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/img-carrier-logo-1.png';
									alt = 'Telekom';
								} else if(src.indexOf('Vodaphone') > -1){
									src = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/img-carrier-logo-3.png';
									alt = 'Vodaphone';
								} else if(src.indexOf('o2') > -1){
									src = '/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/img-carrier-logo-2.png';
									alt = 'o2';
								}
							}
							logoList.push({src, alt});
						}
						
					}
	
					// CRHQ-7964
					let description = Granite.I18n.get('Choose your preferred tariff from various providers.');
					if(siteCode == "fr" && tariffInfo){
						/* fr tariff recommended true   */
						var tariffFrDiscount = 0;
						$.each(tariffInfo, function (index, tariffData) {
							for(var i=0; i < tariffData.tariffPlans.length; i++){
								if(tariffData.tariffPlans[i].recommended && (tariffFrDiscount == 0 || tariffFrDiscount == null || tariffFrDiscount == undefined)){
									tariffFrDiscount += tariffData.tariffPlans[i].discount;
								}
							}
						});
						if(tariffFrDiscount > 0){
							description = Granite.I18n.get("Choose a network and save up to {0}", "<strong style=\"color: #006bea;\">" + currencyComma(tariffFrDiscount, sharedObj.priceCurrency) + "</strong>");
						}
					}
	
					let learnMoreHref = "";
					if(siteCode === "se" || siteCode === "no" ||  siteCode === "dk"){  // CRHQ-8994 [B2C][MX][DK] SIM Module
						learnMoreHref = "https://www.samsung.com/"+siteCode+"/plans/";
					}
					
					drawObj.tariffOption = {
						'hasComponent' : true,
						'headline' : Granite.I18n.get('Tariff Options'), /* CRHQ-7964 [B2C][BC][MX][FR] Enable SIM Tariff display for Simple PD for A series smartphones */
						'description' : description,
						'logoList' : logoList,
						'href' : learnMoreHref,
						'yesAttr' : {'text' : Granite.I18n.get('YES')}, // CRHQ-9555
						'noAttr' : {'text' : Granite.I18n.get('NO')}    // CRHQ-9555
					}
					
					if( (siteCode === 'se' || siteCode === 'no' || siteCode === 'dk') && !sharedObj.simpleInfoSIM ){//CRHQ-8994
						drawObj.tariffOption.hasComponent = false;
					}else{
						view.tariffOpionDraw( drawObj );
						window.sg.components.productDetailKv.reInit();
					}
				}
			}
		}

		hybrisDrawTariffOption( data ){
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const isGPv2AndHyIntg = sharedObj.isGPv2AndHyIntg;
			
			if( isGPv2AndHyIntg && data && data.carriers && data.carriers.length > 0 ){
				sharedObj.tariffFlag = true;
				sharedObj.hybrisApiData.tarriffOption = data;
				
				drawObj.tariffOption = {
					'hasComponent' : true,
					'headline' : Granite.I18n.get('Tariff Option'),
					'description' : Granite.I18n.get('Choose your preferred tariff from various providers.'),
					'logoList' : [
						{ 
							'src' : null,
							'alt' : null
						}
					],
					'yesAttr' : {'text' : Granite.I18n.get('YES')}, // CRHQ-9555
					'noAttr' : {'text' : Granite.I18n.get('NO')}    // CRHQ-9555
				}
				if( (siteCode === 'se' || siteCode === 'no' || siteCode === 'dk') && !sharedObj.simpleInfoSIM ){//CRHQ-8994
					drawObj.tariffOption.hasComponent = false;
				}else{
					view.tariffOpionDraw( drawObj );
					window.sg.components.productDetailKv.reInit();
				}
				
			}
		}
		
		hybrisDrawGift( data ){
			const view = sharedObj.view;
			const drawObj = sharedObj.drawObj;
			const offerView = drawObj.offer;
			const util = sharedObj.util;
			const isGPv2AndHyIntg = sharedObj.isGPv2AndHyIntg;
			const giftdataHybris = sharedObj.giftdataHybris;
			let headline = null;
			let subHeadline = null;
			
			if( isGPv2AndHyIntg && data ){
				sharedObj.giftFlag = true;
				var customsObj = {};
				customsObj.layerTarget = 'freeGiftPopup';
				customsObj['giftIdx'] = 0;
				let learnMoreCta = util.getAttrCta ( Granite.I18n.get('ADD TO ORDER'), 'javascript:;', '_self', 's-btn-gift-popup', customsObj,'' );
				
				
				sharedObj.giftdataHybris
				for( var index in giftdataHybris ){
					const item = giftdataHybris[index];
					if( item.key && item.key === 'mainTitle' ){
						headline = item.value;
					}
					if( item.key && item.key === 'subTitle' ){
						subHeadline = item.value;
					}
				}
				let mainDec = [];
				if( subHeadline ){
					mainDec.push( {'text' : subHeadline});
				}
					
				offerView.gift = {
					'title' : 'giftBundle',
					'giftIndex' : 0,
					'hasItem' : true,
					'item' : {
						'headline' : headline,
						'description' : {
							'hasDescription' : true,
							'main': mainDec,
							'date': null
						},
						'learnMoreCta' : learnMoreCta
					}
				}
				view.productOfferDraw( drawObj ) ;
			}
		}
		//new-hybris
		hybrisDrawCare( data ){
			const isGPv2AndHyIntg = sharedObj.isGPv2AndHyIntg;
			const isHybrisSplitPD = sharedObj.isHybrisSplitPD; 
			const isHybrisSplitPDSamsungCarePlus = sharedObj.isHybrisSplitPDSamsungCarePlus;
			
			if( (isGPv2AndHyIntg || (isHybrisSplitPD && isHybrisSplitPDSamsungCarePlus)) && data.smcs && data.smcs.length > 0 ){
			    // CRHQ-9703 [B2C][MX][SENA] SC+   UI 
                const senaSiteFlag = "se" === siteCode || "no" === siteCode || "fi" === siteCode || "dk" === siteCode;
			    const isSmcType2 = "uk" === siteCode || senaSiteFlag;
				const samsungCareFlag = sharedObj.samsungCareFlag = true;
				const priceCurrency = sharedObj.priceCurrency;
				const util  = sharedObj.util;
				const careLearnMoreUrl = sharedObj.careLearnMoreUrl;
				const careList = data.smcs;
				//ca, ca_fr  VD case . 
				const isVD = $("#categorySubTypeCode").val().length > 2 && $("#categorySubTypeCode").val().substring(0,2) === "04" ? true : false;
				//pe  HA case . 
				const isHA = $("#categorySubTypeCode").val().length > 2 && $("#categorySubTypeCode").val().substring(0,2) === "08" ? true : false;
				const isIM = $("#categorySubTypeCode").val().length > 2 && $("#categorySubTypeCode").val().substring(0,2) === "01" ? true : false;
				
				let description = '';
				let learnMoreTarget = '_self';
				let learnMoreText = '';
				let learnMoreHref = 'javascript:;';
				let learnMoreCta = {};
				let learnMoreClass = '';
				let customsObj = {};
				let yesAttr = {};
				let noAttr = {};
				let eventType = 'care';
				let rowText = [];
				let title = '';
				let isSubscription = false; //new-hybris
				
				let isWarranty = false; 
				title = Granite.I18n.get('Add Samsung Care+');
				if(isHA && siteCode === 'pe') {
					let largeImage = $(".hubble-care-popup__image .image__preview.lazy-load.responsive-img"); //	  
					var largeImage2 = $(".hubble-care-popup__image .image__main.lazy-load.responsive-img"); //     
					let largeImageLazy1 = $(".hubble-care-popup__image .image__preview.responsive-img.image--loaded image--hide"); //	 
					let largeImageLazy2 = $(".hubble-care-popup__image .image__main.responsive-img.image--loaded"); //	 
					
					title = Granite.I18n.get('HA_Add Samsung Care+');
					
					setTimeout(function () {
                		largeImage.attr('data-desktop-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');
                		largeImage.attr('data-mobile-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$680_398_PNG$');
                		largeImage.attr('data-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');
                		largeImage.attr('src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');

                		largeImage2.attr('data-desktop-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');
                		largeImage2.attr('data-mobile-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$680_398_PNG$');
                		largeImage2.attr('data-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');
                		largeImage2.attr('src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');

                		largeImageLazy1.attr('data-desktop-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');
                		largeImageLazy1.attr('data-mobile-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$680_398_PNG$');
                		largeImageLazy1.attr('data-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');
                		largeImageLazy1.attr('src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');
                		
                		largeImageLazy2.attr('data-desktop-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');
                		largeImageLazy2.attr('data-mobile-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$680_398_PNG$');
                		largeImageLazy2.attr('data-src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');
                		largeImageLazy2.attr('src','https://images.samsung.com/is/image/samsung/assets/pe/Samsungcareplus_600x398.jpg?$380_223_PNG$');
					}, 1200);
					
				}
				if(!isIM && (siteCode === 'ca' || siteCode === 'ca_fr') ) {
					let largeImage = $(".hubble-care-popup__image .image__preview.lazy-load.responsive-img"); //	  
					var largeImage2 = $(".hubble-care-popup__image .image__main.lazy-load.responsive-img"); //     
					let largeImageLazy1 = $(".hubble-care-popup__image .image__preview.responsive-img.image--loaded image--hide"); //	 
					let largeImageLazy2 = $(".hubble-care-popup__image .image__main.responsive-img.image--loaded"); //	 

					// NOTICE : IM   
					// NOTICE : summary WARRANTY      productShortDescription  
					for( var index in careList ){
						const tempCareApiItem = careList[index];
						 
						if( tempCareApiItem.summary  && tempCareApiItem.summary.toUpperCase() === 'WARRANTY'){
							isWarranty = true;
							break;
						}
						if(isWarranty == false) {
							if( tempCareApiItem.productShortDescription  && tempCareApiItem.productShortDescription.toUpperCase().indexOf('WARRANTY') > -1){
								isWarranty = true;
								break;
							}
						}
					}

					//  
					//if (window.location.href.indexOf("/tablets/galaxy-tab-s/galaxy-tab-s7-fe-black-64gb-sm-t733nzkaxac/buy") > -1) {
					//	isWarranty = true;
					//}
					if(isWarranty) {
						title = Granite.I18n.get('VD_Add Samsung Care+');
						
						setTimeout(function () {
		            		if( siteCode == "ca" ){
		                		largeImage.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
		                		largeImage.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$680_398_PNG$');
		                		largeImage.attr('data-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
		                		largeImage.attr('src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');

		                		largeImage2.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
		                		largeImage2.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$680_398_PNG$');
		                		largeImage2.attr('data-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
		                		largeImage2.attr('src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');

		                		largeImageLazy1.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
		                		largeImageLazy1.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$680_398_PNG$');
		                		largeImageLazy1.attr('data-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
		                		largeImageLazy1.attr('src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
		                		
		                		largeImageLazy2.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
		                		largeImageLazy2.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$680_398_PNG$');
		                		largeImageLazy2.attr('data-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
		                		largeImageLazy2.attr('src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
		            		} else if( siteCode == "ca_fr" ){
		                		largeImage.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		                		largeImage.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$680_398_PNG$');
		                		largeImage.attr('data-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		                		largeImage.attr('src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		                		
		                		largeImage2.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		                		largeImage2.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$680_398_PNG$');
		                		largeImage2.attr('data-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		                		largeImage2.attr('src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');

		                		largeImageLazy1.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		                		largeImageLazy1.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$680_398_PNG$');
		                		largeImageLazy1.attr('data-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		                		largeImageLazy1.attr('src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		                		
		                		largeImageLazy2.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		                		largeImageLazy2.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$680_398_PNG$');
		                		largeImageLazy2.attr('data-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		                		largeImageLazy2.attr('src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
		            		}
						}, 1200);
						/*
	            		if( siteCode == "ca" ){
	                		largeImage.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
	                		largeImage.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$680_398_PNG$');
	                		largeImageLazy1.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
	                		largeImageLazy1.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$680_398_PNG$');
	                		largeImageLazy2.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$380_223_PNG$');
	                		largeImageLazy2.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img.png?$680_398_PNG$');
	            		} else if( siteCode == "ca_fr" ){
	                		largeImage.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
	                		largeImage.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$680_398_PNG$');
	                		largeImageLazy1.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
	                		largeImageLazy1.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$680_398_PNG$');
	                		largeImageLazy2.attr('data-desktop-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$380_223_PNG$');
	                		largeImageLazy2.attr('data-mobile-src','/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/extended-warranty-img-FR.png?$680_398_PNG$');
	            		}
	            		*/
					}
					
				}
				
				
				
				if( careLearnMoreUrl ){
					learnMoreText = Granite.I18n.get("Learn more");
					learnMoreHref = careLearnMoreUrl;
					learnMoreTarget = '_blank';
				} else {
					if(siteCode === 'se' || siteCode === 'dk' || siteCode === 'fi' || siteCode === 'no' || siteCode === 'nl' || siteCode === 'be' || siteCode === 'be_fr'){
							learnMoreHref = 'javascript:;';
							learnMoreText = Granite.I18n.get("Learn more");
							learnMoreTarget = '_self';
							customsObj.layerTarget = 'hubbleCareinfoPopup';
					} else if( siteCode === 'it' ){
							learnMoreHref = 'https://www.samsung.com/it/offer/samsung-care-plus/';
							learnMoreText = Granite.I18n.get("Learn more");
							learnMoreTarget = '_blank';
					} else if( siteCode === 'es' ){
						learnMoreHref = 'https://www.samsung.com/es/offer/samsung-care-plus/';
						learnMoreText = Granite.I18n.get("Know the advantages");
						learnMoreTarget = '_blank';
					} else if( siteCode === 'pt' ){
						learnMoreHref = 'https://www.samsung.com/pt/offer/samsung-care-plus/';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
					} else if( siteCode === 'au' ){
						//    . 
						learnMoreHref = 'https://www.samsung.com/au/offer/samsung-care-plus/ ';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_blank';
					} else if( siteCode === 'za' ){
						learnMoreHref = 'javascript:;';
						learnMoreText = Granite.I18n.get("Learn more");
						learnMoreTarget = '_self';
						customsObj.layerTarget = 'scLearnMorePopup';
					} else if( siteCode === 'ca_fr' || siteCode === 'ca'){
						if(isWarranty) {
							//Warranty  
							if( siteCode === 'ca'){
								learnMoreHref = 'https://www.samsung.com/ca/support/warranty/';
							} else if( siteCode === 'ca_fr'){
								learnMoreHref = 'https://www.samsung.com/ca_fr/support/warranty/';
							}
							learnMoreText = Granite.I18n.get("Learn more");
							learnMoreTarget = '_blank';
						} else {
							// IM    (SC+)
							learnMoreHref = 'javascript:;';
							learnMoreText = Granite.I18n.get("Learn more");
							learnMoreTarget = '_self';
							customsObj.layerTarget = 'scLearnMorePopup';
						}
					} else if( siteCode === 'hk' || siteCode === 'hk_en'){
                        learnMoreHref = 'https://www.samsung.com/'+siteCode+'/offer/samsung-care-plus/';
                        learnMoreText = Granite.I18n.get("Learn more");
                        learnMoreTarget = '_blank';
                    } else if ( siteCode === 'my' ){
    					if( $('#isEppPage').val() === 'true' ){
    						learnMoreHref = '/my/multistore/' + $('#eppCompanyCode').val() + '/offers_epp/epp-sc-plus/';
                            learnMoreText = Granite.I18n.get("Learn more");
                            learnMoreTarget = '_blank';
    					}
                    } else if( siteCode === 'pe' ){
                    	if(isHA){
                    		learnMoreHref = 'https://www.samsung.com/pe/offer/samsung-care-plus/home-appliances';
							learnMoreText = Granite.I18n.get("Learn more");
							le			
				description = Granite.I18n.get("Insurance that protects and cares for your phone wherever, whenever.");
				if(isWarranty) {
					description = Granite.I18n.get("VD_Insurance that protects and cares for your phone wherever, whenever.");
				}
				if(isHA && siteCode === 'pe'){
					description = Granite.I18n.get("HA_Insurance that protects and cares for your phone wherever, whenever.");
				}
				
				yesAttr = {
					'text': Granite.I18n.get('YES'),
					'layerTarget' : 'hubbleCarePopup'
				}
				noAttr = {
					'text': Granite.I18n.get('NO'),
					'eventType' : eventType,
				}
				
				learnMoreCta= util.getAttrCta ( learnMoreText, learnMoreHref, learnMoreTarget, learnMoreClass, customsObj, '' );
				drawObj.care = {
					'hasComponent' : samsungCareFlag,
					'title' : title,
					'learnMoreCta' :  learnMoreCta,
					'description' : description,
					'yesAttr' : yesAttr,
					'noAttr' : noAttr,
					'subText': '',
					'rowText' : rowText,
					'itemSet' : [],
					// CRHQ-9202 [B2C][MX][UK] SC+   UI 
					// CRHQ-9703 [B2C][MX][SENA] SC+   UI 
					'items': [],
					'isSmcType2': isSmcType2
				}
				
				sharedObj.finalCareList = [];
				
				for( var index in careList ){
					const careApiItem = careList[index];
					isSubscription = false;			//new-hybris
					//newHybris   .       .
					if( sharedObj.isMigrationHybris && careApiItem.paymentCycle  && careApiItem.paymentCycle.toUpperCase() === 'MONTHLY'){
						isSubscription = true;
					}

                    // CRHQ-9202 [B2C][MX][UK] SC+   UI 
					let finalCareObj = {};

					//new-hybris
					if (siteCode === "be" || siteCode === "be_fr" || siteCode === "nl") {
					    // CRHQ-9202 [B2C][MX][UK] SC+   UI 
						finalCareObj = {
							'flags' : {
								'is_subscription' : isSubscription
							},
							'displayName' : careApiItem.title,
							'price_info' : [
								{
									'msrp_price' : {
										'value' : careApiItem.price,
										'formatted_value' : currencyCommaExcep( careApiItem.price,priceCurrency ),
										'duration_value' : careApiItem.duration,
										'paymentcycle_value' : careApiItem.paymentCycle
									},
									'sale_price' : {
										'value' : careApiItem.promotionPrice,
										'formatted_value' : currencyCommaExcep( careApiItem.promotionPrice, priceCurrency ),
										'duration_value' : careApiItem.duration,
										'paymentcycle_value' : careApiItem.paymentCycle
									}
								}
							],
							'long_description' : careApiItem.summary
						};
					} else {
						if (isWarranty) {
							//ca, ca_fr isWarranty API   
							// CRHQ-9202 [B2C][MX][UK] SC+   UI 
							finalCareObj = {
								'flags' : {
									'is_subscription' : isSubscription
								},
								'displayName' : careApiItem.title,
								'price_info' : [
									{
										'msrp_price' : {
											'value' : careApiItem.price,
											'formatted_value' : currencyComma( careApiItem.price,priceCurrency ),
											'duration_value' : careApiItem.duration,
											'paymentcycle_value' : careApiItem.paymentCycle
										},
										'sale_price' : {
											'value' : careApiItem.promotionPrice,
											'formatted_value' : currencyComma( careApiItem.promotionPrice, priceCurrency ),
											'duration_value' : careApiItem.duration,
											'paymentcycle_value' : careApiItem.paymentCycle
										}
									}
								],
								'long_description' : '',
								'isWarranty' : isWarranty
							};
						} else {
							// SC+  
							// CRHQ-9202 [B2C][MX][UK] SC+   UI 
							finalCareObj = {
								'flags' : {
									'is_subscription' : isSubscription
								},
								'displayName' : careApiItem.title,
								'price_info' : [
									{
										'msrp_price' : {
											'value' : careApiItem.price,
											'formatted_value' : currencyComma( careApiItem.price,priceCurrency ),
											'duration_value' : careApiItem.duration,
											'paymentcycle_value' : careApiItem.paymentCycle,
											'wasValue' : careApiItem.wasPrice,
											'formatted_wasValue' : currencyComma( careApiItem.wasPrice,priceCurrency )
										},
										'sale_price' : {
											'value' : careApiItem.promotionPrice,
											'formatted_value' : currencyComma( careApiItem.promotionPrice, priceCurrency ),
											'duration_value' : careApiItem.duration,
											'paymentcycle_value' : careApiItem.paymentCycle
										}
									}
								],
								'long_description' : careApiItem.summary,
								'isWarranty' : isWarranty,
								'summary': careApiItem.summary
							};
						}
					}

					// CRHQ-9202 [B2C][MX][UK] SC+   UI 
                    if (isSmcType2) {
                        // otherParameters  theft: false  .
                        if ( !util.isNotEmpty(careApiItem.otherParameters) ) {
                            careApiItem.otherParameters = {"theft": "false"};
						}

                        careApiItem.isTheft = "true" === careApiItem.otherParameters.theft ? true : false;

                        finalCareObj.otherParameters = careApiItem.otherParameters;
                        finalCareObj.isTheft = careApiItem.isTheft;
					}

					// CRHQ-9202 [B2C][MX][UK] SC+   UI 
					sharedObj.finalCareList.push(finalCareObj);
				}

				sharedObj.hybrisCareData = data;
				// CRHQ-9202 [B2C][MX][UK] SC+   UI 
				if (isSmcType2) {
                    sharedObj.hybrisCareData.isSmcType2 = true;
                } else {
                    sharedObj.hybrisCareData.isSmcType2 = false;
                }

				util.settingAfterApiCareDraw( sharedObj, selectorObj );
				window.sg.components.productDetailKv.reInit();
			}
		}
		//new-hybris
		hybrisDrawAccessory( isSuccess ){
			const util  = sharedObj.util;
			//new-hybris step buying test 
//			if("Hybris-new" == $("#shopIntegrationFlag").val() && "04010000" == $("#categoryTypeCode").val() && "live" == $("#runmodeInfo").val() ){
//				isSuccess = false;
//			}
			if( isSuccess ){
				sharedObj.addonsFlag = true;
				util.settingPriceCta ( sharedObj.hasPriceCta, sharedObj, selectorObj, sharedObj.currentUrl );
			}else{				
				//CRHQ-5597 [B2C][BC][IM] DE SIM     split 
				sharedObj.addonsFlag = false;	
				util.settingPriceCta ( sharedObj.hasPriceCta, sharedObj, selectorObj, sharedObj.currentUrl );
			}
		}
		//CRHQ-6172 [B2C][BC] SG Stackable Trade in 
		tradeInResultSpecialPrice(sharedObj,tradeInResultDraw){// CRHQ-8578
			var specialuseyn=true;
			var tradeInResult=tradeInResultDraw.list;
			
			let maxindexData=-1;
			let maxSpecialPrice=0;
			for( var index = 0; index < tradeInResult.length; index++){
				var tradeinresultdata=tradeInResult[index];
				if(tradeinresultdata.specialPrice && parseFloat(maxSpecialPrice) < parseFloat(tradeinresultdata.specialPrice)){
					maxSpecialPrice=tradeinresultdata.specialPrice;
					maxindexData=index;
				}
			}
			const additionalDiscountFlag=tradeInResultDraw.additionalDiscountFlag;
			for( var index = 0; index < tradeInResult.length; index++){
				const priceCurrency = sharedObj.priceCurrency;
				var tradeinresultdata=tradeInResult[index];
				var discountPriceText ="";
				var discountPriceData=tradeinresultdata.discountPrice;
				var displayPrice=tradeinresultdata.discountPrice;
				var cashbackSiteCode=siteCode === 'ae' || siteCode === 'ae_ar' || siteCode === 'sa' || siteCode === 'sa_en';
				if(cashbackSiteCode){//CRHQ-8960
					discountPriceData=tradeinresultdata.dataCashBack;
					displayPrice=tradeinresultdata.dataCashBack;
				}else if(siteCode == "fr"){
					if(tradeinresultdata.spotGuaranteeAmount){
						displayPrice += parseFloat(tradeinresultdata.spotGuaranteeAmount);
					}
					if(tradeinresultdata.abondementAmount){
						displayPrice += parseFloat(tradeinresultdata.abondementAmount);
					}
				}
				var discountText1="";
				var specialDiscountText="";
				var isSpecial = false;
				var discountPriceTextTile="";
				let maxCheckSite=tradeinresultdata.specialPrice;
				
				if(additionalDiscountFlag && siteCode!="de"){
					maxCheckSite=(tradeinresultdata.specialPrice && index==maxindexData);
				}
				if(specialuseyn && maxCheckSite){
					const tradeInSpecialPrice = parseInt(tradeinresultdata.specialPrice);
					specialDiscountText = `${Granite.I18n.get("Special Discount")} ${currencyComma(tradeInSpecialPrice, priceCurrency)}`;
					if(siteCode === 'fr'){// CRHQ-8032
						specialDiscountText = `+${currencyComma(parseInt(tradeInSpecialPrice), priceCurrency)} ${Granite.I18n.get("de bonus reprise")}`;
					}else if(siteCode === 'de'){//CRHQ-8945
						if(tradeinresultdata.priceinfodesc){
							specialDiscountText=tradeinresultdata.priceinfodesc;
						}
					}
					displayPrice += tradeInSpecialPrice;
					discountPriceText =currencyComma(displayPrice, priceCurrency);
					isSpecial = true;
					specialuseyn=false;
					
				}
				if(isSpecial){
					if(cashbackSiteCode){
						discountPriceTextTile = `${Granite.I18n.get("Total cashback amount")}`;
						discountPriceText = `${currencyComma(displayPrice, priceCurrency)}`;
						discountText1 = Granite.I18n.get("Old device value") + ' : ' + currencyComma(discountPriceData, priceCurrency);
					}else if(siteCode === 'fr'){// CRHQ-8032
						discountPriceTextTile = `${Granite.I18n.get("Total de remise applique")}`;
						discountText1 = `${currencyComma(discountPriceData, priceCurrency)} ${Granite.I18n.get('de valeur de reprise de votre ancien appareil')}`;
						discountPriceText = `${currencyComma(displayPrice, priceCurrency)}`;
					}else if(siteCode === 'de'){//CRHQ-8945
							discountPriceTextTile = `${Granite.I18n.get("Total Discount")}`;
						}else{
							discountText1 = Granite.I18n.get("Regular Exchange Value") + ' : ' + currencyComma(discountPriceData, priceCurrency);
					}
				}else{
					if(cashbackSiteCode){
						if(siteCode === 'sa' || siteCode === 'sa_en'){
							discountText1 = `${Granite.I18n.get('Regular Exchange Value')}`;
						}else{
							discountText1 = `${Granite.I18n.get('Regular Exchange Value')} ${currencyComma(discountPriceData, priceCurrency)}`;	
						}
					}else if(siteCode === 'fr'){// CRHQ-8032
						discountPriceTextTile = `${Granite.I18n.get("Total de remise applique")}`;
						discountText1 = `${currencyComma(discountPriceData, priceCurrency)} ${Granite.I18n.get('de valeur de reprise de votre ancien appareil')}`;
						if(!tradeinresultdata.spotGuaranteeAmount && !tradeinresultdata.abondementAmount){
							discountText1 = "";
						}
					}else if(siteCode === 'de'){//CRHQ-8945
							discountText1 = "(" +Granite.I18n.get("Upfront discount")+ ")";
					}else{
						discountPriceTextTile = `${Granite.I18n.get("Regular Exchange Value")}`;
					}
					discountPriceText = `${currencyComma(displayPrice, priceCurrency)}`;
				}
				tradeinresultdata["discountPriceTextTile"]=discountPriceTextTile;
				tradeinresultdata.discountPriceText=discountPriceText;
				tradeinresultdata.specialDiscountText=specialDiscountText;
				tradeinresultdata.discountText1=discountText1;
				if(cashbackSiteCode){
				    // CRHQ-8616 [B2C][MX][AE] Trade-in     
					tradeinresultdata.dataPrice = 0;
				}else{
					tradeinresultdata.dataPrice=displayPrice;
				}
			}
		}
	}
	//new-hybris
	function tradeInResultDraw ( data , sharedObj, selectorObj, view ){
		const siteCode = sharedObj.siteCode;
		const priceCurrency = sharedObj.priceCurrency;
		const upgradeResultArea = $(sharedObj.buyingToolOptUpgradeResult);
		const upgradePriceArea = upgradeResultArea.find('.result-price');
		const drawObj = sharedObj.drawObj;
		const util = sharedObj.util;
		const openPromoTaxParam = sharedObj.openPromoTaxParam;
		const isHybrisSplitPD = sharedObj.isHybrisSplitPD;
		const isHybrisSplitPDTradeIn = sharedObj.isHybrisSplitPDTradeIn;
		const specialPrice = sharedObj.splitPDTradeInSpecial;
		const specialMessage = sharedObj.splitPDTradeInSpecialMsg;
		const resultList = sharedObj.isMultiTradeIn && drawObj.tradeInResult.list ? drawObj.tradeInResult.list : []; //COMP6FE-1495] Au Multi TradeIn  
		
		let tradeInResultDraw = {};
		let displayBrandName = '';
		let modelAndBrand = '';
		let eupTradeInPrice = 0;
		let displayPrice = 0;
		let StrOrignalDisplayPrice = '';
		let orignalDisplayPrice = 0;
		let cashBackPrice = 0;
		let orignalCashBackPrice = 0;
		let orignalTotalPrice = 0;
		let tradeinDiscountYn = false; // false upfront() true cashback
		let openPromoTax = false;
		let hasPriceData = false;
		let discountText1 = null;
		let discountText2 = null;
		let discountText3 = null;
		let discountText4 = null;
		let discountText5 = null;
		let discountText6 = null;
		let specialDiscountText = null;
		let description = null;
		let enhancedDiscountAmount = 0;
		let tradeinAmount = 0;
		let discountAmount = 0;
		let dealBonusPrice = 0;
		let tradeinAmountText = null;
		let dealBonusPriceText = null;
		let priceAreaTitleText = null;
		let deletedOriginalCashBackPriceText = null;
		let totalCashBackPriceText = null;
		let eventAmountPrice = 0;
		
		if( data ){
			hasPriceData = data.discount && data.value;
			
			const globalCaseData = settingTradeInGlobalData( data, sharedObj, hasPriceData ); //    
			
			tradeinDiscountYn = globalCaseData.tradeinDiscountYn;
			displayBrandName = globalCaseData.displayBrandName;
			modelAndBrand = globalCaseData.modelAndBrand;
			StrOrignalDisplayPrice = StrOrignalDisplayPrice;
			orignalDisplayPrice = globalCaseData.orignalDisplayPrice;
			orignalCashBackPrice = globalCaseData.orignalCashBackPrice;
			orignalTotalPrice = globalCaseData.orignalTotalPrice;
			displayPrice = globalCaseData.displayPrice;
			cashBackPrice = globalCaseData.cashBackPrice;
			discountText1 = globalCaseData.priceText;
			enhancedDiscountAmount = globalCaseData.enhancedDiscountAmount;
			tradeinAmount = globalCaseData.tradeinAmount;
			discountAmount = globalCaseData.discountAmount;
			dealBonusPrice = globalCaseData.dealBonusPrice;
			eventAmountPrice = globalCaseData.eventAmountPrice;
			const additionalDiscountFlag =  data.additionalDiscountFlag ||  false;// CRHQ-8578
			//    
			//[B2C] COMP6FE-1492(ca   )
			if( siteCode === 'ca' || siteCode === 'ca_fr' ){
				let displayModelAndBrandName = [];
				if( data.displayBrandName ){
					displayModelAndBrandName.push( data.displayBrandName );
				}
				if( data.displayModelName ){
					displayModelAndBrandName.push( data.displayModelName );
				} 
				modelAndBrand = Granite.I18n.get('Your Trade-in') + '&nbsp;&nbsp; : &nbsp;&nbsp;' + displayModelAndBrandName.join(' | ');

				displayPrice = orignalTotalPrice;
				discountText1 = Granite.I18n.get('Total Trade-in')+ '&nbsp;&nbsp; : &nbsp;&nbsp;' + currencyComma(orignalTotalPrice, priceCurrency)
				if(orignalDisplayPrice > 0){
					discountText2 = currencyComma(orignalDisplayPrice, priceCurrency) +' (' + Granite.I18n.get('Estimated Trade-in Value')+')';	
				}
				if(enhancedDiscountAmount > 0){
					discountText3 = currencyComma(enhancedDiscountAmount, priceCurrency) + ' ('+Granite.I18n.get('Promotional Trade-in Credit')+')';	
				}
				
			} else if( siteCode === 'ae' || siteCode === 'ae_ar' || siteCode === 'sa' || siteCode === 'sa_en' ) {
				
//				//COMP6FE-1498 SGE AE, AE_AR TradeIn   
//				const hasSamsungBrandName = displayBrandName.toUpperCase().indexOf('SAMSUNG') > -1; 
//				
//				if( !hasSamsungBrandName ){
//					modelAndBrand = Granite.I18n.get('Third-party brand');
//				}
				
				// CRHQ-8032 [B2C][MX][AE] SGE Trade-in CX improvement
				let displayModelAndBrandName = [];
				if( data.displayBrandName ){
					displayModelAndBrandName.push( data.displayBrandName );
				}
				if( data.displayModelName ){
					displayModelAndBrandName.push( data.displayModelName );
				} 
				modelAndBrand = Granite.I18n.get('Trade-in') + '&nbsp;&nbsp; : &nbsp;&nbsp;' + displayModelAndBrandName.join(' | ');
				
				displayPrice = 0;
				if( orignalCashBackPrice ){
					description = Granite.I18n.get('* Values will vary based on model and condition of trade-in. T&Cs apply.');
					discountText2 = currencyComma(orignalCashBackPrice, priceCurrency) + ' ('+ Granite.I18n.get('Cashback') +')';
				}
				//CRHQ-8352
				if( sharedObj.isMultiTradeIn ){
					discountText1 = `${Granite.I18n.get('Regular Exchange Value')} ${currencyComma(orignalCashBackPrice, priceCurrency)}`;
					
					let displayModelAndBrandName = [];
					if( data.displayBrandName ){
						displayModelAndBrandName.push( data.displayBrandName );
					}
					
					if( data.displayModelName ){
						displayModelAndBrandName.push( data.displayModelName );
					}
					//CRHQ-7531 [B2C][BC][ID] Trade-in CX 
					var tradeInSpecialPrice="";
					if(data.tradeInSpecialPrice ){
						tradeInSpecialPrice =parseFloat(data.tradeInSpecialPrice);
					}
					const resultItem = {
						'index': resultList.length,
						'count': resultList.length+1,
						'displayModelName': displayModelAndBrandName.join(' | '),
						'discountPriceText': currencyComma(orignalCashBackPrice, priceCurrency),
						'discountText1': discountText1,
						'dataPrice': displayPrice,
						'dataCashBack': orignalCashBackPrice,
						'dataQuoteId': data.tradeinId,
						'dataId': data.consents,
						'services': data,
						'specialDiscountText' : specialDiscountText,
						'discountPrice' : parseFloat(displayPrice),
						'specialPrice' : tradeInSpecialPrice
					};
					
					if( sharedObj.checkedIndex > -1 ){
						resultItem.index = sharedObj.checkedIndex;
						resultList.splice(sharedObj.checkedIndex,1,resultItem);
					} else {
						resultList.push(resultItem);
					}
				}
			} else if ( siteCode === 'de' ) {		//new-hybris
				if( data.openPromoTax ){
					openPromoTax = data.openPromoTax;
				}else{
					if( openPromoTaxParam ){
						openPromoTax = openPromoTaxParam;
					}
				}
				
				sharedObj.tradeInSelectPrice = orignalCashBackPrice + orignalDisplayPrice;
				//CRHQ-8944 [B2C][MX][DE] Stackable Trade-In FOC   
				if(sharedObj.isMultiTradeIn){
					var isfreegiftcheck = sharedObj.hasStackbleTradeInFreeGiftPromotion
					if(!drawObj.tradeInResult.hasComponent){
						isfreegiftcheck = false;
					}
					if(isfreegiftcheck){
						sharedObj.hasGift = false;
						if(sharedObj.hasVoucher || sharedObj.hasAddOns){
							window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
						}else{
							window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(false);
						}
					}
				}
				//  CRHQ-7126-2  
				if(sharedObj.hasTradeInFreeGiftPromotion){
					sharedObj.hasGift = false;
					if(sharedObj.hasVoucher || sharedObj.hasAddOns){
						window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
					}else{
						window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(false);
					}
				}
				if( !tradeinDiscountYn ){
					displayPrice = orignalDisplayPrice + orignalCashBackPrice;
					discountText1 = '- ' + currencyComma(displayPrice, priceCurrency) + ' ' + Granite.I18n.get('Upfront discount');
					
					if( openPromoTax && orignalCashBackPrice !== 0 ){
						discountText2 = Granite.I18n.get('Inkl. {0} Tauschprmie | Direktabzug im Warenkorb',currencyComma(orignalCashBackPrice, priceCurrency));
					}
					
					if( util.hasUpgradeResult ){
						eupTradeInPrice = parseFloat(upgradePriceArea.attr('data-price')) - parseFloat(sharedObj.tradeInSelectPrice);
						upgradePriceArea.attr( 'data-price', eupTradeInPrice );
						$(upgradePriceArea).find('.option-result__text').innerHTML = currencyComma(parseFloat(eupTradeInPrice/24),priceCurrency) +  ' / ' + Granite.I18n.get("month"); 
					}
				}
				
				if( sharedObj.isMultiTradeIn ){

					let displayModelAndBrandName = [];
					if( data.displayBrandName ){
						displayModelAndBrandName.push( data.displayBrandName );
					}

					if( data.displayModelName ){
						displayModelAndBrandName.push( data.displayModelName );
					}

					var tradeInSpecialPrice="";
					if(data.tradeInSpecialPrice ){
						var discountPriceTextTile = `${Granite.I18n.get("Total Discount")}`;
						tradeInSpecialPrice =parseFloat(data.tradeInSpecialPrice);
						displayPrice+=tradeInSpecialPrice;
						var priceInfos = data.priceInfos;
						if(priceInfos.length > 0){
							var priceinfodesc = "";
							$.each(priceInfos, function(index, priceInfo){
								priceinfodesc+=priceInfo+"<br>";
							});
							priceinfodesc+="(" +Granite.I18n.get("Upfront discount",null,null)+ ")";
							specialDiscountText = priceinfodesc;
						}
					}else{
							specialDiscountText = "(" +Granite.I18n.get("Upfront discount")+ ")";
					}

					const resultItem = {
						'index': resultList.length,
						'count': resultList.length+1,
						'displayModelName': displayModelAndBrandName.join(' | '),
						'discountPriceText': currencyComma(displayPrice, priceCurrency),
						'discountText1': discountText1,
						'dataPrice': displayPrice,
						'dataCashBack': orignalCashBackPrice,
						'dataQuoteId': data.tradeinId,
						'dataId': data.consents,
						'services': data,
						'discountPriceTextTile' : discountPriceTextTile,
						'specialDiscountText' : specialDiscountText,
						'discountPrice' : parseFloat(orignalDisplayPrice),
						'specialPrice' : tradeInSpecialPrice,
						'priceinfodesc' : priceinfodesc,
						'closedDiscountAmount' : parseFloat(data.closedDiscountAmount ? data.closedDiscountAmount : 0) // CRHQ-8946 [B2C][MX][DE] Stackable Trade-In      
					};

					if( sharedObj.checkedIndex > -1 ){
						resultItem.index = sharedObj.checkedIndex;
						resultList.splice(sharedObj.checkedIndex,1,resultItem);
					} else {
						resultList.push(resultItem);
					}

					if( util.hasUpgradeResult ){
						var sumtradeInSelectPrice=resultList.reduce((sum, item) => sum+parseInt(item.dataPrice),0)
						eupTradeInPrice = parseFloat(upgradePriceArea.attr('data-price')) - parseFloat(sumtradeInSelectPrice);
						upgradePriceArea.attr( 'data-price', eupTradeInPrice );
						$(upgradePriceArea).find('.option-result__text').innerHTML = currencyComma(parseFloat(eupTradeInPrice/24),priceCurrency) +  ' / ' + Granite.I18n.get("month");
					}

				}

			} else if( siteCode === 'pl' ){
				if( !tradeinDiscountYn ){
					displayPrice = orignalTotalPrice;
					discountText1 = `${Granite.I18n.get('Trade-in discount')}: `;
					discountText2 = currencyComma(displayPrice, priceCurrency);
					//2023-07-26 add -  Cashback Type  Trade-in   Price Summary  Price    
					displayPrice = 0; 
				}
				
			} else if( siteCode ==='lv' || siteCode ==='lt' || siteCode ==='ee' ){
				if( !tradeinDiscountYn ){
					displayPrice = orignalTotalPrice;
					discountText1= currencyComma(displayPrice, priceCurrency);
					displayPrice = null;
				}
				if( dealBonusPrice ){
					tradeinAmountText = `${currencyComma(tradeinAmount, priceCurrency)} (${Granite.I18n.get('Your device trade-in value')})`;
					dealBonusPriceText = `${currencyComma(dealBonusPrice, priceCurrency)} (${Granite.I18n.get('Additional bonus')})`;
					discountText1 = `${Granite.I18n.get('Total trade amount')} : ${currencyComma(discountAmount, priceCurrency)}`;
				}
				description = Granite.I18n.get('* Values will vary based on model and condition of trade-in. T&Cs apply.');
			} else if( siteCode ==='id' || siteCode === 'ph' ){
				if( !tradeinDiscountYn ){
					// exchange   ..     .
					displayPrice = orignalDisplayPrice + orignalCashBackPrice;
					if( orignalDisplayPrice !== 0 ){
						discountText1 = currencyComma( orignalDisplayPrice, priceCurrency ) +' (' +Granite.I18n.get('Regular exchange discount') + ')';
					}
					
					if( orignalCashBackPrice !== 0 ){
						discountText2 = currencyComma( orignalCashBackPrice, priceCurrency )+' (' + Granite.I18n.get('Additional exchange discount') + ')';
					}
				}
				if( sharedObj.isMultiTradeIn ){
					discountText1 = `${Granite.I18n.get('Regular Exchange Value')} ${currencyComma(orignalDisplayPrice, priceCurrency)}`;
					
					let displayModelAndBrandName = [];
					if( data.displayBrandName ){
						displayModelAndBrandName.push( data.displayBrandName );
					}
					
					if( data.displayModelName ){
						displayModelAndBrandName.push( data.displayModelName );
					}
					//CRHQ-7531 [B2C][BC][ID] Trade-in CX 
					var tradeInSpecialPrice="";
					if(data.tradeInSpecialPrice ){
						tradeInSpecialPrice =parseFloat(data.tradeInSpecialPrice);
					}
					const resultItem = {
						'index': resultList.length,
						'count': resultList.length+1,
						'displayModelName': displayModelAndBrandName.join(' | '),
						'discountPriceText': currencyComma(displayPrice, priceCurrency),
						'discountText1': discountText1,
						'dataPrice': displayPrice,
						'dataCashBack': cashBackPrice,
						'dataQuoteId': data.tradeinId,
						'dataId': data.consents,
						'services': data,
						'specialDiscountText' : specialDiscountText,
						'discountPrice' : parseFloat(displayPrice),
						'specialPrice' : tradeInSpecialPrice
					};
					
					if( sharedObj.checkedIndex > -1 ){
						resultItem.index = sharedObj.checkedIndex;
						resultList.splice(sharedObj.checkedIndex,1,resultItem);
					} else {
						resultList.push(resultItem);
					}
				}
			} else if( siteCode === 'uk' ){			//new-hybris
				if( !tradeinDiscountYn ){
					displayPrice = orignalDisplayPrice + orignalCashBackPrice;
					discountText1 = '- ' + currencyComma(displayPrice, priceCurrency)+ ' ' + Granite.I18n.get('Upfront discount');
				}
			} else if( siteCode === 'fr' ){			//new-hybris
				if( !tradeinDiscountYn ){
					displayPrice = orignalDisplayPrice + orignalCashBackPrice;
					discountText1 = '- ' + currencyComma(displayPrice, priceCurrency)+ ' ' + Granite.I18n.get('Upfront discount');
					
					if( orignalCashBackPrice !== 0 ){
						description = Granite.I18n.get("* Includes {0} additional discount",currencyComma(orignalCashBackPrice, priceCurrency));
					}
				} else {
					cashBackPrice = orignalDisplayPrice + orignalCashBackPrice;
					discountText1 = currencyComma(cashBackPrice, priceCurrency) + ' ' + Granite.I18n.get("Cashback");
					
					if( orignalCashBackPrice !== 0 ){
						description = Granite.I18n.get("* Includes {0} additional discount",currencyComma( orignalCashBackPrice, priceCurrency ));
					}
				}
				sharedObj.commonTradein = data.commonTradein;
				 
				let tradeInSpecialPrice="";
				if(data.tradeInSpecialPrice ){
					tradeInSpecialPrice = parseInt(data.tradeInSpecialPrice);
				}
				//CRHQ-8480
				if( sharedObj.isMultiTradeIn ){
					
					let displayModelAndBrandName = [];
					if( data.displayBrandName ){
						displayModelAndBrandName.push( data.displayBrandName );
					}
					
					if( data.displayModelName ){
						displayModelAndBrandName.push( data.displayModelName );
					}
					let discountPriceTextTile = `${Granite.I18n.get("Total de remise applique")}`;
					discountText1 = `${currencyComma(oriI18n.get('de valeur de reprise de votre ancien appareil')}`;
					// CRHQ-8194 [B2C][MX][FR] Spot Guarantee Trade-in
					let abondementAmount = data.abondementAmount;
					let abondementAmountText = '';
					let spotGuaranteeAmount =  data.spotGuaranteeAmount;
					let spotGuaranteeAmountText = '';
					if(!data.spotGuaranteeAmount && !data.abondementAmount && !data.tradeInSpecialPrice){
						discountText1 = "";
					}
					if(data.spotGuaranteeAmount){
						spotGuaranteeAmountText = `+${currencyComma(data.spotGuaranteeAmount, priceCurrency)} ${Granite.I18n.get("ajout  votre valeur initiale (offre de reprise garantie)")}`;
					}
					if(data.abondementAmount){
						abondementAmountText = `+${currencyComma(data.abondementAmount, priceCurrency)} ${Granite.I18n.get("ajout  votre valeur initiale (abondement)")}`;
					}
					if(data.tradeInSpecialPrice ){
						specialDiscountText = `+${currencyComma(parseInt(data.tradeInSpecialPrice), priceCurrency)} ${Granite.I18n.get("de bonus reprise")}`;
					}
					// CRHQ-8194 [B2C][MX][FR] Spot Guarantee Trade-in
					const resultItem = {
						'index': resultList.length,
						'count': resultList.length+1,
						'displayModelName': displayModelAndBrandName.join(' | '),
						'discountPriceText': currencyComma(displayPrice, priceCurrency),
						'discountText1': discountText1,
						'dataPrice': displayPrice,
						'dataCashBack': cashBackPrice,
						'dataQuoteId': data.tradeinId,
						'dataId': data.consents,
						'services': data,
						'specialDiscountText' : specialDiscountText,
						'discountPrice' : parseFloat(displayPrice),
						'specialPrice' : tradeInSpecialPrice,
						'discountPriceTextTile' : discountPriceTextTile,
						'abondementAmount' : abondementAmount,
						'abondementAmountText' : abondementAmountText,
						'spotGuaranteeAmount' : spotGuaranteeAmount,
						'spotGuaranteeAmountText' : spotGuaranteeAmountText
					};
					if( sharedObj.checkedIndex > -1 ){
						resultItem.index = sharedObj.checkedIndex;
						resultList.splice(sharedObj.checkedIndex,1,resultItem);
					} else {
						resultList.push(resultItem);
					}
				}
				
				if(tradeInSpecialPrice ){
					specialDiscountText = `${Granite.I18n.get("Special Discount")} ${currencyComma(tradeInSpecialPrice, priceCurrency)}`;
					//    
					orignalTotalPrice = parseFloat(orignalTotalPrice) + parseFloat(tradeInSpecialPrice);
					displayPrice += tradeInSpecialPrice;
				}
				
			} else if( siteCode === 'be' || siteCode === 'be_fr' || siteCode === 'nl' ){
				//new-hybris
				//[COMP6FE-1499] SENA  instant discount  Trade-In  
				discountText1 = `${currencyComma(orignalDisplayPrice, priceCurrency)} (${Granite.I18n.get('Regular Exchange Value')})`;
				description = Granite.I18n.get('* Values will vary based on model and condition of trade-in. T&Cs apply.');
				
				if( sharedObj.isMultiTradeIn ){
					discountText1 = `${Granite.I18n.get('Regular Exchange Value')} ${currencyComma(orignalDisplayPrice, priceCurrency)}`;
					
					let displayModelAndBrandName = [];
					if( data.displayBrandName ){
						displayModelAndBrandName.push( data.displayBrandName );
					}
					
					if( data.displayModelName ){
						displayModelAndBrandName.push( data.displayModelName );
					}
					
					const resultItem = {
						'index': resultList.length,
						'count': resultList.length+1,
						'displayModelName': displayModelAndBrandName.join(' | '),
						'discountPriceText': currencyComma(displayPrice, priceCurrency),
						'discountText1': discountText1,
						'dataPrice': displayPrice,
						'dataCashBack': cashBackPrice,
						'dataQuoteId': data.tradeinId,
						'dataId': data.consents,
						'services': data
					};
					
					if( sharedObj.checkedIndex > -1 ){
						resultItem.index = sharedObj.checkedIndex;
						resultList.splice(sharedObj.checkedIndex,1,resultItem);
					} else {
						resultList.push(resultItem);
					}
				}
			}else if( siteCode === 'sk' || siteCode === 'cz' ){
				if( orignalCashBackPrice > 0 ){
					cashBackPrice = orignalDisplayPrice;
					discountText1 = Granite.I18n.get('Up to(apply_step)') + ' ' + currencyComma(cashBackPrice, priceCurrency) + ' ' + Granite.I18n.get('for your old device');
					displayPrice = 0;
				}else{
					discountText1 = '- ' + currencyCommaExcep(displayPrice, priceCurrency)+ ' ' + Granite.I18n.get('Upfront Trade-Up discount');
				}
			}else if( siteCode === 'pe' || siteCode === 'co' ){
				discountText1 = currencyComma(orignalCashBackPrice, priceCurrency) + ' ' + Granite.I18n.get("Cashback");
				displayPrice = 0;
			}else if( siteCode === 'mx' ){
				discountText1 = currencyComma(orignalTotalPrice, priceCurrency) + ' ' + Granite.I18n.get("Cashback");
				displayPrice = 0;


			// CRHQ-8132 [B2C][MX][KZ] New Trade-In Telekom
			} else if ( siteCode === 'kz_kz' || siteCode === 'kz_ru' ) {
			    description = Granite.I18n.get('* Values will vary based on model and condition of trade-in. T&Cs apply.');

			    if (sharedObj.isMultiTradeIn) {

                    let displayModelAndBrandName = [];
                    if( data.displayBrandName ){
                        displayModelAndBrandName.push( data.displayBrandName );
                    }

                    if( data.displayModelName ){
                        displayModelAndBrandName.push( data.displayModelName );
                    }

                    const resultItem = {
                        'index': resultList.length,
                        'count': resultList.length+1,
                        'displayModelName': displayModelAndBrandName.join(' | '),
                        'discountPriceText': currencyComma(displayPrice, priceCurrency),
                        'discountText1': discountText1,
                        'dataPrice': displayPrice,
                        'dataCashBack': cashBackPrice,
                        'dataQuoteId': data.tradeinId,
                        'imeiKey' : data.imeiKey,
                        'dataId': data.consents,
                        'services': data
                    };

                    if( data.checkedIndex > -1 ){
                        resultList.splice(0);
                        resultList.push(resultItem);
                    } else {
                        resultList.push(resultItem);
                    }
                }

			// SplitPD
			}else if( siteCode === 'ua'){
				cashBackPrice = orignalCashBackPrice;			
				discountText1 = Granite.I18n.get('Total Discount') + ' : ' + currencyComma((Number(displayPrice) + Number(cashBackPrice)), priceCurrency);
				discountText2 ='-' + currencyComma(displayPrice, priceCurrency) + ' (' + Granite.I18n.get('Upfront discount') +')';
				discountText3 ='-' + currencyComma(cashBackPrice, priceCurrency) + ' (' + Granite.I18n.get('Cashback') +')';
				description = Granite.I18n.get('* Values will vary based on model and condition of trade-in. T&Cs apply.');
			} else if( siteCode === 'at' && $('#categoryGroupCode').val() === '01000000'){
				displayPrice = orignalTotalPrice;
				discountText1 = currencyComma(displayPrice, priceCurrency);
				displayPrice = 0;
			} else if( siteCode === 'ro'){
				discountText1 = currencyComma(displayPrice, priceCurrency);
			} else if(siteCode === 'jp'){
				//CRHQ-9399 [B2C] JP - tradein 
				priceAreaTitleText = Granite.I18n.get("Total Cashback amount");

				if(eventAmountPrice > 0){
					deletedOriginalCashBackPriceText = `<del>${Granite.I18n.get("Trade-in value")} : ${currencyComma(orignalCashBackPrice, priceCurrency)}</del>`;
					totalCashBackPriceText = `${Granite.I18n.get("Total trade-in value")} : ${currencyComma(eventAmountPrice, priceCurrency)}`;
				}else{
					totalCashBackPriceText = `${Granite.I18n.get("Trade-in value")} : ${currencyComma(orignalTotalPrice, priceCurrency)}`;	
				}
				displayPrice = 0; // cashBack   summary  navBar   .
			} else if( isHybrisSplitPD && isHybrisSplitPDTradeIn){
				if( siteCode == 'se' ){
					if( StrOrignalDisplayPrice !== undefined && StrOrignalDisplayPrice !== "" && StrOrignalDisplayPrice !== null ){
						orignalDisplayPrice = StrOrignalDisplayPrice;
					}
				}
				isSpecial = false;
				description = Granite.I18n.get('* Values will vary based on model and condition of trade-in. T&Cs apply.');

				if( siteCode === 'es' ){
					orignalTotalPrice = orignalTotalPrice != undefined && orignalTotalPrice ? parseFloat(orignalTotalPrice) : 0;
					orignalCashBackPrice = orignalCashBackPrice != undefined && orignalCashBackPrice ? parseFloat(orignalCashBackPrice) : 0;

					if( orignalDisplayPrice > 0 ){
						discountText2 = Granite.I18n.get('Value to') + ' ' + currencyComma(orignalTotalPrice, priceCurrency) + ' ' + Granite.I18n.get('include promotion');
					}else{
						discountText2 = Granite.I18n.get('Up to')  + ' ' + currencyComma(orignalCashBackPrice, priceCurrency) + ' ('+ Granite.I18n.get('Cashback') +')';
					}

					if($('#categoryGroupCode').val() === '04000000'){
						description = Granite.I18n.get('Trade-In disclaimer(TV)');
					}

				}else if( siteCode === 'my' ){
					//CRHQ-6886 [B2C][BC][MY] Seamless Trade-In + Stackable Trade in
					description = Granite.I18n.get('* Values will vary based on model and condition of trade-in. T&Cs apply.');
					discountText1 = `${Granite.I18n.get('Regular Exchange Value')}`;
					let displayModelAndBrandName = [];
					if( data.displayBrandName ){
						displayModelAndBrandName.push( data.displayBrandName );
					}
					if( data.displayModelName ){
						displayModelAndBrandName.push( data.displayModelName );
					}

					if( data.tradeInSpecialPrice ){ // CRHQ-8566 [B2C] MY - tradein    
						const tradeInSpecialPrice = parseInt(data.tradeInSpecialPrice);
						orignalTotalPrice = parseFloat(orignalTotalPrice) + parseFloat(tradeInSpecialPrice);
						if(orignalCashBackPrice == 0 && orignalDisplayPrice > 0){ // 
							displayPrice += tradeInSpecialPrice;
						}else if(orignalCashBackPrice > 0 && orignalDisplayPrice == 0){ // 
							displayPrice = 0;
						}
					}

					const resultItem = {
						'index': resultList.length,
						'count': resultList.length+1,
						'displayModelName': displayModelAndBrandName.join(' | '),
						'discountPriceText': currencyComma(orignalCashBackPrice,  priceCurrency)+"*",
						'discountText1': discountText1,
						'dataPrice': displayPrice,
						'dataCashBack': orignalCashBackPrice,
						'dataQuoteId': data.tradeinId,
						'dataId': data.consents,
						'services': data
					};

					// CRHQ-8566 [B2C] MY - tradein     > CRHQ-7908 cashback -> discount     
					// cashback, discount  tradein result  additional Discount  
					resultItem.discountPriceText = currencyComma(orignalTotalPrice,  priceCurrency)+"*";

					if( sharedObj.checkedIndex > -1 ){
						resultItem.index = sharedObj.checkedIndex;
						resultList.splice(sharedObj.checkedIndex,1,resultItem);
					} else {
						resultList.push(resultItem);
					}
                }else if( siteCode === 'vn' ){//CRHQ-6829 vn
					description = Granite.I18n.get('* Values will vary based on model and condition of trade-in. T&Cs apply.');
					//CRHQ-7418 [B2C][BC][VN] Trade in overtrade  
					var tradeInSpecialPrice="";
					if(data.tradeInSpecialPrice ){
						tradeInSpecialPrice =parseFloat(data.tradeInSpecialPrice);
					}

					const resultItem = {
						'index': resultList.length,
						'count': resultList.length+1,
						'displayModelName': data.displayModelName,
						'dataPrice': displayPrice,
						'dataCashBack': orignalCashBackPrice,
						'dataQuoteId': data.tradeinId,
						'dataId': data.consents,
						'imeiKey' : data.imeiKey,
						'services': data,
						'specialDiscountText' : specialDiscountText,
						'discountText1' : discountText1,
						'discountPrice' : parseFloat(displayPrice),
						'specialPrice' : tradeInSpecialPrice
					};

					if( sharedObj.checkedIndex > -1 ){
						resultItem.index = sharedObj.checkedIndex;
						resultList.splice(sharedObj.checkedIndex,1,resultItem);
					} else {
						resultList.push(resultItem);
					}

				}else if( sharedObj.isMultiTradeIn ){
					//[COMP6FE-1495] Au Multi TradeIn  

					let displayModelAndBrandName = [];
					if( data.displayBrandName ){
						displayModelAndBrandName.push( data.displayBrandName );
					}

					if( data.displayModelName ){
						displayModelAndBrandName.push( data.displayModelName );
					}
					//CRHQ-6172 [B2C][BC] SG Stackable Trade in 
					var tradeInSpecialPrice="";
					if( siteCode === 'sg' && data.tradeInSpecialPrice ){
						tradeInSpecialPrice =parseFloat(data.tradeInSpecialPrice);
					}
					// CRHQ-7213 [B2C][BC] AU trade in journey
					var tradeInPrice="";
					if( siteCode === 'au'){
						if(data.tradeInPrice){
							tradeInPrice =parseFloat(data.tradeInPrice);
						}
					}
					const resultItem = {
						'index' : resultList.length,
						'count' : resultList.length+1,
						'displayModelName' : displayModelAndBrandName.join(' | '),
						'discountPriceText' : currencyComma(displayPrice, priceCurrency),
						'dataPrice' : displayPrice,
						'dataCashBack' : cashBackPrice,
						'dataQuoteId' : data.tradeinId,
						'dataId' : data.consents,
						'services' : data,
						'specialDiscountText' : specialDiscountText,
						'discountText1' : discountText1,
						'discountPrice' : parseFloat(displayPrice),
						'specialPrice' : tradeInSpecialPrice,
						'tradeInPrice' : tradeInPrice
					};

					if( sharedObj.checkedIndex > -1 ){
						resultItem.index = sharedObj.checkedIndex;
						resultList.splice(sharedObj.checkedIndex,1,resultItem);
					} else {
						resultList.push(resultItem);
					}
				} else if( siteCode === 'hk' || siteCode === 'hk_en' ){

					//COMP6FE-1504 hk,hk_en tradeIn 
					if(data.tradeinTotalAmount !== undefined){
						discountText1 = ` ${Granite.I18n.get('Trade-in discount')} : ${currencyComma(data.tradeinTotalAmount, priceCurrency)} ( ${Granite.I18n.get('Total Rebate')} )`;

						if( data.tradeinTotalAmount > 0 ){
							if(data.tradeinValue > 0 ){
								discountText2 = `${currencyComma(data.tradeinValue, priceCurrency)} ( ${Granite.I18n.get('Rebate')} )`;
							}
							if(data.exclusiveTradeinUnitOffer > 0 ){
								discountText3 = `${currencyComma(data.exclusiveTradeinUnitOffer, priceCurrency)} ( ${Granite.I18n.get('Extra Trade-in Rebate')} )`;
							}
							if(data.extraTradeinOffer > 0 ){
								discountText4 = `${currencyComma(data.extraTradeinOffer, priceCurrency)} ( ${Granite.I18n.get('Designated Used Device Trade-in Rebate')} )`;
							}
							if(data.exclusiveChannerTradeinOffer > 0 ){
								discountText5 = `${currencyComma(data.exclusiveChannerTradeinOffer, priceCurrency)} ( ${Granite.I18n.get('Online Shop Trade-in Rebate')} )`;
							}
							if(data.extraTradeinVoucher > 0 ){
								discountText6 = `${currencyComma(data.extraTradeinVoucher, priceCurrency)} ( ${Granite.I18n.get('Promo code Trade-in Rebate')} )`;
							}
						}
					}

					displayPrice = 0;

				} else if( siteCode === 'nz'){
					modelAndBrand = Granite.I18n.get('Trade-in') + ' : ' + modelAndBrand;
					discountText1 = Granite.I18n.get('Total Discount') + ' : ' + currencyComma(orignalTotalPrice, priceCurrency);

					if(enhancedDiscountAmount > 0){
						discountText2 = '-' + currencyComma(orignalDisplayPrice, priceCurrency) + ' (' + Granite.I18n.get('Your old device value') + ')';
						discountText3 = '-' + currencyComma(enhancedDiscountAmount, priceCurrency) + ' (' + Granite.I18n.get('Overtrade bonus') + ')';
					}
					displayPrice = orignalTotalPrice;
				} else{
					if( orignalDisplayPrice > 0 ){
						discountText2 = currencyComma(orignalDisplayPrice, priceCurrency);

						if( siteCode === 'ru' || siteCode === 'au' || siteCode === 'th' ){
							if( Granite.I18n.get('Immediate Discount') !== ' ' ){
								discountText2 += ' (' + Granite.I18n.get('Immediate Discount') + ')';
							}
						} else if( siteCode === 'vn' ){
							//[COMP6FE-1482] Vn TradeIn 
							modelAndBrand = null;
							discountText1 = `${currencyComma(orignalDisplayPrice, priceCurrency)} (${Granite.I18n.get('Regular Exchange Value')}) `;
							discountText2 = null;
						} else{
							if( Granite.I18n.get('Regular Exchange Value') !== ' ' ){
								if( siteCode === 'za' ){
									discountText2 += '*';
								}
								discountText2 += ' (' + Granite.I18n.get('Regular Exchange Value') + ')';
							}
						}
					}
					// 
					if( orignalCashBackPrice > 0 ){
						if( !(siteCode === 'th' && orignalDisplayPrice > 0) ){ // th: cashback, immediate    Immediate 
							if( discountText2 !== '' ){
								discountText3 = currencyComma(orignalCashBackPrice, priceCurrency) + ' ('+ Granite.I18n.get('Cashback') +')';
							}else{
								discountText2 = currencyComma(orignalCashBackPrice, priceCurrency) + ' ('+ Granite.I18n.get('Cashback') +')';
							}
						}
					}
				}

				//  
				if( specialPrice !== '' && Number(specialPrice) > 0 ){
					specialDiscountText = currencyComma(specialPrice, priceCurrency);

					if(specialMessage !== '')
						specialDiscountText += ' ('+ specialMessage +')';
					else{
						specialDiscountText += ' ('+ Granite.I18n.get("Special Discount") +')';
					}

					//    
					orignalTotalPrice = parseFloat(orignalTotalPrice) + parseFloat(specialPrice);

					isSpecial = true;
				}

				// COMP6FE-1502 sg tradeIn 
				if( siteCode === 'sg' && data.tradeInSpecialPrice ){
					const tradeInSpecialPrice = parseInt(data.tradeInSpecialPrice);
					specialDiscountText = `${Granite.I18n.get("Special Discount")} ${currencyComma(tradeInSpecialPrice, priceCurrency)}`;

					//    
					orignalTotalPrice = parseFloat(orignalTotalPrice) + parseFloat(tradeInSpecialPrice);
					displayPrice += tradeInSpecialPrice;

					isSpecial = true;
				}

				//   &  
				if(isSpecial){
					// it Immediate Discount  ()
					if( (siteCode !== 'it' && siteCode !== 'ru' && siteCode !== 'au' && siteCode !== 'nz' && siteCode !== 'za' && siteCode !== 'th' && siteCode !== 'ca' && siteCode !== 'ca_fr') && orignalDisplayPrice > 0 ){	// 
						discountText1 = Granite.I18n.get("Total Discount") + ' : ' + currencyComma(orignalTotalPrice, priceCurrency);
					}else{
						discountText1 = Granite.I18n.get("Total Benefit") + ' : ' + currencyComma(orignalTotalPrice, priceCurrency);
					}

				}else{
					// it       
					if(siteCode === 'it' && (orignalDisplayPrice > 0 || orignalCashBackPrice > 0)){
						discountText1 = null;
						discountText2 = null;
						if(orignalDisplayPrice > 0 ){//CRHQ-8311
							let displayModelAndBrandName = [];
							if( data.displayBrandName ){
								displayModelAndBrandName.push( data.displayBrandName );
							}

							if( data.displayModelName ){
								displayModelAndBrandName.push( data.displayModelName );
							}
							modelAndBrand = Granite.I18n.get('Galaxy Now! Credito Immediato') + ' : ' + displayModelAndBrandName.join(' | ');
						}
					}
				}
			}

			tradeInResultDraw = {
				'hasComponent' : true,
				'displayModelName' : modelAndBrand,
				'discountText1' : discountText1,
				'discountText2' : discountText2,
				'discountText3' : discountText3,
				'discountText4' : discountText4,
				'discountText5' : discountText5,
				'discountText6' : discountText6,
				'specialDiscountText' : specialDiscountText,
				'description' : description,
				'dataPrice' : displayPrice,
				'dataCashBack' : cashBackPrice,
				'dataQuoteId' : data.tradeinId,
				'dataId' : data.consents,
				'list' : resultList, // //[COMP6FE-1495] Au Multi TradeIn  
				'tradeinAmountText' : tradeinAmountText,
				'dealBonusPriceText' : dealBonusPriceText,
				'additionalDiscountFlag' : additionalDiscountFlag,
				'priceAreaTitleText' : priceAreaTitleText, //CRHQ-9399 [B2C] JP - tradein  priceAreaTitle, totalCashBackPrice, deletedOriginalCashBackPrice 
				'totalCashBackPriceText' : totalCashBackPriceText,
				'deletedOriginalCashBackPriceText' : deletedOriginalCashBackPriceText
			}

			// CRHQ-9406 [B2C][MX][DK] Trade-in  / 
			if(siteCode == 'dk') {
				tradeInResultDraw['discountPriceText'] = currencyComma(displayPrice, priceCurrency);
				tradeInResultDraw['discountText2'] = Granite.I18n.get('Regular Exchange Value') + ' ' + tradeInResultDraw['discountPriceText'];
			}

			// [COMP6FE-1495] Au Multi TradeIn   -   
			// CRHQ-5944 [B2C][BC][IM] SEBN stackable trade in
			if( sharedObj.isMultiTradeIn && resultList.length > 0 ){
				//CRHQ-6172,CRHQ-7418,CRHQ-7531 [B2C][BC][ID] Trade-in CX
				if( siteCode === 'sg' || siteCode === 'vn' || siteCode === 'id' || additionalDiscountFlag){// CRHQ-8578//8960
					window.sg.components.dynamic.DetailAfterEvent.tradeInResultSpecialPrice(sharedObj,tradeInResultDraw);// CRHQ-8578
				}
				tradeInResultDraw.dataPrice = resultList.reduce((sum, item) => sum+parseInt(item.dataPrice),0);

				// CRHQ-8132 [B2C][MX][KZ] New Trade-In Telekom
				if ( siteCode === 'kz_kz' || siteCode === 'kz_ru' ) {
				    tradeInResultDraw.dataPrice = data.totalSumPrice;
				}

				// trade-in  - price + minOrderEntryValue()
				var excessAmount = Number( tradeInResultDraw.dataPrice ) - Number( sharedObj.proudctPriceInfo.salePrice );

				if( sharedObj.minOrderEntryValue ){
                    excessAmount += Number( sharedObj.minOrderEntryValue );
                }

                // CRHQ-8132 [B2C][MX][KZ] New Trade-In Telekom
				//CRHQ-8945 [B2C][MX][DE] Stackable Trade-In 
				if( siteCode === 'be' || siteCode === 'be_fr' || siteCode === 'nl' || siteCode === 'sg' || siteCode === 'vn' || siteCode === 'my' || siteCode === 'id'  || siteCode === 'fr' || siteCode === 'kz_kz' || siteCode === 'kz_ru' || siteCode === 'de' || siteCode === 'sa' || siteCode === 'sa_en'){//CRHQ-8480
				    tradeInResultDraw.totalAmountText = currencyComma( tradeInResultDraw.dataPrice, priceCurrency ); //CRHQ-6829 vn tradeIn 
					if( excessAmount > 0 ){
						tradeInResultDraw.priceOverFlag = true;
						tradeInResultDraw.excessAmount = excessAmount;
						tradeInResultDraw.excessAmountText = currencyComma( excessAmount, priceCurrency );
						tradeInResultDraw.tenText = currencyComma( sharedObj.minOrderEntryValue, priceCurrency );
					}
				}else{
					if( tradeInResultDraw.dataPrice > sharedObj.proudctPriceInfo.salePrice ){
						tradeInResultDraw.priceOverFlag = true;
					}
				}

			}

			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-trade-in-0"));

			drawObj.tradeInResult = tradeInResultDraw;
			view.tradeInResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );

			// CRHQ-8831 (fr) tradein  sc+: monthly hide 
			if( siteCode === 'fr' ){
				if( $('.option-care').hasClass('has-component') ){
					const careList = $('.option-care .pd-select-option__list--samsung-care input');
					careList.each((i, e)=>{
					    if( careList.eq(i).attr('data-paymentcycle') === 'monthly' ){
					    	careList.eq(i).attr('disabled',true);
					    }
					});
				}
			}
		}
	}

	/**
	 * Trade In Result     
	 */
	function settingTradeInGlobalData( data, sharedObj, hasPriceData ) {

		const priceCurrency = sharedObj.priceCurrency;
		const isHybrisSplitPD = sharedObj.isHybrisSplitPD;

		let tradeinDiscountYn = false;
		let displayBrandName = '';
		let displayModelName = '';
		let modelAndBrand = '';
		let StrOrignalDisplayPrice = '';
		let orignalDisplayPrice = 0;
		let orignalCashBackPrice = 0;
		let orignalTotalPrice = 0;
		let displayPrice = 0;
		let cashBackPrice = 0;
		let priceText = '';
		let enhancedDiscountAmount = 0;
		let displayModelAndBrandName = [];
		let tradeinAmount = '';
		let discountAmount = '';
		let dealBonusPrice = '';
		let eventAmountPrice = 0;

		if( data.tradeinDiscountYn ){
			tradeinDiscountYn = data.tradeinDiscountYn;
		}

		if( data.displayBrandName ){
			displayBrandName =  data.displayBrandName ;
			displayModelAndBrandName.push( data.displayBrandName );
		}

		if( data.displayModelName ){
			displayModelName = data.displayModelName;
			displayModelAndBrandName.push( data.displayModelName );
		}

		modelAndBrand = Granite.I18n.get('Your Trade-in') + ' : ' + displayModelAndBrandName.join(' | ');
		if( siteCode === 'pt' ){
			modelAndBrand = Granite.I18n.get("Your Trade-in") + " : " + displayModelName;
		}else if( siteCode === 'nz' || siteCode === 'dk' ){ // CRHQ-9406
			modelAndBrand = displayModelAndBrandName.join(' | ');
		}

		if( hasPriceData ){
			StrOrignalDisplayPrice = data.value.price;
			orignalDisplayPrice = parseFloat( data.value.price );
			orignalCashBackPrice = parseFloat( data.discount.price );
			orignalTotalPrice = parseFloat( data.discount.total );
			//COMP6FE-1492(ca  )
			if(data.value.enhancedDiscountAmount){
				enhancedDiscountAmount = parseFloat( data.value.enhancedDiscountAmount );
			}

			if(data.discount && data.discount.eventAmountPrice){
				eventAmountPrice = parseFloat(data.discount.eventAmountPrice);
			}
		}

		if( !tradeinDiscountYn ){
			displayPrice = orignalDisplayPrice;
			if( !isHybrisSplitPD ){
				priceText= '- ' + currencyComma(displayPrice, priceCurrency) + ' ' + Granite.I18n.get('Upfront discount');
			}
		} else {
			cashBackPrice = orignalDisplayPrice;
			if( !isHybrisSplitPD ){
				priceText = '- ' + currencyComma(cashBackPrice, priceCurrency) + ' ' + Granite.I18n.get('Cashback');
			}
		}

		const isSEB = (siteCode === "lt" || siteCode === "lv" || siteCode === "ee") ? true : false;
		if( isSEB && data.dealBonusPrice ){
			tradeinAmount = data.tradeinAmount;
			discountAmount = data.discountAmount;
			dealBonusPrice = data.dealBonusPrice;
		}

		const globalCaseData = {
			'tradeinDiscountYn' : tradeinDiscountYn,
			'displayBrandName' : displayBrandName,
			'displayModelName' : displayModelName ,
			'modelAndBrand' : modelAndBrand,
			'StrOrignalDisplayPrice' : StrOrignalDisplayPrice,
			'orignalDisplayPrice' : orignalDisplayPrice,
			'orignalCashBackPrice' : orignalCashBackPrice,
			'orignalTotalPrice' : orignalTotalPrice,
			'displayPrice' : displayPrice,
			'cashBackPrice' : cashBackPrice,
			'priceText' : priceText,
			'enhancedDiscountAmount' : enhancedDiscountAmount, //[B2C] COMP6FE-1492(ca   )
			'tradeinAmount': tradeinAmount,
			'discountAmount': discountAmount,
			'dealBonusPrice': dealBonusPrice,
			'eventAmountPrice': eventAmountPrice
		}

		return globalCaseData;
	}

	function tariffOptionResultDraw ( data , sharedObj, selectorObj, view ){
		const drawObj = sharedObj.drawObj;
		const util = sharedObj.util;
		const priceCurrency = sharedObj.priceCurrency;
		const siteCode = sharedObj.siteCode;
		let discountText1 = '';

		if( data ){
			if( siteCode === 'uk' ){
				discountText1 = Granite.I18n.get("Monthly Price : ") + ' ' + currencyComma(data.price, priceCurrency) + "/month***";
				sharedObj.tariffPrice = data.upfrontAmount;
			}else{
				if( siteCode === 'au' ){
					sharedObj.tariffPrice = data.discount;
				}
				if( data.period ) {
					discountText1 = Granite.I18n.get("You pay now") + ' ' + currencyComma(data.price, priceCurrency) + "/" + data.period;
				} else if(data.price) {
					discountText1 = Granite.I18n.get("You pay now") + ' ' + currencyComma(data.price , priceCurrency);
				}
			}

			if( siteCode === 'au' && data.priceText ){
				discountText1 = data.priceText;
			}

			//5645 CR  { // CRHQ-8994 [B2C][MX][DK] SIM Module 
				discountText1 = '';
			}

			/* CRHQ-7964 [B2C][BC][MX][FR] Enable SIM Tariff display for Simple PD for A series smartphones */
			if( siteCode == "fr" && util.isNotEmpty(data.pricing.promotions) && util.isNotEmpty(data.pricing.promotions[0].monthly_rate.value) ) {
				discountText1 = Granite.I18n.get("Starting from")+' '+Granite.I18n.get("{0}/month",currencyComma(data.pricing.promotions[0].monthly_rate.value, priceCurrency));
			}

			drawObj.tariffOptionResult = {
				'hasComponent' : true,
				'displayModelName' : data.serviceDescription,
				'discountText1' : discountText1,
				'description1' : siteCode == "fr" ? "" : Granite.I18n.get("Invoice will be issued by the network service company"),
				'dataPrice' : data.periodPrice,
				'dataSimskuCode' : data.simSkuCode,
				'dataModelCode' : data.modelCode,
				'dataId' : data.consents
			};

			// CRHQ-5597 [B2C][BC][IM] DE SIM     split : tariff  , CRHQ-7126
			// CRHQ-8914 [B2C][MX][DE] [SIM-Service] customize free-gift based on the planID
			if (siteCode === 'de') {
			    // sharedObj.hasGiftPage == true    .
			    if (sharedObj.hasGiftPage) {
			        sharedObj.hasGift = true;
			        window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
			    } else {
			        sharedObj.hasGift = false;
			        window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(false);

			        if(sharedObj.hasVoucher || sharedObj.hasAddOns){
                        window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
                    }else{
                        window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(false);
                    }
			    }

                let isSkip = false;
			    // sharedObj.hasPlanIDAndFreeGiftPromotion == true     .
			    if (sharedObj.hasPlanIDAndFreeGiftPromotion == true) {
			        isSkip = sharedObj.giftSelectionSkipPlanIdList.includes(data.modelCode);
			        
			        if(isSkip){
                        sharedObj.hasGift = false;
                        if(sharedObj.hasVoucher || sharedObj.hasAddOns){
                            window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
                        }else{
                            window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(false);
                        }
                    }else{
                        sharedObj.hasGift = true;
                        window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
                    }
			    }
			    
			    //    getTariffRelatedProductsSimpleInfo api        .
			    if (!isSkip) {
                    window.sg.components.dynamic.freeGiftHybrisCommon.getTariffRelatedProductsSimpleInfo( sharedObj.modelCode );
			    }
			}

			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-tariff-option-0"));
			
			view.tariffOpionResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
			
			//uk   cart    //new-hybris
			/*if(siteCode === "uk"){
				sharedObj.afterEvent.addToCartCta( [] , true );
			}*/
		}
	}
	
	function giftResultDraw ( data , sharedObj, selectorObj, view ){
		const util = sharedObj.util;
		const drawObj = sharedObj.drawObj;
		const giftData = drawObj.offer.gift;
		const priceCurrency= sharedObj.priceCurrency;
		const pviTypeName = data.pviTypeName ? data.pviTypeName.toLowerCase() : '';
		const pviSubtypeName = data.pviSubtypeName ? data.pviSubtypeName.toLowerCase() : '';
		const categorySubTypeEngName = data.categorySubTypeEngName ? data.categorySubTypeEngName.toLowerCase() : '';
		
		giftData.item.hasBundle = true;
		giftData.item.bundleList = [];
		
		const pcImg = data.thumbUrl;
		let original = '';
		let save = '';
		let now= '';
		let dataPrice = '';
		let dataSalePrice = '';
		
		//    
		if( data.sale_price && data.msrp_price ){
			var saleFormatPrice = "";
			var msrpFormatPrice = "";

			/* formatted     currency  */
			if( !data.sale_price.formatted_value ){
				saleFormatPrice = currencyComma(data.sale_price.value, priceCurrency)
			}else{
				saleFormatPrice = data.sale_price.formatted_value;
			}
			if( !data.msrp_price.formatted_value ){
				msrpFormatPrice = currencyComma(data.msrp_price.value, priceCurrency)
			}else{
				msrpFormatPrice = data.msrp_price.formatted_value;
			}
			
			var fromSebn = '';
			if(siteCode === "nl" || siteCode === "be" || siteCode === "be_fr"){ //new-hybris
				fromSebn = Granite.I18n.get("From");
			}
			
			var fromSeg = '';
			if(siteCode === "de"){ //new-hybris
				fromSeg = Granite.I18n.get("From");
			}

			if( data.sale_price ){
				const savePriceTemp = parseFloat( data.msrp_price.value ) - parseFloat( data.sale_price.value );
				if( savePriceTemp !== 0 ){
					original = fromSebn + fromSeg + msrpFormatPrice;
					dataPrice = data.msrp_price.value;
					
					if(data.saveText && fromSebn === ""){
						save = data.saveText;
					}
					
					now = Granite.I18n.get(saleFormatPrice);
					dataSalePrice= data.sale_price.value

				}else{
					original = ' ';
					dataPrice = data.msrp_price.value;
					now = Granite.I18n.get(saleFormatPrice);
					dataSalePrice= data.sale_price.value
				}

			}else{
				original = ' ';
				dataPrice = data.msrp_price.value;
				now = Granite.I18n.get(msrpFormatPrice);
				dataSalePrice= data.msrp_price.value;
			}
		}
		if( data.selectIdx ){
			giftData.item.learnMoreCta.giftIdx = data.selectIdx; 
		}
		let tempObj = {
			'title' : data.displayName,
			'deleteTitle' : Granite.I18n.get("Delete option") + " : " + data.displayName,
			'dataPrice' : dataPrice,
			'dataSalePrice' : dataSalePrice,
			'dataEventType' : 0,
			'dataModelName' : data.modelName,
			'dataDisplayName' : data.displayName,
			'dataSkuCode' : data.shopSKU,
			'dataModelCode' : data.modelCode,
			'dataIndex' : data.selectIdx,
			'pviTypeName' : pviTypeName,
			'pviSubtypeName' : pviSubtypeName,
			'categorySubTypeEngName' : categorySubTypeEngName,
			'imgAttr' : { 
				'classWapper' : "image__main responsive-img",
				'srcPc' : pcImg,
				'alt' : data.thumbUrlAlt
			},
			'price' : {
				'original' : original,
				'save' : save,
				'now' : now
			}
		};
		
		giftData.item.bundleList.push( tempObj );
		
		view.productOfferDraw( drawObj, true );
		util.settingPriceDraw( sharedObj, selectorObj );
	}
	//new-hybris
	function comboResultDraw ( data , sharedObj, selectorObj, view ){
		const util = sharedObj.util;
		const drawObj = sharedObj.drawObj;
		const comboList = drawObj.offer.combo;
		const comboArea = sharedObj.checkedComboArea
		const comboIndex = Number(comboArea.attr('data-combo-index'));
		const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
		const priceCurrency= sharedObj.priceCurrency;
		
		let selectedCombo= null;
		
		for(var index in comboList ){
			const comboItem = comboList[index];
			if( comboItem.comboIndex === comboIndex ){
				selectedCombo = comboItem;
				break;
			}
		}
		if( selectedCombo ){
			selectedCombo.item.hasBundle = true;
			selectedCombo.item.bundleList = [];
			
			for( var adx in data ){
				
				const pcImg = data[adx].thumbUrl;
				const pviTypeName = data[adx].pviTypeName ? data[adx].pviTypeName.toLowerCase() : '';
				const pviSubtypeName = data[adx].pviSubtypeName ? data[adx].pviSubtypeName.toLowerCase() : '';
				const categorySubTypeEngName = data[adx].categorySubTypeEngName ? data[adx].categorySubTypeEngName.toLowerCase() : '';
				
				let original = '';
				let save = '';
				let now= '';
				let dataPrice = '';
				let dataSalePrice = '';
				//new-hybris
				if( data[adx].msrp_price && !data[adx].sale_price ){
					data[adx].sale_price = data[adx].msrp_price;
				}
				
				//    
				if( data[adx].sale_price && data[adx].msrp_price ){
					var saleFormatPrice = "";
					var msrpFormatPrice = "";

					/* formatted     currency  */
					if( !data[adx].sale_price.formatted_value ){
						saleFormatPrice = currencyComma(data[adx].sale_price.value, priceCurrency)
					}else{
						saleFormatPrice = data[adx].sale_price.formatted_value;
					}
					if( !data[adx].msrp_price.formatted_value ){
						msrpFormatPrice = currencyComma(data[adx].msrp_price.value, priceCurrency)
					}else{
						msrpFormatPrice = data[adx].msrp_price.formatted_value;
					}
					
					var fromSebn = '';
					if(siteCode === "nl" || siteCode === "be" || siteCode === "be_fr"){
						fromSebn = Granite.I18n.get("From");
					}
					
					var fromSeg = '';
					if(siteCode === "de"){
						fromSeg = Granite.I18n.get("From");
					}

					if( data[adx].sale_price ){
						const savePriceTemp = parseFloat( data[adx].msrp_price.value ) - parseFloat( data[adx].sale_price.value );
						if( savePriceTemp !== 0 ){
							original = fromSebn + fromSeg + msrpFormatPrice;
							dataPrice = data[adx].msrp_price.value;
							
							
							if(data[adx].saveText && fromSebn === ""){
								save = data[adx].saveText;
							}
							
							now = Granite.I18n.get(saleFormatPrice);
							dataSalePrice= data[adx].sale_price.value

						}else{
							original = ' ';
							dataPrice = data[adx].msrp_price.value;
							now = Granite.I18n.get(saleFormatPrice);
							dataSalePrice= data[adx].sale_price.value
						}

					}else{
						original = ' ';
						dataPrice = data[adx].msrp_price.value;
						now = Granite.I18n.get(msrpFormatPrice);
						dataSalePrice= data[adx].msrp_price.value;
					}
				}
				
				let tempObj = {
					'title' : data[adx].displayName,
					'deleteTitle' : Granite.I18n.get("Delete option") + " : " + data[adx].displayName,
					'dataPrice' : dataPrice,
					'dataSalePrice' : dataSalePrice,
					'dataEventType' : 'combo-'+comboIndex+'-'+adx,
					'dataModelName' : data[adx].modelName,
					'dataDisplayName' : data[adx].displayName,
					'pviTypeName' : pviTypeName,
					'pviSubtypeName' : pviSubtypeName,
					'categorySubTypeEngName' : categorySubTypeEngName,
					'dataSkuCode' : data[adx].shopSKU,
					'dataModelCode' : data[adx].modelCode,
					'dataIndex' : data[adx].idx,
					'imgAttr' : { 
						'classWapper' : "image__main responsive-img",
						'srcPc' : pcImg,
						'alt' : data[adx].thumbUrlAlt
					},
					'price' : {
						'original' : original,
						'save' : save,
						'now' : now
					}
				};
				
				selectedCombo.item.bundleList.push( tempObj );
			}

			if(siteCode === "in"){
				if( hasTradeInResult ) {
					util.exchangeResultDraw( sharedObj, selectorObj );
				}
			}
			
			view.productOfferDraw( drawObj, true );
			util.totalAfterFunction( sharedObj, selectorObj );
		}
	}
	
	function checkAPiExchange( data , sharedObj, selectorObj, view ){
		if(sharedObj.tradeInType === 'CE' && siteCode === 'in'){
			sharedObj.commonApiModel.tradeInCeDataV1Api( sharedObj, selectorObj, data );
		}else{
			if( data.notselected_offer_id ) {
				sharedObj.commonApiModel.exchangeInDataV1Api( sharedObj, selectorObj, data );
			} else {
				data.dataQuoteId = data.id;
				sharedObj.util.settingExchangeAPIData( data , sharedObj, selectorObj, view );
			}
		}
	}
	
	function upgradeResultDraw ( data , sharedObj, selectorObj, view ) {
		const drawObj = sharedObj.drawObj;
		const util = sharedObj.util;
		const priceCurrency = sharedObj.priceCurrency;
		
		if( data ){
			drawObj.upgradeResult = {
				'hasComponent' : true,
				'displayModelName' : data.displayName,
				'discountText1' : Granite.I18n.get('You pay now') + ' '  + Granite.I18n.get("{0}/month", (currencyComma(parseFloat(data.salePrice/24),priceCurrency))),
				'dataId' : data.consents,
				'dataPrice' : data.salePrice
			}
			
			if( sharedObj.isMigrationHybris && data.monthlyPrice ){
				drawObj.upgradeResult.discountText1 = Granite.I18n.get('You pay now') + ' '  + Granite.I18n.get("{0}/month", (currencyComma(parseFloat(data.monthlyPrice),priceCurrency)));
			}
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-upgrade-0"));
			
			view.upgradeResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
		}
	}
	
	function careResultDraw ( data , sharedObj, selectorObj, view ){
		
		const priceCurrency = sharedObj.priceCurrency;
		const tempPrice = {
			'msrp_price' : 0,
			'formatted_msrp_price' : null,
			'sale_price' : 0,
			'formatted_sale_price' : null,
			'save_price' : 0,
			'formatted_save_price' : null,
			'duration' : 0,
			'paymentcycle' : null
		}
		
		if( data ){
			if( data.discounted_sku ){
				
				if( data.msrp_price ){
					if( data.msrp_price.value ){
						tempPrice.msrp_price = parseFloat(data.msrp_price.value);
					}
					if( data.msrp_price.formatted_value ){
						tempPrice.formatted_msrp_price = data.msrp_price.formatted_value;
					} else {
						tempPrice.formatted_msrp_price = currencyComma(tempPrice.msrp_price, priceCurrency);
					}
					if( data.msrp_price.duration ){
						tempPrice.duration = data.msrp_price.duration;
					}
					if( data.msrp_price.paymentcycle ){
						tempPrice.paymentcycle = data.msrp_price.paymentcycle;
					}
				}
				
				if( data.sale_price ){
					if( data.sale_price.value ){
						tempPrice.sale_price = parseFloat(data.sale_price.value);
					} else {
						tempPrice.sale_price = tempPrice.msrp_price;
					}
					
					if( data.sale_price.formatted_value ){
						tempPrice.formatted_sale_price = data.sale_price.formatted_value;
					} else {
						tempPrice.formatted_sale_price = currencyComma(tempPrice.sale_price, priceCurrency);
					}
					if( data.sale_price.duration ){
						tempPrice.duration = data.sale_price.duration;
					}
					if( data.sale_price.paymentcycle ){
						tempPrice.paymentcycle = data.sale_price.paymentcycle;
					}
				}
				
				if( tempPrice.msrp_price > 0 && tempPrice.msrp_price !== tempPrice.sale_price ){
					tempPrice.save_price = tempPrice.msrp_price - tempPrice.sale_price;
					tempPrice.formatted_save_price = currencyComma( tempPrice.save_price , priceCurrency );
				}
			}
			sharedObj.drawObj.careResult = {
				'hasComponent' : true,
				'dataPrice' : tempPrice.msrp_price,
				'dataSalePrice' : tempPrice.sale_price,
				'dataModelName' : data.modelName,
				'dataModelCode' : data.modelCode,
				'dataId' : data.consents,
				'dataPromotionPrice' : tempPrice.formatted_sale_price,
				'dataDuration' : tempPrice.duration,
				'dataPaymentcycle' : tempPrice.paymentcycle
			}
			if( sharedObj.popupReturnObj ){
				window.sg.components.productDetailKv.triggerChange(sharedObj.popupReturnObj.get(0));
			}
			
			view.careResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
		}
	}
	
	function warrantyResultDraw ( data , sharedObj, selectorObj, view ){
		
		const siteCode = sharedObj.siteCode;
		const multiCareYn = sharedObj.multiCareYn;
		
		let displayMsrpPrice = "";
		let carePrice = 0;
		let displayModelName = '';
		let savePriceTemp = 0;
		
		let description = '';
		let dataPrice = '';
		let dataSalePrice = '';
		let price = '';
		let disclaimer = '';
		let savedPrice = '';
		let displayPrice = null;
		
		
		if( data ){
			/* model  */
			if( data.discounted_sku ){
				displayModelName = data.discounted_sku;
				
				if( sharedObj.apiFlag === 'GPv2' ) {
					carePrice = data.msrp_price.value;
					if( data.sale_price.formatted_value ){
						displayMsrpPrice = data.msrp_price.formatted_value;
						savePriceTemp = parseFloat(data.msrp_price.value) - parseFloat(data.sale_price.value);
					}else if( data.msrp_price.formatted_value ){
						displayMsrpPrice = data.msrp_price.formatted_value;
					}
				} else {
					carePrice = data.sale_price.value;
					displayPrice = data.sale_price.value;
					displayMsrpPrice = currencyComma(data.sale_price.value, sharedObj.priceCurrency);
				}
			}
			
			let fromSebn = '';
			if(siteCode === "nl" || siteCode === "be" || siteCode === "be_fr"){ //new-hybris
				fromSebn = Granite.I18n.get("From");
			}
			
			var fromSeg = '';
			if(siteCode === "de"){ //new-hybris
				fromSeg = Granite.I18n.get("From");
			}
			
			let smcTypeName = Granite.I18n.get('Extended Warranty');
			if( multiCareYn !== 'Y') {
				description = smcTypeName + ' ' + displayModelName;
			} 
			
			if( savePriceTemp !== 0 ){
				dataPrice = carePrice;
				price = fromSebn + fromSeg + ' ' + displayMsrpPrice;
				
				if(fromSebn === ""){
					savedPrice = Granite.I18n.get("Save {0}",currencyComma(savePriceTemp, sharedObj.priceCurrency),siteCode);
				}
				dataSalePrice = displayPrice;
				
				if(siteCode === "ee" || siteCode === "lt" || siteCode === "lv"){
					if( data.sales_pitch ){
						disclaimer = data.sales_pitch[0];
					}
				}
			}else{
				dataPrice = carePrice;
				dataSalePrice = displayPrice;
				price = displayMsrpPrice;
			}
			
			sharedObj.drawObj.warrantyResult = {
				'hasComponent' : true,
				'displayModelName' : description,
				'discountText1' : price,
				'description1' : disclaimer,
				'dataPrice' : dataPrice,
				'dataSalePrice' : dataSalePrice,
				'dataModelName' : data.modelName,
				'dataModelCode' : data.modelCode,
				'dataId' : data.consents,
				'savedPrice' : savedPrice
			}
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-warranty-0")); 
			
			view.warrantyResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
		}
	}
	
	function warrantyVdResultDraw ( data , sharedObj, selectorObj, view ){
		
		const siteCode = sharedObj.siteCode;
		const multiCareYn = sharedObj.multiCareYn;
		 
		let summaryHtml = "";
		if( data ){
			$(".option-result--extended-warranty-option").removeAttr("style");
			sharedObj.drawObj.warrantyVdResult = {
				'hasComponent' : true,
				'title' : data.title,
				'price' : data.price,
				'smcCode' : data.smcCode,
				'description' : data.description,
				'priceDisplay' : currencyComma(data.price, sharedObj.priceCurrency)
			}
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-extended-warranty-option-0")); 
			
			view.warrantyVdResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
			
			summaryHtml = `<strong class="summary__product-name">${data.title}</strong>
						   <p class="summary__product-price" style="">${currencyComma(data.price, sharedObj.priceCurrency)}</p>`;
			
			//summary    
			$(".summary__product-price").show();
			$(".pd-buying-tool__cost-box .summary .warranty-wrap").html(summaryHtml);
		}
	}
	
	function assuredResultDraw ( data , sharedObj, selectorObj, view ){
		
		const util = sharedObj.util;
		
		if( data ){
			sharedObj.drawObj.assuredBuyBackResult = {
				'hasComponent' : true,
				'dataSku' : data.sku,
				'dataPrice' : data.msrp_price.value,
				'dataSalePrice' : data.sale_price.value,
				'dataId' : data.consents,
				'displayModelName' : data.displayModelName,
				'dataModelName' : data.dataModelName
			}
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-galaxy-assured-1"));
			
			view.assuredBuyBackResultDraw( drawObj );
			util.totalAfterFunction( sharedObj, selectorObj );
		}
	}

	function foreverResultDraw ( data , sharedObj, selectorObj, view ){
		
		const util = sharedObj.util;
		const hasTradeInResult = util.hasTradeInResult( sharedObj, selectorObj );
		
		if( data ){
			sharedObj.drawObj.galaxyForeverResult = {
				'hasComponent' : true,
				'displayModelName' : data.displayName,
				'discountText1' : Granite.I18n.get('Monthly Cost') + ':' + currencyComma( data.foreverPrice, sharedObj.priceCurrency ) ,
				'description1' : Granite.I18n.get('Tenure') + ':' + data.tenureValue +' '+ Granite.I18n.get('month'),
				'dataId' : data.consents,
				'dataPrice' : null,
				'modelList' : data.modelCodeArr,
				'financePlanId' : data.plan_id
			}
			
			window.sg.components.productDetailKv.triggerChange(document.querySelector("#pd-samsung-galaxy-forever-0"));
			
			view.galaxyForeverResultDraw( drawObj );
			selectorObj.buyingToolOptCare.hide(); // care 
			if( hasTradeInResult ){
				util.exchangeResultDraw( sharedObj, selectorObj );
			}
			
			util.totalAfterFunction( sharedObj, selectorObj );
		}
	}
	
	dynamic.DetailAfterEventClass = DetailAfterEventClass;
	
})();


(() => {

	const MULTI_TRADEIN_SITES = ['au', 'be', 'be_fr', 'fr', 'id', 'my', 'nl', 'sg' ,'ae','ae_ar', 'kz_kz', 'kz_ru','de','vn' ,'sa','sa_en'];

	let $componentWrapper = $(".product-detail-kv");
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	
	//  
	let sharedObj = {};
	//   
	let selectorObj = {};
	
	//     
	if( $componentWrapper.length > 0 ){
		init();
	}
	
	/**
	 *  js     
	 */
	function init(){
		settingBaseData();
		settingObject( sharedObj );
		settingFirst( sharedObj, selectorObj );
		settingProductInfoData( sharedObj, selectorObj );
		optionClickEventListener( sharedObj, selectorObj );
	}
	
	/**
	 *    USP  Promo Text  |_|200|_|   200 currency   
	 */
	function changeUspTextPattern( sharedObj, selectorObj ){
		const uspTextList = $('.usp-text');
		for( var index = 0; index < uspTextList.length; index++ ){
			let uspText = uspTextList.eq(index).text();
			if( uspText && uspText.indexOf('|_|') > -1 ){
				uspText = uspText.trim().replace( /\|_\|([^\|_\|]*)\|_\|/g, function( match, innerText ){
					return currencyComma(parseFloat(innerText), sharedObj.priceCurrency);
				});
				
				uspTextList.eq(index).text(uspText);
			}
		}
	}
	
	/**
	 *     //new-hybris
	 */
	function settingBaseData (){
		changePageHiddenDataToApiData();
		
		$componentWrapper = $(".product-detail-kv");
		const $buyingTool = $componentWrapper.find('.product-detail-kv__buying-tool');
		const $buyingToolInfo = $buyingTool.find('.pd-buying-tool__info');
		const $buyingToolOpt = $buyingTool.find('.pd-buying-tool__option');
		const $buyingToolPriceBar = $buyingTool.find('.pd-buying-tool__cost-box');

		let siteCode = $("#siteCode").val();
		let categoryGroupCode = $('#categoryGroupCode').val().substring(0, 2);
		let isCeTradeUpEnabled = $("#ceTradeUpEnabledYn").val() === 'Y';

		//  
		sharedObj = {
			'drawObj' : {}, // view     
			'apiDomain' : $("#storeDomain").val(), // shop api   
			'apiFlag' : $("#shopIntegrationFlag").val(), // gpv2, hybris 
			'modelCode' : $("#apiChangeModelCode").val(), //  
			'siteCode' : $("#siteCode").val(), //   
			'siteCodeWithEpp' : $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : $("#siteCode").val(),
			'shopApiModel' : null, // front api ajax     
			'commonApiModel' : null, //front api  ajax     
			'afterEvent' : null,
			'util': null, //  util   
			'view' : null, // view   
			'isCart' : $("#useStore").val(), //   
			'oldProductYn' : $("#oldProductYn").val(),
			'abnormalcoloryn' : $("#abnormalColorYN").length === 1 ? $("#abnormalColorYN").val() : 'N',
			'pdHrefLang' : $("#localLang").val(),
			'countryIsoCode' : $("#countryIsoCode").val(),
			'pdMultiLanguageYN' : $("#multiLanguageYn").val(),
			'shopSkuCode' : $("#apiChangeShopSKU").val(),
			'stockLevelStatus' : $("#pdCtaType").val(), //   
			'stockCustomMessage' : '', //  
			'wtbCtaBtnYn' : $("#pdWtbCtaBtnYn").val(),
			'wtbUseYn' : $("#apiChangeWtbUseYn").val(), // WTB  
			'wtbDispFuncUseYN' : $("#wtbDispFuncUseYN").val(), // WTB   2
			'isSimplePDP' : $("#pdType").val() === 'S-B' || $("#pdType").val() === 'S-F', // simplePD standardPD 
			'modelName' : $("#apiChangeModelName").val(), //  
			'pdRemoveTagTxt' : $("#pdRemoveTagTxt").val(), // WTB Title
			'wtbSrc' : $("#wtbSrc").val(),
			'wtbSubTypeCode' : $("#apiChangeCategorySubTypeCode").val(), // WTB  subTypeCode
			'pdProductType' : $("#pdProductType").val(), // IM, VD   CTA disabled 
			'tradeInFlag' : false, // Offer Trade In(Exchange)  
			'tradeinSaveValue' : '',
			'tradeinText' : '',
			'tradeInType' : '',
			'promotionSalesPitch' : 0,
			'upgradeEligible' : false, // Upgrade Program Terms   Y/N
			'pdUpgradeUseYn' : $("#pdUpgradeUseYn").val(),
			'upgradeFlag' : false, // EUP 
			'eupData' : {},
			'childCheckList' : [], // Check Out  model list(Upgrade Program)
			'pdProductTypeCheckYn' : $("#pdProductTypeCheckYn").val(), // SMC, Extended warranty, Addon   , Y  addon,smc,warranty layer,    addon layer  
			'samsungCareList' : [], // Popup   samsung care List
			'samsungCareBadgeList' : [],
			'samsungCareFlag' : false, // AddOn Samsung Care   Y/N
			'pdTimeformatFront' : $("#pdTimeformatFront").val(),
			'addOnCategoryList': [],
			'addOnGift' : {
				'products' : [],
				'expanded' : {}
			}, // Gift   
			'addOnInfoTemp' : [], //  
			'addOnInfoTempCache' : {}, // addOn     
			'addOnInfo' : [], // 2  
			'embedAddon08' : $("#apiChangeCategoryGroupCode").val() === '08000000' ? true : false,
			'isEmbedAddOn' : ($("#shopIntegrationFlag").val() === 'Hybris-new' || $("#shopIntegrationFlag").val() === 'Hybris' || $("#shopIntegrationFlag").val() === 'Hybris-intg') && $("#apiChangeCategoryGroupCode").val() === '08000000' ? true : false, // HA   add on    embed 
			'embedAddonSelected' : [], // embed addon tagging
			'multiCareYn' : $("#multiCareYn").val(), // multiCareYn - common  202003 in Y  SC+      	 
			'addonsFlag' : false, // Add-Ons   Y/N
			'giftFlag' : false,
			'pdPackageYn' : $("#pdPackageYn").val() == 'Y', //CRHQ-8807 packageYn  Y/N
            'pdChildModelCnt' :  $("#pdChildModelCnt").val() > 0 ? $("#pdChildModelCnt").val(): 0, //CRHQ-8807 childModel 
            'pdChildModelList' : [], //CRHQ-8807 -  (modelCode, modelName, displayName, mainYn)
			'comboFlag' : false, // Offer combo   Y/N
			'setComboPopupData' : [],
			'pdBogoUseYn' : $("#pdBogoUseYn").val(), // BOGO 
			'bogoModelList' : [],
			'bogoFlag' : false, // Offer bogo   Y/N
			'financingEligible' : false, // EMC 4 Task FINANCING   Y/N
			'promotionFinancingFlag' : false, // Promotion financing CTA Link    Y/N
			'emcPromotionIcon' : false, //       Y/N
			'pdSoftBundleUseYn' : $("#pdSoftBundleUseYn").val(), // soft bundle 
			'tariffFlag' : false,
			'priceCurrency' : $("#priceCurrency").val(), //  
			'promotionImgType' : $("#promotionImgType").val(),
			'giftDrawData' : {
				'date' : null,
				'dec' : null
			},
			'globalComboData' : [], // ComboData 
			'pdStageInfo' : $("#apiStageInfo").val(),
			'noComboSearchList' : [],
			'realComboSearchList' : [],
			'pdSearchDomain' : $("#searchDomain").val(), // search api 
			'addonDate' : '',
			'warrantyFlag' : false,
			'careLearnMoreUrl' : $("#pdCareLearnMoreUrl").val(),
			'pdSmcType' : $("#smcType").val(),
			'reCallSyndi' : [],
			'tradeInUrl' : $("#pdTradeInUrl").val()	,
			'pdUpgradeLearnMoreUrl' : $("#pdUpgradeLearnMoreUrl").val(),
			'financeFlag' : $("#pdCalculateFinancingYn").val(),
			'financingUrl' : $("#financingUrl").val(),
			'warrantyLearnMoreUrl' : $("#pdWarrantyLearnMoreUrl").val(),
			'hybrisJsonYn' : $("#hybrisApiJson").val() ? $("#hybrisApiJson").val() : "N",
			'addToCartPostYn' : $("#addToCartPostYn").val() ? $("#addToCartPostYn").val() : "N",
			'disabledClass' : 'is-disabled',
			'hasComponentClass' : 'has-component',
			'selectedClass' : 'is-selected',
			'disabledCtaClass' : 'cta--disabled',
			'checkingBogoSearchFlag' : false,
			'checkingComboSearchFlag' : false,
			'checkingAddOnSearchFlag' : false,
			'checkingGiftSearchFlag' : false,
			'addonModelCodeList' : [],
			'bogoSearchList' : [],
			'comboSearchList' : [],
			'careAndWarrantySearchList' : [],
			'careSearchList' : [],
			'addOnSearchList' : [],
			'giftSearchList' : [],
			'addOnApiList' : {},
			'finalCareList' : [],
			'finalWarrantyList' : [],
			'totalSkuList' : {},
			'finishedFirstSyndi' : true,
			'finishedSecondSyndi' : true,
			'finishedAddOn' : true,
			'finishedSearch' : true,
			'cartTradeInQuoteId' : '',
			'tradeinDiscountYn' : '',
			'hasAddonApiData' : false, //Add To Cart  exchange ID
			'learnMoreCtaUrl' : $("#pdLearnMoreCtaUrl").val(),
			'proudctPriceInfo' :{
				'orignalPrice' : '',
				'salePrice' : '',
				'vatFreePrice' : '',
				'vatFreePriceFormatted' : '',
				'listPrice' : '',
				'listPriceFormatted' : '',
				'orignalPriceFormatted' : '',
				'salePriceFormatted' : '',
				'rowCodeformattedPriceSave' : '',
				'usEppPrice' : '',
				'salesPitch' : '',
				'leaseInfo' :{
					'monthly' : '',
					'month' : '',
					'upfront' : ''
				},
				'monthlyPriceInfo' :{
					'monthlyPrice' : '',
					'tenureVal' : '',
					'interest' : ''			//new-hybris
				},
				productCartCount : 1, // SMB  cart  
				netavailable : 1, // SMB  
				smbMinQty : 1, // SMB 
				smbMaxQty : 999, // SMB 
			},
			'totalPrice' : {
				'original' : '',
				'sale' : '',
				'saved' : ''
			},
			'currentUrl' : '', // learenMore  url
			'paymentMethods' : {}, //fr  fr  4x,3x   & tax Price    
			'hasPriceCta' : false,
			'accessoryDisabled' : false, // addOn Accesory  Disabled  
			'proudctEcomFlag' : false,
			'optionId' : '',
			'familyCode' : $("#familyCode").val(),
			'detailNodePath' : $("#detailNodePath").val(),
			'currentpagenav' : $("#current-page-nav").val(),
			'addItem' : [],
			'addChildItem' : [],
			'openPromoTaxParam' : '',
			'tradeInSelectPrice' : 0,
			'syndiProductData' : '', //  pdTariffData, tempProductsData
			'checkedComboArea' : '',
			'checkedGiftArea' : '',
			'globalServiceInfo' : [], //   
			'tradeInSelectCnt' : 0,
			'smcSelectCnt' : 0,
			'smcSelectPrice' : 0,
			'cartPinCode' : '',
			'pdUpgrade' : '',
			'checkOutLink' : $('#checkOutUrl').val(),
			'cartUrl' : $("#cartUrl").val(),
			'pdAppId' : '',
			'isPreqa' : $('#isPreqa').val(),
			'emiUrl' :  $('#emiUrl').val(),
			'accessToken' : '',
			'pdDisplayYn' : $('#pdDisplayYn').val(),
			'returnPolicyText' : $('#returnPolicy').val(),
			'warrantyText' : $('#warranty').val(),
			'isLive' : $('#isLive').val(),
			'samsungCareSubText' : '',
			'financeplusUrl' : $('#financeplusUrl').val(),
			'popupReturnObj' : null,
			'tariffPlanSelectedClass' : 'this-checked',
			'isNotGpv2' : $("#shopIntegrationFlag").val() ? $("#shopIntegrationFlag").val().indexOf('GPv2') < 0 : true,
			'isGpv2' : $("#shopIntegrationFlag").val() ? $("#shopIntegrationFlag").val().indexOf('GPv2') >-1 : true,
			'isHyIntg' : $("#shopIntegrationFlag").val().indexOf('Hybris-intg') > -1,
			'isGPv2AndHyIntg' : $("#shopIntegrationFlag").val().indexOf('GPv2') > -1 || $("#shopIntegrationFlag").val().indexOf('Hybris-intg') > -1 || $("#shopIntegrationFlag").val().indexOf('Hybris-new') > -1, //new-hybris
			'isHybrisSplitPD' : $("#splitPdYn").val() === 'Y',
			'isHybrisSplitPDTradeIn' : $("#splitPdTradeInYn").val() === 'Y',
			'isHybrisSplitPDSamsungCarePlus' : $("#splitPdSamsungCarePlusYn").val() === 'Y',
			'isHybrisSplitPDLease' : $("#splitPdLeaseYn").val() === 'Y',
			'isHybrisSplitPDUpgrade' : $("#splitPdUpgradeYn").val() === 'Y',
			'isHybrisSplitPDTariff' : $("#splitPdTariffYn").val() === 'Y',
			'splitPDTradeInSpecial' : '',
			'hybrisCareData' : null,
			'foreverFinanceInfo' : {
				'foreverFlag' : false,
				'displayName' : null,
				'assuredBuyBack' : null,
				'downPayment' : null,
				'tenureValue' : null,
				'productPrice' : null,
				'exchangeDiscount' : null,
				'foreverPrice' : null,
				'carePrice' : null,
				'tradeinCheckFlag' : false,
				'tradeinDiscountYn' : false,
				'tradeinprice' : null
			},
			'exchangeApiData' : {
				'exchangeFlag' : false 
			},
			'hybrisApiData' : {
				'tarriffOption' : null,
				'shopAPI' : null
			},
			'syndiApiData' : {
				'products' : {},
				'expanded' : {}
			},
			'modelCodeList' :$('#modelCodeList').val(),
			'isClicked' : false,
			'isOptClicked' : false,
			'emiCalculatorUrl' : '',
			'focusId' : '',
			'commonCode' : $('#commonCode').val(),
			'voucherdata' : {},
			'voucherdataHybris' : [],
			'giftdataHybris' : [],
			'hasVoucher' : false,
			'hasGift' : false,
			'vdcombodataHybris' : [],
			'hasGiftPage': false, // CRHQ-8914 [B2C][MX][DE] [SIM-Service] customize free-gift based on the planID
			'relatedProductsObj': {}, // CRHQ-8914 [B2C][MX][DE] [SIM-Service] customize free-gift based on the planID
			'hasPlanIDAndFreeGiftPromotion' : false, //20220526 CRHQ-5597
			'hasTradeInFreeGiftPromotion' : false, //CRHQ-7126-2
			'giftSelectionSkipPlanIdList' : [],	//CRHQ-7126
			'hasStackbleTradeInFreeGiftPromotion' : false,	////CRHQ-8944 [B2C][MX][DE] Stackable Trade-In FOC   
			'hasAddOns' : false, //new-hybris
			'hasBundle' : false, //new-hybris
			'getOptoinPrice' : false,
			'freeGiftOos' : false,
			'pageTrackPd' : $('#pageTrackPd').val(),
			'displayName' : $('#apiChangeDisplayName').val(),
			'hasEbtButtonUse' : $('#ebtButtonUse').val() === 'Y',
			'hasReserveInStore' : false, 
			'buyNowUrl' : '',
			'buyNowUrlYn' : $('#buyNowUrlYn').val() === 'Y',
			'currentPdpUrl' : $('#currentPdpUrl').val(),
			'pvitype' : $('#pvitype').val(),
			'pvisubtype' : $('#pvisubtype').val(),
			'pimsubtype' : $('#pimsubtype').val(),
			'parentPath' : $('#parentPath').val(),
			'pfAllUrl' : $('#pfAllUrl').val(),
			'deliveryYN' : $('#deliveryYN').val() === 'Y',
			'isBuyingoptionApi' : false,
			'categoryTypeCode' :  $("#apiChangeCategoryTypeCode").val(),
			'multistoreSiteCd' : '',
			'assuredSku' : '',
			'apiChangePdJcrTitle' : $("#apiChangePdJcrTitle").val(),
			'apiChangeStockStatus' : '',
			'hasBespokeCta' : $("#bespokeCtaUse").val() === 'Y',
			'setPersonalizeTv' : false,
			'hasPersonalizeTv' : $("#categoryTypeCode").val() === '04010000' || $("#categoryTypeCode").val() === '04050000' || $("#categoryTypeCode").val() === '04020000',
			'pmtURL' : '',
			'pmtModelList' : [],
			'isMigrationHybris' : $("#shopIntegrationFlag").val().indexOf('Hybris-new') > -1, //new-hybris
			'gpvStoreDomain' : $("#gpvStoreDomain") ? $("#gpvStoreDomain").val() : '' ,
			'clickDom' : '', //new-hybris
			'configuratorUrl' : $("#navConfiguratorUrl").val(),
			'ctaLocalText' : $("#navCtaLocalText").val(),
			'ctaEngText' : $("#navCtaEngText").val(),
			'configuratorUseYn' : $("#navConfiguratorUseYn").val(),
			'aplautYn' : $("#aplautYn").val(),
			'giftCard' : {
				'isGiftCard' : false,
				'inputAmount' : 0,
				'amountValid' : false,
				'emailValid' : false,
				'personalizedMessage' : '',
				'email' : '',
				'firstName' : '',
				'lastName' : '',
				'minPrice' : 0,
				'minPriceFormatted' : '',
				'maxPrice' : 0,
				'maxPriceFormatted' : '',
				'priceIncrement' : 0,
				'priceIncrementFormatted' : '',
				'selectedPrice' : 0,
				'cartGiftCardCode' : ''
			},
			'deliveryPickup' : {
				'deliverySiteCode' : ["my", "ph"],
				'isDeliveryPickup' : false
			},
			'useRecommendation' : $("#shopIntegrationFlag").val() === 'Hybris-intg' || $("#shopIntegrationFlag").val() === 'Hybris' || $("#shopIntegrationFlag").val() === 'Hybris-new' || $("#shopIntegrationFlag").val() === 'GPv2' || $("#shopIntegrationFlag").val() === '3rd',
			'notUseRecommendation': ["be","be_fr","gr","nl","ie","jp","ru","latin","uy","hk","hk_en","il"], //PD Recommendation   
			'productType' : $("#productType").val(),
			'useWarrantyVd' : ($("#apiChangeCategoryTypeCode").val().startsWith('04') && siteCode === 'de') || (!$("#apiChangeCategoryTypeCode").val().startsWith('01') && siteCode === 'fr') || siteCode == "mx",
			'isOldHybrisWishlist' : ["ch","ch_fr","hk","hk_en","hu","levant","levant_ar","es","pt","ca","ca_fr",oduct' : false,
			'sellingWithBazel': false,
			'bezelImageClass': '',
			'noneTypeList': [],
			'modernTypeList': [],
			'beveledTypeList': [],
			'freestyleList': [],
			'useBezelOptionDraw': false,
		se,
			'isPossibleBuy' : false,
			'bezelColorArray' : [],
			'bezelModelCodeList' : '',
			'bezelModelPatternCodeList' : '',
			'bezelModelCodeArrayList' : [],
			//'bezelSkuArrayList' : [], //bezel gpv2
			'bezelModelCodeArray' : [],
			'bezelColorIndex' : 0,
			'selectedBezelColor' : {},
			'selectedBezelTotalPrice' : {
				'original' : '',
				'sale' : '',
				'saved' : ''
			},
			'cartBezelCode' : '',
            'checkedIndex' : -1,
            // [COMP6FE-1495] Au Multi TradeIn  
            // [B2C][BC][IM] SEBN stackable trade in , CRHQ-6886 my, CRHQ-6172 sg
            'isMultiTradeIn' : (!isCeTradeUpEnabled && MULTI_TRADEIN_SITES.indexOf(siteCode) >= 0), // CRHQ-8248 CE Trade-up     
			'isOldHybrisCheckService' : $("#shopIntegrationFlag").val() === 'Hybris-intg' || $("#shopIntegrationFlag").val() === 'Hybris',//[COMP6FE-1507] Hybris API    service  .   hybris  
			'backOrderMessage': '',
			'stockLevelStatusDisplay': '',
			'addonGiftBundleRelatedData': [],
			'addonBundleRelatedData': [],
			'bundleCnt': 0,
			'vdAddonInitPriceHtml': '',
			'savingInformation': '',
			'blockEddDisplay': '', //PD Y , N 
			'addonStepBuying04':$("#categorySubTypeCode").val().length > 2 && $("#categorySubTypeCode").val().substring(0,2) === "04" ? true : false,
			'addonStepBuying0701':$("#categorySubTypeCode").val().length > 4 && $("#categorySubTypeCode").val().substring(0,4) === "0701" ? true : false,
			'taxPriceDisplay': '',  //only br
			'storeText': '',         //only br
			'vatEligible': '', //only co . true : show vatFreePrice  / false : hide vatFreePrice
			'isNewElementLowestWasPrice':$("#siteCode").val() === 'pl' || $("#siteCode").val() === 'si' || $("#siteCode").val() === 'gr' || $("#siteCode").val() === 'fi' || $("#siteCode").val() === 'it' || $("#siteCode").val() === 'se' || $("#siteCode").val() === 'no' || $("#siteCode").val() === 'dk' || $("#siteCode").val() === 'fr',
			'isNewElementLowestWasPriceSetting': false,
			'isLowestInstallmentAmount':$("#siteCode").val() === 'id' || $("#siteCode").val() === 'ee' || $("#siteCode").val() === 'lv' || $("#siteCode").val() === 'lt' || $("#siteCode").val() === 'uk' || $("#siteCode").val() === 'pl' || $("#siteCode").val() === 'pe' || $("#siteCode").val() === 'cl' || $("#siteCode").val() === 'ro' || $("#siteCode").val() === 'mx' || $("#siteCode").val() === 'co' || $("#siteCode").val() === 'sk' || $("#siteCode").val() === 'cz',
			'isLowestInstallmentInterest':$("#siteCode").val() === 'ee' || $("#siteCode").val() === 'lv' || $("#siteCode").val() === 'lt' || $("#siteCode").val() === 'pl',
			'isSECZ': ['sk', 'cz'].indexOf(siteCode) >= 0,
			'calculateInstallmentPeriodicValue': 0,
			'calculateInstallmentPeriod': 0,
			'isMonthlySENA':$("#siteCode").val() === 'se' || $("#siteCode").val() === 'fi' || $("#siteCode").val() === 'no',
			'walkoutQty': 0,		// o2o site walk out qty count value
			'homeDeliveryQty': 0,	// o2o site home delivery qty count value
			'isStorePopup' : false,	// COMP6FE-1619 [EPP] SIEL Offline  
			'ceTradeUpPopup' : {
				'isEnabled' : isCeTradeUpEnabled,
				'categoryGroup' : categoryGroupCode,
				'productCategoryGroup' : ({
					'03': 'pc',
					'04': 'vd',
					'05': 'sb',
					'07': 'mon',
					'08': 'da'
				})[categoryGroupCode]
			},
			'showEmbedAddon': false,
			'vdRelatedProducts': {},
			'newEmbedVDCountry': $("#shopIntegration() === "Hybris" || $("#shopIntegrationFlag").val() === "Hybris-intg",
			'hasRentalInstallment' : false // only nl
		}
		
		//   
		selectorObj = {
			'componentWrapper' : $componentWrapper,
			'buyingTool' : $buyingTool,
			'buyingToolGlallery' : $componentWrapper.find('.pd-header-gallery'),
			'buyingToolInfo' :  $buyingToolInfo,
			'buyingToolInfoBadge' : $buyingToolInfo.find('.pd-info__text-badge'),
			'buyingToolInfoTitle' : $buyingToolInfo.find('.pd-info__title'),
			'buyingToolInfoSku' : $buyingToolInfo.find('.pd-info__sku'),
			'buyingToolInfoWishlist' : $buyingToolInfo.find('.pd-info__wishlist'),
			'buyingToolInfoRating' : $buyingToolInfo.find('.pd-info__rating'),
			'buyingToolInfoUsp' : $buyingToolInfo.find('.pd-info__usp-list'),
			'buyingToolOpt' : $buyingToolOpt,
			'buyingToolOptBundle' : $buyingToolOpt.find('.pd-select-option.bundle-group'),
			'buyingToolOptBezelOption' : $buyingToolOpt.find('.pd-select-option.option-bezelcolor'),
			'buyingToolOptTradeIn' : $buyingToolOpt.find('.pd-select-option.trade-in'),
			'buyingToolOptTradeInResult' : $buyingToolOpt.find('.option-result.result-trade-in'),
			'buyingToolOptGroup' : $buyingToolOpt.find('.pd-select-option.option-group'),
			'buyingToolOptDevice' : $buyingToolOpt.find('.pd-select-option.option-device'),
			'buyingToolOptColor' : $buyingToolOpt.find('.pd-select-option.option-color'),
			'buyingToolOptCarrier' : $buyingToolOpt.find('.pd-select-option.option-carrier'),
			'buyingToolOptMemory' : $buyingToolOpt.find('.pd-select-option.option-device-memory'),
			'buyingToolOptSize' : $buyingToolOpt.find('.pd-select-option.option-size'),
			'buyingToolOptCapacity' : $buyingToolOpt.find('.pd-select-option.option-capacity'),
			'buyingToolOptContract' : $buyingToolOpt.find('.pd-select-option.option-contract'),
			'b-storage-memory'),
			'buyingToolOptOthers' : $buyingToolOpt.find('.pd-select-option.option-others'),
			'buyingToolOptBetween' : $buyingToolOpt.find('.pd-select-option.option-between'),
			'buyingToolOptDelivery' : $buyingToolOpt.find('.pd-select-option.pd-select-option--delivery-detail'),
			'buyingToolOptDeliveryResult' : $buyingToolOpt.find('.option-result.result-delivery'),
			'buyingToolOptTariffPlan' : $buyingToolOpt.find('.pd-select-option.option-tariff-plan'),
			'buyingToolOptTariff' : $buyingToolOpt.find('.pd-select-option.option-tariff'),
			'buyingToolOptTariffResult' : $buyingToolOpt.find('.option-result.result-tariff-optioin'),
			'buyingToolOptOffer' : $("#pdPackageYn").val() == 'Y'? $buyingToolOpt.find('.pd-select-option.pd-select-option--type-offer-combo') : $buyingToolOpt.find('.pd-select-option.option-offer'),//CRHQ-8807 - childModelList offer  
			'buyingToolOptOfferFinance' : $buyingToolOpt.find('.pd-select-option.option-offer-finance'),
			'buyingToolOptUpgrade' : $buyingToolOpt.find('.pd-select-option.option-upgrade'),
			'buyingToolOptUpgradeResult' : $buyingToolOpt.find('.option-result.result-upgrade'),
			'buyingToolOptGalaxyForever' : $buyingToolOpt.find('.pd-select-option.option-galaxy-forever'),
			'buyingToolOptGalaxyForeverResult' : $buyingToolOpt.find('.option-result.result-galaxy-forever'),
			'buyingToolOptAssuredBuyBack' : $buyingToolOpt.find('.pd-select-option.option-assured-buy-back'),
			'buyingToolOptAssuredBuyBackResult' : $buyingToolOpt.find('.option-result-dev.result-option-assured-buy-back'),
			'buyingToolOptWarranty' : $buyingToolOpt.find('.pd-select-option.option-warranty'),
			'buyingToolOptWarrantyResult' : $buyingToolOpt.find('.option-result.result-warranty'),
			'buyingToolOptWarrantyVd' : $buyingToolOpt.find('.pd-select-option.option-warranty-vd'),
			'buyingToolOptWarrantyVdResult' : $buyingToolOpt.find('.option-result.option-result--extended-warranty-option'),
			'buyingToolOptCare' : $buyingToolOpt.find('.pd-select-option.option-care'),
			'buyingToolOptCareResult' : $buyingToolOpt.find('.option-result-dev.result-care'),
			'buyingToolOptEmbedAddon' : $buyingToolOpt.find('.pd-select-option.option-embed-addon'),
			'buyingToolOptSMBQuantity' : $buyingToolOpt.find('.pd-select-option.option-smb-quantity'),
			'buyingToolPriceBar' : $buyingToolPriceBar,
			'buyingToolCalculate' : $buyingToolOpt.find('.pd-buying-tool__emi-calculator'),
			'buyingToolCalculateDivider' : $buyingToolOpt.find('.option-divider.emi-links'),
			'buyingToolLinks' : $buyingToolOpt.find('.pd-buying-tool__links')
		}
		
		if( sharedObj.stockLevelStatus ){
			sharedObj.stockLevelStatus = sharedObj.stockLevelStatus.toUpperCase();
		}
		
		//20221209 EPP omniprice 
		if ( $('#isEppPage').val() === 'true' ){
			if ( typeof eppOmniPricingUseYn != 'undefined' && eppOmniPricingUseYn === 'N' ) {
				sharedObj.isNewElementLowestWasPrice = false;
			}
		}
	}
	
	/**
	 *       
	 */
	function settingFirst ( sharedObj, selectorObj ){
		const util = sharedObj.util;
		
		pdDisplayYnRedirect( sharedObj );
		
		/* accesstoken   api  */
		if( window.location.search  && window.location.search.indexOf("accesstoken") > -1 ){
			sharedObj.accessToken = util.getQuerystring("accesstoken");
			sharedObj.commonApiModel.externalAjax( sharedObj, selectorObj );
		}

		/* appId      */
		if( window.location.search && window.location.search.indexOf("appId") > -1 ){
			sharedObj.pdAppId = util.getQuerystring("appId");
		}
		
		/* returning user    */
		if( window.location.search  && window.location.search.indexOf("upgrade") > -1 ){
			sharedObj.pdUpgrade = util.getQuerystring("upgrade");
		}
		
		/* tradein landing   api  */
		if( window.location.search && window.location.search.indexOf("exchangeid") > -1 ){
			//20191029 open_promo_tax .
			if( window.location.search.indexOf("open_promo_tax") > -1 ){
				sharedObj.openPromoTaxParam = util.getQuerystring("open_promo_tax");
			}
		}
		
		//CRHQ-5401 20220412
		
		if( sharedObj.apiChangePdJcrTitle ){
			document.title = sharedObj.apiChangePdJcrTitle;
		}
		
		util.initGlobalVal( sharedObj, selectorObj );
		
		changeUspTextPattern( sharedObj, selectorObj );
		
		util.validateQuantity('1', sharedObj, selectorObj, true);
	}
	
	/**
	 *      //new-hybris
	 */
	function settingObject ( sharedObj ){
		const view = new dynamic.BuyingToolOpView( selectorObj, sharedObj );
		const util = new dynamic.BuyingToolOpUtile( selectorObj );
		sharedObj.view = view;
		sharedObj.util = util;
		//new-hybris
		if( sharedObj.isMigrationHybris ){
			sharedObj.shopApiModel = new dynamic.BuyingToolOpAjaxNewbris();
		} else {
			if( sharedObj.apiFlag === 'GPv2' ) {
				sharedObj.shopApiModel = new dynamic.BuyingToolOpAjaxGPv2();
			} else {
				sharedObj.shopApiModel = new dynamic.BuyingToolOpAjaxHybris();
			}
		}
		
		sharedObj.commonApiModel = new dynamic.BuyingToolOpAjaxCommon();
		
		let pdRemoveTagTxt = sharedObj.pdRemoveTagTxt;
		sharedObj.pdRemoveTagTxt = util.escapeHtml(pdRemoveTagTxt);
		
		const drawObj = view.productModel();
		sharedObj.drawObj = drawObj;
		
		const afterEvent = new dynamic.DetailAfterEventClass( sharedObj, selectorObj );
		sharedObj.afterEvent = afterEvent;
		dynamic.DetailAfterEvent = afterEvent;
		dynamic.detailSelectorObj = selectorObj;
		dynamic.detailSharedObj = sharedObj;
		
		//22.12.16 [EPP] EAN Code 
		if($('#isEppPage').val() === 'true'){
			if(window.sg.components.dynamic && window.sg.components.dynamic.bridgePageCommonHybris){
				window.sg.components.dynamic.bridgePageCommonHybris.setSharedObj(sharedObj);	
			}
			
			//22.12.16 [EPP] EAN Code 
			if( window.sg.epp && window.sg.epp.common && window.sg.epp.common.isPosStore){
				view.eanCodeDraw();
			}			
		}	
	}
	
	/**
	 * ProductInfo     
	 */
	function settingProductInfoData ( sharedObj, selectorObj ){
		
		const currentUrl = anchorNaviTitleChange ( sharedObj, selectorObj );
		settingsProductAjax( sharedObj, selectorObj, currentUrl );
		
	}
	
	/**
	 *    
	 */
	function settingsProductAjax( sharedObj, selectorObj, currentUrl  ){
		const siteCode = sharedObj.siteCode;
		const isCart = sharedObj.isCart;
		const oldProductYn = sharedObj.oldProductYn;
		const abnormalcoloryn = sharedObj.abnormalcoloryn;
		const shopApiModel = sharedObj.shopApiModel;
		const modelCode = sharedObj.modelCode;
		const util = sharedObj.util;
		
		//   
		sharedObj.syndiProductData = '';
		
		if(siteCode === "in" && modelCode.indexOf("SM-A920F") > -1){
			currentUrl = "https://www.samsung.com/in/microsite/galaxy-a9/";
			sharedObj.currentUrl = currentUrl;
		}
		if( sharedObj.isNotGpv2 ){
			shopApiModel.productAjax ( sharedObj, selectorObj );
		} else {
			if( isCart === "Y" && oldProductYn !== "Y" && abnormalcoloryn !== "Y" ){
				shopApiModel.productAjax ( sharedObj, selectorObj );
			} else {
				util.totalAfterFunction(sharedObj, selectorObj);
				sharedObj.util.clickEventListener( sharedObj, selectorObj );
				sharedObj.commonApiModel.settingWishList( sharedObj, selectorObj );
				util.gpHybrisGlobalEndPoint(sharedObj, selectorObj);
			}
		}
	}
	
	/**
	 *    href , href 
	 */
	function anchorNaviTitleChange( sharedObj, selectorObj ){
		const view = sharedObj.view;
		const buyingToolInfoTitle = selectorObj.buyingToolInfoTitle.html();
		const siteCode = sharedObj.siteCode;
		const modelCode = sharedObj.modelCode;
		let currentUrl = window.location.href.replace("/buy", "");
		
		/*   Learn more    */
		if(siteCode === "in" && modelCode.indexOf("SM-A920F") > -1){
			currentUrl = "https://www.samsung.com/in/microsite/galaxy-a9/";
		}
		view.anchorDraw( buyingToolInfoTitle );
		sharedObj.currentUrl = currentUrl;
		
		return currentUrl;
	}

	function optionClickEventListener( sharedObj, selectorObj ){
		sharedObj.optionId = "";
		const eventParam = {
			'sharedObj' : sharedObj,
		  Event
		 */
		selectorObj.buyingToolOptBundle.on( 'click', '.option-input', eventParam, function ( event ) {
			
			const _this = $(this);
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			let detailNodePath = sharedObj.detailNodePath;
			if(window.location.href.indexOf("author.samsung.com") > -1){
				if(detailNodePath.indexOf("/content/samsung") == -1){
					detailNodePath = "/content/samsung"+detailNodePath;
				}
			}
			const siteCode = sharedObj.siteCode;
			const modelcode = modelCodeToSelector(_this.data("modelcode"));
			const familycode =_this.data("familycode");
			const isClicked = sharedObj.isClicked;
			const isOptClicked = sharedObj.isOptClicked;
			const parentId = _this.closest('.pd-select-option').attr('id');
			
			sharedObj.isBuyingoptionApi = _this.hasClass('buyingoption-api');

			sharedObj.focusId = parentId;
			
			if( !isClicked && !_this.hasClass('checked')){
				let htmllast="/";
				
				if( location.href.indexOf(".html") > -1){
					htmllast= ".html";
				}
				
				if( modelcode ){
					
					//[EPP] in refurbished   selector 
					let addOfferSelector = '';
					if( $('#isEppPage').val() === 'true' ){
						let offerId = location.pathname.match(/[0-9]{13}/g);
						if ( offerId != null && typeof offerId != 'undefined' && $.trim(offerId) != '' ){
							addOfferSelector = '.offerid-' + offerId;
						}
					}
					
					const getNodeUrl = detailNodePath + '.pd-g-product-detail-kv.' + modelcode+'.' + sharedObj.siteCode + '.' + familycode + addOfferSelector + htmllast;
					
					sharedObj.isClicked = true;
					sharedObj.isOptClicked = true;
					setTimeout(function() {
						sharedObj.isClicked = false;
					}, 1500);
					
					let hasComponentClass = sharedObj.hasComponentClass;
					let disabledClass = sharedObj.disabledClass;
					let warrantyVdResultArea = selectorObj.buyingToolOptWarrantyVdResult;
					let hasWarrantyVdResult = warrantyVdResultArea.hasClass(hasComponentClass) && !warrantyVdResultArea.hasClass(disabledClass);
					
					if(hasWarrantyVdResult){
						const msg = Granite.I18n.get("VD_Extended Warranty Popup_Change Option");
						$('.confirm-popup-v2 .confirm-popup-v2__cta-wrap .cta.cta--contained').attr("data-event-type", "change-option");
						$('.confirm-popup-v2 .confirm-popup-v2__cta-wrap .cta.cta--contained').attr("data-nodeurl", getNodeUrl);
						confirmPopupV2(msg, 'change option', '', _this);
						
						$('.confirm-popup-v2').on( 'click', '.cta[data-event-type="change-option"]', eventParam, function ( event ) {
							var nodeurl = $(this).data("nodeurl");
							
							$.ajax({
								type : "GET",
								url : nodeurl,
								dataType: "html",
								success : function (data) {
									const $virtualDom = $('<div></div>').append(data);
									const gallery = $virtualDom.find('.pd-header-gallery');
									const buyingTool = $virtualDom.find('.pd-buying-tool');
									const hiddenData = $virtualDom.find('#detail-input-hidden');
									const betterTogether = $virtualDom.find('#betterTogether');
									const banner = $virtualDom.find('section.pd-banner');
									const templates = $virtualDom.find('#detail-google-off');
									const rawcodeComponent = $virtualDom.find('#front-api-rawcode-component');
									$("#detailNodePath").val(detailNodePath);
									const hybrisAddon = $virtualDom.find('#pdd16-step-buying');
									
									$('.pd-g-product-detail-kv .pd-header-gallery').replaceWith(gallery);
									$('.pd-g-product-detail-kv .pd-buying-tool').replaceWith(buyingTool);
									$('.pd-g-product-detail-kv #detail-google-off').replaceWith(templates);
									$('.pd-g-product-detail-kv #detail-input-hidden').replaceWith(hiddenData);
									$('.pd-g-product-detail-kv #betterTogether').replaceWith(betterTogether);
									$('.pd-g-product-detail-kv section.pd-banner').replaceWith(banner);
									$('.pd-g-product-detail-kv #pdd16-step-buying').replaceWith(hybrisAddon);
									$('#front-api-rawcode-component').replaceWith(rawcodeComponent);
									
									//        
									if(siteCode === 'nl') {
										$('#rentalInstallmentFinancing').hide();
										$('#rentalInstallmentFinancingTable').html(''); 
									}

									window.sg.components.productDetailKv.reInit(); // off-change  reInit()    1 reInit() 
									$('#'+sharedObj.focusId).find('.option-input[checked="checked"]').focus();
									
									changeURL(modelcode);
									init();
									
									window.sg.components.pdBanner.reInit();
									changeComponent( sharedObj, selectorObj );
									window.sg.components.PDheaderGallery.reInit();
									window.sg.components.productDetailKv.scrollGo(document.querySelector('#'+sharedObj.focusId));
									window.sg.components.stepbuying.init(); //pdd16-step-buying  
								},
								complete : function() {
									sharedObj.isClicked = false;
								}
							});
						});
						
					}else{
						$.ajax({
							type : "GET",
							url : getNodeUrl,
							dataType: "html",
							success : function (data) {
								const $virtualDom = $('<div></div>').append(data);
								const gallery = $virtualDom.find('.pd-header-gallery');
								const buyingTool = $virtualDom.find('.pd-buying-tool');
								const hiddenData = $virtualDom.find('#detail-input-hidden');
								const betterTogether = $virtualDom.find('#betterTogether');
								const banner = $virtualDom.find('section.pd-banner');
								const templates = $virtualDom.find('#detail-google-off');
								const rawcodeComponent = $virtualDom.find('#front-api-rawcode-component');
								$("#detailNodePath").val(detailNodePath);
								const hybrisAddon = $virtualDom.find('#pdd16-step-buying');
								
								$('.pd-g-product-detail-kv .pd-header-gallery').replaceWith(gallery);
								$('.pd-g-product-detail-kv .pd-buying-tool').replaceWith(buyingTool);
								$('.pd-g-product-detail-kv #detail-google-off').replaceWith(templates);
								$('.pd-g-product-detail-kv #detail-input-hidden').replaceWith(hiddenData);
								$('.pd-g-product-detail-kv #betterTogether').replaceWith(betterTogether);
								$('.pd-g-product-detail-kv section.pd-banner').replaceWith(banner);
								$('.pd-g-product-detail-kv #pdd16-step-buying').replaceWith(hybrisAddon);
								$('#front-api-rawcode-component').replaceWith(rawcodeComponent);
								
								//        
								if(siteCode === 'nl') {
									$('#rentalInstallmentFinancing').hide();
									$('#rentalInstallmentFinancingTable').html(''); 
								}

								window.sg.components.productDetailKv.reInit(); // off-change  reInit()    1 reInit() 
								$('#'+sharedObj.focusId).find('.option-input[checked="checked"]').focus();
								
								changeURL(modelcode);
								init();
								
								window.sg.components.pdBanner.reInit();
								changeComponent( sharedObj, selectorObj );
								window.sg.components.PDheaderGallery.reInit();
								window.sg.components.productDetailKv.scrollGo(document.querySelector('#'+sharedObj.focusId));
								window.sg.components.stepbuying.init(); //pdd16-step-buying  
							},
							complete : function() {
								sharedObj.isClicked = false;
							}
						});
					}
				}
			} else {
				return false;
			}
		});
		
		/**
		 *     Event (VD frame )
		 */
		selectorObj.buyingToolOptBundle.on( 'click', '.bezel-option-input', eventParam, function ( event ) {
			const _this = $(this);
			const sharedObj = event.data.sharedObj;
			const selectorObj = event.data.selectorObj;
			const drawObj = sharedObj.drawObj;
			let detailNodePath = sharedObj.detailNodePath;
			if(window.location.href.indexOf("author.samsung.com") > -1){
				if(detailNodePath.indexOf("/content/samsung") == -1){
					detailNodePath = "/content/samsung"+detailNodePath;
				}
			}
			
			const modelcode = sharedObj.modelCode;
			//NOTICE :        
			const bezelModelcode = _this.data("bezelmodelcode");
			const bezelModelPatterncode = _this.data("bezelmodelpatterncode");
			const familycode =_this.data("familycode");
			const isBezelClicked = sharedObj.isBezelClicked;
			const parentId = _this.closest('.pd-select-option').attr('id');
			const isNewHybris = (sharedObj.apiFlag === "Hybris-new");
			const isOldHybris = (sharedObj.apiFlag === "Hybris" || sharedObj.apiFlag === "Hybris-intg");
			const defaultColor = bezelModelcode === modelcode;
			let bezelPMT = '';
			sharedObj.pmtURL = "/"+sharedObj.siteCode+"/tvs/personalize-my-tv/?sku="+modelcode+"&type=apps";
			sharedObj.pmtModelList = [];
			
			if(!defaultColor && bezelModelcode != "dummyCode"){
				sharedObj.bezelDummyCode = false;
				sharedObj.cartBezelCode = bezelModelcode;
				sharedObj.pmtModelList.push(bezelModelcode);
			}else{
				sharedObj.cartBezelCode = '';
				sharedObj.bezelDummyCode = true;
			}
			
			// VD embed addon
			const isSoundbarCategoryData = sharedObj.soundbarCategoryData && Object.keys(sharedObj.soundbarCategoryData).length > 0 ? true : false;
			if( isSoundbarCategoryData ){ 
				sharedObj.embedAddonSelected.forEach(function(product, idx){
					sharedObj.pmtModelList.push(product.modelCode);
				});
			}
			
			if( $("#personalizeMyTv").length > 0 ){
				if( !defaultColor || (defaultColor && sharedObj.pmtModelList.length > 0) ){
					bezelPMT += "&option=";
				}
				sharedObj.pmtModelList.forEach(function(code){
					bezelPMT += code + ',';
				});
				$("#personalizeMyTv .cta").attr("href", sharedObj.pmtURL + bezelPMT.slice(0, -1));
			}
			
			sharedObj.isBuyingoptionApi = _this.hasClass('buyingoption-api');

			sharedObj.focusId = parentId;
			
			for(var i=0; i<sharedObj.bezelColorArray.length; i++){
				var this_id = _this.attr("id");
				if(sharedObj.bezelColorArray[i].id == this_id){
					sharedObj.bezelColorIndex = i;
				}
			}
			sharedObj.selectedBezelColor = sharedObj.bezelModelCodeArray[sharedObj.bezelColorIndex];
			
			//TODO :        CTA  
			//NOTICE :     not for sale
			//NOTICE : outOfstock  get stock alert
			//NOTICE : inStock    add to cart  continue( , inStock     ) 
			if(sharedObj.isBezelObj.util.settingPriceDraw( sharedObj, selectorObj );
				
				//    
				if(sharedObj.isPossibleBuy){
					//  CTA  
					sharedObj.util.settingPriceCta( sharedObj.hasPriceCta, sharedObj, selectorObj, sharedObj.currentUrl );
				}else if(!sharedObj.isPossibleBuy && sharedObj.sellingWithBazel){
					
					//2022      CTA OOS      cta   
					sharedObj.util.settingPriceCta( sharedObj.hasPriceCta, sharedObj, selectorObj, sharedObj.currentUrl );
				}
			}
			
			if( !isBezelClicked && !_this.hasClass('checked')){
				let htmllast="/";
				
				if( location.href.indexOf(".html") > -1){
					htmllast= ".html";
				}
				
				if( modelcode ){
					//TODO :                . 
					var getNodeUrl = "";
					var bezelModelcodeParam = bezelModelcode.indexOf("/") > -1 ? bezelModelcode.replace("/","_") : bezelModelcode; // "/"  "_" 
					
					//[EPP] in refurbished   selector 
					let addOfferSelector = '';
					if( $('#isEppPage').val() === 'true' ){
						let offerId = location.pathname.match(/[0-9]{13}/g);
						if ( offerId != null && typeof offerId != 'undefined' && $.trim(offerId) != '' ){
							addOfferSelector = '.offerid-' + offerId;
						}
					}
					
					if(bezelModelcode){ //bezelModelCode  
						getNodeUrl = detailNodePath + '.pd-g-product-detail-kv.' + modelcode+'.' + sharedObj.siteCode + '.' + familycode + '.' + bezelModelcodeParam + addOfferSelector + htmllast;
					}else{ //bezelModelCode 
						getNodeUrl = detailNodePath + '.pd-g-product-detail-kv.' + modelcode+'.' + sharedObj.siteCode + '.' + familycode + addOfferSelector + htmllast;
					}
					
					//TODO :                 . > isBezelClicked  
					sharedObj.isBezelClicked = true;
					setTimeout(function() {
						sharedObj.isBezelClicked = false;
					}, 1500);
					$.ajax({
						type : "GET",
						url : getNodeUrl,
						dataType: "html",
						success : function (data) {
							
							const $virtualDom = $('<div></div>').append(data);
							const gallery = $virtualDom.find('.pd-header-gallery');

							$('.pd-g-product-detail-kv .pd-header-gallery'j.focusId).find('.option-input[checked="checked"]').focus();
							
							window.sg.components.PDheaderGallery.reInit();
							
							$('.pd-header-gallery__thumbnail-tab .tab__item').eq(0).find('.num').text($(".pd-header-gallery__thumbnail-list").eq(0).children().length); //   
							$('.pd-header-gallery__thumbnail-tab .tab__item').eq(1).find('.num').text($(".pd-header-gallery__thumbnail-list").eq(1).children().length); //   
						},
						complete : function() {
							sharedObj.isBezelClicked = false;
						}
					});
				 
					
				}
			} else {
				return false;
			}
			
			//    
			$(".pd-select-option__info-link").click(function(){
				var _this = $(this);
				var popupType = _this.data('target-popup');
				var openPopup = "";
				if($(".pd-select-optiondType"){
						openPopup = document.querySelectorAll('.pd-select-option__info-link')[1];
					}
				}else{
					openPopup = document.querySelectorAll('.pd-select-option__info-link')[0];
				}
				window.sg.components.productDetailKv.openBezelPopup(openPopup);
			});
		});
		
		//Aplaut review widget 
		if(sharedObj.aplautYn == 'Y'){			
			var tempModelCode = sharedObj.modelCode;
			var aplautModelCode = tempModelCode.replace("/","_");
			 ShoppilotAPI.then(function (Shoppilot) {
				var ProductWidget = Shoppilot.require("product_widget");
				var MultiWidget = Shoppilot.require('multi_widget');
					
				var inline_rating = new ProductWidget({
					name: "inline-rating",
					product_id: aplautModelCode,
					container: "#aplaut-inline-rating-container",
					});
				var product_reviews = new ProductWidget({
					name: "product-reviews",
					product_id: aplautModelCode,
					container: "#aplaut-reviews-container",
					});
				var product_questions = new ProductWidget({
					name: "product-questions",
					product_id: aplautModelCode,
					container: "#aplaut-questions-container",
					});			
				
				MultiWidget.render([inline_rating, product_reviews, product_questions]);
			});
		}		
		
		// bv conversation    
		//window.bvCallback = function (BV) {
			
		$(document).on('click', '.bv_stars_component_container, .sp-inline-rating-stars, .pd-info__rating', function () {
				document.querySelector('#reviewWrap > a').click();
			});
		//};
		
		//ePromoter chat - mobile
		if($('#isEppPage').val()){
			$(".product-detail-kv .product-detail-kv__cta-epromotor").hide();
		}
		$(document).on("click", ".product-detail-kv .product-detail-kv__cta-epromotor .cta", function(){
			window.sprChat('open');
		});
	}
	
	/* display N  redirect. */
	function pdDisplayYnRedirect( sharedObj ) {
		const pdStageInfo = sharedObj.pdStageInfo;
		const pdDisplayYn = sharedObj.pdDisplayYn;
		let parentPage = sharedObj.parentPath;
		if (parentPage.indexOf("/content/samsung") > -1) {
			parentPage = parentPage.split("/content/samsung")[1];
		}
		
		if (pdStageInfo !== "admin") {
			if (pdDisplayYn === 'N') {
				var htmllast = "/";
				if (location.href.indexOf(".html") > -1) {
					htmllast = ".html";
				}
				if( parentPage ){
					location.href = parentPage + htmllast;
				}
				
			}
		}
	}
	
	/**
	 * api      pageData  
	 */
	function changePageHiddenDataToApiData (){
		const apiChangeModelCode = $("#apiChangeModelCode").val();
		const apiChangeCategorySubSubTypeCode = $("#apiChangeCategorySubSubTypeCode").val();
		const apiChangeCategorySubTypeCode = $("#apiChangeCategorySubTypeCode").val();
		const apiChangeCategoryTypeCode = $("#apiChangeCategoryTypeCode").val();
		const apiChangeCategoryGroupCode = $("#apiChangeCategoryGroupCode").val();
		const apiChangeModelName = $("#apiChangeModelName").val();
		const apiChangeShopSKU = $("#apiChangeShopSKU").val();
		const apiChangePdpUrl = $("#apiChangePdpUrl").val();
		const apiChangeFamilyCode = $("#apiChangeFamilyCode").val();
		
		
		if( apiChangeModelCode ){
			$("#modelCode").val(apiChangeModelCode);
		}
		if( apiChangeCategorySubSubTypeCode ){
			$("#categorySubSubTypeCode").val(apiChangeCategorySubSubTypeCode);
		}
		if( apiChangeCategorySubTypeCode ){
			$("#categorySubTypeCode").val(apiChangeCategorySubTypeCode);
		}
		if( apiChangeCategoryTypeCode ){
			$("#categoryTypeCode").val(apiChangeCategoryTypeCode);
		}
		if( apiChangeCategoryGroupCode ){
			$("#categoryGroupCode").val(apiChangeCategoryGroupCode);
		}
		if( apiChangeModelName ){
			$("#modelName").val(apiChangeModelName);
		}
		if( apiChangeShopSKU ){
			$("#shopSKU").val( apiChangeShopSKU );
		}
		
		if( apiChangePdpUrl ){
			$("#pdpUrl").val( apiChangePdpUrl );
		}
		
		if( apiChangeFamilyCode ){
			$("#familyCode").val(apiChangeFamilyCode);
		}
	}
	
	function changeComponent( sharedObj, selectorObj ){
		const naviNode =  '.pd-g-header-navigation';
		const featureBenefitNode =  '.pd-g-feature-benefit';
		const specNode =  '.pd-g-product-specs';
		const reviewNode =  '.pd-g-product-review-highlight';
		const recentlyviewNode =  '.pd-g-product-recently-viewed';
		const supportNode =  '.pd-g-product-support';
		const compareNode =  '.pd-g-product-compare';
		const accNode =  '.pd-g-accessories';
		const breadInDisclamerNode = $('#isEppPage').val() === 'true' ? '.ep-cm-g-breadcrumb' : '.nv-g-breadcrumb'; //epp breadCrumb  
		const manufacturerInfoPopupNode =  '.pd-g-manufacturer-info-popup';
		
		if ( !sharedObj.isBuyingoptionApi ){
			featureBenefitNodeReplace( getNodeUrlPath ( featureBenefitNode, sharedObj, selectorObj ), featureBenefitNode , sharedObj, selectorObj );
		}
		
		specReplace( getNodeUrlPath ( specNode, sharedObj, selectorObj ), specNode , sharedObj, selectorObj );
		reviewReplace( getNodeUrlPath ( reviewNode, sharedObj, selectorObj ), reviewNode , sharedObj, selectorObj );
		recentlyviewReplace( getNodeUrlPath ( recentlyviewNode, sharedObj, selectorObj ), recentlyviewNode , sharedObj, selectorObj );
		supportReplace( getNodeUrlPath ( supportNode, sharedObj, selectorObj ), supportNode , sharedObj, selectorObj );
		compareReplace( getNodeUrlPath ( compareNode, sharedObj, selectorObj ), compareNode , sharedObj, selectorObj );
		accReplace( getNodeUrlPath ( accNode, sharedObj, selectorObj ), accNode , sharedObj, selectorObj );
		breadInDisclamerReplace( getNodeUrlPath ( breadInDisclamerNode, sharedObj, selectorObj ), breadInDisclamerNode , sharedObj, selectorObj );
		manufacturerInfoPopupReplace( getNodeUrlPath ( manufacturerInfoPopupNode, sharedObj, selectorObj ), manufacturerInfoPopupNode , sharedObj, selectorObj );
		naviReplace( getNodeUrlPath ( naviNode, sharedObj, selectorObj ), naviNode , sharedObj, selectorObj );
	}
	
	function changeAnchorPrice( sharedObj, selectorObj ){
		const naviNode =  '.pd-g-header-navigation';
		
		naviReplace( getNodeUrlPath ( naviNode, sharedObj, selectorObj ), naviNode , sharedObj, selectorObj );
	}
	
	function getNodeUrlPath ( nodeName, sharedObj, selectorObj ){
		const detailNodePath = sharedObj.detailNodePath;
		const modelcode = modelCodeToSelector($('#modelCode').val());
		const siteCode = sharedObj.siteCode;
		
		let result = '';
		let htmllast="/";
		if( location.href.indexOf(".html") > -1){
			htmllast= ".html";
		}
		
		//[EPP] in refurbished   selector 
		let addOfferSelector = '';
		if( $('#isEppPage').val() === 'true' ){
			let offerId = location.pathname.match(/[0-9]{13}/g);
			if ( offerId != null && typeof offerId != 'undefined' && $.trim(offerId) != '' ){
				addOfferSelector = '.offerid-' + offerId;
			}
		}
		
		if( nodeName ){
			result = detailNodePath + nodeName + '.' + modelcode+'.' + siteCode + addOfferSelector + htmllast;
		}
		
		return result;
	}
	
	function compareReplace( url, nodeName, sharedObj, selectorObj ){
		const util = sharedObj.util;
		const siteCode = sharedObj.siteCode;
		$.ajax({
			type : "GET",
			url : url,
			dataType: "html",
			success : function (data) {
				
				const COMPONENT_SELECTOR = "#compare.pd-product-compare";
				window.sg.sdf.comp.dispose( COMPONENT_SELECTOR );
				
				$(nodeName).html(data);
				if(siteCode !== 'id') {
					compareReinit(util);
				}
			}
		});
			
	}
	
	function compareReinit(util){
		const bindObjDev = window.sg.components.pdProductCompare.initDynamic;
		const bindObjMarkUp = window.sg.components.pdProductCompare;
		util.nonCheckError( bindObjDev, bindObjDev );
		util.nonCheckError( bindObjMarkUp, bindObjMarkUp.init );
	}
	
	function supportReplace( url, nodeName, sharedObj, selectorObj ){
		
		$.ajax({
			type : "GET",
			url : url,
			dataType: "html",
			success : function (data) {
				$(nodeName).html(data);
			}
		});
			
	}
	
	function accReplace( url, nodeName, sharedObj, selectorObj ){
		const util = sharedObj.util;
		
		$.ajax({
			type : "GET",
			url : url,
			dataType: "html",
			success : function (data) {
				const bindObjDev = window.sg.components.dynamic;
				const bindObjMarkUp = window.sg.components.accessories;
				
				$(nodeName).html(data);
				
				util.nonCheckError( bindObjDev, bindObjDev.accessoriesGrid );
				util.nonCheckError( bindObjMarkUp, bindObjMarkUp.reInit );
			}
		});
	}
	
	function breadInDisclamerReplace( url, nodeName, sharedObj, selectorObj ){
		
		$.ajax({
			type : "GET",
			url : url,
			dataType: "html",
			success : function (data) {
				
				const $virtualDom = $('<div></div>').append(data);
				const discalmerArea = $virtualDom.find('.text-editor');
				
				$('.nv-g-breadcrumb .text-editor').replaceWith(discalmerArea);
				
			}
		});
	}
	
	function recentlyviewReplace( url, nodeName, sharedObj, selectorObj ){
		const util = sharedObj.util;
		
		$.ajax({
			type : "GET",
			url : url,
			dataType: "html",
			success : function (data) {
				const bindObjDev = window.sg.components.dynamic;
				const bindObjMarkUp = window.sg.components.recentlyViewed;
				
				$(nodeName).html(data);
				
				if( bindObjDev.rencentlyViewGrid  ){
					util.nonCheckError( bindObjDev, bindObjDev.rencentlyViewGrid );
				}
				
				if( bindObjMarkUp ){
					util.nonCheckError( bindObjMarkUp, bindObjMarkUp.reInit );
				}
				
			}
		});
			
	}
	
	function reviewReplace( url, nodeName, sharedObj, selectorObj ){
		let bvFlagVal = $('#bvFlag').val() === "Y" ? true : false;
		if(bvFlagVal){
			if(url.indexOf(".html") > -1){
				url = url.substr(0, url.length - 5);
				url = url + '.pd-g-product-review-highlight-tab1.html';
			}else{
				url = url.substr(0, url.length - 1);
				url = url + '.pd-g-product-review-highlight-tab1/';				
			}
			nodeName = '#review';
		}
		
		$.ajax({
			type : "GET",
			url : url,
			dataType: "html",
			success : function (data) {
				$(nodeName).html(data);
			}
		});
	}
	
	function manufacturerInfoPopupReplace( url, nodeName, sharedObj, selectorObj ){
		const util = sharedObj.util;
		
		$.ajax({
			type : "GET",
			url : url,
			dataType: "html",
			success : function (data) {
				$(nodeName).html(data);
				
				const manufacturerArea = $('.manufacturer-info-popup');
				if( manufacturerArea.length > 0 ){
					const bindObjDev = window.sg.components.dynamic;
					const bindObjMarkUp = window.sg.components.manufacturerInfoPopup;
					
					util.nonCheckError( bindObjMarkUp, bindObjMarkUp.reInit );
				}
			}
		});
	}
	
	function specReplace( url, nodeName, sharedObj, selectorObj ){
		const util = sharedObj.util;
		
		$.ajax({
			type : "GET",
			url : url,
			dataType: "html",
			success : function (data) {
				const bindObjMarkUp = window.sg.components.specHighlight;
				
				$(nodeName).html(data);
				util.nonCheckError( bindObjMarkUp, bindObjMarkUp.reInit );
			}
		});
			
	}
	
	function naviReplace( url, nodeName, sharedObj, selectorObj ){
		const util = sharedObj.util;
		const view = sharedObj.view;
		const siteCode = sharedObj.siteCode;
		$.ajax({
			type : "GET",
			url : url,
			dataType: "html",
			success : function (data) {
				const bindObjDev = window.sg.aem.components.product.setAnchors;
				const bindObjMarkUp = window.sg.components.pdHeaderNavigation;
				
				$(nodeName).html(data);
				util.nonCheckError( bindObjDev , bindObjDev.init);
				util.nonCheckError( bindObjMarkUp, bindObjMarkUp.reInit );
				
				view.productPriceTotalDraw(window.sg.components.dynamic.detailSharedObj.drawObj, window.sg.components.dynamic.detailSharedObj.isOptClicked);
				view.productDraw(window.sg.components.dynamic.detailSharedObj.drawObj);
				view.anchorDraw(dynamic.detailSelectorObj.buyingToolInfoTitle.text());
				if(siteCode !== 'id') {
					compareReinit(util);
				}
			}
		});
			
	}
	
	function changeURL(modelcode){
		let changeURL = $('#currentPdpUrl').val();
		const hasBuy = location.href.indexOf('/buy') > -1

		if( changeURL ){
			if( location.href.indexOf('.html') > -1 ){
				let lastChar = changeURL.substring(changeURL.length-1);
				if( lastChar === '/' ){
					changeURL = changeURL.substring(0,changeURL.length-1);
				}
				// buy  buy 
				if( hasBuy && changeURL.indexOf('/buy') < 0 ){
					changeURL = '/content/samsung' + changeURL +'/buy.html';
				}else{
					changeURL = '/content/samsung' + changeURL + '.html';
				}
			} else {
				// buy  buy 
				if( hasBuy && changeURL.indexOf('/buy') < 0 ){
					let lastChar = changeURL.substring(changeURL.length-1);
					if( lastChar === '/' ){
						changeURL = changeURL + 'buy/';
					} else {
						changeURL = changeURL + '/buy/';
					}
					
				}
			}
			
			//epp  
			if( $('#isEppPage').val() === 'true' ){
				const cPdpUrl = $('#currentPdpUrl').val();
				let pdType = 'buy';
				if(location.href.indexOf('/pd.') > -1){
					pdType = 'pd'
				}
				if(cPdpUrl.indexOf('/pd.') > -1 ){
					changeURL = $('#currentPdpUrl').val().replace('/pd.',`/${pdType}.`);
				} else if(cPdpUrl.indexOf('/feature.') > -1 ){
					changeURL = $('#currentPdpUrl').val().replace('/feature.',`/${pdType}.`);
				} else if(cPdpUrl.indexOf('/buy.') > -1 ){
					changeURL = $('#currentPdpUrl').val().replace('/buy.',`/${pdType}.`);
				}

				//[EPP] in refurbished   selector 
				const checkUrl = changeURL.match(/[0-9]{13}/g);
				if ( $.trim(checkUrl) === '' ){
					const offerId = location.pathname.match(/[0-9]{13}/g);
	                if ( offerId != null && typeof offerId != 'undefined' && $.trim(offerId) != '' ){
						changeURL = changeURL.replace(modelcode, modelcode + '.' + offerId);
	                }
				}
                
				if( location.href.indexOf('.html') > -1 ){
					let lastChar = changeURL.substring(changeURL.length-1);
					if( lastChar === '/' ){
						changeURL = changeURL.substring(0,changeURL.length-1);
					}
					if( changeURL.indexOf('/content/samsung') == -1 ){
						changeURL = '/content/samsung' + changeURL;
					}
					changeURL += ".html";
				}
			}
			
			history.pushState(null , null , changeURL);
		}
	}
	
	function featureBenefitNodeReplace( url, nodeName, sharedObj, selectorObj ){
		
		$.ajax({
			type : "GET",
			url : url,
			dataType: "html",
			success : function (data) {
				const util = sharedObj.util;
				const $virtualDom = $('<div></div>').append(data);
				$(nodeName).html(data);
				
				
				if($virtualDom.find('.feature-benefit').length > 0 ){
					util.nonCheckError( window.sg.components.featureBenefit, window.sg.components.featureBenefit.reInit );
				}
				
				if($virtualDom.find('.feature-benefit-banner').length > 0){
					util.nonCheckError( window.sg.components.featureBenefitBanner, window.sg.components.featureBenefitBanner.reInit );
				}
				
				if($virtualDom.find('.feature-benefit-bundle').length > 0){
					util.nonCheckError( window.sg.components.featureBenefitBundle, window.sg.components.featureBenefitBundle.reInit );
				}
				
				if($virtualDom.find('.feature-benefit-full-bleed').length > 0){
					util.nonCheckError( window.sg.components.featureBenefitFullBleed, window.sg.components.featureBenefitFullBleed.reInit );
				}
				
				if($virtualDom.find('.feature-benefit-gallery').length > 0){
					util.nonCheckError( window.sg.components.featureBenefitGallery, window.sg.components.featureBenefitGallery.reInit );
				}
				
				if($virtualDom.find('.feature-benefit-half-text').length > 0){
					util.nonCheckError( window.sg.components.featureBenefitHalfText, window.sg.components.featureBenefitHalfText.reInit );
				}
				
				if($virtualDom.find('.feature-benefit-tab').length > 0){
					util.nonCheckError( window.sg.components.featureBenefitTab, window.sg.components.featureBenefitTab.reInit );
				}
				
				if($virtualDom.find('.three-column-carousel').length > 0){
					util.nonCheckError( window.sg.components.featureBenefitThreeColumn, window.sg.components.featureBenefitThreeColumn.reInit );
				}

				if($virtualDom.find('.two-column').length > 0){
					util.nonCheckError( window.sg.components.featureBenefitTwoColumn, window.sg.components.featureBenefitTwoColumn.reInit );
				}
				
				if($virtualDom.find('.feature-benefit-video-kv').length > 0){
					util.nonCheckError( window.sg.components.featureBenefitVideoKv, window.sg.components.featureBenefitVideoKv.reInit );
				}
				
				window.sg.common.image.initAll();
			}
		});
			
	}
})();


((window, $) => {
	"use strict";

	var siteCode = $("#siteCode").val();
	var hybrisJsonYn = $("#hybrisApiJson").val();
	var storeDomain = $("#storeDomain").val();
	var searchDomain = $("#searchDomain").val();
	var stage = $("#apiStageInfo").val();
	var currency = $("#priceCurrency").val();
	var addPlatform = ($("#shopIntegrationFlag").val() === "Hybris-intg" ? "hybris" : "global");
	var relatedProducts = {};
	var productListData = new Array();

	var isMultistore = (siteCode === "ae" || siteCode === "ae_ar" || siteCode === "levant" || siteCode === "levant_ar" || siteCode === "n_africa");
	var shopSiteCode = "";
	if (siteCode === "ae" || siteCode === "ae_ar") {
		//NOTICE : dotcomMultistore     ae, ae_ar, kw, kw_ar, om, om_ar, bh, bh_ar    
		var dotcomMultistore = window.cookies.getCookie("estoreSitecode");
		if(dotcomMultistore) {
			if(dotcomMultistore === "ae" || dotcomMultistore === "ae_ar" || dotcomMultistore === "kw" || dotcomMultistore === "kw_ar" || dotcomMultistore === "om" 
				|| dotcomMultistore === "om_ar" || dotcomMultistore === "bh" || dotcomMultistore === "bh_ar" || dotcomMultistore === "qa" || dotcomMultistore === "qa_ar") {
				shopSiteCode = dotcomMultistore;
			} else {
				shopSiteCode = siteCode;
			}
		} else {
			shopSiteCode = siteCode;
		}
	} else if (siteCode === "levant") {
		shopSiteCode = "jo";
	} else if (siteCode === "levant_ar") {
		shopSiteCode = "jo_ar";
	} else if (siteCode === "n_africa") {
		shopSiteCode = "ma";
	} else {
		shopSiteCode = siteCode;
	}
	
	// epp shop 
	shopSiteCode = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : shopSiteCode;

	var relatedProductsUrl = storeDomain + "/" + shopSiteCode;
	if (siteCode === "cl" || siteCode === "mx" || siteCode === "py") {
		relatedProductsUrl = storeDomain;
	}
	relatedProductsUrl += "/servicesv2/getRelatedProductsSimpleInfo";

	function getRelatedProductsSimpleInfo(modelCode) {
		var param = "?productCode=" + modelCode;
		productListData = new Array();
		var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};
		
		if (hybrisJsonYn === 'Y') {
			$.ajax({
				url: relatedProductsUrl + param,
				type: "GET",
				dataType: "json",
				cache: true,
				crossDomain: true,
				xhrFields: _xhrFields,
				timeout: 10000,
				success: setAddOnProduct,
				error: function () {}
			});
		} else {
			$.ajax({
				url: relatedProductsUrl + param,
				type: "GET",
				dataType: "jsonp",
				jsonpCallback: "jQuery1910499421933433041_" + "151",
				xhrFields: _xhrFields,
				cache: true,
				crossDomain: true,
				timeout: 10000,
				success: setAddOnProduct,
				error: function () {}
			});
		}
	}

	function setAddOnProduct(data) {
		if (data.products != null && data.products.length > 0) {
			// Draw Continue Button
			window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);

			$.each(data.products, function (idx, obj) {
				var modelCode = obj.modelcode;
				relatedProducts[modelCode] = {};
				relatedProducts[modelCode].modelCode = modelCode;
				relatedProducts[modelCode].name = obj.name || "";
				relatedProducts[modelCode].imageUrl = obj.imageUrl || "";
				relatedProducts[modelCode].imageUrlAlt = obj.imageUrlAlt || "";
				relatedProducts[modelCode].stocklevel = obj.stocklevel || "";
				relatedProducts[modelCode].price = obj.price || "";
				relatedProducts[modelCode].priceValue = obj.priceValue || "";
				relatedProducts[modelCode].promotionPrice = "";
				relatedProducts[modelCode].promotionPriceValue = "";

				if (obj.promotionPrice) {
					relatedProducts[modelCode].promotionPrice = obj.promotionPrice;
				} else {
					relatedProducts[modelCode].promotionPrice = obj.price;
				}
				if (obj.promotionPriceValue) {
					relatedProducts[modelCode].promotionPriceValue = obj.promotionPriceValue;
				} else {
					relatedProducts[modelCode].promotionPriceValue = obj.priceValue;
				}
			});
		}
	}

	function getSearchProductcard(callback) {
		var modelList = new Array();
		$.each(relatedProducts, function (idx, item) {
			modelList.push(item.modelCode);
		});

		var param = {
			"modelList": modelList.toString(),
			"onlyRequestSkuYN": "Y",
			"saleSkuYN": "N",
			"siteCode": siteCode
		};

		if (isMultistore) {
			param.shopSiteCode = shopSiteCode;
		}
		
		// epp search  
		const isEPP = $('#isEppPage').val() === 'true';
		const businessType = isEPP ? 'epp/v2': 'b2c';
		if(isEPP){
			param.companyCode  = $('#eppCompanyCode').val();
			param.shopSkuYN  = "N";
			
			const eppIsUserGroupPricing = window.sg.epp.common.isUserGroupPricing;
			if(eppIsUserGroupPricing){
				param['groupName'] = window.sg.epp.common.groupName;
			}
		}

		$.ajax({
			url: searchDomain + "/" + stage + `/${businessType}/product/card/detail/` + addPlatform,
			type: "GET",
			data: param,
			dataType: "json",
			//async : false,
			cache: true,
			timeout: 10000,
			success: function (data) {
				if (data.response.statusCode === 200 && data.response.resultData != null && data.response.resultData.productList != null) {
					var productList = data.response.resultData.productList;
					$.each(productList, function (familyIdx, product) {
						var modelList = product.modelList;
						var categorySubTypeEngName = product.categorySubTypeEngName;
						if (modelList != null) {
							$.each(modelList, function (modelIdx, model) {
								var modelCode = model.modelCode;
								var stocklevel = relatedProducts[modelCode].stocklevel;
								if (!relatedProducts[modelCode]) {
									return;
								}

								if (!model.displayName) {
									model.displayName = relatedProducts[modelCode].name;
								}
								if (!model.thumbUrl) {
									model.thumbUrl = relatedProducts[modelCode].imageUrl;
								}
								if (!model.thumbUrlAlt) {
									model.thumbUrlAlt = relatedProducts[modelCode].imageUrlAlt;
								}
								model.priceDisplay = relatedProducts[modelCode].price;
								model.promotionPriceDisplay = relatedProducts[modelCode].promotionPrice;
								model.price = relatedProducts[modelCode].priceValue;
								model.promotionPrice = relatedProducts[modelCode].promotionPriceValue;
								model.stocklevel = stocklevel;
								model.isStock = !(stocklevel === "" || stocklevel.toUpperCase() === "OUTOFSTOCK");
								model.idx = String(familyIdx) + '-' + String(modelIdx); //familyNum - modelNum
								model.categorySubTypeEngName = categorySubTypeEngName;
							});
						}
					});

					productListData = productList;
				}
			},
			error: function () {},
			complete: function () {
				callback(productListData);
			}
		});
	}

	function setPriceInfo(model) {
		var productPrice = model.price;
		var promotionPrice = model.promotionPrice;
		var savePriceTemp = Number((parseFloat(productPrice) - parseFloat(promotionPrice)).toFixed(2));
		var saveText = currencyComma(savePriceTemp, currency);
		var productPriceDisplay = model.priceDisplay || (productPrice ? currencyComma(productPrice, currency) : "");
		var promotionPriceDisplay = model.promotionPriceDisplay || (promotionPrice ? currencyComma(promotionPrice, currency) : "");

		return {
			"promotionPrice": promotionPrice,
			"productPrice": productPrice,
			"savePriceTemp": savePriceTemp,
			"saveText": saveText,
			"productPriceDisplay": productPriceDisplay,
			"promotionPriceDisplay": promotionPriceDisplay
		}
	}

	var dynamic = window.sg.components.dynamic || {};
	dynamic.betterTogetherHybris = (function () {
		return {
			getRelatedProductsSimpleInfo: getRelatedProductsSimpleInfo,
			getSearchProductcard: getSearchProductcard,
			setPriceInfo: setPriceInfo
		}
	})();

})(window, window.jQuery);

((window, $) => {
	"use strict";

	var currency = $("#priceCurrency").val();
	var siteCode = $("#siteCode").val();
	var isSEBN = (siteCode === "nl" || siteCode === "be" || siteCode === "be_fr");

	function newChip(chipOptions, fmyChip) {
		var option = {
			"optionCode": fmyChip.fmyChipCode,
			"optionLocalName": fmyChip.fmyChipLocalName,
			"optionName": fmyChip.fmyChipName
		};
		var chipOption = {
			"fmyChipType": fmyChip.fmyChipType,
			"optionList": [option]
		};
		chipOptions.push(chipOption);
	}

	function setChipOptions(chipOptions, fmyChipList) {
		for (var i = 0; i < fmyChipList.length; i++) {
			var fmyChip = fmyChipList[i];
			if (chipOptions.length > 0) {
				var newChipFlag = true;
				for (var j = 0; j < chipOptions.length; j++) {
					var chipOption = chipOptions[j];
					if (chipOption.fmyChipType === fmyChip.fmyChipType) {
						var option = {
							"optionCode": fmyChip.fmyChipCode,
							"optionLocalName": fmyChip.fmyChipLocalName,
							"optionName": fmyChip.fmyChipName
						};
						newChipFlag = false;
						if (JSON.stringify(chipOption.optionList).indexOf(JSON.stringify(option)) === -1) {
							chipOption.optionList.push(option);
						}
					}
				}
				if (newChipFlag) {
					newChip(chipOptions, fmyChip);
				}
			} else {
				newChip(chipOptions, fmyChip);
			}
		}
	}

	function setFamily(data) {
		var productList = [];
		var FamilyListTemp = {};
		for (var i in data) {
			var model = data[i];
			if (model.familyIndex != null) {
				if (FamilyListTemp[model.familyIndex] == null) {
					FamilyListTemp[model.familyIndex] = [];
				}
				FamilyListTemp[model.familyIndex].push(model);
			}
		}
		var familyNum = 0;
		for (var i in FamilyListTemp) {
			var FamilyList = {};
			FamilyList.modelList = FamilyListTemp[i];
			FamilyList.chipOptions = [];
			for (var j = 0; j < FamilyListTemp[i].length; j++) {
				var model = FamilyListTemp[i][j];
				var ctaType = model.ctaType;
				//model.price_info = model.price_info[0];
				model.idx = String(familyNum) + '-' + String(j); //familyNum - modelNum

				if (model.inventory && model.inventory.status) {
					ctaType = model.inventory.status;
					model.ctaType = ctaType;
				}
				model.isStock = !(ctaType === "" || ctaType.toUpperCase() === "NOORDER" || ctaType.toUpperCase() === "OUTOFSTOCK");
				setChipOptions(FamilyList.chipOptions, model.fmyChipList);
			}
			familyNum++;

			productList.push(FamilyList);
		}
		return productList;
	}

	function setPriceInfo(model) {
		var promotionPrice = 0;
		var productPrice = 0;
		var savePriceTemp = 0;
		var saveText = "";
		var productPriceDisplay = "";
		var promotionPriceDisplay = "";
		if (model.price_info != null && model.price_info.length > 0 && model.price_info[0].msrp_price) {
			productPrice = model.price_info[0].msrp_price.value;
			promotionPrice = model.price_info[0].sale_price.value;
			savePriceTemp = Number((parseFloat(productPrice) - parseFloat(promotionPrice)).toFixed(2));
			saveText = currencyComma(savePriceTemp, currency);
			productPriceDisplay = model.price_info[0].msrp_price.formatted_value;
			promotionPriceDisplay = model.price_info[0].sale_price.formatted_value;

			if (model.price_info[0].discount_description != null) {
				if (model.price_info[0].discount_description.type != null && "rebate,percentage".indexOf(model.price_info[0].discount_description.type.toLowerCase()) && model.price_info[0].discount_description.formatted_value != null) {
					saveText = model.price_info[0].discount_description.formatted_value;
				}
			}
			productPriceDisplay = (isSEBN || !productPriceDisplay) ? currencyComma(productPrice, currency) : productPriceDisplay;
			promotionPriceDisplay = (isSEBN || !promotionPriceDisplay) ? currencyComma(promotionPrice, currency) : promotionPriceDisplay;
		}

		return {
			"promotionPrice": promotionPrice,
			"productPrice": productPrice,
			"savePriceTemp": savePriceTemp,
			"saveText": saveText,
			"productPriceDisplay": productPriceDisplay,
			"promotionPriceDisplay": promotionPriceDisplay
		}
	}

	var dynamic = window.sg.components.dynamic || {};
	dynamic.betterTogetherGPv2 = (function () {
		return {
			setFamily: setFamily,
			setPriceInfo: setPriceInfo
		}
	})();

})(window, window.jQuery);

((window, $) => {
	"use strict";

	window.sg.components.dynamic = window.sg.components.dynamic || {};
	var dynamic = window.sg.components.dynamic;
	var siteCode = $("#siteCode").val();
	var currency = $("#priceCurrency").val();
	var productListData = new Array();
	var selectIndexList = new Array();
	var selectProductList = new Array();
	var isVoucher = false;
	var isSEBN = (siteCode === "nl" || siteCode === "be" || siteCode === "be_fr");
	var pageTrack = (digitalData.page.pageInfo.pageTrack || "").toLowerCase();
	var betterTogetherApi = {};
	var buttonEl = null;
	var isGPv2 = false;
	var isNewHybris = false;

	var fromI18n = Granite.I18n.get("From");
	var orI18n = Granite.I18n.get("or");
	var monthly18n = Granite.I18n.get("Monthly Price:");
	var fullI18n = Granite.I18n.get("Full Price:");
	var addI18n = Granite.I18n.get("Add");
	var deleteConfirmI18n = Granite.I18n.get("Are you sure to remove this product?");

	function setProductPrice() {
		var priceInfo = dynamic.detailSharedObj.drawObj.price.priceWrapper.info;
		var totalPrice = priceInfo.totalPrice || "";
		var MonthlyPrice = totalPrice.split(" " + orI18n + " ");
		var priceHtml = "";
		if (MonthlyPrice.length > 1) {
			priceHtml =
				`<div class="better-together__price">
                    <span class="hidden">${monthly18n}</span>
                    <span class="better-together__price-text">${fromI18n}</span>
                    ${MonthlyPrice[0].replace(fromI18n, "")}
                </div>
                <div class="better-together__full-price">
                    <span class="hidden">${fullI18n}</span>
                    <span class="better-together__full-price-text">${orI18n}</span>
                    ${MonthlyPrice[1]}
                </div>`;
		} else {
			priceHtml =
				`<div class="better-together__price">
                    <span class="hidden">${fullI18n}</span>
                    <span class="better-together__price-text"></span>
                    ${totalPrice}
                </div>`;
		}
		$(".better-together .better-together__price-wrap").html(priceHtml);
	}

	function setVoucher() {
		var voucherTotal = $("#voucherTotal");
		var voucherBalance = $("#voucherBalance");
		var voucherCharge = $("#voucherCharge");
		var zeroPrice = currencyComma(0, currency);
		var headline = $(".better-together__headline-text");
		var desciption = $(".better-together__desciption");

		voucherTotal.html(zeroPrice);
		voucherBalance.html(zeroPrice);
		voucherCharge.html(zeroPrice);

		if (isGPv2) {
			var voucherdata = dynamic.detailSharedObj.voucherdata;
			var title = "";
			if (voucherdata.formatted_sales_pitch) {
				title = voucherdata.formatted_sales_pitch;
			} else if (voucherdata.sales_pitch) {
				title = voucherdata.sales_pitch;
			}
			headline.html(title);
			voucherBalance.html(voucherdata.discount_description[0].formatted_value);
			voucherBalance.attr("data-price", voucherdata.discount_description[0].value);
			voucherBalance.attr("data-oriPrice", voucherdata.discount_description[0].value);
		} else {
			var voucherdata = dynamic.detailSharedObj.voucherdataHybris;
			for (var i = 0; i < voucherdata.length; i++) {
				var key = voucherdata[i].key;
				var value = voucherdata[i].value;
				if (value) {
					if (key === "voucherPrice") {
						voucherBalance.html(currencyComma(value, currency));
						voucherBalance.attr("data-price", value);
						voucherBalance.attr("data-oriPrice", value);
					}
					if (key === "mainTitle") {
						headline.html(value);
					}
					if (key === "subTitle") {
						desciption.html(value);
						desciption.show();
					}
				}
			}
		}

		$(".better-together").addClass("better-together__selected");
		$(".better-together__selected-info").show();
	}

	function resetVoucherPrice() {
		//  
		var voucherTotal = $("#voucherTotal");
		var voucherBalance = $("#voucherBalance");
		var voucherCharge = $("#voucherCharge");
		var voucherPrice = voucherBalance.attr("data-oriPrice");
		var selectedNumberEL = $(".better-together__selected-title .number span");
		voucherTotal.attr("data-price", 0);
		voucherBalance.attr("data-price", voucherPrice);
		voucherCharge.attr("data-price", 0);
		voucherTotal.html(currencyComma(0, currency));
		voucherBalance.html(currencyComma(voucherPrice, currency));
		voucherCharge.html(currencyComma(0, currency));
		selectedNumberEL.html(0);

		// cta 
		var ctaEL = $(".better-together .better-together__cta .cta--on");
		var ctaSpanEL = ctaEL.find("span");
		ctaSpanEL.html(addI18n);
		ctaEL.removeClass("cta--on");
	}

	function voucherPopup(id) {
		var voucherBalance = $("#voucherBalance");
		var voucherOriPrice = Number(voucherBalance.attr("data-oriPrice")) || 0;
		var voucherPrice = Number(voucherBalance.attr("data-price")) || 0;
		var msg, popupType;

		if (voucherPrice === 0) {
			popupType = "allVoucher";
			msg = Granite.I18n.get("You redeeemed at your credits!<br>Press 'continue' to proceed.<br/>You cannot change your selection once you press 'continue'.");
			id = "voucher" + id;
		} else if (voucherPrice === voucherOriPrice) {
			popupType = "redeem";
			msg = Granite.I18n.get("You didn't redeem your {0} credit.<br/>it will be gone once you press 'skip'.", currencyComma(voucherPrice, currency));
			id = "skip" + id;
		} else if (voucherPrice > 0) {
			popupType = "voucher";
			msg = Granite.I18n.get("You still have credit to redeem ({0})<br/>Your credit will be gone once you press 'continue'.", currencyComma(voucherPrice, currency));
			id = "voucher" + id;
		}

		confirmPopup(msg, popupType, id);
	}

	function showBetterTogether(data) {
		productListData = data;
		
		if( productListData == null || Object.keys(productListData).length === 0 ){
			//epp service search       
			// hybris  ,        addToCartFlag false  
			setInterval(function() {
				dynamic.DetailAfterEvent.addToCartCta([], true, true);
			}, 1000);
			
			return;
		}
		buildProductGrid(productListData);
		if (dynamic.detailSharedObj.hasVoucher) {
			setVoucher();
		}

		window.sg.components.betterTogether.show(document.querySelector(".better-together"), $(".better-together").siblings().add($(".better-together").parent().siblings()), buttonEl);
		window.sg.components.betterTogether.reInit(); //   show  

		if ($(".scrollbar__contents .better-together__item").not(".is-item-visible").length === 0) {
			$(".better-together__cta-more").hide();
		}
	}

	function moveBridgePage(btnEl) {
		var sharedObj = dynamic.detailSharedObj;
		buttonEl = btnEl;
		setProductPrice();
		isGPv2 = (sharedObj.apiFlag === "GPv2");
		isNewHybris = (sharedObj.apiFlag === "Hybris-new");

		if (isGPv2) {
			betterTogetherApi = dynamic.betterTogetherGPv2;
			showBetterTogether(betterTogetherApi.setFamily(sharedObj.addOnInfoTemp));
		} else if (isNewHybris) {
			betterTogetherApi = dynamic.betterTogetherNewHybris;
			betterTogetherApi.getSearchProductcard(showBetterTogether);
		} else {
			betterTogetherApi = dynamic.betterTogetherHybris;
			betterTogetherApi.getSearchProductcard(showBetterTogether);
			//hybris Check Out 
			$("#primaryInfoCheckOut").remove();
		}

		if (dynamic.detailSharedObj.hasVoucher) {
			resetVoucherPrice();
			$("#primaryInfoCheckOut").attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-cart")
				.attr("an-ca", "content click")
				.attr("an-ac", "feature")
				.attr("an-la", "evoucher:checkout");
			$("#primaryInfoGoCart").attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-cart")
				.attr("an-ca", "content click")
				.attr("an-ac", "feature")
				.attr("an-la", "evoucher:go to cart");

			$(".better-together__back-cta").attr("an-la", "evoucher:back");
			$(".better-together__item-box .better-together__fiche a.cta-text").attr("an-la", "evoucher:product fiche");
		} else {
			$("#primaryInfoCheckOut").attr("an-tr", "pdd10_product bought together-" + pageTrack + "-text-notaddedcart")
				.attr("an-ca", "content click")
				.attr("an-ac", "feature")
				.attr("an-la", "add-on:checkout");
			$("#primaryInfoGoCart").attr("an-tr", "pdd10_product bought together-" + pageTrack + "-text-notaddedcart")
				.attr("an-ca", "content click")
				.attr("an-ac", "feature")
				.attr("an-la", "add-on:go to cart");
		}
		$("#primaryInfoCheckOut, #primaryInfoGoCart").removeAttr("data-modelcode")
			.removeAttr("data-modelname")
			.removeAttr("data-modeldisplay")
			.removeAttr("data-modelprice")
			.removeAttr("data-discountprice")
			.removeAttr("data-pvitype")
			.removeAttr("data-pvisubtype")
			.removeAttr("data-pimsubtype")
			.removeAttr("data-modelrevenue")
			.removeAttr("data-modelqty")
			.removeAttr("data-modelcurrency");
	}

	function arrayContains(array, element) {
		for (var i = 0; i < array.length; i++) {
			if (array[i] === element) {
				return true;
			}
		}
		return false;
	}

	function addOnsImgDomain(imgUrl, preset, iconFl) {
		var newUrl = "";
		var useScene7domain = $("#scene7domain").val();
		if (imgUrl) {
			if (imgUrl.indexOf("?") > -1) { //    add-ons - hybris
				preset = "";
			} else {
				preset = "?" + preset;
			}
			if (imgUrl.indexOf("https:") > -1 || imgUrl.indexOf("http:") > -1 || imgUrl.indexOf("//stg-images.samsung.com/") > -1 || imgUrl.indexOf("//images.samsung.com/") > -1 || imgUrl.indexOf("image.samsung.com/") > -1) {
				newUrl = imgUrl;
			} else {
				if (iconFl) useScene7domain = useScene7domain.replace("/image/", "/content/");
				newUrl = useScene7domain + imgUrl;
			}
			newUrl += preset;
		}

		return newUrl;
	}

	/**
	 *   
	 */
	function resetProduct() {
		selectIndexList = new Array();
		selectProductList = new Array();
	}

	/**
	 * viewOptionObj :    Product   
	 * optionChip      sku index  
	 * selectOptionMoIdx :    moidx  
	 * otherSelectedOptionMoIdxList :         
	 * isColorType :   color   
	 * optionTypeList :   Product   optionTypeList 
	 */
	var getSelectedModelIdx = function (viewOptionObj, selectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, optionTypeList) {
		var modelIdx = 0;
		var modelIdxList = selectOptionMoIdx.split(',');
		var firstIdx = modelIdxList[0];
		var memoryIdx = optionTypeList.indexOf("MEMORY");

		if (!isGPv2 && !isNewHybris && isColorType && memoryIdx > 0) {
			// [global, hybrisIntg]   color ,     memory     
			var memoryOptionList = viewOptionObj["MEMORY"].optionList;
			var selectedModelIdx = 0;
			var highestOption = 0;
			for (var moi in memoryOptionList) {
				var temp_mi = memoryOptionList[moi].modelIdx.split(',');
				for (var tmi in temp_mi) {
					//   modelIdx   model idx     
					if (arrayContains(modelIdxList, temp_mi[tmi])) {
						var this_memory_num = memoryOptionList[moi].optionCode.replace("TB", "000").replace(/[^0-9]/g, "");
						if (highestOption < this_memory_num) {
							highestOption = this_memory_num;
							selectedModelIdx = temp_mi[tmi];
						}
						break;
					}
				}
			}
			modelIdx = selectedModelIdx;
		} else {
			var tempMappingModelIdx = [];
			for (var omi in otherSelectedOptionMoIdxList) {
				var otherMoIdx = otherSelectedOptionMoIdxList[omi];
				if (otherMoIdx) {
					var otherMoIdxArr = otherMoIdx.split(',');
					tempMappingModelIdx = [];
					for (var mli in modelIdxList) {
						if (otherMoIdxArr.indexOf(String(modelIdxList[mli])) > -1) {
							tempMappingModelIdx.push(modelIdxList[mli]);
						}
					}
					if (tempMappingModelIdx.length > 0) {
						modelIdxList = tempMappingModelIdx;
					}
				}
			}
			if (modelIdxList.length > 0) {
				modelIdx = modelIdxList[0];
			} else {
				modelIdx = firstIdx;
			}
		}
		return modelIdx;
	};

	var productCardFmyOptionBuild = function (product) {
		var optionHtml = "";
		var frontModel = product.modelList[product.frontModelIdx];

		if (product.viewOptionObj && Object.keys(product.viewOptionObj).length > 0) {
			//    model idx : disable    ( idx  disabled )
			var parentOptionModelIdx = "";
			var viewOptionIdx = 0;
			var curViewOptionObj = product.viewOptionObj;
			var curOptionTypeList = product.optionTypeList;

			for (var type in product.viewOptionObj) {
				var optionDataType = type.toLowerCase().replace(/ /g, "-");
				var optionObj = product.viewOptionObj[type].optionList;
				var isSelected = false;
				var currentOption = {};
				var disabledClass = "";
				var selectorWrapperStyle = "";
				var tagging = (isVoucher ? "evoucher" : "add-on");

				if (product.viewOptionObj[type].styleAttr) {
					selectorWrapperStyle = product.viewOptionObj[type].styleAttr;
				}

				if (type === "COLOR") {
					var curSelecteModelIdx = "";
					var colorOptionHtml = "";
					for (var option in optionObj) {
						/* ()  flag  */
						currentOption = optionObj[option];
						isSelected = false;
						var modelIdxList = currentOption.modelIdx.split(',');

						if (currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))) {
							isSelected = true;
							curSelecteModelIdx = currentOption.modelIdx;
							disabledClass = "";
						} else {
							disabledClass = " is-disabled";

							if (viewOptionIdx === 0) {
								disabledClass = "";
							} else {
								var parentModelIdxList = parentOptionModelIdx.split(',');
								for (var mli in modelIdxList) {
									//    model idx   model idx    
									if (arrayContains(parentModelIdxList, modelIdxList[mli])) {
										disabledClass = "";
										break;
									}
								}
							}
						}

						//   model   (  )
						var modelCodeAttrForTagging = "";
						var modelNameAttrForTagging = "";
						var modelIdx;
						if (disabledClass === "") {
							var curSelectOptionMoIdx = currentOption.modelIdx;
							var otherSelectedOptionMoIdxList = [];
							var isColorType = true;

							for (var ooi in curViewOptionObj) {
								if (ooi !== type) {
									var tmp_optionList = curViewOptionObj[ooi].optionList;
									for (var toi in tmp_optionList) {
										var tmp_option = tmp_optionList[toi];
										var tmp_optionMoIdx = tmp_option.modelIdx;
										var tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');

										//   option 
										if (tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx)) > -1) {
											otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
										}
									}

								}
							}

							modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
							if (product.modelList.length > modelIdx && product.modelList[modelIdx]) {
								modelCodeAttrForTagging = product.modelList[modelIdx].modelCode;
								modelNameAttrForTagging = product.modelList[modelIdx].modelName;
							}
						}
						var chipId = 'pdd10-' + optionDataType + '-' + option + '-' + frontModel.idx;
						var chipName = 'pdd10-' + optionDataType + '-' + frontModel.idx;

						colorOptionHtml +=
							`<span class="option-selector__swiper-slide${disabledClass}">
								<span class="option-selector__color">
									<input type="radio" id="${chipId}" name="${chipName}" data-modeli="${modelIdx}"${(isSelected?' checked':'')}${(disabledClass === ""?"":" disabled")}
										an-tr="pdd10_product bought together-${pageTrack}-select-option" an-ca="option click" an-ac="bridge" an-la="${tagging}:${type.toLowerCase()}:${currentOption.optionName.toLowerCase()}"
										data-modelcode="${modelCodeAttrForTagging}" data-modelname="${modelNameAttrForTagging}">
									<label for="${chipId}">
										<span class="option-selector__color-code" style="background-color: ${currentOption.optionCode}">${currentOption.optionLocalName}</span>
									</label>
								</span>
							</span>`;
					}
					parentOptionModelIdx = curSelecteModelIdx;
					
					//.color-name-text   
					var colorNameText = '';
					for (var option in optionObj) {
						currentOption = optionObj[option];
						var modelIdxList = currentOption.modelIdx.split(',');
						if (currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))) {
							colorNameText = currentOption.optionLocalName;
						}
					}
					
					optionHtml +=
						`<div class="option-selector__color-name">${Granite.I18n.get("Color")} : <span class="color-name-text">${colorNameText}</span></div>
						<div class="option-selector_" data-mobile-view="5">
							<div class="option-selector__swiper">
								<div class="option-selector__swiper-container" aria-live="polite">
									<div class="option-selector__swiper-wrapper" style="${selectorWrapperStyle}">
										${colorOptionHtml}
									</div>
								</div>
								<button type="button" class="option-selector__button-prev" aria-label="Previous" role="button" aria-disabled="true" an-tr="pdd10_product bought together-${pageTrack}-image-arrow" an-ca="indication" an-ac="carousel" an-la="carousel:arrow:left">
									<span class="hidden">${Granite.I18n.get("Previous")}</span>
									<svg class="icon" focusable="fntlib-common/resources/images/svg-sprite.svg#previous-regular"></use>
									</svg>
								</button>
								<button type="button" class="option-selector__button-next" aria-label="Next" role="button" aria-disabled="true" an-tr="pdd10_product bought together-${pageTrack}-image-arrow" an-ca="indication" an-ac="carousel" an-la="carousel:arrow:right">
									<span class="hidden">${Granite.I18n.get("Next")}</span>
									<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-regular"></use>
									</svg>
								</button>
							</div>
						</div>`;
				} else if (type === "MOBILE MEMORY" || type === "TV SIZE" || type === "HOME APPLIANCE SIZE") {
					// IM: Color | Capacity (Memory) | Carrier, VD: Size, DA: Material | Size
					var curSelecteModelIdx = '';
					var memoryOptionHtml = "";
					for (var oi = 0; oi < optionObj.length; oi++) {
						/* ()  flag  */
						currentOption = optionObj[oi];
						isSelected = false;
						var modelIdxList = currentOption.modelIdx.split(',');

						if (currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))) {
							isSelected = true;
							curSelecteModelIdx = currentOption.modelIdx;
							disabledClass = '';
						} else {
							disabledClass = " is-disabled";
							if (viewOptionIdx === 0) {
								disabledClass = '';
							} else {
								var parentModelIdxList = parentOptionModelIdx.split(',');

								for (var mli in modelIdxList) {
									//    model idx   model idx    
									if (arrayContains(parentModelIdxList, modelIdxList[mli])) {
										disabledClass = '';
										break;
									}
								}
							}
						}

						//   model   (  )
						var modelCodeAttrForTagging = "";
						var modelNameAttrForTagging = "";
						var modelIdx;

						if (disabledClass === "") {
							var curSelectOptionMoIdx = currentOption.modelIdx;
							var otherSelectedOptionMoIdxList = [];
							var isColorType = false;

							for (var ooi in curViewOptionObj) {
								if (ooi !== type) {
									var tmp_optionList = curViewOptionObj[ooi].optionList;
									for (var toi in tmp_optionList) {
										var tmp_option = tmp_optionList[toi];
										var tmp_optionMoIdx = tmp_option.modelIdx;
										var tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');

										//   option 
										if (tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx)) > -1) {
											otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
										}
									}

								}
							}

							modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
							if (product.modelList.length > modelIdx && product.modelList[modelIdx]) {
								modelCodeAttrForTagging = product.modelList[modelIdx].modelCode;
								modelNameAttrForTagging = product.modelList[modelIdx].modelName;
							}
						}
						var chipId = 'pdd10-' + optionDataType + '-' + oi + '-' + frontModel.idx;
						var chipName = 'pdd10-' + optionDataType + '-' + frontModel.idx;

						memoryOptionHtml +=
							`<span class="option-selector__swiper-slide${disabledClass}">
								<span class="option-selector__size">
									<input type="radio" id="${chipId}" name="${chipName}" data-modeli="${modelIdx}"${(isSelected?' checked':'')}${(disabledClass === ""?"":" disabled")}
										an-tr="pdd10_product bought together-${pageTrack}-select-option" an-ca="option click" an-ac="bridge" an-la="${tagging}:${type.toLowerCase()}:${currentOption.optionName.toLowerCase()}"
										data-modelcode="${modelCodeAttrForTagging}" data-modelname="${modelNameAttrForTagging}">
									<label class="option-selector__size-label" for="${chipId}">
										<span class="option-selector__size-label-text">${currentOption.optionLocalName}</span>
									</label>
								</span>
							</span>`;
					}
					parentOptionModelIdx = curSelecteModelIdx;
					optionHtml +=
						`<div class="option-selector__wrap option-selector__wrap--capacity" data-desktop-view="3" data-mobile-view="3">
							<div class="option-selector__swiper">
								<div class="option-selector__swiper-container" aria-live="polite">
									<div class="option-selector__swiper-wrapper" style="${selectorWrapperStyle}">
										${memoryOptionHtml}
										<div class="option-selector__floating-bar" style="display: none;"></div>
									</div>
								</div>
								<button type="button" class="option-selector__button-prev" aria-label="Previous" role="button" aria-disabled="true" an-tr="pdd10_product bought together-${pageTrack}-image-arrow" an-ca="indication" an-ac="carousel" an-la="carousel:arrow:left">
									<span class="hidden">${Granite.I18n.get("Previous")}</span>
									<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#previous-regular"></use>
									</svg>
								</button>
								<button type="button" class="option-selector__button-next" aria-label="Next" role="button" aria-disabled="true" an-tr="pdd10_product bought together-${pageTrack}-image-arrow" an-ca="indication" an-ac="carousel" an-la="carousel:arrow:right">
									<span class="hidden">${Granite.I18n.get("Next")}</span>
									<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-regular"></use>
									</svg>
								</button>
							</div>
						</div>`;
				}
				viewOptionIdx++;
			}
		}
		return optionHtml;
	};

	/**
	 * Product Data  Product Card  
	 * 
	 * @param product
	 */
	function buildProductCard(product) {
		var productCardTemplate = "";
		var frontModel = product.modelList[product.frontModelIdx];
		var isStock = frontModel.isStock;
		var princeInfo = betterTogetherApi.setPriceInfo(frontModel);
		var promotionPrice = princeInfo.promotionPrice;
		var savePriceTemp = princeInfo.savePriceTemp;
		var saveText = princeInfo.saveText;
		var productPriceDisplay = princeInfo.productPriceDisplay;
		var promotionPriceDisplay = princeInfo.promotionPriceDisplay;
		var tagging = (isVoucher ? "evoucher" : "add-on");
		var imageHtml = ""

		if (frontModel.thumbUrl) {
			imageHtml =
				`<img class="image__preview lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(frontModel.thumbUrl, "$LazyLoad_Home_PNG$")}" data-mobile-src="${addOnsImgDomain(frontModel.thumbUrl, "$LazyLoad_Home_PNG$")}" alt="${frontModel.thumbUrlAlt}">
				<img class="image__main lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(frontModel.thumbUrl, "$240_240_PNG$")}" data-mobile-src="${addOnsImgDomain(frontModel.thumbUrl, "$480_480_PNG$")}" alt="${frontModel.thumbUrlAlt}">`;
		}

		productCardTemplate +=
			`<div class="better-together__item unbind-option" data-index="${frontModel.idx}" data-price="${promotionPrice}">
				<div class="better-together__product-name"><span class="better-together__product-name-inner">${frontModel.displayName}</span></div>
				<div class="better-together__image-wrap">
					<div class="better-together__image">
						<div class="image">
							${imageHtml}
						</div>
					</div>
				</div>`;
		//option  better-together__info   height 
		productCardTemplate +=
			`<div class="better-together__info">
				<div class="option-selector option-selector__color-text">
					${productCardFmyOptionBuild(product)}
				</div>
			</div>`;
		//Product Fiche : fiche  better-together__fich   height 
		productCardTemplate +=
			`<div class="better-together__fiche">
				${frontModel.ficheFileUrl != null ? 
				`<a href="${frontModel.ficheFileUrl}" target="_blank" title="${Granite.I18n.get("Open in a new window")}" class="cta-text" an-tr="pdd10_product bought together-${pageTrack}-text-product fiche" an-ca="option click" an-ac="bridge" an-la="${tagging}:product fiche">${Granite.I18n.get("Product Fiche")}</a>`:''}
				${frontModel.energyLabelGrade != null ? 
				`<a class="badge ${frontModel.energyLabelClass2}" href="${frontModel.energyFileUrl}" target="_blank" title="${frontModel.energyLabelGrade}">
					<span class="badge__grade--with-text ${frontModel.energyLabelClass1}">
						<span class="hidden">${frontModel.energyLabelGrade}</span>
					</span>
				</a>`:''}
			</div>`;
		if (siteCode !== "pl" || isStock) {
			productCardTemplate +=
				`<div class="better-together__price">${promotionPriceDisplay}</div>
				<div class="better-together__price-sub">
				${savePriceTemp > 0 ? 
					`<span class="better-together__price-original">
						<span class="hidden">${Granite.I18n.get("Original Price")}: </span>
						${(isSEBN || siteCode === "de") ? `${Granite.I18n.get("From")} `:""}<del>${productPriceDisplay}</del>
					</span>
					${!isSEBN ? 
						`<span class="better-together__price-save">${Granite.I18n.get("Save {0}", saveText)}</span>`
						:''}`
					:''}
				</div>`;
		}

		var ctaTitle;
		var isSelected = selectIndexList.includes(frontModel.idx);
		var OOS = Granite.I18n.get("Out Of Stock");
		var ITEM_ADDED = Granite.I18n.get("Item added");
		var ADD_TO_CART = Granite.I18n.get("Add to cart");
		var ADD = Granite.I18n.get("Add");

		if (!isStock) {
			ctaTitle = OOS;
			//ctaTitle = Granite.I18n.get("Get stock Alert");//  js-cta-stock 
			//an-tr="pdd10_product bought together-{pageTrack}-button-stock" an-ca="buy cta" an-ac="stock alert" an-la="add-on/evoucher:get stock alert"
		} else if (isSelected) {
			ctaTitle = ITEM_ADDED;
		} else {
			if (isVoucher) {
				ctaTitle = ADD;
			} else {
				ctaTitle = ADD_TO_CART;
			}
		}

		productCardTemplate +=
			`<div class="better-together__cta">
					<a class="cta cta--contained cta--black${!isStock || (isSelected && !isVoucher)? " cta--disabled":""}${isSelected && isVoucher? " cta--on":""}" href="javascript:void(0)" title="${ctaTitle}" 
						an-tr="pdd10_product bought together-${pageTrack}-${isVoucher?"button":"popup"}-add" an-ca="option click" an-ac="bridge" an-la="${tagging}:add item" 
						data-modelcode="${frontModel.modelCode}" data-modelname="${frontModel.modelName}">
						${isVoucher ? `<span data-global-text='{"selected" : "${ITEM_ADDED}", "unSelected" : "${ADD}"}'>${ctaTitle}</span>` : ctaTitle}
					</a>
				</div>
			</div>`;

		return productCardTemplate;
	}

	/**
	 * Product   
	 * 
	 * @param product
	 * @param frontModelIdx Product  model   model index
	 * @return product
	 */
	function getProductInfo(product, frontModelIdx) {
		var tempProduct = product;
		if (tempProduct.modelList[frontModelIdx].displayName == null) {
			tempProduct.modelList[frontModelIdx].displayName = "";
		}

		/*
		 * viewOptionObj :    
		 * optionTypeList :      (  index     )
		 */

		var tmpOptionListInModel = {};
		for (var mi in tempProduct.modelList) {
			var tmpModel = tempProduct.modelList[mi];
			var tmpFmyChipList = tmpModel.fmyChipList;

			for (var fci in tmpFmyChipList) {
				//fmyChipCode "  
				var thisOptionKey = tmpFmyChipList[fci].fmyChipType + '+' +
					tmpFmyChipList[fci].fmyChipCode.replace("\"", "").replace("&quot;", "") + '+' +
					tmpFmyChipList[fci].fmyChipLocalName.replace("\"", "").replace("&quot;", "");

				if (tmpOptionListInModel[thisOptionKey] == undefined) {
					tmpOptionListInModel[thisOptionKey] = mi;
				} else {
					tmpOptionListInModel[thisOptionKey] += "," + mi;
				}
			}
		}

		var optionTypeList = [];
		var viewOptionObj = {};
		if (tempProduct.chipOptions) {
			for (var a = 0; a < tempProduct.chipOptions.length; a++) {
				var optionData = tempProduct.chipOptions[a];
				var optionTypeTmp = optionData.fmyChipType;

				var optionListInType = optionData.optionList;
				for (var opl in optionListInType) {
					var thisOptionKey = optionData.fmyChipType + '+' +
						optionListInType[opl].optionCode.replace("\"", "").replace("&quot;", "") + '+' +
						optionListInType[opl].optionLocalName.replace("\"", "").replace("&quot;", "");
					if (tmpOptionListInModel[thisOptionKey] != undefined) {
						optionListInType[opl].modelIdx = tmpOptionListInModel[thisOptionKey];
					}

				}
				viewOptionObj[optionTypeTmp] = {};
				viewOptionObj[optionTypeTmp]["optionList"] = optionListInType;

				optionTypeList.push(optionTypeTmp);
			}
		}
		tempProduct.viewOptionObj = viewOptionObj;
		tempProduct.optionTypeList = optionTypeList;

		tempProduct.frontModelIdx = frontModelIdx;
		return tempProduct;
	}

	function buildProductGrid(productList) {
		var result = "";
		resetProduct();
		isVoucher = window.sg.components.dynamic.detailSharedObj.hasVoucher;

		if (productList != null) {
			// productGridTemplate
			var productGridTemplate = "";
			for (var pl = 0; pl < productList.length; pl++) {
				var tempProduct = productList[pl];
				if (tempProduct.modelList != null && tempProduct.modelList.length > 0) {
					var frontModelIdx = 0;
					var selectedIndex = null; // selected Y      

					/* selected Y  */
					for (var cnt = 0; cnt < tempProduct.modelList.length; cnt++) {
						var tempModel = tempProduct.modelList[cnt];
						var enabledFlag = tempModel.isStock;

						if (tempModel.selected && tempModel.selected === "Y") {
							frontModelIdx = cnt;
							if (enabledFlag) {
								selectedIndex = cnt;
							}
						}
					}
					if (selectedIndex == null) {
						for (var cnt = 0; cnt < tempProduct.modelList.length; cnt++) {
							var tempModel = tempProduct.modelList[cnt];
							var isStock = tempModel.isStock;
							if (isStock) {
								selectedIndex = cnt;
								break;
							}
						}
					}
					if (selectedIndex == null) {
						selectedIndex = frontModelIdx;
					}

					tempProduct = getProductInfo(tempProduct, selectedIndex);
					productGridTemplate += buildProductCard(tempProduct);
				}
			}
			result = productGridTemplate;
			result += `<div class="better-together__cta-more">
				<a href="javascript:void(0);" class="cta" an-tr="pdd10_product bought together-${pageTrack}-image-view more" an-ca="indication" an-ac="view more" an-la="view more">
					<svg class="icon next" focusable="false">
						<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-bold"></use>
					</svg>
					<span class="cta-text">${Granite.I18n.get("View more")}</span>
					<svg class="icon down" focusable="false">
						<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#open-down-bold"></use>
					</svg>
				</a>
			</div>`;
		}

		$(".better-together .scrollbar__contents").html(result);

		productCardListener();
	}

	function productCardListener() {
		/* (Color, Memory)  Event :: S */
		$(".better-together").off("click", ".option-selector__color input, .option-selector__size input");
		$(".better-together").on("click", ".option-selector__color input, .option-selector__size input", function () {
			var  selectIndex = selectCard.attr("data-index") || ""; //familyNum - modelNum
			var productIdx = selectIndex.split('-')[0]; // familyNum
			var optionIdx = $(this).data("modeli"); // option Num

			setTimeout(function () {
				if (optionIdx != null) {
					productListData[productIdx].frontModelIdx = optionIdx;
					var productInfo = getProductInfo(productListData[productIdx], optionIdx);
					var targetContentEl = $(".better-together__item.unbind-option").eq(productIdx); // card index == family index
					var index = $(".better-together__item.unbind-option").index(targetContentEl);

					targetContentEl.find(".option-selector__swiper-wrapper").each(function (idx) {
						var tmpType = productListData[productIdx].optionTypeList[idx];
						var styleAttr = $(this).attr("style");
						productListData[productIdx].viewOptionObj[tmpType].styleAttr = styleAttr;
					});

					targetContentEl.replaceWith(buildProductCard(productInfo));

					// product card      
					targetContentEl = $(document.querySelectorAll(".better-together__item.unbind-option")[index]);
					targetContentEl.addClass("is-item-visible");
					window.sg.components.betterTogether.reInitCard(targetContentEl[0]);
					productCardListener();
				}
			}, 300);
		});

		$(".better-together").off("click", ".better-together__cta .cta:not(.cta--disabled)");
		$(".better-together").on("click", ".better-together__cta .cta:not(.cta--disabled)", function () {
			var _this = $(this);
			var addedItem = Granite.I18n.get("Item added");
			var index = _this.closest(".better-together__item").attr("data-index");
			var productIndex = index.split('-');
			var selectModel = productListData[productIndex[0]].modelList[productIndex[1]];
			var selectProductCode = "";

			if (isGPv2) {
				selectProductCode = selectModel.shopSKU;
			} else {
				selectProductCode = selectModel.modelCode;
			}

			if (isVoucher) {
				var addedIndex = selectIndexList.indexOf(index);
				var price = parseFloat(_this.closest(".better-together__item").attr("data-price"));

				if (addedIndex > -1) {
					setVoucherPrice(price, false);
					selectIndexList.splice(addedIndex, 1);
					selectProductList.splice(addedIndex, 1);
				} else {
					setVoucherPrice(price, true);
					selectIndexList.push(index);
					selectProductList.push(selectProductCode);
				}
			} else {
				_this.text(addedItem);
				_this.addClass("cta--disabled");
				selectIndexList.push(index);
				selectProductList.push(selectProductCode);

				var msg = Granite.I18n.get("Product has been successfully added to cart");
				var PopupType = "addToCart";
				if( siteCode !== "pl" ){
					confirmPopup(msg, PopupType);
				}
			}

			setCtaTagging();
		});
	}

	function setCtaTagging() {
		var cartEl = $("#primaryInfoGoCart");
		var checkEl = $("#primaryInfoCheckOut");
		var ctaEl = $("#primaryInfoGoCart, #primaryInfoCheckOut");

		if (selectIndexList.length > 0) {
			var modelCode = "";
			var modelName = "";
			var displayName = "";
			var modelPrice = "";
			var discountprice = "";
			var pviTypeName = "";
			var pviSubtypeName = "";
			var categorySubTypeEngName = "";
			var modelrevenue = "";
			var modelqty = "";

			for (var i = 0; i < selectIndexList.length; i++) {
				var selectIndex = selectIndexList[i]; //familyNum - modelNum
				var familyIdx = selectIndex.split('-')[0];
				var modeIdx = selectIndex.split('-')[1];
				var model = productListData[familyIdx].modelList[modeIdx];
				var princeInfo = betterTogetherApi.setPriceInfo(model);
				var price = princeInfo.productPrice;
				var qty = 1;
				var comma = '';
				var colon = '';
				if (i > 0) {
					comma = ',';
					colon = ';';
				}

				modelCode += comma + model.modelCode;
				modelName += comma + model.modelName;
				displayName += colon + model.displayName;
				modelPrice += comma + price;
				discountprice += comma + princeInfo.promotionPrice;
				pviTypeName += comma + model.pviTypeName;
				pviSubtypeName += comma + model.pviSubtypeName;
				categorySubTypeEngName += comma + model.categorySubTypeEngName;
				modelrevenue += comma + price;
				modelqty += comma + qty;
			}
			pviTypeName = pviTypeName.toLowerCase();
			pviSubtypeName = pviSubtypeName.toLowerCase();
			categorySubTypeEngName = categorySubTypeEngName.toLowerCase();

			if (!isVoucher) {
				cartEl.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-text-addedcart")
					.attr("an-ca", "ecommerce")
					.attr("an-ac", "addToCart")
					.attr("an-la", "add-on:go to cart");

				checkEl.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-text-button")
					.attr("an-ca", "ecommerce")
					.attr("an-ac", "addToCart")
					.attr("an-la", "add-on:checkout");
			} else {
				cartEl.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-text-button")
					.attr("an-ca", "ecommerce")
					.attr("an-ac", "addToCart")
					.attr("an-la", "evoucher:go to cart");

				checkEl.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-text-button")
					.attr("an-ca", "ecommerce")
					.attr("an-ac", "addToCart")
					.attr("an-la", "evoucher:checkout");
			}
			ctaEl.attr("data-modelcode", modelCode)
				.attr("data-modelname", modelName)
				.attr("data-modeldisplay", displayName)
				.attr("data-modelprice", modelPrice)
				.attr("data-discountprice", discountprice)
				.attr("data-pvitype", pviTypeName)
				.attr("data-pvisubtype", pviSubtypeName)
				.attr("data-pimsubtype", categorySubTypeEngName)
				.attr("data-modelrevenue", modelrevenue)
				.attr("data-modelqty", modelqty)
				.attr("data-modelcurrency", currency);
		} else {
			if (!isVoucher) {
				cartEl.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-text-notaddedcart")
					.attr("an-ca", "content click")
					.attr("an-ac", "feature")
					.attr("an-la", "add-on:go to cart");

				checkEl.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-text-notaddedcart")
					.attr("an-ca", "content click")
					.attr("an-ac", "feature")
					.attr("an-la", "add-on:checkout");
			} else {
				cartEl.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-cart")
					.attr("an-ca", "content click")
					.attr("an-ac", "feature")
					.attr("an-la", "evoucher:go to cart");

				checkEl.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-cart")
					.attr("an-ca", "content click")
					.attr("an-ac", "feature")
					.attr("an-la", "evoucher:checkout");
			}
			ctaEl.removeAttr("data-modelcode")
				.removeAttr("data-modelname")
				.removeAttr("data-modeldisplay")
				.removeAttr("data-modelprice")
				.removeAttr("data-discountprice")
				.removeAttr("data-pvitype")
				.removeAttr("data-pvisubtype")
				.removeAttr("data-pimsubtype")
				.removeAttr("data-modelrevenue")
				.removeAttr("data-modelqty")
				.removeAttr("data-modelcurrency");
		}
	}

	function setVoucherPrice(price, addFlag) {
		var voucherTotal = $("#voucherTotal");
		var voucherBalance = $("#voucherBalance");
		var voucherCharge = $("#voucherCharge");
		var totalPrice = parseFloat(voucherTotal.attr("data-price") || 0);
		var voucherOriPrice = parseFloat(voucherBalance.attr("data-oriprice") || 0);
		var voucherPrice;
		var chargePrice;

		if (addFlag) {
			totalPrice += price;
		} else {
			totalPrice = Number((parseFloat(totalPrice) - parseFloat(price)).toFixed(2));
		}
		voucherPrice = Number((parseFloat(voucherOriPrice) - parseFloat(totalPrice)).toFixed(2));

		if (voucherPrice < 0) {
			chargePrice = -voucherPrice;
			voucherPrice = 0;
		} else {
			chargePrice = 0;
		}

		voucherTotal.attr("data-price", totalPrice);
		voucherBalance.attr("data-price", voucherPrice);
		voucherCharge.attr("data-price", chargePrice);
		voucherTotal.html(currencyComma(totalPrice, currency));
		voucherBalance.html(currencyComma(voucherPrice, currency));
		voucherCharge.html(currencyComma(chargePrice, currency));
	}

	$(document).on("click", ".better-together__selected .better-together__selected-close", function () {
		if ($(".better-together .better-together__cta .cta--on").length > 0) {
			confirmPopup(deleteConfirmI18n, "voucherDelete", "voucherClearAll");
		}
	});

	$(document).on("click", "#voucherClearAll", function () {
		resetProduct();
		resetVoucherPrice();
	});

	$(document).on("click", "#primaryInfoGoCart", function () {
		if (dynamic.detailSharedObj.hasVoucher) {
			voucherPopup("GoCart");
		} else {
			dynamic.DetailAfterEvent.addToCartCta(selectProductList, true, true);
		}
	});

	$(document).on("click", "#primaryInfoCheckOut", function () {
		if (dynamic.detailSharedObj.hasVoucher) {
			voucherPopup("CheckOut");
		} else {
			dynamic.DetailAfterEvent.checkOutCta(selectProductList, true, true);
		}
	});

	$(document).on("click", "#voucherGoCart", function () {
		dynamic.DetailAfterEvent.addToCartCta(selectProductList, true, true);
	});

	$(document).on("click", "#voucherCheckOut", function () {
		dynamic.DetailAfterEvent.checkOutCta(selectProductList, true, true);
	});

	$(document).on("click", "#skipGoCart", function () {
		dynamic.DetailAfterEvent.addToCartCta([], true, true);
	});

	$(document).on("click", "#skipCheckOut", function () {
		dynamic.DetailAfterEvent.checkOutCta([], true, true);
	});

	$(document).on("click", ".better-together__cta-more", function () {
		window.sg.components.betterTogether.more();
		if ($(".scrollbar__contents .better-together__item").not(".is-item-visible").length === 0) {
			$(this).hide();
		}
	});

	dynamic.bridgePage = (function () {
		return {
			moveBridgePage: moveBridgePage
		}
	})();

})(window, window.jQuery);
((window, $) => {
	"use strict";

	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	let sharedObj = dynamic.detailSharedObj;
	const siteCode = $("#siteCode").val();
	const currency = $("#priceCurrency").val();
	const pageTrack = (digitalData.page.pageInfo.pageTrack || "").toLowerCase();
	const isGPv2 = $("#shopIntegrationFlag").val() === "GPv2" && siteCode === 'in';
	const isOldHybris = $("#shopIntegrationFlag").val() === "Hybris" || $("#shopIntegrationFlag").val() === "Hybris-intg";
	const isNewHybris = $("#shopIntegrationFlag").val() === "Hybris-new";
	const categorySubTypeCode = $("#categorySubTypeCode").val();
	const categoryTypeCode = $("#categoryTypeCode").val();
	const isVDSTEPBUYING = categorySubTypeCode.length > 2 && categorySubTypeCode.substring(0,2) === "04" || categorySubTypeCode.length > 4 && categorySubTypeCode.substring(0,4) === "0701";
	let lowestWasPriceCountry = ( siteCode === 'pl' || siteCode === 'si' || siteCode === 'gr' || siteCode === 'fi' || siteCode === 'it' || siteCode === 'se' || siteCode === 'no' || siteCode === 'dk' || siteCode === 'fr') ? true : false;
	let seletecBundlePopupData = {};
	
	let betterTogetherApi = {};
	let productListData = new Array();
	let selectIndexList = new Array();
	let selectProductList = new Array();
	let selectProductImgList = new Array();
	let isVoucher = false;
	let categoryIdx = "";
	let addOnPrice = 0;
	let originPrice = 0;
	let savePrice = 0;
	let mainPrice;
	let mainInitPrice;
	let productListLength = 0;
	let displayName = "";
	let productBundleListData = "";
	let selectedCount = 0;
	let monthlyCheckedFlag = false;
	let closeButtonThis = "";
	let categoryCardIdx = 0;
	
	// gift
	let selectedGift = '';
	
	const viewMoreI18n = Granite.I18n.get("View more");
	let fromI18n = Granite.I18n.get("From");
	const orI18n = Granite.I18n.get("or");
	const monthly18n = Granite.I18n.get("Monthly Price") + ":";
	const fullI18n = Granite.I18n.get("Full Price:");
	const addI18n = Granite.I18n.get("Add");
	const deleteConfirmI18n = Granite.I18n.get("Are you sure to remove this product?");
	const checkoutI18n = Granite.I18n.get("Checkout");
	let nextI18n = Granite.I18n.get("Next");
	const totalI18n = Granite.I18n.get("Total");
	const vatInclusiveI18n = Granite.I18n.get("VAT Inclusive");
	const addedI18n = Granite.I18n.get("Added");
	const outOfStockI18n = Granite.I18n.get("Out Of Stock");

	const isCountryUseAddOnContinueI18n = (siteCode == 'fr');

	// COMP6FE-1599 [EPP] SEPOL MSRP Price  :  
	const eppPl = $('#isEppPage').val() === 'true' && siteCode === "pl" ? true : false;
	// epp omnipricing 
	if ( $('#isEppPage').val() === 'true' ){
		if ( eppOmniPricingUseYn === "Y" ){
			lowestWasPriceCountry = true;
		} else {
			lowestWasPriceCountry = false;
		}
	}

	// CRHQ-9159 [B2C] [FR] Add On Page   
	if (siteCode === 'fr'){
		fromI18n = '';
	}


	/**
	*      
	* 
	* useTncOnAddOn : AddOn  Tnc 
	* useVATInclusiveArea : VAT  
	* useStaticSubTitle : AddOn SubTitle  
	* useStaticTitle : AddOn Title  
	* staticTitle : Title  
	* staticSubTitle : SubTitle  
	* useAddOnNextI18n : Next  AddOn    
	*/
	const localConfig = {
		it : {
			useTncOnAddOn : false
		},
		es : {
			useVATInclusiveArea : false
		},
		ca : {
			useVATInclusiveArea : false
		},
		ca_fr : {
			useVATInclusiveArea : false
		},
		id : {
			useAddOnNextI18n : true
		},
		nl : {
			useStaticTitle : isVDSTEPBUYING && categoryTypeCode == '04010000',
			staticTitle : Granite.I18n.get("Choose your TV set-up"),
			useStaticSubTitle : isVDSTEPBUYING && categoryTypeCode == '04010000',
			staticSubTitle : Granite.I18n.get('addon subtitle')
		},
		be : {
			useStaticTitle : isVDSTEPBUYING && categoryTypeCode == '04010000',
			staticTitle : Granite.I18n.get("Choose your TV set-up"),
			useStaticSubTitle : isVDSTEPBUYING && categoryTypeCode == '04010000',
			staticSubTitle : Granite.I18n.get('addon subtitle')
		},
		be_fr : {
			useStaticTitle : isVDSTEPBUYING && categoryTypeCode == '04010000',
			staticTitle : Granite.I18n.get("Choose your TV set-up"),
			useStaticSubTitle : isVDSTEPBUYING && categoryTypeCode == '04010000',
			staticSubTitle : Granite.I18n.get('addon subtitle')
		},
		default : { // default  true    
			useVATInclusiveArea : true
		}
	}

	const localConfigurator = ((siteCode, config)=>{
		
		let site_cfg = config[siteCode];
		let default_cfg = config["default"];

		/**
		 * option key       
		 *   false 
		 */
		function getConfigProperty(optionKey){

			if(site_cfg && typeof site_cfg[optionKey] !== "undefined"){
				return site_cfg[optionKey];
			}else{
				if(default_cfg && typeof default_cfg[optionKey] !== "undefined"){
					return default_cfg[optionKey]
				}else{
					return false;
				}
			}
		}

		return {
			get : getConfigProperty
		}

	})(siteCode, localConfig);

	if(localConfigurator.get("useAddOnNextI18n")){
		// addon    "Next (addon)"   
		nextI18n = Granite.I18n.get("Next (addon)");
	}
	
	function setProductPrice() {
		const priceInfo = dynamic.detailSharedObj.drawObj.price.priceWrapper.info;
		const totalPrice = priceInfo.totalPrice || "";
		const savePriceFormatted = priceInfo.savePrice || "";
		const savePrice = priceInfo.unformattedSavePrice || "";
		
		const proudctPriceInfo = window.sg.components.dynamic.detailSharedObj.proudctPriceInfo;
		const orignalPriceFormatted = proudctPriceInfo.orignalPriceFormatted || "";
		const orignalPrice = proudctPriceInfo.orignalPrice || "";
		const salePriceFormatted = proudctPriceInfo.salePriceFormatted || "";
		const salePrice = proudctPriceInfo.salePrice || "";
		const MonthlyPrice = totalPrice.split(" " + orI18n + " ");
		
		if(sharedObj.globalServiceInfo['care']){
			mainInitPrice = salePrice + sharedObj.globalServiceInfo['care'].sale_price.value;
		}else{
			mainInitPrice = salePrice;
		}
		let priceHtml = "";
		if( isVDSTEPBUYING ){
			
			priceHtml = `<div class="pdd16-step-buying__header-price-text">`;
			if( MonthlyPrice.length > 1 ){
				monthlyCheckedFlag = true;
				priceHtml += `<strong>${fromI18n} ${MonthlyPrice[0].replace(fromI18n, "")}<br>
								${orI18n} ${MonthlyPrice[1]}</strong>`;
			}else{
				priceHtml += `<strong>${totalPrice}</strong>`;
			}
			if( orignalPriceFormatted && savePriceFormatted ){
				// COMP6FE-1599 [EPP] SEPOL MSRP Price  :   (!eppPl )
				if ( !eppPl ){
					priceHtml += `
						<div class="pdd16-step-buying__header-price-save">
							<del class="was-text" data-orignal-price=${orignalPrice}>${orignalPriceFormatted}</del>
							<span class="sale-text" data-save-price=${savePrice}>${savePriceFormatted}</span>
						</div>
					</div>`;
				} else {
					priceHtml += `</div>`;
				}
			}
			priceHtml += `<input type="hidden" class="hiddenPrice" value="${mainInitPrice}">`;
			sharedObj.vdAddonInitPriceHtml = priceHtml;
			
		}else{
			if (MonthlyPrice.length > 1) {
				monthlyCheckedFlag = true;
				priceHtml =`
					<p class="hidden"><strong>${monthly18n}</strong></p>
					<p class="pdd16-step-buying__header-price-text"><strong>${fromI18n} ${MonthlyPrice[0].replace(fromI18n, "")}</strong><br>
						${orI18n} ${MonthlyPrice[1]}</p>
					<input type="hidden" class="hiddenPrice" value="${mainInitPrice}">`;
			} else {
				priceHtml =`
					<p class="hidden"><strong>${monthly18n}</strong></p>
					<p class="pdd16-step-buying__header-price-text"><strong>${fromI18n} ${MonthlyPrice[0]}</strong></p>
					<input type="hidden" class="hiddenPrice" value="${mainInitPrice}">`;
			}
		}
		
		$(".pdd16-step-buying__header-price").html(priceHtml);
		$(".pdd16-step-buying__footer-sum").html(priceHtml);
	}

	function setVoucher() {
		var voucherTotal = $("#voucherTotal");
		var voucherBalance = $("#voucherBalance");
		var voucherCharge = $("#voucherCharge");
		var zeroPrice = currencyComma(0, currency);
		var headline = $(".pdd16-step-buying__headline");
		var desciption = $(".pdd16-step-buying__sub-headline");
		var disclaimer = $(".pdd16-step-buying__disclaimer");
		voucherTotal.html(zeroPrice);
		voucherBalance.html(zeroPrice);
		voucherCharge.html(zeroPrice);

		if (isGPv2) {
			var voucherdata = dynamic.detailSharedObj.voucherdata;
			var title = "";
			if (voucherdata.formatted_sales_pitch) {
				title = voucherdata.formatted_sales_pitch;
			} else if (voucherdata.sales_pitch) {
				title = voucherdata.sales_pitch;
			}
			headline.html(title);
			
			voucherBalance.html(voucherdata.discount_description[0].formatted_value);
			voucherBalance.attr("data-price", voucherdata.discount_description[0].value);
			voucherBalance.attr("data-oriPrice", voucherdata.discount_description[0].value);
		} else {
			var voucherdata = dynamic.detailSharedObj.voucherdataHybris;
			for (var i = 0; i < voucherdata.length; i++) {
				var key = voucherdata[i].key;
				var value = voucherdata[i].value;
				if (value) {
					if (key.toLowerCase() === "voucherprice") {
						voucherBalance.html(currencyComma(value, currency));
						voucherBalance.attr("data-price", value);
						voucherBalance.attr("data-oriPrice", value);
					}
					if (key.toLowerCase() === "maintitle") {
						headline.html(value);
					}
					if (key.toLowerCase() === "subtitle") {
						desciption.html(value);
						desciption.show();
					}
					if (key.toLowerCase() === "description") {
						disclaimer.find("p").html(value);
						disclaimer.show();
					}
				}
			}
		}
	}

	function resetVoucherPrice() {
		//  
		var voucherTotal = $("#voucherTotal");
		var voucherBalance = $("#voucherBalance");
		var voucherCharge = $("#voucherCharge");
		var voucherPrice = voucherBalance.attr("data-oriPrice");
		var selectedNumberEL = $(".better-together__selected-title .number span");
		var selectedItem = $("#selectedItem");
		voucherTotal.attr("data-price", 0);
		voucherBalance.attr("data-price", voucherPrice);
		voucherCharge.attr("data-price", 0);
		selectedItem.html('');
		voucherTotal.html(currencyComma(0, currency));
		voucherBalance.html(currencyComma(voucherPrice, currency));
		voucherCharge.html(currencyComma(0, currency));
		selectedNumberEL.html(0);
		originPrice = 0;
		savePrice = 0;
	}

	function voucherPopup(id) {
		var voucherBalance = $("#voucherBalance");
		var voucherOriPrice = Number(voucherBalance.attr("data-oriPrice")) || 0;
		var voucherPrice = Number(voucherBalance.attr("data-price")) || 0;
		var msg, popupType;
		
		if (voucherPrice === 0) {
			popupType = "allVoucher";
			msg = Granite.I18n.get("You redeeemed at your credits!<br>Press 'continue' to proceed.<br/>You cannot change your selection once you press 'continue'.");
			id = "voucher" + id;
		} else if (voucherPrice === voucherOriPrice) {
			popupType = "redeem";
			msg = Granite.I18n.get("You didn't redeem your {0} credit.<br/>it will be gone once you press 'skip'.", currencyComma(voucherPrice, currency));
			id = "skip" + id;
		} else if (voucherPrice > 0) {
			popupType = "voucher";
			msg = Granite.I18n.get("You still have credit to redeem ({0})<br/>Your credit will be gone once you press 'continue'.", currencyComma(voucherPrice, currency));
			id = "voucher" + id;
		}

		confirmPopup(msg, popupType, id);
		
		const alertlayer = $(".confirm-popup");
		const alertTitle = alertlayer.find(".confirm-popup__title");
		const alertYes = alertlayer.find(".cta--contained");
		const alertNo = alertlayer.find(".cta--outlined");
		if( siteCode === 'hk' || siteCode === 'hk_en' ){
			if( popupType === 'redeem' ){ // addon   add   
				alertTitle.html(Granite.I18n.get("Are you sure? (redeem)"));
				alertlayer.find('.cta--outlined.cta--black').attr('id', 'skipGoCartAddOn');
				alertYes.html(Granite.I18n.get("Use Your Galaxy Credit"));
				alertNo.html(Granite.I18n.get("Skip"));
				alertlayer.find('.cta--contained.cta--emphasis').removeAttr('id');
			}else if( popupType === 'voucher' ){ // addon  add    
				alertTitle.html(Granite.I18n.get("Are you sure? (voucher)"));
				alertlayer.find('.cta--outlined.cta--black').attr('id', 'voucherGoCartAddOn');
				alertYes.html(Granite.I18n.get("Use Your Galaxy Credit"));
				alertNo.html(Granite.I18n.get("Skip"));
				alertlayer.find('.cta--contained.cta--emphasis').removeAttr('id');
			}
		}
	}

	function showBetterTogether(data) {
		if( isVDSTEPBUYING && sharedObj.vdcombodataHybris && sharedObj.vdcombodataHybris.length > 0 ){
			let vdMsg = '';
			sharedObj.vdcombodataHybris.forEach(function(data){
				if( data.key.toLowerCase() === 'maintitle' ){
					vdMsg += data.value;
				}else if( data.key.toLowerCase() === 'subtitle' ){
					if( vdMsg ){
						vdMsg += `<br/>${data.value}`;
					}else{
						vdMsg += data.value;
					}
				}
			});
			$('.pdd16-step-buying__promotion-banner .pdd16-step-buying__promotion-banner-text').html(vdMsg);
			$('.pdd16-step-buying__promotion-banner').show();
		}else{
			$('.pdd16-step-buying__promotion-banner').remove();
		}
		
		if( sharedObj.giftdataHybris && sharedObj.giftdataHybris.length > 0 ){
			const giftModel = $('.pdd16-step-buying .pdd16-step-buying__card-input');
			if( giftModel ){
				selectedGift = {"modelCode":[giftModel.find('input:checked').attr('data-modelcode')]};
			}
		}
		
		window.sg.components.dynamic.detailSharedObj.commonApiModel.historyBackEvent();
		if( isGPv2 ){
			sharedObj.addOnCategoryList.forEach(function(categoryList, idx){
				categoryList.category.productList.forEach(function(productList, jdx){
					sharedObj.addOnSearchGPv2.forEach(function(searchList, kdx){
						if( searchList.familyId === productList.family_id ){
							sharedObj.addOnInfoTemp.forEach(function(addonModel){
								searchList.modelList.filter(function(searchModel, mdx){
									if( addonModel.model_code === searchModel.modelCode ){
										const priceInfo = addonModel.price_info[0];
										const stocklevel = addonModel.inventory.status || "";
										searchModel.displayName = addonModel.displayName || "";
										searchModel.thumbUrlAlt = addonModel.imageUrlAlt || "";
										searchModel.priceDisplay = priceInfo.list_price.formatted_value || "";
										searchModel.promotionPriceDisplay = priceInfo.sale_price.formatted_value || "";
										searchModel.price = priceInfo.list_price.value || "";
										searchModel.promotionPrice = priceInfo.sale_price.value || "";
										searchModel.stocklevel = stocklevel;
										searchModel.isStock = !(stocklevel === "" || stocklevel.toUpperCase() === "OUTOFSTOCK");
										searchModel.idx = String(jdx) + '-' + String(mdx) //familyNum - modelNum //test
									}
								})
							});
							sharedObj.addOnCategoryList[idx].category.productList[jdx] = searchList;
							sharedObj.addOnCategoryList[idx].category.idx = String(idx);
						}
					});
				});
			});
			
			const tempList = [];
			sharedObj.addOnCategoryList.forEach(function(elem){
				if( elem.category.idx ){
					tempList.push(elem);
				}
			});
			sharedObj.addOnCategoryList = tempList;
			
			sharedObj.addOnCategoryList.forEach(function(categoryList, idx){
				const filtered = [];
				categoryList.category.productList.reduce((keys, cur) => {
					if( !keys.includes(cur.familyId) ){
						keys.push(cur.familyId);
						filtered.push(cur);
					}
					return keys;
				}, [])
				categoryList.category.productList = filtered;
			});
			
			productListData = sharedObj.addOnCategoryList;
			
		}else{
			productListData = data;
		}
		if( productListData == null || Object.keys(productListData).length === 0 ){
			//epp service search       
			// hybris  ,        addToCartFlag false  
			setInterval(function() {
				moveCart();
			}, 1000);
			
			return;
		}
		buildProductGrid(productListData);
		
		window.scrollTo(0, 0);
		$(".pdd16-step-buying").show();

		if( isGPv2 || isOldHybris ){
			var removeClass = $("[class*='feature-benefit']");
			for(var i = 0; i < removeClass.length; i++){
				removeClass[i].remove();
			}
			/*var removeClass2 = $("#wrap").nextUntil("footer");
			for(var j = 0; j < removeClass2.length; j++){
				removeClass2[j].remove();
			}*/
			$(".video-wrapper").remove();
		}
		if( isNewHybris ){
			var responsivegrid = $(".root.responsivegrid > div");
	        for(let i = 0; i < responsivegrid.length; i++){
				var classList = responsivegrid[i].classList;
	            if(!classList.value.includes('aem-Grid--default--12'))
					responsivegrid[i].remove();
	        }
		}
		
		$(".pdd16-step-buying").siblings().add($(".pdd16-step-buying").parent().siblings()).hide();
        setTimeout(function() {
        	window.sg.components.stepbuying.init();
        }, 10);

		if ($(".scrollbar__contents .pdd16-step-buying__card").not(".is-item-visible").length === 0) {
			$(".pdd16-step-buying__cta-more").hide();
		}
		
		if (dynamic.detailSharedObj.hasVoucher) {
			setVoucher();
			_satellite.setVar("Add Page Name", "evoucher");
			_satellite.track("page view");
		}else{
			_satellite.setVar("Add Page Name", "add on");
			_satellite.track("page view");
		}

		if(localConfigurator.get('useStaticTitle')){
			const headlineText = $(".pdd16-step-buying__headline");
			headlineText[0].innerHTML = localConfigurator.get("staticTitle");
		}
		if(localConfigurator.get('useStaticSubTitle')){
			$('.pdd16-step-buying__sub-headline').text(localConfigurator.get('staticSubTitle'));
		}
	}
	
	var giftFlag = true;
	function moveBridgePage(btnEl) {
		isVoucher = window.sg.components.dynamic.detailSharedObj.hasVoucher;
		sharedObj = dynamic.detailSharedObj;
		setProductPrice();
		// old-hybris : voucher    gift   gift (BC new-hybris  )
		var showGift = (isOldHybris || isGPv2) ? (sharedObj.hasGift && giftFlag && !sharedObj.hasVoucher) : (isNewHybris ? (sharedObj.hasGift && giftFlag) : false);
		if( showGift ){
			$('.pdd16-step-buying .tab').removeClass('bg-light-gray').removeAttr('data-use-arrow');
			$('.pdd16-step-buying .tab__list').hide();
			if(!$('.pdd16-step-buying').hasClass('pdd16-step-buying--free-gift')){
				$('.pdd16-step-buying').addClass('pdd16-step-buying--free-gift');
			}
			giftFlag = false;
			window.sg.components.dynamic.bridgePagefreeGift.moveBridgePage();
		}else{
			const newEmbedVD = isVDSTEPBUYING && sharedObj.newEmbedVDCountry;
			const showAddon = newEmbedVD ? sharedObj.hasAddOns && !sharedObj.isEmbedAddOn : (sharedObj.hasAddOns && (!sharedObj.isEmbedAddOn || sharedObj.isEmbedAddOn && isSoundbarCategoryData));
			const isSoundbarCategoryData = sharedObj.soundbarCategoryData && Object.keys(sharedObj.soundbarCategoryData).length > 0 ? true : false;
			if( showAddon ){
				$('.pdd16-step-buying .tab').addClass('bg-light-gray').attr('data-use-arrow');
				$('.pdd16-step-buying .tab__list').show();
				betterTogetherApi = dynamic.bridgePageCommon;
				
				if(localConfigurator.get("useStaticSubTitle")){
					$('.pdd16-step-buying__sub-headline').css('display','');
					if(isVoucher){
						$('.pdd16-step-buying__evoucher').css('display','');
					}else{
						$('.pdd16-step-buying__evoucher').remove();
					}
				}else if(isVoucher){
					var voucherData = window.sg.components.dynamic.detailSharedObj.voucherdataHybris;
					$('.pdd16-step-buying__sub-headline').css('display','');
					$('.pdd16-step-buying__evoucher').css('display','');
				}
				if($('.pdd16-step-buying').hasClass('pdd16-step-buying--free-gift')){
					$('.pdd16-step-buying').removeClass("pdd16-step-buying--free-gift");
				}
				if( !sharedObj.isEmbedAddOn ){
					if( isGPv2 ){
						showBetterTogether();
						betterTogetherApi.categoryGridGPv2();
					}else{
						betterTogetherApi.getSearchProductcard(showBetterTogether);
					}
				}
				giftFlag = true;

				if(!localConfigurator.get("useTncOnAddOn")){
					const _$tnc = $('.pdd16-step-buying__tnc');
					if(_$tnc && _$tnc.length > 0){
						_$tnc.hide();
					}
				}
			}
		}

		if (dynamic.detailSharedObj.hasVoucher) {
			resetVoucherPrice();
			$("#primaryInfoCheckOutAddOn,skipGoCartAddOn,voucherGoCartAddOn").attr("an-tr", "pdd16_product bought together-" + pageTrack + "-popup-cart")
				.attr("an-ca", "content click")
				.attr("an-ac", "feature")
				.attr("an-la", "evoucher:checkout");
			$("#primaryInfoGoCartAddOn,skipGoCartAddOn,voucherGoCartAddOn").attr("an-tr", "pdd16_product bought together-" + pageTrack + "-popup-cart")
				.attr("an-ca", "content click")
				.attr("an-ac", "feature")
				.attr("an-la", "evoucher:go to cart");

		} else {
			$("#primaryInfoCheckOutAddOn,skipGoCartAddOn,voucherGoCartAddOn").attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-notaddedcart")
				.attr("an-ca", "content click")
				.attr("an-ac", "feature")
				.attr("an-la", "add-on:checkout");
			$("#primaryInfoGoCartAddOn,skipGoCartAddOn,voucherGoCartAddOn").attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-notaddedcart")
				.attr("an-ca", "content click")
				.attr("an-ac", "feature")
				.attr("an-la", "add-on:go to cart");
		}
		$("#primaryInfoCheckOutAddOn, #primaryInfoGoCartAddOn,skipGoCartAddOn,voucherGoCartAddOn").removeAttr("data-modelcode")
			.removeAttr("data-modelname")
			.removeAttr("data-modeldisplay")
			.removeAttr("data-modelprice")
			.removeAttr("data-discountprice")
			.removeAttr("data-pvitype")
			.removeAttr("data-pvisubtype")
			.removeAttr("data-pimsubtype")
			.removeAttr("data-modelrevenue")
			.removeAttr("data-modelqty")
			.removeAttr("data-modelcurrency");
	}

	function arrayContains(array, element) {
		for (var i = 0; i < array.length; i++) {
			if (array[i] === element) {
				return true;
			}
		}
		return false;
	}
	
	function addOnsImgBundleDomain(imgUrl, preset, iconFl) {
		/* 
			 addOnsImgDomain          
			https://images.samsung.com/nz/smartphones/galaxy-s22-ultra/buy/Watch_Bundle_B0.png?$THUB_SHOP_L$
			>>
			tps://images.samsung.com/nz/smartphones/galaxy-s22
		*/ 
		
		var newUrl = "";
		var useScene7domain = $("#scene7domain").val();
		if (imgUrl) {
			if (imgUrl.indexOf("?") > -1) { //    add-ons - hybris
				imgUrl = imgUrl.replace("medias","");
				imgUrl = imgUrl.substring(0, imgUrl.indexOf("?"));
				imgUrl += "?" + preset;
			} else {
				preset = "?" + preset;
			}
			if (imgUrl.indexOf("https:") > -1 || imgUrl.indexOf("http:") > -1 || imgUrl.indexOf("//stg-images.samsung.com/") > -1 || imgUrl.indexOf("//images.samsung.com/") > -1 || imgUrl.indexOf("image.samsung.com/") > -1) {
				newUrl = imgUrl;
			} else {
				if (iconFl) useScene7domain = useScene7domain.replace("/image/", "/content/");
				newUrl = useScene7domain + imgUrl;
			}
		}
		return newUrl;
	}
	
	function addOnsImgDomain(imgUrl, preset, iconFl) {
		var newUrl = "";
		var useScene7domain = $("#scene7domain").val();
		if (imgUrl) {
			if (imgUrl.indexOf("?") > -1) { //    add-ons - hybris
				imgUrl = imgUrl.replace("medias","");
				imgUrl = imgUrl.substring(2, imgUrl.indexOf("?"));
				imgUrl = imgUrl.substring(0,imgUrl.lastIndexOf('-'));
				preset = "";
			} else {
				preset = "?" + preset;
			}
			if (imgUrl.indexOf("https:") > -1 || imgUrl.indexOf("http:") > -1 || imgUrl.indexOf("//stg-images.samsung.com/") > -1 || imgUrl.indexOf("//images.samsung.com/") > -1 || imgUrl.indexOf("image.samsung.com/") > -1) {
				newUrl = imgUrl;
			} else {
				if (iconFl) useScene7domain = useScene7domain.replace("/image/", "/content/");
				newUrl = useScene7domain + imgUrl;
			}
		}
		return newUrl;
	}
	
	/**
	 *   
	 */
	function resetProduct() {
		selectIndexList = new Array();
		selectProductList = new Array();
		selectProductImgList = new Array();
		seletecBundlePopupData = {};
	}

	/**
	 * viewOptionObj :    Product    optionChip     
	 * sku index   selectOptionMoIdx :    moidx 
	 * otherSelectedOptionMoIdxList :         
	 * isColorType :   color    optionTypeList :   Product 
	 * optionTypeList
	 */
	var getSelectedModelIdx = function (viewOptionObj, selectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, optionTypeList) {
		var modelIdx = 0;
		var modelIdxList = selectOptionMoIdx.split(',');
		var firstIdx = modelIdxList[0];
		var memoryIdx = optionTypeList.indexOf("MEMORY");

		if (!isGPv2 && !isNewHybris && !isOldHybris && isColorType && memoryIdx > 0) {
			// [global, hybrisIntg]   color ,     memory  
			//   
			var memoryOptionList = viewOptionObj["MEMORY"].optionList;
			var selectedModelIdx = 0;
			var highestOption = 0;
			for (var moi in memoryOptionList) {
				var temp_mi = memoryOptionList[moi].modelIdx.split(',');
				for (var tmi in temp_mi) {
					//   modelIdx   model idx   
					if (arrayContains(modelIdxList, temp_mi[tmi])) {
						var this_memory_num = memoryOptionList[moi].optionCode.replace("TB", "000").replace(/[^0-9]/g, "");
						if (highestOption < this_memory_num) {
							highestOption = this_memory_num;
							selectedModelIdx = temp_mi[tmi];
						}
						break;
					}
				}
			}
			modelIdx = selectedModelIdx;
		} else {
			var tempMappingModelIdx = [];
			for (var omi in otherSelectedOptionMoIdxList) {
				var otherMoIdx = otherSelectedOptionMoIdxList[omi];
				if (otherMoIdx) {
					var otherMoIdxArr = otherMoIdx.split(',');
					tempMappingModelIdx = [];
					for (var mli in modelIdxList) {
						if (otherMoIdxArr.indexOf(String(modelIdxList[mli])) > -1) {
							tempMappingModelIdx.push(modelIdxList[mli]);
						}
					}
					if (tempMappingModelIdx.length > 0) {
						modelIdxList = tempMappingModelIdx;
					}
				}
			}
			if (modelIdxList.length > 0) {
				modelIdx = modelIdxList[0];
			} else {
				modelIdx = firstIdx;
			}
		}
		return modelIdx;
	};

	var productCardFmyOptionBuild = function (product, flag, idx, replaceProduct) {
		var optionHtml = "";
		var frontModel = product.modelList[product.frontModelIdx];
		if (product.viewOptionObj && Object.keys(product.viewOptionObj).length > 0) {
			//    model idx : disable    ( idx  disabled )
			var parentOptionModelIdx = "";
			var viewOptionIdx = 0;
			var curViewOptionObj = product.viewOptionObj;
			var curOptionTypeList = product.optionTypeList;

			for (var type in product.viewOptionObj) {
				var optionDataType = type.toLowerCase().replace(/ /g, "-");
				var optionObj = product.viewOptionObj[type].optionList;
				var isSelected = false;
				var currentOption = {};
				var disabledClass = "";
				var selectorWrapperStyle = "";
				var tagging = (isVoucher ? "evoucher" : "add-on");
				
				if (product.viewOptionObj[type].styleAttr) {
					selectorWrapperStyle = product.viewOptionObj[type].styleAttr;
				}

				if (type === "COLOR") {
					var curSelecteModelIdx = "";
					var colorOptionHtml = "";
					for (var option in optionObj) {
						var colorOptionCount = optionObj.length;
						/* ()  flag  */
						currentOption = optionObj[option];
						isSelected = false;
						var modelIdxList = currentOption.modelIdx.split(',');

						if (currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))) {
							isSelected = true;
							curSelecteModelIdx = currentOption.modelIdx;
						}
						
						//   model   (  )
						var modelCodeAttrForTagging = "";
						var modelNameAttrForTagging = "";
						var modelIdx;
						var curSelectOptionMoIdx = currentOption.modelIdx;
						var otherSelectedOptionMoIdxList = [];
						var isColorType = true;

						for (var ooi in curViewOptionObj) {
							if (ooi !== type) {
								var tmp_optionList = curViewOptionObj[ooi].optionList;
								for (var toi in tmp_optionList) {
									var tmp_option = tmp_optionList[toi];
									var tmp_optionMoIdx = tmp_option.modelIdx;
									var tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');

									//   option 
									if (tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx)) > -1) {
										otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
									}
								}

							}
						}
						
						modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
						if (product.modelList.length > modelIdx && product.modelList[modelIdx]) {
							if( isGPv2 ){
								modelCodeAttrForTagging = product.modelList[modelIdx].modelCode;
								modelNameAttrForTagging = product.modelList[modelIdx].modelName;
							}else{
								modelCodeAttrForTagging = product.modelList[modelIdx].modelCode;
								modelNameAttrForTagging = product.modelList[modelIdx].modelName;
							}
						}
						var modelOriPrice = product.modelList[modelIdx].price;
						var modelProPrice = product.modelList[modelIdx].promotionPrice;
						var modelSavPrice = modelOriPrice - modelProPrice;
						
						if( isGPv2 ){
							if( product.modelList[modelIdx].idx ){
								product.modelList[modelIdx].idx = `${categoryCardIdx}-${modelIdx}`;
							}
						}
						if( replaceProduct ){
							product.modelList[modelIdx].idx = `${replaceProduct}-${modelIdx}`
						}
						var chipId = 'pdd16-' + optionDataType + '-' + categoryIdx + '-' + product.modelList[modelIdx].idx;
						var chipName = 'pdd16-' + optionDataType + '-' + categoryIdx + '-' + product.modelList[modelIdx].idx;
						colorOptionHtml +=
							`<span class="option-selector__swiper-slide${disabledClass}">
								<span class="option-selector__color">
									<input type="radio" id="${chipId}" name="${chipName}" data-modeli="${modelIdx}" ${(isSelected?' checked':'')} ${(disabledClass === ""?"":" disabled")}
										an-tr="${isVDSTEPBUYING ? 'pdd16_step buying' : 'pdd16_product bought together'}-${pageTrack}-select-option" an-ca="option click" an-ac="bridge" an-la="${isVDSTEPBUYING ? 'vd ' : ''}${tagging}:${type.toLowerCase()}:${currentOption.optionName.toLowerCase()}"
										data-modelcode="${modelCodeAttrForTagging}" data-modelname="${modelNameAttrForTagging}" data-price="${modelOriPrice}" data-promotionPrice="${modelProPrice}" data-saveprice="${modelSavPrice}" data-index="${product.modelList[modelIdx].idx}">
									<label for="${chipId}">
										<span class="option-selector__color-code" style="background-color: ${currentOption.optionCode}">${currentOption.optionLocalName}</span>
										<span class="hidden">${currentOption.optionName}</span>
									</label>
								</span>
							</span>`;
					}
					parentOptionModelIdx = curSelecteModelIdx;
					optionHtml +=
						`
						<div class="option-selector__wrap option-selector__wrap--color-chip swiper-mode ${flag == true ? '' : 'option-selector__wrap'}" data-desktop-view="5" data-mobile-view="2">
							<div class="option-selector__swiper">
								<div class="option-selector__swiper-container" aria-live="polite">
									<div class="option-selector__swiper-wrapper" style="transform: translateX(0px);">
										${colorOptionHtml}
									</div>
								</div>
								<button type="button" class="option-selector__button-prev option-selector__button--disabled" aria-label="Previous" role="button" aria-disabled="true"  tabindex="0" style="display:block;">
									<span class="hidden">${Granite.I18n.get("Previous")}</span>
									${colorOptionCount > 5 ? 
									`<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#previous-regular"></use>
									</svg>` : '' }
								</button>
								<button type="button" class="option-selector__button-next" aria-label="Next" role="button" aria-disabled="true" tabindex="0" style="display:block;">
									<span class="hidden">${nextI18n}</span>
									${colorOptionCount > 5 ?
									`<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-regular" ></use>
									</svg>` : '' }
								</button>
							</div>
						</div>
						`;
				} else if (type === "MOBILE MEMORY" || type === "TV SIZE" || type === "HOME APPLIANCE SIZE" || type === "MONITOR SCREEN SIZE") {
					// IM: Color | Capacity (Memory) | Carrier, VD: Size, DA: Material | Size
					var curSelecteModelIdx = '';
					var memoryOptionHtml = "";
					for (var oi = 0; oi < optionObj.length; oi++) {
						/* ()  flag  */
						var capacityOptionCount = optionObj.length;
						currentOption = optionObj[oi];
						isSelected = false;
						var modelIdxList = currentOption.modelIdx.split(',');

						if (currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))) {
							isSelected = true;
							curSelecteModelIdx = currentOption.modelIdx;
						}

						//   model   (  )
						var modelCodeAttrForTagging = "";
						var modelNameAttrForTagging = "";
						var modelIdx;

						var curSelectOptionMoIdx = currentOption.modelIdx;
						var otherSelectedOptionMoIdxList = [];
						var isColorType = false;

						for (var ooi in curViewOptionObj) {
							if (ooi !== type) {
								var tmp_optionList = curViewOptionObj[ooi].optionList;
								for (var toi in tmp_optionList) {
									var tmp_option = tmp_optionList[toi];
									var tmp_optionMoIdx = tmp_option.modelIdx;
									var tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');

									//   option 
									if (tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx)) > -1) {
										otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
									}
								}

							}
						}

						modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
						if (product.modelList.length > modelIdx && product.modelList[modelIdx]) {
							modelCodeAttrForTagging = product.modelList[modelIdx].modelCode;
							modelNameAttrForTagging = product.modelList[modelIdx].modelName;
						}
						
						var chipId = 'pdd16-' + optionDataType + '-' + categoryIdx + '-' + product.modelList[modelIdx].idx;
						var chipName = 'pdd16-' + optionDataType + '-' + categoryIdx + '-'+ product.modelList[modelIdx].idx;

						memoryOptionHtml +=
							`<span class="option-selector__swiper-slide${disabledClass}">
								<span class="option-selector__size">
									<input type="radio" id="${chipId}" name="${chipName}" data-modeli="${modelIdx}"${(isSelected?' checked':'')}${(disabledClass === ""?"":" disabled")}
										an-tr="${isVDSTEPBUYING ? 'pdd16_step buying' : 'pdd16_product bought together'}-${pageTrack}-select-option" an-ca="option click" an-ac="bridge" an-la="${isVDSTEPBUYING ? 'vd ' : ''}${tagging}:${type.toLowerCase()}:${currentOption.optionName.toLowerCase()}"
										data-modelcode="${modelCodeAttrForTagging}" data-modelname="${modelNameAttrForTagging}" data-index="${product.modelList[modelIdx].idx}">
									<label class="option-selector__size-label" for="${chipId}">
										<span class="option-selector__size-label-text">${currentOption.optionLocalName}</span>
									</label>
								</span>
							</span>`;
					}
					parentOptionModelIdx = curSelecteModelIdx;
					optionHtml +=
						`<div class="option-selector__wrap option-selector__wrap--capacity swiper-mode ${flag == true ? '' : 'option-selector__wrap'}" data-desktop-view="3" data-mobile-view="2">
							<div class="option-selector__swiper">
								<div class="option-selector__swiper-container" aria-live="polite">
									<div class="option-selector__swiper-wrapper" style="${selectorWrapperStyle}">
										${memoryOptionHtml}
										<div class="option-selector__floating-bar" style="display: none;"></div>
									</div>
								</div>
								<button type="button" class="option-selector__button-prev option-selector__button--disabled" aria-label="Previous" role="button" aria-disabled="true" tabindex="0" style="display:block;">
									<span class="hidden">${Granite.I18n.get("Previous")}</span>
									${capacityOptionCount > 2 ?
									`<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#previous-regular" ></use>
									</svg>` : ''}
								</button>
								<button type="button" class="option-selector__button-next" aria-label="Next" role="button" aria-disabled="true" tabindex="0" style="display:block">
									<span class="hidden">${nextI18n}</span>
									${capacityOptionCount > 2 ?
									`<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-regular" ></use>
									</svg>` : '' }
								</button>
							</div>
						</div>`;
				}
				viewOptionIdx++;
			}
		}
		return optionHtml;
	};
	
	function bundleGrid(bundleIdx){
		var imageHtml = ""; 
		var productCardTemplate = ""; 
		var bundleOriPrice = productBundleListData[bundleIdx].priceValue;
		var bundlePromotionPrice = productBundleListData[bundleIdx].promotionPriceValue ? productBundleListData[bundleIdx].promotionPriceValue : bundleOriPrice;
		var bundleSavePrice = bundlePromotionPrice ? bundleOriPrice - bundlePromotionPrice : 0;
		var bundleDisplayPrice = productBundleListData[bundleIdx].promotionPrice ? productBundleListData[bundleIdx].promotionPrice : productBundleListData[bundleIdx].price;
		imageHtml = `<img class="image__preview lazy-load responsive-img" data-desktop-src='${addOnsImgBundleDomain(productBundleListData[bundleIdx].imageUrl, "$LazyLoad_Home_PNG$")}' data-mobile-src="${addOnsImgBundleDomain(productBundleListData[bundleIdx].imageUrl, "$LazyLoad_Home_PNG$")}"  alt="" role="img"> 
					<img class="image__main lazy-load responsive-img" data-desktop-src='${addOnsImgBundleDomain(productBundleListData[bundleIdx].imageUrl)}' data-mobile-src="${addOnsImgBundleDomain(productBundleListData[bundleIdx].imageUrl)}" alt=""  role="img">`; 
		productCardTemplate += `
								<div class="pdd16-step-buying__card-title">
									<strong class="pdd16-step-buying__card-title-text">${productBundleListData[bundleIdx].name}</strong> 
									<div class="pdd16-step-buying__tooltip">${productBundleListData[bundleIdx].name}</div> 
								</div> 
								<div class="image image--main-loaded"> ${imageHtml} </div> `; 

        // CRHQ-7899 [B2C][BC][IM] Ranking / Sorting for production on Addon Step -   
		var stocklevel = productBundleListData[bundleIdx].stocklevel ? productBundleListData[bundleIdx].stocklevel.toLowerCase() : "outofstock";
		var isStock = stocklevel !== 'outofstock' ? true : false;
		if( isStock ){
			if( !sharedObj.addonBundleRelatedData || sharedObj.addonBundleRelatedData.length == 0 ){
				isStock = false;
			} else {
				//   : 3      3         
				for( const relatedData of sharedObj.addonBundleRelatedData ){
					if( relatedData.bundleModelCode === productBundleListData[bundleIdx].modelCode ){
						const sameGroup = [];
						for(const key in relatedData ){
							if( key !== 'bundleModelCode' && relatedData[key] ){
								if(!sameGroup[relatedData[key].groupCode]){
									sameGroup[relatedData[key].groupCode] = [];
								}
								if( relatedData[key].stocklevel !== 'outOfStock' && relatedData[key].colorCode ){
									sameGroup[relatedData[key].groupCode] .push(relatedData[key]);
								}
							}
						}
						for( const group in sameGroup){
							if(isStock && sameGroup[group].length == 0){
								isStock = false;
							}
						}
					}
				}
			}
		}
		var state = isStock ? addI18n : outOfStockI18n;
		
		productCardTemplate += `
								<div class="pdd16-step-buying__card-option" style="height:84.4375px"> 
									<div class="option-selector option-selector__color-text"> 
										<div class="option-selector__color-name"> 
										</div> 
									</div> 
								</div> 
								<div class="pdd16-step-buying__card-badge"> 
									<div class="badge-energy-label"> 
									</div> 
								</div> 
								<div class="pdd16-step-buying__card-price">
									<strong class="card-price">${bundleDisplayPrice}</strong>
									<span class="card-was">
										<span class="hidden">Original Price: ${bundleOriPrice}</span>
										<input type="hidden" value="${bundlePromotionPrice}">
										${bundleSavePrice && !eppPl ? `<del>${productBundleListData[bundleIdx].price}</del>` : ``}
									</span>
								</div>`; 
		productCardTemplate += `
								<button class="cta cta--contained cta--icon cta--icon-leading bundleSelect cta--bundle ${!isStock ? 'js-cta-stock cta--outlined' : 'cta--black'}" title="SELECT" id="bundleSelect" data-modelcode="${productBundleListData[bundleIdx].modelcode}" data-originPrice=${bundleOriPrice} data-savePrice=${bundleSavePrice} data-promotionPrice=${bundlePromotionPrice} aria-selected
								an-tr="pdd16_product bought together-product detail-popup-add" an-ca="option click" data-text="${addI18n}" data-text-selected="${addedI18n}"> 
									<span>${state}</span>
									<svg class="icon" focusable="false"> 
									<use xlink:href="#done-bold" href="#done-bold">
									</use> 
									</svg> 
								</button> `; 
		return productCardTemplate;
	}
	
	function buildProductCard(product,idx,replaceProduct) {
		var productCardTemplates = "";
		var productCardTemplate = "";
		var cardTemplate = "";
		var thirdPASeller = isVDSTEPBUYING ? product.thirdPASeller : '';
		var frontModel = product.modelList[product.frontModelIdx];
		var chipOptions = frontModel.fmyChipList;
		var colorName = "";
		if(chipOptions.length > 0){
			for(var i = 0; i < chipOptions.length; i++){
				if(chipOptions[i].fmyChipType == "COLOR"){
					colorName = (frontModel.fmyChipList[i].fmyChipLocalName !== '') ? frontModel.fmyChipList[i].fmyChipLocalName : frontModel.fmyChipList[i].fmyChipName;
					break;
				}
			}
		}
		var isStock = frontModel.isStock;
		var princeInfo = betterTogetherApi.setPriceInfo(frontModel);
		var promotionPrice = princeInfo.promotionPrice;
		var savePriceTemp = princeInfo.savePriceTemp;
		var saveText = princeInfo.saveText;
		var productPriceDisplay = princeInfo.productPriceDisplay;
		var promotionPriceDisplay = princeInfo.promotionPriceDisplay;
		var tagging = (isVoucher ? "evoucher" : "add-on");
		var imageHtml = ""
		var key = idx;
		categoryIdx = idx;
		
		const imageUrl = frontModel.thumbUrl ? frontModel.thumbUrl : '';
		const imageAlt = frontModel.thumbUrlAlt ? frontModel.thumbUrlAlt : '';
		if( imageUrl ){
			imageHtml =
				`<img class="image__preview lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(imageUrl, "$LazyLoad_Home_PNG$")}" data-mobile-src="${addOnsImgDomain(imageUrl, "$LazyLoad_Home_PNG$")}" alt="${imageAlt}" role="img" data-img-src="${imageUrl}">
				<img class="image__main lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(imageUrl, "$240_240_PNG$")}" data-mobile-src="${addOnsImgDomain(imageUrl, "$480_480_PNG$")}" alt="${imageAlt}" role="img">`;
		}

		let badgeType = '';
		let badgeClass = '';
		if( isVDSTEPBUYING ){
			if( frontModel.topFlags ){
				if( frontModel.topFlags.iconTitle && frontModel.topFlags.iconTypeCd ){
					badgeType = frontModel.topFlags.iconTypeCd;
					switch( badgeType.replace(/ /g,'').toUpperCase() ){
						case 'N':
							badgeClass = 'badge-icon--bg-color-blue';
							break;
						case 'H':
							badgeClass = 'badge-icon--bg-color-red';
							break;
						case 'B':
							badgeClass = 'badge-icon--bg-color-orange';
							break;
						case 'U':
							badgeType = frontModel.topFlags.iconTitle;
							badgeClass = 'baak;
					}
				}
			}
		}
		
		productCardTemplate += 
			`<!--/* (2022.06.21 ) Badge : badge   .pdd16-step-buying__card-header-badge   */-->
			<div class="pdd16-step-buying__card-header-badge">
				<!--/* new bg color : blue, badge-icon--bg-color-blue  */-->
				<!--/* best seller bg color : orange, badge-icon--bg-color-orange  */-->
				<!--/* hot bg color : red, badge-icon--bg-color-red  */-->
				<!--/* special deal bg color : blue, badge-icon--bg-color-blue  */-->
				<!--/* eco bg color : green, badge-icon--bg-color-green  */-->
				<!--/* trade-in bg color : teal, badge-icon--bg-color-teal  */-->
				<!--/* gold tier bg color : gold, badge-icon--bg-color-gold  */-->
				<!--/* silver tier bg color : silver, badge-icon--bg-color-silver  */-->
				<!--/* registered tier bg color : silver, badge-icon--bg-color-neutral-blue  */-->
				<!--/* user key-in bg color : Dark Cyan, badge-icon--bg-color-teal  */-->
				<!--/* user key-in bg color : Black, badge-icon--bg-color-black  */-->
				<!--/* user key-in bg color : Red, badge-icon--bg-color-red  */-->
				<!--/* user key-in bg color : Blue, badge-icon--bg-color-blue  */-->
				${badgeClass ? `<span class="badge-icon badge-icon--label ${badgeClass}">${badgeType}</span>` : ``}
			</div>`;
		
		productCardTemplate +=
			`<div class="pdd16-step-buying__card-title"><strong class="pdd16-step-buying__card-title-text">${frontModel.displayName}</strong>
                <div class="pdd16-step-buying__tooltip">${frontModel.displayName}</div>
            </div>
			<div class="image">
				${imageHtml}
			</div>
				`;
		// option  better-together__info   height 
		// (2022.01.21 ) Seller   .pdd16-step-buying__card-seller  
		const colorText = isGPv2 ? `: ${colorName}` : `&nbsp;${colorName}`;
		productCardTemplate +=
			`<div class="pdd16-step-buying__card-seller">
				<p class="pdd16-step-buying__card-seller-text">
					${thirdPASeller ? `Granite.I18n.get("Seller") : thirdPASeller` : ``}
				</p>
			</div>
			<div class="pdd16-step-buying__card-option">
				<div class="option-selector option-selector__color-text">
					${colorName ?
					`<div class="option-selector__color-name">
								${Granite.I18n.get("Color")} 
								<span class="color-name-text">${colorText}</span>
					</div>` : '' }
					${productCardFmyOptionBuild(product, false, idx, replaceProduct)}
				</div>
			</div>`;
		// Product Fiche : fiche  better-together__fich   height 
		const isFiche = frontModel.energyLabelGrade && frontModel.ficheFileUrl;
		const isEnergy = frontModel.energyLabelGrade && frontModel.energyFileUrl;
		productCardTemplate +=
			`<div class="pdd16-step-buying__card-badge">
				<div class="badge-enery-label">
					${isFiche ? 
					`<a href="${frontModel.ficheFileUrl}" target="_blank" title="${Granite.I18n.get("Open in a new window")}" class="cta-text" an-tr="pdd16_product bought together-${pageTrack}-text-product fiche" an-ca="option click" an-ac="bridge" an-la="${tagging}:product fiche">${Granite.I18n.get("Product Fiche")}</a>`:''}
					${isEnergy ? 
					`<a class="badge ${frontModel.energyLabelClass2}" href="${frontModel.energyFileUrl}" target="_blank" title="${frontModel.energyLabelGrade}">
						<span class="badge__grade--with-text ${frontModel.energyLabelClass1}">
							<span class="hidden">${frontModel.energyLabelGrade}</span>
						</span>
					</a>`:''}
				</div>
			</div>`;
		
		let cardWasDisplay = princeInfo.promotionPrice !== null && princeInfo.promotionPrice !== "" && princeInfo.promotionPrice !== "0" && 
								Number(parseFloat(princeInfo.productPrice).toFixed(2)) !== Number(parseFloat(princeInfo.promotionPrice).toFixed(2)) ? true : false;
		if( lowestWasPriceCountry ){
			cardWasDisplay = false;
		}
		if (siteCode !== "pl" || isStock) {
			if( siteCode === 'co' && princeInfo.vatPrice ){
				productCardTemplate +=`
					<div class="pdd16-step-buying__card-price pdd16-step-buying__card-price--samcol">
						<strong class="card-price-excluding-vat">Precio sin IVA: ${princeInfo.vatPrice}</strong>
						<input type="hidden" value="${princeInfo.vatPriceValue}">
						<strong class="card-price-special">Precio con descuento: ${princeInfo.promotionPriceDisplay}</strong>
						<span class="card-price-rrp">Precio antes: <del>${princeInfo.productPriceDisplay}</del></span>
					</div>`;
			}else{
				if( cardWasDisplay ){
					productCardTemplate +=
						`<div class="pdd16-step-buying__card-price">
			                <strong class="card-price">${princeInfo.promotionPriceDisplay}</strong>
			                <span class="card-was">
			                  <span class="hidden">Original Price: ${princeInfo.productPriceDisplay}</span>
			                  <input type="hidden" value="${princeInfo.promotionPrice}">
			                  <del>${princeInfo.productPriceDisplay}</del>
			                </span>
			              </div>`;
				}else{
					productCardTemplate +=
						`<div class="pdd16-step-buying__card-price">
							<strong class="card-price">${(princeInfo.promotionPrice && (princeInfo.promotionPrice <= princeInfo.productPrice)) ? princeInfo.promotionPriceDisplay : princeInfo.productPriceDisplay}</strong>
						</div>`;
				}
			}
		}else{
			productCardTemplate +=
				`<div class="pdd16-step-buying__card-price"></div>`;
		}

		var ctaTitle;
		var isSelected = selectIndexList.includes(key + '-' + frontModel.idx);
		var ADD_TO_CART = Granite.I18n.get("Add to cart");
		var SELECT = Granite.I18n.get("Select");
		var COMING_SOON = Granite.I18n.get("COMING SOON");
		var isComingSoon = false;
		if (!isStock) {
			ctaTitle = Granite.I18n.get("Get Stock Alert");//  js-cta-stock 
			// an-tr="pdd16_product bought together-{pageTrack}-button-stock"an-ca="buy cta" an-ac="stock alert" an-la="add-on/evoucher:get stock alert"
		} else if (isSelected) {
			ctaTitle = addedI18n;
		} else {
				ctaTitle = addI18n;
		}
		if(isStock == null || isStock == undefined || princeInfo == null || princeInfo == undefined){
			ctaTitle = COMING_SOON;
			isComingSoon = true;
		}
		
		var data_price = "";
		if(princeInfo.promotionPrice !== null  && princeInfo.promotionPrice !== "" && princeInfo.promotionPrice !== "0"){
			data_price = princeInfo.promotionPrice;
		}else{
			data_price = princeInfo.productPrice;
		}
		var productPrice = princeInfo.productPrice;
		var saveProductPrice = princeInfo.savePriceTemp;
		const antrTagging = isVDSTEPBUYING ? `pdd16_step buying-${pageTrack}-cta-button` : `pdd16_product bought together-${pageTrack}-popup-add`;
		let modelCode = '';
		if( isGPv2 ){
			modelCode = frontModel.shopSKU;
		}else{
			modelCode = frontModel.modelCode;
		}
		productCardTemplate +=
				`<div class="pdd16-step-buying__card-cta">
					<button class= " ${isComingSoon ? 'cta--disabled' : '' } cta cta--contained cta--icon cta--icon-leading  cta--2line-mo ${!isStock ? 'js-cta-stock cta--outlined' : 'cta--black' }  ${isSelected ? " cta--on":""}" title="${ctaTitle}" aria-selected="" 
						an-tr="${antrTagging}" an-ca="${!isStock ? 'buy cta' : 'option click'}" an-ac="${!isStock ? 'stock alert' : 'bridge'}" an-la="${isVDSTEPBUYING ? 'vd add-on' : tagging}:${!isStock ? 'get stock alert' : 'add item'}" 
						data-modelcode="${modelCode}" data-modelname="${frontModel.modelName}" data-price=${data_price} data-text=${addI18n} data-text-selected="${addedI18n}" data-oriprice="${productPrice}" data-savePrice="${saveProductPrice}">
							<span>${ctaTitle}</span>
							<svg class="icon" focusable="false">
								<use xlink:href="#done-bold" href="#done-bold">
								</use>
							</svg>
					</button>
					${isVDSTEPBUYING ? 
					`<div class="pdd16-step-buying__card-cta-learn-more">
						<button class="cta cta--outlined cta--black cta--2line-mo learn-more-btn" an-tr="pdd16_step buying-product detail-cta-button" an-ca="option click" an-ac="bridge" an-la="vd add-on:learn more" data-modelcode="${modelCode}" data-modelname="${frontModel.modelName}">
							${Granite.I18n.get("Learn more")}
						</button>
					</div>` : ``}
				</div>`;
		productCardTemplates = `<div class="pdd16-step-buying__card" data-index="${key}-${frontModel.idx}" data-price="${promotionPrice}">
									${productCardTemplate}
								</div>`;
		return productCardTemplates;
	}

	/**
	 * Product   
	 * 
	 * @param product
	 * @param frontModelIdx
	 *            Product  model   model index
	 * @return product
	 */
	function getProductInfo(product, frontModelIdx) {
		var tempProduct = product;
		if (tempProduct.modelList[frontModelIdx].displayName == null) {
			tempProduct.modelList[frontModelIdx].displayName = "";
		}

		/*
		 * viewOptionObj :    optionTypeList :      
		 * (  index     )
		 */

		var tmpOptionListInModel = {};
		for (var mi in tempProduct.modelList) {
			var tmpModel = tempProduct.modelList[mi];
			var tmpFmyChipList = tmpModel.fmyChipList;

			for (var fci in tmpFmyChipList) {
				// fmyChipCode " 
				var thisOptionKey = tmpFmyChipList[fci].fmyChipType + '+' +
					tmpFmyChipList[fci].fmyChipCode.replace("\"", "").replace("&quot;", "") + '+' +
					tmpFmyChipList[fci].fmyChipLocalName.replace("\"", "").replace("&quot;", "");

				if (tmpOptionListInModel[thisOptionKey] == undefined) {
					tmpOptionListInModel[thisOptionKey] = mi;
				} else {
					tmpOptionListInModel[thisOptionKey] += "," + mi;
				}
			}
		}

		var optionTypeList = [];
		var viewOptionObj = {};
		if (tempProduct.chipOptions) {
			for (var a = 0; a < tempProduct.chipOptions.length; a++) {
				var optionData = tempProduct.chipOptions[a];
				var optionTypeTmp = optionData.fmyChipType;

				var optionListInType = optionData.optionList;
				for (var opl in optionListInType) {
					var thisOptionKey = optionData.fmyChipType + '+' +
						optionListInType[opl].optionCode.replace("\"", "").replace("&quot;", "") + '+' +
						optionListInType[opl].optionLocalName.replace("\"", "").replace("&quot;", "");
					if (tmpOptionListInModel[thisOptionKey] != undefined) {
						optionListInType[opl].modelIdx = tmpOptionListInModel[thisOptionKey];
					}

				}
				viewOptionObj[optionTypeTmp] = {};
				viewOptionObj[optionTypeTmp]["optionList"] = optionListInType;

				optionTypeList.push(optionTypeTmp);
			}
		}
		tempProduct.viewOptionObj = viewOptionObj;
		tempProduct.optionTypeList = optionTypeList;

		tempProduct.frontModelIdx = frontModelIdx;
		
		return tempProduct;
	}

	function buildProductGrid(productList) {
		var result = "";
		var bundleCategoryName = "";
		if(sharedObj.hasBundle){ // Bundle      Grid  .
			bundleCategoryName = window.sg.components.dynamic.bridgePageCommon.getBundleCategoryName();
		}
		resetProduct();
		isVoucher = window.sg.components.dynamic.detailSharedObj.hasVoucher;
		mainPrice = $('.pdd16-step-buying__header-price-text')[0].innerHTML;
		productListLength = Object.keys(productList).length;
		if (Object.keys(productList).length > 0) {
			var productGridTemplate = "";
			$.each(productList, function(idx,value){
				var productData = productList[idx].category.productList;
				categoryCardIdx = 0;
				for (var pl = 0; pl < productData.length; pl++) {
					var tempProduct = productData[pl];
					if (tempProduct.modelList != null && tempProduct.modelList.length > 0) {
						var frontModelIdx = 0;
						var selectedIndex = null; // selected Y      
						/* selected Y  */
						for (var cnt = 0; cnt < tempProduct.modelList.length; cnt++) {
							var tempModel = tempProduct.modelList[cnt];
							var enabledFlag = tempModel.isStock;
	
							if (tempModel.selected && tempModel.selected === "Y") {
								frontModelIdx = cnt;
								if (enabledFlag) {
									selectedIndex = cnt;
								}
							}
						}
						if (selectedIndex == null) {
							for (var cnt = 0; cnt < tempProduct.modelList.length; cnt++) {
								var tempModel = tempProduct.modelList[cnt];
								var isStock = tempModel.isStock;
								if (isStock) {
									selectedIndex = cnt;
									break;
								}
							}
						}
						if (selectedIndex == null) {
							selectedIndex = frontModelIdx;
						}
						tempProduct = getProductInfo(tempProduct, selectedIndex);
						productGridTemplate += buildProductCard(tempProduct,idx);
					}
					categoryCardIdx++;
				}
				if(productList[idx].category.display_name == bundleCategoryName){ // Bundle  Category bundle Card   .
					const bundleData = productList[idx];
					productBundleListData = bundleData.category.productList;
					for(const bundleIdx in productList[idx].category.productList ){
                        const bundleInfo = productList[idx].category.productList[bundleIdx];
                        const promoValue = bundleInfo.promotionPriceValue ? bundleInfo.promotionPriceValue : bundleInfo.priceValue;
                        
						productGridTemplate += 
							`<div class="pdd16-step-buying__card" data-index="${bundleData.category.key}-${bundleIdx}-0" data-price="${promoValue}">
								${bundleGrid(bundleIdx)}
							</div>`;
					}
				}
				result +=
					`  <div class="pdd16-step-buying__tab pdd16-step-buying__2column swiper-slide" data-button-text="${(Number(idx) + 1) == productListLength ? checkoutI18n : nextI18n}">
		            <div class="pdd16-step-buying__list-type">
		            <a class="btn-type on" aria-label="2column">
		              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" focusable="false">
		                <path fill="none" d="M0 0H16V16H0z" transform="translate(-344 -388) translate(344 388)" />
		                <g>
		                  <path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(344 388)" />
                        <path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(344 394.649)" />
                        <path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(350.65 388)" />
                        <path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(350.65 394.649)" />
		                </g>
		              </svg>
		            </a>
		            <a class="btn-type" aria-label="1column">
		              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" focusable="false">
		                <path fill="none" d="M0 0H16V16H0z" transform="translate(349 388) translate(-349 -388)" />
		                <g>
		                  <path d="M.652 0h10.7A.681.681 0 0 1 12 .764v3.822a.681.681 0 0 1-.652.764H.652A.681.681 0 0 1 0 4.586V.764A.681.681 0 0 1 .652 0z" class="cls-2" transform="translate(344 388.732) translate(7 1.268) translate(-349 -388)" />
                        <path d="M.652 0h10.7A.681.681 0 0 1 12 .764v3.822a.681.681 0 0 1-.652.764H.652A.681.681 0 0 1 0 4.586V.764A.681.681 0 0 1 .652 0z" class="cls-2" transform="translate(344 395.732) translate(7 1.268) translate(-349 -388)" />
		                </g>
		              </svg>
		            </a>
		          </div>
		          <div class="scrollbar">
		            <div class="scrollbar__contents">
		            	${productGridTemplate}
		              <div class="pdd16-step-buying__view-more">
		                <button type="button" class="cta" aira-label="${viewMoreI18n}">
		                  <svg class="icon next" focusable="false">
		                    <use xlink:href="#next-bold" href="#next-bold"></use>
		                  </svg>
		                  <span class="cta-text">${viewMoreI18n}</span>
		                  <svg class="icon down" focusable="false">
		                    <use xlink:href="#open-down-bold" href="#open-down-bold"></use>
		                  </svg>
		                </button>
		              </div>
		            </div>
		          </div>
		        </div>`;
				productGridTemplate = "";
			})
	    }
        
		$(".pdd16-step-buying .pdd16-step-buying__card-wrap .swiper-wrapper").html(result);
		
		var buttonType = "";
		if(isVDSTEPBUYING && !isGPv2){ // VD    Text
			$("#pdd16-step-buying").addClass('pdd16-step-buying--default');
			const categoryCount = $(".pdd16-step-buying .pdd16-step-buying__tab-wrap .tab__list li").length;
			if(categoryCount > 1){ // VD Category     
				buttonType = `
						<div class="pdd16-step-buying__footer-price">
			                <p class="pdd16-step-buying__footer-text"><strong>${totalI18n}</strong>${localConfigurator.get("useVATInclusiveArea") ? vatInclusiveI18n : ''}</p>
			                <p class="pdd16-step-buying__footer-sum">${mainPrice}</p>
			              </div>
						<div class="pdd16-step-buying__footer-cta">
							<button class="cta cta--contained cta--emphasis cta--step" aria-label="Next" id="nextBtn">
								${nextI18n}
							</button>
						</div>`
			}else{ // VD Category   
				buttonType = 
					`
						<div class="pdd16-step-buying__footer-cta">
							<button class="cta cta--contained cta--emphasis cta--step" aria-label="Next" id="primaryInfoGoCartAddOn">
								${checkoutI18n}
							</button>
						</div>
					`
			}
			const vdDisclaimer = Granite.I18n.get("*Savings based on regular Samsung.com price. Discount applied automatically at checkout when two or more qualifying products in basket.");
			buttonType += 
					`
						<p class="pdd16-step-buying__footer-disclaimer">${vdDisclaimer}</p>
					`
		}else{ // VD  
			buttonType = `
				<div class="pdd16-step-buying__footer-price">
	                <p class="pdd16-step-buying__footer-text"><strong>${totalI18n}</strong>${localConfigurator.get("useVATInclusiveArea") ? vatInclusiveI18n : ''}</p>
	                <p class="pdd16-step-buying__footer-sum">${mainPrice}</p>
	              </div>
				<div class="pdd16-step-buying__footer-cta-wrap">
	                <div class="pdd16-step-buying__footer-cta">
		                <button class="cta cta--underline cta--emphasis cta--skip">
		                	${Granite.I18n.get("Skip")}
		              	</button>
	            	</div>
	            <div class="pdd16-step-buying__footer-cta">
	            	<button class="cta cta--contained cta--emphasis" id="primaryInfoGoCartAddOn">
	                	${
							!isCountryUseAddOnContinueI18n ?
								Granite.I18n.get("CONTINUE"):
								Granite.I18n.get("CONTINUE(ADD_ON)") // case : fr
						}
	              	</button>
	            </div>
	          </div>`
		}
		$('.pdd16-step-buying__footer').html(buttonType);
		
		productCardListener();
	}
	
	function productCardListener() {
		/* (Color, Memory)  Event :: S */
		$(".pdd16-step-buying").off("click", ".option-selector__color input, .option-selector__size input");
		$(".pdd16-step-buying").on("click", ".option-selector__color input, .option-selector__size input", function () {
			var _this = $(this);
			var optionIdx = _this.attr('data-modeli');
			var selectCard = _this.closest(".pdd16-step-buying__card");
			var selectIndex = selectCard.attr("data-index") || ""; // familyNum
			var productIdx = selectIndex.split('-')[1]; // familyNum
			var targetIdx = selectIndex.split('-')[2];
			var key = selectIndex.split('-')[0];

			setTimeout(function () {
				if (optionIdx != null) {
					productListData[key].category.productList[productIdx].frontModelIdx = optionIdx;
					var productInfo = getProductInfo(productListData[key].category.productList[productIdx], optionIdx);
					var targetContentEl = $(".pdd16-step-buying__2column").eq(key).find('.pdd16-step-buying__card').eq(productIdx);
					var index = $(".pdd16-step-buying__card").index(targetContentEl);
					targetContentEl.find(".option-selector__swiper-wrapper").each(function (idx) {
						var tmpType = productListData[key].category.productList[productIdx].optionTypeList[idx];
						var styleAttr = $(this).attr("style");
						productListData[key].category.productList[productIdx].viewOptionObj[tmpType].styleAttr = styleAttr;
					});
					mainPrice = $('.pdd16-step-buying__header-price-text')[0].innerHTML;
					targetContentEl.replaceWith(buildProductCard(productInfo,key,productIdx,_this));
					targetContentEl = $(document.querySelectorAll(".pdd16-step-buying__card")[index]);
					targetContentEl.addClass("is-show");
					window.sg.components.stepbuying.init();
				}
			}, 100);
			productCardListener();
		});
		
		/* Card Add  Event */
		$(".pdd16-step-buying").off("click", ".pdd16-step-buying__card .cta:not(.learn-more-btn)");
		$(".pdd16-step-buying").on("click", ".pdd16-step-buying__card .cta:not(.learn-more-btn)", function () {
			var _this = $(this);
			closeButtonThis =  _this;
			const modelCode = _this.attr('data-modelcode');
			var index = _this.closest(".pdd16-step-buying__card").attr("data-index");
			var monthly = sharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal;
			var monthlyPrice = sharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal;
			var price = parseFloat(_this.closest(".pdd16-step-buying__card").attr("data-price"));
			var productPrice = Number($(".hiddenPrice")[0].getAttribute('value'));
			
			var monthPrice = "";
			var totalPrices = "";
			var priceHtml = "";
			var voucherBalance = "";
			var originVoucher = "";
			var voucherCharge = "";
			var selectedItem = "";

			if($(this).hasClass('cta--bundle')){
				addOnPrice = $(this).attr('data-promotionprice');
				if( !$(this).hasClass('js-cta-stock') ){
					if( $(this).hasClass('cta--on') ){
						const fData = productBundleListData.filter(elem => {
							return elem.modelcode === modelCode;
						})
						const bundleData = sharedObj.addonBundleRelatedData.filter(elem => {
							return elem.bundleModelCode === modelCode;
						});
						window.sg.components.addonBundlePopup.callSearchAjax(fData[0], bundleData[0]);
						
						window.sg.components.notifyMePopup.showPopup(document.querySelector('.add-ons-evoucher-popup'));
						window.sg.components.notifyMePopup.reInit();
					} else {
						$(".pdd16-step-buying__evoucher-title span").html(--selectedCount);
						if(isVoucher){
							voucherBalance = Number($('#voucherBalance').attr('data-price'));
							originVoucher = Number($('#voucherBalance').attr('data-oriprice'));
							voucherCharge = Number($('#voucherCharge').attr('data-price'));
							originPrice -= Number($(this).attr('data-originprice'));
							savePrice -= Number(parseFloat($(this).attr('data-saveprice')).toFixed(2));
							setVoucherPrice(price, false);
							
							if(!voucherCharge){ 
							}else{ 
								if(voucherCharge >= Number(addOnPrice)){
									productPrice -= Number(addOnPrice);
								}else{
									productPrice -= voucherCharge;
								}
							}
						}else{
							productPrice -= Number(addOnPrice);
						}
						if( seletecBundlePopupData[modelCode] ){
							seletecBundlePopupData[modelCode] = [];
						}
					}
				}
			}else{
				addOnPrice = $(this).attr('data-price');
				var productIndex = index.split('-');
				var selectModel = productListData[productIndex[0]].category.productList[productIndex[1]].modelList[productIndex[2]];
				var addedIndex = selectIndexList.indexOf(index);
				if($(this).hasClass('cta--on') && !$(this).hasClass('js-cta-stock')){
					selectIndexList.push(index);
					$(".pdd16-step-buying__evoucher-title span").html(++selectedCount);
					if(isVoucher){
	                	voucherBalance = Number($('#voucherBalance').attr('data-price'));
						if( voucherBalance - Number(addOnPrice) < 0){
	                		productPrice += -(voucherBalance - Number(addOnPrice));
						}
						originPrice += Number($(this).attr('data-oriprice'));
						savePrice += Number(parseFloat($(this).attr('data-saveprice')).toFixed(2));
						setVoucherPrice(price, true);
					}else{
						productPrice += Number(addOnPrice);
					}
					
					selectProductList.push(modelCode);
					const modelName = $(this).closest('.pdd16-step-buying__card').find('.pdd16-step-buying__card-title strong').html();
					const imgPath = $(this).closest('.pdd16-step-buying__card').find('.image img');
					const imgList = {
							modelCode: modelCode,
							modelName: modelName,
							src: imgPath.attr('data-img-src')
					}
					selectProductImgList.push(imgList);
					
				}else if(!$(this).hasClass('cta--on') && !$(this).hasClass('js-cta-stock') ){
					$(".pdd16-step-buying__evoucher-title span").html(--selectedCount);
					selectIndexList.splice(addedIndex, 1);
					if(isVoucher){
	                	voucherBalance = Number($('#voucherBalance').attr('data-price'));
	                	originVoucher = Number($('#voucherBalance').attr('data-oriprice'));
	                	voucherCharge = Number($('#voucherCharge').attr('data-price'));
						originPrice -= Number($(this).attr('data-oriprice'));
						savePrice -= Number(parseFloat($(this).attr('data-saveprice')).toFixed(2));
						setVoucherPrice(price, false);
						if(!voucherCharge){ 
						}else{ 
							if(voucherCharge >= Number(addOnPrice)){
								productPrice -= Number(addOnPrice);
							}else{
								productPrice -= voucherCharge;
							}
						}
					}else{
						productPrice -= Number(addOnPrice);
					}
					
					for(let i = 0; i < selectProductList.length; i++){
						if(selectProductList[i] == modelCode){
							selectProductList.splice(i,1);
							i--;
							break;
						}
					}
					selectProductImgList = selectProductImgList.filter(function(elem){
						return modelCode !== elem.modelCode;
					});
				}
			}
			totalPrices = Granite.I18n.get(rice / Number(monthly), currency)) + ' ' + Granite.I18n.get("for {0} mos",monthly) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(productPrice, currency);
			monthPrice = totalPrices.split(" " + orI18n + " ");

			if( isVDSTEPBUYING ){
				if( !priceHtml ){
					priceHtml = $(".pdd16-step-buying__header-price").html();
				}
				if( selectProductList.length > 0 ){
					const pdModelCode = $('#modelCode').val();
					let productCodes = `${pdModelCode},`
					selectProductList.forEach(function(modelCode, idx){
						productCodes += modelCode + (selectProductList.length-1 === idx ? '' : ',');
					});
					
					let addonListHtml = '';
					selectProductImgList.forEach(function(elem){
						addonListHtml += `
							<div class="pdd16-step-buying__add-on-list-box swiper-slide" role="listitem">
								<div class="pdd16-step-buying__add-on-list-icon">
									<svg class="icon close" focusable="false">
									<use xlink:href="#plus-bold" href="#plus-bold"></use>
									</svg>
								</div>
								<div class="pdd16-step-buying__add-on-list-image">
									<div class="image">
										<img class="image__preview lazy-load responsive-img" data-desktop-src="" data-mobile-src="" alt="" role="img" data-comp-name="image">
										<img class="image__main lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(elem.src, "$48_48_PNG$")}" data-mobile-src="${addOnsImgDomain(elem.src, "$32_32_PNG$")}" alt="" role="img" data-comp-name="image">
									</div>
								</div>
								<div class="pdd16-step-buying__add-on-list-product-name">${elem.modelName}</div>
							</div>`;
					});
					const stepBuyingHeaderArea = $('.pdd16-step-buying__header');
					stepBuyingHeaderArea.addClass('pdd16-step-buying__header-add-on-product');
					stepBuyingHeaderArea.find('.swiper-container').show();
					stepBuyingHeaderArea.find('.swiper-wrapper').html(addonListHtml);
					stepBuyingHeaderArea.find('.pdd16-step-buying__quantity strong').html(`+${selectProductList.length}`)
	
					window.sg.components.dynamic.detailSharedObj.commonApiModel.callSimulatecartAjax(productCodes, function (data, isSuccess) {
						if( data ){
							if( data.subTotal && data.totalDiscounts && data.totalPrice ){

								const priceInfo = dynamic.detailSharedObj.drawObj.price.priceWrapper.info;
								const proudctPriceInfo = window.sg.components.dynamic.detailSharedObj.proudctPriceInfo;

								const salePriceOnPDP = proudctPriceInfo.salePrice;
								const originalPriceOnPDP = proudctPriceInfo.orignalPrice;
								const savePriceOnPDP = priceInfo.unformattedSavePrice;
								const discountAmountOnPDP = salePriceOnPDP - (originalPriceOnPDP - savePriceOnPDP);

								const addOnProductPrice = data.subTotal.value - proudctPriceInfo.salePrice;
								const addOnProductDiscountAmount = data.totalDiscounts.value - (originalPriceOnPDP - salePriceOnPDP);

								const beforePrice = currencyComma(addOnProductPrice + originalPriceOnPDP + addOnProductDiscountAmount, currency); //    
								const savePrice = currencyComma((data.totalDiscounts.value + (discountAmountOnPDP > 0 ? discountAmountOnPDP : 0)), currency); //   
								let salePrice = currencyComma((data.totalPrice.value - (discountAmountOnPDP > 0 ? discountAmountOnPDP : 0)), currency); //    
								if( monthlyCheckedFlag ) { //     
									salePrice = data.totalPrice.formattedValue;
								}
								const unformattedSalePrice = data.totalPrice.value;
								priceHtml = `
									<div class="pdd16-step-buying__header-price-text">`;
								if( monthlyCheckedFlag ){
									priceHtml += `<strong>${fromI18n} ${monthPrice[0].replace(fromI18n, "")}<br>
												${orI18n} ${salePrice}</strong>`;
								}else{
									priceHtml += `<strong>${salePrice}</strong>`;
								}
								// COMP6FE-1599 [EPP] SEPOL MSRP Price  :   (!eppPl )
								if ( !eppPl && !lowestWasPriceCountry ){
									priceHtml += `	<div class="pdd16-step-buying__header-price-save">
														<del class="was-text" data-orignal-price=${beforePrice}>${beforePrice}</del>
													<span class="sale-text" data-save-price=${savePrice}>${Granite.I18n.get("Save {0}", savePrice)}</span>
													</div>
												</div>`;
								} else {
									priceHtml += `</div>`;
								}
								
								priceHtml += `<input type="hidden" class="hiddenPrice" value="${unformattedSalePrice}">`;
							}
							$(".pdd16-step-buying__header-price").html(priceHtml);
						}
					});
				}else{
					
					const stepBuyingHeaderArea = $('.pdd16-step-buying__header');
					stepBuyingHeaderArea.removeClass('pdd16-step-buying__header-add-on-product');
					stepBuyingHeaderArea.find('.swiper-container').hide();
					priceHtml = sharedObj.vdAddonInitPriceHtml;
				}
			}else{
				if( monthlyCheckedFlag ){
					priceHtml = `
						<p class="hidden"><strong>${monthly18n}</strong></p>
						<p class="pdd16-step-buying__header-price-text"><strong>${fromI18n} ${monthPrice[0].replace(fromI18n, "")}</strong><br>
							${orI18n} ${monthPrice[1]}</p>
						<input type="hidden" class="hiddenPrice" value="${productPrice}">`;
				}else{
					priceHtml = `
						<p class="hidden"><strong>${monthly18n}</strong></p>
						${siteCode !== 'mx' ? 
						`<p class="pdd16-step-buying__header-price-text"><strong>${fromI18n} ${monthPrice[1]}</strong></p>` :
						`<p class="pdd16-step-buying__header-price-text"><strong>${monthPrice[1]}</strong></p>`}
						<input type="hidden" class="hiddenPrice" value="${productPrice}">`;
				}
			}
			
			if (isVoucher) {
				if(!savePrice || savePrice < 0){ //  
					selectedItem = currencyComma(originPrice,currency);
				}else{ //  
					selectedItem = currencyComma(originPrice,currency) + ' ' + Granite.I18n.get("Save") + ' ' + '<del>' + currencyComma(savePrice, currency) + '</del> ' + currencyComma(originPrice-savePrice,currency);
				}
				$('#selectedItem').html(selectedItem);
			}
			
             $(".pdd16-step-buying__header-price").html(priceHtml);
             $(".pdd16-step-buying__footer-sum").html(priceHtml);
             
             if($(".tab__list").attr('style') === undefined){
      			$(document).off("click",'#freeGiftPopup .layer-popup__close');
      			$(document).on("click",'#freeGiftPopup .layer-popup__close',function(){
      				window.sg.components.stepbuying.clearAll($('.bundleSelect'));
      				closeButtonThis.removeClass("cta--on");
      			});
      		 }
             
             setCtaTagging();
             window.sg.components.stepbuying.init();
		});
		
		/* Card Learn More   Event (VD Step Buying) */
		$(".pdd16-step-buying").off("click", ".pdd16-step-buying__card .pdd16-step-buying__card-cta-learn-more button");
		$(".pdd16-step-buying").on("click", ".pdd16-step-buying__card .pdd16-step-buying__card-cta-learn-more button", function () {
			const _this = $(this);
			const productIndex = _this.closest(".pdd16-step-buying__card").attr("data-index").split('-');
			const selectModel = productListData[productIndex[0]].category.productList[productIndex[1]].modelList[productIndex[2]];
			const thirdPASeller = productListData[productIndex[0]].category.productList[productIndex[1]].thirdPASeller;
			const categoryName = $('.pdd16-step-buying__footer-cta button').attr('data-category-name');
			const learnMorePopup = $('.pdd16-step-buying__layer-learn-more');
			learnMorePopup.find('.layer-popup__title').html(categoryName);
			
			const imageUrl = (selectModel.galleryImage && selectModel.galleryImage.length > 0) ? selectModel.galleryImage : [selectModel.thumbUrl];
			const imageAlt = (selectModel.galleryImage && selectModel.galleryImage.length > 0) ? selectModel.galleryImageAlt : [selectModel.thumbUrlAlt];
			let imageListHtml = '';
			if( imageUrl ){
				for(let idx in imageUrl){
					imageListHtml += `
					<div class="swiper-slide" role="listitem">
						<div class="image">
							<img class="image__preview lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(imageUrl[idx], "$290_240_PNG$")}" data-mobile-src="${addOnsImgDomain(imageUrl[idx], "$520_400_PNG$")}" alt="imageAlt[idx]" role="img">
							<img class="image__main lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(imageUrl[idx], "$290_240_PNG$")}" data-mobile-src="${addOnsImgDomain(imageUrl[idx], "$520_400_PNG$")}" alt="imageAlt[idx]" role="img">
						</div>
					</div>`;
				}
			}
			const isSwiperOption = imageUrl.length > 1 ? true : false;
			const imageHtml = `
				<div class="swiper-container basic-swiper" data-swiper-option='{
					"slidesPerView":"1","keepWrapper":true,"loop":false,"pagination":false,"componentEl":".pdd16-step-buying__learn-more-images","oferedSlidesBounds": true,"followFinger":roduct detail-image-index" an-ca="indication" an-ac="carousel" an-la="carousel:index:left">
						<span class="hidden">${Granite.I18n.get('Previous')}</span>
						<svg class="icon" focusable="false" aria-hidden="true"><use xlink:href="#previous-bold" href="#previous-bold"></use></svg>
					</button>
					<div class="swiper-wrapper" role="list">
						${imageListHtml}
					</div>
					<button type="button" class="swiper-button-next" an-tr="pdd16_step buying-product detail-image-index" an-ca="indication" an-ac="carousel" an-la="carousel:index:right">
						<span class="hidden">${Granite.I18n.get('Next')}</span>
						<svg class="icon" focusable="false" aria-hidden="true"><use xlink:href="#next-bold" href="#next-bold"></use></svg>
					</button>`;
			learnMorePopup.find('.pdd16-step-buying__learn-more-images').html(imageHtml);
			
			let uspHtml = '';
			const isHybrisIntg = $("#shopIntegrationFlag").val() === "Hybris-intg";
			const isGlobal = !isGPv2 && !isHybrisIntg && !isNewHybris;
			if( isHybrisIntg ){
				const promotionList = [{key: selectModel.tradeIn, value: selectModel.tradeInDesc}, {key: selectModel.premiumCare, value: selectModel.premiumCareDesc},
						{key: selectModel.financing, value: selectModel.financingDesc}, {key: selectModel.upgrade, value: selectModel.upgradeDesc}, {key: (selectModel.storePromotions ? 'Y' : 'N'), value: selectModel.storePromotions}];
				for(let idx in promotionList){
					if(promotionList[idx].key === 'Y'){
						uspHtml += `<li class="pdd16-step-buying__learn-more-feature-item" role="listitem">${promotionList[idx].value}</li>`;
					}
				}
			}else if( isGlobal ){
				if( selectModel.vd3PAMarketingMessage && selectModel.vd3PAMarketingMessage.length > 0 ){
					for(let message of selectModel.vd3PAMarketingMessage){
						uspHtml += `<li class="pdd16-step-buying__learn-more-feature-item" role="listitem">${message}</li>`;
					}
				}
			}
			if( selectModel.uspText && selectModel.uspText.length > 0 ){
				for(let usp of selectModel.uspText){
					uspHtml += `	<li class="pdd16-step-buying__learn-more-feature-item" role="listitem">${usp}</li>`;
				}
			}
			let featureHtml = '';
			if( selectModel.keySummary && selectModel.keySummary.length > 0 ){
				for(let keySummary of selectModel.keySummary){
					if( keySummary.displayType.toLowerCase() === 'feature' ){
						featureHtml += `
							<li class="pdd16-step-buying__learn-more-feature-icon-item">
								<div class="pdd16-step-buying__learn-more-feature-icon-image">
									<div class="image">
										<img class="image__preview lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(keySummary.imgUrl, "$64_64_PNG$")}" data-mobile-src="${addOnsImgDomain(keySummary.imgUrl, "$96_96_PNG$")}" alt="${keySummary.imgAlt}" role="img">
										<img class="image__main lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(keySummary.imgUrl, "$64_64_PNG$")}" data-mobile-src="${addOnsImgDomain(keySummary.imgUrl, "$96_96_PNG$")}" alt="${keySummary.imgAlt}" role="img">
									</div>
								</div>
								<p class="pdd16-step-buying__learn-more-feature-icon-text">${keySummary.title}</p>
							</li>`;
					}
				}
			}
			const contentHtml = `
				<h3 class="pdd16-step-buying__learn-more-title">${selectModel.displayName}</h3>
				<div class="pdd16-step-buying__learn-more-info">
					<p class="pdd16-step-buying__learn-more-sku">${selectModel.modelCode}</p>
					${thirdPASeller ? `<strong class="pdd16-step-buying__learn-more-seller">Granite.I18n.get('Seller') : thirdPASeller</strong>` : ``}
				</div>
				${selectModel.ratings && selectModel.reviewCount ?
				`<div class="pdd16-step-buying__learn-more-review">
					<span class="rating">
						<span class="rating__inner">
							${gridRating(selectModel.ratings, selectModel.reviewCount)}
						</span>
					</span>
				</div>` : ``}
				<ul class="pdd16-step-buying__learn-more-feature" role="list">
					${uspHtml}
				</ul>
				${selectModel.pdpUrl ? 
				`<div class="pdd16-step-buying__learn-more-cta">
					<a class="cta cta--underline cta--black cta--icon" href="${selectModel.pdpUrl}" aria-label="Link Title" target="_blank" 
						an-tr="pdd16_step buying-product detail-cta-button" an-ca="product click" an-ac="bridge" an-la="vd add-on:learn more popup:learn more" data-modelcode="${selectModel.modelCode}" data-modelname="${selectModel.modelName}">
						${Granite.I18n.get('Product detail')}
						<svg class="icon" focusable="false" aria-hidden="true"><use xlink:href="#outlink-bold" href="#outlink-bold"></use></svg>
					</a>
				</div>` : ``}
				${featureHtml ? 
				`<ul class="pdd16-step-buying__learn-more-feature-icon">
					${featureHtml}
				</ul>` : ``}`;
			learnMorePopup.find('.pdd16-step-buying__learn-more-content').html(contentHtml);
			
			window.sg.components.stepbuying.activePopup(document.querySelector('#layerPopupLearnMore'));
		});
		
		setCtaTagging();
	}
	
	function gridRating(ratings, reviewCount){
		if( !ratings ){ 
			ratings = 0; 
		}
		// rating  
		const tmpCount = Math.pow(10,1);
		ratings = Math.round(ratings*tmpCount)/tmpCount;
		const ratingValue = parseFloat(ratings).toFixed(1),
		fullStarCnt = parseInt(ratings);
		let cutStarWidthStyleNum = 0;
		cutStarWidthStyleNum = parseInt((ratingValue-fullStarCnt)*100);
		if(ratingValue !== "0.0"){
			ratings = ratingValue;
		}
	
		let latingHtml = `	<span class="rating__star-list">`;
		for(var j=0; j<fullStarCnt;j++){
			latingHtml += `		<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 100%;"></span></span>`;
		}
		if(fullStarCnt < 5 && fullStarCnt > 0){
			latingHtml += `		<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width:${cutStarWidthStyleNum}%;"></span></span>`;
			for(var k=4;k>fullStarCnt;k--){
				latingHtml += `	<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>`;
			}
		} else if ( fullStarCnt === 0 ){
			for(var empty_idx=0;empty_idx<5;empty_idx++){
				latingHtml += `	<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>`;
			}
		}
		latingHtml += `		</span>
							<strong class="rating__point"><span class="hidden">${Granite.I18n.get('Product Ratings')} : </span><span>${ratings}</span></strong>
							<em class="rating__review-count">(<span class="hidden">${Granite.I18n.get('Number of Ratings')} :</span><span>${reviewCount ? reviewCount : 0}</span>)</em>`;
		return latingHtml;
	}

	function setCtaTagging() {
		var cartEl = $("#primaryInfoGoCartAddOn");
		var checkEl = $("#primaryInfoCheckOutAddOn");
		var nextEl = $("#nextBtn");
		var ctaEl = $("#primaryInfoGoCartAddOn, #primaryInfoCheckOutAddOn, #voucherGoCartAddOn, #skipGoCartAddOn");

		const categoryOrder = [];
		
		if( isGPv2 || isOldHybris ){ // old-hybirs : order 
			for( let i in productListData ){
				categoryOrder.push(productListData[i].category.display_name);
			}
		}
		
		if( isNewHybris ){ // new-hybris : order  
			const productListArr = [];
			for( let i in productListData ){
				productListArr.push(productListData[i]);
			}
			productListArr.sort((a,b) => a.category.order - b.category.order);
			for( let i of productListArr ){
				categoryOrder.push(i.category.display_name);
			}
		}
		
		let tabTitle = $(".tab__item--active").length > 0 ? categoryOrder[$(".tab__item--active").index()] : categoryOrder[0];
		
		if (selectIndexList.length > 0) {
			var modelCode = "";
			var modelName = "";
			var modelPrice = "";
			var discountprice = "";
			var pviTypeName = "";
			var pviSubtypeName = "";
			var categorySubTypeEngName = "";
			var modelrevenue = "";
			var modelqty = "";
			displayName = "";
			for (var i = 0; i < selectIndexList.length; i++) {
				var selectIndex = selectIndexList[i]; // familyNum - modelNum
				var categoryKey = selectIndex.split('-')[0];
				var familyIdx = selectIndex.split('-')[1];
				var modeIdx = selectIndex.split('-')[2];
				var model = productListData[categoryKey].category.productList[familyIdx].modelList[modeIdx];
				var princeInfo = betterTogetherApi.setPriceInfo(model);
				var price = princeInfo.productPrice;
				var qty = 1;
				var comma = '';
				var colon = '';
				if (i > 0) {
					comma = ',';
					colon = ';';
				}
				modelCode += comma + model.modelCode;
				modelName += comma + model.modelName;
				displayName += comma + model.displayName;
				modelPrice += comma + price;
				discountprice += comma + princeInfo.promotionPrice;
				pviTypeName += comma + model.pviTypeName;
				pviSubtypeName += comma + model.pviSubtypeName;
				categorySubTypeEngName += comma + model.pviSubtypeName + ' ' + model.pviTypeName;
				modelrevenue += comma + price;
				modelqty += comma + qty;
			}
			pviTypeName = pviTypeName.toLowerCase();
			pviSubtypeName = pviSubtypeName.toLowerCase();
			categorySubTypeEngName = categorySubTypeEngName.toLowerCase();

			if( !isVDSTEPBUYING ){
				if (!isVoucher) {
					cartEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-addedcart")
						.attr("an-ca", "ecommerce")
						.attr("an-ac", "addToCart")
						.attr("an-la", "add-on:go to cart");
	
					checkEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-button")
						.attr("an-ca", "ecommerce")
						.attr("an-ac", "addToCart")
						.attr("an-la", "add-on:checkout");
				} else {
					cartEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-button")
						.attr("an-ca", "ecommerce")
						.attr("an-ac", "addToCart")
						.attr("an-la", "evoucher:go to cart");
	
					checkEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-button")
						.attr("an-ca", "ecommerce")
						.attr("an-ac", "addToCart")
						.attr("an-la", "evoucher:checkout");
				}
			}else{
				if( $(".cta--step").attr('id') === 'nextBtn' ){
					nextEl.attr("an-tr", "pdd16_step buying-" + pageTrack + "-button-next")
						.attr("an-ca", "content click")
						.attr("an-ac", "feature")
						.attr("an-la", "vd add-on:" + tabTitle.toLowerCase() + ":next")
						.attr("data-category-name", tabTitle);	// vd stepbuying : learn more   
				}else{
					cartEl.attr("an-tr", "pdd16_step buying-" + pageTrack + "-cta-cart page")
						.attr("an-ca", "ecommerce")
						.attr("an-ac", "addToCart")
						.attr("an-la", "vd add-on:checkout")
						.attr("data-category-name", tabTitle);	// vd stepbuying : learn more   
				}
			}
			ctaEl.attr("data-modelcode", modelCode)
				.attr("data-modeldisplay", displayName)
				.attr("data-modelname", modelName)
				.attr("data-modelrevenue", modelrevenue)
				.attr("data-modelprice", modelPrice)
				.attr("data-pvitype", pviTypeName)
				.attr("data-pvisubtype", pviSubtypeName)
				.attr("data-discountprice", discountprice)
				.attr("data-pimsubtype", categorySubTypeEngName)
				.attr("data-modelqty", modelqty);
		} else {
			if( !isVDSTEPBUYING ){
				if (!isVoucher) {
					cartEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-notaddedcart")
						.attr("an-ca", "content click")
						.attr("an-ac", "feature")
						.attr("an-la", "add-on:go to cart");
	
					checkEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-notaddedcart")
						.attr("an-ca", "content click")
						.attr("an-ac", "feature")
						.attr("an-la", "add-on:checkout");
				} else {
					cartEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-popup-cart")
						.attr("an-ca", "content click")
						.attr("an-ac", "feature")
						.attr("an-la", "evoucher:go to cart");
	
					checkEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-popup-cart")
						.attr("an-ca", "content click")
						.attr("an-ac", "feature")
						.attr("an-la", "evoucher:checkout");
				}
			}else{
				if( $(".cta--step").attr('id') === 'nextBtn' ){
					nextEl.attr("an-tr", "pdd16_step buying-" + pageTrack + "-button-next")
						.attr("an-ca", "content click")
						.attr("an-ac", "feature")
						.attr("an-la", "vd add-on:" + tabTitle.toLowerCase() + ":next")
						.attr("data-category-name", tabTitle);	// vd stepbuying : learn more   
				}else{
					cartEl.attr("an-tr", "pdd16_step buying-" + pageTrack + "-button-checkout")
						.attr("an-ca", "content click")
						.attr("an-ac", "feature")
						.attr("an-la", "vd add-on:" + tabTitle.toLowerCase() + ":checkout")
						.attr("data-category-name", tabTitle);	// vd stepbuying : learn more   
				}
			}
			ctaEl.removeAttr("data-modelcode")
				.removeAttr("data-modeldisplay")
				.removeAttr("data-modelname")
				.removeAttr("data-modelrevenue")
				.removeAttr("data-modelprice")
				.removeAttr("data-pvitype")
				.removeAttr("data-pvisubtype")
				.removeAttr("data-discountprice")
				.removeAttr("data-pimsubtype")
				.removeAttr("data-modelqty");
		}
		nextEl.removeAttr("data-modelcode")
			.removeAttr("data-modeldisplay")
			.removeAttr("data-modelname")
			.removeAttr("data-modelrevenue")
			.removeAttr("data-modelprice")
			.removeAttr("data-pvitype")
			.removeAttr("data-pvisubtype")
			.removeAttr("data-discountprice")
			.removeAttr("data-pimsubtype")
			.removeAttr("data-modelqty");
	}
	
	function goCart( isCheckOut=false ){
		const modelList = [];
		for( const modelCode of selectProductList ){
			modelList.push(modelCode);
		}
		if( isGPv2 ){
			if( sharedObj.giftFlag && sharedObj.globalServiceInfo.gift && sharedObj.globalServiceInfo.gift.modelCode ){
				modelList.push(sharedObj.globalServiceInfo.gift.modelCode);
			}
		}
		for( const parentCode in seletecBundlePopupData ){
			for( const modelCode of seletecBundlePopupData[parentCode] ){
				modelList.push(modelCode);
			}
		}
		if( isCheckOut ){
			dynamic.DetailAfterEvent.checkOutCta(modelList, true, true, selectedGift);
		} else {
			dynamic.DetailAfterEvent.addToCartCta(modelList, true, true, selectedGift);
		}
	}
	
	function moveCart( isCheckOut=false ){
		if( isCheckOut ){
			dynamic.DetailAfterEvent.checkOutCta([], true, true, selectedGift);
		} else {
			dynamic.DetailAfterEvent.addToCartCta([], true, true, selectedGift);
		}
	}
	
	function hasBundleResult(){
		if( Object.keys(seletecBundlePopupData).length > 0 ){
			for(const item in seletecBundlePopupData){
				if( seletecBundlePopupData[item].length > 0 ) {
					return true;
				}
			}
		}
		return false;
	}
	
	function setVoucherPrice(price, addFlag) {
		var voucherTotal = $("#voucherTotal");
		var voucherBalance = $("#voucherBalance");
		var voucherCharge = $("#voucherCharge");
		var totalPrice = parseFloat(voucherTotal.attr("data-price") || 0);
		var voucherOriPrice = parseFloat(voucherBalance.attr("data-oriprice") || 0);
		var voucherPrice;
		var chargePrice;
		if (addFlag) {
			totalPrice += price;
		} else {
			totalPrice = Number((parseFloat(totalPrice) - parseFloat(price)).toFixed(2));
		}
		voucherPrice = Number((parseFloat(voucherOriPrice) - parseFloat(totalPrice)).toFixed(2));

		if (voucherPrice < 0) {
			chargePrice = -voucherPrice;
			voucherPrice = 0;
		} else {
			chargePrice = 0;
		}
		voucherTotal.attr("data-price", totalPrice);
		voucherBalance.attr("data-price", voucherPrice);
		voucherCharge.attr("data-price", chargePrice);
		voucherTotal.html(currencyComma(totalPrice, currency));
		voucherBalance.html(currencyComma(voucherPrice, currency));
		voucherCharge.html(currencyComma(chargePrice, currency));
	}
	
	$(document).off("click", ".pdd16-step-buying__evoucher-cta .cta--clear-all");
	$(document).on("click", ".pdd16-step-buying__evoucher-cta .cta--clear-all", function () {
		const hasBundle = hasBundleResult();
		if (selectProductList.length > 0 || hasBundle) {
			confirmPopup(deleteConfirmI18n, "voucherDelete", "voucherClearAll");
		}
	});
	
	$(document).off("click", "#voucherClearAll");
	$(document).on("click", "#voucherClearAll", function () {
		var initPrice = $('.pdd16-step-buying__header-price-text');
		
		for(let i = 0; i < initPrice.length; i++){
			initPrice[i].innerHTML = mainPrice;
			$('.hiddenPrice')[i].setAttribute('value',mainInitPrice);
		}
		selectedCount = 0;
		
		resetProduct();
		resetVoucherPrice();
		window.sg.components.stepbuying.clearAll(document.querySelector('.pdd16-step-buying'));
		$(".pdd16-step-buying__evoucher-title span").html(0);
	});

	$(document).off("click", "#primaryInfoGoCartAddOn");
	$(document).on("click", "#primaryInfoGoCartAddOn", function () {
		if (sharedObj.hasVoucher) {
			voucherPopup("GoCartAddOn");
		} else {
			goCart();
		}
	});

	$(document).off("click", "#primaryInfoCheckOutAddOn");
	$(document).on("click", "#primaryInfoCheckOutAddOn", function () {
		if (sharedObj.hasVoucher) {
			voucherPopup("CheckOutAddOn");
		} else {
			goCart();
		}
	});

	$(document).off("click", "#voucherGoCartAddOn");
	$(document).on("click", "#voucherGoCartAddOn", function () {
		goCart();
	});

	$(document).off("click", "#voucherCheckOutAddOn");
	$(document).on("click", "#voucherCheckOutAddOn", function () {
		goCart(true);
	});

	$(document).off("click", "#skipGoCartAddOn");
	$(document).on("click", "#skipGoCartAddOn", function () {
		moveCart();
	});

	$(document).off("click", "#skipCheckOutAddOn");
	$(document).on("click", "#skipCheckOutAddOn", function () {
		moveCart(true);
	});

	$(document).off("click", ".pdd16-step-buying__cta-more");
	$(document).on("click", ".pdd16-step-buying__cta-more", function () {
		window.sg.components.betterTogether.more();
		if ($(".scrollbar__contents .better-together__item").not(".is-item-visible").length === 0) {
			$(this).hide();
		}
	});
	
	$(document).off("click",".pdd16-step-buying .cta--skip");
	$(document).on("click",".pdd16-step-buying .cta--skip",function(){
		if (sharedObj.hasVoucher) {
			var alertlayer = $(".confirm-popup");
		    var alertTitle = alertlayer.find(".confirm-popup__title");
		    var alertText = alertlayer.find(".confirm-popup__desc");
		    var alertYes = alertlayer.find(".cta--contained");
		    var alertNo = alertlayer.find(".cta--outlined");
		    var voucherBalance = $("#voucherBalance");
			var voucherOriPrice = Number(voucherBalance.attr("data-oriPrice")) || 0;
			var msg = Granite.I18n.get("You didn't redeem your {0} credit.<br/>it will be gone once you press 'skip'.", currencyComma(voucherOriPrice, currency));
			alertYes.attr("id", ("skipGoCartAddOn" || null));
			alertText.html(msg);
		    alertTitle.html(Granite.I18n.get("Are you sure?"));
	        alertNo.html(Granite.I18n.get("Redeem"));
	        alertNo.show();
	        alertYes.html(Granite.I18n.get("Skip"));
	        window.sg.components.confirmPopup.showPopup();
		} else {
			moveCart();
		}
	});
	
	$(document).off("click",".pdd16-step-buying .cta--step");
	$(document).on("click",".pdd16-step-buying .cta--step", function(){
		const selectedCategoryOrder = $(".pdd16-step-buying .tab__item--active").index() + 1;
		const categoryLength = $(".pdd16-step-buying .tab__item").length;
		if( categoryLength === selectedCategoryOrder ){
			$(this).attr('id','primaryInfoGoCartAddOn');
		}else{
			$(this).attr('id','nextBtn');
		}
	});
	
	$(document).off("click",".pdd16-step-buying .tab__item-title");
	$(document).on("click",".pdd16-step-buying .tab__item-title",function(){
		const headlineText = $(".pdd16-step-buying__headline");
		const selectedCategoryOrder = $(".pdd16-step-buying .tab__item--active").index() + 1;
		const categoryLength = $(".pdd16-step-buying .tab__item").length;
		const chooseYourI18n = siteCode === 'es' ? "Choose yours {0}" : "Choose your {0}";
		if(isVDSTEPBUYING){
			if(localConfigurator.get("useStaticTitle")){
				headlineText[0].innerHTML = localConfigurator.get("staticTitle");
			}else if(!sharedObj.hasVoucher){
				headlineText[0].innerHTML = Granite.I18n.get(chooseYourI18n, $(this)[0].innerText);
			}
			const btnText = $(this).parents('.pdd16-step-buying__tab-wrap').find('.cta--step');
			if( categoryLength === selectedCategoryOrder ){
				btnText.attr('id','primaryInfoGoCartAddOn');
			}else{
				btnText.attr('id','nextBtn');
			}
		}
		setCtaTagging();
	});
	
	$(document).off("click",".pdd16-step-buying #nextBtn");
	$(document).on("click",".pdd16-step-buying #nextBtn", function(){
		const headlineText = $(".pdd16-step-buying__headline");
		const selectedCategory = $(".pdd16-step-buying .tab__item--active").find('button');
		const selectedCategoryOrder = $(".pdd16-step-buying .tab__item--active").index() + 1;
		const categoryLength = $(".pdd16-step-buying .tab__item").length;
		const chooseYourI18n = siteCode === 'es' ? "Choose yours {0}" : "Choose your {0}";
		if(isVDSTEPBUYING){
			if(localConfigurator.get("useStaticTitle")){
				headlineText[0].innerHTML = localConfigurator.get("staticTitle");
			}else if(!sharedObj.hasVoucher){
				headlineText[0].innerHTML = Granite.I18n.get(chooseYourI18n, selectedCategory[0].innerText);
			}
			if( categoryLength === selectedCategoryOrder ){
				$(this).attr('id','primaryInfoGoCartAddOn');
			}else{
				$(this).attr('id','nextBtn');
			}
		}
		setCtaTagging();
	});
	
	//  add
	$(document).off("click",".add-ons-evoucher-popup #bundleAddOn");
	$(document).on("click",".add-ons-evoucher-popup #bundleAddOn", function(){
		var sumOriPrice = 0;
		var sumPromoPrice = 0;
		var sumSavePrice = 0;
		const itemList = [];
		const colorChip = $(".add-ons-evoucher-popup__item .option-selector-v2__color-code");
		if( colorChip ){
			colorChip.each(function(){
				if( $(this).closest('.option-selector-v2__swiper-slide').hasClass('is-checked') ){
					itemList.push($(this));
				}
			});
		}
		const memoryChip = $(".add-ons-evoucher-popup__item .option-selector-v2__size-text");
		if( memoryChip ){
			memoryChip.each(function(){
				if( $(this).closest('.option-selector-v2__swiper-slide').hasClass('is-checked') ){
					itemList.push($(this));
				}
			});
		}
		
		const parentModelCode = $(this).attr('data-parent-modelcode');
		seletecBundlePopupData[parentModelCode] = [];
		
		if( $(this).attr('data-price') ){
			sumOriPrice += Number($(this).attr('data-price'));
		}
		if( $(this).attr('data-promotionprice') ){
			sumPromoPrice += Number($(this).attr('data-promotionprice'));
		}
		if( $(this).attr('data-saveprice') ){
			sumSavePrice += Number($(this).attr('data-saveprice'));
		}
		$.each(itemList,function(idx,value){
			seletecBundlePopupData[parentModelCode].push(itemList[idx].attr('data-modelcode'));
		})
		
		var monthly = window.sg.components.dynamic.detailSharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal;
		var totalPrices = "";
		var priceHtml = "";
		var productPrice = Number($(".hiddenPrice")[0].getAttribute('value'));
		var voucherBalance = "";
		var selectedItem = "";
		$(".pdd16-step-buying__evoucher-title span").html(++selectedCount);
		if(isVoucher){
			var voucherBalance = Number($('#voucherBalance').attr('data-price'));
			if( voucherBalance - Number(sumPromoPrice) < 0 ){
				productPrice += -(voucherBalance - Number(sumPromoPrice));
			}
			originPrice += Number(sumOriPrice);
			savePrice += Number(sumSavePrice);
			setVoucherPrice(parseFloat(sumPromoPrice), true);
		}else{
			productPrice += Number(sumPromoPrice);
		}
		totalPrices = Granite.I18n.get("From {0}/mo", currencyComma(productPrice / Number(monthly), currency)) + ' ' + Granite.I18n.get("for {0} mos",monthly) + ' ' + Granite.I18n.get("or") + ' '+currencyComma(productPrice, currency);
		
		var MonthlyPrice = totalPrices.split(" " + orI18n + " ");
		if( monthlyCheckedFlag ){
			//  
			/*priceHtml = `
				<div class="pdd16-step-buying__header-price-text">
					<strong>${fromI18n} ${MonthlyPrice[0].replace(fromI18n, "")}</strong><br>
					${orI18n} ${MonthlyPrice[1]}
					${orignalPriceFormatted && savePrice ? 
						`<div class="pdd16-step-buying__header-price-save">
							<del class="was-text">${orignalPriceFormatted}</del>
							<span class="sale-text">${savePrice}</span>
						</div>` : ``
					}
				</div>
				<input type="hidden" class="hiddenPrice" value="${productPrice}">`;*/
				
			// 
			priceHtml = `
				<p class="hidden"><strong>${monthly18n}</strong></p>
				<p class="pdd16-step-buying__header-price-text"><strong>${fromI18n} ${MonthlyPrice[0].replace(fromI18n, "")}</strong><br>
					${orI18n} ${MonthlyPrice[1]}</p>
				<input type="hidden" class="hiddenPrice" value="${productPrice}">`;
		}else{
			//  
			/*priceHtml = `
				<div class="pdd16-step-buying__header-price-text">
					<strong>${salePriceFormatted}</strong>
					${orignalPriceFormatted && savePrice ? 
						`<div class="pdd16-step-buying__header-price-save">
							<del class="was-text">${orignalPriceFormatted}</del>
							<span class="sale-text">${savePrice}</span>
						</div>` : ``
					}
				</div>
				<input type="hidden" class="hiddenPrice" value="${productPrice}">`;
				*/
			// 
			priceHtml = `
				<p class="hidden"><strong>${monthly18n}</strong></p>
				<p class="pdd16-step-buying__header-price-text"><strong>${fromI18n} ${MonthlyPrice[1]}</strong></p>
				<input type="hidden" class="hiddenPrice" value="${productPrice}">`;
		}
		$(".pdd16-step-buying__header-price").html(priceHtml);
		$(".pdd16-step-buying__footer-sum").html(priceHtml);
		if (isVoucher) {
			if(!savePrice){//  
				selectedItem = currencyComma(originPrice,currency);
			}else{ //  
				selectedItem = currencyComma(originPrice,currency) + ' ' + Granite.I18n.get("Save") + ' ' + '<del>' + currencyComma(savePrice, currency) + '</del> ' + currencyComma(originPrice-savePrice,currency);
			}
			$('#selectedItem').html(selectedItem);
		}
		
		window.sg.components.notifyMePopup.closePopup();
	})
	
	//  close
	$(document).off("click",".add-ons-evoucher-popup .layer-popup__close");
	$(document).on("click",".add-ons-evoucher-popup .layer-popup__close", function(){
		const parentModelCode = $(this).attr('data-attr-parent');
		$.each($('.pdd16-step-buying__tab .bundleSelect'),function(idx,value){
			if( $(this).attr('data-modelcode') === parentModelCode ){
				$(this).find('span').text(addI18n);
				$(this).removeClass('cta--on');
			}
		})
	})
	
	function setSharedObj(Obj) {
		sharedObj = Obj;
	}
	
	dynamic.bridgePageCommonHybris = (function () {
		return {
			moveBridgePage: moveBridgePage,
			setSharedObj: setSharedObj
		}
	})();

})(window, window.jQuery);
((window, $) => {
	"use strict";

	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const currency = $("#priceCurrency").val();
	const siteCode = $("#siteCode").val();
	//const dynamic = window.sg.components.dynamic;
	//const sharedObj = dynamic.detailSharedObj;
	const isSEBN = (siteCode === "nl" || siteCode === "be" || siteCode === "be_fr");
	const isGPv2 = siteCode === "in";
	const isOldHybris = $("#shopIntegrationFlag").val() === "Hybris" || $("#shopIntegrationFlag").val() === "Hybris-intg";
	const isNewHybris = $("#shopIntegrationFlag").val() === "Hybris-new";
	const categorySubTypeCode = $("#categorySubTypeCode").val();
	const isVDSTEPBUYING = categorySubTypeCode.length > 2 && categorySubTypeCode.substring(0,2) === "04" || categorySubTypeCode.length > 4 && categorySubTypeCode.substring(0,4) === "0701";
	let lowestWasPriceCountry = ( siteCode === 'pl' || siteCode === 'si' || siteCode === 'gr' || siteCode === 'fi' || siteCode === 'it' || siteCode === 'se' || siteCode === 'no' || siteCode === 'dk' || siteCode === 'fr') ? true : false;
	
	let relatedProducts = {};
	let relatedProductsBundle = {};
	let relatedProductsBundleTotal = [];
	let relatedProductAPIData = {};
	let newData = {};
	let prodModelCode = "";
	let addOnCategoryId = [];
	let sortOrderArr = [];
	let productListDataBundle = "";
	let bundleCategoryName = "";
	
	const fromI18n = Granite.I18n.get("From");
	const orI18n = Granite.I18n.get("or");
	const monthly18n = Granite.I18n.get("Monthly Price:");
	const fullI18n = Granite.I18n.get("Full Price:");
	const addI18n = Granite.I18n.get("Add");
	const deleteConfirmI18n = Granite.I18n.get("Are you sure to remove this product?");
	
	// COMP6FE-1599 [EPP] SEPOL MSRP Price  :  
	const eppPl = $('#isEppPage').val() === 'true' && siteCode === "pl" ? true : false;
	// epp omnipricing 
	if ( $('#isEppPage').val() === 'true' ){
		if ( eppOmniPricingUseYn === "Y" ){
			lowestWasPriceCountry = true;
		} else {
			lowestWasPriceCountry = false;
		}
	}
	
	function getRelatedProductsSimpleInfo(modelCode) {
		const dynamic = window.sg.components.dynamic;
		const sharedObj = dynamic.detailSharedObj;
		if( isOldHybris ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjaxAddOnsOldHybris(false, sharedObj, modelCode, function (data, isSuccess) {
				if( data && data.length > 0 ){
					getRelatedData(false, data, isSuccess);
				}
			}, null, {
				"queryType": "ACCESSORIES"
			});
			
		}else if( isNewHybris ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjaxAddOns(modelCode, function (data, isSuccess) {
				if( data && data.length > 0 ){
					getRelatedData(false, data, isSuccess);
				}
			}, null, {
				"queryType": "ACCESSORIES"
			});
		}
	}
	
	// new vd
	function getRelatedProductsVdSimpleInfo(modelCode) {
		const dynamic = window.sg.components.dynamic;
		const sharedObj = dynamic.detailSharedObj;
		if( isOldHybris ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjaxAddOnsOldHybris(true, sharedObj, modelCode, function (data, isSuccess) {
				if( data && data.length > 0 ){
					getRelatedData(true, data, isSuccess);
				}
			}, null, {
				"queryType": "DISPLAY_ON_PDP"
			});
		}else if( isNewHybris ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjaxAddOns(modelCode, function (data, isSuccess) {
				if( data && data.length > 0 ){
					getRelatedData(true, data, isSuccess);
				}
			}, null, {
				"queryType": "DISPLAY_ON_PDP"
			});
		}
	}
	
	function getRelatedData( isNewVD, data, isSuccess ){
		const dynamic = window.sg.components.dynamic;
		const sharedObj = dynamic.detailSharedObj;
		const drawObj = sharedObj.drawObj;
		const view = sharedObj.view;
		let itemSet = drawObj.embedAddon.itemSet;
		if( isNewVD ){
			itemSet = drawObj.embedAddon.itemSet = [];
		}
		sharedObj.soundbarCategoryData = {};
		prodModelCode = modelCode;
		
		if( isOldHybris ){
			let cnt = 0;
			for(let i of data){
				for(let j of i.products){
					cnt++;
				}
			}
			if( itemSet.length >= cnt ){
				itemSet = [];
			}
			relatedProducts = {};
			relatedProductAPIData = data;
			
			let itemIdx = 0;
			for(let i = 0; i < data.length; i++){
				if (isSuccess && data[i].products != null && data[i].products.length > 0) {

				    // CRHQ-9299 [B2C][MX][MY] Ranking / Sorting for production on Addon Step
                    sortAddOnCategory(data[i].products);

					$.each(data[i].pelCode = obj.modelcode;
						var product = relatedProducts[modelCode] = {};
						product.modelCode = modelCode;
						product.name = obj.name;

						// CRHQ-9299 [B2C][MX][MY] Ranking / Sorting for production on Addon Step
                        if (obj.priority) {
                            product.priority = obj.priority;
                        }
						
						if (obj.imageUrl) {
							product.imageUrl = obj.imageUrl;
						}
						if (obj.imageUrlAlt) {
							product.imageUrlAlt = obj.imageUrlAlt;
						}
						if (obj.stocklevel) {
							product.stocklevel = obj.stocklevel;
						}
						if (obj.price && obj.priceValue) {
							product.priceValue = obj.priceValue;
							product.price = obj.price;
							product.promotionPriceValue = obj.priceValue;
							product.promotionPrice = obj.price;
						}
						if (obj.promotionPrice && obj.promotionPriceValue) {
							product.promotionPriceValue = obj.promotionPriceValue;
							product.promotionPrice = obj.promotionPrice;
						}
						
						// 2021.04.16 GroupCode
						if((obj.groupCode && obj.groupId == 0 ) || ( obj.groupCode && obj.groupId != 0 )){
							product.groupCode = obj.groupCode;
							product.groupId = obj.groupId;
						}
						if(isBundleCode(obj.modelcode)){
							sharedObj.hasBundle = true;
							bundleCategoryName = data[i].category.display_name;
							$.extend(obj, product);
							sharedObj.addonBundleIdx = i;
							sharedObj.addonBundleData = data[i];
							getRelatedProductsSimpleBundle(obj.modelcode);
						}
						
						if( isNewVD ){
							getEmbedAddonItem(sharedObj, obj, product, modelCode, itemSet, itemIdx);
							itemIdx++;
							
						}else{
							/*let isSoundbarCategory = false;
							if( isVDSTEPBUYING && (data[i].category.id.toLowerCase().indexOf("soundbar") > -1 || data[i].category.id.toLowerCase().indexOf("sound device") > -1) ){
								sharedObj.soundbarCategoryData.categoryTotalCount = data.length;
								isSoundbarCategory = true;
							}
							const isSoundbarCategoryData = sharedObj.soundbarCategoryData && Object.keys(sharedObj.soundbarCategoryData).length > 0 ? true : false;
							if( !sharedObj.isEmbedAddOn && !isSoundbarCategoryData ){
								drawObj.embedAddon.hasComponent = false;
							}*/
							if( sharedObj.isEmbedAddOn && sharedObj.embedAddon08 ){
								getEmbedAddonItem(sharedObj, obj, product, modelCode, itemSet, itemIdx);
								itemIdx++;
							}
						}
					});
				}
			}
			if(Object.keys(relatedProducts).length > 0 && !isNewVD){
				window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
				window.sg.components.dynamic.detailSharedObj.hasAddOns = true;
			}
			
			if( isNewVD ){
				sharedObj.vdRelatedProducts = relatedProducts;
				
				if( Object.keys(sharedObj.vdRelatedProducts).length > 0 && !sharedObj.showEmbedAddon ){
					drawEmbedAddon(sharedObj, itemSet, sharedObj.vdRelatedProducts, data, isSuccess);
				}
			}else{
				if( sharedObj.isEmbedAddOn && sharedObj.embedAddon08 ){
					drawEmbedAddon(sharedObj, itemSet, relatedProducts, data, isSuccess);
				}
			}
			
		}else if( isNewHybris ){
			let cnt = 0;
			for(let i of data){
				for(let j of i.products){
					cnt++;
				}
			}
			if( itemSet.length >= cnt ){
				itemSet = [];
			}
			relatedProducts = {};
			relatedProductAPIData = data;
			
			let itemIdx = 0;
			for(let i = 0; i < data.length; i++){
				if (isSuccess && data[i].products !=][IM] Ranking / Sorting for production on Addon Step
				    // CRHQ-9299 [B2C][MX][MY] Ranking / Sorting for production on Addon Step
				    sortAddOnCategory(data[i].products);

					$.each(data[i].products, function (idx, obj) {
						var modelCode = obj.modelcode;
						var product = relatedProducts[modelCode] = {};
						product.modelCode = modelCode;
						product.name = obj.name;

						// CRHQ-7899 [B2C][BC][IM] Ranking / Sorting for production on Addon Step
						if (obj.priority) {
                            product.priority = obj.priority;
                        }

						if (obj.picture) {
							product.imageUrl = obj.picture.url;
							product.imageUrlAlt = obj.picture.altText;
						}
						if (obj.stock) {
							product.stocklevel = obj.stock.stockLevelStatus;
						}
						if (obj.price && obj.price.value) {
							product.priceValue = obj.price.value;
							product.price = obj.price.formattedValue;
							product.promotionPriceValue = obj.price.value;
							product.promotionPrice = obj.price.formattedValue;
						}
						if (obj.promotionPrice && obj.promotionPrice.value) {
							product.promotionPriceValue = obj.promotionPrice.value;
							product.promotionPrice = obj.promotionPrice.formattedValue;
						}
						
						// 2021.04.16 GroupCode
						if((obj.groupCode && obj.groupId == 0 ) || ( obj.groupCode && obj.groupId != 0 )){
							product.groupCode = obj.groupCode;
							product.groupId = obj.groupId;
						}
						if(isBundleCode(obj.modelcode)){
							sharedObj.hasBundle = true;
							bundleCategoryName = data[i].category.display_name;
							$.extend(obj, product);
							sharedObj.addonBundleIdx = i;
							sharedObj.addonBundleData = data[i];
							getRelatedProductsSimpleBundle(obj.modelcode);
						}
						
						//       
						product.bundleCategoryName = data[i].category.display_name;
						
						if( isNewVD ){
							getEmbedAddonItem(sharedObj, obj, product, modelCode, itemSet, itemIdx);
							itemIdx++;
							
						}else{
							/*let isSoundbarCategory = false;
							if( isVDSTEPBUYING && (data[i].category.id.toLowerCase().indexOf("soundbar") > -1 || data[i].category.id.toLowerCase().indexOf("sound device") > -1) ){
								sharedObj.soundbarCategoryData.categoryTotalCount = data.length;
								isSoundbarCategory = true;
							}
							const isSoundbarCategoryData = sharedObj.soundbarCategoryData && Object.keys(sharedObj.soundbarCategoryData).length > 0 ? true : false;
							if( !sharedObj.isEmbedAddOn && !isSoundbarCategoryData ){
								drawObj.embedAddon.hasComponent = false;
							}*/
							if( sharedObj.isEmbedAddOn && sharedObj.embedAddon08 ){
								getEmbedAddonItem(sharedObj, obj, product, modelCode, itemSet, itemIdx);
								itemIdx++;
							}
						}
						
					});
				}
			}
			
			//       
			for( const idx in relatedProducts ){
				const product = relatedProducts[idx];
				if( product.bundleCategoryName === bundleCategoryName ){
					if( !isBundleCode(product.modelCode) ){
						delete relatedProducts[idx];
					}
				}
			}
			if( relatedProductAPIData.length > 0 ){
				relatedProductAPIData.forEach(function(product, idx){
					if( product.category.display_name === bundleCategoryName ){
						for( const jdx in product.products ){
							if( !isBundleCode(product.products[jdx].modelcode) ){
								relatedProductAPIData[idx].products.splice(jdx, 1);
							}
						}
					}
				});
			}
			//       
			
			if(Object.keys(relatedProducts).length > 0 && !isNewVD){j.embedAddon08 ){
					drawEmbedAddon(sharedObj, itemSet, relatedProducts, data, isSuccess);
				}
			}
		}
	}

    // CRHQ-9299 [B2C][MX][MY] Ranking / Sorting for production on Addon Step
	function sortAddOnCategory(products) {
	    // CRHQ-7899 [B2C][BC][IM] Ranking / Sorting for production on Addon Step
        products.sort(function (a, b) {
            //    0     
            if (!b.priority || b.priority == 0) {
                //   
                if (!a.priority || a.priority == 0) {
                    return 0;
                }
                return -1;
            }

            if (a.priority == 0) {
                return 1;
            }

            return a.priority - b.priority;
        });
	}
	
	function getEmbedAddonItem(sharedObj, obj, product, modelCode, itemSet, itemIdx){
		const drawObj = sharedObj.drawObj;
		const promotionPriceValue = isOldHybris ? obj.promotionPriceValue  : (obj.promotionPrice ? obj.promotionPrice.value : '');
		const priceValue = isOldHybris ? obj.priceValue : obj.price.value;
		const salePriceValue = `${obj.promotionPrice && promotionPriceValue ? promotionPriceValue : ''}`;
		const savePriceValue = `${salePriceValue ? (priceValue - promotionPriceValue) : ''}`;
		const savePrice = `${salePriceValue ? Granite.I18n.get("Save {0}", currencyComma(savePriceValue, currency)) : ''}`;
		let isOOS = null;
		let oosClass = null;
		if(product.stocklevel.toLowerCase() === 'outofstock'){
			isOOS = true;
			oosClass = ' add-on-product--out-of-stock';
		}
		drawObj.embedAddon.hasComponent = true;
		drawObj.embedAddon.title = Granite.I18n.get("Add-on Items");
		
		if( siteCode !== 'cl' ){
			drawObj.embedAddon.description = Granite.I18n.get("Additional items to complement your purchase");
		}
		
		//CRHQ-8673
		let categoryCode08 = (sharedObj.categoryTypeCode)? sharedObj.categoryTypeCode.substring(0, 2) :'';
		if( siteCode == 'pe' && categoryCode08 === '08'){
			drawObj.embedAddon.title = Granite.I18n.get("Add-on Items(08)");
			drawObj.embedAddon.description = Granite.I18n.get("Additional items to complement your purchase(08)");
		}
		
		itemSet.push(
			{
				'index' : itemIdx,
				'name' : obj.name,
				'nameToLowerCase' : obj.name ? obj.name.toLowerCase() : '',
				'groupCode' : obj.groupCode.toLowerCase(),
				'modelCode' : modelCode,
				//'description' : Granite.I18n.get("description"),
				'finalPrice' : product.promotionPrice,
				'finalPriceValue' : product.promotionPriceValue,
				'originalPrice' : (savePriceValue && !isOOS && !eppPl) ? product.price : null,
				'originalPriceValue' : (savePriceValue && !isOOS) ? obj.price.value : null,
				'savePrice' : (savePriceValue && !isOOS && !eppPl) ? savePrice : null,
				'savePriceValue' : (savePriceValue && !isOOS) ? savePriceValue : null,
				'isOOS' : isOOS,
				'oosClass' : oosClass,
				'revenue' : obj.price.value, // 
				'isVDSTEPBUYING' : isVDSTEPBUYING ? isVDSTEPBUYING : null,
				'isLearnMorePopup' : isVDSTEPBUYING || sharedObj.embedAddon08
			}
		)
	}
	
	function drawEmbedAddon(sharedObj, itemSet, relatedProducts, data, isSuccess){
		sharedObj.showEmbedAddon = true;
		const drawObj = sharedObj.drawObj;
		const view = sharedObj.view;
		window.sg.components.dynamic.detailSharedObj.commonApiModel.callSearchApiAjax(Object.keys(relatedProducts), function (data, isSuccess) {
			if (isSuccess && data.response.statusCode === 200 && data.response.resultData != null && data.response.resultData.productList != null) {
				const productList = data.response.resultData.productList;
				$.each(itemSet, function(i, relatedCode){
					$.each(productList, function (familyIdx, product) {
						var modelList = product.modelList;
						if (modelList != null) {
							$.each(modelList, function (modelIdx, model) {
								if(relatedCode.modelCode === model.modelCode){
									if( isVDSTEPBUYING || sharedObj.embedAddon08 || sharedObj.isEmbedAddOn ){
										if( !model.galleryImage && model.thumbUrl ){
											model.galleryImage = [model.thumbUrl];
											model.galleryImageAlt = [model.thumbUrlAlt];
										}
										itemSet[i].imgSrc = addOnsImgDomain(model.thumbUrl);
	t[i].imgSrcList = model.galleryImage;
										itemSet[i].imgAlt = model.thumbUrlAlt;
										itemSet[i].imgAltList = model.galleryImageAlt;
										itemSet[i].thirdPASeller = product.thirdPASeller;
										tradeInDesc;
										itemSet[i].premiumCare = model.premiumCare;
										itemSet[i].premiumCareDesc = model.premiumCareDesc;
										itemSet[i].financing = model.financing;
										itemSet[i].financingDesc = model.financingDesc;
										itemSet[i].upgrade = model.upgrade;
										itemSet[i].upgradeDesc = model.upgradeDesc;
										itemSet[i].sc;
										itemSet[i].storePromotions = model.storePromotions;
										itemSet[i].vd3PAMarketingMessage = model.vd3PAMarketingMessage;
										itemSet[i].uspText = model.uspText;
										itemSet[i].keySummary = model.keySummary;
										itemSet[i].ratings = model.ratings;
										itemSet[i].pdpUrl = model.pdpUrl;
										if( model.topFlags ){
											if( model.topFlags.iconTitle && model.topFlags.iconTypeCd ){
												let badgeType = model.topFlags.iconTypeCd;
												let badgeClass = '';
												switch( badgeType.replace(/ /g,'').toUpperCase() ){
													case 'N':
														badgeClass = 'badge-icon--bg-color-blue';
														break;
													case 'H':
														badgeClass = 'badge-icon--bg-color-red';
														break;
													case 'B':
														badgeClass = 'badge-icon--bg-color-orange';
														break;
													case 'U':
														badgeType = model.topFlags.iconTitle;
														badgeClass = 'badge-icon--bg-color-teal';
														break;
													default:
														break;
												}
												itemSet[i].iconTitle = model.topFlags.iconTitle;
												itemSet[i].iconClass = badgeClass;
											}
										}
									}else{
										itemSet[i].imgSrc = addOnsImgDomain(model.thumbUrl);
										itemSet[i].imgAlt = model.thumbUrlAlt;
									}
									itemSet[i].modelName = model.modelName;
									itemSet[i].pviType = model.pviTypeName ? model.pviTypeName.toLowerCase() : '';
									itemSet[i].pviSubtype = model.pviSubtypeName ? model.pviSubtypeName.toLowerCase() : '';
									itemSet[i].categorySubType = product.categorySubTypeEngName;
									let lowestWasPriceDisplay = true;
									if( lowestWasPriceCountry ){
										lowestWasPriceDisplay = false;
									}
									if( !lowestWasPriceDisplay ){
										itemSet[i].originalPrice = itemSet[i].originalPriceValue = itemSet[i].savePrice = itemSet[i].savePriceValue = null;
									}
								}
							});
						}
					});
				});
				if( itemSet.length > 0 ){
					view.embedAddonDraw( sharedObj, drawObj );
				}
			}
		});
	           return false;
        }
        return modelCode.substring(0,2) == 'F-'
    }

	function getRelatedProductsSimpleBundle(modelCode) {
		const dynamic = window.sg.components.dynamic;
		const sharedObj = dynamic.detailSharedObj;
		if( isOldHybris ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjaxOldHybris(sharedObj, modelCode, function (data, isSuccess) {
				relatedProductsBundle = {};
				relatedProductsBundle.bundleModelCode = modelCode;

				if (isSuccess && data.products != null && data.products.length > 0) {
					$.each(data.products, function (idx, obj) {
						var modelCode = obj.modelcode;
						var product = relatedProductsBundle[modelCode] = {};
						product.modelCode = modelCode;
						product.name = obj.name;
						
						if (obj.imageUrl) {
							product.imageUrl = obj.imageUrl;
						}
						if (obj.imageUrlAlt) j.priceValue) {
							product.priceValue = obj.priceValue;
							product.price = obj.price;
							product.promotionPriceValue = obj.priceValue;
							product.promotionPrice = obj.price;
						}
						if (obj.promotionPrice && obj.promotionPriceValue) {
							product.promotionPriceValue = obj.promotionPriceValue;
							product.promotionPrice = obj.promotionPrice;
						}
						// 2021.04.16 GroupCode
						if((obj.groupCode && obj.groupId == 0 ) || ( obj.groupCode && obj.groupId != 0 )){
							product.groupCode = obj.groupCode;
							product.groupId = obj.groupId;
						}
						
						if( obj.colorCode ){
							product.colorCode = obj.colorCode;
						}
					});
					relatedProductsBundleTotal.push(relatedProductsBundle);
				}
				sharedObj.addonBundleRelatedData = relatedProductsBundleTotal;
			}, null, {"queryType":"SELECTION_OF_BUNDLE"});
			
		}else if( isNewHybris ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjax(modelCode, function (data, isSuccess) {
				relatedProductsBundle = {};
				relatedProductsBundle.bundleModelCode = modelCode;
				if (isSuccess && data.products != null && data.products.length > 0) {
					$.each(data.products, function (idx, obj) {
						var modelCode = obj.modelcode;
						var product = relatedProductsBundle[modelCode] = {};
						product.modelCode = modelCode;
						product.name = obj.name;
						
						if (obj.picture) {
							product.imageUrl = obj.picture.url;
							product.imageUrlAlt = obj.picture.altText;
						}
						if (obj.stock) {
							product.stocklevel = obj.stock.stockLevelStatus;
						}
						if (obj.price && obj.price.value) {
							product.priceValue = obj.price.value;
							product.price = obj.price.formattedValue;
							product.promotionPriceValue = obj.price.value;
							product.promotionPrice = obj.price.formattedValue;
						}
						if (obj.promotionPrice && obj.promotionPrice.value) {
							product.promotionPriceValue = obj.promotionPrice.value;
							product.promotionPrice = obj.promotionPrice.formattedValue;
						}
						// 2021.04.16 GroupCode
						if((obj.groupCode && obj.groupId == 0 ) || ( obj.groupCode && obj.groupId != 0 )){
							product.groupCode = obj.groupCode;
							product.groupId = obj.groupId;
						}
						
						if( obj.colorCode ){
							product.colorCode = obj.colorCode;
						}
					});
					relatedProductsBundleTotal.push(relatedProductsBundle);
				}
				sharedObj.addonBundleRelatedData = relatedProductsBundleTotal;
			}, null, {"queryType":"SELECTION_OF_BUNDLE"});
		}
	}
	
	function getBundleSearchProductcard(callback){
		window.sg.components.dynamic.detailSharedObj.commonApiModel.callSearchApiAjax(Object.keys(relatedProductsBundle), function (data, isSuccess) {
			if (isSuccess && data.response.statusCode === 200 && data.response.resultData != null && data.response.resultData.productList != null) {
				var productList = data.response.resultData.productList;
				$.each(relatedProductsBundle, function(i,value){
					$.each(productList, function (familyIdx, product) {
						var modelList = product.modelList;
						if (modelList != null) {
							$.each(modelList, function (modelIdx, model) {
								var modelCode = model.modelCode;
								var stocklevel = relatedProductsBundle[modelCode].stocklevel || "";
	
								if (!relatedProductsBundle[modelCode]) {
									return;
								}
								if (!model.displayName) {
									model.displayName = relatedProductsBundle[modelCode].name || "";
								}
								model.thumbUrlAlt = relatedProductsBundle[modelCode].imageUrlAlt || "";
								model.priceDisplay = relatedProductsBundle[modelCode].price || "";
								model.promotionPriceDisplay = relatedProductsBundle[modelCode].promotionPrice || "";
								model.price = relatedProductsBundle[modelCode].priceValue || "";
								model.promotionPrice = relatedProductsBundle[modelCode].promotionPriceValue || "";
								model.stocklevel = stocklevel;
								model.isStock = !(stocklevel === "" || stocklevel.toUpperCase() === "OUTOFSTOCK");
								model.idx = String(familyIdx) + '-' + String(modelIdx) // familyNum
							});
						}
					});
				});
				
				productListDataBundle = productList;
				callback(productListDataBundle);
			}
		}, null, null);
	}
	
	function mergeReleatedToSearch( productList, relatedProducts ){
		$.each(relatedProducts, function(i,value){
			$.each(productList, function (familyIdx, product) {
				var modelList = product.modelList;
				if (modelList != null) {
				    // CRHQ-7899 [B2C][BC][IM] Ranking / Sorting for production on Addon Step
                    sortByPriority(modelList, product.chipOptions, relatedProducts);

					$.each(modelList, function (modelIdx, model) {
						var modelCode = model.modelCode;
						var stocklevel = relatedProducts[modelCode].stocklevel || "";
	
						if (!relatedProducts[modelCode]) {
							return;
						}
						if (!model.displayName) {
							model.displayName = relatedProducts[modelCode].name || "";
						}
						model.thumbUrlAlt = relatedProducts[modelCode].imageUrlAlt || "";
						model.priceDisplay = relatedProducts[modelCode].price || "";
						model.promotionPriceDisplay = relatedProducts[modelCode].promotionPrice || "";
						model.price = relatedProducts[modelCode].priceValue || "";
						model.promotionPrice = relatedProducts[modelCode].promotionPriceValue || "";
						model.stocklevel = stocklevel;
						model.isStock = !(stocklevel === "" || stocklevel.toUpperCase() === "OUTOFSTOCK");
						model.idx = String(familyIdx) + '-' + String(modelIdx) //familyNum - modelNum
					});
				}
			});
		});
	}

	// CRHQ-7899 [B2C][BC][IM] Ranking / Sorting for production on Addon Step
	/**
	 * shop  priority      
	 */
	function sortByPriority (modelList, chipOptions, relatedProducts) {
        $.each(modelList, function (modelIdx, model) {
            var modelCode = model.modelCode;
            if (!relatedProducts[modelCode]) {
                return;
            }
            var _priority = relatedProducts[modelCode].priority || 0;
            model.priority = _priority;

            if (model.fmyChipList) {
                $.each(model.fmyChipList, function (fmyChipIdx, fmyChip) {
                    if (fmyChip.fmyChipType && fmyChip.fmyChipType.toLowerCase() == "color") {
                        $.each(chipOptions, function (chipIdx, chip) {
                            if (chip.fmyChipType && chip.fmyChipType.toLowerCase() == "color") {
                                $.each(chip.optionList, function (optionIdx, optionData) {
                                    if (optionData.optionCode == fmyChip.fmyChipCode) {
                                        optionData.priority = _priority;
                                    }
                                });
                            }
                        });
                    }
                });
            }
        });

        // relatedProduct.priority    0 
        //  0 
        modelList.sort(function (a, b) {
            if (b.priority == 0) {
                if (a.priority == 0) {
                    return 0;
                }
                return -1;
            }

            if (a.priority == 0) {
                return 1;
            }

            return a.priority - b.priority;
        });

        //  0 
        $.each(chipOptions, function (idx, options) {
            if (options.fmyChipType.toLowerCase() == "color") {
                options.optionList.sort(function (a, b) {
                    if (b.priority == 0) {
                        if (a.priority == 0) {
                            return 0;
                        }
                        return -1;
                    }

                    if (a.priority == 0) {
                        return 1;
                    }

                    return a.priority - b.priority;
                });
            }
        });
	}

	function setCategoryInfo( searchProductList ){
		const dynamic = window.sg.components.dynamic;
		const sharedObj = dynamic.detailSharedObj;
		newData = {};
		var number = 0;
		var categoryData = {};
		let productListDatas = new Array();
		let familyIdx = new Array();
		
		// embed addon    continue  => addon  soundbar   ( new vd   )
		if( isVDSTEPBUYING && !sharedObj.newEmbedVDCountry ){
			const isSoundbarCategory = sharedObj.soundbarCategoryData && Object.keys(sharedObj.soundbarCategoryData).length > 0 ? true : false;
			const isEmbedSelected = sharedObj.globalServiceInfo.embedaddon && sharedObj.globalServiceInfo.embedaddon.length > 0 ? true : false;
			if( isVDSTEPBUYING && isSoundbarCategory && isEmbedSelected ){
				relatedProductAPIData = relatedProductAPIData.filter(function(data){
					const categoryId = data.category.id.replace(/_/g,'').replace(/ /g,'').toLowerCase();
					if( categoryId.indexOf("soundbar") === -1 && categoryId.indexOf("sounddevice") === -1 ){
						return data;
					}
				});
			}
		}
		
		$.each(relatedProductAPIData, function(idx,relatedProductAPI){
			var relatedProducts = relatedProductAPIData[idx].products;
			$.each(relatedProducts, function(i,relatedProductInfo){
				$.each(searchProductList, function(j,searchProduct){
					var searchModelList = searchProduct.modelList;
					$.each(searchModelList,function(k,searchModelInfo){
						if(relatedProductInfo.modelcode == searchModelInfo.modelCode){
							const inputData = newObjectSetting(searchProduct);
							if(familyIdx.indexOf(inputData.familyId) == -1){
								productListDatas.push(inputData)
								familyIdx.push(inputData.familyId);
							}
							categoryData = {
									category : {
											display_name : relatedProductAPI.category.display_name,
											id : relatedProductAPI.category.id,
											order : relatedProductAPI.category.order,
											productList : productListDatas,
											key : number
									}
							}
							newData[number] = categoryData;
							return;
						}
					})
				})
			})
			familyIdx = new Array();
			productListDatas = new Array();
			number++;
		})
		number = 0;
		const bundleIdx = sharedObj.addonBundleIdx;
		if( !newData[bundleIdx] && sharedObj.hasBundle ){
			const bundleData = sharedObj.addonBundleData;
			newData[bundleIdx] = {
				category: {
					'display_name': bundleData.category.display_name,
					'id': bundleData.category.id,
					'key': bundleIdx,
					'order': bundleData.category.order,
					'productList': bundleData.products
				}
			}
			
		}
		const keys = Object.keys(newData);
		
		for( const element of keys){
			newData[number] = newData[element];
			newData[number].category.id = number;
			number++;
		}
		const categoryAllInfo = [];
		for(let i in newData){
			categoryAllInfo.push(newData[i]);
		}
		categoryAllInfo.sort((a,b) => a.category.order - b.category.order);
		
		$.each(categoryAllInfo, function(k,categoryInfo){
			$.each(categoryInfo.category.productList, function(k1,categoryProduct){
				$.each(categoryProduct.modelList, function(k2,modelInfo){
						modelInfo.idx = k1 + '-' + modelInfo.idx.split('-')[1]
				  })
			})
		})
		
		return categoryAllInfo;
	};

	function getSearchProductcard(callback) {
		window.sg.components.dynamic.detailSharedObj.commonApiModel.callSearchApiAjax(Object.keys(relatedProducts), function (data, isSuccess) {
			if (isSuccess && data.response.statusCode === 200 && data.response.resultData != null && data.response.resultData.productList != null) {
				var productList = data.response.resultData.productList;
				mergeReleatedToSearch( productList, relatedProducts );
				const categoryAllInfo = setCategoryInfo(productList);
				categoryGrid(prodModelCode); // category.order  sort ( )
				callback(categoryAllInfo);
			} 
		}, null, null);
	}
    

	function newObjectSetting(value){
        const outNewObject = {};
		for(const[idx,val] of Object.entries(value)){
			outNewObject[idx] = val;
        }
 
		let newModelList = [];

        for(let i = 0; i < value.modelList.length; i++){
            const newObject = new Object();
			for(const[idx,val] of Object.entries(value.modelList[i])){
				newObject[idx] = val;

        	}
            newModelList.push(newObject);

        }
        outNewObject.modelList = newModelList;
        return outNewObject;

    }

	function setPriceInfo(model) {
		var productPrice = model.price;
		var promotionPrice = model.promotionPrice;
		var savePriceTemp = Number((productPrice - promotionPrice).toFixed(2));
		var saveText = currencyComma(savePriceTemp, currency);
		var productPriceDisplay = (isSEBN || !model.priceDisplay) ? currencyComma(productPrice, currency) : model.priceDisplay;
		var promotionPriceDisplay = (isSEBN || !model.promotionPriceDisplay) ? currencyComma(promotionPrice, currency) : model.promotionPriceDisplay;
		const isVAT = siteCode === 'co' && model.vatEligible === 'true' && model.vatFreePrice && model.vatFreePriceDisplay;
		const vatPrice = isVAT ? model.vatFreePriceDisplay : '';
		const vatPriceValue = isVAT ? model.vatPriceValue : '';
		
		return {
			"promotionPrice": promotionPrice,
			"productPrice": productPrice,
			"savePriceTemp": savePriceTemp,
			"saveText": saveText,
			"productPriceDisplay": productPriceDisplay,
			"promotionPriceDisplay": promotionPriceDisplay,
			"vatPrice": vatPrice,
			"vatPriceValue" : vatPriceValue
		}
	}
	
	function categoryGrid(prodModelCode) {
		const dynamic = window.sg.components.dynamic;
		const sharedObj = dynamic.detailSharedObj;
		
		// search API(shop/model/productcard) Data  Product Category  Setting
    	var categoryInfo = [];
		addOnCategoryId = [];
		if( isNewHybris ){
			sortOrderArr = [];
		}
		if(Object.keys(newData).length > 0){
			$.each(newData, function (i, value) {
				if(value.category.id != null && value.category.id != undefined) {
					if(addOnCategoryId.indexOf(value.category.id) < 0){ // Category  push   addOnCategoryId 
						categoryInfo = {
								"categoryId" : value.category.id,
								"categoryOrder" : value.category.order,
								"display_name" : value.category.display_name
						}
						addOnCategoryId.push(value.category.id);
						sortOrderArr.push(categoryInfo);
					}
				}
			});	
			//category categoryOrder  sort
			sortOrderArr.sort(function (a, b) { 
				return a.categoryOrder - b.categoryOrder;
			});
			
			//categoryOrder sort category  categoryId push
			addOnCategoryId = []; //  push addOnCategoryId    categoryId   push 
			for(var sort = 0; sort < sortOrderArr.length; sort++){
				addOnCategoryId.push(sortOrderArr[sort].categoryId);
			}
			
			var categoryHtml = '';
			var headlineText = $(".pdd16-step-buying__headline");
			$.each(addOnCategoryId, function (i, addOnCategoryId) {
				const chooseYourI18n = siteCode === 'es' ? "Choose yours {0}" : "Choose your {0}";
				
				if( i == 0 && isVDSTEPBUYING ){
					headlineText[0].innerHTML = Granite.I18n.get(chooseYourI18n, sortOrderArr[i].display_name);
					
				}else if( !isVDSTEPBUYING && !sharedObj.hasVoucher ){
					if(siteCode !== 'se' && siteCode !== 'no' && siteCode !== 'dk' && siteCode !== 'fi') {
						headlineText[0].innerHTML = Granite.I18n.get("Amazing additions");
						$(".pdd16-step-buying__sub-headline").css('display','none');
					}
				}
			
				categoryHtml += '			<li class="tab__item" role="presentation">';
				categoryHtml += '				<button class="tab__item-title" role="tab" an-tr="pdd16_step buying-product detail-select-tab" an-ca="option click" an-ac="bridge" an-la="' + (isVDSTEPBUYING ? 'vd ' : '') + 'add-on:' + sortOrderArr[i].display_name + ':tab">' + sortOrderArr[i].display_name;
				categoryHtml += '					<span class="tab__item-line"></span>';
				categoryHtml += '				</button>';
				categoryHtml += '			</li>';
			});
		}else{
			var categoryHtml = '';
			var headlineText = $(".pdd16-step-buying__headline");
			categoryHtml += '			<li class="tab__item" role="presentation">';
			categoryHtml += '				<button class="tab__item-title" role="tab" an-tr="pdd16_step buying-product detail-select-tab" an-ca="option click" an-ac="bridge" an-la="' + (isVDSTEPBUYING ? 'vd ' : '') + 'add-on:' + bundleCategoryName + ':tab">' + bundleCategoryName;
			categoryHtml += '					<span class="tab__item-line"></span>';
			categoryHtml += '				</button>';
			categoryHtml += '			</li>';
		}
		$(".tab__list").html(categoryHtml);
	}
	
	function categoryGridGPv2(){
		const dynamic = window.sg.components.dynamic;
		const sharedObj = dynamic.detailSharedObj;
		
		let categoryHtml = '';
		sharedObj.addOnCategoryList.forEach(function(elem){
			categoryHtml += '<li class="tab__item" role="presentation">';
			categoryHtml += '	<button class="tab__item-title" role="tab" an-tr="pdd16_step buying-product detail-select-tab" an-ca="option click" an-ac="bridge" an-la="add-on:' + elem.category.display_name + ':tab">' + elem.category.display_name;
			categoryHtml += '		<span class="tab__item-line"></span>';
			categoryHtml += '	</button>';
			categoryHtml += '</li>';
		});
		$(".pdd16-step-buying .tab__list").html(categoryHtml);
	}
	
	function getBundleCategoryName(){
		return bundleCategoryName;
	}
	
	function addOnsImgDomain(imgUrl, preset, iconFl) {
		var newUrl = "";
		var useScene7domain = $("#scene7domain").val();
		if (imgUrl) {
			if (imgUrl.indexOf("?") > -1) { //    add-ons - hybris
				imgUrl = imgUrl.replace("medias","");
				imgUrl = imgUrl.substring(2, imgUrl.indexOf("?"));
				imgUrl = imgUrl.substring(0,imgUrl.lastIndexOf('-'));
				preset = "";
			} else {
				preset = "?" + preset;
			}
			if (imgUrl.indexOf("https:") > -1 || imgUrl.indexOf("http:") > -1 || imgUrl.indexOf("//stg-images.samsung.com/") > -1 || imgUrl.indexOf("//images.samsung.com/") > -1 || imgUrl.indexOf("image.samsung.com/") > -1) {
				newUrl = imgUrl;
			} else {
				if (iconFl) useScene7domain = useScene7domain.replace("/image/", "/content/");
				newUrl = useScene7domain + imgUrl;
			}
		}
		return newUrl;
	}

	window.sg.components.dynamic.bridgePageCommon = (function () {
		return {
			getRelatedProductsSimpleInfo: getRelatedProductsSimpleInfo,
			getRelatedProductsVdSimpleInfo: getRelatedProductsVdSimpleInfo, // new vd
			getSearchProductcard: getSearchProductcard,
			setPriceInfo: setPriceInfo,
			getBundleCategoryName : getBundleCategoryName,
			getRelatedProductsSimpleBundle : getRelatedProductsSimpleBundle,
			getBundleSearchProductcard : getBundleSearchProductcard,
			categoryGridGPv2: categoryGridGPv2
		}
	})();

})(window, window.jQuery);
((window, $) => {
	"use strict";

	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	const sharedObj = dynamic.detailSharedObj;
	const siteCode = $("#siteCode").val();
	const currency = $("#priceCurrency").val();
	const pageTrack = (digitalData.page.pageInfo.pageTrack || "").toLowerCase();
	const isSENA = (siteCode === "se" || siteCode === "dk" || siteCode === "fi" || siteCode === "no");
	const isGPv2 = $("#shopIntegrationFlag").val() === "GPv2";
	const isOldHybris = $("#shopIntegrationFlag").val() === "Hybris" || $("#shopIntegrationFlag").val() === "Hybris-intg";
	const isNewHybris = $("#shopIntegrationFlag").val() === "Hybris-new";
	const isEPP = $('#isEppPage').val() === 'true';
		
	let betterTogetherApi = {};
	let productListData = new Array();
	let selectIndexList = new Array();
	let selectProductList = new Array();
	let buttonEl = null;
	let mainPrice;
	let mainInitPrice;
	let productBundleListData = "";
	let frontModelIdx;
	let displayName = "";
	let optionCountPopup = new Array();
	let bundleModelCode = new Array(); // Bundle     
	let radioBundleBtn;
	let OOSflag = false;
	let monthlyCheckedFlag = false;
	
	const fromI18n = Granite.I18n.get("From");
	const orI18n = Granite.I18n.get("or");
	const monthly18n = Granite.I18n.get("Monthly Price:");
	const viewMoreI18n = Granite.I18n.get("View more");
	const totalI18n = Granite.I18n.get("Total");
	const vatInclusiveI18n = Granite.I18n.get("VAT Inclusive");
	const outOfStockI18n = Granite.I18n.get("Out Of Stock");
	let tncComponent = null; // addon     

	/**
	 *      
	 * 
	 * useGiftContinueI18nForAllCTA :   Continue(Gift)  
	 * useTnc : Tnc 
	 * useTncFromAPI :  API  Tnc   
	 * tncAPIContext  : API  Tnc    context    
	 */
	const localConfig = {
		it : {
			useGiftContinueI18nForAllCTA : true,
			useTnc : true,
			useTncFromAPI : true,
			tncAPIContext : 'FOC'
		}
	}

	const localConfigurator = ((siteCode, config)=>{
		
		let site_cfg = config[siteCode];
		let default_cfg = config["default"];
		
		/**
		 * option key       
		 *   false 
		 */
		function getConfigProperty(optionKey){

			if(site_cfg && typeof site_cfg[optionKey] !== "undefined"){
				return site_cfg[optionKey];
			}else{
				if(default_cfg && typeof default_cfg[optionKey] !== "undefined"){
					return default_cfg[optionKey]
				}else{
					return false;
				}
			}
		}

		return {
			get : getConfigProperty
		}

	})(siteCode, localConfig);

	function setProductPrice() {
		var priceInfo = dynamic.detailSharedObj.drawObj.price.priceWrapper.info;
		var totalPrice = priceInfo.totalPrice || "";
		var MonthlyPrice = totalPrice.split(" " + orI18n + " ");
		var priceHtml = "";
		var productPrice = window.sg.components.dynamic.detailSharedObj.proudctPriceInfo.salePrice;
		if(sharedObj.globalServiceInfo['care']){
			mainInitPrice = productPrice + sharedObj.globalServiceInfo['care'].sale_price.value;
		}else{
			mainInitPrice = productPrice;
		}
		if (MonthlyPrice.length > 1) {
			monthlyCheckedFlag = true;
			priceHtml =
				`
                    <p class="hidden"><strong>${monthly18n}</strong></p>
                    <p class="pdd16-step-buying__header-price-text"><strong>${fromI18n} ${MonthlyPrice[0].replace(fromI18n, "")}</strong><br>
                    	${orI18n} ${MonthlyPrice[1]}</p>
                    	<input type="hidden" class="hiddenPrice" value="${mainInitPrice}">
                `;
		} else {
			priceHtml =
				`
					<p class="hidden"><strong>${monthly18n}</strong></p>
                	<p class="pdd16-step-buying__header-price-text"><strong>${fromI18n} ${MonthlyPrice[0]}</strong></p>
                	<input type="hidden" class="hiddenPrice" value="${mainInitPrice}">
				`;
		}
		$(".pdd16-step-buying__header-price").html(priceHtml);
		$(".pdd16-step-buying__footer-sum").html(priceHtml);
	}

	function showBetterTogether(data, isBundle) {
		window.sg.components.dynamic.detailSharedObj.commonApiModel.historyBackEvent();
		
		if( isGPv2 ){
			const newArr = [...new Set(sharedObj.addOnGift.products.map(i=>i.family_id))].map((family_id, c)=>
				(({modelList=[], chipOptions}={})=>({
					familyId: family_id,
					chipOptions: chipOptions,
					modelList: modelList.filter(({modelCode}) =>
						sharedObj.addOnGift.products.some(({family_id: x, modelCode: y}) => 
							x === family_id && y === modelCode)).map((i, d) => {
								const gift = sharedObj.addOnGift.products[d];
								const isStock = !(gift.inventory.status === "" || gift.inventory.status.toUpperCase() === "OUTOFSTOCK");
								return ({...i, idx: `${c}-${d}`, stocklevel: gift.inventory.status, isStock: isStock, displayName: gift.displayName})
							})
				}))(sharedObj.addOnSearchGPv2.find((i, a)=>i.familyId === family_id))
			);

			productListData = newArr.filter(e => {
				return e.modelList.length > 0 ;
			});
			
		}else{
			productListData = data;
		}
		
		if( !isBundle ){
			if( productListData == null || Object.keys(productListData).length === 0 ){
				//b2c, epp in  (    addon )
				if(!isEPP || (isEPP && siteCode === 'in')){
					if( sharedObj.addonsFlag ){ // old/new hybris: hasAddOns | GPv2(in): addonsFlag
						sharedObj.hasAddOns = true;
					}
				}
				//epp service search       
				if( sharedObj.hasAddOns ){
					window.sg.components.dynamic.bridgePageCommonHybris.moveBridgePage();
				}else{
					// hybris  ,        addToCartFlag false  
					setInterval(function() {
						dynamic.DetailAfterEvent.addToCartCta([], true, true);
					}, 1000);
				}
				return;
			}
		}
		
		buildProductGrid(productListData);
		
		if(localConfigurator.get('useTnc') && localConfigurator.get('useTncFromAPI')){
			// addOnGiftContinueBtn    ,        
			tncComponent = addOnGiftTNC();
			const tncAPIcontext = localConfigurator.get('tncAPIContext') ? localConfigurator.get('tncAPIContext') : '';
			tncComponent.render(tncAPIcontext);
		}

		window.scrollTo(0, 0);
		$('.pdd16-step-buying__promotion-banner').hide();
		$(".pdd16-step-buying").show();

		if( isGPv2 || isOldHybris ){
			var removeClass = $("[class*='feature-benefit']");
			for(var i = 0; i < removeClass.length; i++){
				removeClass[i].remove();
			}
			var removeClass2 = $("#wrap").nextUntil("footer");
			for(var j = 0; j < removeClass2.length; j++){
				removeClass2[j].remove();
			}
			$(".video-wrapper").remove();
		}
		if( isNewHybris ){
			var responsivegrid = $(".root.responsivegrid > div");
	        for(let i = 0; i < responsivegrid.length; i++){
				var classList = responsivegrid[i].classList;
	            if(!classList.value.includes('aem-Grid--default--12'))
					responsivegrid[i].remove();
	        }
		}
        
		$(".pdd16-step-buying").siblings().add($(".pdd16-step-buying").parent().siblings()).hide();
        setTimeout(function() {
        	window.sg.compsible").length === 0) {
			$(".pdd16-step-buying__cta-more").hide();
		}
		_satellite.setVar("Add Page Name", "free gift");
		_satellite.track("page view");
	}

	function moveBridgePage(btnEl) {
		buttonEl = btnEl;
		setProductPrice();
		if( isGPv2 || isOldHybris || isNewHybris ){
			betterTogetherApi = dynamic.freeGiftHybrisCommon;
			if( !isGPv2 ){
				if( productListData.length === 0 && sharedObj.addonGiftBundleRelatedData.length > 0 ){ // gift bundle(F-)   
					showBetterTogether([], true);
				}else{
					betterTogetherApi.getSearchProductcard(showBetterTogether);
				}
			}else{
				const sharedObjGift = sharedObj.addOnApiList.gift;
				if( sharedObjGift && sharedObjGift.list && sharedObjGift.list.length > 0 ){
					showBetterTogether(sharedObjGift.list)
				}
			}
		}
	}

	function arrayContains(array, element) {
		for (var i = 0; i < array.length; i++) {
			if (array[i] === element) {
				return true;
			}
		}
		return false;
	}

	function addOnsImgDomain(imgUrl, preset, iconFl) {
		var newUrl = "";
		var useScene7domain = $("#scene7domain").val();
		if (imgUrl) {
			if (imgUrl.indexOf("?") > -1) { //    add-ons - hybris
				imgUrl = imgUrl.replace("medias","");
				imgUrl = imgUrl.substring(2, imgUrl.indexOf("?"));
				imgUrl = imgUrl.substring(0,imgUrl.lastIndexOf('-'));
				preset = "";
			} else {
				preset = "?" + preset;
			}
			if (imgUrl.indexOf("https:") > -1 || imgUrl.indexOf("http:") > -1 || imgUrl.indexOf("//stg-images.samsung.com/") > -1 || imgUrl.indexOf("//images.samsung.com/") > -1 || imgUrl.indexOf("image.samsung.com/") > -1) {
				newUrl = imgUrl;
			} else {
				if (iconFl) useScene7domain = useScene7domain.replace("/image/", "/content/");
				newUrl = useScene7domain + imgUrl;
			}
		}
		return newUrl;
	}

	/**
	 * viewOptionObj :    Product    optionChip     
	 * sku index   selectOptionMoIdx :    moidx 
	 * otherSelectedOptionMoIdxList :         
	 * isColorType :   color    optionTypeList :   Product 
	 * optionTypeList
	 */
	var getSelectedModelIdx = function (viewOptionObj, selectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, optionTypeList) {
		var modelIdx = 0;
		var modelIdxList = selectOptionMoIdx.split(',');
		var firstIdx = modelIdxList[0];
		var memoryIdx = optionTypeList.indexOf("MEMORY");

		if (!isGPv2 && !isNewHybris && !isOldHybris && isColorType && memoryIdx > 0) {
			// [global, hybrisIntg]   color ,     memory     
			var memoryOptionList = viewOptionObj["MEMORY"].optionList;
			var selectedModelIdx = 0;
			var highestOption = 0;
			for (var moi in memoryOptionList) {
				var temp_mi = memoryOptionList[moi].modelIdx.split(',');
				for (var tmi in temp_mi) {
					//   modelIdx   model idx   
					if (arrayContains(modelIdxList, temp_mi[tmi])) {
						var this_memory_num = memoryOptionList[moi].optionCode.replace("TB", "000").replace(/[^0-9]/g, "");
						if (highestOption < this_memory_num) {
							highestOption = this_memory_num;
							selectedModelIdx = temp_mi[tmi];
						}
						break;
					}
				}
			}
			modelIdx = selectedModelIdx;
		} else {
			var tempMappingModelIdx = [];
			for (var omi in otherSelectedOptionMoIdxList) {
				var otherMoIdx = otherSelectedOptionMoIdxList[omi];
				if (otherMoIdx) {
					var otherMoIdxArr = otherMoIdx.split(',');
					tempMappingModelIdx = [];
					for (var mli in modelIdxList) {
						if (otherMoIdxArr.indexOf(String(modelIdxList[mli])) > -1) {
							tempMappingModelIdx.push(modelIdxList[mli]);
						}
					}
					if (tempMappingModelIdx.length > 0) {
						modelIdxList = tempMappingModelIdx;
					}
				}
			}
			if (modelIdxList.length > 0) {
				modelIdx = modelIdxList[0];
			} else {
				modelIdx = firstIdx;
			}
		}
		return modelIdx;
	};

	var productCardFmyOptionBuild = function (product) {
		var optionHtml = "";
		var frontModel = product.modelList[product.frontModelIdx];
		if (product.viewOptionObj && Object.keys(product.viewOptionObj).length > 0) {
			//    model idx : disable    ( idx  disabled )
			var parentOptionModelIdx = "";
			var viewOptionIdx = 0;
			var curViewOptionObj = product.viewOptionObj;
			var curOptionTypeList = product.optionTypeList;

			for (var type in product.viewOptionObj) {
				var optionDataType = type.toLowerCase().replace(/ /g, "-");
				var optionObj = product.viewOptionObj[type].optionList;
				var isSelected = false;
				var currentOption = {};
				var disabledClass = "";
				var selectorWrapperStyle = "";
				var activeClass = "";

				if (product.viewOptionObj[type].styleAttr) {
					selectorWrapperStyle = product.viewOptionObj[type].styleAttr;
				}
				if (type === "COLOR") {
					var curSelecteModelIdx = "";
					var colorOptionHtml = "";
					for (var option in optionObj) {
						var colorOptionCount = optionObj.length;
						/* ()  flag  */
						currentOption = optionObj[option];
						isSelected = false;
						var modelIdxList = currentOption.modelIdx.split(',');

						if (currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))) {
							isSelected = true;
							curSelecteModelIdx = currentOption.modelIdx;
							disabledClass = "";
						} else {
							disabledClass = " is-disabled";

							if (viewOptionIdx === 0) {
								disabledClass = "";
							} else {
								var parentModelIdxList = parentOptionModelIdx.split(',');
								for (var mli in modelIdxList) {
									//     model idx   model idx    
									if (arrayContains(parentModelIdxList, modelIdxList[mli])) {
										disabledClass = "";
										break;
									}
								}
							}
						}
						//   model   (  )
						var modelCodeAttrForTagging = "";
						var modelNameAttrForTagging = "";
						var modelIdx;
						if (disabledClass === "") {
							var curSelectOptionMoIdx = currentOption.modelIdx;
							var otherSelectedOptionMoIdxList = [];
							var isColorType = true;

							for (var ooi in curViewOptionObj) {
								if (ooi !== type) {
									var tmp_optionList = curViewOptionObj[ooi].optionList;
									for (var toi in tmp_optionList) {
										var tmp_option = tmp_optionList[toi];
										var tmp_optionMoIdx = tmp_option.modelIdx;
										var tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');

										//   option 
										if (tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx)) > -1) {
											otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
										}
									}

								}
							}
							modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
							if (product.modelList.length > modelIdx && product.modelList[modelIdx]) {
								modelCodeAttrForTagging = product.modelList[modelIdx].modelCode;
								modelNameAttrForTagging = product.modelList[modelIdx].modelName;
							}
						}
						var chipId = 'pdd16-' + optionDataType + '-' + option + '-' + product.modelList[modelIdx].idx;
						var chipName = 'pdd16-' + optionDataType  + '-' + option + '-' + product.modelList[modelIdx].idx;
						colorOptionHtml +=
							`
								<span class="option-selector__color">
									<input type="radio" id="${chipId}" name="${chipName}" data-modeli="${modelIdx}" ${(isSelected?' checked':'')}${(disabledClass === ""?"":" disabled")}
										an-tr="pdd16_product bought together-${pageTrack}-select-option" an-ca="option click" an-ac="bridge" an-la="add-on:${type.toLowerCase()}:${currentOption.optionName.toLowerCase()}"
										data-modelcode="${modelCodeAttrForTagging}" data-modelname="${modelNameAttrForTagging}">
									<label for="${chipId}">
										<span class="option-selector__color-code" style="background-color: ${currentOption.optionCode}"></span>
										<span class="hidden">${currentOption.optionName}</span>
									</label>
								</span>
							</span>`;
					}
					parentOptionModelIdx = curSelecteModelIdx;
					optionHtml +=
						`
						<div class="option-selector__wrap option-selector__wrap--color-chip" data-desktop-view="5" data-mobile-view="4">
							<div class="option-selector__swiper" >
								<div class="option-selector__swiper-container" aria-live="polite">
									<div class="option-selector__swiper-wrapper">
										${colorOptionHtml}
									</div>
								</div>
								<button type="button" class="option-selector__button-prev" aria-label="Previous" role="button" aria-disabled="true">
									<span class="hidden">${Granite.I18n.get("Previous")}</span>
									${colorOptionCount > 5 ? 
									`<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#previous-regular"></use>
									</svg>` : '' }
								</button>
								<button type="button" class="option-selector__button-next" aria-label="Next" role="button" aria-disabled="true">
									<span class="hidden">${Granite.I18n.get("Next")}</span>
									${colorOptionCount > 5 ?
									`<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-regular" ></use>
									</svg>` : '' }
								</button>
							</div>
						</div>
						`;
				} else if (type === "MOBILE MEMORY" || type === "TV SIZE" || type === "HOME APPLIANCE SIZE") {
					// IM: Color | Capacity (Memory) | Carrier, VD: Size, DA: Material | Size
					var curSelecteModelIdx = '';
					var memoryOptionHtml = "";
					for (var oi = 0; oi < optionObj.length; oi++) {
						/* ()  flag  */
						var capacityOptionCount = optionObj.length;
						currentOption = optionObj[oi];
						isSelected = false;
						var modelIdxList = currentOption.modelIdx.split(',');

						if (currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))) {
							isSelected = true;
							curSelecteModelIdx = currentOption.modelIdx;
							disabledClass = '';
						} else {
							disabledClass = " is-disabled";
							if (viewOptionIdx === 0) {
								disabledClass = '';
							} else {
								var parentModelIdxList = parentOptionModelIdx.split(',');

								for (var mli in modelIdxList) {
									//     model idx   model idx    
									if (arrayContains(parentModelIdxList, modelIdxList[mli])) {
										disabledClass = '';
										break;
									}
								}
							}
						}
						//   model   (  )
						var modelCodeAttrForTagging = "";
						var modelNameAttrForTagging = "";
						var modelIdx;
						if (disabledClass === "") {
							var curSelectOptionMoIdx = currentOption.modelIdx;
							var otherSelectedOptionMoIdxList = [];
							var isColorType = false;

							for (var ooi in curViewOptionObj) {
								if (ooi !== type) {
									var tmp_optionList = curViewOptionObj[ooi].optionList;
									for (var toi in tmp_optionList) {
										var tmp_option = tmp_optionList[toi];
										var tmp_optionMoIdx = tmp_option.modelIdx;
										var tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');

										//   option 
										if (tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx)) > -1) {
											otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
										}
									}

								}
							}
							modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
							if (product.modelList.length > modelIdx && product.modelList[modelIdx]) {
								modelCodeAttrForTagging = product.modelList[modelIdx].modelCode;
								modelNameAttrForTagging = product.modelList[modelIdx].modelName;
							}
						}
						var chipId = 'pdd16-' + optionDataType + '-' + oi + '-' + product.modelList[modelIdx].idx;;
						var chipName = 'pdd16-' + optionDataType + '-'+ product.modelList[modelIdx].idx;;
						memoryOptionHtml +=
							`<span class="option-selector__swiper-slide${disabledClass}">
								<span class="option-selector__size">
									<input type="radio" id="${chipId}" name="${chipName}" data-modeli="${modelIdx}" ${(isSelected?' checked':'')}${(disabledClass === ""?"":" disabled")}
										an-tr="pdd16_product bought together-${pageTrack}-select-option" an-ca="option click" an-ac="bridge" an-la="add-on:${type.toLowerCase()}:${currentOption.optionName.toLowerCase()}"
										data-modelcode="${modelCodeAttrForTagging}" data-modelname="${modelNameAttrForTagging}">
									<label class="option-selector__size-label" for="${chipId}">
										<span class="option-selector__size-label-text">${currentOption.optionLocalName}</span>
									</label>
								</span>
							</span>`;
					}
					parentOptionModelIdx = curSelecteModelIdx;
					optionHtml +=
						`<div class="option-selector__wrap option-selector__wrap--capacity" data-desktop-view="2" data-mobile-view="1">
							<div class="option-selector__swiper">
								<div class="option-selector__swiper-container" aria-live="polite">
									<div class="option-selector__swiper-wrapper" style="${selectorWrapperStyle}">
										${memoryOptionHtml}
										<div class="option-selector__floating-bar" style="display: none;"></div>
									</div>
								</div>
								<button type="button" class="option-selector__button-prev option-selector__button--disabled" aria-label="Previous" role="button" aria-disabled="true" tabindex="0" style="display:block;">
									<span class="hidden">${Granite.I18n.get("Previous")}</span>
									${capacityOptionCount > 2 ?
									`<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#previous-regular" ></use>
									</svg>` : ''}
								</button>
								<button type="button" class="option-selector__button-next" aria-label="Next" role="button" aria-disabled="true" tabindex="0" style="display:block">
									<span class="hidden">${Granite.I18n.get("Next")}</span>
									${capacityOptionCount > 2 ?
									`<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-regular" ></use>
									</svg>` : '' }
								</button>
							</div>
						</div>`;
				}
				viewOptionIdx++;
			}
		}
		return optionHtml;
	};
	
	var productBundleCardFmyOptionBuild = function (product) {
		var optionHtml = "";
		var frontModel = product.modelList[product.frontModelIdx];
		if (product.viewOptionObj && Object.keys(product.viewOptionObj).length > 0) {
			//    model idx : disable    ( idx  disabled )
			var parentOptionModelIdx = "";
			var viewOptionIdx = 0;
			var curViewOptionObj = product.viewOptionObj;
			var curOptionTypeList = product.optionTypeList;
			for (var type in product.viewOptionObj) {
				var optionDataType = type.toLowerCase().replace(/ /g, "-");
				var optionObj = product.viewOptionObj[type].optionList;
				var isSelected = false;
				var currentOption = {};
				var disabledClass = "";
				var selectorWrapperStyle = "";
				if (product.viewOptionObj[type].styleAttr) {
					selectorWrapperStyle = product.viewOptionObj[type].styleAttr;
				}
				if (type === "COLOR") {
					var curSelecteModelIdx = "";
					var colorOptionHtml = "";
					for (var option in optionObj) {
						var colorOptionCount = optionObj.length;
						/* ()  flag  */
						currentOption = optionObj[option];
						isSelected = false;
						var modelIdxList = currentOption.modelIdx.split(',');
						if (currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))) {
							isSelected = true;
							curSelecteModelIdx = currentOption.modelIdx;
							disabledClass = "";
						} else {
							disabledClass = " is-disabled";

							if (viewOptionIdx === 0) {
								disabledClass = "";
							} else {
								var parentModelIdxList = parentOptionModelIdx.split(',');
								for (var mli in modelIdxList) {
									//     model idx   model idx    
									if (arrayContains(parentModelIdxList, modelIdxList[mli])) {
										disabledClass = "";
										break;
									}
								}
							}
						}
						//   model   (  )
						var modelCodeAttrForTagging = "";
						var modelNameAttrForTagging = "";
						var modelIdx;
						if (disabledClass === "") {
							var curSelectOptionMoIdx = currentOption.modelIdx;
							var otherSelectedOptionMoIdxList = [];
							var isColorType = true;

							for (var ooi in curViewOptionObj) {
								if (ooi !== type) {
									var tmp_optionList = curViewOptionObj[ooi].optionList;
									for (var toi in tmp_optionList) {
										var tmp_option = tmp_optionList[toi];
										var tmp_optionMoIdx = tmp_option.modelIdx;
										var tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');
										//   option 
										if (tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx)) > -1) {
											otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
										}
									}

								}
							}
							modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
							if (product.modelList.length > modelIdx && product.modelList[modelIdx]) {
								modelCodeAttrForTagging = product.modelList[modelIdx].modelCode;
								modelNameAttrForTagging = product.modelList[modelIdx].modelName;
							}
						}
						var chipId = 'pddB16-' + optionDataType + '-' + option + '-' + product.modelList[modelIdx].idx;
						var chipName = 'pddB16-' + optionDataType  + '-' + product.modelList[modelIdx].idx;
						colorOptionHtml +=
							`<span class="option-selector__swiper-slide${disabledClass}">
								<span class="option-selector__color">
									<input type="radio" id="${chipId}" name="${chipName}" data-modeli="${modelIdx}"${(isSelected?' checked':'')}${(disabledClass === ""?"":" disabled")}
										an-tr="pdd16_product bought together-${pageTrack}-select-option" an-ca="option click" an-ac="bridge" an-la="add-on:${type.toLowerCase()}:${currentOption.optionName.toLowerCase()}"
										data-modelcode="${modelCodeAttrForTagging}" data-modelname="${modelNameAttrForTagging}" class="cta">
									<label for="${chipId}">
										<span class="option-selector__color-code" style="background-color: ${currentOption.optionCode}"></span>
										<span class="hidden">${currentOption.optionName}</span>
									</label>
								</span>
							</span>`;
					}
					parentOptionModelIdx = curSelecteModelIdx;
					optionHtml +=
						`
						<div class="option-selector__wrap option-selector__wrap--color-chip" data-desktop-view="5" data-mobile-view="4">
							<div class="option-selector__swiper" >
								<div class="option-selector__swiper-container" aria-live="polite">
									<div class="option-selector__swiper-wrapper">
										${colorOptionHtml}
									</div>
								</div>
								<button type="button" class="option-selector__button-prev" aria-label="Previous" role="button" aria-disabled="true">
									<span class="hidden">${Granite.I18n.get("Previous")}</span>
									${colorOptionCount > 5 ? 
									`<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#previous-regular"></use>
									</svg>` : '' }
								</button>
								<button type="button" class="option-selector__button-next" aria-label="Next" role="button" aria-disabled="true">
									<span class="hidden">${Granite.I18n.get("Next")}</span>
									${colorOptionCount > 5 ?
									`<svg class="icon" focusable="false">
										<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-regular" ></use>
									</svg>` : '' }
								</button>
							</div>
						</div>
						`;
				}
				viewOptionIdx++;
			}
		}
		return optionHtml;
	};
	/**
	 * Product Data  Product Card  
	 * 
	 * @param product
	 */
	var isSelectedIdx = "";
	function buildProductCard(product) {
		var productCardTemplates = "";
		var productCardTemplate = "";
		var cardTemplate = "";
		var frontModel = product.modelList[product.frontModelIdx];
		var isSelected = frontModel.idx == isSelectedIdx;
		var chipOptions = frontModel.fmyChipList;
		var colorName = "";
		if(chipOptions) {
			if(chipOptions.length > 0){
				for(var i = 0; i < chipOptions.length; i++){
					if(chipOptions[i].fmyChipType == "COLOR"){
						colorName = (frontModel.fmyChipList[i].fmyChipLocalName !== '') ? frontModel.fmyChipList[i].fmyChipLocalName : frontModel.fmyChipList[i].fmyChipName;
						break;
					}
				}
			}
		}
		var isStock = frontModel.isStock;
		var princeInfo = betterTogetherApi.setPriceInfo(frontModel);
		var promotionPrice = princeInfo.promotionPrice;
		var savePriceTemp = princeInfo.savePriceTemp;
		var saveText = princeInfo.saveText;
		var productPriceDisplay = princeInfo.productPriceDisplay;
		var promotionPriceDisplay = princeInfo.promotionPriceDisplay;
		var imageHtml = "";
		var cardNumber = frontModel.idx.split('-')[0];
		if (frontModel.thumbUrl) {
			imageHtml =
				`<img class="image__preview lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(frontModel.thumbUrl, "$LazyLoad_Home_PNG$")}" data-mobile-src="${addOnsImgDomain(frontModel.thumbUrl, "$LazyLoad_Home_PNG$")}" alt="${frontModel.thumbUrlAlt}" role="img">
				<img class="image__main lazy-load responsive-img" data-desktop-src="${addOnsImgDomain(frontModel.thumbUrl, "$240_240_PNG$")}" data-mobile-src="${addOnsImgDomain(frontModel.thumbUrl, "$480_480_PNG$")}" alt="${frontModel.thumbUrlAlt}" role="img">`;
		}
		productCardTemplate +=
			`<div class="pdd16-step-buying__card-title"><strong class="pdd16-step-buying__card-title-text">${frontModel.displayName}</strong>
                <div class="pdd16-step-buying__tooltip">${frontModel.displayName}</div>
            </div>
			<div class="image">
				${imageHtml}
			</div>
				`;
		var cardState = "";
		if(!isStock){ //     OOS  .
			cardState = outOfStockI18n;
		}
		const colorText = isGPv2 ? `: ${colorName}` : `&nbsp;${colorName}`;
		productCardTemplate +=
			`<div class="pdd16-step-buying__card-option" style="height:84.4375px">
				<div class="option-selector option-selector__color-text">
					${colorName != "" ?
						`<div class="option-selector__color-name">
									${Granite.I18n.get("Color")}
									<span class="color-name-text">${colorText}</span>
						</div>` : '' }
					${productCardFmyOptionBuild(product)} 
				</div>
			</div>
			<div class="pdd16-step-buying__card-state">
				<p>${cardSotionPrice != null  && princeInfo.promotionPrice !== "" && princeInfo.promotionPrice != "0"){
				productCardTemplate +=
					`<div class="pdd16-step-buying__card-price">
		                <strong class="card-price">${princeInfo.promotionPriceDisplay}</strong>
		                <span class="card-was">
		                  <span class="hidden">Original Price: ${princeInfo.productPriceDisplay}</span>
		                  <input type="hidden" value="${princeInfo.promotionPrice}">
		                  <del>${princeInfo.productPriceDisplay}</del>
		                </span>
		              </div>`;
			}else{
				productCardTemplate +=
					`<div class="pdd16-step-buying__card-price">
		                <strong class="card-price">${princeInfo.productPriceDisplay}</strong>
		              </div>`;
			}
			
		}

		let modelCode = '';
		if( isGPv2 ){
			modelCode = frontModel.shopSKU;
		}else{
			modelCode = frontModel.modelCode;
		}
		productCardTemplate += 
			`
				<div class="pdd16-step-buying__card-input">
                    <div class="radio-v2">
                      <input type="radio" name="radio" class="hidden" id="radio-id-${cardNumber}" data-modelcode="${modelCode}" data-modelname="${frontModel.modelName}" ${isStock ? '' : "disabled checked"} ${isSelected ? " checked":""}>
                      <label class="radio-v2__label" for="radio-id-${cardNumber}">
                        <span class="radio-v2__label-box-wrap">
                          <span class="radio-v2__label-box">
                            <span class="radio-v2__label-box-circle"></span>
                          </span>
 o-v2__label-text">Selecting item</span>
                      </label>
                    </div>
                  </div>
			`;
		productCardTemplates = `<div class="pdd16-step-buying__card" data-index="${frontModel.idx}" data-modelcode="${modelCode}">
									${productCardTemplate}
								</div>`;
		return productCardTemplates;
	}

	/**
	 * Product   
	 * 
	 * @param product
	 * @param frontModelIdx
	 *            Product  model   model index
	 * @return product
	 */
	function getProductInfo(product, frontModelIdx) {
		var tempProduct = product;
		if (tempProduct.modelList[frontModelIdx].displayName == null) {
			tempProduct.modelList[frontModelIdx].displayName = "";
		}
		/*
		 * viewOptionObj :    optionTypeList :      ( 
		 * index     )
		 */
		var tmpOptionListInModel = {};
		for (var mi in tempProduct.modelList) {
			var tmpModel = tempProduct.modelList[mi];
			var tmpFmyChipList = tmpModel.fmyChipList;

			for (var fci in tmpFmyChipList) {
				// fmyChipCode " 
				var thisOptionKey = tmpFmyChipList[fci].fmyChipType + '+' +
					tmpFmyChipList[fci].fmyChipCode.replace("\"", "").replace("&quot;", "") + '+' +
					tmpFmyChipList[fci].fmyChipLocalName.replace("\"", "").replace("&quot;", "");

				if (tmpOptionListInModel[thisOptionKey] == undefined) {
					tmpOptionListInModel[thisOptionKey] = mi;
				} else {
					tmpOptionListInModel[thisOptionKey] += "," + mi;
				}
			}
		}
		var optionTypeList = [];
		var viewOptionObj = {};
		if (tempProduct.chipOptions) {
			for (var a = 0; a < tempProduct.chipOptions.length; a++) {
				var optionData = tempProduct.chipOptions[a];
				var optionTypeTmp = optionData.fmyChipType;

				var optionListInType = optionData.optionList;
				for (var opl in optionListInType) {
					var thisOptionKey = optionData.fmyChipType + '+' +
						optionListInType[opl].optionCode.replace("\"", "").replace("&quot;", "") + '+' +
						optionListInType[opl].optionLocalName.replace("\"", "").replace("&quot;", "");
					if (tmpOptionListInModel[thisOptionKey] != undefined) {
						optionListInType[opl].modelIdx = tmpOptionListInModel[thisOptionKey];
					}

				}
				viewOptionObj[optionTypeTmp] = {};
				viewOptionObj[optionTypeTmp]["optionList"] = optionListInType;
				optionTypeList.push(optionTypeTmp);
			}
		}
		tempProduct.viewOptionObj = viewOptionObj;
		tempProduct.optionTypeList = optionTypeList;
		tempProduct.frontModelIdx = frontModelIdx;
		return tempProduct;
	}

	function buildProductGrid(productList) {
		// gift bundle   
		sharedObj.addonGiftBundleRelatedData = sharedObj.addonGiftBundleRelatedData.filter((arr, index, callback) => 
			index === callback.findIndex(t => 
				t.bundleModelCode === arr.bundleModelCode
			)
		);
		let result = "";
		if( isGPv2 ){
			const gift = sharedObj.addOnGift.expanded.product_tags['GIFT'];
			const title = gift.formatted_sales_pitch ? gift.formatted_sales_pitch : gift.sales_pitch;
			$(".pdd16-step-buying__headline").html(title);
		}else{
			var title = window.sg.components.dynamic.detailSharedObj.giftdataHybris;
			$.each(title, function(idx,value){	// Gift Page title
				if(title[idx].key.toLowerCase() === "maintitle"){
					$(".pdd16-step-buying__headline").html(title[idx].value)
				}
				if(title[idx].key.toLowerCase() === "subtitle"){
					$(".pdd16-step-buying__sub-headline").html(title[idx].value);
					$('.pdd16-step-buying__sub-headline').css('display','');
				}
				if(title[idx].key.toLowerCase() === "description") {
					$(".pdd16-step-buying__disclaimer p").html(title[idx].value)
					$('.pdd16-step-buying__disclaimer').css('display','');
				}
			})
		}
		mainPrice = $('.pdd16-step-buying__header-price-text')[0].innerHTML;
		var count = 0;
		if (productList.length > 0) {
			var productGridTemplate = "";
				for (var pl = 0; pl < productList.length; pl++) {
					var tempProduct = productList[pl];
					if (tempProduct.modelList != null && tempProduct.modelList.length > 0) {
						frontModelIdx = 0;
						var selectedIndex = null; // selected Y      
						/* selected Y  */
						for (var cnt = 0; cnt < tempProduct.modelList.length; cnt++) {
							var tempModel = tempProduct.modelList[cnt];
							var enabledFlag = tempModel.isStock;
	
							if (tempModel.selected && tempModel.selected === "Y") {
								frontModelIdx = cnt;
								if (enabledFlag) {
									selectedIndex = cnt;
								}
							}
						}
						if (selectedIndex == null) {
							for (var cnt = 0; cnt < tempProduct.modelList.length; cnt++) {
								var tempModel = tempProduct.modelList[cnt];
								var isStock = tempModel.isStock;
								if (isStock) {
									selectedIndex = cnt;
									break;
								}
							}
						}
						if (selectedIndex == null) {
							selectedIndex = frontModelIdx;
						}

						tempProduct = getProductInfo(tempProduct, selectedIndex);
						productGridTemplate += buildProductCard(tempProduct);
					}
				}
				
				if(!window.sg.components.dynamic.detailSharedObj.drawObj.care){
					configuratorCare.setProductInfo();
				}
				
				if(sharedObj.hasGiftBundle){ // Bundle   Card      .
					for(const bundleIdx in sharedObj.addonGiftBundleRelatedData){
						productGridTemplate += 
							`<div class="pdd16-step-buying__card">
								${bundleGridGift(bundleIdx)}
							</div>`
					}
				}
				var gifts = sharedObj.giftdataHybris;
				var smc = "";
				var smcCard = "";
				var smcGridFlag = false;
				if(gifts.length){ // freeSmc  value 'Y' SC+ Card .
					for(let i = 0; i < gifts.length; i++){
						if(gifts[i].key == 'freeSmc' && gifts[i].value == 'Y'){
							smcGridFlag = true;
						}
					}
				}
				if(smcGridFlag){ // SC+ Card    .
					const setPopupData = [];
					const deliveredData = sharedObj.hybrisCareData;
					let careInfoList = deliveredData.smcs;
					let careItem;
					
					for(let i = 0; i < careInfoList.length; i++){
						if(careInfoList[i].paymentCycle != null && careInfoList[i].paymentCycle.toUpperCase() == "MONTHLY"){ //   
						}else{
							careItem = careInfoList[i];
							smcCard = buildProductCardSC(careItem);
							productGridTemplate += `
								<div class="pdd16-step-buying__card" data-index="SC">
									${smcCard}
								</div>`;
							break;
						}
					}
				}
				result += 
					`<div class="pdd16-step-buying__tab pdd16-step-buying__ swiper-slide">
		            <div class="pdd16-step-buying__list-type">
		            <a class="btn-type on" aria-label="">
		              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" focusable="false">
		                <path fill="none" d="M0 0H16V16H0z" transform="translate(-344 -388) translate(344 388)" />
		                <g>
							<path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(344 388)" />
							<path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(344 394.649)" />
                    		<path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(350.65 388)" />
                    		<path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(350.65 394.649)" />
		                </g>
		              </svg>
		            </a>
		            <a class="btn-type" aria-label="">
		              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" focusable="false">
		                <path fill="none" d="M0 0H16V16H0z" transform="translate(349 388) translate(-349 -388)" />
		                <g>
							<path d="M.652 0h10.7A.681.681 0 0 1 12 .764v3.822a.681.681 0 0 1-.652.764H.652A.681.681 0 0 1 0 4.586V.764A.681.681 0 0 1 .652 0z" class="cls-2" transform="translate(344 388.732) translate(7 1.268) translate(-349 -388)" />
                    		<path d="M.652 0h10.7A.681.681 0 0 1 12 .764v3.822a.681.681 0 0 1-.652.764H.652A.681.681 0 0 1 0 4.586V.764A.681.681 0 0 1 .652 0z" class="cls-2" transform="translate(344 395.732) translate(7 1.268) translate(-349 -388)" />
		                </g>
		              </svg>
		            </a>
		          </div>
		          <div class="scrollbar">
		            <div class="scrollbar__contents">
		            	${productGridTemplate}
		              <div class="pdd16-step-buying__view-more">
		                <button type="button" class="cta" aira-label="${viewMoreI18n}">
		                  <svg class="icon next" focusable="false">
		                    <use xlink:href="#next-bold" href="#next-bold"></use>
		                  </svg>
		                  <span class="cta-text">${viewMoreI18n}</span>
		                  <svg class="icon down" focusable="false">
		                    <use xlink:href="#open-down-bold" href="#open-down-bold"></use>
		                  </svg>
		                </button>
		              </div>
		            </div>
		          </div>
		        </div>`;
				productGridTemplate = "";
	     }else{
	    	 var productBundleGridTemplate = "";
	    	 if(!window.sg.components.dynamic.detailSharedObj.drawObj.care){
					configuratorCare.setProductInfo();
				}
				if(sharedObj.hasGiftBundle){ // Bundle   Card      .
					for(const bundleIdx in sharedObj.addonGiftBundleRelatedData){
						productBundleGridTemplate += 
							`<div class="pdd16-step-buying__card">
								${bundleGridGift(bundleIdx)}
							</div>`
					}
				}
				var gifts = sharedObj.giftdataHybris;
				var smc = "";
				var smcCard = "";
				var smcGridFlag = false;
				if(gifts.length){ // freeSmc  value 'Y' SC+ Card .
					for(let i = 0; i < gifts.length; i++){
						if(gifts[i].key == 'freeSmc' && gifts[i].value == 'Y'){
							smcGridFlag = true;
						}
					}
				}
				if(smcGridFlag){ // SC+ Card    .
					const setPopupData = j.hybrisCareData;
					let careInfoList = deliveredData.smcs;
					let careItem;
					
					for(let i = 0; i < careInfoList.length; i++){
						if(careInfoList[i].paymentCycle != null && careInfoList[i].paymentCycle.toUpperCase() == "MONTHLY"){ //   
						}else{
							careItem = careInfoList[i];
							break;
						}
					}
					smcCard = buildProductCardSC(careItem);
					productBundleGridTemplate += `
						<div class="pdd16-step-buying__card" data-index="SC">
							${smcCard}
						</div>`;
				}
				result = 
					`<div class="pdd16-step-buying__tab pdd16-step-buying__ swiper-slide">
		            <div class="pdd16-step-buying__list-type">
		            <a class="btn-type on" aria-label="">
		           6 16" focusable="false">
		                <path fill="none" d="M0 0H16V16H0z" transform="translate(-344 -388) translate(344 388)" />
		                <g>
							<path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(344 388)" />
							<path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(344 394.649)" />
                 		<path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(350.65 388)" />
                 		<path d="M.764 0h3.822a.764.764 0 0 1 .764.764v3.822a.764.764 0 0 1-.764.764H.764A.764.764 0 0 1 0 4.586V.764A.764.764 0 0 1 .764 0z" transform="translate(-344 -388) translate(2 2) translate(350.65 394.649)" />
		                </g>
		              </svg>
		            </a>
		            <a class="btn-type" aria-label="">
		              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" focusable="false">
		                <path fill="none" d="M0 0H16V16H0z" transform="translate(349 388) translate(-349 -388)" />
		                <g>
							<path d="M.652 0h10.7A.681.681 0 0 1 12 .764v3.822a.681.681 0 0 1-.652.764H.652A.681.681 0 0 1 0 4.586V.764A.681.681 0 0 1 .652 0z" class="cls-2" transform="translate(344 388.732) translate(7 1.268) translate(-349 -388)" />
                 		<path d="M.652 0h10.7A.681.681 0 0 1 12 .764v3.822a.681.681 0 0 1-.652.764H.652A.681.681 0 0 1 0 4.586V.764A.681.681 0 0 1 .652 0z" class="cls-2" transform="translate(344 395.732) translate(7 1.268) translate(-349 -388)" />
		                </g>
		              </svg>
		            </a>
		          </div>
		          <div class="scrollbar">
		            <div class="scrollbar__contents">
		            	${productBundleGridTemplate}
		              <div class="pdd16-step-buying__view-more">
		                <button type="button" class="cta" aira-label="${viewMoreI18n}">
		                  <svg class="icon next" focusable="false">
		                    <use xlink:href="#next-bold" href="#next-bold"></use>
		                  </svg>
		                  <span class="cta-text">${viewMoreI18n}</span>
		                  <svg class="icon down" focusable="false">
		                    <use xlink:href="#open-down-bold" href="#open-down-bold"></use>
		                  </svg>
		                </button>
		              </div>
		            </div>
		          </div>
		        </div>`;
	     }
		$(".pdd16-step-buying .pdd16-step-buying__card-wrap .swiper-wrapper").html(result);
        
		// Continue    Gift Page OOS    
		var firstRadioCheck = $(".radio-v2 input");
		var fistOOSCheck = firstRadioCheck.closest('.pdd16-step-buying--free-gift').find('.pdd16-step-buying__card-state p');
		var radioCheckedFlag = false;
		for(let i = 0; i < fistOOSCheck.length; i++){
			var inputRadioId = firstRadioCheck[i].getAttribute('id');
			var inputRadioClass = firstRadioCheck[i].getAttribute('class')
			if(fistOOSCheck[i].innerText.toUpperCase() == outOfStockI18n.toUpperCase() || inputRadioId == 'radio-id-99' || inputRadioId == 'radio-id-SC' || inputRadioClass.includes('cta--bundle')){
				continue;
			}else{
				firstRadioCheck[i].setAttribute('checked',true);
				selectProductList.push(firstRadioCheck[i].getAttribute('data-modelcode'));
				radioCheckedFlag = true;
				break;
			}
		}
		//   OOS Skip,  Continue  
		var OOScount = 0;
		var OOSstate = "";
		var cardState = $(".pdd16-step-buying--free-gift .pdd16-step-buying__card-state p");
		for(let i = 0; i < cardState.length; i++){
			if(cardState[i].innerText.toUpperCase() == outOfStockI18n.toUpperCase() && !(firstRadioCheck[i].getAttribute('id') == 'radio-id-SC')){
				OOScount++;
			}
		}
		if(OOScount == cardState.length){
			OOSflag = true;
			OOSstate = Granite.I18n.get("Skip");
			radioCheckedFlag = true;
		}else{
			OOSstate = '';
			OOSstate = Granite.I18n.get("CONTINUE");
		}

		if(localConfigurator.get("useGiftContinueI18nForAllCTA")){
			OOSstate = Granite.I18n.get("CONTINUE(GIFT)");
		}

		const tncList = $(".pdd16-step-buying__tnc .pdd16-step-buying__tnc-checkbox input[name='checkbox']");
		const checkFlag = localConfigurator.get('useTnc') ? tncCheck(tncList) : true;

		if(!checkFlag){
			radioCheckedFlag = false;
		}
		
		var buttonType = `
			<div class="pdd16-step-buying__footer-price">
                <p class="pdd16-step-buying__footer-text"><strong>${totalI18n}</strong>${vatInclusiveI18n}</p>
                <p class="pdd16-step-buying__footer-sum">${mainPrice}</p>
              </div>
			<div class="pdd16-step-buying__footer-cta-wrap">
            <div class="pdd16-step-buying__footer-cta">
            	<button 
					class="cta cta--contained cta--emphasis ${!radioCheckedFlag ? 'cta--disabled' : ''} ${localConfigurator.get("useTnc") ? 'cta--step' : ''}" 
					id="giftContinue" 
					${!radioCheckedFlag ? 'disabled' : ''}>
                	${OOSstate}
              	</button>
            </div>
          </div>`
		$('.pdd16-step-buying__footer').html(buttonType);
		
		if(localConfigurator.get("useTnc")){
			// tnc   i18n  gift tnc [siteCode]   
			const tncI18nKey = `gift tnc (${siteCode})`;
			$('.pdd16-step-buying__tnc .checkbox-v2__label-text').html(Granite.I18n.get(tncI18nKey));
			$('.pdd16-step-buying__tnc').show();
		}
		
		productCardListener();
	}
	
	function bundleGridGift(bundleIdx){
		var imageHtml = "";
		var productCardTemplate = "";
		var giftBundleObj = sharedObj.relatedProductsBundle[sharedObj.addonGiftBundleRelatedData[bundleIdx].bundleModelCode];
		var code = giftBundleObj.modelcode;
		imageHtml =
			`<img class="image__preview lazy-load responsive-img" data-desktop-src='${addOnsImgBundleDomain(giftBundleObj.imageUrl, "$LazyLoad_Home_PNG$")}' data-mobile-src="${addOnsImgBundleDomain(giftBundleObj.imageUrl, "$LazyLoad_Home_PNG$")}" alt="" role="img">
			<img class="image__main lazy-load responsive-img" data-desktop-src='${addOnsImgBundleDomain(giftBundleObj.imageUrl)}' data-mobile-src="${addOnsImgBundleDomain(giftBundleObj.imageUrl)}" alt="" role="img">`;
		productCardTemplate +=
			`<div class="pdd16-step-buying__card-title"><strong class="pdd16-step-buying__card-title-text">${giftBundleObj.name}</strong>
				<div class="pdd16-step-buying__tooltip">Bundle</div>
			</div>
			<div class="image">
				${imageHtml}
			</div>
			`;
		let isInStock = false;
		let state = outOfStockI18n;
		for( const childModelCode in sharedObj.addonGiftBundleRelatedData[bundleIdx] ){
			const childInfo = sharedObj.addonGiftBundleRelatedData[bundleIdx][childModelCode]
			if( childInfo.stocklevel && childInfo.stocklevel === 'inStock' && childInfo.colorCode ){
				isInStock = true;
				state='';
				break; 
			}
		}
		productCardTemplate +=
			`<div class="pdd16-step-buying__card-option" style="height:84.4375px">
				<div class="option-selector option-selector__color-text">
				</div>
			</div>
			<div class="pdd16-step-buying__card-state">
				<p>${state}</p>
			</div>`;
		productCardTemplate += 
			`
				<div class="pdd16-step-buying__card-input">
					<div class="radio-v2">
					  <input type="radio" name="radio" class="hidden cta--bundle" id=${isInStock ? code : ''} data-modelCode="${code}" ${!isInStock ? 'disabled' : '' }>
					  <label class="radio-v2__label" for="${code}">
						<span class="radio-v2__label-box-wrap">
						  <span class="radio-v2__label-box">
							<span class="radio-v2__label-box-circle"></span>
						  </span>
						</span>
						<span class="radio-v2__label-text"></span>
					  </label>
					</div>
				  </div>
			`;
		return productCardTemplate;
	}
	
	function addOnsImgBundleDomain(imgUrl, preset, iconFl) {
		/* 
			 addOnsImgDomain          
			https://images.samsung.com/nz/smartphones/galaxy-s22-ultra/buy/Watch_Bundle_B0.png?$THUB_SHOP_L$
			>>
			tps://images.samsung.com/nz/smartphones/galaxy-s22
		*/ 
		
		var newUrl = "";
		var useScene7domain = $("#scene7domain").val();
		if (imgUrl) {
			if (imgUrl.indexOf("?") > -1) { //    add-ons - hybris
				imgUrl = imgUrl.replace("medias","");
				imgUrl = imgUrl.substring(0, imgUrl.indexOf("?"));
				imgUrl += "?" + preset;
			} else {
				preset = "?" + preset;
			}
			if (imgUrl.indexOf("https:") > -1 || imgUrl.indexOf("http:") > -1 || imgUrl.indexOf("//stg-images.samsung.com/") > -1 || imgUrl.indexOf("//images.samsung.com/") > -1 || imgUrl.indexOf("image.samsung.com/") > -1) {
				newUrl = imgUrl;
			} else {
				if (iconFl) useScene7domain = useScene7domain.replace("/image/", "/content/");
				newUrl = useScene7domain + imgUrl;
			}
		}
		return newUrl;
	}
	
	function buildProductCardSC(smcs) {
		var smcData = smcs;
		var imageHtml = "";
		var productCardTemplate = "";
		imageHtml =
			`<img class="image__preview lazy-load responsive-img" data-desktop-src='https://p6-pre-qa2.samsung.com/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/insurance-ico.svg' data-mobile-src='https://p6-pre-qa2.samsung.com/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/insurance-ico.svg' alt="">
			<img class="image__main lazy-load responsive-img" data-desktop-src='https://p6-pre-qa2.samsung.com/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/insurance-ico.svg' data-mobile-src='https://p6-pre-qa2.samsung.com/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/insurance-ico.svg' alt="">`;
		productCardTemplate +=
			`
				<div class="pdd16-step-buying__card-title">
					<strong class="pdd16-step-buying__card-title-text">
						${smcs.title}
					</strong>
					<div class="pdd16-step-buying__tooltip">
						${smcs.title}
					</div>
				</div>
				<div class="image">
					${imageHtml}
				</div>`;
		//option  better-together__info   height 
			productCardTemplate +=
				`<div class="pdd16-step-buying__card-option" style="height:84.4375px">
					<div class="option-selector option-selector__color-text">
					</div>
				</div>
				<div class="pdd16-step-buying__card-state">
					<p></p>
				</div>`;
			productCardTemplate += 
				`
					<div class="pdd16-step-buying__card-input">
	                    <div class="radio-v2">
	                      <input type="radio" name="radio" class="hidden" id="radio-id-SC" data-modelCode="${smcs.smcCode}">
	                      <label class="radio-v2__label" for="radio-id-SC">
	                        <span class="radio-v2__label-box-wrap">
	                          <span class="radio-v2__label-box">
	                            <span class="radio-v2__label-box-circle"></span>
	                          </span>
	                        </span>
	                        <span class="radio-v2__label-text"></span>
	                      </label>
	                    </div>
	                  </div>
				`;
		
		return productCardTemplate;
	}
	function productCardListener() {
		/* (Color, Memory)  Event :: S */
		$(".pdd16-step-buying__card > .pdd16-step-buying__card-option").off("click", ".option-selector__color input, .option-selector__size input");
		$(".pdd16-step-buying__card > .pdd16-step-buying__card-option").on("click", ".option-selector__color input, .option-selector__size input", function () {
			var _this = $(this);
			selectProductList = new Array();
			$(".pdd16-step-buying__header-price-text").html(mainPrice);
			$(".hiddenPrice").attr('value',mainInitPrice);
			var selectCard = _this.closest(".pdd16-step-buying__card");
			var selectIndex = selectCard.attr("data-index") || ""; // familyNum
			var productIdx = selectIndex.split('-')[0]; // familyNum
			var optionIdx = _this.attr('data-modeli'); // option Num
			var selectModel = productListData[productIdx].modelList[optionIdx];
			selectProductList.push(selectModel.modelCode);
			var isStock = selectModel.isStock;
			isSelectedIdx = $(this).attr('name');
			var isSelectedIdxes = isSelectedIdx.lastIndexOf('-');
			isSelectedIdx = isSelectedIdx.substring(isSelectedIdx.lastIndexOf('-',isSelectedIdxes-1)+1);
			setTimeout(function () {
				if (optionIdx != null) {
					productListData[productIdx].frontModelIdx = optionIdx;
					var productInfo = getProductInfo(productListData[productIdx], optionIdx);
					var targetContentEl = $(".pdd16-step-buying__card").eq(productIdx);
					var index = $(".pdd16-step-buying__card").index(targetContentEl);
					targetContentEl.find(".option-selector__swiper-wrapper").each(function (idx) {
						var tmpType = productListData[productIdx].optionTypeList[idx];
						var styleAttr = $(this).attr("style");
						productListData[productIdx].viewOptionObj[tmpType].styleAttr = styleAttr;
					});
					targetContentEl.replaceWith(buildProductCard(productInfo));
					// product card      
					targetContentEl = $(document.querySelectorAll(".pdd16-step-buying__card")[index]);
					targetContentEl.adinit();
					productCardListener();
				}
			}, 300);
			
			if(!isStock){
				$("#giftContinue").addClass('cta--disabled').attr('disabled', true);
				$("#giftContinue").attr('aria-disabled', 'true')
			}else{
				if($("#giftContinue").hasClass('cta--disabled')){
					$("#giftContinue").removeClass('cta--disabled').attr('disabled', false);
				}
				$("#giftContinue").attr('aria-disabled', '')
			}
		});
		
		/* Card Radio   Event */
		$(".pdd16-step-buying.pdd16-step-buying--free-gift").off("click", ".radio-v2__label");
		$(".pdd16-step-buying.pdd16-step-buying--free-gift").on("click", ".radio-v2__label", function () {
			var _this = $(this);
			radioBundleBtn = _this;
			var inStockCard = _this.closest('.pdd16-step-buying__card').find('.pdd16-step-buying__card-state p');
			$(".pdd16-step-buying__header-price-text").html(mainPrice);
			$(".hiddenPrice").attr('value',mainInitPrice);
			selectProductList = new Array();
			selectIndexList = new Array();
			var index = _this.closest(".pdd16-step-buying__card").attr("data-index");
			const targetInput = _this.closest('.radio-v2').find('input[type="radio"]');
			if(_this.closest('.radio-v2').find('input[type="radio"]').attr('id') == 'radio-id-SC'){
				const setPopupData = [];
				const deliveredData = sharedObj.hybrisCareData;
				let careInfoList = deliveredData.smcs;
				let careItem;
				
				for(let i = 0; i < careInfoList.length; i++){
					if(careInfoList[i].paymentCycle != null && careInfoList[i].paymentCycle.toUpperCase() == "MONTHLY"){
					}else{
						careItem = careInfoList[i];
						break;
					}
				}
				setPopupData.push(careItem);
				deliveredData.smcs = setPopupData;
				configuratorCare.showPopup(deliveredData);
				$(".hubble-care-popup__smc-price").hide();
			} else if(targetInput.hasClass('cta--bundle') ){
				const modelCode = targetInput.attr('data-modelcode');
				
				let fData = window.sg.components.dynamic.detailSharedObj.relatedProductsBundle[modelCode];
				const bundleData = window.sg.components.dynamic.detailSharedObj.addonGiftBundleRelatedData.filter(elem => {
					return elem.bundleModelCode === modelCode;
				});
				
				window.sg.components.addonBundlePopup.callSearchAjax(fData, bundleData[0], true);
				
				window.sg.components.notifyMePopup.showPopup(document.querySelector('.add-ons-evoucher-popup'));
				window.sg.components.notifyMePopup.reInit();
			}else if(!targetInput.hasClass('cta--bundle') && targetInput.attr('id') != 'radio-id-SC'){
				var productIndex = index.split('-');
				var selectModel = productListData[productIndex[0]].modelList[productIndex[1]];
				var selectProductCode = "";
	            var monthly = window.sg.components.dynamic.detailSharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal;
				var monthlyPrice = window.sg.components.dynamic.detailSharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal;
				var totalPrices = "";
				var priceHtml = "";
				var priceCurrency = $("#priceCurrency").val();
				var productPrice = Number($(".hiddenPrice")[0].getAttribute('value'));
				
				var selectedItem = "";
				if (isGPv2) {
					selectProductCode = selectModel.shopSKU;
				} else {
					selectProductCode = selectModel.modelCode;
				}
	
				if (isGPv2) {
					selectProductCode = selectModel.shopSKU;
				} else {
					selectProductCode = selectModel.modelCode;
				}
				selectIndexList.push(index);
				selectProductList.push(						if(careButtons[0] == $(this)[0]){
								radioBundleBtn.prev().prop("checked",false)
								$("#giftContinue").addClass('cta--disabled').attr('disabled', true)
							}else{
								$("#giftContinue").removeClass('cta--disabled').attr('disabled', false)
							}
						});
					}
				}
			}
			const tncList = $(".pdd16-step-buying__tnc .pdd16-step-buying__tnc-checkbox input[name='checkbox']");
			const checkFlag = localConfigurator.get('useTnc') ? tncCheck(tncList) : true;
			if( selectProductList.length > 0 && checkFlag ){
				$("#giftContinue").removeClass('cta--disabled').attr('disabled', false)
			}else{
				$("#giftContinue").addClass('cta--disabled').attr('disabled', true)
			}
		});
	}
	
	function setCtaTagging() {
		var cartEl = $("#primaryInfoGoCartAddOn");
		var checkEl = $("#primaryInfoCheckOutAddOn");
		var ctaEl = $("#primaryInfoGoCartAddOn, #primaryInfoCheckOutAddOn");

		if (selectIndexList.length > 0) {
			var modelCode = "";
			var modelName = "";
			var displayName = "";
			var modelPrice = "";
			var discountprice = "";
			var pviTypeName = "";
			var pviSubtypeName = "";
			var categorySubTypeEngName = "";
			var modelrevenue = "";
			var modelqty = "";
			for (var i = 0; i < selectIndexList.length; i++) {
				var selectIndex = selectIndexList[i]; // familyNum - modelNum
				var categoryKey = selectIndex.split('-')[0];
				var familyIdx = selectIndex.split('-')[1];
				var modeIdx = selectIndex.split('-')[2];
				var model = productListData[categoryKey].category.productList[familyIdx].modelList[modeIdx];
				var qty = 1;
				var comma = '';
				var colon = '';
				if (i > 0) {
					comma = ',';
					colon = ';';
				}
				modelCode += comma + model.modelCode;
				modelName += comma + model.modelName;
				displayName += colon + model.displayName;
				modelPrice += comma + price;
				pviTypeName += comma + model.pviTypeName;
				pviSubtypeName += comma + model.pviSubtypeName;
				categorySubTypeEngName += comma + model.categorySubTypeEngName;
				modelrevenue += comma + price;
				modelqty += comma + qty;
			}
			pviTypeName = pviTypeName.toLowerCase();
			pviSubtypeName = pviSubtypeName.toLowerCase();
			categorySubTypeEngName = categorySubTypeEngName.toLowerCase();
				cartEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-addedcart")
					.attr("an-ca", "ecommerce")
					.attr("an-ac", "addToCart")
					.attr("an-la", "add-on:go to cart");

				checkEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-button")
					.attr("an-ca", "ecommerce")
					.attr("an-ac", "addToCart")
					.attr("an-la", "add-on:checkout");
			ctaEl.attr("data-modelcode", modelCode)
				.attr("data-modelname", modelName)
				.attr("data-modeldisplay", displayName)
				.attr("data-modelprice", modelPrice)
				.attr("data-discountprice", discountprice)
				.attr("data-pvitype", pviTypeName)
				.attr("data-pvisubtype", pviSubtypeName)
				.attr("data-pimsubtype", categorySubTypeEngName)
				.attr("data-modelrevenue", modelrevenue)
				.attr("data-modelqty", modelqty)
				.attr("data-modelcurrency", currency);
		} else {
				cartEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-notaddedcart")
					.attr("an-ca", "content click")
					.attr("an-ac", "feature")
					.attr("an-la", "add-on:go to cart");

				checkEl.attr("an-tr", "pdd16_product bought together-" + pageTrack + "-text-notaddedcart")
					.attr("an-ca", "content click")
					.attr("an-ac", "feature")
					.attr("an-la", "add-on:checkout");
			ctaEl.removeAttr("data-modelcode")
				.removeAttr("data-modelname")
				.removeAttr("data-modeldisplay")
				.removeAttr("data-modelprice")
				.removeAttr("data-discountprice")
				.removeAttr("data-pvitype")
				.removeAttr("data-pvisubtype")
				.removeAttr("data-pimsubtype")
				.removeAttr("data-modelrevenue")
				.removeAttr("data-modelqty")
				.removeAttr("data-modelcurrency");
		}
	}
	
	// addOn Gift TNC Component
	function addOnGiftTNC(){

		const _$ui = {
			tnc : $('.pdd16-step-buying__tnc'),
			giftContinueBtn : $('#giftContinue')
		}

		const composeHtml = (tncItemList) => {

			let tncHtml = '';

			if(tncItemList && tncItemList.length > 0){
				tncHtml = tncItemList.map((tncItem)=>{
					return /*html*/`
					<div class="pdd16-step-buying__tnc-checkbox ${tncItem.required ? 'is-required' : ''}">
						<div class="checkbox-v2">
							<input class="checkbox-v2__input" type="checkbox" name="checkbox" id="${tncItem.code}">
							<label class="checkbox-v2__label" for="${tncItem.code}">
							<span class="checkbox-v2__label-box-wrap">
								<span class="checkbox-v2__label-box">
								<svg class="checkbox-v2__label-box-icon" focusable="false" aria-hidden="true">
									<use xlink:href="#done-bold" href="#done-bold"></use>
								</svg>
								</span>
							</span>
							<span class="checkbox-v2__label-text">${tncItem.content}</span>
							</label>
						</div>
					</div>`
				}).join('')
			}

			return tncHtml;
		}

		const render = (context) => {
			$.when(
				dynamic.freeGiftHybrisCommon.getTnc(context)
			).done((tncApiResponse)=>{
				if(tncApiResponse && tncApiResponse.length > 0){
					_$ui.tnc.html(composeHtml(tncApiResponse));
					const tncList = $(".pdd16-step-buying__tnc .pdd16-step-buying__tnc-checkbox input[name='checkbox']");
					const checkFlag = localConfigurator.get('useTnc') ? tncCheck(tncList) : true;
					if(!checkFlag){
						$('#giftContinue').addClass('cta--disabled').attr('disabled', true);
					}
				}
			})
		}

		return {
			render : render
		}

	}
	
	$(document).off("click",".hubble-care-popup .hubble-care-popup__button-item a");
	$(document).on("click",".hubble-care-popup .hubble-care-popup__button-item a", function(e){
		var _this = $(this);
		if(sharedObj.globalServiceInfo['care'] != undefined  && _this[0].innerText == 'Confirm'){ //  SC+     
			var services = sharedObj.globalServiceInfo;
			var careData = services.care;
			var giftCarePrice = $(".hiddenPrice").val() - careData.sale_price.value;
			var monthly = window.sg.components.dynamic.detailSharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal;
			var monthlyPrice = window.sg.components.dynamic.detailSharedObj.proudctPriceInfo.monthlyPriceInfo.tenureVal;
			var totalPrices = Granite.I18n.get("From {0}/mo", currencyComma(giftCarePrice / Number(monthly), currency)) + ' ' + Granite.I18n.get("for {0} mos",monthly) + ' ' + orI18n + ' '+currencyComma(giftCarePrice, currency);
			var MonthlyPrice = totalPrices.split(" " + orI18n + " ");
			var priceHtml = "";
			if (monthlyCheckedFlag) {
				priceHtml =
				`
                    <p class="hidden"><strong>${monthly18n}</strong></p>
                    <p class="pdd16-step-buying__header-price-text"><strong>${fromI18n} ${MonthlyPrice[0].replace(fromI18n, "")}</strong><br>
                    	${orI18n} ${MonthlyPrice[1]}</p>
                    <input type="hidden" class="hiddenPrice" value="${giftCarePrice}">
                `;
            } else {
                priceHtml =
				`
					<p class="hidden"><strong>${monthly18n}</strong></p>
                	<p class="pdd16-step-buying__header-price-text"><strong>${fromI18n} ${MonthlyPrice[1]}</strong></p>
                	<input type="hidden" class="hiddenPrice" value="${giftCarePrice}">
				`;
             }
			$(".pdd16-step-buying__header-price").html(priceHtml);
			$(".pdd16-step-buying__footer-sum").html(priceHtml);
			
		}
		var smcCode = $("#radio-id-SC").attr('data-modelCode');
		selectProductList.push(smcCode);
		if(selectProductList.length == 0){
			$("#giftContinue").addClass('cta--disabled').attr('disabled', true)
		}else{
			$("#giftContinue").removeClass('cta--disabled').attr('disabled', false)
		}
		
	})
	
	//  add
	$(document).off("click","#bundleAddOnGift");
	$(document).on("click","#bundleAddOnGift", function(){
		const bundleSumProdCode = [];
		const itemList = $(".add-ons-evoucher-popup__item .option-selector-v2__swiper-slide.is-checked");
		$.each(itemList,function(idx,value){
			bundleSumProdCode.push(itemList.find('.option-selector-v2__color-code')[idx].getAttribute('data-modelcode'))
		})
		for(let i = 0; i < bundleSumProdCode.length; i++){
			selectProductList.push(bundleSumProdCode[i]);
		}
		if(selectProductList.length == 0){
			$("#giftContinue").addClass('cta--disabled').attr('disabled', true);
		}else{
			$("#giftContinue").removeClass('cta--disabled').attr('disabled', false);
			const modelCode = $(this).attr('data-parent-modelcode');
			const bundleList = $('.pdd16-step-buying--free-gift .pdd16-step-buying__card-input .cta--bundle');
			bundleList.each(function(idx){
				if( $(this).attr('data-modelcode') === modelCode ){
					$(this).prop('checked', true);
				}
			});
		}
		
		window.sg.components.notifyMePopup.closePopup();
	});
	
	$(document).off("click",".pdd16-step-buying__tnc .pdd16-step-buying__tnc-checkbox input[name='checkbox']");
	$(document).on("click",".pdd16-step-buying__tnc .pdd16-step-buying__tnc-checkbox input[name='checkbox']", function(){
		const tncList = $(".pdd16-step-buying__tnc name='checkbox']");
		const checkFlag = tncCheck(tncList);
		if( checkFlag ){
			$('#giftContinue').removeClass('cta--disabled').attr('disabled', false);
		}else{
			$('#giftContinue').addClass('cta--disabled').attr('disabled', true);
		}
	});
	
	//tnc  
	var tncCheck = function(checkBox) {
		var checkFlage = true;

		if (checkBox.length > 0) {
			checkBox.each(function () {
				var _this = $(this);
				if (_this.closest('.pdd16-step-buying__tnc-checkbox').hasClass("is-required")) {
					checkFlage = checkFlage && _this.is(":checked");
				}
			});
		}
		return checkFlage; 
	}
	
	$(document).off("click","#giftContinue");
	$(document).on("click","#giftContinue",function(){
		const isSoundbarCategoryData = sharedObj.soundbarCategoryData && Object.keys(sharedObj.soundbarCategoryData).length > 0 ? true : false;
		if(OOSflag){
			if(sharedObj.hasAddOns && !sharedObj.isEmbedAddOyData){
    			window.sg.components.dynamic.bridgePageCommonHybris.moveBridgePage();
    		}else{
    			dynamic.DetailAfterEvent.addToCartCta([], true, true);
    		}
		}else{
			selectProductList = selectProductList.filter(function(elem){
				return elem;
			});
			if(selectProductList[0].indexOf(',') > -1){
				selectProductList = selectProductList[0].split(',');
			}
			setTimeout(function() {
	        	window.sg.components.stepbuying.init();
	        	if(sharedObj.hasAddOns && !sharedObj.isEmbedAddOn || sharedObj.hasAddOns && sharedObj.isEmbedAddOn && isSoundbarCategoryData){
	        		//  gift addon.bridgePage.js => showBetterTogether  selectedGift 
	    			window.sg.components.dynamic.bridgePageCommonHybris.moveBridgePage();
	    		}else{
	    			dynamic.DetailAfterEvent.addToCartCta(selectProductList, true, true);
	    		}
	    		if(sharedObj.globalServiceInfo['care'])
	    			delete sharedObj.globalServiceInfo['care'];
	        }, 10);
		}
	})
		
	dynamic.bridgePagefreeGift = (function () {
		return {
			moveBridgePage: moveBridgePage
		}
	})();

})(window, window.jQuery);
((window, $) => {
	"use strict";
	
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	const sharedObj = dynamic.detailSharedObj;
	const currency = $("#priceCurrency").val();
	const siteCode = $("#siteCode").val();
	const isSEBN = (siteCode === "nl" || siteCode === "be" || siteCode === "be_fr");
	const isOldHybris = $("#shopIntegrationFlag").val() === "Hybris" || $("#shopIntegrationFlag").val() === "Hybris-intg";
	const isNewHybris = $("#shopIntegrationFlag").val() === "Hybris-new";
	const storeDomain = $("#storeDomain").val();
	const categoryGroupCode = $('#categoryGroupCode').val()
	
	let productListData = new Array();
	let productListDataBundle = new Array();
	let relatedProducts = {};
	let relatedProductsBundle = {};
	let relatedProductsBundleTotal = [];
	
	let addOnType = "";
	let addOnType2 = "";
	let optionTagging = "";
	let ctaTagging = "";
	
	$(document).on('bundlePopupEvent', function(e, bundleInfo){
		
		if($(".hubble-addon-page").hasClass("is-gift-type")) {
			addOnType = "free gift";
			addOnType2 = "free gift";
			optionTagging = "-select-option";
			ctaTagging = "-cta-option button";
		} else {
			if(dynamic.detailSharedObj.isVoucher) {
				addOnType = "evoucher";
				addOnType2 = "evoucher";
				optionTagging = "-option-select";
				ctaTagging = "-select-option add button";
			} else {
				addOnType = "add-on";
				addOnType2 = "add on";
				optionTagging = "-kit-option";
				ctaTagging = "-cta-addtocart";
			}
		}
		
		if($("#storeType").val() == 'NewHybris') {
			getNewRelatedProductsBundleInfo(bundleInfo);
		} else {
			getRelatedProductsBundleInfo(bundleInfo);

		}
	});
	
	
	var bundleProduct = {}, pageBundleData = {};
	var bundleProds = {}, pageBundleDataProducts = {};
	
	var fromI18n = Granite.I18n.get("From");
	var orI18n = Granite.I18n.get("or");
	var monthly18n = Granite.I18n.get("Monthly Price:");
	var fullI18n = Granite.I18n.get("Full Price:");
	var addI18n = Granite.I18n.get("Add");
	var deleteConfirmI18n = Granite.I18n.get("Are you sure to remove this product?");

	function getRelatedProductsSimpleInfo(modelCode) {
		relatedProductsBundle = {};
		productListData = new Array();
		if( isOldHybris ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjaxOldHybris(sharedObj, modelCode, function (data, isSuccess) {
				if (isSuccess && data.products != null && data.products.length > 0) {
					relatedProducts = {};
					$.each(data.products, function (idx, obj) {
						if (obj.stocklevel && obj.stocklevel) {
							var modelCode = obj.modelcode;
							var product = relatedProducts[modelCode] = {};
							product.modelCode = modelCode;
							product.name = obj.name;
							if (obj.imageUrl) {
								product.imageUrl = obj.imageUrl;
							}
							if (obj.imageUrlAlt) {
								product.imageUrlAlt = obj.imageUrlAlt;
							}
							if (obj.stocklevel) {
								product.stocklevel = obj.stocklevel;
							}
							if (obj.price && obj.priceValue) {
								product.priceValue = obj.priceValue;
								product.price = obj.price;
							}
							if (obj.promotionPrice && obj.promotionPriceValue) {
								product.promotionPriceValue = obj.promotionPriceValue;
								product.promotionPrice = obj.promotionPrice;
								if (obj.priceValue === obj.promotionPriceValue) {
									product.promotionPriceValue = null;
									product.promotionPrice = null;
								}
							}
							if(obj.modelcode.substring(0,2) == 'F-'){
								if(obj.picture) {
									product.imageUrl = obj.picture.url;
								}
								if(obj.name) {
									product.name = obj.name;
								}
								$.extend(obj, product);
								relatedProductsBundle[obj.modelcode] = obj;
								getRelatedProductsSimpleBundle(obj.modelcode);
								sharedObj.hasGiftBundle = true;
							}
						}
					});
					sharedObj.relatedProductsBundle = relatedProductsBundle;
					window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);	
				} else {
					window.sg.components.dynamic.detailSharedObj.hasGift = false;
					if( !window.sg.components.dynamic.detailSharedObj.hasAddOns ){
						window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(false);
					}
				}
			}, null, {"queryType":"SELECTION_OF_GIFT"});
			
		}else if( isNewHybris ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjax(modelCode, function (data, isSuccess) {
			    // CRHQ-8914 [B2C][MX][DE] [SIM-Service] customize free-gift based on the planID
			    window.sg.components.dynamic.detailSharedObj.relatedProductsObj = {};
			    if (isSuccess && data.products != null && data.products.length > 0) {
			        window.sg.components.dynamic.detailSharedObj.relatedProductsObj = data;
                    relatedProductsSimpleInfoSuccessCallBackFunc(data, sharedObj, relatedProductsBundle);
                    window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
                } else {
                    window.sg.components.dynamic.detailSharedObj.hasGift = false;
                    if( !window.sg.components.dynamic.detailSharedObj.hasAddOns ){
                        window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(false);
                    }
                }
			}, null, {"queryType":"SELECTION_OF_GIFT"});
		}
	}

    // CRHQ-8914 [B2C][MX][DE] [SIM-Service] customize free-gift based on the planID
	function getTariffRelatedProductsSimpleInfo(modelCode) {
        const sharedObj = dynamic.detailSharedObj;
        relatedProductsBundle = {};
        sharedObj.hasGiftBundle = false;
        productListData = new Array();

        window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjax(modelCode, function (data, isSuccess) {
            if (isSuccess && data.products != null && data.products.length > 0) {
                window.sg.components.dynamic.detailSharedObj.hasTariffGift = true;
                window.sg.components.dynamic.detailSharedObj.hasGift = true;
    ProductsBundle);
                window.sg.components.dynamic.DetailAfterEvent.hybrisDrawAccessory(true);
            } else {
                window.sg.components.dynamic.detailSharedObj.hasTariffGift = false;
            }
        }, null, {"queryType":"SELECTION_OF_GIFT_FOR_SERVICETYPE", "serviceId": sharedObj.tariffServiceId});
    }

    // CRHQ-8914 [B2C][MX][DE] [SIM-Service] customize free-gift based on the planID
	function relatedProductsSimpleInfoSuccessCallBackFunc(data, sharedObj, relatedProductsBundle) {
	    relatedProducts = {};
        $.each(data.products, function (idx, obj) {
            var modelCode = obj.modelcode;
            var product = relatedProducts[modelCode] = {};
            product.modelCode = modelCode;
            product.name = obj.name;
            if (obj.picture) {
                product.imageUrl = obj.picture.url;
                product.imageUrlAlt = obj.picture.altText;
            }
            if (obj.stock) {
                product.stocklevel = obj.stock.stockLevelStatus;
            }
            if (obj.price && obj.price.value) {
                product.priceValue = obj.prilue = obj.price.value;
                product.promotionPrice = obj.price.formattedValue;
            }
            if (obj.promotionPrice && obj.promotionPrice.value) {
                product.promotionPriceValue = obj.promotionPrice.value;
                product.promotionPrice = obj.promotionPrice.formattedValue;
            }
            if(obj.modelcode.substring(0,2) == 'F-'){
                if(obj.name) {
                    product.name = obj.name;
                }
                $.extend(obj, product);
                relatedProductsBundle[obj.modelcode] = obj;
                getRelatedProductsSimpleBundle(obj.modelcode);
                sharedObj.hasGiftBundle = true;
            }
        });
        sharedObj.relatedProductsBundle = relatedProductsBundle;
	}
	
	function getRelatedProductsSimpleBundle(modelCode) {
		if( isOldHybris ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjaxOldHybris(sharedObj, modelCode, function (data, isSuccess) {
				relatedProductsBundle = {};
				relatedProductsBundle.bundleModelCode = modelCode;
				if (isSuccess && data.products != null && data.products.length > 0) {
					$.each(data.products, function (idx, obj) {
						var modelCode = obj.modelcode;
						var product = relatedProductsBundle[modelCode] = {};
						product.modelCode = modelCode;
						product.name = obj.name;
						
						if (obj.imageUrl) {
							product.imageUrl = obj.imageUrl;
						}
						if (obj.imageUrlAlt) {
							product.imageUrlAlt = obj.imageUrlAlt;
						}
						if (obj.stocklevel) {
							product.stocklevel = obj.stocklevel;
						}
						if (obj.price && obj.priceValue) {
							product.priceValue = obj.priceValue;
							product.price = obj.price;
							product.promotionPriceValue = obj.priceValue;
							product.promotionPrice = obj.price;
						}
						if (obj.promotionPrice && obj.promotionPriceValue) {
							product.promotionPriceValue = obj.promotionPriceValue;
							product.promotionPrice = obj.promotionPrice;
						}
						
						if( obj.colorCode ){
							product.colorCode = obj.colorCode;
						}
					});
					relatedProductsBundleTotal.push(relatedProductsBundle);
				}
				sharedObj.addonGiftBundleRelatedData = relatedProductsBundleTotal;
			}, null, {"queryType":"SELECTION_OF_BUNDLE"});
			
		}else if( isNewHybris ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callRelatedProductAjax(modelCode, function (data, isSuccess) {
				relatedProductsBundle = {};
				relatedProductsBundle.bundleModelCode = modelCode;
				if (isSuccess && data.products != null && data.products.length > 0) {
					$.each(data.products, function (idx, obj) {
						var modelCode = obj.modelcode;
						var product = relatedProductsBundle[modelCode] = {};
						product.modelCode = modelCode;
						product.name = obj.name;
						
						if (obj.picture) {
							product.imageUrl = obj.picture.url;
							product.imageUrlAlt = obj.picture.altText;
						}
						if (obj.stock) {
							product.stocklevel = obj.stock.stockLevelStatus;
						}
						if (obj.price && obj.price.value) {
							product.priceValue = obj.price.value;
							product.price = obj.price.formattedValue;
							product.promotionPriceValue = obj.price.value;
							product.promotionPrice = obj.price.formattedValue;
						}
						if (obj.promotionPrice && obj.promotionPrice.value) {
							product.promotionPriceValue = obj.promotionPrice.value;
							product.promotionPrice = obj.promotionPrice.formattedValue;
						}
						if((obj.groupCode && obj.groupId == 0 ) || ( obj.groupCode && obj.groupId != 0 )){
							product.groupCode = obj.groupCode;
							product.groupId = obj.groupId;
						}
						
						if( obj.colorCode ){
							product.colorCode = obj.colorCode;
						}
					});
					relatedProductsBundleTotal.push(relatedProductsBundle);
				}
				sharedObj.addonGiftBundleRelatedData = relatedProductsBundleTotal;
			}, null, {"queryType":"SELECTION_OF_BUNDLE"});
		}
	}

	function getProductListData(){
		return productListDataBundle;
	}
	
	function getSearchProductcard(callback) {
		var modelList = new Array();
		$.each(Object.keys(relatedProducts), function(index,item){
			if(item.substr(0, 2) != "F-") { // 'F-'  Bundle  Search API Data 
				modelList.push(item);
			}
		});
		if( modelList.length > 0 ){
			window.sg.components.dynamic.detailSharedObj.commonApiModel.callSearchApiAjax(modelList, function (data, isSuccess) {
				if (isSuccess && data.response.statusCode === 200 && data.response.resultData != null && data.response.resultData.productList != null) {
					var productList = data.response.resultData.productList;
					$.each(productList, function (familyIdx, product) {
						var modelList = product.modelList;
						if (modelList != null) {
							$.each(modelList, function (modelIdx, model) {
								var modelCode = model.modelCode;
								if (!relatedProducts[modelCode]) {
									return;
								}
								var stocklevel = relatedProducts[modelCode].stocklevel;
	
								if (!model.displayName) {
									model.displayName = relatedProducts[modelCode].name || "";
								}
								model.thumbUrlAlt = relatedProducts[modelCode].imageUrlAlt || "";
								model.priceDisplay = relatedProducts[modelCode].price || "";
								model.promotionPriceDisplay = relatedProducts[modelCode].promotionPrice || "";
								model.price = relatedProducts[modelCode].priceValue || "";
								model.promotionPrice = relatedProducts[modelCode].promotionPriceValue || "";
								model.stocklevel = stocklevel;
								model.isStock = !(stocklevel === "" || stocklevel.toUpperCase() === "OUTOFSTOCK");
								model.idx = String(familyIdx) + '-' + String(modelIdx); // familyNum
							});
						}
					});
					productListData = productList;
					callback(productListData);
					
					// pd    free gift    
					// window.sg.components.dynamic.DetailAfterEvent.hybrisDrawGift(true);
				}
			}, null, null);
		} else {
			callback([]);
		}
	}

	function getAddOnGift() {
		return productListData;
	}

	function giftPopupGrid(selectIndex) {
		window.sg.components.dynamic.freeGift.giftPopupGrid(selectIndex);
	}
	
	function setPriceInfo(model) {
		var productPrice = model.price;
		var promotionPrice = model.promotionPrice;
		var savePriceTemp = Number((productPrice - promotionPrice).toFixed(2));
		var saveText = currencyComma(savePriceTemp, currency);
		var productPriceDisplay = (isSEBN || !model.priceDisplay) ? currencyComma(productPrice, currency) : model.priceDisplay;
		var promotionPriceDisplay = (isSEBN || !model.promotionPriceDisplay) ? currencyComma(promotionPrice, currency) : model.promotionPriceDisplay;

		return {
			"promotionPrice": promotionPrice,
			"productPrice": productPrice,
			"savePriceTemp": savePriceTemp,
			"saveText": saveText,
			"productPriceDisplay": productPriceDisplay,
			"promotionPriceDisplay": promotionPriceDisplay
		}
	}
	
	function getBundleSearchProductcard(callback){
		var modelList = new Array();
		$.each(relatedProducts, function(index,item){
			if(item.modelcode.substr(0, 2) != "F-") { // 'F-'  Bundle  Search API Data 
				modelList.push(item.modelcode);
			}
		});
		window.sg.components.dynamic.detailSharedObj.commonApiModel.callSearchApiAjax(modelList, function (data, isSuccess) {
			if (isSuccess && data.response.statusCode === 200 && data.response.resultData != null && data.response.resultData.productList != null) {
				var productList = data.response.resultData.productList;
				$.each(relatedProductsBundle, function(i,value){
					$.each(productList, function (familyIdx, product) {
						var modelList = product.modelList;
						var categorySubTypeEngName = product.categorySubTypeEngName;
						if (modelList != null) {
							$.each(modelList, function (modelIdx, model) {
								var modelCode = model.modelCode;
								var stocklevel = relatedProductsBundle[modelCode].stocklevel || "";
	
								if (!relatedProductsBundle[modelCode]) {
									return;
								}
								if (!model.displayName) {
									model.displayName = relatedProductsBundle[modelCode].name || "";
								}
								model.thumbUrlAlt = relatedProductsBundle[modelCode].imageUrlAlt || "";
								model.priceDisplay = relatedProductsBundle[modelCode].price || "";
								model.promotionPriceDisplay = relatedProductsBundle[modelCode].promotionPrice || "";
								model.price = relatedProductsBundle[modelCode].priceValue || "";
								model.promotionPrice = relatedProductsBundle[modelCode].promotionPriceValue || "";
								model.stocklevel = stocklevel;
								model.isStock = !(stocklevel === "" || stocklevel.toUpperCase() === "OUTOFSTOCK");
								model.idx = String(familyIdx) + '-' + String(modelIdx) // familyNum
							});
						}
					});
				});
				productListDataBundle = productList;
				callback(productListDataBundle);
			}
		}, null, null);
	}

	function getTnc(context){
		//[23.11.21] EPP 
		const apiDomain = (checkEppSite() && isOldHybris) ? $("input#newHyvStoreDomain").val() : storeDomain;
		const siteCodeWithEpp = checkEppSite() ? window.sg.epp.common.companyCode : siteCode;
		const _xhrFields = checkEppSite() ? { withCredentials: true } : {};		
		return $.ajax({
			url: `${apiDomain}/tokocommercewebservices/v2/${siteCodeWithEpp}/tnc?context=${context}&value=${categoryGroupCode}`,
			type: "GET",
			dataType: "json",
			xhrFields: _xhrFields
		});
	}
	
	window.sg.components.dynamic.freeGiftHybrisCommon = (function () {
		return {
			getRelatedProductsSimpleInfo: getRelatedProductsSimpleInfo,
			getRelatedProductsSimpleBundle : getRelatedProductsSimpleBundle,
			getAddOnGift: getAddOnGift,
			giftPopupGrid: giftPopupGrid,
			getSearchProductcard : getSearchProductcard,
			setPriceInfo : setPriceInfo,
			getBundleSearchProductcard : getBundleSearchProductcard,
			getProductListData : getProductListData,
			// CRHQ-8914 [B2C][MX][DE] [SIM-Service] customize free-gift based on the planID
			getTariffRelatedProductsSimpleInfo: getTariffRelatedProductsSimpleInfo,
			relatedProductsSimpleInfoSuccessCallBackFunc: relatedProductsSimpleInfoSuccessCallBackFunc,
			relatedProductsBundle: relatedProductsBundle,
			getTnc: getTnc
		}
	})();

})(window, window.jQuery);

(() => {
	if($("#siteCode").val() === "id"){
		  return;
	}
	
  const $q = window.sg.common.$q;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;
  const swiperManager = window.sg.common.swiperManager;
  const lazyLoad = window.sg.common.lazyLoad;
  const optionSelector = window.sg.common.OptionSelector;
  const scrollbar = window.sg.common.scrollbar;
  const icon = window.sg.common.icon;
  const isVerticalVisible = window.sg.common.utils.isVerticalVisible;

  const selector = {
    section: '.pd-product-compare__item-box',
    sectionWrap: '.pd-product-compare',
    sameHeight: ['.pd-product-compare__info-rating', '.option-selector', '.pd-product-compare__price-full', '.pd-product-compare__price-description', '.pd-product-compare__fiche__cta-wrap', '.pd-product-compare__fiche', '.pd-product-compare__item-box'],
  };

  // option-selector

  let statePc = null;
  // let resizeTimer = null;
  // function resizeEvent() {
  //   clearTimeout(resizeTimer);
  //   resizeTimer = null;
  //   resizeTimer = setTimeout(setResize, 400);
  // }

  function resizeEvent() {
    const nowPc = BREAKPOINTS.MOBILE < utils.getViewPort().width;

    if (statePc !== nowPc) {
      if (nowPc) {
        $q(selector.sectionWrap).target.forEach((section) => {
          const $section = $q(section);
          const $itemBoxFix = $section.find('.pd-product-compare__item-box-fix');
          const $inDesktop = $section.find('.pd-product-compare__scroll-desktop .pd-product-compare__item-box-fix');
          if ($itemBoxFix.target.length !== 0 && $itemBoxFix.target[0] !== null && ($inDesktop.target[0] !== null && $inDesktop.target[0] !== undefined)) {
            $section.find('.pd-product-compare__scroll-mobile').prepend($itemBoxFix.target[0]);
          }
        });
      } else {
        $q(selector.sectionWrap).target.forEach((section) => {
          const $section = $q(section);
          const $itemBoxFix = $section.find('.pd-product-compare__item-box-fix');
          const $inDesktop = $section.find('.pd-product-compare__scroll-desktop .pd-product-compare__item-box-fix');
          if ($itemBoxFix.target.length !== 0 && $itemBoxFix.target[0] !== null && ($inDesktop.target[0] === null || $inDesktop.target[0] === undefined)) {
            $section.find('.pd-product-compare__scroll-desktop').prepend($itemBoxFix.target[0]);
          }
        });
      }

      $q(selector.sectionWrap).target.forEach((wrap) => {
        if (wrap.querySelectorAll('.pd-product-compare__item-box').length <= (nowPc ? 4 : 2)) {
          if (wrap.querySelector('.scrollbar-horizontal__track')) {
            wrap.querySelector('.scrollbar-horizontal__track').style.visibility = 'hidden';
          }
        } else {
          if (wrap.querySelector('.scrollbar-horizontal__track')) {
            wrap.querySelector('.scrollbar-horizontal__track').style.visibility = '';
          }
        }
      });

      statePc = nowPc;
    }

    sameHeight();

    setTimeout(() => {
      $q(`${selector.sectionWrap} .scrollbar`).target.forEach((element) => {
        window.sg.common.scrollbar.resize(element);
      });
    }, 30);
  }

  function sameHeight() {
    $q(selector.sectionWrap).target.forEach((section) => {
      const $section = $q(section);
      $section.find('.pd-product-compare__feature').removeClass('line-4');

      $section.find('.pd-product-compare__feature').target.forEach((el) => {
        const listNum = $q(el).find('li').target.length;

        if (listNum >= 4) {
          $section.find('.pd-product-compare__feature').addClass('line-4');
        }
      });

      selector.sameHeight.forEach((selector2) => {
        const $sames = $section.find(selector2);
        $sames.css({
          'height': '',
        });

        let maxHeight = 0;
        $sames.target.forEach((ele) => {
          if (ele.classList.contains('pd-product-compare__fiche__cta-wrap')) {
            if (ele.childElementCount === 0) {
              ele.classList.add('no-energy-label');
            }
          }

          if (ele.classList.contains('pd-product-compare__fiche')) {
            if (ele.querySelector('.badge-repairability')) {
              ele.classList.add('with-repairability');
            }
          }

          const h = $q(ele).outerHeight();
          if (maxHeight < h) {
            maxHeight = h;
          }
        });

        $sames.css({
          'height': `${maxHeight}px`,
        });
      });
    });
  }

  function bindEventResize() {
    $q(window).off('resize', resizeEvent).on('resize', resizeEvent);
    resizeEvent();
  }

  class PdProductCompare {
    constructor(component) {
      this.selector = {
        section: selector.section,
        imgWrap: '.pd-product-compare__box-image .swiper-container',
      };

      this.ele = {
        window: $q(window),
        section: $q(component),
        imgWrap: null,
      };

      this.statePc = null;

      this.setProperty();

      this.mousoverImgTimer = null;

      this.handler = {
        resize: this.resize.bind(this),
        imageInViewport: this.imageInViewport.bind(this),
        mouseOverImg: this.mouseOverImg.bind(this),
        stopOverImg: this.stopOverImg.bind(this),
      };

      PdProductCompare.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.imgWrap = this.ele.section.find(this.selector.imgWrap);

      this.statePc = null;
    }

    init() {
      this.bindEvents();
      this.resize();

      icon.update(this.ele.section.closest(selector.section).target[0]);
    }

    reInit() {
      this.ele.section.find('.basic-swiper').target.forEach((sw) => {
        if (sw.swiper === undefined) {
          swiperManager.slideInit(sw);
        } else {
          swiperManager.slideReInit(sw);
        }
      });

      this.setProperty();

      if (this.ele.imgWrap.target.length > 0 && !this.ele.imgWrap.hasClass('image-checked')) {
        this.ele.window.off('scroll', this.handler.imageInViewport).on('scroll', this.handler.imageInViewport);
        this.imageInViewport();
      }

      this.resize();

      icon.update(this.ele.section.closest(selector.section).target[0]);
    }

    resize() {
      const nowPc = BREAKPOINTS.MOBILE < utils.getViewPort().width;

      if (nowPc !== this.statePc) {
        this.bindImageMode(nowPc);
      }

      this.statePc = nowPc;
    }

    imageInViewport() {
      if (isVerticalVisible(this.ele.section.target[0])) {
        window.sg.common.lazyLoad.forceLoad(this.ele.imgWrap.target[0]);
        this.ele.imgWrap.addClass('image-checked');
        this.ele.window.off('scroll', this.handler.imageInViewport);
      }
    }

    bindEvents() {
      this.ele.window.off('resize', this.handler.resize).on('resize', this.handler.resize);

      if (this.ele.imgWrap.target.length > 0 && !this.ele.imgWrap.hasClass('image-checked')) {
        this.ele.window.off('scroll', this.handler.imageInViewport).on('scroll', this.handler.imageInViewport);
        this.imageInViewport();
      }
    }

    bindImageMode(nowPc) {
      clearInterval(this.mousoverImgTimer);
      this.mousoverImgTimer = null;

      if (nowPc) {
        this.ele.imgWrap.parent().off('mouseenter', this.handler.mouseOverImg).on('mouseenter', this.handler.mouseOverImg);
        this.ele.imgWrap.parent().off('focusin', this.handler.mouseOverImg).on('focusin', this.handler.mouseOverImg);

        this.ele.imgWrap.parent().off('mouseleave', this.handler.stopOverImg).on('mouseleave', this.handler.stopOverImg);
        this.ele.imgWrap.parent().off('focusout', this.handler.stopOverImg).on('focusout', this.handler.stopOverImg);

        swiperManager.slideSwiperDestory(this.ele.imgWrap.target[0]);
      } else {
        this.ele.imgWrap.parent().off('mouseenter', this.handler.mouseOverImg);
        this.ele.imgWrap.parent().off('focusin', this.handler.mouseOverImg);

        this.ele.imgWrap.parent().off('mouseleave', this.handler.stopOverImg);
        this.ele.imgWrap.parent().off('focusout', this.handler.stopOverImg);

        this.ele.window.off('resize', this.handler.resize);
        swiperManager.slideReInit(this.ele.imgWrap.target[0]);

        const swiper =  swiperManager.getSwiper(this.ele.imgWrap.target[0]);
        swiper.on('touchMove', (event) => {
          event.preventDefault();
          event.stopPropagation();
          scrollbar.scrollTo($q(selector.sectionWrap).find('.scrollbar').target[0], 0);
        });

        setTimeout(() => {
          this.ele.window.on('resize', this.handler.resize);
        }, 30);
      }
    }

    mouseOverImg() {
      clearInterval(this.mousoverImgTimer);
      this.mousoverImgTimer = null;

      const $images = this.ele.imgWrap.find('.swiper-slide');
      let count = 0;

      function changeImg() {
        if (count >= $images.target.length - 1) {
          $images.show();
          count = 0;
        } else {
          $images.eq(count).hide();
          count++;
        }
      }

      this.mousoverImgTimer = setInterval(() => {
        changeImg();
      }, 500);
    }

    stopOverImg() {
      clearInterval(this.mousoverImgTimer);
      this.mousoverImgTimer = null;
      this.ele.imgWrap.find('.swiper-slide').show();
    }
  }

  function init() {
    statePc = null;
    lazyLoad.setLazyLoad();

    $q(selector.sectionWrap).find('.scrollbar').target.forEach((scroll) => {
      window.sg.common.scrollbar.reInit(scroll);
    });

    bindEventResize();

    $q(selector.section).find('.option-selector').target.forEach((os) => {
      optionSelector.reInit($q(os));
    });

    $q(selector.section).target.forEach((element) => {
      if (PdProductCompare.instances.has(element)) {
        const instances =  PdProductCompare.instances.get(element);
        instances.reInit();
      } else {
        new PdProductCompare(element);
      }
    });

    sameHeight();

    $q(selector.sectionWrap).find('.scrollbar').target.forEach((scroll) => {
      window.sg.common.scrollbar.resize(scroll);
    });
  }

  function reInitItem(element) {
    statePc = null;
    lazyLoad.setLazyLoad();

    $q(element).find('.option-selector').target.forEach((os) => {
      optionSelector.reInit($q(os));
    });

    if (PdProductCompare.instances.has(element)) {
      const instances =  PdProductCompare.instances.get(element);
      instances.reInit();
    }

    sameHeight();

    $q(selector.sectionWrap).find('.scrollbar').target.forEach((scroll) => {
      window.sg.common.scrollbar.reInit(scroll);
      window.sg.common.scrollbar.resize(scroll);
    });

    resizeEvent();
  }

  PdProductCompare.instances = new WeakMap();

  // $q.ready(init);
  window.sg.components.pdProductCompare = {
    init,
    reInitItem,
  };
})();

;
(function($, PDPC, sdfUtil, sdfComp) {

	"use strict";

	if($("#siteCode").val() === "id"){
		console.log(" ##### No Compare #### ");
		  return;
	}
	
	const DEBUG = parseInt("1") === 0; // turn off

	// B2B   :: S
	const isB2B = $('#b2bFlag').val() === "Y" ? true : false;
	const isB2BHybris = $('#shopIntegrationFlag').val() === "true" ? true : false;
	const useTaxExPrice = isB2B &&  $.cookies.get("useTaxExPriceYN") == 'Y'? true : false;
	let isLogedin = false;
	let isSMBUser = false;
	
	const isTieredPriceSite = $('#tieredPriceUseYn').val()=="Y"? true:false;
	// B2B   :: E

	const COMPONENT_SELECTOR = "#compare.pd-product-compare";

	const APIPATH_PRODUCT_CARD_DETAIL = "/b2c/product/card/detail";
	const APIPATH_PRODUCT_CARD_DETAIL_FOR_B2B = "/b2b/product/card/detail";

	const SHOPTYPE_GPV2 = "gpv2";
	const SHOPTYPE_NEWHYBRIS = "newhybris";
	const SHOPTYPE_HYBRIS = "hybris";
	const SHOPTYPE_GLOBAL = "global";
	const SHOPTYPE_B2BHYBRIS = "b2bhybris";

	const SEL_ACTIVE_SLIDE = ".active-slide";
	const CLS_ACTIVE_SLIDE = "active-slide";

	const SEL_IS_SELECTED = ".is-selected";
	const CLS_IS_SELECTED = "is-selected";

	const CLS_DISABLED_SWIPER_SLIDE = "is-disabled";

	const SEL_WRAPPER_PANEL = ".sdf-comp-wrapper-panel";
	const SEL_CONTENT_PANEL = ".sdf-comp-content-panel";
	const SEL_FAMILY_CARD = ".sdf-comp-family-card";
	const SEL_FAMILY_CARD_PREFIX = ".sdf-comp-family-card-";
	const SEL_MODEL_NAME = ".sdf-comp-model-name";
	const SEL_MODEL_CODE = ".sdf-comp-model-code";
	const SEL_THUMBNAIL_PANEL = ".sdf-comp-thumbnail-panel";
	const SEL_MODEL_INFO_PANEL = ".sdf-comp-model-info-panel";
	const SEL_CHIP_SWIPER_SLIDE = ".option-selector__swiper-slide";
	const SEL_CHIP_SELECTED_SWIPER_SLIDE = SEL_CHIP_SWIPER_SLIDE + SEL_IS_SELECTED;
	const SEL_OPTION_CHIP = "input.sdf-comp-option-chip";
	const SEL_OPTION_CHIPS = SEL_CHIP_SWIPER_SLIDE + " input.sdf-comp-option-chip";
	const SEL_CHECKED_OPTION_CHIPS = SEL_CHIP_SELECTED_SWIPER_SLIDE + " input.sdf-comp-option-chip";

	const CLS_CURRENT_FAMILY_CARD = "pd-product-compare__item-first";

	const SEL_ANCHOR_MENU_ITEM = "#anchor_pd-g-product-compare";

	const ATTR_FAMILY_ID = "data-family-id";
	const ATTR_CHIP_TYPE = "data-chip-type";
	const ATTR_MODEL_CODE = "data-modelcode";
	const ATTR_MODEL_NAME = "data-modelname";
	const ATTR_MODEL_DISPLAY = "data-modeldisplay";
	const ATTR_MODEL_PRICE = "data-modelprice";
	const ATTR_DISCOUNT_PRICE = "data-discountprice";
	const ATTR_PVI_TYPE = "data-pvitype";
	const ATTR_PVI_SUBTYPE = "data-pvisubtype";
	const ATTR_PIM_SUBTYPE = "data-pimsubtype";

	const TMPL_COMPARE_CONTENT = "compareContent";
	const TMPL_THUMBNAIL_PANEL = "thumbnailPanel";
	const TMPL_MODEL_INFO = "modelInfo";

	const PRESET_THUMBNAIL_DESKTOP = "240_240";
	const PRESET_THUMBNAIL_MOBILE = "480_480";
	const PRESET_THUMBNAIL_EXT = "PNG";
	const PRESET_KEY_SUMMARY = "24_24";

	const CHIP_TYPE_COLOR = "COLOR";

	const KEY_SUMMARY_TYPE_SPEC = "Spec";
	const KEY_SUMMARY_TYPE_FEATURE = "Feature";

	const MSGKEY_VAT_INCLUDED = "VAT Included";
	const MSGKEY_SAVE_VAR = "Save {0}";
	const MSGKEY_FROM_VAR = "From {0}";

	const CTA_NO_ORDER = "NOORDER";
	const CTA_LEARN_MORE = "LEARNMORE";
	const CTA_OUT_OF_STOCK = "OUTOFSTOCK";

	const SITE_SEBN = [ 'be', 'be_fr', 'nl' ];
	const SITE_SEG = [ 'de' ];
	const SITE_SEPOL = [ 'pl' ];
	const SITE_SEI = [ 'it' ];
	const SITE_MULTISTORE_ENABLED = [ 'ae', 'ae_ar' ];
	const SITE_MULTISTORE_MAPPED = {
		"levant" : "jo",
		"levant_ar" : "jo_ar",
		"n_africa" : "ma"
	};
	let SITE_LOWEST_WAS_PRICE = [ 'pl', 'it', 'si', 'gr', 'fi', 'se', 'no', 'dk', 'fr' ];
	let useLowestWasPrice = false;
	
	//[S] 23.07.06 &EPPONLY omnipricing 
	if($('#isEppPage').val() === 'true'){
		if(SITE_LOWEST_WAS_PRICE.includes(siteCode)){
			if ( eppOmniPricingUseYn !== "Y" ){
				let eppLowestWasPriceSiteCode = [];
				eppLowestWasPriceSiteCode = SITE_LOWEST_WAS_PRICE.filter(function (lwstSite) {
				    return lwstSite !== siteCode;
				});
				SITE_LOWEST_WAS_PRICE = eppLowestWasPriceSiteCode;
			}
		}
	}
	//[E] 23.07.06 &EPPONLY omnipricing 
	
	const SITE_NO_MONTHLY_PRICES = [];
	const SITE_NO_MOBILE_REVIEWS = [];

	const COOKIE_DCOM_MULTISTORE = "estoreSitecode";

	let component = null;
	let _apiEndPoint;

	function _initComponentPanel(resData) {
		let prods = resData.productList;
		if (prods.length < 2) { // Search API  
			if (DEBUG) {
				console.log("[PDD04] Incorrect compare data");
				console.dir(resData);
			}
			$(SEL_ANCHOR_MENU_ITEM).remove();
			component.$ui.remove();
			return;
		}

		let mdlCode = component.config.modelCode;
		let curProd = prods.shift();
		let found = false;
		for (let i = 0; i < curProd.modelList.length; i++) {
			if (curProd.modelList[i].modelCode === mdlCode) {
				found = true;
				break;
			}
		}
		if (!found) { // Search API  
			if (DEBUG) {
				console.log("[PDD04] Incorrect compare data: first API item is not current family");
				console.dir(curProd);
			}
			$(SEL_ANCHOR_MENU_ITEM).remove();
			component.$ui.remove();
			return;
		}

		component.familyMap = {};

		let content = {
			currentFamily : _fetchProductFamily(curProd, mdlCode),
			comparableFamilyList : []
		};
		component.familyMap[content.currentFamily.code] = content.currentFamily;
		for (let i = 0; i < prods.length; i++) {
			let family = _fetchProductFamily(prods[i]);
			content.comparableFamilyList.push(family);
			component.familyMap[family.code] = family;
		}
		if (DEBUG) {
			console.log("[PDD04] Fetched family map");
			console.dir(component.familyMap);
		}

		let $contentPanel = component.$ui.wrapperPanel.find(SEL_CONTENT_PANEL).empty();
		component.$ui.contentPanel = $contentPanel;

		component.invokeTemplate(TMPL_COMPARE_CONTENT, {
			content : content
		}, $contentPanel.get(0));

		_initFamilyCardPanel(content.currentFamily);
		for (let i = 0; i < content.comparableFamilyList.length; i++) {
			_initFamilyCardPanel(content.comparableFamilyList[i]);
		}
		content.currentFamily.$panel.addClass(CLS_CURRENT_FAMILY_CARD);

		component.$ui.wrapperPanel.show();
		
		//    
		var colorNameTextClass = "";
		var rdoColorChipClass = "";
		for(var i=1; i <= prods.length+1; i++ ){
			colorNameTextClass = ".option-selector__color-name-text-in."+i;
			//colorTooltipTextClass = ".option-selector__color-tooltip-text."+i;
			rdoColorChipClass = ".is-selected .option-selector__color .rdoColorChip_"+i;

			$(colorNameTextClass).text($(rdoColorChipClass).attr("data-colorchipname"));
			//$(colorTooltipTextClass).text($(rdoColorChipClass).attr("data-colorchipname"));
		}

		setTimeout(function() { // delayed execute (requested from markup-eng.)
			PDPC.init();
		}, 300);

		$contentPanel.find(SEL_OPTION_CHIPS).on("click", function(evt) {
			let self = evt.target, $self = $(evt.target);
			let $familyCard = $self.closest(SEL_FAMILY_CARD);
			let family = component.familyMap[$familyCard.attr(ATTR_FAMILY_ID)];

			// skip already checked (current selected model)
			if (family.currentModel.chipOptionMap[$self.attr(ATTR_CHIP_TYPE)] === self.value) {
				return;
			}

			_checkOptionChipAvailability(family, self);
			

			setTimeout(function() { // delayed exec

				let codeMap = {};
				let $selectedChks = family.$panel.find(SEL_CHECKED_OPTION_CHIPS);
				$selectedChks.each(function(i, elem) {
					codeMap[elem.getAttribute(ATTR_CHIP_TYPE)] = elem.value;
				});
				let codes = [];
				for (let i = 0; i < family.chipOptions.appliedTypes.length; i++) {
					let type = family.chipOptions.appliedTypes[i];
					codes.push(codeMap[type]);
				}
				let mdlCode = codes.join("-");
				let model = family.chipOptions.modelMap[mdlCode];
				if (DEBUG) {
					console.log("[PDD04] Selected model: " + mdlCode);
					console.dir(model);
				}

				family.currentModel = model;
				_renderModel(family, model);

				setTimeout(function() { // delyed execute (requested from markup-eng.)
					PDPC.reInitItem(family.$panel.get(0));
				}, 300);
			}, 100);
		});

		// PD   Anchor-navigation  
		//
		if(isB2B){
			$(SEL_ANCHOR_MENU_ITEM).removeClass("pd11-anchor-nav__menu-item--none");
			window.sg.components.pdAnchorNav.reInit();
		}else{
			$(SEL_ANCHOR_MENU_ITEM).removeAttr("style"); // inline   
			$(SEL_ANCHOR_MENU_ITEM).show();
		}
	}

	function _checkOptionChipAvailability(family, curRadio) {

		function _isAvailable(curChip, rdo) {
			let codes = curChip.joinableChips[rdo.getAttribute(ATTR_CHIP_TYPE)];
			return codes && codes.indexOf(rdo.value) >= 0;
		}

		let curName = curRadio.name, curCode = curRadio.value;
		let curChip = _findOptionChip(family, curRadio.getAttribute(ATTR_CHIP_TYPE), curCode);

		// enable/disable all chips in current family
		//
		family.$panel.find(SEL_CHIP_SWIPER_SLIDE).each(function(i, elem) {
			let $chip = $(elem);
			let rdo = $chip.find(SEL_OPTION_CHIP).get(0);
			if (rdo.name === curName || _isAvailable(curChip, rdo)) {
				$chip.removeClass(CLS_DISABLED_SWIPER_SLIDE);
				rdo.disabled = false;
				if (DEBUG) {
					console.log("[PDD04] Chip enabled: " + rdo.name + ":" + rdo.value);
				}
			} else {
				$chip.addClass(CLS_DISABLED_SWIPER_SLIDE);
				rdo.disabled = true;
			}
			rdo.boundChip.disabled = rdo.disabled;
		});

		// set active current chip
		//
		family.$panel.find("input[name='" + curName + "']").each(function(i, rdo) {
			if (rdo.value === curCode) {
				rdo.setAttribute("checked", "checked");
				rdo.boundChip.checked = true;
				family.chipOptions.optionMap[rdo.boundChip.type].selectedChipCode = rdo.value;
				$(rdo).closest(SEL_CHIP_SWIPER_SLIDE).addClass(CLS_IS_SELECTED);
			} else {
				rdo.removeAttribute("checked");
				rdo.boundChip.checked = false;
				$(rdo).closest(SEL_CHIP_SWIPER_SLIDE).removeClass(CLS_IS_SELECTED);
			}
		});

		// arrange disabled checked chip
		//
		family.$panel.find(SEL_CHIP_SELECTED_SWIPER_SLIDE).each(function(i, elem) {
			let $chip = $(elem);
			let rdo = $chip.find(SEL_OPTION_CHIP).get(0);
			let chipSet = family.chipOptions.optionMap[rdo.boundChip.type];

			if (!$chip.hasClass(CLS_DISABLED_SWIPER_SLIDE)) {
				rdo.boundChip.checked = true;
				chipSet.selectedChipCode = rdo.value;
				return;
			}

			if (DEBUG) {
				console.log("[PDD04] Disabled checked chip: " + rdo.name + ":" + rdo.value);
			}
			$chip.removeClass(CLS_IS_SELECTED);
			rdo.removeAttribute("checked");
			rdo.boundChip.checked = false;
			chipSet.selectedChipCode = null;

			$chip.parent().children(SEL_CHIP_SWIPER_SLIDE).each(function(j, slide) {
				let $self = $(slide);
				if (!$self.hasClass(CLS_DISABLED_SWIPER_SLIDE)) {
					let r = $self.find(SEL_OPTION_CHIP).get(0);
					if (DEBUG) {
						console.log("[PDD04] => Change to checkable chip: " + r.name + ":" + r.value);
					}
					$self.addClass(CLStrue;
					chipSet.selectedChipCode = r.value;
				}
			});
		});

		_resetTaggingAttributesode) {
		let subTypeCode = $.trim(prod.categorySubTypeCode);
		let family = {
			origin : prod,
			displayName : _quotSafe(prod.fmyMarketingName),
			familyRecord : prod.familyRecord,
			categorySubTypeCode : subTypeCode,
			categorySubTypeEngName : prod.categorySubTypeEngName,
			isMobile : subTypeCode.length > 2 && subTypeCode.substring(0, 2) === "01",
			chipOptions : {
				colorChips : null,
				optionChipSets : [],
				appliedTypes : [],
				modelMap : {},
				optionMap : {}
			},
			models : [],
			modelMap : {}
		};

		_fetchChipOptions(prod, family);

		_fetchModels(prod, family);
		if (defaultModelCode) {
			for (let i = 0; i < family.models.length; i++) {
				if (family.models[i].modelCode === defaultModelCode) {
					family.currentModel = family.models[i];
					break;
				}
			}
		}
		if (!family.currentModel && family.models.length > 0) {
			family.currentModel = family.models[0];
		}

		// wiring chip options of the current family
		//
		let appliedChipTypes = family.chipOptions.appliedTypes;
		for (let i = 0; i < family.models.length; i++) {
			let mdl = family.models[i];
			if (mdl.chipOptionId) {
				family.chipOptions.modelMap[mdl.chipOptionId] = mdl;
			}
		}

		// wiring current model of the current family
		//
		if (family.currentModel) {
			family.code = family.currentModel.code;
			family.modelCode = family.currentModel.modelCode;
			if (family.currentModel.chipOptionId) {
				let map = family.currentModel.chipOptionMap;
				for ( let chipType in family.chipOptions.optionMap) {
					let chips = family.chipOptions.optionMap[chipType].chips;
					let code = map[chipType];
					if (code) {
						for (let i = 0; i < chips.length; i++) {
							if (chips[i].code === code) {
								chips[i].checked = "checked";
							}
						}
					}
				}
			}
		}

		return family;
	}

	function _fetchChipOptions(prod, family) {

		function _arrangeProductColor(prod) {
			let opts = prod.chipOptions;

			let found = false;
			for (let i = 0; i < opts.length; i++) {
				if (opts[i].fmyChipType === CHIP_TYPE_COLOR) {
					found = true;
				}
			}
			if (!found) {
				return;
			}

			let codeMap = {};

			//     fmyChipList.fmyChipCode   .
			//
			let seq = 1;
			for (let i = 0; i < prod.modelList.length; i++) {
				let m = prod.modelList[i];
				for (let j = 0; j < m.fmyChipList.length; j++) {
					let o = m.fmyChipList[j];
					if (o.fmyChipType === CHIP_TYPE_COLOR) {
						let key = o.fmyChipCode + ":" + o.fmyChipLocalName;
						let rec = codeMap[key];
						if (!rec) {
							rec = codeMap[key] = {
								optionCode : "COLOR-" + seq++ + o.fmyChipCode,
								colorCode : o.fmyChipCode,
								optionName : o.fmyChipName,
								optionLocalName : o.fmyChipLocalName,
								optionCodeList : o.multiColorList != null && o.multiColorList != undefined ? o.multiColorList.optionCodeList : "",
								optionColorType : o.multiColorList != null && o.multiColorList != undefined ? o.multiColorList.optionColorType : "C1",
								multiColorYN : o.multiColorYN ? o.multiColorYN : "N"
							};
						}
						o.fmyChipCode = rec.optionCode;
						o.colorCode = rec.colorCode;
					}
				}
			}

			// API  prod.chipOptions     .
			//
			for (let i = 0; i < opts.length; i++) {
				if (opts[i].fmyChipType === CHIP_TYPE_COLOR) {
					let colorChips = [];
					for ( let key in codeMap) {
						colorChips.push(codeMap[key]);
					}
					opts[i].optionList = colorChips;
					break;
				}
			}
		}

		function _fetchColorChips(opt) {
			let chips = [];
			for (let i = 0; i < opt.optionList.length; i++) {
				let chip = opt.optionList[i];
				chips.push({
					type : CHIP_TYPE_COLOR,
					code : chip.optionCode,
					colorCode : chip.colorCode,
					name : chip.optionName,
					taggingName : $.trim(chip.optionName).toLowerCase(),
					di: chip.optionColorType == "C1" ? true : false,
					C2AType : chip.optionColorType == "C2_A" ? true : false,
					C2BType : chip.optionColorType == "C2_B" ? true : false,
					C3AType : chip.optionColorType == "C3_A" ? true : false,
					C3BType : chip.optionColorType == "C3_B" ? true : false,
					C3CType : chip.optionColorType == "C3_C" ? true : false,
					C4AType : chip.optionColorType == "C4_A" ? true : false,
					CPType : chip.optionColorType == "CP" ? true : false,
					multiColorY : c	joinableChips : {}
				});
			}
			returetchOptionChips(opt) {
			let set = {
				type : opt.fmyChipType,
				taggingType : opt.fmyChipType.toLowerCase(),
				code : _stripSpecialChars(opt.fmyChipType),
				chips : [],
				numberOfOptionChips : 0
			};
			for (let i = 0; i < opt.optionList.length; i++) {
				let chip = opt.optionList[i];
				set.chips.push({
					type : opt.fmyChipType,
					code : chip.optionCode,
					name : chip.optionName,
					taggingName : $.trim(chip.optionName).toLowerCase(),
					displayName : _quotSafe(chip.optionLocalName),
					joinableChips : {}
				});
			}
			set.numberOfOptionChips = set.chips.length;
			return set;
		}

		if (!prod.chipOptions || prod.chipOptions.length === 0) {
			return;
		}

		_arrangeProductColor(prod);

		let opts = prod.chipOptions;
		let fopts = family.chipOptions;
		for (let i = 0; i < opts.length; i++) {
			let opt = opts[i];
			if (opt.fmyChipType === CHIP_TYPE_COLOR) {
				let chips = _fetchColorChips(opt);
				fopts.colorChipEnabled = true;
				fopts.colorChips = chips;
				fopts.numberOfColorChips = chips.length;
				fopts.optionMap[opt.fmyChipType] = {
					type : CHIP_TYPE_COLOR,
					code : CHIP_TYPE_COLOR,
					chips : chips,
					numberOfOptionChips : chips.length
				};
			} else {
				let set = _fetchOptionChips(opt);
				fopts.optionChipSets.push(set);
				fopts.optionChipEnabled = true;
				fopts.optionMap[opt.fmyChipType] = set;
			}
			fopts.appliedTypes.push(opt.fmyChipType);
		}
		family.optionsAvailable = fopts.colorChipEnabled || fopts.optionChipEnabled;
	}

	function _fetchModels(prod, family) {
		let appliedChipTypes = family.chipOptions.appliedTypes;
		for (let i = 0; i < prod.modelList.length; i++) {
			let omdl = prod.modelList[i];
			if(isB2B){
				// B2B  b2bHybrisShopInfo    B2C   
				if(isB2BHybris){
					for(let hsi in omdl.b2bHybrisShopInfo){
						omdl[hsi] = omdl.b2bHybrisShopInfo[hsi];
					}
				} else {
					for(let gsi in omdl.globalShopInfo){
						omdl[gsi] = omdl.globalShopInfo[gsi];
					}
				}
			}
			let mdl = {
				origin : omdl,
				code : _stripSpecdl.modelName,
				displayName : _quotSafe(omdl.displayName),
				familyRecord : prod.familyRecord,
				pdpUrl : omdl.pdpUrl,
				thumbnailImages : _fetchModelThumbnailImages(omdl),
				ratings : _fetchModelRatings(omdl, family),
				energyLabel : _fetchModelEnergyLabel(omdl),
				repairabilityIndex : _fetchModelRepairabilityIndex(omdl),
				prices : _fetchModelPrices(omdl, prod),
				keySummary : _fetchModelKeySummary(omdl),
				taggingModelCode : omdl.modelCode.toLowerCase(),
				taggingModelName : _quotSafe(omdl.modelName.toLowerCase()),
				pviType : $.trim(omdl.pviTypeName).toLowerCase(),
				pviSubType : $.trim(omdl.pviSubtypeName).toLowerCase(),
				categorySubTypeCode : $.trim(prod.categorySubTypeCode).toLowerCase(),
				categorySubTypeEngName : $.trim(prod.categorySubTypeEngName).toLowerCase()
			};
			//epp compare feature url 
			if($('#isEppPage').val() === 'true'){
				const pdType = prod.simplePdYN === 'N' ? "pd" : "feature";
				if(mdl.pdpUrl.indexOf('/pd.') > -1){
					mdl.pdpUrl = mdl.pdpUrl.replace(/\/pd./ig,`/${pdType}.`);
				} else if(mdl.pdpUrl.indexOf('/feature.') > -1){
					mdl.pdpUrl = mdl.pdpUrl.replace(/\/feature./ig,`/${pdType}.`);
				}
			}
			
			if (omdl.fmyChipList) {
				let map = {};
				for (let j = 0; j < omdl.fmyChipList.length; j++) {
					let ochip = omdl.fmyChipList[j];
					let chip = _findOptionChip(family, ochip.fmyChipType, ochip.fmyChipCode);
					if (chip) {
						map[ochip.fmyChipType] = ochip.fmyChipCode;

						// connect joint chips
						let joinable = chip.joinableChips;
						for (let k = 0; k < omdl.fmyChipList.length; k++) {
							if (k !== j) {
								let jchip = omdl.fmyChipList[k];
								let jopts = family.chipOptions.optionMap[jchip.fmyChipType];
								if (jopts && jopts.chips.length > 0) {
									let codes = joinable[jchip.fmyChipType];
									if (!codes) {
										codes = joinable[jchip.fmyChipType] = [];
									}
									if (codes.indexOf(jchip.fmyChipCode) < 0) {
										codes.push(jchip.fmyChipCode);
									}
								}
							}
						}
					}
				}
				mdl.chipOptionMap = map;

				let codes = [];
				for (let j = 0; j < appliedChipTypes.length; j++) {
					ld = codes.join("-");
			}
			if (omdl.selected === "Y") {
				family.currentModel = mdl;
			lMap[mdl.code] = mdl;
		}
	}

	function _fetchModelThumbnailImages(omdl) {
		let imgs = [];
		imgs.push(_fetchThumbnailImage(omdl.thumbUrl, omdl.thumbUrlAlt));
		if (omdl.galleryImage && omdl.galleryImageAlt) {
			for (let i = 0; i < omdl.galleryImage.length; i++) {
				imgs.push(_fetchThumbnailImage(omdl.galleryImage[i], omdl.galleryImageAlt[i]));
			}
		}
		return imgs;
	}

	function _fetchThumbnailImage(imgSrc, imgAlt) {
		let previewSrc = sdfUtil.previewImageSrc(imgSrc, PRESET_THUMBNAIL_EXT);
		let desktopSrc = sdfUtil.presetImage(PRESET_THUMBNAIL_DESKTOP, imgSrc, PRESET_THUMBNAIL_EXT);
		let mobileSrc = sdfUtil.presetImage(PRESET_THUMBNAIL_MOBILE, imgSrc, PRESET_THUMBNAIL_EXT);
		return {
			desktopPreviewSrc : previewSrc,
			mobilePreviewSrc : previewSrc,
			desktopSrc : desktopSrc,
			mobileSrc : mobileSrc,
			altText : imgAlt
		};
	}

	function _fetchModelRatings(omdl, family) {

		function _reviewUrl(omdl) {
			let url = $.trim(omdl.reviewUrl);
			if (url === "") {
				if (component.meta("livePublished") === 'true') {
					url = component.meta("reviewPageUri") + omdl.modelCode + "/";
				} else {
					url = component.meta("reviewPageUri") + "/" + omdl.modelCode;
				}
			}
			return url;
		}

		let ratings = {};
		if(isB2B){
			// [B2B] Review 
			ratings.enabled = false;
		} else {
			if (family.isMobile && component.siteMeta.is(SITE_NO_MOBILE_REVIEWS)) {
				ratings.enabled = false;
				return ratings;
			}

			if (component.config.reviewEnabled || component.config.reevooEnabled) {
				let r = parseFloat(_trimToNull(omdl.ratings) || "0");
				let cnt = _trimToNull(omdl.reviewCount) || "0";

				ratings.enabled = true;
				ratings.reevooEnabled = component.config.reevooEnabled;
				ratings.reevooDisabled = !ratings.reevooEnabled;
				ratings.score = !isNaN(r) && r > 0 ? r.toFixed(1) : 0;
				ratings.reviewCount = cnt;
				ratings.reviewUrl = _reviewUrl(omdl); // ignore omdl.reviewUrl;
				ratings.noReviewLink = false;

				if (Math.floor(ratings.score) === 0) {
					ratings.emptyScoreClass = " rating--empty";
				}

				let score = Math.floor(ratings.score * 100);
				let scores = [];
				for (let i = 0; i < 5; i++) {
					var n = 0;
					if (score >= 100) {
						n = 100;
						score -= 100;
					} else if (score > 0) {
						n = score;
						score = 0;
					}
					scores.push({
						percentScore : (n).toString()
					});
				}
				ratings.starScores = scores;
			}
		}
		
		return ratings;
	}

	function _fetchModelEnergyLabel(omdl) {
		let rec = {};
		if (omdl.energyLabelGrade && omdl.energyFileUrl) {
			if (omdl.ficheFileUrl) {	//ficheFileUrl 
				rec.ficheFileUrl = omdl.ficheFileUrl;
				if(omdl.newEnergyLabel == "Y"){	//   
					rec.oldFicheEnabled = false;
					rec.newFicheEnabled = true;
					rec.newEnergyLabel = true;
					rec.oldEnabled = false;
					rec.newEnabled = true;
				}else{	//   
					rec.oldFicheEnabled = true;
					rec.newFicheEnabled = false;
					rec.newEnergyLabel = false;
					rec.oldEnabled = true;
					rec.newEnabled = false;
				}
			}else{	//ficheFileUrl 
				if(omdl.newEnergyLabel == "Y"){	//   
					rec.oldEnabled = false;
					rec.newEnabled = true;
				}else{	//   
					rec.oldEnabled = true;
					rec.newEnabled = false;
				}
			}
			rec.fileUrl = omdl.energyFileUrl;
			rec.grade = omdl.energyLabelGrade;
			rec.cssClass1 = omdl.energyLabelClass1;
			rec.cssClass2 = omdl.energyLabelClass2;
			if(omdl.energyLabelClass){
				rec.energyLabelClass = omdl.energyLabelClass;
			}else{
				rec.energyLabelClass = omdl.energyLabelClass1;
			}
		}
		return rec;
	}
	
	function _fetchModelRepairabilityIndex(omdl) {
		let siteCode = component.meta("siteCode");
		let rec = {};
		var indexNum;
		if(omdl.repairabilityIndex){
			rec.repairabilityIndex = omdl.repairabilityIndex;
			if(omdl.repairabilityIndex.length == 1){
				indexNum = omdl.repaplace('.','');
			}
			rec.hasRepairabilityImage = true;
			if(siteCode == "fr" || siteCode == "test"){
				if(omdl.repairabilityIndexPdfUrl == null || omdl.repairabilityIndexPdfUrl == ""){
					rec.href = "https://www.samsung.com/fr/indice-reparabilite/";
					rec.fileName = ""
				}else{
					rec.href = omdl.repairabilityIndexPdfUrl;	
					rec.fileName = ":"
				}
				// fileName
				if(rec.href.lastIndexOf("/") > -1){
					rec.fileName += rec.href.slice(rec.href.lastIndexOf("/")+1);
				}
			}
			rec.src = "/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/badge-repairability-" + indexNum + ".jpg";
			rec.alt = "Repairability Index : " + omdl.repairabilityIndex + " / 10";
		}
		return rec;
	}
	
	function _fetchModelPrices(omdl, prod) {

		function _setGpv2FromPrice(prices, fromPriceTag) {
			prices.priceDisplay = Granite.I18n.get(MSGKEY_FROM_VAR, [ fromPriceTag ]);
		}

		// lowestWasPrice 
		function _setLowestWasPrice(prices, omdl) {
			let savePrice = currencyComma(prices.savePrice, component.config.currencyCode);
			prices.saveLabelRequired = true;
			prices.savePrice = Granite.I18n.get(MSGKEY_SAVE_VAR, [ savePrice ]);
			prices.priceDisplay = '<del>' + omdl.lowestWasPriceDisplay + '</del>';
			if(component.siteMeta.siteCode === "it"){
				if(prices.monthlyPriceEnabled){
					prices.description = Granite.I18n.get("From {0}/mo", [prices.monthlyPrice]) + " " + Granite.I18n.get("for {0} mos", [prices.months]);
				}
				prices.monthlyPriceEnabled = false;
				prices.monthlyPriceDisabled = true;
				prices.promotionPriceEnabled = true;
				savePrice = parseFloat(omdl.lowestWasPrice) - parseFloat(omdl.promotionPrice);
				prices.savePrice = Granite.I18n.get("Save the {0}%", [ getDiscountRate(parseFloat(savePrice), parseFloat(omdl.lowestWasPrice)) ]);
			}
		}
		
		function _setGpv2SavePrice(prices, omdl) {
			let savePrice = currencyComma(omdl.saveText, component.config.currencyCode);
			prices.saveLabelRequired = true;
			prices.savePrice = Granite.I18n.get(MSGKEY_SAVE_VAR, [ savePrice ]);
//			if(component.siteMeta.siteCode === "de"){
//				prices.saveLabelRequired = false;
//				priceDisplayTag = "";
//				prices.priceDisplay = Granite.I18n.get("RRP {0}",priceDisplay); //"UVP " + priceDisplay;
//			}
			if(component.siteMeta.siteCode === "ro"){
				prices.promotionPriceEnabled = false;
				prices.saveLabelRequired = false;
				priceDisplayTag = "";
				prices.priceDisplay = Granite.I18n.get("RRP {0}",priceDisplay); //"PR " + priceDisplay;
			}
		}

		function _setLeasingPrice(prices, omdl, prod, isGpv2) {
			if (!component.siteMeta.is(SITE_NO_MONTHLY_PRICES) && !isB2B) {
				// VD     
				//
//				let subTypeCode = $.trim(prod.categorySubTypeCode);
//				if (subTypeCode.length < 2 || subTypeCode.substring(0, 2) !== "04") {
//					prices.monthlyPriceDisabled = true;
//					return;
//				}

				let monthlyPrice = null, tenureVal = null;
				if (component.siteMeta.siteCode === "nl") {
					if (omdl.leasingInfo) { // nl  leasingInfo  
						monthlyPrice = $.trim(omdl.leasingInfo.monthlyRate);
						monthlyPrice = prices.priceDisplay + ' ' + Granite.I18n.get("or") + ' '
								+ deleteCurrency(monthlyPrice, component.config.currencyCode);
						tenureVal = $.trim(omdl.leasingInfo.tenureVal);
					}
				} else {
					if (omdl.monthlyPriceInfo) { // nl     monthlyPriceInfo  
						monthlyPrice = $.trim(omdl.monthlyPriceInfo.leasingMonthly);
						if (monthlyPrice !== "") {
							if (component.siteMeta.is(SITE_SEBN)) {
								monthlyPrice = deleteCurrency(monthlyPrice, component.config.currencyCode);
							} else {
								monthlyPrice = currencyComma(monthlyPrice, component.config.currencyCode);
							}
							tenureVal = $.trim(omdl.monthlyPriceInfo.leasingMonths);
						}
					}
				}
				if (monthlyPrice && monthlyPrice.length > 0 && tenureVal && tenureVal.length > 0) {
					let mprice = monthlyPrice;
					prices.monthlyPriceEnabled = true;
					prices.monthlyPriceText = Granite.I18n.get("From {0}/mo", [ mprice ]) + ' '
							+ Granite.I18n.get("for {0} mos", [ tenureVal ]) + ' ' + Granite.I18n.get("or") + ' '
							+ prices.currentPriceDisplay;
					prices.monthlyPrice = mprice;
					prices.months = tenureVal;
					return;
				}
			}
			prices.monthlyPriceDisabled = true;
		}

		//       oldProductYN  "Y"   
		//
		let priceEnabled = component.config.priceEnabled && prod.oldProductYN !== "Y";
		if (!priceEnabled) {
			return null;
		}

		let ctaType = $.trim(omdl.ctaType).toUpperCase();
		let validStat = ctaType !== CTA_LEARN_MORE && ctaType !== CTA_NO_ORDER;
		let currency = component.config.currencyCode;

		let priceDisplay = $.trim(omdl.priceDisplay);
		let priceDisplayTag = "<del>" + priceDisplay + "</del>";
		
		var getDiscountRate = function(savePrice, originPrice){
			let tempDecimalPoint = Math.pow(10, 2);
			let discountRateTemp = Number(savePrice) / Number(originPrice) * tempDecimalPoint;
			discountRateTemp = Number(discountRateTemp).toFixed(2);
			return discountRateTemp.replace('.', ',');
		}
		
		// Global (not in Hybris 6.0 & GPv2)
		//
		if (component.shopType === SHOPTYPE_GLOBAL) {
			if (!validStat) {
				return null;
			}
			let prices = {
				enabled : priceDisplay.length > 0,
				currentPriceDisplay : priceDisplay,
				priceDisplay : priceDisplayTag
			};
			if (prices.enabled) {
				prices.price = omdl.price;
				prices.currentPrice = omdl.promotionPrice || omdl.price;
				_setLeasingPrice(prices, omdl, prod);
				let savePrice = $.trim(omdl.formattedPriceSave);
				if (savePrice !== '') {
					prices.savePriceEnabled = true;
					prices.saveLabelRequired = true;
					prices.savePrice = savePrice;
				}
			}
			// lowestWasPrice 
			let lowestWasPrice = parseFloat(omdl.lowestWasPrice);
			if (component.siteMeta.is(SITE_LOWEST_WAS_PRICE)){
				if(lowestWasPrice){
					if(lowestWasPrice <= prices.price && lowestWasPrice > omdl.promotionPrice){
						prices.savePrice = lowestWasPrice - parseFloat(omdl.promotionPrice);
						_setLowestWasPrice(prices, omdl);
					}else{
						prices.savePriceEnabled = false;
					}
				}else{
					prices.savePriceEnabled = false;
				}
			}
			return prices;
		}

		// Hybris 6.0 (integrated)
		//
		if (component.shopType === SHOPTYPE_HYBRIS) {
			let pp = _trimToNull(omdl.promotionPriceDisplay);
			let tp = _trimToNull(omdl.tradeInPriceText);
			let enabled = tp != null || priceDisplay.length > 0;
			if (enabled && validStat) {
				let prices = {
					enabled : enabled,
					price : omdl.price,
					currentPrice : enabled ? (omdl.promotionPrice || omdl.price) : null,
					currentPriceDisplay : tp || pp || priceDisplay,
					priceDisplay : priceDisplayTag,
					savePriceEnabled : pp != null && pp != $.trim(omdl.price),
					promotionPriceEnabled : true
				};
				_setLeasingPrice(prices, omdl, prod);
				// lowestWasPrice 
				let lowestWasPrice = parseFloat(omdl.lowestWasPrice);
				if (component.siteMeta.is(SITE_LOWEST_WAS_PRICE)){
					if(lowestWasPrice){
						if(lowestWasPrice <= prices.price && lowestWasPrice > omdl.promotionPrice){
							prices.savePrice = lowestWasPrice - parseFloat(omdl.promotionPrice);
							_setLowestWasPrice(prices, omdl);
						}else{
							prices.savePriceEnabled = false;
						}
					}else{
						prices.savePriceEnabled = false;
					}
				}
				return prices;
			}
			return null;
		}

		// GPv2
		//
		if (component.shopType === SHOPTYPE_GPV2 || component.shopType === SHOPTYPE_NEWHYBRIS || (isB2B && isB2BHybris)) {

			// SEPOL  ctaType OUTOFSTOCK   
			//
			if (component.siteMeta.is(SITE_SEPOL) && ctaType === CTA_OUT_OF_STOCK) {
				return null;
			}

			let isSEBN = component.siteMeta.is(SITE_SEBN);

			let prices = {
				enabled : priceDisplay.length > 0,
				currentPriceDisplay : isSEBN ? deleteCurrency(priceDisplay, currency) : priceDisplay,
				priceDisplay : isSEBN ? deleteCurrency(priceDisplayTag, currency) : priceDisplayTag
			};

			let taxExPrice = 0;
			let taxExPriceDisplay = '';
			let useTieredPrice = false;
			let useSMBPromotionPrice = false;
			if(isB2B && isLogedin && isSMBUser){
				/**
				 * [B2B]   
				 * SMB User - VAT OFF : taxExTieredPrice > smbPromotionPrice > taxExPrice
				 * SMB USer - VAT ON  : tieredPrice > smbPromotionPrice > promotionPrice 
				 * */ 
				if(isTieredPriceSite && _trimToNull(omdl.tieredPrice)){
					omdl.promotionPrice = omdl.tieredPrice;
					omdl.promotionPriceDisplay = omdl.tieredPriceDisplay;
					useTieredPrice = true;
				} else if (_trimToNull(omdl.smbPromotionPrice)){
					omdl.promotionPrice = omdl.smbPromotionPrice;
					omdl.promotionPriceDisplay = omdl.smbPromotionPriceDisplay;
					useSMBPromotionPrice = true;
				}

				if(useTaxExPrice){
					if(isTieredPriceSite && _trimToNull(omdl.taxExTieredPrice)){
						taxExPrice = omdl.taxExTieredPrice;
						taxExPriceDisplay = omdl.taxExTieredPriceDisplay;
					} else {
						taxExPrice = omdl.taxExPrice || omdl.promotionPrice;
						taxExPriceDisplay = omdl.taxExPriceDisplay || omdl.promotionPriceDisplay;
					}
				}
			}

			if (prices.enabled) {
				prices.price = omdl.price;
				prices.currentPrice = omdl.promotionPrice || omdl.price;
				if(isB2B && isLogedin && isSMBUser && useTaxExPrice){
					prices.currentPrice = taxExPrice;
				}
				_setLeasingPrice(prices, omdl, prod, true);
			}

			// ctaType NOORDER  LEARNMORE , SEBN    , SEBN     
			//
			if (ctaType === CTA_NO_ORDER || ctaType === CTA_LEARN_MORE) {
				return isSEBN ? prices : null;
			}

			let listPrice = parseFloat(omdl.listPrice);

			// lowestWasPrice 
			let lowestWasPrice = parseFloat(omdl.lowestWasPrice);
			
			//        
			//
			let p = parseFloat($.trim(omdl.price)), pp = parseFloat($.trim(omdl.promotionPrice));
			if (!p || !pp || isNaN(p) || isNaN(pp)) {
				return prices;
			}

			let cprice = _trimToNull(omdl.promotionPriceDisplay) || priceDisplay;
			if(isB2B && isLogedin && isSMBUser && useTaxExPrice){
				cprice = taxExPriceDisplay;
			}
			prices.currentPriceDisplay = isSEBN ? deleteCurrency(cprice, currency) : cprice;

			prices.savePrice = p - pp;
			if(component.siteMeta.is(SITE_LOWEST_WAS_PRICE)){ // lowestWasPrice 
				if(lowestWasPrice){
					if(lowestWasPrice <= p && lowestWasPrice > pp){
						prices.savePrice = lowestWasPrice - pp;
					} 
				}else{
					prices.priceDisplay = '';
					prices.savePrice = '';
				}
			}
			prices.savePriceEnabled = prices.savePrice > 0;
			prices.promotionPriceEnabled = true;

			//      
			//
			if (prices.savePriceEnabled) {
				
				if(isB2B && isLogedin && isSMBUser && (useTieredPrice || useSMBPromotionPrice)){
					omdl.saveText = prices.savePrice;
				}
				// SEBN
				if (isSEBN) {
					_setGpv2FromPrice(prices, deleteCurrency(priceDisplayTag, currency));
				}
				// SEG
				else if (component.siteMeta.is(SITE_SEG)) {
					_setGpv2FromPrice(prices, priceDisplayTag);
					_setGpv2SavePrice(prices, omdl);
				}
				// lowestWasPrice 
				else if (component.siteMeta.is(SITE_LOWEST_WAS_PRICE)){
					if(lowestWasPrice){
						if(lowestWasPrice <= prices.price && lowestWasPrice > omdl.promotionPrice){
							_setLowestWasPrice(prices, omdl);
						}else{
							prices.savePriceEnabled = false;
						}
					}else{
						prices.savePriceEnabled = false;
					}
				}
				// others
				else {
					_setGpv2SavePrice(prices, omdl);
				}
			}
			//   listPrice  SEBN  
			else if (listPrice > p && isSEBN) {
				prices.savePriceEnabled = true;
				prices.price = omdl.listPrice;
				prices.currentPrice = omdl.price;
				prices.priceDisplay = Granite.I18n.get("Listprice") + " " + deleteCurrency(omdl.listPriceDisplay, currency);
			}
			
			if(component.siteMeta.siteCode === "co"){
				if( omdl.vatEligible == "true" ){
					prices.vatEligible = true;
					prices.monthlyPriceDisabled = false; // current price 
					prices.savePriceEnabled = false; // save price 
					if(omdl.vatFreePrice){
						prices.vatFreePrice = omdl.vatFreePrice;
					}
					if(omdl.vatFreePriceDisplay){
						prices.vatFreePriceFormatted = omdl.vatFreePriceDisplay;
					}
				}
			}
			
			//COMP6FE-1599 [EPP] SEPOL MSRP Price 
			if ( $('#isEppPage').val() === 'true' && component.siteMeta.siteCode === "pl" ) {
				prices.savePriceEnabled = false;
			}
			
			return prices;
		}
	}

	function _fetchModelKeySummary(omdl) {
		let recs = [];
		if (omdl.keySummary && omdl.keySummary.length > 0) {
			for (let i = 0; i < omdl.keySummary.length; i++) {
				let item = omdl.keySummary[i];
				if (item.displayType === KEY_SUMMARY_TYPE_SPEC) {
					recs.push({
						isSpec : true,
						title : item.key,
						value : item.value,
						unit : item.unit
					});
				} else if (item.displayType === KEY_SUMMARY_TYPE_FEATURE) {
					let img = sdfUtil.presetImage(PRESET_KEY_SUMMARY, item.imgUrl);
					recs.push({
						isFeature : true,
						title : item.title,
						desktopPreviewImageSrc : img,
						mobilePreviewImageSrc : img,
						desktopImageSrc : img,
						mobileImageSrc : img,
						altText : item.imgAlt
					});
				}
			}
		}
		return {
			enabled : recs.length > 0,
			entries : recs
		};
	}

	function _initFamilyCardPanel(family) {
		var firstCheckedChip = null;
		family.$panel = component.$ui.contentPanel.find(SEL_FAMILY_CARD_PREFIX + family.code);
		family.$panel.find(SEL_OPTION_CHIPS).each(function(i, rdo) {
			rdo.boundChip = _findOptionChip(family, rdo.getAttribute(ATTR_CHIP_TYPE), rdo.value);
			if (rdo.hasAttribute("checked")) {
				if (!firstCheckedChip) {
					firstCheckedChip = rdo;
				}
				$(rdo).closest(SEL_CHIP_SWIPER_SLIDE).addClass(CLS_IS_SELECTED);
			}
		});
		if (firstCheckedChip) {
			_checkOptionChipAvailability(family, firstCheckedChip);
		}
	}

	function _renderModel(family, model) {
		let $p = family.$panel;
		if (!$p) {
			$p = family.$panel = component.$ui.contentPanel.find(SEL_FAMILY_CARD_PREFIX + family.code);
		}

		let bindObj = {
			model : model
		};
		component.invokeTemplate(TMPL_THUMBNAIL_PANEL, bindObj, $p.find(SEL_THUMBNAIL_PANEL).empty().get(0));
		component.invokeTemplate(TMPL_MODEL_INFO, bindObj, $p.find(SEL_MODEL_INFO_PANEL).empty().get(0));

		$p.find(SEL_MODEL_NAME).html(model.displayName);
		$p.find(SEL_MODEL_CODE).html(model.modelCode);

		window.sg.common.icon.update($p.get(0));
	}

	function _findOptionChip(family, type, code) {
		let opts = family.chipOptions.optionMap[type];
		if (opts) {
			for (let i = 0; i < opts.chips.length; i++) {
				if (opts.chips[i].code === code) {
					return opts.chips[i];
				}
			}
		}
		return null;
	}

	function _resetTaggingAttributes(family) {
		family.$panel.find(SEL_OPTION_CHIPS).each(function(i, rdo) {
			let curChip = rdo.boundChip;
			if (curChip.disabled) {
				rdo.removeAttribute(ATTR_MODEL_CODE);
				rdo.removeAttribute(ATTR_MODEL_NAME);
				rdo.removeAttribute(ATTR_MODEL_DISPLAY);
				rdo.removeAttribute(ATTR_MODEL_PRICE);
				rdo.removeAttribute(ATTR_DISCOUNT_PRICE);
				rdo.removeAttribute(ATTR_PVI_TYPE);
				rdo.removeAttribute(ATTR_PVI_SUBTYPE);
				rdo.removeAttribute(ATTR_PIM_SUBTYPE);
				return;
			}
			let codes = [], optMap = family.chipOptions.optionMap;
			for ( let chipType in optMap) {
				if (chipType === curChip.type) {
					codes.push(rdo.value);
				} else {
					let selCode = optMap[chipType].selectedChipCode;
					let joinables = curChip.joinableChips[chipType];
					if (joinables) {
						if (joinables.indexOf(selCode) >= 0) {
							codes.push(selCode);
						} else if (joinables.length > 0) {
							codes.push(joinables[0]);
						}
					}
				}
			}
			let mdlChipId = codes.join("-");
			let mdl = family.chipOptions.modelMap[mdlChipId];
			if (mdl) {
				rdo.setAttribute(ATTR_MODEL_CODE, mdl.taggingModelCode);
				rdo.setAttribute(ATTR_MODEL_NAME, mdl.taggingModelName);
				rdo.setAttribute(ATTR_MODEL_DISPLAY, mdl.displayName);
				if (mdl.prices && mdl.prices.enabled && mdl.prices.price && mdl.prices.currentPrice) {
					rdo.setAttribute(ATTR_MODEL_PRICE, mdl.prices.price);
					rdo.setAttribute(ATTR_DISCOUNT_PRICE, mdl.prices.currentPrice);
				}
				rdo.setAttribute(ATTR_PVI_TYPE, mdl.pviType || "");
				rdo.setAttribute(ATTR_PVI_SUBTYPE, mdl.pviSubType || "");
				rdo.setAttribute(ATTR_PIM_SUBTYPE, mdl.categorySubTypeEngName);
			}
		});
	}

	function _stripSpecialChars(s) {
		return s ? s.replace(/[^0-9A-Za-z]/g, "") : s;
	}

	function _trimToNull(str) {
		let s = $.trim(str);
		return s.length > 0 ? s : null;
	}

	function _quotSafe(s) {
		return s.replace(/"/g, "&quot;");
	}

	// ======================================================================

	function _init() {
		let domain = $.trim($("input#searchDomain").val());
		let stage = $.trim($("input#apiStageInfo").val());

		_apiEndPoint = domain + "/" + stage + (isB2B ? APIPATH_PRODUCT_CARD_DETAIL_FOR_B2B : APIPATH_PRODUCT_CARD_DETAIL);
		
		// epp compare search  
		const isEPP = $('#isEppPage').val() === 'true';
		if(isEPP){
			_apiEndPoint = domain + "/" + stage + "/epp/v2/product/card/detail";
		}
	
		if(isB2BHybris){
			isLogedin = commonLoginCheck();
			if(isLogedin && isB2BHybris){
				const isSMBRegisteredUserYN = $.cookies.get("isSMBRegisteredUserYN", {domain : ".samsung.com"});
				if(isSMBRegisteredUserYN == "Y"){
					isSMBUser = true;
				}
			}
		}

		if ($(COMPONENT_SELECTOR).length > 0) {
			_initOnReady();
		}
	}

	function _initConfig() {
		component.config = {
			modelCode : component.meta("modelCode"),
			reviewEnabled : $("#reviewUseYN").val() === 'Y',
			reevooEnabled : $('#reevooUseYN').val() === 'Y',
			priceEnabled : component.siteMeta.priceDisplayEnabled,
			currencyCode : $("#priceCurrency").val()
		};
		let siteCode = component.meta("siteCode");
		let msCode = siteCode;
		if (component.siteMeta.is(SITE_MULTISTORE_ENABLED)) {
			let code = $.trim(window.cookies.getCookie(COOKIE_DCOM_MULTISTORE));
			if (code !== "") {
				//NOTICE : code     ae, ae_ar, kw, kw_ar, om, om_ar, bh, bh_ar,qa,qa_ar    
				if(code === "ae" || code === "ae_ar" || code === "kw" || code === "kw_ar" || code === "om" || code === "om_ar" || code === "bh" || code === "bh_ar" || code === "qa" || code === "qa_ar") {
					msCode = code;
				}
			}
		} else {
			let code = SITE_MULTISTORE_MAPPED[siteCode];
			if (code) {
				msCode = code;
			}
		}
		component.config.dcomMultiStoreSite = msCode;
	}

	function _initOnReady() {
		component = sdfComp.dispatch(COMPONENT_SELECTOR);
		if (DEBUG) {
			window.pdd04ProductCompare = component;
		}
		if (!component) {
			return;
		}

		component.$ui.wrapperPanel = component.$ui.find(SEL_WRAPPER_PANEL).hide();

		let siteMeta = $.parseJSON(component.meta("siteMeta"));
		component.siteMeta = siteMeta;
		component.siteMeta.is = function(codes) {
			return codes && codes.length > 0 && codes.indexOf(component.siteMeta.siteCode) >= 0;
		};

		_initConfig();

		if(isB2B){
			if(isB2BHybris){
				component.shopType = SHOPTYPE_B2BHYBRIS;
			}
		} else {
			if (siteMeta.isGpv2site) {
				component.shopType = SHOPTYPE_GPV2;
			} else if (siteMeta.isHybrisNewSite) {
				component.shopType = SHOPTYPE_NEWHYBRIS;
			} else if (siteMeta.isHybrisIntegrationSite) {
				component.shopType = SHOPTYPE_HYBRIS;
			} else {
				component.shopType = SHOPTYPE_GLOBAL;
			}
			_apiEndPoint += "/" + component.shopType;
		}

		let mdlCode = component.meta("modelCode");
		let cmList = component.meta("compareModelList");
		let mdlList = mdlCode;
		if (cmList !== "") {
			mdlList += "," + cmList;
		}

		let params = {
			siteCode : component.meta("siteCode"),
			modelList : mdlList,
			commonCodeYN : "N",
			saleSkuYN : "N",
			onlyRequestSkuYN : "N",
			keySummaryYN : "Y"
		};
		if(isB2B && isB2BHybris){
			params.shopType = component.shopType;
		}
		if (component.config.dcomMultiStoreSite) {
			params.shopSiteCode = component.config.dcomMultiStoreSite;
		}
		
		// epp compare search  
		const isEPP = $('#isEppPage').val() === 'true';
		if(isEPP){
			params.companyCode  = $('#eppCompanyCode').val();
			params.shopSkuYN  = "N";
			
			const eppIsUserGroupPricing = window.sg.epp.common.isUserGroupPricing;
			if(eppIsUserGroupPricing){
				params['groupName'] = window.sg.epp.common.groupName;
			}
			
			//[EPP] in refurbished   selector 
			let offerId = location.pathname.match(/[0-9]{13}/g);
			if ( offerId != null && typeof offerId != 'undefined' && $.trim(offerId) != '' ){
				params['offerId'] = offerId[0];
			}
		}
		_loadCompareData(params, function(data) {
			PDPC.dynamicInstance = component;

			_initComponentPanel(data.resultData);
		});
	}

	function _loadCompareData(paramData, callback) {
		$.ajax({
			url : _apiEndPoint,
			data : paramData,
			type : "GET",
			dataType : "json",
			success : function(data) {
				if (data && data.response) {
					data = data.response;
				}
				if (!data || !data.statusCode || data.statusCode !== 200 || !data.resultData) {
					console.error("[PDD04] Search API failure");
					console.dir(data);
					return;
				}
				if (callback) {
					callback.call(null, data);
				}
			},
			error : function() {
				console.error("[PDD04] Can't retrieve compare data from '" + _apiEndPoint + "'");
			}
		});
	}

	PDPC.initDynamic = _init;

	$(function() {
		_init();
	});

})(jQuery, window.sg.components.pdProductCompare, window.sg.sdf.util, window.sg.sdf.comp);

(() => {
  const $q = window.sg.common.$q;
  const utils = window.sg.common.utils;
  const lazyLoad = window.sg.common.lazyLoad;

  const selector = {
    section: '.product-award',
  };

  class ProductAward {
    constructor(sectionEl) {
      this.selector = {
        awardWrap: '.award__wrap',
        awardList: '.award__list',
        awardListInner: '.award__list-inner',
        active: 'is-list--visible',
        inner: '.award__list > li',
        moreBtn: '.award__btn',
      };

      this.MOBILE_MORE = 2;
      this.DESKTOP_MORE = 3;
      this.firstCheck = false;

      this.el = {
        window: $q(window),
        component: $q(sectionEl),
        moreBtn: null,
      };

      this.handler = {
        resize: () => {
          if (!this.firstCheck) {
            this.el.inner.target.forEach((innerEl, idx) => {
              if (this.handler.getCount() > idx) {
                innerEl.classList.add(this.selector.active);
              } else {
                innerEl.classList.remove(this.selector.active);
              }
              lazyLoad.setLazyLoad();
            });

            if (this.handler.getCount() >= this.el.inner.target.length) {
              this.el.moreBtn.hide();
            } else {
              this.el.moreBtn.show();
            }
          } else {
            this.el.window.off('resize', this.handler.resize);
          }
        },

        setHeight: () => {
          const listArr = this.el.component.find('.is-list--visible .award__list-inner');
          listArr.css({
            height: '',
          });

          if (utils.getCurrentDevice() === 'desktop') {
            let h = 0;
            let tempList = [];

            listArr.target.forEach((el, idx) => {
              if (h < el.clientHeight) {
                h = el.clientHeight;
              }
              tempList.push(el);

              if (idx % this.DESKTOP_MORE === this.DESKTOP_MORE - 1 || idx === listArr.target.length - 1) {
                tempList.forEach((tEl) => {
                  tEl.style.height = `${h}px`;
                });

                h = 0;
                tempList = [];
              }
            });
          }

          this.el.awardWrap.css({
            'height': '',
          });

          this.el.awardWrap.css({
            'height': `${this.el.awardList.outerHeight()}px`,
          });
        },
        
        getCount: () => {
          let total = 0;

          if (utils.getCurrentDevice() === 'desktop') {
            total = this.DESKTOP_MORE;
          } else {
            total = this.MOBILE_MORE;
          }

          return total;
        },

        more: () => {
          this.el.awardWrap.css({
            'height': '',
          });
    
          const total = this.handler.getCount();
          const temp = this.el.component.find(`${this.selector.inner}:not(.${this.selector.active})`);
          for (let i = 0; i < total; i++) {
            const target = temp.eq(i);
            target.addClass(this.selector.active);
          }
          if (total >= temp.target.length) {
            this.el.moreBtn.hide();
          }
    
          lazyLoad.setLazyLoad();
    
          this.handler.setHeight();
          
          this.firstCheck = true;
          this.el.window.off('resize', this.handler.resize);
        },
      };

      ProductAward.instances.set(sectionEl, this);

      this.init();
    }

    init() {
      this.setElements();

      this.bindEvents();
    }

    setElements() {
      this.el.awardWrap = this.el.component.find(this.selector.awardWrap);
      this.el.awardList = this.el.component.find(this.selector.awardList);
      this.el.inner = this.el.component.find(this.selector.inner);
      this.el.moreBtn = this.el.component.find(this.selector.moreBtn);
    }

    bindEvents() {
      this.el.window.on('resize', this.handler.resize);
      this.el.window.on('resize', this.handler.setHeight);
      this.el.moreBtn.on('click', this.handler.more);

      this.handler.resize();
      this.handler.setHeight();
    }

    unBindEvents() {
      this.el.window.off('resize', this.handler.resize);
      this.el.window.off('resize', this.handler.setHeight);
      this.el.moreBtn.off('click', this.handler.more);
    }

    reInit() {
      this.firstCheck = false;

      this.unBindEvents();

      this.init();
    }

    // more() { 
    // }
  }

  function init() {
    $q(selector.section).target.forEach((el) => {
      new ProductAward(el);
    });
  }

  ProductAward.instances = new WeakMap();

  function reInit() {
    $q(selector.section).target
        ProductAward.instances.get(element).reInit();
      } else {
        new ProductAward(element);
      }
    });
  }

  // function more(componentEl) {
  //   if (ProductAward.instances.has(componentEl)) {
  //     ProductAward.instances.get(componentEl).more();
  //   }
  // }

  window.sg.components.productAward = {
    init,
    reInit,
    // more,
  };

  $q.ready(init);
})();

(() => {
  const $q = window.sg.common.$q;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;
  const swiperManager = window.sg.common.swiperManager;
  const selector = { pdHeaderNavigation: '.pd-header-navigation' };

  class PDheaderNavigation {
    constructor(component) {
      this.selector = {
        sectionWrap: '.pd-header-navigation-keep',
        section: selector.pdHeaderNavigation,
        naviWrap: '.pd-header-navigation__menu',
        naviMenu: '.pd-header-navigation__menu-item ',
        naviMenuBar: '.pd-header-navigation__menu-bar',
        naviActive: '.active',
        menuBtn: '.pd-header-navigation__headline',
        menuWrap: '.pd-header-navigation__header',
        menuMotion: '.pd-header-navigation__menu-wrap',
        scrollFix: 'pd-header-navigation--fixed',
        price: '.pd-buying-price__wrap',
        tooltipWrap: '.pd-buying-price__new-price',
        tooltipBtn: '.tooltip-btn',
        tooltipLayer: '.tooltip-box',
        usEppDiscount: '.us-epp-discount',
        usEppDisKeep: '.us-epp-discount-keep',
        mobilePrevArrow: '.pd-header-navigation__btn-prev',
        mobileNextArrow: '.pd-header-navigation__btn-next',
        comboPackage: '.pd-header-navigation__combo-package',
        comboSlide: '.pd-header-navigation__combo-package-container',
        installmentTooltipOpenBtn: '.pd-buying-price__tooltip-btn',
        installmentTooltipCloseBtn: '.pd-buying-price__tooltip-close-btn',
      };

      this.ele = {
        window: $q(window),
        sectionWrap: null,
        section: $q(component),
        naviWrap: null,
        naviMenu: null,
        naviMenuBar: null,
        naviActive: null,
        menuBtn: null,
        menuWrap: null,
        menuMotion: null,
        tooltipBtn: null,
        tooltipLayer: null,
        usEppDiscount: null,
        usEppDisKeep: null,
        mobilePrevArrow: null,
        mobileNextArrow: null,
      };

      this.isRtl = utils.isRtl();
      this.statePC = BREAKPOINTS.MOBILE < utils.getViewPort().width;
      this.isUsEppDiscount = null;
      this.focusTooltipWrap = null;
      this.resizeTimer = null;
      this.scrollTimer = 0;
      this.isOpera = navigator.userAgent.toLocaleLowerCase().match(/( opera\/| opr\/)/);
      if (this.isOpera !== null && this.isOpera.index > 0) {
        this.isOpera = true;
      } else {
        this.isOpera = false;
      }

      this.scrollRect = {
        mobileFixTargetEl: null, // when mobile, fix start title/2
        bannerEle: null, //banner Element
        fixMode: null, //now fixed state
        start: null, //navi fix start scrollTop
        height: null, //navi Height
        scrollActiveTarget: null, //when pc scroll, use to active menu
        offTop: null, //when fix, .pd-header-navigation top
      };

      this.menuScrollLeft = 0;
      this.menuScrollMax = null;
      this.menuWrapWidth = null;
      this.mobileMenuOpen = false;

      this.setProperty();
      this.setScrollActiveTarget();

      this.handler = {
        // outClick: this.checkOutClick.bind(this),
        resize: () => {
          this.resize();
          this.scroll(true);
        },
        scroll: () => {
          this.scroll();
          requestAnimationFrame(() => {
            this.moveMenuBar(this.ele.naviActive);
          });
        },
        checkOutClickTooltip: this.checkOutClickTooltip.bind(this),
        // closeMobileMenuCallback: () => {
        //   this.ele.menuWrap.removeClass('pd-header-navigation__menu--open');
        //   this.resetMobileMenuMotion();
        //   this.fixMobileMenu();
        // },
        fixNaviFinish: () => {
          if (this.scrollRect.fixMode === 'mobileOff') {
            this.ele.section.removeClass(this.selector.scrollFix);
          }
        },
        installmentTooltipOpen: this.installmentTooltipOpen.bind(this),
        installmentTooltipClose: this.installmentTooltipClose.bind(this),
      };

      PDheaderNavigation.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.sectionWrap = this.ele.section.closest(this.selector.sectionWrap);
      this.ele.naviWrap = this.ele.section.find(this.selector.naviWrap);
      this.ele.naviMenu = this.ele.section.find(this.selector.naviMenu);
      this.ele.naviMenuBar = this.ele.section.find(this.selector.naviMenuBar);
      this.ele.naviActive = this.ele.section.find(this.selector.naviActive);
      this.ele.menuBtn = this.ele.section.find(this.selector.menuBtn);
      this.ele.menuWrap = this.ele.section.find(this.selector.menuWrap);
      this.ele.menuMotion = this.ele.section.find(this.selector.menuMotion);
      this.ele.price = this.ele.section.find(this.selector.price);
      this.ele.tooltipBtn = this.ele.section.find(`${this.selector.tooltipWrap} ${this.selector.tooltipBtn}`);
      this.ele.tooltipLayer = this.ele.section.find(`${this.selector.tooltipWrap} ${this.selector.tooltipLayer}`);
      this.ele.usEppBar = $q('.gnb .epp-bar-wrap');
      this.ele.usEppDiscount = $q(this.selector.usEppDiscount);
      this.ele.usEppDisKeep = $q(this.selector.usEppDisKeep);
      this.ele.mobilePrevArrow = $q(this.selector.mobilePrevArrow);
      this.ele.mobileNextArrow = $q(this.selector.mobileNextArrow);
      this.ele.tooltipWrap = this.ele.section.find(this.selector.tooltipWrap);
      this.ele.comboPackage = this.ele.section.find(this.selector.comboPackage);
      this.ele.comboSlide  = this.ele.section.find(this.selector.comboSlide );
      this.ele.installmentTooltipOpenBtn = this.ele.section.find(this.selector.installmentTooltipOpenBtn);
      this.ele.installmentTooltipCloseBtn = this.ele.section.find(this.selector.installmentTooltipCloseBtn);
      // this.ele.priceBadge = this.ele.section.find('.pd-buying-price__badge.desktop');

      this.isUsEppDiscount = this.ele.usEppDiscount.target.length !== 0;

      this.scrollRect.mobileFixTargetEl = $q('.pd-info__title').target[0];

      this.scrollRect.bannerEle = $q('.pd-banner');
      this.scrollRect.fixMode = '';

      if (this.ele.section.find('.pd-buying-price').target.length === 0 || this.ele.section.find('.pd-buying-price__wrap').target[0].innerText.trim() === '') {
        this.ele.section.addClass('non-shop');
      } else {
        this.ele.section.removeClass('non-shop');
      }

      if (this.ele.section.target[0].querySelector('.pd-buying-price__advice-price') !== null || this.ele.section.target[0].querySelector('.pd-buying-price__monthly-price') !== null) {
        this.ele.section.find('.pd-buying-price__badge.mobile').css({
          minHeight: 'auto',
        });
      } else {
        this.ele.section.find('.pd-buying-price__badge.mobile').css({
          minHeight: '',
        });
      }

      this.isRtl = utils.isRtl();
      this.scrollRect.scrollActiveTarget = [];
      this.ele.naviMenu.target.forEach((el) => {
        const targetId = $q(el).find('a').attr('href');
        if (this.isIdSelector(targetId)) {
          this.scrollRect.scrollActiveTarget.push({
            el,
          });
        }
      });

      this.mobileMenuOpen = this.ele.sectionWrap.hasClass('header-keep');
      this.isLandscape = utils.getViewPort().width > utils.getViewPort().height;
    }

    init() {
      this.bindEvents();

      this.ele.naviMenuBar.css({
        transition: 'none',
      });

      setTimeout(() => {
        this.moveMenuBar(this.ele.naviActive);
        this.ele.naviMenuBar.css({
          transition: '',
        });
      }, 30);

      this.scrollRect.fixMode = 'mobileOff';
    }

    loadInit() {
      this.ele.window.off('resize', this.handler.resize).on('resize', this.handler.resize);
      this.ele.window.off('scroll', this.handler.scroll).on('scroll', this.handler.scroll);

      this.resize();
      this.scroll();
    }

    reInit() {
      this.mobileMenuOpen = false;

      this.setProperty();
      this.setScrollActiveTarget();
      this.bindEvents();

      this.ele.naviMenuBar.css({
        transition: 'none',
      });

      setTimeout(() => {
        this.moveMenuBar(this.ele.naviActive);
        this.ele.naviMenuBar.css({
          transition: '',
        });
      }, 30);

      this.loadInit();

      this.ele.comboSlide.target.forEach((swiperEl) => {
        swiperManager.slideReInit(swiperEl);
        window.sg.common.icon.update(swiperEl);
      });
    }

    setScrollMax() {
      this.menuWrapWidth = this.ele.section.offset().width;
      if (this.menuWrapWidth < this.ele.naviWrap.target[0].scrollWidth) {
        this.menuScrollMax = this.menuWrapWidth - this.ele.naviWrap.target[0].scrollWidth; //scroll max
        this.menuScrollMax -= (this.isRtl ? parseFloat(this.ele.naviWrap.css('padding-left')) : parseFloat(this.ele.naviWrap.css('padding-right')));
      } else {
        this.menuScrollMax = 0;
      }
    }

    setPriceHeight() {
      this.ele.sectionWrap.removeClass('pd-header-navigation--extended');
      this.ele.sectionWrap.removeClass('pd-header-navigation--advice');
      this.ele.menuBtn.css({
        height: '',
      });
      // this.ele.priceBadge.css({
      //   'height': '',
      // });

      if (this.ele.price.target.length > 0) {
        this.ele.price.target[0].style.height = '';
        if (this.statePC !== true) {
          const $goToStoreBtn = this.ele.section.find('.pd-buying-price__cta');
          if ($goToStoreBtn.target.length === 0 || $goToStoreBtn.offset().height + 1 < this.ele.price.target[0].scrollHeight){
            this.ele.price.css({
              height: 'auto',
            });
            this.ele.menuBtn.css({
              height: '',
            });
          }
        } else {
          // if (this.ele.tooltipWrap.target.length > 0) {
          //   const badgeH = this.ele.tooltipWrap.offset().height;
          //   if (badgeH) {
          //     this.ele.priceBadge.css({
          //       'height': `${badgeH}px`,
          //     });
          //   }
          // }

          if (this.ele.sepd-header-navigation--advice');
          }

          const comboPackageHeight = this.ele.comboPackage.target.length ? this.ele.comboPackage.offset().height : 0;
          if ((this.ele.price.offset().height > this.ele.section.offset().height().height)) {
            this.ele.sectionWrap.addClass('pd-header-navigation--extended');
            const priceHeight = this.ele.price.offset().height;
            this.ele.menuBtn.css({
              height: `${Math.max(priceHeight, comboPackageHeight)}px`,
            });
          }
        }
      }
    }

    resize() {
      this.isLandscape = utils.getViewPort().width > utils.getViewPort().height;

      const nowPc = BREAKPOINTS.MOBILE < utils.getViewPort().width;
      if (this.mobileMenuOpen) {
        this.ele.sectionWrap.find('.pd-header-navigation__dummy-headline').css({
          'height': `${this.ele.section.height()}px`,
        });
      } else {
        if (this.ele.sectionWrap.hasClass('pd-header-navigation--extended') && nowPc) {
          this.ele.sectionWrap.find('.pd-header-navigation__dummy-headline').css({
            'height': `${this.ele.section.height()}px`,
          });
        } else {
          this.ele.sectionWrap.find('.pd-header-navigation__dummy-headline').css({
            'height': '',
          });
        }
      }

      this.setScrollMax();

      this.ele.naviMenuBar.css({
        transition: 'none',
      });

      this.setPriceHeight();

      if (nowPc !== this.statePC) {
        this.hideTooltip();
      }

      clearTimeout(this.resizeTimer);
      this.resizeTimer = setTimeout(() => {
        this.ele.naviMenuBar.css({
          transition: '',
        });

        this.setPriceHeight();
        if (this.mobileMenuOpen) {
          this.ele.sectionWrap.find('.pd-header-navigation__dummy-headline').css({
            'height': `${this.ele.section.height()}px`,
          });
        } else {
          if (this.ele.sectionWrap.hasClass('pd-header-navigation--extended') && nowPc) {
            this.ele.sectionWrap.find('.pd-header-navigation__dummy-headline').css({
              'height': `${this.ele.section.height()}px`,
            });
          } else {
            this.ele.sectionWrap.find('.pd-header-navigation__dummy-headline').css({
              'height': '',
            });
          }
        }

        this.setScrollMax();
        if (this.statePC) {
          this.ele.mobilePrevArrow.target[0].style.display = '';
          this.ele.mobileNextArrow.target[0].style.display = '';
        } else {
          if (this.menuScrollMax === 0) {
            this.ele.mobilePrevArrow.hide();
            this.ele.mobileNextArrow.hide();
          } else if (this.menuScrollLeft === 0){
            this.ele.mobilePrevArrow.hide();
          }
        }
        if (nowPc !== this.statePC) {
          this.clearFixStyle();

          this.resetFixData(this.statePC);

          if (this.statePC) {
            this.fixNaviPC();
          } else {
            this.fixNaviMobile(false);
          }
        }
      }, 400);

      this.statePC = nowPc;

      this.clearFixStyle();
      this.resetFixData(nowPc);

      //navi view reset
      this.moveMenuBar(this.ele.naviActive);

      this.setScrollActiveTarget();
      if (this.statePC) {
        this.ele.mobilePrevArrow.target[0].style.display = '';
        this.ele.mobileNextArrow.target[0].style.display = '';
      } else {
        if (this.menuScrollMax === 0) {
          this.ele.mobilePrevArrow.hide();
          this.ele.mobileNextArrow.hide();
        } else if (this.menuScrollLeft === 0){
          this.ele.mobilePrevArrow.hide();
        }
      }
      this.scrollMenuToPx(0);
    }

    // "pd-header-navigation
    scroll(callResize = false) {
      if (this.ele.section.height() === 0) {
        return;
      }

      this.setScrollActiveTarget();
      this.activeScrollMenu();

      const nowTime = (new Date()).getTime();
      if (nowTime > this.scrollTimer) {
        this.scrollTimer = nowTime + 500;
        this.isUsEppDiscount = this.ele.usEppDiscount.target.length !== 0;

        this.resetFixData(this.statePC);
        this.scrollRect.fixMode = '';
      }

      if (this.statePC) {
        this.fixNaviPC();
        // if (this.ele.menuWrap.hasClass('pd-header-navigation__menu--open')) {
        //   this.closeMobileMenu(false);
        // }
      } else {
        // if (!this.ele.menuWrap.hasClass('pd-header-navigation__menu--close')) {
        //   this.closeMobileMenu();
        // }

        if (this.ele.usEppDiscount.find('.us-epp-discount__select').hasClass('us-epp-discout__select--open')) {
          if (window.sg.components.usEppDiscount !== undefined) {
            window.sg.components.usEppDiscount.closeLayer();
          }
        }
        if (callResize) {
          this.fixNaviMobile(false);
        } else {
          this.fixNaviMobile();
        }
      }
    }

    isIdSelector(url) {
      if (typeof url !== 'string') {
        return false;
      }
      url = url.trim();
      if (url !== '#' && url.indexOf('#') === 0) {
        const target = document.querySelector(url);
        if (target !== null && target !== undefined) {
          return true;
        }
      }
      return false;
    }

    setScrollActiveTarget() {
      const top = document.body.scrollTop || document.documentElement.scrollTop;

      this.scrollRect.scrollActiveTarget.forEach((obj) => {
        const targetId = obj.el.querySelector('a').getAttribute('href');
        if (this.isIdSelector(targetId)) {
          const targetRect = $q(targetId).offset();
          obj.top = (targetRect.top !== 0 && targetRect.bottom !== 0) ? targetRect.top + top : null;
        } else {
          obj.top = null;
        }
      });

      this.scrollRect.scrollActiveTarget.sort((a, b) => a.top - b.top);
    }

    activeScrollMenu() {
      if (this.scrollRect.scrollActiveTarget.length <= 0) {
        return;
      }

      const top = (this.statePC ? 0 : 20) + this.scrollRect.height + this.scrollRect.offTop + (document.body.scrollTop || document.documentElement.scrollTop);

      let targetIdx = 1;
      for (targetIdx = 1; targetIdx < this.scrollRect.scrollActiveTarget.length; targetIdx++) {
        if (top < this.scrollRect.scrollActiveTarget[targetIdx].top && this.scrollRect.scrollActiveTarget[targetIdx].top !== null) {
          break;
        }
      }

      targetIdx = targetIdx - 1;

      if (this.scrollRect.scrollActiveTarget[targetIdx].top !== null && top >= this.scrollRect.scrollActiveTarget[targetIdx].top) {
        const $targetMenu = $q(this.scrollRect.scrollActiveTarget[targetIdx].el);

        if (this.ele.naviMenuBar.target[0].style.display === 'none') {
          this.ele.naviMenuBar.target[0].style.display = '';
        }

        if (!$targetMenu.hasClass('active')) {
          this.setActiveMenu($targetMenu.target[0]);
          this.scrollMenuToBtn($targetMenu);
        }
      } else {
        this.setActiveMenu(null);
      }
    }

    clearFixStyle() {
      this.scrollRect.fixMode = '';

      const css = {
        top: '',
      };

      if (this.statePC) {
        css.transform = '';
        css.transition = '';
      }

      this.ele.section.css(css);
    }

    resetFixData(nowPc) {
      const top = document.body.scrollTop || document.documentElement.scrollTop;

      if (nowPc) {
        this.scrollRect.start = top + this.ele.section.target[0].parentNode.getBoundingClientRect().top;
        this.scrollRect.start -= (this.ele.usEppBar.target.length > 0 ? this.ele.usEppBar.offset().height : 0);
        this.scrollRect.start -= (this.ele.usEppDiscount.target.length > 0 ? this.ele.usEppDiscount.offset().height : 0);

        this.scrollRect.height = this.ele.section.parent().find('.pd-header-navigation__dummy').height();
      } else {
        const targetRect = {
          top: 0,
          height: 0,
        };

        if (this.scrollRect.mobileFixTargetEl !== undefined) {
          targetRect.top = this.scrollRect.mobileFixTargetEl.getBoundingClientRect().top + top;
          targetRect.height = this.scrollRect.mobileFixTargetEl.getBoundingClientRect().height;
        }

        this.scrollRect.start = targetRect.top + targetRect.height / 2;

        this.scrollRect.height = this.ele.section.height() + (this.ele.menuMotion.target.length > 0 ? this.ele.menuMotion.offset().height : 0);
      }

      const eppDisHeight = (this.isUsEppDiscount ? this.ele.usEppDiscount.offset().height : 0);
      const eppBarHeight = (this.ele.usEppBar.target.length > 0 ? this.ele.usEppBar.offset().height : 0);
      this.scrollRect.offTop = parseFloat((eppBarHeight + eppDisHeight).toFixed(2));

      if (nowPc === false) {
        if (this.scrollRect.mobileFixTargetEl !== undefined) {//(has title)
          this.scrollRect.start -= this.scrollRect.offTop;
        } else { //(no title)
          this.scrollRect.start = eppBarHeight;

          if ((this.ele.usEppDisKeep.target.length > 0)) {
            const eppDisTop = this.ele.usEppDisKeep.offset().top;
            if (eppDisTop) {
              this.scrollRect.start = (top + eppDisTop - eppBarHeight);
            }
          }
        }

        if(this.statePC === false && this.isLandscape === false) {
          this.ele.section.css({
            top: `${this.scrollRect.offTop}px`,
          });
        }
      }
      this.scrollRect.height = parseFloat((this.scrollRect.height).toFixed(2));
    }

    fixNaviPC() {
      const top = document.body.scrollTop || document.documentElement.scrollTop;
      //epp
      const eppBarHeight = (this.ele.usEppBar.target.length > 0 ? this.ele.usEppBar.offset().height : 0);
      if (this.isUsEppDiscount) {
        if (this.ele.usEppDisKeep.offset().top < 0 + eppBarHeight) {
          if (window.sg.components.usEppDiscount !== undefined) {
            window.sg.components.usEppDiscount.setFixed(true);

            if (this.ele.usEppDiscount.target[0].style.top !== `${eppBarHeight}px`) {
              this.ele.usEppDiscount.css({
                top: `${eppBarHeight}px`,
              });
            }
          }
        } else {
          if (this.isUsEppDiscount) {
            if (window.sg.components.usEppDiscount !== undefined) {
              window.sg.components.usEppDiscount.setFixed(false);
            }
            if (this.ele.usEppDiscount.target[0].style.top !== '') {
              this.ele.usEppDiscount.css({
                top: '',
              });
            }
          }
        }
      }

      this.ele.section.finish();
      if (top > this.scrollRect.start) {
        if (this.scrollRect.fixMode === 'pcOn') {
          return;
        }

        this.ele.section.addClass(this.selector.scrollFix);

        this.scrollRect.fixMode = 'pcOn';

        if (window.sg.components.pdBanner !== undefined && this.scrollRect.bannerEle.hasClass('pd-banner--open')) {
          window.sg.components.pdBanner.closeBanner(true);
        }

        if (this.ele.section.target[0].style.top !== `${this.scrollRect.offTop}px`) {
          this.ele.section.css({
            top: `${this.scrollRect.offTop}px`,
          });
        }
      } else {
        if (this.scrollRect.fixMode === 'pcOff') {
          return;
        }

        this.ele.section.removeClass(this.selector.scrollFix);
        this.scrollRect.fixMode = 'pcOff';

        if (this.ele.section.target[0].style.top !== '') {
          this.ele.section.css({
            top: '',
          });
        }
      }
    }

    fixNaviMobile(motion = true) {
      const top = (document.body.scrollTop || document.documentElement.scrollTop);
      const eppBarHeight = (this.ele.usEppBar.target.length > 0 ? this.ele.usEppBar.offset().height : 0);
      let fixedCheck = null;

      if (this.isUsEppDiscount) { //fix .us-epp-discount
        if (this.ele.usEppDisKeep.offset().top < eppBarHeight) {
          if (window.sg.components.usEppDiscount !== undefined) {
            window.sg.components.usEppDiscount.setFixed(true);
            fixedCheck = true;
          }
          if (this.ele.usEppDiscount.target[0].style.top !== `${eppBarHeight}px`) {
            this.ele.usEppDiscount.css({
              top: `${eppBarHeight}px`,
            });
          }
        } else {
          if (window.sg.components.usEppDiscount !== undefined) {
            window.sg.components.usEppDiscount.setFixed(false);
            fixedCheck = false;
          }
          if (this.ele.usEppDiscount.target[0].style.top !== '') {
            this.ele.usEppDiscount.css({
              top: '',
            });
          }
        }
      }

      if (this.mobileMenuOpen) {
        if (fixedCheck === null) {
          fixedCheck = (top <= ($q('.gnb').target.length && $q('.gnb').height() || $q('.nv00-gnb').target.length && $q('.nv00-gnb').height())) ? false : true;
        }

        if (fixedCheck && this.isLandscape === false) {
          this.ele.section.css({
            top: `${this.scrollRect.offTop}px`,
          });

          this.ele.section.addClass(this.selector.scrollFix);
        } else {
          this.ele.section.css({
            top: '',
          });

          this.ele.section.removeClass(this.selector.scrollFix);
        }

        return;
      }

      let transY = 0;

      if (top > this.scrollRect.start && this.isLandscape === false) {
        if (this.scrollRect.fixMode === 'mobileOn') {
          return;
        }

        this.ele.section.addClass(this.selector.scrollFix);
        transY = (this.scrollRect.height + this.scrollRect.offTop) * -1;
        this.ele.section.css({
          transform: 'translate3d(0,0,0)',
        });

        if (motion) {
          const preCss = {
            transition: 'transform .2s cubic-bezier(.2,.6,.4,1)',
          };

          if (this.ele.section.target[0].style.transform === '') {
            preCss.transform = `translate3d(0,${transY}px,0)`;
          }

          if (this.ele.section.target[0].style.transform !== 'translate3d(0,0,0)') {
            this.ele.section.css(preCss);

            requestAnimationFrame(() => {
              this.setPriceHeight();
              this.ele.section.css({
                transform: 'translate3d(0,0,0)',
              });
            });
          }
        } else {
          if (this.ele.section.target[0].style.transform !== 'translate3d(0,0,0)') {
            this.ele.section.css({
              transform: 'translate3d(0,0,0)',
            });
          }
        }

        this.scrollRect.fixMode = 'mobileOn';
      } else {
        if (window.sg.components.pdBanner !== undefined && this.scrollRect.bannerEle.hasClass('pd-banner--open')) {
          window.sg.components.pdBanner.closeBanner(true);
        }

        if (this.scrollRect.fixMode === 'mobileOff') {
          return;
        }

        transY = (this.scrollRect.height + this.scrollRect.offTop) * -1;

        ['webkitTransitionEnd', 'oTransitionEnd', 'otransitionend', 'mozTransitionEnd', 'moztransitionend', 'transitionend', 'transitionEnd'].forEach((eventName) => {
          this.ele.section.target[0].removeEventListener(eventName, this.handler.fixNaviFinish);
          this.ele.section.target[0].addEventListener(eventName, this.handler.fixNaviFinish);
        });

        if (this.scrollRect.height === 1) {
          this.resetFixData(false);
          transY = (this.scrollRect.height + this.scrollRect.offTop) * -1;
        }

        if (this.ele.section.target[0].style.transform !== `translate3d(0,${transY}px,0)`) {
          requestAnimationFrame(() => {
            this.ele.section.css({
              transition: 'transform .2s cubic-bezier(.2,.6,.4,1)',
              transform: `translate3d(0,${transY}px,0)`,
            });
          });
        }

        this.scrollRect.fixMode = 'mobileOff';
      }
    }

    scrollHash(url) {
      if (this.isIdSelector(url)) {
        const $targetArea = $q(url).eq(0);
        if ($targetArea.target.length !== 0) {
          requestAnimationFrame(() => {
            const offset = this.scrollRect.height + this.scrollRect.offTop;
            const scrollToPx = (document.body.scrollTop || document.documentElement.scrollTop) + ($targetArea.offset().top - offset) + (this.statePC ? 1 : 2);
            window.sg.common.lazyLoad.ignoreLazyLoadOnceUnder(document, scrollToPx + offset);
            window.scrollTo(0, scrollToPx);
          });
        }
      }
    }

    hideTooltip() {
      if (this.focusTooltipWrap === null) {
        return;
      }

      const $layer = this.focusTooltipWrap.find(this.selector.tooltipLayer);
      $layer.hide();
      $layer.removeAttr('tabindex');

      this.focusTooltipWrap.find('.tooltip-close').removeAttr('tabindex');
      this.focusTooltipWrap.off('mouseleave');
      this.focusTooltipWrap.off('focusout');
      this.focusTooltipWrap.find('.tooltip-close').off('click');
      this.focusTooltipWrap.find('.tooltip-close').off('keydown');
      this.ele.window.off('click', this.checkOutClickTooltip);

      this.focusTooltipWrap = null;
    }

    checkOutClickTooltip(event) {
      setTimeout(() => {
        if (this.focusTooltipWrap !== null && $q(event.target).closest(this.focusTooltipWrap.target[0]).target.length === 0) {
          this.hideTooltip();
        }
      }, 30);
    }

    showTooltip(hover = false) {
      const $wrap = this.ele.tooltipBtn.closest(this.selector.tooltipWrap);
      const $layer = $wrap.find(this.selector.tooltipLayer);
      this.focusTooltipWrap = $wrap;

      $layer.show();
      $wrap.find('.tooltip-close').attr('tabindex', 0);

      if (hover === false) {
        $layer.attr('tabindex', 0);
        $layer.focus();
      } else {
        $wrap.off('mouseleave').on('mouseleave', () => {
          this.hideTooltip();
        });
      }

      $wrap.off('focusout').on('focusout', () => {
        setTimeout(() => {
          if ($q(document.activeElement).closest($wrap.target[0]).target.length === 0) {
            this.hideTooltip();
          }
        }, 30);
      });
      $wrap.find('.tooltip-close').off('click').on('click', () => {
        this.hideTooltip();
      });
      $wrap.find('.tooltip-close').off('keydown').on('keydown', (event) => {
        if (event.keyCode === window.sg.common.constants.KEY_CODE.ENTER) {
          this.hideTooltip();
        }ClickTooltip);
    }

    bindEvents() {
      this.ele.menuWrap.off('dragstart').on('dragstart', (event) => {
        event.stopPropagation();
        event.preventDefault();
        return false;
      });
      this.ele.menuWrap.off('selectstart').on('selectstart', (event) => {
        event.stopPropagation();
        event.preventDefault();
        return false;
      });
      this.ele.naviMenu.off('mouseenter').on('mouseenter', (event) => {
        this.moveMenuBar($q(event.currentTarget));
      });
      this.ele.naviMenu.off('focusin').on('focusin', (event) => {
        const $menu = $q(event.currentTarget);
        this.scrollMenuToBtn($menu);
        requestAnimationFrame(() => { //for ie
          this.moveMenuBar($menu);
        });
      });
      this.ele.naviMenu.find('a').target.forEach((obj) => {
        $q(obj).off('click').on('click', (event) => {
          const url = event.currentTarget.getAttribute('href').trim();
          if (this.isIdSelector(url)) {
            event.preventDefault();
            event.stopPropagation();
            this.setActiveMenu($q(event.currentTarget).closest(this.selector.naviMenu).target[0]);
            this.scrollHash(event.currentTarget.getAttribute('href'));
            const $menu = $q(event.currentTarget.parentNode);
            this.scrollMenuToBtn($menu,true);
            requestAnimationFrame(() => {
              this.moveMenuBar($menu);
            });
          }
        });
      });
      this.ele.naviWrap.off('mouseleave').on('mouseleave', () => {
        this.moveMenuBar(this.ele.naviActive);
      });
      this.ele.naviWrap.off('focusout').on('focusout', () => {
        requestAnimationFrame(() => {
          if ($q(document.activeElement).closest(this.ele.naviWrap.target[0]).target.length === 0) {
            this.moveMenuBar(this.ele.naviActive);
          }
        });
      });

      // this.ele.menuBtn.off('click').on('click', this.toggleMobileMenu.bind(this));

      this.ele.tooltipBtn.off('mouseenter').on('mouseenter', () => {
        if (this.statePC) {
          this.showTooltip(true);
        }
      });
      this.ele.tooltipBtn.off('click').on('click', (event) => {
        event.preventDefault();
        event.stopPropagation();
        this.showTooltip();
      });

      this.ele.section.find(`${this.selector.mobilePrevArrow},${this.selector.mobileNextArrow}`).off('click').on('click',(event) => {
        const outMenu = event.currentTarget.classList.contains('pd-header-navigation__btn-prev') ? this.findLeftMenu() : this.findRightMenu();
        if (outMenu != null) {
          const $outMenu = $q(outMenu);
          this.scrollMenuToBtn($outMenu, true);
          requestAnimationFrame(() => {
            this.moveMenuBar(this.ele.naviActive);
          });
        }
      });

      this.ele.installmentTooltipOpenBtn.off('click', this.handler.installmentTooltipOpen).on('click', this.handler.installmentTooltipOpen);
      this.ele.installmentTooltipCloseBtn.off('click', this.handler.installmentTooltipClose).on('click', this.handler.installmentTooltipClose);
    }

    getOffArrow(){
      let wrapPadding = Math.max(this.ele.mobilePrevArrow.offset().width, this.ele.mobileNextArrow.offset().width);
      wrapPadding += Math.max(
        parseFloat(window.getComputedStyle(this.ele.mobilePrevArrow.target[0],':after').width),
        parseFloat(window.getComputedStyle(this.ele.mobileNextArrow.target[0],':after').width));
      return wrapPadding;
    }

    findRightMenu(){
      let outMenu = null;
      const wrapPadding = this.getOffArrow() - 1;
      const winWidth = utils.getViewPort().width;

      this.ele.naviMenu.target.some((menu,idx) => {
        const rec = menu.getBoundingClientRect();
        if (this.isRtl) {
          if (rec.left + rec.width + wrapPadding <= winWidth) {
            outMenu = this.ele.naviMenu.target[idx - 1];
            return true;
          }
          return false;
        } else {
          if (rec.left + rec.width + wrapPadding > winWidth) {
            outMenu = menu;
            return true;
          }
          return false;
        }
      });
      return outMenu;
    }

    findLeftMenu(){
      let outMenu = null;
  idx) => {
        const rec = menu.getBoundingClientRect();
        if (this.isRtl) {
          if (rec.left - wrapPadding < 0) {
            outMenu = menu;
            return true;
          }
          return false;
        } else {
          if (rec.left - wrapPadding >= 0) {
            outMenu = this.ele.naviMenu.target[idx - 1];
            return true;
          }
          return false;
        }
      });
      return outMenu;
    }

    // checkOutClick(event) {
    //   const isOut = $q(event.target).closest(this.ele.menuWrap.target[0]).target.length <= 0;
    //   if (isOut || event.target === document.documentElement) {
    //     this.closeMobileMenu();
    //   }
    // }

    // toggleMobileMenu() {
    //   i //   if (this.ele.menuWrap.hasClass('pd-header-navigation__menu--close')) {
    //     this.openMobileMenu();
    //   } else {
    //     this.closeMobileMenu();
    //   }
    // // }

    // openMobileMenu() {
    //   this.ele.menuMotion.finish();
    //   this.ele.menuWrap.removeClass('pd-header-navigation__menu--close');
    //   this.ele.menuWrap.addClass('pd-header-navigation__menu--open');

    //   this.resetFixData(BREAKPOINTS.MOBILE < utils.getViewPort().width);
    //   this.fixMobileMenu();

    //   this.ele.menuMotion.slideDown(200, () => {
    //     this.ele.window.off('click', this.handler.outClick).on('click', this.handler.outClick);
    //   });

    //   this.ele.section.find('.pd-header-navigation__headline-anchor .hidden').text('close');
    // }

    // closeMobileMenu(motion = true) {
    //   if (motion && this.ele.menuWrap.hasClass('pd-header-navigation__menu--close')) {
    //     return;
    //   }

    //   this.ele.menuMotion.finish();
    //   this.ele.menuWrap.addClass('pd-header-navigation__menu--close');

    //   if (motion) {
    //     this.ele.menuMotion.slideUp(200, this.handler.closeMobileMenuCallback);
    //   } else {
    //     this.handler.closeMobileMenuCallback();
    //   }

    //   this.ele.window.off('click', this.handler.outClick);

    //   this.ele.section.find('.pd-header-navigation__headline-anchor .hidden').text('open');
    // }

    // resetMobileMenuMotion() {
    //   this.ele.menuMotion.css({
    //     overflow: '',
    //     height: '',
    //     paddingTop: '',
    //     paddingBottom: '',
    //     display: '',
    //   });
    // }

    // fixMobileMenu(close = true) {
    //   if (close === true && this.ele.menuWrap.hasClass('pd-header-navigation__menu--open')) {
    //     this.ele.menuMotion.css({
    //       top: `${this.scrollRect.height}px`,
    //     });
    //   } else {
    //     this.ele.menuMotion.css({
    //       top: '',
    //     });
    //   }
    // }

    /**
     * @param1 {object} $menu menu
     * @param2 {object} once move 1button or first
     */
    scrollMenuToBtn($menu, once = false) {
      if (this.statePC === true || $menu.target.length === 0) {
        this.menuScrollLeft = 0;
        this.ele.naviWrap.css({
          transform: '',
        });
        return;
      }

      const wrapPadding = this.getOffArrow();

      if (this.isRtl && this.isOpera) {
        this.ele.naviWrap.target[0].parentNode.scrollLeft = this.menuScrollMax * -1;
      } else {
        this.ele.naviWrap.target[0].parentNode.scrollLeft = 0;
      }

      requestAnimationFrame(() => {
        const menuRect = $menu.offset();

        if ((menuRect.left < wrapPadding) || (this.menuWrapWidth < menuRect.left + menuRect.width + wrapPadding)) {//lineStart || lineEnd
          if (this.isRtl) {
            if (once && menuRect.left < wrapPadding) {
              this.scrollMenuToPx((menuRect.left - wrapPadding) * -1);
            } else {
              this.scrollMenuToPx((menuRect.left + menuRect.width - this.menuWrapWidth + wrapPadding) * -1);
            }
          } else {
            if (once && menuRect.left > wrapPadding) {
              this.scrollMenuToPx((menuRect.left + menuRect.width - this.menuWrapWidth + wrapPadding) * -1);
            } else {
              this.scrollMenuToPx((menuRect.left - wrapPadding) * -1);
            }
          }
        }
      });
    }

    scrollMenuToPx(len) {
      if (this.statePC === true || this.menuScrollMax === 0) {
        this.menuScrollLeft = 0;
        this.ele.naviWrap.css({
          transform: '',
        });
        return;
      }

      this.menuScrollLeft += len;
      if (this.statePC === false) {
        this.ele.mobilePrevArrow.show();
        this.ele.mobileNextArrow.show();

        let hideBtnPrev = false;
        let hideBtnNext = false;

        if (this.isRtl) {
          if (this.menuScrollLeft <= 0) {
            this.menuScrollLeft = 0;
            hideBtnNext = true;
          } else if (this.menuScrollLeft >= this.menuScrollMax * -1) {
            this.menuScrollLeft = this.menuScrollMax * -1;
            hideBtnPrev = true;
          }
        } else {
          if (this.menuScrollLeft >= 0) {
            this.menuScrollLeft = 0;
            hideBtnPrev = true;
          } else if (this.menuScrollLeft <= this.menuScrollMax) {
            this.menuScrollLeft = this.menuScrollMax;
            hideBtnNext = true;
          }
        }

        if (hideBtnPrev) {
          if (document.activeElement === this.ele.mobilePrevArrow.target[0]) {
            this.ele.mobileNextArrow.focus();
          }
          this.ele.mobilePrevArrow.hide();
        }
        if(hideBtnNext) {
          if (document.activeElement === this.ele.mobileNextArrow.target[0]) {
            this.ele.mobilePrevArrow.focus();
          }
          this.ele.mobileNextArrow.hide();
        }
      }

      this.ele.naviWrap.css({
        transform: `translateX(${this.menuScrollLeft}px)`,
      });
    }

    moveMenuBar($menu) {
      if ($menu.target.length <= 0 || $menu.target[0] === null) {
        this.ele.naviMenuBar.target[0].style.display = 'none';
        return;
      }

      const left = $menu.offset().left - this.ele.naviWrap.offset().left + this.menuScrollLeft;
      if (this.ele.naviMenuBar.target[0].style.left !== `${left}px` || this.ele.naviMenuBar.target[0].style.width !== `${$menu.width()}px`) {
        this.ele.naviMenuBar.css({
          left: `${left}px`,
          width: `${$menu.width()}px`,
        });
      }

      if (this.ele.naviMenuBar.target[0].style.display === 'none') {
        this.ele.naviMenuBar.target[0].style.display = '';
      }
    }

    setActiveMenu(active) {
      this.ele.naviActive = $q(active);
      this.ele.naviMenu.target.forEach((el) => {
        if (el.classList.contains('active')) {
          el.classList.remove('active');
        }
      });
      if (active !== null) {
        if (this.ele.naviActive.target[0].classList.contains('active') !== true) {
          this.ele.naviActive.addClass('active');
        }
      }
      this.moveMenuBar(this.ele.naviActive);
    }

    getRect() {
      return this.scrollRect;
    }

    installmentTooltipOpen() {
      this.ele.section.find('.pd-buying-price__tooltip').addClass('pd-buying-price__tooltip--show');
    }

    installmentTooltipClose() {
      this.ele.section.find('.pd-buying-price__tooltip').removeClass('pd-buying-price__tooltip--show');
    }
  }

  function init() {
    $q(selector.pdHeaderNavigation).target.forEach((element) => {
      if (!PDheaderNavigation.instances.has(element)) {
        new PDheaderNavigation(element);
      }
    });

    $q(window).off('hashchange', goHash).on('hashchange', goHash);
  }

  function reInit() {
    $q(selector.pdHeaderNavigation).target.forEach((element) => {
      if (PDheaderNavigation.instances.has(element)) {
        const instances = PDheaderNavigation.instances.get(element);
        instances.reInit();
      } else {
        new PDheaderNavigation(element);
      }
    });
  }

  function getRect(element = null) {
    if (element === null) {
      element = $q(selector.pdHeaderNavigation).target[0];
    }

    if (PDheaderNavigation.instances.has(element)) {
      const instances = PDheaderNavigation.instances.get(element);
      return instances.getRect();
    } else {
      return {};
    }
  }

  function goHash() {
    const hashId = window.location.hash.trim();
    const component = $q(selector.pdHeaderNavigation).target[0];
    if (PDheaderNavigation.instances.has(component)) {
      const instances = PDheaderNavigation.instances.get(component);
      instances.scrollHash(hashId);
    }
  }

  function scrollToAnchor(anchor) {
    const hashId = anchor.trim();
    const component = $q(selector.pdHeaderNavigation).target[0];
    if (PDheaderNavigation.instances.has(component)) {
      const instances = PDheaderNavigation.instances.get(component);
      instances.scrollHash(hashId);
    }
  }

  function loadInit() {
    $q(selector.pdHeaderNavigation).target.forEach((element) => {
      if (PDheaderNavigation.instances.has(element)) {
        const instances = PDheaderNavigation.instances.get(element);
        instances.loadInit();
      }
    });
  }

  PDheaderNavigation.instances = new WeakMap();

  window.sg.components.pdHeaderNavigation = {
    init,
    reInit,
    getRect,
    scrollToAnchor,
  };

  $q.ready(init);
  $q.load(() => {
    loadInit();
    requestAnimationFrame(() => goHash());
  });
})();

(function (win, $) {
	'use strict';
	
	if('undefined' === typeof win.sg) {
		win.sg = {};
	}

	if('undefined' === typeof win.sg.aem) {
		win.sg.aem = {};
	}

	if('undefined' === typeof win.sg.aem.components) {
		win.sg.aem.components = {};
	}
	
	if('undefined' === typeof win.sg.aem.components.product) {
		win.sg.aem.components.product = {};
	}

	const namespace = win.sg.aem.components.product;
	const navModelCode = $("#modelCode").val();
	const navPriceCurrency = $("#priceCurrency").val();
	const navBtn = $(".pd-header-navigation .anchorBtn");
	
	const navSaerchDomain = $("#searchDomain").val();
	const navApiStageInfo = $('#apiStageInfo').val();
	const navShopIntegeration = $("#shopIntegrationFlag").val();
	const navOldProductYn = $("#navOldProductYn").val();
	const navIsGPv2 = (navShopIntegeration === 'GPv2') ? true : false;
	const navIsHybrisNew = (navShopIntegeration === 'Hybris-new') ? true : false;					//new-hybris
	const navIsHybrisIntg = (navShopIntegeration === 'Hybris-intg') ? true : false;
	const navHybrisJsonYn = $("#hybrisApiJson").val();
	const isNonShop = fnIsNull(navShopIntegeration)?true : false;
	const navStoreDomain = $("#storeDomain").val();
	const navIsCart = $("#useStore").val();
	const navShopServiceYn = $("#navShopServiceYn").val();
	const navPriceDisplayYn = $("#navPriceDisplayYn").val();
	const navPageTrack = $("#navPageTrack").val();
	const productGroupCode = $("#categoryGroupCode").val();
	const navPackageYn = $('#navPackageYn').val();
	
	
	
	const GROUPCODE_VD = "04000000";
	const GROUPCODE_HA = "08000000";
	const GROUPCODE_IM = "01000000";
	
	let navSiteCode = $("#siteCode").val();
	//CRHQ-8407 [B2C] DE - Galaxy Book2 PD  CTA  
	const removeCtaSkuArray = ['NP955XED-KA1DE','NP950QED-KA1DE','NP950QED-KA2DE','NP950XED-KA1DE','NP930XED-KA1DE','NP930QED-KH1DE','NP930QED-KA1DE','NP930QED-KA2DE','NP750XED-KC2DE','NP750XED-KC1DE','NP750XED-KB2DE','NP750XED-KB1DE','NP750XED-KB4DE','NP750XED-KB3DE','NP750XED-KB5DE','NP730QED-KA1DE','NP750XEE-XA2DE','NP750XED-KC5DE','NP750XED-KC4DE','NP750XED-KC3DE','NP750XED-KB7DE','NP750XED-KB6DE','NP950QED-KA4DE','NP950QED-KA3DE','NP950QED-KJ1DE','NP930QED-KA3DE'];
	
	// localshop
	const navIsHybris = (("Y" === navShopServiceYn && "Y" === navIsCart) || "Hybris-intg" === navShopIntegeration ) && "Y" !== navOldProductYn;
	const navIsRealTime = navSiteCode === 'br' || navSiteCode === 'latin' || navSiteCode === 'ar' || navSiteCode === 'py';

	//ro, de api lowestWasPrice         
	let isNewElementLowestWasPrice = navSiteCode === 'pl' || navSiteCode === 'si' || navSiteCode === 'gr' || navSiteCode === 'fi' || navSiteCode === 'it' || navSiteCode === 'se' || navSiteCode === 'no' || navSiteCode === 'dk' || navSiteCode === 'fr';
	let isNewElementLowestWasPriceSetting =  false; // pl    

	//CRHQ-8511 [B2C] SENA    (     )  dk     
	let isMonthlySENA  =  navSiteCode === 'se' || navSiteCode === 'fi' || navSiteCode === 'no';
	
	let navSearchApiParam = {
		"siteCode": navSiteCode,
		"modelList" : navModelCode,
		"onlyRequestSkuYN": "Y",
		"keySummaryYN": "N",
		"specYN": "N"
	};
	
	// api  
	// epp search  
	const isEPP = $('#isEppPage').val() === 'true';
	const businessType = isEPP ? 'epp/v2': 'b2c';
	if(isEPP){
		navSearchApiParam.companyCode  = $('#eppCompanyCode').val();
		navSearchApiParam.shopSkuYN  = "N";
		
		const eppIsUserGroupPricing = window.sg.epp.common.isUserGroupPricing;
		if(eppIsUserGroupPricing){
			navSearchApiParam['groupName'] = window.sg.epp.common.groupName;
		}
		
		//[EPP] in refurbished   selector 
		let offerId = location.pathname.match(/[0-9]{13}/g);
		if ( offerId != null && typeof offerId != 'undefined' && $.trim(offerId) != '' ){
			navSearchApiParam['offerId'] = offerId[0];
		}
	
		//epp lowestWasPrice 
		if ( eppOmniPricingUseYn === "Y" ){
			isNewElementLowestWasPrice = true;
		} else {
			isNewElementLowestWasPrice = false;
		}		
	}
	
	let navSearchApiUrl = navSaerchDomain + '/' + navApiStageInfo + '/'+businessType+'/product/card/detail/global';
	if (navIsGPv2) {
		navSearchApiParam.commonCodeYN = "N";
		navSearchApiParam.saleSkuYN = "N";
		navSearchApiUrl = navSaerchDomain + '/' + navApiStageInfo + '/'+businessType+'/product/card/detail/gpv2';
	} else if (navIsHybrisNew) {					//new-hybris
		navSearchApiParam.commonCodeYN = "N";
		navSearchApiParam.saleSkuYN = "N";
		navSearchApiUrl = navSaerchDomain + '/' + navApiStageInfo + '/'+businessType+'/product/card/detail/newhybris';
	} else if (navIsHybrisIntg) {
		navSearchApiParam.saleSkuYN = "N";
		navSearchApiUrl = navSaerchDomain + '/' + navApiStageInfo + '/'+businessType+'/product/card/detail/hybris';
	}
	
	//   &shopSiteCode 
	let dotcom_multistore = $.cookies.get("estoreSitecode") ? $.cookies.get("estoreSitecode").toString() : '';
	let shopSiteCd = '';
	if(navSiteCode === "ae" || navSiteCode === "ae_ar"){
		if(dotcom_multistore !== '') {
			//NOTICE : dotcomMultistore     ae, ae_ar, kw, kw_ar, om, om_ar, bh, bh_ar,qa,qa_ar    
			if(dotcom_multistore === "ae" || dotcom_multistore === "ae_ar" || dotcom_multistore === "kw" || dotcom_multistore === "kw_ar" || dotcom_multistore === "om" || dotcom_multistore === "om_ar" || dotcom_multistore === "bh" || dotcom_multistore === "bh_ar" || dotcom_multistore === "qa" || dotcom_multistore === "qa_ar") {
				shopSiteCd = dotcom_multistore;
			} else {
				shopSiteCd = navSiteCode;
			}
		} else {
			shopSiteCd = navSiteCode;
		}
	} else if(navSiteCode === "levant"){
		shopSiteCd = "jo";
	} else if(navSiteCode === "levant_ar"){
		shopSiteCd = "jo_ar";
	} else if(navSiteCode === "n_africa"){
		shopSiteCd = "ma";
	}
	
	if(shopSiteCd !== ''){
		navSearchApiParam['shopSiteCode'] = shopSiteCd;
	}
	
	namespace.setAnchors = (function() {
		let checkEmpty = function(item, emptyYn) {
			if(emptyYn === "N") {
				$(item).show();
				$(item).css("margin-left", "");
			} else {
				$(item).hide();
				$(item).css("margin-left", "0px");
			}
		};

		// product type 
		let checkProductType = function(productType) {
			let summaryEmptyYn = "N";
			if(productType === "A"){
				summaryEmptyYn = "Y";
			}
			return summaryEmptyYn;
		};

		// pd-g-feature-benefit   
		let checkFeatureEmptyYn = function(featureEmptyYn) {
			let featureEmptyFlag = true;
			
			if(featureEmptyYn.length>0){
				featureEmptyYn.each(function(){
					if($(this).val() === "N") {
						featureEmptyFlag = false;
					}
				});
			} else {
				featureEmptyFlag = false;
			}

			return featureEmptyFlag;
		};
		
		// pd-g-feature-benefit-gallery   
		let checkFeatureGalleryEmptyYn = function(featureGalleryEmptyYn) {
			let featureGalleryEmptyFlag = true;
			
			featureGalleryEmptyYn.each(function(){
				if($(this).val() === "N") {
					featureGalleryEmptyFlag = false;
				}
			});
			return featureGalleryEmptyFlag;
		};

		return {
			// anchor setting
			setAnchor : function() {
				const anchorContainer = $("#anchorContainer");
				const benefitEmptyYn = "N";// summary  
				const summaryEmptyYn = $("#summaryEmptyYn").val();// summary  
				const supportEmptyYn = $("#supportEmptyYn").val();// support  
				let specEmptyYn = $("#specEmptyYn").val();// specs  
				if(navPackageYn === 'Y') {
					specEmptyYn = 'N';
				}
				const featureEmptyYn = $("input[name=featureEmptyYn]");// feature  
				const featureBundleEmptyYn = $("#featureBundleEmptyYn").val();// feature bundle  
				const featureGalleryEmptyYn = $("input[name=featureGalleryEmptyYn]");// feature gallery  
				const emptyYnArr = [benefitEmptyYn, featureGalleryEmptyYn.val(), summaryEmptyYn, supportEmptyYn, specEmptyYn, featureBundleEmptyYn];
				const anchorIdArr = ["benefit", "gallery", "summary", "support", "specs", "feature-benefit-bundle"];
				
				let featureEmptyFlag = checkFeatureEmptyYn(featureEmptyYn);
				let featureGalleryEmptyFlag = checkFeatureGalleryEmptyYn(featureGalleryEmptyYn);

				// pc, mobile anchors
				const anchors = $("#anchorContainer .pd-header-navigation__menu > li:not(#anchor_pd-g-product-compare)");
				const summaryProductType = $("#summaryProductType").val();// product type
				
				checkProductType(summaryProductType);
				anchorContainer.hide();
				anchors.each(function(){
					let anchorId = $(this).attr("id");
					if(anchorId !== undefined) {
						anchorId = anchorId.replace("anchor_", "");
						let checkEmptyFlag = false;
						if(anchorId === "reviewWrap"){
							$("#reviewWrap").show();
							$("#reviewWrap").removeAttr("style");
						}else if(anchorId === "anchorWtb"){
							$("#anchorWtb > a").attr("href", "javascript:;");
						}else if(anchorId === "anchorOffer"){
							$("#anchorOffer").show();
							$("#anchorOffer").removeAttr("style");
						}else{
							if(((!isNaN(anchorId) || anchorId.indexOf("feature") > -1) && featureEmptyFlag) || (!isNaN(anchorId) && $(this).find("a").attr("href") === "#gallery" && featureGalleryEmptyFlag)) {
								$(this).hide();
								$(this).css("margin-left", "0px");
								checkEmptyFlag = true;
							}else {
								for(let i=0; i<anchorIdArr.length; i++) {
									if(anchorId.indexOf(anchorIdArr[i]) >= 0) {
										checkEmpty($(this), emptyYnArr[i]);
										checkEmptyFlag = true;
										break;
									}
								}
							}
							if(!checkEmptyFlag) {
								$(this).show();
								$(this).removeAttr("style");
							}
						}
					}
				});
				const tempTitle = $('#tempTitle').val();
				const configuratorUrl = $("#navConfiguratorUrl").val();
				const ctaLocalText = $("#navCtaLocalText").val();
				const ctaEngText = $("#navCtaEngText").val();
				const configuratorUseYn = $("#navConfiguratorUseYn").val();
				if( configuratorUseYn === 'Y' ){
					if( tempTitle === 'page-feature-pd' ){
						if( configuratorUrl !== '' && configuratorUrl !== null ){
								$('.pd-buying-price__cta a').attr('href', configuratorUrl);
						}else{
							$('.pd-buying-price__cta a').addClass('cta--disabled');
						}
						if( ctaLocalText !== '' && ctaLocalText !== null ){
							$('.pd-buying-price__cta a').html(ctaLocalText);
						}
						if( ctaEngText !== '' && ctaEngText !== null ){
							$('.pd-buying-price__cta a').attr('an-ac', ctaEngText).attr('an-la', ctaEngText);
						}
					}
				}
				anchorContainer.show();
			},
			setApi : function() {
				$.ajax({
					url: navSearchApiUrl,
					data: navSearchApiParam,
					success: function(data){
						const tempTitle = $('#tempTitle').val();
						const configuratorUrl = $("#navConfiguratorUrl").val();
						const ctaLocalText = $("#navCtaLocalText").val();
						const ctaEngText = $("#navCtaEngText").val();
						const configuratorUseYn = $("#navConfiguratorUseYn").val();
						
						if(data.response.statusCode === 200 && data.response.resultData !== null){
							let product = data.response.resultData.productList[0];
							let upperStock = "";
							if(isNotNull(product)){
								
								if(isNotNull(product) && isNotNull(product.modelList[0].ctaType)){
									upperStock = product.modelList[0].ctaType.toUpperCase();
									product.modelList[0].ctaTypeUpperCase = upperStock;
								}
								
								/* CTA   :: S */
								if(isNotNull(product) && product.iaCtaDisplay === "Y"){
									//new-hybris
									if(navIsGPv2 || navIsHybrisNew){
										navGetCTAForGPv2(product);
									}else if(navIsHybrisIntg){
										navGetCTAForHybrisIntg(product);
									}else{
										navGetCTAForGlobal(product);
									}
								}
								if( configuratorUseYn === 'Y' ){
									if( tempTitle === 'page-feature-pd' ){
										if( configuratorUrl !== '' && configuratorUrl !== null ){
											product.modelList[0].ctaLink = configuratorUrl;
											setAttr(product, true);
										}else{
											$('.pd-buying-price__cta a').addClass('cta--disabled');
										}
										if( ctaLocalText !== '' && ctaLocalText !== null ){
											getI18n(ctaLocalText);
										}
										if( ctaEngText !== '' && ctaEngText !== null ){
											$('.pd-buying-price__cta a').attr('an-ac', ctaEngText).attr('an-la', ctaEngText);
										}
									}
								}
								/* CTA   :: E */
								
								/*   :: S */
								if(navIsHybris){
									if(navIsRealTime){
										navGetHybrisRealTime();
									}else{
										navGetHybris();
									}
								}else{
									buildPriceArea(product, upperStock);
									window.sg.components.pdHeaderNavigation.reInit();
									/*if(navSiteCode === 'gr'){
										setGrprice();
									}else{
										buildPriceArea(product, upperStock);
									}*/
								}
								/*   :: E */
							}else{
								ctaBtnDefualtSetting();
								return false;
							}
						}else{
							ctaBtnDefualtSetting();
							return false;
						}
					}
				});
			},
			buyingAnchor : function() {
				if($("#marketingpdpYN").val() !== "Y"){
					/* Feature PD   Node  Buying PD AnchorNav  */
					let featureContentUrl = window.location.href;
					featureContentUrl = featureContentUrl.replace("/buy", "");
					let currentpagenav = $("#current-page-nav").val();
					let runModeCheck = $("#runmodeInfo").val();
					let htmllast="/";
					let ajaxFlag = {};
					
					//epp  
					if($('#isEppPage').val() === 'true'){
						featureContentUrl =  window.location.href.replace(/\/buy./ig,`/feature.`);
					}
					
					if(runModeCheck === "live" || runModeCheck === "qa"){
						if(currentpagenav.indexOf("/content/samsung") >=0){
							currentpagenav = currentpagenav.replace("/content/samsung", "");
						}
					}
					
					if(location.href.indexOf(".html") > -1){
						htmllast= ".html";
					}

					//[EPP] in refurbished   selector 
					let addOfferSelector = '';
					if( $('#isEppPage').val() === 'true' ){
						let offerId = location.pathname.match(/[0-9]{13}/g);
						if ( offerId != null && typeof offerId != 'undefined' && $.trim(offerId) != '' ){
							addOfferSelector = '.offerid-' + offerId;
						}
					}
					
					/* Benefit */
					let featureNodeUrl = currentpagenav + ".dynamic.pd-g-feature-benefit"+ "."+ modelCodeToSelector(navModelCode) +"."+ navSiteCode + ".feature" +".readonly" + addOfferSelector + htmllast;
					/* Spec Highlights */
					let specNodeUrl = currentpagenav + ".dynamic.pd-g-product-specs"+ "."+ modelCodeToSelector(navModelCode) +"."+ navSiteCode + addOfferSelector + htmllast;
					/* Support */
					let	supportNodeUrl = currentpagenav + ".dynamic.pd-g-product-support"+ "."+ modelCodeToSelector(navModelCode) +"."+ navSiteCode + addOfferSelector + htmllast;
					/* Compare */
					let	compareNodeUrl = currentpagenav + ".dynamic.pd-g-product-compare"+ "."+ modelCodeToSelector(navModelCode) +"."+ navSiteCode + addOfferSelector + htmllast;
					
					$.ajax({
						url : featureNodeUrl,
						type : "GET",
						dataType: "html",
						success : function (data) {
							let featureAnchorListYn = $("#featureAnchorListYn").val();
							if(featureAnchorListYn == "Y"){
								var benefitWrapCount = $('[id^=benefitWrap]').length;
								var arr = new Array();
								for(var i=0; i<benefitWrapCount; i++){
									arr[i] = $("#benefitWrap"+i).find("a").attr("href");
								}
								for(var i=0; i<arr.length; i++){
									$("#benefitWrap"+i).find("a").attr("href", featureContentUrl + arr[i]);
								}
								
								$('[id^=benefitWrap]').removeAttr("style");
								$('[id^=benefitWrap]').show();
								
							}else{
								let featureEmptyFlag = true;
								$(data).filter("input[name=hasBenefit]").each(function(){
									if($(this).val() === "Y"){
										featureEmptyFlag = false;
									}
								});
								
								let featureGalleryEmptyFlag = true;
								$(data).filter("input[name=hasGallery]").each(function(){
									if($(this).val() === "Y"){
										featureGalleryEmptyFlag = false;
									}
								});
								
								/* a   */
								$("#benefitWrap").find("a").attr("href", featureContentUrl + "#benefits");
								$("#galleryWrap").find("a").attr("href", featureContentUrl + "#gallery");
								
								if(featureEmptyFlag){
									$("#benefitWrap").hide();
									$("#benefitWrap").css("margin-left", "0px");
								}else{
									$("#benefitWrap").removeAttr("style");
									$("#benefitWrap").show();
								}
								
								if(featureGalleryEmptyFlag){
									$("#galleryWrap").hide();
									$("#galleryWrap").css("margin-left", "0px");
								}else{
									$("#galleryWrap").removeAttr("style");
									$("#galleryWrap").show();
								}
							}
							const tempTitle = $('#tempTitle').val();
							const configuratorUrl = $("#navConfiguratorUrl").val();
							const ctaLocalText = $("#navCtaLocalText").val();
							const ctaEngText = $("#navCtaEngText").val();
							const configuratorUseYn = $("#navConfiguratorUseYn").val();
							if( configuratorUseYn === 'Y' ){
								if( tempTitle === 'page-feature-pd' ){
									if( configuratorUrl !== '' && configuratorUrl !== null ){
										$('.pd-buying-price__cta a').attr('href', configuratorUrl);
									}else{
										$('.pd-buying-price__cta a').addClass('cta--disabled');
									}
									if( ctaLocalText !== '' && ctaLocalText !== null ){
										$('.pd-buying-price__cta a').html(ctaLocalText);
									}
									if( ctaEngText !== '' && ctaEngText !== null ){
										$('.pd-buying-price__cta a').attr('an-ac', ctaEngText).attr('an-la', ctaEngText);
									}
								}
							}
						},
						error : function(error){
							/* ajax       */
							$("#benefitWrap").hide();
							$("#galleryWrap").hide();
							$("#benefitWrap").css("margin-left", "0px");
							$("#galleryWrap").css("margin-left", "0px");
						},
						complete : function() {
							ajaxFlag.featureSyn = true;
							ajaxCompleteNav(ajaxFlag);
						}
					});
					
					$.ajax({
						url : specNodeUrl,
						type : "GET",
						success : function (data) {
							/* a   */
							$("#specsWrap").find("a").attr("href", featureContentUrl + "#specs");
							
							let specFlag = $(data).filter("#specEmptyYn").val();
							if(specFlag !== "N"){
								$("#specsWrap").hide();
								$("#specsWrap").css("margin-left", "0px");
							}else{
								$("#specsWrap").removeAttr("style");
								$("#specsWrap").show();
							}
						},
						error : function(error){
							/* ajax       */
							$("#specsWrap").hide();
							$("#specsWrap").css("margin-left", "0px");
						},
						complete : function() {
							ajaxFlag.specSyn = true;
							ajaxCompleteNav(ajaxFlag);
						}
					});
					
					$.ajax({
						url : supportNodeUrl,
						type : "GET",
						success : function (data) {
							/* a   */
							$("#supportWrap").find("a").attr("href", featureContentUrl + "#support");
							
							let supportFlag = $(data).filter("#supportEmptyYn").val();
							if(supportFlag !== "N"){
								$("#supportWrap").hide();
								$("#supportWrap").css("margin-left", "0px");
							}else{
								$("#supportWrap").removeAttr("style");
								$("#supportWrap").show();
							}
						},
						error : function(error){
							/* ajax       */
							$("#supportWrap").hide();
							$("#supportWrap").css("margin-left", "0px");
						},
						complete : function() {
							ajaxFlag.supportSyn = true;
							ajaxCompleteNav(ajaxFlag);
						}
					});
					
					$.ajax({
						url : compareNodeUrl,
						type : "GET",
						success : function (data) {
							/* a   */
							$("#compareWrap").find("a").attr("href", featureContentUrl + "#compare");
							
							let compareFlag = $(data).filter("#compareEmptyYn").val();
							if(compareFlag !== "N"){
								$("#compareWrap").hide();
								$("#compareWrap").css("margin-left", "0px");
							}else{
								$("#compareWrap").removeAttr("style");
								$("#compareWrap").show();
							}
						},
						error : function(error){
							/* ajax       */
							$("#compareWrap").hide();
							$("#compareWrap").css("margin-left", "0px");
						},
						complete : function() {
							ajaxFlag.compareSyn = true;
							ajaxCompleteNav(ajaxFlag);
						}
					});
					
					/* review */
					$("#reviewWrap").find("a").attr("href", featureContentUrl + "#reviews");
				}
			},
			init : function() {
				const pdType = $("#pdType").val();
				
				if(pdType === "S-B"){
					this.buyingAnchor();
				}else{
					this.setAnchor();
					if(pdType === "S-F"){
						this.setApi();
					}
				}
			}
		}
	})();
	
	$(function() {
	namespace.setAnchors.init();
	});
	
	function ajaxCompleteNav(data){
		if(data.featureSyn && data.specSyn && data.supportSyn && data.compareSyn){
			// review component  buying pd  ajax  complete  review  

			$("#reviewWrap").removeAttr("style");
			$("#reviewWrap").show();
			window.sg.components.pdHeaderNavigation.reInit();
		}
	}
	
	function isNotNull(_str){
		return !fnIsNull(_str);
	}
	
	function escapeHtml(text) {
		let newText = text;
		if(isNotNull(newText)){
			newText = newText
				.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;")
				.replace(/"/g, "&quot;")
				.replace(/'/g, "&#039;");
		}
		return newText;
	};
	
	function getI18n(text){
		if(isNotNull(text)){
			if(navSiteCode === 'de' && $.inArray(navModelCode,removeCtaSkuArray) !== -1){
				navBtn.hide();
			}else{
				navBtn.show();
			}
			
			// epp Ru  BUY NOW_FEATURE   ,     i18n     
			// COMP6FE-1619 [EPP] SIEL Offline   : Buy Now CTA 
			if( $('#isEppPage').val() === 'true' && text == 'BUY NOW_FEATURE'){
				if ( $("#siteCode").val() === 'ru' ){
					text = '';
				} else {
					if ( window.sg.epp && window.sg.epp.common && ( window.sg.epp.common.ecomStoreType === "offline" || window.sg.epp.common.ecomStoreType === "offline_reverse_o2o" ) ){
						text = "BUY ONLINE";
					}
				}
			}
			
			return navBtn.html(Granite.I18n.get(text));
		}
	}
	
	//only it  
	function getDiscountRate(saveText, originalPrice) {
		//console.log('saveText=['+saveText+']');
		//console.log('originalPrice=['+originalPrice+']');
		//console.log('originalPrice-saveText=['+(originalPrice-saveText)+']');
		let tempDecimalPoint = Math.pow(10, 2);
		let discountRateTemp = Number(saveText) / Number(originalPrice) * tempDecimalPoint;
		//console.log(discountRateTemp);
		discountRateTemp = Number(discountRateTemp).toFixed(2);
		//console.log(discountRateTemp);
		//  
		discountRateTemp = discountRateTemp.replace('.', ',');
		//console.log(discountRateTemp);
		return discountRateTemp;
	}
	
	function hybrisSetAttr(product){
		let frontModel = product;
		
		let price='';
		let discountPrice = '';
		if(isNotNull(frontModel.price)){
			price = frontModel.price;
		}
		if(isNotNull(frontModel.promotionPrice)){
			discountPrice = frontModel.promotionPrice;
		}
		
		navBtn.attr({
			'data-modelrevenue' : price,
			'data-modelprice' : price,
			'data-discountprice' : discountPrice
		});
	}
	
	//epp  
	function getEppBuyUrl ( modelCode, defaultUrl ){
		if($('#isEppPage').val() === 'true'){
			//[EPP] in refurbished   selector 
			const checkUrl = defaultUrl.match(/[0-9]{13}/g);
			if ( $.trim(checkUrl) === '' ){
				const offerId = location.pathname.match(/[0-9]{13}/g);
				if ( offerId != null && typeof offerId != 'undefined' && $.trim(offerId) != '' ){
					defaultUrl = defaultUrl.replace(modelCode, modelCode + '.' + offerId);
				}
			}
			return defaultUrl.replace('/buy','').replace(/\/feature./ig,`/buy.`)
		}
		
		return defaultUrl;
	}
	
	function setAttr(product, type){
		let frontModel = product.modelList[0];
		let pdpUrl = (frontModel.originPdpUrl === null) ? "" :  frontModel.originPdpUrl;
		let url = pdpUrl + "buy/";
		
		//epp  
		url = getEppBuyUrl($('#modelCode').val(), url);
		
		let price='';
		let discountPrice = '';
		if(isNotNull(frontModel.price)){
			price = frontModel.price;
		}
		if(isNotNull(frontModel.promotionPrice)){
			discountPrice = frontModel.promotionPrice;
		}
		
		if(type === true){
			navBtn.attr({
				'href' : isNotNull(frontModel.ctaLink) ? frontModel.ctaLink : url,
				'data-pimsubtype' : (isNotNull(product.categorySubTypeEngName) ? product.categorySubTypeEngName.toLowerCase():''),
				'data-pvitype' : (isNotNull(frontModel.pviTypeName) ? frontModel.pviTypeName.toLowerCase():''),
				'data-pvisubtype' : (isNotNull(frontModel.pviSubtypeName) ? frontModel.pviSubtypeName.toLowerCase():''),
				'data-modelrevenue' : price,
				'data-modelprice' : price,
				'data-modelqty' : "1",
				'data-modelcurrency': navPriceCurrency,
				'data-modelcode' : frontModel.modelCode,
				'data-modelname' : frontModel.modelName,
				'data-modeldisplay' : escapeHtml(frontModel.displayName.replace(/<br>/ig," ").replace(/<sup>/ig," ")),
				'data-discountprice' : discountPrice
			});
		}else{
			navBtn.attr({
				'config-url' : frontModel.configuratorUrl,
				'data-pimsubtype' : (isNotNull(product.categorySubTypeEngName) ? product.categorySubTypeEngName.toLowerCase():''),
				'data-pvitype' : (isNotNull(frontModel.pviTypeName) ? frontModel.pviTypeName.toLowerCase():''),
				'data-pvisubtype' : (isNotNull(frontModel.pviSubtypeName) ? frontModel.pviSubtypeName.toLowerCase():''),
				'data-modelrevenue' : price,
				'data-modelprice' : price,
				'data-modelqty' : "1",
				'data-modelcurrency': navPriceCurrency,
				'data-modelcode' : frontModel.modelCode,
				'data-modelname' : frontModel.modelName,
				'data-modeldisplay' : escapeHtml(frontModel.displayName.replace(/<br>/ig," ").replace(/<sup>/ig," ")),
				'data-discountprice' : discountPrice
			});
		}
		
		if(frontModel.ctaTypeUpperCase === ""){
			navBtn.attr({
				'an-tr' : 'pdd01_anchor nav-' + navPageTrack + '-cta-buy page',
				'an-ca' : 'buy cta',
				'an-ac' : 'buy now',
				'an-la' : 'buy now'
			});
		}else{
			if(frontModel.ctaTypeUpperCase === "PREORDER"){
				navBtn.attr({
					'an-tr' : 'pdd01_anchor nav-' + navPageTrack + '-cta-buy page',
					'an-ca' : 'buy cta',
					'an-ac' : 'pre-order',
					'an-la' : 'pre-order'
				});
			}else{
				navBtn.attr({
					'an-tr' : 'pdd01_anchor nav-' + navPageTrack + '-cta-buy page',
					'an-ca' : 'buy cta',
					'an-ac' : 'buy now',
					'an-la' : 'buy now'
				});
			}
		}
	}
	
	function setLeasingInfoData(product){
		let priceArea = "";
		let monthlyArea = "";
		if( product && product.length > 0 ){
			const leasingItem = product[0];
			let monthlyPrice = leasingItem.monthly;
			let tenureVal = leasingItem.months;
			
			let useMonthlyPrice = isNotNull(monthlyPrice) && isNotNull(tenureVal);
			let salePrice = $(".pd-buying-price__new-price").data("promotionprice");
			let orignalPrice = $(".pd-buying-price__was").data("price");
			
			if(!isNotNull(orignalPrice)){
				orignalPrice = salePrice;
			}
			
			let savePrice = parseFloat(orignalPrice) - parseFloat(salePrice);
			
			//   
			$(".pd-buying-price__wrap").empty();
			
			if(useMonthlyPrice){
				if(navSiteCode === "hk") {
					monthlyArea += 
						Granite.I18n.get("From {0}/mo",[currencyComma(monthlyPrice, navPriceCurrency)])+
						' '+
						currencyComma(salePrice, navPriceCurrency)+
						' '+
						Granite.I18n.get("for {0} mos",[tenureVal]);
				} else if(navSiteCode === "my" || navSiteCode === "ro") {
					monthlyArea += 
						Granite.I18n.get("From {0}/mo",[currencyComma(monthlyPrice, navPriceCurrency)])+
						' '+
						Granite.I18n.get("or")+
						' ';
				} else if(isMonthlySENA === true) {
					monthlyArea += 
						' '+
						Granite.I18n.get("or")+
						' '+
						Granite.I18n.get("From {0}/mo",[currencyComma(monthlyPrice, navPriceCurrency)])+
						' '+
						Granite.I18n.get("for {0} mos",[tenureVal])+
						' ';
				} else {
					// 
					monthlyArea += 
						Granite.I18n.get("From {0}/mo",[currencyComma(monthlyPrice, navPriceCurrency)])+
						' '+
						Granite.I18n.get("for {0} mos",[tenureVal])+
						' '+
						Granite.I18n.get("or")+
						' ';
				}
			}
				
			if(savePrice !== 0){
				if(navSiteCode === "ru") {
					priceArea += 
					'<div class="pd-buying-price__new-price no-max-width" data-promotionprice="'+salePrice+'">'+ monthlyArea + currencyComma(salePrice, navPriceCurrency) +'</div>';
				}else if(navSiteCode === "hk") {
					priceArea += 
						'<div class="pd-buying-price__new-price" data-promotionprice="'+salePrice+'">'+ monthlyArea +'</div>';
				}else if(isMonthlySENA === true) {
					//CRHQ-8511 [B2C] SENA    
					//   
					priceArea += 
						'<div class="pd-buying-price__new-price" data-promotionprice="'+salePrice+'">'+ currencyComma(salePrice, navPriceCurrency) + monthlyArea +'</div>';
				}else{
					priceArea += 
					'<div class="pd-buying-price__new-price" data-promotionprice="'+salePrice+'">'+ monthlyArea + currencyComma(salePrice, navPriceCurrency) +'</div>';
				}
				priceArea += 
					'<div class="pd-buying-price__box">';
				
				if(navSiteCode === "in") {
					priceArea += 
						'<div class="pd-buying-price__tax">MRP (Inclusive of all taxes)</div>';
				}
				priceArea += 
					'<div class="pd-buying-price__was" data-price="'+orignalPrice+'">'+ 
					'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>';
				if(navSiteCode === "jp") {
					priceArea +=
						'(:'+currencyComma(orignalPrice, navPriceCurrency)+')'; //sample (:33,583)
				} else {
					//it  save  %(<del>(lowestWasPrice)</del>) currencyComma(orignalPrice, navPriceCurrency)+'</del>';
					}
				}
				priceArea +=
					'</div>';
				
				if(navSiteCode === "it") {
					//Granite.I18n.get("Save the {0}%",getDiscountRate(savePrice, orignalPrice) + '(<del>'+currencyComma(orignalPrice, priceCurrency)+'</del>)';
					priceArea +=
						'<div class="pd-buying-price__save">' + Granite.I18n.get("Save the {0}%",getDiscountRate(savePrice, orignalPrice)) + '(<del>'+currencyComma(orignalPrice, navPriceCurrency)+'</del>)</div>';
				} else {
					//  
					priceArea +=
						'<div class="pd-buying-price__save">' + Granite.I18n.get("Save {0}", [currencyComma(savePrice, navPriceCurrency)]) + '</div>';
				}
				if(navSiteCode === "pe" || navSiteCode === "cl" || navSiteCode === "mx" || navSiteCode === "co") {
					priceArea +='<div class="pd-buying-price__disclaimer">*Aplican condiciones</div>';
				}
				priceArea +=
						'</div>';
			}else{
				if(navSiteCode === "ru") {
					priceArea += '<div class="pd-buying-price__new-price no-max-width" data-promotionprice="'+salePrice+'">'+ monthlyArea + currencyComma(salePrice, navPriceCurrency) +'</div>';
				} else if(navSiteCode === "hk") {
					priceArea += '<div class="pd-buying-price__new-price" data-promotionprice="'+salePrice+'">'+ monthlyArea + '</div>';
				}else{
					priceArea += '<div class="pd-buying-price__new-price" data-promotionprice="'+salePrice+'">'+ monthlyArea + currencyComma(salePrice, navPriceCurrency) +'</div>';
				}
			}
			
			$(".pd-buying-price__wrap").html(priceArea);
		}
	}
	
	function hybrisBuildPriceArea(product){
		let orignalPrice = isNotNull(product.price) ? product.price : '' ;
		let salePrice = isNotNull(product.promotionPrice) ? product.promotionPrice : '';
		let formattedPrice = isNotNull(product.priceFormatted) ? product.priceFormatted : '';
		let promotionPriceFormatted = isNotNull(product.promotionPriceFormatted) ? product.promotionPriceFormatted : '';
		let stockLevelStatus = isNotNull(product.stockLevelStatus) ? product.stockLevelStatus.toUpperCase() : '';
		let lowestWasPrice = isNotNull(product.lowestWasPrice) ? product.lowestWasPrice.value : '' ; //it   
		let salePriceFormatted = "";
		
		//23.06.28 &EPPONLY [Feature PD] hybris lowestWasPrice   (NOTICE : 202307 isEPP &&   . )
		if( isNewElementLowestWasPrice ){
			if ( isNotNull(product.lowestWasPrice) ){
				const lowestWasPriceValue = product.lowestWasPrice.value;
				if ( isNotNull(product.promotionPrice) && lowestWasPriceValue <= product.price && product.promotionPrice < lowealue;
					formattedPrice = currencyComma(orignalPrice, navPriceCurrency);
				}
			}
		}
		
		let usePriceArea = false;
		if(stockLevelStatus !== "NOORDER"){
			usePriceArea = true;
			hybrisSetAttr(product);
		}
		
		if( product.apiType === "realtime" ){
			orignalPrice = deleteCurrency(product.price, navPriceCurrency).trim();
			salePrice = deleteCurrency(product.promotionPrice, navPriceCurrency).trim();
		}
		
		//TRADEIN_TEXT   TRADEIN_TEXT     
		if( navIsHybrisIntg && isNotNull(product.aemAdditionalInfoTypes) && product.aemAdditionalInfoTypes.length > 0 ){
			const aemAdditionalInfoTypes = product.aemAdditionalInfoTypes;
			for( var addIndex in aemAdditionalInfoTypes ){
				const addItem = aemAdditionalInfoTypes[addIndex];
				if( addItem.type === 'TRADEIN' && isNotNull(addItem.aemAdditionalInfos) && addItem.aemAdditionalInfos.length > 0 ){
					for( var itemIndex in addItem.aemAdditionalInfos ){
						const infosItem = addItem.aemAdditionalInfos[itemIndex];
						if( infosItem.key === 'TRADEIN_TEXT' && isNotNull(infosItem.value)){
							salePriceFormatted = infosItem.value;
						}
					}
				}
			}
		}
		
		if(salePrice === ""){
			salePrice = orignalPrice;
		}
		
		if(salePriceFormatted !== ""){
			salePrice = salePriceFormatted;
		}
		
		let priceArea = "";
		if(usePriceArea){
			let savePrice = parseFloat(orignalPrice) - parseFloat(salePrice);
			//&EPP isNewElementLowestWasPrice  save price  
			if( $('#isEppPage').val() === 'true' && isNewElementLowestWasPrice ){
				savePrice = 0;
			}			
			if(savePrice !== 0){
				if(navSiteCode === "ru") {
					priceArea += 
						'<div class="pd-buying-price__new-price no-max-width" data-promotionprice="'+salePrice+'">'+ (promotionPriceFormatted !== "" ? promotionPriceFormatted : currencyComma(salePrice, navPriceCurrency))  +'</div>';
				}else{
					priceArea += 
						'<div class="pd-buying-price__new-price" data-promotionprice="'+salePrice+'">'+ (promotionPriceFormatted !== "" ? promotionPriceFormatted : currencyComma(salePrice, navPriceCurrency))  +'</div>';
				}
				priceArea +=
						'<div class="pd-buying-price__box">';
				if(navSiteCode === "in") {
					priceArea += 
						'<div class="pd-buying-price__tax">MRP (Inclusive of all taxes)</div>';
				}
				
				if(navSiteCode === "jp") {
					priceArea +=
						'<div class="pd-buying-price__save">' + Granite.I18n.get("Save {0}", [currencyComma(savePrice, navPriceCurrency)]) + '</div>';
					priceArea +=
						'<div class="pd-buying-price__was" data-price="'+product.price+'">'+ 
						'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>';	
					priceArea +=
						'( : '+(formattedPrice !== "" ? formattedPrice : currencyComma(orignalPrice, navPriceCurrency))+')'; //sample (:33,583)
					priceArea +=
						'</div>';
				} else {
					if(navSiteCode === "it") {
						priceArea +=
							'<div class="pd-buying-price__was" data-price="'+orignalPrice+'">'+ 
							'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>';
					} else {
						// 
						priceArea +=
							'<div class="pd-buying-price__was" data-price="'+product.price+'">'+ 
							'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>';
					}
					priceArea +=
						'<del>'+(formattedPrice !== "" ? formattedPrice : currencyComma(orignalPrice, navPriceCurrency))+'</del>';
					priceArea +=
						'</div>'+
						'<div class="pd-buying-price__save">' + Granite.I18n.get("Save {0}", [currencyComma(savePrice, navPriceCurrency)]) + '</div>';
				}
				
				if(navSiteCode === "pe" || navSiteCode === "cl" || navSiteCode === "mx" || navSiteCode === "co") {
					priceArea +='<div class="pd-buying-price__disclaimer">*Aplican condiciones</div>';
				}
				priceArea +=
					'</div>';
			}else{ea += '<div class="pd-buying-price__new-price no-max-width" data-promotionprice="'+salePrice+'">'+ (promotionPriceFormatted !== "" ? promotionPriceFormatted : currencyComma(salePrice, navPriceCurrency))  +'</div>';
				}else{
					priceArea += '<div class="pd-buying-price__new-price" data-promotionprice="'+salePrice+'">'+ (promotionPriceFormatted !== "" ? promotionPriceFormatted : currencyComma(salePrice, navPriceCurrency))  +'</div>';
				}
			}
		}
		
		if(priceArea !== ""){
			$(".pd-buying-price__wrap").append(priceArea);
		}
	}
	
	/**
	 * Price 
	 * 
	 * Global - monthlyPriceInfo, priceDisplay, formattedPriceSave
	 * Hybris-Intg - monthlyPriceInfo, priceDisplay, promotionPriceDisplay, price, promotionPrice, tradeInPriceText
	 * GPv2 - leasingInfo, priceDisplay, promotionPriceDisplay, listPriceDisplay, price. promotionPrice, listPrice
	 *
	 */
	function buildPriceArea(product, upperStock){
		let priceTemplate = "";
		let frontModel = product.modelList[0];
		let priceDisplay = frontModel.priceDisplay;
		
		if((navSiteCode === "nl" || navSiteCode === "be" || navSiteCode === "be_fr") && isNotNull(priceDisplay)){
			priceDisplay = deleteCurrency(priceDisplay, navPriceCurrency);
		}
		
		let usePriceArea = false;
		if(navPriceDisplay		/* pl  Out Of Stock   */
			usePriceArea = true;
		}
		
		//Hybris Intg > tradeIn price text 
		let useTradeInPrice = false;
		let tradeInPriceText = "";
		if(navIsHybrisIntg && isNotNull(frontModel.tradeInPriceText)) {
			tradeInPriceText = frontModel.tradeInPriceText;
			useTradeInPrice = true;
		}
		
		if(usePriceArea){
			let promotionDisplay = "";
			let currentDisplay = priceDisplay;
			let monthlyPrice = "";
			let tenureVal = "";
			let saveHtml = "";
			
			let leasingInterest = "";
			let downPaymentFormatted = "";
			let tenureUnit = "";
			let monthlyRate = "";
			
			let useMonthlyPrice = false;
			let useLeasingInfo = false;
			//new-hybris			
			if(navIsGPv2 || navIsHybrisNew){
				if(isNotNull(frontModel.leasingInfo) && navSiteCode === "nl" && frontModel.upgrade === "Y"){
					// nl  leasingInfo 
					let leasingInfo = frontModel.leasingInfo;
					monthlyRate = deleteCurrency(leasingInfo.monthlyRate, navPriceCurrency);
					tenureVal = leasingInfo.tenureVal;
					downPaymentFormatted = deleteCurrency(leasingInfo.downPaymentFormatted, navPriceCurrency);
					tenureUnit = leasingInfo.tenureUnit;
					
					useLeasingInfo = true;
					
				}else if(isNotNull(frontModel.monthlyPriceInfo) 
						&& isNotNull(frontModel.monthlyPriceInfo.leasingMonthly) && isNotNull(frontModel.monthlyPriceInfo.leasingMonths) && isNotNull(frontModel.monthlyPriceInfo.interest)){
					let monthlyPriceInfo = frontModel.monthlyPriceInfo;
					monthlyPrice = currencyComma(monthlyPriceInfo.leasingMonthly, navPriceCurrency);
					tenureVal = monthlyPriceInfo.leasingMonths;
					leasingInterest = monthlyPriceInfo.interest;
					//pe cl    (ro "CRHQ-8405 [B2C] RO - PD  monthly price   "    )
					if(navSiteCode === "pe" || navSiteCode === "cl" || navSiteCode === "mx" || navSiteCode === "co" || navSiteCode === "ro") {
						leasingInterest="";
					}
					useMonthlyPrice = true;
				}
				
				promotionDisplay = frontModel.promotionPriceDisplay;
				if(navSiteCode === "be" || navSiteCode === "be_fr" || navSiteCode === "nl"){
					promotionDisplay = frontModel.promotionPrice;
					promotionDisplay = currencyComma(promotionDisplay, navPriceCurrency);
				}
			} else {
				if(isNotNull(frontModel.monthlyPriceInfo) &&
						isNotNull(frontModel.monthlyPriceInfo.leasingMonthly) && isNotNull(frontModel.monthlyPriceInfo.leasingMonths) && 
						(navSiteCode === "au" || navSiteCode === "nz" || navSiteCode === "ae" || navSiteCode === "my" || navSiteCode === "sg" || navSiteCode === "ca" || navSiteCode === "ca_fr" || 
						navSiteCode === "it" || navSiteCode === "se" || navSiteCode === "dk" || navSiteCode === "fi" || navSiteCode === "no" || navSiteCode === "es" || navSiteCode === "pt" || 
						navSiteCode === "th" || navSiteCode === "tw" || navSiteCode === "ru" || navSiteCode === "ch" || navSiteCode === "ch_fr")){
					let monthlyPriceInfo = frontModel.monthlyPriceInfo;
					monthlyPrice = currencyComma(monthlyPriceInfo.leasingMonthly, navPriceCurrency);
					tenureVal = monthlyPriceInfo.leasingMonths;
					
					useMonthlyPrice = true;
				}
				if(navIsHybrisIntg){
					promotionDisplay = frontModel.promotionPriceDisplay;
				}
			}
			
			if(isNotNull(promotionDisplay)){
				currentDisplay = promotionDisplay;
			}
			
			//GPv2  new hybris old hybris  
			if(navShopIntegeration === 'Hybris-new' || navShopIntegeration === 'Hybris-intg' || navShopIntegeration === 'Hybris') {
				if(isNotNull(promotionDisplay)){
					//    lowestWasPrice  promotionPrice
					if(isNewElementLowestWasPrice && isNotNull(frontModel.lowestWasPrice) && isNotNull(frontModel.promotionPrice)
						&& (parseFloat(frontModel.lowestWasPrice) <= parseFloat(frontModel.price) && parseFloat(frontModel.promotionPrice) < parseFloat(frontModel.lowestWasPrice))
						){
						
						frontModel.lowestWasPriceUseYn = "Y";
						frontModel.price = frontModel.lowestWasPrice;
						frontModel.priceDisplay = currencyComma(frontModel.lowestWasPrice, navPriceCurrency);
						isNewElementLowestWasPriceSetting  = true;
						priceDisplay = frontModel.priceDisplay;
					}
				} else if(isNotNull(priceDisplay)) {
					//priceDisplay        
					frontModel.lowestWasPriceUseYn = "N";
					//    lowestWasPrice  promotionPrice
					if(isNewElementLowestWasPrice && isNotNull(frontModel.lowestWasPrice) && isNotNull(frontModel.pr						){
							
							frontModel.lowestWasPriceUseYn = "Y";
							frontModel.price = frontModel.lowestWasPrice;
							frontModel.priceDisplay = currencyComma(frontModel.lowestWasPrice, navPriceCurrency);
							isNewElementLowestWasPriceSetting  = true;
							priceDisplay = frontModel.priceDisplay;
					}
				}
			}
			
			//HybrisIntg - save  
			//new-hybris
			if(navIsGPv2 || navIsHybrisNew){
				//saveHtml 
				if(isNotNull(promotionDisplay)){
					let listPrice = 0;
					if(frontModel.listPrice !== null){
						listPrice = parseFloat(frontModel.listPrice) - parseFloat(frontModel.price);
					}
					
					let savePrice = parseFloat(frontModel.price) - parseFloat(frontModel.promotionPrice);
					
					//lowestWasPrice   
					if(isNewElementLowestWasPrice && isNewElementLowestWasPriceSetting) {
						frontModel.saveText = savePrice;
					}
					//lowestWasPrice     :: pl  
					if(isNewElementLowestWasPrice && !isNewElementLowestWasPriceSetting) {
						savePrice = 0;
						frontModel.saveText = null;
					}
					
					if(savePrice !== 0 && isNotNull(frontModel.saveText)){
						//  de  (    )
						if($('#isEppPage').val() !== 'true' && navSiteCode === "ro") {
							priceDisplay= Granite.I18n.get("RRP {0}", [priceDisplay]); //'PR ' + priceDisplay
						}

						let saveText = frontModel.saveText;
						if(navSiteCode === "nl" || navSiteCode === "be" || navSiteCode === "be_fr" || navSiteCode === "de"){
							/* SEBN, DE    From  */
							saveHtml += 
								'<div class="pd-buying-price__was"><span class="hidden">' +Granite.I18n.get("Original Price")+ ': </span>' + Granite.I18n.get("From {0}",['<del>'+priceDisplay+'</del>']) + '</div>';
						}else{
							if(navSiteCode === "in") {
								saveHtml += 
									'<div class="pd-buying-price__tax">MRP (Inclusive of all taxes)</div>';
							}
							if(navSiteCode === "pl" && isNewElementLowestWasPriceSetting) {
								saveHtml += 
									'<div class="pd-buying-price__label">'+Granite.I18n.get("Lowest price 30 days before the discount:")+'</div>';
							}
							//only co (TODO : vatEligible  true   )
							if(navSiteCode === "co" && frontModel.vatEligible && fpd-buying-price   pd-buying-price--samcol-only  
								$('.pd-buying-price').addClass('pd-buying-price--samcol-only');
								//pd-buying-price__new-price   pd-buying-price__new-price--samcol  
								$('.pd-buying-price__new-price').addClass('pd-buying-price__new-price--samcol');
								
								//saveHtml +=
								//		'<div class="pd-buying-price__samcol-main"><strong>' +Granite.I18n.get("Price without VAT")+ ':</strong><strong> '+frontModel.vatFreePriceDisplay+'</strong></div>'+
								//		'<div class="pd-buying-price__samcol-special"><strong>' +Granite.I18n.get("Price with discount")+ '</strong><strong> D$7.999.00</strong></div>'+
								//		'<div class="pd-buying-price__samcol-rrp"><span>' +Granite.I18n.get("Price before")+ ':</span><del> ' + priceDisplay + '</del></div>';
								//saveHtml += 
								//	'<div class="pd-buying-price__was 1005"><span class="hidden">' +Granite.I18n.get("Original Price")+ ': </span><del>' + priceDisplay + '</del></div>';
							} else {
								if($('#isEppPage').val() !== 'true' && navSiteCode === "ro") {
									//ro 
									saveHtml += 
										'<div class="pd-buying-price__was"><span class="hidden">' +Granite.I18n.get("Original Price")+ ': </span>' + priceDisplay + '</div>';
								} else {
									//
									saveHtml += 
										'<div class="pd-buying-price__was"><span class="hidden">' +Granite.I18n.get("Original Price")+ ': </span><del>' + priceDisplay + '</del></div>';
								}
							}
						}
			e  true   . Save       )
							if(navSiteCode === "co" && frontModel.vatEligible && frontModel.vatEligible === "true") {
								//NOTICE : vatEligible === true  vatFreePrice   save  
								//saveHtml +=
								//'<div class="pd-buying-price__save">'+
								//	Granite.I18n.get("Save {0}", [currencyComma(saveText, navPriceCurrency)])+
								//'</div>';
							} else {
								//  
								/* GPv2  save  
								 * SEBN  save    */
								saveHtml +=
								'<div class="pd-buying-price__save">'+
									Granite.I18n.get("Save {0}", [currencyComma(saveText, navPriceCurrency)])+
								'</div>';								
							}
						}
					} else if(listPrice > 0 && (navSiteCode === "nl" || navSiteCode === "be" || navSiteCode === "be_fr")){
						saveHtml += 
							'<div class="pd-buying-price__price">'+
								Granite.I18n.get("Listprice")+' '+
								currencyComma(frontModel.listPrice, navPriceCurrency)+
							'</div>';
					}
					//COMP6FE-1599 [EPP] SEPOL MSRP Price  : && !(isEPP && navSiteCode === "pl") 
                    if ($('#isEppPage').val() === 'true' && navSiteCode === "pl") {
                    	let msrpPrice = '';
                    	if ( isNotNull(frontModel.msrpPrice) ){
                    		msrpPrice = ' ' + currencyComma(frontModel.msrpPrice, navPriceCurrency);
                    		priceTemplate += '<p class="pd-buying-price__advice-price">' + Granite.I18n.get("Listprice") + msrpPrice + '</p>';
                    	}                    	
                    }					
				}
			}else if(!navIsHybrisIntg){
				//global
				if(isNotNull(frontModel.formattedPriceSave)){
					saveHtml = frontModel.formattedPriceSave;
				}
			}
			//price area build
			if((upperStock === "NOORDER" || upperStock === "LEARNMORE") && 
					(navSiteCode === "nl" || navSiteCode === "be" || navSiteCode === "be_fr")){
				priceTemplate +=
					'<div class="pd-buying-price__new-price">'+
						priceDisplay+
					'</div>';
			} else if(((navIsGPv2 || navIsHybrisNew) && upperStock !== "LEARNMORE" && upperStock !== "NOORDER") || 
					(!(navIsGPv2 || navIsHybrisNew) && upperStock !== "LEARNMORE")){
				if(useTradeInPrice){
					priceTemplate +=
						'<div class="pd-buying-price__text">'+
							'<p class="pd-buying-price__text-lease">'+tradeInPriceText+'</p>'+
						'</div>';
				}else if(useMonthlyPrice){
					priceTemplate +=
						'<div class="pd-buying-price__new-price">';
							if(navSiteCode=="id"){
								priceTemplate += Granite.I18n.get("pd From {0}/mo",[monthlyPrice])+' ';
							}else{
								priceTemplate += Granite.I18n.get("From {0}/mo",[monthlyPrice])+' ';
							}
							if(leasingInterest !== ""){
								priceTemplate += Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, leasingInterest]);
							} else {
								//my, ro  ( )
								if(navSiteCode!="my" && navSiteCode!="ro"){
									priceTemplate += Granite.I18n.get("for {0} mos",[tenureVal]);
								}
							}
							if(navSiteCode=="my"){
								priceTemplate += Granite.I18n.get("or") + ' ' + currentDisplay+'</div>';
							} else if(navSiteCode!="my"){
								// 
								priceTemplate += ' ' + Granite.I18n.get("or") + ' ' + currentDisplay+'</div>';
							}
							
						//'</div>';
				}else if(useLeasingInfo){
					if(downPaymentFormatted !== "" && tenureUnit !== "" && tenureVal !== "" && monthlyRate !== ""){
						let leasingText = " " + downPaymentFormatted + " + " + 
						tenureVal + " x " +
						monthlyRate + "/" + 
						Granite.I18n.get(tenureUnit);
						
						priceTemplate +=
							'<div class="pd-buying-price__new-price">'+
								currentDisplay+ ' ' +
								Granite.I18n.get("or")+
								leasingText+
							'</div>';
					}
				}else {
					if(navSiteCode === "co" && frontModel.vatEligible && frontModel.vatEligible === "true") {
						
						priceTemplate += 
							'<div class="pd-buying-price__new-price pd-buying-price__new-price--samcol">'+
							'	<div class="pd-buying-price__samcol-main"><strong>' +Granite.I18n.get("Price without VAT")+ ':</strong><strong> '+frontModel.vatFreePriceDisplay+'</strong></div>';
						if(currentDisplay) {
							priceTemplate += '	<div class="pd-buying-price__samcol-special"><strong>' +Granite.I18n.get("Price with discount")+ '</strong><strong> '+currentDisplay+'</strong></div>'; 
						}
						priceTemplate += 
							'	<div class="pd-buying-price__samcol-rrp"><span>' +Granite.I18n.get("Price before")+ ':</span><del> ' + priceDisplay + '</del></div>'+
							'</div>';
					} else{
						// 
						priceTemplate +=
							'<div class="pd-buying-price__new-price">'+
								currentDisplay+
							'</div>';
					}

				}
				//Save Text 
				priceTemplate += 
						'<div class="pd-buying-price__box">';
				//COMP6FE-1599 [EPP] SEPOL MSRP Price  : && !(isEPP && navSiteCode === "pl") 					
				if(isNotNull(saveHtml) && !($('#isEppPage').val() === 'true' && navSiteCode === "pl")){
					priceTemplate +=
							saveHtml;
				}
				if(navSiteCode === "pe" || navSiteCode === "cl" || navSiteCode === "mx" || navSiteCode === "co") {
					priceTemplate +='<div class="pd-buying-price__disclaimer">*Aplican condiciones</div><!-- 1114 -->';
				}
				priceTemplate +=
						'</div>';
			}
			
			if(priceTemplate !== ""){
				$(".pd-buying-price__wrap").append(priceTemplate);
			}
			//CRHQ-8349 [B2C] PD navigation     
			if($(".pd-buying-price__wrap .pd-buying-price__new-price").text()){
				$(".pd-buying-price__wrap .pd-buying-price__new-price").html($(".pd-buying-price__wrap .pd-buying-price__new-price").text().replace(currentDisplay, '<span class="pd-buying-price__new-price-currency">'+currentDisplay+'</span>'));
			}
		}
	}
	
	function ctaBtnDefualtSetting(){
		let currentUrl = window.location.origin + window.location.pathname.replace(".html", "/");
		let modelCd = $("#modelCode").val();
		let modelNm = $("#modelName").val();
		let modelDisplayNm = $("#navDisplayName").val();
		let wtbUseFlag = $("#wtbUseYn").val();
		let url = currentUrl + "buy/";
		
		//epp  
		url = getEppBuyUrl ( modelCd, url );
		
		const tempTitle = $('#tempTitle').val();
		const configuratorUrl = $("#navConfiguratorUrl").val();
		const ctaLocalText = $("#navCtaLocalText").val();
		const ctaEngText = $("#navCtaEngText").val();
		const configuratorUseYn = $("#navConfiguratorUseYn").val();
		if( configuratorUseYn === 'Y' && configuratorUrl !== '' && configuratorUrl !== null ){
			url = configuratorUrl;
		}
		
		if(wtbUseFlag === "Y"){
			if(navSiteCode !== "pl"){
				$("#anchorWtb").show();
				$("#anchorWtb").css("margin-left", "");
			}
		}
		
		navBtn.attr({
			'href' : url,
			'data-pimsubtype' : "",
			'data-pvitype' : "",
			'data-pvisubtype' : "",
			'data-modelrevenue' : "",
			'data-modelprice' : "",
			'data-modelqty' : "1",
			'data-modelcurrency': navPriceCurrency,
			'data-modelcode' : modelCd,
			'data-modelname' : modelNm,
			'data-modeldisplay' : escapeHtml(modelDisplayNm.replace(/<br>/ig," ").replace(/<sup>/ig," ")),
			'data-discountprice' : ""
		});
		
		if( configuratorUseYn === 'Y' ){
			if( tempTitle === 'page-feature-pd' ){
				if( configuratorUrl === '' || configuratorUrl === null ){
					$('.pd-buying-price__cta a').addClass('cta--disabled');
				}
				if( ctaLocalText !== '' && ctaLocalText !== null ){
					getI18n(ctaLocalText);
				}
				if( ctaEngText !== '' && ctaEngText !== null ){
					$('.pd-buying-price__cta a').attr('an-ac', ctaEngText).attr('an-la', ctaEngText);
				}
			}
		}else{
			getI18n("BUY NOW_FEATURE");
		}
	}
	
	function navGetCTAForGlobal(product){
		let frontModel = product.modelList[0];
		
		let useConfiguratorUrl = false;
		if(isNotNull(frontModel.configuratorUrl)){
			useConfiguratorUrl = true;
		}
		
		if(isNonShop){
			setAttr(product, true);
			getI18n("BUY NOW_FEATURE");
		}else {
			if(frontModel.ctaTypeUpperCase === "WHERETOBUY"){
				/* whereToBuy  */
				if(useConfiguratorUrl){
					setAttr(product, false);
					getI18n("BUY NOW_FEATURE");
				}else{
					setAttr(product, true);
					getI18n("BUY NOW_FEATURE");
				}
			}else if(frontModel.ctaTypeUpperCase === "BUYNOWLINK"){
				/* buyNowLink  */
				setAttr(product, true);
				getI18n(frontModel.ctaTitle);
			}else if(frontModel.ctaTypeUpperCase === "PREORDER"){
				/* preOrder  */
				if(useConfiguratorUrl){
					setAttr(product, false);
					getI18n("pre order");
				}else{
					setAttr(product, true);
					getI18n("pre order");
				}
			}else if(frontModel.ctaTypeUpperCase === "OUTOFSTOCK"){
				if(useConfiguratorUrl){
					setAttr(product, false);
					getI18n("BUY NOW_FEATURE");
				}else{
					setAttr(product, true);
					getI18n("BUY NOW_FEATURE");
				}
			}else{
				setAttr(product, true);
				getI18n("BUY NOW_FEATURE");
			}
		}

	}
	
	function navGetCTAForHybrisIntg(product){
		let frontModel = product.modelList[0];
		
		let useConfiguratorUrl = false;
		if(isNotNull(frontModel.configuratorUrl)){
			useConfiguratorUrl = true;
		}
		
		if(frontModel.ctaTypeUpperCase === "WHERETOBUY"){
			/* whereToBuy  */
			if(useConfiguratorUrl){
				setAttr(product, false);
				getI18n("BUY NOW_FEATURE");
			}else{
				setAttr(product, true);
				getI18n("BUY NOW_FEATURE");
			}
		}else if(frontModel.ctaTypeUpperCase === "BUYNOWLINK"){
			/* buyNowLink  */
			setAttr(product, true);
			getI18n(frontModel.ctaTitle);
		}else if(frontModel.ctaTypeUpperCase === "PREORDER"){
			/* preOrder  */
			if(useConfiguratorUrl){
				setAttr(product, false);
				getI18n("pre order");
			}else{
				setAttr(product, true);
				getI18n("pre order");
			}
		}else if(frontModel.ctaTypeUpperCase === "OUTOFSTOCK"){
			if(useConfiguratorUrl){
				setAttr(product, false);
				getI18n("BUY NOW_FEATURE");
			}else{
				setAttr(product, true);
				getI18n("BUY NOW_FEATURE");
			}
		}else{
			setAttr(product, true);
			getI18n("BUY NOW_FEATURE");
		}
		
	}
	
	function navGetCTAForGPv2(product){
		let frontModel = product.modelList[0];
		
		let useConfiguratorUrl = false;
		if(isNotNull(frontModel.configuratorUrl)){
			useConfiguratorUrl = true;
		}
		
		// us Buying Configurator 
		if(navSiteCode==="us" && fnIsNull(frontModel.buyingConfigLink)){
			useConfiguratorUrl = true;
			frontModel.configuratorUrl = frontModel.buyingConfigLink;
		}
		
		//GPv2   , BUY NOW_FEATURE CTA  .
		let priceDisplayNull = false; 
		if((fnIsNull(frontModel.priceDisplay)) &&
			(fnIsNull(frontModel.promotionPriceDisplay))){
			priceDisplayNull = true;
		}
		
		if(frontModel.wtbUseFlag === "Y"){
			if(navSiteCode !== "pl"){
				$("#anchorWtb").show();
				$("#anchorWtb").css("margin-left", "");
			}
		}
		
		if(priceDisplayNull){
			setAttr(product, true);
			getI18n("BUY NOW_FEATURE");
		}else{
			if((frontModel.ctaTypeUpperCase === "INSTOCK" || frontModel.ctaTypeUpperCase === "BACKORDERED" || frontModel.ctaTypeUpperCase === "PREORDER") && useConfiguratorUrl){
				setAttr(product, false);
				if(frontModel.ctaTypeUpperCase === "PREORDER"){
					/* preOrder  */
					getI18n("pre order");
				}else{
					getI18n("BUY NOW_FEATURE");
				}
			}else if((frontModel.ctaTypeUpperCase === "INSTOCK" || frontModel.ctaTypeUpperCase === "BACKORDERED" || frontModel.ctaTypeUpperCase === "PREORDER") && !useConfiguratorUrl){
				setAttr(product, true);
				if(frontModel.ctaTypeUpperCase === "PREORDER"){
					/* preOrder  */
					getI18n("pre order");
				}else{
					getI18n("BUY NOW_FEATURE");
				}
			}else if(frontModel.ctaTypeUpperCase === "OUTOFSTOCK" && useConfiguratorUrl){
				setAttr(product, false);
				getI18n("BUY NOW_FEATURE");
			}else if(frontModel.ctaTypeUpperCase === "OUTOFSTOCK" && !useConfiguratorUrl){
				setAttr(product, true);
				getI18n("BUY NOW_FEATURE");
			}else{
				setAttr(product, true);
				getI18n("BUY NOW_FEATURE");
			}
		}

	}
	
	/**
	 * Hybris shop API/ng/p4v1/getRealTimeProductSimpleInfo)  (price )
	 */
	function navGetHybrisRealTime(){
		if(shopSiteCd !== ''){
			navSiteCode = shopSiteCd;
		}
		
		// epp shop 
		const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : navSiteCode;
		
		
		let navRealTimeUrl = navStoreDomain + "/" + siteCodeWithEpp + "/ng/p4v1/getRealTimeProductSimpleInfo?productCode=" + navModelCode;
		if(navSiteCode === "py") {
			navRealTimeUrl = navStoreDomain + "/ng/p4v1/getRealTimeProductSimpleInfo?productCode=" + navModelCode;
		}
		
		if(navHybrisJsonYn === "Y") {
			$.ajax({
				url: navRealTimeUrl,
				type: "GET",
				dataType: 'json',
				cache:true,
				crossDomain : true,
				timeout : 10000,
				xhrFields: {withCredentials: true},
				success: function(data, responseText, jqXHR){
					realTimeInfoResponse(data);
				}
			});
		} else {
			$.ajax({
				url: navRealTimeUrl,
				type: "GET",
				dataType: 'jsonp',
				jsonpCallback:"jQuery1910499421933433041_1385598221584_0",
				cache:true,
				crossDomain : true,
				timeout : 10000,
				xhrFields: {withCredentials: true},
				success: function(data, responseText, jqXHR){
					realTimeInfoResponse(data);
				}
			});
		}
	}
	
	/**
	 * Hybris shop API(/servicesv2/getSimpleProductsInfo)  (price )
	 */
	function navGetHybris(){
		if(shopSiteCd !== ''){
			navSiteCode = shopSiteCd;
		}
		
		// epp shop 
		const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : navSiteCode;
		
		if(navHybrisJsonYn === 'Y') {
			$.ajax({
				url: navStoreDomain+"/"+siteCodeWithEpp+"/servicesv2/getSimpleProductsInfo?productCodes="+ navModelCode,
				type: "GET",
				dataType: 'json',
				cache:true,
				crossDomain : true,
				timeout : 10000,
				xhrFields: {withCredentials: true},
				success: function(data, responseText, jqXHR){
					simpleInfoResponse(data);
				}
			});
		} else {
			$.ajax({
				url: navStoreDomain+"/"+siteCodeWithEpp+"/servicesv2/getSimpleProductsInfo?productCodes="+ navModelCode,
				type: "GET",
				dataType: 'jsonp',
				jsonpCallback:"jQuery1910499421933433041_" + "111",
				cache:true,
				crossDomain : true,
				timeout : 10000,
				xhrFields: {withCredentials: true},
				success: function(data, responseText, jqXHR){
					simpleInfoResponse(data);
				}
			});
		}
	}
	
	function setGrprice(){
		$.ajax({
			headers : {
				"Cache-Control": "no-cache",
				"Content-Type": "application/json",
				"Access-Control-Allow-Origin" : "*"
			},
			url : 'https://shop.samsung.com/gr/products/' + navModelCode + '.json',
			type : "GET",
			dataType : "json",
			timeout : 10000,
			success : function (data) {
				if( data && data.price ){
					$(".pd-buying-price__wrap").append('<div class="pd-buying-price__new-price">' + data.price + '</div>');
				}
			}
		});
	}
	
	/**
	 * Hybris shop API(/ng/p4v1/getRealTimeProductSimpleInfo)   
	 */
	function realTimeInfoResponse(data) {
		if(data.resultCode === "0000" && navModelCode === data.code){
			data.apiType = "realtime";
			hybrisBuildPriceArea(data);
			window.sg.components.pdHeaderNavigation.reInit();
		}
	}
	
	/**
	 * Hybris shop API(/servicesv2/getSimpleProductsInfo)   
	 */
	function simpleInfoResponse(data) {
		let successFlag = false;
		if(data.resultCode === "0000" && data.productDatas.length > 0){
			$.each(data.productDatas,function(index, productData){
				if(navModelCode === productData.productCode && isNotNull(productData.price)){
					productData.apiType = "simple";
					hybrisBuildPriceArea(productData);
					getLeasingInfo();
					window.sg.components.pdHeaderNavigation.reInit();
					successFlag = true;
					return false;
				}
			});
		}
	}
	
	function getLeasingInfo(){
		// epp shop 
		const siteCodeWithEpp = $('#isEppPage').val() === 'true' ? $('#eppCompanyCode').val() : navSiteCode;
		var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};
		//[23.12.01] EPP(ae,ae_ar) leasingInfo API 
		let nocacheUrl = "";
		if ($('#isEppPage').val() === 'true' && (navSiteCode === "ae" || navSiteCode === "ae_ar")){
			nocacheUrl = "/nocache";
		}
		
		if(navHybrisJsonYn === 'Y') {
			$.ajax({
				url: navStoreDomain+"/"+siteCodeWithEpp+"/servicesv2" + nocacheUrl + "/leasingInfo?productCode="+ navModelCode,
				type: "GET",
				cache: true,
				crossDomain : true,
                xhrFields: _xhrFields,
				dataType: 'json',
				timeout: 20000,
				success: function(data){
					setLeasingInfoData(data);
				}
			}); 
		} else {
			$.ajax({
				url: navStoreDomain+"/"+siteCodeWithEpp+"/servicesv2" + nocacheUrl + "/leasingInfo?productCode="+ navModelCode,
				type: "GET",
				cache: true,
				crossDomain : true,
                xhrFields: _xhrFields,
				dataType: 'jsonp',
				jsonpCallback:"jQuery1910499421933433041_" + "171",  
				timeout: 20000,
				success: function(data){
					setLeasingInfoData(data);
				}
			});
		}
	}
	
	$(document).on("click", ".anchorBtn", function(){
		var configInfo = $(this).attr("config-url");
		var modelCode = $(this).attr("data-modelcode");
		
		if(isNotNull(configInfo)){
			$(this).attr("href", "javascript:;");
			var configuratorURL = configInfo + "?modelCode=" + modelCode;
			window.location.href = configuratorURL;
		}
	});
	
	//ePromoter chat
	if($('#isEppPage').val()){
		$(".pd-header-navigation__menu-epromoter-cta").hide();
	}
	$(document).on("click", ".pd-header-navigation__menu-epromoter-cta .cta", function(){
		window.sprChat('open');
	});
	
	//CRHQ-8407 [B2C] DE - Galaxy Book2 PD  CTA  
	if(navSiteCode === 'de' && $.inArray(navModelCode,removeCtaSkuArray) !== -1){
		window.onload = function(){
			navBtn.hide();
		}
	}
}(window, $));
;(function (win, $) {
	'use strict';

	if('undefined' === typeof win.smg) {
		win.smg = {};
	}

	if('undefined' === typeof win.smg.aem) {
		win.smg.aem = {};
	}

	if('undefined' === typeof win.smg.aem.components) {
		win.smg.aem.components = {};
	}

	if('undefined' === typeof win.smg.aem.components.product) {
		win.smg.aem.components.product = {};
	}

	var namespace = win.smg.aem.components.product;
	
	namespace.setRecent = (function() {
		var privateData = {
				familyCode : $("#familyCode").val(),
				modelCode : $("#modelCode").val(),
				tellsomeYn : $('#tellsomeYn').val()
		};
		var RECENT_MAX_SIZE = 6;
		
		return {
			init : function() {
				// recent list cookie  
				if(undefined !== privateData.familyCode && "" !== privateData.familyCode && undefined !== privateData.modelCode && "" !== privateData.modelCode && privateData.tellsomeYn !== 'Y') {
					this.setRecentCode(privateData, 30);
				}
			},
			//  
			getCookie : function(cname) {
				'use strict';
				var name = cname + '=',
					ca = document.cookie.split(';'),
					c;

				for(var i=0, leng=ca.length; i<leng; i++) {
					c = ca[i];
					while (c.charAt(0)===' ') {
						c = c.substring(1);
					}
					if (c.indexOf(name) !== -1) {
						return c.substring(name.length,c.length);
					}
				}
				return '';
			},

			//  
			getCookiePath : function() {
				'use strict';
				var path = location.pathname;
				var cookiePath;
				path = path.split('/');
				const isEPP = $('#isEppPage').val() === 'true'; // epp path company 

				if(path[1] === 'content') {
					if(isEPP){
						cookiePath = path[1] + '/' + path[2] + '/' + path[3] + '/' + path[4] + '/' + path[5];
					} else {
						cookiePath = path[1] + '/' + path[2] + '/' + path[3];
					}
				} else {
					if(isEPP){
						cookiePath = path[1] + '/' + path[2] + '/' + path[3];
					} else {
						cookiePath = path[1];
					}
				}
				return cookiePath;
			},

			//  
			setCookie : function(cname, cvalue, exdays, site_path) {
				'use strict';
				var d = new Date();
				d.setTime(d.getTime() + ((exdays || 0) * 24 * 60 * 60 * 1000));
				document.cookie = cname + '=' + cvalue + '; expires=' + d.toUTCString() + '; path=' + site_path;
			},

			//recently viewed code list 
			setRecentCode : function(param, expires){
				var cookieNm = 'recent_list';
				var cookieVal = this.getCookie( cookieNm );
				var cookiePath = this.getCookiePath();
				
				if('' === cookieVal || 'undefined' === cookieVal ) {
					cookieVal = [ param ];
				} else {
					cookieVal = JSON.parse(cookieVal);
					var isEqual = false;

					for(var i=0; i<cookieVal.length; i++) {
						if(cookieVal[i].familyCode === param.familyCode) {
							cookieVal.splice(i, 1);
							if(param.tellsomeYn !== 'Y') {
								cookieVal.push(param);
							}
							isEqual = true;
							break;
						}
					}

					if(!isEqual) {
						if(cookieVal.length >= RECENT_MAX_SIZE) {
							cookieVal.splice(0, 1);
						}
						cookieVal.push(param);
					}
				}
				cookieVal = JSON.stringify(cookieVal);
				this.setCookie( cookieNm, cookieVal, expires, '/' + cookiePath + '/');
			}
		};
	})();

	$(function() {
		namespace.setRecent.init();
	});
})(window, window.jQuery);
(() => {
  const $q = window.sg.common.$q;
  const utils = window.sg.common.utils;
  const lazyLoad = window.sg.common.lazyLoad;
  const scrollbar = window.sg.common.scrollbar;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const optionSelector = window.sg.common.OptionSelector;

  const selector = {
    component: '.accessories',
    cardComponent: '.accessories__item',
  };

  const el = {
    window: null,
    component: null,
  };

  class Accessories {
    constructor(component) {
      this.selector = {
        component: '.accessories',
        cardFiche: '.accessories__product-price-info',
        rating: '.accessories__rating',
        optionWrap: '.option-selector',
      };
    
      this.el = {
        component: $q(component),
      };

      this.handler = {
        setHeight: this.setHeight.bind(this),
      };

      Accessories.instances.set(component, this);

      this.init();
    }

    setElement() {
      this.el.cardSlide = this.el.component.find(selector.cardComponent);
      this.el.cardFiche = this.el.component.find(this.selector.cardFiche);
      this.el.rating = this.el.component.find(this.selector.rating);
      this.el.optionWrap = this.el.component.find(this.selector.optionWrap);
    }

    init() {
      this.setElement();

      this.setCardInstances();

      this.setHeight();

      this.bindEvents();
    }

    reInit() {
      this.init();
    }

    setDefault() {
      const defaultList = [this.el.rating, this.el.cardSlide, this.el.cardFiche, this.el.optionWrap];

      defaultList.forEach((item) => {
        item.css({
          'height': '',
        });
      });
    }

    setHeight() {
      const resizeList = BREAKPOINTS.MOBILE > utils.getViewPort().width ? [this.el.rating, this.el.cardSlide, this.el.cardFiche, this.el.optionWrap] : [this.el.rating, this.el.cardSlide, this.el.optionWrap];

      this.setDefault();

      resizeList.forEach((element) => {
        const cardArr = [];

        element.target.forEach((item) => {
          const $item = $q(item);
  
          if ($item.css('display') !== 'none') {
            cardArr.push($item.outerHeight());
          }
        });
  
        const maxHeight = Math.max.apply(null, cardArr);
  
        element.target.forEach((item) => {
          const $item = $q(item);
  
          if ($item.css('display') !== 'none') {
            $item.css({
              'height': `${maxHeight}px`,
            });
          }
        });
      });

      setTimeout(() => {
        this.el.component.find('.scrollbar').target.forEach((element) => {
          scrollbar.resize(element);
        });
      }, 30);
    }

    setCardInstances() {
      this.el.cardSlide.target.forEach((cardEl) => {
        if (!AccessoriesCard.instances.has(cardEl)) {
          new AccessoriesCard(cardEl);
        } else {
          const instances = AccessoriesCard.instances.get(cardEl);
          instances.reInit();
        }
      });
    }

    bindEvents() {
      $q(window).off('resize', this.handler.setHeight).on('resize', this.handler.setHeight);
    }
  }

  class AccessoriesCard {
    constructor(component) {
      this.selector = {
        cardComponent: '.accessories__item',
        optionSelector: '.option-selector__wrap',
        mobileOptionWrap: '.accessories__option-selector',
        mobileOptionColor: '.accessories__color-chip',
        mobileOptionCapacity: '.accessories__capacity',
      };

      this.el = {
        component: $q(component),
      };

      this.handler = {
        resize: this.resize.bind(this),
      };

      AccessoriesCard.instances.set(component, this);

      this.init();
    }

    setElement() {
      this.el.optionSelector = this.el.component.find(this.selector.optionSelector);
      this.el.mobileOptionWrap = this.el.component.find(this.selector.mobileOptionWrap);

      this.desktopFlag = false;
      this.mobileFlag = false;
      this.resizeFlag = false;
    }

    init() {
      this.setElement();

      this.resize();

      this.bindEvents();
    }

    reInit() {
      this.init();
    }

    setMobileOption() {
      this.el.mobileOptionWrap.target.forEach((item) => {
        const $item = $q(item);
        const $optionColor = $item.find(this.selector.mobileOptionColor);
        const $optionCapacity = $item.find(this.selector.mobileOptionCapacity);

        if ($optionColor.target.length) {
          if ($optionColor.find('.accessories__color').target.length > 5) {
            $optionColor.addClass('accessories__color-chip--over');
          } else {
            $optionColor.removeClass('accessories__color-chip--over');
          }
        }

        if ($optionCapacity.target.length) {
          if ($optionCapacity.width() > $item.width()) {
            $optionCapacity.addClass('accessories__capacity--over');
          } else {
            $optionCapacity.removeClass('accessories__capacity--over');
          }
        }
      });
    }

    resize() {
      if (BREAKPOINTS.MOBILE < utils.getViewPort().width) {
        if (this.desktopFlag === false) {
          this.desktopFlag = true;
          this.mobileFlag = false;
        }
      } else {
        if (this.mobileFlag === false) {
          this.desktopFlag = false;
          this.mobileFlag = true;

          if (this.resizeFlag === false) {
            this.setMobileOption();

            this.resizeFlag = true;
          }
        }
      } 
    }

    bindEvents() {
      $q(window).off('resize', this.handler.resize).on('resize', this.handler.resize);
    }
  }

  const init = () => {
    el.window = $q(window);
    el.component = $q(selector.component);

    if (!el.component.target.length) {
      return;
    }

    $q(selector.component).target.forEach((element) => {
      if (!Accessories.instances.has(element)) {
        new Accessories(element);
      }
    });
  };

  const reInit = () => {
    lazyLoad.setLazyLoad();

    $q(selector.component).target.forEach((element) => {
      $q(element).find('.scrollbar').target.forEach((scroll) => {
        scrollbar.reInit(scroll);
        scrollbar.resize(scroll);
      });

      $q(element).find('.option-selector').target.forEach((os) => {
        optionSelector.reInit($q(os));
      });

      if (!Accessories.instances.has(element)) {
        new Accessories(element);
      } else {
        const instances = Accessories.instances.get(element);
        instances.reInit();
      }
    });
  };

  const reInitItem = (item) => {
    lazyLoad.setLazyLoad();

    $q(item).target.forEach((element) => {
      $q(element).find('.option-selector').target.forEach((os) => {
        optionSelector.reInit($q(os));
      });

      if (!AccessoriesCard.instances.has(element)) {
        new AccessoriesCard(element);
      } else {
        const instances = AccessoriesCard.instances.get(element);
        instances.reInit();
      }
    });
  };

  Accessories.instances = new WeakMap();
  AccessoriesCard.instances = new WeakMap();

  $q.ready(init);

  window.sg.components.accessories = {
    init,
    reInit,
    reInitItem,
  };
})();

;(function (win, $) {
	'use strict';
	
	window.sg.components.dynamic = window.sg.components.dynamic || {};
	const dynamic = window.sg.components.dynamic;
	
	var accessoriesGrid = function() {
		var searchDomain = $('#searchDomain').val(),
			shopIntegrationFlag = $('#shopIntegrationFlag').val(),
			pageSiteCode = $('#siteCode').val(),
			apiStageInfo = $('#apiStageInfo').val(),
			priceCurrency = $('#accPriceCurrency').val(),
			oldProductYn = $('#oldProductYn').val(),
			accModelList = $('#accModelList').val(),
			reviewUseYN = $('#reviewUseYN').val(),
			reevooUseYN = $('#reevooUseYN').val();
		var islogin = false;
        const isB2BShop = $("#shopIntegrationFlag") ? $("#shopIntegrationFlag").val() ==='true' : true;
        const tieredPriceUseYn = $("#tieredPriceUseYn") ? $("#tieredPriceUseYn").val() ==='Y' : true;
		const isGPv2 = (shopIntegrationFlag === 'GPv2') ? true : false;
		const isHybrisNew = (shopIntegrationFlag === 'Hybris-new') ? true : false;
		const isHybrisIntg = (shopIntegrationFlag === 'Hybris-intg') ? true : false;
		const pageTrack = digitalData.page.pageInfo.pageTrack;
		const scene7domain = $('#scene7domain').val();
		
		const recImagePresetDesktop = "?$240_240_PNG$";
		const recImagePresetMobile = "?$480_480_PNG$";
		const recImageLazyloadPreset = "LazyLoad_Home";
		
		//  
		var productListData = [];
		var productListIndex = 0;
		
		Granite.I18n.setLocale($("#language").val());
		
		var isNotNull = function(_str){
			return !fnIsNull(_str);
		};
		
		var productPreset = function(presetStr, imgUrl){
			var preset = "?$"+presetStr;
			var tempImgUrl = imgUrl.toLowerCase();
	
			if (tempImgUrl.indexOf(".jpg") > -1) {
				preset += "_JPG$";
			} else if (tempImgUrl.indexOf(".jpeg") > -1) {
				preset += "_JPG$";
			} else if (tempImgUrl.indexOf(".png") > -1) {
				preset += "_PNG$";
			} else if (tempImgUrl.indexOf(".gif") > -1) {
				preset += "_GIF$";
			} else {
				preset += "_PNG$";
			}
			 
			return preset;
			
		};
		
		var recImgDomain = function(imgUrl, presetType, iconFl) {
			var newUrl = "";
			var useScene7domain = scene7domain;
			if(fnIsNull(imgUrl) || imgUrl.indexOf("http:") > -1 || imgUrl === "" || imgUrl.indexOf("//image-us.samsung.com/") > -1 || 
					imgUrl.indexOf("//stg-images.samsung.com.cn/") > -1 || imgUrl.indexOf("//images.samsung.com.cn/") > -1 || imgUrl.indexOf("image.samsung.com.cn/") > -1 ||
					imgUrl.indexOf("//stg-images.samsung.com/") > -1 || imgUrl.indexOf("//images.samsung.com/") > -1 || imgUrl.indexOf("image.samsung.com/") > -1){
				newUrl = imgUrl;
			}else{
				if(iconFl){
					useScene7domain = useScene7domain.replace("/image/","/content/");
				}
				newUrl = useScene7domain + imgUrl;
			}
			
			if(newUrl.indexOf("?$") < 0 && isNotNull(imgUrl)){
				if(presetType === "lazy"){
					newUrl += productPreset(recImageLazyloadPreset, newUrl);
				} else if( presetType === "product-desktop"){
					newUrl += recImagePresetDesktop;
				} else if( presetType === "product-mobile"){
					newUrl += recImagePresetMobile;
				}
			}
			return newUrl;
		};
		
		var arrayContains = function(array, element){
			for (var i=0; i<array.length; i++) {
				if (array[i] === element) {
					return true;
				}
			}
			return false;
		};
		
		/**
		 * Product   . 
		 */
		var getProductInfo = function(product){
			var tempProduct = product;
	
			/*      chip   product   (  index   index    ) 
			 * (       index   )
			 * modelChipInfoList = [
			 * 		"type1ChipCode+type2ChipCode-...",
			 * 		"type1ChipCode+type2ChipCode-...",
			 * 		...
			 *  ]
			 * */
			var tmpOptionListInModel = {};
			for(var mi in tempProduct.modelList){
				var tmpModel = tempProduct.modelList[mi];
				var tmpFmyChipList = tmpModel.fmyChipList;
				
				for(var fci in tmpFmyChipList){
					//fmyChipCode "  
					var thisOptionKey = tmpFmyChipList[fci].fmyChipType + '+'+
					 					tmpFmyChipList[fci].fmyChipCode.replace("\"", "").replace("&quot;", "")+'+'+
					 					tmpFmyChipList[fci].fmyChipLocalName.replace("\"", "").replace("&quot;", "");
					
					if(tmpOptionListInModel[thisOptionKey] === undefined){
						tmpOptionListInModel[thisOptionKey] = mi;
					} else {
						tmpOptionListInModel[thisOptionKey] += ","+mi;
					}
				}
			}
			
			var optionTypeList = [];
			var viewOptionObj = {};
			if(isNotNull(tempProduct.chipOptions)){
				for(var a=0; a<tempProduct.chipOptions.length; a++){
					var optionData = tempProduct.chipOptions[a];
					var optionTypeTmp = optionData.fmyChipType;

					var optionListInType = optionData.optionList;
					for(var opl in optionListInType){
						var modelOptionKey = optionData.fmyChipType + '+'+
											optionListInType[opl].optionCode.replace("\"", "").replace("&quot;", "")+'+'+
											optionListInType[opl].optionLocalName.replace("\"", "").replace("&quot;", "");
						if(tmpOptionListInModel[modelOptionKey] !== undefined){
							optionListInType[opl].modelIdx = tmpOptionListInModel[modelOptionKey];
						}
						
					}
					viewOptionObj[optionTypeTmp] = {};
					viewOptionObj[optionTypeTmp]['optionList'] = optionListInType;
					
					optionTypeList.push(optionTypeTmp);
				}
			}
			
			
			tempProduct["viewOptionObj"] = viewOptionObj;
			tempProduct["optionTypeList"] = optionTypeList;
			
			return tempProduct;
		};
		
		/**
		 * Product  model   .
		 * 
		 * @param product
		 * @param frontModelIdx Product  model   model index
		 * @return product
		 */
		var getProductModelInfo = function(product, frontModelIdx){
			var tempProduct = product;
	
			if(isNotNull(frontModelIdx) && isNotNull(tempProduct.modelList) && isNotNull(tempProduct.modelList[frontModelIdx])){
				
				var tempModel = tempProduct.modelList[frontModelIdx];
	
				/* Product Name SKU    :: S */
				if(fnIsNull(tempModel.displayName)){
					tempProduct.modelList[frontModelIdx].displayName = "";
				}
				/* Product Name SKU    :: E */
				
				/* thumbUrl Image Preset   :: S */
				if(isNotNull(tempModel.thumbUrl)){
	
					var thumbObj = {};
	
					if(isNotNull(tempModel.thumbUrl)){
						thumbObj = {};
						thumbObj['imageUrlDesktop'] = recImgDomain(tempModel.thumbUrl, 'product-desktop');
						thumbObj['imageUrlMobile'] = recImgDomain(tempModel.thumbUrl, 'product-mobile');
						thumbObj['lazyImageUrl'] = recImgDomain(tempModel.thumbUrl, 'lazy');
					}
	
					tempProduct.modelList[frontModelIdx].thumbInfo = thumbObj;
				}
				
				/*   & review Count :: S */
				if(reviewUseYN ==="Y" || reevooUseYN === "Y"){
					var item = "";
					var ratings = tempModel.ratings;
					if(fnIsNull(ratings)){ 
						ratings = 0; 
						tempProduct.modelList[frontModelIdx].ratings = 0;
					}
					
					// rating  
					var tmpCount = Math.pow(10,1);
					ratings = Math.round(ratings*tmpCount)/tmpCount;
	
					var ratingValue = parseFloat(ratings).toFixed(1),
					fullStarCnt = parseInt(ratings),
					cutStarWidthStyleNum = 0;
					cutStarWidthStyleNum = parseInt((ratingValue-fullStarCnt)*100);
					
					var ratingEmptyText = '';
					
					if(ratingValue !== "0.0"){
						tempProduct.modelList[frontModelIdx].ratings = ratingValue;
					}else{
						ratingEmptyText = 'rating--empty';
					}
					tempProduct.modelList[frontModelIdx].ratingEmptyText = ratingEmptyText;
					
					for(var j=0; j<fullStarCnt;j++){
						item+='<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 100%;"></span></span>';
					}
					if(fullStarCnt < 5 && fullStarCnt > 0){
						item+='<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: ' + cutStarWidthStyleNum + '%;"></span></span>';
						for(var k=4;k>fullStarCnt;k--){
							item+='<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>';
						}
					} else if ( fullStarCnt === 0 && isNotNull(tempProduct.modelList[frontModelIdx].reviewUrl)){
						for(var empty_idx=0;empty_idx<5;empty_idx++){
							item+='<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>';
						}
					}
					tempProduct.modelList[frontModelIdx].ratingHtml = item;
	
					if(fnIsNull(tempModel.reviewCount)){
						tempProduct.modelList[frontModelIdx].reviewCount = "0";
					}
					tempProduct.modelList[frontModelIdx].ratingsText = Granite.I18n.get("{0} out of {1} Stars",["<span>"+tempModel.ratings+"</span>","5"],siteCode);
	
				}
				/*   & review Count :: E */
				
				/* Energy Label Data :: S */
				if(fnIsNull(tempModel.energyLabelGrade)){
					tempProduct.modelList[frontModelIdx].energyLabelGrade = "";
				}
				if(fnIsNull(tempModel.ficheFileUrl)){
					tempProduct.modelList[frontModelIdx].ficheFileUrl = "";
				}
				/* Energy Label Data :: E */
				
			}
			return tempProduct;
		};
		
		/**
		 * product card Name 
		 */
		var productCardNameBuild = function(frontModel){
	
			var pdpUrl = "javascript:void(0)"; 
			if(isNotNull(frontModel.pdpUrl)){
				pdpUrl = frontModel.pdpUrl;
			}
			var productCardTemplate =
				'<div class="accessories__product-name">';
			if(isNotNull(frontModel.displayName)){
				productCardTemplate +=
					'<a href="'+pdpUrl+'" an-tr="pd_accessories-'+pageTrack+'-product-link" an-ca="product click" an-ac="accessories" an-la="product click" data-modelcode="'+frontModel.modelCode+'" data-modelname="'+frontModel.modelName+'">'+frontModel.displayName+'</p></a>';
			}
			productCardTemplate +=
				'</div>';
		
			return productCardTemplate;
		}
		
		/**
		 * product card image 
		 */
		var productCardImageBuild = function(frontModel, product){
			
			var productCardTemplate =
				'<div class="accessories__image">';
				
				// epp acc feature URL  
				if($('#isEppPage').val() === 'true'){
					const pdType = product.simplePdYN === 'N' ? "pd" : "feature";
					if(frontModel.pdpUrl.indexOf('/pd.') > -1){
						frontModel.pdpUrl  = frontModel.pdpUrl .replace(/\/pd./ig,`/${pdType}.`);
					} else if(frontModel.pdpUrl.indexOf('/feature.') > -1){
						frontModel.pdpUrl  = frontModel.pdpUrl .replace(/\/feature./ig,`/${pdType}.`);
					}
					
				}
				
				if(isNotNull(frontModel.pdpUrl) && isNotNull(frontModel.thumbUrl)){
					productCardTemplate +=
					'<a href="'+frontModel.pdpUrl+'" an-tr="pd_accessories-'+pageTrack+'-product-link" an-ca="product click" an-ac="accessories" an-la="product click" data-modelcode="'+frontModel.modelCode+'" data-modelname="'+frontModel.modelName+'">'+
						'<div class="image">' +
							'<img class="image__preview lazy-load responsive-img" data-desktop-src="'+ frontModel.thumbInfo.lazyImageUrl +'" data-mobile-src="'+ frontModel.thumbInfo.lazyImageUrl +'" alt="'+ frontModel.thumbUrlAlt +'">' +
							'<img class="image__main lazy-load responsive-img" data-desktop-src="'+ frontModel.thumbInfo.imageUrlDesktop +'" data-mobile-src="'+ frontModel.thumbInfo.imageUrlMobile +'" alt="'+ frontModel.thumbUrlAlt +'">' +
						'</div>'+
					'</a>';
				}
			productCardTemplate +=
				'</div>';
			return productCardTemplate;
		};
		
		/**
		 * viewOptionObj :    Product   
		 * optionChip      sku index  
		 * selectOptionMoIdx :    moidx  
		 * otherSelectedOptionMoIdxList :         
		 * isColorType :   color   
		 * optionTypeList :   Product   optionTypeList 
		 */
		var getSelectedModelIdx = function(viewOptionObj, selectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, optionTypeList){
			var modelIdx = 0;
			
			var modelIdxList = selectOptionMoIdx.split(',');
			var firstIdx = modelIdxList[0];
			
			var memoryIdx = optionTypeList.indexOf("MEMORY");
			
			if(!isGPv2 && !isHybrisNew && isColorType && memoryIdx > 0){
				// [global, hybrisIntg]   color ,     memory     
				
				var memoryOptionList = viewOptionObj["MEMORY"].optionList;
				var selectedModelIdx = 0;
				var highestOption = 0;
				for(var moi in memoryOptionList){
					var temp_mi = memoryOptionList[moi].modelIdx.split(',');
					for(var tmi in temp_mi){
						//   modelIdx   model idx     
						if(arrayContains(modelIdxList, temp_mi[tmi])){
							var this_memory_num = memoryOptionList[moi].optionCode.replace("TB","000").replace(/[^0-9]/g,"");
							if(highestOption < this_memory_num){
								highestOption = this_memory_num;
								selectedModelIdx = temp_mi[tmi];
							}
							break;
						}
					}
				}
				modelIdx = selectedModelIdx;
				
			} else {
				var selectModelIdxList = [];
				var tempMappingModelIdx = [];
				
				for(var omi in otherSelectedOptionMoIdxList){
					var otherMoIdx = otherSelectedOptionMoIdxList[omi];
					if(isNotNull(otherMoIdx)){
						var otherMoIdxArr = otherMoIdx.split(',');

						tempMappingModelIdx = [];
						for(var mli in modelIdxList){
							if(otherMoIdxArr.indexOf(String(modelIdxList[mli]))>-1) {
								tempMappingModelIdx.push(modelIdxList[mli]);
							}
						}
						if(tempMappingModelIdx.length > 0){
							modelIdxList = tempMappingModelIdx;
						}
					}
					
				}
				if(modelIdxList.length > 0){
					modelIdx = modelIdxList[0];
				} else {
					modelIdx = firstIdx;
				}
			}
			
			return modelIdx;
		};
		/**
		 * product card OptionChip 
		 */
		var productCardFmyOptionBuild = function(product){
			var productCardTemplate = "";
			var optionChipMobile = "";
			var frontModel = product.modelList[product.frontModelIdx];
			
			/* option      */ 
			if(isNotNull(product.viewOptionObj)){
				productCardTemplate += 
					'<div class="option-selector">';
				optionChipMobile +=
					'<div class="accessories__option-selector">';
				if(isNotNull(product.viewOptionObj) && Object.keys(product.viewOptionObj).length > 0){
					
					var parentOptionModelIdx = "";
					var viewOptionIdx = 0;
					
					var curViewOptionObj = product.viewOptionObj;
					var curOptionTypeList = product.optionTypeList;
					
					for(var type in product.viewOptionObj){
						var optionDataType = "";
						optionDataType = type.toLowerCase().replace(/ /g, "-");
						
						var optionObj = product.viewOptionObj[type].optionList;
						
						var isSelected = false;
						var currentOption = {};
						var disabledClass = '';
						var modelIdxList = '';
						var curSelecteModelIdx = '';
						
						var parentModelIdxList = '';
						
						var curSelectOptionMoIdx = '';
						var otherSelectedOptionMoIdxList = '';
						var isColorType = '';
						
						var tmp_optionList = '';
						var tmp_option = '';
						var tmp_optionMoIdx = '';
						var tmp_optionMoIdxArr = '';
						
						var modelCodeAttrForTagging = '';
						var modelNameAttrForTagging = '';
						
						var modelIdx = '';
						
						var chipId = '';
						var chipName = '';
						
						var selectorWrapperStyle = "";
						if(isNotNull(product.viewOptionObj[type].styleAttr)){
							selectorWrapperStyle = product.viewOptionObj[type].styleAttr;
						}
						
						//.color-name-text   
						var colorNameText = '';
						for(var option in optionObj){
							currentOption = optionObj[option];
							modelIdxList = currentOption.modelIdx.split(',');
							if(currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))){
								colorNameText = currentOption.optionLocalName;
							}
						}
						
						if(type === "COLOR"){
							productCardTemplate +=
								'<div class="option-selector__color-name">'+
									'<div class="option-selector__color-name-inner">'+
										'<span class="color-name-title">'+Granite.I18n.get("Color")+' : </span><span class="color-name-text">'+colorNameText+'</span>'+
									'</div>'+
								'</div>'+
								'<div class="option-selector__wrap option-selector__wrap--color-chip" data-desktop-view="5" data-mobile-view="3">'+
									'<div class="option-selector__swiper">'+
										'<div class="option-selector__swiper-container">'+
											'<div class="option-selector__swiper-wrapper" style="'+selectorWrapperStyle+'" role="list">';
							optionChipMobile +=
								'<div class="accessories__color-chip">';
							for(var option in optionObj){
								/* ()  flag  */
								currentOption = optionObj[option];

								isSelected = false;
								modelIdxList = currentOption.modelIdx.split(',');

								if(currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))){
									isSelected = true;
									curSelecteModelIdx = currentOption.modelIdx;
									disabledClass = '';
								} else {
									disabledClass = ' js-fmyChip-is-disabled-acc';
									if(viewOptionIdx === 0){
										disabledClass = '';
									} else {
										parentModelIdxList = parentOptionModelIdx.split(',');
										for(var mli in modelIdxList){
											//    model idx   model idx    
											if(arrayContains(parentModelIdxList, modelIdxList[mli])){
												disabledClass = '';
												break;
											}
										}
									}
								}
								
								if(disabledClass === ''){
									curSelectOptionMoIdx = currentOption.modelIdx;
									otherSelectedOptionMoIdxList = [];
									isColorType = true;
									
									for(var ooi in curViewOptionObj){
										if(ooi !== type){
											tmp_optionList = curViewOptionObj[ooi].optionList;
											for(var toi in tmp_optionList){
												tmp_option = tmp_optionList[toi];
												tmp_optionMoIdx = tmp_option.modelIdx;
												tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');
												
												//   option 
												if(tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx))>-1){
													otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
												}
											}
											
										}
									}
									
									modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
									if(product.modelList.length > modelIdx && isNotNull(product.modelList[modelIdx])){
										modelCodeAttrForTagging = ' data-modelcode="'+product.modelList[modelIdx].modelCode+'"';
										modelNameAttrForTagging = ' data-modelname="'+product.modelList[modelIdx].modelName+'"';
									}
								}
								
								chipId = 'product-'+optionDataType+'-'+option+'-'+frontModel.modelCode;
								chipName = 'product-'+optionDataType+'-'+frontModel.modelCode;
								
								productCardTemplate +=
												'<span class="option-selector__swiper-slide'+(isSelected?' swiper-slide-active':'')+'" role="listitem">'+
													'<span class="option-selector__color js-acc-product-fmychip'+disabledClass+'">'+
														'<input type="radio" id="'+chipId+'" data-optionName="'+currentOption.optionLocalName+'" name="'+chipName+'" data-modeli="'+modelIdx+'"'+
															' data-code="'+currentOption.optionCode+'"'+(isSelected?' checked':'')+''+
															' an-tr="pd_accessories-'+pageTrack+'-text-option" an-ca="option click" an-ac="accessories" an-la="'+type.toLowerCase()+':'+currentOption.optionName.replace("\"","&quot;").toLowerCase()+'"'+
															modelCodeAttrForTagging+modelNameAttrForTagging+
															' data-typeidx="'+viewOptionIdx+'" data-moidx="'+currentOption.modelIdx+'" >'+
														'<label for="'+chipId+'">'+
															'<span class="option-selector__color-code" style="background-color: '+currentOption.optionCode+'">'+currentOption.optionLocalName+'</span><span class="hidden">'+currentOption.optionLocalName+'</span>'+
														'</label>'+
													'</span>'+
												'</span>';
								optionChipMobile +=
										'<span class="accessories__color'+disabledClass+'">'+
											'<span class="accessories__color-code" style="background-color: '+currentOption.optionCode+'">'+
												'<span class="hidden">'+currentOption.optionLocalName+'</span>' +
											'</span>' +
										'</span>';
							}
							parentOptionModelIdx = curSelecteModelIdx;
							productCardTemplate +=
											'</div>'+//option-selector__swiper-wrapper
										'</div>'+//option-selector__swiper-container
										'<button type="button" class="option-selector__button-prev" aria-label="'+Granite.I18n.get("Previous")+'" role="button" aria-disabled="true">'+
											'<span class="hidden">'+Granite.I18n.get("Previous")+'</span>'+
											'<svg class="icon" focusable="false">'+
												'<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#previous-regular"></use>'+
											'</svg>'+
										'</button>'+
										'<button type="button" class="option-selector__button-next" aria-label="'+Granite.I18n.get("Next")+'" role="button" aria-disabled="true">'+
											'<span class="hidden">'+Granite.I18n.get("Next")+'</span>'+
											'<svg class="icon" focusable="false">'+
												'<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-regular"></use>'+
											'</svg>'+
										'</button>'+
									'</div>'+//option-selector__swiper
								'</div>';//option-selector__wrap
							optionChipMobile +=
										'<div class="accessories__over-view">' +
											'<span></span>'+
											'<span></span>'+
											'<span></span>'+
										'</div>'+
									'</div>'; // accessories__color-chip
						} else {
							productCardTemplate +=
								'<div class="option-selector__wrap option-selector__wrap--capacity" '+
									'data-desktop-view="3" data-mobile-view="2">'+
									'<div class="option-selector__swiper">'+
										'<div class="option-selector__swiper-container">'+
											'<div class="option-selector__swiper-wrapper" style="'+selectorWrapperStyle+'" role="list">';
							optionChipMobile +=
								'<div class="accessories__capacity">';
							for(var oi=0; oi < optionObj.length; oi++){
								/* ()  flag  */

								currentOption = optionObj[oi];
								
								isSelected = false;

								modelIdxList = currentOption.modelIdx.split(',');
								if(currentOption.modelIdx != null && arrayContains(modelIdxList, String(product.frontModelIdx))){
									isSelected = true;
									curSelecteModelIdx = currentOption.modelIdx;
									disabledClass = '';
								} else {
									disabledClass = ' js-fmyChip-is-disabled-acc';
									if(viewOptionIdx === 0){
										disabledClass = '';
									} else {
										parentModelIdxList = parentOptionModelIdx.split(',');
										
										for(var mlic in modelIdxList){
											//    model idx   model idx    
											if(arrayContains(parentModelIdxList, modelIdxList[mlic])){
												disabledClass = '';
												break;
											}
										}
									}
								}
								
								if(disabledClass === ''){
									curSelectOptionMoIdx = currentOption.modelIdx;
									otherSelectedOptionMoIdxList = [];
									isColorType = false;
									
									for(var ooic in curViewOptionObj){
										if(ooic !== type){
											tmp_optionList = curViewOptionObj[ooic].optionList;
											for(var toic in tmp_optionList){
												tmp_option = tmp_optionList[toic];
												tmp_optionMoIdx = tmp_option.modelIdx;
												tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');
												
												//   option 
												if(tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx))>-1){
													otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
												}
											}
											
										}
									}
									
									modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
									
									if(product.modelList.length > modelIdx && isNotNull(product.modelList[modelIdx])){
										modelCodeAttrForTagging = ' data-modelcode="'+product.modelList[modelIdx].modelCode+'"';
										modelNameAttrForTagging = ' data-modelname="'+product.modelList[modelIdx].modelName+'"';
									}
								}
								chipId = 'product-'+optionDataType+'-'+oi+'-'+frontModel.modelCode;
								chipName = 'product-'+optionDataType+'-'+frontModel.modelCode;
	
								productCardTemplate +=
												'<span class="option-selector__swiper-slide'+(isSelected?' swiper-slide-active':'')+'" role="listitem">'+
													'<span class="option-selector__size js-acc-product-fmychip'+disabledClass+'">'+
														'<input type="radio" id="'+chipId+'" data-optionName="'+currentOption.optionLocalName+'" name="'+chipName+'" data-modeli="'+modelIdx+'"'+
															' an-tr="pd_accessories-'+pageTrack+'-text-option" an-ca="option click" an-ac="accessories" an-la="'+type.toLowerCase()+':'+currentOption.optionName.replace("\"","&quot;").toLowerCase()+'"'+
															modelCodeAttrForTagging+modelNameAttrForTagging+
															' data-typeidx="'+viewOptionIdx+'" data-code="'+currentOption.optionCode+'"'+(isSelected?' checked':'')+' data-moidx="'+currentOption.modelIdx+'">'+
														'<label class="option-selector__size-label" for="'+chipId+'">'+
															'<span class="option-selector__size-label-text">'+currentOption.optionLocalName+'</span>'+
														'</label>'+
													'</span>'+
												'</span>';
								optionChipMobile +=
									'<span class="accessories__size '+disabledClass+'">'+
										'<span class="accessories__size-label-text">'+currentOption.optionLocalName+'</span>'+
									'</span>';
							}
							parentOptionModelIdx = curSelecteModelIdx;
							productCardTemplate +=
												'<div class="option-selector__floating-bar" style="display: none;"></div>'+
											'</div>'+//option-selector__swiper-wrapper
										'</div>'+//option-selector__swiprer-container
										'<button type="button" class="option-selector__button-prev" aria-label="'+Granite.I18n.get("Previous")+'" role="button" aria-disabled="true">'+
											'<span class="hidden">'+Granite.I18n.get("Previous")+'</span>'+
											'<svg class="icon" focusable="false">'+
												'<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#previous-regular"></use>'+
											'</svg>'+
										'</button>'+
										'<button type="button" class="option-selector__button-next" aria-label="'+Granite.I18n.get("Next")+'" role="button" aria-disabled="true">'+
											'<span class="hidden">'+Granite.I18n.get("Next")+'</span>'+
											'<svg class="icon" focusable="false">'+
												'<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-spri;//option-selector__wrap
							optionChipMobile +=
								'<div class="accessories__over-view">' +
									'<span></span>'+
									'<span></span>'+
									'<span></span>'+
								'</div>'+
							'</div>'; // accessories__capacity
						}
						
						viewOptionIdx++;
					}
				}
	
				productCardTemplate +=
						'</div>';//option-selector
				optionChipMobile +=
					'</div>'; //accessories__option-selector
			}
			return productCardTemplate;// + optionChipMobile
		};
		
		var productCardReviewBuild = function(frontModel,subTypeCode){
			var productCardTemplate = "";
			var reviewUrl = '/'+siteCode+'/common/review/'+frontModel.modelCode+'/';
			if(isNotNull(frontModel.reviewUrl)){
				reviewUrl = frontModel.reviewUrl;
			}
			
			if((reviewUseYN ==="Y" || reevooUseYN === "Y") && isNotNull(frontModel.ratingHtml) /* && !(subTypeCode === '01' && siteCode === 'br')*/ ){
				productCardTemplate +=
					'<div class="accessories__rating">'+
						'<a href="'+reviewUrl+'" data-modelcode="'+frontModel.modelCode+'" data-modelname="'+frontModel.modelName+'"'+
						' an-tr="pd_accessories-'+pageTrack+'-image-review" an-ca="review" an-ac="accessories" an-la="read review">'+
							'<span class="rating '+frontModel.ratingEmptyText+'">'+
								'<span class="hidden">'+Granite.I18n.get("Rating")+'</span>'+
								'<span class="rating__inner">'+
									'<span class="rating__star-list">'+
										frontModel.ratingHtml+
									'</span>'+
									'<strong class="rating__point"><span class="hidden">'+Granite.I18n.get("Product Ratings")+' : </span><span>'+frontModel.ratings+'</span></strong>'+
									'<em class="rating__review-count">(<span class="hidden">'+Granite.I18n.get("Number of Ratings")+' :</span><span>'+frontModel.reviewCount+'</span>)</em>'+
								'</span>'+
							'</span>'+
						'<a>' +
					'</div>';
			}
			
			return productCardTemplate;
		}
		/**
		 * product card seller 
		 */
		var productCardSellerBuild = function(thirdPASeller){
			var productCardTemplate = "";
			productCardTemplate +=
				'<div class="accessories__seller">';
			if(isNotNull(thirdPASeller)){
				productCardTemplate +=
					'<p class="accessories__seller-inner">'+thirdPASeller+'</p>';
			}
			productCardTemplate +=	
				'</div>';
			
			return productCardTemplate;
		};
		/**
		 * product card EnergeLabel 
		 */
		var productCardEnergeLabelBuild = function(frontModel){
			var productCardTemplate = "";
			if(isNotNull(frontModel.energyLabelGrade)){
				productCardTemplate +=
					'<div class="accessories__product-price-info">';
				if(isNotNull(frontModel.ficheFileUrl)){
					productCardTemplate +=
						'<a class="accessories__badge-text" href="'+frontModel.ficheFileUrl+'" target="_blank" aria-label="'+Granite.I18n.get("Open in a new window")+'" '+
						' an-tr="pd_accessories-'+pageTrack+'-product fiche-link" an-ca="option click" an-ac="accessories" an-la="product fiche">'+
							Granite.I18n.get("Product Fiche")+
						'</a>';
				}
				productCardTemplate +=
						'<a class="badge '+frontModel.energyLabelClass2+'" href="'+frontModel.energyFileUrl+'" target="_blank" aria-label="'+Granite.I18n.get("Open in a new window")+'"'+
						' an-tr="pd_accessories-'+pageTrack+'-product fiche-link" an-ca="option click" an-ac="accessories" an-la="product fiche">'+
							'<span class="badge__grade--with-text '+frontModel.energyLabelClass1+'">'+
								'<span class="hidden">'+frontModel.energyLabelGrade+'</span>'+
							'</span>'+
						'</a>'+
					'</div>';
			}
			return productCardTemplate;
		};
		
		function getPriceData( frontModel, upperStock ){
			var usePriceArea = true;
			var orignalPrice = '';
			var orignalPriceFormatted = '';
			var salePrice = '';
			var salePriceFormatted = '';
			var savePriceFormatted = '';
			var listPrice = '';
			var listPriceFormatted = '';
			
			if( oldProductYn === 'Y'|| (siteCode === "pl" && upperStock === "OUTOFSTOCK") ){
				usePriceArea = false;
			} else if( upperStock === "NOORDER" || upperStock === "LEARNMORE" ){
				if( siteCode === "nl" || siteCode === "be" || siteCode === "be_fr" ){
					usePriceArea = true;
				} else {
					usePriceArea = false;
				}
			}
			
			if( frontModel.price ){
				orignalPrice = frontModel.price;
			}
			
			if( frontModel.listPrice ){
				listPrice = frontModel.listPrice;
			}
			
			if( frontModel.listPriceDisplay ){
				listPriceFormatted = frontModel.listPriceDisplay;
			} else if( frontModel.listPrice ) {
				listPriceFormatted = currencyComma(frontModel.listPrice, priceCurrency);
			}
	
			if( frontModel.priceDisplay ){
				orignalPriceFormatted = frontModel.priceDisplay;
			} else if( frontModel.price ) {
				orignalPriceFormatted = currencyComma(frontModel.price, priceCurrency);
			}
	
			if( frontModel.promotionPrice ){
				salePrice = frontModel.promotionPrice;
			} else {
				salePrice = frontModel.price;
			}
	
			if( frontModel.promotionPriceDisplay ){
				salePriceFormatted = frontModel.promotionPriceDisplay;
			} else if( frontModel.promotionPrice ) {
				salePriceFormatted = currencyComma( frontModel.promotionPrice , priceCurrency);
			} else {
				salePriceFormatted = orignalPriceFormatted;
			}
            
            const isSMBRegisteredUser =  $.cookies.get('isSMBRegisteredUserYN', {domain : ".samsung.com"}) === 'Y' && commonLoginCheck();
            if( isB2BShop && isSMBRegisteredUser ){
                 if( frontModel.tieredPrice && tieredPriceUseYn ){
                    salePrice = frontModel.tieredPrice;
                    salePriceFormatted = currencyComma( frontModel.tieredPrice , priceCurrency);
                    
                    if( frontModel.tieredPriceDisplay ){
                        salePriceFormatted = frontModel.tieredPriceDisplay;
                    }
                } else if( frontModel.smbPromotionPrice  ){
                    salePrice = frontModel.smbPromotionPrice;
                    salePriceFormatted = currencyComma( frontModel.smbPromotionPrice , priceCurrency);
                }
            }
            
			if( orignalPrice && salePrice && orignalPrice !== salePrice ){
				savePriceFormatted = currencyComma(  parseFloat(orignalPrice) - parseFloat(salePrice), priceCurrency ) ;
			} else if( frontModel.formattedPriceSave ) {
				savePriceFormatted = frontModel.formattedPriceSave;
			} else if( frontModel.saveText && parseFloat(frontModel.saveText) > 0 ) {
				savePriceFormatted = frontModel.saveText;
			}
            
            // save   front   .
            const useTaxExPriceYN =  $.cookies.get('useTaxExPriceYN', {domain : ".samsung.com"}) === 'Y';
            if( isB2BShop && useTaxExPriceYN ){
                 if( frontModel.taxExPrice ){
                    salePrice = frontModel.taxExPrice;
                    salePriceFormatted = currencyComma( frontModel.taxExPrice , priceCurrency);
                    
                    if( frontModel.taxExPriceDisplay ){
                        salePriceFormatted = frontModel.taxExPriceDisplay;
                    }
                }
                
                if( isSMBRegisteredUser ){
                    if( frontModel.taxExTieredPrice && tieredPriceUseYn ){
                        salePrice = frontModel.taxExTieredPrice;
                        salePriceFormatted = currencyComma( frontModel.taxExTieredPrice , priceCurrency);
                        
                        if( frontModel.taxExTieredPriceDisplay ){
                            salePriceFormatted = frontModel.taxExTieredPriceDisplay;
                        }
                    }
                }
            }
	
			// tradeInPriceText       
			if( frontModel.tradeInPriceText && $("#shopIntegrationFlag").val().indexOf('Hybris-intg') > -1 ){
				salePriceFormatted = frontModel.tradeInPriceText;
			}
			
			if(siteCode === "be" || siteCode === "be_fr" || siteCode === "nl"){
				orignalPriceFormatted = deleteCurrency(orignalPriceFormatted, priceCurrency);
				salePriceFormatted = deleteCurrency(salePriceFormatted, priceCurrency);
				savePriceFormatted = deleteCurrency(savePriceFormatted, priceCurrency);
				listPriceFormatted = deleteCurrency(listPriceFormatted, priceCurrency);
			}
			
			var proudctPriceInfo = {
				'hasPrice' : usePriceArea,
				'orignalPrice' : orignalPrice,
				'salePrice' : salePrice,
				'listPrice' : listPrice,
				'listPriceFormatted' : listPriceFormatted,
				'orignalPriceFormatted' : orignalPriceFormatted,
				'salePriceFormatted' : salePriceFormatted,
				'savePriceFormatted' : savePriceFormatted
			}
			
			return proudctPriceInfo;
		}
		
		/**
		 * Price 
		 * 
		 * Global - monthlyPriceInfo, priceDisplay, formattedPriceSave
		 * Hybris-Intg - monthlyPriceInfo, priceDisplay, promotionPriceDisplay, price, promotionPrice
		 * GPv2 - leasingInfo, priceDisplay, promotionPriceDisplay, listPriceDisplay, price. promotionPrice, listPrice
		 *
		 */
		var buildPriceArea = function(frontModel, upperStock , subTypeCode){
			var proudctPriceInfo = !isB2BShop ? getPriceData( frontModel, upperStock ) : getPriceData( frontModel.b2bHybrisShopInfo, upperStock );
			var productCardTemplate = "";
			//var priceDisplay = proudctPriceInfo.orignalPriceFormatted;
			
			var priceTextForCompare = "";
			
			var usePriceArea = proudctPriceInfo.hasPrice;
			
			productCardTemplate +=
				'<div class="accessories__price">';
			if(usePriceArea){
				var promotionDisplay = proudctPriceInfo.salePriceFormatted;
				var currentDisplay = proudctPriceInfo.orignalPriceFormatted;
				var saveText = proudctPriceInfo.savePriceFormatted;
				var listPrice = proudctPriceInfo.listPrice;
				var listPriceDisplay = proudctPriceInfo.listPriceFormatted;
				
				if(frontModel.listPrice != null){
					listPrice = parseFloat(frontModel.listPrice) - parseFloat(frontModel.price);
				}
				
				var monthlyPrice = "";
				var tenureVal = "";
				var leasingInterest = "";
				
				var downPaymentFormatted = "";
				var tenureUnit = "";
				var monthlyRate = "";
				
				var saveHtml = "";
				
				var useMonthlyPrice = false;
				var useLeasingInfo = false;
                    
				if(isGPv2 || isHybrisNew || isB2BShop){
					if(isNotNull(frontModel.leasingInfo) && siteCode === "nl"){
						// nl  leasingInfo 
						var leasingInfo = frontModel.leasingInfo;
						monthlyRate = deleteCurrency(leasingInfo.monthlyRate, priceCurrency);
						tenureVal = leasingInfo.tenureVal;
						downPaymentFormatted = deleteCurrency(leasingInfo.downPaymentFormatted, priceCurrency);
						tenureUnit = leasingInfo.tenureUnit;
						
						useLeasingInfo = true;
					}else{
						if( isNotNull(frontModel.monthlyPriceInfo) && isNotNull(frontModel.monthlyPriceInfo.leasingMonthly) 
								&& isNotNull(frontModel.monthlyPriceInfo.leasingMonths) && isNotNull(frontModel.monthlyPriceInfo.interest)){
							monthlyPrice = frontModel.monthlyPriceInfo.leasingMonthly;
							if(siteCode !=="be" && siteCode !=="be_fr"){
								monthlyPrice = currencyComma(monthlyPrice, priceCurrency);
							}
							tenureVal = frontModel.monthlyPriceInfo.leasingMonths;
							leasingInterest = frontModel.monthlyPriceInfo.interest;

							useMonthlyPrice = true;
						}
					}
				} else {
					if( isNotNull(frontModel.monthlyPriceInfo) && 
							isNotNull(frontModel.monthlyPriceInfo.leasingMonthly) && isNotNull(frontModel.monthlyPriceInfo.leasingMonths) && 
							(siteCode === "au" || siteCode === "nz" || siteCode === "ae" || siteCode === "my" || siteCode === "sg" || siteCode === "ca" || siteCode === "ca_fr" || 
							siteCode === "it" || siteCode === "se" || siteCode === "dk" || siteCode === "fi" || siteCode === "no" || siteCode === "es" || siteCode === "pt" || 
							siteCode === "th" || siteCode === "tw" || siteCode === "ru" || siteCode === "ch" || siteCode === "ch_fr")){
						var monthlyPriceInfo = frontModel.monthlyPriceInfo;
						monthlyPrice = monthlyPriceInfo.leasingMonthly;
						monthlyPrice = currencyComma(monthlyPrice, priceCurrency);
						tenureVal = monthlyPriceInfo.leasingMonths;

						useMonthlyPrice = true;
					}
				}
				
				if(isGPv2 || isHybrisNew || isHybrisIntg || isB2BShop){
					//COMP6FE-1599 [EPP] SEPOL MSRP Price  : && !($('#isEppPage').val() === 'true' && siteCode === "pl") 
					if( saveText && !($('#isEppPage').val() === 'true' && siteCode === "pl") ){
						if( siteCode === "nl" || siteCode === "be" || siteCode === "be_fr" || siteCode === "de" ){
							currentDisplay = Granite.I18n.get("From {0}",['<del>'+currentDisplay+'</del>']);
						}else{
							currentDisplay = '<del>' + currentDisplay + '</del>';
						}
						saveHtml = 
							'<span class="accessories__price-original">' +
								'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>' + 
								currentDisplay +
							'</span>';
						if(siteCode !== "nl" && siteCode !== "be" && siteCode !== "be_fr"){
							saveHtml +=
							'<span class="accessories__price-save">'+
								Granite.I18n.get("Save {0}", saveText)+
							'</span>';
						}
					} else if(listPrice > 0 && (siteCode === "nl" || siteCode === "be" || siteCode === "be_fr")){
						saveHtml += 
							'<span class="accessories__price-original">'+
								'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>'+
								'<span>'+Granite.I18n.get("Listprice")+ ' '+ listPriceDisplay+'</span>'+
							'</span>';
					}
				} else {
					//COMP6FE-1599 [EPP] SEPOL MSRP Price  : && !($('#isEppPage').val() === 'true' && siteCode === "pl") 
					if( saveText && ( siteCode !== "nl" && siteCode !== "be" && siteCode !== "be_fr" && !($('#isEppPage').val() === 'true' && siteCode === "pl") ) ){
						saveHtml +=
							'<span class="accessories__price-save">'+
								saveText+
							'</span>';
					}
				}
				
				if(useMonthlyPrice){
					priceTextForCompare = Granite.I18n.get("From {0}/mo",[monthlyPrice])+' ';
					priceTextForCompare += Granite.I18n.get("for {0} mos",[tenureVal])+' ';
					priceTextForCompare += Granite.I18n.get("or")+promotionDisplay;
						
					productCardTemplate +=
						'<div class="accessories__price-info">' +
							'<span class="accessories__price-current" data-pricetext="'+priceTextForCompare+'">'+
								'<span class="hidden">'+Granite.I18n.get("Monthly Price")+': </span>'+
								'<span class="accessories__price-current-text">'+
									Granite.I18n.get("From {0}/mo",[monthlyPrice])+
								'</span>'+
								' '+
								Granite.I18n.get("for {0} mos",[tenureVal])+
							'</span>'+
							'<span class="accessories__price-monthly">'+
								'<span class="hidden">'+Granite.I18n.get("Current Price")+': </span>'+
								'<span class="accessories__price-monthly-text"> '+Granite.I18n.get("or")+' </span>'+
								promotionDisplay+
							'</span>'+
						'</div>';
				} else if(useLeasingInfo){
					// nl   {} or {leasingInfo }
					if(downPaymentFormatted !== "" && tenureUnit !== "" && tenureVal !== "" && monthlyRate !== ""){
	  					
	  					var leasingText = " " + downPaymentFormatted + " + " + 
	  					tenureVal + " x " +
	  					monthlyRate + "/" + 
	  					Granite.I18n.get(tenureUnit);
	  					
	  					priceTextForCompare = currentDisplay + ' '+Granite.I18n.get("or")+' ' + leasingText;
							
						var priceTextForCompareAttr = 
							' data-pricetext="'+priceTextForCompare+'"';
						
						productCardTemplate +=
							'<div class="accessories__price-info">' +
								'<div class="product-card__price-current"'+priceTextForCompareAttr+'>'+
									'<span class="hidden">'+Granite.I18n.get("Current Price")+': </span>'+
									'<span class="accessories__price-current-text">'+
										promotionDisplay+
									'</span>'+
								'</div>'+
								'<div class="accessories__price-monthly">'+
									'<span class="hidden">'+Granite.I18n.get("Monthly Price")+': </span>'+
									'<span class="product-card__price-monthly-text"> '+Granite.I18n.get("or")+' </span>'+
									leasingText+
								'</div>'+
							'</div>';
					}
					
				} else {
					productCardTemplate +=
						'<div class="accessories__price-info">' +
							'<div class="accessories__price-current" data-pricetext="'+promotionDisplay+'">'+
								'<span class="hidden">'+Granite.I18n.get("Current Price")+': </span>'+
								promotionDisplay+
							'</div>' + 
						'</div>';
				}
				//Save Text 
				productCardTemplate +=
						'<div class="accessories__price-detail">';
				if(isNotNull(saveHtml)){
					productCardTemplate += 
							saveHtml;
				}
				productCardTemplate += 
						'</div>';
			}
	
			productCardTemplate +=
					'</div>';
			
			return productCardTemplate;
			
		};
		
		var buildProductCard = function(product) {
			var productCardTemplate = '';
			var upperStock = '';
			var frontModel = product.modelList[product.frontModelIdx];
			
			if(isNotNull(frontModel.ctaType)){
				upperStock = frontModel.ctaType.toUpperCase();
				product.modelList[product.frontModelIdx].ctaTypeUpperCase = upperStock;
			}
			var subTypeCode = '';
			if(isNotNull(product.categorySubTypeCode)){
				subTypeCode = product.categorySubTypeCode.substr(0,2);
			}
	        if( isB2BShop && frontModel.b2bHybrisShopInfo ){
                upperStock = frontModel.b2bHybrisShopInfo.cta+=		productCardNameBuild(frontModel);
			productCardTemplate +=		productCardImageBuild(frontModel, product);
			productCardTemplate +=		'<div class="accessories__text">';
			productCardTemplate +=			productCardFmyOptionBuild(product);
			productCardTemplate +=			productCardReviewBuild(frontModel, subTypeCode);
			productCardTemplate +=			productCardSellerBuild(product.thirdPASeller);			
			//productCardTemplate +=			productCardEnergeLabelBuild(frontModel);
			productCardTemplate +=			buildPriceArea(frontModel, upperStock, subTypeCode);
			productCardTemplate +=	  '</div>';
	
			return productCardTemplate;
		};
		
		var productCardEventListener = function(){
			
			$('.js-fmyChip-is-disabled-acc').parent().addClass('is-disabled');
			$('.js-fmyChip-is-disabled-acc').removeClass('js-fmyChip-is-disabled-acc').find('input').prop('disabled', true);
			
			/* fmychip click event :: S */
			var $fmyChipEl = $('.js-acc-product-fmychip').find('input');
			$fmyChipEl.off("click.finder");
			$fmyChipEl.on("click.finder", function(e){
				var $optionInputEl = $(this);
				var $targetContentEl = $optionInputEl.closest('.js-acc-product-card');
				
				var productIdx = $targetContentEl.data("productidx");
				
				var modelIdx =  $optionInputEl.data("modeli");
				
				setTimeout(function(){
					if(isNotNull(modelIdx)){
						productListData[productIdx].frontModelIdx = modelIdx;
						
						var proObj = getProductModelInfo(productListData[productIdx], modelIdx);
						
						$targetContentEl.find('.option-selector__wrap').each(function(idx){
							var tmpType = productListData[productIdx].optionTypeList[idx];
							var styleAttr = $(this).find('.option-selector__swiper-wrapper').attr("style");
							productListData[productIdx].viewOptionObj[tmpType].styleAttr = styleAttr;
						});
						
						
						$targetContentEl.html(buildProductCard(proObj));

						productCardEventListener();
						
						// product card      
						window.sg.components.accessories.reInitItem(document.querySelectorAll(".accessories__item")[productIdx]);
					}
				}, 300);
			});
			/* fmychip click event :: E */
	
		};
		
		var getRecentResult = function(){
			var param = {};
			var returnHtml = '';
			var apiUrl = '';
			
			//epp acc search  
			const isEPP = $('#isEppPage').val() === 'true';
			const businessType = isEPP ? 'epp/v2': 'b2c';
			if( isEPP ){
				param.companyCode  = $('#eppCompanyCode').val();
				param.shopSkuYN  = "N";
				
				const eppIsUserGroupPricing = window.sg.epp.common.isUserGroupPricing;
				if(eppIsUserGroupPricing){
					param['groupName'] = window.sg.epp.common.groupName;
				}
				
				//[EPP] in refurbished   selector 
				let offerId = location.pathname.match(/[0-9]{13}/g);
				if ( offerId != null && typeof offerId != 'undefined' && $.trim(offerId) != '' ){
					param['offerId'] = offerId[0];
				}
			}
			
			if (isGPv2) {
				apiUrl = `${businessType}/product/card/detail/gpv2`;
			} else if (isHybrisNew) {
				apiUrl = `${businessType}/product/card/detail/newhybris`;
			} else if (isHybrisIntg) {
				apiUrl = `${businessType}/product/card/detail/hybris`;
			} else if( isB2BShop ){
				apiUrl = `b2b/product/card/detail`;
			}else {
				apiUrl = `${businessType}/product/card/detail/global`;
			}
			
			if(accModelList){
				
				param.siteCode = pageSiteCode;
				param.modelList = accModelList;
				param.saleSkuYN  = "N";
				param.onlyRequestSkuYN = "N";
				param.keySummaryYN = "N";
				param.specYN = "N";
				
				let dotcom_multistore = $.cookies.get("estoreSitecode") ? $.cookies.get("estoreSitecode").toString() : '';
				
				var shopSiteCd = '';
				if(siteCode === "ae" || siteCode ==="ae_ar"){
					if(isNotNull(dotcom_multistore)) {
						//NOTICE : dotcomMultistore     ae, ae_ar, kw, kw_ar, om, om_ar, bh, bh_ar, qa, qa_ar    
						om_multistore === "kw" || dotcom_multistore === "kw_ar" || dotcom_multistore === "om" || dotcom_multistore === "om_ar" || dotcom_multistore === "bh" || dotcom_multistore === "bh_ar" || dotcom_multistore === "qa" || dotcom_multistore === "qa_ar") {
							shopSiteCd = dotcom_multistore;
						} else {
							shopSiteCd = siteCode;
						}
					} else {
						shopSiteCd = siteCode;
					}
				} else if(siteCode === "levant"){
					shopSiteCd = "jo";
				} else if(siteCode === "levant_ar"){
					shopSiteCd = "jo_ar";
				} else if(siteCode === "n_africa"){
					shopSiteCd = "ma";
				}
				
				if(isNotNull(shopSiteCd)){
					param.shopSiteCode = shopSiteCd;
				}
				
				if(isGPv2 || isHybrisNew || isB2BShop){
					param.commonCodeYN  = "N";
				}
                
                if(isB2BShop){
                    param['shopType'] = 'b2bhybris';
                }
                
				$.ajax({
					url:  `${searchDomain}/${apiStageInfo}/${apiUrl}`,
					data: param,
					async:false,
					success: function (data) {

						if(data.response.statusCode === 200 && data.response.resultData.productList.length > 0){
							for(var pr=0; pr<data.response.resultData.productList.length; pr++){
								var tempProduct = data.response.resultData.productList[pr];
								
								var selectedIndex = 0;	// selected Y     index

								if(isNotNull(tempProduct.modelList) && tempProduct.modelList.length > 0){
									/* selected Y   index  .*/
									for(var cnt=0; cnt<tempProduct.modelList.length; cnt++){
										var tempModel = tempProduct.modelList[cnt];
										if(tempModel.selected !== undefined && tempModel.selected === "Y"){
											selectedIndex = cnt;
										}
									}
								}
								tempProduct.frontModelIdx = selectedIndex;
								
								tempProduct = getProductInfo(tempProduct);
								//product   productListData  
								productListData[productListIndex] = tempProduct;
								
								var refinedProduct = getProductModelInfo(tempProduct, selectedIndex);
								var createdHtml = buildProductCard(refinedProduct);
								returnHtml += '<div class="accessories__item js-acc-product-card" data-productidx='+productListIndex+'>';
								returnHtml += createdHtml;
								returnHtml += '</div>';
								productListIndex ++;
							}
						}
					}
				});
			}
			if(returnHtml){
				$('section.accessories').find('div.scrollbar__contents').html(returnHtml);
				productCardEventListener();
				$("section.accessories").show();
			}else{
				$("section.accessories").remove();
			}
			
		};

		if(accModelList){
			getRecentReseInit();
		
	});
	
	dynamic.accessoriesGrid = accessoriesGrid;

})(window, window.jQuery);
(() => {
  const $q = window.sg.common.$q;
  const libs = window.sg.common.libs;
  const setMobileFocusLoop = window.sg.common.utils.setMobileFocusLoop;
  const removeMobileFocusLoop = window.sg.common.utils.removeMobileFocusLoop;
  const utils = window.sg.common.utils;

  const selector = {
    section: '.contact-mail-form-popup',
    setFocus: null,
  };

  class Fn06ContactMailForm {
    constructor(component) {
      this.selector = {
        section: selector.section,
        closeCta: '.layer-popup__close',
        mailForm: '.contact-mail-form-popup__form',
        multiField: '.field--multi-text',
      };

      this.ele = {
        section: $q(component),
        window: $q(window),
        closeCta: null,
        mailForm: null,
        multiField: null,
      };

      this.handler = {
        focusLock: this.focusLock.bind(this),
        activePopup: this.activePopup.bind(this),
        closePopup: this.closePopup.bind(this),
        textLengCheck: this.textLengCheck.bind(this),
        formEnterPrevent: this.formEnterPrevent.bind(this),
        reCaptchaMate: this.reCaptchaMate.bind(this),
        mateCheckStop: this.mateCheckStop.bind(this),
      };

      Fn06ContactMailForm.instances.set(component, this);

      this.init();
    }

    init() {
      this.setProperty();
      this.bindEvents();
    }

    reInit() {
      this.setProperty();
      this.bindEvents();
    }

    setProperty() {
      this.ele.closeCta = this.ele.section.find(this.selector.closeCta);
      this.ele.mailForm = this.ele.section.find(this.selector.mailForm);
      this.ele.multiField = this.ele.mailForm.find(this.selector.multiField).find('.text-field-v2__input-multi-line');
      this.ele.formEl = this.ele.section.find('.contact-mail-form-popup__form-field input');

      this.activeCta = null;
    }

    bindEvents() {
      this.ele.closeCta.off('click', this.handler.closePopup).on('click', this.handler.closePopup);
      this.ele.multiField.off('input', this.handler.textLengCheck).on('input', this.handler.textLengCheck);
      this.ele.formEl.off('keypress', this.handler.formEnterPrevent).on('keypress', this.handler.formEnterPrevent);

      this.handler.textLengCheck();

      setTimeout(() => {
        utils.removeReCaptchaFrameBorder();
      }, 200);
    }

    focusLock(e) {
      if (e.keyCode === libs.keyCode.TAB_KEY) {
        const firstEl = this.activeTarget.find('a, button, input:not([type="hidden"]), textarea').target[0];

        if (e.shiftKey === false && this.activeTarget.find(this.selector.closeCta).target[0] === document.activeElement) {
          e.preventDefault();
          firstEl.focus();
        } else if (e.shiftKey === true && firstEl === document.activeElement) {
          e.preventDefault();
          this.activeTarget.find(this.selector.closeCta).focus();
        } else if (e.shiftKey === true && this.activeTarget.target[0] === document.activeElement) {
          e.preventDefault();
          this.activeTarget.find(this.selector.closeCta).focus();
        }
      }
    }

    activePopup(focusEl) {
      if (focusEl) {
        this.activeCta = $q(focusEl);
        selector.setFocus = focusEl;
      }

      // document.body.style.overflow = 'hidden';
      utils.hiddenScroll();

      this.activeTarget = this.ele.section;
      this.activeTarget.css({
        'display': 'block',
      });
      this.ele.window.off('keydown', this.handler.focusLock).on('keydown', this.handler.focusLock);

      const focusableEl = this.activeTarget.find('a, button, input:not([type="hidden"]), textarea').target[0];
      focusableEl.focus();

      if (document.querySelectorAll('[data-aria-hidden]').length <= 0) {
        setMobileFocusLoop(this.ele.section.target[0]);
      }
      window.sg.components.fn06ContactMailForm.reCaptchaHidden();

      const recaptchFocus = window.addEventListener('blur', () => {
        if (document.activeElement.nodeName === 'IFRAME') {
          window.sg.components.fn06ContactMailForm.reCaptchaMate();
        }
        window.removeEventListener('blur', recaptchFocus);
      });
    }

    closePopup() {
      // document.body.style.overflow = '';
      utils.visibleScroll();

      if (document.querySelectorAll('.recaptcha-challenge-popup').length > 0) {
        $q('.recaptcha-challenge-popup').removeClass('recaptcha-challenge-popup');
      }

      if (document.querySelectorAll('[data-aria-hidden]').length > 0) {
        removeMobileFocusLoop();
      }

      utils.changeInActiveReCaptchaProperty();
      this.requiredReset();

      if (this.activeCta !== null) {
        this.activeCta.focus();
      }

      this.ele.section.css({
        'display': 'none',
      });

      this.ele.window.off('keydown', this.handler.focusLock);
      this.activeTarget = null;
      this.activeCta = null;
    }

    formEnterPrevent(e){
      if (e.keyCode === libs.keyCode.ENTER) {
        e.preventDefault();
      }
    }

    textLengCheck(e) {
      const maxCharacter = 2000;
      if (e === undefined) {
        this.ele.mailForm.find('.text-field-v2.multi-line').target.forEach((el) => {
          const $el = $q(el).find('.text-field-v2__input-multi-line');
          const $assistiveEl = $q(el).find('.assistive');
          const $errorEl = $q(el).find('.error');
          const inputWidth = $q(el).target[0].offsetWidth;

          if ($el.target[0].value && !$q(el).hasClass('error')) {
            $assistiveEl.css({
              'display': 'block',
            });
            $el.attr('aria-describedby', $assistiveEl.attr('id'));
            $errorEl.css({
              'width': '',
            });
          } else if ($q(el).closest('.error').target.length > 0) {
            $assistiveEl.css({
              'display': 'block',
            });
            $el.attr('aria-describedby', `${$errorEl.attr('id')} ${$assistiveEl.attr('id')}`);
            $errorEl.css({
              'width': `${inputWidth - $assistiveEl.target[0].offsetWidth}px`,
            });
          } else {
            $assistiveEl.css({
              'display': 'none',
            });
            $el.removeAttr('aria-describedby');
            $errorEl.css({
              'width': '',
            });
          }
          $assistiveEl.text(`${$el.target[0].value.length}/${maxCharacter}`);
        });
      } else {
        const inputVal = e.target.value;
        const $assistiveEl = $q(e.target).closest('.multi-line').find('.assistive');
        const $errorEl = $q(e.target).closest('.multi-line').find('.error');
        const inputWidth = e.target.offsetWidth;

        if (inputVal && $q(e.target).closest('.error').target.length === 0) {
          $assistiveEl.css({
            'display': 'block',
          });
          $q(e.target).attr('aria-describedby', $assistiveEl.attr('id'));
          $errorEl.css({
            'width': '',
          });
        } else if ($q(e.target).closest('.error').target.length > 0) {
          $assistiveEl.css({
            'display': 'block',
          });
          $q(e.target).attr('aria-describedby', `${$errorEl.attr('id')} ${$assistiveEl.attr('id')}`);
          $errorEl.css({
            'width': `${inputWidth - $assistiveEl.target[0].offsetWidth}px`,
          });
        } else {
          $assistiveEl.css({
            'display': 'none',
          });
          $q(e.target).removeAttr('aria-describedby');
          $errorEl.css({
            'width': '',
          });
        }
        $assistiveEl.text(`${inputVal.length}/${maxCharacter}`);
      }
    }

    reCaptchaMate() {
      const dirCheck = $q('html').css('direction');
      if ($q('.contact-mail-form-popup').css('display') === 'block') {
        const leCaptchaSrc = $q('.contact-mail-form-popup__iframe-inner iframe[title]').attr('src');
        const leCaptchaKey = leCaptchaSrc.substring(
          ('https://www.google.com/recaptcha/api2/anchor?ar=1&k=').length,
          leCaptchaSrc.indexOf('&co='));

        this.targetIframe = [];

        [...document.querySelectorAll('iframe[sandbox]')].forEach((el) => {
          const src = el.getAttribute('src');

          if (src.indexOf(leCaptchaKey) >= 0 && $q(el).closest('.contact-mail-form-popup').target.length < 1 && $q(el).closest('.ready-to-buy__iframe').target.length < 1  && $q(el).closest('.contact-mail-form__iframe').target.length < 1) {
            this.targetIframe.push(el);
            el.parentNode.parentNode.classList.add('recaptcha-challenge-popup');
            if (dirCheck === 'rtl') {
              el.parentNode.parentNode.classList.add('recaptcha-popup-resizing');
            }
          }
        });
      }
    }

    mateCheckStop() {
      if (this.addMate !== null) {
        clearInterval(this.addMate);
        this.addMate = null;
      }
    }

    requiredCheck() {
      this.ele.section.find('.field--checkbox.is-required').target.forEach((el) => {
        const requiredChecked = el.querySelectorAll('.checkbox-v2__input:checked').length;
        const requiredText = $q(el).find('.checkbox--required-text');
        const requiredError = $q(el).find('.checkbox--error-text');
        if ($q(el).find('.field--checkbox-list-wrap').target.length <= 0) {
          if (requiredChecked <= 0) {
            requiredError.attr('aria-hidden', true);
            requiredText.attr('aria-hidden', false);
            $q(el).find('.checkbox-v2__input').attr('aria-describedby', requiredError.attr('id'));
          } else {
            requiredError.attr('aria-hidden', false);
            requiredText.attr('aria-hidden', true);
            $q(el).find('.checkbox-v2__input').attr('aria-describedby', requiredText.attr('id'));
          }
        }
      });
    }

    requiredReset(){
      this.ele.section.find('.field--checkbox.is-required').target.forEach((el) => {
        const requiredInput = $q(el).find('.checkbox-v2__input');
        const requiredText = $q(el).find('.checkbox--required-text');
        const requiredError = $q(el).find('.checkbox--error-text');

        if ($q(el).find('.field--checkbox-list-wrap').target.length <= 0) {
          requiredInput.attr('aria-describedby', requiredText.attr('id'));
          requiredText.attr('aria-hidden', true);
          requiredError.removeAttr('aria-hidden');
        }
      });
      this.ele.mailForm.find('.text-field-v2.multi-line').target.forEach((el) => {
        const $el = $q(el).find('.text-field-v2__input-multi-line');
        $el.removeAttr('aria-describedby');
      });
    }
  }

  function init(){
    $q(selector.section).target.forEach((element) => {
      if (!Fn06ContactMailForm.instances.has(element)) {
        new Fn06ContactMailForm(element);
      } else {
        const instances =  Fn06ContactMailForm.instances.get(element);
        instances.reInit();
      }
    });
  }

  function reInit(){
    $q(selector.section).target.forEach((element) => {
      if (Fn06ContactMailForm.instances.has(element)) {
        const instances =  Fn06ContactMailForm.instances.get(element);
        instances.reInit();
      } else {
        new Fn06ContactMailForm(element);
      }
    });
  }

  /**
  //  @param       : focus element
  //  @description : set focus elememt when call closePopup.
  //  @example : window.sg.components.fn06ContactMailForm.activePopup(this);
  **/
  function activePopup(focusEl) {
    $q(selector.section).target.forEach((element) => {
      if (Fn06ContactMailForm.instances.has(element)) {
        const instances =  Fn06ContactMailForm.instances.get(element);
        instances.activePopup(focusEl);
      }
    });
  }

  function closePopup() {
    $q(selector.section).target.forEach((element) => {
      if (Fn06ContactMailForm.instances.has(element)) {
        const instances =  Fn06ContactMailForm.instances.get(element);
        instances.closePopup();
      }
    });
  }

  function textLengCheck() {
    $q(selector.section).target.forEach((element) => {
      if (Fn06ContactMailForm.instances.has(element)) {
        const instances =  Fn06ContactMailForm.instances.get(element);
        instances.textLengCheck();
      }
    });
  }

  function recatchaHiddenProperty() {
    utils.removeReCaptchaFrameBorder();
  }

  function reCaptchaHidden(){
    utils.changeActiveReCaptchaProperty();
    $q(selector.section).target.forEach((el) => {
      $q(el).find('[title="reCAPTCHA"]').removeAttr('aria-hidden');
      if (/Android/i.test(navigator.userAgent)) {
        $q(el).find('[title="reCAPTCHA"]').attr('role', 'presentation');
      }
    });
  }

  function reCaptchaMate(){
    $q(selector.section).target.forEach((element) => {
      if (Fn06ContactMailForm.instances.has(element)) {
        const instances =  Fn06ContactMailForm.instances.get(element);
        instances.reCaptchaMate();
      }
    });
  }

  function mateCheckStop(){
    $q(selector.section).target.forEach((element) => {
      if (Fn06ContactMailForm.instances.has(element)) {
        const instances =  Fn06ContactMailForm.instances.get(element);
        instances.mateCheckStop();
      }
    });
  }

  function requiredCheck() {
    $q(selector.section).target.forEach((element) => {
      if (Fn06ContactMailForm.instances.has(element)) {
        const instances =  Fn06ContactMailForm.instances.get(element);
        instances.requiredCheck();
      }
    });
  }

  Fn06ContactMailForm.instances = new WeakMap();

  window.sg.components.fn06ContactMailForm = {
    selector,
    init,
    reInit,
    activePopup,
    closePopup,
    textLengCheck,
    reCaptchaHidden,
    recatchaHiddenProperty,
    reCaptchaMate,
    mateCheckStop,
    requiredCheck,
  };

  $q.ready(init);
})();

var mailformPopup= {};
;(function ($, document) {
	"use strict";
	var contents = $(".contact-mail-form-popup .contact-mail-form-popup__contents");
	var siteCode = $('#siteCode').val();
	
    //mail form Validation
    function isMailValidCheck(){
		var validCheck = true;
		contents.find(".contact-mail-form-popup__form-field.is-required").find("select,textarea,input[data-form-name]:not(.checkbox-v2__input, .radio-v2__input)").each(function(){
			//input, message
			var $target = $(this);
			if($target.val() == null || $target.val() === ''){
				validCheck = false;
				$target.closest('.text-field-v2, .menu--text-field').addClass("error");
				if($target.hasClass('text-field-v2__input') || $target.hasClass('text-field-v2__input-multi-line')){
					$target.attr("aria-describedby",$target.attr('id')+'_err');
					$target.closest('.text-field-v2').find('.text-field-v2__text.error').attr("id",$target.attr('id')+'_err');
				}else if($target.hasClass('menu__select')){
					$target.closest('.menu--text-field').find('.menu__select-field').attr("aria-describedby",$target.closest('.menu--text-field').find('.menu--text-field__hint').attr('id')+'_err');
					$target.closest('.menu--text-field').find('.menu--text-field__error').attr("id",$target.closest('.menu--text-field').find('.menu--text-field__hint').attr('id')+'_err').attr("aria-hidden","true");
					$target.closest('.menu--text-field').find('.menu__select').attr("aria-labelledby",$target.closest('.menu--text-field').find('p').attr('id')+" "+$target.closest('.menu--text-field').find('.menu--text-field__hint').attr('id')+'_err');
					$target.closest('.menu--text-field').find('.text-field--required-text').attr("aria-hidden","true");
				}
			}else{
				$target.closest('.text-field-v2, .menu--text-field').removeClass("error");
				if($target.hasClass('text-field-v2__input') || $target.hasClass('text-field-v2__input-multi-line')){
					$target.removeAttr("aria-describedby");
					$target.closest('.text-field-v2').find('.text-field-v2__text.error').removeAttr("id");
				}else if($target.hasClass('menu__select')){
					$target.closest('.menu--text-field').find('.menu__select-field').removeAttr("aria-describedby");
					$target.closest('.menu--text-field').find('.menu--text-field__error').removeAttr("id").removeAttr("aria-hidden");
					$target.closest('.menu--text-field').find('.menu__select').attr("aria-labelledby",$target.closest('.menu--text-field').find('p').attr('id'));
					$target.closest('.menu--text-field').find('.text-field--required-text').removeAttr("aria-hidden");
				}
			}
		});
		
		//checked list
		var name = ""
		contents.find(".contact-mail-form-popup__form-field.checkbox--list.is-required").find("input[data-form-name].checkbox-v2__input").each(function(){
			var $target = $(this);
			if(name !== $target.attr('data-form-name')){
				name = $target.attr('data-form-name');
				if(!$target.closest('.contact-mail-form-popup__form-field').find("input[data-form-name]").is(':checked')){
					validCheck = false;
					$target.closest('.field--checkbox-list-wrap').addClass("error");
					$target.closest('.contact-mail-form-popup__form-field').find('fieldset legend span').text('* '+Granite.I18n.get("This checkbox is required"));
				}else{
					$target.closest('.field--checkbox-list-wrap').removeClass("error");
					$target.closest('.contact-mail-form-popup__form-field').find('fieldset legend span').text('* '+Granite.I18n.get("Required"));
				}
			}
		});
		
		//checked checkbox
		contents.find(".contact-mail-form-popup__form-field.field--checkbox.is-required:not(.checkbox--list)").find("input[data-form-name].checkbox-v2__input").each(function(){
			var $target = $(this);
			if(name !== $target.attr('data-form-name')){
				name = $target.attr('data-form-name');
				if(!$target.closest('.contact-mail-form-popup__form-field').find("input[data-form-name]").is(':checked')){
					validCheck = false;
					$target.closest('.field--checkbox-wrap').addClass("error");
				}else{
					$target.closest('.field--checkbox-wrap').removeClass("error");
				}
			}
		});
		
		//radio
		contents.find(".contact-mail-form-popup__form-field.radio--list.is-required").find("input[data-form-name].radio-v2__input").each(function(){
			var $target = $(this);
			if(name !== $target.attr('data-form-name')){
				name = $target.attr('data-form-name');
				if(!$target.closest('.contact-mail-form-popup__form-field').find("input[data-form-name]").is(':checked')){
					validCheck = false;
					$target.closest('.field--radio-list-wrap').addClass("error");
					$target.closest('.contact-mail-form-popup__form-field').find('fieldset legend span').text('* '+Granite.I18n.get("This field is required"));
				}else{
					$target.closest('.field--radio-list-wrap').removeClass("error");
					$target.closest('.contact-mail-form-popup__form-field').find('fieldset legend span').text('* '+Granite.I18n.get("Required"));
				}
			}
		});
		
		//,        
		if(contents.find("input[data-form-name='Telephone']")){
			var telephoneVal = contents.find("input[data-form-name='Telephone']").val();
			contents.find("input[data-form-name='Telephone']").attr("aria-describedby",contents.find("input[data-form-name='Telephone']").attr('id')+'_err');
			contents.find("input[data-form-name='Telephone']").closest('.text-field-v2').find('.text-field-v2__text.error').attr("id",contents.find("input[data-form-name='Telephone']").attr('id')+'_err');
			if(contents.find("input[data-form-name='Telephone']").closest('.contact-mail-form-popup__form-field').hasClass('is-required') && (telephoneVal == null || telephoneVal === '')){
				validCheck = false;
				contents.find("input[data-form-name='Telephone']").closest('.contact-mail-form-popup__form-field').find('.text-field-v2__text').text('* '+Granite.I18n.get("This field is required"));
				contents.find("input[data-form-name='Telephone']").closest('.text-field-v2').addClass("error");
			}else if(telephoneVal != null && telephoneVal !== '' && !phoneNumberCheck(telephoneVal)){
				validCheck = false;
				contents.find("input[data-form-name='Telephone']").closest('.contact-mail-form-popup__form-field').find('.text-field-v2__text').text(Granite.I18n.get("Please enter a valid telephone number"));
				contents.find("input[data-form-name='Telephone']").closest('.text-field-v2').addClass("error");
			}else{
				contents.find("input[data-form-name='Telephone']").closest('.text-field-v2').removeClass("error");
				contents.find("input[data-form-name='Telephone']").removeAttr("aria-describedby");
				contents.find("input[data-form-name='Telephone']").closest('.text-field-v2').find('.text-field-v2__text.error').removeAttr("id");
			}
		}
		
		if(contents.find("input[data-form-name='EmailAddress']")){
			var telephoneVal = contents.find("input[data-form-name='EmailAddress']").val();
			contents.find("input[data-form-name='EmailAddress']").attr("aria-describedby",contents.find("input[data-form-name='EmailAddress']").attr('id')+'_err');
			contents.find("input[data-form-name='EmailAddress']").closest('.text-field-v2').find('.text-field-v2__text.error').attr("id",contents.find("input[data-form-name='EmailAddress']").attr('id')+'_err');
			if(contents.find("input[data-form-name='EmailAddress']").closest('.contact-mail-form-popup__form-field').hasClass('is-required') && (telephoneVal == null || telephoneVal === '')){
				validCheck = false;
				contents.find("input[data-form-name='EmailAddress']").closest('.contact-mail-form-popup__form-field').find('.text-field-v2__text').text('* '+Granite.I18n.get("This field is required"));
				contents.find("input[data-form-name='EmailAddress']").closest('.text-field-v2').addClass("error");
			}else if(telephoneVal != null && telephoneVal !== '' && !emailCheck(telephoneVal)){
				validCheck = false;
				contents.find("input[data-form-name='EmailAddress']").closest('.contact-mail-form-popup__form-field').find('.text-field-v2__text').text(Granite.I18n.get("Please enter a valid E-mail address"));
				contents.find("input[data-form-name='EmailAddress']").closest('.text-field-v2').addClass("error");
			} else if( siteCode !== 'fr' && telephoneVal.indexOf("@samsung.com") > -1 ){
				validCheck = false;
				contents.find("input[data-form-name='EmailAddress']").closest('.contact-mail-form-popup__form-field').find('.text-field-v2__text').text(Granite.I18n.get("Samsung.com email address is not allowed. Please input other email address."));
				contents.find("input[data-form-name='EmailAddress']").closest('.text-field-v2').addClass("error");
			}else{
				contents.find("input[data-form-name='EmailAddress']").closest('.text-field-v2').removeClass("error");
				contents.find("input[data-form-name='EmailAddress']").removeAttr("aria-describedby");
				contents.find("input[data-form-name='EmailAddress']").closest('.text-field-v2').find('.text-field-v2__text.error').removeAttr("id");
			}
		}
		
		//Recaptcha 
		if(typeof conRecaptcha !== 'undefined' && conRecaptcha != null && $('#captchaOptionFlag').val() !== 'Y'){
			if(grecaptcha.getResponse(conRecaptcha) === ''){
				validCheck = false;
				grecaptcha.reset(conRecaptcha);
				window.sg.components.fn06ContactMailForm.recatchaHiddenProperty();
				contents.find(".invalid-notice").show();
				reCaptchaMate();
			}else{
				contents.find(".invalid-notice").hide();
			}
		}
		return validCheck;
	}
	
    
    // Phone Number validation
    function phoneNumberCheck( number ) {
    	var numberValue = number.replace(/\+/g, '').replace(/-/g, '');
    	var check = /^[-0-9]*$/;
        if ( !check.test(numberValue)) { 
            return false; 
        } else {
            return true; 
        } 
    }
    
    // Email validation
    function emailCheck( email ) {
        var regex=/^([\w\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
        return regex.test(email) && !/\s/g.test(email);
    }
        
	function getformData(){
		var formData= {};
		contents.find(".contact-mail-form-popup__form-field").find("select,textarea,input[data-form-name]").each(function(){
			var flage = true;
			var $target = $(this);
			var value = $target.val();
			if($target.prop('type') === 'checkbox' || $target.prop('type') === 'radio'){
				if($target.attr('data-form-name') ==='PrivacyPolicy' || $target.attr('data-form-name') ==='OptIn' ){
					if($target.prop('checked')){
						value = "Y"; 
					}else{
						value = "N";
					}
				}else{
					if(!$target.prop('checked')){
						flage = false;
					}					
				}
			}
			if(flage){
				if(formData[$target.attr("data-form-name")] == null){
	        		formData[$target.attr("data-form-name")] = value;
	        	}else{
	        		formData[$target.attr("data-form-name")] = formData[$target.attr("data-form-name")]+";"+value;
	        	}
			}
		});

		
		formData["DivisionId"] = getDivisionId();
        formData["PageURL"] = getCurrentPath();
        formData["Breadcrumb"] = getBreadCrumb();
        formData["InquiryType"] = $("#inquiryType").val();
        formData["Subsidiary"] = $("#Subsidiary").val();
        //OptIn -> Optin 
        if(formData["OptIn"] != null){
    		formData["Optin"] = formData["OptIn"];
    		delete formData["OptIn"];
    	}

        if(typeof conRecaptcha !== 'undefined' && conRecaptcha != null){
            var captchaData = grecaptcha.getResponse(conRecaptcha);
            formData["g-recaptcha-response"] = captchaData;        	
        }
        
        return formData;
    }
    
	function getDivisionId(){
        var result = {};
        var divistionIDMap = {
            'Mobile' : 'IM',
            'Computing' : 'IM',
            'Displays' : 'VD EBT',
            'Home Appliance' : 'DA',
            'Climate' : 'SEACE',
            'Memory' : 'Memory',
            'Healthcare' : 'Healthcare',
        	'Networks' : 'Networks',
    		'Compressor' : 'Compressor'
        }

        contents.find('input[data-form-name="ProductSolution"]:checked').each(function(){
			//input, message
			var $target = $(this);
			result[divistionIDMap[$target.attr('data-orignal')]] = divistionIDMap[$target.attr('data-orignal')];
		});
        
        return  Object.keys(result).join(';') ;
    }
    
	
	function getBreadCrumb(){
        const breadCrumb = $('.nv-g-breadcrumb .breadcrumb__text-desktop');
        const result = [];
        
        breadCrumb.each( ( index, item )=>{
            result.push( $(item).text() );
        });

        return result.join('>');
    }
    
    function getCurrentPath(){
        return window.location.href;
    }

    
	/**
	 * reCaptcha 
	 */	
	function checkReCaptcha(){	
		var url = "/aemapi/v6/business/common/contactus";
		var formData = getformData();
		formData["grecaptcha"] = "grecaptcha";
		formData["LeadSource"] = "Eloqua_Web Sales Inquiry";
		formData["CountryCode"] = siteCode;

	    if(typeof conRecaptcha === 'undefined' || conRecaptcha == null || $('#captchaOptionFlag').val() === 'Y'){
            url = "/aemapi/v6/business/common/directcontactus";
        }
        _satellite.setVar("common_value", "contact mail popup:request a call back:submit");
		_satellite.track("common_dc");

		$.ajax({
			type: "post",
			url: url,
			data: formData,
			dataType: "json",
			success: function (data) {
				if (data.response.statusCode == "200") {
					contents.find(".invalid-notice").hide();
					var successTitle = $("#fn06_headlineText").val();
					var successMessageDesc = $("#fn06_description").val();
					var headlineHeadingLevel = $("#fn06_headlineHeadingLevel").val();
					
					if(successTitle == null || successTitle === ''){
						successTitle = Granite.I18n.get("Thank you!");
					}
					
					if(successMessageDesc == null || successMessageDesc === ''){
						successMessageDesc = Granite.I18n.get("Your enquiry has been successfully submitted. We will get back to you shortly.");
					}
    				/*****send  .*****/
					var popupTtitle = '<'+headlineHeadingLevel+' class="layer-popup__title">'+successTitle+'</'+headlineHeadingLevel+'>';
    				$(".thank-you-popup .layer-popup__title").replaceWith(popupTtitle);
    				$(".thank-you-popup .thank-you-popup__description").text(successMessageDesc);
    				
    				var targetFocus = window.sg.components.fn06ContactMailForm.selector.setFocus;
    				
    				window.sg.components.fn06ContactMailForm.closePopup();
    				window.sg.components.thankYouPopup.activePopup(targetFocus);

				}else{
					if(typeof conRecaptcha !== 'undefined' && conRecaptcha != null){
						grecaptcha.reset(conRecaptcha);
						window.sg.components.fn06ContactMailForm.recatchaHiddenProperty();
						contents.find(".invalid-notice").show();
						reCaptchaMate();
					}
				}
			},
			erorr: function (e) {                	
				console.log(e);
			}
		});
	}
	
	/**
	 * resetMailForm
	 */	
	function resetMailForm(){
		contents.find('input[type="text"]').each((index,item)=>{
			$(item).val('');
			$(item).closest('.text-field-v2').removeClass('active').removeClass('delete').removeClass('error');
			$(item).removeAttr("aria-describedby");
			$(item).closest('.text-field-v2').find('.text-field-v2__text.error').removeAttr("id");
        })

        contents.find('select').each((index,item)=>{
            const $wrapper = $(item).closest('.menu--text-field');
            if( $wrapper.length > 0 ){
                $(item).val('');
                $wrapper.removeClass('selected');
                $wrapper.find('.menu__list-option-wrap.active').removeClass('active');
                $wrapper.find('.menu__select-field').removeAttr("aria-describedby");
                $wrapper.find('.menu--text-field__error').removeAttr("id").removeAttr("aria-hidden");
				$wrapper.find('.menu__select').attr("aria-labelledby",$wrapper.closest('.menu--text-field').find('p').attr('id'));
                $wrapper.find('.text-field--required-text').removeAttr("aria-hidden");
				
            }
        })
        contents.find('.menu__select-field-text').text('');
		
        contents.find('textarea').each((index,item)=>{
            $(item).val('');
            $(item).closest('.text-field-v2').removeClass('active').removeClass('delete').removeClass('error');
        })

        contents.find('fieldset legend span').text('* '+Granite.I18n.get("Required"));
        contents.find('input[type="checkbox"]:checked').each((index,item)=>{
            $(item).prop("checked", false);
        })
		contents.find('input[type="checkbox"]:checked, input[type="radio"]:checked').each((index,item)=>{
            $(item).prop("checked", false);
        })
        contents.find('.field--checkbox-list-wrap, .field--radio-list-wrap, .menu--text-field, .field--checkbox-wrap, .field--radio-wrap').removeClass('active').removeClass('delete').removeClass('error');
        contents.find(".invalid-notice").hide();
	}
	
	/**
	 * eloquaSubmit
	 */	
	function eloquaSubmit(){
        var appendDom = contents.find('.append-from-data');
        
        appendDom.html('');
        var formData = getformData();
        for( var item of Object.keys(formData) ){
            appendDom.append($('<input/>', {type: 'hidden', name: item, value:formData[item]}));
        }
        
        _satellite.setVar("common_value", "contact mail popup:request a call back:submit");
		_satellite.track("common_dc");
        
    	var contactMmailFormPopUp = contents.find("form[name=contact-mail-form-popup__form]").serialize();
    	$.ajax({
			type: "post",
			url: $('#eloquaPostUrl').val(),
			data: contactMmailFormPopUp,
			success: function (data) {
				contents.find(".invalid-notice").hide();
				var successTitle = $("#fn06_headlineText").val();
				var successMessageDesc = $("#fn06_description").val();
				var headlineHeadingLevel = $("#fn06_headlineHeadingLevel").val();
				
				if(successTitle == null || successTitle === ''){
					successTitle = Granite.I18n.get("Thank you!");
				}
				
				if(successMessageDesc == null || successMessageDesc === ''){
					successMessageDesc = Granite.I18n.get("Your enquiry has been successfully submitted. We will get back to you shortly.");
				}
				/*****send  .*****/
				var popupTtitle = '<'+headlineHeadingLevel+' class="layer-popup__title">'+successTitle+'</'+headlineHeadingLevel+'>';
				$(".thank-you-popup .layer-popup__title").replaceWith(popupTtitle);
				$(".thank-you-popup .thank-you-popup__description").text(successMessageDesc);
				
				var targetFocus = window.sg.components.fn06ContactMailForm.selector.setFocus;
				
				window.sg.components.fn06ContactMailForm.closePopup();
				window.sg.components.thankYouPopup.activePopup(targetFocus);
			}
    	});        	
	}
	
	// submit button click
	$(".contact-mail-form-popup .contact-mail-form-popup__contents .cta--contained").on("click", function() {
		if(!isMailValidCheck()){
			window.sg.components.fn06ContactMailForm.requiredCheck();
			contents.find('.text-field-v2.error, .checkbox--list .field--checkbox-list-wrap.error, .field--radio .field--radio-list-wrap.error, .field--checkbox .field--checkbox-wrap.error, .menu--text-field.error').eq(0).find('input, textarea, button').eq(0).focus();
		}else{
			if ($('#eloquaYn').val() === "Y" && $('#eloquaPostUrl').val() !== '') {
				eloquaSubmit();
			} else {
				checkReCaptcha();
			}
		}
	});

	function reCaptchaMate() {
		window.sg.components.fn06ContactMailForm.reCaptchaMate();
	};
	
	function showPopup(targetFocus, targetType) {
		if($('.contact-mail-form-popup .layer-popup').length < 1){
			return;
		}
		
		// 
		resetMailForm();
		
		if(targetFocus == null){
			window.sg.components.fn06ContactMailForm.activePopup($(':focus'));
		}else{
			window.sg.components.fn06ContactMailForm.activePopup(targetFocus);
		}
		if(targetType === 'PD'){
			contents.find('.cta--contained').attr("an-tr","contact mail form_popup type|cta");
			contents.find('.cta--contained').attr("an-la","make a request:send");
		}
		if(typeof conRecaptcha !== 'undefined' && conRecaptcha != null){
	        grecaptcha.reset(conRecaptcha);
	        window.sg.components.fn06ContactMailForm.recatchaHiddenProperty();
			reCaptchaMate();
		}
	};
	
	mailformPopup = (function(){
		return {
			showPopup : showPopup
		}
	})();
	
})(window.jQuery, window.document);
(() => {
  const $q = window.sg.common.$q;
  const libs = window.sg.common.libs;
  const utils = window.sg.common.utils;
  const setMobileFocusLoop = window.sg.common.utils.setMobileFocusLoop;
  const removeMobileFocusLoop = window.sg.common.utils.removeMobileFocusLoop;

  const selector = {
    section: '.thank-you-popup',
  };

  class ThankYouPopup {
    constructor(component) {
      this.selector = {
        section: selector.section,
        closeCta: '.layer-popup__close',
        cancelCta: '.cta--closed',
      };

      this.ele = {
        section: $q(component),
        window: $q(window),
      };

      this.handler = {
        focusLock: this.focusLock.bind(this),
        activePopup: this.activePopup.bind(this),
        closePopup: this.closePopup.bind(this),
      };

      ThankYouPopup.instances.set(component, this);

      this.init();
    }

    init() {
      this.setProperty();
      this.bindEvents();
    }

    reInit() {
      this.setProperty();
      this.bindEvents();
    }

    setProperty() {
      this.ele.closeCta = this.ele.section.find(this.selector.closeCta);
      this.ele.cancelCta = this.ele.section.find(this.selector.cancelCta);
      this.activeCta = null;
    }

    bindEvents() {
      this.ele.closeCta.off('click', this.handler.closePopup).on('click', this.handler.closePopup);
      this.ele.cancelCta.off('click', this.handler.closePopup).on('click', this.handler.closePopup);
    }

    focusLock(e) {
      if (e.keyCode === libs.keyCode.TAB_KEY) {
        const firstEl = this.ele.section.find('a, button').target[0];

        if (e.shiftKey === false && this.ele.section.find(this.selector.closeCta).target[0] === document.activeElement) {
          e.preventDefault();
          firstEl.focus();
        } else if (e.shiftKey === true && firstEl === document.activeElement) {
          e.preventDefault();
          this.ele.section.find(this.selector.closeCta).focus();
        } else if (e.shiftKey === true && this.ele.section.target[0] === document.activeElement) {
          e.preventDefault();
          this.ele.section.find(this.selector.closeCta).focus();
        }
      }
    }

    activePopup(focusEl) {
      if (focusEl) {
        this.activeCta = $q(focusEl);
      }
      utils.hiddenScroll();
      this.ele.section.css({
        'display': 'block',
      });
      this.ele.window.off('keydown', this.handler.focusLock).on('keydown', this.handler.focusLock);

      const focusableEl = this.ele.section.find('a, button').target[0];
      focusableEl.focus();

      if (document.querySelectorAll('[data-aria-hidden]').length <= 0) {
        setMobileFocusLoop(this.ele.section.target[0]);
      }

      utils.changeActiveReCaptchaProperty();
    }

    closePopup(e) {
      if (e !== undefined) {
        e.preventDefault();
      }

      if (document.querySelectorAll('[data-aria-hidden]').length > 0) {
        removeMobileFocusLoop();
      }

      utils.changeInActiveReCaptchaProperty();

      if (this.activeCta !== null) {
        this.activeCta.focus();
      }

      utils.visibleScroll();
      this.ele.section.css({
        'display': 'none',
      });
      this.ele.window.off('keydown', this.handler.focusLock);

      this.activeCta = null;
    }
  }

  function init(){
    $q(selector.section).target.forEach((element) => {
      new ThankYouPopup(element);
    });
  }

  function reInit(){
    $q(selector.section).target.forEach((element) => {
      if (ThankYouPopup.instances.has(element)) {
        const instances =  ThankYouPopup.instances.get(element);
        instances.reInit();
      } else {
        new ThankYouPopup(element);
      }
    });
  }

  /**
  //  @param       : focus element(value of id attribute)
  //  @description : set focus when closed Popup.
  //  @example : window.sg.components.thankYouPopup.activePopup(document.querySelector('#focus-cta'))
  **/
  function activePopup(focusEl) {
    $q(selector.section).target.forEach((element) => {
      if (ThankYouPopup.instances.has(element)) {
        const instances =  ThankYouPopup.instances.get(element);
        instances.activePopup(focusEl);
      }
    });
  }

  function closePopup() {
    $q(selector.section).target.forEach((element) => {
      if (ThankYouPopup.instances.has(element)) {
        const instances =  ThankYouPopup.instances.get(element);
        instances.closePopup();
      }
    });
  }

  function reCaptchaHidden(){
    utils.changeActiveReCaptchaProperty();
  }

  ThankYouPopup.instances = new WeakMap();

  window.sg.components.thankYouPopup = {
    init,
    reInit,
    activePopup,
    closePopup,
    reCaptchaHidden,
  };

  $q.ready(init);
})();

