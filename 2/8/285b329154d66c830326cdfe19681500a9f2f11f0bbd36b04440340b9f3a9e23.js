(function(CURRENT_SCOPE){if(window.Datetime){throw new Error("Datetime already loaded")}function Package(){if(typeof window.JSON!=="object"){window.JSON={}}());(function(CURRENT_SCOPE){CURRENT_SCOPE.Log=(function(){var STATIC={},PUBLIC_STATIC;STATIC.instances={};STATIC.entries=[];STATIC.handlers=[];STATIC.EXP_SNIFF_FROM_USER_AGENT=/msie/i;STATIC.dumpingOnBrowsersConsole=false;STATIC.LogEntry=function LogEntry(instance,entry,details){this.id=instance.id;this.recordDate=new Date();this.instanceStartupDate=instance.startup;this.name=typeof entry==="object"&&entry.name?entry.name:"checkpoint";this.details=details||(typeof entry==="object"?entry:null);if(entry instanceof Error){this.name=entry.name||"ApplicationError";this.message="[EXCEPTION : "+this.name+"] → "+entry.message}else{if(typeof entry==="object"){this.message=entry.message||window.JSON.stringify(entry)}else{this.message=entry}}this.friendlyDescription="["+this.id+(this.name==="checkpoint"?"":" : "+this.name)+"] → "+this.message};STATIC.browsersConsoleHandler=function(message){var entry=this,containerElement,writingMethod,entryElement;if(window.console&&window.console.log){if(window.console[entry.name]){writingMethod=entry.name}else{switch(entry.name){case"warning":writingMethod=window.console.warn?"warn":"log";break;case"critical":writingMethod=window.console.error?"error":"log";break;default:writingMethod="log"}}if(entry.details){entry.friendlyDescription+=" → [Details] ↓↓↓";if(STATIC.EXP_SNIFF_FROM_USER_AGENT.test(navigator.userAgent)&&window.JSON){entry.details=window.JSON.stringify(entry.details,null,true)}}if(window.console[writingMethod].apply){window.console[writingMethod].apply(window.console,[entry.friendlyDescription]);if(entry.details){window.console.log.apply(window.console,[entry.details])}}else{window.console[writingMethod](entry.friendlyDescription);if(entry.details){window.console.log(entry.details)}}}};PUBLIC_STATIC=function Log(id){if(typeof id!=="string"){throw"Invalid log id. You must pass a string to this constructor"}if(STATIC.instances[id]){return STATIC.instances[id]}var PRIVATE={},PUBLIC=this;PRIVATE.entries=[];PRIVATE.handlers=[];PRIVATE.print=function(entry,handlers){var i;handlers=handlers instanceof Array?handlers:[handlers];for(i=0;i<handlers.length;i++){try{handlers[i].call(entry,entry.friendlyDescription)}catch(error){error.message="[Exception caught while handling a log entry] → "+error.message+" \nentry →"+window.JSON.stringify(entry);throw error}}};PUBLIC.id=id;PUBLIC.startup=new Date();PUBLIC.write=function(entry,details){entry=new STATIC.LogEntry(PUBLIC,entry,details);PRIVATE.entries.push(entry);if(!PRIVATE.handlers.length){return}PRIVATE.print(entry,PRIVATE.handlers)};PUBLIC.setHandler=function(customHandler){if(typeof customHandler!="function"&&customHandler!=="BROWSERS_CONSOLE"){throw'Invalid log handler. You must pass a function as the only parameter. You can use de string "BROWSERS_CONSOLE" as well...'}var i,entry;if(customHandler==="BROWSERS_CONSOLE"){if(STATIC.dumpingOnBrowsersConsole){return}customHandler=STATIC.browsersConsoleHandler;PRIVATE.handlers.push(customHandler);STATIC.dumpingOnBrowsersConsole=true}else{PRIVATE.handlers.push(customHandler)}for(i=0;i<PRIVATE.entries.length;i++){entry=PRIVATE.entries[i];PRIVATE.print(entry,customHandler)}return PUBLIdlers.length=0}};PUBLIC_STATIC.reset=function(){var id,instance;for(id in STATIC.instances){if(STATIC.instances.hasOwnProperty(id)){instance=STATIC.instances[id];instance.reset()}}STATIC.instances={}};return PUBLIC_STATIC}())}(this));(function(CURRENT_SCOPE){CURRENT_SCOPE.requestJSONP=(function(){var STATIC={};STATIC.data={};STATIC.callbacks={};STATIC.log=new CURRENT_SCOPE.Log("requestJSONP");return function(settings){var script,timer;script=document.createElement("script");script.type="text/javascript";script.charset="utf-8";script.async=true;script.onload=script.onreadystatechange=function(){if(!this.readyState||this.readyState=="loaded"||this.readyState=="complete"){var src=this.src;this.onload=this.onreadystatechange=null;window.setTimeout(function(){var scripts=document.getElementsByTagName("script"),callbacks=STATIC.callbacks[src],values=STATIC.data[settings.transporter],url,currentSettings,currentValue,i;try{if(!callbacks||!callbacks.length){throw new Error('No callbacks found for request "'+src+'".')}currentSettings=callbacks.shift();currentValue=values.shift();STATIC.log.write("Response received from "+currentSettings.url);if(currentSettings.timer){window.clearTimeout(currentSettings.timer)}currentSettings.success.apply(currentSettings,currentValue)}catch(error){error.message="Error handling response from "+src+'. Check out the "success" callback → '+error.message;if(currentSettings&&typeof currentSettings.error=="function"){currentSettings.error.call(currentSettings,error)}}},0)}};if(script.addEventListener){script.addEventListener("error",function(event){var error=new Error("Error loading "+script.src);STATIC.log.write(error,settings);try{settings.error(error,event)}catch(e){e.message="Error handling response from "+settings.url+'. Check out the "success" callback → '+e.message;STATIC.log.write(error)}},true)}script.src=settings.url;if(!window[settings.transporter]){window[settings.transporter]=(function(transporter){return function(){var data=Array.prototype.slice.call(arguments);STATIC.data[transporter].push(data)}}(settings.transporter))}if(settings.timeout){settings.timer=window.setTimeout(function(){var error=new Error("Request timeout. Its taking more than "+settings.timeout+"ms to receive data from this url: \n"+settings.url);STATIC.log.write(error);settings.error(error);window[settings.transporter]=function(){}},settings.timeout)}if(!STATIC.callbacks[settings.url]){STATIC.callbacks[settings.url]=[]}if(!STATIC.data[settings.transporter]){STATIC.data[settings.transporter]=[]}STATIC.callbacks[settings.url].push(settings);document.getElementsByTagName("head")[0].appendChild(script)}}())}(this));(function(CURRENT_SCOPE){CURRENT_SCOPE.MixedType=(function(){var STATIC={};STATIC.getValidTypes=function(options){var output=[],current;for(current in options){if(options.hasOwnProperty(current)){if(options[current] instanceof RegExp){output.push(current+" » A string that matches "+options[current].source)}else{if(typeof options[current]=="function"){output.push(current+" » A variable validated by a custom function")}else{throw new Error("Invalid type validator. It must be a functions or a regular expression.")}}}}return output};return function MixedType(options){var PUBLIC=this,PRIVATE={};if(Object.prototype.toString.call(options)!="[object Object]"){throw new Error("Invalid MixedType options. It must be an object of functions and/or regular expressions.")}PRIVATE.options=CURRENT_SCOPE.copyObject(options);PRIVATE.validTypes=STATIC.getValidTypes(PRIVATE.options);PUBLIC.match=function(value){var current;for(current in PRIVATE.options){if(PRIVATE.options.hasOwnProperty(current)){if(PRIVATE.options[current] instanceof RegExp){if(PRIVATE.options[current].test(value)){return current}}else{try{if(PRIVATE.options[current](value)){return current}}catch(exception){continue}}}}return null};PUBLIC.listValidTypes=function(){return Array.prototype.slice.call(PRIVATE.validTypes)}}}())}(this));(function(CURRENT_SCOPE){CURRENT_SCOPE.copyObject=function(reference){if(Object.prototype.toString.call(reference)!="[object Object]"){throw new Error("Invalid reference to copy. It must be an object.")}var copy={},key,value;for(key in reference){if(reference.hasOwnProperty(key)){copy[key]=reference[key]}}return copy};CURRENT_SCOPE.getObjectKeys=function(reference){if(Object.prototype.toString.call(reference)!="[object Object]"){throw new Error("Invalid reference to get keys. It must be an object.")}var keys=[],current;for(current in reference){if(reference.hasOwnProperty(current)){keys.push(current)}}return keys}}(this));if(typeof window.localStorage=="undefined"||typeof window.sessionStorage=="undefined"){(function(){var Se+expires+"; path=/"}function readCookie(name){var nameEQ=name+"=",ca=document.cookie.split(";"),i,c;for(i=0;i<ca.length;i++){c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)===0){return c.substring(nameEQ.length,c.length)}}return null}function setData(data){data=JSON.stringify(data);if(type=="session"){window.name=data}else{createCookie("localStorage",data,365)}}function clearData(){if(type=="session"){window.name=""}else{createCookie("localStorage","",365)}}function getData(){var data=type=="session"?window.name:readCookie("localStorage");return data?JSON.parse(data):{}}var data=getData();length=0fined?null:data[key]},key:function(i){var ctr=0,k;for(k in data){if(data.hasOwnProperty(k)){if(ctr==i){return k}else{ctr++}}}rength--;setData(data)},setItem:function(key,value){data[key]=value.toString?value.toString():value;this.length++;setData(data)}}};if(typeof window.localStorage=="undefined"){window.localStorage=new Storage("local")}if(typeof window.sessionStorage=="undefined"){window.sessionStorage=new Storage("session")}}())}
/*! Promise → v0.1.0 → 20130421-1835 */
(function(a){if(a.Promise){throw new Error("Promise already loaded")}a.Promise=(function(){var c={},b,d;c.version="0.1.0";c.instances=[];c.defaulEvents=["success",ure"];c.NOOP=function(){};c.EXP_VALID_ID=/[A-Za-z]\w*/;b=d=function d(g){var e=this,f={};if(!c.EXP_VALID_ID.test(g)){throw new Error("Invalid id. You must pass a string that matches the following expression: "+c.EXP_VALID_ID.source)}f.id=g;f.result="pending";f.observers={};f.data={};f.timer=null;f.execListeners=function(k,l){var j=f.observers[k],m;if(k=="failure"){j=Array.prototype.slice.call(j)}while(j.length){try{m=j.shift();m.success(l)}catch(h){h.message="[Exception caught triggering the event "+k+"] → "+h.message;try{m.error(h)}catch(i){h.message+="\n\n[Exception also caught on the error handler of "+k+"] → "+i.message}finally{if(k!=="failure"){f.execListeners("failure",h)}}}}};f.bindEvent=function(h){return function(j,i){if(typeof j!=="function"){f.execListeners("failure",'Invalid success handler for event "'+h+'" (of '+f.id+").")}if(i!==undefined&&typeof i!=="function"){f.execListeners("failure",'Invalid error handler for event "'+h+'" (of '+f.id+").")}f.observers[h].push({success:j,error:i||c.NOOP});if(f.data.hasOwnProperty(h)){f.execListeners(h,f.data[h])}else{if(f.status=="error"||f.status=="success"){f.execListeners("failure",new Error("Event listener attached after the result of "+h))}}return e.events}};f.getEvents=function(j){j=j||{};var k,h;for(h=0;h<c.defaulEvents.length;h++){k=c.defaulEvents[h];f.observers[k]=[];j[k]=f.bindEvent(k)}return j};e.notify=function(h,i){if(!f.observers[h]){throw new Error("Invalid event id")}if(f.status=="success"||f.status=="error"){return}f.data[h]=i;if(h=="success"||h=="error"){f.status=h;if(f.timer){f.timer=window.clearTimeout(f.timer)}}f.execListeners(h,f.data[h])};e.abort=function(h){e.notify("error",h||new Error("Procedure programatically aborted"))};e.setTimeout=function(h){if(f.timer){f.timer=window.clearTimeout(f.timer)}f.timeout=h||0;if(f.timeout){f.timer=window.setTimeout(function(){e.abort(new Error("Procedure aborted by timeout "+f.timeout+"ms with no result."))},f.timeout)}};e.bindEventsTo=function(h){if(Object.prototype.toString.call(h)!=="[object Object]"){throw new Error("Invalid target. You can only bind events to objects.")}return f.getEvents(h)};e.events=f.getEvents();c.insttype.sliction(){c.instances.length=0};b.getVersion=function(){return c.version};return b}())}(this));(function(CURRENT_SCOPE){CURRENT_SCOPE.Region=(function(){var STATIC={},PUBLIC_STATIC;STATIC.EXP_MATCH_LOCALE_TOKENS=/^(\w\w)\-?(\w\w)$/;PUBLIC_STATIC=function Region(localeDeclaration){var PUBLIC=this,tokens=STATIC.EXP_MATCH_LOCALE_TOKENS.exec(localeDeclaration);if(!tokens){throw new Error("Invalid locale declaration: "+localeDeclaration)}PUBLIC.lang=String.prototype.toLowerCase.call(tokens[1]);PUBLIC.country=String.prototype.toUpperCase.call(tokens[2]||"")||null;PUBLIC.locale=PUBLIC.lang;if(PUBLIC.country){PUBLIC.locale+="-"+PUBLIC.country}};return PUBLIC_STATIC}())}(this));
/*! WebLocation → v0.1.0 → 20130427-1422 */
(function(CURRENT_SCOPE){if(CURRENT_SCOPE.WebLocation){throw Error("WebLocation already loaded")}CURRENT_SCOPE.WebLocation=function(){var PUBLIC_STATIC,WebLocation,STATIC={};return STATIC.EXP_IS_PATH_ABSOLUTE=/^(https?|file):/,STATIC.EXP_MATCH_PARAM_TOKENS=/[\?&]([^=]+)(?:=([^&#]*))?/g,STATIC.EXP_VALID_PARAM_TYPES=/string|number|boolean/i,STATIC.EXP_MATCH_TOKENS=/^((((?:https?|file)\:)\/\/\/?((.+?)(?:\:(\d+?))?))(\/[^\?#]*?([^\/\?]+?(?:\.(.*?))?)?)?(\?.*?)?)&?(#.+)?$/,STATIC.HREF_TOKEN_NAMES=["href","uri","origin","protocol","host","hostname","port","pathname","filename","extension","search","hash"],STATIC.defaultSettings={href:"",origin:"",uri:"",protocol:"http:",host:"",hostname:"",port:"",pathname:"",filename:"",extension:"",search:"",hash:""},STATIC.merge=function(){var current,reference,objects=Array.prototype.slice.call(arguments),target=objects.shift();if(!objects.length){throw Error("You must pass at least two objects to be merged together.")}for(;objects.length;){reference=objects.shift();for(current in reference){reference.hasOwnProperty(current)&&void 0!==reference[current]&&(target[current]=reference[curren Clone.prototype=obj,new Clone}}(),STATIC.printValues=function(validKeys,values){var current,i,output=[];for(i=0;validKeys.length>i;i++){current=validKeys[i],output.push(values[current])}return output.join("")},STATIC.printSearch=function(params){var currentName,currentValue,subValue,output=[];for(currentName in params){if(params.hasOwnProperty(currentName)){for(currentValue=params[currentName],currentValue="[object Array]"==Object.prototype.toString.call(currentValue)?Array.prototype.slice.call(currentValue):[currentValue];currentValue.length;){subValue=currentValue.shift(),null===subValue&&(subValue=""),subValue=encodeURIComponent(subValue),output.push(currentName+"="+subValue)}}}return output=output.length?"?"+output.join("&"):""},STATIC.convertPathToAbsolute=function(){var EXP_PATH_ABSOLUTE=/^(https?:\/\/|file:)/,EXP_PATH_RELATIVE=/^\.\.\//,EXP_PATH_RELATIVE_TO_DOMAIN=/^\//,EXP_PATH_RELATIVE_TO_CURRENT_DIR=/^\.\//,EXP_MATCH_PARENT_DIR=/(\.\.\/)/g,EXP_CURRENT_FILE_DECLARATION=/[^\/]+$/,EXP_LAST_DIRECTORY_DECLARATION=/[^\/]+\/?$/;return function(href){if("string"!=typeof href){throw Error("The method .convertPathToAbsolute() mest receive a String representing de include path as first parameter")}if(EXP_PATH_ABSOLUTE.test(href)){return href}href=href.replace(EXP_PATH_RELATIVE_TO_CURRENT_DIR,"");var backDirectories,i,base=location.href.replace(EXP_CURRENT_FILE_DECLARATION,""),fileRealPath=href.replace(base,"").replace(EXP_MATCH_PARENT_DIR,"");if(EXP_PATH_RELATIVE_TO_DOMAIN.test(href)){return href=document.domain?location.protocol+"//"+location.host+href:location.protocol+/.+\//.exec(location.href)[0]+href.replace(EXP_PATH_RELATIVE_TO_DOMAIN,"")}if(EXP_PATH_RELATIVE.test(href)){for(backDirectories=href.match(EXP_MATCH_PARENT_DIR).length,i=0;backDirectories>i;i++){base=base.replace(EXP_LAST_DIRECTORY_DECLARATION,"")}}return base+fileRealPath}}(),STATIC.extractTokens=function(uri){var currentName,values,currentValue,i,tokens={};if(values=STATIC.EXP_MATCH_TOKENS.exec(uri),!values){throw Error("Invalid uri. It must be a valid string.")}for(i=0;values.length>i;i++){currentValue=values[i],currentName=STATIC.HREF_TOKEN_NAMES[i],tokens[currentName]=currentValue}return tokens},STATIC.extractParams=function(search){var tokens,paramDeclaration,paramTokens,name,value,params={},foundAny=!1;if(STATIC.EXP_MATCH_PARAM_TOKENS.compile(STATIC.EXP_MATCH_PARAM_TOKENS.source,"g"),tokens=search.match(STATIC.EXP_MATCH_PARAM_TOKENS),!tokens||!tokens.length){return null}for(STATIC.EXP_MATCH_PARAM_TOKENS.compile(STATIC.EXP_MATCH_PARAM_TOKENS.source,"");tokens.length;){foundAny=!0,paramDeclaration=tokens.shift(),paramTokens=STATIC.EXP_MATCH_PARAM_TOKENS.exec(paramDeclaration),paramTokens.shift(),name=paramTokens.shift(),value=paramTokens.shift()||null,value&&(value=decodeURIComponent(value)),params[name]?params[name].push?params[name].push(value):params[name]=[params[name],value]:params[name]=value}return foundAny?params:null},STATIC.getComponents=function(href){var params,uri=STATIC.convertPathToAbsolute(href),tokens=STATIC.extractTokens(uri);return tokens.search&&(params=STATIC.extractParams(tokens.search),tokens.search=STATIC.printSearch(params),tokens.uri=tokens.origin+tokens.pathname+tokens.search,tokens.href=tokens.uri+tokens.hash),{values:STATIC.merge({},STATIC.defaultSettings,tokens),params:params||null}},PUBLIC_STATIC=WebLocation=function WebLocation(href){var PRIVATE={},PUBLIC=this;if(!(this instanceof WebLocation)){throw Error('WebLocation is a constructor. You must use the operator "new".')}if(!href||"string"!=typeof href){throw Error("Invalid href. It must be a valid string.")}PRIVATE.originalHREF=href,PRIVATE.components=STATIC.getComponents(href),PRIVATE.values=PRIVATE.components.values,PRIVATE.params=PRIVATE.curn STATIC.clone(PRIVATE.values)},PUBLIC.getParams=function(){return PRIVATE.params?STATIC.clone(PRIVATE.params):PRIVATE.params},PUBLIC.setParams=function(newParams){if("[object Object]"!=Object.prototype.toString.call(newParams)){throw Error("Invalid params. It must be an object.")}var currentParamValue,newParamName,newParamValue,currentValues=STATIC.merge({},PRIVATE.params||{});for(newParamName in newParams){if(newParams.hasOwnProperty(newParamName)&&(newParamValue=newParams[newParamName],currentParamValue=currentValues[newParamName],void 0!==newParamValue)){if(currentParamValue){if("[object Array]"!=Object.prototype.toString.call(currentParamValue)&&(currentValues[newParamName]=[currentParamValue]),STATIC.EXP_VALID_PARAM_TYPES.test(Object.prototype.toString.call(newParamValue))){currentValues[newParamName].push(newParamValue)}else{if("[object Array]"!=Object.prototype.toString.call(newParamValue)){throw Error('Invalid value for "'+newParamName+'".')}currentValues[newParamName]=currentParamValue.concat(newParamValue)}}else{currentValues[newParamName]=newParamValue}}}return PRIVATE.params=currentValues,PRIVATE.values.search=PRIVATE.params?STATIC.printSearch(PRIVATE.params):"",PRIVATE.values.uri=PRIVATE.values.origin+PRIVATE.values.pathname+PRIVATE.values.search,PRIVATE.values.href=PRIVATE.values.uri+PRIVATE.values.hash,PUBLIC},PUBLIC.unsetParams=function(paramsList){if("string"==typeof paramsList&&(paramsList=[paramsList]),"[object Array]"==Object.prototype.toString.call(paramsList)){for(;paramsList.length;){delete PRIVATE.params[paramsList.shift()]}}else{PRIVATE.params=null}return PRIVATE.values.search=PRIVATE.params?STATIC.printSearch(PRIVATE.params):"",PRIVATE.values.uri=PRIVATE.values.origin+PRIVATE.values.pathname+PRIVATE.values.search,PRIVATE.values.href=PRIVATE.values.uri+PRIVATE.values.hash,PUBLIC}},PUBLIC_STATIC.convertPathToAbsolute=STATIC.convertPathToAbsolute,PUBLIC_STATIC}()})(this)}CURRENT_SCOPE.Datetime=(function(PKG){var STATIC={},PUBLIC_STATIC,Datetime;STATIC.logInstance=new PKG.Log("Datetime");STATIC.log=STATIC.logInstance.write;STATIC.WS={};STATIC.environments={DSV:{serviceURL:"https://api-hlg-priv.terra.com/datetime/converttz?type=jsonp&callback=trrdatetime"},HLG:{serviceURL:"https://api-hlg-priv.terra.com/datetime/converttz?type=jsonp&callback=trrdatetime"},INFRA:{serviceURL:"https://api-hlg-priv.terra.com/datetime/converttz?type=jsonp&callback=trrdatetime"},PRODUCTION:{serviceURL:"https://p1.trrsf.com/api/datetime/converttz?type=jsonp&callback=trrdatetime"}};STATIC.REQUEST_GROUPING_WINDOW=500;STATIC.DEFAULT_LOCALE="es-MX";STATIC.LOCALE_MAP={en:"en-US",es:"es-MX",pt:"pt-BR"};STATIC.USER_LOCALE_TOKENS=/^([a-z]{2})(?:\-([A-Z]{2}))?$/.exec((navigator.language||navigator.userLanguage||STATIC.DEFAULT_LOCALE).replace(/\-\d+$/,""));STATIC.USER_LANGUAGE=STATIC.USER_LOCALE_TOKENS?STATIC.LOCALE_MAP[STATIC.USER_LOCALE_TOKENS[0]]||STATIC.USER_LOCALE_TOKENS[0]:STATIC.DEFAULT_LOCALE;STATIC.defaultSettings={input:{timestamp:"NOW",timezone:"EDITORIAL_LOCATION"},output:{timezone:"EDITORIAL_LOCATION",format:"FULL_DATE_AND_TIME",locale:"EDITORIAL_LOCATION"}};STATIC.DEFAULT_REGION=new PKG.Region(STATIC.DEFAULT_LOCALE);STATIC.USER_PREFERENCE=new PKG.Region(STATIC.USER_LANGUAGE||STATIC.DEFAULT_LOCALE);STATIC.EDITORIAL_LOCATION=(function(){var html=document.getElementsByTagName("html")[0],documentLangAttribute=html.getAttribute("lang")||html.getAttribute("xml:lang"),referenceLocale;referenceLocale=documentLangAttribute;if(!referenceLocale){referenceLocale=STATIC.USER_PREFERENCE.locale}return new PKG.Region(referenceLocale)}());STATIC.CONSTANTS={timestamp:{NOW:"now"},timezone:{USER_PREFERENCE:STATIC.USER_PREFERENCE.country,EDITORIAL_LOCATION:STATIC.EDITORIAL_LOCATION.country||STATIC.DEFAULT_REGION.country,UTC:"utc"},locale:{USER_PREFERENCE:STATIC.USER_PREFERENCE.locale,EDITORIAL_LOCATION:STATIC.EDITORIAL_LOCATION.locale||STATIC.DEFAULT_REGION.locale},format:{BR_FULL:"full_date_and_time",DATE_TIME:"date_time",DATE:"date",DATE_SUMMARY:"date_summary",FULL_DATE_AND_TIME:"full_date_and_time",SHORT_DATE:"short_date",FORMAL_DATE:"formal_date",TIME:"time",FULL_TIME:"full_time",EPOCH_TIME:"epoch_datetime",DEFAULT:"default",DEFAULT_COMPACT:"default_compact",DEFAULT_FULL:"default_full",DATE_RFC822:"date_rfc822",DATE_RFC2822:"date_rfc2822",DATE_ISO8601:"date_iso8601",DATE_RFC1123:"date_rfc1123",DATE_RFC3339:"date_rfc3339",DATE_RFC1036:"date_rfc1036",DATE_W3C:"date_w3c",DATE_ATOM:"date_atom",DATE_RSS:"date_rss"}};STATIC.types={};STATIC.types.timestamp=new PKG.MixedType({ISO8601:/^[+\-]?(19\d\d|20[0-3]\d)(?:\-?(0\d|1[0-2]))(?:\-?([012][0-9]|3[01]))?(?:T([01][0-9]|2[0-4]))?(?:\:([0-5]\d))?(?:\:([0-5]\d))?(?:(Z)|(?:([+\-])(2[0-3]|[0-1][0-9]):?([0-5][0-9])))?$/,epochTime:/\d+/,constant:/^NOW$/});STATIC.types.timezone=new PKG.MixedType({timezoneName:/^\w+\/\w+$/,abbreviation:/^[A-Z]{3}$/,country:/^[A-Z]{2}$/,constant:new RegExp("^"+PKG.getObjectKeys(STATIC.CONSTANTS.timezone).join("|")+"$")});STATIC.types.format=new PKG.MixedType({constant:new RegExp("^"+PKG.getObjectKeys(STATIC.CONSTANTS.format).join("|")+"$")});STATIC.types.locale=new PKG.MixedType({localeDefinition:/^(\w\w)\-?(\w\w)$/,constant:new RegExp("^"+PKG.getObjectKeys(STATIC.CONSTANTS.locale).join("|")+"$")});STATIC.types.offset=new PKG.MixedType({hoursAndMinutes:/^[+\-]?(?:\d|1[1-4])(?:d?:\d\d)?$/,constant:new RegExp("^"+PKG.getObjectKeys(STATIC.CONSTANTS.timezone).join("|")+"$")});STATIC.ISO8601Date=(function(){var STATIC={};STATIC.EXP_MATCH_TOKENS=/^[+\-]?(19\d\d|20[0-3]\d)(?:\-?(0\d|1[0-2]))(?:\-?([012][0-9]|3[01]))?(?:T([01][0-9]|2[0-4]))?(?:\:([0-5]\d))?(?:\:([0-5]\d))?(?:(Z)|(?:([+\-])(2[0-3]|[0-1][0-9]):?([0-5][0-9])))?$/;return function ISO8601Date(declaration){var PUBLIC=this,output={},tokens;tokens=STATIC.EXP_MATCH_TOKENS.exec(declaration);if(!tokens){throw new Error("Invalid Iso8601 date declaration")}output={fullYear:tokens[1],month:tokens[2],day:tokens[3]||"01",hours:tokens[4]||"00",minutes:tokens[5]||"00",seconds:tokens[6]||"00"};if(tokens[7]=="Z"){output.offset="Z"}else{if(tokens[8]&&tokens[9]&&tokens[10]){output.offset=tokens[8]+tokens[9]+":"+tokens[10]}}PUBLIC.getFullDeclaration=function(){return output.fullYear+"-"+output.month+"-"+output.day+"T"+output.hours+":"+output.minutes+":"+output.seconds+(oution(){return output.offset||null}}}());(function(SUPER_STATIC){SUPER_STATIC.Query=(function(){var STATIC={},PUBLIC_STATIC;STATIC.instances={};STATIC.queryTimer=null;STATIC.pendingQueries=[];STATIC.totalQueries=0;STATIC.abortQueries=function(exception){var requestGroup=this.details,current;exception.message="[Aborting requestGroup] >> "+exception.message;SUPER_STATIC.log(exception,requestGroup);for(current in requestGroup.queries){if(requestGroup.queries.hasOwnProperty(current)){while(requestGroup.queries[current].length){requestGroup.queries[current].shift().operation.abort(exception)}}}};STATIC.resolveQueries=function(response){var queries=this.details.queries,current,error;if(Object.prototype.toString.call(response)!=="[object Object]"||Object.prototype.toString.call(response.header)!=="[object Object]"||Object.prototype.toString.call(response.data)!=="[object Object]"||!(/^200|206$/).test(response.header.status)){error=new Error("[Request error]");if(response.header&&response.header.status&&response.header.message){error.message+=" → status : "+response.header.status+"\n» "+response.header.message}STATIC.abortQueries.call(this,error)}else{SUPER_STATIC.log("Response received from WS.",response.data);for(current in response.data){if(response.data.hasOwnProperty(current)){if(!queries[current]||!queries[current].length){SUPER_STATIC.log(new Error("No query matches the following datetime: "+current));SUPER_STATIC.log(queries);SUPER_STATIC.log(this.url)}else{SUPER_STATIC.log("Resolving queries for "+current+" ("+queries[current].length+")",response.data[current]);while(queries[current].length){queries[current].shift().operation.notify("success",response.data[current])}}}}}};STATIC.runQueries=function(){var service=new PKG.WebLocation(SUPER_STATIC.WS.serviceURL),requestGroups={},totalRequestGroups=0,requestKey,requestGroup,current;SUPER_STATIC.log("Dealing with pending queries ("+STATIC.pendingQueries.length+").");if(STATIC.queryTimer){STATIC.queryTimer=clearTimeout(STATIC.queryTimer)}while(STATIC.pendingQueries.length){current=STATIC.pendingQueries.shift();requestKey=[current.settings.params.from_tz,current.settings.params.to_tz,current.settings.params.format,current.settings.params.locale].join("|");requestGroup=requestGroups[requestKey];if(!requestGroup){totalRequestGroups++;requestGroup=requestGroups[requestKey]={queries:{},params:PKG.copyObject(current.settings.params)};requestGroup.params.datetime=[]}if(!requestGroup.queries[current.settings.params.datetime]){requestGroup.queries[current.settings.params.datetime]=[]}requestGroup.params.datetime.push(current.settings.params.datetime);requestGroup.queries[current.settings.params.datetime].push(current)}if(totalRequestGroups>1){SUPER_STATIC.log("Splitting queries in "+totalRequestGroups+" requests.")}for(current in requestGroups){if(requestGroups.hasOwnProperty(current)){requestGroup=requestGroups[current];SUPER_STATIC.log("Requesting WS for "+current);PKG.requestJSONP({url:service.unsetParams(["datetime","from_tz","to_tz","offset","format","locale"]).setParams(requestGroup.params).getValues().uri,transporter:"trrdatetime",details:requestGroup,success:STATIC.resolveQueries,error:STATIC.abortQueries})}}};STATIC.getSettings=function(input,output){var serviceSettings={};serviceSettings.originalQuery={input:input,output:output};serviceSettings.params={};serviceSettings.params.from_tz=input.timezone;if(isNaN(parseInt(input.timestamp,10))){if(input.timestamp==="now"){serviceSettings.params.datetime="now";delete serviceSettings.params.from_tz}else{serviceSettings.params.datetime=new SUPER_STATIC.ISO8601Date(input.timestamp);if(serviceSettings.params.datetime.getOffset()&&input.timezone){throw new Error('Incompactible timezone definition. You can\'t pass an offset reference on the "datetime" property and use "from_tz" at the same time.')}serviceSettings.params.datetime=serviceSettings.params.datetime.getFullDeclaration()}}else{serviceSettings.params.datetime=input.timestamp}serviceSettings.params.to_tz=output.timezone;serviceSettings.params.format=output.format;serviceSettings.params.locale=output.locale.replace(/\-/,"_");serviceSettings.key=[serviceSettings.params.datetime,serviceSettings.params.from_tz,serviceSettings.params.to_tz,serviceSettings.params.format,serviceSettings.params.locale].join("|");return serviceSettings};PUBLIC_STATIC=function Query(input,output){var PRIVATE={},PUBLIC=this;PRIVATE.settings=STATIC.getSettings(input,output);if(STATIC.instances[PRIVATE.settings.key]){SUPER_STATIC.log("Query already resolved. Delivering values with no requests.");return STATIC.instances[PRIVATE.settings.key].events}PRIVATE.key=PRIVATE.settings.key;PRIVATE.status="pending";PRIVATE.operation=new PKG.Promise("query");PRIVATE.result={};PRIVATE.operation.bindEventsTo(PUBLIC);STATIC.pendingQueries.push({settings:PRIVATE.settings,operation:PRIVATE.operation});if(SUPER_STATIC.REQUEST_GROUPING_WINDOW&&!STATIC.queryTimer){STATIC.queryTimer=window.setTimeout(STATIC.runQueries,SUPER_STATIC.REQUEST_GROUPING_WINDOW)}if(PRIVATE.settings.params.datetime!="now"){STATIC.instances[PRIVATE.keyus=function(){retPRIVATE.status=status;return PUBLIC}};PUBLIC_STATIC.getInstances=function(){var instances=[],current;for(current in STATIC.instances){if(STATIC.instances.hasOwnProperty(current)){current=STATIC.instances[current];instances.push(current)}}return instances};return PUBLIC_STATIC}())}(STATIC,PUBLIC_STATIC));STATIC.setUpWebService=function(env){env=env||"PRODUCTION";var environments=[],current,id;for(id in STATIC.environments){if(STATIC.environments.hasOwnProperty(id)){current=STATIC.environments[id];environments.push(id)}}STATIC.log("The following environments are available: "+environments.join(", "));if(!STATIC.environments[env]){throw new Error("Invalid environment. You must choose between one of these: "+environments.join(", "))}STATIC.WS.environment=env;STATIC.WS.serviceURL=STATIC.environments[env].serviceURL;STATIC.log('WebService configured as "'+env+'".')};STATIC.createListener=function(instance,target){if(typeof target=="function"){STATIC.log("Setting listener",instance)}else{if(/HTML|Element|Document/i.test(Object.prototype.toString.call(target))||Object.prototype.hasOwnProperty.call(target,"nodeType")){STATIC.log("Binding value to an HTML elemt",instance)}else{throw new Error("Invalid target. You can only bind this instance to a listener (function) or an HTML element")}}return function(result){if(typeof target=="function"){try{STATIC.log("Triggering listeners",result);target.call(result,result.custom_datetime)}catch(e){e.message="[Expection caught on instance.write() callback] → "+e.message;STATIC.log(e)}}else{STATIC.log("Updating HTML element",target);target.innerHTML=result.custom_datetime}}};STATIC.Settings=function Settings(direction,customSettings){var PUBLIC=this,defaultSettings,current,matchedType,value;if(!(/^input|output$/).test(direction)){throw new Error('Invalid direction. It must be "input" or "output".')}if(customSettings!==undefined&&Object.prototype.toString.call(customSettings)!=="[object Object]"){throw new Error("Invalid "+direction+" settings. It must be an object. You can also ommit it, if you wanna stick with the defaults.")}defaultSettings=STATIC.defaultSettings[direction];customSettings=customSettings||{};for(current in defaultSettings){if(defaultSettings.hasOwnProperty(current)){value=customSettings[current];if(STATIC.types[current]&&value!==undefined){matchedType=STATIC.types[current].match(value);if(!matchedType){throw new Error('Invalid value for "'+current+'". It must be one of these types: \n'+STATIC.types[current].listValidTypes().join("\n"))}if(matchedType=="constant"&&STATIC.CONSTANTS[current]&&STATIC.CONSTANTS[current][value]){PUBLIC[current]=STATIC.CONSTANTS[current][value]}else{PUBLIC[current]=value}}else{PUBLIC[current]=defaultSettings[current]}}}};PUBLIC_STATIC=Datetime=function Datetime(settings){var PRIVATE={},PUBLIC=this;if(!(this instanceof Datetime)){throw new Error('Datetime is a constructor. You must use the operator "new".')}if(settings!==undefined&&Object.prototype.toString.call(settings)!=="[object Object]"){throw new Error('Invalid settings. It must be an object composed by "input" and/or "output" properties. You can also ommit it, if you wanna stick with the defaults.')}settings=settings||{};PRIVATE.input=new STATIC.Settings("input",settings.input||{});PRIVATE.output=new STATIC.Settings("output",settings.output||{});PRIVATE.listeners=[];PUBLIC.compute=function(success,error){if(typeof success!=="function"){throw new Error("Invalid datetime handler. You must pass a function.")}if(error!==undefined&&typeof success!=="function"){throw new Error("Invalid error handler. You must pass a function.")}if(!PRIVATE.query||PRIVATE.input.timestamp=="NOW"){STATIC.log("Computing",{input:PRIVATE.input,output:PRIVATE.output});PRIVATE.query=new STATIC.Query(PRIVATE.input,PRIVATE.output)}else{STATIC.log("Returning last result")}PRIVATE.query.success(success).error(error||STATIC.log);return PUBLIC};PUBLIC.bind=function(target){var listener=STATIC.createListener(PUBLIC,target);PUBLIC.compute(function(){listener.apply(this,Array.prototype.slice.call(arguments));PRIVATE.listeners.push(listener)},STATIC.log);return PUBLIC};PUBLIC.set=function(customSettings){var newSettings,i;if(Object.prototype.toString.call(customSettings)!=="[object Object]"||(!customSettings.input&&!customSettings.output)){throw new Error('Invalid settings. It must be an object composed by "input" and/or "output" properties. You can also ommit it, if you wanna stick with the defaults.')}newSettings={};if(customSettings.input){newSettings.input=new STATIC.Settings("input",customSettings.input);STATIC.log("New input settings",customSettings.input)}if(customSettings.output){newSettings.output=new STATIC.Settings("output",customSettings.output);STATIC.log("New output settings",customSettings.output)}PRIVATE.query=null;PRIVATE.input=newSettings.input||PRIVATE.input;PRIVATE.output=newSettings.output||PRIVATE.output;if(PRIVATE.listeners.length){for(i=0;i<PRIVATE.listeners.length;i++){PUBLIC.compute(PRIVATE.listeners[i],STATIC.log)}}};STATIC.log("New instance.",{input:PRIVATE.input,output:PRIVATE.output})};PUBLIC_STATIC.setEnvironment=function(env){if(!STATIC.environments[env]){throw new Error("Invalid environment. You must choose between one of these: "+environments.join(", "))}STATIC.WS.environment=env;STATIC.WS.serviceURL=STATIC.environments[env].serviceURL;STATIC.log("New environment selected: "+env);return PUBLInction(){return STATIC.WS.enHandler(handler);return PUBLIC_STATIC};(function(){var forcedEnvironment=location.search.match(/zaz-datetime\[ws\]=([A-Z]+)/),initialEnvironemnt="PRODUCTION";STATIC.log("Initializing");STATIC.defaultSettings.input=new STATIC.Settings("input",STATIC.defaultSettings.input);STATIC.log("Default input settings defined",STATIC.defaultSettings.input);STATIC.defaultSettings.output=new STATIC.Settings("output",STATIC.defaultSettings.output);STATIC.log("Default output settings defined",STATIC.defaultSettings.output);if(forcedEnvironment){initialEnvironemnt=forcedEnvironment.pop();STATIC.log("Forcing WS defined via queryString: ",initialEnvironemnt)}STATIC.setUpWebService(initialEnvironemnt);STATIC.log("Class available")})();return PUBLIC_STATIC}(new Package()))}(this));