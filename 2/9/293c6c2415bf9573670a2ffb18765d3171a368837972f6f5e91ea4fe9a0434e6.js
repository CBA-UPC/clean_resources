!this,function(e){"use strict";var t=ar n=/[^a-zA-Z0-9\\_:.-]/gim,i=/</g,o=/>/g,a=/&#([a-zA-Z0-9]*);?/gim,u=/&quot;/g,s=/&colon;?/gim,c=/&newline;?/gim,l=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,f=/u\s*r\s*l\s*\(.*/gi,h=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,d=/"/g,p=v={indexOf:function(e,t){var r,n;for(r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return -1},forEach:function(e,t,r){var n,i;for(n=0,i=e.length;n<i;n++)t.call(r,e[n],n,e)},some:function(e,t,r){var n,i;for(n=0,i=e.length;n<i;n++)if(t.call(r,e[n],n,e))return!0;return!1},trim:isArray:includes:function(e,t){if("string"==typeof e)return -1!==e.indexOf(t);for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1},spaceIndex:uniq:function(e){for(var t={},r=[],n=0;n<e.length;n++)t[e[n]]||(r.push(e[n]),t[e[n]]=!0);return r},from:keys:;unction y(e){var t,r,n,i,o,a,u,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",l=0;for(e=e);l<e.length;)i=(t=e.charCodeAt(l++))>>2,o=(3&t)<<4|(r=e.charCodeAt(l++))>>4,a=(15&r)<<2|(n=e.charCodeAt(l++))>>6,u=63&n,isNaN(r)?a=u=64:isNaN(n)&&(u=64),c=c+s.charAt(i)+s.charAt(o)+s.charAt(a)+s.charAt(u);return c}function m(e){var t,r,n,i,o,a,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="",c=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");c<e.length;)t=u.indexOf(e.charAt(c++))<<2|(i=u.indexOf(e.charAt(c++)))>>4,r=(15&i)<<4|(o=u.indexOf(e.charAt(c++)))>>2,n=(3&o)<<6|(a=u.indexOf(e.charAt(c++))),s+=String.fromCharCode(t),64!==o&&(s+=String.fromCharCode(r)),64!==a&&(s+=String.fromCharCode(n));return s)}function _(e,t,r){var n="",i=0,o=!1,a=!1,u=0,s=e.length,c="",l="";e:for(u=0;u<s;u++){var f=e.charAt(u);if(!1===o){if("<"===f){o=u;continue}}else if(!1===a){if("<"===f){n+=r(e.slice(i,u)),o=u,i=u;continue}if(">"===f||u===s-1){n+=r(e.slice(i,o)),c=l=e.slice(o,u+1)),n+=t(o,n.length,c,l,"</"===l.slice(0,2)),i=u+1,o=!1;continue}if('"'===f||"'"===f)for(var h=1,d=e.charAt(u-h);""===d.trim()||"="===d;){if("="===d){a=f;continue e}d=e.charAt(u-++h)}}else if(f===a){a=!1;continue}}return i<s&&(n+=r(e.substr(i))),n}function b(e,t){var r=0,i=0,o=[],a=!1,u=e.length;or(var c=0;c<u;c++){var l=e.charAt(c),f=void 0;if(!1!==a||"="!==l){if(!1===a||c!==i){if(/\s|\n|\t/.test(l)){if(e=e.replace(/\s|\n|\t/g," "),!1===a){if(-1===(f=function(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"="===r?t:-1}return -1}(e,c))){s(v.trim(e.slice(r,c))),a=!1,r=c+1;continue}c=f-1;continue}if(-1===(f=function(e,t){for(;t>0;t--){var r=e[t];if(" "!==r)return"="===r?t:-1}return -1}(e,c-1))){s(a,g(v.trim(e.slice(r,c)))),a=!1,r=c+1;continue}}}else{if(-1===(f=e.indexOf(l,c+1)))break;s(a,v.trim(e.slice(i+1,f))),a=!1,r=(c=f)+1}}else a=e.slice(r,c),r=c+1,i='"'===e.charAt(r)||"'"===e.charAt(r)?r:function(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"'"===r||'"'===r?t:-1}return -1}(e,c+1)}return r<e.length&&(!1===a?s(e.slice(r)):s(a,g(v.trim(e.slice(r))))),v.trim(o.join(" "))}function k(e,t,r){var n,i;if(r=function(e){for(var t="",r=0,n=e.length;r<n;r++)t+=32>e.charCodeAt(r)?" ":e.charAt(r);return v.trim(t)}(r.replace(u,'"').replace(a,.replace(s,":").replace(c," ")),"href"===t||"src"===t){if("#"===(r=v.trim(r)))return"#";if("http://"!==r.substr(0,7)&&"https://"!==r.substr(0,8)&&"mailto:"!==r.substr(0,7)&&"tel:"!==r.substr(0,4)&&"data:image/"!==r.substr(0,11)&&"ftp://"!==r.substr(0,6)&&"./"!==r.substr(0,2)&&"../"!==r.substr(0,3)&&"#"!==r[0]&&"/"!==r[0])return""}else if("background"===t){if(l.lastIndex=0,l.test(r))return""}else if("style"===t&&(h.lastIndex=0,h.test(r)||(f.lastIndex=0,f.test(r)&&(l.lastIndex=0,l.test(r)))))return"";return r=p(r.replace(d,"&quot;"))}var w=P=function(){function e(e){var t=e||{});t.stripIgnoreTag&&(t.onIgnoreTag,t.onIgnoreTag=function(){return""}),t.whiteList={},t.onTag=function(){},t.onTagAttr=function(){},t.onIgnoreTag=function(){},t.onIgnoreTagAttr=function(){},t.safeAttrValue=k,t.escapeHtml=p,this.options=Object.assign(t,e)}return e.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t,r,n,i,o,a=this.options,u=a.whiteList,s=a.onTag,c=a.onIgnoreTag,l=a.onTagAttr,f=a.onIgnoreTagAttr,h=a.safeAttrValue,d=a.escapeHtml;a.stripBlankChar&&(e=e.split("").filter(.join("")),a.allowCommentTag||(e=e));var p=!1;a.stripIgnoreTagBody&&(t=a.stripIgnoreTagBody,"function"!=typeof(r=c)&&(r=function(){}),n=!Array.isArray(t),i=[],o=!1,c=(p={onIgnoreTag:function(e,a,u){if(n||-1!==v.indexOf(t,e)){if(u.isClosing){var s="[/removed]",c=u.position+s.length;return i.push([!1!==o?o:u.position,c]),o=!1,s}return o||(o=u.position),"[removed]"}return r(e,a,u)},remove:).onIgnoreTag);var g=_(e,function(e,t,r,n,i){var o={sourcePosition:e,position:t,isClosing:i,isWhite:Object.prototype.hasOwnProperty.call(u,r)},a=s(r,n,o);if(null!=a)return a;if(o.isWhite){if(o.isClosing)return"</".concat(r,">");var p=n),g=u[r],y=b(p.html,function(e,t){var n=-1!==v.indexOf(g,e),i=l(r,e,t,n);return null==i?n?(t=h(r,e,t,null))?"".concat(e,'="').concat(t,'"'):e:null==(i=f(r,e,t,n))?void 0:i:i});return n="<".concat(r),y&&(n+=" ".concat(y)),p.closing&&(n+=" /"),n+=">"}return null==(a=c(r,n,o))?d(n):a},d);return p&&(g=p.remove(g)),g},e}(),C=Function("\nvar _checkXSS = function (it) {\n  return it && it.Math == Math && it;\n};\nreturn _checkXSS(typeof globalThis === 'object' && globalThis) ||\n_checkXSS(typeof window === 'object' && window) ||\n_checkXSS(typeof self === 'object' && self) ||\n_checkXSS(typeof global === 'object' && global) ||\nFunction('return this')();\n")(),x=new(function(){function e(){var e=this;this.batchData=[],this.uniqKeys=new Set,this.timeout=2e3,this.lock=!1,this.getSlardarBid=function(){var t,r,n="douyin_web";if(!v.includes(n,"bid"))return n;if(e.config&&e.config.bid)return e.config.bid;if(C&&C._xssBid)return C._xssBid;if(C&&C.slardar&&"function"==typeof C.slardar.config){var i=(C.slardar.config()||{}).bid;if(i)return i}if(C&&C.Slardar&&"function"==typeof C.Slardar.config){var o=(C.Slardar.config()||{}).bid;if(o)return o}return(null===(r=null===(t=null==C?void 0:C.Slardar)||void 0===t?void 0:t._baseParams)||void 0===r?void 0:r.bid)||"argus"},this.getConfigRegion=function(){var t;return v.includes("cn","region")?e.config&&e.config.region?e.config.region:((null===(t=null==C?void 0:C.gfdatav1)||void 0===t?void 0:t.region)||"cn").toLowerCase():"cn"},this.gerReportUrl=return e.prototype.setConfig=function(e){this.config=e},e.prototype.upload=function(){var e=this,t=this.gerReportUrl();!this.lock&&t&&0!==this.batchData.length&&(this.lock=!0,setTimeout(function(){var r=e.batchData.slice(0,100);e.batchData=e.batchData.slice(100),C.fetch(t,{method:"post",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).catch(,e.lock=!1,e.upload()},this.timeout))},e.prototype.generateKey=e.prototype.push=e.prototype.report=function(e){var t=this.generateKey(e);if(C.fetch&&e.collectKey){var r="object"==typeof window?window.location.href:"SSR";e.documentUrl=r;var n={age:Math.floor(Date.now()),type:"xss",url:r,body:e,"user-agent":""};"enforce"===e.disposition&&"SSR"!==r||(n.url=t),"SSR"===r&&(n.url="SSR___".concat(n.url),n.body.ssr=!0),this.push(n)}},e}()),T=function(e){for(var t=0,r=function(r){Array.isArray(e[r])?0===e[r].length?delete e[r]:(e[r]=v.from(v.uniq(e[r])),t+=e[r].length):0===v.keys(e[r]).length?delete e[r]:v.keys(e[r]).forEach(function(n){e[r][n]=v.from(v.uniq(e[r][n])),t+=e[r][n].length})},n=0,i=v.keys(e);n<i.length;n++)r(i[n]);return{count:t,ret:e}};function I(e,t){return x.setConfig(t),new P(t).process(e)}function S(e){var t,r=(t=/\s|\n|\t/.exec(e))?t.index:-1;if(-1===r)return{html:"",closing:"/"===e[e.length-2]};var n="/"===(e=e.slice(r+1,-1).trim())[e.length-1];return n&&(e=e.slice(0,-1).trim()),{html:e,closing:n}}var D=function(e){return -1===(e=(e=(e=(e=e.replace(/&colon;/gi,":")).replace(/&tab;/gi,"")).replace(/&newline;/gi,"")).replace(/(\t|\n|\r)/g,"")).indexOf("&#")?e.trim().toLowerCase():e.trim().replace(/&#(?:(x)([0-9a-f]+)|([0-9]+));?/gi,.replace(/(\t|\n|\r)/g,"").toLowerCase()};function O(e,t){if(void 0===e&&(e=""),"string"!=typeof e)return!0;if(e=D(e),v.includes(e,"base64")&&!function(e){if(""===e||""===e.trim())return!0;try{return!v.includes(e,"data:text/html;base64")}catch(e){return!0}}(e))return t&&t("data:text/html;base64"),!1;var r=["expression(","behavior:","view-source:"];if(v.some(r,function(t){return -1!==e.indexOf(t)}))return v.forEach(r,function(r){-1!==e.indexOf(r)&&t&&t(r)}),!1;var n=["data:application","data:javascript","data:text/html","data:texthtml"];if(v.some(n,)return v.forEach(n,,!1;if(e.indexOf("javascript:")>0)return t&&t("javascript:"),!1;if(/^javascript:/i.test(e)){var i=e.slice(11).replace(/\s/g,"").trim();return!!v.some(["void","void(0)","void0","false","undefined",";"],||(t&&t("javascript:"),!1)}return!0}var L=function(e,t){var r,n,i="<%= isSaveValidUrl =>";if("string"!=typeof e||(n=Number("<%= urlLimit =>"),void 0!==r&&(n=r),"NaN"!==e.toString()&&-1!==n&&e.length>=n)||O(e,t))return e;try{if(!0===(i=JSON.parse(i))||"true"===i){var o=new URL(e);return o.origin+o.pathname}}catch(e){}return"#"};function A(e,t,n){if(void 0===e&&(e=""),void 0===t&&(t=[]),"string"!=typeof e)return!0;if(!O(e=D(e)))return!1;var i,o={url:(i=e.match(/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/)||[])[0],scheme:i[1],slash:i[2],host:i[3],port:i[4],path:i[5],query:i[6],hash:i[7]},a=o.scheme,u=o.host;return n?!!n(e):!(!a||!u)&&(!v.includes(["http","https","file"],a)||("object"==typeof window&&window&&(t=r(r([],t,!0),[location.host],!1)),v.some(t,))}var B={a:["target","title","spellcheck","rel"],canvas:[],abbr:["title"],address:[],area:["shape","coords","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:["dir"],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["alt","title","width","height","decoding"],ins:["datetime"],li:[],mark:[],nav:[],ol:["start"],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],delete:[],form:[],strong:[],mask:["maskunits","x","y","width","height","fill"],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],wbr:[],video:["autoplay","controls","loop","preload","height","width"],svg:["viewBox","version","xmlns","fill","width","height","stroke","stroke-width","style"],path:["d","fill","opacity","stroke","p-id","fill-rule","clip-rule","stroke-width","stroke-linecap","stroke-linejoin","fill-opacity","mask"],rect:["x","y","width","height","fill","stroke","rx"],g:[]},E={collect:null,initCollect:function(){this.collect={whiteList:{},filterProtocol:[]}},removeCollect:function(){var e=T(this.collect),t=e.count,r=e.ret;return this.collect=null,{collectKey:0===t?null:JSON.stringify(r),collectMode:"white"}},onIgnoreTagAttr:function(e,t,n){return e&&v.indexOf(["href","src"],t)>-1?E.domainWhiteList&&Array.isArray(E.domainWhiteList)&&E.domainWhiteList.length>0&&!A(n,r([],E.domainWhiteList,!0))?"":"".concat(t,'="').concat(L(n,,'"'):e&&(v.indexOf(["style","class","id"],t)>-1||t.indexOf("data-")>-1)?"".concat(t,'="').concat(n,'"'):(E.collect.whiteList[e]=E.collect.whiteList[e]||[],void E.collect.whiteList[e].push(t))},onIgnoreTag:function(e,t){if("style"===e)return t;_(t,function(e,t,r,n){b(S(n).html.replace("/",""),},p)},whiteList:B,mergeWhiteList:function(e){for(var t,r={},n=0,i=v.keys(B);n<i.length;n++)r[t=i[n]]=v.from(B[t]);for(var o=0,a=v.keys(e);o<a.length;o++)r[t=a[o]]=t in B?B[t].concat(e[t]):v.from(e[t]);return r},setWhiteList:;try{var N={},j="merge";v.includes(j,"override")&&(E.whiteList=N.whiteList),v.includes(j,"merge")&&E.setWhiteList(N.whiteList)}catch(e){}var R=function(e,t){for(var r={},n=0,i=v.keys(e);n<i.length;n++){var o=i[n];Array.isArray(e[o])?r[o]=v.from(e[o]):r[o]=R({},e[o])}for(var a=0,u=v.keys(t);a<u.length;a++)(o=u[a])in e?Array.isArray(e[o])?r[o]=e[o].concat(t[o]):r[o]=R(e[o],t[o]):Array.isArray(t[o])?r[o]=v.from(t[o]):r[o]=R({},t[o]);return r},M={blackList:{a:["folder"],meta:["content"],iframe:["srcdoc"],input:["pattern"],vmlframe:["xmlns"]},blackTags:["script","xml","embed","isindex","object","base","set","handler","animate","payload","import"],blackAttrs:["charset","ns","namespace","formaction","xlink:href","xmlns:xlink","handler","repeat","repeat-start","repeat-end"],blackAttrRegExps:[/^on/],filterList:{param:["value"],video:["poster"],form:["action"]},filterAttrs:["href","src","background","style","dynsrc","lowsrc","content"]};try{var K={};K.blackAttrRegExps&&(K.blackAttrRegExps=K.blackAttrRegExps.map();var U="merge";v.includes(U,"override")&&(M=K),v.includes(U,"merge")&&(M=R(M,K))}catch(e){}var q={mode:"black",whiteList:{},blackConfig:M,collect:null,initCollect:removeCollect:function(){var e=T(q.collect),t=e.count,r=e.ret;return q.collect=null,{collectKey:0===t?null:JSON.stringify(r),collectMode:"black"}},onIgnoreTag:function(e,t){var r;if(!v.includes(M.blackTags,e))return _(t,function(e,t,r,n,i){if(-1!==r.indexOf("/"))return p(n);if(i)return"</".concat(r,">");var o=S(n),a=b(o.html,function(e,t){var n,i=0;if(M.blackList[r]&&v.includes(M.blackList[r],e)&&(q.collect.blackList[r]=q.collect.blackList[r]||[],q.collect.blackList[r].push(e),i++),M.blackAttrRegExps.length&&M.blackAttrRegExps.some(&&v.forEach(M.blackAttrRegExps,,M.blackAttrs.length&&v.includes(M.blackAttrs,e)&&(M.blackAttrs.push(e),i++),!i){if(M.filterList&&M.filterList[r]&&v.includes(M.filterList[r],e)){var o=L(t,function(e){var t;null===(t=q.collect)||void 0===t||t.filterProtocol.push(e)});return o!==t&&(q.collect.filterList[r]=q.collect.filterList[r]||[],q.collect.filterList[r].push(e)),t?"".concat(e,"='").concat(o,"'"):e}return M.filterAttrs&&v.includes(M.filterAttrs,e)?((o=L(t,function(e){var t;null===(t=q.collect)||void 0===t||t.filterProtocol.push(e)}))!==t&&(null===(n=q.collect)||void 0===n||n.filterAttrs.push(e)),t?"".concat(e,"='").concat(o,"'"):e):t?"".concat(e,"='").concat(t,"'"):e}});return n="<".concat(r),a&&(n+=" ".concat(a)),o.closing&&(n+=" /"),n+=">"},p);null===(r=q.collect)||void 0===r||r.blackTags.push(e)}},F=function(e){var t=e.reportOnly,r=void 0===t||t,n=e.block;return r&&"all"===r?"report":("string"==typeof r&&("true"===r&&(r=!0),"false"===r&&(r=!1)),n?"enforce":r?"report":"enforce")},W=function(e){return function(r,n,i){if(!r||"string"!=typeof r)return r;var o=n;e===I&&(o=E).initCollect();var a=e(r,o);if(w(a)===w(r))return r;if(!i)return a;var u=i.logType,s=F(i),c=o.removeCollect();return x.report(t(t({type:u,disposition:s},c),{sourceText:y(r),filterText:y(a)})),"enforce"===s?a:r}},H=W(function(e,t){return void 0===t&&(t={}),t&&t.whiteList||(t.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}),new P(t).process(e)}),Z=W(I),V=function(e,t,r){var n=[],i=L(e,function(e){n.push(e)});if(i===e)return e;n=v.from(v.uniq(n));var o=t||r||{};if(!o)return i;var a=o.logType,u=F(r);return x.report({type:a,disposition:u,collectKey:n.join("___"),collectData:JSON.stringify(n),collectMode:"black",sourceText:y(e),filterText:y(i)}),"enforce"===u?i:e},X=C._xssProject||{},Y=C.xssNamespace||{},G="3.0.26",z={FilterXSS:P,version:G,webpackPluginVersion:"<%= webpackPluginVersion =>",reportOnly:"<%= reportOnly =>",filterXSS:H,_filterXSS:Z,filterUrl:V,Config:E,BlackConfig:q,project:X,setProjectName:;Y.douyin_web=z,C.xssNamespace=Y,C.Math&&!C.Math.xssNamespace&&(C.Math.xssNamespace=Y),X[G]=z,C.globalThis=C,C.getFilterXss=C.xss=z,C.isSafeUrl=A,C.isSafeDomain=A,C.isSafeProtocol=O,C._xssProject=X,C._xssProjectName&&(X[C._xssProjectName]=z);var J=z.setProjectName.bind(z);e.BlackConfig=q,e.Config=E,e.FilterXSS=P,e._filterXSS=Z,e.filterUrl=V,e.filterXSS=H,e.isSafeDomain=A,e.isSafeProtocol=O,e.isSafeUrl=A,e.project=X,e.setProjectName=J,e.setXssNamespace=function(e){var t=e.appId,r=e.bid,n=e.region;Y[t]=z,E.bid=r,E.region=n,E.enabled=!0},e.xssNamespace=Y,Object.defineProperty(e,"__esModule",{value:!0})});"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([[675],{89102:function(e,t,r){function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function u(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,r){return(t=p(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var i=l(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return h(e)}(this,r)}}function p(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}r.d(t,{Lc:function(){return h},PA:function(){return o},WY:function(){return d},XW:function(){return c},Zj:function(){return i},_x:function(){return s},qH:function(){return u}})},89735:function(e,t,r){r.d(t,{vP:function(){return d},vK:function(){return h},ZP:function(){return p}});var n=r(89102);r(57275),r(42416),r(64200),r(23978),r(71602),r(31807),r(36766);var i=function(){function e(t){var r=this;(0,n.PA)(this,e),(0,n._x)(this,"_onPlay",function(){r._calcPausedTime()}),(0,n._x)(this,"_onPause",,(0,n._x)(this,"_onEnded",,(0,n._x)(this,"_canPlay",,(0,n._x)(this,"_onProgress",,(0,n._x)(this,"_onTick",function(){var e=r.video;if(e){r._timer=setTimeout(r._onTick,500);var t=e.currentTime;if(e.paused&&!e.ended&&0!==e.playbackRate&&0!==e.readyState){r._prevCurrentTime=t;return}r._prevCurrentTime===t?r._prevStallTime||(r._prevStallTime=Date.now()):r._calcStallTime(),r._prevCurrentTime=t}}),this.video=t,this._timer=null,this._prevPauseTime=0,this._prevStallTime=0,this._prevCurrentTime=0,this.resetInfo(),this.enable()}return(0,n.qH)(e,[{key:"isStalling",get:function(){return!!this._prevStallTime}},{key:"enable",value:,{key:"disable",value:,{key:"endPlay",value:,{key:"getInfo",value:function(){return this._info}},{key:"resetInfo",value:,{key:"destroy",value:,{key:"_calcStallTime",value:function(){this._prevStallTime&&(this._info.stalledTime+=(Date.now()-this._prevStallTime)/1e3,this._prevStallTime=0)}},{key:"_calcPausedTime",value:]),e}();r(75521),r(29994);var o=function(){function e(t){(0,n.PA)(this,e),this._queue=[],this._current={},this.setConfig(t)}return(0,n.qH)(e,[{key:"setConfig",value:,{key:"setCurrent",value:,{key:"getCurrent",value:function(){return this._current}},{key:"resetCurrent",value:,{key:"calcAndReset",value:function(){var e=this._current,t=e.startBufferTime,r=e.duration,n=e.endBufferTime,i=e.leaveWithBlock,o=e.stalledTime,a=e.pausedTime,u=e.downloadDuration,s=e.bitrate;if(!r||!s||!n){this.resetCurrent();return}var c=this._config,l=c.paramBf,f=c.paramBp,h=c.paramUpperBl,d=c.paramUpper,p=c.slidingWindowWeight,v=c.slidingWindowType,g=c.slidingWindowWeightThreshold,y=c.slidingWindowCountThreshold,m=1+((n-t)*l-(o+a)*f)/u;i&&(m=Math.min(m,h));var _=s*Math.max(d,m),b=0;if(b="time"===p?Math.min(u,r+o):Math.min(u,r)*s,this._queue.push([_,b,this._current]),"by_weight"===v){this._queue=this._queue.slice(-30);for(var k=this._queue.reduce(function(e,t){return e+t[1]},0)-g;k>0;){var w=this._queue.shift();if(!w)break;if(w[1]>k){w[1]-=k,this._queue.unshift(w);break}k-=w[1]}}else this._queue=this._queue.slice(-y);this.resetCurrent()}},{key:"getDefaultBitrate",value:,{key:"getTargetBitrate",value:function(e){if(!this._queue.length||!e)return 0;var t=this._config,r=t.paramVlLower,n=t.paramVlUpper,i=t.paramVl1,o=t.paramVl2,a=t.bitrateLower,u=t.bitrateUpper,s=t.slidingWindowExtraction,c=0,l=this._queue.reduce(0);if("weighted_median"===s){var f=l/2,h=1/0,d=0;this._queue.forEach(}else c=this._queue.reduce(0);return Math.max(a,Math.min(u,c*Math.min(n,Math.max(r,i+o/e))))}}]),e}(),a=r(99400),u=new o,s=function(){function e(t,r){var o=this;(0,n.PA)(this,e),(0,n._x)(this,"_onEnded",function(){o._updateInfo()}),(0,n._x)(this,"_onPlayNext",function(){o._updateInfo()}),this._rule=u,this._player=t,t&&(this._playingInfo=new i(t.video)),this._bindEvent(),u.setConfig(r),this._selectAlgType=r.selectAlgType}return(0,n.qH)(e,[{key:"select",value:function(e){if(e.length){var t,r=e[0].duration||0;1===e.length&&(t=e[0]);var n=0;return t||((t=(n=u.getTargetBitrate(r,e))?(0,a.v2)(e,n,this._selectAlgType):e[0])._targetBitrate=n),u.resetCurrent(),u.setCurrent({bitrate:t.bitrate,duration:r}),this._playingInfo&&this._playingInfo.enable(),t}}},{key:"_bindEvent",value:,{key:"getTargetBitrate",value:,{key:"destroy",value:,{key:"_updateInfo",value:,{key:"_endPlay",value:]),e}(),c=function(){function e(){(0,n.PA)(this,e)}return(0,n.qH)(e,[{key:"select",value:function(e,t,r){if(e.length<=1)return e[0];var n,i=r.autoBitrateParams,o=i.paramA,u=i.paramB,s=i.paramC,c=i.paramD,l=r.defaultBitrate,f=-1===t?l:o*Math.pow(t,3)+u*Math.pow(t,2)+s*t+c;return(n=(0,a.v2)(e,f,r.selectAlgType))||(n=e[e.length-1]),n._targetBitrate=f,n}}]),e}(),l=function(){function e(t){(0,n.PA)(this,e),this._config=Object.assign({},t)}return(0,n.qH)(e,[{key:"select",value:function(e,t,r){if(e.length<=1)return e[0];var n,i=r.autoBitrateParams,o=i.paramA,u=i.paramB,s=i.paramC,c=i.paramD;this._config=Object.assign({},r);var l=this._config.defaultBitrate,f=t<=0||!t?l:o*Math.pow(t,3)+u*Math.pow(t,2)+s*t+c;return(n=(0,a.v2)(e,f,r.selectAlgType))||(n=e[e.length-1]),n._targetBitrate=f,n}}]),e}(),f=20,h={DEFAULT:"default",BITRATE_ADAPTER:"bitRateAdapter",USER_SELECT:"userSelect",OVER_SCORE:"overscore"},d={SIMPLE:"simple",BUFFER_INFO:"buffer-info",BANDWIDTH:"bandwidth-buffer"},p=function(){function e(t,r){var i=this;(0,n.PA)(this,e),this.config=e.defaultConfig;var o=t.config||{};Object.keys(o).map(function(e){i.config[e]=o[e]}),this.netRecords=[],this.speed=0,this.speedKB=0,this._selectorMap={},this._selectorMap[d.SIMPLE]=new c,this._selectorMap[d.BUFFER_INFO]=new s(r,this.config),this._selectorMap[d.BANDWIDTH]=new l(this.config)}return(0,n.qH)(e,[{key:"netSampling",value:function(t){this.netRecords.push(t),this.netRecords.length>e.MaxQueueCapacity&&(this.netRecords=this.netRecords.shift(0)),this.speed=this.getSpeed(),this.speedKB=this.speed/8/1024}},{key:"getSpeed",value:function(){var e=-1;if(this.netRecords.length<this.config.mSpeedRecordValidThreshold)return e;var t=[];this.netRecords.map(function(e){t.push(e)}),t.sort(function(e,t){return e.mSpeedInbPS-t.mSpeedInbPS});for(var r=t.length,n=0,i=0;i<r;i++)n+=t[i].mBytes;n/=2;for(var o=0;o<r;o++)(n-=t[o].mBytes)<=0&&(e=t[o].mSpeedInbPS);return e<0?-1:e}},{key:"select",value:function(e,t){if(!this.config.disabled){t=t||this.config.mode;var r=this.config,n=r.bitrateRange,i=r.defaultBitrate,o=e.filter(.sort(function(e,t){return t.bitrate-e.bitrate});if(!o.length){var a,u=1/0;e.forEach(,a&&o.push(a)}return(this._selectorMap[t]||this._selectorMap.simple).select(o,this.speed,this.config)||o[0]}}},{key:"selector",get:function(){var e=this.config.mode;return this._selectorMap[e]||this._selectorMap.simple}},{key:"getTargetBitrate",value:function(e,t){var r=this.selector;if(r&&r.getTargetBitrate)return r.getTargetBitrate(e,t)}},{key:"addSelect",value:,{key:"destroy",value:],[{key:"defaultConfig",get:function(){return{paramBf:.3,paramBp:.5,paramUpper:1.5,paramLower:.6,paramUpperBl:.7,paramVl1:.7,paramVl2:1e3,paramVlUpper:.9,paramVlLower:.8,bitrateUpper:2e6,bitrateLower:2e5,slidingWindowType:"by_weight",slidingWindowWeight:"size",slidingWindowWeightThreshold:3e5,slidingWindowCountThreshold:30,slidingWindowExtraction:"weighted_median",bitrateRange:[2e5,25e5],defaultBitrate:1e6,autoBitrateParams:{paramA:0,paramB:404330129e-17,paramC:.0164405979,paramD:225511.28,minBitrate:2e5},mSpeedRecordValidThreshold:2,mode:d.SIMPLE,needCheckDuration:!0,overscore:{isOpen:!1,enable266:!0,filterKey:"definition",filterList:[],scoreMultiple:2}}}},{key:"MaxQueueCapacity",get:function(){return f},set:function(e){f=e}}]),e}()},20107:function(e,t,r){r.d(t,{Z:function(){return d}});var n=r(89102);r(26108),r(42416),r(71602),r(31807),r(64200),r(75521);var i=r(96522),o=r(89735);r(57275);var a=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.PA)(this,e),this.config={size:30,severeBlockDuration:1500,slightBlockDuration:100,highBitrateRatio:1.5,lowBitrateRatio:.8,highLadderSelectedCnt:1,lowLadderSelectedCnt:1,blockSumMaxTime:6e5},Object.keys(r).map(function(e){t.config[e]=r[e]}),this.timerId=null,this.setTimer()}return(0,n.qH)(e,[{key:"setConfig",value:,{key:"resetCurrent",value:,{key:"setTimer",value:,{key:"targetBitRate",set:,{key:"selectBitRate",set:,{key:"blockDuration",set:,{key:"currentBlockDur",set:,{key:"updateBitRateInfo",value:,{key:"checkDefinition",value:]),e}();function u(e,t,r){var i=r.isOpen,o=r.enable266,a=r.filterKey,u=r.filterList,s=r.scoreMultiple,c=r.type;if(!i)return e;var l=null;return("filter"===c?l=function(e,t,r,n){var i=null;if(r.forEach(,!i)return null;for(var o=null,a=function(t){if(i.target.forEach(,o)return"break"},u=0;u<n.length&&"break"!==a(u);u++);return o}(a,e,u,t):"multiple"===c&&(l=function(e,t,r){if(!e)return null;for(var n=-1,i=0;i<r.length;i++)if(t.definition===r[i].definition){n=i;break}if(n>-1&&n<r.length-1){var o=n+e>r.length-1?r.length-1:n+e;return r[o]}return null}(s,e,t)),l&&(!l.isH266||o))?(0,n.Zj)((0,n.Zj)({},l),{},{type:"overscore",fromType:e.type,orgDefinition:e.definition}):e}var s=r(99400),c=new a({}),l=null,f=null,h={needCheckDuration:!0};let d=function(e){(0,n.XW)(r,e);var t=(0,n.WY)(r);function r(e){var i;return(0,n.PA)(this,r),i=t.call(this,e),(0,n._x)((0,n.Lc)(i),"_onXLog",,r.defaultConfig=e.config,i}return(0,n.qH)(r,[{key:"matchFactor",value:function(e,t,r){var n,i,o="Array"===(0,s.kM)(t)?t:[],a=!1;switch(e){case"core_cnt":r.core&&o.length>1&&r.core>=Number(o[0])&&r.core<=Number(o[1])&&(a=!0);break;case"memory":r.memory&&o.length>1&&r.memory>=Number(o[0])&&r.memory<=Number(o[1])&&(a=!0);break;case"video_screen_mode":o.length>0&&"landscape"===o[0]&&(n=r.videoHeight,i=r.videoWidth,n&&i&&i>n)&&(a=!0);break;case"encoder":o.length>0&&o[0]&&r.codecType&&o[0]===r.codecType&&(a=!0)}return a}},{key:"updateParamsByFactor",value:function(e){for(var t=this,r=this.playerConfig,n=r.codecType,i=r.videoHeight,o=r.videoWidth,a=0|window.navigator.deviceMemory,u=0|window.navigator.hardwareConcurrency,s=null,c={codecType:n,videoHeight:i,videoWidth:o,memory:a,core:u},l=0;l<e.length;l++){for(var f=e[l].factor||{},h=Object.keys(f),d=!0,p=0;p<h.length;p++)if(!this.matchFactor(h[p],f[h[p]],c)){d=!1;break}if(d){e[l].factor,s=e[l].config;break}}s&&Object.keys(s).forEach(}},{key:"afterCreate",value:function(){var e=this.config.multiFactors;e&&e.length>0&&this.updateParamsByFactor(e),this._bindEvent(),this.bitRateAdapter=new o.ZP({config:this.config},this.player),l||(l=new o.ZP({config:this.config})),c.setConfig(this.config.detectConfig||{}),c.resetCurrent(),this.curBitRate=this.getInitBitrate(),this.player.curDefinition=this.curBitRate}},{key:"beforePlayerInit",value:function(){this.curBitRate=this.getInitBitrate(),this.player.curDefinition=this.curBitRate}},{key:"_bindEvent",value:,{key:"getInitBitrate",value:function(){if(!this.config.disabled){var e=this.player,t=this.config,r=this.playerConfig;f=r.userSelectDefinition;var n=this.getSuitableBitrate(e.definitionList,r.userSelectDefinition);return n?r.url=n.url:n={url:r.url,definition:r.defaultDefinition||t.definition,bitrate:r.defaultBitrate||r.bitrate,type:o.vK.DEFAULT},n.networkSpeed=e.speed,n}}},{key:"getSuitableBitrate",value:function(e,t){if(e=(0,s.VX)(e,"video"),this.bitRateAdapter&&e&&!(e.length<1)){var n=e.sort(function(e,t){return t.bitrate-e.bitrate}),i=this.getAdaptBitrate(n),a=i?i.duration:0,l=(null===(h=i)||void 0===h?void 0:h._targetBitrate)||i.bitrate,f=this.player;if((null===(d=this.config)||void 0===d?void 0:d.mode)===o.vP.BANDWIDTH){var h,d,p,v=Object.assign({},this.config);v.mode=o.vP.BUFFER_INFO;var g=new o.ZP({config:v});g.speed=f.avgSpeed||f.speed;var y=null==g?void 0:g.select(e,v.mode),m=(null==y?void 0:y._targetBitrate)||(null==y?void 0:y.bitrate);p=!f.avgSpeed||f.avgSpeed<0?m:(null==v?void 0:v.mixFactor)>=0&&v.mixFactor<=1?l*v.mixFactor+m*(1-v.mixFactor):(null==v?void 0:v.mixFactor)>1?Math.max(l,m):Math.min(l,m),(i=(0,s.v2)(e,p,v.selectAlgType))||(i=e[e.length-1]),i._targetBitrate=p}var _=this.bitRateAdapter.getTargetBitrate(a,e,this.player.avgSpeed);if(_&&(c.targetBitRate=_),t){var b=r.getUserSelectBitrate(n,t);b&&(c.selectBitRate=b.bitrate,c.updateBitRateInfo(b.bitrate,_),i=b)}return this.config.overscore&&this.config.overscore.isOpen?u(i,n,this.config.overscore):i}}},{key:"getAdaptBitrate",value:function(e){if(!this.config.disabled){var t=this.player,r=null;return e&&e.length&&this.bitRateAdapter&&(this.bitRateAdapter.speed=t.avgSpeed||t.speed,r=this.bitRateAdapter.select(e)),r&&(r.type=o.vK.BITRATE_ADAPTER),r}}},{key:"getDefinition",value:,{key:"needChangeDefinition",value:function(){var e=this.player,t=e.curDefinition,n=e.definitionList,i=this.playerConfig,o=i.userSelectDefinition,a=i.extDefinition,u=a&&a.length>0?a:n,s={type:0,message:"DO_NOT_UPDATE",targetDefinition:null};if(!o||u.length<2)return s;var l=t;o&&(l=r.getUserSelectBitrate(u,o));var f=c.checkDefinition();s.type=f;var h=this.getAdaptBitrate(u);if(!h||0===f||!h||!h.bitrate||!l||!l.bitrate)return s.message="DO_NOT_UPDATE",s;var d=h.bitrate>=l.bitrate,p=h.bitrate<l.bitrate,v=null;switch(1===f?v=d?this.getDefinition(u,l.bitrate,!0):h:2===f&&(v=p?this.getDefinition(u,l.bitrate,!1):h),s.targetDefinition=v,s.targetDefinition&&s.targetDefinition.definition!==o||(s.type=0),s.type){case 1:s.message="NEED_TO_REDUCE_BITRATE";break;case 2:s.message="CAN_UPGRADE_BITRATE";break;default:s.message="DO_NOT_UPDATE"}return s}},{key:"detectDefInfo",get:function(){return c}},{key:"destroy",value:function(){this.bitRateAdapter&&this.bitRateAdapter.destroy(),this.bitRateAdapter=null,this.off("xglog",this._onXLog),c&&c.resetCurrent()}}],[{key:"pluginName",get:function(){return"BitrateSelector"}},{key:"defaultConfig",get:set:,{key:"getSuitableBitrate",value:function(e,t,n,i){if((e=(0,s.VX)(e,"video"))&&!(e.length<1)){n||(n=r.defaultConfig),t||(t=f);var a=e.sort(function(e,t){return t.bitrate-e.bitrate}),d=null;if(l||(l=new o.ZP({config:Object.assign(n,h)})),a&&a.length&&l){var p=(d=l.select(a))._targetBitrate||d.bitrate;if((null===(v=n)||void 0===v?void 0:v.mode)===o.vP.BANDWIDTH){var v,g,y,m,_=Object.assign({},n);_.mode=o.vP.BUFFER_INFO;var b=new o.ZP({config:_});b.speed=i;var k=null==b?void 0:b.select(e,_.mode),w=(null==k?void 0:k._targetBitrate)||(null==k?void 0:k.bitrate);m=!i||i<0?w:(null===(g=n)||void 0===g?void 0:g.mix_factor)>=0&&n.mix_factor<=1?p*n.mix_factor+w*(1-n.mix_factor):(null===(y=n)||void 0===y?void 0:y.mix_factor)>1?Math.max(p,w):Math.min(p,w),(d=(0,s.v2)(e,m,n.selectAlgType))||(d=e[e.length-1]),d._targetBitrate=m}}d&&(d.type="bitRateAdapter");var P=d?d.duration:0,C=l?l.getTargetBitrate(P,e):null;if(C&&(c.targetBitRate=C),t){var x=r.getUserSelectBitrate(a,t);x&&(c.selectBitRate=x.bitrate,c.updateBitRateInfo(x.bitrate,C),d=x)}return n.overscore&&n.overscore.isOpen?u(d,a,n.overscore):d}}},{key:"getUserSelectBitrate",value:function(e,t){if(t&&e&&e.length>0){for(var r=null,n=null,i=0;i<e.length;i++){if(t===e[i].definition){r=e[i];break}!n&&t<e[i].definition&&(n=e[i])}return r||(r=n||e[e.length-1]),r.type=o.vK.USER_SELECT,r}return null}}]),r}(i.ZP)},30603:function(e,t,r){r.r(t),r.d(t,{BitrateAdapter:function(){return i.ZP},NetSpeedRecord:function(){return a},default:function(){return n.Z}});var n=r(20107),i=r(89735);r(71602),r(31807),r(64200);var o=r(99400);let a={maxQueueCapacity:20,mSpeedRecordValidThreshold:1,netRecords:[],weightedSpeedKB:0,weightedSpeed:0,speed:0,realTimeSpeed:0,getWeightedSpeed:getAvgSpeed:netSpeedSampling:},99400:function(e,t,r){function n(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n]}unction o(e,t){var r=[];return e.forEach(function(e){e.mediaType&&e.mediaType!==t||r.push(e)}),r}function a(e,t,r){return r?1===r?function(e,t){if(!e)return null;for(var r=-1,n=0;n<e.length;n++)if(e[n]&&e[n].bitrate&&t>=e[n].bitrate){r=n;break}return r<0?null:e[r]}(e,t):void 0:function(e,t){if(!e)return null;var r,n=1/0;return(e.forEach(,r)?r:null}(e,t)}r.d(t,{VX:function(){return o},cM:function(){return n},kM:function(){return i},v2:function(){return a}}),r(49118),r(19232),r(41224),r(71602),r(2071),r(31807)},47661:function(e,t,r){nction o(){o=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";ry{c({},"")}catch(e){c=wrap=l;var h={};function d(){}function p(){}ar g={};c(g,a,function(){return this});var y=Object.getPrototypeOf,m=y&&y(y(x([])));m&&m!==t&&r.call(m,a)&&(g=m);var _=v.prototype=d.prototype=Object.create(g);p.prototype=v,n(_,"constructor",{value:v,configurable:!0}),n(v,"constructor",{value:p,configurable:!0}),p.displayName=c(v,s,"GeneratorFunction"),e.isGeneratorFunction=e.mark=e.awrap=b(k.prototype),c(k.prototype,u,function(){return this}),e.AsyncIterator=k,e.async=b(_),c(_,s,"Generator"),c(_,a,,c(_,"toString",,e.keys=e.values=x,C.prototype={constructor:C,reset:stop:dispatchException:abrupt:complete:finish:catch:delegateYield:,e}(){return a},Lc:function(){return g},PA:function(){return c},WY:function(){return y},XW:function(){return d},ZQ:function(){return m},Zj:function(){return i},_x:function(){return h},l5:function(){return o},qH:function(){return f},sf:function(){return w},u:function(){return _},x:function(){return s}})},13720:function(e,t,r){r.d(t,{R:function(){return a},d:function(){return o}});var n,i,o=((n=o||{})[n.DURATION=0]="DURATION",n[n.SIZE=1]="SIZE",n),a=((i=a||{})[i.INDEXDB=0]="INDEXDB",i[i.MEMORY=1]="MEMORY",i)},25553:function(e,t,r){r.r(t),r.d(t,{CACHE_TYPES:function(){return n.R},PRELOAD_EVENTS:function(){return a.K},PRELOAD_TYPES:function(){return n.d},PreloaderBase:function(){return i.Z},PreloaderManager:function(){return o.Z}});var n=r(13720),i=r(70609),o=r(47253),a=r(65327)},70609:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(47661);r(71602),r(3156),r(15009);var i=r(1987),o=r.n(i),a=r(47253),u=function(e){(0,n.XW)(s,e);var t,r,i,o,u=(0,n.WY)(s);function s(e,t){var r;return(0,n.PA)(this,s),(r=u.call(this))._data=null,r._preloadManager=e,r._config=t,r.promisePolyfill(),r}return(0,n.qH)(s,[{key:"getRequestOption",value:function(e){var t=this._config,r=t.getRequestOptionsCallback,n=t.reqOptions,i={};return e?i=e.reqOptions?e.reqOptions:"function"==typeof r?r(e):n||{}:i}},{key:"getUserSelectDefinition",value:,{key:"selectBitrate",value:,{key:"promisePolyfill",value:,{key:"preloadManager",get:function(){return this._preloadManager}},{key:"getData",value:function(){return this._data}},{key:"setData",value:,{key:"start",value:(t=(0,n.x)((0,n.l5)().mark(function e(t,r){return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("start need implment, return Promise");case 1:case"end":return e.stop()}},e)})),},{key:"cancel",value:(r=(0,n.x)((0,n.l5)().mark(function e(){return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("cancel need implment, cancel current preload request");case 1:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"getPreLoadData",value:(i=(0,n.x)((0,n.l5)().mark(function e(t){return(0,n.l5)().wrap(e)})),},{key:"hasItemSameVid",value:function(e){return!0}},{key:"destroy",value:(o=(0,n.x)((0,n.l5)().mark(function e(){return(0,n.l5)().wrap(e)})),},{key:"stepwise",get:,{key:"parseKey",value:],[{key:"generateUniqueKey",value:,{key:"vtype",get:,{key:"isUniqueCache",value:]),s}(o())},47253:function(e,t,r){r.d(t,{Z:function(){return A}});var n=r(47661);r(61151),r(49118),r(75521),r(64200),r(23978),r(71602),r(3156),r(31807),r(42416);var i=r(43753),o=r(1987),a=r.n(o);r(19232),r(85248),r(71654),r(15009),r(29994),r(15667),r(79064),r(31538);var u=r(97069),s=r(13720);r(36766),r(59564),r(93567),r(19858),r(2071);var c=function(){try{if("undefined"!=typeof indexedDB)return indexedDB}catch(e){}}();r h={},d="readonly",p="readwrite";unction g(e,t){return new Promise(function(r,n){if(h[e.name]=h[e.name]||_(),e.db){if(!t)return r(e.db);v(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var o=null==c?void 0:c.open.apply(c,i);t&&(o.onupgradeneeded=function(t){var r=o.result;try{r.createObjectStore(e.storeName)}catch(e){if("ConstraintError"===e.name);else throw e}}),o.onerror=o.onsuccess=function(){var t;r(o.result),(t=h[e.name].deferredOperations.pop())&&(t.resolve(),t.promise)}})}unction m(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(i){if(n>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return Promise.resolve().then(.then(function(){return(function(e){v(e);for(var t=h[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,g(e,!1).then(function(t){return(e.db=t,y(e))?g(e,!0):t}).then(.catch(function(t){var r;throw(r=h[e.name].deferredOperations.pop())&&(r.reject(t),r.promise),t})})(e).then(}).catch(r);r(i)}}ar b=function(){function e(){(0,n.PA)(this,e)}return(0,n.qH)(e,[{key:"ready",value:,{key:"_initStorage",value:function(e){var t=this;t._defaultConfig=e;var r={db:null,name:"",version:""};if(e)for(var n in e)r[n]=e[n];var i=h[r.name];i||(i=_(),h[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t._ready=t._fullyReady);var o=[];or(var u=0;u<i.forages.length;u++){var s=i.forages[u];s!==t&&o.push(s._initReady().catch(a))}var c=i.forages.slice(0);return t._ready=Promise.all(o).then(.then(function(e){return(r.db=e,y(r,t._defaultConfig.version))?g(r,!0):e}).then(,t._ready}},{key:"probeSupport",get:function(){return function(){try{if(!(null!=c&&c.open))return!1;var e=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}()}},{key:"getItem",value:,{key:"setItem",value:,{key:"removeItem",value:,{key:"clear",value:,{key:"length",value:,{key:"all",value:function(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){m(t._dbInfo,d,function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).openCursor(),a=[];o.onsuccess=function(){var t=o.result;if(!t){e(a);return}a.push({key:t.key,value:t.value}),t.continue()},o.onerror=catch(e){r(e)}})}).catch(r)});return l(r,e),r}},{key:"_fullyReady",value:function(e){var t=this,r=t._initReady().then(function(){var e=h[t._dbInfo.name];if(null!=e&&e.dbReady)return e.dbReady});return"function"==typeof e&&r.then(e),"function"==typeof e&&r.catch(e),r}}]),e}(),k=function(){eturn(0,n.qH)(e,[{key:"_initStorage",value:function(e){var t=e.name,r=e.storeName,i="".concat(t,"_").concat(r);return this.key=i,window[i]&&"object"===(0,n.Ac)(window[i])||(window[i]={}),this.store=window[i],Promise.resolve()}},{key:"getItem",value:,{key:"setItem",value:,{key:"removeItem",value:,{key:"clear",value:,{key:"length",value:,{key:"_internalPromise",value:,{key:"all",value:,{key:"probeSupport",value:]),e}(),w={description:"",name:"__PRE_CACHE__",storeName:"keyvaluepairs",version:1},P="__PRE_CACHE__KEYS",C=function(){var e;function t(e,r){(0,n.PA)(this,t),this._allCachedKeyMap={},this._memory=0,this._cnt=0;var i=r===s.R.MEMORY?k:b;this._driver=new i,this._driver._initStorage(w).catch(function(){}),this._hasIdbForbidden=!1,this._maxCache=!e||e<=0?200:e,this.setMaxCache(this._maxCache),this._allCachedKeys={},this._allCachedTimeKeys={},this.getCachedKeysFromLocal(),this._readyPromise=new u.XK,this.init()}return(0,n.qH)(t,[{key:"getCachedKeysFromLocal",value:function(){var e=u.Xb.getItem(P);if(e)for(var t=e.split("|"),r=0;r<t.length;r++){var n=t[r],i=this._getCacheKeyInfos(n),o=i.time,a=i.cachedKey;this._allCachedKeys[a]=1,this._allCachedTimeKeys[a]=o}}},{key:"_getCacheKeyInfos",value:,{key:"writeCachedKeysToLocal",value:function(e){var t=[];this._allCachedKeys={},this._allCachedTimeKeys={};for(var r=0;r<e.length;r++){var n=e[r].key,i=this._getCacheKeyInfos(n),o=i.time,a=i.cachedKey;this._allCachedKeys[a]=1,this._allCachedTimeKeys[a]=o,t.push(n)}var s=t.join("|");u.Xb.setItem(P,s)}},{key:"init",value:,{key:"_getAll",value:function(){var e=this;this._memory=0,this._cnt=0,this._driver.all().then(function(t){e._cachedLength=t.length;var r=t.length-e._maxCache,i=t;if(r>0){var o=t.slice(0,r);i=t.slice(r);for(var a=0;a<o.length;a++)e.removeItem(o[a].key).then(function(){})}e._cnt=i.length;for(var u=0;u<i.length;u++){var s=i[u];if("object"===(0,n.Ac)(s.value)){Object.values(s.value).forEach(function(t){e._memory+=(null==t?void 0:t.memory)||0});var c=e._getCacheKeyInfos(s.key).cachedKey;e._allCachedKeyMap[c]=Object.keys(s.value)}}e.writeCachedKeysToLocal(i)}).catch(}},{key:"getAllCachedDataKeys",value:function(){var e=[];return Object.values(this._allCachedKeyMap).forEach(,e}},{key:"getItem",value:(e=(0,n.x)((0,n.l5)().mark(function e(t,r,i){var o,a,u,s;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((o=this.hasItem(t))&&i&&(o=(null==(a=this._allCachedKeyMap[t])?void 0:a.includes(i))||!1),o){e.next=4;break}return e.abrupt("return",Promise.resolve(!1));case 4:return u=this._getTimeKey(t).timeKey,e.next=7,this._driver.getItem(u,r);case 7:if(s=e.sent,!i){e.next=10;break}return e.abrupt("return",s[i]);case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}},e,this)})),},{key:"setItem",value:,{key:"_getTimeKey",value:,{key:"_genTimeKey",value:,{key:"removeItem",value:function(e,t){var r=this._getTimeKey(e).timeKey,n=this._driver.removeItem(r,t);return delete this._allCachedKeys[e],delete this._allCachedTimeKeys[e],delete this._allCachedKeyMap[e],n}},{key:"hasItem",value:,{key:"clear",value:function(e){return this._driver.clear(e)}},{key:"length",value:function(e){return this._driver.length(e)}},{key:"setMaxCache",value:,{key:"getMemoryInfo",value:]),t}();r(43274),r(66147),r(15992),r(88359),r(17),r(65189),r(96274),r(77135),r(36215),r(32822),r(73297),r(82825),r(74188),r(98424);var x=0,T=function(){function e(t){var r=this;(0,n.PA)(this,e),this._preload_bandwith_map=new Map,this._usepreload_info=new Map,this._pcdn_info_map=new Map,this._updateRealTimeSpeed=function(e){x=e.speed,r.emit(i.kW,e)},this._manager=t}return(0,n.qH)(e,[{key:"setPreloadBandwidth",value:function(e,t){this._preload_bandwith_map.set(e,t)}},{key:"getPreloadBandwidth",value:,{key:"_updateLoadInfo",value:function(e,t,r){var n=this._pcdn_info_map.get(e);n||(n={}),n[t]||(n[t]={},n[t].loadLen=0),n[t].loadLen=n[t].loadLen+r,this._pcdn_info_map.set(e,n)}},{key:"getLoadInfoAndDelete",value:,{key:"getPreloadUnuseInfo",value:function(){var e,t={},r=(0,n.sf)(this._preload_bandwith_map);try{for(r.s();!(e=r.n()).done;){var i=(0,n.ZQ)(e.value,2),o=i[0],a=i[1];if(this._usepreload_info.get(o))this._preload_bandwith_map.delete(o);else{var u=o.split("#"),s=u.length>0?u[0]:o;t[s]?(t[s].bw+=a.bw||0,t[s].pbw+=a.pbw||0):t[s]={vid:s,bw:a.bw||0,pbw:a.pbw||0,bitrate:a.bitrate||0,duration:a.duration||0}}}}catch(e){r.e(e)}finally{r.f()}return Object.values(t)}},{key:"bwEventEmit",value:function(e){var t=e.vid,r=e.loadType,n=e.size,o=e.speed,a=e.cacheKey,u=e.vtype,s=e.duration,c=e.bitrate,l=this.getPreloadBandwidth(a)||{bw:0,pbw:0,vid:t,duration:s,bitrate:c};r&&r!==i._R.CDN?(l.pbw=l.pbw+n,this.emit("prf_data_size",{vid:t,task_type:2,pcdn_size:n,pcdn_speed:o,vtype:u,bitrate:c,duration:s})):(l.bw=l.bw+n,this.emit("prf_data_size",{vid:t,task_type:2,cdn_size:n,cdn_speed:o,vtype:u,duration:s,bitrate:c})),this.setPreloadBandwidth(a,l),this._updateRealTimeSpeed({speed:o,type:r||i._R.CDN}),this._updateLoadInfo(a,r,n)}},{key:"setUsePreloadInfo",value:,{key:"realTimeSpeed",get:,{key:"emit",value:,{key:"destroy",value:function(){this._preload_bandwith_map=new Map,this._usepreload_info=new Map,this._pcdn_info_map=new Map,this._manager=null}}]),e}();function I(e,t){var r=[0,0];if(e)for(var n=0,i=e.length;n<i&&(r[0]=e.start(n),r[1]=e.end(n),!(r[0]<=t)||!(t<=r[1]));n++);return r[0]-t<=0&&t-r[1]<=0?r:[0,0]}function S(e,t,r){for(var n=0;n<e.length;n++)if(r===e[n][t])return n;return -1}var D=r(65327),O=!1,L="PRELOAD_NEXT",A=function(e){(0,n.XW)(l,e);var t,r,o,a,u,s,c=(0,n.WY)(l);function l(){var e;return(0,n.PA)(this,l),(e=c.call(this))._loaders={},e._loaderInsts={},e._taskIntervalId=0,e._currentPreloadInst=null,e._preloadDataList=[],e._player=null,e._stepwise=!1,e._playingVids=[],e._isOpen=!0,e._userDefinition=null,e._startDefinition=null,e.onPreloadNext=(0,n.x)((0,n.l5)().mark(function t(){var r,i,o,a,u,s,c,l,f,h,d,p,v,g;return(0,n.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=(o=(0,n.Lc)(e))._preloadDataList,u=o._config,!(!e._isOpen||e._currentPreloadInst||e._preloadDataList.length<1)){t.next=3;break}return t.abrupt("return",!1);case 3:if(c=null==(s=e.findPreloadItem(a,!1))?void 0:s.data,!(!s||!(null!=c&&c.payload))){t.next=7;break}return t.abrupt("return",!1);case 7:if(l=null,l=e.selectBeforeStart(c),e._filterMaxPayload(c,l),e.setStartDefinition(null===(r=l)||void 0===r?void 0:r.definition),e.log("log","selectBeforeStart",null===(i=l)||void 0===i?void 0:i.vtype,l),f=e._getPreloaderKey(l||c)){t.next=17;break}return e.log("warn","need to set vtype, no preloader",c),u.autoPreload&&e.emit(L),t.abrupt("return",!1);case 17:if(h=e._getLoaderInst(f)){t.next=23;break}if(d=e._getLoader(f)){t.next=22;break}return t.abrupt("return",!1);case 22:h=new d((0,n.Lc)(e),e._config);case 23:return e._currentPreloadInst=h,e._currentPreloadInst.setData(c),t.prev=25,e.log("log","loaderInst.start",f,e.getStartDefinition(),c),t.next=29,h.start(c,e.getStartDefinition());case 29:(p=t.sent)&&p.remove&&(v=a.indexOf(s))>-1&&a.splice(v,1),t.next=36;break;case 33:t.prev=33,t.t0=t.catch(25),e.log("error","preload data error!",t.t0);case 36:return t.prev=36,null===(g=e._currentPreloadInst)||void 0===g||g.setData(null),e._currentPreloadInst=null,e._config.autoPreload&&e.emit(L),t.finish(36);case 41:return t.abrupt("return",!0);case 42:case"end":return t.stop()}},t,null,[[25,33,36,41]])})),e._stats=new T((0,n.Lc)(e)),e}return(0,n.qH)(l,[{key:"getPreloadMetaByVid",value:function(e){for(var t=this.getAllCachedDataKeys(),r=[],n="",i=0;i<t.length;i++){var o=t[i],a=l.parseKey(o);a.vid===e&&(n=a.vtype,r.push(o))}if(0===r.length)return null;var u=this._getLoaderInst(n);return u?u.parseKey(r):null}},{key:"VTYPES",get:,{key:"log",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];O&&(t=console)[e].apply(t,["[PreloaderManager]"].concat(n))}},{key:"register",value:function(e){var t=l.getDefaultConfig();this._config=Object.assign({},t,e.config),this._options=e;var r=this._config,n=r.preloadMaxCacheCount,i=r.preloadCacheType;this._stepwise=!!this._config.stepwise,this._cacheInst=new C(n,i),this._selector=e.BitrateSelector,this.on(L,this.onPreloadNext);for(var o=e.loaders,a=0;a<o.length;a++)this.registerLoader(o[a].vtype,o[a])}},{key:"registerLoader",value:function(e,t){e&&(this._loaders[e]&&this.log("warn","vtype:".concat(e," Preloader already exist")),this._loaders[e]=t,this._loaderInsts[e]=new t(this,this._config))}},{key:"_checkIfCanPreload",value:function(){if(null===this._currentPreloadInst&&this._preloadDataList.length>0){var e=this.findPreloadItem(this._preloadDataList),t=null==e?void 0:e.data;if(e&&null!=t&&t.payload){if(!this._getPreloaderKey(t))return this.log("warn","need to set vtype"),this.stopCheckTask(),!1;var r=this._config.checkIfCanPreload;if(r&&"function"==typeof r)return r(t);if(this._config.autoCheckPreload)return this._autoCheckPreload(t,e);this.stopCheckTask()}}return!1}},{key:"_autoCheckPreload",value:function(e,t){if(!this._media)return this.log("warn","need set video"),this._stepwise||this._addData(t),!1;var r=function(e,t,r){if(!e)return!1;var n=I(e.buffered,e.currentTime),i=t.startPreloadControl,o=t.startPreloadMinBuffer,a=t.startPreloadMinPosTime,u=t.minBufferLength;if(i){var s=Math.max(n[1]-e.currentTime,0);if(s>o){if(e.currentTime>a)return null==r||r("log","[checkIfCanPreload startPreloadControl true return true] buffer",s,"startPreloadMinBuffer",o),!0;if(e.currentTime>e.duration/2)return null==r||r("log","[checkIfCanPreload startPreloadControl true return true] video.currentTime",e.currentTime,"video.duration",e.duration),!0}else if(e.currentTime+o+1>e.duration&&e.currentTime+s>e.duration-1)return null==r||r("log","[checkIfCanPreload startPreloadControl true return true] end"),!0}else{var c=e.duration>u+5?u:e.duration/2,l=Math.min(e.currentTime+u,e.duration),f=n[1]-l;if(e.currentTime>c&&f>-1)return null==r||r("log","[checkIfCanPreload startPreloadControl false return true] minPos",c,"minCacheTime",l),!0}return!1}(this._media,this._config,this.log),n=this._player;if(r&&n){var i=n.config.vid,o=this._config,a=o.minBufferLength,u=o.startPreloadControl,s=o.startPreloadMinBuffer,c=o.startPreloadMinPosTime,l=I(n.video.buffered,n.currentTime),f=l[1]?l[1]-n.currentTime:0;this.emit(D.K.PRELOAD_TIME,{vid:i,pid:e.vid,buffer:l,currentTime:n.currentTime,minBufferLength:a,startPreloadControl:u,startPreloadMinBuffer:s,startPreloadMinPosTime:c,bufferHead:f})}return r}},{key:"_getPreloaderKey",value:,{key:"_sort",value:function(e){e.sort(function(e,t){return void 0===e.order&&void 0===t.order||"number"==typeof e.order&&"number"==typeof t.order&&e.order<t.order?-1:1})}},{key:"_addPlayingVid",value:function(e,t){var r=this._playingVids,n=S(this._playingVids,"playerId",e);n>-1?r[n].vid=t:r.push({vid:t,playerId:e})}},{key:"selectBeforeStart",value:function(e){var t=e.targetDefinition,r=e.defaultDefinition;if(t)return(0,n.Zj)({},t);var i=this.getUserSelectDefinition(),o=this.selectBitrate(null==e?void 0:e.payload,r,i),a=(null==o?void 0:o.vtype)||e.vtype,u=(0,n.Zj)((0,n.Zj)({},o),{},{vtype:a});return e.targetDefinition=u,this.log("log","selectBeforeStart",null==e?void 0:e.vid,a,null==o?void 0:o.definition,null==e?void 0:e.payload,o),u}},{key:"selectBitrate",value:function(e,t,r){if(e.length<1)return null;var i,o,a,u=null;if(this._selector)u=this._selector.getSuitableBitrate(e,r),this.log("log","BitRateAdapter result",null===(i=u)||void 0===i?void 0:i.vtype,null===(o=u)||void 0===o?void 0:o.definition,null===(a=u)||void 0===a?void 0:a.bitrate);else{for(var s=-1,c=-1,l=0;l<e.length;l++){var f=e[l];r&&f.definition===r?s=l:t&&f.definition===t&&(c=l)}u=e[s>=0?s:c>=0?c:0]}return(0,n.Zj)({},u)}},{key:"startCheckTask",value:function(){var e=this,t=this._preloadDataList,r=this._config.autoCheck;this._taskIntervalId&&(window.clearTimeout(this._taskIntervalId),this._taskIntervalId=0),0!==t.length&&(this._checkIfCanPreload()&&this.onPreloadNext(),this._taskIntervalId=window.setTimeout(function(){e.startCheckTask()},r.interval))}},{key:"stopCheckTask",value:function(){this._taskIntervalId&&(window.clearTimeout(this._taskIntervalId),this._taskIntervalId=-1)}},{key:"preloadNext",value:,{key:"_filterMaxPayload",value:function(e,t){var r=t.vtype;if(r){var n=e.vtype===r;e.vtype=r,e.payload=e.payload.filter(}}},{key:"addPreloadList",value:(t=(0,n.x)((0,n.l5)().mark(function e(t){var r,i,o;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._sort(t),r=(0,n.sf)(t),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=10;break}return o=i.value,e.next=8,this._addData(o);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:this._checkAutoTask();case 19:case"end":return e.stop()}},e,this,[[2,12,15,18]])})),function(e){return t.apply(this,arguments)})},{key:"addPlayingId",value:function(e,t){for(var r=this._preloadDataList,n=-1,i=0;i<r.length;i++)if(e===r[i].data.vid){n=i;break}if(n>-1){var o=r.splice(n,1);this.log("log","cancelPreloadByVid remove from list",o.length>0&&o[0].data.vid)}var a=this._currentPreloadInst,u=a?a.getData():null;this.log("log","_currentPreloadInst",u),u&&u.vid===e&&this.cancel(),t&&this._addPlayingVid(t,e)}},{key:"removePlayingId",value:function(e){var t=this._playingVids,r=S(t,"playerId",e);if(r>-1){var n=t.splice(r,1);this.log("log","removePlayingId",n.length>0&&n[0].playerId)}}},{key:"addPreload",value:(r=(0,n.x)((0,n.l5)().mark(function e(t){return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._addData(t);case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:this._sort(this._preloadDataList),this._checkAutoTask();case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_addData",value:(o=(0,n.x)((0,n.l5)().mark(function e(t){var r,i,o,a,u,s,c,l,f,h=this;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.vtype){e.next=3;break}return this.log("warn","vtype is null, can\xb7t select loader"),e.abrupt("return",!1);case 3:if(r=t.data,i=this._getLoader(r.vtype)){e.next=8;break}return this.log("warn","the loader for ".concat(r.vtype," not registered")),e.abrupt("return",!1);case 8:if(!((a=S(o=this._playingVids,"vid",t.data.vid))>=0)){e.next=14;break}return u=o[a],this.log("log","vid:".concat(u.vid," is already instantiated and loaded, playerId is ").concat(u.playerId)),e.abrupt("return");case 14:return s=this._getUniqueKey(t),e.next=17,this.getItem(t.data,!0);case 17:if(!(c=e.sent)||!i.isUniqueCache(c)){e.next=22;break}return this.log("log","".concat(s," already exist in cache")),e.abrupt("return",!1);case 22:if(!this._currentPreloadInst||!(l=this._currentPreloadInst.getData())||this._getUniqueKey({data:l,order:0})!==s){e.next=29;break}return this.log("log","currentKey repeat"),e.abrupt("return");case 29:if(f=this._preloadDataList.filter(,this.log("log","addedItems",s,f),0!==f.length){e.next=35;break}return this._stepwise&&"undefined"===t.data.steps&&(t.data.steps=[0]),this._preloadDataList.push(t),e.abrupt("return",!0);case 35:return this.log("log","".concat(s," already exist in preloadList")),e.abrupt("return",!1);case 37:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"_getUniqueKey",value:function(e){return e.data.vtype?l.generateUniqueCacheKey(e.data):e.data.vid}},{key:"_checkAutoTask",value:function(){var e=this,t=this._config,r=t.autoCheck,n=t.autoPreload;Promise.resolve().then(function(){n&&e.emit(L),r.enable&&!e._taskIntervalId&&e.startCheckTask()})}},{key:"setItem",value:function(e,t,r,i){var o=l.generateUniqueCacheKey(e);if(!r){var a=this._getLoader(e.vtype);if(!a)return this.log("warn","no ".concat(e.vtype," preloader, register")),Promise.resolve(!1);var u=a.generateUniqueKey(e);t=(0,n._x)({},u,t)}return this._cacheInst.setItem(o,t,i)}},{key:"getItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=l.generateUniqueCacheKey(e),i=this._getLoader(e.vtype);if(!i)return this.log("warn","no ".concat(e.vtype," preloader, register")),Promise.resolve(!1);var o=t?"":i.generateUniqueKey(e);return this._cacheInst.getItem(n,r,o)}},{key:"removeItem",value:function(e,t){var r=l.generateUniqueCacheKey(e);return this._cacheInst.removeItem(r,t)}},{key:"getPreLoadData",value:(a=(0,n.x)((0,n.l5)().mark(function e(t){var r,i,o;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.vtype,!(i=this._getLoaderInst(r))){e.next=7;break}return e.next=5,i.getPreLoadData(t);case 5:return o=e.sent,e.abrupt("return",o);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"removeAll",value:function(){var e=this;this.getAllCachedDataKeys().forEach(function(t){var r=e.getPreloadMetaByVid(t.split("#")[0]);r&&e.removeItem(r,null)})}},{key:"removeAllPreloadTask",value:,{key:"disable",value:,{key:"enable",value:function(){this._isOpen=!0,this._config.autoCheck.enable&&!this._taskIntervalId&&this._preloadDataList.length>0&&this.startCheckTask()}},{key:"setUserSelectDefinition",value:function(e){this._userDefinition=e}},{key:"getUserSelectDefinition",value:,{key:"getStartDefinition",value:function(){return this._startDefinition}},{key:"setStartDefinition",value:function(e){this._startDefinition=e}},{key:"destroy",value:(u=(0,n.x)((0,n.l5)().mark(function e(){var t,r,i,o;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stats.destroy(),t=Object.keys(this._loaderInsts),r=0;case 3:if(!(r<t.length)){e.next=13;break}if(i=t[r],o=this._getLoaderInst(i),e.t0=o,!e.t0){e.next=10;break}return e.next=10,o.destroy();case 10:r++,e.next=3;break;case 13:this.removeAllListeners(),this._loaderInsts={},this._loaders={},this._playingVids=[],this.detachPlayer();case 18:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"cancel",value:(s=(0,n.x)((0,n.l5)().mark(function e(){var t;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._currentPreloadInst){e.next=4;break}return e.next=3,this._currentPreloadInst.cancel();case 3:null===(t=this._currentPreloadInst)||void 0===t||t.setData(null);case 4:this._currentPreloadInst=null;case 5:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"removeByPlayInst",value:function(e,t){for(var r=this._preloadDataList.length-1;r>-1;r--){var n=this._preloadDataList[r];if(n.data.vid===e&&n.playerId===t){this._preloadDataList.splice(r,1);break}}}},{key:"getAllCachedDataKeys",value:function(){return this._cacheInst.getAllCachedDataKeys()}},{key:"getDataUniqueKey",value:function(e){var t=this._getLoader(e.vtype);return!!t&&t.generateUniqueKey(e)}},{key:"hasItemSameVid",value:function(e){var t=this._getLoader(e.vtype),r=this._getLoaderInst(e.vtype);if(t&&r){var n=t.generateUniqueKey(e);return r.hasItemSameVid(n)}return!1}},{key:"_getLoader",value:function(e){return e=e||"",this._loaders[e]||this._loaders[e.toLocaleLowerCase()]||(this.log("warn","no ".concat(e," preloader, register")),null)}},{key:"_getLoaderInst",value:function(e){return e=e||"",this._loaderInsts[e]||this._loaderInsts[e.toLocaleLowerCase()]||(this.log("warn","no ".concat(e," preloader, register")),null)}},{key:"currentPreloadInst",get:function(){return this._currentPreloadInst}},{key:"preloadDataList",get:function(){return this._preloadDataList}},{key:"getPreloadMemoryInfo",value:function(){return this._cacheInst.getMemoryInfo()}},{key:"attachPlayer",value:function(e){this._player=e,this._media=e.video||e.media}},{key:"detachPlayer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&this._player!==e||(this._player=null,this._media=null)}},{key:"player",get:function(){return this._player}},{key:"setPreloadBandwidth",value:function(e,t){this._stats.setPreloadBandwidth(e,t)}},{key:"getPreloadBandwidth",value:function(e){return this._stats.getPreloadBandwidth(e)}},{key:"getLoadInfoAndDelete",value:function(e){return this._stats.getLoadInfoAndDelete(e)}},{key:"getPreloadUnuseInfo",value:function(){return this._stats.getPreloadUnuseInfo()}},{key:"setUsePreloadInfo",value:function(e,t){this._stats.setUsePreloadInfo(e,t)}},{key:"bwEventEmit",value:function(e){var t=e.vid,r=e.loadType,n=e.size,i=e.speed,o=e.cacheKey,a=e.vtype,u=e.duration,s=e.bitrate;this._stats.bwEventEmit({vid:t,loadType:r,size:n,speed:i,cacheKey:o,vtype:a,duration:u,bitrate:s})}},{key:"stepwise",get:function(){return this._stepwise}},{key:"findPreloadItem",value:function(e){var t,r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(this._stepwise){var n=e.reduce(function(e,t){return void 0===t.data.stepIdx||"number"==typeof t.data.stepIdx&&"number"==typeof e.data.stepIdx&&t.data.stepIdx<e.data.stepIdx?t:e}),i=e.filter(;if(i.length>1&&this._sort(i),t=i[0],!r){if("number"!=typeof t.data.stepIdx&&(t.data.stepIdx=-1),t.data.stepIdx++,Array.isArray(t.data.steps)&&t.data.stepIdx>=t.data.steps.length-1){var o=e.indexOf(t);e.splice(o,1)}t.data.stepIdx===1/0&&(t=void 0)}}else t=r?e[0]:e.shift();return t}},{key:"realTimeSpeed",get:function(){return this._stats.realTimeSpeed}},{key:"updateConfig",value:function(e){Object.assign(this._config,e);var t=this._config.autoCheck;t&&!t.enable&&this.stopCheckTask(),t&&t.enable&&this.startCheckTask()}}],[{key:"getDefaultConfig",value:,{key:"generateUniqueCacheKey",value:function(e){var t=e.vid,r=e.codecType,n=e.vtype;return"".concat(t,"#").concat(r,"#").concat(n.toUpperCase())}},{key:"parseKey",value:function(e){if(!e)throw Error("key ".concat(e," is empty"));var t=e.split("#");if(t.length<5)throw Error("key ".concat(e," is not right format"));var r=t[0],n=t[1];return{vid:r,mediaType:n,codecType:t[2],vtype:t[3],definition:t[4]}}},{key:"debugger",set:]),l}(a())},65327:function(e,t,r){r.d(t,{K:function(){return o},_:function(){return i}});var n=r(13720);function i(){return{autoPreload:!1,autoCheck:{enable:!1,interval:1e3},preloadMaxCacheCount:5,preloadCacheType:n.R.MEMORY,autoCheckPreload:!0,startPreloadControl:!1,startPreloadMinBuffer:5,startPreloadMinPosTime:5,minBufferLength:5}}var o={PRELOAD_TIME:"PRELOAD_TIME"}},92556:function(e,t,r){function n(){n=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o,a,u=Object.create((t&&t.prototype instanceof d?t:d).prototype);return i(u,"_invoke",{value:(o=new C(n||[]),a="suspendedStart",function(t,n){if("executing"===a)throw Error("Generator is already running");if("completed"===a){if("throw"===t)throw n;return T()}for(o.method=t,o.arg=n;;){var i=o.delegate;if(i){var u=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=TypeError("The iterator does not provide a '"+n+"' method")),h;var o=f(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,h;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,h):a:(r.method="throw",r.arg=TypeError("iterator result is not an object"),r.delegate=null,h)}(i,o);if(u){if(u===h)continue;return u}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var s=f(e,r,o);if("normal"===s.type){if(a=o.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:o.done}}"throw"===s.type&&(a="completed",o.method="throw",o.arg=s.arg)}})}),u}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function d(){}function p(){}function v(){}var g={};c(g,a,function(){return this});var y=Object.getPrototypeOf,m=y&&y(y(x([])));m&&m!==t&&r.call(m,a)&&(g=m);var _=v.prototype=d.prototype=Object.create(g);function b(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var n;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(n,a){!function n(i,o,a,u){var s=f(e[i],e,o);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then(function(e){n("next",e,a,u)},function(e){n("throw",e,a,u)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return n("throw",e,a,u)})}u(s.arg)}(i,o,n,a)})}return n=n?n.then(a,a):a()}})}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function x(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=v,i(_,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:p,configurable:!0}),p.displayName=c(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},b(k.prototype),c(k.prototype,u,function(){return this}),e.AsyncIterator=k,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},b(_),c(_,s,"Generator"),c(_,a,function(){return this}),c(_,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=x,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),s=r.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function i(e,t,r,n,i,o,a){try{var u=e[o](a),s=u.value}catch(e){r(e);return}u.done?t(s):Promise.resolve(s).then(n,i)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function u(e){i(a,n,o,u,s,"next",e)}function s(e){i(a,n,o,u,s,"throw",e)}u(void 0)})}}function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,v(n.key),n)}}function s(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t,r){return(t=v(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return unction v(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}r.d(t,{IP:function(){return f},PA:function(){return a},U2:function(){return p},WY:function(){return d},XW:function(){return l},_x:function(){return c},l5:function(){return n},qH:function(){return s},x:function(){return o}})},81022:function(e,t,r){r.d(t,{Q:function(){return i}});var n=r(92556);r(57275),r(42416);var i=function(){function e(t,r,i,o){var a=this;(0,n.PA)(this,e),this.config=e.getDefaultConfig(),Object.keys(o).map(function(e){void 0!==o[e]&&null!==o[e]&&(a.config[e]=o[e])}),this.duration=i,this.player=t,this.updateBitrate(r)}return(0,n.qH)(e,[{key:"updateBitrate",value:function(e){this.bitrate=e,this.bitrate||(this.bitrate=this.config.minBandwidth)}},{key:"getAdaptLoadDuration",value:function(){var e=this.player,t=this.config;if(!t.rangeControl)return -1;var r=(null==e?void 0:e.bufferedPoint)||null,n=r&&r.end?r.end-e.currentTime:0;return Math.max(t.rangeMaxDuration-n,t.rangeMinDuration)}},{key:"getAdaptCacheBuffer",value:function(){var e=this.player,t=this.config,r=this.bitrate;if(!t.targetCacheControl)return -1;var n=t.estPlayTime,i=n;t.estPTcontrol&&(i=Math.min(n,this.duration-((null==e?void 0:e.currentTime)||0)));var o=(null==e?void 0:e.avgSpeed)*1024||0,a=Math.max(t.safeFactor*o,t.minBandwidth);e&&e.avgSpeed&&(a=t.safeFactor*o);var u=r>0?Math.floor((1-a/r)*i):0;return u=t.minDangerThreshold+Math.max(u,0),Math.min(Math.max(t.cacheSafeFactor*u,t.minTargetCacheDur),t.maxTargetCacheDur)}}],[{key:"getDefaultConfig",value:function(){return{rangeMaxDuration:15,rangeMinDuration:5,rangeMinSize:409600,safeFactor:.1,cacheSafeFactor:3,minDangerThreshold:5,estPlayTime:12,minBandwidth:1e6,estPTcontrol:!1,minTargetCacheDur:30,maxTargetCacheDur:60,targetCacheControl:!1,rangeControl:!1}}}]),e}()},91684:function(e,t,r){r.d(t,{F:function(){return i}});var n=r(92556);r(57275),r(42416);var i=function(){function e(t,r,i,o){var a=this;(0,n.PA)(this,e),this.config=e.getDefaultConfig(),Object.keys(o).map(function(e){void 0!==o[e]&&null!==o[e]&&(a.config[e]=o[e])}),this.duration=i,this.player=t,this.updateBitrate(r)}return(0,n.qH)(e,[{key:"updateBitrate",value:function(e){this.bitrate=e,this.bitrate||(this.bitrate=this.config.minBandwidth)}},{key:"getBuffer",value:function(){var e=this.player,t=(null==e?void 0:e.bufferedPoint)||null;return t&&t.end?t.end-e.currentTime:0}},{key:"getAdaptLoadDuration",value:function(){var e=this.config,t=this.duration;if(!e.rangeControl)return -1;var r=this.getBuffer();return Math.max(Math.min(t-r,e.rangeMaxDuration-r),e.rangeMinDuration)}},{key:"getAdaptRangeSize",value:function(e){var t=this.config,r=this.bitrate,n=this.duration;if(!t.rangeControl)return -1;e||(e=this.getAdaptLoadDuration());var i=this.getBuffer(),o=Math.max(t.rangeMinSize,e*r/8),a=(n-i)*r/8;return o+t.rangeFloatSize>=a&&(o=a),Math.ceil(o)}},{key:"getAdaptCacheBuffer",value:function(){var e=this.player,t=this.config,r=this.bitrate;if(!t.targetCacheControl)return -1;var n=t.estPlayTime,i=n;t.estPTcontrol&&(i=Math.min(n,this.duration-((null==e?void 0:e.currentTime)||0)));var o=(null==e?void 0:e.avgSpeed)*1024||0,a=Math.max(t.safeFactor*o,t.minBandwidth);e&&e.avgSpeed&&(a=t.safeFactor*o);var u=r>0?Math.floor((1-a/r)*i):0;return u=t.minDangerThreshold+Math.max(u,0),Math.min(Math.max(t.cacheSafeFactor*u,t.minTargetCacheDur),t.maxTargetCacheDur)}}],[{key:"getDefaultConfig",value:function(){return{rangeControl:!1,rangeMaxDuration:20,rangeMinDuration:5,rangeMinSize:409600,rangeFloatSize:10240,safeFactor:.1,cacheSafeFactor:3,minDangerThreshold:5,estPlayTime:12,minBandwidth:1e6,estPTcontrol:!1,minTargetCacheDur:30,maxTargetCacheDur:60,targetCacheControl:!1}}}]),e}()},11193:function(e,t,r){r.d(t,{J:function(){return i}});var n,i=((n=i||{}).CHANGE_FLYING_PLUGIN_CONFIG="CHANGE_FLYING_PLUGIN_CONFIG",n)},43753:function(e,t,r){r.d(t,{_R:function(){return o},kW:function(){return i},l0:function(){return n}});var n={MP4:"MP4",DASH:"DASH",HLS:"HLS"},i="real_time_speed",o={CDN:"cdn",PCDN:"pcdn"}},45960:function(e,t,r){r.d(t,{L:function(){return s},w:function(){return u}});var n,i=r(92556);r(71602),r(31807),r(23978),r(61151);var o=r(91937),a=null,u=function(e){(0,i.XW)(r,e);var t=(0,i.WY)(r);function r(){var e;return(0,i.PA)(this,r),e=t.apply(this,arguments),e._ploys=[],e}return(0,i.qH)(r,[{key:"_findIndexFromPloys",value:function(e){for(var t=-1,r=this._ploys,n=0;n<r.length;n++)if(r[n]===e){t=n;break}return t}},{key:"_checkStrategy",value:function(e){return!(!(null!=e&&e.start)||!e.stop||this._findIndexFromPloys(e)>-1)}},{key:"registerStrategy",value:function(e){var t=this;e&&(Array.isArray(e)||(e=[e]),e.filter(.forEach(function(e){var r=e.Strategy,n=e.config;try{var i=new r(n,t);t._checkStrategy(i)&&(i.start(),t._ploys.push(i))}catch(e){}}))}},{key:"unregisterStrategy",value:function(e){if(e){e.stop();var t=this._findIndexFromPloys(e);t>-1&&this._ploys.splice(t,1)}else this._ploys.forEach(,this._ploys.splice(0,this._ploys.length)}},{key:"setActive",value:function(e,t){var n=(0,i.U2)((0,i.IP)(r.prototype),"setActive",this).call(this,e,t);return this.emit("UPDATE_INST_ORDER"),n}},{key:"setNext",value:function(e){var t=(0,i.U2)((0,i.IP)(r.prototype),"setNext",this).call(this,e);return this.emit("UPDATE_INST_ORDER"),t}}],[{key:"getInstance",value:]),r}(o.L||Object.prototype.constructor),s=((n=s||{}).UPDATE_INST_ORDER="UPDATE_INST_ORDER",n)},92441:function(e,t,r){r.d(t,{l:function(){return u}});var n=r(92556),i=r(45960),o=(0,n.qH)(,a=r(11193),u=function(e){(0,n.XW)(r,e);var t=(0,n.WY)(r);eturn(0,n.qH)(r,[{key:"start",value:function(){var e=this,t=this.instManager;this.stop(),t.on(i.L.UPDATE_INST_ORDER,function(){var r=t.findAll(function(e){return e.isUserActive}),n=t.findAll(;1===r.length&&1===n.length&&(e._activePlayer=r[0],e._nextPlayer=n[0],e._execTask())})}},{key:"stop",value:,{key:"_clearTimer",value:,{key:"_startTimer",value:,{key:"_execTask",value:function(){if(this._activePlayer&&this._nextPlayer){var e=this.config,t=e.nextBufferMin,r=e.scale,n=e.nextStartPos,i=e.nextStartBuffer,o=this._nextPlayer.duration,u=this._activePlayer.currentTime,s=this._activePlayer.getBufferedRange(),c=t;u>n&&s[1]>i?(o<=60?c=t+10*r.S:o>60&&o<=180?c=t+10*r.M:o>180&&o<=600?c=t+10*r.L:o>600&&(c=t+10*r.XL),this._nextPlayer.emit(a.J.CHANGE_FLYING_PLUGIN_CONFIG,{nextBufferLength:c}),this._clearTimer(),this._activePlayer=null,this._nextPlayer=null):this._startTimer()}}}]),r}(o)},99535:function(e,t,r){r.d(t,{e:function(){return c}});var n=r(92556);r(59564),r(43274),r(71602),r(93567),r(66147),r(15992),r(88359),r(17),r(65189),r(96274),r(77135),r(36215),r(32822),r(73297),r(82825),r(74188),r(98424),r(19858),r(57275),r(42416),r(23978),r(75521),r(49118);var i=r(56763),o=r(45849),a=r(17904),u=function(){function e(t,r,i,o){var a=this;(0,n.PA)(this,e),this.config=e.getDefaultConfig(),Object.keys(o).map(function(e){void 0!==o[e]&&null!==o[e]&&(a.config[e]=o[e])}),this.duration=i,this.player=t,this.updateBitrate(r),this.curPCDNInBuffer=this.config.maxPCDNInBuffer,this.curPCDNOutBuffer=this.config.maxPCDNOutBuffer,this.PCDNChangeCnt=0}return(0,n.qH)(e,[{key:"updateBitrate",value:function(e){this.bitrate=e,this.bitrate||(this.bitrate=this.config.minBandwidth)}},{key:"getPCDNInBuffer",value:function(){var e=this.config,t=this.player,r=this.bitrate;if(!e.PCDNBufferControl)return null;var n=e.estPlayTime,i=n;e.estPTcontrol&&(i=Math.min(n,Math.max(0,this.duration-((null==t?void 0:t.currentTime)||0))));var o=e.safePCDNInFactor,a=e.minBandwidth,u=e.maxPCDNInBuffer,s=e.minPCDNInBuffer,c=o*Math.max((null==t?void 0:t.avgSpeedPCDN)*1024||0,a),l=r>0?(1-c/r)*i:0;return this.curPCDNInBuffer=Math.min(u,Math.max(s,l)),this.curPCDNInBuffer}},{key:"getPCDNOutBuffer",value:function(){var e=this.config,t=this.player,r=this.bitrate;if(!e.PCDNBufferControl)return null;var n=e.estPlayTime,i=n;e.estPTcontrol&&(i=Math.min(n,Math.max(0,this.duration-((null==t?void 0:t.currentTime)||0))));var o=e.safePCDNOutFactor,a=e.minBandwidth,u=e.maxPCDNOutBuffer,s=e.minPCDNOutBuffer,c=o*Math.max((null==t?void 0:t.avgSpeedPCDN)*1024||0,a),l=r>0?(1-c/r)*i:0;return this.curPCDNOutBuffer=Math.min(u,Math.max(s,l)),this.curPCDNOutBuffer}},{key:"getPCDNChangeCnt",value:function(){var e=this.config,t=e.PCDNCntControl,r=e.alpha,n=this.curPCDNInBuffer,i=this.player,o=(null==i?void 0:i.bufferedPoint)||null,a=o&&o.end?o.end-i.currentTime:0;return t?a>n+(this.PCDNChangeCnt-1)*r&&this.PCDNChangeCnt++:a>=n&&this.PCDNChangeCnt<2&&this.PCDNChangeCnt++,this.PCDNChangeCnt}}],[{key:"getDefaultConfig",value:function(){return{PCDNBufferControl:!1,PCDNCntControl:!1,estPTcontrol:!1,minPCDNInBuffer:8,maxPCDNInBuffer:12,minPCDNOutBuffer:3,maxPCDNOutBuffer:6,safePCDNInFactor:.1,safePCDNOutFactor:.4,alpha:.5,estPlayTime:12,minBandwidth:1e6}}}]),e}(),s=new Map,c=function(){var e,t;function r(e,t,o,a){var s,c,l=this;(0,n.PA)(this,r),this.options=r.getDefaultConfig(),Object.keys(e).map(,this.options.productConfig&&this.options.productConfig.app_id,this.loader=new i.mf(this.options),this.resetTrackeArgs(),this._lastFileInfo=null,this.lastfetchNodeTime=-1,this._lastRetFileKey=null,this._minUpdateNodeStep=this.options.ErrorTimeStep,null!==(s=this.options)&&void 0!==s&&null!==(c=s.adaptPCDNConfig)&&void 0!==c&&c.PCDNBufferControl&&(this.pcdnAdapt=new u(t,o,a,this.options.adaptPCDNConfig))}return(0,n.qH)(r,[{key:"isOpenAdaptPCDN",get:,{key:"curPCDNInBuffer",get:function(){return this.pcdnAdapt.curPCDNInBuffer}},{key:"getPCDNInBuffer",value:function(){var e;return null===(e=this.pcdnAdapt)||void 0===e?void 0:e.getPCDNInBuffer()}},{key:"curPCDNOutBuffer",get:function(){return this.pcdnAdapt.curPCDNOutBuffer}},{key:"getPCDNOutBuffer",value:function(){var e;return null===(e=this.pcdnAdapt)||void 0===e?void 0:e.getPCDNOutBuffer()}},{key:"curPCDNChangeCnt",get:function(){return this.pcdnAdapt.PCDNChangeCnt}},{key:"getPCDNChangeCnt",value:,{key:"resetTrackeArgs",value:,{key:"getPCDNNode",value:function(e,t,r){var n,i=f(t),a=s.get(l(e,i)),u=new o.Q;return!(null!=a&&a.nodes)||(null==a?void 0:null===(n=a.nodes)||void 0===n?void 0:n.length)<1?this.fetchPCDNNode(null,null,r).then(function(e){u.resolve(e)}).catch(:(a.fromCache=!0,u.resolve(a)),u}},{key:"removePCDNNode",value:function(e,t,r){var n=f(t),i=s.get(l(e,n)),o=null==i?void 0:i.nodes;o&&(r?i.nodes=o.filter(function(e){return e&&0>r.indexOf(e.url)}):o.shift(),s.set(l(e,n),i)),o&&o.length||this.fetchPCDNNode().then().catch(function(){})}},{key:"fetchPCDNNode",value:(e=(0,n.x)((0,n.l5)().mark(function e(t,a,u){var c,h,d,p,v,g,y,m,_,b,k,w,P,C,x,T;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=new o.Q,a){e.next=5;break}a=this._lastFileInfo,e.next=13;break;case 5:if(a.byterate=f(a.bitrate),!((null==(d=s.get(l(a.vid,a.byterate)))?void 0:null===(h=d.nodes)||void 0===h?void 0:h.length)>0)){e.next=11;break}return d.fromCache=!0,c.resolve(d),e.abrupt("return",c);case 11:delete a.bitrate,this._lastFileInfo=a;case 13:if(a){e.next=16;break}return c.resolve(null),e.abrupt("return",c);case 16:if(p=!1,v=l(a.vid,a.byterate),this._lastRetFileKey!==v&&(this.resetTrackeArgs(),p=!0),!(Date.now()-this.lastfetchNodeTime<this._minUpdateNodeStep&&!p)){e.next=22;break}return c.resolve(null),e.abrupt("return",c);case 22:if(this.lastfetchNodeTime=Date.now(),this._lastRetFileKey=v,a.sfid?a.version=1:a.vid&&(a.version=2),this.options.withReferer&&(a.with_referer=this.options.withReferer),g=JSON.stringify(Object.assign(this.options.productConfig,{file_info:a},this.trackeArgs,{req_id:u})),!(this.trackeArgs.req_times>=this.options.maxCnt)){e.next=31;break}return c.resolve(null),e.abrupt("return",c);case 31:return this.loader||(this.loader=new i.mf(this.options)),this.trackeArgs.req_times+=1,e.prev=33,r.pcdn_tracker_request_cnt++,e.next=37,this.loader.load(t||this.options.trackerUrl,{body:g});case 37:y=e.sent,m=null,y&&(this.trackeArgs.resp_times+=1,b=8*a.byterate,y.done&&null!==(_=y.data)&&void 0!==_&&_.Result?((m=(k=y.data.Result).nodes)&&m.length>0?r.pcdn_tracker_success_cnt++:this._minUpdateNodeStep=this.options.NULLNodeTimeStep,m.map(,w=k.fid,P=k.trace_id,C=k.req_id,x={nodes:m,fid:w,vid:a.vid,trace_id:P,req_id:C,bitrate:b},T=l(a.vid,a.byterate),s.set(T,x),this.trackeArgs.fid=k.fid,this.trackeArgs.trace_id=k.trace_id,this.trackeArgs.token=k.token,c.resolve(x)):(this._minUpdateNodeStep=this.options.ErrorTimeStep,c.reject(y))),e.next=47;break;case 42:e.prev=42,e.t0=e.catch(33),this._minUpdateNodeStep=this.options.ErrorTimeStep,c.reject(e.t0);case 47:return e.abrupt("return",c);case 48:case"end":return e.stop()}},e,this,[[33,42]])})),function(t,r,n){return e.apply(this,arguments)})}],[{key:"pluginName",get:function(){return"PCDN"}},{key:"pcdnReqCnt",get:,{key:"getDefaultConfig",value:,{key:"gainPCDNNode",value:(t=(0,n.x)((0,n.l5)().mark(function e(t,a,u,s){var c,l,h,d,p,v,g,y;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=r.getDefaultConfig(),Object.keys(a).map(,s&&s.app_id,l=new o.Q,u?(u.byterate=f(u.bitrate),delete u.bitrate):l.reject("video fileInfo need set"),h=JSON.stringify(Object.assign(s,{file_info:u},{node_num:(null==a?void 0:a.node_num)||3})),d=new i.mf(c),e.prev=8,r.pcdn_tracker_request_cnt++,e.next=12,d.load(t,{body:h});case 12:(y=e.sent).done&&(null===(p=y.data)||void 0===p?void 0:null===(v=p.Result)||void 0===v?void 0:null===(g=v.nodes)||void 0===g?void 0:g.length)>0&&r.pcdn_tracker_success_cnt++,l.resolve(y),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(8),l.reject((null===e.t0||void 0===e.t0?void 0:e.t0.message)||"get pcdnNode error");case 20:return e.abrupt("return",l);case 21:case"end":return e.stop()}},e,null,[[8,17]])})),}]),r}();,n._x)(c,"pcdn_tracker_request_cnt",0),(0,n._x)(c,"pcdn_tracker_success_cnt",0)}}]);