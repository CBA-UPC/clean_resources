function ImageViewer(e){if(!(this instanceof ImageViewer))return ImageViewer.instance||(ImageViewer.instance=new ImageViewer);this.inlineContainer=e,this.images={},this.elements={},this.closeTargets=SimpleSet("imageViewerImageContainer","imageViewerHtmlContainer","loadingContainer","imageOverlay","loadingImage","imageDetails","iClose"),this.imageViewerActive=!1,this.currentSet=null,this.currentImage=-1,this.currentImageLoaded=!1,this.w,this.h,this.thumbViewer=null,this.thumbViewerHeight=0,this.options={},this.defaultOptions={slideshow:!1,transitionspeed:5,thumbview:!0},this.showTimers={},this.slideShowTimer=null,this.resizeTimer=null,this.initialized=!1}function SimpleThumbViewer(e,t){this.imageViewer=e,this.elements={},this.thumbs=[],this.currentThumb=-1,this.maxThumbHeight=t||90,this.thumbFormats={i:90==t?"thumb":"thumbmedium",va:"middle",f:"thumb"},this.initialized=!1,loadThumbs(this)}function Thumb(e,t,i,s){this.thumbViewer=e,this.type=i,this.index=s,this.loaded=!1,this.error=!1,this.imageElement=null,loadImage(t,this.init.bind(this))}function loadThumbs(e){var t=[],i=function(){for(var s,r=0,h=0;s=t[r];)s.error?t.splice(r,1):(s.loaded&&h++,r++);if(h===t.length)return e.createThumbs(t),void(t=e=null);setTimeout(i,40)};!function(){for(var s,r,h=0;s=e.imageViewer.getImage(h);)r=s.thumbSrc||s.src,t.push(new Thumb(e,r,s.type,h)),h++;i()}()}window.LinkBehaviour&&LinkBehaviour.register(/(^|\s)imageviewer(\[([\w-]+)])?(\s|$)/,(function(e,t){var i=e.getAttribute("data-thumb-src"),s="imageviewer"!==e.rel&&t[2]?t[3]:"single";if(!i&&e.hasChildNodes()){var r=Selector(":scope > img",e)[0];r?i=r.getAttribute("data-src")||r.src:"NOSCRIPT"===e.firstChild.nodeName&&(i=e.firstChild.textContent.match(/\ssrc\s*=\s*(["']?)([^\s>]*)\1/i)[2])}(i||"single"===s)&&ImageViewer().addImage(s,{anchor:e,src:e.href,highResSrc:e.getAttribute("data-highres-src"),thumbnail:i,type:e.getAttribute("data-type")||(e.href.includes("/embed/")?"video":"image"),caption:e.title,exif:e.getAttribute("data-exif"),label:e.getAttribute("data-label")})})),Object.extend(ImageViewer.prototype,{init:function(){this.elements.imageOverlay=document.createElement("div"),this.elements.imageOverlay.id="imageOverlay";var e=HTMLBuilder.built({n:"div",a:{id:"imageViewer"},c:[{n:"div",a:{id:"imageDetails"}},{n:"div",a:{id:"imageViewerImageContainer"},c:{n:"div",c:[{n:"img",a:{id:"imageViewerImage"}},{n:"div",a:{id:"imageExifData"}}]}},{n:"div",a:{id:"imageViewerHtmlContainer"}},{n:"div",a:{id:"loadingContainer"},c:{n:"img",a:{id:"loadingImage",src:jsConfig.get("ImgURL")+"g/imageviewer/throbber_80.gif"}}},{n:"div",a:{id:"thumbPrevWrapper",onclick:this.prevImage.bind(this),unselectable:"on"},c:{n:"div",a:{id:"thumbPrev",title:"vorige"}}},{n:"div",a:{id:"thumbNextWrapper",onclick:this.nextImage.bind(this),unselectable:"on"},c:{n:"div",a:{id:"thumbNext",title:"volgende"}}},{n:"div",a:{id:"iClose",title:"Sluiten"},h:'<twk-icon name="fa-xmark" class="icon"></twk-icon>'}]});Object.extend(this.elements,HTMLBuilder.getIdList()),this.hideAll(),this.inlineContainer?(this.inlineContainer.innerHTML="",this.inlineContainer.appendChild(e)):(document.body.appendChild(this.elements.imageOverlay),document.body.appendChild(e),this.elements.imageOverlay.addEventListener("click",this.stop.bind(this)),this.elements.imageViewer.addEventListener("click",this.stop.bind(this)),document.addEventListener("keydown",this.keyHandler.bind(this)),pushStateHandler.addStateHandler("initial",this.stop.bind(this))),window.addEventListener("resize",this.setImageViewerSizeDelayed.bind(this)),this.initialized=!0},start:function(e,t,i,s){s&&s.preventDefault(),this.imageViewerActive||(this.initialized||this.init(),this.imageViewerActive=!0,this.currentSet=e,e in this.images||(this.images[e]=[]),this.toggleFlash("hidden"),this.show("loadingContainer"),this.options=i||{},Object.extend(this.options,this.defaultOptions),this.changeImage(t||0,!0),this.setImageViewerSize(),this.hasThumbs()?this.thumbViewer=new SimpleThumbViewer(this,this.inlineContainer?101:90):this.images[this.currentSet].length>1&&this.show("thumbPrevWrapper","thumbNextWrapper"))},inline:function(e){var t,i=getById(e),s=0;if(i){var r=Selector("noscript.lazycontent",i)[0];if(r)return void(r.firstChild.nodeValue=r.firstChild.nodeValue.replace(/>$/,' data-inline-imageviewer="'+e+'">'));i.style.height=i.clientHeight+"px";for(var h=new ImageViewer(i);t=this.images[e][s++];)t.articleSrc&&(t=Object.extend({src:t.articleSrc},t)),h.addImage(e,t);h.start(e)}},openInNewViewer:function(){ImageViewer().start(this.currentSet,this.currentImage)},hasThumbs:function(){return!(!this.inlineContainer&&window.Responsive&&Responsive.isMobileGrade())&&(this.options.thumbview&&"single"!==this.currentSet&&this.images[this.currentSet].length>1)},stop:function(e){if(this.imageViewerActive){var t=e&&e.target;(!t||t.id&&t.id in this.closeTargets)&&(this.imageViewerActive=!1,this.currentImage=-1,this.currentImageLoaded=!1,this.currentSet=null,this.slideShowTimer&&(clearTimeout(this.slideShowTimer),this.slideShowTimer=null),this.thumbViewer&&this.thumbViewer.destroy(),this.toggleFullScreen(!1),this.hideAll(),this.toggleFlash(""),this.inlineContainer||pushStateHandler.removeState("imageviewer")),e&&e.stopPropagation()}},show:function(){for(var e,t,i=arguments.length;i--;)e=arguments[i],(t=this.elements[e])&&(t.style.display="block")},showDelayed:function(e,t){this.showTimers[e]=setTimeout(this.show.bind(this,e),t||1e3)},hide:function(){for(var e,t,i=arguments.length;i--;)e=arguments[i],(t=this.elements[e])&&(t.style.display="none","imageViewerHtmlContainer"===e&&(t.innerHTML=""),e in this.showTimers&&(clearTimeout(this.showTimers[e]),delete this.showTimers[e]))},hideAll:function(){this.hide("thumbPrevWrapper","thumbNextWrapper","imageOverlay","imageViewer","imageViewerImageContainer","imageViewerHtmlContainer","imageDetails","imageExifData")},keyHandler:function(e){var t=jsConfig.get("keyCodes");if(this.imageViewerActive&&e&&!e.altKey){if(this.isFullScreen())switch(e.keyCode){case t.BACKSPACE:case t.ESC:this.toggleImageSize();break;case t.PAGEUP:this.elements.imageViewer.scrollTop-=this.elements.imageViewer.clientHeight;break;case t.PAGEDOWN:this.elements.imageViewer.scrollTop+=this.elements.imageViewer.clientHeight;break;case t.END:this.elements.imageViewer.scrollTop=this.elements.imageViewer.scrollHeight;break;case t.HOME:this.elements.imageViewer.scrollTop=0;break;case t.LEFT:this.elements.imageViewer.scrollLeft-=10;break;case t.UP:this.elements.imageViewer.scrollTop-=10;break;case t.RIGHT:this.elements.imageViewer.scrollLeft+=10;break;case t.DOWN:this.elements.imageViewer.scrollTop+=10;break;default:return}else switch(e.keyCode){case t.BACKSPACE:case t.ESC:this.stop();break;case t.LEFT:this.images[this.currentSet].length>1&&this.prevImage();break;case t.RIGHT:this.images[this.currentSet].length>1&&this.nextImage();break;case t.PAGEUP:case t.PAGEDOWN:case t.END:case t.HOME:case t.UP:case t.DOWN:break;default:return}e.preventDefault()}},toggleFlash:function(e){["object","embed"].forEach((function(t){Selector(t).forEach(()}))},setImageViewerSizeDelayed:setImageViewerSize:function(){if(this.imageViewerActive){this.show("imageOverlay","imageViewer"),this.w=this.elements.imageViewer.clientWidth-2,this.h=this.elements.imageViewer.clientHeight-2,this.hasThumbs()&&(this.h-=this.thumbViewerHeight),"absolute"!==computedStyle(this.elements.imageDetails,"position")&&(this.h-=this.elements.imageDetails.clientHeight);var e=this.getImage(this.currentImage);if(e)switch(e.type){case"text":case"html":break;case"video":this.setVideoSize();break;default:this.currentImageLoaded&&this.setImageSize(e)}this.thumbViewer&&this.thumbViewer.initialized&&(this.thumbViewer.createScrollBar(),this.thumbViewer.positionThumbs(!0))}},getImage:function(e){return e>-1&&this.images[this.currentSet][e]},changeImage:function(e,t){var i=this.getImage(e);if(i&&e!==this.currentImage){switch(this.slideShowTimer&&(clearTimeout(this.slideShowTimer),this.slideShowTimer=null),this.currentImageLoaded=!1,this.currentImage=e,this.showOtherInfo(e),this.showDelayed("loadingContainer"),i.type){case"text":case"html":this.showHtml(i.text);break;case"video":this.showVideo(i,t);break;default:loadImage(i.src,this.showImage.bind(this,i,"smallSize"))}this.inlineContainer||pushStateHandler.pushState("imageviewer",this.start.bind(this,this.currentSet,this.currentImage))}},showImage:function(e,t,i){this.imageViewerActive&&(i?(this.elements.imageViewerImage.src=i.src,this.elements.imageViewerImage.originalWidth=i.width,this.elements.imageViewerImage.originalHeight=i.height,this.currentImageLoaded=!0,this.setImageSize(e,t),this.hide("loadingContainer","imageViewerHtmlContainer"),this.show("imageViewerImageContainer")):this.showHtml('<p class="notFound">De afbeelding kon niet geladen worden.</p>'))},showHtml:function(e){this.elements.imageViewerHtmlContainer.innerHTML=e,this.hide("loadingContainer","imageViewerImageContainer"),this.show("imageViewerHtmlContainer")},showVideo:function(e,t){var i='<iframe style="border:0" frameborder=0 width=980 height=551 src="'+e.src+(t?"&autoPlay=1":"")+'" allowfullscreen></iframe>';this.showHtml(i),this.setVideoSize()},setVideoSize:function(){var e=this.calculateDisplaySize("fit",980,551),t=Selector("iframe",this.elements.imageViewerHtmlContainer)[0];t&&(t.width=e.width,t.height=e.height,t.style.marginLeft=e.marginLeft+"px",t.style.marginTop=e.marginTop+"px")},showOtherInfo:function(e){var t=this.getImage(e),i=t.caption||"";"single"!==this.currentSet&&this.images[this.currentSet].length>1&&(i+=" ("+(e+1)+" / "+this.images[this.currentSet].length+")"),i.length?(this.elements.imageDetails.innerHTML=i.escapeHtml(),this.show("imageDetails")):this.hide("imageDetails"),t.exif?(t.exifFormatted||(t.exifFormatted=this.formatExif(t.exif)),this.elements.imageExifData.innerHTML=t.exifFormatted,this.show("imageExifData")):this.hide("imageExifData"),this.options.slideshow&&(this.slideShowTimer=setTimeout(this.nextImage.bind(this),1e3*this.options.transitionspeed))},formatExif:function(e){var t,i=[];try{t="{"===e.charAt(0)&&JSON.parse(e)}catch(e){}if(!t)return e.escapeHtml();for(var s in t)i.push('<span title="'+s.escapeHtml()+'">'+t[s].escapeHtml()+"</span>");return i.join(" | ")},setImageSize:function(e,t){var i=this.elements.imageViewerImage,s=this.calculateDisplaySize(t=t||i.className,i.originalWidth,i.originalHeight);if(this.inlineContainer)return i.className="smallSize",void(i.onclick=this.openInNewViewer.bind(this));i.width=s.width,i.height=s.height,i.parentNode.style.width=s.width+"px",i.parentNode.style.marginLeft=s.marginLeft+"px",i.parentNode.parentNode.style.paddingTop=s.marginTop+"px","fullSize"===t||i.width!==i.originalWidth||i.height!==i.originalHeight||e.highResSrc?(i.className=t,i.onclick=this.toggleImageSize.bind(this)):(i.className="",i.onclick=null),t&&this.toggleFullScreen("fullSize"===t)},isFullScreen:toggleFullScreen:function(e){e?(this.bodyScrollTop=document.documentElement.scrollTop,document.documentElement.style.overflow="hidden",this.elements.imageViewer.classList.add("fullScreen")):this.isFullScreen()&&(this.elements.imageViewer.classList.remove("fullScreen"),document.documentElement.style.overflow="",document.documentElement.scrollTop=this.bodyScrollTop,this.elements.imageViewer.scrollTop=0)},calculateDisplaySize:function(e,t,i){var s,r,h;return"fullSize"===e?(s=getPageDimensions(),r=Math.max(0,(s.innerWidth-t)/2),h=Math.max(0,(s.innerHeight-i)/2)):(t>this.w&&(i=Math.floor(i*this.w/t),t=this.w),i>this.h&&(t=Math.floor(t*this.h/i),i=this.h),r=(2+this.w-t)/2,h=(2+this.h-i)/2),{width:t,height:i,marginLeft:Math.floor(r),marginTop:Math.floor(h)}},toggleImageSize:function(){var e=this.getImage(this.currentImage),t="smallSize"===this.elements.imageViewerImage.className?"fullSize":"smallSize";if("fullSize"===t?this.hide("thumbPrevWrapper","thumbNextWrapper"):this.images[this.currentSet].length>1&&this.show("thumbPrevWrapper","thumbNextWrapper"),e.highResSrc){this.showDelayed("loadingContainer");var i="fullSize"===t?e.highResSrc:e.src;loadImage(i,this.showImage.bind(this,e,t))}else this.setImageSize(e,t)},nextImage:function(){if(this.thumbViewer&&this.thumbViewer.initialized)this.thumbViewer.next();else{var e=this.currentImage+1;this.getImage(e)||(e=0),this.changeImage(e)}},prevImage:function(){if(this.thumbViewer&&this.thumbViewer.initialized)this.thumbViewer.prev();else{var e=this.currentImage-1;this.getImage(e)||(e=this.images[this.currentSet].length-1),this.changeImage(e)}},addImage:function(e,t,i){var s,r,h,l=0;(e=e||"single")in this.images||(this.images[e]=[]),Array.isArray(t)||(t=[t]);for(;s=t[l++];){for(r=0,h=this.images[e].length;r<h&&this.images[e][r].src!==s.src;r++);this.images[e][r]={src:s.src,highResSrc:s.highResSrc,articleSrc:s.articleSrc,thumbSrc:s.thumbnail||s.thumbSrc,caption:s.caption,label:i||s.label,type:s.type||"image",text:s.text,exif:s.exif,width:s.width||600,height:s.height||400},s.anchor&&s.anchor.addEventListener("click",this.start.bind(this,e,r,!1))}},thumbsReady:),Object.extend(SimpleThumbViewer.prototype,{destroy:function(){this.initialized=!1,this.elements&&this.elements.thumbContainer&&this.elements.thumbContainer.parentNode.removeChild(this.elements.thumbContainer),this.imageViewer&&(this.imageViewer.thumbViewerHeight=0,this.imageViewer.thumbViewer=null,this.imageViewer.thumbsReady()),this.imageViewer=null,this.scrollBar=null,this.thumbs=null,this.elements=null},createThumbs:function(e){if(!e.length||!this.imageViewer)return this.destroy();this.thumbs=e;var t=HTMLBuilder.built({n:"div",a:{id:"thumbContainer"},c:[{n:"div",a:{id:"thumbView"}}]});this.imageViewer.elements.imageViewer.appendChild(t),this.elements=HTMLBuilder.getIdList();for(var i,s,r,h,l,n,a=0;i=this.thumbs[a];)r=(s=this.imageViewer.getImage(i.index))&&s.label,(s.type!==l||r&&r!==h)&&(a&&((n=document.createElement("div")).className="spacer",this.elements.thumbView.appendChild(n)),l=s.type,r&&r!==h&&((n=document.createElement("div")).className="label",n.appendChild(document.createTextNode(r)),this.elements.thumbView.appendChild(n),h=r)),i.imageElement.onclick=this.select.bind(this,a),this.elements.thumbView.appendChild(i.imageElement),a++;h&&(this.elements.thumbView.className="hasLabels"),this.createScrollBar(),this.thumbs[this.imageViewer.currentImage]||(this.imageViewer.currentImage=0),this.select(this.imageViewer.currentImage),this.imageViewer.thumbViewerHeight=this.elements.thumbContainer.clientHeight,this.imageViewer.show("thumbPrevWrapper","thumbNextWrapper"),this.imageViewer.setImageViewerSize(),this.imageViewer.thumbsReady(),this.initialized=!0},createScrollBar:function(){var e={novertical:1};this.imageViewer.inlineContainer||(e.lightcolor=1),this.scrollBar=Scrollable.create(this.elements.thumbView,e)},positionThumbs:function(){var e=this.currentThumb>-1&&this.thumbs[this.currentThumb];e&&this.scrollBar&&this.scrollBar.scrollTo(e.imageElement.offsetLeft-(this.elements.thumbView.offsetWidth-e.imageElement.offsetWidth)/2)},select:function(e){this.thumbs[e]&&(this.currentThumb>-1&&this.thumbs[this.currentThumb].setSelected(!1),this.thumbs[e].setSelected(!0),this.currentThumb=e,this.positionThumbs(),this.imageViewer.changeImage(this.thumbs[e].index))},next:function(){var e=this.currentThumb+1;this.thumbs[e]||(e=0),this.select(e)},prev:function(){var e=this.currentThumb-1;this.thumbs[e]||(e=this.thumbs.length-1),this.select(e)}}),Object.extend(Thumb.prototype,{init:function(e){if(e){this.imageElement=document.createElement("div"),this.imageElement.className="ivthumb "+this.type;var t=document.createElement("img");t.src=e.src,e.height<=this.thumbViewer.maxThumbHeight?(t.height=e.height,t.width=e.width):(t.height=this.thumbViewer.maxThumbHeight,t.width=Math.round(e.width*t.height/e.height)),this.imageElement.appendChild(t),this.loaded=!0}else this.error=!0},setSelected:);var Scrollable=function(){var e={},t=0,i=function(t){return t&&t.__scrollableId&&t.__scrollableId in e?e[t.__scrollableId]:null},s=function(t){var i=t.__scrollableId;i&&i in e&&(e[i].destroy(),delete e[i]),t.classList.remove("scrollBar")};return{get:i,create:function(r,h){if(r){var l=i(r);if(l){if(l.update())return l;s(r)}else if(r.scrollWidth>r.clientWidth||r.scrollHeight>r.clientHeight)return r.classList.add("scrollBar"),e[r.__scrollableId=++t]=new Scrollbar(r,h)}return!1},destroy:s}}();function Scrollbar(e,t){this.element=e,this.scrollable=e.firstElementChild,this.options=t||{},this.scrollerVertical=null,this.scrollerHorizontal=null,this.scrollerActive=null,this.lineHeight=20,this.curX=0,this.curY=0,this.scrollX=0,this.scrollY=0,this.scrollerX=0,this.scrollerY=0,this.startTime=0,this.startX=0,this.startY=0,this.hasMoved=!1,this.animationFunc=null,this.animationTimer=null,this.moveX=0,this.moveY=0,this.events={},this.transform=Browser.is.webkit&&Browser.prefixed("transform"),this.transition=Browser.prefixed("transition"),this.transitionTimeOut=null,this.init()}Object.extend(Scrollbar.prototype,{init:function(){if(this.element.style.overflow="hidden","static"==computedStyle(this.element,"position")&&(this.element.style.position="relative"),this.width=this.element.clientWidth,this.height=this.element.clientHeight,this.lineHeight=this.options.lineHeight||parseInt(computedStyle(this.element,"line-height"))||20,!this.scrollable||!this.scrollable.classList.contains("scrollable")){for(this.scrollable=document.createElement("div"),this.scrollable.className="scrollable";this.element.hasChildNodes();)this.scrollable.appendChild(this.element.firstChild);var e=document.createElement("div");e.style.clear="both",this.scrollable.appendChild(e),this.element.appendChild(this.scrollable)}this.options.novertical||(this.scrollHeight=this.scrollable.scrollHeight+parseInt(computedStyle(this.element,"padding-top"))+parseInt(computedStyle(this.element,"padding-bottom")),this.scrollHeight>this.height&&(this.deltaY=this.height/this.scrollHeight,this.scrollY=this.element.scrollTop||this.scrollY,this.scrollerVertical=this.createScroller("vertical"),this.scrollerVertical.style.height=Math.round(this.height*this.deltaY)+"px",this.addEventForType("wheel",this.element,this.mouseWheel.bind(this)))),this.options.nohorizontal||(this.scrollWidth=this.scrollable.scrollWidth+parseInt(computedStyle(this.element,"padding-left"))+parseInt(computedStyle(this.element,"padding-right")),this.scrollWidth>this.width&&(this.deltaX=this.width/this.scrollWidth,this.scrollX=this.element.scrollLeft||this.scrollX,this.scrollerHorizontal=this.createScroller("horizontal"),this.scrollerHorizontal.style.width=Math.round(this.width*this.deltaX)+"px",this.scrollable.style.width=this.scrollable.scrollWidth+"px")),(this.scrollerVertical||this.scrollerHorizontal)&&(this.addEventForType("touchstart",this.element,this.touchStart.bind(this)),this.addEventForType("click",this.element,this.clickBuster.bind(this)),this.position())},addEventForType:function(e,t,i){this.events[e]=[t,i],t.addEventListener(e,i)},removeEventForType:function(e){if("all"==e)for(e in this.events)this.removeEventForType(e);else e in this.events&&(this.events[e][0].removeEventListener(e,this.events[e][1]),delete this.events[e])},createScroller:function(e){var t=document.createElement("span");return t.className="scroller "+e+(this.options.lightcolor?" light":""),t.innerHTML="<span></span>",this.addEventForType("mousedown",t,this.mouseDown.bind(this)),this.element.appendChild(t),t},mouseWheel:function(e){switch(e.preventDefault(),"wheel"==e.type||e.deltaMode){case 0:this.scrollY+=e.deltaY;break;case 2:this.scrollY+=e.deltaY*this.height;break;default:this.scrollY+=e.deltaY*this.lineHeight}this.transition&&this.useTransition(.5),this.position()},mouseDown:function(e){this.curX=e.clientX,this.curY=e.clientY,this.scrollerActive=e.currentTarget,this.addEventForType("mousemove",document,this.mouseMove.bind(this)),this.addEventForType("mouseup",document,this.mouseUp.bind(this)),document.onselectstart=e.preventDefault()},mouseMove:function(e){this.scrollerActive==this.scrollerHorizontal&&(this.scrollerX-=this.curX-(this.curX=e.clientX),this.scrollX=this.scrollerX/this.deltaX),this.scrollerActive==this.scrollerVertical&&(this.scrollerY-=this.curY-(this.curY=e.clientY),this.scrollY=this.scrollerY/this.deltaY),this.position()},mouseUp:function(){this.removeEventForType("mousemove"),this.removeEventForType("mouseup"),document.onselectstart=null,this.scrollerActive=null,this.snap()},touchStart:function(e){var t=getTouchCapableEventObject(e);this.startTime=this.getTime(t),this.curX=this.startX=t.clientX,this.curY=this.startY=t.clientY,this.resetClickBuster(),this.addEventForType("touchmove",document,this.touchMove.bind(this)),this.addEventForType("touchend",document,this.touchEnd.bind(this)),this.addEventForType("touchcancel",document,this.touchEnd.bind(this)),this.stopAnimation(),(this.animationFunc=this.animationFrame.bind(this))()},touchMove:function(e){var t=getTouchCapableEventObject(e),i=this.getTime(t),s=0,r=0;this.hasMoved||(s=Math.abs(this.startX-t.clientX),r=Math.abs(this.startY-t.clientY)),i-this.startTime>300&&(this.startTime=i,this.startX=t.clientX,this.startY=t.clientY),this.scrollerHorizontal&&(s>3&&s>=r&&(this.hasMoved=!0),this.scrollX+=this.curX-(this.curX=t.clientX)),this.scrollerVertical&&(r>3&&r>=s&&(this.hasMoved=!0),this.scrollY+=this.curY-(this.curY=t.clientY)),this.clickBuster(e)},touchEnd:function(e){var t=getTouchCapableEventObject(e);if(this.stopAnimation(),this.removeEventForType("touchmove"),this.removeEventForType("touchend"),this.removeEventForType("touchcancel"),this.hasMoved){this.hasMoved=setTimeout(this.resetClickBuster.bind(this),500);var i=this.getTime(t)-this.startTime;if(i<300)return void this.scrollBy(this.scrollerHorizontal?500*(this.startX-t.clientX)/i:0,this.scrollerVertical?500*(this.startY-t.clientY)/i:0);this.snap()}},clickBuster:function(e){this.hasMoved&&(this.scrollable.style.pointerEvents="none",e.preventDefault())},resetClickBuster:function(){this.hasMoved&&(clearTimeout(this.hasMoved),this.hasMoved=!1,this.scrollable.style.pointerEvents="")},position:function(){this.scrollerHorizontal&&(this.scrollX=this.validateX(this.scrollX),this.scrollerX=Math.round(this.scrollX*this.deltaX),this.transform?this.scrollerHorizontal.style[this.transform]="translateX("+this.scrollerX+"px)":(this.scrollable.style.left=-this.scrollX+"px",this.scrollerHorizontal.style.left=this.scrollerX+"px")),this.scrollerVertical&&(this.scrollY=this.validateY(this.scrollY),this.scrollerY=Math.round(this.scrollY*this.deltaY),this.transform?this.scrollerVertical.style[this.transform]="translateY("+this.scrollerY+"px)":(this.scrollable.style.top=-this.scrollY+"px",this.scrollerVertical.style.top=this.scrollerY+"px")),this.transform&&(this.scrollable.style[this.transform]="translate("+-this.scrollX+"px, "+-this.scrollY+"px)"),this.options.onScroll&&this.options.onScroll(this)},validateX:function(e){if(e<0)return 0;var t=this.getMaxX();return e>t?t:Math.round(e)},validateY:function(e){if(e<0)return 0;var t=this.getMaxY();return e>t?t:Math.round(e)},getMaxX:function(){return this.scrollWidth-this.width},getMaxY:useTransition:function(e){var t=(this.transform?Browser.prefixed.hyphenate(this.transform):"all")+" "+e+"s ease-out";this.scrollable.style[this.transition]=t,this.scrollerHorizontal&&(this.scrollerHorizontal.style[this.transition]=t),this.scrollerVertical&&(this.scrollerVertical.style[this.transition]=t),clearTimeout(this.transitionTimeOut),this.transitionTimeOut=setTimeout(this.stopAnimation.bind(this,!0),1e3*e)},easeOutQuad:animate:function(){this.animatePercentage+=1/60;var e=this.easeOutQuad(this.animatePercentage);this.moveX&&(this.scrollX=this.startX+e*this.moveX),this.moveY&&(this.scrollY=this.startY+e*this.moveY),this.animatePercentage<1?this.animationFrame():this.snap()},stopAnimation:function(e){cancelAnimationFrame(this.animationTimer),this.transition&&(clearTimeout(this.transitionTimeOut),this.scrollable.style[this.transition]="none",this.scrollerHorizontal&&(this.scrollerHorizontal.style[this.transition]="none"),this.scrollerVertical&&(this.scrollerVertical.style[this.transition]="none"),e&&this.snap())},animationFrame:snap:function(){this.scrollTo(this.options.snapX&&this.scrollerHorizontal?Math.round(this.scrollX/this.options.snapX)*this.options.snapX:null,this.options.snapY&&this.scrollerVertical?Math.round(this.scrollY/this.options.snapY)*this.options.snapY:null)},scrollTo:function(e,t){this.startX=this.scrollX,this.moveX=null!==e&&this.scrollerHorizontal?this.validateX(e)-this.startX:0,this.startY=this.scrollY,this.moveY=null!==t&&this.scrollerVertical?this.validateY(t)-this.startY:0,(this.moveX||this.moveY)&&(this.transition?(this.scrollX+=this.moveX,this.scrollY+=this.moveY,this.useTransition(1),this.position()):(this.animatePercentage=0,this.stopAnimation(),(this.animationFunc=this.animate.bind(this))()))},scrollBy:function(e,t){this.scrollTo(this.scrollX+e,this.scrollY+t)},getTime:function(e){var t=e.timeStamp||Date.now();return t instanceof Date?t.getTime():t},update:function(){return this.destroy(!0),this.init(),this.scrollerVertical||this.scrollerHorizontal},destroy:function(e){this.stopAnimation(),this.scrollerActive=null,this.removeEventForType("all"),this.scrollerHorizontal&&(this.scrollerHorizontal.parentNode&&this.scrollerHorizontal.parentNode.removeChild(this.scrollerHorizontal),this.scrollerHorizontal=null),this.scrollerVertical&&(this.scrollerVertical.parentNode&&this.scrollerVertical.parentNode.removeChild(this.scrollerVertical),this.scrollerVertical=null),e||(this.element.style.overflow="",this.scrollable.style.cssText="",this.element=this.scrollable=null)}});