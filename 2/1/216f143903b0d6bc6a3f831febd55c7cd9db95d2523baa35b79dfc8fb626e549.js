(function(){
var hola_ldr_require;(function(){if(!navigator||!navigator.userAgent||/ MSIE [1-8]\./.test(navigator.userAgent)){return}var E={};hola_ldr_require=E;E.zdot=function(name){var zdot;if((zdot=window.spark_loader&&window.spark_loader.zdot)&&name in zdot)return zdot[name];if(1)

return {
json: undefined,
customer: "mediahuis",
agents: [],
all_agents: {},
version: "1.165.39",
qs_ver: 'ver=1.165.39',
disabled: !!+false,
host: 'player.h-cdn.com',
zlxc: +'0',
videojs: '/svc/cdn/pub/video-js.swf?md5=18467-517c596c',
videojs_osmf: '/svc/cdn/pub/videojs-osmf.swf?md5=186245-ec749577',
videojs_flashls: '/svc/cdn/pub/videojs-flashls.swf?md5=74609-97e11010',
videojs5_osmf: '/svc/cdn/pub/videojs5-osmf.swf?md5=189643-2d3bd98a',
videojs5: '/svc/cdn/pub/videojs-5/video-js.swf?md5=92486-46aeeea9',
videojs5_10: '/svc/cdn/pub/videojs_swf_sv.swf?md5=92547-f789b0cf',
thumbnails: '/svc/cdn/pub/css/videojs.thumbnails.css?md5=874-39aa2ea2',
tpl: "/svc/cdn/pub/loader.js?minify=true&snapshot=&host=player.h-cdn.com&percent=undefined&no_conf=1",
languages: undefined,
stats_css: '/css/stats.css?md5=24994-40fa0bc7',
cdngraph_js: '/svc/cdn/pub/cdngraph.js?md5=70587-065dd6d8',
hls_js: '/svc/cdn/pub/hls.js?md5=523418-00e00a91',
flow_hls_engine: '/svc/cdn/pub/flowplayer_hls_engine.js?md5=46884-c1150199',
flow_dash_engine: '/svc/cdn/pub/flowplayer_dash_engine.js?md5=20155-6413735a',
vjs_hls_provider: '/svc/cdn/pub/vjs_hls_provider.js?md5=12415-3bb37e3a',
vstat: '/svc/cdn/pub/vstat.js?md5=29859-35440a7a',
watch_later_css: '/svc/cdn/pub/css/watch_later.css?md5=31387-a074625c',
video_panel_css: '/svc/cdn/pub/css/video_panel.css?md5=1298-0dd2ff97',
widget_css: '/svc/cdn/pub/css/widget.css?md5=14051-2ca47f0e',
player_shortcuts_css: '//player2.h-cdn.com/svc/cdn/pub/css/player_shortcuts.css?md5=2469-7f4f386d',
seek_zones_css: '//player2.h-cdn.com/svc/cdn/pub/css/seek_zones.css?md5=2289-e85f9bee',
spark_logo_svg: '/svc/cdn/pub/img/spark_logo.svg?md5=1778-aabfb132',
watch_later_add_svg: '/svc/cdn/pub/img/watch_later_add.svg?md5=574-1f2c2604',
watch_later_wait_gif: '/svc/cdn/pub/img/watch_later_wait.gif?md5=29931-34fa5045',
watch_later_done_svg: '/svc/cdn/pub/img/watch_later_done.svg?md5=704-007c5b96',
watch_later_add_black_svg: '/svc/cdn/pub/img/watch_later_add_black.svg?md5=619-7fcdfa92',
watch_later_add_blue_svg: '/svc/cdn/pub/img/watch_later_add_blue.svg?md5=624-5cf7f91d',
watch_later_done_round_svg: '/svc/cdn/pub/img/watch_later_done_round.svg?md5=336-2ea5ca92',
watch_later_heart_add_svg: '/svc/cdn/pub/img/watch_later_heart_add.svg?md5=1355-1c5b9bb3',
watch_later_heart_add_hover_svg: '/svc/cdn/pub/img/watch_later_heart_add_hover.svg?md5=1348-c48aaf93',
watch_later_heart_wait_gif: '/svc/cdn/pub/img/watch_later_heart_wait.gif?md5=6772-844b3b57',
watch_later_heart_done_svg: '/svc/cdn/pub/img/watch_later_heart_done.svg?md5=953-5ea95b82',
playlist_css: '/svc/cdn/pub/css/playlist.css?md5=25204-04f9a1eb',
video_search_css: '/svc/cdn/pub/css/video_search.css?md5=15795-6a54f434',
share_css: '/svc/cdn/pub/css/share.css?md5=10538-b1000841',
share_dark_css: '/svc/cdn/pub/css/share_dark.css?md5=13704-6452ca88',
autoclick_css: '/svc/cdn/pub/css/autoclick.css?md5=887-4c3638ee',
casting_css: '/svc/cdn/pub/css/casting.css?md5=2632-4e80e829',
previews_widget_css: '//player.h-cdn.com/svc/cdn/pub/css/previews_widget.css?md5=7309-eaf2dcf3',
previews_widget_html: '//player.h-cdn.com/svc/cdn/pub/inc/previews_widget.html?md5=1811-08d2e5c2',
font_roboto_css: '//player2.h-cdn.com/svc/cdn/pub/css/font_roboto.css?md5=2351-c405d498',
}[name];
return{}[name]};var console=window.console;e9_console();te_errors,hola_errors,js_errors,ldr_errors,is_loader;var customer=E.zdot("customer"),tpl=E.zdot("tpl");is_loader=/^\/svc\/cdn\/pub\/loader.js/.test(tpl);if(is_loader){window.addEventListener("error",}fix_obj_props(Array.prototype,"reduce",array_reduce);if(window.Prototype){delete Object.prototype.toJSON;delete Array.prototype.toJSON;delete String.prototype.toJSON;delete Number.prototype.toJSON;for(var p in[])Object.defineProperty(Array.prototype,p,{enumerable:false})}E.module_registry={};E.aliases={};E.config=define=E.specified=function(name){return!!E.module_registry[name]};E.require=if(is_loader)window.hola_cdn_require=E.require})();efine.amd=true;var waiting_conf=hola_ldr_require&&!hola_ldr_require.zdot("json")&&[];if(waiting_conf){window.addEventListener("spark_config_loaded",false)}equire.config=function(){return require};require.specified=function(name){return hola_ldr_require.specified(name)};require.zdot=function(name){return hola_ldr_require.zdot(name)};define("/svc/cdn/pub/ldr_require.js",function(){});
define("/svc/cdn/pub/typedarray_shim.js",{__stub:1});
(();
if(typeof hola_ldr_require!="undefined")hola_ldr_require.config({map:{events:"/util/events.js"}});define("/svc/cdn/pub/config.js",[],function(){return{}});require(["/util/es6_shim.js","/svc/cdn/pub/typedarray_shim.js"],function(){});
define("mp4box",{__stub:1});




define("muxjs",{__stub:1});



(();
(();
(();
(();
(();
(})();})();
define("/svc/cdn/pub/map.js",["/svc/cdn/pub/util.js","/svc/cdn/pub/log.js"});
define("/svc/cdn/pub/storage.js",["/svc/cdn/pub/util.js","/util/events.js"});})();})();
define("/svc/cdn/pub/cache.js",{__stub:1});})();})();}(this);})();
define("json_stable_stringify",[});
define("/svc/cdn/pub/zone_match.js",{__stub:1});})();})();
define("/svc/cdn/pub/load_perf.js",["/svc/cdn/pub/util.js"});
define("/svc/cdn/pub/adaptive.js",{__stub:1});
define("/svc/cdn/pub/progressive.js",{__stub:1});
define("/svc/cdn/pub/unittest.js",{__stub:1});
define("/svc/cdn/pub/req.js",{__stub:1});
define("/svc/cdn/pub/stream.js",{__stub:1});
define("/svc/cdn/pub/aggregator.js",{__stub:1});
define("/svc/cdn/pub/hap_util.js",{__stub:1});
define("/svc/cdn/pub/hola_adaptive.js",{__stub:1});


define("/svc/cdn/pub/mp4.js",{__stub:1});
define("/svc/cdn/pub/webm.js",{__stub:1});
define("/svc/cdn/pub/cdn.js",{__stub:1});

define("/svc/cdn/pub/timeline.js",{__stub:1});}(thi});
define("/svc/cdn/pub/dom_util.js",["cash"});
define("/svc/cdn/pub/stats.js",{__stub:1});

define("/svc/cdn/pub/analysis.js",{__stub:1});
define("/svc/cdn/pub/shaka.js",{__stub:1});
define("/svc/cdn/pub/dash.js",{__stub:1});
define("/svc/cdn/pub/hls.js",{__stub:1});








define("/svc/cdn/pub/dailymotion.js",{__stub:1});
define("/svc/cdn/pub/player_util.js",["cash","/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/log.js"});
define("/svc/cdn/pub/html5.js",["cash","/svc/cdn/pub/util.js","/util/util.js","/svc/cdn/pub/shaka.js","/svc/cdn/pub/dash.js","/svc/cdn/pub/dailymotion.js","/svc/cdn/pub/player_util.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/perr.js"});
define("/svc/cdn/pub/mode.js",["/svc/cdn/pub/log.js","/svc/cdn/pub/util.js","/svc/cdn/pub/cdn_util.js","/svc/cdn/pub/storage.js"});
define("/svc/cdn/pub/cdn_svc.js",{__stub:1});

define("/svc/cdn/pub/zjwplayer3.js",{__stub:1});

define("/svc/cdn/pub/ad_handlers.js",{__stub:1});
define("/svc/cdn/pub/vjs.js",{__stub:1});

define("/svc/cdn/pub/android.js",{__stub:1});
define("/svc/cdn/pub/youtube.js",{__stub:1});
define("filesaver",{__stub:1});
define("/svc/cdn/pub/flowplayer.js",{__stub:1});
define("/svc/cdn/pub/ios.js",["/svc/cdn/pub/util.js","/util/util.js","/svc/cdn/pub/player_util.js","/svc/cdn/pub/perr.js"});
define("/svc/cdn/pub/hola_vjs.js",{__stub:1});
define("/svc/cdn/pub/buffer_monitor.js",["/svc/cdn/pub/util.js","/svc/cdn/pub/perr.js"});
define("/svc/cdn/pub/airplay.js",["/svc/cdn/pub/util.js","/svc/cdn/pub/perr.js"});
define("/svc/cdn/pub/ooyala.js",{__stub:1});
define("/svc/cdn/pub/akamai.js",{__stub:1});
define("/svc/cdn/pub/custom_player.js",["cash","/svc/cdn/pub/util.js","/util/util.js","/svc/cdn/pub/html5.js","/svc/cdn/pub/player_util.js"});
define("/svc/cdn/pub/wrapper.js",["/util/es6_shim.js","/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/zjwplayer3.js","/svc/cdn/pub/vjs.js","/svc/cdn/pub/html5.js","/svc/cdn/pub/android.js","/svc/cdn/pub/youtube.js","/util/events.js","filesaver","/svc/cdn/pub/flowplayer.js","/svc/cdn/pub/load_perf.js","/svc/cdn/pub/ios.js","/svc/cdn/pub/hola_vjs.js","/svc/cdn/pub/buffer_monitor.js","/svc/cdn/pub/airplay.js","/svc/cdn/pub/ooyala.js","/svc/cdn/pub/akamai.js","/svc/cdn/pub/custom_player.js","/svc/cdn/pub/perr.js"});
define("/svc/cdn/pub/videojs.js",["cash","/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/vjs.js","/svc/cdn/pub/hola_vjs.js"});
define("/svc/cdn/pub/clappr.js",["cash","/util/util.js","/svc/cdn/pub/util.js"});
define("/svc/cdn/pub/theoplayer.js",["cash","/svc/cdn/pub/util.js"});
define("/svc/cdn/pub/powa.js",["cash","/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/dom_util.js"});
define("/svc/cdn/pub/bluebillywig.js",["/util/util.js"});
define("/svc/cdn/pub/kaltura.js",["cash","/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/player_util.js"});
define("/svc/cdn/pub/delightvr.js",["cash","/svc/cdn/pub/util.js"});
define("/svc/cdn/pub/panolens.js",["/svc/cdn/pub/util.js"});
define("/svc/cdn/pub/autodetect.js",["cash","/svc/cdn/pub/log.js","/svc/cdn/pub/util.js","/util/util.js","/util/events.js","/svc/cdn/pub/zjwplayer3.js","/svc/cdn/pub/flowplayer.js","/svc/cdn/pub/youtube.js","/svc/cdn/pub/android.js","/svc/cdn/pub/dash.js","/svc/cdn/pub/dailymotion.js","/svc/cdn/pub/html5.js","/svc/cdn/pub/ios.js","/svc/cdn/pub/videojs.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/ooyala.js","/svc/cdn/pub/akamai.js","/svc/cdn/pub/clappr.js","/svc/cdn/pub/custom_player.js","/svc/cdn/pub/theoplayer.js","/svc/cdn/pub/powa.js","/svc/cdn/pub/bluebillywig.js","/svc/cdn/pub/shaka.js","/svc/cdn/pub/kaltura.js","/svc/cdn/pub/delightvr.js","/svc/cdn/pub/panolens.js","/svc/cdn/pub/perr.js"});})();
define("/svc/cdn/pub/msg.js",["/svc/cdn/pub/util.js","/util/events.js"});
define("/svc/cdn/pub/api.js",["/svc/cdn/pub/util.js","/util/escape.js","/svc/cdn/pub/ajax.js","/svc/cdn/pub/cdnlist.js","/svc/cdn/pub/perr.js","/svc/cdn/pub/zone.js","/util/util.js"});
define("/svc/cdn/pub/links.js",["cash","/svc/cdn/pub/util.js","/svc/cdn/pub/spark_features.js","/util/url.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/msg.js","/svc/cdn/pub/api.js"});
define("/svc/cdn/pub/spark_layout.js",{__stub:1});
define("/svc/cdn/pub/l10n.js",["/util/util.js","/svc/cdn/pub/log.js"});
define("/svc/cdn/pub/ga.js",["/svc/cdn/pub/util.js"});
define("/svc/cdn/pub/spark_stats.js",["/util/util.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/perr.js","/svc/cdn/pub/storage.js"});
define("/svc/cdn/pub/spark_player.js",["cash","/util/util.js","/svc/cdn/pub/util.js","/util/events.js","/svc/cdn/pub/map.js","/svc/cdn/pub/api.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/msg.js","/svc/cdn/pub/perr.js","/util/url.js"});
define("/svc/cdn/pub/editor.js",{__stub:1});
define("/svc/cdn/pub/feature/persistent/index.js",["cash","/svc/cdn/pub/util.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/msg.js","/svc/cdn/pub/storage.js"});
define("/svc/cdn/pub/feature/thumbnails/timeline.js",["cash","/svc/cdn/pub/util.js","/svc/cdn/pub/dom_util.js"});
define("/svc/cdn/pub/feature/thumbnails/index.js",["cash","/svc/cdn/pub/util.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/html5.js","/svc/cdn/pub/feature/thumbnails/timeline.js"});
define("/svc/cdn/pub/play_icon.js",["cash","/svc/cdn/pub/util.js","/svc/cdn/pub/dom_util.js"});
define("/svc/cdn/pub/feature/preview/debug.js",["cash","/svc/cdn/pub/util.js","/svc/cdn/pub/play_icon.js","/svc/cdn/pub/dom_util.js"rn E});
define("/svc/cdn/pub/feature/preview/editor.js",{__stub:1});
define("/svc/cdn/pub/feature/preview/controls.js",{__stub:1});
define("/svc/cdn/pub/promo_db.js",["/util/util.js","/util/events.js","/svc/cdn/pub/util.js"],function(zutil,events,util){var E=PromoData;var MAX_REDIRECTS=7;var assign=Object.assign;var arr_props=["Creatives","Extensions","MediaFiles","TrackingEvents","VideoClicks"];function get_xml(url,cb){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.onreadystatechange=function(){if(xhr.readyState!=xhr.DONE)return;if(xhr.status!=200)return cb();cb(xhr.responseXML)};xhr.send()}function xml2json(xml,_arr_props){_arr_props=_arr_props||[];var json={},i;var children=xml.children;if(!xml)return;if(xml.nodeType!=1)return xml2json(children[0],_arr_props);var name=xml.nodeName;if(xml.children&&xml.children.length){if(_arr_props.includes(name)){json[name]=[];for(i=0;i<xml.children.length;i++)json[name].push(xml2json(xml.children[i],_arr_props))}else{json[name]={};for(i=0;i<xml.children.length;i++)assign(json[name],xml2json(xml.children[i],_arr_props))}}else{json[name]=xml.innerHTML.replace(/[\s\S]*CDATA\[([^\]]+)\][\s\S]*/,"$1")}if(xml.attributes&&xml.attributes.length){json.attr={};for(i=0;i<xml.attributes.length;i++){var attr=xml.attributes[i].name;json.attr[attr]=xml.getAttribute(attr)}}return json}var TRACKING_EVENTS={start:"AD_START",firstQuartile:"AD_FIRST_QUARTILE",midpoint:"AD_MIDPOINT",thirdQuartile:"AD_THIRD_QUARTILE",complete:"AD_COMPLETE",creativeView:"AD_CREATIVE_VIEW"};zutil.inherits(PromoData,events.EventEmitter);function PromoData(opt){this._playlist=opt.playlist;this._playlist_url=opt.playlist_url;this._playlist_ttl=opt.playlist_ttl_sec||60;this._disable_reload=opt.disable_playlist_reload;this._playlist_ts=0;this._vast_url=opt.vast_url;this._source=null;this._source_playlist=null;this._state="IDLE";if(this._vast_url)this._source_type="vast";else if(this._playlist_url)this._source_type="remote_playlist";else if(this._playlist)this._source_type="built_in_playlist";this._load()}PromoData.prototype.get_playlist=function(){var playlist;if(this._source){this._source_playlist=this._source.get_playlist();this._load();return this._source_playlist}if(this._playlist&&this._playlist.length){var playlist_num=Math.random()*this._playlist.length|0;playlist=this._playlist[playlist_num].slice();if(Date.now()-this._playlist_ts>this._playlist_ttl*1e3)this._load();return playlist}};PromoData.prototype.onready=function(cb){if(this._state!="IDLE")return void cb();this.on("ready",cb)};PromoData.prototype._ready=function(){if(this._state!="IDLE")return;this._state="READY";this.emit("ready")};PromoData.prototype._load=function(){if(this._disable_reload&&this._source_playlist&&this._source_playlist.length){return}var _this=this;if(this._source_type=="vast"){this._source=null;get_xml(this._vast_url,function(xml){_this._xml=xml;_this._json=xml2json(xml,arr_props);if(_this._json.Playlist)_this._source=new Playlist({json:_this._json.Playlist});else _this._source=new Vast({xml:_this.xml,json:_this._json});if(_this._source._state=="READY")return void _this._ready();_this._source.on("ready",_this._ready.bind(_this))});return}if(this._source_type=="remote_playlist"){this._playlist=null;util.get_json(this._playlist_url,function(data){_this._ready();if(!data)return;_this._playlist=data.playlist;_this._playlist_ts=Date.now()});return}};zutil.inherits(Playlist,events.EventEmitter);function Playlist(opt){this._url=opt.url;this._json=opt.json;this._items=[];var _this=this;if(this._json){this._items=Object.keys(this._json).map(function(type){return new Vast({url:_this._json[type].Ad,type:type.toLowerCase()})});if(this._items.length)this._items[0].on("ready",_this.emit.bind(_this,"ready"));else this.emit("ready")}else this.emit("ready")}Playlist.prototype.get_playlist=function(){if(!this._items.length)return;var playlist=[];this._items.forEach(function(vast){var vast_playlist=vast.get_playlist();if(vast_playlist&&vast_playlist.length)playlist=playlist.concat(vast_playlist)});return playlist};zutil.inherits(Vast,events.EventEmitter);function Vast(opt){this._url=opt.url;this._type=opt.type;this._json=opt.json;this._last_update=0;this._creatives=[];this._xml=opt.xml;this._json=opt.json;this._ad_wrapper_url=null;this._ad_wrapper=null;this._redirect_num=opt.redirect_num||0;this._state="IDLE";var _this=this;this._load(function(){_this._ad_wrapper_url=zutil.get(_this._json,"VAST.Ad.Wrapper.VASTAdTagURI",null);if(_this._ad_wrapper_url&&_this._redirect_num<MAX_REDIRECTS){_this._ad_wrapper=new Vast({url:_this._ad_wrapper_url,redirect_num:_this._redirect_num+1});_this._ad_wrapper.one("ready",_this.set_ready_state.bind(_this))}else _this.set_ready_state()})}Vast.prototype.set_ready_dy")};Vast.prototype.get_playlist=function(){if(this._ad_wrapper)return this._ad_wrapper._get_playlist();if(this._ad_wrapper_url||!this._json)return;var inline;if(!(inline=zutil.get(this._json,"VAST.Ad.InLine",null)))return;var linear;try{linear=inline.Creatives[0].Creative.Linear}catch(e){}if(!linear)return;var media_files=linear.MediaFiles;var duration=linear.Duration;if(!media_files||!media_files.length||!duration)return;media_files=media_files.fmp4"})idth});if(!media_files.length)return;var offset=this._type=="postroll"?Infinity:0;var trackers={};trackers.AD_IMPRESSION=inline.Impression;trackers.AD_ERROR=inline.Error;if(linear.TrackingEvents){linear.TrackingEvents.forEach(function(ev){var ev_name=ev.attr.event;if(ev_name in TRACKING_EVENTS)trackers[TRACKING_EVENTS[ev_name]]=ev.Tracking})}var click_url;try{click_url=linear.VideoClicks[0].ClickThrough}catch(e){}return[{offset:offset,duration:parseInt(duration.split(":")[2],10),type:"linear",url:media_files[0].MediaFile,click_url:click_url,trackers:trackers}]};Vast.prototype.check_ttl=function(){if(!this._url)return;if(Date.now()-this._last_update>this.ttl_sec*1e3)this.load()};Vast.prototype._load=function(cb){if(this._json||!this._url)return void cb();this._last_update=Date.now();var _this=this;get_xml(this._url,function(xml){if(!xml)return void(this.ttl_sec=this._err_ttl_sec);_this._xml=xml;_this._json=xml2json(xml,arr_props);cb()})};return E});
define("/svc/cdn/pub/promo_ui.js",["/util/util.js","/util/events.js","/svc/cdn/pub/dom_util.js"],function(zutil,events,dom_util){var E=PromoUI;E.states={IDLE:"IDLE",ERROR:"ERROR",STARTED:"STARTED",ENDED:"ENDED"};E.events={STATE_CHANGE:"STATE_CHANGE"};var css=[".spark_preview_promo_nonlinear, .spark_preview_promo_video {","  top: 0;","  left: 0;","  position: absolute!important;","  visibility: hidden;","  object-fit: cover;","  opacity: 1;","  transition: opacity 0.3s ease-in-out;","  margin: 0!important;","  display: block!important;","}",".spark_preview_promo_video.hola_fade_out {","  opacity: 0;","}"].join("\n");function get_css(opt){var _css=css;if(opt&&opt.keyframes_show){_css+="\n@keyframes preview_promo_show {\n  "+opt.keyframes_show.join("\n  ")+"\n}"}if(opt&&opt.keyframes_hide){_css+="\n@keyframes preview_promo_hide {\n  "+opt.keyframes_hide.join("\n  ")+"\n}"}return _css}function track_event(event,url){var img=new Image;img.src=url}function PromoUI(container,ad_opt,opt){this._container=container;if(!container.shadowRoot)container.attachShadow({mode:"open"});this._ad_opt=ad_opt;this._opt=opt;this._ad=null;this._render()}PromoUI.prototype.denull};PromoUI.prototype._render=function(){this._container.shadowRoot.innerHTML="<style>"+get_css(this._opt)+"</style>";if(this._ad_opt.type=="non_linear")this._ad=new NonLinear(this._container,this._ad_opt,this._opt);else this._ad=new Linear(this._container,this._ad_opt,this._opt);this._ad.show()};PromoUI.prototype.on=function(event,cb){this._ad.on(event,cb)};zutil.inherits(Linear,events.EventEmitter);function Linear(container,ad_opt,opt){this._width=dom_util.width(container);this._height=dom_util.height(container);this._container=container.shadowRoot;this._ad_opt=ad_opt;this._opt=opt;this._promo=null;this.state=E.states.IDLE;this._render()}Linear.prototype.destroy=function(){var _this=this;this.hide(function(){_this._rm_listeners();dom_util.remove(_this._promo);dom_util.remove(_this._link)})};Linear.prototype.hide=function(cb){cb=cb||function(){};var opt=this._opt;var hide_delay;if(opt.keyframes_hide){hide_delay=opt.keyframes_hide_dur_sec||1;this._promo.style.animation="preview_promo_hide "+hide_delay+"s";this._promo.style.animationFillMode="forwards"}else this._promo.style.visibility="hidden";this._promo.pause();if(hide_delay)setTimeout(cb,hide_delay*1e3);else cb()};Linear.prototype.show=function(){var opt=this._opt;if(opt.keyframes_show){var dur=opt.keyframes_show_dur_sec||1;this._promo.style.animation="preview_promo_show "+dur+"s";this._promo.style.animationFillMode="forwards"}this._promo.style.visibility="visible";this._promo.play()};Linear.prototype._add_listeners=function(){this._add_trackers();this.__on_ended=this._on_ended.bind(this);this.__on_error=this._on_error.bind(this);this.__on_meta=this._on_meta.bind(this);this._promo.addEventListener("ended",this.__on_ended);this.source.addEventListener("error",this.__on_error);this._promo.addEventListener("loadedmetadata",this.__on_meta)};Linear.prototype._add_trackers=function(){var fn,promo=this._promo;var trackers=this._ad_opt.trackers;if(!trackers)return;this._rm_tracker_fns=[];if(trackers.AD_START){fn=function(){track_event("AD_START",trackers.AD_START)};promo.addEventListener("play",fn);this._rm_tracker_fns.push(promo.removeEventListener.bind(promo,"play",fn))}if(trackers.AD_IMPRESSION){fn=function(){track_event("AD_IMPRESSION",trackers.AD_IMPRESSION)};promo.addEventListener("play",fn);this._rm_tracker_fns.push(promo.removeEventListener.bind(promo,"play",fn))}var progress_25=trackers.AD_FIRST_QUARTILE;var progress_50=trackers.AD_MIDPOINT;var progress_75=trackers.AD_THIRD_QUARTILE;if(progress_25||progress_50||progress_75){fn=function(){var progress=Math.ceil(promo.currentTime/promo.duration*100);if(progress_25&&progress>=25){track_event("AD_FIRST_QUARTILE",progress_25);progress_25=undefined}if(progress_50&&progress>=50){track_event("AD_MIDPOINT",progress_50);progress_50=undefined}if(progress_75&&progress>=75){track_event("AD_THIRD_QUARTILE",progress_75);progress_75=undefined}};promo.addEventListener("timeupdate",fn);this._rm_tracker_fns.push(promo.removeEventListener.bind(promo,"timeupdate",fn))}if(trackers.AD_COMPLETE){fn=function(){track_event("AD_COMPLETE",trackers.AD_COMPLETE)};promo.addEventListener("ended",fn);this._rm_tracker_fns.push(promo.removeEventListener.bind(promo,"ended",fn))}if(trackers.AD_ERROROR)};this.source.addEventListener("error",fn);this._rm_tracker_fns.push(this.source.removeEventListener.bind(this.source,"error",fn))}};Linear.prototype._rm_trackers=function(){if(!this._rm_tracker_fns)return;this._rm_tracker_fns.forEach(function(rm_track_fn){rm_track_fn()});this._rm_tracker_fns=[]};Linear.prototype._on_DED)};Linear.prototype._on_video_play=function(){if(this.state!=E.states.IDLE||this._ad_opt.offset!=0)return;this._update_state(E.states.STARTED);this.show()};Linear.prototype._on_video_ended=function(){if(this.state!=E.states.IDLE||this._ad_opt.offset!=Infinity)return;this._update_state(E.states.STARTED);this.show()};Linear.prototype._on_error=function(){this._rm_listeners();this.hide();this._update_state(E.states.ERROR)};Linear.prototype._on_meta=function(){var dur=this._promo.duration;if(dur<=this._ad_opt.duration)return;this.speed=+(dur/this._ad_opt.duration).toFixed(2);this._update_speed()};Linear.prototype._on_timeupdate=function(){if(this.state!=E.states.IDLE)this._update_state(E.states.STARTED);this.show()};Linear.prototype._render=function(){var ad_opt=this._ad_opt;var promo=this._promo=document.createElement("video");var container=this._container;var _this=this;promo.muted=true;promo.setAttribute("muted",1);promo.setAttribute("playsinline",1);promo.style.width=this._width+"px";promo.style.height=this._height+"px";promo.className="spark_preview_promo_video";if(ad_opt.click_url){if(this._opt.disable_click_link){container.appendChild(promo);["click","touchend"].forEach(function(ev_name){promo.addEventListener(ev_name,function(event){window.open(ad_opt.click_url);if(!_this._opt.disable_click_destroy)_this.destroy();event.preventDefault();event.stopPropagation()})})}else{this._link=document.createElement("a");this._link.href=ad_opt.click_url;this._link.target="_blank";this._link.appendChild(promo);container.appendChild(this._link)}}else container.appendChild(promo);var source=this.source=document.createElement("source");source.setAttribute("type","video/mp4");promo.appendChild(source);this._add_listeners();source.setAttribute("src",ad_opt.url)};Linear.prototype._rm_listeners=function(){this._rm_trackers();this._promo.removeEventListener("ended",this.__on_ended);this._promo.removeEventListener("loadedmetadata",this.__on_meta);this.source.removeEventListener("error",this.__on_error)};Linear.prototype._update_speed=function(){this._promo.defaultPlaybackRate=this.speed;this._promo.playbackRate=this.speed};Linear.prototype._update_state=function(state){this.state=state;this.emit(E.events.STATE_CHANGE,state)};zutil.inherits(NonLinear,events.EventEmitter);function NonLinear(container,ad_opt,opt){this._width=dom_util.width(container)||1;this._height=dom_util.height(container)||1;this._container=container.shadowRoot;this._ad_opt=ad_opt;this._opt=opt;this.state=E.states.IDLE;this._render()}NonLinear.prototype.deomo)};NonLinear.prototype.hide=function(){var _opt=this._opt;if(_opt.keyframes_hide){var dur=_opt.keyframes_hide_dur_sec||1;this.promo.style.animation="preview_promo_hide "+dur+"s";this.promo.style.animationFillMode="forwards"}else this.promo.style.visibility="hidden"};NonLinear.prototype.show=function(){var _opt=this._opt;if(_opt.keyframes_show){var dur=_opt.keyframes_show_dur_sec||1;this.promo.style.animation="preview_promo_show "+dur+"s";this.promo.style.animationFillMode="forwards"}this.promo.style.visibility="visible";this.__on_ended_timeout=setTimeout(this._on_ended.bind(this),this._ad_opt.duration*1e3)};NonLinear.prototype._add_listeners=function(){this.__on_error=this._on_error.bind(this);this.__on_load=this._on_load.bind(this);this.__on_timeupdate=this._on_timeupdate.bind(this);this.promo.addEventListener("load",this.__on_load);this.promo.addEventListener("error",this.__on_error)};NonLinear.prototype._on_ended=function(){this._rm_listeners();this.hide();this._update_state(E.states.ENDED)};NonLinear.prototype._on_ROR)};NonLinear.prototype._on_load=function(){this.promo_width=this.promo.naturalWidth;this.promo_height=this.promo.naturalHeight;this._update_size()};NonLinear.prototype._on_timeupdate=function(){if(this.state!=E.states.IDLE)return;this._update_state(E.states.STARTED);this.show()};NonLinear.prototype._render=function(){var promo=this.promo=document.createElement("img");promo.className="spark_preview_promo_nonlinear";promo.style.visibility="hidden";this._container.appendChild(promo);this._add_listeners();promo.setAttribute("src",this._ad_opt.url)};NonLinear.prototype._rm_listeners=function(){if(this.promo)this.promo.removeEventListener("load",this.__on_load);if(this.__on_ended_timeout)this.__on_ended_timeout=void clearTimeout(this.__on_ended_timeout);this.promo.removeEventListener("error",this.__on_error)};NonLinear.prototype._update_state=function(state){this.state=state;this.emit(E.events.STATE_CHANGE,state)};NonLinear.prototype._update_size=function(){this.promo.style.width=this._width;var new_height=this.promo_height*this._width/this.promo_width;this.promo.style.height=new_height+"px";this.promo.style.top=(this._height-new_height)/2+"px"};return E});
define("/svc/cdn/pub/feature/preview/promo.js",{__stub:1});
define("/svc/cdn/pub/autoplay_policy.js",["/svc/cdn/pub/utilrn E});
define("/svc/cdn/pub/widget_info.js",["cash","/util/util.js","/util/events.js","/svc/cdn/pub/play_icon.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/l10nrn E});
define("/svc/cdn/pub/feature/preview/modal_box.js",["cash","/svc/cdn/pub/utilrn E});
define("/svc/cdn/pub/feature/preview/index.js",["cash","/svc/cdn/pub/util.js","/util/events.js","/svc/cdn/pub/play_icon.js","/svc/cdn/pub/feature/preview/debug.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/l10n.js","/svc/cdn/pub/feature/preview/editor.js","/svc/cdn/pub/feature/preview/controls.js","/svc/cdn/pub/feature/preview/promo.js","/svc/cdn/pub/autoplay_policy.js","/svc/cdn/pub/widget_info.js","/svc/cdn/pub/feature/preview/modal_boxrn E});
define("/svc/cdn/pub/feature/playlist/promo.js",["/svc/cdn/pub/promo_db.js","/svc/cdn/pub/promo_ui.js","/svc/cdn/pub/dom_util.js"],function(promo_db,promo_ui,dom_util){var E={};var promo_data;var stop_event=function(event){event.preventDefault();event.stopPropagation()};function PlaylistPromo(container,opt){this._db=opt&&new promo_db(opt)||promo_data;if(!this._db)return;this._container=container;this._state={idx:0};var _this=this;this._db.onready(function(){_this._playlist=_this._db.get_playlist();if(!_this._playlist||!_this._playlist.length)return;_this._check_state()})}PlaylistPromo.prototype.destroy=function(){if(this._ad)this._ad.destroy();dom_util.remove(this._el)};PlaylistPromo.prototype._next=function(){if(this._ad){this._ad.destroy();this._ad=null}this._state.idx++;if(this._state.idx>=this._playlist.length){this._state.idx=0;this._playlist=this._db.get_playlist()}this._check_state()};PlaylistPromo.prototype._create_ad=function(promo_opt){var _this=this;if(!this._el){this._el=document.createElement("div");["click","touchend"].foent)});var rect=this._container.getBoundingClientRect();Object.assign(this._el.style,{left:0,top:0,overflow:"hidden",position:"absolute",width:rect.width?rect.width+"px":"100%",height:rect.height?rect.height+"px":"100%"});this._container.appendChild(this._el);this._container.removeAttribute("href")}this._ad=new promo_ui(this._el,promo_opt,Object.assign({disable_click_link:true,disable_click_destroy:true},E._opt));this._ad.on(promo_ui.events.STATE_CHANGE,function(state){if(state==promo_ui.states.ENDED||state==promo_ui.states.ERROR)_this._next()})};PlaylistPromo.prototype._check_state=function(){if(this._ad)return;var promo_opt=this._playlist[this._state.idx];if(!promo_opt)return;setTimeout(this._create_ad.bind(this,promo_opt),100)};E.copt)};E.init=function(opt){if(!opt||!opt.enable)return;E._opt=opt;promo_data=new promo_db(opt)};return E});
define("/svc/cdn/pub/widget.js",["cash","/svc/cdn/pub/util.js","/util/events.js","/svc/cdn/pub/play_icon.js","/util/url.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/l10n.js","/svc/cdn/pub/feature/playlist/promo.js","/svc/cdn/pub/perr.js"],function($,util,events,play_icon,zurl,dom_util,l10n,playlist_promo,perr){var assign=Object.assign,id="widget";var E={};var path="//ve-image-cdn.h-cdn.com/svc/preview/pub/img/";var wm_svg=path+"watermark.svg";var wm_transparent=path+"watermark-transparent.svg";var pr_countdown="hola_preview_navigate_on_hover_enabled";var pr_class="hola_widget_";var preload_css=function(){var loaded=false;return function(){if(loaded)return;loaded=true;dom_util.preload_css(util.player_url+require.zdot("widget_css"))}}();function add_powered_by_btn(root,opt){if(!opt.add_powered_logo)return;var link,el,create=create_el.bind(this,pr_class);link=create("a","powered_text");var img=E.create_img("hola_widget_powered_by_logo");link.append(img.create(wm_transparent)).attr("href","http://holaspark.com?cam=wm_"+id+"_"+E.spark.customer).attr("target","_blank").append($("<div>").text(l10n.spark_t("powered_by_text")));el=create("div","powered");root.append(el.append(create("div","powered_info").append(link)));return el}function add_watch_later(res){if(!E.spark.is_feature_inited("watch_later"))return;E.spark.features.watch_later.module.storage.set(res.url,res)}function create_el(base,el,cl){return $("<"+el+">").addClass(base+(cl||""))}function format_sec(sec){sec=Math.round(sec);var s=sec%60;var min=Math.floor(sec%3600/60);var hour=Math.floor(sec/3600);return(hour?pad(hour,2)+":":"")+pad(min,2)+":"+pad(s,2)}function get_scroll_parent(node){var style=getComputedStyle(node);var ex_static=style.position=="absolute";var overflow_re=/(auto|scroll)/;if(style.position=="fixed")return document.body;for(var parent=node;parent=parent.parentElement;){style=getComputedStyle(parent);if(ex_static&&style.position=="static")continue;if(overflow_re.test(style.overflow+style.overflowY+style.overflowX))return parent}return document.body}function get_source(res){return res.source||zurl.get_host(E.spark.top_url).replace(/^www\./,"")}function pad(num,size){return("000"+num).slice(-size)}function play_next(next,is_click){if(this.opt.handlers.play_next)return void this.opt.handlers.play_next(next,is_click);if(this.opt.events.play_next)this.opt.events.play_next(next,is_click);this.log.debug("switching to another video");this.stats.inc(is_click?"next_click_n":"next_autoplay_n");var page_url;if(!(page_url=next.url||next.page_url||next.location))return;if(this.opt.events.next_url)this.opt.events.next_url(next,is_click);var _this=this;return void setTiurl)},0)}function sec_to_dur(s){return util.date_ms_to_dur(s*1e3).replace(/^00:/,"")}function set_div_size(div,opt){var rows=opt.rows||"auto",cols=opt.cols||"auto";if(rows!="auto"&&cols!="auto")return void assign(opt,{cols:cols,rows:rows});var dsize,tsize=opt.size;dsize={width:$(div).width(),height:$(div).height()};var add=function(num,key,skey,border){opt[key]=num=="auto"?Math.floor(dsize[skey]/(tsize[skey]+border)):num};add(cols,"cols","width",4);add(rows,"rows","height",4)}util.inherits(Window,events.EventEmitter);function Window(_id,opt){this.id=_id;this.opt=opt;this.active=true;this._render()}Window.prototype.bind_e")})};Window.prototype.destroy=function(){if(!this.active)return;this.active=false;this.view.remove()};Window.prototype.get_container=function(){return this.container};Window.prototype.get_view=function(){return this.view};Window.prototype.get_drag_area=function(){return this.view};Window.prototype._render=function(){var size=assign({width:"600px",height:"450px"},this.opt.div_size);var view=$("<div>").addClass("hola_widget_view");var container=$("<div>").addClass("hola_widget_container").css({width:size.width,height:size.height});var title=$("<div>").addClass("hola_widget_title").text(this.opt.title||"Videos");view.append(title);this.close=$("<div>").addClass("hola_widget_view_close");view.append(this.close);view.append(container);this.container=container;this.view=view};function Composer(){this.window_id=0;this.windows=[];this.wopt={};this.has_overlay=false}Composer.prototype.create_window=function(opt){if(!this.has_overlay)this._create_overlay();var w=new Window(++this.window_id,opt);this.windows.push(w);var view=w.get_view();$(view).css({display:"block",position:"absolute"});this.overlay.append(view);$(view).css({top:"50%",left:"50%","margin-left":"-"+Math.floor($(view).width()/2)+"px","margin-top":"-"+Math.floor($(view).height()/2)+"px"});this.wopt[w.id]={};this.wopt[w.id].handlers={close:this._window_close.bind(this,w),mousedown:this._window_mousedown.bind(this,w),mouseup:this._window_mouseup.bind(this,w),mousemove:this._window_mousemove.bind(this,w)};w.on("close",this.wopt[w.id].handlers.close);var area=w.get_drag_area();area.on("mousedown",this.wopt[w.id].handlers.mousedown);w.bind_events();this._update_zindex();return w.get_container()};Composer.prototype._create_overlay=function(){this.overlay=$("<div>").addClass("hola_widget_overlay");$(document.body).append(this.overlay);this.has_overlay=true;var _this=this;this.overlay.on("click",function(event){if(event.target==_this.overlay.get(0))_this._destroy()})};Composer.prototype._destroy=function(){var _this=this;this.windows.forEach(function(w){_this._window_close_int(w)});$(this.overlay).remove();this.has_overlay=false;this.window_id=0};Composer.prototype._update_zindex=function(w){this.windows.push(this.windows.splice(this.windows.indexOf(w),1)[0]);for(var i in this.windows)this.windows[i].get_view().css({"z-index":i+1})};Composer.prototype._window_close=function(w){this._window_close_int(w);if(!this.windows.length)this._destroy()};Composer.prototype._window_close_int=function(w){var area=w.get_drag_area();var handlers=this.wopt[w.id].handlers;this.overlay.off("mousemove",handlers.mousemove);this.overlay.off("mouseup",handlers.mouseup);area.off("mousedown",handlers.mousedown);w.off("close",handlers.close);delete this.wopt[w.id];w.destroy();this.windows.splice(this.windows.indexOf(w),1)};Composer.prototype._window_mousedown=function(w,event){if(this.wopt[w.id].drag_start)return;this.overlay.on("mousemove",this.wopt[w.id].handlers.mousemove);this.overlay.on("mouseup",this.wopt[w.id].handlers.mouseup);this.wopt[w.id].drag_start={x:event.screenX,y:event.screenY};this._update_zindex(w)};Composer.prototype._window_mouseup=function(w,event){if(!this.wopt[w.id].drag_start)return;this.overlay.off("mousemove",this.wopt[w.id].handlers.mousemove);this.overlay.off("mouseup",this.wopt[w.id].handlers.mouseup);var pos={x:event.screenX,y:event.screenY};var drag_start=this.wopt[w.id].drag_start;this._window_move(w,pos.x-drag_start.x,pos.y-drag_start.y);this.wopt[w.id].drag_start=null};Composer.prototype._window_mousemove=function(w,event){var pos={x:event.screenX,y:event.screenY};var drag_start=this.wopt[w.id].drag_start;this._window_move(w,pos.x-drag_start.x,pos.y-drag_start.y);this.wopt[w.id].drag_start=pos};Composer.prototype._window_move=function(w,dx,dy){var pos=this.wopt[w.id].pos||(this.wopt[w.id].pos={x:0,y:0});pos.x+=dx;pos.y+=dy;w.get_view().css({transform:"translate("+pos.x+"px, "+pos.y+"px)"})};Composer.get=function(){var composer;return function(){return composer=composer?composer:new Composer}}();util.inherits(Widget,events.EventEmitter);function Widget(pl,div,opt){opt=assign({events:{},handlers:{},autoclick:{}},opt);E.spark=opt.spark;if(!E.t)E.t=l10n.get_t(id);this.opt=opt;opt.size=opt.size||{width:190,height:130};if(!opt.skip_default_menu&&E.spark.is_feature_inited("watch_later")){(opt.menu||(opt.menu=[])).push({title:this.t("add_to_watch_later"),handler:function(item,props){add_watch_later({url:props.page_url,img:props.poster||props.video_poster,title:util.str_longest(props.description,props.title)})}})}this.div=div?$(div):Composer.get().create_window(opt);set_div_size(this.div,opt);this.log=opt.log||{debug:function(){},info:function(){}};this.stats=opt.stats||{inc:function(){}};this.pl=pl||[];this.tiles=[];this.rtl=opt.rtl;this.img=E.create_img("hola_widget_poster_img");if(this.rtl===undefined)this.rtl=dom_util.detect_direction(this.div[0])=="rtl";this.inited=true;this._history_init();this.render()}E.Widget=Widget;E.Widget.prototype.t=function(text,opt){var strings=this.opt.strings||{};if(!strings[text])return E.t(text,opt);if(typeof strings[text]=="string")return strings[text];return strings[text](opt)};E.Widget.prototype.mark_played=function(){if((this.opt.autoclick||{}).type=="loop")return;var h=this.history;this.pl.forEach(function(el){if(h.page_url[el.page_url]||h.url_key[el.url_key])el.played=true})};E.Widget.prototype.get_next=function(){var opt=this.opt.autoclick||{},pl=this.pl,type=opt.type;if(!opt.enable||!pl.length)return;if(type=="tile"){if(opt.tile!==undefined||pl.find(function(e){return!e.played&&!e.is_static})){return pl[opt.tile||0]}type="random"}if(type=="random"){var f=pl.filter(function(e){return!e.is_static});if(!f.length)f=pl;return f[Math.floor(Math.random()*f.length)]}pl=pl.filter(function(e){return!e.played});var idx=0;var len=pl.length,pos=this._get_cursor_pos();if(pos==idx)idx++;idx=len?idx%len:0;return pl[idx]};E.Widget.prototype.it_list=function(){if(!this.inited)return;this.hola_widget_main.addClass("hola_widget_list");this.pl.forEach(this.render_list_item.bind(this));var root=$(get_scroll_parent(this.hola_widget_main.get(0)));var _this=this;this.scroll_root=root;this.load_more_et=null;this.scroll_fn=util.throttle(function(){if(_this.load_more_et)return;var h=root.height(),sh=root.get(0).scrollHeight;var st=root.get(0).scrollTop;if(sh-st-h<=250){_this.scroll_root.off("scroll",_this.scroll_fn);if(_this.opt.load_more_fn){_this.opt.load_more_fn(function(res){if(!res)return;_this.pl=res;_this.it_list()})}}},200);root.on("scroll",this.scroll_fn);this.scroll_fn()};E.Widget.prototype.get_link_url=function(url){return url&&E.spark.gen_page_url(url,this.opt.link_tags||[])};E.Widget.prototype.render_list_item=function(res){var meta=[],opt=this.opt,t=E.t,_this=this;if(!opt.skip_author)meta.push(get_source(res));if(res.total)meta.push(t("item_views",{num:util.scaled_number(res.total)}));if(res.ts)meta.push(l10n.time_ago(res.ts));var p=res.poster||res.video_poster||"";var d=util.str_longest(res.description,res.title);var cl_prefix="hola_widget_list_item";var create=create_el.bind(this,cl_prefix);var r=create("a").attr({"data-watch-later-item":1,"data-spark_preview_link":"","data-spark_feature":"widget",href:this.get_link_url(res.page_url||res.location)||"#"});var img=create("div","_poster_img").css({"background-image":"url('"+p+"')"}).attr({"data-spark_preview_img":"","data-spark_preview_img_src":p});if(!opt.hide_duration&&res.dur)img.append(create("div","_duration").text(format_sec(res.dur)));var poster_div=create("div","_poster");if(res.video_poster){poster_div.css({background:"url("+res.video_poster+") no-repeat #fff","background-size":"100% 100%"})}r.append(create("div","_poster_wrap").append(poster_div.append(img)));var desc_wrap=create("div","_description_wrap");var meta_div=create("div","_meta");for(var i=0;i<meta.length;i++)meta_div.append(create("div","_meta_item").text(meta[i]));r.append(desc_wrap.append(create("div","_title").text(util.str_trunc(d||"",50))).append(meta_div).append(create("div","_description").text(res.description||"")));r.on("click",function(event){event.preventDefault();event.stopPropagation();play_next.call(_this,res,true)});E.set_preview_url(r,res,opt);var item=create("div","_wrap").append(r);var m;var _opt={dom:item,remove:function(){$(item).remove();if(_this.opt.events.item_remove)_this.opt.events.item_remove(res)}};if(opt.menu){m=create("div","_menu").html('<div class="'+cl_prefix+'_menu_btn_wrap">'+'<button class="'+cl_prefix+'_menu_btn"></button>'+"</div>");var ul=$("<ul>");opt.menu.forEach(function(menu_item){var li=$("<li>").text(menu_item.title).on("click",menu_item.handler.bind(menu_item,_opt,res));ul.append(li)});m.append(ul);desc_wrap.append(m)}if(opt.actions){m=create("div","_actions");opt.actions.forEach(function(menu_item){var div=$("<div>").attr("title",menu_item.title).addClass(menu_item.class_name).on("click",menu_item.handler.bind(menu_item,_opt,res));m.append(div)});desc_wrap.append(m)}var actions=item.find(".hola_widget_list_item_actions");actions.on("con()});var menu=item.find(".hola_widget_list_item_menu");menu.on("click",function(event){event.preventDefault();event.stopPropagation();_this.hola_widget_main.find(".hola_widget_list_item_menu_visible").removeClass("hola_widget_list_item_menu_visible").filter(function(elem){return elem!=menu.get(0)}).find("ul").css("display","none");menu.addClass("hola_widget_list_item_menu_visible");var _ul=menu.find("ul");_ul.css("display",_ul.css("display")=="block"?"none":"block")});img.on("error",function img_on_error(){img.off("error",img_on_error);img.attr("src",wm_svg);img.css("object-fit","contain")});item.find("a").prop("data-watch-later-conf",{position:"tl",margin:{x:2,y:2},z_index:"auto",pos_elem_sel:""});this.hola_widget_main.append(item);if(this.opt.events.item_add)this.opt.events.item_add(res)};E.Widget.prototype.it_tiles=function(size,cb){var pl=this.pl,opt=this.opt,row=opt.rows;var ts,off={top:0,left:0},col=opt.cols;var tborder=this.opt.tborder||4,lborder=this.opt.lborder||4;function get_len(pl_len){var len=row*col;while(len){if(pl_len>=len)return len;len-=col;row--;if(row<opt.min_rows)return 0}}if(opt.skip_small&&!get_len(pl.length))return this.stats.inc("small_playlist_n");var btn_size=0;if(opt.add_play_button)btn_size=opt.play_button_size||48;ts={width:Math.round((size.width-lborder*(col+1))/col),height:Math.round((size.height-btn_size-tborder*(row+1))/row)};for(var i=0;i<row;i++){var top=off.top+i*tborder+i*ts.height+tborder;for(var j=0;j<col;j++){if(pl.length<=i*col+j)return;cb.apply(this,[i*col+j,{top:top,height:ts.height,width:ts.width,left:off.left+j*lborder+j*ts.width+lborder}])}}if(btn_size){btn_size={top:size.height-btn_size-tborder,left:Math.round(lborder/2),width:btn_size,height:btn_size};cb.call(this,"play_btn",btn_size)}};E.Widget.prototype.update=function(){if(!this.div)return;var size={width:this.div.width(),height:this.div.height()};if(this.size.width!=size.width||this.size.height!=size.height){this.size=size;this.it_tiles(this.size,this.update_tile)}setTimeout(this.update.bind(this),500)};E.Widget.prototype.update_tile=function(idx,size){var tile;if(idx=="play_btn")return this._update_play_btn(idx,size);if(!(tile=this.tiles[idx]))return;tile.css({top:size.top+"px",left:size.left+"px",height:size.height+"px",width:size.width+"px"});var icon=tile.find(".hola_preview_icon");if(icon.length){var w=icon.width();icon.css({top:(size.height-w)/2+"px",left:(size.width-w)/2+"px"})}};E.Widget.prototype.add_hover=function(tile){if(!tile.poster)return;var _this=this;var update=function(){if(tile.poster.hasClass("hola_preview_countdown"))tile.addClass("hola_widget_tile_hover");if(tile.rm_hover)return;tile.rm_hover=setTimeout(function(){if(tile.poster.hasClass("hola_preview_playing")||tile.poster.hasClass("hola_preview_countdown")){tile.addClass("hola_widget_tile_hover")}},_this.opt.hover_anim_time*1e3)};tile.wait_fn=function(start){if(tile.rm_hover)tile.rm_hover=clearTimeout(tile.rm_hover);if(tile.unwatch_class)tile.unwatch_class=tile.unwatch_class();tile.removeClass("hola_widget_tile_hover");if(!start)return;tile.unwatch_class=dom_util.attr_watch(tile.poster[0],{attr:"class",watch_fn:update});update()};tile.hover_fn=function(){tile.wait_fn(true);tile.on("mousemove",tile.move_fn)};tile.unhov_fn)};tile.move_fn=function(){if(!tile.poster.hasClass("hola_preview_countdown"))tile.wait_fn(true)};tile.on("mouseenter",tile.hover_fn);tile.on("mouseleave",tile.unhover_fn)};E.Widget.prototype.create_tile=function(next,idx){var link,opt=this.opt,create=create_el.bind(this,pr_class);var tile=opt.disable_link_tile||!(link=next.url||next.page_url)?create("div","tile"):create("a","tile").attr("href",this.get_link_url(link));var _this=this,stats_inc=_this.opt.handlers.stats_inc;this.on_link_click=function(e){if(e.type=="contextmenu"||!_this._is_ctrl_click(e)){if(opt.handlers.on_context_menu&&e.type=="contextmenu")opt.handlers.on_context_menu(e,tile,idx,next,opt);return e.preventDefault()}if(!stats_inc)return;["next_click_n","next_middle_click_n","next_url_n"].forEach(function(name){stats_inc(name,_this.type,_this.opt._state)})};["click","auxclick","contextmenu"].forEach(function(name){tile.on(name,_this.on_link_click)});return tile};E.Widget.prototype.render_play_btn=function(idx,topt){var el=create_el(pr_class,"div",idx);this.play_btn=this.icon_show(el,false,topt,{size_px:topt});this._update_play_btn(idx,topt);this.hola_widget_main.append(el)};E.Widget.prototype.render_tile=function(idx,size){if(idx=="play_btn")return this.render_play_btn(idx,size);var info=$("<span>").addClass("hola_widget_info");var itop=$("<div>").addClass("hola_widget_info_top");var opt=this.opt,next=this.pl[idx];var tile=this.create_tile(next,idx);tile.css({top:size.top+"px",left:size.left+"px",height:size.height+"px",width:size.width+"px"});tile.attr("pl_idx",idx);if(playlist_promo&&!playlist_promo.__stub&&next.type=="promo"){this.hola_widget_main.append(tile);this.tiles.push(tile);this.promo=playlist_promo.create(tile[0],next.promo);return}if(opt.add_dbg_info)opt.add_dbg_info(tile,next,opt);var css=opt.css||{};if(next.poster){tile.img=this.img.create(next.poster,next);tile.img.attr("data-spark_preview_img","");var poster=tile.poster=$("<div>").addClass("hola_widget_poster").attr("data-spark_feature","widget").attr("data-spark_preview_link","");poster.attr("data-spark_preview_page_url",next.url||next.page_url);poster.attr("spark_video_title",util.str_longest(next.title,next.description));poster.prop("data-watch-later-conf",{position:this.rtl?"tl":"tr",margin:{x:2,y:2},z_index:"auto",pos_elem_sel:""});E.set_preview_url(poster,next,opt);tile.append(poster.append(tile.img))}if(next.description){itop.append($("<div>").addClass("hola_widget_description").text(next.description))}if(css.font_size)info.css({"font-size":css.font_size+"px"});if(opt.show_play_icon)this.icon_show(tile,false,size);if(!opt.hide_views&&next.total)this.views_show(itop,size,next.total);info.append(itop);if(!opt.hide_duration&&next.dur)this._duration_show(info,size,next.dur);if(opt.show_info)info.addClass("hola_widget_info_static");if(opt.show_category&&next.category){var category=$("<div>").addClass("hola_widget_category");category.css("display","none");category.attr("category",next.category);category.text(next.category);tile.append(category)}this.hola_widget_main.append(tile.append(info));this.tiles.push(tile);if(!opt.disable_info_hide)this.add_hover(tile)};E.Widget.prototype.render=function(){this.log.debug("widget render");this.hola_widget_main=$("<div>").addClass("hola_widget_main");this.div.append(this.hola_widget_main);this.div.addClass("hola_widget hola_top_element");add_powered_by_btn.call(this,this.div,this.opt);if(this.rtl)this.div.addClass("hola_widget_rtl");this.stats.inc("popup_n");if(this.opt.events.show)this.opt.events.show();this.size={width:this.div.width(),height:this.div.height()};this.mark_played();this.next=this.get_next();if(this.opt.mode=="list")this.it_list();else{this.it_tiles(this.size,this.render_tile);var el;if((el=this.pl.indexOf(this.next))!=-1&&!isNaN(+(this.opt.autoclick||{}).timeout)){el=this.tiles[el];this.icon_show(el,true,{width:el.width(),height:el.height()})}this.update();this._bind_events()}};E.Widget.prototype.views_show=function(root,pos,views){if(pos.width<this.opt.size.width/2)return;var text=this.t("item_views",{num:this.opt.views_count(views||0)});root.append($("<div>").addClass("hola_widget_views").text(text))};E.Widget.prototype.icon_show=function(tile,is_countdown,size,iopt){var _this=this,autoclick=this.opt.autoclick;var pos={top:0,left:0,height:size.height,width:size.width};var opt={tr:this.t.bind(this),is_allowed:function(){return true},pos:pos,shadow:true,icon_location:"center",img:tile.img,img_pos:pos,icon_countdown:is_countdown,container:tile,disable_visibility_check:this.opt.disable_visibility_check,is_top:util.is_top,msg:E.spark.msg};if(is_countdown){var on_navigate=function(){play_next.call(_this,_this.pl[+tile.attr("pl_idx")],false)};var cck()};var onrue)};var on_hide=function(){tile.removeClass("hola_widget_next_countdown");_this.on_countdown();if(tile.poster)tile.poster.data(pr_countdown,false)};assign(opt,{on_countdown_cancel:cancel.bind(this),on_show:on_show,countdown_on_hover:autoclick.timeout,on_hide:on_hide,on_navigate:on_navigate})}var icon;this.icons=this.icons||[];this.icons.push(icon=new play_icon.Icon(assign(opt,iopt)));return icon};E.Widget.prototype.on_countdown=function(is_shown){var click=this.opt.autoclick||{};if(!click.navigate_on_hover_enabled)return;this.tiles.forEach(function(e){if(e=e.poster)e.data(pr_countdown,!is_shown)})};E.Widget.prototype.uninit=function(){if(!this.inited)return;if(this.uninit_fn)this.ctx.off("widget_hide",this.uninit_fn);this.hola_widget_main.off("click",this.on_main_fn);if(this.on_play_fn)this.play_btn.container.off("click",this.on_play_fn);this._cancel_event(this.hola_widget_main,"off",["mouseup","pointerup"]);if(this.icons){this.icons.forEach(function(e){e.hide()});this.icons=undefined}var _this=this;this.tiles.forEach(function(e){if(_this.on_link_click){["click","auxclick","contextmenu"].forEach(function(name){e.on(name,_this.on_link_click)})}if(!e.wait_fn)return;e.wait_fn();e.off("mousemove",e.move_fn);e.off("mouseenter",e.hover_fn);e.off("mouseleave",e.unhover_fn)});if(this.scroll_root)this.scroll_root.off("scroll",this.scroll_fn);this.div.removeClass("hola_widget hola_top_element");this.div.empty();this.div=this.hola_widget_main=undefined;this.img.uninit();if(this.promo){this.promo.destroy();this.promo=null}this.inited=false};E.Widget.prototype._bind_events=function(){this.on_main_fn=function(e){var idx,cl="hola_widget_tile",tile=$(e.target);if(!tile.hasClass(cl))tile=tile.parents("."+cl);if(!tile.length||this._is_ctrl_click(e))return;e.preventDefault();e.stopPropagation();idx=+tile.attr("pl_idx");play_next.call(this,this.pl[idx],true)}.bind(this);this.hola_widget_main.on("click",this.on_main_fn);if(this.play_btn&&this.opt.handlers.play){this.on_play_fn=function(e){e.preventDefault();e.stopPropagation();this.opt.handlers.play()}.bind(this);this.play_btn.container.on("click",this.on_play_fn)}this._cancel_event(this.hola_widget_main,"on",["mouseup","pointerup"])};E.Widget.prototype._cancel_event=function(el,type,evts){this.on_cancel_event=this.on_cancel_event||function(e){e.stopImmediatePropagation();e.preventDefault()};var _this=this;evts.forEach(function(e){el[type](e,_this.on_cancel_event)})};E.Widget.prototype._duration_show=function(root,pos,sec){if(pos.width<this.opt.size.width/2)return;root.append($("<div>").addClass("hola_widget_duration").text(sec_to_dur(sec)))};E.Widget.prototype._get_cursor_pos=function(){var page_url=E.spark.get_top_url();var p=(this.opt.autoclick||{}).player,url_key=p&&p.url_key;var pl=this.pl;for(var i=0;i<pl.length;i++){var url=pl[i].url||pl[i].page_url||pl[i].url_key;if(url==page_url||url==url_key)return i}};E.Widget.prototype._history_init=function(){var key;var history=E.spark.history&&E.spark.history.data||[];var _this=this;this.history={page_url:{},url_key:{}};history.forEach(function(e){if(e.page_url)_this.history.page_url[e.page_url]=e;if(key=e.url_key||e.cache_url)_this.history.url_key[key]=e})};E.Widget.prototype._is_ctrl_click=function(e){return e.ctrlKey||e.shiftKey||e.metaKey||e.button&&e.button==1};E.Widget.prototype._update_play_btn=function(idx,topt){if(!this.play_btn)return;this.play_btn.container.css({position:"absolute",left:topt.left+"px",width:topt.width+"px",height:topt.height+"px",top:topt.top+"px"});var pos=util.pick(topt,"width","height");this.play_btn.update_pos({pos:pos,img_pos:pos,size_px:pos.height})};E.set_preview_url=function(el,next,opt){opt=opt||{};var url,type,disable_preview=opt.skip_preview||next.disable_preview;if(!disable_preview)url=next.orig_url||next.url||next.video_url||next.page_url;el.attr("data-spark_feature","playlist").attr("data-spark_preview_page_url",url?util.absolute_uri(url):"").attr("data-spark_preview_link","");if(type=next.media_info&&next.media_info.video_type)el.attr("data-hola-video-type",type);var autoclick=opt.autoclick||{};if(autoclick.navigate_on_hover_enabled){["navigate_on_hover_enabled","countdown_on_hover","navigate_on_hover_sec"].fo[e])})}if(!disable_preview&&(url=next.video_url))el.attr("data-spark_preview_video_url",util.absolute_uri(url))};E.create_img=function(cl){var reported,imgs=[];if(!(reported=E.create_img.reported))reported=E.create_img.reported={};return{create:function(url,info){var div=$("<div>").addClass(cl);div.css({"background-image":"url('"+url+"')"}).attr("data-spark_preview_img","").attr("data-spark_preview_img_src",url).attr("data-spark-src",url);if(!info||!info.url_md5||!util.is_chrome)return div;var on_error=function(e){if(reported[info.url_md5])return;perr({id:"widget_poster_error",delay:false,info:{poster_url:url,url_md5:info.url_md5}});reported[info.url_md5]=true};var img=$("<img>").css({display:"none"}).attr("src",url).on("error",on_error);imgs.push({el:img,cb:on_error});return div.append(img)},uninit:function(){imgs.fo.cb)})}}};Eit()};return E});
define("/svc/cdn/pub/feature/watch_later/index.js",{__stub:1});
define("/svc/cdn/pub/feature/position_memory/index.js",{__stub:1});
define("/svc/cdn/pub/feature/playlist/editor.js",{__stub:1});
define("/svc/cdn/pub/feature/playlist/util.js",["cash","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/util.js"],function($,dom_util,util){var E={};var assign=Object.assign;var pr_class="hola_playlist_";var cancel_click_events=["mousedown","pointerdown","mouseup","pointerup"];var styles={600:{pbottom_css:{padding:"0 12px 12px"},pdesc_css:{"font-size":"12px"},pdur_css:{"font-size":"10px"},plabel_css:{"font-size":"12px"},plabel_info_css:{"min-width":"20px"},plabel_type_css:{"min-width":"20px"}},700:{pbottom_css:{padding:"0 14px 14px"},pdesc_css:{"font-size":"14px"},pdur_css:{"font-size":"12px"},plabel_css:{"font-size":"14px"},plabel_info_css:{"min-width":"30px"},plabel_type_css:{"min-width":"30px"}},900:{pbottom_css:{padding:"0 16px 16px"},pdesc_css:{"font-size":"16px"},pdur_css:{"font-size":"14px"},plabel_css:{"font-size":"16px"},plabel_info_css:{"min-width":"60px"},plabel_type_css:{"min-width":"60px"}}};E.fscreen_zindex=2147483647;E.wm_url="//ve-image-cdn.h-cdn.com/svc/preview/pub/img/watermark-transparent.svg";E.add_rm_fs_listener=function(remove,cb){var f=remove?"removeEventListener":"addEventListener";["","webkit","ms","moz"].fo,cb)})};E.cancel_event=function(el,type,evts){evts=evts||cancel_click_events;this.on_cancel_event=this.on_cancel_event||function(e){e.stopImmediatePropagation();e.preventDefault()};var _this=this;evts.forEach(function(e){el[type](e,_this.on_cancel_event)})};E.create_el=function(base,el,cl){return $("<"+el+">").addClass(base+(cl||""))};E.create_tile=function(next,stats_inc){var link,opt=this.opt;var create=E.create_el.bind(this,pr_class);var tile=opt.disable_link_tile||!(link=!this.ctx.is_inline()&&next.url||next.page_url)?create("div","tile "+pr_class+"ptile"):create("a","tile "+pr_class+"ptile").attr("href",link);var _this=this;this.on_link_click=function(e){if(e.type=="contextmenu"||!E.is_ctrl_click(e)){if(e.type=="contextmenu")_this.ctx.emit("info_show",e);return e.preventDefault()}["next_click_n","next_middle_click_n","next_url_n"].foate)})};["click","auxclick","contextmenu"].forEach(function(name){tile.on(name,_this.on_link_click)});return tile};E.get_container_pos=function(ctx,use_video,get_max){var pos,c=$(ctx.container),v=E.get_video(ctx);function get_pos(a,b,offset){var p=offset&&a.offset()||{};p.width=Math.round(Math.max(a.width(),b?b.width():0));p.height=Math.round(Math.max(a.height(),b?b.height():0));return p}if(get_max&&v.length)pos=get_pos(c,v,true);else{if(!use_video)pos=get_pos(c,undefined,true);if(v.length&&(use_video||!pos.height||!pos.width))pos=assign({},pos,get_pos(v,undefined,use_video))}return pos||{}};E.get_frame_container=function(ctx,opt){return dom_util.is_fullscreen()&&(!ctx.ended||ctx.ended&&!opt.use_container_on_end)?E.get_video(ctx):ctx.container};E.get_popup_size=function(dsize,opt){var conf=opt.pnext_conf,size=conf.size;return conf.min_width>dsize.width?size.min:util.is_mobile?size.mobile:size.def};E.get_video=function(ctx){var c=$(ctx.container),v=ctx.controls.get_ui().media;return v?$(v):c[0].tagName=="VIDEO"?c:c.find("video")};E.get_widget_conf=function(conf,size){var i,s=Object.keys(styles) a-b});for(i=0;i<s.length;i++){if(size.width<=s[i])break}i=Math.min(i,s.length-1);return assign({},styles[s[i]],conf)};E.is_ctrl_click=function(e){return e.ctrlKey||e.shiftKey||e.metaKey||e.button&&e.button==1};E.is_visible=function(el){return!!(el[0]&&el.css("display")!="none"&&el.css("opacity")!="0"&&el.css("visibility")!="hidden")};E.on_fullscreen=function(e){var s={};e=e||{is_fullscreen:dom_util.is_fullscreen()};if(this.opt.set_z_index)this.opt.set_z_index({s:s,E:E,e:e,_this:this,$:$});else s["z-index"]=e.is_fullscreen?E.fscreen_zindex:this.opt.zindex+1;$(this.root).css(s)};E.sec_to_dur=function(s){return util.date_ms_to_dur(s*1e3).replace(/^00:/,"")};E.show_element=function(el,show){el.css("display",show||show===undefined?"block":"none")};E.Popup=p(){}Popup.prototype.add_css_element=function(root,el,type){var conf=this.conf,key=type+"_css";if(conf[key])el.css(conf[key]);root.append(el)};Popup.prototype.set_bg_color=function(el,name){var color;if(color=this.conf[name])el.css({"background-color":color})};Popup.prototype.draw_label=function(root,next,_pr_class){var type,el,s;var create=E.create_el.bind(this,_pr_class);if(!(type=next.type))return;var label=create("div","label "+_pr_class+"label_"+type);if(type=="rank"){el=create("div","label_info").text("#"+next.rank);this.add_css_element(label,el,"plabel_info");this.set_bg_color(el,type+"_bgcolor")}this.add_css_element(root,label,"plabel");el=create("div","label_type");if(s=next.type_str?next.type_str:["hot","new","rank"].includes(type)?this._t(type):""){el.text(s)}this.add_css_element(label,el,"plabel_type");this.set_bg_color(el,type+"_bgcolor")};return E});
define("/svc/cdn/pub/feature/playlist/suggestion_btn.js",["cash","/svc/cdn/pub/feature/playlist/util.js","/svc/cdn/pub/dom_util.js"],function($,playlist_util,dom_util){var pr_class="hola_playlist_";var cancel_click_events=["mousedown","pointerdown","mouseup","pointerup"];var E=SuggestionButton;var stats;function SuggestionButton(playlist,opt){this.playlist=playlist;this.container=playlist_util.get_frame_container(playlist,opt);this.controls=playlist.controls;this.type="sugg_btn";this.conf=opt[this.type+"_conf"];this.opt=opt;this.inited=true;this.on_active=this.set_active.bind(this,true);this.on_inactive=this.set_active.bind(this,false);this.show()}SuggestionButton.prototype.update_pos=function(){var pos=playlist_util.get_container_pos(this.playlist);this.update(pos);this.update_pos_to=setTimeout(this.update_pos.bind(this),500);return pos};SuggestionButton.prototype.on_click=function(e){e.stopImmediatePropagation();e.preventDefault();if(stats)stats.inc("sugg_btn_click_n");this.controls.pause()};SuggestionButton.prototype.on_mouseve()};SuggestionButton.prototype.on_mouseleave=function(e){this.hovered=false;if(!this.controls.is_user_active())this.on_inactive()};SuggestionButton.prototype.bind_btn_events=function(type){var _this=this;["click","mouseenter","mouseleave"].forEach(function(e){var name="on_"+e+"_fn";if(!_this[name])_this[name]=_this["on_"+e].bind(_this);_this.button[type](e,_this[name])});playlist_util.cancel_event.call(this,this.button,type,cancel_click_events)};SuggestionButton.prototype.set_active=function(is_active){if(!is_active&&this.hovered)return;this.button[is_active?"addClass":"removeClass"](pr_class+"active")};SuggestionButton.prototype.bind_events=function(){this.uninit_fn=this.uninit.bind(this);this.playlist.on("detach",this.uninit_fn);this.playlist.on("frame_hide",this.uninit_fn);this.on_fullscreen_fn=playlist_util.on_fullscreen.bind(this);this.playlist.on("fullscreenchange",this.on_fullscreen_fn);this.bind_btn_events("on");this.controls.on("user_active",this.on_active);this.controls.on("user_inactive",this.on_inactive)};SuggestionButton.prototype.uninit=function(opt){if(!this.inited||opt&&opt.type!=this.type)return;this.playlist.off("detach",this.uninit_fn);this.playlist.off("frame_hide",this.uninit_fn);this.playlist.off("fullscreenchange",this.on_fullscreen_fn);this.bind_btn_events("off");this.controls.off("user_active",this.on_active);this.controls.off("user_inactive",this.on_inactive);this.hide(opt);this.inited=false};SuggestionButton.prototype.update=function(topt){if(!this.button)return;var size=this.conf.size||{},m=this.conf.margin;size=size.width||(topt.width<=900?64:96);dom_util.style_important(this.button[0],{position:"absolute",width:size+"px",height:size+"px",top:(topt.height-size)/2+"px",right:m.right+"px"});return size};SuggestionButton.prototype.render=function(topt){this.button=playlist_util.create_el(pr_class,"div","sugg_btn");this.update(topt);playlist_util.show_element(this.button);return this.button};SuggestionButton.prototype.show=function(){$(this.container).after(this.render(this.update_pos()));this.bind_events();this.set_active(this.controls.is_user_active())};SuggestionButton.prototype.hide=function(opt){if(this.button[0].parentNode)this.button.remove();this.button=undefined;if(this.update_pos_to)this.update_pos_to=clearTimeout(this.update_pos_to)};E.init=function(_stats){stats=_stats};return E});
define("/svc/cdn/pub/feature/playlist/side_btn.js",["cash","/util/events.js","/util/util.js","/svc/cdn/pub/feature/playlist/util.js","/svc/cdn/pub/dom_util.js"],function($,events,zutil,playlist_util,dom_util){var playlist;var assign=Object.assign;var pr_class="hola_playlist_";var cancel_click_events=["mousedown","pointerdown","mouseup","pointerup"];var wn_types={popup:"pnext",tile:"ptile",panel:"ppanels",slide:"pslide"};var E=SideButton;zutil.inherits(SideButton,events.EventEmitter);function SideButton(_playlist,opt){this.playlist=_playlist;this.container=playlist_util.get_frame_container(_playlist,opt);this.controls=_playlist.controls;this.conf=opt.sbutton_conf;this.session=playlist.session[_playlist.id]||{};this.pnext=this.playlist[wn_types[opt.on_pause]];this.max_len=opt.pinline_conf.cols*opt.pinline_conf.rows;var views=this.session.views,pl=this.pnext.playlist;this.unplayed=pl.filter(function(e){if(!views.find(function(ve){return ve.url_md5==e.url_md5}))return e});this.opt=opt;this.els={};this.type="sbutton";this.inited=true;this.on_active=this.set_active.bind(this,true);this.on_inactive=this.set_active.bind(this,false);this.show()}SideButton.prototype.update_pos=function(init){if(!this.root)return;var _this=this,pos=playlist_util.get_container_pos(this.playlist);$(this.root).css({width:pos.width+"px",height:pos.height+"px"});["left","right"].forEach(function(e){_this._update_side_btn(e,pos)});this.update_pos_to=setTimeout(this.update_pos.bind(this),500);return pos};SideButton.prototype.set_active=function(is_active){if(!is_active&&this.hovered)return;this.root[is_active?"addClass":"removeClass"](pr_class+"active")};SideButton.prototype.uninit=function(opt){if(!this.inited||opt&&opt.type!=this.type)return;this.playlist.off("detach",this.uninit_fn);this.playlist.off("frame_hide",this.uninit_fn);this.playlist.off("fullscreenchange",this.on_fullscreen_fn);this._bind_slide_click("off");this.controls.off("user_active",this.on_active);this.controls.off("user_inactive",this.on_inactive);this.hide(opt);this.inited=false};SideButton.prototype.show=function(){var _this=this,c=$(this.container);this.root=playlist_util.create_el(pr_class,"div","next_control");dom_util.style_important(this.root[0],{display:"block","pointer-events":"none","margin-left":c.css("margin-left"),position:"absolute"});this.root.css({top:0,left:0});var pos=this.update_pos(true);["left","right"].fopos)});c.after(this.root);this._bind_events();this.set_active(this.controls.is_user_active())};SideButton.prototype.hide=function(opt){if(this.root[0].parentNode)this.root.remove();this.root=undefined;if(this.update_pos_to)this.update_pos_to=clearTimeout(this.update_pos_to)};SideButton.prototype._bind_events=function(){this.uninit_fn=this.uninit.bind(this);this.playlist.on("detach",this.uninit_fn);this.playlist.on("frame_hide",this.uninit_fn);this.on_fullscreen_fn=playlist_util.on_fullscreen.bind(this);this.playlist.on("fullscreenchange",this.on_fullscreen_fn);this._bind_slide_click("on");this.controls.on("user_active",this.on_active);this.controls.on("user_inactive",this.on_inactive)};SideButton.prototype._bind_slide_click=function(type){var _this=this,els=this.els;["left","right"].forEach(function(side){var ev,el,name=side+"_side_btn";if(!(el=els[name]))return;var views=_this.session.views;_this[name]=_this[name]||function(e){e.stopImmediatePropagation();e.preventDefault();var curr=_this.session.curr;switch(side){case"right":if(curr==views.length-1){if(_this.unplayed.length){views.push(_this.unplayed[0]);curr++}}else curr++;break;case"left":if(curr)curr--;break}if(playlist){playlist.play_next(_this.playlist,{next:views[curr]},true,this.type,_this.opt._state,true)}};el[type]("click",_this[name]);ev=name+"_hover";_this[ev]=_thisve()};el[type]("mouseenter",_this[ev]);ev=name+"_unhover";_this[ev]=_this[ev]||function(e){_this.hovered=false;if(!_this.controls.is_user_active())_this.on_inactive()};el[type]("mouseleave",_this[ev]);playlist_util.cancel_event.call(this,el,type,cancel_click_events)})};SideButton.prototype._render_side_btn=function(side,topt){var el=playlist_util.create_el(pr_class,"div","side_btn "+pr_class+side+"_btn");this.els[side+"_side_btn"]=el;this._update_side_btn(side,topt);var curr=this.session.curr,views=this.session.views;playlist_util.show_element(el,side=="left"?curr:curr<views.length-1||curr<this.max_len&&this.unplayed.length);this.root.append(el)};SideButton.prototype._update_side_btn=function(side,topt){var el;if(!(el=this.els[side+"_side_btn"]))return;var size=this.conf.size||{},m=this.conf.margin;size=size.width||(topt.width<=900?64:96);dom_util.style_important(el[0],assign({position:"absolute",width:size+"px",height:size+"px",top:(topt.height-size)/2+"px"},side=="left"?{left:m.left+"px"}:{right:m.right+"px"}));return size};E.init=function(_playlist){playlist=_playlist};return E});
define("/svc/cdn/pub/feature/playlist/popup.js",["cash","/util/events.js","/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/feature/playlist/util.js","/svc/cdn/pub/widget.js"],function($,events,zutil,util,playlist_util,widget){var assign=Object.assign,pr_class="hola_playlist_";var playlist;var poster_ew=1.182,ms_sec=1e3;var E={};zutil.inherits(NextPopup,events.EventEmitter);function NextPopup(ctx,div,opt){this.ctx=ctx;this.pnext=ctx.pnext;this.type="pnext";this.opt=opt;this.conf=opt.pnext_conf;this.div=$(div);this.img=widget.create_img(pr_class+"poster_img");if(this.pnext.next)this.render();this.inited=true}NextPopup.prototype.render=function(){playlist.log.debug("next popup render");var opt=this.opt,create=playlist_util.create_el.bind(this,pr_class);var overlay=create("div","overlay"),main=create("div","main");var els=this.els={},css=this.opt.css||{},arr=["poster"];if(!opt.is_min_size)arr=arr.concat(["description","sec_timer"]);else this.div.addClass(pr_class+"min_size");arr.forEach(function(cl){main.append(els[cl]=create("div",cl))});this.div.addClass("hola_next_suggestion "+pr_class+"wrapper "+pr_class+"x_animation "+pr_class+"active").append(overlay);if(util.is_mobile)this.div.addClass("mobile");playlist_util.show_element(this.div);var next=this.pnext.next;if(next.poster){if(!(util.is_ie||util.is_edge&&util.browser.version<16))els.poster.addClass("def_width");var img=this.img.create(next.poster,next);if(!opt.is_min_size)img.attr("data-hola-playlist-ew",poster_ew);els.poster.append(img)}if(next.description&&els.description)els.description.text(next.description);widget.set_preview_url(main,next,opt);if(css.background_color)overlay.css({"background-color":css.background_color});var sec_timer=els.sec_timer;if(css.font_size){this.div.css({"font-size":css.font_size+"px"});if(sec_timer)sec_timer.css({"font-size":css.font_size-1+"px"})}this.t_hidden=sec_timer&&sec_timer.css("display")=="none";els.close=$("<a>").addClass(pr_class+"close skip-preview").attr("href","#");els.main=main;this.div.append(main).append(els.close);if(this.ctx.emit)this.ctx.emit("widget_ready");this.bind_events();playlist.delayed_scan();playlist.popup_inc("show",this.opt._state)};NextPopup.prototype.sec_left=function(opt){var sec_timer,left=Math.ceil(opt.left);if(!(sec_timer=this.els.sec_timer))return;if(left<=playlist.conf.sec_before_end){sec_timer.html(playlist._t("text",{left:left}));if(this.t_hidden)this.t_hidden=!!playlist_util.show_element(sec_timer)}else if(!this.t_hidden)this.t_hidden=!playlist_util.show_element(sec_timer,false)};NextPopup.prototype.play_next=function(is_click){if(this.play_t)this.play_t=clearTimeout(this.play_t);if(this.ctx.is_ad_active&&this.ctx.is_ad_active()){this.play_t=setTimeout(this.play_next.bind(this,is_click),500);return}var opt=this.opt;if(opt.no_switch&&!is_click)return playlist.log.info("not switching due to conf");if(this.hidden&&!opt.force_switch)return playlist.log.debug("not switching due to closed popup");playlist.play_next(this.ctx,this.pnext,is_click,this.type,opt._state,this.ctx.is_inline());this.uninit()};NextPopup.prototype.close=function(){playlist.popup_inc("close",this.opt._state);if(this.ctx.emit)this.ctx.emit("close_popup",{type:this.type});this.uninit()};NextPopup.prototype.bind_events=function(){var _this=this;var one=function(target,event,cb){var fn=function(e){e.preventDefault();e.stopPropagation();cb();target.off(event,fn)};target.on(event,fn);return fn};this.on_close_fn=one(this.els.close,"click",this.close.bind(this));this.on_main_fn=one(this.els.main,"click",function(){_this.play_next(true)});if(!this.ctx.on)return;this.sec_left_fn=this.sec_left.bind(this);this.play_next_fn=this.play_next.bind(this);this.uninit_fn=this.uninit.bind(this);this.ctx.on("sec_left",this.sec_left_fn);this.ctx.on("video_finished",this.play_next_fn);this.ctx.on("widget_hide",this.uninit_fn)};NextPopup.prototype.uninit=function(opt){if(!this.inited||opt&&opt.type!=this.type)return;playlist.log.debug("next popup uninit");if(this.sec_left_fn)this.ctx.off("sec_left",this.sec_left_fn);if(this.play_next_fn)this.ctx.off("video_finished",this.play_next_fn);if(this.uninit_fn)this.ctx.off("widget_hide",this.uninit_fn);this.img.uninit();this.els.close.off("click",this.on_close_fn);this.els.main.off("click",this.on_main_fn);this.div.removeClass(pr_class+"active");this.inited=false};zutil.inherits(NextPopupFrame,events.EventEmitter);function NextPopupFrame(_playlist,opt){this.playlist=_playlist;this.hidden=false;this.pnext=_playlist.pnext;this.conf=opt.pnext_conf;this.size=playlist_util.get_popup_size(playlist_util.get_container_pos(this.playlist),opt);opt.is_min_size=this.size==this.conf.size.min;this.type="pnext";this.container=playlist_util.get_frame_container(_playlist,opt);this.vtline=$(_playlist.container).find(".hola_visual_timeline_holder");this.opt=opt;this.show();this.inited=true}NextPopupFrame.prototype.get_container=function(){return this.main};NextPopupFrame.prototype.update_pos=function(){if(this.hidden||!this.root)return;this.update_pos_to=setTimeout(this.update_pos.bind(this),500);if(this.on_main)return;var bmargin,opt=this.opt;var pos=playlist_util.get_container_pos(this.playlist);var conf=this.conf;if(!conf.dis_autopos){var cbar=this.playlist.get_control_bar();bmargin=conf.margin.bottom+(cbar&&playlist_util.is_visible(cbar)&&cbar.height())+(playlist_util.is_visible(this.vtline)&&this.vtline.height())}else bmargin=this.opt.margin_bottom;var add_widget_to_body=typeof opt.add_widget_to_body=="function"?opt.add_widget_to_body({E:E,_this:this,$:$,util:util}):opt.add_widget_to_body;var s=add_widget_to_body?{top:pos.top,left:pos.left}:{top:0,left:0};this.root.css({top:s.top+pos.height-bmargin-this.size.height+"px",left:s.left+pos.width-this.size.width-conf.margin.right+"px"})};NextPopupFrame.prototype.close=function(){this.hidden=true;this.root.css("display","none")};NextPopupFrame.prototype.bind_events=function(){this.uninit_fn=this.uninit.bind(this);this.close_fn=this.close.bind(this);this.on_fullscreen_fn=playlist_util.on_fullscreen.bind(this);this.playlist.on("detach",this.uninit_fn);this.playlist.on("close_popup",this.close_fn);this.playlist.on("frame_hide",this.uninit_fn);this.playlist.on("fullscreenchange",this.on_fullscreen_fn)};NextPopupFrame.prototype.uninit=function(opt){if(!this.inited||opt&&opt.type!=this.type)return;playlist.log.debug("popup frame uninit");this.playlist.off("detach",this.uninit_fn);this.playlist.off("close_popup",this.close_fn);this.playlist.off("frame_hide",this.uninit_fn);this.playlist.off("fullscreenchange",this.on_fullscreen_fn);if(this.opt.delay_hide)setTimeout(this.hide.bind(this),this.opt.delay_hide*ms_sec);else this.hide();this.inited=false};NextPopupFrame.prototype.show=function(){var size=this.size,opt=this.opt,c=$(this.container)[0];var s={height:size.height+"px",width:size.width+"px"};this.root=$("<div>").addClass("hola_playlist hola_top_element").css(assign({height:s.height,width:s.width,display:"block","pointer-events":"all","font-size":size.font_size},this.conf.root_css));this.main=$("<div>").addClass(pr_class+"wrapper");this.update_pos();this.bind_events();if(opt._state!="preload"){this.hover_fn=function(){this.on_main=true}.bind(this);this.unhovalse}.bind(this);this.main.on("mouseenter",this.hover_fn);this.main.on("mouseleave",this.unhover_fn);this.root.append(this.main);var add_widget_to_body=typeof opt.add_widget_to_body=="function"?opt.add_widget_to_body({E:E,_this:this,$:$,util:util}):opt.add_widget_to_body;if(add_widget_to_body)document.body.appendChild(this.root.get(0));else $(c).after(this.root);this.on_fullscreen_fn();this.playlist.set_show_time(this.type)}};NextPopupFrame.prototype.hide=function(opt){if(opt&&opt.type!=this.type)return;this.playlist.emit("widget_hide",{type:this.type});if(this.hover_fn)this.main.off("mouseenter",this.hover_fn);if(this.unhover_fn)this.main.off("mouseleave",this.unhover_fn);var ve()}.bind(this);if(opt&&opt.force)clear();else setTimeout(clear,ms_sec);if(this.update_pos_to)this.update_pos_to=clearTimeout(this.update_pos_to)};E.init=function(_playlist){playlist=_playlist};E.NextPopup=NextPopup;E.NextPopupFrame=NextPopupFrame;return E});
define("/svc/cdn/pub/feature/playlist/slide.js",["cash","/svc/cdn/pub/util.js","/svc/cdn/pub/feature/playlist/util.js","/svc/cdn/pub/widget.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/feature/preview/index.js","/svc/cdn/pub/feature/playlist/promo.js"],function($,util,playlist_util,widget,dom_util,preview,playlist_promo){var assign=Object.assign,pr_class="hola_playlist_";var selected_tile=pr_class+"selected_tile";var ms_sec=1e3;var playlist;var E=SlidePopup;util.inherits(SlidePopup,playlist_util.Popup);function SlidePopup(ctx,div,opt){var live_tile_on=/spark_live_playlist=1/.test(document.referrer);var p0=ctx.pslide&&ctx.pslide.playlist&&ctx.pslide.playlist[0];if(live_tile_on&&p0){var nurl="https://www.foxnews.com/video/5614615980001#sp=watch-live";p0=Object.assign({},p0,{orig_url:nurl,page_url:nurl,page_key:nurl});if(p0.media_info)p0.media_info=Object.assign({},p0.media_info,{page_url:nurl});p0.live_tile="https://247preview.foxnews.com/hls/live/2020027/"+"fncv3preview/index.m3u8";p0.poster="https://media2.foxnews.com/BrightCove/694940094001/"+"2018/03/19/694940094001_5754212826001_5614615980001-vs.jpg";ctx.pslide.playlist[0]=p0}this.ctx=ctx;this.pslide=this.ctx.pslide;this.opt=opt;this.div=$(div);this.type="pslide";this.tiles=[];this.icons=playlist.icons_handler(ctx,this.type,opt);this.img=widget.create_img(pr_class+"poster_img");this.prev_idx=this.idx=0;this.is_preview_enabled=playlist.spark.is_feature_inited("video_previews")&&util.is_mobile;this.touches={};this.size=this._get_size();this.conf=playlist_util.get_widget_conf(opt.pslide_conf,this.size);if(this.size.video_height<this.conf.min_height)return void this.ctx.emit("frame_hide",{type:"pslide"});this._render();this.info_popup=playlist.create_info_popup(ctx,this.div);this.inited=true}SlidePopup.prototype.on_cancel_autock()};SlidePopup.prototype.uninit=function(opt){if(!this.inited||opt&&opt.type!=this.type)return;playlist.log.debug("slide popup uninit");if(this.uninit_fn)this.ctx.off("widget_hide",this.uninit_fn);if(this.info_popup)this.info_popup=this.info_popup.uninit();var _this=this,main=this.els.hola_playlist_main;["touchstart","touchmove","touchend"].forEach(function(t){main.off(t,this.on_touch_fn)}.bind(this));if(this.on_main_fn)main.off("click",this.on_main_fn);this._bind_slide_click("off");this._uninit_autoslide();this.icons.uninit();this.tiles.forEach(function(e){if(!e)return;if(_this.on_link_click){["click","auxclick","contextmenu"].foick)})}if(e.wait_fn){e.wait_fn();if(e.move_fn)e.off("mousemove",e.move_fn);e.off("mouseenter",e.hover_fn);e.off("touchstart",e.hover_fn);e.off("mouseleave",e.unhover_fn)}});this.img.uninit();this.div.removeClass("hola_playlist hola_top_element");this.div.empty();this.div=this.els=undefined;if(this.promo){this.promo.destroy();this.promo=null}this.inited=false};SlidePopup.prototype.update=function(){if(!this.div)return;var size=this._get_size();if(this.size.width!=size.width||this.size.height!=size.height){this.size=size;this._it_tiles(this.idx,size,this._update_tile,this.offset)}setTimeout(this.update.bind(this),500)};SlidePopup.prototype._add_hover=function(prev,cur){if(!util.is_mobile)return playlist.add_hover.call(this,cur);var anim=this.conf.hover_anim_time*ms_sec;if(prev.rm_hover)prev.rm_hover=clearTimeout(prev.rm_hover);prev.removeClass(pr_class+"tile_hover");var on_hover=function(){if(cur.poster&&cur.poster.hasClass("hola_preview_playing"))return void cur.addClass(pr_class+"tile_hover");cur.rm_hover=setTimeout(on_hover,anim)};cur.rm_hover=setTimeout(on_hover,anim)};SlidePopup.prototype._autoslide=function(){var opt=this.opt.pslide_conf.autoslide;if(!opt||!opt.enable)return;this._stop_autoslide();this.autoslide_t=setTimeout(this._slide.bind(this,opt.direction),opt.interval*ms_sec)};SlidePopup.prototype._bind_events=function(){var main=this.els.hola_playlist_main;this.on_touch_fn=this._on_touch.bind(this);["touchstart","touchmove","touchend"].fo_fn)}.bind(this));this._bind_slide_click("on");if(this.is_preview_enabled)preview.init_autoplay({autoplay_el:selected_tile});this.on_main_fn=function(e){if(this.info_popup&&this.info_popup.popped)return this.ctx.emit("info_hide",e);var tile;if(!(tile=this._get_tile(e)))return void this.ctx.controls.play();if(!playlist_util.is_ctrl_click(e))this._play_tile(tile)}.bind(this);main.on("click",this.on_main_fn);if(!this.ctx.on)return;this.uninit_fn=this.uninit.bind(this);this.ctx.on("widget_hide",this.uninit_fn)};SlidePopup.prototype._bind_slide_click=function(type){var _this=this,els=this.els;["left","right"].forEach(function(side){var el,name=side+"_side_btn";if(!(el=els[name]))return;_this[name]=_this[nide)};el[type]("click",_this[name]);playlist_util.cancel_event.call(this,el,type)})};SlidePopup.prototype._get_size=function(){var v=playlist_util.get_video(this.ctx);var size={width:this.div.width(),height:this.div.height()};size.video_height=v.length?v.height():size.height;if(dom_util.is_fullscreen()&&(v=v[0])){var r=v.videoWidth?v.videoHeight/v.videoWidth:.75;size.video_height=Math.round(r*size.width)}size.video_height=size.video_height||size.height;return size};SlidePopup.prototype._get_tile=function(e){var tile=$(e.target);if(!tile.hasClass(pr_class+"tile"))tile=tile.parents("."+pr_class+"tile");return tile.length?tile:undefined};SlidePopup.prototype._init_autoslide=function(){if(!util.get(this.opt,"pslide_conf.autoslide.enable"))return;this.div.on("mouseenter",this.on_mouseenter=this._stop_autoslide.bind(this));this.div.on("mouseleave",this.on_mouseleave=this._autoslide.bind(this));this._autoslide()};SlidePopup.prototype._it_tiles=function(idx,size,cb,offset){var i,j,pos,pl=this.pslide.playlist,len=pl.length;var conf=this.conf;var k=conf.tile_size_coef||.666;var btn_size,_this=this,anim,hlen=Math.floor(len/2);var ts={height:Math.round(size.video_height*k),width:Math.round(size.width*k)};if(conf.tile_ratio){if(ts.height/ts.width>1)ts.height=ts.width*conf.tile_ratio|0;else ts.width=Math.min(ts.height/conf.tile_ratio|0,ts.width)}var left=Math.round((size.width-ts.width)/2+(offset||0));var changed=this.prev_idx!=idx||!this.tiles.length;ts.top=Math.round((size.height-ts.height)/2);var lborder;if(typeof conf.lborder=="number")lborder=conf.lborder;else lborder=ts.top/ts.width<.1?ts.top:.05*ts.width;if(changed||!offset)anim=true;if(!util.is_mobile){btn_size=assign({},ts,{width:32});["left","right"].foize)})}if(conf.dis_autopos||conf.add_floating_play_button){btn_size=Math.min(Math.round(size.height-ts.top-ts.height),48);btn_size={top:ts.top+ts.height,left:Math.round(lborder/2),width:btn_size,height:btn_size};cb.call(this,"play_btn",btn_size)}cb.call(this,idx,assign({},ts,{left:left,anim:anim,sel:true}));if(changed){this._add_hover(this.tiles[this.prev_idx],this.tiles[idx]);if(this.is_preview_enabled)setTimeout(function(){preview.emit("start_preview")},ms_sec);this.prev_idx=idx}for(j=1,i=idx+1;i<=idx+hlen;i++,j++){pos=i>=len?i-len:i;cb.call(this,pos,assign(ts,{left:left+j*(ts.width+lborder),anim:anim&&j==1}))}for(j=hlen,i=idx-hlen;i<idx;i++,j--){pos=i<0?len+i:i;cb.call(this,pos,assign(ts,{left:left-j*(ts.width+lborder),anim:anim&&j==1}))}};SlidePopup.prototype._on_touch=function(e){var t,o,sx,sy,start,move,touches=this.touches;if(!e||!(t=e.touches))return;var tile=this._get_tile(e),skip=!tile;var gy:0}};t=t[0];switch(e.type){case"touchstart":touches=this.touches={};touches[e.type]=get_xy(t);break;case"touchmove":touches[e.type]=get_xy(t);if(!skip){start=touches.touchstart||get_xy();o=t.pageX-start.x;sx=Math.abs(o);sy=Math.abs(t.pageY-start.y);if(sy>sx)break;this.offset=o;this._it_tiles(this.idx,this.size,this._update_tile,this.offset);if(e.cancelable)e.preventDefault()}break;case"touchend":start=touches.touchstart||get_xy();move=touches.touchmove||get_xy();o=start.x-move.x;sx=Math.abs(o);sy=Math.abs(start.y-move.y);this.touches={};if(sx>=5&&touches.touchmove!==undefined){if(!skip){if(Math.abs(o)<15||sy>sx){this.offset=0;this._it_tiles(this.idx,this.size,this._update_tile,this.offset)}else this._slide(Math.sign(o)>0?"right":"left");if(e.cancelable)e.preventDefault()}}else if(sy<sx||touches.touchmove===undefined){if(skip)this.ctx.controls.play();else this._play_tile(tile);if(e.cancelable)e.preventDefault()}break}};SlidePopup.prototype._play_tile=function(tile){var idx=+tile.attr("pl_idx");if(this.ctx.ab_test)this.ctx.ab_test.send_click(idx,this.pslide.playlist[idx-1]);playlist.play_next(this.ctx,{next:this.pslide.playlist[idx]},true,this.type,this.opt._state)};SlidePopup.prototype._render=function(){playlist.log.debug("slide popup render");var _this=this,els=this.els={};[pr_class+"overlay",pr_class+"main"].forEach(function(cl){_this.div.append(els[cl]=$("<div>").addClass(cl))});this.div.addClass("hola_playlist "+pr_class+"slide hola_top_element");if(this.conf.autoclick_tile!==undefined)this.pslide.next=this.pslide.playlist[this.conf.autoclick_tile];this._it_tiles(this.idx,this.size,this._render_tile);this.update();playlist.add_powered_by_btn(this.div);playlist_util.show_element(this.div);this._init_autoslide();this._bind_events();playlist.delayed_scan();playlist.popup_inc("show",this.opt._state,"slide")};SlidePopup.prototype._render_play_btn=function(idx,topt){var el=playlist_util.create_el(pr_class,"div",idx);this.els[idx]=el;this.play_icon=this.icons.add_icon(el,topt,{size_px:topt.height});this._update_play_btn(idx,topt);this.els.hola_playlist_main.append(el)};SlidePopup.prototype._render_side_btn=function(side,topt){var el=playlist_util.create_el(pr_class,"div","side_btn");this.els[side+"_side_btn"]=el;this._update_side_btn(side,topt);var svg_ns="http://www.w3.org/2000/svg";var svg=document.createElementNS(svg_ns,"svg");svg.setAttributeNS(null,"viewBox","0 0 "+topt.width+" "+topt.width);svg.setAttributeNS(null,"width","100%");svg.setAttributeNS(null,"height","100%");var path={right:"m 12.59,20.34 4.58,-4.59 -4.58,-4.59 1.41,-1.41 6,6 -6,6 z",left:"M 19.41,20.09 14.83,15.5 19.41,10.91 18,9.5 l -6,6 6,6 z"};var p=document.createElementNS(svg_ns,"path");p.setAttributeNS(null,"d",path[side]);p.setAttributeNS(null,"fill","#fff");svg.appendChild(p);this.els.hola_playlist_main.append(el.append($(svg)))};SlidePopup.prototype._render_tile=function(idx,topt){if(idx=="left"||idx=="right")return this._render_side_btn(idx,topt);if(idx=="play_btn")return this._render_play_btn(idx,topt);var opt=this.opt,create=playlist_util.create_el.bind(this,pr_class);var info=create("span","pinfo"),next=this.pslide.playlist[idx];var tile=playlist_util.create_tile.call(this,next,playlist.stats_inc);if(this.is_preview_enabled)tile.addClass(pr_class+"stile");this.tiles[idx]=tile.attr("pl_idx",idx);this._update_tile(idx,topt);if(next.type=="promo"&&util.is_enabled(playlist_promo)){this.els.hola_playlist_main.append(tile);this.promo=playlist_promo.create(tile[0],next.promo);return}var live_tile=next.live_tile;if(live_tile){opt.autoclick={};widget.set_preview_url(tile,next,opt);tile.attr("data-spark_preview_video_url",live_tile);tile.attr("spark_ve_preview_live",1);tile.attr("data-spark_ve_preview_live",1);tile.attr("data-spark_keep_playing",1)}else widget.set_preview_url(tile,next,opt);if(next.poster){tile.img=this.img.create(next.poster,next);tile.poster=create("div","poster").append(tile.img);tile.append(tile.poster)}var el,bel=create("div","bottom"),conf=this.conf;if(next.dur||next.total){el=$("<div>");if(!conf.hide_duration&&next.dur){el.append(create("span","duration").text(playlist_util.sec_to_dur(next.dur)))}if(!conf.hide_views&&next.total){el.append(create("span","views").text(playlist.views_to_text(next.total)))}this.add_css_element(bel,el,"pdur")}if(!live_tile&&next.description){el=create("div","description").text(next.description);this.add_css_element(bel,el,"pdesc")}if(opt.show_category&&next.category){var category=create("div","category");category.css("display","none");category.attr("category",next.category);category.text(next.category);info.append(category)}if(!conf.hide_label)this.draw_label(info,next,pr_class);this.add_css_element(info,bel,"pbottom");playlist.add_dbg_info(info,next,conf);tile.append(tile.info=info);if(typeof conf.customize_tile_fn=="function"){try{conf.customize_tile_fn($,tile,next,opt,conf)}catch(e){return void playlist.log.err("invalid customize_tile_fn function: "+(e&&e.toString())||"JS Error")}}this.els.hola_playlist_main.append(tile);this._update_tile(idx,topt)};SlidePopup.prototype._slide=function(dir){var len=this.tiles.length;this.idx=(this.idx+(dir=="left"?-1:1))%len;this.idx=this.idx<0?this.idx+len:this.idx;this.offset=0;this._it_tiles(this.idx,this.size,this._update_tile);this._autoslide()};SlidePopup.prototype._stop_autoe_t)};SlidePopup.prototype._t=function(str){return playlist._t(str)};SlidePopup.prototype._uninit_autoslide=function(){this._stop_autoslide();if(this.on_mouseenter)this.div.off("mouseenter",this.on_mouseenter);if(this.on_mouseleave)this.div.off("mouseleave",this.on_mouseleave)};SlidePopup.prototype._update_play_btn=function(idx,topt){if(!this.play_icon)return;var play_btn_style={position:"absolute",width:topt.width+"px",height:topt.height+"px",top:topt.top+"px",left:topt.left+"px"};if(this.conf.play_btn_style)assign(play_btn_style,this.conf.play_btn_style);if(this.conf.fix_btn_style){this.conf.fix_btn_style(play_btn_style,{E:E,_this:this,idx:idx,topt:topt})}dom_util.style_important(this.play_icon.container[0],play_btn_style);var pos=util.pick(topt,"width","height");this.play_icon.update_pos({pos:pos,img_pos:pos,size_px:pos.height})};SlidePopup.prototype._update_side_btn=function(side,topt){var el;if(!(el=this.els[side+"_side_btn"]))return;dom_util.style_important(el[0],assign({position:"absolute",width:topt.width+"px",height:topt.height+"px",top:topt.top+"px"},side=="left"?{left:0}:{right:0}))};SlidePopup.prototype._update_tile=function(idx,topt){if(idx=="left"||idx=="right")return this._update_side_btn(idx,topt);if(idx=="play_btn")return this._update_play_btn(idx,topt);var cl={add:[],remove:[]},tile;if(!(tile=this.tiles[idx]))return;dom_util.style_important(tile[0],{position:"absolute",top:topt.top+"px",left:topt.left+"px",height:topt.height+"px",width:topt.width+"px"});cl[topt.sel?"add":"remove"].push("selected_tile");cl[topt.anim?"add":"remove"].push("anim_tile");for(var s in cl)cl[s].forEach(function(e){tile[s+"Class"](pr_class+e)});if(topt.sel){if(this.icon)this.icon=this.icons.rm_icon(this.icon);if(!this.autoclick_cancelled){this.icon=playlist.add_autoclick(this.icons,{pl_idx:idx,container:tile,size:topt,playlist:this.pslide.playlist,on_cancel_autoclick:this.on_cancel_autoclick.bind(this)},this.ctx,this.conf,this.opt)}}var icon=tile.find("."+pr_class+"icon");if(icon.length){var w=icon.height();icon.css({top:(topt.height-w)/2+"px",left:(topt.width-w)/2+"px"})}};Elist};return E});
define("/svc/cdn/pub/feature/playlist/tile.js",["cash","/svc/cdn/pub/util.js","/util/events.js","/svc/cdn/pub/feature/playlist/util.js","/svc/cdn/pub/dom_util.js"],function($,util,events,playlist_util,dom_util){var playlist,assign=Object.assign;var E=TilePopupFrame;util.inherits(TilePopupFrame,events.EventEmitter);function TilePopupFrame(_playlist,opt,type){this.playlist=_playlist;this.conf=opt[type+"_conf"];this.opt=opt;this.type=type;this.cbar_cl={};this.container=playlist_util.get_frame_container(_playlist,opt);if(opt.get_frame_container){this.container=opt.get_frame_container({E:E,_this:this,$:$,util:util})}this.show();this.inited=true}TilePopupFrame.prototype.get_controot};TilePopupFrame.prototype.set_cbar_class=function(is_active){var c=$(this.container);var fn=is_active?c.removeClass:c.addClass;for(var cl in this.cbar_cl)fn.call(c,cl)};TilePopupFrame.prototype.set_cbar_active=function(){var active,_this=this,c=this.container;if((active=this.playlist.master)&&active.userActive){if($(c).hasClass("vjs-ended"))this.cbar_cl["vjs-ended"]=1;if($(c).hasClass("vjs-controls-disabled"))this.cbar_cl["vjs-controls-disabled"]=1;this.set_cbar_class(true);active.userActive(true)}else if(active=this.opt.player&&this.opt.player.set_cbar_active){active=active($,c,this.opt);if(active&&!this.active_unwatch){this.active_unwatch=dom_util.attr_watch($(active.el)[0],{attr:active.attr||"class",toggle_pattern:active.cl||active.pattern,watch_fn:function(){if(!active.cl||!$(active.el).hasClass(active.cl))_this.set_cbar_active()}})}}};TilePopupFrame.prototype.update_pos=function(){if(!this.root)return;var m=this.conf.margin,is_fs=dom_util.is_fullscreen();var pos=playlist_util.get_container_pos(this.playlist,undefined,is_fs);pos.width-=m.left+m.right;pos.height-=m.top+m.bottom;if(!this.conf.dis_autopos){this.set_cbar_active();pos.height-=this.playlist.get_bottom_offset()}var imp={width:pos.width+"px",height:pos.height+"px"};if(this.add_offset){imp.top=pos.top+m.top+"px";imp.left=pos.left+m.left+"px"}else if(this.conf.use_video_pos&&!is_fs){var vpos=playlist_util.get_container_pos(this.playlist,true);imp.width=vpos.width+"px";imp.left=vpos.left+m.left+"px"}$(this.root).css(imp);this.update_pos_to=setTimeout(this.update_pos.bind(this),500)};TilePopupFrame.prototype.bind_events=function(){this.uninit_fn=this.uninit.bind(this);this.on_fullscreen_fn=playlist_util.on_fullscreen.bind(this);this.playlist.on("detach",this.uninit_fn);this.playlist.on("frame_hide",this.uninit_fn);this.playlist.on("fullscreenchange",this.on_fullscreen_fn)};TilePopupFrame.prototype.uninit=function(opt){if(!this.inited||opt&&opt.type!=this.type)return;playlist.log.debug("tile popup frame uninit");this.playlist.off("detach",this.uninit_fn);this.playlist.off("frame_hide",this.uninit_fn);this.playlist.off("fullscreenchange",this.on_fullscreen_fn);if(this.active_unwatch)this.active_unwatch();this.hide();this.inited=false};TilePopupFrame.prototype.show=function(){this.root=$("<div>");var position="absolute";var opt=this.opt;if(opt.set_position){position=opt.set_position({E:E,_this:this,$:$,util:util,dom_util:dom_util})}dom_util.style_important(this.root[0],assign({display:"block","pointer-events":"all",position:position,"background-color":"#000"},this.conf.root_css));var c;this.bind_events();if(opt._state=="preload")this.update_pos();else if(c=$(this.container)[0]){var add_widget_to_body=typeof opt.add_widget_to_body=="function"?opt.add_widget_to_body({E:E,_this:this,$:$,util:util}):opt.add_widget_to_body;if(add_widget_to_body){this.add_offset=1;this.update_pos();document.body.appendChild(this.root.get(0))}else{var s={top:0,left:0};if(opt.add_offset||opt.add_top_offset){var p=$(c).position();s.top=p.top+"px";if(opt.add_offset)s.left=p.left+"px"}this.root.css(s);this.update_pos();$(c).after(this.root)}this.on_fullscreen_fn();if(opt.fix_popup_frame)opt.fix_popup_frame({$:$,E:E,_this:this,util:util});this.playlist.set_show_time(this.type)}};TilePopupFrame.prototype.hide=function(opt){if(opt&&opt.type!=this.type)return;if(!this.conf.dis_autopos)this.set_cbar_class();this.playlist.emit("widget_hide",{type:this.type});this.root.remove();if(this.update_pos_to)this.update_pos_to=clearTimeout(this.update_pos_to)};E.init=function(_playlist){playlist=_playlist};return E});
define("/svc/cdn/pub/feature/playlist/panels.js",["cash","/svc/cdn/pub/util.js","/svc/cdn/pub/feature/playlist/util.js","/svc/cdn/pub/widget.js","/svc/cdn/pub/feature/playlist/editor.js","/svc/cdn/pub/feature/playlist/promo.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/feature/preview/index.js"],function($,util,playlist_util,widget,playlist_editor,playlist_promo,dom_util,preview){var assign=Object.assign;var pr_class="hola_playlist_",selected_tile=pr_class+"selected_tile";var playlist;var cancel_click_events=["mousedown","pointerdown","mouseup","pointerup"];var pr_countdown="hola_preview_navigate_on_hover_enabled";var ms_sec=1e3;var E={};util.inherits(PanelsPopup,playlist_util.Popup);function PanelsPopup(ctx,div,opt){var live_tile_on=/spark_live_playlist=1/.test(document.referrer);var p0=ctx.ppanels&&ctx.ppanels.playlist&&ctx.ppanels.playlist[0];if(live_tile_on&&p0){var nurl="https://www.foxnews.com/video/5614615980001#sp=watch-live";p0=Object.assign({},p0,{orig_url:nurl,page_url:nurl,page_key:nurl});if(p0.media_info)p0.media_info=Object.assign({},p0.media_info,{page_url:nurl});p0.live_tile="https://247preview.foxnews.com/hls/live/2020027/"+"fncv3preview/index.m3u8";p0.poster="https://media2.foxnews.com/BrightCove/694940094001/"+"2018/03/19/694940094001_5754212826001_5614615980001-vs.jpg";ctx.ppanels.playlist[0]=p0}this.ctx=ctx;this.ppanels=this.ctx.ppanels;this.vsize=this.ctx.vsize;this.opt=opt;this.div=$(div);this.type="ppanels";this.icons=playlist.icons_handler(ctx,this.type,opt);this.tiles=[];this.elements=[];this.restore=[];if(this.ctx.__panels_ui){this.ctx.__panels_ui._clear();dom_util.force_redraw(this.div)}this.ctx.__panels_ui=this;this.is_preview_enabled=playlist.spark.is_feature_inited("video_previews")&&util.is_mobile;if(playlist.edit_box_enabled()){this.edit_box=new playlist_editor(this.type,playlist.spark.customer,playlist.spark.spark_zone.name)}this.size={width:this.div.width(),height:this.div.height()};this.conf=playlist_util.get_widget_conf(opt.ppanels_conf,this.size);this.img=widget.create_img(pr_class+"poster_img");this.render();this.info_popup=playlist.create_info_popup(ctx,this.div);this.inited=true}PanelsPopup.prototype._clear=function(){var instance=this.ctx.__panels_ui;if(!instance)return;if(instance._clear_timeout)instance._clear_timeout=void clearTimeout(instance._clear_timeout);instance.video.removeClass(pr_class+"video");delete instance.video[0].pl_orig_style;instance.html5.removeClass(pr_class+"blur");if(instance.opt.html5_css){instance.html5.attr("style",instance.html5[0].pl_orig_style||"");delete instance.html5[0].pl_orig_style}instance.send_resize();if(instance._state_timeout){clearTimeout(instance._state_timeout);delete instance._state_timeout;instance._set_player_animation(false)}delete instance.ctx.__panels_ui};PanelsPopup.prototype.it_tiles=function(size,tile_cb,bg_cb){var i,col=3,row=3,k=.666,conf=this.conf,vs=this.vsize;var top,lborder=conf.lborder,tborder=conf.tborder;var vw=Math.round(vs.width*k),vh=Math.round(vs.height*k);var side={width:Math.round(size.width-vw-lborder),height:Math.round((size.height-(row-1)*tborder)/row)};var bottom={width:Math.round((vw-lborder)/2),height:side.height};tile_cb.apply(this,[0,{top:0,height:vh,width:vw,left:0}]);for(i=0;i<row;i++){top=i*(side.height+tborder);tile_cb.apply(this,[i+1,{top:top,height:side.height,width:side.width,left:lborder+vw}])}for(i=0;i<col-1;i++){tile_cb.apply(this,[1-i+1+row,{top:top,height:bottom.height,width:bottom.width,left:i*(bottom.width+lborder)}])}if(bg_cb){bg_cb.apply(this,[0,{top:0,height:size.height,left:vw,width:size.width-vw}]);bg_cb.apply(this,[1,{top:top-tborder,left:0,width:size.width,height:bottom.height+tborder}])}};PanelsPopup.prototype.update=function(){if(!this.div)return;var size={width:this.div.width(),height:this.div.height()};if(this.size.width!=size.width||this.size.height!=size.heigth){this.size=size;this.it_tiles(this.size,this._update_tile)}setTimeout(this.update.bind(this),500)};PanelsPopup.prototype.update_vtile=function(idx,size){dom_util.style_important(this.video_tile[0],{position:"absolute",top:size.top+"px",left:size.left+"px",height:size.height+"px",width:size.width+"px"})};PanelsPopup.prototype._update_tile=function(idx,size){var icon,tile;if(!idx)this.update_vtile(idx,size);else if(tile=this.tiles[idx]){dom_util.style_important(tile[0],{position:"absolute",top:size.top+"px",left:size.left+"px",height:size.height+"px",width:size.width+"px"});if((icon=tile.find("."+pr_class+"icon"))&&icon.length){var w=icon.height();icon.css({top:(size.height-w)/2+"px",left:(size.width-w)/2+"px"})}}};PanelsPopup.prototype.render_controls=function(size){if(!this.opt.resize_video)return;var el,c=$(this.ctx.container);if((el=c.find(".vjs-big-play-button"))&&el.length||(el=c.find(".big-play-btn"))&&el.length){el.addClass(pr_class+"play_button");this.restore.push({el:el,cl:pr_class+"play_button",style:el.attr("style")});el.css({left:size.width/2+"px",top:size.height/2+"px"})}};PanelsPopup.prototype.send_resize=function(){if(!this.conf.disable_resize&&this.is_cbar_found()&&(this.ctx.controls||{}).name=="ooyala"){window.dispatchEvent(new Event("resize"))}};PanelsPopup.prototype.is_cbar_found=function(){var cbar=this.ctx.get_control_bar();return cbar&&this.video[0].contains(cbar[0])};PanelsPopup.prototype.render_vtile=function(idx,size){var el,create=playlist_util.create_el.bind(this,pr_class);var opt=this.opt;var tile=this.video_tile=create("div","tile "+pr_class+"vtile");var _this=this,info=create("span","info");setTimeout(function(){_this.send_resize();tile.addClass(pr_class+(opt._state=="playing"?"playing":"play"))},ms_sec);this.update_vtile(idx,size);tile.attr("pl_idx",idx);if(!this.is_cbar_found())tile.css({"pointer-events":"all"});var player=this.ctx.player||{},vinfo=this.ctx.video_info||{};var hola_vjs=(player.controls||{}).name=="hola";if(!hola_vjs&&vinfo.title){el=create("div","description").text(vinfo.title);this.add_css_element(info,el,"vdesc")}if(!hola_vjs&&!opt.hide_duration&&!this.conf.hide_duration&&player.get_duration()&&player.get_duration()!=Infinity){el=create("div","duration").text(playlist_util.sec_to_dur(player.get_duration()));this.add_css_element(info,el,"vdur")}if(!this.conf.disable_play_icon){el=this.icons.add_icon(tile[0],size);el.elem.css({"pointer-events":"all"})}this.els.hola_playlist_main.append(tile.append(info));this.tiles[idx]=tile;var s={width:size.width+"px",height:size.height+"px"};if(opt.height_auto)delete s.height;if(opt.video_css)assign(s,opt.video_css);this.video[0].pl_orig_style=this.video.attr("style")||"";this.video.css(s);if(opt.force_video_size)dom_util.style_important(this.video[0],s);this.video.addClass(pr_class+"video");if(opt.html5_css){this.html5[0].pl_orig_style=this.html5.attr("style")||"";this.html5.css(opt.html5_css)}this.render_controls(size)};PanelsPopup.prototype.add_hover=function(tile){var on_ile)}.bind(this);playlist.add_hover.call(this,tile,on_hover)};PanelsPopup.prototype._render_tile=function(idx,size){if(!idx)return this.render_vtile(idx,size);var opt=this.opt,create=playlist_util.create_el.bind(this,pr_class);var info=create("span","pinfo"),next=this.ppanels.playlist[idx-1];var conf=this.conf;var tile=playlist_util.create_tile.call(this,next,playlist.stats_inc);tile.addClass(pr_class+(idx<3?"x":idx==3?"xy":"y")+"_animation "+pr_class+"active");dom_util.style_important(tile[0],{position:"absolute",top:size.top+"px",left:size.left+"px",height:size.height+"px",width:size.width+"px","pointer-events":"all"});tile.attr("pl_idx",idx);if(next.type=="promo"&&util.is_enabled(playlist_promo)){this.els.hola_playlist_main.append(tile);this.tiles[idx]=tile;this.elements.push(tile);this.promo=playlist_promo.create(tile[0],next.promo);return}var live_tile=next.live_tile;if(live_tile){opt.autoclick={};widget.set_preview_url(tile,next,opt);tile.attr("data-spark_preview_video_url",live_tile);tile.attr("spark_ve_preview_live",1);tile.attr("data-spark_ve_preview_live",1);tile.attr("data-spark_keep_playing",1)}else widget.set_preview_url(tile,next,opt);if(next.poster){tile.img=this.img.create(next.poster,next);tile.poster=create("div","poster").append(tile.img);tile.append(tile.poster)}var el,bel=create("div","bottom");if(next.dur||next.total){el=$("<div>");if(!conf.hide_duration&&next.dur){el.append(create("span","duration").text(playlist_util.sec_to_dur(next.dur)))}if(!conf.hide_views&&next.total){el.append(create("span","views").text(playlist.views_to_text(next.total)))}this.add_css_element(bel,el,"pdur")}if(!live_tile&&next.description){el=create("div","description").text(next.description);this.add_css_element(bel,el,"pdesc")}if(!conf.hide_label)this.draw_label(info,next,pr_class);this.add_css_element(info,bel,"pbottom");playlist.add_dbg_info(info,next,conf);if(conf.show_info)info.addClass(pr_class+"info_static");if(!conf.disable_hint&&util.is_mobile){tile.addClass(pr_class+"mobile");bel=create("div","bottom_hint");bel.css({width:size.width+"px"});el=create("div","hint_text").text(playlist._t("hint_text"));this.add_css_element(info,bel.append(el),"bhint")}if(opt.show_category&&next.category){var category=create("div","category");category.css("display","none");category.attr("category",next.category);category.text(next.category);info.append(category)}tile.append(info);if(typeof conf.customize_tile_fn=="function"){try{conf.customize_tile_fn($,tile,next,opt,conf)}catch(e){return void playlist.log.err("invalid customize_tile_fn function: "+(e&&e.toString())||"JS Error")}}this.els.hola_playlist_main.append(tile);this.tiles[idx]=tile;this.elements.push(tile);if(!opt.disable_info_hide)this.add_hover(tile);if(!this.edit_box)return;$(tile).on("contextmenu",tile.on_contextmenu=this.edit_box.render_edit_button.bind(this.edit_box,tile,idx,next))};PanelsPopup.prototype.render_bg=function(idx,size){var bg=$("<div>").addClass(pr_class+"overlay");dom_util.style_important(bg[0],{position:"absolute",top:size.top+"px",left:size.left+"px",height:size.height+"px",width:size.width+"px"});bg.addClass(pr_class+(idx==0?"x":"y")+"_animation "+pr_class+"active");this.els.hola_playlist_bg.append(bg);this.elements.push(bg)};PanelsPopup.prototype._set_player_animation=function(in_progress){var player=this.ctx.player;if(!player||!player.set_state)return;var state={};state[player.states.WN_PANEL_ANIMATION]=in_progress;player.set_state(state)};PanelsPopup.prototype._enter_animation_mode=function(){this._set_player_animation(true);if(this._state_timeout)this._state_timeout=void clearTimeout(this._state_timeout);var _this=this;this._state_timeout=setTimeout(function(){delete _this._state_timeout;_this._set_player_animation(false)},ms_sec)};PanelsPopup.prototype.render=function(){playlist.log.debug("panel popup render");var el,v,c=$(this.ctx.container),opt=this.opt;if(!c.length||!(v=playlist_util.get_video(this.ctx))||!v.length)return;this._enter_animation_mode();var idx,_this=this,els=this.els={},panels=this.ppanels;this.video=dom_util.is_fullscreen()||opt.resize_video?v:c;this.html5=v;if(!this.conf.disable_blur&&opt._state!="playing")this.html5.addClass(pr_class+"blur");if(opt._state=="playing")playlist.stats.inc_d("auto_trigger_shown_n");[pr_class+"bg",pr_class+"main"].forEach(function(cl){_this.div.append(els[cl]=$("<div>").addClass(cl))});this.div.addClass("hola_playlist "+pr_class+"panel hola_top_element");if(this.ctx.rtl)this.div.addClass(pr_class+"rtl");if(el=playlist.add_powered_by_btn(this.div))this.elements.push(el);playlist_util.show_element(this.div);this.it_tiles(this.size,this._render_tile,this.render_bg);this.update();this.bind_events();if(this.conf.autoclick_tile!==undefined)panels.next=panels.playlist[this.conf.autoclick_tile];if((idx=panels.playlist.indexOf(panels.next)+1)&&(el=this.tiles[idx])){playlist.add_autoclick(this.icons,{pl_idx:idx-1,container:el,size:{width:el.width(),height:el.height()},playlist:panels.playlist},this.ctx,this.conf,opt)}if(this.thumbnails=this.ctx.video_ctx.attached_thumbnails)this.thumbnails.turn_off();playlist.delayed_scan();playlist.popup_inc("show",this.opt._state,"panel")};PanelsPopup.prototype.bind_events=function(){if(this.is_preview_enabled)preview.init_autoplay({autoplay_el:selected_tile});this.on_main_fn=function(e){if(this.info_popup&&this.info_popup.popped)return this.ctx.emit("info_hide",e);var ctrl,idx,tile=$(e.target);if(!tile.hasClass(pr_class+"tile"))tile=tile.parents("."+pr_class+"tile");if(!tile.length)return;idx=+tile.attr("pl_idx");if(!idx&&(ctrl=this.ctx.controls)){if(this.opt._state!="playing"&&!ctrl.is_playing())return void ctrl.play();playlist.stats.inc_d("auto_trigger_discard_n");this.ctx.playing_discarded=true;this.uninit();return}if(!idx)return;if(this.is_preview_enabled&&!tile.hasClass(selected_tile)){this.tiles.foile)});tile.addClass(selected_tile);setTimeout(function(){preview.emit("start_preview")});return}tile.removeClass(selected_tile);if(!playlist_util.is_ctrl_click(e)){if(this.ctx.ab_test){this.ctx.ab_test.send_click(idx,this.ppanels.playlist[idx-1])}if(this.opt._state=="playing")playlist.stats.inc_d("auto_trigger_click_n");playlist.play_next(this.ctx,{next:this.ppanels.playlist[idx-1]},true,this.type,this.opt._state)}}.bind(this);var main=this.els.hola_playlist_main;main.on("click",this.on_main_fn);playlist_util.cancel_event.call(this,main,"on",cancel_click_events);if(!this.ctx.on)return;this.uninit_fn=this.uninit.bind(this);this.ctx.on("widget_hide",this.uninit_fn);if(!this.opt.autoclick.navigate_on_hover_enabled)return;this.on_countdown_fn=this.on_countdown.bind(this);this.ctx.on("on_countdown",this.on_countdown_fn)};PanelsPopup.prototype.on_countdown=function(is_shown){this.tiles.forEach(function(e){if(e)e.data(pr_countdown,!is_shown)})};PanelsPopup.prototype.uninit=function(opt){if(!this.inited||opt&&opt.type!=this.type)return;playlist.log.debug("panel popup uninit");opt=opt||{};if(this.uninit_fn)this.ctx.off("widget_hide",this.uninit_fn);if(this.on_countdown_fn)this.ctx.off("on_countdown",this.on_countdown_fn);if(this.info_popup)this.info_popup=this.info_popup.uninit();var main=this.els.hola_playlist_main;main.off("click",this.on_main_fn);playlist_util.cancel_event.call(this,main,"off",cancel_click_events);this.icons.uninit();this.video_tile.removeClass(pr_class+"play");this.video_tile.removeClass(pr_class+"playing");var _this=this;this.elements.forEach(function(e){e.removeClass(pr_class+"active");if(_this.on_link_click){["click","auxclick","contextmenu"].forEach(function(name){e.on(name,_this.on_link_click)})}if(e.on_contextmenu)e.off("contextmenu",e.on_contextmenu);if(!e.wait_fn)return;e.wait_fn();if(e.move_fn)e.off("mousemove",e.move_fn);e.off("mouseenter",e.hover_fn);e.off("touchstart",e.hover_fn);e.off("mouseleave",e.unhover_fn)});this.restore.forEach(function(e){e.el.removeClass(e.cl);e.el.attr("style",e.style||"")});if(this.thumbnails)this.thumbnails.turn_on();if(this.edit_box)this.edit_box=void this.edit_box.uninit();if(!this.opt.skip_orig_style)this.video.attr("style",this.video[0].pl_orig_style||"");this._enter_animation_mode();if(opt.force)this._clear();else this._clear_timeout=setTimeout(this._clear.bind(this),ms_sec);this.img.uninit();this.div=this.els=undefined;if(this.promo){this.promo.destroy();this.promo=null}this.inited=false};PanelsPopup.prototype._t=function(str){return playlist._t(str)};function PanelsPopupFrame(_playlist,opt){this.playlist=_playlist;this.conf=opt.ppanels_conf;this.opt=opt;this.type="ppanels";this.inited=true;this.container=playlist_util.get_frame_container(_playlist,opt);if(opt.get_frame_container){this.container=opt.get_frame_container({E:E,_this:this,$:$,util:util})}if(this.playlist.__panels_frame_ui){this.playlist.__panels_frame_ui._clear();dom_util.force_redraw(this.container)}this.playlist.__panels_frame_ui=this;this.show()}PanelsPopupFrame.prototype._clear=function(){var instance=this.playlist.__panels_frame_ui;if(!instance)return;if(instance._clear_timeout)instance._clear_timeout=void clearTimeout(instance._clear_timeout);if(instance.root)instance.root.remove();dom_util.remove(instance.el_root);$(instance.container).removeProp("hola_root_container");instance.el_root=instance.root=undefined;if(instance.orig_css===undefined)return;var el=$(instance.container).parent();el.attr("style",instance.orig_css);instance.orig_css=undefined};PanelsPopupFrame.prototype.get_container=function(){return this.root};PanelsPopupFrame.prototype.update_pos=function(init){if(!this.root)return;var m=this.conf.margin,s={},opt=this.opt;var pos=playlist_util.get_container_pos(this.playlist,opt.resize_video);if(init){pos.width-=m.left+m.right;pos.height-=m.top+m.bottom;assign(s,{width:pos.width+"px",height:pos.height+"px"});if(opt.add_offset||opt.add_top_offset){var p=$(this.container).position();s.top=p.top+"px";if(opt.add_offset)s.left=p.left+"px"}if(this.conf.use_video_pos)s.left=pos.left+m.left+"px"}if(this.add_offset)assign(s,{top:pos.top+m.top+"px",left:pos.left+m.left+"px"});this.root.css(s);if(this.conf.on_update_pos)this.conf.on_update_pos({E:E,_this:this,s:s,$:$});this.update_pos_to=setTimeout(this.update_pos.bind(this),500);return pos};PanelsPopupFrame.prototype.on_fullscreen=function(e){playlist_util.on_fullscreen.call(this,e);if(!this.root)return;var $c=$(this.container);this.root.css({"margin-bottom":$c.css("margin-bottom"),"margin-top":$c.css("margin-top")})};PanelsPopupFrame.prototype.bind_events=function(){this.uninit_fn=this.uninit.bind(this);this.detaue})}.bind(this);this.on_fullscreen_fn=this.on_fullscreen.bind(this);this.playlist.on("detach",this.detach_fn);this.playlist.on("frame_hide",this.uninit_fn);this.playlist.on("fullscreenchange",this.on_fullscreen_fn)};PanelsPopupFrame.prototype.uninit=function(opt){if(!this.inited||opt&&opt.type!=this.type)return;playlist.log.debug("tile popup frame uninit");this.playlist.off("detach",this.detach_fn);this.playlist.off("frame_hide",this.uninit_fn);this.playlist.off("fullscreenchange",this.on_fullscreen_fn);this.hide(opt);this.inited=false};PanelsPopupFrame.prototype.show=function(){var c=$(this.container),opt=this.opt;this.el_root=document.createElement("div");this.root=$(this.el_root);var root_css={display:"block","margin-left":c.css("margin-left"),"pointer-events":"none",position:"absolute"};root_css=assign(root_css,this.conf.root_css);dom_util.style_important(this.el_root,root_css);if(opt._state=="preload")this.update_pos(true);else{var allow=!dom_util.is_fullscreen()||opt.allow_fullscreen;var w=c.width(),h=c.height();if(!allow){var mtop=parseInt(c.css("margin-top")),screen=window.screen;var mbottom=parseInt(c.css("margin-bottom"));var position=c.css("position");if(position=="absolute"&&mtop==mbottom||position=="fixed"&&w==screen.width&&h==screen.height){allow=true}}var p=c.parent();if(allow&&this.playlist.player_pos&&w&&h&&(!opt.fix_parent_div||opt.fix_parent_div&&(w=p.width())&&(h=p.height()))){if(opt.fix_parent_div||opt.parent_css){var s=opt.parent_css||{};if(opt.fix_parent_div){s=assign({},s,{position:"relative",width:w+"px",height:h+"px"})}this.orig_css=p.attr("style")||"";p.css(s)}var vsize;var add_widget_to_body=typeof opt.add_widget_to_body=="function"?opt.add_widget_to_body({E:E,_this:this,$:$,util:util}):opt.add_widget_to_body;if(add_widget_to_body)this.add_offset=1;else this.root.css({top:0,left:0});this.playlist.vsize=vsize=this.update_pos(true);if(vsize.width<this.conf.min_width)this.uninit({type:this.type,force:true});else{if(this.add_offset)document.body.appendChild(this.el_root);else c.after(this.root);c.prop("hola_root_container",this.el_root)}this.on_fullscreen();if(opt.fix_popup_frame)opt.fix_popup_frame({$:$,E:E,_this:this,util:util});this.playlist.set_show_time(this.type)}else opt._state="hidden"}this.bind_events()};PanelsPopupFrame.prototype.hide=function(opt){this.playlist.emit("widget_hide",opt);opt=opt||{};if(opt.force)this._clear();else this._clear_timeout=setTimeout(this._clear.bind(this),ms_sec);if(this.update_pos_to)this.update_pos_to=clearTimeout(this.update_pos_to)};E.init=function(_playlist){playlist=_playlist};E.PanelsPopup=PanelsPopup;E.PanelsPopupFrame=PanelsPopupFrame;return E});
define("/svc/cdn/pub/feature/playlist/index.js",["cash","/util/es6_shim.js","/util/events.js","/util/url.js","/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/ajax.js","/svc/cdn/pub/feature/preview/index.js","/svc/cdn/pub/widget.js","/svc/cdn/pub/play_icon.js","/svc/cdn/pub/l10n.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/feature/playlist/promo.js","/svc/cdn/pub/msg.js","/svc/cdn/pub/widget_info.js","/svc/cdn/pub/feature/playlist/editor.js","/svc/cdn/pub/feature/playlist/util.js","/svc/cdn/pub/feature/playlist/suggestion_btn.js","/svc/cdn/pub/feature/playlist/side_btn.js","/svc/cdn/pub/feature/playlist/popup.js","/svc/cdn/pub/feature/playlist/slide.js","/svc/cdn/pub/feature/playlist/tile.js","/svc/cdn/pub/feature/playlist/panels.js"],function($,shim,events,zurl,zutil,util,ajax,preview,widget,play_icon,l10n,dom_util,playlist_promo,_msg,widget_info,playlist_editor,playlist_util,suggestion_btn,side_btn,popup_ui,slide_ui,tile_ui,panels_ui){var assign=Object.assign,log={},E={},id="playlist",ms_sec=1e3;var api,perr;var wm_url="//ve-image-cdn.h-cdn.com/svc/preview/pub/img/watermark-transparent"+".svg";var max_find_retries=5,hash_param="spark_wn";var debug_hints,t,cache={};var pr_class="hola_playlist_";var pr_countdown="hola_preview_navigate_on_hover_enabled";var wn_type={popular:"rank",trending:"hot",rank:"rank",hot:"hot","new":"new"};var wn_type_pri={rank:0,hot:1,"new":2};E.session={};E.default_conf={zindex:10,page_blacklist:[],pnext_conf:{margin:{bottom:10,right:5},size:{mobile:{height:58,width:130,font_size:"8px"},def:{height:109,width:244,font_size:"14.6px"},min:{height:60,width:80,font_size:"8px"}},min_width:400,sec_before_end:5,sec_after_start_dur:5,seek_sec_delay:5,sec_after_start:10,sec_after_end_dur:10,content:{popular:1,trending:1,"new":1}},ptile_conf:{margin:{top:0,left:0,right:0,bottom:0},size:{width:190,height:130},lborder:4,tborder:4,content:{popular:1,trending:1,"new":1},hover_anim_time:2},ppanels_conf:{min_width:520,margin:{top:0,left:0,right:0,bottom:0},size:{width:190,height:130},content:{rank:2,"new":1,hot:2},lborder:4,tborder:4,hover_anim_time:2},pslide_conf:{min_height:50,margin:{top:0,left:0,right:0,bottom:0},content:{popular:1,trending:1,"new":1},dis_autopos:util.is_mobile,hover_anim_time:2,screen_size:{width:600,height:960},autoslide:{interval:10,direction:"right"}},sbutton_conf:{margin:{left:10,right:10}},sugg_btn_conf:{margin:{left:10,right:10}},pinline_conf:{cols:4,rows:5},papp_conf:{rows:1,cols:12,content:{popular:1,trending:1,"new":1}},autoclick:{countdown_on_hover:5,navigate_on_hover_sec:3,count:7,paused_count:60},views_count:util.scaled_number,on_pause:"panel",on_end:"tile",sec_before_end:30,margin_bottom:41,min_rows:2,allow_mobile:false,seek_sec_delay:10,max_preload_len:-1,min_width:520,link_tags:[],disable_wn_button:false,auto_trigger:{threshold:20,disable_sec:10,min_views:10}};var wn_types={popup:"pnext",tile:"ptile",panel:"ppanels",slide:"pslide"};var links_cache={};function add_conf_func(fname,func){if(typeof func!="function")return;E[fname]=function(container){return func(function(s){return $(document).find(s)},container)}}function add_domains(params,opt){if(opt.cont_src=="all")return;var d=opt.domains||[];var hostname=!opt.cont_src||!d.length?E.host:d.join(" ");if(E.conf.fix_hostname)hostname=E.conf.fix_hostname(hostname,{E:E});return params.hostname=hostname}function close_plugins(controls){if(E.close_plugins)E.close_plugins(controls);else if(controls&&controls.name=="jwplayer"){try{controls.jwplayer.plugins.related.close()}catch(e){}}}function draw_widget(ctx,type,div,opt){var f;switch(type){case"pnext":f=popup_ui&&popup_ui.NextPopup;break;case"ppanels":f=panels_ui&&panels_ui.PanelsPopup;break;case"pslide":f=slide_ui;break}if(E.conf.is_draw_widget_allowed&&!E.conf.is_draw_widget_allowed({ctx:ctx,type:type,E:E})){return}if(util.is_enabled(f))ctx[type+"_widget"]=new f(ctx,div,opt)}function filter_playlist(src,dst,type,hits,opt){opt=opt||{};var key,types=opt.types||[],urls=opt.urls||{},pages=opt.pages||{};for(var e,i=0;i<src.length&&dst.length<hits;i++){e=src[i];key=e.url_md5||e.page_url||e.video_url||e.url||e.url_key;if(urls[key]||opt.page_key&&e.page_key==opt.page_key||opt.url_key&&e.url_key==opt.url_key){continue}if(opt.history&&(opt.history.page_key[e.page_key]||opt.history.url_key[e.url_key])){e.played=true;continue}if(opt.views&&opt.views.find(function(ev){return ev.url_md5==e.url_md5})){continue}if(opt.pmap){var link,u=e.page_url||e.video_url;if(opt.miss&&(!(link=opt.pmap[u])||!link.preview||link.preview.error)){opt.miss.push(u);continue}if(opt.load)opt.load.push(link)}if(e.page_key&&opt.spage){if(pages[e.page_key]){opt.spage.push(e.url_md5);continue}pages[e.page_key]=true}dst.push(assign(e,{rank:i+1,preview:!!opt.pmap}));if(type)e.type=types[type];urls[key]=true}}function find_next_video(ctx,opt,cb){cb=cb||function(){};var size=zutil.is_mocha()||!opt._ctx?{width:400,height:300}:get_div_size(undefined,opt);var types=get_pl_conf_type(opt);var _preload=function(type,_cb){preload(type,ctx,size,opt,function(data){var _size=get_widget_size(type,size,opt);get_playlist(ctx,type,opt,_size,data,_cb)})};var wait=types.length;for(var i=0;i<types.length;i++){_preload(types[i],function(){if(!--wait)cb()})}}function get_container(player){var c,el=player.controls.get_ui().container;if(c=E.conf.player&&E.conf.player.container)return typeof c=="function"?c($,el):$(el).closest(c).get(0);return player.container||el}function get_content_map(type,dim,content){var len,idx=0,map=Array(dim.rows*dim.cols);for(var key in content){if(!(len=content[key]))continue;if(type!="ppanels")len=dim.cols*(Math.floor(len/dim.rows)||1);for(var i=0;i<len;i++)map[idx++]=[key]}return map}function get_div_size(div,opt,conf){var ctx,size;if(!(ctx=opt._ctx))size={width:$(div).width(),height:$(div).height()};else{var cbar,m;conf=conf||opt.ptile_conf;size=playlist_util.get_container_pos(ctx);if(m=conf.margin){size.width-=m.left+m.right;size.height-=m.top+m.bottom}if(!conf.dis_autopos&&(cbar=ctx.get_control_bar()))size.height-=cbar.height()}return size}function get_links_info(links,type,size,cb){if(!links.length)return void cb({});var res={};var new_links=[];var link_info,cache_key;for(var i=0;i<links.length;i++){cache_key=size+"_"+links[i];if(link_info=links_cache[cache_key]){res[links[i]]=assign({},link_info);continue}new_links.push({url:links[i],type:type,size:size,by_spark:"playlist_preload"})}if(!new_links.length)return void cb(res);E.links.force_get_db(new_links,undefined,function(links_info){if(!links_info||!links_info.res)return void cb(res);var cache_key;for(var link in links_info.res){cache_key=size+"_"+link;links_cache[cache_key]=res[link]=links_info.res[link]}cb(res)})}function get_pl_by_api(ctx,type,opt){var pl,master=ctx.master||{};if(!(pl=master.hola_playlist||master.spark_playlist))return;assign(opt,pl);delete opt.playlist;return pl.playlist}function get_pl_by_custom_fn(ctx,type,opt,ws,data,cb){var type_conf=opt[type+"_conf"]||{};var allow_custom_fn_iframe=opt.allow_custom_fn_iframe||type_conf.allow_custom_fn_iframe;if(!util.is_top&&!allow_custom_fn_iframe)return void E.msg.get_custom_fn_playlist_cb(cb);var custom_fn=type_conf.custom_fn||opt.custom_fn;if(typeof custom_fn!="function")return void cb();custom_fn(function(playlist){if(cache)cache.custom_fn_playlist=playlist;cb(playlist)},ctx,type,opt)}function get_pl_by_selector(ctx,type,opt,ws,data,cb){var sel=opt.selectors;if(!sel||!Object.keys(sel).length)return void cb();var pname="sel_playlist",c=cache[pname]=cache[pname]||{};if(c.playlist)return void cb(c.playlist);E.msg.sel_playli||pl});var items,len=0,base=document,win=window.self;if(sel.item){var old_win;for(items=$(base).find(sel.item);!items.get(0);items=$(base).find(sel.item)){if(win.parent==win)break;old_win=win;try{win=win.parent;base=win.document;log.debug("going to parent..",win.name)}catch(e){win=old_win;base=old_win.document;break}}if(!items.get(0)){c.fn_retry=c.fn_retry||0;if(c.fn_retry<max_find_retries){c.fn_retry++;setTimeout(function(){find_next_video(ctx,opt)},2e3)}return void cb()}c.fn_retry=0;len=items.length}cache.target_win=win;var playlist=[];if(len&&opt.use_links_js)playlist=get_pl_links_info(items);else{var getrop]};var get_func=function(el,prop){return el?$(el)[prop]():""};var get_img_src=function(el){return el?E.links.get_img_src(el,{}):""};var get_fn=function(selector,selector_js,_cb,prop,idx){vtor)};if(typeof selector=="function")return selector(_$,idx);if(selector_js){var fn=new Function("_$","pc",selector_js);return fn(_$,idx)}return _cb(_$(selector).get(idx),prop)};var u=get_url_type(ctx)+"_url";for(var idx=0,next={url:1};idx<len||!len&&next.url;idx++){next={poster:get_fn(sel.img,sel.img_js,get_img_src,"src",idx),description:get_fn(sel.desc,sel.desc_js,get_func,"text",idx)};if(next[u]=get_fn(sel.link,sel.link_js,get_prop,"href",idx))playlist.push(next);if(next.page_url)next.page_key=E.spark.page2cache(next.page_url)}}c.playlist=history_filter(playlist,[],ctx,type,opt);cb(c.playlist)}function get_pl_by_tags(ctx,type,opt,ws,data,cb){var pname=type+"_playlist",c=cache[pname]=cache[pname]||{};if(c.playlist)return void cb(c.playlist);var items=$("["+(opt.pl_attr||"spark_playlist,hola_spark_playlist")+"]");if(!items.length){c.fn_retry=c.fn_retry||0;if(c.fn_retry==max_find_retries)return void cb(c.playlist=[]);c.fn_retry++;return void setTiopt)},2e3)}c.fn_retry=0;cb(c.playlist=get_pl_links_info(items))}function get_pl_by_views(ctx,map,views,key,data,period,opt,cb){ctx=ctx||{};opt=assign({url_type:get_url_type(ctx)},opt);var count=opt.count||5,previews={},page_url=E.spark.get_top_url();var url_key=ctx.player&&ctx.player.url_key;var is_preview_enabled=E.spark.is_feature_inited("video_previews")&&!opt.disable_preview_filter;var add_pl_item=function(pl,added,arr,count,opts,order){var ple,e,cid;for(var i=0;i<arr.length;i++){e=arr[i];if(added[e.url_md5]||!(ple=playlist_entry(e,opt,opts)))continue;var page_url=ple.location||ple.page_url||ple.media_info&&ple.media_info.page_url||"";if(!is_page_url_allowed(page_url,opt))continue;if(opt.get_entry_id&&(cid=opt.get_entry_id(ple))){if(cid=="ignore"||added[cid])continue;added[cid]=true}ple.order=order;ple.page_views=e.page_views;pl.push(ple);added[e.url_md5]=true;if(is_preview_enabled)previews[ple.page_url||ple.video_url]=1;if(!--count)return}};var prepare=function(opts){var res={},rcount=count*2;for(var v in views){var harr=data[key+period[v].h]||[],rarr=[],farr=[];var larr=data[key+period[v].l]||[],lobj={},pl=res[v]=[];var added={};larr.fo5]=v});harr.forEach(function(e){if(!lobj[e.url_md5])return void farr.push(e);rarr.push(e)});add_pl_item(pl,added,rarr,rcount,opts,0);add_pl_item(pl,added,farr,rcount,opts,1);add_pl_item(pl,added,larr,rcount,opts,2);plotal}).foiews})}return res};var res=prepare(),keys=Object.keys(previews);get_links_info(keys,opt.url_type,opt.preload_size,function(pr){var views,res_pl=[],hits=opt.count,col=map[0].length;if(keys.length&&!pr)perr({id:"playlist_no_links_data",playlist_urls:keys});var opts={urls:{},pages:{},types:wn_type,miss:[],spage:[],page_key:E.spark.page2cache(page_url),url_key:url_key};if(is_preview_enabled)opts.load=[];if(hits>0&&is_inline(ctx))views=(E.session[ctx.id]||{}).views;var filter=assign({pmap:pr,history:E.history,views:views},opts);map.forEach(function(row,i){row.forEach(function(p,j){filter_playlist(res[p],res_pl,p,i*col+j+1,filter)})});function fill_playlist(opts){for(var p in res){filter_playlist(res[p],res_pl,p,hits,opts);if(res_pl.length==hits)return true}}var i,fkeys=["fall","history","pmap","views"];for(i=0;res_pl.length<hits&&i<fkeys.length;i++){delete filter[fkeys[i]];fill_playlist(filter)}if(res_pl.length==hits&&opts.load&&opts.load.length&&hits<=opt.max_preload_len){preview.preload_preview(opts.load)}if(res_pl.length<hits&&debug_hints){var dbg=["empty_desc","empty_poster","allow_empty"];for(i=0;i<dbg.length;i++){var o={};o[dbg[i]]=1;res=prepare(o);if(fill_playlist(assign({pmap:pr},opts))||fill_playlist(opts)){break}}while(res_pl.length<hits)res_pl.push({})}if(keys.length&&opts.miss.length){perr({id:"playlist_missing_preview",playlist_urls:opts.miss})}if(opts.spage.length){perr({id:"playlist_videos_on_single_page",playlist_urls:opts.spage})}cb(res_pl)})}function get_pl_conf_type(opt){if(opt._force_type)return[opt._force_type];var types=[];if(opt.on_pause=="popup"||opt.on_end=="popup")types.push("pnext");if(opt.on_pause=="tile"||opt.on_end=="tile")types.push("ptile");if(opt.on_pause=="panel"||opt.on_end=="panel")types.push("ppanels");if(!opt.disable_slide&&(types.includes("ptile")||types.includes("ppanels")||opt.on_pause=="slide"||opt.on_end=="slide")){types.push("pslide")}return types}function get_pl_links_info(items){var pl=[],opt={};for(var i=0;i<items.length;i++){var a=$(items[i]).find("a");if(!a.length)continue;var info=E.links.get_link_info(a[0],opt);if(info&&info.poster&&info.description&&info.url){pl.push(zutil.pick(info,"poster","description","video_url","page_url"))}}return pl}function get_pl_missing_info(ctx,lkey,pl,opt,cb){var add_poster,pages="";pl.forEach(function(e){pages+=(pages?" ":"")+e.page_url;if(!add_poster&&!e.poster)add_poster=true});opt=assign({cont_src:"all",by_pages:pages},opt);if(!add_poster)opt.ignore="poster video_poster";var cb_err=function(e){log.err(util.zerr_e2s(e));cb()};var playlists_handler=function(sdata){if(!sdata||!sdata.length){if(!sdata)E.stats.inc_d("get_static_playlists_err_n");return void cb()}sdata.forEach(function(e){var vi;if(!(vi=e.video_info))return void cb();assign(lkey[e._url_key],zutil.pick(vi,"poster","video_poster","description","title","dur","total"))});cb(lkey)};get_playlists(ctx,["1h"],5,opt,playlists_handler,cb_err)}function get_pl_remote(ctx,type,opt,ws,data,cb){var pconf=opt[type+"_conf"]||{};if(!zutil.is_mocha()&&ctx==E)return void cb();var url=pconf.playlist_url;if(!url&&typeof pconf.playlist_url_fn=="function")url=pconf.playlist_url_fn(ctx);if(!url)return void cb();var pname=type+"_playlist";var c=cache[pname]=cache[pname]||{};if(c.playlist)return void cb(c.playlist);var curl=cache[url]=cache[url]||{};ajax.raw({url:url,data_type:"json"},function(res){if(typeof pconf.prepare_remote_data=="function"){try{res=pconf.prepare_remote_data(res)}catch(e){log.err("invalid prepare_remote_data function: "+(e&&e.toString())||"JS Error")}}curl.res=res=res.playlist||res;if(!res.length)return void cb();res.forEach(function(e){if(!e.page_key&&e.page_url)e.page_key=E.spark.page2cache(e.page_url)});c.playlist=history_filter(res,[],ctx,type,assign({},opt,ws));cb(c.playl(e))})}function get_pl_static(ctx,type,opt,ws,pl,cb){var pconf=opt[type+"_conf"]||{};if(type=="pslide"&&!(pconf.static_list||[]).length){type=(opt.ptile_conf.static_list||[]).length?"ptile":(opt.ppanels_conf.static_list||[]).length?"ppanels":"";pconf=opt[type+"_conf"]||{}}var sl,pname=type+"_static";if(!(sl=pconf.static_list)||!sl.length)return void cb(pl);var c=cache[pname]=!(is_inline(ctx)&&opt._state=="preload")&&cache[pname]||{};if(c.playlist||!pconf.force_static_list&&(!pl||!pl.length)||!zutil.is_mocha()&&ctx==E){return void cb(c.playlist)}if(!pl&&pconf.force_static_list)pl=[];var mrow=0,mcol=0,lkey={},missing=[];var url_type=get_url_type(ctx);sl.forEach(function(e){e=assign({},e);e.row--;if(e.col)e.col--;mrow=Math.max(e.row,mrow);mcol=Math.max(e.col||0,mcol);if(e.type=="promo"&&util.is_enabled(playlist_promo)){if(typeof e.col=="number")lkey["promo_"+e.row+"_"+e.col]=e;else lkey["promo_"+e.row]=e;return}lkey[e.page_url]=e;if(!e.video_url&&url_type=="video")url_type="page";if(e.poster&&e.description&&!e.force_load)return;missing.push(e)});mrow=Math.max((pconf.rows||1)-1,mrow);mcol=Math.max((pconf.cols||1)-1,mcol);var cb_err=function(e){log.err(util.zerr_e2s(e));c.playlist={};cb()};var static_playlist_handler=function(){try{var d,_e,res=[];opt=assign({url_type:url_type},opt);for(_e in lkey){d=lkey[_e];var idx=mcol?d.row*(mcol+1)+d.col:d.row;if(!res[idx])res[idx]=[];if(d.type=="promo"&&util.is_enabled(playlist_promo)){res[idx].push(assign({},d));continue}d.video_info=zutil.omit(d,"page_url");if(_e=playlist_entry(d,opt)){if(d.type_str&&!d.type)d.type="new";_e.is_static=true;res[idx].push(assign(_e,zutil.pick(d,"type","type_str","disable_preview")))}}for(var i=0;i<res.length;i++){if(!(_e=res[i])||!_e.length)continue;d=[];filter_playlist(_e,d,undefined,1,{history:E.history});pl[i]=d.length?d[0]:_e[0]}cb(c.playlist)}catch(e){cb_err(e)}};c.playlist=pl;if(!missing.length)return void static_playlist_handler();get_pl_missing_info(ctx,lkey,missing,opt,static_playlist_handler)}function get_pl_top_vstats(ctx,type,opt,ws,data,cb){ws=ws||{};var range,pname=type+"_playlist",hits=ws.rows*ws.cols;var c=cache[pname]=!(is_inline(ctx)&&opt._state=="preload")&&cache[pname]||{};if(c.playlist||!data||!zutil.is_mocha()&&ctx==E||!["pslide","pnext","ppanels"].includes(type)&&(ws.cols<opt.min_rows||ws.rows<opt.min_rows||!hits)){return void cb(c.playlist)}if(c.et)return void c.et.push(cb);c.et=[cb];var _finally=function(playlist){var cbs=c.et;if(!cbs)return;c.et=undefined;for(var i=0;i<cbs.length;i++)cbs[i](playlist)};if(!(range=get_popular_range(type,ws,opt)))return void _finally(c.playlist=[]);var cb_err=function(e){log.err(util.zerr_e2s(e));c.playlist={};_finally()};var playlist_handler=function(res){try{if(!zutil.is_mocha()&&res.length<hits&&!["pnext","papp"].includes(type)){res=[]}else if(type=="ppanels"&&util.has_ext){var rank={};range.map.forEach(function(p,i){p=p[0]||"rank";res[i].type=p;res[i].rank=rank[p]=(rank[p]||0)+1})}else if(type!="ppanels"){res=res.slice(0,hits).sort(function(a,b){return b.played==a.played?b.total-a.total:+!!a.played-+!!b.played})}c.playlist=res;_finally(c.playlist)}catch(e){cb_err(e)}};var key=(add_domains({},opt)?"site_":"customer_")+"popular_";var _opt=assign({},opt,{count:hits});get_pl_by_views(ctx,range.map,range.view,key,data,range.period,_opt,playlist_handler)}function get_playlist(ctx,type,opt,ws,data,cb){var pl,next_by,next_fn;if(pl=get_pl_by_api(ctx,type,opt))return void cb(pl);switch(next_by=get_type_next_by(type,opt)){case"popular":case"slide":case"panels":case"trending":next_fn=get_pl_top_vstats;break;case"selector":next_fn=get_pl_by_selector;break;case"remote":next_fn=get_pl_remote;break;case"tags":next_fn=get_pl_by_tags;break;case"custom_fn":next_fn=get_pl_by_custom_fn;break;case"none":log.debug("next video popup disabled");break;default:log.debug("unsupported option: "+next_by);break}return next_fn&&next_fn(ctx,type,opt,ws,data,cb)}function get_playlist_next(ctx,pl,type,opt){var type_opt=opt[type+"_conf"]||{};if(typeof type_opt.get_playlist_next=="function"){try{return type_opt.get_playlist_next(ctx,pl,type,opt)}catch(e){return void log.err("invalid custom get_playlist_next function: "+(e&&e.toString())||"JS Error")}}if(!pl.length)return;if(opt.cursor_disabled||type!="pnext"&&!opt.force_next){if(!platic})){var f=pl.filter(function(e){return!e.is_static});if(!f.length)f=pl;return f[Math.floor(Math.random()*f.length)]}if(type=="ppanels"){pl=pl.concat().sort(function(a,b){return b.type==a.type?a.rank-b.rank:wn_type_pri[wn_type[a.type]]-wn_type_pri[wn_type[b.type]]})}return pl[0]}if(ctx.is_inline()){var s;if(!(s=E.session[ctx.id]))return pl[0];if(s.curr==s.views.length-1)return pl[s.curr];return s.views[s.curr+1]}pl=E.conf.loop?pl:pl.fayed});var idx=E.spark.storage_db.get_int(pr_class+"cursor")+1||0;var len=pl.length,pos=get_playlist_pos(ctx,pl);if(pos==idx)idx++;else if(pos!==undefined&&!opt.disable_play_next)idx=pos+1;idx%=len;if(pos==idx&&!E.conf.loop)return;E.spark.storage_db.set(pr_class+"cursor",idx);return pl[idx]}function get_playlist_pos(ctx,pl,el){el=el||{};var page_url=el.url||el.page_url||E.spark.get_top_url();var p=ctx.player,url_key=el.url_key||p&&p.url_key;for(var i=0;i<pl.length;i++){var url=pl[i].url||pl[i].page_url||pl[i].url_key;if(url==page_url||url==url_key)return i}}function get_playlist_url(url){if(!url)return{};url=zurl.parse(util.absolute_uri(url));if(url.hash){var hash=util.remove_from_qs(url.hash.substr(1),["spark_watch_next"]);url.hash=hash?"#"+hash:""}if(url.search){var query=util.remove_from_qs(url.search.substr(1),["spark_watch_next"]);url.path=url.pathname+(query?"?"+query:"")}var orig_url=zurl.uri_obj_href(url);url=E.spark.gen_page_url(orig_url,E.conf.link_tags);return{orig_url:orig_url,url:url}}function get_playlists(ctx,last,hits,opt,cb,cb_err){cb_err=cb_err||function(){};var p=zutil.pick(opt,"by_pages","ignore","ts_limit","limit_to","min_views","cdn_host");add_domains(p,opt);if(opt.map_vinfo)p.map_vinfo=1;p.dplatform=util.is_mobile?"mobile":"desktop";var s,page=E.spark.get_top_url(),url=ctx.player&&ctx.player.url||"";if(!opt.disable_type&&(s=util.url2videotype(url)||util.url2videotype(page))){p.video_type=s}if(!opt.disable_category&&(s=util.show_url2category(page)||opt.force_category)){p.category=s}if(!opt.disable_language&&(s=util.url2lang(page)))p.lang=s;if(hits>=1e3)perr({id:"playlist_max_hits",delay:false,hits:hits});hits=Math.max(hits,opt.min_hits||0);api.get_playlists(last,hits,p,cb,cb_err)}function get_popular_range(type,dim,opt){var last=[],view={},hits=0,conf=opt[type+"_conf"];var period={popular:{h:"1w",l:"1d"},trending:{h:"1d",l:"6h"},"new":{h:"new"},rank:{h:"1w",l:"1d"},hot:{h:"1d",l:"6h"}};E.set_pl_period(conf,["popular","trending","rank","hot"],period);var map=opt.map||get_content_map(type,dim,conf.content);map.forEach(function(r){r.fo0)+1})});for(var v in view){hits+=view[v];last.push(period[v].h);if(period[v].l)last.push(period[v].l)}return hits&&{last:last,map:map,period:period,view:view}}function get_preload_size(ctx,div,opt){var max,size=get_div_size(div,opt),types=get_pl_conf_type(E.conf);var get_size=function(type){var s;switch(type){case"pnext":s=playlist_util.get_popup_size(size,opt);return{width:2*s.height,height:s.height};case"ptile":s=get_widget_size(type,size,opt);return{width:Math.floor(size.width/s.cols),height:Math.floor(size.height/s.rows)};case"ppanels":return{width:Math.floor(.4*size.width),height:Math.floor(.4*size.height)};case"pslide":return size}};types.forEach(function(e){var s;if(e=="pslide"&&!ctx.is_slide_allowed()||!(s=get_size(e)))return;if(!max||max.width*max.height<s.width*s.height)max=s});return max?max.width+"x"+max.height:"400x320"}function get_spark_link(){return"http://holaspark.com?cam=wm_"+id+"_"+E.spark.customer}function get_type_next_by(type,opt,types){var next_by,pconf=opt[type+"_conf"]||{};if(type=="pslide"&&!pconf.next_by){types=types||get_pl_conf_type(E.conf);next_by=(types.includes("ptile")?opt.ptile_conf.next_by:opt.ppanels_conf.next_by)||"slide"}return next_by||pconf.next_by||opt.next_by||(type=="pnext"?"selector":type=="ppanels"?"panels":"popuage"}function get_widget_container(ctx,type,opt){if(!ctx.attached)return;var f;switch(type){case"pnext":f=popup_ui&&popup_ui.NextPopupFrame;break;case"ptile":f=tile_ui;break;case"ppanels":f=panels_ui&&panels_ui.PanelsPopupFrame;break;case"pslide":f=tile_ui;break}if(util.is_enabled(f))return ctx[type+"_popup"]=new f(ctx,opt,type)}function get_widget_div(opt){var div=$("<div>").css({display:"block","pointer-events":"all"});var size=opt.div_size||{width:"600px",height:"450px"};div.css(assign({top:0,left:0,position:"absolute"},size));div=div.get(0);if(E.conf.z_index)div.css("z-index",E.conf.z_index);document.body.appendChild(div);return div}function get_widget_size(type,size,opt){var map,conf=opt.ptile_conf||{};if(conf.next_by=="none")return{cols:3,rows:3};if(type=="papp")return{cols:1,rows:12};if(type=="ppanels")return{cols:1,rows:5};if(["pslide","pnext"].includes(type)){conf=opt[type+"_conf"]||{};return type=="pnext"?{cols:conf.cols||4,rows:conf.rows||5}:{cols:conf.cols||1,rows:conf.rows||5}}var res={},rows=conf.rows||"auto",cols=conf.cols||"auto";if((map=opt.map||conf.map)&&map.length){var row=map[0];if(map.length>1)rows=map.length;if(row.length>1)cols=row.length;res.map=map}if(rows!="auto"&&cols!="auto")return assign(res,{cols:cols,rows:rows});var tsize=opt.size||conf.size;var add=function(num,key,skey,border){res[key]=num=="auto"?Math.floor(size[skey]/(tsize[skey]+border)):num};add(cols,"cols","width",conf.lborder);add(rows,"rows","height",conf.tborder);return res}function history_filter(src,dst,ctx,type,opt){var hits,opts={urls:{},url_key:(ctx.player||{}).url_key,page_key:E.spark.page2cache(E.spark.get_top_url())};if(type=="pslide"||type=="ptile"||type=="papp"){var conf=opt[type+"_conf"];hits=opt.rows*opt.cols||conf.rows*conf.cols||9}else if(type=="ppanels")hits=5;if(hits){filter_playlist(src,dst,undefined,hits,assign({history:E.history},opts));if(dst.length<hits)filter_playlist(src,dst,undefined,hits,opts);if(dst.length<hits)dst=[]}else dst=src;return dst}function history_init(){var key;var history=E.spark_modules.history.data||[];var h=E.history={page_key:{},url_key:{}};history.forEach(function(e){if(e.page_url)h.page_key[E.spark.page2cache(e.page_url)]=e;if(key=e.url_key||e.cache_url)h.url_key[key]=e});for(var name in cache){if(name.endsWith("_playlist")&&cache[name])cache[name].playlist=undefined}return h}function host_init(url){E.host=zurl.parse(url).hostname}function invalidate(){cache.sel_playlist=undefined;E.msg.invalidne()}function is_page_url_allowed(url,opt){var blacklist=opt.page_blacklist;if(!blacklist)return true;for(var i=0;i<blacklist.length;i++){if(url.includes(blacklist[i]))return false}return true}function on_player_ad_attach(player,ctx){log.debug("on player ad attached "+player.id);var pl,id=player.wrapper.id;if(!(pl=E.playlist==id})))return;pl.ad_active=true;player.once("detach_ad",function(ctx){log.debug("on player ad detached "+player.id);pl.ad_active=false})}function on_player_attach(player,ctx){log.debug("on player attached "+player.id);if(E.conf.is_player_allowed&&!E.conf.is_player_allowed({E:E,player:player,ctx:ctx})){return log.info("player is excluded")}if(!E.monitor)E.monitor=setInterval(update_players,500);var pl_ctx,id=player.wrapper.id,sess=E.session[id];var rm=function(pl){var index=E.playlist.indexOf(pl);if(index>=0){E.playlist.splice(index,1);pl.detach(pl.player);pl.player.controls.off("next_suggestion_play",_play_next)}};player.media_info=(sess&&sess.views[sess.curr]||{}).media_info;if(!(pl_ctx=ctx.attached_pl)){var pl_prev;pl_ctx=ctx.attached_pl=util.is_app?new PlaylistApp({id:id}):new Playlist({id:id});pl_ctx.video_ctx=ctx;if(pl_prev=E.playlistl.id})){if(E.conf.copy_ctx_on_reattach&&!player.controls.is_playing()&&!pl_prev.played_inline){assign(pl_ctx,zutil.pick(pl_prev,"started","ended","is_live"))}rm(pl_prev)}pl_ctx.attach(player);E.playlist.push(pl_ctx);if(E.conf.ab_test&&E.conf.ab_test.enable){pl_ctx.ab_test=ab_test;ab_test.init(E.conf.ab_test.groups,player,E.spark,util.is_mobile?"mobile":"desktop",util.browser&&util.browser.browser,util.guess&&util.guess.os)}}pl_ctx.rm_playlist=rm;var show_suggeck()};var on_ended=pl_ctx.video_finished.bind(pl_ctx,false);var _play_next=pl_ctx.video_finished.bind(pl_ctx,true);var on_show_suggestion=show_suggestion.bind(pl_ctx);var on_hide_suggestion=show_suggestion.bind(pl_ctx,true);var controls=player.controls;controls.on("pre-ended",on_ended);controls.on("next_suggestion_show",on_show_suggestion);controls.on("next_suggestion_hide",on_hide_suggestion);controls.on("next_suggestion_play",_play_next);history_init();player.once("detach",function(_ctx){log.debug("on player detached "+player.id);if(!pl_ctx.ended){pl_ctx=_ctx.attached_pl=rm(pl_ctx);controls.off("next_suggestion_play",_play_next)}controls.off("pre-ended",on_ended);controls.off("next_suggestion_show",on_show_suggestion);controls.off("next_suggestion_hide",on_hide_suggestion);if(!E.playlist.length)E.monitor=clearInterval(E.monitor)})}function play_url(ctx,next,is_click,type,state,play_inline){if(next.type=="none")return;log.debug("switching to another video");if(ctx.autoclick&&ctx.autoclick.inline_hide_all&&ctx.hide_all)ctx.hide_all();ctx.loading_next=true;var metric=is_click?"next_click_n":"next_autoclick_n";E.stats_inc(metric,type,state,play_inline);var _is_inline=ctx.is_inline&&ctx.is_inline();var url=!_is_inline&&next.url||next.page_url;if(_is_inline&&!play_inline&&!url&&next.media_info)url=get_playlist_url(next.media_info.page_url).url;if(url){invalidate();next.played=true;E.stats_inc("next_url_n",type,state);return void setTimeout(function(){(cache.target_win||window.top).location.href=url})}if(!ctx.controls)return;next.played=true;ctx.played_inline=true;ctx.container.spark_wn_played_inline=true;log.debug("attempt to play next sources:",next);E.stats_inc("next_src_n",type,state,play_inline);url=next.video_url||next.url;E.spark.content_modified=true;ctx.controls.play_src([{url:url,poster:next.poster,title:next.title,description:next.description,type:util.guess_link_type(url)}]);invalidate()}function playlist_entry(e,opt,dbg){var dur,p,d,vi=e.video_info||{};var use=function(key){return opt.map_vinfo?vi[key]:opt["use_"+key]&&vi[key]};p=use("video_poster")||vi.poster||vi.video_poster;d=use("title")||util.str_longest(vi.description,vi.title);dbg=dbg||{};if(!dbg.allow_empty&&(!dbg.empty_poster&&!p||!dbg.empty_desc&&!d||opt.disable_live&&vi.is_live)){return}var entry={poster:p,description:d,total:vi.total||0,url_md5:e.url_md5};if(opt.show_category)entry.category=e.category||"unknown";if(!opt.hide_duration)entry.dur=vi.dur;if(d&&entry.dur&&(dur=playlist_util.sec_to_dur(entry.dur))&&d.startsWith(dur)){entry.description=d.replace(dur,"")}entry.media_info={page_url:e.location||e.page_url,video_url:vi.url,title:vi.title,description:vi.description,video_type:vi.video_type};if(opt.url_type=="page"){if(entry.page_url=entry.media_info.page_url)entry.page_key=E.spark.page2cache(entry.page_url)}else entry.video_url=entry.media_info.video_url;if(vi.url){entry.url_key=vi.cache_url||E.spark.video2cache(vi.url,util.get_adaptive_type(vi.url))}if(entry.video_url||entry.page_url)return entry}function playlist_widget(div,opt,cb){opt=opt||{};if(!div)div=get_widget_div(opt);var type,ctx=opt._ctx||{};if(!opt._ctx){opt=assign({tile:opt.tile||opt.tile===undefined},opt);if(opt.tile)opt.pnext_conf={next_by:"none"};opt.next_by=opt.type||(opt.selectors?"selector":"popular");var ptile_conf=opt.ptile_conf={};if(opt.rows&&opt.cols){ptile_conf.rows=opt.rows;ptile_conf.cols=opt.cols}if(opt.size)ptile_conf.size=opt.size;if(opt.autoclick_tile!==undefined)ptile_conf.autoclick_tile=opt.autoclick_tile;zutil.defaults_deep(opt,E.default_conf)}if(!(type=get_pl_conf_type(opt)[0]))return void cb();if(opt._ctx&&!(opt.preload_size=ctx.preload_size))ctx.preload_size=opt.preload_size=get_preload_size(ctx,div,opt);var ws,size=get_div_size(div,opt);var playlist_handler=function(pl){if(!pl||!pl.length){if(ctx.monitoring)ctx.monitoring.err(type,"no_data");return}if(["ptile","ppanels","pslide"].includes(type)&&pl.length<ws.rows*ws.cols){if(ctx.monitoring)ctx.monitoring.err(type,"not_enough_data");return}var name,tpl,ftype=get_pl_conf_type(opt)[0];if(type=="pnext"&&(name=opt.pnext_conf&&opt.pnext_conf.next_by))ctx[type]=cache[name+"_playlist"];if(!(tpl=ctx[type])||tpl.playlist!=pl||!tpl.next){tpl=ctx[type]={};tpl.playlist=pl;if(E.conf.fix_playlists_tpl)E.conf.fix_playlists_tpl({tpl:tpl,E:E,type:type,$:$});update_playlist(ctx,pl,type);if(type!="ptile"&&!tpl.next)tpl.next=get_playlist_next(ctx,pl,type,opt)}if(opt._state=="preload"||opt._state=="hidden"||type!=ftype||typeof div=="function"&&(!(div=div(ctx,type,opt))||!(div=div.get_container()))){
return}$(div).empty();if(opt._state=="hidden")return;if(type=="ptile"){ptile_widget_uninit.call(ctx);var conf=opt.ptile_conf;var autoclick_type=conf.autoclick_type?conf.autoclick_type:typeof conf.autoclick_tile=="number"||!opt.force_next||opt.cursor_disabled?"tile":opt.loop?"random":"history";if(conf.remote)autoclick_type="random";var autoclick=conf.autoclick||ctx.is_autoclick_allowed&&ctx.is_autoclick_allowed()&&ctx.get_autoclick_count();if(E.edit_box_enabled())ctx.edit_box=new playlist_editor(type);ctx.info_popup=E.create_info_popup(ctx,div);var wopt={spark:E.spark,stats:E.stats,mode:"tile",add_powered_logo:opt.add_powered_logo,log:log,rtl:ctx.rtl,tborder:conf.tborder,lborder:conf.lborder,min_rows:conf.min_rows,rows:conf.rows,cols:conf.cols,skip_small:conf.skip_small,size:conf.size,skip_author:opt.skip_author,hide_duration:opt.hide_duration||conf.hide_duration,skip_preview:opt.skip_preview,show_play_icon:conf.show_play_icon,hide_views:conf.hide_views,show_info:conf.show_info,hover_anim_time:conf.hover_anim_time,add_play_button:conf.add_play_button,play_button_size:conf.play_button_size,views_count:opt.views_count,disable_link_tile:opt.disable_link_tile,css:opt.css,add_dbg_info:E.add_dbg_info,disable_visibility_check:opt.disable_visibility_check,link_tags:E.conf.link_tags,autoclick:{enable:!ctx.autoclick_cancelled&&opt._state=="ended"&&!!autoclick,timeout:autoclick,player:ctx.player,type:autoclick_type,on_cancel_autoclick:ctx.on_cancel_autoclick&&ctx.on_cancel_autoclick.bind(ctx),tile:conf.autoclick_tile},strings:{item_views:t.bind(null,"views_text"),countdown_cancel:t("countdown_cancel")},events:le")}},handlers:{play:function(){ctx.controls.play()},play_next:function(next,is_click){if(is_click&&ctx.info_popup&&ctx.info_popup.popped){return ctx.emit("info_hide")}E.play_next(ctx,{next:next},is_click,type,opt._state)},on_context_menu:function(e,tile,idx,next,_opt){ctx.emit("info_show",e);if(!ctx.edit_box)return;ctx.edit_box.render_edit_button(tile,idx,next,_opt)},statate)}},show_category:conf.show_category!==undefined?conf.show_category:opt.show_category};assign(wopt.autoclick,zutil.pick(opt.autoclick,"countdown_on_hover","navigate_on_hover_enabled","navigate_on_hover_sec"));ctx.ptile_widget=new widget.Widget(ctx.ptile.playlist||[],div,wopt);if(ctx.on)ctx.on("widget_hide",ptile_widget_uninit,ctx);return}draw_widget(ctx,type,div,opt)};preload(type,ctx,size,opt,function(data){ws=get_widget_size(type,get_div_size(div,opt),opt);get_playlist(ctx,type,opt,ws,data,function(pl){get_pl_static(ctx,type,opt,undefined,pl,function(pl){try{playlist_handler(pl)}catch(e){log.debug(e)}if(opt.done_cb)opt.done_cb();cb()})})})}function preload(type,ctx,size,opt,cb){var master=ctx.master||{};if(master.hola_playlist||master.spark_playlist)return void cb([]);var hits=0,c=cache.preload=cache.preload||{};if(c.playlist||!zutil.is_mocha()&&ctx==E)return void cb(c.playlist);var _finally=function(playlist){var cbs=c.et;if(!cbs)return;c.et=undefined;for(var i=0;i<cbs.length;i++)cbs[i](playlist)};var last=[];var types=get_pl_conf_type(E.conf);types.forEach(function(e){var next_by=get_type_next_by(e,opt,types);if(!["panels","popular","slide","trending"].includes(next_by))return;var ws=get_widget_size(e,size,opt)||{};if(ws.rows*ws.cols<=0)return;hits=Math.max(ws.rows*ws.cols,hits);var range=get_popular_range(e,ws,opt)||{};if(!range.last)return;range.last.foh(l)})});if(!hits)return void cb(c.playlist={});if(opt._state!="preload")E.stats_inc("no_preload_n",type,opt._state,is_inline(ctx));if(c.et)return void c.et.push(cb);c.et=[cb];var cb_err=function(e){log.err(util.zerr_e2s(e));c.playlist={};_finally()};var playlists_handler=function(res){if(!res)E.stats.inc_d("get_playlists_err_n");if(E.conf.fix_playlists)E.conf.fix_playlists(res);_finally(c.playlist=res)};get_playlists(ctx,last,hits,opt,playlists_handler,cb_err)}function ptile_widget_uninit(opt){if(!this.ptile_widget||opt&&opt.type!="ptile")return;if(this.info_popup)this.info_popup=this.info_popup.uninit();if(this.edit_box)this.edit_box=void this.edit_box.uninit();this.ptile_widget=void this.ptile_widget.uninit();this.off("widget_hide",ptile_widget_uninit)}function set_media_info(next){var info=assign({},next.media_info);E.spark.msg.set_title_cb(next.title||"",info,function(){E.spark.msg.set_description_cb(next.description!=next.title?next.description||"":"",info,function(){})})}function setup_msg_handlers(){E.msg.add_top_handler("sel_playlist});E.msg.add_top_handler("invalidate",function(){cache.sel_playlist=undefined;find_next_video(E,E.conf)});E.msg.add_top_handler("is_frame_floating",function(idx){var w;if(!(w=(E.msg.frames[idx]||{}).frame))return;var f=$("iframe").get().find(function(_f){return _f.contentWindow==w});return f&&E.conf.is_frame_floating($,f)});E.msg.add_top_handler("get_custom_fn_play||[]});var update=function(is_fs){E.playlist.fo_fs)})};E.msg.add_frame_handler("fullscreen",update);playlist_util.add_rm_fs_listener(false,function(){var is_fs=dom_util.is_fullscreen();if(util.is_top)E.msg.fullscreen("all",is_fs);update(is_fs)})}function update_players(){E.playlist.forEach(function(pl){pl.monitor_playback()})}function update_playlist(ctx,pl,type){var key,h=E.history;var url_type=get_url_type(ctx);if(url_type=="page")key=pl[0].page_url?"page_url":"url";pl.forEach(function(el){if(!el.orig_url){var res=get_playlist_url(el[key]);el.orig_url=res.orig_url;el[key]=res.url}if(!E.conf.loop&&(h.page_key[el.page_key]||h.url_key[el.url_key]))el.played=true});if(type=="ptile"&&url_type=="video"){pl=pl.sort(function(a,b){return b.played==a.played?b.total-a.total:+!!a.played-+!!b.played})}}zutil.inherits(Playlist,events.EventEmitter);function Playlist(opt){if(!(this instanceof Playlist))return new Playlist(opt);this.id=opt.id||0;this.log=log;this.allowed={};opt=this.opt=assign({_ctx:this},E.conf);this.autoclick=opt.autoclick;var _this=this;var types=get_pl_conf_type(this.opt);types.fotrue});this.pnext_rule=this.init_pnext_rule(function(left){if(left)return _this.emit("sec_left",left);_this.emit("video_finished")});this.monitoring=new Monitoring}Playlist.prototype.set_show_time=function(type){var name=type+"_show_time_",diff=+Date.now()-this[type+"_start_t"];E.stats.set_d(name+"max",Math.max(E.stats.get(name+"max")||0,diff));E.stats.inc_d(name+"total",diff);E.stats.inc_d(name+"count");E.stats.set_avg_d(name+"avg",name+"total",name+"count")};Playlist.prototype.hide_popup=function(type,force){var opt=this.opt;this.monitoring.hide(type);var _t=type+"_popup";var etype=type+"_et";$(this.container).removeClass(pr_class+"active_"+type);if(this[etype])this[etype]=false;if(!this[_t])return;this[_t]=undefined;this.emit("frame_hide",{type:type,force:force});if(opt.on_hide_popup)opt.on_hide_popup({_this:this,E:E,$:$})};Playlist.prototype.show_popup=function(type,state){var _this=this;if(E.conf.can_show_popup&&!E.conf.can_show_popup({E:E,type:type,state:state,_this:this})){return}var et=type+"_et";if(this[et])return;this.hide_popup(type);if(state!="preload"){if(this.ab_test)this.ab_test.send_show(type);this.monitoring.show(type,state)}var opt=assign(this.opt,{_force_type:type,_state:state});this[type+"_start_t"]=+Date.now();this[et]=true;if(opt.on_show_popup)opt.on_show_popup({_this:this,E:E,$:$});playlist_widget(get_widget_container,opt,function(){if(!_this.attached||!_this[et])return;_this[et]=undefined;if(opt._state!="preload")_this.monitoring.render(!!_this[type+"_popup"],type,opt._state);if(opt._state!="preload"&&_this[type+"_popup"]){_this.controls.emit("playlist.show");$(_this.container).addClass(pr_class+"active_"+type);if(opt._state=="ended")close_plugins(_this.controls)}if(opt._state=="preload"||opt._state=="hidden")_this.hide_popup(type,true)})};Playlist.prototype.is_floating_set=function(){return E.is_floating_mode&&E.is_floating_mode(this.container)||$(this.container).hasClass("floating-video")||$(this.container).closest(".floating-video").length>0||$(window.document.body).hasClass("floating-video-iframe")||this.is_floating};Playlist.prototype.is_floating_mode=function(){var is_floating=this.is_floating_set(),isize=this.win_size;if(!is_floating&&E.conf.fl_mode_detect&&isize&&isize.width==window.innerWidth&&isize.height==window.innerHeight){var pos=playlist_util.get_container_pos(this);var ipos=this.player_pos;is_floating=ipos&&(pos.top!=ipos.top||pos.left!=ipos.left)&&(pos.width!=ipos.width||pos.height!=ipos.height)}if(E.conf.is_frame_floating&&!util.is_top&&!this.is_fl_et){this.is_fl_et=true;var _this=this;E.msg.is_frame_floating_cb(function(res){_this.is_fl_et=false;if(_this.is_floating==res)return;_this.is_floating=res;_this.monitor_playback()})}if(this.is_floating_old&&!is_floating)this.update_size();return this.is_floating_old=is_floating};Playlist.prototype.is_ad_active=function(){return E.is_ad_playing&&E.is_ad_playing(this.container)||this.controls.is_ad_active()||this.controls.ad_active||this.ad_active};Playlist.prototype.is_type_alype]};Playlist.prototype.update_widget=function(type,allow_popup,opt){var popup=type+"_popup";opt=opt||{};if(typeof E.conf.new_autoplay=="function"&&E.conf.new_autoplay({E:E,_this:this,type:type,allow_popup:allow_popup,opt:opt,cache:cache})){return}if(!this[popup]&&allow_popup)this.show_popup(type,opt.state);else if(this[popup]&&!allow_popup)this.hide_popup(type,opt.force)};Playlist.prototype.is_slide_allowed=function(){var swidth=window.screen.width,sheight=window.screen.height;if(swidth>sheight){swidth=sheight;sheight=window.screen.width}var size=this.pslide_conf.screen_size;return this.is_type_allowed("pslide")&&this.player_pos&&(this.player_pos.width<=this.opt.min_width||util.is_mobile&&swidth<size.width&&sheight<size.height)};Playlist.prototype.is_iine"};Playlist.prototype.is_inline_fline};Playlist.prototype.is_autoclick_almode};Playlist.prototype.get_autoclick_count=function(){return this.opt._state=="paused"?this.autoclick.paused_count:this.autoclick.count};Playlist.prototype.init_auto_trigger=function(){var opt=this.opt.auto_trigger;if(!opt||!opt.enable||this.loading_task||this.auto_trigger||util.is_mobile){return}if(opt.sec_to_video_end){var delay=(this.player.get_duration()||0)-opt.sec_to_video_end;if(delay>(opt.min_delay||0))return void(this.auto_trigger=delay);return}var _this=this;var headtmap_response_handler=function(ret){if(!_this.loading_task)return;E.stats.inc_d("auto_trigger_fetch_success_n");var data=ret&&ret.res;if(!data||!data.view_sec||!data.view_sec.length)return void E.stats.inc_d("auto_trigger_fetch_no_data_n");if(data.total<opt.min_views){E.stats.inc_d("auto_trigger_disabled_min_views_n");log.info("too few views for auto trigger");return}var max=0;data.view_sec.fox,v)});var threshold=max*opt.threshold/100;var pos=data.view_sec.findhold});E.stats.inc_d("auto_trigger_has_data_n");if(pos<=0||pos>_this.player.get_duration()-opt.disable_sec){E.stats.inc_d("auto_trigger_disabled_sec_n");log.info("auto trigger threshold not reached");return}_this.auto_trigger=pos*data.interval;E.stats.inc_d("auto_trigger_set_n")};E.stats.inc_d("auto_trigger_fetch_try_n");this.loading_task=true;api.get_heatmaps(this.video_ctx.video_url,function(ret){try{headtmap_response_handler(ret)}catch(e){E.stats.inc_d("auto_trigger_fetch_fail_n");perr({id:"playlist_heatmap_info_fail",throttle:1,info:{error:""+e}});log.warn("error during fetch heatmap info: "+e)}_this.loading_task=false})};Playlist.prototype.validate_auto_trigger=function(pos){var opt=this.opt.auto_trigger;if(!opt||!opt.enable||this.loading_task||!this.auto_trigger||pos<this.auto_trigger||this.playing_discarded){return}var auto_trigger=pos+this.opt.seek_sec_delay;if(auto_trigger>this.player.get_duration()-opt.disable_sec)this.auto_trigger=0;this.auto_trigger=auto_trigger;E.stats.inc_d("auto_trigger_delayed_n")};Playlist.prototype.init_pnext_rule=function(cb){var _this=this,opt=this.opt,conf=opt.pnext_conf;var rules={redir:{on_pause:!opt.disable_popup_on_pause,sec_before_end:opt.sec_before_end,hide_on_end:opt.hide_on_end,seek_sec_delay:opt.seek_sec_delay},inline:{on_pause:!conf.disable_popup_on_pause,sec_before_end:conf.sec_before_end,sec_after_start_dur:conf.sec_after_start_dur,seek_sec_delay:conf.seek_sec_delay}};var ended_ts,left_sec=0,seeked,old_dur=0,old_pos=0;var type=this.is_inline()?"inline":"redir",rule=rules[type];var tile_left_sec=0;if(type!="inline"&&opt.on_end=="tile")tile_left_sec=left_sec=rule.sec_before_end=rule.sec_before_end/2;return{is_allowed:function(pos,dur,wopt){switch(wopt.state){case"paused":return dur&&pos>2&&rule.on_pause&&pos>=conf.sec_after_start;case"playing":return dur&&pos>2&&(dur-pos<=rule.sec_before_end||pos>=conf.sec_after_start&&pos<=conf.sec_after_start+rule.sec_after_start_dur||!wopt.force&&_this.pnext_popup&&_this.pnext_popup.on_main);case"ended":return!rule.hide_on_end&&(rule.no_switch||left_sec||opt.on_end=="popup")}},set_time_left:function(pos,dur,state){var left,delay,seek=rule.seek_sec_delay;if(dur&&pos&&(old_dur!=dur||old_pos!=pos)){left=dur-pos;if(left<=seek&&pos-old_pos>=2||pos<old_pos){seeked=true;left_sec=left}else if(seeked&&left>seek){seeked=false;left_sec=tile_left_sec}old_dur=dur;old_pos=pos;delay=seeked?seek:rule.sec_before_end;if(left_sec&&left<=delay)left=delay-(left_sec-left)}else if(state=="ended"&&!opt.no_switch){delay=seeked?seek:opt.on_end=="popup"?_this.get_autoclick_count():rule.sec_before_end;if(!ended_ts)ended_ts=Date.now();if((left=delay-left_sec-(Date.now()-ended_ts)/1e3)<=0){seeked=left_sec=0;return cb()}}if(left!==undefined)cb({left:left})}}};Playlist.prototype.is_sbutton_allowed=function(){if(!util.is_enabled(side_btn))return false;var opt=this.opt;return this.is_inline()&&this[wn_types[opt.on_pause]]&&!this.ppanels_popup&&!opt.disable_sbutton&&(opt.force_sbutton||!this.player.is_small())};Playlist.prototype.is_sugg_btn_allowed=function(){if(!util.is_enabled(suggestion_btn))return false;var opt=this.opt;return["tile","panel"].includes(opt.on_pause)&&opt.enable_sugg_btn&&!this.is_sbutton_allowed()&&this[wn_types[opt.on_pause]]&&!this.ppanels_popup&&!this.is_floating_mode()&&this.player.controls.is_playing()&&!this.player.is_small()};Playlist.prototype.is_ended=function(){return this.ended&&(!this.is_custom_ended||this.is_custom_ended())};Playlist.prototype.is_manual_pause=function(){this.autoplay=this.autoplay||E.spark.get_feature_if_inited("autoplay");return!this.autoplay||this.autoplay.is_manual_pause(this.player)};Playlist.prototype.is_player_paused=function(){var cntr=this.controls;var is_seeking=cntr.is_seeking()||cntr.scrubbing();return cntr.is_paused()&&!is_seeking&&!(this.ended||this.is_ended()||(cntr.get_ui().media||{}).ended)&&this.is_manual_pause()||this.ppanels_popup&&is_seeking};Playlist.prototype.is_auto_trigger_enabled=function(){var pos=this.player.get_pos();return!this.is_player_paused()&&!this.is_ended()&&this.auto_trigger&&!this.playing_discarded&&pos>this.auto_trigger};Playlist.prototype.monitor_playback=function(){if(!this.attached||this.loading_next)return;if(E.conf.on_monitor_playback&&E.conf.on_monitor_playback({E:E,_this:this})){return}var dur=this.player.get_duration(),pos=this.player.get_pos();if(pos-this.last_pos>2)this.validate_auto_trigger(pos);this.last_pos=pos;var cntr=this.controls,opt=this.opt,ended=this.is_ended();var paused=this.is_player_paused();var _this=this;var is_type_enabled=function(type){return opt.on_pause==type&&pos&&(paused||type=="popup")||opt.on_end==type&&(ended||type=="popup"&&!paused&&!(_this.ptile_popup||_this.ppanels_popup||_this.pslide_popup))||type=="panel"&&_this.is_auto_trigger_enabled()};if(dur&&this.is_live===undefined)this.is_live=this.player.attached&&cntr.is_live_stream();var is_floating=this.is_floating_mode()||this.wait_size_update;var allow=!this.is_ad_active()&&!is_floating&&this.player.is_extra_ui_allowed({feature:"playlist"});var wopt={state:ended?"ended":paused?"paused":"playing",force:!allow};var allow_popup=allow&&!this.is_live&&this.is_type_allowed("pnext")&&is_type_enabled("popup")&&(this.pnext_rule.is_allowed(pos,dur,wopt)||this.show_suggestion);this.update_widget("pnext",allow_popup,wopt);var allow_mobile=!util.is_mobile||!E.conf.disable_mobile;var buffered=cntr.get_buffered()||[];var bpos=cntr.html5?cntr.html5.currentTime:pos;var started=bpos&&buffered.length&&Math.floor(bpos)>buffered.start(0)||ended;started=this.started=this.started||started;var allow_slide=this.is_slide_allowed()||is_type_enabled("slide");allow_popup=allow&&this.is_type_allowed("ptile")&&!allow_slide&&allow_mobile&&started&&is_type_enabled("tile");this.update_widget("ptile",allow_popup,wopt);allow_popup=this.is_type_allowed("ppanels")&&!allow_slide&&allow&&(!dom_util.is_fullscreen()||dom_util.is_fullscreen()&&!opt.disable_fullscreen)&&started&&is_type_enabled("panel");this.update_widget("ppanels",allow_popup,wopt);allow_popup=allow&&allow_slide&&started&&(is_type_enabled("slide")||is_type_enabled("tile")||is_type_enabled("panel")&&!_this.is_auto_trigger_enabled());this.update_widget("pslide",allow_popup,wopt);this.pnext_rule.set_time_left(pos,dur,wopt.state);allow=this.is_sbutton_allowed();if(allow&&!this.sbtn)this.sbtn=new side_btn(this,opt);else if(!allow&&this.sbtn)this.sbtn=void this.emit("frame_hide",{type:"sbutton"});allow=this.is_sugg_btn_allowed();if(allow&&!this.sugg_btn)this.sugg_btn=new suggestion_btn(this,opt);else if(!allow&&this.sugg_btn)this.sugg_btn=void this.emit("frame_hide",{type:"sugg_btn"});this.update_wn_button();if(wopt.state=="ended"&&(this.ptile_popup||this.ppanels_popup||this.pslide_popup)){close_plugins(this.controls)}};Playlist.prototype.update_wn_button=function(){var player=this.player,opt=this.opt;if(!player.controls||player.controls.name!="hola"||!["tile","panel"].includes(opt.on_pause)||!this[wn_types[opt.on_pause]]||opt.disable_wn_button){return}if(!this.wn_btn){this.wn_btn=player.controls.custom_buttons.add({class_name:"vjs_watch_next_btn",text:t("watch_next_title"),order:12});this.wn_btn.on("click",function(){player.controls.pause()})}this.wn_btn.force_hide(this.is_floating_mode()||!player.controls.is_playing())};Playlist.prototype.get_control_bar=function(){var cbar=E.conf.control_bar?this.container.find(E.conf.control_bar):$(this.controls.get_ui().control_bar);return cbar.length&&cbar};Playlist.prototype.get_bottom_offset=function(){var cbar,pbar,h=0,master=this.master;if(!(cbar=this.get_control_bar())||!playlist_util.is_visible(cbar)&&!(master&&master.userActive)){return h}h+=cbar.height();if((pbar=$(this.controls.get_ui().progress_bar))&&pbar.length){var co=cbar.offset(),po=pbar.offset();if(co.top>po.top)h+=pbar.height();else if(this.opt.pbar_autopos)h-=po.top-co.top;else if(!this.opt.disable_ooyala_autopos&&this.player.name=="ooyala"&&(pbar=pbar.find(".oo-scrubber-bar"))&&pbar.length){po=pbar.offset();if(po.top>co.top)h-=po.top-co.top}}return h};Playlist.prototype.on_start_preload=function(){for(var type in this.allowed)this.update_widget(type,true,{state:"preload"});this.init_auto_trigger()};Playlist.prototype.update_size=function(){var wait,resize,_this=this,is_floating=this.is_floating_set();if(!this.update_size_fn)this.update_size_fn=this.update_size.bind(this);if(is_floating!=this.is_floating_old){if(is_floating)this.monitor_playback();else wait=true}if(is_floating)return;if(wait||(resize=!util.is_mobile&&this.win_size&&(this.win_size.width!=window.innerWidth||this.win_size.height!=window.innerHeight))){if(this.wait_size_update)clearTimeout(this.wait_size_update);this.wait_size_update=setTick()},650);if(resize)this.monitor_playback()}this.win_size={width:window.innerWidth,height:window.innerHeight};if(this.ppanels_popup)return;this.player_pos=undefined;var pos=playlist_util.get_container_pos(this);if(this.update_to)this.update_to=clearTimeout(this.update_to);if(!pos.width&&this.update_retry<10){this.update_retry++;return void(this.update_to=setTimeout(this.update_size_fn,50))}this.update_retry=0;this.player_pos=pos};Playlist.prototype.attach=function(player){var _this=this;this.player=player;this.controls=player.controls;this.master=this.controls.get_player();this.loading_next=false;if(!(this.container=get_container(player)))return log.err("player container not found");this.was_played_inline=this.container.spark_wn_played_inline;this.before_unload=this.detach.bind(this);util.on("beforeunload",this.before_unload);this.rtl=this.opt.rtl!==undefined?this.opt.rtl:dom_util.detect_direction(this.container)=="rtl";this.on_start_preload_cb=this.on_start_preload.bind(this);this.player.once("buffer_5sec",this.on_start_preload_cb);this.pslide_conf=this.opt.pslide_conf;if(E.is_ended)this.is_custom_ended=E.is_ended(player);if(this.html5=this.player.html5){$(this.html5).on("play",this.on()})})}this.attached=true;this.update_retry=0;if(this.opt.on_attach)this.opt.on_attach({_this:this,E:E,$:$,util:util});this.update_size();var sess;if(!(sess=E.session[_this.id])){E.session[_this.id]={views:[{video_url:this.player.url,media_info:{video_url:_this.player.url,page_url:E.spark.get_top_url()}}],curr:0}}window.addEventListener("resize",this.update_size_fn);var handle_player_data=function(d){d.title=_this.controls.get_title()||d.title;d.description=_this.controls.get_description()||d.description;_this.video_info=d;var views=(E.session[_this.id]||{}).views;if(views&&views[0].video_url==_this.player.url){var info={description:d.description,title:d.title};views=assign(views[0],{poster:d.poster},info);if(views.media_info)assign(views.media_info,info)}};var media_info=sess&&(sess.views[sess.curr]||{}).media_info;if(media_info)handle_player_data(media_info);else player.get_player_info_cb(handle_player_data);var c=$(this.container).parent()[0];this.attr_unwatch=dom_util.attr_watch(c,{attr:"class",toggle_pattern:this.opt.floating_class||/(floating|sticky)/,watch_fn:function(){_this.monitor_playback()}});this.fullscreen_change_fn=function(is_fs){this.emit("fullscreenchange",{is_fullscreen:is_fs});this.hide_all();if(this.sbtn)this.sbtn=void this.emit("frame_hide",{type:"sbutton"});this.monitor_playback()}.bind(this);this.on("fullscreen",this.fullscreen_change_fn);log.debug("attached "+player.id)};Playlist.prototype.hide_all=function(){["ppanels","pslide","ptile","pnext"].forEach(function(type){if(this.is_type_allowed(type))this.hide_popup(type,{force:true})}.bind(this))};Playlist.prototype.detach=function(){if(!this.attached)return;log.debug("detach");this.attached=false;this.emit("detach");this.hide_all();util.off("beforeunload",this.before_unload);window.removeEventListener("resize",this.update_size_fn);if(this.fullscreen_change_fn)this.off("fullscreen",this.fullscreen_change_fn);if(this.attr_unwatch)this.attr_unwatch();if(this.wn_btn){this.player.controls.custom_buttons.remove(this.wn_btn);this.wn_btn=null}this.player.off("buffer_5sec",this.on_start_preload_cb);if(this.on_play)$(this.html5).off("play",this.on_play);if(this.update_to)this.update_to=clearTimeout(this.update_to);if(this.wait_size_update)this.wait_size_update=clearTimeout(this.wait_size_update);this.loading_task=undefined;if(this.opt.on_detach)this.opt.on_detach({_this:this,E:E,$:$,util:util})};Playlist.prototype.video_finished=function(is_click){if(!this.pnext_popup&&this.ptile_popup&&is_click){return E.play_next(this,this.ptile,is_click,"pnext","ended",this.is_inline())}if(this.ended=!is_click){var p=this.player;if(this.pnext_rule.is_allowed(p.get_duration(),p.get_pos(),{state:"ended"})){return}}this.emit("video_finished",is_click)};Playlist.prototype.on_cancel_autoclick=function(){this.autoclick_cancelled=this.opt._state!="paurue}}Monitoring.prototype.show=function(type,state){var tm_now=Date.now();if(this[type]){this.stats_inc(["render_duplicate",type]);this[type].last_tm=Date.now();return}this.stats_inc(["render",type]);this.stats_inc(["render_"+(state||"unknown"),type]);this.ui_switch=this.prev_ui&&tm_now-this.prev_ui.remove_tm<2e3&&(this.possible_ui_switch[this.prev_ui.type+"_"+type]||this.prev_ui.type==type);if(this.ui_switch)this.stats_inc(["ui_switch",this.prev_ui.type+"_"+type]);this[type]={init_tm:tm_now,last_tm:tm_now,err_code:null,rendered:this.ui_switch&&this.prev_ui.rendered,type:type}};Monitoring.prototype.stats_inc=function(names,postfix){if(typeof names=="string")names=[names];postfix=postfix||"_n";var name="mon";for(var i=0;i<names.length;i++){name+="_"+names[i];E.stats.inc(name+postfix)}};Monitoring.prototype.hide=function(type){if(!this[type])return;this.prev_ui=this[type];this.prev_ui.remove_tm=Date.now();this[type]=undefined};Monitoring.prototype.err=function(type,code){var _session;if(_session=this[type])_session.err_code=code};Monitoring.prototype.render=function(success,type,state){this.stats_inc(["rendered",type]);var _session;if(!(_session=this[type]))return this.stats_inc(["rendered_fail","no_session",type]);if(success){if(_session.rendered)this.stats_inc(["rendered_duplicate",type,state||"unknown"]);else this.stats_inc(["rendered_success",type,state||"unknown"]);_session.rendered=true}else this.stats_inc(["rendered_fail",_session.err_code||"unknown",type])};zutil.inherits(PlaylistApp,events.EventEmitter);function PlaylistApp(opt){if(!(this instanceof PlaylistApp))return new PlaylistApp(opt);this.id=opt.id||0;this.log=log;this.allowed={};this.playlist_items=[];opt=this.opt=assign({_ctx:this},E.conf)}PlaylistApp.prototype.attach=function(player){var _this=this;this.player=player;this.controls=player.controls;this.on_start_preload_cb=this.load_playlist.bind(this);this.monitor_playback_cb=this.monitor_playback.bind(this);this.player.once("buffer_5sec",this.on_start_preload_cb);this.controls.on("play",this.monitor_playback_cb);this.controls.on("pause",this.monitor_playback_cb);this.attached=true;if(!E.session[_this.id]){E.session[_this.id]={views:[{video_url:this.player.url,media_info:{video_url:_this.player.url,page_url:E.spark.get_top_url()}}],curr:0}}player.get_player_info_cb(function(d){d.title=_this.controls.get_title()||d.title;d.description=_this.controls.get_description()||d.description;_this.video_info=d;var views=(E.session[_this.id]||{}).views;if(views&&views[0].video_url==_this.player.url){assign(views[0],{description:d.description,poster:d.poster,title:d.title})}});log.debug("attached "+player.id)};PlaylistApp.prototype.is_inline=function(){return true};PlaylistApp.prototype.is_inline_forced=function(){return true};PlaylistApp.prototype.monitor_playback=function(){var p=this.controls,opt=this.opt;if(!p.is_idle())this.ended=false;var ended=this.ended;var is_seeking=p.is_seeking()||p.scrubbing();var paused=p.is_paused()&&!is_seeking&&!ended;var has_items=this.playlist_items.length>0;var expanded=has_items&&(paused&&opt.on_pause!="none"||ended&&opt.on_end!="none");var visible=has_items&&(expanded||p.fullscreen());if(visible&&!this.prev_visible)this.exec("show");if(expanded&&!this.prev_expanded)this.exec("expand");else if(!expanded&&this.prev_expanded)this.exec("collapse");if(!visible&&this.prev_visible)this.exec("hide");if(opt.autoclick.mode=="inline"){if(expanded&&ended&&(!this.prev_ended||this.pending_countdown))this.start_countdown();else this.pending_countdown=false;if(this.check_state("is_countdown_active")&&!this.check_state("is_player_visible")){this.exec("stop_countdown")}else if(this.check_state("is_countdown_stopped")&&this.check_state("is_player_visible")){this.start_countdown()}}this.prev_expanded=expanded;this.prev_ended=ended;this.prev_visible=visible};PlaylistApp.prototype.video_finck()};PlaylistApp.prototype.update_countdown=function(){};PlaylistApp.prototype.start_countdown=function(){if(this.check_state("is_player_visible")){this.exec("start_countdown",this.opt.autoclick.count);this.pending_countdown=false}else this.pending_countdown=true};PlaylistApp.prototype.load_playlist=function(){var _this=this,type="papp";var opt=assign(this.opt,{_state:"preload",cont_src:"all",min_rows:1});var conf=_this.opt.papp_conf;var range=get_popular_range(type,conf,opt)||{};var num=conf.rows*conf.cols;get_playlists(opt._ctx,range.last,num,opt,function(res){if(!res)return void E.stats.inc_d("get_playlists_err_n");var size=get_widget_size(type,{},opt);get_playlist(opt._ctx,type,opt,size,res,function(pl){_this.playlist_items=pl;if(!pl||!pl.length)return;var data=pl.map(function(p){return{video_url:p.media_info.video_url,poster_url:p.poster,title:p.description,dur:p.dur,preview:p.preview}});_this.exec("init",data);_this.monitor_playback()})})};PlaylistApp.prototype.exec=function(fn,data){return this.controls.hola_java_proxy.module_cb("playlist",fn,data?JSON.stringify(data):"")};PlaylistApp.prototype.check_rue"};PlaylistApp.prototype.detach=function(){if(!this.attached)return;this.exec("collapse");this.exec("hide");log.debug("detach");this.attached=false;this.emit("detach");this.player.off("buffer_5sec",this.on_start_preload_cb);this.controls.off("play",this.monitor_playback_cb);this.controls.off("pause",this.monitor_playback_cb)};E.add_autoclick=function(icons,icon,ctx,conf,opt){var auto_trigger=ctx.is_auto_trigger_enabled&&ctx.is_auto_trigger_enabled();if(opt._state!="ended"&&!conf.autoclick_on_pause&&!auto_trigger||ctx.autoclick_cancelled){return}var count=conf.autoclick||auto_trigger&&opt.auto_trigger.autoclick_sec||(ctx.is_autoclick_allowed()?ctx.get_autoclick_count():undefined);if(!isNaN(count)){return icons.add_icon(icon.container,icon.size,assign({autoclick:count},icon))}};E.add_dbg_info=function(el,next,conf){var is_preview_enabled=E.spark.is_feature_inited("video_previews");if(debug_hints&&conf.next_by!="remote"&&(!next.description||!next.poster||is_preview_enabled&&!next.preview)){var text;if(!next.url_md5){text="watch more videos to fill up the panels and wait 15m for "+"database to update"}else{text=[];["poster","description"].foh(e)});if(is_preview_enabled&&!text.length&&!next.preview)text.push("preview");text="missing "+text.join(", ")}el.append(playlist_util.create_el(pr_class,"span","dbg_info").text(text))}};E.add_hover=function(tile,cb){if(!tile.poster)return;var _this=this;var update_class=function(add){var hclass=pr_class+"tile_hover";if(add&&(tile.poster.hasClass("hola_preview_playing")||tile.poster.hasClass("hola_preview_countdown"))){tile.is_preview_playing=true;if(!tile.hasClass(hclass))tile.addClass(hclass)}else{if(tile.hasClass(hclass))tile.removeClass(hclass);if(tile.unwatch_class)tile.unwatch_class=tile.unwatch_class();if(tile.is_preview_playing&&cb)cb(tile,add);tile.is_preview_playing=false}};var update=function(){if(tile.poster.hasClass("hola_preview_countdown"))update_class(true);if(tile.rm_hover)return;tile.rm_hover=setTimeout(function(){update_class(true)},_this.conf.hover_anim_time*ms_sec)};tile.wait_fn=function(start){if(tile.rm_hover)tile.rm_hover=clearTimeout(tile.rm_hover);update_class();if(tile.unwatch_class)tile.unwatch_class=tile.unwatch_class();if(!start)return;tile.unwatch_class=dom_util.attr_watch(tile.poster[0],{attr:"class",watch_fn:update});update()};tile.hover_fn=function(){if(tile.is_preview_playing)return;tile.wait_fn(true);if(tile.move_fn)tile.on("mousemove",tile.move_fn)};tile.unhover_fn=function(){tile.wait_fn();if(tile.move_fn)tile.off("mousemove",tile.move_fn);
};if(util.is_mobile)return tile.on("touchstart",tile.hover_fn);tile.move_fn=function(){if(!tile.poster.hasClass("hola_preview_countdown"))tile.wait_fn(true)};tile.on("mouseenter",tile.hover_fn);tile.on("mouseleave",tile.unhover_fn)};E.add_powered_by_btn=function(root){if(!E.conf.add_powered_logo)return;var link,el;var create=playlist_util.create_el.bind(this,pr_class);var img=widget.create_img(pr_class+"powered_by_logo");link=create("a","powered_text");link.append(img.create(wm_url));link.attr("href",get_spark_link()).attr("target","_blank").append($("<div>").text(l10n.spark_t("powered_by_text")));el=create("div","powered "+pr_class+"active");root.append(el.append(create("div","powered_info").append(link)));return el};E.create_info_popup=function(ctx,div){if(E.conf.show_info_popup&&!util.is_mobile&&util.is_enabled(widget_info)){return widget_info.powered_by(ctx,{el:div,module_id:id})}};E.delayed_scan=function(){setTie){}},0)};E.edit_box_enabled=function(){return util.is_enabled(playlist_editor)&&E.conf.edit_ext&&util.conf.ext_api_key};E.icons_handler=function(ctx,type,opt){var icons=[];return{add_icon:function(container,size,iopt){iopt=iopt||{};var pos={top:0,left:0,height:size.height,width:size.width};var icon={disable_visibility_check:opt.disable_visibility_check,tr:t,is_allowed:function(){return true},pos:pos,icon_location:"center",img_pos:pos,size_px:iopt.size_px,is_top:util.is_top,msg:E.spark.msg,shadow:true,container:container,"class":pr_class+"icon"};if(iopt.autoclick!==undefined){var cl=pr_class+"next_countdown";var on_navigate=function(){E.play_next(ctx,{next:iopt.playlist[iopt.pl_idx]},false,type,opt._state)};var cck()};var on_show=function(){container.addClass(cl);if(ctx.emit)ctx.emit("on_countdown",true);container.data(pr_countdown,false)};var on_hide=function(){container.removeClass(cl);if(ctx.emit)ctx.emit("on_countdown");container.data(pr_countdown,false)};assign(icon,{on_countdown_cancel:cancel,on_show:on_show,icon_countdown:true,on_hide:on_hide,on_navigate:on_navigate,cl_class:pr_class+"icon_cancel",cd_class:pr_class+"icon_countdown",countdown_on_hover:iopt.autoclick})}icons.push(icon=new play_icon.Icon(icon));return icon},rm_icon:function(icon){var i;if((i=icons.indexOf(icon))==-1)return;icons[i].hide();icons.splice(i,1)},uninit:function(){icons.fode()});icons=[]}}};E.is_playlist_active=function(spark_player){var _id=spark_player.wrapper.id;var pl=E.playlist.find(function(p){return p.id==_id});return!!(pl.pnext_popup||pl.ptile_popup||pl.ppanels_popup||pl.pslide_popup)};E.play_next=function(ctx,pl,is_click,type,state,force_inline){var next=pl.next;force_inline=force_inline||ctx.is_inline_forced&&ctx.is_inline_forced();if(!force_inline)return play_url(ctx,next,is_click,type,state);var views,sess=E.session[ctx.id]||{},curr=sess.curr;if(!(views=sess.views))return log.debug("view session not found");if((curr=views.indexOf(next))==-1){views.push(next);curr=sess.curr+1}sess.curr=curr;next=views[curr];play_url(ctx,next,is_click,type,state,true);setTimeout(set_media_info.bind(null,next),100)};E.popup_inc=function(name,state,type){E.stats.inc("total_"+name+"_popup_n");E.stats.inc("total_"+state+"_"+name+"_popup_n");name=(type?type+"_":"")+name+"_popup_";E.stats.inc(name+"n");E.stats.inc(name+state+"_n")};E.set_pl_period=function(conf,types,period){types.forEach(function(type){var e;if(!(e=conf[type+"_period"]))return;e=e.split("_");period[type].h=e[0]||period[type].h;period[type].l=e[1]||period[type].l})};E.stats_inc=function(name,type,state,inline){E.stats.inc(name);if(!type)return;E.stats.inc(type+"_"+name);if(state){E.stats.inc(state+"_"+name);E.stats.inc(type+"_"+state+"_"+name)}if(inline){E.stats.inc(type+"_inline_"+name);if(state)E.stats.inc(type+"_inline_"+state+"_"+name)}};E.views_to_text=function(v){return t("views_text",{num:E.conf.views_count(v||0)})};E.was_played_inline=function(spark_player){var _id=spark_player.wrapper.id;var pl=E.playlist.find(function(p){return p.id==_id});return pl&&pl.was_played_inline};var ab_test={info:{}};ab_test.init=function(groups,player,spark,platform,browser,os){if(ab_test.inited)return console.log("ab_test already inited");ab_test.inited=true;ab_test.rand=Math.random();ab_test.groups=groups;ab_test.info.group="none";for(var group in groups){if(ab_test.rand<groups[group]){ab_test.info.group=group;break}}ab_test.player=player;ab_test.spark=spark;ab_test.info.platform=platform;ab_test.info.os=os;ab_test.info.browser=browser;ab_test.info.user_agent=navigator.userAgent;setTiit()},2e3)};ab_test.get_info=function(){var info=ab_test.info,player=ab_test.player;info.page_url=ab_test.spark.get_top_url();info.video_url=player.url;info.title=player.video_info&&player.video_info.title;info.width=player.container&&player.container.offsetWidth;info.height=player.container&&player.container.offsetHeight;return info};ab_test.send_init=function(){if(!ab_test.inited)return console.log("ab_test send but not inited");if(ab_test.sent)return console.log("ab_test already sent");ab_test.sent=true;var info=ab_test.get_info();perr({id:"ab_test_init",info:{ab_test:info},delay:false})};ab_test.send_click=function(click_id,o){if(!ab_test.inited)return console.log("ab_test send_click but not inited");if(ab_test.sent_click)return console.log("ab_test already sent_click");ab_test.sent_click=true;var info=ab_test.get_info();info.click_id=click_id;info.click_page_url=o&&o.page_url;info.click_title=o.media_info&&o.media_info.title;perr({id:"ab_test_click",info:{ab_test:info},delay:false})};ab_test.send_show=function(type){if(!ab_test.inited)return console.log("ab_test send_show but not inited");if(ab_test.sent_show)return console.log("ab_test already sent_show");ab_test.sent_show=true;var info=ab_test.get_info();info.type=type;perr({id:"ab_test_show",info:{ab_test:info},delay:false})};E.init=function(spark_modules,conf,spark){E.spark_modules=spark_modules;E.spark=spark;E.links=spark_modules.links;E.log=log=spark_modules.log;log.notice("playlist init conf %o",conf);E.conf=conf;E.api=api=E.spark_modules.api;if(conf.on_init){if(conf.on_init({E:E,$:$,util:util})=="skip"){log.notice("playlist disabled via conf on_init");return}}var params=E.spark.params||{};perr=spark_modules.perr;E.conf.link_tags.push({name:hash_param,type:E.conf.disable_hash?"query":"auto"});if(params.debug_hints)debug_hints=true;var ptile_conf=E.conf.ptile_conf;if(ptile_conf.num_mode=="manual"){ptile_conf.cols=ptile_conf.cols||3;ptile_conf.rows=ptile_conf.rows||3}debug_hints=util.has_ext&&E.conf.debug_hints||spark.conf.debug;play_icon.init();E._t=t=l10n.get_t(id);l10n.override(E.conf.strings||{},id);E.playlist=[];E.frames=[];E.stats=E.spark_modules.stats;if(util.is_enabled(suggestion_btn))suggestion_btn.init(E.stats);if(util.is_enabled(side_btn))side_btn.init(E);if(util.is_enabled(popup_ui))popup_ui.init(E);if(util.is_enabled(slide_ui))slide_ui.init(E);if(util.is_enabled(tile_ui))tile_ui.init(E);if(util.is_enabled(panels_ui))panels_ui.init(E);if(E.edit_box_enabled())playlist_editor.init(E.spark_modules);E.msg=_msg("pl",{child_frames:true});setup_msg_handlers();if(!E.conf.disable_css)dom_util.preload_css(util.player_url+require.zdot("playlist_css"));add_conf_func("is_ad_playing",E.conf.ad_detect);add_conf_func("is_floating_mode",E.conf.persistent_detect);add_conf_func("is_ended",E.conf.is_ended);add_conf_func("close_plugins",E.conf.close_plugins);E.spark.api.playlist_widget=playlist_widget;E.spark.on("set_top_url",host_init);history_init();host_init(E.spark.get_top_url());if(!E.conf.disable_ui){if(!zutil.is_mocha())find_next_video(E,E.conf);E.spark_modules.players.on("attach",on_player_attach);E.spark_modules.players.on("attach_ad",on_player_ad_attach)}if(util.is_enabled(playlist_promo))playlist_promo.init(E.conf.promo);E.inited=true;log.debug("inited")};E.is_avaitrue};E.t={find_next_video:find_next_video,cache:cache,history_init:history_init};return E});
define("/svc/cdn/pub/feature/autoplay/index.js",{__stub:1});

define("/svc/cdn/pub/feature/video_search/index.js",{__stub: E})})();
define("/svc/cdn/pub/feature/share/index.js",{__stub:1});
define("/svc/cdn/pub/feature/casting/index.js",{__stub:1});
define("/svc/cdn/pub/feature/youtube_controls/shortcuts.js",{__stub:1});
define("/svc/cdn/pub/feature/youtube_controls/seek_zones.js",{__stub:1});
define("/svc/cdn/pub/feature/youtube_controls/index.js",{__stub:1});
define("/svc/cdn/pub/feature/video_panel/index.js",{__stub:1});
define("/svc/cdn/pub/feature/sticky_player/index.js",{__stub:1});
define("/svc/cdn/pub/feature/heatmap/index.js",{__stub:1});
define("/svc/cdn/pub/feature/newsreel/widget.js",{__stub:1});
define("/svc/cdn/pub/feature/newsreel/index.js",{__stub:1});
define("/svc/cdn/pub/feature/top_pages/promo.js",{__stub:1});
define("/svc/cdn/pub/feature/top_pages/index.js",{__stub:1});
define("/svc/cdn/pub/feature/image_preview/index.js",{__stub:1});
define("/svc/cdn/pub/watermark.js",["cash","/svc/cdn/pub/utilrn E});
define("/svc/cdn/pub/features.js",["/util/util.js","/util/url.js","/svc/cdn/pub/util.js","/svc/cdn/pub/spark_features.js","/svc/cdn/pub/feature/persistent/index.js","/svc/cdn/pub/feature/thumbnails/index.js","/svc/cdn/pub/feature/preview/index.js","/svc/cdn/pub/feature/watch_later/index.js","/svc/cdn/pub/log.js","/svc/cdn/pub/links.js","/svc/cdn/pub/feature/position_memory/index.js","/svc/cdn/pub/feature/playlist/index.js","/svc/cdn/pub/feature/autoplay/index.js","/svc/cdn/pub/feature/video_search/index.js","/svc/cdn/pub/feature/share/index.js","/svc/cdn/pub/feature/casting/index.js","/svc/cdn/pub/feature/youtube_controls/index.js","/svc/cdn/pub/feature/video_panel/index.js","/svc/cdn/pub/widget.js","/svc/cdn/pub/feature/sticky_player/index.js","/svc/cdn/pub/l10n.js","/svc/cdn/pub/feature/heatmap/index.js","/svc/cdn/pub/feature/newsreel/index.js","/svc/cdn/pub/feature/top_pages/index.js","/svc/cdn/pub/feature/image_preview/index.js","/svc/cdn/pub/perr.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/api.js","/svc/cdn/pub/watermarkrn  E})} E})} E})} E})})();
define("/svc/cdn/pub/spark_log.js",["/util/zerrrn E});
define("/svc/cdn/pub/spark.js",["cash","/util/util.js","/util/url.js","/svc/cdn/pub/util.js","/svc/cdn/pub/cdnlist.js","/svc/cdn/pub/spark_features.js","/svc/cdn/pub/log.js","/svc/cdn/pub/links.js","/util/events.js","/svc/cdn/pub/spark_layout.js","/util/escape.js","/svc/cdn/pub/l10n.js","/svc/cdn/pub/msg.js","/svc/cdn/pub/ga.js","/svc/cdn/pub/storage.js","/svc/cdn/pub/spark_stats.js","/svc/cdn/pub/spark_player.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/api.js","/svc/cdn/pub/editor.js","/svc/cdn/pub/perr.js","/svc/cdn/pub/features.js","/svc/cdn/pub/widget_info.js","/svc/cdn/pub/spark_logrn E});
define("/svc/cdn/pub/flowplayer_hls_engine.js",{__stub:1});
define("/svc/cdn/pub/jwplayer_hls_provider.js",{__stub:1});
define("/svc/cdn/pub/vjs_hls_provider.js",{__stub:1});
define("/svc/cdn/pub/cdn_deps.js",{__stub:1});
require(["/util/es6_shim.js","/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/cdn_svc.js","/svc/cdn/pub/wrapper.js","/svc/cdn/pub/mode.js","/svc/cdn/pub/log.js","/svc/cdn/pub/cdnlist.js","/svc/cdn/pub/autodetect.js","/svc/cdn/pub/load_perf.js","/svc/cdn/pub/storage.js","/svc/cdn/pub/spark.js","/svc/cdn/pub/cdn_deps.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/perrrn E});define("/svc/cdn/pub/loader.js",["/svc/cdn/pub/config.js","/svc/cdn/pub/cdn.js","/svc/cdn/pub/utiln(){});

}());
