(()=>{"use strict";const e=t=i=n=e=>e<10&&e%10<=9?"0"+e.toFixed(1).toString():e.toFixed(1).toString(),o=()=>{const e=new Date;return`${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}:${e.getMilliseconds()}`};var s;!s||(s={}));class a{constructor(){a.instance||(this.levelPrio={Off:0,Error:1,Warn:2,Info:3,Debug:4,Trace:5},this.currLevel=s.Info,this.logObjects=!1,this.logsFilteredOut={Off:!1,Error:!1,Warn:!1,Info:!1,Debug:!1,Trace:!1,Diag:!1},a.instance=this)}setLogLevel(e){const t=e[0].toUpperCase()+e.substring(1).toLowerCase(),i=s[t];null!=i?this.currLevel=i:(console.log(`Invalid logLevel ${i} passed in, defaulting to info.`),this.currLevel=s.Info)}sableLogType(e){const t=e[0].toUpperCase()+e.substring(1).toLowerCase();this.logsFilteredOut[t]=!0}error(e,...t){this.print(s.Error,e,...t)}warn(e,...t){this.print(s.Warn,e,...t)}info(e,...t){this.print(s.Info,e,...t)}debug(e,...t){this.print(s.Debug,e,...t)}iagInfo(e,...t){this.logsFilteredOut.Diag||this.print(s.Info,"Kochava Diagnostic - "+e,...t)}diagDebug(e,...t){this.logsFilteredOut.Diag||this.print(s.Debug,"Kochava Diagnostic - "+e,...t)}print(e,t,...i){if(this.levelPrio[this.currLevel.toString()]>=this.levelPrio[e.toString()]&&!this.logsFilteredOut[e.toString()])try{const n=JSON.parse(i[0]);this.logObjects&&n?console.log(`KVA :: ${o()} ${e.toString()}:`,t,n):console.log(`KVA :: ${o()} ${e.toString()}:`,t,...i)}catch(n){console.log(`KVA :: ${o()} ${e.toString()}:`,t,...i)}}}const r=new a;const c=(e,t)=>{return i=void 0,n=void 0,s=function*(){try{const i=new Headers;i.append("Content-Type","application/json"),r.trace(`Request ${e.nt_id} being sent to: `,t);const n=yield fetch(t,{method:"POST",headers:i,body:JSON.stringify(e)});return yield n.text()}catch(e){return r.error("Error in post request",e),""}},new((o=void 0)||(o=Promise))((function(e,t){function a(e){try{c(s.next(e))}catch(e){t(e)}}function r(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof o?i:new o((function(e){e(i)}))).then(a,r)}c((s=s.apply(i,n||[])).next())}));var i,n,o,s},d=e=>"1"===e||1===e||!0===e,l=u=()=>window?window.screen.availWidth:0,v=h=()=>window?window.innerWidth<window.innerHeight?"portrait":"landscape":"",f=()=>{try{const e=window.location.host.match(/[^.]*\.[^.]*$/);return e?e[0]:""}catch(e){return window.location.host}},g=()=>{let e="";return window.location&&(e=window.location.pathname.substring(1),e=e.replace(/\/+$/,"")),""===e?"/":e},p=e=>{if(!window.location||!window.location.search)return"";e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},k=(t,i,n)=>{let o=`${i.kochavaSession}-${i.kochavaSessionCount}-${e()}`;return n&&(r.debug("Persisted call found with nt_id:",n),o=n),{action:t,kochava_app_id:i.appGuid,kochava_device_id:i.kochavaDeviceId,sdk_version:i.version,sdk_protocol:"17",nt_id:o,init_token:i.kochavaConfig.config.init_token||void 0}},y=e=>{const i=t();let n=(i-e.startTimeMS)/1e3;return n<0&&(n=0),{starttime:e.startTimeMS/1e3,uptime:n,usertime:i/1e3}};const m=(t,i)=>{const n={kochava_app_id:t.appGuid,kochava_device_id:t.kochavaDeviceId,nt_id:`${t.kochavaSession}-${t.kochavaSessionCount}-${e()}`};return n.data=Object.assign(Object.assign({},y(t)),i.data),t.customValues.forEach((e=>{if(!e.isDeviceId){const i=Object.keys(e.data)[0];if(t.kochavaConfig.privacy){let o=!1;for(const e of t.kochavaConfig.privacy.allow_custom_ids)i===e&&(o=!0);o&&(n.data=Object.assign(Object.assign({},e.data),n.data))}}})),n},S=(e,t,i)=>{return n=void 0,o=void 0,a=function*(){const n=((e,t,i)=>{const n=Object.assign(Object.assign({},t),i);return r.debug("Event Payload",JSON.stringify(n)),e.kochavaConfig.privacy&&e.kochavaConfig.privacy.deny_datapoints.forEach((e=>{for(const t in n.data){const i=t;i===e&&delete n.data[i]}for(const t in n){const i=t;i===e&&delete n[i]}})),n})(e,t,i),o=yield c(n,e.overrideUrls.event?e.overrideUrls.event:e.kochavaConfig.networking.urls.event);let s,a=!1;try{r.trace("Event Response string:",o),s=JSON.parse(o),r.debug("Event Response:",o),a=d(s.success)}catch(e){r.error("Error parsing Event Response",e),a=!1}return a?(r.info("Event success!"),!0):(r.error("Event failed!"),!1)},new((s=void 0)||(s=Promise))((function(e,t){function i(e){try{c(a.next(e))}catch(e){t(e)}}function r(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(i,r)}c((a=a.apply(n,o||[])).next())}));var n,o,s,a};const w=(t,i)=>{const n={kochava_app_id:t.appGuid,kochava_device_id:t.kochavaDeviceId,nt_id:`${t.kochavaSession}-${t.kochavaSessionCount}-${e()}`};return n.data=Object.assign(Object.assign({},i.data),y(t)),n},I=(e,t)=>{return i=void 0,n=void 0,s=function*(){const i=((e,t)=>{const i=Object.assign(Object.assign({},t.preStartBody),t.postStartBody);return r.debug("IdentityLink Payload",JSON.stringify(i)),r.diagDebug("IdentityLink to be sent as stand alone"),e.kochavaConfig.privacy&&e.kochavaConfig.privacy.deny_datapoints.forEach((e=>{for(const t in i.data){const n=t;n===e&&delete i.data[n]}for(const t in i){const n=t;n===e&&delete i[n]}})),i})(e,t),n=yield c(i,e.overrideUrls.identityLink?e.overrideUrls.identityLink:e.kochavaConfig.networking.urls.identityLink);let o,s=!1;try{r.trace("IdentityLink Response string:",n),o=JSON.parse(n),r.debug("IdentityLink Response:",n),s=d(o.success)}catch(e){r.error("Error parsing IdentityLink Response",e),s=!1}return s?(r.info("IdentityLink success!"),!0):(r.error("IdentityLink failed!"),!1)},new((o=void 0)||(o=Promise))((function(e,t){function a(e){try{c(s.next(e))}catch(e){t(e)}}function r(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof o?i:new o((function(e){e(i)}))).then(a,r)}c((s=s.apply(i,n||[])).next())}));var i,n,o,s},_=(e,t)=>{let i="";const n=new Date;n.setTime(n.getTime()+31536e7),i=`; expires=${n.toUTCString()}`,document.cookie=e+"="+(t||"")+i+"; path=/;domain="+f()},b=e=>{const t=e+"=",i=document.cookie.split(";");for(let e=0;e<i.length;e++){let n=i[e];for(;" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return""};var D;!D||(D={}));const O=[D.LastKvinit,D.EventQueue,D.IdLinkQueue,D.DeviceId,D.InstallId,D.FirstStartDate,D.InstallSentDate,D.KvinitSentDate,D.SessionCount,D.IdentityLinks,D.OverrideAppId,D.OverrideDeviceId],L=e=>{const t=localStorage.getItem(D.EventQueue),i=JSON.parse(t)||[];i.push(e),localStorage.setItem(D.EventQueue,JSON.stringify(i))},C=e=>{const t=Object.keys(e.idLink)[0],i=localStorage.getItem(D.IdLinkQueue),n=JSON.parse(i)||[];let o=!1;for(const i of n)t===Object.keys(i.idLink)[0]&&(i.idLink[t]=e.idLink[t],o=!0);o||n.push(e),localStorage.setItem(D.IdLinkQueue,JSON.stringify(n))},J=(e,t)=>{const i=p(e),n=localStorage.getItem(e);let o="";return t&&(o=b(e)),i?$(e,i,t):(n||o)&&$(e,n,t),i||n||o||""},$=(e,t,i)=>{localStorage.setItem(e,t),i&&_(e,t)};var N=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function r(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}c((n=n.apply(e,t||[])).next())}))};class E{constructor(){this.eventQueue=[],this.idLinkQueue=[],this.processing=!1,this.stopped=!1,this.paused=!1}start(e){return N(this,void 0,void 0,(function*(){this.eventQueue=JSON.parse(localStorage.getItem(D.EventQueue))||[],this.idLinkQueue=JSON.parse(localStorage.getItem(D.IdLinkQueue))||[],this.updateEventJobs(e),this.updateIdLinkJobs(e),r.trace("Starting Event Queue",JSON.parse(JSON.stringify(this.eventQueue))),r.trace("Starting IdLink Queue",JSON.parse(JSON.stringify(this.idLinkQueue))),this.stopped=!1,this.paused=!1,yield this.dequeueJob(e)}))}stop(){this.stopped=!0,this.timeOut&&clearTimeout(this.timeOut),this.processing=!1}nqueueEvent(t,i){return N(this,void 0,void 0,(function*(){const n=i[0],o=i[1],s=((e,t,i)=>{const n={action:"event",sdk_version:e.version,sdk_protocol:"17",data:{event_name:t,event_data:i,device_orientation:h(),disp_w:u(),disp_h:v()}};return e.kochavaConfig&&(n.init_token=e.kochavaConfig.config.init_token||void 0),n})(t,n,o);if(t.installDone&&t.kvinitDone){const i=m(t,s),o={id:e(),queuedBeforeStart:!1,preStartBody:s,postStartBody:i,retries:0,eventName:n};return this.eventQueue.push(o),L(o),void(yield this.dequeueJob(t))}const a={id:e(),queuedBeforeStart:!0,preStartBody:s,postStartBody:void 0,retries:0,eventName:n};this.eventQueue.push(a),L(a)}))}enqueueIdLink(t,i){return N(this,void 0,void 0,(function*(){const n=((e,t)=>{const i={action:"identityLink",sdk_version:e.version,sdk_protocol:"17",data:{identity_link:Object.assign({},t)}};return e.kochavaConfig&&(i.init_token=e.kochavaConfig.config.init_token||void 0),i})(t,i);if(t.installDone&&t.kvinitDone){const o=w(t,n),s={id:e(),queuedBeforeStart:!1,preStartBody:n,postStartBody:o,retries:0,idLink:i};return C(s),this.idLinkQueue.push(s),void(yield this.dequeueJob(t))}const o={id:e(),queuedBeforeStart:!0,preStartBody:n,postStartBody:void 0,retries:0,idLink:i};C(o),this.idLinkQueue.push(o)}))}dequeueJob(e){return N(this,void 0,void 0,(function*(){if(this.processing)return!1;if(this.paused)return!1;if(this.stopped)return!1;const t=this.idLinkQueue.shift();if(t){r.trace("Dequeued Job: ",t),this.processing=!0;const i=yield this.processJob(e,t);if(this.stopped)return!0;if(this.processing=!1,i)return(e=>{const t=localStorage.getItem(D.IdLinkQueue),i=(JSON.parse(t)||[]).filter((t=>t.id!==e.id));localStorage.setItem(D.IdLinkQueue,JSON.stringify(i))})(t),yield this.dequeueJob(e)}const i=this.eventQueue.shift();if(i){r.trace("Dequeued Job: ",i),this.processing=!0;const t=yield this.processJob(e,i);if(this.stopped)return!0;if(this.processing=!1,t)return(e=>{const t=localStorage.getItem(D.EventQueue),i=(JSON.parse(t)||[]).filter(();localStorage.setItem(D.EventQueue,JSON.stringify(i))})(i),yield this.dequeueJob(e)}return!(!t&&!i)}))}processJob(e,t){return N(this,void 0,void 0,(function*(){if("eventName"in t){for(const i of e.kochavaConfig.privacy.deny_event_names)if(i===t.eventName)return r.debug(`Denied event_name ${i}, dropping request.`),!0}else if("idLink"in t)for(const i of e.kochavaConfig.privacy.deny_identity_links)if(i===Object.keys(t.idLink)[0])return r.debug(`Denied identity_link ${i}, dropping request.`),!0;let i=!1;do{if(i=yield this.attemptJob(e,t),i)return r.trace("Job processed successfully:",t),!0;if(!this.stopped){const i=e.kochavaConfig.networking.retry_waterfall,n=i[t.retries>i.length-1?i.length-1:t.retries];r.error(`Job failed, attempting again in ${n} seconds`),yield new Promise((e=>this.timeOut=setTimeout(e,1e3*n))),t.retries++}}while(!i&&!this.stopped);return!0}))}attemptJob(e,t){return N(this,void 0,void 0,(function*(){return"event"===t.preStartBody.action?yield S(e,t.preStartBody,t.postStartBody):"identityLink"===t.preStartBody.action?yield I(e,t):(r.warn("Invalid action in job from jobqueue, cancelling."),!0)}))}updateEventJobs(e){for(const t of this.eventQueue)t.queuedBeforeStart&&(t.postStartBody=m(e,t.preStartBody));$(D.EventQueue,JSON.stringify(this.eventQueue),!1)}updateIdLinkJobs(e){for(const t of this.idLinkQueue)t.queuedBeforeStart&&(t.postStartBody=w(e,t.preStartBody));$(D.IdLinkQueue,JSON.stringify(this.idLinkQueue),!1)}}const T={general:{app_id_override:"",device_id_override:""},config:{init_token:"",refresh_minimum:60},install:{resend_id:"",updates_enabled:!0},networking:{urls:{init:"https://kvinit-prod.api.kochava.com/track/kvinit",install:"https://web-sdk.control.kochava.com/track/json/",event:"https://web-sdk.control.kochava.com/track/json/",identityLink:"https://web-sdk.control.kochava.com/track/json/"},retry_waterfall:[7,30,300,1800]},privacy:{allow_custom_ids:[],deny_datapoints:[],deny_event_names:[],deny_identity_links:[]}};let P,j=!1;const A=(e,i,o=0)=>{return s=void 0,a=void 0,u=function*(){j=!1;const s=(e=>{const t=k("init",e);return t.build_date=e.buildDate,t.data=K(e),r.debug("Kvinit Payload",JSON.stringify(t)),t})(e);let a,l=!1;do{r.trace("Kvinit endpoint:",e.kochavaConfig.networking.urls.init);const u=t()-e.startTimeMS;r.diagDebug(`Sending kvinit at ${n(u/1e3)} seconds`);const v=yield c(s,e.overrideUrls.init?e.overrideUrls.init:e.kochavaConfig.networking.urls.init),h=t()-e.startTimeMS;if(r.diagDebug(`Completed kvinit at ${n(h/1e3)}\n      seconds with a network duration of ${n((h-u)/1e3)} seconds`),j)return r.trace("Can no longer retry kvinit, cancelling."),!1;try{a=JSON.parse(v),r.debug("Kvinit Response:",a),l=d(a.success)}catch(e){r.error("Error parsing Kvinit Response",e),l=!1}if(l)return r.info("Kvinit success!"),$(D.LastKvinit,JSON.stringify(a),e.useCookies),l;if(!j){const e=o>i.length-1?i.length-1:o,t=i[e];r.error(`Kvinit failed, attempting again in ${t} seconds`),yield new Promise((e=>{P=setTimeout(e,1e3*t)})),o++}}while(!l&&!j)},new((l=void 0)||(l=Promise))((function(e,t){function i(e){try{o(u.next(e))}catch(e){t(e)}}function n(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof l?o:new l((function(e){e(o)}))).then(i,n)}o((u=u.apply(s,a||[])).next())}));var s,a,l,u},Q=(e,t)=>{t.general&&(t.general.device_id_override&&(r.trace(`Device_id override found, going from ${e.kochavaDeviceId} to\n        ${t.general.device_id_override}`),e.kochavaConfig.general.device_id_override=t.general.device_id_override,e.kochavaDeviceId=t.general.device_id_override,$(D.OverrideDeviceId,t.general.device_id_override,e.useCookies)),t.general.app_id_override&&(r.trace(`App_id override found, going from ${e.appGuid} to\n        ${t.general.app_id_override}`),e.kochavaConfig.general.app_id_override=t.general.app_id_override,e.appGuid=t.general.app_id_override,$(D.OverrideAppId,t.general.app_id_override,e.useCookies))),t.config&&(e.kochavaConfig.config={init_token:t.config.init_token||T.config.init_token,refresh_minimum:void 0!==t.config.refresh_minimum&&null!==t.config.refresh_minimum?t.config.refresh_minimum:T.config.refresh_minimum}),t.install&&(t.install.resend_id&&(e.kochavaConfig.install.resend_id=t.install.resend_id),e.kochavaConfig.install.updates_enabled=t.install.updates_enabled||T.install.updates_enabled),t.networking&&(e.kochavaConfig.networking.retry_waterfall=t.networking.retry_waterfall||T.networking.retry_waterfall,e.retryWaterfall=e.kochavaConfig.networking.retry_waterfall,t.networking.urls&&(e.kochavaConfig.networking.urls={init:t.networking.urls.init||T.networking.urls.init,install:t.networking.urls.install||T.networking.urls.install,event:t.networking.urls.event||T.networking.urls.event,identityLink:t.networking.urls.identityLink||T.networking.urls.identityLink})),t.privacy&&(e.kochavaConfig.privacy={allow_custom_ids:t.privacy.allow_custom_ids||T.privacy.allow_custom_ids,deny_datapoints:t.privacy.deny_datapoints||T.privacy.deny_datapoints,deny_event_names:t.privacy.deny_event_names||T.privacy.deny_event_names,deny_identity_links:t.privacy.deny_identity_links||T.privacy.deny_identity_links})},K=e=>{const t=Math.floor(Date.now()/1e3);let i=(t-e.startTimeMS)/1e3;return i<0&&(i=0),{package:l(),platform:"web",starttime:e.startTimeMS/1e3,uptime:i,usertime:t}};let x,B=!1;const q=(e,t)=>{const i=J(D.FirstStartDate,e.useCookies);if(i){const e=JSON.parse(i);return t-e>2592e3?t:e}return t};var M,U,R,F,W,G,H,V,z,X,Y,Z,ee,te=ie=ne=class oe{constructor(){M.add(this),U.set(this,void 0),R.set(this,void 0),ie(this,M,"m",F).call(this),ne(this,R,new E,"f")}tatic createForNode(){const e=new oe;return e.executeAdvancedInstruction("wrapper",JSON.stringify({name:"Node",version:""})),e}static createForReact(){const e=new oe;return e.executeAdvancedInstruction("wrapper",JSON.stringify({name:"React",version:""})),e}static createForVue(){const e=new oe;return e.executeAdvancedInstruction("wrapper",JSON.stringify({name:"Vue",version:""})),e}static createForAngular(){const e=new oe;return e.executeAdvancedInstruction("wrapper",JSON.stringify({name:"Angular",version:"1.0.0"})),e}useCookies(e=!1){ie(this,U,"f").useCookies=e}disableAutoPage(e=!1){ie(this,U,"f").disableAutoPage=e}startWithAppGuid(e){e?(ie(this,U,"f")||ie(this,M,"m",F).call(this),ie(this,U,"f").started?r.warn("Kochava SDK already started."):(r.diagDebug(`Host called API: Start With App Guid ${e}`),ie(this,U,"f").started=!0,ie(this,M,"m",G).call(this),ie(this,M,"m",W).call(this,e),ie(this,U,"f").disableAutoPage||this.sendPageEvent(),ie(this,M,"m",V).call(this),ie(this,M,"m",H).call(this),ie(this,M,"m",z).call(this,e),ie(this,M,"m",X).call(this))):r.error(`Invalid appGuid ${e}, start failed.`)}shutdown(e){r.diagDebug("Host called API: Shutdown and "+(e?"delete data":"keep data")),e&&(r.debug("Deleting persisted values"),O.forEach((e=>(e=>{localStorage.removeItem(e),(e=>{if(b(e)){const t="/",i=f();document.cookie=e+"="+(t?";path="+t:"")+(i?";domain="+i:"")+";expires=Thu, 01 Jan 1970 00:00:01 GMT"}})(e)})(e)))),ie(this,U,"f").started||r.warn("SDK already shutdown."),r.info("SDK shutting down."),j=!0,clearTimeout(P),B=!0,clearTimeout(x),ie(this,R,"f").stop(),ne(this,R,new E,"f"),ie(this,M,"m",F).call(this)}setLogLevel(e){r.diagDebug(`Host called API: Set Log Level ${e}`),r.setLogLevel(e)}executeAdvancedInstruction(e,t,i){switch(r.diagDebug(`Host called API: Execute Advanced Instruction ${e}`),e){case"wrapper":{const e=JSON.parse(t);ie(this,U,"f").version||(ie(this,U,"f").version="WebTracker 3.0.4"),"Angular"===e.name?ie(this,U,"f").version+=` (${e.name} ${e.version})`:ie(this,U,"f").version+=` (${e.name})`}break;case"urls":{const e=JSON.parse(t);e.init&&(ie(this,U,"f").overrideUrls.init=e.init),e.event&&(ie(this,U,"f").overrideUrls.event=e.event),e.install&&(ie(this,U,"f").overrideUrls.install=e.install),e.identityLink&&(ie(this,U,"f").overrideUrls.identityLink=e.identityLink)}break;case"urlsRestore":{const e=JSON.parse(t);for(const t of e)"init"===t&&(ie(this,U,"f").overrideUrls.init=T.networking.urls.init),"event"===t&&(ie(this,U,"f").overrideUrls.event=T.networking.urls.event),"install"===t&&(ie(this,U,"f").overrideUrls.install=T.networking.urls.install),"identityLink"===t&&(ie(this,U,"f").overrideUrls.identityLink=T.networking.urls.identityLink)}break;case"logFilter":JSON.parse(t).forEach(();break;case"getInstance":i(JSON.stringify(ie(this,U,"f"))),r.debug(`capturing instance: ${t}`);break;case"logObjects":r.setLogObjects(JSON.parse(t))}}sendEvent(e,t){r.diagDebug("Host called API: Send Event"),e?ie(this,R,"f").enqueueEvent(ie(this,U,"f"),[e,t]):r.warn("Invalid event name, ignoring call.")}sendPageEvent(e,t){e?this.sendEvent("page",Object.assign({page_name:e},t)):this.sendEvent("page",Object.assign({page_name:g()},t))}registerIdentityLink(e,t){if(r.diagDebug(`Host called API: Register Identity Link ${e}`),!e||!t)return void r.warn("Invalid identity link, ignoring call.");if(((e,t)=>{const i=localStorage.getItem(D.IdentityLinks);if(i){const n=JSON.parse(i)||{};for(const i in n)if(e===i&&n[i]===t)return!0}return!1})(e,t))return void r.debug("Duplicate Identity Link found, ignoring.");const i={};i[e]=t,((e,t,i)=>{const n=localStorage.getItem(D.IdentityLinks),o=JSON.parse(n)||{};Object.keys(o).length>10?r.debug("Maximum stored idLinks reached, most recent idLink will not be stored."):(o[e]=t,$(D.IdentityLinks,JSON.stringify(o),i))})(e,t,ie(this,U,"f").useCookies),localStorage.getItem("com.kochava.tracker.InstallSentDate")&&ie(this,R,"f").enqueueIdLink(ie(this,U,"f"),i)}registerCustomValue(e,t){if(r.diagDebug(`Host called API: Register Custom Value ${e}`),!e||!t)return void r.warn("Invalid custom value, ignoring call.");const i={};i[e]=t,ie(this,U,"f").customValues.push({data:i,isDeviceId:!1})}registerCustomDeviceIdentifier(e,t){if(r.diagDebug(`Host called API: Register Custom Device Identifier ${e}`),!e||!t)return void r.warn("Invalid custom device identifier, ignoring call.");const i={};i[e]=t,ie(this,U,"f").customValues.push({data:i,isDeviceId:!0})}etDeviceId(){return r.diagDebug("Host called API: Get Kochava Device Id"),ie(this,U,"f").started?ie(this,U,"f").kochavaDeviceId:""}setSleep(e){r.diagDebug("Host called API: Sleep "+(e?"Stop":"Start")),e&&!ie(this,U,"f").sleep?(ie(this,U,"f").sleep=e,ie(this,R,"f").pause()):!e&&ie(this,U,"f").sleep&&(ie(this,U,"f").sleep=e,ie(this,M,"m",X).call(this))}}U=new WeakMap,R=new WeakMap,M=new WeakSet,F=function(){ne(this,U,{appGuid:"",started:!1,installStarted:!1,kvinitDone:!1,installDone:!1,disableAutoPage:!1,useCookies:!1,sleep:!1,version:"",buildDate:"",overrideUrls:{init:"",install:"",event:"",identityLink:""},customValues:[],kochavaSession:"",retryWaterfall:[],startTimeMS:0,utm:"",kochavaDeviceId:"",kochavaInstallId:"",kochavaSessionCount:-1,kochavaInstallDate:-1,kochavaConfig:void 0},"f")},W=function(i){ie(this,U,"f").appGuid=i,ie(this,U,"f").disableAutoPage=ie(this,U,"f").disableAutoPage||!1,ie(this,U,"f").useCookies=ie(this,U,"f").useCookies||!1,ie(this,U,"f").version=ie(this,U,"f").version||"WebTracker 3.0.4",ie(this,U,"f").buildDate="kbd: 7/13/2022, 12:43:16 PM",ie(this,U,"f").kochavaSession=e().substring(0,5),ie(this,U,"f").startTimeMS=t(),ie(this,U,"f").retryWaterfall=[7,30,300,1800],ie(this,U,"f").kochavaConfig=JSON.parse(JSON.stringify(T))},G=function(){if(!J(D.FirstStartDate,ie(this,U,"f").useCookies)){$(D.FirstStartDate,String(i()),ie(this,U,"f").useCookies);const e=J(D.OldKvid,ie(this,U,"f").useCookies);e&&($(D.DeviceId,e,ie(this,U,"f").useCookies),$(D.InstallSentDate,JSON.stringify(i()),ie(this,U,"f").useCookies))}},H=function(){let e={};const t=J(D.LastKvinit,ie(this,U,"f").useCookies);t&&(e=JSON.parse(t),e&&(r.trace("Found persisted kvinit.",e),Q(ie(this,U,"f"),e),r.trace("KochavaConfig after persistedKvinit:",JSON.parse(JSON.stringify(ie(this,U,"f").kochavaConfig)))));const n=J(D.KvinitSentDate,ie(this,U,"f").useCookies);if(n){const e=JSON.parse(n);if(e){const t=ie(this,U,"f").kochavaConfig.config.refresh_minimum;i()-e<t&&(ie(this,U,"f").kvinitDone=!0)}}},V=function(){ie(this,U,"f").installDone=J(D.InstallSentDate,ie(this,U,"f").useCookies).length>0,ie(this,U,"f").kochavaInstallId=J(D.InstallId,ie(this,U,"f").useCookies),ie(this,U,"f").kochavaDeviceId=(t=>{let n=J(D.DeviceId,t);return n||(n=`KB${i()}T${e()}`.replace(/-/g,"")),$(D.DeviceId,n,t),n})(ie(this,U,"f").useCookies),ie(this,U,"f").kochavaSessionCount=(e=>{const t=J(D.SessionCount,e);let i=1;return t&&(i=parseInt(t),i++),$(D.SessionCount,i.toString(),e),i})(ie(this,U,"f").useCookies),ie(this,U,"f").utm=((e,t)=>{const i=e+"_click",n=p("ko_click_id"),o=localStorage.getItem(i);let s="";return t&&(s=b(i)),n?(localStorage.setItem(i,n),t&&_(i,n)):o&&t&&_(i,n),n||o||s||""})(ie(this,U,"f").appGuid,ie(this,U,"f").useCookies)},z=function(e){r.diagInfo(`Started SDK ${ie(this,U,"f").version}\n      published ${ie(this,U,"f").buildDate}`),r.diagInfo(`The log level is set to ${r.getLogLevel()}`),r.diagDebug(`This ${ie(this,U,"f").installDone?"is not":"is"} the first tracker SDK launch`),r.diagDebug(`The kochava device id is ${ie(this,U,"f").kochavaDeviceId}`),r.diagDebug(`The kochava app GUID provided was ${e}`)},X=function(){return te(this,void 0,void 0,(function*(){ie(this,U,"f").kvinitDone?r.diagDebug("A new kvinit will not be sent"):(r.diagDebug("A new kvinit will be sent"),yield ie(this,M,"m",Y).call(this)),ie(this,M,"m",Z).call(this)&&(ie(this,U,"f").installDone=!1),r.diagDebug(`The install ${ie(this,U,"f").installDone?"has already":"has not yet"} been sent`),ie(this,U,"f").sleep||(ie(this,U,"f").installDone||(yield ie(this,M,"m",ee).call(this)),ie(this,U,"f").kvinitDone&&ie(this,U,"f").installDone&&(yield ie(this,R,"f").start(ie(this,U,"f"))))}))},Y=function(){return te(this,void 0,void 0,(function*(){ie(this,U,"f").kvinitDone=yield A(ie(this,U,"f"),ie(this,U,"f").retryWaterfall),$(D.KvinitSentDate,String(i()),ie(this,U,"f").useCookies);let e={};const t=J(D.LastKvinit,ie(this,U,"f").useCookies);t&&(e=JSON.parse(t)),Q(ie(this,U,"f"),e),r.trace("KochavaConfig after new Kvinit:",JSON.parse(JSON.stringify(ie(this,U,"f").kochavaConfig)))}))},Z=function(){let e="";ie(this,U,"f").kochavaConfig.install&&(e=ie(this,U,"f").kochavaConfig.install.resend_id);const t=((e,t)=>{const i=J(D.InstallId,t);return!!e&&(i?e!==i&&($(D.InstallId,e,t),!0):($(D.InstallId,e,t),!0))})(e,ie(this,U,"f").useCookies);return t&&r.debug(`resend_id ${e} found, forcing new install`),t},ee=function(){return te(this,void 0,void 0,(function*(){const e=(e=>{const t=k("install",e);return e.installStarted=!0,t.data=(e=>{const t=Math.floor(Date.now()/1e3);let i=(t-e.startTimeMS)/1e3;i<0&&(i=0);let n={starttime:e.startTimeMS/1e3,uptime:i,usertime:q(e,t),device_orientation:h(),package:l(),disp_w:u(),disp_h:v(),language:navigator?navigator.language:""};e.utm&&(n=Object.assign(Object.assign({},n),{conversion_data:{utm_source:e.utm}})),e.customValues.length>0&&(n.device_ids={}),e.customValues.forEach((t=>{const i=Object.keys(t.data)[0];if(e.kochavaConfig.privacy){let o=!1;for(const t of e.kochavaConfig.privacy.allow_custom_ids)i===t&&(o=!0);o&&(t.isDeviceId?n.device_ids=Object.assign(Object.assign({},n.device_ids),t.data):n=Object.assign(Object.assign({},t.data),n))}}));const o=(()=>{const e=localStorage.getItem(D.IdentityLinks);if(e)return JSON.parse(e)})();if(o){n.identity_link={};for(const t in o){let i=!0;for(const n of e.kochavaConfig.privacy.deny_identity_links)n===t&&(r.debug(`Denied identity_link ${n}, dropping from install.`),i=!1);i&&(n.identity_link[t]=o[t])}}return n})(e),r.debug("Install Payload",JSON.stringify(t)),e.kochavaConfig.privacy&&e.kochavaConfig.privacy.deny_datapoints.forEach((e=>{for(const i in t.data){const n=i;n===e&&delete t.data[n]}for(const i in t){const n=i;n===e&&delete t[n]}})),t})(ie(this,U,"f"));var i;ie(this,U,"f").installDone=yield((e,i,o=0)=>{return s=void 0,a=void 0,u=function*(){B=!1;let s,a=!1;do{const l=t()-e.startTimeMS;r.diagDebug(`Sending install at ${n(l/1e3)} seconds`);const u=yield c(i,e.overrideUrls.install?e.overrideUrls.install:e.kochavaConfig.networking.urls.install),v=t()-e.startTimeMS;if(r.diagDebug(`Completed install at ${(new Date).toLocaleTimeString()} \n      seconds with a network duration of ${n((v-l)/1e3)} seconds`),B)return r.trace("Can no longer retry install, cancelling."),!1;try{r.trace("Install Response string:",u),s=JSON.parse(u),r.debug("Install Response:",u),a=d(s.success)}catch(e){r.error("Error parsing Install Response",e),a=!1}if(a)return r.info("Install success!"),a;if(!B){const t=e.kochavaConfig.networking.retry_waterfall,i=t[o>t.length-1?t.length-1:o];r.error(`Install failed, attempting again in ${i} seconds`),yield new Promise((e=>{x=setTimeout(e,1e3*i)})),o++}}while(!a&&!B)},new((l=void 0)||(l=Promise))(();var s,a,l,u})(ie(this,U,"f"),e),ie(this,U,"f").installDone&&((i=ie(this,U,"f")).kochavaInstallDate=t(),$(D.InstallSentDate,String(i.kochavaInstallDate),i.useCookies),$(D.IdLinkQueue,JSON.stringify(ie(this,R,"f").idLinkQueue),!1))}))},window.kochava=oe.create()})();