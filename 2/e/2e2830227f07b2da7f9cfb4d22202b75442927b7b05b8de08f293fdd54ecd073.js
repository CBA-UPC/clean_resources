(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[673],{"3b/l":function(e,t,r){"use strict";function o(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()+t,e.getMinutes(),e.getSeconds(),e.getMilliseconds())}r.d(t,"a",(function(){return o}))},"6LLJ":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var o=r("a3FV"),i=r("V1Qu"),n=r("ovfp");function a(e){if(!e||!e.sharePointResourceId)return Promise.reject("no sharePointResourceId");var t=Object(i.j)(["id","name","organizationAssets"],!1,!1,"organizationAssets/officeTemplateLibrary%20ne%20null"),r=e.inMockMode&&!e.isConsumer?"".concat(e.officeHomeApiRoot,"/_api/v2.1/drives/enterpriselibraries"):"".concat(Object(i.e)(e.sharePointResourceId,e,!1,!0),"/drives").concat(t?"?"+t:"");return Object(n.a)(o.a.TemplateLibrariesRequest,"Template_Libraries",r,"network-first",e,"SharePoint",e.sharePointResourceId,"BrowseOrgTemplates","AUO")}},"9pXf":function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var o=r("QjXU"),i=r("3b/l"),n=r("Wa5Y"),a=r("zPk6"),s=r("V1Qu"),l=new Map;function c(e,t,r,c,u,d,p,f,h,_){var g=l.get(p);if(g&&(!g.expiryTime||g.expiryTime>new Date))return g.promise;l.delete(p);var m=function(i){return function(e,t,r,i,s,l,c,u,d,p,f,h,_){return Object(o.__awaiter)(this,void 0,void 0,(function(){var g;return Object(o.__generator)(this,(function(o){return g={headers:{accept:"application/json"}},[2,Object(n.a)(d,p,e,g,t,r,i,s,c,{resourceUrl:u,mockParam:"mockvroom",populateRequestEvent:function(e,t){t.RequestId=Object(a.a)(e)||e)||""},silent:f,capDialogData:h,isRetriableError:_},l).then((function(e){return e&&e.data?e.data:Promise.reject({httpResponse:e,clientError:"Invalid response"})}))]}))}))}(t,!!e.jwtAuthEnabled,e.getAccessToken,e.officeHomeApiRoot,e.correlationId,i,r,c,u,d,f,h,_)},v=(null==g?void 0:g.promise)||m("cache-only"),E=m("network-first"),b=Object(s.a)(v,E,!!g).catch(();return l.set(p,{promise:b,expiryTime:Object(i.a)(new Date,24)}),b}},BhFD:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var o=r("B5kz"),i=r("QjXU"),n=r("a3FV"),a=r("CRHC"),s=r("m32Q"),l=r("lkvL"),c=r("CMIS"),u=r("Wa5Y"),d=r("i3m/"),p=r("V1Qu"),f="vroom-fluid-enabled-api";function h(e){return Object(o.c)(["FluidEnabled"],(function(){return function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,r,o,h=this;return Object(i.__generator)(this,(function(_){return e?(t="".concat(Object(p.e)(e.sharePointResourceId,e,!1,!0),"/").concat(d.b,"root/opStream/fluidEnabled"),r={headers:{accept:"application/json",Prefer:"allow-zerobyte",application:"officehome"}},o=new Promise((function(o,i){Object(u.a)(n.a.VroomGetFluidEnabled,"Vroom_Get_Fluid_Enabled",t,r,!!e.jwtAuthEnabled,e.getAccessToken,e.officeHomeApiRoot,e.correlationId,"SharePoint",{resourceUrl:e.sharePointResourceId}).then((function(e){e&&e.data?o(e.data.isFluidEnabled):i({clientError:"Invalid response returned for Vroom get Fluid enabled request"})})).catch((function(e){Object(c.a)({eventName:"Vroom_Get_Fluid_Enabled_Error",errorType:"Vroom_Get_Fluid_Enabled_Error",message:(null==e?void 0:e.message)||"",debugInfo:(null==e?void 0:e.stack)||""}),i(e)}))})),[2,Object(a.a)((function(){return o}),(function(){return Object(s.a)({userId:e.userId,collectionName:f,collectionVersion:1,key:e.userId})}),(function(t){return Object(i.__awaiter)(h,void 0,void 0,(function(){return Object(i.__generator)(this,(function(r){switch(r.label){case 0:return[4,Object(l.a)({userId:e.userId,collectionName:f,collectionVersion:1,key:e.userId,data:t})];case 1:return r.sent(),[2]}}))}))}))]):[2,Promise.reject("vroomApiOptions not defined")]}))}))}(e)}),{staleTime:1/0,cacheTime:1/0,enabled:e})}},"DM/p":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var o=r("QjXU"),i=r("MJsD"),n=r("QLkI"),a=r("W7wX");function s(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,t,r;return Object(o.__generator)(this,(function(s){switch(s.label){case 0:return[4,Object(i.a)()];case 1:return e=s.sent(),[4,Promise.all([Object(n.a)(),Object(a.a)()])];case 2:return t=o.__read.apply(void 0,[s.sent(),2]),[2,{correlationId:e.correlationId,getAccessToken:e.getAccessToken,inMockMode:e.inMockMode,isConsumer:t[1].isMsa,jwtAuthEnabled:e.jwtAuthEnabled,officeHomeApiRoot:e.officeHomeApiRoot,oneDriveResourceId:null==(r=t[0])?void 0:r.oneDriveResourceId,sharePointResourceId:null==r?void 0:r.sharePointResourceId}]}}))}))}},"Jxb/":function(e,t,r){"use strict";var o;r.d(t,"a",(function(){return o})),o||(o={}))},PoVA:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var o=r("a3FV"),i=r("V1Qu"),n=r("9pXf");function a(e){if(!e.oneDriveResourceId)return Promise.reject("Missing oneDrive resource");var t=Object(i.e)(e.oneDriveResourceId,e,!1,!0),r="".concat(t,"/drive?select=wacBootstrapInfo");return Object(n.a)(e,r,"OneDrive",e.oneDriveResourceId,o.a.WacBootstrapInfoRequest,"Wac_Bootstrap_Info","wacBootstrapInfo",!1,{category:"TemplatesPage",fileType:"Visio"},().then((function(e){return e.wacBootstrapInfo?e.wacBootstrapInfo.wacComplianceRegion:Promise.reject({clientError:"Invalid response for wacBootStrapInfo"})}))}},V1Qu:function(e,t,r){"use strict";r.d(t,"l",(function(){return l})),r.d(t,"f",(function(){return p})),r.d(t,"k",(function(){return f})),r.d(t,"c",(function(){return h})),r.d(t,"g",(function(){return v})),r.d(t,"b",(function(){return E})),r.d(t,"e",(function(){return b})),r.d(t,"d",(function(){return I})),r.d(t,"h",(function(){return S})),r.d(t,"a",(function(){return O})),r.d(t,"i",(function(){return P})),r.d(t,"m",(function(){return U})),r.d(t,"j",(function(){return k}));var o=r("QjXU"),i=r("Jxb/"),n=r("lpeV"),a=r("amPu"),s=r("i3m/"),l="https://graph.microsoft.com",c=/http[s]?:\/\/[\S]*?\.sharepoint[\S]*?\.com/,u=/http[s]?:\/\/[\S]*?-my\.sharepoint[\S]*?\.com/,d=/http[s]?:\/\/d\.docs\.live\.net/,p=f=function(e){return e&&e.length?"$select="+e.join(","):void 0},h=function(e){return"action=".concat(e)},_=function(e){return e?"WacDataCenter=".concat(e):void 0},g=function(e){return e?"usid=".concat(e):void 0},m=v=function(e){return(null==e?void 0:e.isESSEnabled)&&(null==e?void 0:e.wacDataCenter)?[_(null==e?void 0:e.wacDataCenter),g(null==e?void 0:e.sessionId),m(null==e?void 0:e.hostCorrelationId)]:[]};function E(e){if(e&&e.length){if(e.match(u)||e.match(d))return"OneDrive";if(e.match(c))return"SharePoint";if(e.startsWith(l))return"Graph"}}function b(e,t,r,o){return void 0===r&&(r=!1),void 0===o&&(o=!1),"".concat(t.inMockMode?t.officeHomeApiRoot:e,r?"/_api":o?"/_api/v2.1":"/_api/v2.0")}function I(e,t,r){var o,a=t.isConsumer,s=t.oneDriveResourceId,l=new URL(e);if(l&&l.protocol&&l.host){var c=a?s:"".concat(l.protocol,"//").concat(l.host),u=a?p(t):b(c||"",t),d=a?"OneDrive":null!==(o=E(c||""))&&void 0!==o?o:"None";if(c&&u&&d)return{baseUrl:u,tokenType:d,resourceUrl:c,hostname:l.hostname};null==r||r.ULS.sendTraceTag(542492316,i.a.msoulscat_Wac_UnifiedUiHost,n.a.Error,"GetApiInfo failed. [InvalidResourceUrl: ".concat(!c,"][InvalidBaseUrl: ").concat(!u,"][InvalidTokenType: ").concat(!d,"]"))}else null==r||r.ULS.sendTraceTag(542492315,i.a.msoulscat_Wac_UnifiedUiHost,n.a.Error,"GetApiInfo failed. [InvalidParsedUrl: ".concat(!l,"][InvalidProtocol: ").concat(!(null==l?void 0:l.protocol),"][Invalidhost: ").concat(!(null==l?void 0:l.host),"]"))}function S(e,t,r,o){return void 0===o&&(o=!1),"".concat(r?e:l,"/").concat(o?"beta":"v1.0","/").concat(t)}function O(e,t,r){return new Promise((function(o,i){var n,a=!1,s=!1;e.then((function(e){n=e,!a&&r||(o(e),s=!0)}),(function(e){a&&(i(e),s=!0),a=!0})),t.then((,(function(e){a?(i(e),s=!0):n&&!s&&(o(n),s=!0),a=!0}))}))}function P(e){return Object(a.a)(e,{accept:"application/json",prefer:"allow-zerobyte"})}function U(e){return!!e.match(u)||!!e.match(d)||!!e.match(c)}function k(e,t,r,i,n){void 0===i&&(i=""),void 0===n&&(n="open");var a=t?Object(o.__spreadArray)([],Object(o.__read)(new Set(e.concat(s.a))),!1):e,l=a.length?"$select=".concat(a.join(",")):"",c=i?"$filter=".concat(i):"";return[l,r?"$expand=thumbnails":"",t?"action=".concat(n):"",c].filter(Boolean).join("&")}},aO3W:function(e,t,r){"use strict";r.r(t),r.d(t,"useFetchFluidEnabled",(function(){return i.a})),r.d(t,"createNewFile",(function(){return n.a})),r.d(t,"fetchVroomApiOptions",(function(){return a.a})),r.d(t,"getDriveItemChildrenWithThumbnails",(function(){return s.a})),r.d(t,"getDriveItemFromWacWithUrl",(function(){return ee})),r.d(t,"getDriveItemWithDriveIdDocId",(function(){return $})),r.d(t,"getDriveItemWithFileIdAndBaseUrl",(function(){return fe})),r.d(t,"getDriveItemWithUrl",(function(){return Y})),r.d(t,"getEnterpriseTemplatesLibraries",(function(){return he.a})),r.d(t,"getErrors",(function(){return _e})),r.d(t,"getMicroserviceUrls",(function(){return ve})),r.d(t,"getSharedItemWithParams",(function(){return Ie})),r.d(t,"getSharepointIds",(function(){return Se})),r.d(t,"getSharepointLists",(function(){return Oe})),r.d(t,"getSharepointSocketUrl",(function(){return Pe})),r.d(t,"getSharingLink",(function(){return We})),r.d(t,"getThumbnailString",(function(){return Ve})),r.d(t,"getWacComplianceRegion",(function(){return Be.a})),r.d(t,"getThumbnailUrlForItem",(function(){return He})),r.d(t,"getAccessTokenTypeFromUrl",(function(){return E.b})),r.d(t,"isOneDriveOrSharepointUrl",();var o,i=r("BhFD"),n=r("fhoW"),a=r("DM/p"),s=r("s32E"),l=r("QjXU");!o||(o={}));var c,u,d,p,f,h,_=r("Jxb/"),g=r("lpeV"),m=r("eChZ"),v=r("amPu"),E=r("V1Qu");function b(e){if(e){var t={};return e.forEach((),t}}function I(e,t){var r=[],o=new Set;return e.concat(t).forEach((function(e){return o.add(e)})),o.forEach((function(e){return r.push(e)})),r}!function(e){e[e.Failure=0]="Failure",e[e.ImpliedUsageFailure=1]="ImpliedUsageFailure",e[e.ImpliedUsageSuccess=2]="ImpliedUsageSuccess",e[e.Success=3]="Success",e[e.Usage=4]="Usage"}(c||(c={})),u||(u={})),d||(d={})),p||(p={})),f||(f={})),h||(h={}));var S,O,P,U,k,W,T,A=function(){function e(){var e=this;this._additionalPartCDimensions={},this._additionalErrorPartCDimensions={},this._alertableKpiNames=[],this._dimensions={},this._dimensionsVersion=0,this._healthConfig={_heartbeatIntervalMs:3e5,_isHealthEnabled:!1,_isOfflineEnabled:!1,_isErrorPartCEnabled:!1,_maxIntervalMs:3e4,_maxQueueSize:25,_offlineWorkerUrl:"",_pillarIntervalMs:864e5,_telemetryUrl:"",_absoluteTelemetryUrl:"",_maxConcurrentRetries:3,_retryMaxAttempts:3,_retryDelayMs:15e3,_disabledHealthEvents:new Set},this._heartbeatInitialStartCalled=!1,this._heartbeatOrderingNumber=-1,this._heartbeatRunning=!1,this._heartbeatSendTimerId=0,this._isAppOnline=!0,this._isAppShuttingDown=function(){return!1},this._kpis={},this._loggerBSqmQosErrorQueue=[],this._loggerCurrentQueueSize=0,this._loggerNonHeartbeatDiagnosticLogsOrPillarsQueueSize=0,this._loggerQueuedHeartbeatEvent=void 0,this._loggerKpiQueue=[],this._loggerQosErrorQueue=[],this._loggerQosPillarQueue=[],this._loggerDiagnosticLogQueue=[],this._loggerSendTimerId=0,this._recordPillarLastTimestamp=0,this._recordPillarTimerId=0,this._sessionPillars=[],this._hasAtLeastOneRequestSucceeded=!1,this._currentRetriesCount=0,this._initializationCompleted=!1,this._loggerCancelEventUploadTimer=this._loggerEmptyQueues=function(){e._loggerBSqmQosErrorQueue=[],e._loggerKpiQueue=[],e._loggerQosErrorQueue=[],e._loggerQueuedHeartbeatEvent=void 0,e._loggerQosPillarQueue=[],e._loggerDiagnosticLogQueue=[],e._loggerCurrentQueueSize=0,e._loggerNonHeartbeatDiagnosticLogsOrPillarsQueueSize=0},this._loggerFlush=function(){try{if(e._loggerCurrentQueueSize<=0)return;var t=e._loggerFormatPayload();e._tryUpload(t,e._dimensionsVersion,e._healthConfig._retryMaxAttempts),e._loggerEmptyQueues()}catch(e){}},this._loggerFormatPayload=function(){return{d:e._dimensions,a:e._getMergedPartC(),b:e._loggerBSqmQosErrorQueue,e:e._loggerQosErrorQueue,h:e._loggerQueuedHeartbeatEvent,q:e._loggerQosPillarQueue,k:e._loggerKpiQueue,l:e._loggerDiagnosticLogQueue,type:"h_v2"}},this._getMergedPartC=function(){return e._healthConfig._isErrorPartCEnabled&&(e._loggerBSqmQosErrorQueue&&e._loggerBSqmQosErrorQueue.length>0||e._loggerQosErrorQueue&&e._loggerQosErrorQueue.length>0)&&Object.keys(e._additionalErrorPartCDimensions).length>0?Object(l.__assign)(Object(l.__assign)({},e._additionalPartCDimensions),e._additionalErrorPartCDimensions):e._additionalPartCDimensions},this._loggerQueueEvent=function(t,r,o,i){var n;if(void 0===i&&(i=!1),r&&!e._healthConfig._disabledHealthEvents.has(o))if(e._isAppOnline){switch(t){case u.BSqmError:e._loggerBSqmQosErrorQueue.push(r);break;case u.Kpi:e._loggerKpiQueue.push(r);break;case u.QosError:e._loggerQosErrorQueue.push(r);break;case u.QosPillar:-1===e._loggerQosPillarQueue.map(().indexOf(r.n)&&e._loggerQosPillarQueue.push(r);break;case u.DiagnosticLog:e._loggerDiagnosticLogQueue.push(r)}if(e._loggerCurrentQueueSize+=1,t!==u.DiagnosticLog&&t!==u.QosPillar&&(e._loggerNonHeartbeatDiagnosticLogsOrPillarsQueueSize+=1),e._isAppShuttingDown()&&!i)return void e._loggerFlush();e._loggerCurrentQueueSize>=e._healthConfig._maxQueueSize&&(e._loggerCancelEventUploadTimer(),e._loggerSendEventsAndRequeue())}else r.o=(new Date).toJSON(),null===(n=e._offlineWorker)||void 0===n||n.postMessage({t:t,k:"".concat(e._dimensions.w,".").concat(e._dimensionsVersion),m:e._dimensions,c:e._getMergedPartC(),v:r})},this._loggerScheduleEventUploadTimer=function(){e._loggerCancelEventUploadTimer(),e._loggerSendTimerId=window.setTimeout((function(){e._loggerSendEventsAndRequeue()}),e._healthConfig._maxIntervalMs)},this._loggerSendEventsAndRequeue=function(t){void 0===t&&(t=!1),t&&e._loggerNonHeartbeatDiagnosticLogsOrPillarsQueueSize<=0||(e._loggerFlush(),e._loggerScheduleEventUploadTimer())},this._logHeartbeatEvent=function(){if(e._sessionPillars||e._kpis){e._loggerQueuedHeartbeatEvent&&-1!==e._heartbeatOrderingNumber||(e._heartbeatOrderingNumber=(e._heartbeatOrderingNumber+1)%1e3),e._loggerQueuedHeartbeatEvent||(e._loggerCurrentQueueSize+=1);var t={p:e._loggerQueuedHeartbeatEvent?I(e._loggerQueuedHeartbeatEvent.p,e._sessionPillars):e._sessionPillars,k:e._loggerQueuedHeartbeatEvent?I(e._loggerQueuedHeartbeatEvent.k,e._alertableKpiNames):e._alertableKpiNames,i:e._healthConfig._heartbeatIntervalMs,o:e._heartbeatOrderingNumber};e._loggerQueuedHeartbeatEvent=t}},this._logKpiEvent=function(t,r,o,i,n,a,s,l,c,d){if(t&&(!r||e._kpis[t])){r||e._initKpiIfNeeded(t,l,c,d);var p=e._kpis[t],f={n:p.k,e:o,t:p.t,a:p.a,f:p.o,d:null==i?void 0:i.durationMs,p:b(null==i?void 0:i.extendedProperties)};n&&(f.k={n:n,x:s,z:a}),e._loggerQueueEvent(u.Kpi,f,t)}},this._updateMinifiedPartADimensions=function(){var t,r,o,i,n,a,s,l,c,u,d,p,f,h,_,g,m,v,E,b,I,S,O,P,U,k,W,T,A,y,F,D,w,C,j,R,N,L=e._healthConfig._dimensions;L&&(e._dimensions={a:null!==(t=L.application)&&void 0!==t?t:void 0,b:null!==(r=L.applicationLcid)&&void 0!==r?r:void 0,c:null!==(o=L.applicationMode)&&void 0!==o?o:void 0,d:null!==(i=L.applicationModeExtended)&&void 0!==i?i:void 0,e:null!==(n=L.arrVersion)&&void 0!==n?n:void 0,f:null!==(a=L.browser)&&void 0!==a?a:void 0,g:null!==(s=L.browserLcid)&&void 0!==s?s:void 0,h:null!==(l=L.browserMajorVersion)&&void 0!==l?l:void 0,i:null!==(c=L.browserVersion)&&void 0!==c?c:void 0,j:null!==(u=L.clientVersion)&&void 0!==u?u:void 0,k:null!==(d=L.datacenter)&&void 0!==d?d:void 0,l:null!==(p=L.dataCulture)&&void 0!==p?p:void 0,m:null!==(f=L.flightsImpressionId)&&void 0!==f?f:void 0,n:null!==(h=L.host)&&void 0!==h?h:void 0,o:null!==(_=L.isAnonymousUser)&&void 0!==_?_:void 0,p:null!==(g=L.isBusinessUser)&&void 0!==g?g:void 0,q:null!==(m=L.isEduUser)&&void 0!==m?m:void 0,r:null!==(v=L.isSynthetic)&&void 0!==v?v:void 0,s:null!==(E=L.loggableUserId)&&void 0!==E?E:void 0,t:null!==(b=L.loggableUserIdSpace)&&void 0!==b?b:void 0,u:null!==(I=L.ring)&&void 0!==I?I:void 0,v:null!==(S=L.serverDocId)&&void 0!==S?S:void 0,w:null!==(O=L.session_id)&&void 0!==O?O:void 0,x:null!==(P=L.sessionOrigin)&&void 0!==P?P:void 0,y:null!==(U=L.tenantId)&&void 0!==U?U:void 0,z:null!==(k=L.uiHost)&&void 0!==k?k:void 0,aa:null!==(W=L.wfeVersion)&&void 0!==W?W:void 0,ab:null!==(T=L.fileExtension)&&void 0!==T?T:void 0,ac:null!==(A=L.uiHostIntegrationType)&&void 0!==A?A:void 0,ad:null!==(y=L.osVersion)&&void 0!==y?y:void 0,af:null!==(F=L.networkDownlink)&&void 0!==F?F:void 0,ag:null!==(D=L.networkDownlinkMax)&&void 0!==D?D:void 0,ah:null!==(w=L.networkEffectiveType)&&void 0!==w?w:void 0,ai:null!==(C=L.networkRTT)&&void 0!==C?C:void 0,aj:null!==(j=L.networkSaveData)&&void 0!==j?j:void 0,ak:null!==(R=L.networkType)&&void 0!==R?R:void 0,al:null!==(N=L.userLicenseType)&&void 0!==N?N:void 0})},this._logHeartbeatAndReQueue=function(){e._logHeartbeatEvent(),e._heartbeatSendTimerId=window.setTimeout((function(){e._logHeartbeatAndReQueue()}),e._healthConfig._heartbeatIntervalMs)},this._logAllPillars=function(){e._sessionPillars&&e._sessionPillars.forEach(()},this._logPillar=function(t,r){var o={};o.n=t,e._loggerQueueEvent(u.QosPillar,o,t,r)},this._logPillarsAndReQueue=function(){e._sessionPillars&&(e._recordPillarLastTimestamp=Date.now(),e._logAllPillars()),e._queueLogPillars()},this._queueLogPillars=function(t){void 0===t&&(t=e._healthConfig._pillarIntervalMs),e._recordPillarTimerId=window.setTimeout((,t)},this._startHeartbeatIfNotAlreadyStarted=function(){e._heartbeatInitialStartCalled||(e._heartbeatInitialStartCalled=!0,e._heartbeatRunning=!0,e._logHeartbeatAndReQueue())},this._stopPeriodicPillarEvents=this._startOfflineWorker=function(){if(e._healthConfig._isHealthEnabled&&e._healthConfig._isOfflineEnabled&&e._healthConfig._absoluteTelemetryUrl&&""!==e._healthConfig._absoluteTelemetryUrl&&e._healthConfig._offlineWorkerUrl&&""!==e._healthConfig._offlineWorkerUrl)try{if("undefined"==typeof Worker)return void e._diagnosticLog(p.WorkerApiIsNotAvailable);if(!e._healthConfig._offlineWorkerUrl)return void e._diagnosticLog(p.InvalidWorkerUrl);e._diagnosticLog(p.InstallingOfflineWorker);var t=new Blob(["try{importScripts('".concat(encodeURI(e._healthConfig._offlineWorkerUrl),"');}catch(e){self.postMessage({i:14,l:'W',r:e.toString()})}")],{type:"application/javascript"});e._offlineWorker=new Worker(URL.createObjectURL(t)),e._offlineWorker.onmessage=function(t){try{var r=t.data;e._diagnosticLog(r.i,r.r)}catch(t){e._diagnosticLog(p.FailedToProcessMessageFromOfflineWorker,t.toString())}},e._offlineWorker.postMessage({t:u.OfflineWorkerInit,v:e._healthConfig._absoluteTelemetryUrl}),e._offlineWorker.postMessage({t:u.OfflineWorkerFlush})}catch(t){e._diagnosticLog(p.FailedToInstallOfflineWorker,t.toString())}},this._trySendPayloadToOfflineWorker=function(t,r){var o;if(t.b.length>0||t.e.length>0||t.q.length>0||t.k.length>0||t.l.length>0)try{return null===(o=e._offlineWorker)||void 0===o||o.postMessage({t:u.OfflineWorkerFailedUpload,k:"".concat(t.d.w,".").concat(r),v:t}),h.SendSucceeded}catch(t){var i=e._convertExceptionToExtraRuntimeInfo(t);return e._diagnosticLog(p.FailedToSendEventToWorker,i),h.SendFailed}return h.DidNotAttempt},this._initKpiIfNeeded=function(t,r,o,i){t&&void 0!==r&&(e._kpis[t]||(e._kpis[t]={k:t,t:r,a:!0===o,o:null!=i?i:void 0},o&&(e._alertableKpiNames.push(t),e._logHeartbeatEvent())))},this._pillarsChanged=function(t){e._heartbeatOrderingNumber=-1,t?(e._recordPillarLastTimestamp=Date.now(),e._queueLogPillars(),e._startHeartbeatIfNotAlreadyStarted()):e._logHeartbeatEvent()},this._checkForInitialization=function(t){return!!e._initializationCompleted||(e._diagnosticLog(p.AttemptToUseFunctionalityBeforeIitialization,null==t?void 0:t.toString()),!1)},this._tryUpload=function(t,r,o){if(t){var i=e._healthConfig._telemetryUrl;if(e._hasAtLeastOneRequestSucceeded&&(o<=0||!e._isAppOnline)&&e._trySendPayloadToOfflineWorker(t,r)!==h.SendFailed)return;if(!(o<=0)){var n=e._jsonStringifyNoThrow(t,!1);if(null!==n){if(e._isAppShuttingDown())try{if(void 0!==navigator.sendBeacon){if(n.length>=65536&&e._healthConfig._isErrorPartCEnabled){var a=Object(l.__assign)(Object(l.__assign)({},t),{a:e._additionalPartCDimensions}),s=e._jsonStringifyNoThrow(a,!0);if(null===s)return;navigator.sendBeacon(i,s)}else navigator.sendBeacon(i,n);return}}catch(e){}var c=new XMLHttpRequest;c.open("POST",i,!0),c.onreadystatechange=function(){c.readyState===XMLHttpRequest.DONE&&(200===c.status?e._hasAtLeastOneRequestSucceeded||(e._hasAtLeastOneRequestSucceeded=!0):e._currentRetriesCount<e._healthConfig._maxConcurrentRetries?(e._currentRetriesCount+=1,window.setTimeout((function(){e._currentRetriesCount-=1,e._tryUpload(t,r,o-1)}),e._healthConfig._retryDelayMs)):e._hasAtLeastOneRequestSucceeded&&e._trySendPayloadToOfflineWorker(t,r))},c.send(n)}}}},this._diagnosticLog=function(t,r){e._loggerQueueEvent(u.DiagnosticLog,{i:t,r:r},t.toString())},this._convertExceptionToExtraRuntimeInfo=function(e){var t=void 0;return"string"==typeof e?t=e:e instanceof Error&&(t=e.name+" "+e.message,e.stack&&(t+=" "+e.stack)),t},this._jsonStringifyNoThrow=function(t,r){try{return t)}catch(t){var o=e._convertExceptionToExtraRuntimeInfo(t);return e._diagnosticLog(p.FailedToJsonStringifyEvent,o="ModifiedPayload: "+r+" | "+o),null}}}return e.getInstance=e.prototype.initialize=function(e){if(e)try{return this._healthConfig=function(e){var t,r,o,i,n,a,s,l,c,u,d,p,f,h,_;return{_dimensions:null!==(t=e.dimensions)&&void 0!==t?t:void 0,_heartbeatIntervalMs:null!==(r=e.heartbeatIntervalMs)&&void 0!==r?r:3e5,_isHealthEnabled:null!==(o=e.isHealthEnabled)&&void 0!==o&&o,_isOfflineEnabled:null!==(i=e.isOfflineEnabled)&&void 0!==i&&i,_isErrorPartCEnabled:null!==(n=e.isErrorPartCEnabled)&&void 0!==n&&n,_maxIntervalMs:null!==(a=e.loggerMaxIntervalMs)&&void 0!==a?a:3e4,_maxQueueSize:null!==(s=e.loggerMaxQueueSize)&&void 0!==s?s:25,_offlineWorkerUrl:null!==(l=e.offlineWorkerUrl)&&void 0!==l?l:"",_absoluteTelemetryUrl:null!==(c=e.absoluteRemoteTelemetryUrlForOfflineWorker)&&void 0!==c?c:"",_pillarIntervalMs:null!==(u=e.recordPillarToWarmPipelineIntervalMs)&&void 0!==u?u:864e5,_telemetryUrl:null!==(d=e.remoteTelemetryUrl)&&void 0!==d?d:"",_maxConcurrentRetries:null!==(p=e.maxConcurrentRetries)&&void 0!==p?p:3,_retryMaxAttempts:null!==(f=e.retryMaxAttempts)&&void 0!==f?f:3,_retryDelayMs:null!==(h=e.retryDelayMs)&&void 0!==h?h:15e3,_disabledHealthEvents:null!==(_=e.disabledHealthEvents)&&void 0!==_?_:new Set}}(e),this._updateMinifiedPartADimensions(),this._loggerScheduleEventUploadTimer(),this._startOfflineWorker(),this._initializationCompleted=!0,void this._diagnosticLog(p.InitializedHealth)}catch(e){}this._initializationCompleted=!1},e.prototype.addOrUpdatePartCDimension=function(e,t){this._checkForInitialization(f.AttemptedToAddOrUpdatePartCDimension)&&e&&(this._additionalPartCDimensions.hasOwnProperty(e)&&this._additionalPartCDimensions[e]===t||(this._loggerSendEventsAndRequeue(!0),this._additionalPartCDimensions[e]=t,this._dimensionsVersion+=1,this._logHeartbeatEvent(),this._logAllPillars()))},e.prototype.addOrUpdateErrorPartCDimension=function(e,t){this._healthConfig._isErrorPartCEnabled&&e&&(this._additionalErrorPartCDimensions[e]=t)},e.prototype.addQosPillar=function(e){if(e){var t=0===this._sessionPillars.length;-1===this._sessionPillars.indexOf(e)&&(this._sessionPillars.push(e),this._logPillar(e,!1),this._pillarsChanged(t))}},e.prototype.recordBsqmQosError=function(e,t,r){if(this._checkForInitialization(f.AttemptedToRecordBSqmQosError)&&(this._stopAllHealthTimers(!1),this._logAllPillars(),e)){var o={b:e,v:t,d:null==r?void 0:r.durationMs,p:b(null==r?void 0:r.extendedProperties),s:this._sessionPillars,i:null==r?void 0:r.inStaging};this._loggerQueueEvent(u.BSqmError,o,e),this.shutdown(!0)}},e.prototype.recordKpiFailure=function(e,t,r,o,i){this._logKpiEvent(e,!0,c.Failure,i,t,o,r)},e.prototype.recordKpiImpliedFailure=function(e,t,r,o,i,n){this._logKpiEvent(e,!1,c.ImpliedUsageFailure,n,t,o,r,S.FailureBased,!1,i)},e.prototype.recordKpiImpliedSuccess=function(e,t,r){this._logKpiEvent(e,!1,c.ImpliedUsageSuccess,r,void 0,void 0,void 0,S.FailureBased,!1,t)},e.prototype.recordKpiSuccess=function(e,t){this._logKpiEvent(e,!0,c.Success,t)},e.prototype.recordKpiUsage=function(e,t,r,o){this._logKpiEvent(e,!1,c.Usage,{extendedProperties:o},void 0,void 0,void 0,t,!1,r)},e.prototype.recordKpiUsageForAlertableKpi=function(e,t,r){if(e){var o=!0,i=this._kpis[e];i&&(o=i.t===S.FailureBased),this._logKpiEvent(e,!1,c.Usage,{extendedProperties:r},void 0,void 0,void 0,S.FailureBased,!0,t),o&&this._startHeartbeatIfNotAlreadyStarted()}},e.prototype.recordQosError=function(e,t,r,o,i,n,a){if((!n||this._checkForInitialization(f.AttemptedToRecordSessionEndingQosError))&&e&&t){var s={n:e,x:r,z:o,l:i,v:t,e:n,d:null==a?void 0:a.durationMs,p:b(null==a?void 0:a.extendedProperties),s:this._sessionPillars,i:null==a?void 0:a.inStaging};this._loggerQueueEvent(u.QosError,s,e),n&&(this._stopAllHealthTimers(!1),this._logAllPillars(),this.shutdown(!0))}},e.prototype.removeQosPillar=function(e){if(e){var t=this._sessionPillars.indexOf(e);t>-1&&(this._sessionPillars.splice(t,1),this._pillarsChanged(!1)),0===this._sessionPillars.length&&this._stopPeriodicPillarEvents()}},e.prototype.resumeAllHealthTimers=function(){if(this._heartbeatInitialStartCalled&&!this._heartbeatRunning&&this._logHeartbeatAndReQueue(),0===this._recordPillarTimerId&&0!==this._recordPillarLastTimestamp){var e=Date.now()-this._recordPillarLastTimestamp;e>=this._healthConfig._pillarIntervalMs||e<=0?this._logPillarsAndReQueue():this._queueLogPillars(this._healthConfig._pillarIntervalMs-e)}},e.prototype.setHandlerForIsAppShuttingDown=e.prototype.setIsAppOnline=function(e){var t;this._checkForInitialization(f.AttemptedToSetAppOnlineStatus)&&(!this._isAppOnline&&e&&(null===(t=this._offlineWorker)||void 0===t||t.postMessage({t:u.OfflineWorkerFlush,v:this._isAppShuttingDown()})),this._isAppOnline=e)},e.prototype.shutdown=function(e){var t;void 0===e&&(e=!1),this._healthConfig._isHealthEnabled&&(this._loggerCancelEventUploadTimer(),this._stopAllHealthTimers(!1),this._isAppShuttingDown=this._loggerFlush(),(!e||e&&this._isAppOnline)&&(null===(t=this._offlineWorker)||void 0===t||t.terminate()))},e.prototype.stopAllHealthTimers=e.prototype._stopAllHealthTimers=function(e){this._heartbeatRunning=!1,this._heartbeatOrderingNumber=-1,0!==this._heartbeatSendTimerId&&(window.clearTimeout(this._heartbeatSendTimerId),this._heartbeatSendTimerId=0),this._stopPeriodicPillarEvents(),e&&this._loggerFlush()},e.prototype.updatePartADimensions=function(e){var t=this;if(e&&this._checkForInitialization(f.AttemptedToUpdatePartADimensions)){var r=!1;Object.keys(e).forEach((function(o){null!=e[o]&&""!==e[o]&&t._healthConfig._dimensions[o]!==e[o]&&(t._healthConfig._dimensions[o]=e[o],r=!0)})),r&&(this._loggerSendEventsAndRequeue(),this._updateMinifiedPartADimensions(),this._dimensionsVersion+=1,this._logHeartbeatEvent(),this._logAllPillars())}},e.prototype.flushAndSetNewEndpoint=function(e,t){var r;e.localeCompare(null!==(r=this._healthConfig._telemetryUrl)&&void 0!==r?r:"",void 0,{sensitivity:"accent"})&&(this._loggerSendEventsAndRequeue(!1),this._healthConfig._telemetryUrl=e,t&&t())},e}(),y=function(){eturn e.prototype.isEventBlocked=function(e){var t=this.blockedEvents.get(e);return!!t&&(Date.now()>=t?(this.unblockEvent(e),!1):(this.aggregateEventCount(e),!0))},e.prototype.blockEvent=function(e,t){var r=Date.now()+t;this.blockedEvents.set(e,r),this.updateEventHitCount(e,0),this.eventDurations.delete(e),this.eventDurationsTotal.delete(e)},e.prototype.unblockEvent=e.prototype.getEventHitCount=function(e){return this.eventHitCounts.get(e)},e.prototype.updateEventHitCount=e.prototype.aggregateEventCount=function(e){var t=this.getEventHitCount(e);"number"==typeof t&&this.updateEventHitCount(e,++t)},e.prototype.getEventDurations=e.prototype.aggregateEventDuration=function(e,t){var r,o=(null!==(r=this.getEventHitCount(e))&&void 0!==r?r:0)+1,i=this.eventDurationsTotal.get(e),n=this.eventDurations.get(e);if(void 0!==n){var a=Object(l.__spreadArray)([],n,!0);n[0]>t&&(a[0]=t),n[1]<t&&(a[1]=t);var s=void 0;void 0!==i&&i.length<10?(i.push(t),s=i.reduce((,0)/o):(s=n[2]+(t-n[2])/o,this.eventDurationsTotal.delete(e)),a[2]=s,this.eventDurations.set(e,a)}else this.eventDurations.set(e,[t,t,t]),this.eventDurationsTotal.set(e,[t])},e}(),F=function(){eturn e.prototype.logKpiUsage=function(t,r,o,i){var n=this.getKpiKey(t+e.USAGE_KPI,null==o?void 0:o.extendedProperties);return!this.kpiUsageEventBlocker.isEventBlocked(n)&&(this.ensureFeatureDenominatorLoggedAndVetoPillarRegistered(o),this.recordKpiUsage(t,r,o,n),0!==i&&this.kpiUsageEventBlocker.blockEvent(n,null!=i?i:3e5),!0)},e.prototype.logKpiFailure=function(t,r,o,i,n){var a,s,l,c=this.getKpiKey(t+e.FAILURE_KPI+r,null===(a=null==o?void 0:o.additionalValues)||void 0===a?void 0:a.extendedProperties);return"number"==typeof(null===(s=null==o?void 0:o.additionalValues)||void 0===s?void 0:s.durationMs)&&this.kpiFailureEventBlocker.aggregateEventDuration(c,o.additionalValues.durationMs),!this.kpiFailureEventBlocker.isEventBlocked(c)&&(this.ensureFeatureDenominatorLoggedAndVetoPillarRegistered(),this.recordKpiFailure(t,r,o,c),i&&this.recordQosError(null!==(l=i.errorNameOverride)&&void 0!==l?l:r,i.name,i),0!==n&&this.kpiFailureEventBlocker.blockEvent(c,null!=n?n:3e5),!0)},e.prototype.logKpiSuccess=function(t,r,o){var i,n,a=this.getKpiKey(t+e.SUCCESS_KPI,null===(i=null==r?void 0:r.additionalValues)||void 0===i?void 0:i.extendedProperties);return"number"==typeof(null===(n=null==r?void 0:r.additionalValues)||void 0===n?void 0:n.durationMs)&&this.kpiSuccessEventBlocker.aggregateEventDuration(a,r.additionalValues.durationMs),!this.kpiSuccessEventBlocker.isEventBlocked(a)&&(this.ensureFeatureDenominatorLoggedAndVetoPillarRegistered(),this.recordKpiSuccess(t,r,a),0!==o&&this.kpiSuccessEventBlocker.blockEvent(a,null!=o?o:3e5),!0)},e.prototype.ensureFeatureDenominatorLoggedAndVetoPillarRegistered=function(t){var r,o=this.featureConfig.topLevelKpiName,i=this.getKpiKey(this.featureConfig.topLevelKpiName,null==t?void 0:t.extendedProperties);if(!this.kpiUsageEventBlocker.isEventBlocked(null!=i?i:"")){this.recordKpiUsage(o,S.FailureBased,t);var n=null!==(r=this.featureConfig.vetoPillar)&&void 0!==r?r:this.featureConfig.areaName;n&&e.QOS_PILLARS_LIST.includes(n)&&this.healthLogger.addQosPillar(n),this.kpiUsageEventBlocker.blockEvent(null!=i?i:"",864e5)}},e.prototype.recordKpiUsage=function(e,t,r,o){var i;void 0===r&&(r={});var n=(i=r||{}).extendedProperties,a=i.isForAlertableKpi,s=this.createExtendedPropertiesWithMoreFields(n,o);a?this.healthLogger.recordKpiUsageForAlertableKpi(e,this.featureConfig.crewAlias,s):this.healthLogger.recordKpiUsage(e,t,this.featureConfig.crewAlias,s)},e.prototype.getKpiKey=function(e,t){var r=this.getKpiAreaName(t),o=this.getKpiFeatureName(t),i=this.getKpiPivot(t);return"".concat(r,".").concat(o,".").concat(null!=e?e:"").concat(i&&0===i.length?"."+i:"")},e.prototype.getKpiAreaName=function(t){var r,o,i;return null!==(i=null!==(o=null!==(r=null==t?void 0:t.get(e.AREA_NAME_COLUMN_KEY))&&void 0!==r?r:this.featureConfig.areaName)&&void 0!==o?o:this.featureConfig.vetoPillar)&&void 0!==i?i:""},e.prototype.getKpiFeatureName=function(t){var r,o;return null!==(o=null!==(r=null==t?void 0:t.get(e.FEATURE_NAME_COLUMN_KEY))&&void 0!==r?r:this.featureConfig.featureName)&&void 0!==o?o:""},e.prototype.getKpiPivot=function(t){var r=null==t?void 0:t.get(e.PIVOT_TYPE_COLUMN_KEY),o=null==t?void 0:t.get(e.PIVOT_VALUE_COLUMN_KEY);return r&&0!==r.length&&o&&0!==o.length?"".concat(r,"=").concat(o):""},e.prototype.recordKpiFailure=function(e,t,r,o){var i;void 0===r&&(r={});var n=(i=r||{}).isIntentional,a=i.isInternal,s=i.hasImpliedUsage,l=this.createAdditionalValuesWithMoreFields(i.additionalValues,o);!1===s?this.healthLogger.recordKpiFailure(e,t,n,a,l):this.healthLogger.recordKpiImpliedFailure(e,t,n,a,this.featureConfig.crewAlias,l)},e.prototype.recordKpiSuccess=function(e,t,r){var o;void 0===t&&(t={});var i=(o=t||{}).additionalValues,n=o.hasImpliedUsage,a=this.createAdditionalValuesWithMoreFields(i,r);!1===n?this.healthLogger.recordKpiSuccess(e,a):this.healthLogger.recordKpiImpliedSuccess(e,this.featureConfig.crewAlias,a)},e.prototype.recordQosError=function(e,t,r){void 0===r&&(r={});var o=r.isIntentional,i=r.isInternal,n=r.alertOnPillar,a=r.isSessionEndingError,s=this.createAdditionalValuesWithMoreFields(r.additionalValues);this.healthLogger.recordQosError(e,[t],o,i,n,a,s)},e.prototype.createExtendedPropertiesWithMoreFields=function(t,r){var o=new Map(t||new Map);if(o.get(e.FEATURE_NAME_COLUMN_KEY)||o.set(e.FEATURE_NAME_COLUMN_KEY,this.getKpiFeatureName(t)),o.set(e.AREA_NAME_COLUMN_KEY,this.getKpiAreaName(o)),o.has(e.SKIP_ARIA_COLUMN_KEY)||o.has("skipAria")||o.set(e.SKIP_ARIA_COLUMN_KEY,"true"),!this.featureConfig.doNotEmitAggregatedCount&&r){var i=this.getEventBlocker(r);if(i){var n=i.getEventHitCount(r);if(n){o.set(e.AGGREGATED_COUNT_COLUMN_KEY,n.toString());var a=i.getEventDurations(r);n>1&&a&&o.set(e.AGGREGATED_DURATION_COLUMN_KEY,a.map(().toString())}}}return o},e.prototype.createAdditionalValuesWithMoreFields=function(e,t){var r={};return(r=Object(l.__assign)({},e)).extendedProperties=this.createExtendedPropertiesWithMoreFields(null==e?void 0:e.extendedProperties,t),r},e.prototype.getEventBlocker=function(t){return t.endsWith(e.USAGE_KPI)?this.kpiUsageEventBlocker:t.includes(e.FAILURE_KPI)?this.kpiFailureEventBlocker:t.endsWith(e.SUCCESS_KPI)?this.kpiSuccessEventBlocker:void 0},e.FEATURE_NAME_COLUMN_KEY="FeatureName",e.AREA_NAME_COLUMN_KEY="AreaName",e.AGGREGATED_COUNT_COLUMN_KEY="AggCount",e.AGGREGATED_DURATION_COLUMN_KEY="AggMs",e.SKIP_ARIA_COLUMN_KEY="SkipAria",e.PIVOT_TYPE_COLUMN_KEY="PivotType",e.PIVOT_VALUE_COLUMN_KEY="PivotValue",e.QOS_PILLARS_LIST=["Interruptions","Open","NotebookNavigation","Fidelity","AsyncCollab","Present","ContentConsumption","bSqmCompatibility","Boot"],e.USAGE_KPI=".Usage",e.SUCCESS_KPI=".Success",e.FAILURE_KPI=".Failure.",e}(),D=function(){function e(t,r,o,i,n){var a,s,c,u=this;this.healthLogger=t,this.featureConfig=r,this.kpiUsageEventBlocker=o,this.kpiFailureEventBlocker=i,this.kpiSuccessEventBlocker=n,this.featureUsageAndHealthLogger=new F(this.healthLogger,this.featureConfig,null!==(a=this.kpiUsageEventBlocker)&&void 0!==a?a:e.kpiUsageBlocker,null!==(s=this.kpiSuccessEventBlocker)&&void 0!==s?s:e.kpiFailureBlocker,null!==(c=this.kpiFailureEventBlocker)&&void 0!==c?c:e.kpiSuccessBlocker),this.executeCallbackWithLogging=function(e,t){var r,o,i,n=function(e){return"VetoFailureLoggingParams".includes(e)};(null==t?void 0:t.kpiUsageLoggingParams)?(o="Usage",i=null==t?void 0:t.kpiUsageLoggingParams):(null==t?void 0:t.kpiSuccessLoggingParams)?(o="UsageWithSuccess",i=null==t?void 0:t.kpiSuccessLoggingParams):(null==t?void 0:t.kpiFailureLoggingParams)?(o="UsageWithFailure",i=null==t?void 0:t.kpiFailureLoggingParams):(o="UsageWithVetoFailure",i=null==t?void 0:t.vetoFailureLoggingParams);var a=null==i?void 0:i.usageName,s=null==i?void 0:i.usageKpiType;u.logKpiUsage({kpiName:a,kpiType:null!=s?s:S.FailureBased});try{null==e||e(),"UsageWithSuccess"===o&&function(e){return"KpiSuccessLoggingParams".includes(e)}(i)&&u.logKpiSuccess({kpiName:a,optionalProperties:i.successOptionalProperties})}catch(e){if("UsageWithFailure"===o&&i)||"UsageWithVetoFailure"===o&&n(i)){var c=void 0;n(i)&&(c=Object(l.__assign)({name:null!==(r=i.vetoName)&&void 0!==r?r:""},i.vetoOptionalProperties)),u.logKpiFailure({kpiName:i.usageName,errorName:i.failureErrorName,optionalProperties:i.failureOptionalProperties,optionalVeto:c})}throw e}}}return e.getInstance=e.prototype.logKpiUsage=function(e){var t;return!(!e||!e.kpiName)&&this.featureUsageAndHealthLogger.logKpiUsage(e.kpiName,null!==(t=e.kpiType)&&void 0!==t?t:S.FailureBased,e.optionalProperties,e.blockFutureEmissionDurationInMs)},e.prototype.logKpiFailure=function(e){return!!(e&&e.kpiName&&e.errorName)&&this.featureUsageAndHealthLogger.logKpiFailure(e.kpiName,e.errorName,e.optionalProperties,e.optionalVeto,e.blockFutureEmissionDurationInMs)},e.prototype.logKpiSuccess=function(e){return!(!e||!e.kpiName)&&this.featureUsageAndHealthLogger.logKpiSuccess(e.kpiName,e.optionalProperties,e.blockFutureEmissionDurationInMs)},e.prototype.ensureFeatureDenominatorLoggedAndVetoPillarRegistered=function(e){this.featureUsageAndHealthLogger.ensureFeatureDenominatorLoggedAndVetoPillarRegistered(e)},e.kpiUsageBlocker=new y,e.kpiFailureBlocker=new y,e.kpiSuccessBlocker=new y,e}(),w=function(){function e(){}return e.prototype.getHealthInstance=function(e){if(e)return A.getInstance().initialize(e),A.getInstance()},e.prototype.getExtendedHealthInstance=function(e,t){if(e&&t)return D.getInstance(e,t)},e}();!function(e){e[e.FailureBased=0]="FailureBased",e[e.SuccessBased=1]="SuccessBased"}(S||(S={})),new w,function(e){e.DriveId="drive",e.ItemId="item",e.DocUrl="file",e.ContentUri="contenturi",e.Nav="nav"}(O||(O={})),P||(P={})),function(e){e.QosVeto_ShareDialogExperienceDegraded="ShareDialogExperienceDegraded",e.QosVeto_CreateNewExperienceDegraded="CreateNewExperienceDegraded",e.QosVeto_ExternalLinksExperienceDegraded="ExternalLinksExperienceDegraded",e.QosVeto_WopiAuthExperienceDegraded="WopiAuthExperienceDegraded",e.QosVeto_FilePickerFailed="FilePickerFailed",e.QosVeto_OpenInExperienceFailed="OpenInExperienceFailed",e.QosVeto_OwlFrameExperienceFailed="OwlFrameExperienceFailed"}(U||(U={})),k||(k={})),W||(W={})),T||(T={}));var C,j,R={};!function(e){e.New="NEW",e.BackstageMru="BACKSTAGE-MRU",e.Reboot="REBOOT"}(C||(C={})),j||(j={}));var N,L,M,H=r("3b/l");function Q(e,t,r,o){var i=this;void 0===r&&(r=!1),R.driveItemStartTime=Date.now(),N||(N=new Map);var n=N.get(e);if(!r&&n&&n.promise&&(!n.expiryTime||n.expiryTime>new Date))return R.driveItemEndTime=Date.now(),null==o||o.ULS.sendTraceTag(553726288,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"GetDriveItem: Returning drive item from the cache"),n.promise;null==o||o.ULS.sendTraceTag(553726289,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"GetDriveItem: Invalidating the cache"),N.delete(e),null==o||o.ULS.sendTraceTag(546182045,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"GetDriveItem: About to make the fetch call to get drive item");var a=fetch(e,{method:"GET",headers:t.headers}).catch((function(e){return Promise.reject({api:"getItem",failure:e,message:"Fetch call failed",retry:!0})})).then((function(t){return Object(l.__awaiter)(i,void 0,void 0,(function(){var r,i,n,s,c,u,d,p,f,h;return Object(l.__generator)(this,(function(m){switch(m.label){case 0:if(200==t.status)return r=t.json().then((function(e){return e||Promise.reject({api:"getItem",status:t.status,message:"Ok httpStatus, invalid response"})})),i=new Map,s=null===(c=null==t?void 0:t.headers)||void 0===c?void 0:c.get("SPRequestGuid"),R.spRequestGuid=null!=s?s:void 0,i.SPRequestGuid=s,null==o||o.ULS.sendTraceTag(554964099,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"GetDriveItem:  [VroomResponseHeaders: ".concat(JSON.stringify(i),"]")),N.set(e,{promise:a,expiryTime:Object(H.a)(new Date,24)}),[2,r];m.label=1;case 1:return m.trys.push([1,3,,4]),[4,t.json()];case 2:return n=m.sent(),s=null===(u=null==t?void 0:t.headers)||void 0===u?void 0:u.get("SPRequestGuid"),R.spRequestGuid=null!=s?s:void 0,[2,Promise.reject(Object(l.__assign)({api:"getItem",SPRequestGuid:s,status:t.status,errorCode:null===(d=null==n?void 0:n.error)||void 0===d?void 0:d.code,innerErrorCode:null===(f=null===(p=null==n?void 0:n.error)||void 0===p?void 0:p.innerError)||void 0===f?void 0:f.code,message:null===(h=null==n?void 0:n.error)||void 0===h?void 0:h.message,redirectLocation:(null==n?void 0:n.error)?null==n?void 0:n.error["@error.redirectLocation"]:void 0},G(t)))];case 3:return m.sent(),[2,Promise.reject({api:"getItem",status:t.status,message:"request failed, could not retrieve error object."})];case 4:return[2]}}))}))})).finally(();return a}function G(e){var t,r,o,i=null===(o=null==e?void 0:e.headers)||void 0===o?void 0:o.get("www-authenticate"),n=void 0,a=void 0;if(i){var s=i.split(",");if(s)try{for(var c=Object(l.__values)(s),u=c.next();!u.done;u=c.next()){var d=u.value,p=d&&d.trim();p&&p.startsWith("error=")?n=p.split('"')[1]:p&&p.startsWith("claims=")&&(a=[p.split('"')[1]])}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}}return{claimsError:n,claims:a}}var V,B="getItemFromWac",K="GetDriveItem",x=new Map;function q(e,t,r){return Object(l.__awaiter)(this,void 0,void 0,(function(){var o;return Object(l.__generator)(this,(function(i){switch(i.label){case 0:L=Date.now(),x.set("StartTime",L.toString()),void 0===r&&(null==t||t.ULS.sendTraceTag(526951836,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"GetDriveItem: Health object not initialized")),null==r||r.recordKpiUsage(K,S.FailureBased,"owlfc",x),x.delete("StartTime"),R.driveItemFromWacStartTime=Date.now(),i.label=1;case 1:return i.trys.push([1,3,4,5]),null==t||t.ULS.sendTraceTag(523867683,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"GetDriveItem: About to make the fetch call to get drive item"),[4,fetch(e.url,{method:e.method,headers:e.headers,body:JSON.stringify(e.body)})];case 2:return[2,J(i.sent(),t,r)];case 3:return o=i.sent(),M=Date.now(),x.set("DriveItemError",JSON.stringify(o)),x.set("FailureTime",M.toString()),null==r||r.recordKpiFailure(K,"GetDriveItemRequestFailed",!1,!1,{durationMs:M-L,extendedProperties:x}),[2,Promise.reject({api:B,failure:o,message:"Fetch vroom response from wac call failed"})];case 4:return R.driveItemFromWacEndTime=Date.now(),[7];case 5:return[2]}}))}))}function J(e,t,r){var o,i,n;return Object(l.__awaiter)(this,void 0,void 0,(function(){var a,s;return Object(l.__generator)(this,(function(l){switch(l.label){case 0:return 200!=e.status?[3,1]:[2,z(e,t)];case 1:M=Date.now(),x.set("FailureTime",M.toString()),null==r||r.recordKpiFailure(K,"WacHootServiceNotAvailable",!1,!0,{durationMs:M-L,extendedProperties:x}),l.label=2;case 2:return l.trys.push([2,4,,5]),[4,e.json()];case 3:return a=l.sent(),s=null===(o=null==e?void 0:e.headers)||void 0===o?void 0:o.get("SPRequestGuid"),R.spRequestGuid=null!=s?s:void 0,[2,Promise.reject({api:B,SPRequestGuid:s,status:e.status,errorCode:null===(i=null==a?void 0:a.error)||void 0===i?void 0:i.code,message:null===(n=null==a?void 0:a.error)||void 0===n?void 0:n.message})];case 4:return l.sent(),[2,Promise.reject({api:B,status:e.status,message:"Request to wac failed, could not reach out wac for retrieving object."})];case 5:return[2]}}))}))}function z(e,t){var r,o,i=null===(r=null==e?void 0:e.headers)||void 0===r?void 0:r.get("x-behind-service-response-status"),n=i?parseInt(i):500,a=new Map,s=null===(o=null==e?void 0:e.headers)||void 0===o?void 0:o.get("SPRequestGuid");return R.spRequestGuid=null!=s?s:void 0,a.SPRequestGuid=s,null==t||t.ULS.sendTraceTag(526951837,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"GetDriveItemFromWac: [VroomResponseHeaders: ".concat(JSON.stringify(a),"]. The http response status code from downstream service to wac: ").concat(n.toString())),200==n?e.json().then((function(t){return t||Promise.reject({api:B,SPRequestGuid:s,status:e.status,message:"Ok httpStatus, invalid response"})})):Promise.reject(Object(l.__assign)({api:B,SPRequestGuid:s,status:e.status,sharePointCallStatus:n,message:"Request to wac succeed, wac failed to retrieve object in downstream service."},G(e)))}function Y(e,t,r,o,i,n,a){return void 0===i&&(i=!1),void 0===a&&(a=E.i),Object(l.__awaiter)(this,void 0,void 0,(function(){return Object(l.__generator)(this,(function(s){return e?[2,t(r,i,o,void 0,!0).then(a).then((function(t){return Q(e,{headers:t},i,n)})).catch((function(s){return null==n||n.ULS.sendTraceTag(512255580,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Warning,"GetDriveItemWithUrl: error when trying to getDriveItem: ".concat(s)),s&&401==s.status&&"insufficient_claims"===s.claimsError&&"authChallengeRequired"===s.innerErrorCode&&s.claims?(null==n||n.ULS.sendTraceTag(523076960,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Warning,"GetDriveItemWithUrl: vroom call failed with claims challenge. Retry with claims"),t(r,i,o,void 0,!0,s.claims).then(a).then(()):Promise.reject(s)}))]:[2,Promise.reject("No api endpoint given")]}))}))}function X(e){if(!e)return null;var t=new URL(e);return t.protocol+"//"+t.host}function $(e,t,r,o,i,n,a){var s;void 0===o&&(o=!1),void 0===i&&(i="open");var c=e.driveId,u=e.docId,d=e.baseUrl,p=e.docUrl;if(!c||!u)return Promise.reject("Not enough document information was given to retrieve the item");var f,h,m=Object(l.__spreadArray)([Object(E.k)(t),Object(E.c)(i)],Object(l.__read)(Object(E.g)(a)),!1).filter((function(e){return!!e})).join("&"),v=X(null!=d?d:p);v?(h=v,f="".concat(d||v,"/_api/v2.0"),null==n||n.ULS.sendTraceTag(543958855,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"making vroom service call with driveId+docId")):(h=E.l,f="".concat(E.l,"/v1.0"),null==n||n.ULS.sendTraceTag(543958856,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"making graph service call with driveId+docId"));var b="".concat(f,"/drives/").concat(encodeURIComponent(c),"/items/").concat(encodeURIComponent(u),"/?").concat(m),I=null!==(s=Object(E.b)(h))&&void 0!==s?s:"None";return Y(b,r.getAccessToken,I,h,o,n)}var Z="e03a13ee-9730-4cae-8525-47559c8cf18a";function ee(e,t,r,i,n,a,s){var c=this,u={docBootInfo:r,essOptions:n};return V=function(e,t){return"".concat(function(e,t){switch(e){case"FASTFOOD":return"https://ffc-common.online.office.com/suite/";case"MSIT":return"https://ppc-common.online.office.com/suite/";case"PRODUCTION":default:return void 0===o.EuropeanUnion?"https://euc-common.online.office.com/suite/":"https://common.online.office.com/suite/";case"GALLATIN":return"https://common.partner.officewebapps.cn/suite/";case"USGOV":return"https://gbc-common.online.office.com/suite/";case"TRAILBLAZER":return"https://common.gov.online.office365.us/suite/";case"PATHFINDER":return"https://common.dod.online.office365.us/suite/";case"AIRGAP08":return"https://common.wac.online.office.eaglex.ic.gov/suite/";case"AIRGAP09":return"https://common.wac.online.office.microsoft.scloud/suite/"}}(e),"OpenDocument.ashx").concat("")}(i),ie(e,r).then((function(o){return function(e,t){return Object(l.__awaiter)(this,void 0,void 0,(function(){var r,o;return Object(l.__generator)(this,(function(i){switch(i.label){case 0:if(r=null==m.a?void 0:m.a.getItem(Z))try{if((o=JSON.parse(r))&&o.token&&o.expiryTime&&parseInt(o.expiryTime)>(new Date).getTime()/1e3)return null==t||t.ULS.sendTraceTag(524821017,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"GetDriveItemFromWacWithUrl: Fetched valid access token from the windows local storage cache"),[2,o.token];null==m.a||m.a.removeItem(Z)}catch(e){console.log("Error parsing tokenItem in local storage: ".concat(r)),null==m.a||m.a.removeItem(Z)}return[4,e("None",!0,Z,void 0,!0)];case 1:return[2,i.sent()]}}))}))}(e.getAccessToken,a).then((function(i){var n=),d=te(n,u,t,i,o);return q(d,a,s).then((function(e){return re(e,i),oe(e,a)})).catch((function(o){return Object(l.__awaiter)(c,void 0,void 0,(function(){return Object(l.__generator)(this,(function(l){return null==a||a.ULS.sendTraceTag(526471961,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Error,"GetDriveItemFromWacWithUrl: Retrying getDriveItemFromWac. [Error: ".concat(JSON.stringify(o),"][FailureReason: ").concat(null==o?void 0:o.failure,"]")),o&&401==o.sharePointCallStatus&&"insufficient_claims"===o.claimsError&&o.claims?(null==a||a.ULS.sendTraceTag(512492100,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Warning,"GetDriveItemFromWacWithUrl: Wac call vroom failed with claims challenge. Retry with claims"),[2,ie(e,r,o.claims).then((function(e){return q(te(n,u,t,i,e),a,s).then((function(e){return re(e,i),oe(e,a)}))}))]):[2,q(d,a,s).then(()]}))}))}))}))}))}function te(e,t,r,o,i){var n={Authorization:Object(v.a)(o).Authorization,SessionId:r,SharePointToken:Object(v.a)(i).Authorization},a=Object(l.__assign)(Object(l.__assign)({},t),{optionsHttpRequestHeaders:n});return{url:V,method:"POST",headers:e,body:a}}function re(e,t){e&&e.KMSI&&(null==m.a||m.a.setItem(Z,JSON.stringify({token:t,expiryTime:e.wacTokenExpTime})))}function oe(e,t){if(e)try{return JSON.parse(e.graphDriveItem)}catch(e){null==t||t.ULS.sendTraceTag(520439698,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Error,"GetDriveItemFromWacWithUrl: Failed to parse vroom response from string to JSON. [Error: ".concat(JSON.stringify(e),"]"))}return Promise.reject({api:"getItemFromWac",message:"Failed to parse response data from string to JSON due to invalid data or format"})}function ie(e,t,r){var o,i,n,a=X(null!==(i=null!==(o=t.shareUrl)&&void 0!==o?o:t.baseUrl)&&void 0!==i?i:t.docUrl);!a&&t.driveId&&t.docId&&(a=E.l);var s=null!==(n=Object(E.b)(a||""))&&void 0!==n?n:"None";return e.getAccessToken(s,!1,null!=a?a:void 0,void 0,!0,r)}function ne(e,t,r,o){if(void 0===o&&(o=""),o?null==r||r.ULS.sendTraceTag(521414033,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Error,'Invalid value for key "'.concat(o,'". Expected type ').concat(JSON.stringify(e)," but got ").concat(JSON.stringify(t))):null==r||r.ULS.sendTraceTag(521414034,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Error,"Invalid value ".concat(JSON.stringify(t)," for type ").concat(JSON.stringify(e))),"boolean"==typeof e){if("string"==typeof t){var i=function(e){try{var t=JSON.parse(e.toLowerCase());return"boolean"==typeof t&&t}catch(e){return!1}}(t);if("boolean"==typeof i)return i}return!1}return"string"==typeof e?"":"number"==typeof e?0:typeof e==typeof[]?[]:"Date"===e?new Date:"array"===e?[]:"object"===e?{}:void 0}function ae(e){if(void 0===e.jsonToJS){var t={};e.props.forEach((function(e){return t[e.json]={key:e.js,typ:e.typ}})),e.jsonToJS=t}return e.jsonToJS}function se(e){if(void 0===e.jsToJSON){var t={};e.props.forEach((),e.jsToJSON=t}return e.jsToJSON}function le(e,t,r,o,i){void 0===i&&(i="");var n=t;if("any"===n)return e;if(null===n)return null===e?e:ne(n,e,o);if(!1===n)return ne(n,e,o);for(;"object"==typeof n&&void 0!==n.ref;)n=pe[n.ref];return Array.isArray(n)?function(e,t){return-1!==e.indexOf(t)?t:ne(e,t,o)}(n,e):"object"==typeof n?n.hasOwnProperty("unionMembers")?function(e,t){for(var i=e.length,n=0;n<i;n++){var a=e[n];try{return le(t,a,r,o)}catch(e){}}return ne(e,t,o)}(n.unionMembers,e):n.hasOwnProperty("arrayItems")?function(e,t){return Array.isArray(t)?t.map(():ne("array",t,o)}(n.arrayItems,e):n.hasOwnProperty("props")?function(e,t,i){if(null===i||"object"!=typeof i||Array.isArray(i))return ne("object",i,o);var n={};return Object.getOwnPropertyNames(e).forEach((function(t){var a=e[t],s=Object.prototype.hasOwnProperty.call(i,t)?i[t]:void 0;n[a.key]=le(s,a.typ,r,o,a.key)})),Object.getOwnPropertyNames(i).forEach((function(a){Object.prototype.hasOwnProperty.call(e,a)||(n[a]=le(i[a],t,r,o,a))})),n}(r(n),n.additional,e):ne(n,e,o):n===Date&&"number"!=typeof e?function(e){if(null===e)return null;var t=new Date(e);return isNaN(t.valueOf())?ne("Date",e,o):t}(e):function(e,t){return typeof e==typeof t?t:ne(e,t,o,i)}(n,e)}function ce(e){return{arrayItems:e}}function(){.toFeatureGateConfig=function(e,t){if(null==e||""===e||"null"===e)return[];try{return function(e,t,r){return le(e,t,ae,r)}(JSON.parse(e),ce(ue("FeatureGateConfig")),t)}catch(r){return null==t||t.ULS.sendTraceTag(521413921,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Error,'Unable to parse JSON string: "'.concat(e,'", due to expection: ').concat(r)),[]}},e.featureGateConfigToJson=function(e,t){return JSON.stringify(e,ce(ue("FeatureGateConfig")),t),null,2)}}();var de,pe={FeatureGateConfig:function(e,t){return{props:[{json:"ConfigId",js:"ConfigId",typ:""},{json:"IsEnabled",js:"IsEnabled",typ:!0},{json:"SettingsRings",js:"SettingsRings",typ:""}],additional:!1}}()};function fe(e,t,r,o,i,n,a,s,c){var u;if(void 0===i&&(i=!1),void 0===n&&(n="open"),!e||!t)return Promise.reject("Not enough document information was given to retrieve the item");var d,p=new URL(t),f="".concat(p.protocol,"//").concat(p.host),h=Object(l.__spreadArray)([Object(E.k)(r),Object(E.c)(n)],Object(l.__read)(Object(E.g)(s)),!1).filter((function(e){return!!e})).join("&");!function(e,t,r){null==r||r.ULS.sendTraceTag(521164238,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"".concat(e,": ").concat(t?"Enabled":"Disabled"))}(de.FeatureGate_Vroom21SupportGate,c,a),d=c?"".concat(t,"/_api/v2.1/sites/root/items/").concat(encodeURIComponent(e),"/driveItem?").concat(h):"".concat(t,"/_api/v2.0/sites/root/items/").concat(encodeURIComponent(e),"/driveItem?").concat(h);var m=null!==(u=Object(E.b)(t))&&void 0!==u?u:"None";return Y(d,o.getAccessToken,m,f,i,a)}!de||(de={}));var he=r("6LLJ");function _e(e){var t={Id:"",Details:""},r=e.status,o="string"==typeof e.errorCode?e.errorCode:"",i="object"==typeof e.message&&null!==e.message?e.message.toString():"";switch(r){case 200:t="MissingProperty"===o?{Id:500..toString(),Details:"No data retrieved"}:"ParsingResponseFailed"===o?{Id:500..toString(),Details:i}:{Id:null!=o?o:500..toString(),Details:i};break;case 0:t={Id:503..toString(),Details:"Unable to connect to service"};break;case 503:t={Id:503..toString(),Details:"Service Unavailable"};break;default:t={Id:r.toString(),Details:i}}return t}var ge=r("a3FV"),me=r("9pXf");function ve(e,t){if(!e.sharePointResourceId)return Promise.reject("Missing sharepoint resource");var r=Object(E.e)(e.sharePointResourceId,e,!0),o="".concat(r,"/microservicemanager/getserviceurls?service=%27").concat(t,"%27");return Object(me.a)(e,o,"SharePoint",e.sharePointResourceId,ge.a.SharePointMicroserviceUrlsRequest,"SharePoint_Microservice_Urls","microserviceUrls").then((function(e){return e.value?e.value:Promise.reject({clientError:"Invalid response"})}))}function Ee(e){var t={accept:"application/json",prefer:"redeemSharingLink,allow-zerobyte,manualRedirect"};return Object(v.a)(e,t),t}var be=function Ie(e,t,r,o,i,n,a,s){void 0===o&&(o=!1),void 0===i&&(i="open"),void 0===n&&(n=!1);var c=r.inMockMode,u=r.getAccessToken,d=function(e,t){try{null==t||t.ULS.sendTraceTag(541870043,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Info,"getSharesUrl: Start constructing shares Url");for(var r=e.replace(/[,@+$#]/g,(),o=window.btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,())),i=o.length-1;"="===o.charAt(i);)--i;var n=o.slice(0,i+1).replace(/\+/g,"-").replace(/\//g,"_");return"shares/u!".concat(n,"/driveItem")}catch(e){return void(null==t||t.ULS.sendTraceTag(541872152,_.a.msoulscat_Wac_UnifiedUiHost,g.a.Error,"getSharesUrl: Failed to get Share Url. ".concat(e)))}}(e,a);if(!d)return Promise.reject("No shareUrl");var p=Object(E.d)(e,r,a);if(!p)return Promise.reject("No apiInfo");var f=new Date;f.setSeconds(0,0);var h=Object(l.__spreadArray)([Object(E.k)(t),Object(E.c)(i),be(n)],Object(l.__read)(Object(E.g)(s)),!1).filter(().join("&"),m=c?"shares?itemUrl=".concat(encodeURIComponent(d),"&currentDate=").concat(f.toISOString()):"".concat(d,"?").concat(h);return Y("".concat(p.baseUrl,"/").concat(m),u,p.tokenType,p.resourceUrl,o,a,Ee)}function Se(e){if(!e.oneDriveResourceId)return Promise.reject("Missing oneDrive resource");var t=Object(E.e)(e.oneDriveResourceId,e),r="".concat(t,"/me/drive/root?select=sharepointids");return Object(me.a)(e,r,"OneDrive",e.oneDriveResourceId,ge.a.SharePointIdsRequest,"SharePoint_Ids","sharepointIds").then((function(e){return e.sharepointIds?e.sharepointIds:Promise.reject({clientError:"Invalid response"})}))}function Oe(e,t){if(!e.oneDriveResourceId)return Promise.reject("Missing oneDrive resource");var r=Object(E.e)(e.oneDriveResourceId,e),o="".concat(r,"/sites/").concat(t,"/lists?select=name,id");return Object(me.a)(e,o,"OneDrive",e.oneDriveResourceId,ge.a.SharePointListsRequest,"SharePoint_Lists","sharepointLists").then((function(e){return e.value?e.value:Promise.reject({clientError:"Invalid response"})}))}function Pe(e,t,r){if(!e.oneDriveResourceId)return Promise.reject("Missing oneDrive resource");var o=Object(E.e)(e.oneDriveResourceId,e),i="".concat(o,"/sites/").concat(t,"/lists/").concat(r,"/subscriptions/socketio");return Object(me.a)(e,i,"OneDrive",e.oneDriveResourceId,ge.a.SharePointWebsocketRequest,"SharePoint_Websocket","sharepointSocket").then((function(e){return e||Promise.reject({clientError:"Invalid response"})}))}var Ue=r("zPk6"),ke=r("jwpY");function We(e,t,r){var o,i=e.isConsumer,n=e.sharePointResourceId,a=e.inMockMode,s=e.jwtAuthEnabled,l=e.getAccessToken,c=e.officeHomeApiRoot,u=e.correlationId;if(i)return Promise.reject("sharing link only available for commercial");if(!t||!r)return Promise.reject("driveId or itemId not provided");if(!a&&!n)return Promise.reject("sharepoint resource id not given");var d=Object(E.e)(null!=n?n:"",e,!0),p="".concat(d,"/drives/").concat(encodeURIComponent(t),"/items/").concat(encodeURIComponent(r),"/createLink");return Object(ke.a)(ge.a.VroomCreateLinkRequest,"Vroom_Create_Link",p,JSON.stringify({type:"addressBar"}),{headers:{"Content-Type":"application/json"}},null!=s&&s,l,c,u,null!==(o=Object(E.b)(p))&&void 0!==o?o:"SharePoint",{resourceUrl:n,populateRequestEvent:function(e,t){var r;t.RequestId=null!==(r=function(e,t){return t?e.headers&&e.headers["ms-cv"]:Object(Ue.a)(e)}(e,i))&&void 0!==r?r:"",t.ResourceId=u}}).then((function(e){var t,r;return(null==e?void 0:e.ok)&&(null===(r=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.link)||void 0===r?void 0:r.webUrl)?e.data.link.webUrl:Promise.reject(e.statusText)}))}var Te=r("B5kz"),Ae=r("MJsD"),ye=r("QLkI"),Fe=r("j7b/"),De=r("W7wX"),we=r("6y6H"),Ce=r("Cqxz"),je=r("wRjz"),Re=r("lwUs"),Ne=r("m32Q"),Le=r("lkvL"),Me=r("Wa5Y");function He(e,t){var r="drives/".concat(encodeURIComponent(e),"/items/").concat(encodeURIComponent(t));return"".concat(r,"/thumbnails/0/c400x999/content?prefer=noredirect,closestavailablesize,extendCacheMaxAge")}var Qe="thumbnail-vroom-api";function Ge(e,t,r){return Object(l.__awaiter)(this,void 0,void 0,(function(){return Object(l.__generator)(this,(function(o){return[2,Te.a.fetchQuery(["ThumbnailData",t,r],(function(){return function(e,t,r){return Object(l.__awaiter)(this,void 0,void 0,(function(){var o,i,n,a,s,c,u,d,p,f,h,_,g,m,v,b,I,S=this;return Object(l.__generator)(this,(function(O){switch(O.label){case 0:return t&&r?(o=He(t,r),[4,Object(Ae.a)()]):[2,Promise.reject("driveId and itemId not provided")];case 1:return i=O.sent(),[4,Promise.all([Object(ye.a)(),Object(De.a)()])];case 2:return n=l.__read.apply(void 0,[O.sent(),2]),a=n[0],s=n[1],[4,Object(we.a)()];case 3:return c=O.sent(),u=[],(null==c?void 0:c.key)&&u.push(Object(je.a)(c.key)),u.push(Object(Re.a)(4*Fe.a)),p=(d={correlationId:i.correlationId,getAccessToken:i.getAccessToken,inMockMode:!!i.inMockMode,isConsumer:s.isMsa,jwtAuthEnabled:i.jwtAuthEnabled,officeHomeApiRoot:i.officeHomeApiRoot,oneDriveResourceId:e?null==a?void 0:a.oneDriveResourceId:void 0}).jwtAuthEnabled,f=d.getAccessToken,h=d.officeHomeApiRoot,_=d.correlationId,g=function(e,t,r){var o=t.oneDriveResourceId,i=t.inMockMode,n=t.officeHomeApiRoot;return e?"".concat(t.isConsumer?Object(E.f)(t):Object(E.e)(null!=o?o:"",t),"/").concat(r):Object(E.h)(n,r,!!i,!1)}(e,d,o),m={responseType:"blob",method:"GET"},v="".concat(t,"-").concat(r),b=new FileReader,I=new Promise((function(t,r){var o;Object(Me.a)(e?ge.a.VroomThumbnailRequest:ge.a.OneDriveGraphThumbnailRequest,e?"Vroom_Thumbnail":"OneDrive_Graph_Thumbnail",g,m,!!p,f,h,_,null!==(o=Object(E.b)(g))&&void 0!==o?o:"SharePoint",{populateRequestEvent:function(e,t){t.RequestId=e.headers&&e.headers["request-id"]||""},resourceUrl:e?d.oneDriveResourceId:""}).then((function(e){e&&e.ok&&e.data?(b.onloadend=function(){var e="string"==typeof b.result&&b.result||"";e.length>0?t(e):r()},b.onerror=r,b.onabort=r,b.readAsDataURL(e.data)):r()})).catch(()})),[2,Object(Ce.a)((function(){return I}),(function(){var e=Object(l.__spreadArray)([],Object(l.__read)(u),!1).reverse();return Object(Ne.a)({userId:s.puid,collectionName:Qe,collectionVersion:2,key:v,plugins:e})}),(function(e){return Object(l.__awaiter)(S,void 0,void 0,(function(){return Object(l.__generator)(this,(function(t){switch(t.label){case 0:return[4,Object(Le.a)({userId:s.puid,collectionName:Qe,collectionVersion:2,key:v,data:e,plugins:u,writeBehavior:"sync"})];case 1:return t.sent(),[2]}}))}))}))]}}))}))}(e,t,r)}),{staleTime:1/0,cacheTime:1/0})]}))}))}function Ve(e,t,r){return Object(l.__awaiter)(this,void 0,void 0,(function(){return Object(l.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Ge(e,t,r)];case 1:return[2,o.sent().result];case 2:return o.sent(),[2,""];case 3:return[2]}}))}))}var Be=r("PoVA")},eChZ:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r("Jxb/"),r("lpeV");var o=function(){var e=void 0;try{e=window.localStorage}catch(e){}return e}()},fhoW:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var o=r("6ib3"),i=r("muUJ"),n=r("a3FV"),a=r("Jxb/"),s=r("lpeV"),l=r("jwpY"),c=r("zPk6"),u="me/drive/";function d(e,t,r,d,p,f){var h=e.jwtAuthEnabled,_=e.getAccessToken,g=e.officeHomeApiRoot,m=e.correlationId;if(d===o.a.OneNote){var v="https://graph.microsoft.com/v1.0/".concat("me/onenote/","notebooks"),E={displayName:t},b={headers:{"Content-Type":"application/json"}};return Object(l.a)(n.a.OneDriveGraphCreateFileRequest,"OneDrive_Graph_Create_File",v,JSON.stringify(E),b,null!=h&&h,_,g,m,"Graph",{populateRequestEvent:function(e,t){t.RequestId=Object(c.a)(e)||""}}).then((function(e){var t=e.data;if(t&&t.links&&t.links.oneNoteWebUrl&&t.links.oneNoteWebUrl.href)return t;throw Object(i.a)("Could not parse drive item from Graph response")}),(function(e){var t,r=((t={}).ResourceId=m,t.Error=e,t);Object(i.a)(n.a.WacDocumentVroomError,r)}))}return v=void 0,v=p&&p.length?"https://graph.microsoft.com/v1.0/".concat(u,"root/children?").concat("select="+p.join(","),",*"):"https://graph.microsoft.com/v1.0/".concat(u,"root/children?select=webDavUrl,").concat(r?"openwith,":"","*"),E={name:t,file:{},"@microsoft.graph.conflictBehavior":"rename"},b={headers:{"Content-Type":"application/json",Prefer:"allow-zerobyte"}},Object(l.a)(n.a.OneDriveGraphCreateFileRequest,"OneDrive_Graph_Create_File",v,JSON.stringify(E),b,null!=h&&h,_,g,m,"Graph",{populateRequestEvent:function(e,t){t.RequestId=Object(c.a)(e)||""}}).then((function(e){null==f||f.ULS.sendTraceTag(512553950,a.a.msoulscat_Wac_UnifiedUiHost,s.a.Info,"Create new fileType: ".concat(d,", httpStatus: ").concat(e.status,", httpResponse: ").concat(e));var t=e.data;if(t&&t.id&&t.webUrl)return t;throw Object(i.a)("Could not parse drive item from Graph response")}),(function(e){var t;null==f||f.ULS.sendTraceTag(512550538,a.a.msoulscat_Wac_UnifiedUiHost,s.a.Info,"Create new fileType: ".concat(d,", error: ").concat(e));var r=((t={}).ResourceId=m,t.Error=e,t);Object(i.a)(n.a.WacDocumentVroomError,r)}))}},"i3m/":function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return i}));var o="drive/",i=["id","openWith","officebundle","currentUserRole","eTag","name","size","content.downloadUrl","file","sharepointIds","sensitivityLabel","webUrl"]},jwpY:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var o=r("QjXU"),i=r("kb6k"),n=r("lAHu");function a(e,t,r,a,s,l,c,u,d,p,f,h,_){void 0===f&&(f={});var g="cache-only"===h;g&&(p="None");var m=Object(o.__assign)(Object(o.__assign)({},s),{url:r,method:"POST",body:a});return Object(i.a)((function(r){return Object(n.a)(e,t,r,u,d,h,f.populateRequestEvent,f.onUploadProgress,f.onDownloadProgress,f.cancellationToken,f.timeoutInMs)}),e,t,m,l,c,p,f.mockParam,f.resourceUrl,f.rpsHeaderPrefix,f.additionalAuthErrors,f.isRetriableError,f.updateRequestWithAuth,g,void 0,void 0,_)}},lpeV:ovfp:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var o=r("8wW2"),i=r("Wa5Y"),n=new Map;function a(e,t,r,a,s,l,c,u,d){void 0===l&&(l="None");var p="".concat(r,"/").concat(a),f=function(e){if(n.has(e)){var t=n.get(e);if(t&&t.promise&&(!t.expiryTime||t.expiryTime>new Date))return t.promise;n.delete(e)}return null}(p);if(f)return f;var h={headers:{accept:"application/json",Prefer:"allow-zerobyte",application:"officehome"}},_=new Promise((function(n,p){u&&h.headers&&(h.headers.scenario=u),d&&h.headers&&(h.headers.scenarioType=d),Object(i.a)(e,t,r,h,s.jwtAuthEnabled||!1,s.getAccessToken,s.officeHomeApiRoot,s.correlationId,l,{resourceUrl:c},a).then((function(e){e&&e.data?n(e.data):p({clientError:"No data returned"})})).catch((function(e){Object(o.a)().handleError(e,"QYFpr")}))}));return n.set(p,{promise:_}),_}},s32E:function(e,t,r){"use strict";r.d(t,"a",();var o=r("a3FV"),i=r("V1Qu"),n=r("ovfp");function a(e,t,r,a,s,l){if(void 0===a&&(a="network-first"),!t||!e||!e.sharePointResourceId)return Promise.reject("No driveId or no sharePointResourceId");var c=Object(i.j)(["id","name","folder","webUrl","webDavUrl"],!1,!0),u=r?"items/".concat(encodeURIComponent(r),"/"):"root/",d=e.inMockMode&&!e.isConsumer?function(){return r?"EmptyFolder"!==r?"".concat(e.officeHomeApiRoot,"/_api/v2.0/drives/mockenterprisetemplateitem"):"":"".concat(e.officeHomeApiRoot,"/_api/v2.0/drives/enterprisetemplates")}():"".concat(Object(i.e)(e.sharePointResourceId,e),"/drives/").concat(encodeURIComponent(t),"/").concat(u,"children").concat(c?"?"+c:"");return Object(n.a)(o.a.VroomItemRequest,"Vroom_Item",d,a,e,"SharePoint",e.sharePointResourceId,s,l)}}}]);
//# sourceMappingURL=vendors~vroom-service.49f3952a257751fa5104.chunk.v7.js.map