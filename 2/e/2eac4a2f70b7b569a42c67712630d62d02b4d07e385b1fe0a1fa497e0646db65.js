import{e as Z,j as r,an as I,dL as ee,aR as re,ab as ae,d as S,m as oe,a1 as H,aL as se,N as E,eE as b,cj as W,aI as te,ci as ne,d8 as ie,bI as le,ck as de,cl as pe,a4 as ge,bx as ce,eF as ue,eG as he,eH as fe,eI as Se,cn as xe,db as be,eJ as Ue,eK as J,dE as Ce,dF as je}from"./index-IMvvqvG5.js";import{P as R,w as me}from"./index-Xe7JKTMN.js";import{l as X}from"./zh-TW-1d550385-58vOSG_i.js";import{D as De}from"./index-LmdOAVg5.js";import{t as M,a as Ee}from"./index-dTKKjGSB.js";import{c as Me,u as Le}from"./useCloudStorageFiles-0OAYEiZl.js";import{a as C,U as P}from"./index-ss2QbMh7.js";import{b as Te,u as Fe}from"./NoResult-o3INJeYG.js";import{L as Pe}from"./useImageMeasurer-i_xvXh1-.js";import{V as A}from"./index-WTJsS9b1.js";import{D as k}from"./useCollections-9V73-2-B.js";import{S as Ae}from"./index-8CFd6jyP.js";import"./index-BxVjk_A7.js";import"./index-3yfBtf9f.js";import"./index-knW2oKOE.js";import"./index-LV9moQ-t.js";import"./index-q2tK04gT.js";import"./getPressedImageData-74KNu2MQ.js";import"./index-6SJllaRd.js";import"./index-rsdixL0D.js";import"./index-8cjPRlka.js";import"./index-j97aM_Tn.js";import"./removeItemFromRecents-T0H2Snan.js";import"./useContainerParams-DP9mHw08.js";import"./useTextStylesData-V-rq4ZoY.js";import"./index-NM_3i4B5.js";import"./testIds-poACUZMz.js";const q=Z(a=>({root:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gridGap:a.spacings.s4,paddingTop:a.spacings.s16,position:"relative"},progressBar:{transition:"width 2s ease"},skeleton:{width:100,height:100},invisibleDiv:{position:"absolute",width:"100%",bottom:300,height:0}}),{name:"uploads-chooser-body"}),Oe={uploadingLoader:"uploading-loader"},Ie=({cloudItems:a,tempItems:o,localItems:i,showLocalItems:g,localItemsStatuses:d,onCloudItemSelect:u,onLocalItemSelect:j,onItemDelete:l})=>r.jsxs(r.Fragment,{children:[!!(o!=null&&o.length)&&o.map(e=>{var t;return r.jsxs("div",{children:[r.jsx(A,{duration:+(((t=e.duration)==null?void 0:t.toFixed())??0),thumbnailUrl:e.thumbnailUrl??"",videoUrl:e.url??"",onSelect:I,dataTest:M.uploadedItem,hasFooter:!0}),!!e.progressPercent&&r.jsx(R,{percent:e.progressPercent})]},e.id)}),!!(a!=null&&a.length)&&a.map((e,t)=>{var n,c,h;return r.jsx(k,{id:e.uid,index:t,draggableId:e.uid,children:r.jsx(A,{duration:+(((c=(n=e.attributes)==null?void 0:n.duration)==null?void 0:c.toFixed())??0),thumbnailUrl:((h=e.preview)==null?void 0:h.url)??"",videoUrl:e.sourceUrl,onSelect:()=>u(e),onDelete:()=>l(e.uid,C.Cloud),dataTest:M.uploadedItem,hasFooter:!0,tooltipMessages:{deleteText:"Delete"}},e.uid)},e.uid)}),g&&!!(i!=null&&i.length)&&i.map((e,t)=>{var c,h;const n=d==null?void 0:d.find(({id:m})=>m===e.id);return r.jsxs("div",{children:[r.jsx(k,{id:e.id,index:t,draggableId:(c=e.id)==null?void 0:c.toString(),children:r.jsx(A,{videoUrl:e.url,thumbnailUrl:e.thumbnailUrl??"",onSelect:()=>j(e,t),onDelete:()=>l(String(e.id),C.Local),duration:+(((h=e.duration)==null?void 0:h.toFixed())??0),dataTest:M.uploadedItem,hasFooter:!0,tooltipMessages:{deleteText:"Delete"}})},e.id),(n==null?void 0:n.status)!==ee&&r.jsx(R,{percent:(n==null?void 0:n.progressPercent)??0})]},e.id)})]});function Re({url:a,progressPercent:o,onDelete:i,onSelect:g,isDragging:d}){const u=q();return r.jsxs(r.Fragment,{children:[r.jsx(Ae,{hasFooter:!0,imageUrl:a,onSelect:g,onDelete:i,tooltipMessages:{deleteText:"Delete"},dataTest:M.uploadedItem,isDragging:d}),!!o&&r.jsx(R,{loaderClassName:u.progressBar,percent:o})]})}function O({id:a,url:o,index:i,progressPercent:g,onDelete:d,onSelect:u}){return r.jsx(k,{isDragDisabled:!!g,id:a,index:i,children:r.jsx(Re,{url:o,onSelect:u,onDelete:d,progressPercent:g})},a)}const ke=({cloudItems:a,tempItems:o,localItems:i,showLocalItems:g,localItemsStatuses:d,onCloudItemSelect:u,onLocalItemSelect:j,onItemDelete:l})=>r.jsxs(r.Fragment,{children:[!!(o!=null&&o.length)&&o.map((e,t)=>r.jsx(O,{index:t,id:e.id,url:e.url,progressPercent:e.progressPercent,onSelect:I,onDelete:I},e.id)),!!(a!=null&&a.length)&&a.map((e,t)=>{var n;return r.jsx(O,{index:t,id:e.uid,url:((n=e.preview)==null?void 0:n.url)||e.sourceUrl||e.url,onSelect:()=>u(e,{license:re.Personal}),onDelete:()=>l(String(e.uid),C.Cloud)},e.uid)}),g&&!!(i!=null&&i.length)&&i.map((e,t)=>{const n=d==null?void 0:d.find(({id:c})=>c===e.id);return r.jsx(O,{id:e.id,index:t,url:e.url,progressPercent:n==null?void 0:n.progressPercent,onSelect:()=>j(e,t),onDelete:()=>l(String(e.id),C.Local)},e.id)})]}),Ve=18,we=a=>({uploadedImages:ue(a),uploadedVideos:he(a),uploadedMediaStatuses:fe(a),droppableMediaFromSidebar:Se(a),cloudUploadedItems:xe(a),userKey:be(a),isImageUploading:Ue(a)}),Ne=({handleSelect:a,cloudItems:o,addItemToList:i,deleteItem:g,showLocalItems:d,isLoading:u,setRef:j,mediaType:l})=>{const e=ae(),t=q(),[n,c]=S.useState(null),[h,m]=S.useState(null);Me(n);const{uploadedImages:f,uploadedVideos:D,droppableMediaFromSidebar:L,uploadedMediaStatuses:V,cloudUploadedItems:w,userKey:N,isImageUploading:_}=oe(we),y=Le(),K=S.useCallback(async s=>{if(!(s!=null&&s.id))return;const{id:p,type:x}=s;if(H.cloudStorage&&x===C.Cloud)try{await g([p]);return}catch(F){se.trigger({name:`delete ${l} file`,message:F.message},"error")}if(x===C.Local){e(E.actions.deleteUploadedMedia({id:p}));return}const Y=(l===b.Video?D:f).filter(F=>F.id!==p),Q=l===b.Video?W.uploadedVideos:W.uploadedImages;te.putSync(ne,Q,Y),e(E.actions.updateAllUploadMedia(Y)),l===b.Image&&Ee.photoEditItemOpen()},[l,D,f,e,g]),v=(s,p)=>{c(null),a({index:p,media:s})},B=S.useCallback(s=>{const p=f.find(({id:x})=>x===s.draggableId);if(!p){c(null);return}c({...p,thumbnailUrl:ie(p.url)}),e(le.actions.deselect())},[e,f]);S.useEffect(()=>{L.draggableId&&B(L)},[L,B]);const $=(s,p)=>m({id:s,type:p}),z=S.useCallback(s=>{s===de.firstChoiceAction&&K(h),m(null)},[h,K]),U=S.useMemo(()=>{const s=l===J?[J]:[Ce,je];return w.filter(p=>{var x;return s.includes((x=p.resourceType)==null?void 0:x.toLowerCase())})},[w,l]);S.useEffect(()=>{U.forEach(s=>{s.progressPercent===100&&s.cloudInfo&&(i(s.cloudInfo),e(E.actions.removeUploadedItem(s))),s.status===pe&&(e(E.actions.removeUploadedItem(s)),N||i(s))})},[i,U,e,N]);const T=u&&H.cloudStorage;let G=!(f!=null&&f.length)&&!(o!=null&&o.length)&&!U.length&&!T&&!_;return l===b.Video&&(G=!D.length&&!(o!=null&&o.length)&&!U.length&&!T),G?r.jsx(Te,{tab:l===b.Image?P.Images:P.Videos}):r.jsxs(r.Fragment,{children:[r.jsx(De,{id:`${ge.uploads}_${P.Images}`,children:r.jsxs("div",{className:t.root,children:[l===b.Video&&r.jsx(Ie,{cloudItems:o,tempItems:U,localItems:D,localItemsStatuses:V,onCloudItemSelect:y,onLocalItemSelect:v,onItemDelete:$,showLocalItems:d}),l===b.Image&&r.jsx(ke,{cloudItems:o,tempItems:U,localItems:f,localItemsStatuses:V,onCloudItemSelect:y,onLocalItemSelect:v,onItemDelete:$,showLocalItems:d}),T&&r.jsx(Pe,{skeletonItemsCount:Ve,skeletonItemContainerClassName:t.skeleton}),!u&&r.jsx("div",{className:t.invisibleDiv,ref:j})]})}),r.jsx(ce,{show:!!h,onAction:z,...Fe}),_&&r.jsx(X.Loader,{variant:X.LoaderVariants.Local,dataTestId:Oe.uploadingLoader,isWithoutBackground:!0})]})},gr=me(Ne,"UploadsSection");export{gr as default};
