import{d as s,aW as ve,g as ge,m as V,kT as ke,fA as Ce,ab as U,an as we,bI as j,af as z,cq as re,kU as le,z as Me,j as r,h as _,e as E,kV as Y,x as D,cZ as X,fT as Se,aL as je,C as Ie,kW as Ee,bn as Le,kX as Re,f as $,aU as Pe,aV as Be,u as He,E as ce,cr as Q,aF as Ae,aG as Oe,aH as _e,eK as Ne,jt as $e,kY as De,kZ as We,a6 as ze,k_ as Fe,bf as Ve}from"./index-IMvvqvG5.js";import{I as Ue,a as Ge}from"./index-jlrEaQ9b.js";import{b as Ye,I as de,a as Xe,c as Ze}from"./useMediaLoop-zLTC9Vbd.js";import{as as B,bp as qe,bq as Ke,h as Je}from"./useImageMeasurer-i_xvXh1-.js";import{t as ee}from"./index-rZ5Vnaif.js";import{T as te}from"./index-00z2R3vs.js";import{s as Qe}from"./index-R4OxhX0C.js";import{s as et}from"./index-vlJ9OteG.js";import"./getPressedImageData-74KNu2MQ.js";import"./index-6SJllaRd.js";import"./index-ss2QbMh7.js";var ue={exports:{}};/*! For license information please see index.js.LICENSE.txt */(function(e,t){(function(n,o){e.exports=o(s)})(ve,function(n){return function(){var o={73003:function(i,l,d){var x=d(85893),v=d(8156),p=function(h,T){var k={};for(var u in h)Object.prototype.hasOwnProperty.call(h,u)&&T.indexOf(u)<0&&(k[u]=h[u]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var f=0;for(u=Object.getOwnPropertySymbols(h);f<u.length;f++)T.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(h,u[f])&&(k[u[f]]=h[u[f]])}return k};l.Z=function({children:h,width:T=24,height:k=24}){return(0,v.forwardRef)((u,f)=>{var g=p(u,[]);return(0,x.jsx)("svg",Object.assign({width:T,height:k,fill:"none",viewBox:`0 0 ${T} ${k}`,xmlns:"http://www.w3.org/2000/svg",ref:f},g,{children:h}))})}},81372:function(i,l,d){d.d(l,{Z:function(){return x.Z}});var x=d(73003)},75251:function(i,l,d){var x=d(8156),v=Symbol.for("react.element"),p=Object.prototype.hasOwnProperty,h=x.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,T={key:!0,ref:!0,__self:!0,__source:!0};function k(u,f,g){var b,C={},w=null,y=null;for(b in g!==void 0&&(w=""+g),f.key!==void 0&&(w=""+f.key),f.ref!==void 0&&(y=f.ref),f)p.call(f,b)&&!T.hasOwnProperty(b)&&(C[b]=f[b]);if(u&&u.defaultProps)for(b in f=u.defaultProps)C[b]===void 0&&(C[b]=f[b]);return{$$typeof:v,type:u,key:w,ref:y,props:C,_owner:h.current}}l.jsx=k},85893:function(i,l,d){i.exports=d(75251)},8156:function(i){i.exports=n}},c={};function a(i){var l=c[i];if(l!==void 0)return l.exports;var d=c[i]={exports:{}};return o[i](d,d.exports,a),d.exports}a.n=function(i){var l=i&&i.__esModule?function(){return i.default}:function(){return i};return a.d(l,{a:l}),l},a.d=function(i,l){for(var d in l)a.o(l,d)&&!a.o(i,d)&&Object.defineProperty(i,d,{enumerable:!0,get:l[d]})},a.o=function(i,l){return Object.prototype.hasOwnProperty.call(i,l)},a.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var m={};return function(){a.r(m),a.d(m,{default:function(){return l}});var i=a(85893),l=(0,a(81372).Z)({children:(0,i.jsx)("path",{d:"M16.346 9.485l-.003.003 2.462 1.42c.393.24.622.65.622 1.101 0 .45-.23.86-.615 1.094l-2.469 1.426.003.003-3.376 1.945-4.46 2.606a1.31 1.31 0 0 1-.659.187 1.31 1.31 0 0 1-.63-.17 1.955 1.955 0 0 1-.265-.197 1.295 1.295 0 0 1-.383-.92V6.016c0-.36.145-.684.383-.924.085-.075.171-.135.266-.196.41-.23.895-.22 1.295.026l4.454 2.617 3.375 1.946z"})})}(),m}()})})(ue);var tt=ue.exports;const me=ge(tt),nt=e=>({videoTracks:ke(e),audios:Ce(e)}),ot=()=>{const e=s.useRef({}),{videoTracks:t,audios:n}=V(nt),o=s.useMemo(()=>n.map(({id:c,startAt:a,trimEnd:m,duration:i,trimStart:l,currentTime:d,src:x,volume:v,loop:p})=>{const h=e.current[c]||new Audio(x);return e.current[c]||(e.current[c]=h),h.volume=v/100,{id:c,media:h,startAt:a,trimEnd:m||i,duration:i,trimStart:l,currentTime:d,setTime:T=>{h.readyState===4&&(h.currentTime=T)},setMuted:T=>{h.muted=T},setPlayingState:T=>{if(T){h.play();return}h.pause()},loop:p}}),[n]);return[...t,...o]},at=e=>{const t=s.useRef(0),n=s.useRef(void 0),o=s.useRef(!1),c=s.useCallback(i=>{if(n.current!==void 0){const l=i-n.current;e(l)}o.current&&(n.current=i,t.current=requestAnimationFrame(c))},[e]),a=s.useCallback(()=>{cancelAnimationFrame(t.current),o.current=!0,t.current=requestAnimationFrame(c)},[c]),m=s.useCallback(()=>{n.current=void 0,o.current=!1,cancelAnimationFrame(t.current)},[]);return{startTimer:a,pauseTimer:m}},ne=({startAt:e,trimEnd:t,trimStart:n,loop:o,seconds:c})=>{const a=Math.max(c-e,0);return o?a%(t-n)+n:a>t-n?t:a<n?n:a+n},st=e=>({duration:re(e)*1e3,isTimelinePlaying:le(e)}),it=()=>{const e=U(),t=s.useRef(we),n=ot(),[o,c]=s.useState(0),{startTimer:a,pauseTimer:m}=at(u=>c(f=>f+u)),{duration:i,isTimelinePlaying:l}=V(st),d=s.useCallback(()=>{e(j.actions.stopAnimation()),z().animationApi.pause()},[e]),x=s.useCallback(u=>{e(j.actions.playAnimations()),z().animationApi.playAnimation(i,d,u)},[e,i,d]),v=s.useCallback(()=>{t.current=z().renderer.infiniteDraw(),a();const u=o/1e3;n.forEach(({media:f,setTime:g,setPlayingState:b,...C})=>{g(ne({...C,seconds:u})),b(!0)}),x(u)},[n,x,a,o]),p=s.useCallback(()=>{m(),n.forEach(({setPlayingState:u})=>{u(!1)}),d(),e(j.actions.setTimelineCurrentTime(o/1e3))},[n,e,m,d,o]),h=s.useCallback(()=>{p(),n.forEach(({setTime:u,trimStart:f})=>{u(f)}),t.current(),c(0),z().animationApi.stopAnimations(),e(j.actions.setTimelineCurrentTime(0))},[n,e,p]),T=s.useCallback(u=>{c(u*1e3),z().animationApi.setCurrentTime(u),n.forEach(({setTime:f,...g})=>{f(ne({...g,seconds:u}))}),e(j.actions.setTimelineCurrentTime(u))},[n,e]),k=s.useCallback(u=>{n.forEach(({setMuted:f})=>{f(u)})},[n]);return s.useEffect(()=>{if(o>=i){h(),e(j.actions.setIsTimelinePlaying(!1)),e(j.actions.setSubtitleTextValue(""));return}if(l){const u=o/1e3;n.forEach(({media:f,setPlayingState:g,startAt:b,trimEnd:C,trimStart:w,setTime:y,loop:S})=>{const N=u>=b&&u<b+C-w,W=S&&u>=b;N||W?(S&&f.currentTime>=C&&y(w),g(!0)):g(!1)})}},[n,e,i,l,h,o]),s.useEffect(()=>{l?v():p()},[l]),{stop:h,play:v,time:o,pause:p,duration:i,setCurrentTime:T,setMuteHandler:k}},rt={height:40,fontSize:Me.FontSizeValues.s12,iconSize:20},Z=({onClick:e,icon:t,dataTestId:n})=>{const o=s.useRef(null),c=s.useCallback(()=>{var a;e(),(a=o.current)==null||a.blur()},[e]);return r.jsx(_.Button,{ref:o,onClick:c,variant:_.ButtonVariants.Text,tag:_.ButtonElementTypes.Button,skin:_.ButtonSkinStatusNegative,centerIcon:t,size:rt,"data-testid":n})},lt=E(()=>({time:{minWidth:83,width:83}})),I={playHead:"playHead",leftHead:"leftHead",rightHead:"rightHead",wrapper:"wrapper",shadowLeft:"shadowLeft",shadowRight:"shadowRight",pickedTimeContainer:"pickedTimeContainer",durationContainer:"durationContainer",pickedTime:"pickedTime",playHeadToolTip:"playHeadToolTip",playButton:"playButton",applyBtn:"applyBtn"},F=16,q=48,K=4,ct=E(({radiuses:e,colors:t,spacings:n})=>({wrapper:{position:"relative",width:"100%",display:"flex",height:Y,marginRight:F,marginLeft:F,cursor:({isActive:o})=>o?"pointer":"default"},rangeContainer:{position:"relative",height:"100%",flex:"1 1",borderTop:`1px solid ${t==null?void 0:t.accents.secondary.base.default}`,borderBottom:`1px solid ${t==null?void 0:t.accents.secondary.base.default}`},handler:{display:"flex",justifyContent:"center",alignItems:"center",height:40,width:F,background:t==null?void 0:t.accents.secondary.base.default,top:-1,position:"absolute",zIndex:6,"& path":{fill:t==null?void 0:t.backgrounds.positive}},handlerLeft:{left:-F,borderRadius:`${e==null?void 0:e.r8} 0 0 ${e==null?void 0:e.r8}`},handlerRight:{right:-F,borderRadius:` 0 ${e==null?void 0:e.r8} ${e==null?void 0:e.r8} 0`},borderShadow:{background:"rgba(38, 38, 38, 0.6)",height:"100%",zIndex:4},shadowLeft:{flexBasis:o=>`${o.left}%`},shadowRight:{flexBasis:o=>`${o.right}%`},timeContainer:{display:"flex",position:"absolute",right:K,height:14,width:q,justifyContent:"center",alignItems:"center",background:t==null?void 0:t.backgrounds.tint1,borderRadius:e==null?void 0:e.r2,paddingLeft:n==null?void 0:n.s2,paddingRight:n==null?void 0:n.s2,zIndex:8,top:4},pickedTime:{right:"auto",top:20,left:o=>`${o.timePosition}%`,zIndex:8}})),dt=E(({radiuses:e,colors:t,spacings:n})=>({tooltip:{position:"absolute",padding:`${n.s6} ${n.s8}`,borderRadius:e.r8,background:t.backgrounds.tint1,display:"flex",alignItems:"center",top:-40,border:`1px solid ${t.backgrounds.tint3}`},tooltipArrow:{width:0,height:0,borderBottom:"solid 8px transparent",borderTop:`solid 8px ${t.backgrounds.tint3}`,borderLeft:"solid 6px transparent",borderRight:"solid 6px transparent",position:"absolute",top:24,left:"50%",transform:"translateX(-50%)","&::before":{content:"''",width:0,height:0,position:"absolute",borderBottom:"solid 6px transparent",borderTop:`solid 6px ${t.backgrounds.tint1}`,borderLeft:"solid 6px transparent",borderRight:"solid 6px transparent",top:-9,left:-6}}})),J=({text:e,dataTestId:t})=>{const n=dt();return r.jsxs("div",{className:n.tooltip,children:[r.jsx(D,{color:"primary","data-testid":t,weight:"medium",children:e}),r.jsx("span",{className:n.tooltipArrow})]})},oe=4,ae=1,ut=E(({colors:e,radiuses:t})=>({playHead:{position:"absolute",height:"100%",width:oe,border:`${ae}px solid ${e==null?void 0:e.texts.tint1}`,background:e==null?void 0:e.absolutes.white.base.default,borderRadius:t==null?void 0:t.r20,top:0,left:n=>`calc(${n.left}% - ${(ae+oe)/2}px)`,zIndex:8},tooltipContainer:{position:"relative",display:"flex",justifyContent:"center"}})),mt=s.forwardRef(({currentTime:e,duration:t,start:n,isTriming:o,isPlaying:c,setActive:a},m)=>{const[i,l]=s.useState(!1),d=ut({left:e*X/t}),x=s.useMemo(()=>!o&&(c||i),[c,i,o]);return r.jsx("div",{className:d.playHead,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),onMouseDown:()=>a(!0),ref:m,"data-testid":I.playHead,children:r.jsx("div",{className:d.tooltipContainer,children:x&&r.jsx(J,{text:B(Math.max(e-n,0)),dataTestId:I.playHeadToolTip})})})}),ft=s.memo(mt),fe=async(e,t)=>{try{const n=await fetch(e,{signal:t.signal}).then(o=>o.status);return n>199&&n<300?!0:(await Ee(3e3),await fe(e,t))}catch{return!1}},pt=()=>{const e=V(Se),{width:t,height:n,meta:{storyboard:o=[],resource:c},id:a}=e[0],m=t/n,i=Math.floor(Y*m);return s.useEffect(()=>{if(o!=null&&o.length)return;const l=window.screen.width-Le-Re;let d=!0;const x=new AbortController;return(async()=>{const p=await qe.getStoryBoardFrames({video_session_guid:c==null?void 0:c.guid,frame_count:Math.floor(l/i),width:i,height:Y}),h=await fe(p.urls[0],x);d&&h&&Ie(j.actions.setVideoMetaData({id:a,data:{storyboard:p.urls}}))})().catch(p=>je.trigger("error",p)),()=>{x.abort(),d=!1}},[i,a,c==null?void 0:c.guid,o==null?void 0:o.length]),{frameWidth:i,storyboard:o}},ht=E({frameWrapper:{position:"absolute",height:"calc(100% - 2px)",width:"100%",top:1,zIndex:1,overflow:"hidden"},skeletonContainer:{position:"absolute",top:0,left:0,height:"100%",width:"100%"},frameContainer:{position:"relative",display:"flex",zindex:1},frame:{width:e=>e.width,pointerEvents:"none"}}),Tt=()=>{const{storyboard:e,frameWidth:t}=pt(),n=ht({width:t}),o=s.useRef(null),[c,a]=s.useState([]);return s.useLayoutEffect(()=>{const m=o.current;if(m){const i=new Ke(l=>{const{contentRect:{width:d}}=l[0],x=Math.ceil(d/t),v=Math.floor(e.length/x),p=e.filter((T,k)=>k%v===0),h=[...p.slice(0,x-1),p[p.length-1]];a(h)});return i.observe(o.current),()=>{i.unobserve(m)}}},[t,e]),r.jsxs("div",{ref:o,className:n.frameWrapper,children:[r.jsx("div",{className:n.skeletonContainer,children:r.jsx(Qe.Skeleton,{width:"100%",height:"100%"})}),r.jsx("div",{className:n.frameContainer,children:c.map(m=>r.jsx("img",{src:m,alt:m,className:n.frame},m))})]})},xt=s.memo(Tt),yt=({start:e,end:t,changeStart:n,changeEnd:o,setCurrentTime:c,duration:a,currentTime:m,isPlaying:i})=>{const[l,d]=s.useState(!1),[x,v]=s.useState(!1),[p,h]=s.useState(!1),[T,k]=s.useState(!0),[u,f]=s.useState(!1),[g,b]=s.useState({position:0,value:0}),C=s.useMemo(()=>l||x,[l,x]),w=s.useMemo(()=>!p&&T&&u&&!C,[u,p,T,C]),y=ct({left:e*X/a,right:t*X/a,timePosition:g.position,isActive:l||x}),S=s.useRef(null),N=s.useRef(null),W=s.useCallback(M=>{if(!S.current)return;const{clientX:L}=M,{width:R,right:H,left:A}=S.current.getBoundingClientRect();if(x&&o(Math.max(H-L,0)*a/R),l&&n(Math.max(L-A,0)*a/R),p){const O=Math.max(L-A,0)*a/R;O>=e&&O<=a-t&&c(O)}},[o,n,a,t,l,p,x,c,e]),he=s.useCallback(()=>{d(!0)},[]),Te=s.useCallback(()=>{v(!0)},[]),xe=s.useCallback(M=>{const{clientX:L}=M,{left:R,width:H}=M.currentTarget.getBoundingClientRect();c(Math.max(L-R,0)*a/H)},[a,c]),G=s.useCallback(()=>{document.addEventListener("click",M=>{M.stopPropagation()},{once:!0,capture:!0}),v(!1),d(!1),h(!1)},[]),ye=s.useCallback(M=>{if(f(M.target!==N.current),w){const{clientX:L}=M,{left:R,width:H}=M.currentTarget.getBoundingClientRect(),A=Math.floor(H-(e+t)*H/a),O=Math.min(Math.max(L-Math.floor(R+e*H/a),0),A),be=O>A/2?q+K:-K;b({position:(O-be)*100/A,value:O*(a-e-t)/A})}},[w,a,e,t]);return s.useEffect(()=>{if(!S.current)return;const{width:M}=S.current.getBoundingClientRect(),L=e*M/a,R=t*M/a;k(M-L-R>=q)},[a,t,e]),s.useEffect(()=>{if(l||x||p)return document.addEventListener("mousemove",W),document.addEventListener("mouseup",G,{once:!0}),()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",G)}},[l,p,x,W,G]),r.jsx(r.Fragment,{children:r.jsxs("div",{className:y.wrapper,ref:S,onMouseMove:ye,onMouseLeave:()=>f(!1),onMouseEnter:()=>f(!0),onClick:xe,"data-testid":I.wrapper,children:[r.jsx(ft,{currentTime:m,start:e,duration:a,isTriming:C,isPlaying:i,setActive:h,ref:N}),r.jsx(xt,{}),r.jsx("div",{className:$(y.borderShadow,y.shadowLeft),"data-testid":I.shadowLeft}),r.jsxs("div",{className:y.rangeContainer,children:[r.jsxs("div",{className:$(y.handler,y.handlerLeft),onMouseDown:he,"data-testid":I.leftHead,children:[l&&r.jsx(J,{text:B(e)}),r.jsx(Pe,{})]}),w&&r.jsx("div",{className:$(y.timeContainer,y.pickedTime),"data-testid":I.pickedTime,children:r.jsx(D,{weight:"semiBold",color:"primary",children:B(g.value)})}),T&&r.jsx("div",{className:y.timeContainer,"data-testid":I.durationContainer,children:r.jsx(D,{weight:"semiBold",color:"primary",children:B(a-t-e)})}),r.jsxs("div",{className:$(y.handler,y.handlerRight),onMouseDown:Te,"data-testid":I.rightHead,children:[x&&r.jsx(J,{text:B(t)}),r.jsx(Be,{})]})]}),r.jsx("div",{className:$(y.borderShadow,y.shadowRight),"data-testid":I.shadowRight})]})})},bt=({isPlaying:e,trimEnd:t,trimStart:n,duration:o,setTrim:c,setCurrentTime:a,currentTime:m,pause:i,playbackHandler:l})=>{const d=lt(),x=U(),v=He(),[p,h]=s.useState(n),[T,k]=s.useState(o-t),u=s.useCallback(()=>{c(p,o-T),x(ce.actions.setTrimToolOpen(!1)),a(p)},[x,o,T,a,c,p]),f=s.useCallback(y=>{const S=Math.min(y,o-T-Q);h(S)},[o,T]),g=s.useCallback(y=>{k(Math.min(y,o-p-Q))},[o,p]),b=s.useCallback(y=>{f(Math.max(y,0))},[f]),C=s.useCallback(y=>{g(Math.max(o-y,0))},[o,g]),w=s.useMemo(()=>e?de:me,[e]);return s.useEffect(()=>{const y=[p,m,o-T].sort((S,N)=>S-N)[1];m!==y&&a(y)},[m,o,T,a,p]),Xe({isPlaying:e,currentTime:m,setCurrentTime:a,timeEnd:o-T,trimStart:n,pause:i}),r.jsxs(r.Fragment,{children:[r.jsx(Z,{icon:w,onClick:l,dataTestId:I.playButton}),r.jsx(te,{className:d.time,value:p,onChange:b,size:ee.ControlSizesMD,isCentered:!0,isWithoutBorders:!0,minLimit:0,maxLimit:o-T}),r.jsx(te,{className:d.time,value:o-T,onChange:C,size:ee.ControlSizesMD,isCentered:!0,isWithoutBorders:!0,minLimit:p,maxLimit:o}),r.jsx(yt,{isPlaying:e,start:p,end:T,changeStart:f,changeEnd:g,currentTime:m,setCurrentTime:a,duration:o}),r.jsx(_.Button,{skin:_.ButtonSkinSecondary,onClick:u,size:_.ButtonSizeMD,"data-testid":I.applyBtn,children:v("Apply")})]})},vt=({videoLayer:e})=>{const{isPlaying:t,pause:n,play:o,...c}=Ye(e),a=s.useCallback(()=>{t?n():o()},[t,n,o]);return r.jsx(bt,{isPlaying:t,pause:n,playbackHandler:a,...c})},gt=E(({spacings:e})=>({button:{width:t=>t.width,height:t=>t.height,position:"absolute",left:e==null?void 0:e.s0,bottom:e==null?void 0:e.s0,zIndex:1}})),kt=E(({spacings:e,colors:t})=>({container:{pointerEvents:"all",background:t==null?void 0:t.backgrounds.base,borderRadius:"var(--layout-border-radius)",paddingTop:e==null?void 0:e.s8,paddingBottom:e==null?void 0:e.s8,paddingLeft:e==null?void 0:e.s16,paddingRight:e==null?void 0:e.s16,display:"flex",alignItems:"center",justifyContent:"center",gap:e==null?void 0:e.s8,"&.disabled":{pointerEvents:"none"}}}),{name:"video-tools"}),Ct=E(({spacings:e})=>({container:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:e==null?void 0:e.s2}})),wt=E({sliderWrapper:{width:"100%",position:"relative"}}),Mt=E(({colors:e,spacings:t})=>({pickedTimeContainer:{backgroundColor:e==null?void 0:e.backgrounds.panel,position:"absolute",width:50,top:19,left:n=>`calc( ${n.left}px - 50px)`,display:"flex",justifyContent:"center",alignItems:"center",background:e==null?void 0:e.backgrounds.tint1,paddingLeft:t==null?void 0:t.s2,paddingRight:t==null?void 0:t.s2}})),St=E(()=>({container:{minWidth:50,textAlign:"left",flexShrink:0}})),P={slider:"time-line-slider",pickedTimeContainer:"picked-time-container",sliderWrapper:"slider-wrapper",playButton:"play-button",muteButton:"mute-button",timeEnd:"timeEnd",videoTimeLineContainer:"videoTimeLineContainer",currentTime:"currentTime",applyBtn:"applyBtn",isiTextTimeLineContainer:"isiTextTimeLineContainer",invisibleButton:"invisibleButton"},pe=({time:e,dataTestId:t,secondaryColor:n})=>{const o=St();return r.jsx("div",{className:o.container,children:r.jsx(D,{"data-testid":t,weight:"medium",size:"small",color:n?"secondary":"primary",children:e})})},jt=({time:e,left:t})=>{const n=Mt({left:t});return r.jsx("div",{className:n.pickedTimeContainer,"data-testid":P.pickedTimeContainer,children:r.jsx(D,{size:"small",weight:"medium",color:"primary",children:B(e)})})},It=s.memo(jt),Et=({width:e=8,height:t=24,onClick:n})=>{const o=gt({width:e,height:t});return r.jsx("button",{className:o.button,onClick:n,"data-testid":P.invisibleButton,children:" "})},Lt=s.memo(Et),se={isShownPickedTime:!1,left:0,time:0},Rt=({timeEnd:e,time:t,setCurrentTimeHandler:n,pause:o,play:c,isPlaying:a})=>{const[m,i]=s.useState(se),[l,d]=s.useState(!1),x=wt(),v=s.useCallback(()=>{n(m.time)},[m.time,n]),p=s.useCallback(f=>{if(f.target.type==="range"){const{clientX:g}=f,{left:b,width:C}=f.target.getBoundingClientRect(),w=Math.min(Math.max(g-Math.floor(b),0),C);i({isShownPickedTime:!0,time:Math.min(w*e/Math.floor(C),e),left:w})}},[e]),h=s.useCallback(()=>{i(se)},[]),T=s.useCallback(()=>{o(),d(a)},[a,o]),k=s.useCallback(f=>{l&&c(),f.target.blur()},[c,l]),u=s.useCallback(()=>n(0),[n]);return r.jsxs("div",{className:x.sliderWrapper,onMouseMove:p,onMouseLeave:h,"data-testid":P.sliderWrapper,children:[r.jsx(Lt,{onClick:u}),r.jsx(et.Slider,{min:0,max:e,value:t,onChange:v,dataTestId:P.slider,onMouseDown:T,onMouseUp:k}),m.isShownPickedTime&&r.jsx(It,{time:m.time,left:m.left})]})},Pt=s.memo(({totalDuration:e})=>r.jsx(pe,{dataTestId:P.timeEnd,time:B(e),secondaryColor:!0})),Bt=({timeEnd:e,setCurrentTimeHandler:t,currentTime:n,pause:o,play:c,isPlaying:a})=>{const m=Ct();return r.jsxs(r.Fragment,{children:[r.jsx(Rt,{time:n,timeEnd:e,setCurrentTimeHandler:t,play:c,pause:o,isPlaying:a}),r.jsxs("div",{className:m.container,children:[r.jsx(pe,{dataTestId:P.currentTime,time:B(n)}),r.jsx(D,{size:"small",color:"secondary",children:"/"}),r.jsx(Pt,{totalDuration:e})]})]})},ie={PLAY:"play",PAUSE:"pause",MUTE:"mute"},Ht=e=>({isTimelinePlaying:le(e),currentTime:$e(e),isMuted:De(e)}),At=()=>{const e=U(),{time:t,duration:n,setCurrentTime:o,setMuteHandler:c}=it(),{isTimelinePlaying:a,currentTime:m,isMuted:i}=V(Ht),l=s.useCallback(()=>!a&&e(j.actions.setIsTimelinePlaying(!0)),[e,a]),d=s.useCallback(()=>a&&e(j.actions.setIsTimelinePlaying(!1)),[e,a]),x=s.useCallback(()=>{Ae.sendEvent(Oe.BUTTON_CLICK,_e.custom_event,{type:a?ie.PAUSE:ie.PLAY,item:Ne}),a?d():l()},[a,d,l]),v=s.useMemo(()=>a?de:me,[a]),p=s.useMemo(()=>i?Ue:Ge,[i]),h=Je(d),T=s.useCallback(()=>{e(j.actions.setTimelineIsMuted(!i))},[e,i]);return s.useEffect(()=>{c(i)},[i,c]),s.useEffect(()=>(o(m),()=>{o(0)}),[m]),Ze(a,d,l),r.jsxs("div",{ref:h,style:{display:"contents"},"data-testid":P.videoTimeLineContainer,children:[r.jsx(Z,{icon:v,onClick:x,dataTestId:P.playButton}),r.jsx(Z,{icon:p,onClick:T,dataTestId:P.muteButton}),r.jsx(Bt,{timeEnd:n/1e3,currentTime:t/1e3,setCurrentTimeHandler:o,pause:d,play:l,isPlaying:a})]})},Ot=e=>({duration:re(e),isTrimToolOpen:We(e),isCanvasLoading:ze(e),selectedVideolayer:Fe(e)[0]}),Xt=()=>{const e=U(),t=kt(),{duration:n,isTrimToolOpen:o,isCanvasLoading:c,selectedVideolayer:a}=V(Ot);return s.useEffect(()=>{const m=i=>{Ve(i)&&e(ce.actions.setTrimToolOpen(!1))};return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)}}),n?r.jsx("div",{className:$(t.container,{disabled:c}),children:o&&a?r.jsx(vt,{videoLayer:a}):r.jsx(At,{})}):null};export{At as TimelineBase,Xt as default};
