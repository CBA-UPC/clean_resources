/***************************************
 * @preserve
 * Copyright (c) 2023 Verint Systems, Inc. All rights reserved.
 * ForeSee Web SDK: Feedback
 * Version: 19.22.0
 * Built: May 05, 2023 at 09:53:37 EDT
 ***************************************/
_fsDefine(["fs",_fsNormalizeUrl("$fs.utils.js"),_fsNormalizeUrl("$fs.survey.js"),_fsNormalizeUrl("$fs.compress.js"),"exports"],(function(e,t,i,s,n){var a={remove:hasClass:addClass:function(e){this.hasClass(e)||(this.className+=" "+e)},removeClass:function(e){this.className=(this.className||"").replace(e,""),this.className=this.className.replace(/[ ]+$/g,"")},$:css:function(t){for(var i in t)e.hasProp(t,i)&&(this.style[i]=t[i])}},r=function(t){if("string"==typeof t&&-1==t.indexOf("<"))return document.querySelectorAll(t);if("string"==typeof t){var i=document.createElement("div");i.innerHTML=t,t=i.firstChild}for(var s in a)e.hasProp(a,s)&&(t[s]=a[s]);return t},o=function(){function t(){var t=r('<img src="'+e.makeURI("$loader.gif")+'" class="acs-loader">');t.setAttribute("alt","loading survey"),this.$el=t}var i=t.prototype;return i.center=function(e){var t=this.$el.parentNode.offsetWidth,i=this.$el.offsetWidth;this.$el.css({left:(t-i)/2+"px",top:e?(t-i)/2+"px":"auto"})},i.remove=t}(),c=function(){function i(e,i,s,n,a,o){var c=this;this.sv=e,this.br=i,this.cfg=s,this.jrny=s.jrny,this.errTemplate=n,this.svTemplate=a,this.epTemplate=o,this.$domContent=[],this.$btns=[],this.networkError=new t.FSEvent,this.SurveySubmitted=new t.FSEvent,this.ajax=new t.AjaxTransport;for(var d=d||window,l=d.document.body.childNodes,f=0;f<l.length;f++)1===l[f].nodeType&&r(l[f]).hasClass("_acs")?this.$btns.push(l[f]):this.$domContent.push(l[f]);this.$el=r('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.sv.SubmitClicked.subscribe((function(){c.$content.removeClass("acsVisible"),c._showWait(),c._postSurveyData((function(){c.jrny.addEventObj({name:"feedback_submitted",properties:{fs_mid:[s.mid]}}),c.$content.addClass("acsVisible"),c._showThankyou(),c._removeWait(),c.SurveySubmitted.fire()}))})),this.networkError.subscribe(this.onNetworkError.bind(this)),this._getSurveyData((function(e){c.sv=e,c.show()}))}var s=i.prototype;return s.onNetworkError=function(i){var s=this;this._removeWait(),i&&i.type?this.jrny&&this.jrny.addEventObj({name:"feedback_survey_"+i.type,properties:{fs_mid:[this.sv.cfg.mid]}}):this.jrny&&this.jrny.addEventObj({name:"feedback_server_error",properties:{fs_mid:[this.sv.cfg.mid]}}),this.$content=r('<div class="acsMainContainerMobile--'+this.sv.cfg.template+'"></div>'),this.$el=r('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.$closebtn=r('<span><img src="'+e.makeURI("$templates/feedback"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton" alt="Close Button" role="button"></span>'),this.$content.innerHTML=this.errTemplate(this.sv);var n=this.$content.$(".acs-serviceunavailable__message")[0];if("expired"===i.type){for(;n.firstChild;)n.removeChild(n.firstChild);this.sv.cfg.fbexpiremessage?n.appendChild(r("<p>"+this.sv.cfg.fbexpiremessage+"</p>")):n.appendChild(r("<p>This is an expired survey!</p>"))}else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(r("<p>Feedback isn't available right now.</p><p>Please check back later.</p>"))}t.Bind(this.$closebtn,"feedback:click",(function(e){s.hide(e,!0)})),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content);var a=this.$el.$(".acs-close-button")[0];t.Bind(a,"feedback:click",(function(e){s.hide(e,!0)})),this.$content.addClass("acsVisible"),window.document.body.innerHTML="",window.document.body.appendChild(this.$el)},s._renderSurvey=function(){var i=this,s=s||window,n=this,a=s.document.body;if(!this.sv.cfg.preview){t.Bind(document.body,"feedback:keyup",(function e(i){"escape"==t.getKeyCode(i)&&(n.jrny.addEventObj({name:"feedback_abandoned",properties:{fs_mid:[n.cfg.mid]}}),n.hide(i,!1)),t.Unbind(document.body,"feedback:keyup",e)}))}a.innerHTML="",0===this.$el.children.length&&(this.$closebtn=r('<span><img src="'+e.makeURI("$templates/feedback/"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton" alt="Close Button" role="button"></span>'),this.$content=r('<div class="acsMainContainerMobile--'+this.sv.cfg.template+'"></div>'),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content)),a.appendChild(this.$el),this.sv.cfg.preview||t.Bind(this.$closebtn,"feedback:click",(function(e){i.hide(e,!1)})),this._showWait()},s._showWait=function(){this._removeWait(),this._wait=new o,this.$el.appendChild(this._wait.$el),this._wait.center();var e=t.getScroll(window),i=t.getSize(window);this._wait.$el.css({position:"absolute",top:e.y+(i.h-this._wait.$el.offsetHeight)/2+"px",left:e.x+(i.w-this._wait.$el.offsetWidth)/2+"px"})},s._removeWait=function(){this._wait&&(this._wait.remove(),this._wait=null)},s.hide=function(t,i){window.document.body.innerHTML="";for(var s=0;s<this.$domContent.length;s++)window.document.body.appendChild(this.$domContent[s]);e.globalState.feedback.onFeedbackClosed.fire(),this.jrny&&t&&t.target&&!t.target.classList.contains("acs-feedback__button--epilogue")&&this.jrny.addEventObj({name:"feedback_abandoned",properties:{fs_mid:[this.cfg.mid]}}),i||this._showBtns()},s.remove=s._showBtns=function(){for(var e=0;e<this.$btns.length;e++)window.document.body.appendChild(this.$btns[e])},s.show=function(){if(this._renderSurvey(),this._removeWait(),this.sv.ansLogoSrc=e.makeURI("$verint_foresee_logo.svg"),0===this.$content.children.length){var t=this.svTemplate(this.sv);this.$content.innerHTML=t,this.sv.bind(this.$content)}this.$content.addClass("acsVisible"),this.$el.addClass("acsVisible"),this.sv.SurveyUIUpdated.fire(),e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire(this.$el),this.jrny&&this.jrny.addEventObj({name:"feedback_survey_shown",properties:{fs_mid:[this.sv.cfg.mid]}})},s._showThankyou=function(){var i=this;this._removeWait();var s=this.epTemplate(this.sv);this.$closebtn=r('<span><img src="'+e.makeURI("$templates/feedback/"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton" alt="Close Button" role="button"></span>'),this.sv.cfg.preview||t.Bind(this.$closebtn,"feedback:click",(function(e){i.hide(e,!0)}),!0),this.$content.innerHTML=s,this.jrny&&this.jrny.addEventObj({name:"feedback_thankyou_shown",properties:{fs_mid:[this.cfg.mid]}}),this.$el.removeChild(this.$el.childNodes[0]),this.$el.removeChild(this.$el.childNodes[0]),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content);for(var n=this.$el.$(".acs-close-button")[0],a=this.$el.$("h1"),o=0;o<a.length;o++)r(a[o]).addClass("acs-feedback__heading acs-feedback__heading--h1");this.sv.cfg.preview||t.Bind(n,"feedback:click",()},s._getSurveyData=function(){var e=this;if(this.sv.isExpired())this.networkError.fire({type:"expired"});else{var t={mid:this.sv.cfg.mid,cachebust:(new Date).getTime()};this.sv.cfg.version&&(t.version=this.sv.cfg.version),this._surveyTimer=setTimeout((function(){e.networkError.fire({type:"timedout"})}),1e4),this.ajax.send({method:"GET",url:this.cfg.datauri,data:t,success:function(t){clearTimeout(e._surveyTimer),e.sv.SurveyData.fire(t,()},failure:function(){e.networkError.fire({type:"getdata_failed"})}})}},s._postSurveyData=function(e){var i=this;if(this.sv.cfg.preview)setTimeout((function(){if(e)return e()}),100);else{this._surveyTimer=setTimeout((function(){i.networkError.fire({type:"timedout"})}),1e4);var s=JSON.parse(this.sv._serialize());this.jrny&&this.jrny.config&&this.jrny.config.disableCpps&&this.jrny.config.disableCpps.indexOf("url")>-1&&(s.url=""),this.ajax.send({method:"POST",url:this.cfg.posturi,data:s,contentType:"application/json",success:function(){if(clearTimeout(i._surveyTimer),e)return e()},failure:function(){clearTimeout(i._surveyTimer),t.SeshStorage.prototype.setItem("acsFeedbackSubmitted","true"),i.networkError.fire({type:"postdata_failed"})}})}},i}(),d={},l=!1;var f,h,u,p,b=function(){function i(e,i,s,n,a,o){var c=this;this.sv=e,this.cfg=e.cfg,this.instcfg=s,this.browser=i,this.em=n,this.noserv=n,this.eptemplate=o,this.jrny=e.cfg.jrny,this.SurveySubmitted=new t.FSEvent,this.networkError=new t.FSEvent,this.instcfg.surveyurl&&!this.instcfg.popup?this.addCustomSurveyModal(this.instcfg.surveyurl):(this.add(),this.modaltemplate=a,this.ajax=new t.AjaxTransport,this.sv.SubmitClicked.subscribe((function(){c.$content.removeClass("acsVisible"),c._showWait(),c._postSurveyData((function(){c.jrny&&c.jrny.addEventObj({name:"feedback_submitted",properties:{fs_mid:[c.cfg.mid]}}),c.$content.addClass("acsVisible"),c._showThankyou(),c.SurveySubmitted.fire(),c._removeWait()}))})),this.networkError.subscribe((function(e){c._removeWait(),e&&e.type?c.jrny&&c.jrny.addEventObj({name:"feedback_survey_"+e.type,properties:{fs_mid:[c.cfg.mid]}}):c.jrny&&c.jrny.addEventObj({name:"feedback_server_error",properties:{fs_mid:[c.cfg.mid]}}),c.$content.innerHTML=c.noserv(c.survey);var i=c.$content.$("h1"),s=c.$content.$(".acs-close-button")[0],n=c.$content.$(".acs-serviceunavailable__message")[0];if("expired"===e.type){for(;n.firstChild;)n.removeChild(n.firstChild);if(c.sv.cfg.fbexpiremessage)n.appendChild(r("<p>"+c.sv.cfg.fbexpiremessage+"</p>"));else{var a=c._unencodeHTML(c.sv.defaultCfg.expired);n.appendChild(r(a))}}else{for(;n.firstChild;)n.removeChild(n.firstChild);var o=c._unencodeHTML(c.sv.defaultCfg.unavailable);n.appendChild(r(o))}for(var d=0;d<i.length;d++)r(i[d]).addClass("acs-feedback__heading acs-feedback__heading--h1");c.cfg.preview||(c.positionModal(),t.Bind(s,"feedbackModal:click",(function(){c.remove()}))),c.$content.addClass("acsVisible")})),this._getSurveyData())}var s=i.prototype;return s._showThankyou=function(){var e=this,i=this.eptemplate(this.survey);this.$content.innerHTML=i;for(var s=this.$content.$("h1"),n=this.$content.$(".acs-close-button")[0],a=document.getElementById("fsrModalFocus"),r=0;r<s.length;r++)t.addClass(s[r],"acs-feedback__heading acs-feedback__heading--h1");this.positionModal(),this.cfg.preview||t.Bind(n,"feedbackModal:click",(function(){e.remove()})),a.focus()},s._unencodeHTML=s._showWait=function(){this._removeWait(),this._wait=new o,this.$el.appendChild(this._wait.$el),this._wait.center();var e=t.getScroll(window),i=t.getSize(window);this._wait.$el.css({top:e.y+(i.h-this._wait.$el.offsetHeight)/2+"px"})},s._removeWait=s.remove=function(){this.$el&&this.$el.parentNode&&(t.Unbind("feedbackModal:*"),this.$el.parentNode.removeChild(this.$el),e.globalState.feedback.onFeedbackClosed.fire(this.$el))},s.addCustomSurveyModal=function(e){var i=this.browser.isMobile?"mobile":"desktop";new t.ModalIFrame(e,this.instcfg,i).show()},s.add=function(i){var s=this,n=(i=i||window).document.body,a=i.document.documentElement,o=Math.max(n.scrollHeight,n.offsetHeight,a.clientHeight,a.scrollHeight,a.offsetHeight),c="acsModalContainer--"+this.instcfg.template,d=this.sv.cfg,l=r('<div class="acsModalBackFace"></div>'),f=r('<div class="acsModalChrome"></div>');if(this.browser.isIE&&10==this.browser.browser.version&&(c+=" acsIE10"),this.$el=r('<div class="'+c+'"></div>'),this.$el.css({height:o}),!this.cfg.preview){var h=this;t.Bind(l,"feedbackModal:click",(function(){(s.survey||s.networkError.didFire)&&(h.jrny&&h.jrny.addEventObj({name:"feedback_abandoned",properties:{fs_mid:[d.mid]}}),s.remove())}));t.Bind(document.body,"feedbackModal:keyup",(function(e){"escape"==t.getKeyCode(e)&&(h.jrny&&h.jrny.addEventObj({name:"feedback_abandoned",properties:{fs_mid:[d.mid]}}),h.remove(),h.focusOnBadge())})),t.Bind(f,"feedbackModal:click",(function(e){var t=e.target;t&&t==f&&(h.jrny&&h.jrny.addEventObj({name:"feedback_abandoned",properties:{fs_mid:[d.mid]}}),h.remove(),h.focusOnBadge())}))}var u=this.head=r('<div class="acsModalContent" id="acsModalContent" role="dialog" aria-labelledby="acsFeedbackDialogTitle" aria-describedby="acsFeedbackDialogDesc"></div>'),p=r('<div class="acsModalHead" role="presentation"></div>'),b=r('<img id="fsrModalFocus" src="'+e.makeURI("$templates/feedback/"+(this.instcfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton" alt="Close Button" tabindex="0" role="button">');this.$head=p,p.appendChild(b),u.appendChild(p),this.$content=r('<div class="acsModalInnerContent" role="presentation"></div>'),u.appendChild(this.$content),f.appendChild(u),this.$el.appendChild(l),this.$el.appendChild(f),i.document.body.appendChild(this.$el),this.cfg.preview||(t.Bind(b,"feedbackModal:click",(function(){s.jrny&&s.jrny.addEventObj({name:"feedback_abandoned",properties:{fs_mid:[s.cfg.mid]}}),s.remove(),s.focusOnBadge()})),t.Bind(b,"feedbackModal:keypress",(function(e){var i=t.getKeyCode(e);("enter"==i||"spacebar"==i)&&(s.jrny.addEventObj({name:"feedback_abandoned",properties:{fs_mid:[s.cfg.mid]}}),s.remove(),s.focusOnBadge(),e.preventDefault())}))),e.nextTick((function(){l.addClass("_acsActive")})),this._showWait(),this._trapKeyBoard(u,b)},s.renderSurvey=function(){this._removeWait(),this.$head.addClass("acsVisible"),this.survey.ansLogoSrc=e.makeURI("$verint_foresee_logo.svg"),this.survey.meta.prologuetext=this._addTitleDescIds(this.survey.meta.prologuetext),this.survey.meta.epiloguetext=this._addTitleDescIds(this.survey.meta.epiloguetext);var t=this.modaltemplate(this.survey);this.$content.innerHTML=t,this.sv.bind(this.$content),this.positionModal(),this.$content.addClass("acsVisible"),e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire(this.$el),this.jrny&&this.jrny.addEventObj({name:"feedback_survey_shown",properties:{fs_mid:[this.cfg.mid]}}),e.globalState.feedback.onModalCssRetrieved.subscribe((,!0,!0)},s._addTitleDescIds=function(e){var t=document.createElement("div");t.innerHTML=e;var i=t.childNodes[0],s=t.childNodes[1],n="";if(t.childNodes.length>2)for(t.removeChild(t.childNodes[0]),(s=document.createElement("div")).setAttribute("style","padding: 0; margin: 0;");t.hasChildNodes();){var a=t.firstChild;t.removeChild(a),s.appendChild(a)}return i.setAttribute("id","acsFeedbackDialogTitle"),n=i.outerHTML,s&&(s.setAttribute("id","acsFeedbackDialogDesc"),n+=s.outerHTML),n},s.positionModal=function(){var e,i=t.getSize(window),s=this.$content.offsetHeight||this.prevOffsetHeight;i.h>s&&(e=Math.max(0,(i.h-s-50)/2)+"px"),this.head.style.marginTop=e,d&&d.FBALTOVERFLOW&&this.$el.css({"overflow-y":"scroll",display:"block"})},s.show=function(){this.positionModal(),this.$el.css({display:"block"}),e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire(this.$el)},s.focusOnBadge=function(){var e=this.instcfg.badge&&this.instcfg.badge.$el;e&&e.focus()},s._trapKeyBoard=function(e,i){i=i||e,t.Bind(document.body,"feedbackModal:focus",(function(s){var n=(s=s||window.event).target||s.srcElement,a=document.getElementById("acsMainInvite")||document.getElementById("fsrInvite");a&&t.DOMContains(a,n)||t.DOMContains(e,n)||i&&(s.stopPropagation(),i.focus())}),!1)},s._getSurveyData=function(){var t=this;if(this.sv.isExpired())this.networkError.fire({type:"expired"});else{var i={mid:this.sv.cfg.mid,cachebust:(new Date).getTime()};this.sv.cfg.version&&(i.version=this.sv.cfg.version),this._surveyTimer=setTimeout((function(){t.networkError.fire({type:"timedout"})}),1e4),this.ajax.send({url:this.sv.cfg.datauri,data:i,method:"GET",skipEncode:!1,success:function(i){t.networkError.didFire||(clearTimeout(t._surveyTimer),t.sv.SurveyData.fire(i,(function(i){t.survey=i,t.survey.CSSprefix=e.CSSprefix,t.renderSurvey()})))},failure:function(){t.networkError.didFire||t.networkError.fire({type:"getdata_failed"})}})}},s._postSurveyData=function(i){var s=this;if(this.cfg.preview)e.nextTick(();else{var n=JSON.parse(this.sv._serialize());this.jrny&&this.jrny.config&&this.jrny.config.disableCpps&&this.jrny.config.disableCpps.indexOf("url")>-1&&(n.url=""),e.isArray(n.responses)&&n.responses.push({questionId:"deployment_type",answerText:"BADGE"}),e.globalState.feedback.onFeedbackSubmitted.fire(e.ext({rating:this.sv._getScore()},n)),this._surveyTimer=setTimeout((,1e4),this.ajax.send({method:"POST",url:this.cfg.posturi,data:n,contentType:"application/json",success:function(){if(clearTimeout(s._surveyTimer),i)return i()},failure:function(){clearTimeout(s._surveyTimer),t.SeshStorage.prototype.setItem("acsFeedbackSubmitted","true"),s.networkError.fire({type:"postdata_failed"})}})}},i}(),m=function(){function i(e,i,s){this.height=600,this.width=400,this.survey=e,this.cfg=i,this.cpps=e.cpps,this.SurveySubmitted=new t.FSEvent,this.br=s,this.jrny=i.jrny,this.networkError=t.FSEvent()}return i.prototype.show=function(){var i=e.getVendorConfig("fs");if(e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),!this.winRef){var n,a=this.cfg.preview?null:JSON.stringify(this.cpps.all()),r=this,o=window,c=this.cfg.badge&&this.cfg.badge.btncfg&&this.cfg.badge.btncfg.surveyurl?this.cfg.badge.btncfg.surveyurl:this.cfg.surveyurl,d=this.cfg.badge&&this.cfg.badge.btncfg&&this.cfg.badge.btncfg.mid?this.cfg.badge.btncfg.mid:this.cfg.mid,l={global:i,product:this.cfg.preview?null:function(t,i){for(var s=e.ext({},i),n=0;n<s.instances.length;n++)if(t===s.instances[n].mid){s.instances=[e.ext({},s.instances[n],!1)];var a=s.instances[0];delete a.badge,delete a.jrny,delete a.record,delete a.stg;break}return s}(d,e.getProductConfig("fs","feedback"))},f=["&mid=",e.enc(d),"&_gwl_=",e.enc(e.home),"&_cv_=",e.enc(i.codeVer),"&_au_=",e.enc(i.analyticsUrl),"&_vt_=",e.enc(e.tagVersion),"&_issh_=",e.enc(e.isSelfHosted),"&_pa_=",e.enc(e.assetLocation),e.codeLocation?"&_cl_="+e.enc(e.codeLocation):""].join("");if(c)n=c+(-1===c.indexOf("?")?"?":"&")+this.cpps.toQueryString();else if(this.cfg.preview)n=e.makeURI(["$fs.feedbacksurvey.html?mid=",e.enc(this.survey.cfg.mid),"&t=",e.enc(this.cfg.template||"default"),"&datauri=",e.getParam("datauri"),"&ns=",e.enc("preview"),"&_gcfg_=",e.enc(s.compress(e.enc(JSON.stringify(l)))),f].join(""));else{n=e.makeURI(["$fs.feedbacksurvey.html?","&t=",e.enc(this.cfg.template||"default"),"&fsUrl=",e.enc(o.location.href),"&uid=",e.enc(e.globalState.feedback.stg.uid),"&ns=",e.enc(i.siteKey),"&brain=",e.enc(i.brainUrl),f].join("")),t.getBrainStorage(this.br,e.globalState.feedback.stg.uid,this.cfg.preview?"preview":i.siteKey,null,!0).set("fscfg",{gcfg:e.enc(s.compress(e.enc(JSON.stringify(l)))),cid:e.enc(i.customerId),cpps:e.enc(s.compress(a))})}this.br.isIE&&this.br.browser.actualVersion<=11&&("//"==n.substr(0,2)&&(n="https:"+n),"http:"==n.substr(0,5)&&n.replace("http:","https:")),this.cfg.preview&&(o!==o.top||o.location.toString().indexOf("fscommand=feedbackpreview")>-1)?o.location.href=n:(this.winRef=o.open(n,"_system"),this._checkerFailsAllowed=20,this._checker=setInterval((function(){try{if(!0===r.winRef.closed)return clearInterval(r._checker);var t=""+r.winRef.location,i="fsSurveyComplete=";if(t.indexOf(i)>-1){clearInterval(r._checker);var n=s.decompress(decodeURIComponent(t.substr(t.indexOf(i)+i.length)));e.globalState.feedback.onFeedbackSubmitted.fire(JSON.parse(n)),r.SurveySubmitted.fire(JSON.parse(n))}}catch(a){if(r._checkerFailsAllowed>0)return void r._checkerFailsAllowed--;clearInterval(r._checker),r.SurveySubmitted.fire()}}),500))}e.globalState.feedback.onFeedbackShown.fire(this.winRef)},i}(),v=function(){function s(e,i,s,n,a,r){this.cfg=e,this.br=i,this.cpps=s,this.errortemplate=n,this.modaltemplate=a,this.eptemplate=r,this.jrny=e.jrny,this.init(),this.SurveySubmitted=new t.FSEvent,this.NetworkError=new t.FSEvent}var n=s.prototype;return n.init=function(){var t=this;switch(this.cfg.surveytype){case"popup":this.survey=new i.Survey(this.cfg,this.cpps,this.br),this.chrome=new m(this.survey,this.cfg,this.br),this.chrome.SurveySubmitted.subscribe((function(){t.SurveySubmitted.fire(),e.globalState.feedback.onFeedbackClosed.fire()})),this.chrome.show();break;case"modal":e.isDefined(this.chrome)?(this.chrome.show(),e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire()):(this.survey=new i.Survey(this.cfg,this.cpps,this.br),this.chrome=new b(this.survey,this.br,this.cfg,this.errortemplate,this.modaltemplate,this.eptemplate),this.chrome.SurveySubmitted.subscribe((function(){t.SurveySubmitted.fire()})),this.chrome.networkError.subscribe((function(){t.NetworkError.fire()})));break;case"fullpage":e.isDefined(this.chrome)?(this.chrome.show(),e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire()):(this.survey=new i.Survey(this.cfg,this.cpps,this.br),this.chrome=new c(this.survey,this.br,this.cfg,this.errortemplate,this.modaltemplate,this.eptemplate),this.chrome.SurveySubmitted.subscribe((function(){t.SurveySubmitted.fire()})),this.chrome.networkError.subscribe((function(){t.NetworkError.fire()})));break;default:throw new Error("Unknown feedback surveytype: "+this.cfg.surveytype)}},n.show=n.remove=s}(),g={Current:null};g.getPopup=function(e){return!(t.getSize(window).w<=500)&&(!(!g.Current||g.Current.cfg.mid!=e)&&g.Current)},g.disposePopups=g.removePopup=function(e){g.Current&&g.Current.cfg.mid==e&&(g.Current.remove(),g.Current=null)},g.initialize=function(e,t,i,s,n,a){g.disposePopups(),e.surveytype||void 0===e.popup||(e.surveytype=e.popup?"popup":"modal"),e.surveytype=g.computeSurveyType(e.surveytype);var r,o=g.getPopup(e.mid);return o&&!o.cfg.popup?o.show():(o=new v(e,t,i,s,n,a),g.Current=o,o.SurveySubmitted.subscribe((r=e,),o.NetworkError.subscribe((function(){g.NetworkError.fire()}))),o},g.computeSurveyType=function(i){return"fullpage"!==i&&(e.globalState.feedback.browser.isMobile||t.getSize(window).w<=500)?"popup":i},g.SurveySubmitted=new t.FSEvent,g.NetworkError=new t.FSEvent;var y={launchFB:function(i){var s=!1,n=!1,a=e.getProductConfig("fs","feedback").instances;clearTimeout(f),clearTimeout(h),t._preventUnloadFor(500);for(var r=0;r<a.length;r++)if(a[r].mid==i){s=a[r];break}if(s&&s.disabled)return"This feedback has been disabled.";if(s.topics&&s.topics.length)for(var o=0;o<s.topics.length;o++)if(t.checkFeedbackTopicAllowed(s.topics[o])){n=!0;break}if(!s)return"Error: MID provided is not valid";if(!n&&0!==s.topics.length)return"Error: Either this measure is disabled or there are no active topics";if((n||0===s.topics.length)&&!s.disabled){if(s.surveytype||void 0===s.popup||(s.surveytype=s.popup?"popup":"modal"),s.template||(s.template="default"),"popup"==g.computeSurveyType(s.surveytype))return void g.initialize(s,e.globalState.feedback.browser,e.globalState.feedback.CPPS);var c={},d=function(i,s,n,a){var r=e.makeURI("$templates/feedback/"+(i||"default")+"/"+s+".html");new t.TemplateFetcher({success:function(e){return n&&n.resolve(),a(e)},failure:function(){n&&n.error()}}).get(r)},l=new t.Async(!0,(function(){console.warn("api: Fetched the templates "),void 0===e.globalState.feedback.browser&&(e.globalState.feedback.browser=new t.Browser),void 0===e.globalState.feedback.CPPS&&(e.globalState.feedback.CPPS=new t.CPPS(t.getGeneralStorage(e.globalState.feedback.browser))),g.initialize(s,e.globalState.feedback.browser,e.globalState.feedback.CPPS,c.emTemplate,c.svContentsTemplate,c.epTemplate)}),();l.enqueue((function(i){t.loadCSS(e.makeURI("$templates/feedback/"+(this.template||"default")+"/main.css"),(function(){e.globalState.feedback.onModalCssRetrieved.fire(),i&&i.resolve()}),(function(){i&&i.error()}))})),l.enqueue((function(e){d(s.template,"epilogue",e,(function(e){c.epTemplate=e}))})),l.enqueue((function(e){d(s.template,"surveycontents",e,(function(e){c.svContentsTemplate=e}))})),l.enqueue((function(e){d(s.template,"serviceunavailable",e,(function(e){c.emTemplate=e}))}))}},resetFeedback:function(){clearTimeout(h),f&&(clearTimeout(f),f=null),f=setTimeout((function(){for(f=null;p.length>0;){var i=p.pop();i.badge&&i.badge.dispose()}t.Unbind("feedback:*"),t.Unbind("feedbackModal:*"),g.disposePopups();var s=e.API.retrieveFromAPI("isProductCurrentlyQualified");s&&s("feedback")&&(h=e.nextTick(())}),200)}},w=function(){function i(e,t,i){this.template=i,this.br=e,this.cpps=t,this.emTemplate=null,this.css=null,this.typeTemplate=null,this.svContentsTemplate=null,this.epTemplate=null}var s=i.prototype;return s.getCss=function(i){t.loadCSS(e.makeURI("$templates/feedback/"+(this.template||"default")+"/main.css"),(function(t){t?(i&&i.resolve(),e.globalState.feedback.onModalCssRetrieved.fire()):i&&i.error()}),null,this.br)},s.getTemplate=function(i,s,n){var a=e.makeURI("$templates/feedback/"+(this.template||"default")+"/"+i+".html");new t.TemplateFetcher({success:function(e){if(s&&s.resolve(),n)return n(e)},failure:).get(a)},s.grabTemplates=function(e){var i=this;this.queue=new t.Async(!0,(function(){if(e)return e({typeTemplate:i.typeTemplate,emTemplate:i.emTemplate,epTemplate:i.epTemplate,svContentsTemplate:i.svContentsTemplate})}),(function(){})),this.queue.enqueue((),this.queue.enqueue((function(e){i.getTemplate("badge",e,(function(e){i.typeTemplate=e}))})),this.queue.enqueue((function(e){i.getTemplate("serviceunavailable",e,(function(e){i.emTemplate=e}))})),this.queue.enqueue((function(e){i.getTemplate("epilogue",e,(function(e){i.epTemplate=e}))})),this.queue.enqueue((function(e){i.getTemplate("surveycontents",e,()}))},i}(),k=function(e,i,s){var n=this;this.br=e,this.cpps=i,this.templateHolder={},this.loadSuccess=new t.FSEvent,this.loadFailure=new t.FSEvent;var a=new t.Async(!0,(,();s.forEach((function(e){a.enqueue((function(t){new w(n.br,n.cpps,e).grabTemplates((function(i){i?(n.templateHolder[e]=i,t.resolve()):t.error()}))}))}))},S=function(){function i(i){this.br=i,this.mid=t.getHashParm("mid"),this.previewmode=e.toLowerCase(t.getHashParm("previewmode")),this.datauri=t.getHashParm("datauri"),this.template=t.getHashParm("template")||"default",this.surveytype=t.getHashParm("surveytype")?t.getHashParm("surveytype"):"modal",this.tempHolder={}}return i.prototype.show=function(){var e=this;if(!(this.mid&&this.previewmode&&this.datauri))throw new Error("You need mid, previewmode, and datauri.");var t=new k(this.br,{},[this.template]);t.loadSuccess.subscribe((function(t){e.tempHolder=t[e.template],g.initialize({mid:e.mid,datauri:e.datauri,posturi:"",reporturi:"",surveytype:e.surveytype,autowhitelist:!0,preview:!0,template:e.template,replay:!1},e.br,null,e.tempHolder.emTemplate,e.tempHolder.svContentsTemplate,e.tempHolder.epTemplate)})),t.loadFailure.subscribe((function(){}))},i}(),_=function(){function i(i,s,n,a,r,o){this.cfg=i,this.cpps=n,this.jrny=i.jrny;var c,d="acsFeedbackResultsCounter",l=i.previewMode?i.previewMode.toLowerCase():"";(this.btncfg=i,this.badgeClicked=new t.FSEvent,this.surveyTriggered=new t.FSEvent,this.br=s,i.devices&&i.devices.overridesEnabled)&&(c=s.isTablet||"tablet"===l?i.devices.tablet:s.isMobile||"mobile"===l?i.devices.mobile:i.devices.desktop,e.ext(this.cfg,c),this.cfg.icon.lastIndexOf(".png")>-1&&(this.btncfg.icon=this.cfg.icon.replace(".png",".svg")));this.animationMove=4,i.counter&&(this.counter=0,sessionStorage.getItem(d)&&(this.counter=Math.round(parseFloat(sessionStorage.getItem(d))),this.counter=isNaN(this.counter)?0:this.counter),this.btncfg.counter=this.counter,this.btncfg.counterLocale=i.counter.toLocaleString()),this.btncfg.fbsize=this.cfg.fbsize||"medium",this.btncfg.btnClass="_acs _acs"+i.fbtype+"--"+i.template+" _acsbadge--"+this.btncfg.fbsize+" _acs"+i.fblocation,this.btncfg.fbcolortext=this.btncfg.fbcolortext||"#fff",this.btnTemplate=a,this.emtemplate=r,this.enabled=!!o}var s=i.prototype;return s.setBtnTemplate=function(){var i=this,s=this,n={btncfg:this.btncfg},a=this.btnTemplate(n),o=t.getGeneralStorage(this.br),c=e.getProductConfig("fs","trigger");(s.badgeClicked.subscribe((function(){s.jrny&&s.jrny.addEventObj({name:"feedback_clicked"+(s.br.isMobile?"_mobile":""),properties:{fs_mid:[s.cfg.mid]}}),s.surveyTriggered.fire({emtemplate:s.emtemplate})}),!1,!0),this.$el=document.createElement("div"),this.$el.innerHTML=a,this.$el=r(this.$el.querySelectorAll("a._acs")[0]),this.enabled&&(t.Bind(this.$el,"feedback:click",(function(){if(s._unhover(),s.badgeClicked.fire(s.cfg),c&&c.config.hideBadgeAfterInteraction){var e=t.now()+24*c.config.hideBadgeAfterInteractionForDays*60*60*1e3;o.set("rb_"+s.cfg.mid,e)}})),t.Bind(this.$el,"feedback:keypress",(function(e){var i=t.getKeyCode(e);"enter"!==i&&"spacebar"!==i||(s._unhover(),s.badgeClicked.fire(s.cfg))}))),this.cfg.fbanimate&&(t.Bind(this.$el,"feedback:mouseenter",(function(){s._hover()})),t.Bind(this.$el,"feedback:mouseleave",(function(){s._unhover()}))),this.btncfg.label.length||(this.$el.querySelector("._acsBadgeLabel").style.paddingLeft=0),c&&(c.config.hideBadgeAfterInteraction||c.config.hideBadgeAfterSubmitting))?!o.get("rb_"+s.cfg.mid)&&document.body.appendChild(this.$el):document.body.appendChild(this.$el);d&&!d.FBALTPOSITION&&t.addClass(document.documentElement,"fsfb fsfb-relbody"),this.cfg.delay&&this.cfg.delay>0?setTimeout((,this.cfg.delay):this.init()},s._hover=function(){this.cfg.fbanimate&&this.$el.addClass("_acsHover")},s._unhover=s.init=function(e){var i=this.$el.$("._acsBadgeLabel"),s=this,n=t.getGeneralStorage(this.br);if(e=e||function(){},s.jrny&&!n.get("fbb")&&(n.set("fbb","s",864e5),s.jrny.addEventObj({name:"feedback_button_shown",properties:{fs_mid:[s.cfg.mid]}})),this.$el.css({visibility:"hidden"}),i&&i.length>0){if(e){var a=this.$el;setTimeout((function(){s._unhover(),setTimeout((,250)}),250),"vertical"==this.cfg.fbdirection&&(this.cfg.fblocation.indexOf("right")>-1?this.$el.addClass("_acsVertical_right"):this.$el.addClass("_acsVertical_left")),this.cfg.fbfixed&&this.$el.addClass("_acsFixed")}"none"===this.cfg.fbtype?this.$el.css({display:"none"}):this.$el.css({visibility:"visible"}),s.br.isMobile&&this.$el.setAttribute("role","link")}},s.remove=s.dispose=i}();function C(e,t){e=e||this.cfg,t=t||this.br;var i=e.previewMode?e.previewMode.toLowerCase():"",s=e.fbtype;return e&&t?(e.devices&&e.devices.overridesEnabled&&(s=t.isTablet||"tablet"===i?e.devices.tablet.fbtype||e.fbtype:t.isMobile||"mobile"===i?e.devices.mobile.fbtype||e.fbtype:e.devices.desktop.fbtype||e.fbtype),s):s}var $=function(){function e(e,t,i){this.cfg=e,this.br=t,this.cpps=i,this.cfg.template=void 0!==this.cfg.template?this.cfg.template:"default",this.cfg.surveytype=void 0!==this.cfg.surveytype?this.cfg.surveytype:"modal",this.cfg.fbcolor=void 0!==this.cfg.fbcolor?this.cfg.fbcolor:"#F24554",this.cfg.fbcolortext=void 0!==this.cfg.fbcolortext?this.cfg.fbcolortext:"#FFFFFF",this.cfg.replay=void 0!==this.cfg.replay&&this.cfg.replay}return e.prototype.renderBadge=function(){var e=this,t=new k(this.br,this.cpps,[this.cfg.template]);t.loadSuccess.subscribe((function(t){var i=t[e.cfg.template];e.cfg.badge=new _(e.cfg,e.br,e.cpps,i.typeTemplate,i.emTemplate,!1),e.cfg.badge.setBtnTemplate()})),t.loadFailure.subscribe((function(){}))},e}();t.registerProduct("feedback");var T=[],F=window.location;function E(){var i=e.getVendorConfig("fs"),s=e.getProductConfig("fs","feedback"),n=e.getProductConfig("fs","trigger"),a=!!t.getHashParm("previewmode"),r=!!e.getParam("previewbadgemode"),o=s.instances,c=[],d=!1;F=JSON.parse(JSON.stringify(window.location));var l=new t.Browser;l.ready.subscribe((function(){var s=t.getGeneralStorage(l);s.ready.subscribe((function(){if(a){new S(l).show()}else{var f=new t.CPPS(s),h=i.adobeRsid;t.initBehavioralData(i.customerId||t.getRootDomain()||"feedback_customerId",s,l,f),f.set("code",i.codeVer),f.set("tz",-(new Date).getTimezoneOffset()),f.set("env",e.isProduction?"prd":"stg"),t.INT.GA.uid(();var u=if(t.INT.OM.uid(h,u),t.INT.OM.mcid(h,u),t.INT.OM.beacon((),r){var p=JSON.parse(e.getParam("cfg")),b=e.getQueryString("previewbadgemode")||"desktop";p.mid&&(p.previewMode=b,new $(p,l,f).renderBadge())}else{e.globalState.feedback.CPPS=f,e.globalState.feedback.browser=l,e.globalState.feedback.stg=s,e.globalState.feedback.__apiReady&&e.globalState.feedback.__apiReady.fire();var m=e.API.retrieveFromAPI("isProductCurrentlyQualified");if(!m||m("feedback")){for(var v=0;v<o.length;v++){var y=o[v];if(!0===y.replay&&!1===y.disabled&&(d=!0),(y.__didpass||y.topics&&0===y.topics.length)&&!y.disabled&&window==window.top){var w=!1;y.template||(y.template="default");for(var F=0;F<c.length;F++)c[F]===y.template&&(w=!0);w||c.push(y.template),y.jrny=new t.Journey({customerId:i.customerId||t.getRootDomain()||"feedback_customerId",appId:t.APPID.FEEDBACK,stg:s,browser:l,throttleDuration:1e3,useSessionId:!0,usePopupId:!1}),T.push(y)}}if(T.length>0){var E,j=c.length>0?c:["default"];new k(l,f,j).loadSuccess.subscribe((function(i){for(var a=0;a<T.length;a++){var r=T[a];if("badge"===C(r,l)){e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),0==a&&l.isIE&&((E=document.createElement("div")).className="acs-feedback__forcefont",document.body.appendChild(E));var o=i[r.template];r.badge=new _(r,l,f,o.typeTemplate,o.emTemplate,!0),r.badge.setBtnTemplate(),r.badge.surveyTriggered.subscribe(c(r,o),!1,!1)}}function c(t,i){return function(){n&&n.config.hideBadgeAfterInteraction&&h(t.badge.cfg),!0===t.replay&&d&&e.globalState.onRecordQualified.fire("feedback"),t.jrny.initPopupId(),g.initialize(t,l,f,i.emTemplate,i.svContentsTemplate,i.epTemplate)}}function h(e){var t,i;if(e&&e.mid)for(t=0;t<T.length;t++)T[t].badge&&T[t].mid===e.mid&&T[t].badge.remove();else for(i=0;i<T.length;i++)T[i].badge&&T[i].badge.remove()}g.SurveySubmitted.subscribe((function(e){if(h(e),n&&n.config.hideBadgeAfterSubmitting){var i=t.now()+60*n.config.hideBadgeAfterSubmittingForDays*60*24*1e3;s.set("rb_"+e.mid,i)}}))}),!0,!0)}}}}}),!0,!0)}),!0,!0)}return n.API=y,n.startup=function(){if(function(){var t=e.getProductConfig("fs","fbmods")||{},i=e.toLowerCase(window.location.href.toString());if((t.noPositionRelativeBody||i.indexOf("buildabear.c")>-1||i.indexOf("bab-dev-store.sparkred.")>-1||i.indexOf("humana.c")>-1||i.indexOf(".dteenergy.c")>-1||i.indexOf(".mcdonalds.")>-1)&&(d.FBALTPOSITION=!0),(t.overflowScroll||i.indexOf(".peco.c")>-1||i.indexOf(".bge.com")>-1||i.indexOf(".comed.com")>-1)&&(d.FBALTOVERFLOW=!0),(t.skipIFrames||i.indexOf("argos.co")>-1)&&window!==window.top)return!1;if(t.temporaryCssHack&&!l){l=!0;var s=document.createElement("style");s.innerHTML="\n/* ForSee Feedback CSS Styles */\n"+t.temporaryCssHack,document.head.appendChild(s)}return!0}()){if(e.fsCmd("feedbackreport")||e.supportsDomStorage&&"true"==sessionStorage.getItem("fsFeedbackLoaded"))return e.supportsDomStorage&&t.SeshStorage.prototype.setItem("fsFeedbackLoaded","true"),void window._fsRequire([e.makeURI("$fs.feedbackreport.js")],();!E,T),e.domReady(E),e.globalState.feedback.pageResetFn=function(){var t,i=window.location,s=function(e){var t=(e=e||"").split("#");return t.length>2?t[0]+t[1]:e.replace(/#/gi,"")};s(F.hash)==s(i.hash)&&F.pathname==i.pathname||window.fsReady((function(){clearTimeout(t),t=setTimeout((function(){F=JSON.parse(JSON.stringify(window.location));var t=e.API.retrieveFromAPI("resetFeedback");e.isFunction(t)&&t()}),1e3)}))},t.pageNavEvent.subscribe(e.globalState.feedback.pageResetFn,!1,!1)}},n}));
