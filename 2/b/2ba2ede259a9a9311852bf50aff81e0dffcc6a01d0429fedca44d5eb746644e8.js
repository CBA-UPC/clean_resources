!);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"redpop@b474a6ad4354f4ba5fde672fa4e9c2c267684761"};"use strict";(self.webpackChunk_tumblr_redpop=self.webpackChunk_tumblr_redpop||[]).push([[2474],{77095:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(36343),a=(0,i.q)("close"),r=(0,i.q)("close-inverted");a.defaultProps={size:{width:24,height:24}},r.defaultProps={size:{width:24,height:24}};let n=a},28559:(e,t,s)=>{s.d(t,{Z:()=>a});var i=(0,s(36343).q)("copy");i.defaultProps={size:{width:24,height:23}};let a=i},85986:(e,t,s)=>{s.d(t,{Z:()=>a});var i=(0,s(36343).q)("twitter");i.defaultProps={size:{width:24,height:24}};let a=i},4237:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(50209),a=s.n(i),r=s(95004),n=s(93853),o=s(17144),l=s(78667),c=s(2629),d=e=>{var t=e.children,s=e.avatar;return(0,c.jsxs)("div",{className:"JWdar",children:[s,t]})};class h extends r.Component{constructor(){super(...arguments),a()(this,"placeHolders",[this.props.appContext._t("New message"),this.props.appContext._t("Your message here"),this.props.appContext._t("Write a message"),this.props.appContext._t("Say something"),this.props.appContext._t("Say your thing")]),a()(this,"state",{textareaHeight:"auto",textareaHasFocus:!!this.props.autoFocus,placeholder:this.props.isDeactivated?this.props.appContext._c("Placeholder of messaging input when receiver is deactivated account","Messaging unavailable"):this.props.isDisabled?"":(0,o.I)(this.placeHolders)}),a()(this,"textareaRef",(0,r.createRef)()),a()(this,"focus",,a()(this,"onFocus",()=>this.setState({textareaHasFocus:!0})),a()(this,"onBlur",,a()(this,"onPaste",e=>{var t,s,i=function(e){var t=Array.from(e.clipboardData.items).filter(;return 0===t.length?[]:t.map(.filter(}(e);i.length&&(null===(t=(s=this.props).onPasteImage)||void 0===t||t.call(s,i[i.length-1]))}),a()(this,"onKeyDown",e=>{if(e.key===n.SV.Enter&&!e.shiftKey&&!e.nativeEvent.isComposing){var t=this.props.onSubmit;e.preventDefault(),t&&t()}}),a()(this,"resizeTextarea",()=>{var e=this.props,t=e.heightModifier,s=e.onResize;this.setState({textareaHeight:"auto"},()=>{this.textareaRef.current&&void 0!==t&&this.setState({textareaHeight:`${this.textareaRef.current.scrollHeight+t}px`},})})}nder(){var e=this.props,t=e.value,s=e.onSubmit,i=e.onChange,a=e.autoFocus,r=e.maxLength,o=e.isDisabled,l=e.isMobile,h=e.avatar,p=this.state,u=p.textareaHeight,g=p.textareaHasFocus,m=p.placeholder;return(0,c.jsxs)(c.Fragment,{children:[!l&&(0,c.jsx)(n.ZP,{disable:g?n.z9:void 0}),(0,c.jsx)(d,{avatar:h,children:(0,c.jsx)("textarea",{ref:this.textareaRef,className:"xXTjk",autoFocus:a,placeholder:m,value:t,rows:1,maxLength:r,onSubmit:s,onChange:i,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onPaste:this.onPaste,onBlur:this.onBlur,disabled:o,style:{height:u,overflowY:"auto"===u?"hidden":"auto"}})})]})}}a()(h,"defaultProps",{maxLength:4096,autoFocus:!1,heightModifier:0});let p=(0,l.tM)(h)},17144:(e,t,s)=>{s.d(t,{I:()=>a});var i=s(68782);,36874:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(43523),a=s(78667),r=s(43166),n=s(45524);let o=()=>{var e=(0,a.bp)(),t=e.logEvent,s=e.isLoggedIn,o=(0,r.uu)().post,l=o.id,c=o.placementId,d=o.earnedId;return(e,a)=>{t({eventName:a,eventDetails:{post_id:l,placement_id:c,is_logged_in:s,type:e}}),t({eventName:i.J.ShareDestination,eventDetails:{placement_id:c,earned_id:d,is_logged_in:s,type:"post",dest:e===n.Is.Copy?"copyPermalink":e}})}}},78891:(e,t,s)=>{s.r(t),s.d(t,{GET_SUGGESTED_BLOGS_DEBOUNCE_TIME:()=>ec,default:()=>ep});var i=s(33970),a=s.n(i),r=s(54138),n=s.n(r),o=s(50209),l=s.n(o),c=s(5754),d=s.n(c),h=s(95004),p=s(45222),u=s(20069),g=s(44009),m=s(93853),f=s(2474),v=s(77095),b=s(19486),x=s(6135),S=s(4237),C=s(53714),P=s(28559),y=s(25447),w=s(43523),I=s(66498),k=s(45524),j=s(78667),F=s(14544),N=s(34056),B=s(63583),T=s.n(B),R=s(36874),_=s(2629);let A=e=>{var t=e.fill,s=e.onClick,i=e.iconComponent,a=e.caption,r=e.buttonFill,n=void 0===r?T().white:r,o=(0,F.M)().name,l={backgroundColor:o===I.Z.cybernetic?T().paletteWhite:n},c=o===I.Z.cybernetic?T().paletteWhiteOnDark:t;return(0,_.jsxs)(g.Z,{wrapperClassName:"oea_J",className:"baUXc",onClick:s,label:a,children:[(0,_.jsx)("div",{className:"Z8bqG",style:l,children:(0,_.jsx)(i,{colors:{primary:c},size:{width:22,height:22}})}),(0,_.jsx)("span",{className:"iOPva",children:a})]})},E=e=>{var t=e.postUrl,s=(0,R.Z)(),i=(0,j.bp)()._c,r=(0,F.M)().name,n=(0,h.useState)(y.d.Unclicked),o=a()(n,2),l=o[0],c=o[1],d=(0,h.useState)(!1),p=a()(d,2),u=p[0],g=p[1];(0,h.useEffect)(()=>{var e;if(!(null!==(e=navigator)&&void 0!==e&&null!==(e=e.permissions)&&void 0!==e&&e.query)){g(!0);return}navigator.permissions.query({name:"clipboard-write",allowWithoutGesture:!0}).then(e=>{g("granted"==e.state||"prompt"==e.state)},},[u,g]);var m=(0,h.useRef)(null),f=()=>{c(y.d.Success),s(k.Is.Copy,w.J.CopyPostLink),setTimeout(()=>c(y.d.Unclicked),2e3)},v=()=>{c(y.d.Failure),setTimeout(2e3)},b=(e=>{switch(e){case y.d.Unclicked:return{caption:i("Menu item to copy the link to a post to your clipboard","Copy link"),fill:T().gray65};case y.d.Success:return{caption:i("Success message after copying a link","Link copied!"),buttonFill:T().paletteGreen,fill:T().paletteWhiteOnDark};case y.d.Failure:return{caption:i("Error message when trying to copy a link","Failed to copy link."),buttonFill:T().paletteRed,fill:T().paletteWhiteOnDark}}})(l),x=b.caption,S=b.fill,C=b.buttonFill,B=r===I.Z.cybernetic?T().paletteWhiteOnDark:C;return u?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(A,{fill:S,onClick:()=>{(0,N.z)(t).then(f).catch(()=>{m.current&&(0,N.F)(m.current)?f():v()})},iconComponent:P.Z,caption:x,buttonFill:B}),(0,_.jsx)("textarea",{ref:m,className:"HX0fM",tabIndex:-1,children:t})]}):null};var M=s(78994),Z=s(36343),U=(0,Z.q)("embed");U.defaultProps={size:{width:24,height:24}};var D=s(90127);let H=e=>{var t=e.id,s=e.blog,i=e.embedUrl,a=(0,R.Z)(),r=(0,j.bp)(),n=r._c,o=r.features.embedPost2022,l=(0,M.s0)();return(0,_.jsx)(A,{fill:T().gray65,onClick:()=>{o&&null!=s&&s.name&&t?l((0,D.g3)({postId:t,blogName:s.name})):window.open(i,"_blank","noreferrer,noopener"),a(k.Is.Embed,w.J.Share)},iconComponent:U,caption:n("The caption for a button that will allow you to get the code to embed html into a page","Embed")})};var z=(0,Z.q)("facebook");z.defaultProps={size:{width:24,height:24}};var O=s(57768);let W=e=>{var t=e.actionType,s=e.urlStub,i=e.queryParams,a=e.windowName,r=e.fill,n=e.iconComponent,o=e.caption,l=e.buttonFill,c=(0,R.Z)();return(0,_.jsx)(A,{fill:r,onClick:()=>{(0,O.l)(s,i,{top:0,left:0,width:600,height:450,toolbar:"no",menubar:"no"},a),c(t,w.J.Share)},iconComponent:n,caption:o,buttonFill:l})},q=e=>{var t=e.postUrl;return(0,_.jsx)(W,{actionType:k.Is.Facebook,urlStub:k.ho.Facebook,queryParams:{u:t},windowName:"facebookShare",fill:T().facebookBlue,iconComponent:z,caption:"Facebook"})};var L=(0,Z.q)("pinterest");L.defaultProps={size:{width:24,height:24}};let V=e=>{var t=e.postUrl;return(0,_.jsx)(W,{actionType:k.Is.Pinterest,urlStub:k.ho.Pinterest,queryParams:{url:t},windowName:"pinterestShare",fill:T().pinterestRed,iconComponent:L,caption:"Pinterest"})};var G=(0,Z.q)("reddit");G.defaultProps={size:{width:24,height:24}};let K=e=>{var t=e.postUrl;return(0,_.jsx)(W,{actionType:k.Is.Reddit,urlStub:k.ho.Reddit,queryParams:{url:t},windowName:"redditShare",fill:T().black,iconComponent:G,caption:"Reddit"})};var J=s(85986);let Y=e=>{var t=e.postUrl;return(0,_.jsx)(W,{actionType:k.Is.Twitter,urlStub:k.ho.Twitter,queryParams:{url:t},windowName:"twitterShare",fill:T().twitterBlue,iconComponent:J.Z,caption:"Twitter"})};var X=s(60189),$=s(54382),Q=s(37236),ee=s(10131),et=s(85795),es=s(93415),ei=s(59215),ea=s(42914),er=s(44561),en=s(86033),eo=s(70505);let el={sendAPost:"nTtVZ",searchWrapper:"rnFEP",icon:"Yexkw",searchInput:"GISqs",selectedPills:"gaUpz",pillContainer:"hsO5V",recipientPill:"c3A_k",closePill:"IznjY",results:"KAE3V",noResults:"uiB5u",blogSuggestions:"T1G8P",blogInfo:"wAOAc",avatar:"IrKkW",isSelected:"PsNK0",blogName:"coBOo",blogTitle:"H6xf6",messageBoxWrapper:"A__g4",compositionAreaWrapper:"Rw5fx",sendButton:"cFsuL",errorMessage:"QJkxF",backButton:"A0l7h",actionsWrapper:"CTDfP",actions:"gdfgp"};var ec=250,ed={background:"currentColor",boxShadow:"0 0 0 2px currentColor"};class eh extends h.Component{constructor(){super(...arguments),l()(this,"state",{blogs:[],blogSearchName:"",isLoading:!0,recipients:[],recipientsHash:{},userBlogs:[],senderBlog:void 0,messageValue:"",sendInProgress:!1,isSenderVerified:!0}),l()(this,"containerRef",null),l()(this,"searchInputRef",null),l()(this,"apiHelper",(0,et.ZP)(this.props.appContext.apiFetch)),l()(this,"suggestedBlogsFetch",null),l()(this,"userInfoFetch",null),l()(this,"setContainerRef",e=>this.containerRef=e),l()(this,"setSearchInputRef",,l()(this,"debouncedGetSuggestedBlogs",(0,ea.Z)(ec)),l()(this,"onChangeSearchInput",e=>this.setState({blogSearchName:e.target.value},this.debouncedGetSuggestedBlogs)),l()(this,"onKeyDownSearchInput",e=>{var t=this.state,s=t.blogSearchName,i=t.recipients;e.key===m.SV.Backspace&&i.length&&""===s&&this.toggleRecipient(i[i.length-1])}),l()(this,"getToggleRecipientOnClick",e=>t=>{t.preventDefault(),t.nativeEvent.stopImmediatePropagation(),this.toggleRecipient(e)}),l()(this,"onClickSelectedBlog",,l()(this,"onChangeMessageTextarea",,l()(this,"getFillColorForTheme",e=>null!=e&&e.linkColor?(0,eo.sW)(this.props.paletteContext.colors.white,e.linkColor):this.props.paletteContext.colors.accent),l()(this,"sendPost",e=>t=>{var s=this.state,i=s.messageValue,a=s.senderBlog,r=s.recipients,o=s.sendInProgress,l=this.props,c=l.appContext,d=c.logEvent,h=c._t,p=l.asText,u=l.shortUrl,g=l.id,m=l.close,f=l.blog.uuid,v=l.placementId,b=l.earnedId,x=l.toastContext.toggleToast,S=this.props.messagingContext.openConversationWindow;if(null==t||t.stopPropagation(),!r.length||o||!f||!(null!=a&&a.uuid))return Promise.resolve();this.setState({sendInProgress:!0});var C=a.uuid,P=n()(n()({type:p?ee.C.Text:ee.C.Post,participant:C},p&&{content:{text:null!=u?u:""}}),!p&&{postToShare:{id:g,blog:f}}),y={type:ee.C.Text,participant:C,content:{text:i}},I=r.reduce((e,t)=>(t.uuid&&e.push({participants:[t.uuid,C]}),e),[]);return this.apiHelper.batchSendMessage(P,I).fetch().then(()=>i?this.apiHelper.batchSendMessage(y,I).fetch():Promise.resolve({})).then(()=>{d({eventName:w.J.SendAPostSelected,eventDetails:{placement_id:v,earned_id:b}}),this.props.isMobile||1!==r.length?x(h("The post was shared!")):null==S||S({selectedBlogName:null==a?void 0:a.name,otherParticipantName:r[0].name}),null==m||m(),null==e||e.closeContainingPopover()}).catch(e=>{var t;(null==e||null===(t=e.detailedErrors)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.code)===7001&&this.setState({isSenderVerified:!1}),this.setState({sendInProgress:!1})})}),l()(this,"toggleRecipient",e=>{if(e.uuid){var t=this.state,s=t.recipients,i=t.recipientsHash;i[e.uuid]?(s.splice(s.indexOf(e),1),this.setState({recipients:s}),delete i[e.uuid]):(i[e.uuid]=e,this.setState({recipientsHash:i,recipients:s.concat(e),blogSearchName:""}))}}),l()(this,"getSuggestedBlogs",()=>{this.setState({isLoading:!0});var e,t=this.props.blog,s=this.state.blogSearchName;null===(e=this.suggestedBlogsFetch)||void 0===e||e.cancel(),this.suggestedBlogsFetch=(0,en.Z)(this.apiHelper.getSuggestedParticipants(void 0,{q:s,limit:12,include_recent:!0}).fetch()),Promise.all([this.suggestedBlogsFetch,this.getUserInfo()]).then(e=>{var s=a()(e,1)[0].response.blogs,i=this.state.senderBlog;this.setState({blogs:(t.uuid===(null==i?void 0:i.uuid)?s.filter(:s.some(?s:[t,...s]).filter(,isLoading:!1})}).catch(e=>{var t;(null==e||null===(t=e.detailedErrors)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.code)===7001&&this.setState({isLoading:!1,isSenderVerified:!1})})}),l()(this,"getUserInfo",()=>this.state.senderBlog?Promise.resolve():(this.userInfoFetch=(0,en.Z)(this.props.appContext.getUserInfo().then(),this.userInfoFetch.then(e=>{var t=e.blogs.filter(;return new Promise(e=>this.setState({userBlogs:t,senderBlog:(0,er.Z)(t)},e))})))}componentDidMount(){var e,t=this.props,s=t.hideMessaging,i=t.appContext.isLoggedIn;null===(e=this.searchInputRef)||void 0===e||e.focus(),i&&!s&&this.getSuggestedBlogs()}componentWillUnmount(){var e,t;null===(e=this.suggestedBlogsFetch)||void 0===e||e.cancel(),null===(t=this.userInfoFetch)||void 0===t||t.cancel(),this.debouncedGetSuggestedBlogs.cancel()}render(){var e,t=this.state.isSenderVerified;return(0,_.jsx)("div",{className:d()(el.sendAPost,null===(e=this.props)||void 0===e?void 0:e.className),ref:this.setContainerRef,children:(0,_.jsxs)(es.I.Provider,{value:this.containerRef,children:[(0,_.jsx)(m.ZP,{disable:m.z9}),t?this.renderSearchBarAndActions():this.renderVerificationErrorAndPostActionsAfterSendFails()]})})}renderSearchBarAndActions(){var e=this.props,t=e.hideMessaging,s=e.appContext,i=s._t,a=s.isLoggedIn,r=this.state,n=r.blogSearchName,o=r.isLoading,l=r.messageValue,c=r.recipients,d=r.senderBlog,h=r.sendInProgress,p=r.userBlogs;return(0,_.jsxs)(_.Fragment,{children:[a&&!t&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)("div",{className:el.searchWrapper,children:[this.props.isMobile&&this.renderMobileBackButton(),(0,_.jsx)("div",{className:el.icon,children:(0,_.jsx)(b.Z,{colors:{primary:T().paletteGray65},size:{width:18,height:18}})}),(0,_.jsxs)("div",{className:el.selectedPills,children:[(0,_.jsx)("ul",{className:el.pillContainer,children:this.renderRecipientPills()}),(0,_.jsx)("input",{type:"text",onChange:this.onChangeSearchInput,onKeyDown:this.onKeyDownSearchInput,value:n,className:el.searchInput,placeholder:c.length?"":i("Message to..."),ref:this.setSearchInputRef})]})]}),(0,_.jsx)("div",{className:el.results,"aria-label":i("Suggested blogs"),children:o?(0,_.jsx)(x.Z,{centerOrientation:"horizontal"}):this.renderLoadedRecipientSelection()})]}),c.length?(0,_.jsx)(C.LW.Consumer,{children:e=>(0,_.jsxs)("div",{className:el.messageBoxWrapper,children:[(0,_.jsx)("div",{className:el.compositionAreaWrapper,children:(0,_.jsx)(S.Z,{value:l,maxLength:400,isMobile:!!this.props.isMobile,onChange:this.onChangeMessageTextarea,onSubmit:this.sendPost(e),avatar:d?(0,_.jsx)(u.ZP,{blogs:p,onClickSelectedBlog:this.onClickSelectedBlog,selectedBlog:d,avatarShape:Q.o.Circle,avatarDimension:24,displayAvatar:!0,avatarOnly:!0}):null})}),(0,_.jsx)(X.Z,{wrapperClassName:el.sendButton,disabled:h,onClick:this.sendPost(e),style:{fill:this.getFillColorForTheme(c[0].theme)},forceUseAirplane:!0})]})}):this.renderPostActions()]})}renderVerificationErrorAndPostActionsAfterSendFails(){return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("p",{className:el.errorMessage,children:(0,_.jsx)($.ZP,{children:"Hold up! You need to verify your email address before you can send this post to an other Tumblr. In the meantime, share it on social media."})}),this.renderPostActions()]})}renderMobileBackButton(){var e=this.props.appContext._t;return(0,_.jsx)(g.Z,{wrapperClassName:el.backButton,label:e("Return"),onClick:this.props.close,children:(0,_.jsx)(f.Mq,{colors:{primary:T().paletteGray65},size:{width:18,height:18}})})}renderRecipientPills(){var e=this.state.recipients;return!!e.length&&(0,_.jsx)(_.Fragment,{children:null==e?void 0:e.map(e=>(0,_.jsxs)("li",{className:el.recipientPill,style:{background:this.getFillColorForTheme(e.theme)},children:[e.name,(0,_.jsx)(v.Z,{className:el.closePill,size:{width:12,height:12},onClick:this.getToggleRecipientOnClick(e)})]},e.name))})}renderLoadedRecipientSelection(){var e=this.state,t=e.recipients,s=e.blogs,i=e.recipientsHash,a=this.props.appContext._t;return!!(null!=s&&s.length)&&(0,_.jsxs)("div",{className:el.blogSuggestions,children:[t.map(,s.map(e=>e.uuid&&i[e.uuid]?null:this.renderBlogInfoCard(e,!1))]})||(0,_.jsx)("p",{className:el.noResults,children:a("No Blogs Found.")})}renderBlogInfoCard(e,t){var s,i=this.props.appContext._c,a=t?{color:this.getFillColorForTheme(e.theme)}:void 0;return(0,_.jsxs)(g.Z,{style:a,onClick:this.getToggleRecipientOnClick(e),label:i("Placeholder is blog name for recipient",t?"Unselect %1$s":"Select %1$s",[e.name]),wrapperClassName:d()(el.blogInfo,{[el.isSelected]:t}),children:[(0,_.jsx)(p.Z,{imageResponse:e.avatar,avatarShape:(null===(s=e.theme)||void 0===s?void 0:s.avatarShape)||Q.o.Square,dimension:54,className:el.avatar,isAdult:e.isAdult,imgStyleProps:t?ed:void 0}),(0,_.jsx)("p",{className:el.blogName,children:e.name}),(0,_.jsx)("p",{className:el.blogTitle,children:e.title})]},e.uuid)}renderPostActions(){var e=this.props,t=e.blog,s=e.id,i=e.shortUrl,a=e.postUrl,r=e.embedUrl;return(0,_.jsx)("div",{className:el.actionsWrapper,children:(0,_.jsxs)("div",{className:el.actions,children:[!!a&&(0,_.jsx)(E,{postUrl:a}),!!r&&(0,_.jsx)(H,{embedUrl:r,blog:t,id:s}),!!i&&(0,_.jsx)(q,{postUrl:i}),!!i&&(0,_.jsx)(Y,{postUrl:i}),!!i&&(0,_.jsx)(V,{postUrl:i}),!!a&&(0,_.jsx)(K,{postUrl:a})]})})}}let ep=(0,ei.X9)(eh,{appContext:!0,toastContext:!0,messagingContext:!0,paletteContext:!0})},10131:(e,t,s)=>{s.d(t,{C:()=>i,b:);var i={}),a=function(e){return e.Active="ACTIVE",e.Inactive="INACTIVE",e}(a||{}),r=r||{}),n={})}}]);