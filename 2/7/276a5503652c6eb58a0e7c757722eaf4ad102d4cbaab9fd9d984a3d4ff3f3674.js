(()=>{"use strict";var e={5869:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getAlerts=t.addAlert=void 0;const d=i(6405),c=a(i(7607)),l=i(1920),u=i(3241),g=s(i(1594)),p=i(9340),b=i(5453);t.addAlert=({alert:e,subscriberId:t,siteId:i})=>r(void 0,void 0,void 0,(function*(){c.default.debug("The alert is being added for the subscriber."),g.addAlert(e);const n=(0,l.detectBrowser)(),o=(0,u.addQueryParamsToUrl)(`${p.env.__SUBSCRIBER_API_ENDPOINT__}/alerts`,{swv:p.env.__WORKER_VERSION__,bv:n.version}),s=yield(0,d.sendHttpRequest)(o,{method:"POST",body:JSON.stringify(Object.assign(Object.assign({},e),{device_token_hash:t,site_id:i})),retries:2});s.ok||(yield(0,b.throwDexterAPIError)(s,"Couldn't add alert.")),c.default.debug("The alert has been added for the subscriber.")})),t.getAlerts=({subscriberId:e,siteId:t,options:i={}})=>r(void 0,void 0,void 0,(function*(){c.default.debug("The alert is being retrieved for the subscriber.");const n=(0,l.detectBrowser)(),o=(0,u.addQueryParamsToUrl)(`${p.env.__SUBSCRIBER_API_ENDPOINT__}/alerts`,{swv:p.env.__WORKER_VERSION__,bv:n.version,device_token_hash:e,site_id:t,type:i.type,product_id:i.productId,variant_id:i.variantId});try{const e=yield(0,d.sendHttpRequest)(o,{retries:2});if(!e.ok)return c.default.debug("Response not ok:",e),null;const t=yield e.json();return(null==t?void 0:t.error_code)||!1===Array.isArray(null==t?void 0:t.data)?(c.default.debug("Error retrieving the alert response.",t),null):t.data}catch(e){return c.default.debug("Error occurred:",e),null}finally{c.default.debug("The alert has been retrieved for the subscriber.")}}))},5021:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getGeoInfo=t.getAppData=void 0;const s=i(6405),r=o(i(3321)),a=i(4014),d=i(3241),c=i(9340);t.getAppData=({appId:e,source:t="sdk",version:i=1})=>n(void 0,void 0,void 0,(function*(){if(!e)throw new r.default({message:r.default.ERROR_MESSAGE.InvalidAppId,name:r.default.ERROR_NAME.InvalidAppId});const n=(0,d.addQueryParamsToUrl)(`${c.env.__CDN_SERVER_HOST__}/v${i}/sdk-app-data/${e}`,{source:t,sdkv:c.env.__SDK_VERSION__,swv:c.env.__WORKER_VERSION__}),o=yield(0,s.sendHttpRequest)(n,{retries:4});if(!o.ok){const e=yield o.json();throw new Error(`${e.message||"Something went wrong"}`)}const l=yield o.json();return(0,a.isObject)(l)?l:null})),t.getGeoInfo=(()=>{let e=null;return({isEu:t})=>n(void 0,void 0,void 0,(function*(){if(e)return e;const i=(0,d.addQueryParamsToUrl)(`${c.env.__SERVER_HOST__}/geo-details`,{sdkv:c.env.__SDK_VERSION__,swv:c.env.__WORKER_VERSION__});try{const n=yield(0,s.sendHttpRequest)(i,{retries:3});if(!n.ok)return{};const o=yield n.json(),r=(0,a.isObject)(o)?o:{};return(0,a.isEmptyObject)(r)||(r.ipaddress=(0,a.replaceLastNumberFromIpToZero)(t,r.ipaddress)),e=r,r}catch(e){return{}}}))})()},7423:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.removeAttributes=t.setAttributes=t.addAttributes=t.getAttributes=void 0;const d=i(1920),c=i(3241),l=i(6405),u=i(4014),g=s(i(4379)),p=i(5453),b=i(9892),f=i(9340),v=a(i(7607)),m=e=>r(void 0,void 0,void 0,(function*(){const t=yield(0,p.getSubscriberDataFromStorageOrAPI)(e);return(null==t?void 0:t.attributes)&&(0,u.isObject)(t.attributes)?t.attributes:{}}));t.getAttributes=e=>r(void 0,void 0,void 0,(function*(){v.default.debug("The attributes are being retrieved from the subscriber.");const t=yield m(e);return v.default.debug("The attributes has been retrieved for the subscriber."),t})),t.addAttributes=(e,t)=>r(void 0,void 0,void 0,(function*(){v.default.debug("The attributes are being added to the subscriber."),g.addAttributes(t);const i=yield m(e);if((({subscriberAttributes:e,attributes:t})=>{if((0,u.isEmptyObject)(e))return!1;let i=!0;for(const n in t)if(t[n]!==e[n]){i=!1;break}return i})({subscriberAttributes:i,attributes:t}))return;const n=(0,d.detectBrowser)(),o=(0,c.addQueryParamsToUrl)(`${f.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/${e}/attributes`,{swv:f.env.__WORKER_VERSION__,bv:n.version}),s=yield(0,l.sendHttpRequest)(o,{method:"PUT",body:JSON.stringify(t),retries:2});s.ok||(yield(0,p.throwDexterAPIError)(s,"Couldn't add attributes.")),v.default.debug("The attributes has been added to the subscriber."),(0,b.setSubscriberDataToStorage)({attributes:Object.assign({},i,t)})})),t.setAttributes=(e,t)=>r(void 0,void 0,void 0,(function*(){if(v.default.debug("The attributes are being set to the subscriber."),g.addAttributes(t),(({subscriberAttributes:e,attributes:t})=>{if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0})({subscriberAttributes:yield m(e),attributes:t}))return;const i=(0,d.detectBrowser)(),n=(0,c.addQueryParamsToUrl)(`${f.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/${e}/attributes`,{swv:f.env.__WORKER_VERSION__,bv:i.version}),o=yield(0,l.sendHttpRequest)(n,{method:"POST",body:JSON.stringify(t),retries:2});o.ok||(yield(0,p.throwDexterAPIError)(o,"Couldn't set attributes.")),v.default.debug("The attributes has been set to the subscriber."),(0,b.setSubscriberDataToStorage)({attributes:t})})),t.removeAttributes=(e,t)=>r(void 0,void 0,void 0,(function*(){if(v.default.debug("The attributes are being removed from the subscriber."),!1===Array.isArray(t))throw new Error("The attribute names must be provided as an array.");const i=yield m(e);if(!(({attributeNames:e,subscriberAttributes:t})=>{if((0,u.isEmptyObject)(t))return!1;if(0===e.length)return!0;for(const i of e)if((0,u.hasOwn)(t,i))return!0;return!1})({subscriberAttributes:i,attributeNames:t}))return;const n=(0,d.detectBrowser)(),o=(0,c.addQueryParamsToUrl)(`${f.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/${e}/attributes`,{swv:f.env.__WORKER_VERSION__,bv:n.version}),s=yield(0,l.sendHttpRequest)(o,{method:"DELETE",body:JSON.stringify(t),retries:2});s.ok||(yield(0,p.throwDexterAPIError)(s,"Couldn't remove attributes."));let r={};t.length>0&&(r=(0,u.omit)(i,t)),v.default.debug("The attributes has been removed from the subscriber."),(0,b.setSubscriberDataToStorage)({attributes:r})}))},1791:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendErrorLog=void 0;const s=i(6405),r=i(1920),a=o(i(7607)),d=i(9340),c=o(i(3321));t.sendErrorLog=(e="sdk",t,i)=>n(void 0,void 0,void 0,(function*(){var n,o;try{a.default.debug(t,t.details);const l=[c.default.ERROR_NAME.InvalidAppId,c.default.ERROR_NAME.UnsubscribedFailedFromWorker,c.default.ERROR_NAME.NotPushEngagePayload,c.default.ERROR_NAME.PayloadLessInvalidNotificationPayload,c.default.ERROR_NAME.InvalidNotificationPayload,c.default.ERROR_NAME.PushPayloadParseError,c.default.ERROR_NAME.OfflineError,c.default.ERROR_NAME.OpenNotificationUrlFailed,c.default.ERROR_NAME.SendOptInAnalyticsError,c.default.ERROR_NAME.QuotaExceededError,c.default.ERROR_NAME.DisabledPushSubscriptionError,c.default.ERROR_NAME.UnknownError,c.default.ERROR_NAME.SDKInitOptionsNotFound,"NS_ERROR_FILE_CORRUPTED","NS_ERROR_STORAGE_CONSTRAINT","NS_ERROR_FILE_NO_DEVICE_SPACE","NS_ERROR_STORAGE_IOERR","NS_ERROR_NOT_INITIALIZED",c.default.ERROR_NAME.LocalStorageNotAvailable,c.default.ERROR_NAME.SubscriptionAlreadyInitialized],u=[];if(l.includes(t.name)||u.includes(t.type||""))return;const g=`${d.env.__LOG_API_ENDPOINT__}/logs`,p=Object.assign({sdk:d.env.__SDK_VERSION__,bw:(0,r.detectBrowser)(),app:"service-worker"===e?"new-service-worker":"web-sdk",name:t.name,data:t.details||{},message:t.message,stacktrace:(null===(n=t.stack)||void 0===n?void 0:n.toString())||(null===(o=(new Error).stack)||void 0===o?void 0:o.toString()),type:t.type,url:location.href},i);yield(0,s.sendHttpRequest)(g,{method:"POST",body:JSON.stringify(p),mode:"no-cors"})}catch(e){a.default.error("Error occurred while sending error logs",e)}}))},7353:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendGoal=void 0;const s=i(1920),r=i(3241),a=i(6405),d=i(4014),c=i(9340),l=i(5453),u=o(i(7607));t.sendGoal=({goal:e,siteId:t,subscriberId:i})=>n(void 0,void 0,void 0,(function*(){if(u.default.debug("The goal is being sent for the subscriber."),!(0,d.isObject)(e))throw new Error("Goal must be an object.");const n=(0,s.detectBrowser)(),o=(0,r.addQueryParamsToUrl)(`${c.env.__SUBSCRIBER_API_ENDPOINT__}/goals`,{swv:c.env.__WORKER_VERSION__,bv:n.version}),g=yield(0,a.sendHttpRequest)(o,{method:"POST",body:JSON.stringify(Object.assign(Object.assign({},e),{site_id:t,device_token_hash:i})),retries:3});g.ok||(yield(0,l.throwDexterAPIError)(g,"Couldn't send goal.")),u.default.debug("The goal has been sent for the subscriber.")}))},5453:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getSubscriberDataFromStorageOrAPI=t.throwDexterAPIError=void 0;const s=i(6405),r=o(i(7607)),a=i(1920),d=i(9892),c=i(3241),l=i(4014),u=i(9340),g=o(i(3321)),p=o(i(8267));t.throwDexterAPIError=(e,t)=>n(void 0,void 0,void 0,(function*(){var i,n;let o=t||"Something went wrong.",s={};try{const t=yield e.json();t&&t.error&&(o=`${(0,l.capitalizeFirstLetter)((null===(i=t.error)||void 0===i?void 0:i.message)||t.error_message)}.`,s=(null===(n=t.error)||void 0===n?void 0:n.details)||{})}catch(e){r.default.debug("Failed to parse json response",e)}throw new g.default({details:s,message:o,type:g.default.ERROR_TYPE.DexterServerError})})),t.getSubscriberDataFromStorageOrAPI=e=>n(void 0,void 0,void 0,(function*(){try{yield p.default.acquireLock("getSubscriberDataFromStorageOrAPI");const t=(0,d.getSubscriberDataFromStorage)();if(t)return t;const i=(0,a.detectBrowser)(),n=(0,c.addQueryParamsToUrl)(`${u.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/${e}`,{swv:u.env.__WORKER_VERSION__,bv:i.version}),o=yield(0,s.sendHttpRequest)(n,{retries:3});if(!o.ok)return r.default.debug("Response not ok:",o),null;const g=yield o.json();if(null==g?void 0:g.error_code)return r.default.debug("response of error:",g),null;if((0,l.isEmptyObject)(null==g?void 0:g.data))return null;const b=(e=>Object.assign(Object.assign({},e),{attributes:e.attributes||{},segments:e.segments||[],trigger_status:(0,l.isUndefined)(e.trigger_status)?1:e.trigger_status}))(null==g?void 0:g.data);return(0,d.addSubscriberDataToStorage)(b),r.default.debug("The subscriber data is stored in the storage."),b}catch(e){return r.default.debug("Error occurred:",e),null}finally{p.default.releaseLock("getSubscriberDataFromStorageOrAPI")}}))},7224:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPayloadNotifications=t.sendNotificationViewedReferAnalytics=t.fetchPayloadLessNotifications=t.sendNotificationClickedAnalytics=t.sendNotificationViewedAnalytics=void 0;const s=i(3241),r=i(1920),a=i(2689),d=i(6405),c=o(i(3321)),l=i(9340),u=i(5453);t.sendNotificationViewedAnalytics=({tag:e})=>n(void 0,void 0,void 0,(function*(){const t=(0,r.detectBrowser)(),i=(0,s.addQueryParamsToUrl)(`${l.env.__ANALYTICS_API_ENDPOINT__}/notification/view`,{tag:e,swv:l.env.__WORKER_VERSION__,bv:t.version,tz:(0,a.getTimezoneOffset)()}),n=yield(0,d.sendHttpRequest)(i,{retries:3});n.ok||(yield(0,u.throwDexterAPIError)(n,"Couldn't send notification view analytics."))})),t.sendNotificationClickedAnalytics=({tag:e,action:t})=>n(void 0,void 0,void 0,(function*(){const i=(0,r.detectBrowser)(),n=(0,s.addQueryParamsToUrl)(`${l.env.__ANALYTICS_API_ENDPOINT__}/notification/click`,{tag:e,action:t,swv:l.env.__WORKER_VERSION__,bv:i.version,tz:(0,a.getTimezoneOffset)()}),o=yield(0,d.sendHttpRequest)(n,{retries:3});o.ok||(yield(0,u.throwDexterAPIError)(o,"Couldn't send notification click analytics to server."))})),t.fetchPayloadLessNotifications=e=>n(void 0,void 0,void 0,(function*(){const t=(0,r.detectBrowser)(),i=(0,s.addQueryParamsToUrl)(`${l.env.__ANALYTICS_API_ENDPOINT__}/notification`,{swv:l.env.__WORKER_VERSION__,device:e,bv:t.version}),n=yield(0,d.sendHttpRequest)(i,{retries:3});if(!n.ok)throw new c.default({message:`Failed to fetch push payload for device token ${e} with status ${n.status}.`,name:c.default.ERROR_NAME.PayloadLessFetchError,details:{status:n.status,url:n.url,origin:self.location.href}});let o;try{o=yield n.json()}catch(e){throw new c.default({message:`Parsing of the notification payload failed, ${e.message}`,name:c.default.ERROR_NAME.PayloadLessParseError,details:{status:n.status,url:n.url}})}if(Array.isArray(o)&&o.length)return o;throw new c.default({message:`Received empty/invalid payload less notification from device ${e}.`,name:c.default.ERROR_NAME.PayloadLessInvalidNotificationPayload,details:{responseData:o,url:n.url,status:n.status}})})),t.sendNotificationViewedReferAnalytics=({tag:e})=>n(void 0,void 0,void 0,(function*(){const t=(0,s.addQueryParamsToUrl)(`${l.env.__ANALYTICS_API_ENDPOINT__}/notification/view/refer`,{tag:e}),i=yield(0,d.sendHttpRequest)(t,{retries:2});i.ok||(yield(0,u.throwDexterAPIError)(i,"Couldn't send notification view refer analytics to server."))})),t.fetchPayloadNotifications=({tag:e,postback:t})=>n(void 0,void 0,void 0,(function*(){const i=(0,r.detectBrowser)(),n=(0,s.addQueryParamsToUrl)(`${l.env.__ANALYTICS_API_ENDPOINT__}/notification/fetch`,{tag:e,swv:l.env.__WORKER_VERSION__,bv:i.version}),o=yield(0,d.sendHttpRequest)(n,{method:"POST",body:JSON.stringify({tag:e,postback:t}),retries:3});if(!o.ok)throw new c.default({message:`Failed to fetch push payload for tag ${e} with status ${o.status}.`,name:c.default.ERROR_NAME.PushPayloadFetchError,details:{status:o.status,url:o.url,origin:self.location.href}});let a;try{a=yield o.json()}catch(e){throw new c.default({message:`Parsing of the notification payload failed, ${e.message}`,name:c.default.ERROR_NAME.NotificationParseError,details:{status:o.status,url:o.url}})}if(Array.isArray(null==a?void 0:a.data)&&a.data.length)return a.data;throw new c.default({message:`Received empty/invalid response from tag ${e}.`,name:c.default.ERROR_NAME.InvalidNotificationPayload,details:{responseData:a,url:o.url,status:o.status}})}))},6547:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendOptInAnalytics=void 0;const s=i(6405),r=i(9340),a=o(i(3321));t.sendOptInAnalytics=e=>n(void 0,void 0,void 0,(function*(){const t={Data:e,PartitionKey:"optin_analytics"},i=r.env.__OPT_IN_ANALYTICS_API_ENDPOINT__;try{if(!(yield(0,s.sendHttpRequest)(i,{method:"PUT",body:JSON.stringify(t),retries:3})).ok)throw new Error("Couldn't send opt-in analytics event.")}catch(e){throw new a.default({message:e.message,name:a.default.ERROR_NAME.SendOptInAnalyticsError,details:{body:t,requestUrl:i}})}}))},3168:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.setProfileIdToSubscriber=void 0;const d=i(6405),c=a(i(7607)),l=i(1920),u=i(9892),g=i(3241),p=s(i(5702)),b=i(5453),f=i(9340);t.setProfileIdToSubscriber=({profileId:e,siteId:t,subscriberId:i})=>r(void 0,void 0,void 0,(function*(){c.default.debug("The profile id is being set for the subscriber."),p.profileId(e);const n=yield(0,b.getSubscriberDataFromStorageOrAPI)(i);if((null==n?void 0:n.profile_id)===e)return void c.default.debug("The profile id is already set for the subscriber.");const o=(0,l.detectBrowser)(),s={device_token_hash:i,profile_id:e,site_id:t},r=(0,g.addQueryParamsToUrl)(`${f.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/profile-id/add`,{swv:f.env.__WORKER_VERSION__,bv:o.version}),a=yield(0,d.sendHttpRequest)(r,{method:"POST",body:JSON.stringify(s),retries:2});a.ok||(yield(0,b.throwDexterAPIError)(a,"Couldn't set profile id to subscriber.")),c.default.debug("The profile id has been set for the subscriber."),(0,u.setSubscriberDataToStorage)({profile_id:e})}))},953:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addSegmentWithDurationToSubscriber=t.removeSegmentFromSubscriber=t.addSegmentToSubscriber=void 0;const d=i(6405),c=a(i(7607)),l=i(1920),u=i(9892),g=i(3241),p=i(4014),b=s(i(3314)),f=i(5453),v=a(i(4182)),m=i(9340),_=(e,t)=>{let i=!0;for(let n=0;n<t.length;n++)if(!e.includes(t[n])){i=!1;break}return i},h=e=>r(void 0,void 0,void 0,(function*(){const t=yield(0,f.getSubscriberDataFromStorageOrAPI)(e);return(null==t?void 0:t.segments)&&Array.isArray(t.segments)?t.segments:[]}));t.addSegmentToSubscriber=({segment:e,siteId:t,subscriberId:i})=>r(void 0,void 0,void 0,(function*(){b.segment(e);const n=Array.isArray(e)?e:[e],o=yield h(i);if(_(o,n))return void c.default.debug(`The segment have already been added to the subscriber: ${n}.`);const s=(0,l.detectBrowser)(),r={device_token_hash:i,segment:(0,p.uniqueArray)(n),site_id:t},a=(0,g.addQueryParamsToUrl)(`${m.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/segments/add`,{swv:m.env.__WORKER_VERSION__,bv:s.version}),y=yield(0,d.sendHttpRequest)(a,{method:"POST",body:JSON.stringify(r),retries:2});y.ok||(yield(0,f.throwDexterAPIError)(y,"Couldn't add segment to subscriber.")),c.default.debug(`The segment has been added to the subscriber: ${n}.`),(0,u.setSubscriberDataToStorage)({segments:(0,p.uniqueArray)([...o,...n])}),v.default.trigger("updateSubscriptionManagementWidgetView",void 0)})),t.removeSegmentFromSubscriber=({segment:e,siteId:t,subscriberId:i})=>r(void 0,void 0,void 0,(function*(){b.segment(e);const n=Array.isArray(e)?e:[e],o=yield h(i);if(!_(o,n))return void c.default.debug(`The segment do not belong to the subscriber: ${n}.`);const s=(0,l.detectBrowser)(),r={device_token_hash:i,segment:(0,p.uniqueArray)(n),site_id:t},a=(0,g.addQueryParamsToUrl)(`${m.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/segments/remove`,{swv:m.env.__WORKER_VERSION__,bv:s.version}),y=yield(0,d.sendHttpRequest)(a,{method:"POST",body:JSON.stringify(r),retries:2});y.ok||(yield(0,f.throwDexterAPIError)(y,"Couldn't remove segment from subscriber."));const w=o.filter(();c.default.debug(`The segment has been removed from the subscriber: ${n}.`),(0,u.setSubscriberDataToStorage)({segments:w}),v.default.trigger("updateSubscriptionManagementWidgetView",void 0)})),t.addSegmentWithDurationToSubscriber=({segment:e,siteId:t,subscriberId:i})=>r(void 0,void 0,void 0,(function*(){b.segmentWithDuration(e);const n=Array.isArray(e)?e:[e],o=n.map((e=>e.name)),s=yield h(i),r=(0,l.detectBrowser)(),a={device_token_hash:i,segments:n,site_id:t},v=(0,g.addQueryParamsToUrl)(`${m.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/dynamicSegments/add`,{swv:m.env.__WORKER_VERSION__,bv:r.version}),_=yield(0,d.sendHttpRequest)(v,{method:"POST",body:JSON.stringify(a),retries:2});_.ok||(yield(0,f.throwDexterAPIError)(_,"Couldn't add segment to subscriber.")),c.default.debug(`The segment, including its duration, has been added to the subscriber: ${o}.`),(0,u.setSubscriberDataToStorage)({segments:(0,p.uniqueArray)([...s,...o])})}))},7330:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getCartItems=t.getProductByTitle=t.isUrlReachable=void 0;const s=i(6405),r=o(i(7607)),a=i(4014);t.isUrlReachable=e=>n(void 0,void 0,void 0,(function*(){return!!(yield(0,s.sendHttpRequest)(e)).ok})),t.getProductByTitle=e=>n(void 0,void 0,void 0,(function*(){const t=yield(0,s.sendHttpRequest)(`/products/${e}.js`,{retries:1});if(!t.ok)return r.default.debug("Response not ok to get products:",t),null;try{const e=yield t.json();return(0,a.isObject)(e)?e:null}catch(e){return r.default.debug("Error occurred:",e),null}})),t.getCartItems=()=>n(void 0,void 0,void 0,(function*(){const e=yield(0,s.sendHttpRequest)("/cart.js",{retries:1});if(!e.ok)return r.default.debug("Response not ok to get cart items:",e),[];try{const t=yield e.json();if(!(0,a.isObject)(t))return[];const{items:i}=t;return Array.isArray(i)?i:[]}catch(e){return r.default.debug("Error occurred:",e),[]}}))},3502:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.updateAutomatedNotificationStatus=t.updateSubscriberStatus=t.syncSubscriberData=t.addSubscriberDataToSite=t.getSubscriberData=void 0;const s=i(6405),r=i(2689),a=o(i(7607)),d=i(9892),c=i(3241),l=i(4014),u=i(5453),g=i(1920),p=o(i(4182)),b=o(i(3321)),f=i(9340),v=e=>{const t={geobytestimezone:(0,r.getTimezoneOffset)()};return e?(["country","internet","region","code","city","fqcn","ipaddress"].forEach((i=>{e[i]&&(t[`geobytes${i}`]=e[i])})),t):t},m=()=>n(void 0,void 0,void 0,(function*(){var e;const t=`${f.env.__TABOOLA_API_ENDPOINT__}/json/pushengage1-new/user.sync?app.type=web&app.apikey=${f.env.__TABOOLA_API_KEY__}`;try{const i=yield(0,s.sendHttpRequest)(t);if(i.ok&&200===i.status){const t=yield i.json();return(null===(e=null==t?void 0:t.user)||void 0===e?void 0:e.id)||null}return null}catch(e){return a.default.debug("Error occurred during getting taboola ads user id:",e),null}}));t.getSubscriberData=e=>n(void 0,void 0,void 0,(function*(){let t=null;try{t=yield(0,u.getSubscriberDataFromStorageOrAPI)(e)}catch(e){a.default.debug("Error occurred:",e)}return t})),t.addSubscriberDataToSite=({browserInfo:e,site:t,subscription:i,options:o={}})=>n(void 0,void 0,void 0,(function*(){var n,r;const d=v(o.geoInfo),l={subscription:i,site_id:t.site_id,browser_info:{device_type:e.name,browser_version:e.version.toString(),user_agent:e.userAgent,language:e.language,total_scr_width_height:e.screen,available_scr_width_height:e.availableScreen,colour_resolution:e.pixelDepth,host:e.host,device:e.device,pe_ref_url:e.referrer||e.href},geo_info:d,subscription_url:e.href,token_refresh:null!==(n=o.tokenRefresh)&&void 0!==n&&n};if(o.isPublisherSettingEnabled)try{const e=yield m();e&&(l.tid=e)}catch(e){a.default.debug("Couldn't get Taboola Ads User ID",e)}o.widgetOptInType?l.widget_optin_type=o.widgetOptInType:o.optInType&&(l.optin_type=o.optInType);const g=(0,c.addQueryParamsToUrl)(`${f.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/add`,{bv:e.version,swv:f.env.__WORKER_VERSION__}),p=yield(0,s.sendHttpRequest)(g,{method:"POST",body:JSON.stringify(l),retries:4});let _;p.ok||(yield(0,u.throwDexterAPIError)(p,"Couldn't add subscriber."));try{_=yield p.json()}catch(e){throw new b.default({message:"Error parsing response from add subscriber.",name:b.default.ERROR_NAME.SubscriberAdditionServerError})}if(_.error_code)throw new b.default({message:`Couldn't add subscriber. Error code: ${_.error_code}.`,name:b.default.ERROR_NAME.SubscriberAdditionServerError});if(!(null===(r=_.data)||void 0===r?void 0:r.subscriber_hash))throw new b.default({message:"Couldn't add subscriber. Subscriber hash is not available.",name:b.default.ERROR_NAME.SubscriberHashNotAvailableServerError});return _.data.subscriber_hash})),t.syncSubscriberData=({browserInfo:e,geoInfo:t,subscriberId:i,isPublisherSettingEnabled:o})=>n(void 0,void 0,void 0,(function*(){const n=yield(0,u.getSubscriberDataFromStorageOrAPI)(i);if(!n)return;const g=navigator.userAgent,p=(0,r.getTimezoneOffset)(),b={};let _=!1;if(n.user_agent!==g&&(b.browser_info={user_agent:g,browser_version:e.version.toString(),device_type:e.name,language:e.language,total_scr_width_height:e.screen,available_scr_width_height:e.availableScreen,colour_resolution:e.pixelDepth,device:e.device}),!t||n.city===t.city&&n.timezone===p&&n.country===t.country&&n.state===t.state||(b.geo_info=v(t),_=!0),o&&(!n.tid||_)){const e=yield m();b.tid=e}if((0,l.isEmptyObject)(b))return void a.default.debug("The subscriber data is up to date.");const h=(0,c.addQueryParamsToUrl)(`${f.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/${i}`,{swv:f.env.__WORKER_VERSION__,bv:e.version});if((yield(0,s.sendHttpRequest)(h,{method:"PUT",body:JSON.stringify(b),retries:2})).ok){const i={timezone:p,city:null==t?void 0:t.city,country:null==t?void 0:t.country,state:null==t?void 0:t.region,user_agent:g,device_type:e.name,device:e.device};b.tid&&(i.tid=b.tid),(0,d.setSubscriberDataToStorage)(i),a.default.debug("The subscriber data has been updated in the storage.")}})),t.updateSubscriberStatus=({status:e,subscriberId:t,siteId:i})=>n(void 0,void 0,void 0,(function*(){const n=(0,g.detectBrowser)(),o=(0,c.addQueryParamsToUrl)(`${f.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/updatesubscriberstatus`,{swv:f.env.__WORKER_VERSION__,bv:n.version}),r=yield(0,s.sendHttpRequest)(o,{method:"POST",body:JSON.stringify({IsUnSubscribed:"unsubscribe"===e?1:0,device_token_hash:t,site_id:i}),retries:3});r.ok||(yield(0,u.throwDexterAPIError)(r,"Couldn't update subscriber status."))})),t.updateAutomatedNotificationStatus=({status:e,subscriberId:t,siteId:i})=>n(void 0,void 0,void 0,(function*(){const n="disabled"===e?0:1,o=yield(0,u.getSubscriberDataFromStorageOrAPI)(t);if((null==o?void 0:o.trigger_status)===n)return;const r=(0,g.detectBrowser)(),a=(0,c.addQueryParamsToUrl)(`${f.env.__SUBSCRIBER_API_ENDPOINT__}/subscriber/updatetriggerstatus`,{swv:f.env.__WORKER_VERSION__,bv:r.version}),l=yield(0,s.sendHttpRequest)(a,{method:"POST",body:JSON.stringify({triggerStatus:n,device_token_hash:t,site_id:i}),retries:2});l.ok||(yield(0,u.throwDexterAPIError)(l,"Couldn't update automated Notification status.")),(0,d.setSubscriberDataToStorage)({trigger_status:n}),p.default.trigger("updateSubscriptionManagementWidgetView",void 0)}))},6206:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendTriggerEvent=void 0;const d=i(6405),c=s(i(2379)),l=i(9340),u=a(i(7607));t.sendTriggerEvent=({trigger:e,subscriberId:t,siteId:i})=>r(void 0,void 0,void 0,(function*(){u.default.debug("The trigger event is being sent for the subscriber."),c.sendTriggerEvent(e);const n=l.env.__TRIGGER_API_ENDPOINT__;if(!(yield(0,d.sendHttpRequest)(n,{method:"PUT",body:JSON.stringify({Data:Object.assign(Object.assign({},e),{site_id:i,device_token_hash:t}),PartitionKey:t})})).ok)throw new Error("Couldn't send trigger event.");u.default.debug("The trigger event has been sent for the subscriber.")}))},1594:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addAlert=void 0;const n=i(4014);t.addAlert=e=>{if(!(0,n.isObject)(e))throw new Error("Alert must be an object.");if("inventory"!==e.type&&"price_drop"!==e.type)throw new Error("Alert type must be either inventory or price_drop.");if(!e.product_id)throw new Error("Product ID is required.");if(!e.price)throw new Error("Price is required.");if("number"!=typeof e.price&&"string"!=typeof e.price)throw new Error("Price must be a number.");if(e.alert_price&&"number"!=typeof e.alert_price&&"string"!=typeof e.alert_price)throw new Error("Alert price must be a number.");if(e.availability&&"inStock"!==e.availability&&"outOfStock"!==e.availability)throw new Error("Availability must be either inStock or outOfStock.")}},4379:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addAttributes=void 0;const n=i(4014);t.addAttributes=e=>{if(!(0,n.isObject)(e))throw new Error("Attributes must be an object.");if((0,n.isEmptyObject)(e))throw new Error("Attributes must not be empty.")}},5702:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.profileId=void 0,t.profileId=e=>{if(!e)throw new Error("Profile ID is required.");if("string"!=typeof e)throw new Error("Profile ID must be a string.")}},3314:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.segmentWithDuration=t.segment=void 0,t.segment=e=>{if(!e)throw new Error("Segment is required.");const t=Array.isArray(e)?e:[e];if(0===t.length)throw new Error("Segment is required.");for(let e=0;e<t.length;e++)if("string"!=typeof t[e])throw new Error("Segment must be a string.")},t.segmentWithDuration=e=>{if(!e)throw new Error("Segment is required.");const t=Array.isArray(e)?e:[e];if(0===t.length)throw new Error("Segment is required.");for(let e=0;e<t.length;e++){const i=t[e];if(!(null==i?void 0:i.name))throw new Error("Segment name is required.");if("string"!=typeof(null==i?void 0:i.name))throw new Error("Segment name must be a string.");if(!(null==i?void 0:i.duration))throw new Error("Segment duration is required.");if("number"!=typeof i.duration)throw new Error("Segment duration must be a number.");if(i.duration<=0)throw new Error("Segment duration must be greater than 0.")}}},2379:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendTriggerEvent=void 0;const n=i(4014);t.sendTriggerEvent=e=>{if(!(0,n.isObject)(e))throw new Error("Trigger event must be an object.");if(!e.campaign_name)throw new Error("Trigger event must have a campaign name.");if(!e.event_name)throw new Error("Trigger event must have a event name.")}},9851:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSDKInitOptions=t.getAppData=t.setSDKInitOptions=t.setAppData=void 0;const i=new class{set appData(e){this._appData=e}get appData(){if(!this._appData)throw new Error("appData has not been set yet.");return this._appData}t.setAppData=function(e){i.appData=e},t.setSDKInitOptions=t.getAppData=function(){return i.appData},t.getSDKInitOptions=function(){return i.sdkInitOptions}},9340:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.skipQueryParamsInWorkerPath=t.brandName=t.quieterUIPermissionImage=t.env=t.workerMessengerCommand=t.database=t.defaultMinStorageDuration=t.poweredByReferralUrl=t.pushEngageHomePageUrl=t.defaultNotificationTitle=t.defaultNotificationTag=t.loadingIcon=t.bellPlusIcon=t.bellCheckIcon=t.bellCircleIcon=t.bellRingIcon=t.bellBadgeIcon=t.bellSettingIcon=t.closeIcon=t.bellIcon=t.defaultServiceWorkerSetting=t.widgetOptInType=t.optInTypes=t.storageName=void 0,t.storageName="PushEngageSDK",t.optInTypes={bell:3,floatingBar:2,largeSafari:6,largeSafariWithSegments:8,safari:1,singleStep:4,sleekOptInBox:9},t.widgetOptInType=127,t.defaultServiceWorkerSetting={scope:!0,workerStatus:!0,worker:"service-worker.js"},t.bellIcon='<svg width="1em" height="1em" viewBox="0 0 18 22" fill="#4642E5" xmlns="http://www.w3.org/2000/svg">\n<path d="M9.0528 0.00546861C9.10255 0.0273431 9.14677 0.0546861 9.19652 0.0765606C9.52267 0.229682 9.71062 0.481238 9.7272 0.842167C9.73826 1.1156 9.73273 1.38903 9.7272 1.66246C9.7272 1.7773 9.76037 1.82652 9.88198 1.84839C12.458 2.31322 14.3762 4.14521 14.9068 6.67171C14.9953 7.10373 15.0174 7.55216 15.0285 7.99511C15.0506 8.91931 15.0119 9.84351 15.0672 10.7622C15.1667 12.3317 15.8466 13.6442 17.0296 14.6996C17.3723 15.0004 17.6321 15.3395 17.6708 15.8043C17.7537 16.7285 17.107 17.4503 16.1672 17.4996C16.1119 17.505 16.0567 17.4996 16.0014 17.4996C11.2308 17.4996 6.45468 17.4996 1.6841 17.4996C1.13131 17.4996 0.666963 17.33 0.324232 16.8925C-0.189863 16.2418 -0.0848327 15.3449 0.584044 14.7653C1.17 14.2567 1.63987 13.6715 1.99919 12.988C2.45248 12.1239 2.65701 11.1943 2.65701 10.2263C2.65701 9.38414 2.64595 8.54744 2.66254 7.70528C2.71782 4.82879 4.90134 2.32416 7.77032 1.85386C7.93063 1.82652 7.97485 1.76636 7.96933 1.61871C7.95827 1.45465 7.98038 1.29059 7.9638 1.12653C7.91405 0.585142 8.11858 0.202339 8.6382 0C8.7764 0.00546861 8.9146 0.00546861 9.0528 0.00546861Z"/>\n<path d="M8.47234 21.0049C8.06881 20.8737 7.64316 20.7862 7.27279 20.5948C6.40491 20.1518 5.87423 19.4245 5.61994 18.4948C5.61441 18.4675 5.61441 18.4401 5.60889 18.3964C7.76477 18.3964 9.91513 18.3964 12.0821 18.3964C12.0102 18.7901 11.8554 19.1511 11.6343 19.4847C11.0815 20.3159 10.3076 20.819 9.30706 20.9721C9.27389 20.9776 9.24625 20.994 9.21308 21.0049C8.96985 21.0049 8.7211 21.0049 8.47234 21.0049Z"/>\n</svg>',t.closeIcon='<svg width="1em" height="1em" viewBox="0 0 11 11" fill="#2A2A2A" xmlns="http://www.w3.org/2000/svg">\n<path d="M10.4583 1.54041L9.45959 0.541664L5.5 4.50125L1.54042 0.541664L0.541672 1.54041L4.50126 5.5L0.541672 9.45958L1.54042 10.4583L5.5 6.49875L9.45959 10.4583L10.4583 9.45958L6.49875 5.5L10.4583 1.54041Z" />\n</svg>',t.bellSettingIcon='<svg width="1em" height="1em" viewBox="0 0 24 24" fill="#2A2A2A"><path d="M19 12C15.13 12 12 15.13 12 19C12 19.34 12.03 19.67 12.08 20H3V19L5 17V11C5 7.9 7.03 5.17 10 4.29V4C10 2.9 10.9 2 12 2S14 2.9 14 4V4.29C16.97 5.17 19 7.9 19 11V12M10 21C10 22.11 10.9 23 12 23C12.39 23 12.75 22.88 13.06 22.69C12.74 22.17 12.5 21.6 12.3 21H10M23.77 20.32C23.87 20.39 23.89 20.53 23.83 20.64L22.83 22.37C22.77 22.5 22.64 22.5 22.53 22.5L21.28 21.97C21 22.17 20.75 22.34 20.44 22.47L20.25 23.79C20.23 23.91 20.13 24 20 24H18C17.88 24 17.77 23.91 17.75 23.79L17.57 22.47C17.25 22.34 17 22.17 16.72 21.97L15.5 22.5C15.37 22.5 15.23 22.5 15.17 22.37L14.17 20.64C14.11 20.53 14.14 20.39 14.23 20.32L15.29 19.5C15.27 19.33 15.25 19.17 15.25 19S15.27 18.67 15.29 18.5L14.23 17.68C14.14 17.61 14.11 17.5 14.17 17.36L15.17 15.64C15.23 15.53 15.37 15.5 15.5 15.53L16.72 16C17 15.83 17.25 15.66 17.57 15.54L17.75 14.21C17.77 14.09 17.88 14 18 14H20C20.13 14 20.23 14.09 20.25 14.21L20.44 15.54C20.75 15.66 21 15.83 21.28 16L22.53 15.53C22.64 15.5 22.77 15.53 22.83 15.64L23.83 17.36C23.89 17.5 23.87 17.61 23.77 17.68L22.72 18.5C22.74 18.67 22.75 18.84 22.75 19S22.74 19.33 22.72 19.5L23.77 20.32M20.75 19C20.75 18.03 19.97 17.25 19 17.25S17.25 18.03 17.25 19 18.04 20.75 19 20.75 20.75 19.97 20.75 19Z" /></svg>',t.bellBadgeIcon='<svg width="1em" height="1em" viewBox="0 0 24 24" fill="#2A2A2A"><path d="M21 6.5C21 8.43 19.43 10 17.5 10S14 8.43 14 6.5 15.57 3 17.5 3 21 4.57 21 6.5M19 11.79C18.5 11.92 18 12 17.5 12C14.47 12 12 9.53 12 6.5C12 5.03 12.58 3.7 13.5 2.71C13.15 2.28 12.61 2 12 2C10.9 2 10 2.9 10 4V4.29C7.03 5.17 5 7.9 5 11V17L3 19V20H21V19L19 17V11.79M12 23C13.11 23 14 22.11 14 21H10C10 22.11 10.9 23 12 23Z" /></svg>',t.bellRingIcon='<svg width="1em" height="1em" viewBox="0 0 24 24" fill="#2A2A2A"><path d="M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19M14,21A2,2 0 0,1 12,23A2,2 0 0,1 10,21M19.75,3.19L18.33,4.61C20.04,6.3 21,8.6 21,11H23C23,8.07 21.84,5.25 19.75,3.19M1,11H3C3,8.6 3.96,6.3 5.67,4.61L4.25,3.19C2.16,5.25 1,8.07 1,11Z" /></svg>',t.bellCircleIcon='<svg width="1em" height="1em" viewBox="0 0 24 24" fill="#2A2A2A"><path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M17,16V15L16,14V11.39C16,10.3 15.73,9.34 15.21,8.53C14.7,7.72 13.96,7.21 13,7V6.5A1,1 0 0,0 12,5.5A1,1 0 0,0 11,6.5V7C10.04,7.21 9.3,7.72 8.79,8.53C8.27,9.34 8,10.3 8,11.39V14L7,15V16H17M13.5,17H10.5A1.5,1.5 0 0,0 12,18.5A1.5,1.5 0 0,0 13.5,17Z" /></svg>',t.bellCheckIcon='<svg width="1em" height="1em" viewBox="0 0 24 24" fill="#2A2A2A"><path d="M17.75 21.16L15 18.16L16.16 17L17.75 18.59L21.34 15L22.5 16.41L17.75 21.16M3 20V19L5 17V11C5 7.9 7.03 5.18 10 4.29V4C10 2.9 10.9 2 12 2C13.11 2 14 2.9 14 4V4.29C16.97 5.18 19 7.9 19 11V12.08L18 12C14.69 12 12 14.69 12 18C12 18.7 12.12 19.37 12.34 20H3M12 23C10.9 23 10 22.11 10 21H12.8C13.04 21.41 13.33 21.79 13.65 22.13C13.29 22.66 12.69 23 12 23Z" /></svg>',t.bellPlusIcon='<svg width="1em" height="1em" viewBox="0 0 24 24" fill="#2A2A2A"><path d="M17 14V17H14V19H17V22H19V19H22V17H19V14M12 2A2 2 0 0 0 10 4A2 2 0 0 0 10 4.29C7.12 5.14 5 7.82 5 11V17L3 19V20H12.35A6 6 0 0 1 12 18A6 6 0 0 1 18 12A6 6 0 0 1 19 12.09V11C19 7.82 16.88 5.14 14 4.29A2 2 0 0 0 14 4A2 2 0 0 0 12 2M10 21A2 2 0 0 0 12 23A2 2 0 0 0 13.65 22.13A6 6 0 0 1 12.81 21Z" /></svg>',t.loadingIcon='<svg viewBox="0 0 1024 1024" focusable="false" width="1em" height="1em" fill="currentColor"><path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path></svg>',t.defaultNotificationTag="welcome_notification",t.defaultNotificationTitle="Click to see updates",t.pushEngageHomePageUrl="https://www.pushengage.com/",t.poweredByReferralUrl=`${t.pushEngageHomePageUrl}?utm_medium=referral&utm_campaign=powered_by&utm_source=pushengage_sdk`,t.defaultMinStorageDuration=7,t.database={name:"PushEngageSDK",stores:[{name:"ids",keyPath:"id"},{name:"failedViewedNotificationTags",keyPath:"id"},{name:"failedClickedNotificationTags",keyPath:"id"}],version:1},t.workerMessengerCommand={ampSubscriptionState:"amp-web-push-subscription-state",ampSubscribe:"amp-web-push-subscribe",ampUnsubscribe:"amp-web-push-unsubscribe"},t.env={__CDN_SERVER_HOST__:"https://clientcdn.pushengage.com",__SERVER_HOST__:"https://web-sdk.pushengage.com",__SAFARI_WEB_PUSH_PACKAGE_URL__:"https://safari.pushengage.com",__SUBSCRIBER_API_ENDPOINT__:"https://clients-api.pushengage.com/p/v1",__ANALYTICS_API_ENDPOINT__:"https://noti-analytics.pushengage.com/p/v1",__LOG_API_ENDPOINT__:"https://notify.pushengage.com/v1",__DOMAIN_NAME__:"pushengage.com",__OPT_IN_ANALYTICS_API_ENDPOINT__:"https://oeqepmcz7a.execute-api.us-east-1.amazonaws.com/beta/streams/optin/records",__SDK_VERSION__:"3.0.37",__WORKER_VERSION__:"3.0.37",__TABOOLA_API_ENDPOINT__:"https://api.taboola.com/1.2",__TABOOLA_API_KEY__:"a460a30141a022c6dc01526bba996da108798fd0",__TRIGGER_API_ENDPOINT__:"https://m4xrk918t5.execute-api.us-east-1.amazonaws.com/beta/streams/production_triggers/records",__STATIC_STORAGE_ENDPOINT__:"https://assetscdn.pushengage.com"},t.quieterUIPermissionImage={firefox:`${t.env.__STATIC_STORAGE_ENDPOINT__}/react-dashboard/design/reminder-firefox.png`,chrome:`${t.env.__STATIC_STORAGE_ENDPOINT__}/react-dashboard/design/reminder-chrome.png`},t.brandName="PushEngage",t.skipQueryParamsInWorkerPath=[60413]},8338:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validateRequiredSettings=void 0;const o=n(i(3321));t.validateRequiredSettings=({appData:e,sdkInitOptions:t})=>{const{optin_settings:i,vapid_key:n,gcm_options:s,privacy_settings:r,sub_analytics:a,service_worker:d,reset_notification_permission_popup:c}=e.siteSettings;if(!(i&&n&&d&&s&&r&&a&&c))throw new o.default({message:"Required setting are missing.",name:o.default.ERROR_NAME.RequiredSettingsMissing,details:{optInSetting:!!i,vapidSetting:!!n,serviceWorkerSetting:!!d,gcmSetting:!!s,privacySetting:!!r,optInAnalyticsSetting:!!a,resetNotificationPermissionPopupSetting:!!c,siteId:e.site.site_id}});if(!e.site)throw new o.default({message:"Site data is missing.",name:o.default.ERROR_NAME.SiteDataMissing,details:{appId:t.appId}})}},5004:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(3609),r=o(i(7607)),a=i(1791),d=o(i(3321)),c=i(3110),l=i(2326),u=i(1041),g=i(6496),p=i(2004),b=i(4963),f=i(2047),v=i(1919),m=i(8343),_=i(1860),h=i(7328),y=i(5021),w=i(4014),S=i(9851),I=i(8338),P=i(5544);n(void 0,void 0,void 0,(function*(){try{const e=window.__PushEngageSDKInitOptions;if(!e)throw new d.default({message:"Initialization options have not been provided.",name:d.default.ERROR_NAME.SDKInitOptionsNotFound,details:{url:location.href}});let t;(0,S.setSDKInitOptions)(e);try{t=yield(0,y.getAppData)({appId:e.appId})}catch(e){return void r.default.error(e.message)}if(!t||(0,w.isEmptyObject)(t)){const e="App data is not available.";return void r.default.error(e)}(0,I.validateRequiredSettings)({appData:t,sdkInitOptions:e}),t.siteSettings.service_worker=(0,c.transformServiceWorker)({serviceWorkerSetting:t.siteSettings.service_worker,sdkInitOptions:e,customSubDomainSetting:t.siteSettings.custom_url,site:t.site}),(0,S.setAppData)(t),yield(0,s.isDOMContentLoaded)(),(0,c.upgradeLegacyStorageData)(),(0,u.addClickEventListenerForHandleSubscription)(),(0,l.addMessageEventListener)(),(0,b.addEventListenerForUnsubscribeWidget)(),(0,f.addEventListenerForSubscriberRecoveryWidget)(),(0,v.addEventListenerForAddSegment)(),(0,m.addEventListenerForShopifyCampaign)(),(0,_.addEventListenerForSubscriptionManagementWidget)(),(0,h.processFailedAnalytics)(),(0,P.syncDatabase)();const i=window.PushEngage,n=window._peq;(0,g.initializeSDK)({commands:i,legacyCommands:n}),yield(0,p.initializeSubscription)({triggerFrom:"onInit"}),r.default.debug("The subscription process has been completed on page load.")}catch(e){r.default.error(e.message),(0,a.sendErrorLog)("sdk",e,{url:location.href})}}))},3321:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor({message:e,name:t="AppError",details:i={},type:n="Error"}){super(e),this.details=i,this.name=t,this.type=n}}i.ERROR_NAME={InvalidAppId:"InvalidAppId",UnsubscribedFailedFromWorker:"UnsubscribedFailedFromWorker",NotPushEngagePayload:"NotPushEngagePayload",PayloadLessInvalidNotificationPayload:"PayloadLessInvalidNotificationPayload",InvalidNotificationPayload:"InvalidNotificationPayload",PushPayloadParseError:"PushPayloadParseError",OfflineError:"OfflineError",OpenNotificationUrlFailed:"OpenNotificationUrlFailed",SendOptInAnalyticsError:"SendOptInAnalyticsError",QuotaExceededError:"QuotaExceededError",DisabledPushSubscriptionError:"DisabledPushSubscriptionError",IndexedDBOpenError:"IndexedDBOpenError",UnknownError:"UnknownError",PayloadLessFetchError:"PayloadLessFetchError",PayloadLessParseError:"PayloadLessParseError",PushPayloadFetchError:"PushPayloadFetchError",NotificationParseError:"NotificationParseError",RequiredSettingsMissing:"RequiredSettingsMissing",SiteDataMissing:"SiteDataMissing",HttpRequestError:"HttpRequestError",UserNotSubscribed:"UserNotSubscribed",ServiceWorkerNotFound:"ServiceWorkerNotFound",ServiceWorkerNotRegistering:"ServiceWorkerNotRegistering",SDKInitOptionsNotFound:"SDKInitOptionsNotFound",RequestPermissionNotSupported:"RequestPermissionNotSupported",SubscriberAdditionServerError:"SubscriberAdditionServerError",SubscriberHashNotAvailableServerError:"SubscriberHashNotAvailableServerError",LocalStorageNotAvailable:"LocalStorageNotAvailable",SubscriptionAlreadyInitialized:"SubscriptionAlreadyInitialized"},i.ERROR_TYPE={IndexedDBError:"IndexedDBError",DexterServerError:"DexterServerError"},i.ERROR_MESSAGE={InvalidAppId:"AppId is not defined.",UserNotSubscribed:"User is not subscribed."},t.default=i},3110:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.isServiceWorkerAvailable=t.getSegmentNamesFromRules=t.transformServiceWorker=t.isServiceWorkerAvailabilityEnabled=t.upgradeLegacyStorageData=t.getSubDomainSubscriptionUrl=t.canSubscribeViaServiceWorker=t.filterSubscriptionOptInsByRules=t.isSatisfyingSubscriptionRules=t.getSubscriptionOptIns=t.getActiveOptInTypes=t.isDeviceSatisfyingDeviceRules=t.isCountrySatisfyingCountryRules=t.isUrlSatisfyingUrlRules=void 0;const r=i(1920),a=i(3241),d=s(i(4014)),c=i(8405),l=i(9340),u=i(5827),g=s(i(606)),p=i(2689),b=i(4014),f=i(9892),v=i(9851),m=i(2471);t.isUrlSatisfyingUrlRules=(e,t=location.href)=>{const{include:i,exclude:n}=e;let o=!0;i&&(o=!!((0,b.isEmptyArray)(i.contains)&&(0,b.isEmptyArray)(i.start)&&(0,b.isEmptyArray)(i.exact))||(0,u.isUrlSatisfyingRules)(i,t));let s=!0;return n&&(s=!!((0,b.isEmptyArray)(n.contains)&&(0,b.isEmptyArray)(n.start)&&(0,b.isEmptyArray)(n.exact))||!(0,u.isUrlSatisfyingRules)(n,t)),o&&s},t.isCountrySatisfyingCountryRules=(e,t)=>{const{include_countries:i,exclude_countries:n}=e;let o=!0;(null==i?void 0:i.length)&&(o=i.some((e=>e.toLowerCase()===t.toLowerCase())));let s=!0;return(null==n?void 0:n.length)&&(s=!n.some((e=>e.toLowerCase()===t.toLowerCase()))),o&&s},t.isDeviceSatisfyingDeviceRules=(e,t)=>{const{include_devices:i,exclude_devices:n}=e;let o=!0;i&&i.length&&(o=i.some((e=>e.toLowerCase()===t.toLowerCase())));let s=!0;return n&&n.length&&(s=!n.some(()),o&&s},t.getActiveOptInTypes=e=>{const t=(0,a.detectSiteType)();return d.get(e,`activeOptin.${t}.types`)||[]},t.getSubscriptionOptIns=e=>{const t=e.optins;if(!t)return[];const i=(0,r.detectDeviceType)(),n=(0,a.detectSiteType)(),o=[];for(const e in t){const s=t[e],r=d.get(s,`${i}.${n}`);r&&o.push(r)}return o},t.isSatisfyingSubscriptionRules=(e,i)=>{if(!e)return!0;const n=i.country||"",o=(0,t.isCountrySatisfyingCountryRules)(e,n),s=(0,t.isUrlSatisfyingUrlRules)(e,location.href);return!(!o||!s)},t.filterSubscriptionOptInsByRules=(e,i,n)=>{const o=(0,t.getActiveOptInTypes)(e),s=(0,t.getSubscriptionOptIns)(e);if(!o.length||!s.length)return[];const r=i?[]:o;if(i)for(let e=0;e<o.length;e++){const s=o[e],a=(0,c.getOptInRuleNameByType)(s);if(!a)continue;const d=i[a];d?(0,t.isSatisfyingSubscriptionRules)(d,n)&&r.push(s):r.push(s)}const a=[];for(let e=0;e<s.length;e++){const t=s[e];r.includes(t.optin_type)&&a.push(t)}return a},t.canSubscribeViaServiceWorker=({isServiceWorkerAvailable:e})=>{const t=(0,a.detectSiteType)(),{name:i,version:n}=(0,r.detectBrowser)();return"Safari"===i&&n<=15||"http"!==t&&!!e},t.getSubDomainSubscriptionUrl=({customSubDomainSetting:e,siteSubDomain:t})=>e?{url:e.url,type:e.type}:{url:`https://${t}.${l.env.__DOMAIN_NAME__}/`,type:"window"},t.upgradeLegacyStorageData=()=>{var e,i,n;const o=(0,v.getAppData)(),s=o.siteSettings.optin_settings,r=g.getDataFromCookies("peclosed"),a=g.getDataFromCookies("PushSubscriberStatus"),c=g.getDataFromLocalStorage("PushSubscriberHash"),u=g.getDataFromLocalStorage("PushSubscriberID"),b=["PushSubscriberHash","PushSubscriberID","PeSubData","PushSegments","PushBeforeSubData","PushSubscribeWidgetClosed","PushPersonalNotificationStatus","PushOptinReminder"];if(d.isNull(r)&&!u&&!c&&!a)return;const _={},h=(0,t.getActiveOptInTypes)(s),y=(0,t.getSubscriptionOptIns)(s);let w=!0;for(let e=0;e<y.length;e++)if(!y[e].optin_sw_support){w=!1;break}if("UNSUBSCRIBED"===a){const t=(0,m.getNotificationPermission)({safariWebPushId:null===(e=o.siteSettings.safari_options)||void 0===e?void 0:e.push_id}),i=!(!w||"granted"!==t);return _.unsubscribed={data:{isSubDomain:!i,status:!0},expiresAt:(0,p.getUnixTime)(1)},g.setDataToLocalStorage(l.storageName,_),g.deleteDataFromLocalStorage(b),void g.deleteDataFromCookies(["peclosed"])}if("CLOSED"!==a&&"DENIED"!==a&&c&&u){const e=(0,m.getNotificationPermission)({safariWebPushId:null===(i=o.siteSettings.safari_options)||void 0===i?void 0:i.push_id}),t=!(!w||"granted"!==e);Object.assign(_,{endpoint:u,isSubDomain:!t,id:c});const n=(()=>{const e=g.getDataFromLocalStorage("PushBrowseStorageData"),t=g.getDataFromLocalStorage("PushCartStorageData"),i=g.getDataFromLocalStorage("pushPriceDropStorageData"),n=g.getDataFromLocalStorage("pushInventoryStorageData"),o={};if(e){const t=d.convertStringToArray(`${e}`).map((e=>d.toInteger(e)));o.browseVariantIds=t}if(t){const e=d.convertStringToArray(`${t}`).map((e=>d.toInteger(e)));o.cartVariantIds=e}if(i){const e=d.convertStringToArray(`${i}`).map((e=>d.toInteger(e)));o.priceDropVariantIds=e}if(n){const e=d.convertStringToArray(`${n}`).map((e=>d.toInteger(e)));o.backInStockVariantIds=e}return o})();return d.isEmptyObject(n)||(_.shopify=n),g.setDataToLocalStorage(l.storageName,_),g.deleteDataFromLocalStorage(b),void g.deleteDataFromCookies(["peclosed","PushSubscriberStatus"])}if("DENIED"===a){const e=(0,m.getNotificationPermission)({safariWebPushId:null===(n=o.siteSettings.safari_options)||void 0===n?void 0:n.push_id}),t=!(!w||"denied"!==e);return _.denied={data:{isSubDomain:!t,status:!0},expiresAt:(0,p.getUnixTime)(1)},g.setDataToLocalStorage(l.storageName,_),g.deleteDataFromLocalStorage(b),void g.deleteDataFromCookies(["peclosed"])}const S=(0,f.getParsedStorageData)("PushBeforeSubData"),I={};for(const e in S)if(e.includes("close_optin_id_")){const t=e.split("close_optin_id_")[1],i=S[e];I[t]={data:!0,expiresAt:i.max_age||(0,p.getUnixTime)(7)}}"CLOSED"===a&&h.length>0&&y.forEach((e=>{I[e.optin_type]={data:!0,expiresAt:(0,p.getUnixTime)(e.cookie_duration||7)}})),d.isEmptyObject(I)||(_.optInClosed=I,g.setDataToLocalStorage(l.storageName,_),g.deleteDataFromLocalStorage(b),g.deleteDataFromCookies(["peclosed","PushSubscriberStatus"]))},t.isServiceWorkerAvailabilityEnabled=e=>(0,t.getSubscriptionOptIns)(e).some((),t.transformServiceWorker=({serviceWorkerSetting:e,sdkInitOptions:t,customSubDomainSetting:i,site:n})=>{const o=function(){var n,o,s,r,a,c,u,g,p,b,f,v;if(t.isSubscriptionOnSubDomain&&!i)return l.defaultServiceWorkerSetting;let{scope:m,workerStatus:_,worker:h}=e;return t.isShopifySite&&(h="/apps/pushengage/service-worker.js",m=!1),d.isUndefined(window.pathvars)||(h=null!==(o=null===(n=window.pathvars)||void 0===n?void 0:n.worker)&&void 0!==o?o:h,_=null!==(r=null===(s=window.pathvars)||void 0===s?void 0:s.workerStatus)&&void 0!==r?r:_,m=null!==(c=null===(a=window.pathvars)||void 0===a?void 0:a.scope)&&void 0!==c?c:m),d.isObject(t.serviceWorker)&&(h=null!==(g=null===(u=t.serviceWorker)||void 0===u?void 0:u.path)&&void 0!==g?g:h,_=null!==(b=null===(p=t.serviceWorker)||void 0===p?void 0:p.status)&&void 0!==b?b:_,m=null!==(v=null===(f=t.serviceWorker)||void 0===f?void 0:f.scope)&&void 0!==v?v:m),{scope:m,workerStatus:_,worker:h}}();if(!l.skipQueryParamsInWorkerPath.includes(n.site_id)){const{worker:e}=o,i=`v=${l.env.__WORKER_VERSION__}&appId=${t.appId}`;o.worker=e.includes("?")?`${e}&${i}`:`${e}?${i}`}return o},t.getSegmentNamesFromRules=e=>{const i=[];if(!e)return i;const n=location.href;return e.forEach((e=>{e.add_segment_on_page_load&&e.segment_criteria&&(0,t.isUrlSatisfyingUrlRules)({include:e.segment_criteria.include,exclude:e.segment_criteria.exclude},n)&&i.push(e.segment_name)})),i},t.isServiceWorkerAvailable=({optInSetting:e})=>{let i=!0;return(0,t.getSubscriptionOptIns)(e).length&&(i=(0,t.isServiceWorkerAvailabilityEnabled)(e)),i}},8648:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.processNotificationPermission=t.processNotificationPermissionClosedData=t.processNotificationPermissionDeniedData=t.processSubscriptionData=void 0;const s=i(3502),r=i(9892),a=o(i(7607)),d=i(1920),c=i(6547),l=i(9340),u=i(953),g=i(3241),p=i(4014),b=i(5021);t.processSubscriptionData=({site:e,subscription:t,siteSettings:i,options:o={}})=>n(void 0,void 0,void 0,(function*(){const{gcm_options:n,vapid_key:r,privacy_settings:c,publisher_settings:l,safari_options:g}=i;let p;p="deviceToken"in t?{endpoint:t.deviceToken,project_id:g.push_id}:Object.assign(Object.assign(Object.assign({},t),n),{vapid_public_key:r.public_key});const f=(0,d.getBrowserInfo)(),v=yield(0,b.getGeoInfo)({isEu:e.is_eu}),m=yield(0,s.addSubscriberDataToSite)({browserInfo:f,site:e,subscription:p,options:{geoInfo:c.geoLocationEnabled?v:void 0,optInType:o.optInType,tokenRefresh:o.tokenRefresh,isPublisherSettingEnabled:null==l?void 0:l.enabled,widgetOptInType:o.widgetOptInType}}),{segment:_}=o;if(_&&(Array.isArray(_)?_:[_]).length)try{yield(0,u.addSegmentToSubscriber)({segment:_,subscriberId:m,siteId:e.site_id})}catch(e){a.default.warn(e)}return m})),t.processNotificationPermissionDeniedData=({optInType:e,site:t})=>n(void 0,void 0,void 0,(function*(){const i={optin_type:e,site_id:t.site_id};e===l.optInTypes.singleStep?Object.assign(i,{block_1:!0,optin_1:!0}):Object.assign(i,{allow_1:!0,optin_1:!0,block_2:!0,optin_2:!0}),yield(0,c.sendOptInAnalytics)(i)})),t.processNotificationPermissionClosedData=({optInType:e,site:t})=>n(void 0,void 0,void 0,(function*(){const i={optin_type:e,site_id:t.site_id};e===l.optInTypes.singleStep?Object.assign(i,{close_1:!0,optin_1:!0}):Object.assign(i,{allow_1:!0,optin_1:!0,close_2:!0,optin_2:!0}),yield(0,c.sendOptInAnalytics)(i)})),t.processNotificationPermission=({siteSettings:e,permissionData:i,site:o,optInType:s,options:c={}})=>n(void 0,void 0,void 0,(function*(){var n;a.default.debug("Process notification permission.");const u=((e,t)=>{const i=(0,d.detectDeviceType)(),n=(0,g.detectSiteType)(),o=(0,p.get)(e,`optins.${t}.${i}.${n}`);return o?o.cookie_duration:l.defaultMinStorageDuration})(e.optin_settings,s),b=null!==(n=c.isSubDomain)&&void 0!==n&&n;if("granted"===i.permission&&i.subscription){const n=yield(0,t.processSubscriptionData)({siteSettings:e,site:o,subscription:i.subscription,options:{optInType:s,segment:c.segment,tokenRefresh:c.tokenRefresh,widgetOptInType:c.widgetOptInType}});(0,r.storeSubscriptionDataInStorage)({isSubDomain:b,subscriberId:n,subscription:i.subscription}),a.default.debug("The subscriber has been added to the site, and the subscriber data has been sent to PushEngage and stored in storage.")}else"denied"===i.permission?(yield(0,t.processNotificationPermissionDeniedData)({optInType:s,site:o}),(0,r.storeSubscriptionDeniedDataInStorage)({storageDuration:u,isSubDomain:b}),a.default.debug("The current permission status is denied, and the opt-in impression analytics have been sent to PushEngage and the status has been stored in storage.")):(yield(0,t.processNotificationPermissionClosedData)({optInType:s,site:o}),c.widgetOptInType||(0,r.storeOptInCloseDataInStorage)({optInType:s,storageDuration:u}),a.default.debug("The current permission status is default(clicked on X or, auto closed), and the opt-in impression analytics have been sent to PushEngage and the status has been stored in storage."))}))},1734:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleMessageUnsubscribeState=t.handleMessageSubscribeState=t.handleMessageSubscriptionState=t.handleNotificationOpenUrl=t.handleNotificationClick=t.showDefaultNotification=t.showNotification=t.transformNotifications=t.parseOrFetchNotifications=t.isValidPushPayload=t.getNotificationUrlAndUserAction=t.broadcastReply=t.checkAndUpdateNotificationInDbByKey=t.processFailedAnalytics=t.getAppId=void 0;const s=i(1920),r=i(2768),a=o(i(7607)),d=i(4014),c=i(5021),l=i(3502),u=i(9340),g=o(i(3321)),p=i(4318),b=i(3609),f=i(7224),v=i(1791),m=i(3241);t.getAppId=()=>n(void 0,void 0,void 0,(function*(){let e=(0,m.getValueFromUrlByKey)("appId",location.href)||null;if(e)return e;try{e=yield(0,p.getAppId)()}catch(t){e=null}return e||(e="undefined"!=typeof PUSHENGAGE_APP_ID?PUSHENGAGE_APP_ID:null,e)})),t.processFailedAnalytics=()=>n(void 0,void 0,void 0,(function*(){try{const e=yield(0,p.getFailedViewedNotificationTags)();for(let t=0;t<e.length;t++){const{id:i}=e[t];yield(0,f.sendNotificationViewedAnalytics)({tag:i}),yield(0,p.deleteFailedViewedNotificationTag)(i)}const t=yield(0,p.getFailedClickedNotificationTags)();for(let e=0;e<t.length;e++){const{id:i,action:n}=t[e];yield(0,f.sendNotificationClickedAnalytics)({tag:i,action:n}),yield(0,p.deleteFailedClickedNotificationTag)(i)}}catch(e){a.default.error(`Error during process failed analytics, ${e.message}`)}})),t.checkAndUpdateNotificationInDbByKey=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const i=yield(0,p.getNotificationTagsByKey)(t);if(i.length){const t=(0,b.removeSubscriberIdFromTag)(e);if(i.some(())return!0}yield(0,p.updateNotificationTagByKey)(e,t)}catch(e){a.default.error(`Error while checking and updating notification tag in db, ${e.message}`)}return!1})),t.broadcastReply=(e,t)=>n(void 0,void 0,void 0,(function*(){const i=yield self.clients.matchAll();for(let n=0;n<i.length;n++)i[n].postMessage({command:e,payload:t})})),t.getNotificationUrlAndUserAction=(e,t)=>{let i="action3",n=(0,d.isObject)(e)?null==e?void 0:e.url:e,o=null;return t&&(o=(0,d.safeParse)(t)),"action1"==(null==o?void 0:o.action)?(i="action1",n=o.action_url||n):"action2"==(null==o?void 0:o.action)&&(i="action2",n=o.action_url||n),{userAction:i,notificationUrl:n||"/"}},t.isValidPushPayload=e=>!!(e&&Array.isArray(e)&&e.length&&e[0].options&&e[0].options.tag),t.parseOrFetchNotifications=(e,i)=>n(void 0,void 0,void 0,(function*(){var n,o,s;if(!(null==e?void 0:e.data))return yield(0,f.fetchPayloadLessNotifications)(i);let r;try{r=e.data.json()}catch(t){throw new g.default({message:`Parsing of the push payload failed, ${e.data.text()}.`,name:"PushPayloadParseError",details:{worker:self.location.href}})}if(!(0,t.isValidPushPayload)(r))throw new g.default({message:"Valid JSON but not PushEngage payload.",name:"NotPushEngagePayload",details:{payload:r,worker:self.location.href}});const a=r[0];return(null===(n=a.options)||void 0===n?void 0:n.tag)&&(d=a.options).customData&&d.customData.refetch?yield(0,f.fetchPayloadNotifications)({tag:a.options.tag,postback:(null===(s=null===(o=a.options)||void 0===o?void 0:o.customData)||void 0===s?void 0:s.postback)||""}):[a];var d})),t.transformNotifications=e=>e.map((e=>{const{tag:t,data:i,actions:n}=e.options||{},o=t?t.toString():"",s=[];return n&&Array.isArray(n)&&n.forEach((function(e){e.icon||s.push((0,d.omit)(e,["icon"]))})),Object.assign(Object.assign({},e),{options:Object.assign(Object.assign({},e.options),{tag:(0,b.removeSubscriberIdFromTag)(o),actions:s.length?s:void 0,data:{originalTag:o,url:i||""}})})})),t.showNotification=({title:e,subscription:i,notificationOptions:o})=>n(void 0,void 0,void 0,(function*(){var s;if("granted"===Notification.permission){if((null==o?void 0:o.tag)&&o.tag.includes(u.defaultNotificationTag))return self.registration.showNotification(e,o);if(yield self.registration.showNotification(e,o),(null==o?void 0:o.viewUrl)&&(null==o?void 0:o.tag))try{yield(0,f.sendNotificationViewedReferAnalytics)({tag:(null===(s=null==o?void 0:o.data)||void 0===s?void 0:s.originalTag)||o.tag}),a.default.info("Response from view refer analytics")}catch(e){a.default.info(`Failed response from view refer analytics, ${e.name}`)}if(null==o?void 0:o.tag)try{yield(({notificationOptions:e,subscription:i})=>n(void 0,void 0,void 0,(function*(){var n;if(yield(0,t.processFailedAnalytics)(),!(null==e?void 0:e.tag))return;const o=(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.originalTag)||(null==e?void 0:e.tag);if(!(yield(0,t.checkAndUpdateNotificationInDbByKey)(o,"viewedNotificationTags")))try{yield(0,f.sendNotificationViewedAnalytics)({tag:o}),a.default.info("Response from viewed analytics")}catch(e){if(a.default.info(`Failed response from viewed analytics, ${e.name}`),!1===navigator.onLine)try{yield(0,p.addFailedViewedNotificationTag)({tag:o})}catch(e){a.default.error(`Failed to add failed viewed notification tag to db, ${e.message}`)}else(0,v.sendErrorLog)("service-worker",e,{tag:o,name:"viewCountTrackingFailed",endpoint:i.endpoint,data:{tag:o}})}})))({notificationOptions:o,subscription:i})}catch(e){a.default.info(`Failed to handle notification view, ${e.name}`)}}})),t.showDefaultNotification=({subscription:e})=>n(void 0,void 0,void 0,(function*(){const i=yield(0,t.getAppId)(),n={subscription:e,notificationOptions:{data:{url:"/",originalTag:u.defaultNotificationTag},tag:u.defaultNotificationTag,requireInteraction:!1},title:u.defaultNotificationTitle};if(!i)return a.default.debug("AppId is not present in the service worker URL."),void(yield(0,t.showNotification)(n));let o=null;try{o=yield(0,c.getAppData)({source:"service-worker",appId:i})}catch(e){return a.default.info(`${e.message}`),void(yield(0,t.showNotification)(n))}if(!o)throw yield(0,t.showNotification)(n),new g.default({name:"AppDataEmpty",message:"App data is not available.",details:{appId:i,worker:self.location.href}});const s=o.siteSettings.default_notification;if(!s)throw yield(0,t.showNotification)(n),new g.default({name:"DefaultNotificationSettingNotFound",message:"Default notification setting is not available.",details:{appId:i,worker:self.location.href}});const r=o.site,d={body:s.default_notification_message,icon:r.site_image,tag:`${u.defaultNotificationTag}${r.site_id}`,data:{url:s.default_notification_url,originalTag:u.defaultNotificationTag},requireInteraction:!1};yield(0,t.showNotification)({subscription:e,notificationOptions:d,title:s.default_notification_title})})),t.handleNotificationClick=({notificationOptions:e,userAction:i,subscription:o})=>n(void 0,void 0,void 0,(function*(){var n,s;if(null===(n=e.tag)||void 0===n?void 0:n.includes(u.defaultNotificationTag))return;if(!e.tag)return;const r=(null===(s=e.data)||void 0===s?void 0:s.originalTag)||e.tag;if(!(yield(0,t.checkAndUpdateNotificationInDbByKey)(r,"clickedNotificationTags")))try{yield(0,f.sendNotificationClickedAnalytics)({tag:r,action:i}),a.default.info("Response from clicked analytics")}catch(e){if(a.default.info(`Failed response from clicked analytics, ${e.name}`),!1===navigator.onLine)try{yield(0,p.addFailedClickedNotificationTag)({tag:r,action:i})}catch(e){a.default.error(`Failed to add failed clicked notification tag to db, ${e.message}`)}else(0,v.sendErrorLog)("service-worker",e,{tag:r,name:"clickCountTrackingFailed",endpoint:o.endpoint,action:i,data:{tag:r,action:i}})}})),t.handleNotificationOpenUrl=e=>n(void 0,void 0,void 0,(function*(){const t=yield self.clients.matchAll({type:"window"});for(let i=0;i<t.length;i++){const n=t[i];if(n.url===e&&"focus"in n)return n.focus()}try{return yield self.clients.openWindow(e)}catch(t){throw new g.default({message:`Failed to open the URL '${e}'.`,name:"OpenNotificationUrlFailed",details:{url:e}})}})),t.handleMessageSubscriptionState=()=>n(void 0,void 0,void 0,(function*(){const e=yield self.registration.pushManager.getSubscription();if(!e)return void(yield(0,t.broadcastReply)(u.workerMessengerCommand.ampSubscriptionState,!1));const i=yield self.registration.pushManager.permissionState(e.options);yield(0,t.broadcastReply)(u.workerMessengerCommand.ampSubscriptionState,"granted"===i)})),t.handleMessageSubscribeState=()=>n(void 0,void 0,void 0,(function*(){const e=yield(0,t.getAppId)();if(!e)throw new g.default({name:"AppIdNotFound",message:"AppId is not present in the service worker URL",details:{appId:e,worker:self.location.href}});let i;try{i=yield(0,c.getAppData)({appId:e,source:"service-worker-amp"})}catch(t){throw new g.default({name:"InvalidAppId",message:t.message,details:{appId:e,worker:self.location.href}})}if(!i)throw new g.default({name:"AppDataEmpty",message:"App data is not available.",details:{appId:e,worker:self.location.href}});const{gcm_options:n,privacy_settings:o,vapid_key:p}=i.siteSettings,b=i.site.site_id;if(!p)throw new g.default({name:"VAPIDSettingNotFound",message:"VAPID setting is not available.",details:{appId:e,siteId:b}});if(!n)throw new g.default({name:"GCMSettingNotFound",message:"GCM setting is not available.",details:{appId:e,siteId:b}});let f;try{f=yield(0,r.subscribeToPushNotificationFromWorker)(p.public_key)}catch(t){throw new g.default({name:"AMPSubscribeFailed",message:`Failed to subscribe to push notifications, ${t.message}`,details:{appId:e,siteId:b}})}let v,m="";try{m=yield self.clients.matchAll({includeUncontrolled:!0,type:"window"}).then((e=>0===e.length?"":e[0].url))}catch(e){(0,d.noop)()}o.geoLocationEnabled&&(v=yield(0,c.getGeoInfo)({isEu:i.site.is_eu}));const{name:_,version:h}=(0,s.detectBrowser)(),y={browserInfo:{name:_,version:h,device:(0,s.detectDeviceType)(),host:self.location.host,href:m,language:navigator.language,userAgent:navigator.userAgent,referrer:self.location.origin},site:i.site,subscription:Object.assign(Object.assign({},f),{project_id:n.project_id,vapid_public_key:p.public_key}),options:{geoInfo:v,optInType:u.optInTypes.singleStep}};try{yield(0,l.addSubscriberDataToSite)(y),a.default.debug("Subscription added."),yield(0,t.broadcastReply)(u.workerMessengerCommand.ampSubscribe,null)}catch(e){throw new g.default({name:"AddSubscriptionFailed",message:`Failed to adding subscription, ${e.message}`,details:{data:y}})}})),t.handleMessageUnsubscribeState=()=>n(void 0,void 0,void 0,(function*(){const e=yield self.registration.pushManager.getSubscription();if(e)try{yield e.unsubscribe(),a.default.debug("Subscription unsubscribed."),yield(0,t.broadcastReply)(u.workerMessengerCommand.ampUnsubscribe,null)}catch(e){throw new g.default({message:`Failed unsubscribe to push notifications, ${e.message}.`,name:"UnsubscribedFailedFromWorker",details:{worker:self.location.href}})}}))},9432:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getImageUrlsFromCartItem=t.getImageUrlsFromProduct=t.getImageUrlsFromVariant=t.filterVariantFromVariantId=t.getSelectedVariantId=t.getPageType=t.convertPriceToFloat=void 0;const o=i(4014),s=i(7330),r=({imageUrl:e,width:t,height:i})=>n(void 0,void 0,void 0,(function*(){let n=(({url:e,width:t,height:i})=>{const n=[".png",".jpg",".jpeg",".gif",".webp"];if(!e.includes("cdn.shopify.com"))return e;for(const o of n)if(e.includes(o))return e.replace(o,`_${t}x${i}${o}`);return e})({width:t,height:i,url:e});var o;if(0!==(o=n).indexOf("https:")&&0!==o.indexOf("http:")&&(o="https:"+o),n=o,yield(0,s.isUrlReachable)(n))return n}));t.convertPriceToFloat=e=>parseFloat(""+e/100).toFixed(2),t.getPageType=()=>{var e,t,i;return null===(i=null===(t=null===(e=window.ShopifyAnalytics)||void 0===e?void 0:e.meta)||void 0===t?void 0:t.page)||void 0===i?void 0:i.pageType},t.getSelectedVariantId=()=>{var e,t;return null===(t=null===(e=window.ShopifyAnalytics)||void 0===e?void 0:e.meta)||void 0===t?void 0:t.selectedVariantId},t.filterVariantFromVariantId=(e,t)=>{var i,n;return t?null===(n=e.variants)||void 0===n?void 0:n.find(():null===(i=e.variants)||void 0===i?void 0:i[0]},t.getImageUrlsFromVariant=e=>n(void 0,void 0,void 0,(function*(){var t;const i=null===(t=null==e?void 0:e.featured_image)||void 0===t?void 0:t.src;if(!i||"string"!=typeof i)return{};const[n,o]=yield Promise.all([r({imageUrl:i,width:364,height:180}),r({imageUrl:i,width:192,height:192})]);return{largeImageUrl:n,imageUrl:o}})),t.getImageUrlsFromProduct=e=>n(void 0,void 0,void 0,(function*(){const t=e.featured_image;if(!t||"string"!=typeof t)return{};const[i,n]=yield Promise.all([r({imageUrl:t,width:364,height:180}),r({imageUrl:t,width:192,height:192})]);return{largeImageUrl:i,imageUrl:n}})),t.getImageUrlsFromCartItem=e=>n(void 0,void 0,void 0,(function*(){const t=e.image;if(!t||"string"!=typeof t)return{};const[i,n]=yield Promise.all([r({imageUrl:t,width:364,height:180}),r({imageUrl:t,width:192,height:192})]);return{largeImageUrl:i,imageUrl:n}}))},1730:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.unsubscribeSubscription=t.getUserSubscriptionState=t.evaluateUserSubscriptionState=t.isAllSubscriptionOptInClosed=t.subscriptionNeedToBeResubscribed=t.resubscribeSubscription=void 0;const d=s(i(9892)),c=s(i(2768)),l=i(2471),u=i(1920),g=i(9340),p=a(i(7607)),b=i(3502),f=i(9892),v=i(3110),m=({error:e,optInSetting:t})=>["ServiceWorkerNotRegistering","ServiceWorkerNotFound","DisabledPushSubscriptionError"].includes(e.name)&&(0,v.isServiceWorkerAvailable)({optInSetting:t});t.resubscribeSubscription=({vapidSetting:e,serviceWorkerSetting:t,safariWebPushPackageSetting:i})=>r(void 0,void 0,void 0,(function*(){if("granted"!==(0,l.getNotificationPermission)({safariWebPushId:null==i?void 0:i.push_id}))throw new Error("Notification permission is not granted, so it is not possible to obtain the subscription.");const{name:n}=(0,u.detectBrowser)(),o=(0,u.detectDeviceType)();if("Safari"===n&&!(0,l.hasSupportForPushApiInSafari)()){if(!i)throw new Error("Safari Web Push Package is not configured.");const e=c.getSafariSubscription(i.push_id);if("granted"===e.permission)return e;throw new Error("Safari Notification permission is not granted, so it is not possible to obtain the subscription.")}const s=d.getSubscriberIdFromStorage();let r;s&&(r=yield(0,b.getSubscriberData)(s));const a={vapidPublicKey:e.public_key};let g;if(t.workerStatus&&(a.options={scope:t.scope?"/":void 0},a.scriptURL=t.worker),"Firefox"===n&&"mobile"===o){if(r&&r.vapid_public_key!==e.public_key)throw new Error("The applicationServerKey has changed, so it's not possible to resubscribe.");const t=yield c.getPushSubscription({scriptURL:a.scriptURL,options:a.options});if(!t)throw new Error("Subscription not found.");g=t}else if(r&&r.vapid_public_key!==e.public_key)yield c.unsubscribeFromPushSubscription(),g=yield c.subscribeToPushNotification(a);else try{g=yield c.subscribeToPushNotification(a)}catch(e){if("InvalidStateError"!==e.name)throw e;yield c.unsubscribeFromPushSubscription(),g=yield c.subscribeToPushNotification(a)}return g})),t.subscriptionNeedToBeResubscribed=({vapidSetting:e,serviceWorkerSetting:i,safariWebPushPackageSetting:n})=>r(void 0,void 0,void 0,(function*(){if("granted"!==(0,l.getNotificationPermission)({safariWebPushId:null==n?void 0:n.push_id}))return;const o=d.getParsedStorageData(g.storageName),s=yield(0,t.resubscribeSubscription)({vapidSetting:e,serviceWorkerSetting:i,safariWebPushPackageSetting:n});return!s||o.id&&(s.endpoint||s.deviceToken)===o.endpoint?void 0:s})),t.isAllSubscriptionOptInClosed=e=>{const t=(0,v.getActiveOptInTypes)(e);return!(!t.length||!d.isSubscriptionOptInClosed(t))},t.evaluateUserSubscriptionState=({optInSetting:e,vapidSetting:i,serviceWorkerSetting:n,safariWebPushPackageSetting:o})=>r(void 0,void 0,void 0,(function*(){if(d.isSubscriptionUnsubscribed({notificationPermission:(0,l.getNotificationPermission)({safariWebPushId:null==o?void 0:o.push_id})}))return{state:"unsubscribed"};try{const e=yield(0,t.subscriptionNeedToBeResubscribed)({vapidSetting:i,serviceWorkerSetting:n,safariWebPushPackageSetting:o});if(e)return{subscription:e,state:"resubscribe"}}catch(t){if(m({error:t,optInSetting:e}))throw t;!1===d.isSubscriptionOnSubDomain()&&d.clearOldSubscriptionDataFromStorage(),p.default.debug(t)}if(d.isSubscriptionDenied({notificationPermission:(0,l.getNotificationPermission)({safariWebPushId:null==o?void 0:o.push_id})}))return{state:"denied"};if(d.hasSubscriptionDataInStorage({notificationPermission:(0,l.getNotificationPermission)({safariWebPushId:null==o?void 0:o.push_id})})){const s=d.getSubscriberIdFromStorage(),r=yield(0,b.getSubscriberData)(s);if(r&&1!==r.has_unsubscribed)return{state:"subscribed"};d.clearOldSubscriptionDataFromStorage();try{const e=yield(0,t.subscriptionNeedToBeResubscribed)({vapidSetting:i,serviceWorkerSetting:n,safariWebPushPackageSetting:o});if(e)return{subscription:e,state:"resubscribe"}}catch(t){if(m({error:t,optInSetting:e}))throw t;p.default.debug(t)}}return(0,t.isAllSubscriptionOptInClosed)(e)?{state:"closed"}:(d.clearOldSubscriptionDataFromStorage(),{state:"default"})})),t.getUserSubscriptionState=({optInSetting:e,safariWebPushPackageSetting:i})=>r(void 0,void 0,void 0,(function*(){if(d.isSubscriptionUnsubscribed({notificationPermission:(0,l.getNotificationPermission)({safariWebPushId:null==i?void 0:i.push_id})}))return"unsubscribed";if(d.isSubscriptionDenied({notificationPermission:(0,l.getNotificationPermission)({safariWebPushId:null==i?void 0:i.push_id})}))return"denied";if(d.hasSubscriptionDataInStorage({notificationPermission:(0,l.getNotificationPermission)({safariWebPushId:null==i?void 0:i.push_id})})){const e=d.getSubscriberIdFromStorage(),t=yield(0,b.getSubscriberData)(e);return t&&1!==t.has_unsubscribed?"subscribed":(d.clearOldSubscriptionDataFromStorage(),"default")}return(0,t.isAllSubscriptionOptInClosed)(e)?"closed":(d.clearOldSubscriptionDataFromStorage(),"default")})),t.unsubscribeSubscription=({siteId:e,subscriberId:t,serviceWorkerSetting:i})=>r(void 0,void 0,void 0,(function*(){var n;yield(0,b.updateSubscriberStatus)({siteId:e,subscriberId:t,status:"unsubscribe"});const o=d.getParsedStorageData(g.storageName);(0,f.storeSubscriptionUnsubscribedDataInStorage)(null===(n=o.isSubDomain)||void 0===n||n);const{name:s}=(0,u.detectBrowser)();if("Safari"===s&&!(0,l.hasSupportForPushApiInSafari)()||o.isSubDomain)return;const r={};i.workerStatus&&(r.options={scope:i.scope?"/":void 0},r.scriptURL=i.worker);try{yield c.unsubscribeFromPushSubscription()}catch(e){p.default.debug("Error occurred during unsubscription.",e)}}))},4014:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.replaceLastNumberFromIpToZero=t.deepMerge=t.keepLastMaxElements=t.convertStringToArray=t.delay=t.capitalizeFirstLetter=t.uniqueArray=t.isNull=t.isUndefined=t.isWorker=t.toInteger=t.addStyleToPage=t.addScriptToPage=t.isEmptyArray=t.isEmptyObject=t.omit=t.get=t.isObject=t.removeArrayItem=t.safeStringify=t.safeParse=t.hasOwn=t.noop=void 0;const n=i(5914);t.noop=()=>{},t.hasOwn=t.safeParse=e=>{let t=null;try{t=JSON.parse(e)}catch(e){(0,n.logDebug)(e)}return t},t.safeStringify=e=>{let t=null;try{t=JSON.stringify(e)}catch(e){(0,n.logDebug)(e)}return t},t.removeArrayItem=(e,t)=>{const i=e.indexOf(t);return i>-1&&e.splice(i,1),e},t.isObject=t.get=(e,t,i)=>{const n=Array.isArray(t)?t:t.split(".");let o=e;for(const e of n){if(null==o)return i;o=o[e]}return void 0===o?i:o},t.omit=(e,t)=>{const i=Object.assign({},e);for(const e of t){const t=Array.isArray(e)?e:[e];let n=i,o=t[0];for(let e=0;e<t.length-1;e++)n=n[o],o=t[e+1];delete n[o]}return i},t.isEmptyObject=e=>!(0,t.isObject)(e)||0===Object.keys(e).length,t.isEmptyArray=e=>!Array.isArray(e)||0===e.length,t.addScriptToPage=(...e)=>{e.forEach((e=>{try{const t=document.createElement("script");t.src=e,t.async=!0,t.type="text/javascript",document.head.appendChild(t)}catch(t){throw new Error(`Invalid script URL: ${e}`)}}))},t.addStyleToPage=(...e)=>{e.forEach((e=>{try{const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.type="text/css",document.head.appendChild(t)}catch(t){throw new Error(`Invalid style URL: ${e}`)}}))},t.toInteger=e=>{if("string"!=typeof e&&"number"!=typeof e)return 0;e=String(e).trim();const t=parseInt(e,10);return isNaN(t)?0:t},t.isWorker=()=>self instanceof ServiceWorkerGlobalScope,t.isUndefined=t.isNull=t.uniqueArray=t.capitalizeFirstLetter=t.delay=e=>new Promise((t=>setTimeout(t,e))),t.convertStringToArray=t.keepLastMaxElements=(e,t)=>e.length>t?e.slice(-t):e,t.deepMerge=(e,i)=>{for(const n in i)"object"==typeof i[n]&&null!==i[n]&&(0,t.hasOwn)(e,n)?(0,t.deepMerge)(e[n],i[n]):e[n]=i[n]},t.replaceLastNumberFromIpToZero=(e,t)=>{if(!e||!t)return t;const i=t.includes(".")?".":":",n=t.split(i);return n[n.length-1]="0",n.join(i)}},1920:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getChromiumStatus=t.getBrowserInfo=t.detectDeviceType=t.isPrivateBrowser=t.detectBrowser=t.isBrowser=void 0;const i=function(){return new Promise((function(e,t){let i="Unknown";const n=o=e=>e===eval.toString().length;(()=>{const e=navigator.vendor;return void 0!==e&&0===e.indexOf("Apple")&&o(37)})()?(i="Safari",void 0!==navigator.maxTouchPoints?(()=>{const e=String(Math.random());try{window.indexedDB.open(e,1).onupgradeneeded=t=>{var i,o;const s=null===(i=t.target)||void 0===i?void 0:i.result;try{s.createObjectStore("test",{autoIncrement:!0}).put(new Blob),n(!1)}catch(e){let t=e;if(e instanceof Error&&(t=null!==(o=e.message)&&void 0!==o?o:e),"string"!=typeof t)return n(!1);const i=/BlobURLs are not yet supported/.test(t);return n(i)}finally{s.close(),window.indexedDB.deleteDatabase(e)}}}catch(e){return n(!1)}})():(()=>{const e=window.openDatabase,t=window.localStorage;try{e(null,null,null,null)}catch(e){return n(!0)}try{t.setItem("test","1"),t.removeItem("test")}catch(e){return n(!0)}n(!1)})()):(()=>{const e=navigator.vendor;return void 0!==e&&0===e.indexOf("Google")&&o(33)})()?(i=(()=>{const e=navigator.userAgent;return e.match(/Chrome/)?void 0!==navigator.brave?"Brave":e.match(/Edg/)?"Edge":e.match(/OPR/)?"Opera":"Chrome":"Chromium"})(),void 0!==self.Promise&&void 0!==self.Promise.allSettled?navigator.webkitTemporaryStorage.queryUsageAndQuota(((e,t)=>{const i=Math.round(t/1048576),o=2*Math.round((()=>{const e=window;return void 0!==e.performance&&void 0!==e.performance.memory&&void 0!==e.performance.memory.jsHeapSizeLimit?e.performance.memory.jsHeapSizeLimit:1073741824})()/1048576);n(i<o)}),(e=>{t(new Error("detectIncognito somehow failed to query storage quota: "+e.message))})):(0,window.webkitRequestFileSystem)(0,1,(function(){n(!1)}),(function(){n(!0)}))):void 0!==document.documentElement&&void 0!==document.documentElement.style.MozAppearance&&o(37)?(i="Firefox",(()=>{const e=indexedDB.open("test");e.onerror=function(){n(!0)},e.onsuccess=)()):void 0!==navigator.msSaveBlob&&o(39)?(i="Internet Explorer",n(void 0===window.indexedDB)):/Edge\/\d/.test(navigator.userAgent)?(i="Edge",n(!1)):t(new Error("detectIncognito cannot determine the browser"))}))};t.isBrowser=t.detectBrowser=(e=navigator.userAgent)=>{var t,i,n,o,s,r,a,d,c,l,u;let g="Unknown",p="";return/Firefox\/\d/.test(e)?(g="Firefox",p=(null===(t=e.match(/Firefox\/(\d+)/))||void 0===t?void 0:t[1])||""):/OPR\/\d/.test(e)?(g="Opera",p=(null===(i=e.match(/OPR\/(\d+)/))||void 0===i?void 0:i[1])||""):/Edg\/\d/.test(e)?(g="Edge",p=(null===(n=e.match(/Edg\/(\d+)/))||void 0===n?void 0:n[1])||""):/Edge\/\d/.test(e)?(g="Edge",p=(null===(o=e.match(/Edge\/(\d+)/))||void 0===o?void 0:o[1])||""):/EdgA\/\d/.test(e)?(g="Edge",p=(null===(s=e.match(/EdgA\/(\d+)/))||void 0===s?void 0:s[1])||""):/UCBrowser\//.test(e)?(g="Ucbrowser",p=(null===(r=e.match(/UCBrowser\/(\d+)/))||void 0===r?void 0:r[1])||""):/SamsungBrowser\//.test(e)?(g="Samsung",p=(null===(a=e.match(/SamsungBrowser\/(\d+)/))||void 0===a?void 0:a[1])||""):/YaBrowser\//.test(e)?(g="Yandex",p=(null===(d=e.match(/YaBrowser\/(\d+)/))||void 0===d?void 0:d[1])||""):/Chrome\//.test(e)?(g="Chrome",p=(null===(c=e.match(/Chrome\/(\d+)/))||void 0===c?void 0:c[1])||""):/Version\//.test(e)?(g="Safari",p=(null===(l=e.match(/Version\/(\d+)/))||void 0===l?void 0:l[1])||""):/MSIE|Trident/.test(e)&&(g="IE",p=(null===(u=e.match(/(?:MSIE |rv:)(\d+)/))||void 0===u?void 0:u[1])||""),p=p.replace(/[^\d.]/g,"").split(".")[0],{name:g,version:Number(p)}},t.isPrivateBrowser=function(){return new Promise((e=>{i().then(().catch(()}))},t.detectDeviceType=(e=navigator.userAgent)=>/Mobi/.test(e)?"mobile":"desktop",t.getBrowserInfo=()=>{const{name:e,version:i}=(0,t.detectBrowser)();return{name:e,version:i,availableScreen:`${screen.availWidth}*${screen.availHeight}`,device:(0,t.detectDeviceType)(),host:location.host,href:location.href,language:navigator.language,pixelDepth:screen.pixelDepth,referrer:document.referrer,screen:`${screen.width}*${screen.height}`,userAgent:navigator.userAgent}},t.getChromiumStatus=()=>{const e=Boolean(window.chrome),t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return e&&t?{isChromium:!0,version:Number(t[2])}:{isChromium:!1,version:0}}},606:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteDataFromLocalStorage=t.getDataFromLocalStorage=t.setDataToLocalStorage=t.deleteDataFromCookies=t.setDataToCookies=t.getDataFromCookies=void 0;const o=i(5914),s=n(i(3321)),r="undefined"!=typeof localStorage,a="undefined"!=typeof document&&void 0!==document.cookie;t.getDataFromCookies=e=>{if(!a)return(0,o.logDebug)("Cookie storage is not available"),null;const t=document.cookie.split(";");for(let i=0;i<t.length;i++){const[n,o]=t[i].split("=");if(n.trim()===e)return decodeURIComponent(o.trim())}return null},t.setDataToCookies=(e,t,i=30)=>{if(!a)return void(0,o.logDebug)("Cookie storage is not available");const n=new Date;n.setDate(n.getDate()+i);const s="object"==typeof t?JSON.stringify(t):t,r=encodeURIComponent(s)+"; expires="+n.toUTCString();document.cookie=e+"="+r+"; path=/"},t.deleteDataFromCookies=e=>{a?(Array.isArray(e)?e:[e]).forEach((e=>{(0,t.getDataFromCookies)(e)&&(document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`)})):(0,o.logDebug)("Cookie storage is not available")},t.setDataToLocalStorage=(e,t)=>{if(!r)throw new s.default({message:"Local storage is not available",name:s.default.ERROR_NAME.LocalStorageNotAvailable});const i="object"==typeof t?JSON.stringify(t):t;localStorage.setItem(e,i)},t.getDataFromLocalStorage=e=>{if(!r)throw new s.default({message:"Local storage is not available",name:s.default.ERROR_NAME.LocalStorageNotAvailable});return localStorage.getItem(e)||null},t.deleteDataFromLocalStorage=e=>{if(!r)throw new s.default({message:"Local storage is not available",name:s.default.ERROR_NAME.LocalStorageNotAvailable});Array.isArray(e)?e.forEach(():localStorage.removeItem(e)}},2689:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getUnixTime=t.getTimezoneOffset=void 0,t.getTimezoneOffset=()=>{const e=(new Date).getTimezoneOffset(),t=e>0?"-":"+",i=Math.floor(Math.abs(e)/60),n=Math.abs(e)%60;return`${t}${("0"+i).slice(-2)}:${("0"+n).slice(-2)}`},t.getUnixTime=e=>(e?new Date(Date.now()+24*e*60*60*1e3):new Date).getTime()},3641:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.richEditorHasNoValue=t.stripTagsAndDecodeEntity=t.addCSSProperties=t.clearBodyContent=t.getElementById=t.getScrollPercentage=t.addContentAfterBody=t.removeElement=void 0,t.removeElement=e=>{var t;if("string"==typeof e){const i=document.getElementById(e);i&&(null===(t=i.parentNode)||void 0===t||t.removeChild(i))}else Array.isArray(e)&&e.forEach((e=>{var t;const i=document.getElementById(e);i&&(null===(t=i.parentNode)||void 0===t||t.removeChild(i))}))},t.addContentAfterBody=e=>{const t=document.querySelector("body");if(!t)throw new Error("Can't find body element");Array.isArray(e)?e.forEach((e=>{t.insertAdjacentHTML("beforeend",e)})):t.insertAdjacentHTML("beforeend",e)},t.getScrollPercentage=()=>{const e=document.documentElement,t=document.body||document.scrollingElement,i=e.scrollTop||t&&t.scrollTop||0,n=e.scrollHeight||t&&t.scrollHeight||0,o=e.clientHeight||0,s=n?(i+o)/n*100:0;return Math.round(s)},t.getElementById=e=>document.getElementById(e),t.clearBodyContent=t.addCSSProperties=(e,t)=>{const i=document.getElementById(e);i&&Object.assign(i.style,t)},t.stripTagsAndDecodeEntity=e=>{if(!e)return;const t=document.createElement("span");return t.innerHTML=e,t.textContent},t.richEditorHasNoValue=e=>{if(!e)return!0;const t=document.createElement("div");t.innerHTML=e;let i=t.textContent||t.innerText;return i=i.replace(/\s+/g,""),0===i.length}},4182:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(5914);t.default=(()=>{const e={},t=(t,i)=>{const n=e[t];n&&(e[t]=i?n.filter(():[])};return{on:(t,i,n={})=>{e[t]||(e[t]=[]),e[t].push({cb:i,options:n})},trigger:(i,o)=>{const s=e[i];if(s)for(const e of s){try{const t=e.cb(o);t instanceof Promise&&t.catch(()}catch(e){(0,n.logDebug)(e)}e.options.once&&t(i,e.cb)}},remove:t}})()},5914:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logDebug=void 0,t.logDebug=,6405:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__rest||s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendHttpRequest=void 0;const r=s(i(3321)),a=e=>new Promise((t=>setTimeout(t,e)));t.sendHttpRequest=(e,t={})=>n(void 0,void 0,void 0,(function*(){const{retryDelay:i=1e3,retries:n=0,skipRetryStatusCodes:s=[400,404,403,422]}=t,d=o(t,["retryDelay","retries","skipRetryStatusCodes"]);let c;d.body&&(d.headers||(d.headers={"Content-Type":"application/json"}));let l=0;for(;l<n+1;){const t=i*(l+1);try{if(c=yield fetch(e,d),c.ok||l>=n)break;if(s.includes(c.status))break;yield a(t)}catch(i){if(l>=n){if("TypeError"===i.name&&"Failed to fetch"===i.message&&!navigator.onLine)throw new r.default({message:"Browser is offline. Request not sent.",name:r.default.ERROR_NAME.OfflineError,details:{fetchOptions:d,requestUrl:e}});throw new r.default({message:i.message,name:i.name||r.default.ERROR_NAME.HttpRequestError,details:{fetchOptions:d,requestUrl:e}})}yield a(t)}l++}if(!c)throw new r.default({message:"Request failed and no response was received.",name:r.default.ERROR_NAME.HttpRequestError,details:{fetchOptions:d,requestUrl:e}});return c}))},1074:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteObject=t.upsertObject=t.getObjects=t.getObject=t.openDB=void 0;const s=o(i(3321));t.openDB=(e,t,i)=>n(void 0,void 0,void 0,(function*(){if(!indexedDB)throw new Error("indexedDB is not supported");try{const n=indexedDB.open(e,t);n.onupgradeneeded=()=>{!function(e,t){t.forEach((t=>{var i;e.objectStoreNames.contains(t.name)||e.createObjectStore(t.name,{keyPath:t.keyPath,autoIncrement:null!==(i=t.autoIncrement)&&void 0!==i&&i})}))}(n.result,i)};const o=yield function(e){return new Promise(()}(n);return o}catch(e){throw new s.default({message:`Failed to open indexedDB, ${e.message}`,name:e.message.includes("indexedDB.open")?s.default.ERROR_NAME.IndexedDBOpenError:void 0,type:s.default.ERROR_TYPE.IndexedDBError})}})),t.getObject=(e,t,i)=>n(void 0,void 0,void 0,(function*(){try{const n=new Promise(((n,o)=>{const s=e.transaction(t,"readonly");s.onerror=()=>o(s.error);const r=s.objectStore(t).get(i);r.onerror=()=>o(r.error),r.onsuccess=()=>n(r.result)}));return yield n}catch(e){throw new s.default({message:`Failed to retrieve the specified object, ${e.message}.`,type:s.default.ERROR_TYPE.IndexedDBError,details:{key:i,storeName:t}})}})),t.getObjects=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const i=new Promise(((i,n)=>{const o=e.transaction(t,"readonly"),s=o.objectStore(t);if(o.onerror=()=>n(o.error),s.getAll){const e=s.getAll();e.onerror=()=>n(e.error),e.onsuccess=()=>i(e.result)}else{const e=[],t=s.openCursor();t.onerror=()=>n(t.error),t.onsuccess=}));return yield i}catch(e){throw new s.default({message:`Failed to retrieve the objects, ${e.message}.`,type:s.default.ERROR_TYPE.IndexedDBError,details:{storeName:t}})}})),t.upsertObject=(e,t,i)=>n(void 0,void 0,void 0,(function*(){try{const n=new Promise(((n,o)=>{const s=e.transaction(t,"readwrite");s.onerror=()=>o(s.error);const r=s.objectStore(t).put(i);r.onerror=()=>o(r.error),r.onsuccess=()=>n(void 0)}));yield n}catch(e){throw new s.default({message:`Failed to upsert object, ${e.message}.`,type:s.default.ERROR_TYPE.IndexedDBError,details:{object:i,storeName:t}})}})),t.deleteObject=(e,t,i)=>n(void 0,void 0,void 0,(function*(){try{const n=new Promise(((n,o)=>{const s=e.transaction(t,"readwrite");s.onerror=()=>o(s.error);const r=s.objectStore(t).delete(i);r.onerror=r.onsuccess=));yield n}catch(e){throw new s.default({message:`Failed to delete object, ${e.message}.`,type:s.default.ERROR_TYPE.IndexedDBError,details:{storeName:t,key:i}})}}))},8267:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=o=new class{constructor(){this._locks={}}acquireLock(e){return i(this,void 0,void 0,(function*(){for(;this._locks[e];)yield n(200);return this._locks[e]=!0,!0}))}t.default=o},7607:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(9340),o={debug:(...e)=>{let t="undefined"==typeof window;"undefined"!=typeof window&&"undefined"!=typeof sessionStorage&&sessionStorage.getItem(`${n.storageName}Debug`)&&(t=!0),t&&console.debug("PushEngage:",...e)},info:(...e)=>{console.info("PushEngage:",...e)},warn:(...e)=>{console.warn("PushEngage:",...e)},error:;t.default=o},1625:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=new class{constructor(){this._stores={}}_resolveKeyPath(e){return e.split(".").reduce(((e,t)=>null===e||void 0===e[t]?null:e[t]),this._stores)}et(e,t){const i=e.split("."),n=i.pop();i.reduce(((e,t)=>(e[t]&&"object"==typeof e[t]||(e[t]={}),e[t])),this._stores)[n]=t}delete(e){const t=e.split("."),i=t.pop();i&&delete t.reduce(((e,t)=>e[t]?e[t]:{}),this._stores)[i]};t.default=i},3241:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSubdomainFromUrl=t.detectSiteType=t.detectProtocol=t.isLocalhost=t.getQueryParamsFromUrl=t.addQueryParamsToUrl=t.safeDecodeURIComponent=t.getValueFromUrlByKey=t.getUrlObject=void 0,t.getUrlObject=e=>{var t;const i=e=>{if("function"!=typeof e||"URL"!==e.name)return!1;let t;try{t=new e("http://example.com")}catch(e){return!1}return"search"in t&&"searchParams"in t&&"origin"in t&&"host"in t};if(i(URL))try{return new URL(e)}catch(e){return null}else try{const n=document.createElement("iframe");document.body.appendChild(n);const o=null===(t=n.contentWindow)||void 0===t?void 0:t.URL;return document.body.removeChild(n),i(o)?new o(e):null}catch(e){return null}},t.getValueFromUrlByKey=(e,i)=>{try{const n=(0,t.getUrlObject)(i);if(!n)return;return new URLSearchParams(n.search).get(e)||void 0}catch(e){return}},t.safeDecodeURIComponent=(e,t=0)=>{const i=String(e).split(/(%(?:d0|d1)%.{2})/);let n="";for(let e=0,o=i.length;e<o;e++){let o;try{o=decodeURIComponent(i[e])}catch(n){o=t?i[e].replace(/%(?!\d+)/g,"%25"):i[e]}n+=o}return n},t.addQueryParamsToUrl=(e,i)=>{const n=(0,t.getUrlObject)(e);return n?(Object.keys(i).forEach((e=>{void 0!==i[e]&&n.searchParams.append(e,i[e])})),n.toString()):e},t.getQueryParamsFromUrl=e=>{const t={},i=e.indexOf("?");if(-1!==i){const n=e.substring(i+1).split("&");for(let e=0;e<n.length;e++){const i=n[e].split("="),o=decodeURIComponent(i[0]),s=decodeURIComponent(i[1]||"");t[o]=s}}return t},t.isLocalhost=()=>{const e=location.hostname;return Boolean("localhost"===e||"[::1]"===e||e.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))},t.detectProtocol=e=>{if(!e)return location.protocol.slice(0,-1);const t=e.match(/^(\w+):\/\//);return t?t[1]:"http"},t.detectSiteType=()=>(0,t.isLocalhost)()?"https":(0,t.detectProtocol)(),t.getSubdomainFromUrl=e=>{try{const i=(0,t.getUrlObject)(e);if(!i)return null;const n=i.hostname.split(".");return n.length>=3?n[0]:null}catch(e){return null}}},1041:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addClickEventListenerForHandleSubscription=void 0;const s=o(i(7607)),r=i(1791),a=i(2004),d=i(3110),c=i(9851);t.addClickEventListenerForHandleSubscription=()=>{const e=(0,c.getAppData)(),t=e.siteSettings.optin_subscription_trigger;if(!t)return;let i=!1;window.addEventListener("click",(o=>n(void 0,void 0,void 0,(function*(){try{if(i)return;i=!0;const n=t.selectors,r=o.target;if(r&&"closest"in r)for(let t=0,i=n.length;t<i;t+=1){const i=n[t].replace(/[ ]/gi,".");if(r.closest("."+i)||r.closest("#"+i)){try{yield(0,a.initializeSubscription)({triggerFrom:"onClick",options:{clickOptions:{isServiceWorkerAvailable:(0,d.isServiceWorkerAvailable)({optInSetting:e.siteSettings.optin_settings})}}})}catch(e){s.default.error(e.message)}s.default.debug("The subscription process has been completed on button click.");break}}}catch(t){s.default.error(t.message),(0,r.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}finally{i=!1}}))))}},2326:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addMessageEventListener=void 0;const s=o(i(4182)),r=i(8648),a=o(i(3321)),d=o(i(7607)),c=i(9892),l=i(1730),u=i(9851),g=o(i(1625));t.addMessageEventListener=()=>{const e=(0,u.getAppData)();window.addEventListener("message",(t=>n(void 0,void 0,void 0,(function*(){try{const i=t.data;if("PushEngage"!==i.source||i.siteId!==e.site.site_id)return;if(d.default.debug("The message has been received from the subdomain."),"error"in i)return void s.default.trigger("notificationPermissionReceivedFromSubDomain",{error:i.error});const n=g.default.get("subscriptionOnSubdomain")||{},o=n.optInType;if(!o)throw new a.default({message:"Opt-in type is not available.",type:"NotFoundException",details:{siteId:e.site.site_id}});if("prompt"in i)return void s.default.trigger("permissionPrompt",{optInType:n.widgetOptInType||o,prompt:"native",state:"displayed"});s.default.trigger("permissionPrompt",{optInType:n.widgetOptInType||o,prompt:"native",state:"granted"===i.permission?"allow":"close"}),yield(0,r.processNotificationPermission)({optInType:o,permissionData:{permission:i.permission,subscription:i.subscription},siteSettings:e.siteSettings,site:e.site,options:{isSubDomain:!0,tokenRefresh:i.tokenRefresh,segment:n.segment,widgetOptInType:n.widgetOptInType}}),s.default.trigger("notificationPermissionReceivedFromSubDomain",{permission:i.permission});const u="default"===i.permission&&(0,l.isAllSubscriptionOptInClosed)(e.siteSettings.optin_settings)?"denied":i.permission;s.default.trigger("notificationPermissionReceived",{permission:u,subscriberId:(0,c.getSubscriberIdFromStorage)()||void 0,isPermissionChanged:!0})}catch(e){d.default.debug(e),s.default.trigger("notificationPermissionReceivedFromSubDomain",{error:{message:e.message,name:e.name,type:e.type}})}}))))}},7328:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.processFailedAnalytics=void 0;const n=i(1734);t.processFailedAnalytics=,7704:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isPushNotificationSupported=t.handlePushEvent=void 0;const o=n(i(7607)),s=i(2471),r=i(1920);t.handlePushEvent=(...e)=>{for(let t=0;t<e.length;t++){const i=e[t];if("function"==typeof i)try{i()}catch(e){o.default.error(e)}}},t.isPushNotificationSupported=()=>new Promise((e=>{(0,s.isPushNotificationSupported)()&&(0,r.isBrowser)()||e(!1),(0,r.isPrivateBrowser)().then(().catch(()}))},6293:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addSdkEventListeners=void 0;const o=n(i(4182)),s=i(8405),r=i(4014),a=n(i(7607));t.addSdkEventListeners=()=>{o.default.on("notificationPermissionReceived",(e=>{try{const{subscriberId:t,isPermissionChanged:i}=e;if(i&&t){const e=new CustomEvent("PushEngage.onSubscriptionChange",{detail:{subscriber_id:t}});window.dispatchEvent(e)}}catch(e){a.default.error(e.message)}})),o.default.on("permissionPrompt",(e=>{try{const{prompt:t,optInType:i,state:n}=e,o=(0,s.getOptInNameByType)(i)||(0,s.getWidgetOptInNameByType)(i);switch(n){case"allow":{const e=new CustomEvent("PushEngage.permissionPrompt.allow",{detail:{prompt:t,name:o}});window.dispatchEvent(e);break}case"close":{const e=new CustomEvent("PushEngage.permissionPrompt.close",{detail:{prompt:t,name:o}});window.dispatchEvent(e);break}case"displayed":{const e=new CustomEvent("PushEngage.permissionPrompt.displayed",{detail:{prompt:t,name:o}});window.dispatchEvent(e);break}}}catch(e){a.default.error(e.message)}})),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",(e=>{const t=e.data;if(t&&(0,r.isObject)(t))switch(t.eventName){case"PushEngage.notification.displayed":case"PushEngage.notification.click":case"PushEngage.notification.close":window.dispatchEvent(new CustomEvent(t.eventName,{detail:t.data}))}}))}},6259:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.showPermissionPrompt=t.removeSubscriptionManagementWidget=t.showSubscriptionManagementWidget=t.automatedNotification=t.getPermission=t.unsubscribe=t.showNativePermissionPrompt=t.addAlert=t.sendTriggerEvent=t.sendGoal=t.removeAttributes=t.setAttributes=t.addAttributes=t.getAttributes=t.getSubscriber=t.getSubscriberId=t.setProfileId=t.removeSegment=t.addSegmentWithDuration=t.addSegment=void 0;const d=a(i(7607)),c=i(9892),l=s(i(3502)),u=s(i(2004)),g=s(i(7423)),p=s(i(953)),b=i(3168),f=s(i(7353)),v=s(i(6206)),m=s(i(5869)),_=a(i(4182)),h=i(3110),y=a(i(3321)),w=i(4014),S=i(1730),I=s(i(1860)),P=i(9851),E=i(5021),O=i(9340);function k(e){d.default.debug(`Initialize the ${e} method.`)}t.addSegment=e=>{k("addSegment");const t=(0,P.getAppData)();return new Promise(((i,n)=>{const o=(0,c.getSubscriberIdFromStorage)();if(!o)return n(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));p.addSegmentToSubscriber({segment:e,subscriberId:o,siteId:t.site.site_id}).then((()=>i({message:"Segment added successfully."}))).catch(n)}))},t.addSegmentWithDuration=e=>{k("addSegmentWithDuration");const t=(0,P.getAppData)();return new Promise(((i,n)=>{const o=(0,c.getSubscriberIdFromStorage)();if(!o)return n(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));p.addSegmentWithDurationToSubscriber({segment:e,subscriberId:o,siteId:t.site.site_id}).then((()=>i({message:"Segment added successfully."}))).catch(n)}))},t.removeSegment=e=>{k("removeSegment");const t=(0,P.getAppData)();return new Promise(((i,n)=>{const o=(0,c.getSubscriberIdFromStorage)();if(!o)return n(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));p.removeSegmentFromSubscriber({segment:e,subscriberId:o,siteId:t.site.site_id}).then((()=>i({message:"Segment removed successfully."}))).catch(n)}))},t.setProfileId=e=>{k("setProfileId");const t=(0,P.getAppData)();return new Promise(((i,n)=>{const o=(0,c.getSubscriberIdFromStorage)();if(!o)return n(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));(0,b.setProfileIdToSubscriber)({profileId:e,subscriberId:o,siteId:t.site.site_id}).then((()=>i({message:"Profile ID set successfully"}))).catch(n)}))},t.getSubscriberId=()=>(k("getSubscriberId"),new Promise(()),t.getSubscriber=()=>(k("getSubscriber"),new Promise(((e,t)=>{const i=(0,c.getSubscriberIdFromStorage)();if(!i)return t(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));const n={subscriber_id:i};l.getSubscriberData(i).then((t=>{e(Object.assign(Object.assign({},n),(e=>{if(!e)return{};const t=(0,w.omit)(e,["vapid_public_key","user_agent","device_type","trigger_status","ts_created","host","has_unsubscribed"]);return Object.assign(Object.assign({},t),{browser:e.device_type,automated_notification:!!e.trigger_status,subscription_at:e.ts_created,attributes:e.attributes||{},segments:e.segments||[]})})(t)))})).catch(t)}))),t.getAttributes=()=>(k("getAttributes"),new Promise(((e,t)=>{const i=(0,c.getSubscriberIdFromStorage)();if(!i)return t(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));g.getAttributes(i).then(e).catch(t)}))),t.addAttributes=e=>(k("addAttributes"),new Promise(((t,i)=>{const n=(0,c.getSubscriberIdFromStorage)();if(!n)return i(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));g.addAttributes(n,e).then((()=>t({message:"Attributes added successfully."}))).catch(i)}))),t.setAttributes=e=>(k("setAttributes"),new Promise(((t,i)=>{const n=(0,c.getSubscriberIdFromStorage)();if(!n)return i(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));g.setAttributes(n,e).then((()=>t({message:"Attributes replaced successfully."}))).catch(i)}))),t.removeAttributes=e=>(k("removeAttributes"),new Promise(((t,i)=>{const n=(0,c.getSubscriberIdFromStorage)();if(!n)return i(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));g.removeAttributes(n,e).then((()=>t({message:"Attribute removed successfully."}))).catch(i)}))),t.sendGoal=e=>{k("sendGoal");const t=(0,P.getAppData)();return new Promise(((i,n)=>{const o=(0,c.getSubscriberIdFromStorage)();if(!o)return n(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));f.sendGoal({goal:e,subscriberId:o,siteId:t.site.site_id}).then((()=>i({message:"Goal send successfully."}))).catch(n)}))},t.sendTriggerEvent=e=>{k("sendTriggerEvent");const t=(0,P.getAppData)();return new Promise(((i,n)=>{const o=(0,c.getSubscriberIdFromStorage)();return o?t.hasBrowserAbandonment||t.hasCartAbandonment||t.hasCustomTriggerCampaign?void v.sendTriggerEvent({trigger:e,subscriberId:o,siteId:t.site.site_id}).then(().catch(n):n(new Error("Trigger campaign is not enabled in your site")):n(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}))}))},t.addAlert=e=>{k("addAlert");const t=(0,P.getAppData)();return new Promise(((i,n)=>{const o=(0,c.getSubscriberIdFromStorage)();return o?t.hasPriceDropAlert||t.hasBackInStockAlert?void m.addAlert({alert:e,subscriberId:o,siteId:t.site.site_id}).then((()=>i({message:("price_drop"===e.type?"Price Drop":"Back in Stock")+" alert send successfully."}))).catch(n):n(new Error("Alert campaign is not enabled in your site.")):n(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}))}))},t.showNativePermissionPrompt=e=>r(void 0,void 0,void 0,(function*(){k("showNativePermissionPrompt");const i=(0,P.getAppData)();return new Promise(((n,o)=>{const s=e=>r(void 0,void 0,void 0,(function*(){try{const{permission:i,subscriberId:o,isPermissionChanged:s}=e,r={is_permission_changed:s||!1,permission:i};if(o){const e=yield(0,t.getSubscriber)();r.subscriber_id=o,r.geo_info={city:e.city,country:e.country,state:e.state}}n(r),d.default.debug("The subscription process has been completed on button click.")}catch(e){d.default.error(e.message)}}));_.default.on("notificationPermissionReceived",s,{once:!0});let a=null==e?void 0:e.isServiceWorkerAvailable;const c=(0,h.getSubscriptionOptIns)(i.siteSettings.optin_settings);(0,w.isUndefined)(a)&&(a=!c.length||(0,h.isServiceWorkerAvailabilityEnabled)(i.siteSettings.optin_settings)),u.initializeSubscription({triggerFrom:"onClick",options:{clickOptions:Object.assign(Object.assign({},e),{isServiceWorkerAvailable:a})}}).then().catch((e=>{_.default.remove("notificationPermissionReceived",s),o(e),d.default.error(e)}))}))})),t.unsubscribe=()=>{k("unsubscribe");const e=(0,P.getAppData)();return new Promise(((t,i)=>{const n=(0,c.getSubscriberIdFromStorage)();if(!n)return i(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));(0,S.unsubscribeSubscription)({subscriberId:n,siteId:e.site.site_id,serviceWorkerSetting:e.siteSettings.service_worker}).then((()=>{_.default.trigger("notificationPermissionReceived",{permission:"denied",isPermissionChanged:!0}),t({message:"User is unsubscribed successfully."})})).catch(i)}))},t.getPermission=()=>r(void 0,void 0,void 0,(function*(){k("getPermission");const e=(0,P.getAppData)(),{optin_settings:t,safari_options:i}=e.siteSettings,n=yield(0,S.getUserSubscriptionState)({optInSetting:t,safariWebPushPackageSetting:i});return"subscribed"===n?Promise.resolve("granted"):"default"===n?Promise.resolve("default"):Promise.resolve("denied")})),t.automatedNotification=({status:e})=>{k("automatedNotification");const t=(0,P.getAppData)();return new Promise(((i,n)=>{const o=(0,c.getSubscriberIdFromStorage)();if(!o)return n(new y.default({message:y.default.ERROR_MESSAGE.UserNotSubscribed,name:y.default.ERROR_NAME.UserNotSubscribed}));l.updateAutomatedNotificationStatus({status:e,subscriberId:o,siteId:t.site.site_id}).then(().catch(n)}))},t.showSubscriptionManagementWidget=()=>r(void 0,void 0,void 0,(function*(){return k("showSubscriptionManagementWidget"),new Promise(((e,t)=>{I.showSubscriptionManagementWidget().then((t=>e({message:t}))).catch(t)}))})),t.removeSubscriptionManagementWidget=()=>r(void 0,void 0,void 0,(function*(){return k("removeSubscriptionManagementWidget"),new Promise(((e,t)=>{I.removeSubscriptionManagementWidget().then(().catch(t)}))})),t.showPermissionPrompt=()=>r(void 0,void 0,void 0,(function*(){k("showPermissionPrompt");const e=(0,P.getAppData)(),t=yield(0,E.getGeoInfo)({isEu:e.site.is_eu});return new Promise(((e,i)=>{const n=i=>{try{const{permission:n,subscriberId:o,isPermissionChanged:s}=i,r={permission:n,is_permission_changed:s||!1};"granted"===n&&o&&(r.subscriber_id=o,r.geo_info={country:t.country,state:t.state,city:t.city}),e(r),d.default.debug("The subscription process has been completed by showPermissionPrompt.")}catch(e){d.default.error(e.message)}};_.default.on("notificationPermissionReceived",n,{once:!0}),u.initializeSubscription({triggerFrom:"onInit",options:{initOptions:{forceInit:!0}}}).then().catch((e=>{_.default.remove("notificationPermissionReceived",n),i(e),d.default.error(e)}))}))})),t.debug=e=>{const t=`${O.storageName}Debug`;e||void 0===e?sessionStorage.setItem(t,"true"):sessionStorage.removeItem(t)}},2837:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getV1SDKMethods=void 0;const o=n(i(7607));function s(e){o.default.debug(`Initialize the ${e} v1 method.`)}t.getV1SDKMethods=()=>({subscribe:(e,t)=>{s("subscribe"),window._peq=window._peq||[],window._peq.push(["init",e,t])},isSubscribed:e=>{s("isSubscribed"),window._peq=window._peq||[],window._peq.push(["is-subscribed",e])},addSubscriberToSegment:(e,t)=>{s("addSubscriberToSegment"),window._peq=window._peq||[],window._peq.push(["add-to-segment",e,t])},removeSubscriberFromSegment:(e,t)=>{s("removeSubscriberFromSegment"),window._peq=window._peq||[],window._peq.push(["remove-to-segment",e,t])},addProfileId:(e,t)=>{s("addProfileId"),window._peq=window._peq||[],window._peq.push(["add-to-profile",e,t])},addSubscriberToDynamicSegment:(e,t,i)=>{s("addSubscriberToDynamicSegment"),window._peq=window._peq||[],window._peq.push(["add-to-dynamic-segment",e,t,i])},addSegmentsInStorage:)},2572:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.mergeConfig=t.removeSubscriptionManagementWidget=t.showSubscriptionManagementWidget=t.isSubscribed=t.initializeSubscription=t.initializeSubscriptionCallback=t.getPermission=t.unsubscribe=t.showNativePermissionPrompt=t.getSubscriber=t.sendGoal=t.addAlert=t.sendTriggerEvent=t.removeAttributes=t.setAttributes=t.addAttributes=t.getAttributes=t.setProfileId=t.removeSegment=t.addSegmentWithDuration=t.addSegment=void 0;const d=s(i(6259)),c=a(i(7607)),l=i(9892),u=a(i(4182)),g=i(1730),p=i(3502),b=i(4014),f=i(3241),v=i(9851),m=e=>{const t={};if("UserNotSubscribed"===e.name)Object.assign(t,{statuscode:22,message:e.message});else{const i={statuscode:0,message:e.message};e.details&&Object.assign(i,{details:e.details}),Object.assign(t,i)}return t},_=e=>"function"==typeof e||(c.default.warn("Callback is not a function"),!1),h=(e,t)=>{const i={};if("granted"===e){const e=(0,l.getSubscriberIdFromStorage)(),n={};t.country&&(n.country=t.country),t.state&&(n.state=t.state),t.city&&(n.city=t.city);const o={subscriber_hash:e,subscriber_id:e};(0,b.isEmptyObject)(n)||Object.assign(o,{geoInfo:n,geo_info:n}),Object.assign(i,{statuscode:1,data:o,message:"User subscribed successfully.",status:"SUBSCRIBED",subscriber_hash:e})}else"denied"===e?Object.assign(i,{statuscode:2,status:"DENIED",message:"User denied push notification."}):"closed"===e?Object.assign(i,{statuscode:3,status:"CLOSED",message:"User closed subscription Opt-in."}):Object.assign(i,{statuscode:22,status:"DEFAULT",message:"User is not subscribed."});return i};function y(e){c.default.debug(`Initialize the ${e} v2 method.`)}t.addSegment=({segment:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("addSegment");const i={};try{const t=yield d.addSegment(e);Object.assign(i,Object.assign({statuscode:1},t))}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.addSegmentWithDuration=({segment:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("addSegmentWithDuration");const i={};try{const t=yield d.addSegmentWithDuration(e);Object.assign(i,Object.assign({statuscode:1},t))}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.removeSegment=({segment:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("removeSegment");const i={};try{const t=yield d.removeSegment(e);Object.assign(i,Object.assign({statuscode:1},t))}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.setProfileId=({profileId:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("setProfileId");const i={};try{const t=yield d.setProfileId(e);Object.assign(i,Object.assign({statuscode:1},t))}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.getAttributes=e=>r(void 0,void 0,void 0,(function*(){y("getAttributes");const t={};try{const e=yield d.getAttributes();Object.assign(t,{statuscode:1,data:e})}catch(e){Object.assign(t,m(e))}e&&_(e)&&e(t)})),t.addAttributes=({attributes:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("addAttributes");const i={};try{const t=yield d.addAttributes(e),n=(0,l.getSubscriberIdFromStorage)(),o=yield(0,p.getSubscriberData)(n);Object.assign(i,Object.assign({statuscode:1,data:(null==o?void 0:o.attributes)||{}},t))}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.setAttributes=({attributes:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("setAttributes");const i={};try{const t=yield d.setAttributes(e),n=(0,l.getSubscriberIdFromStorage)(),o=yield(0,p.getSubscriberData)(n);Object.assign(i,Object.assign({statuscode:1,data:(null==o?void 0:o.attributes)||{}},t))}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.removeAttributes=({attributeNames:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("removeAttributes");const i={};try{const t=yield d.removeAttributes(e),n=(0,l.getSubscriberIdFromStorage)(),o=yield(0,p.getSubscriberData)(n);Object.assign(i,Object.assign({statuscode:1,data:(null==o?void 0:o.attributes)||{}},t))}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.sendTriggerEvent=({trigger:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("sendTriggerEvent");const i={};try{const t=yield d.sendTriggerEvent(e);Object.assign(i,Object.assign({statuscode:1},t))}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.addAlert=({alert:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("addAlert");const i={};try{const t=yield d.addAlert(e);Object.assign(i,Object.assign({statuscode:1},t))}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.sendGoal=({goal:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("sendGoal");const i={};try{const t=yield d.sendGoal(e);Object.assign(i,Object.assign({statuscode:1},t))}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.getSubscriber=({options:e,callback:t})=>r(void 0,void 0,void 0,(function*(){var i;y("getSubscriber");const n={};try{const t=yield d.getSubscriber(),o=Object.assign(Object.assign({},t),{subscriber_hash:t.subscriber_id});if(o.device&&(o.device_type=o.browser),o.subscription_at&&(o.ts_created=o.subscription_at),o.subscription_url&&(o.host=null===(i=(0,f.getUrlObject)(o.subscription_url))||void 0===i?void 0:i.host),e&&(null==e?void 0:e.fields)&&Array.isArray(e.fields)&&e.fields.length>0){const t={};e.fields.forEach((),Object.assign(n,{statuscode:1,data:t})}else Object.assign(n,{statuscode:1,data:o})}catch(e){Object.assign(n,m(e))}t&&_(t)&&t(n)})),t.showNativePermissionPrompt=({segment:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("showNativePermissionPrompt");const i={};try{const t=yield d.showNativePermissionPrompt({segment:e});let n={};t.subscriber_id&&(n=yield d.getSubscriber());const o=h(t.permission,{city:n.city,country:n.country,state:n.state});Object.assign(i,o)}catch(e){Object.assign(i,m(e))}t&&_(t)&&t(i)})),t.unsubscribe=({callback:e})=>r(void 0,void 0,void 0,(function*(){y("unsubscribe");const t={};try{const e=yield d.unsubscribe();Object.assign(t,Object.assign({statuscode:1},e))}catch(e){Object.assign(t,m(e))}e&&_(e)&&e(t)})),t.getPermission=({callback:e})=>r(void 0,void 0,void 0,(function*(){y("getPermission");const t=(0,v.getAppData)(),i={};try{let e=yield d.getPermission();(0,g.isAllSubscriptionOptInClosed)(t.siteSettings.optin_settings)&&(e="closed");let n={};"granted"===e&&(n=yield d.getSubscriber());const o=h(e,{city:n.city,country:n.country,state:n.state});Object.assign(i,o)}catch(e){Object.assign(i,m(e))}e&&_(e)&&e(i)})),t.initializeSubscriptionCallback=({callback:e})=>{y("initializeSubscriptionCallback");const t=(0,v.getAppData)();e&&_(e)&&u.default.on("notificationPermissionReceived",(i=>r(void 0,void 0,void 0,(function*(){try{const{permission:n,isPermissionChanged:o,subscriberId:s}=i;if(!o)return;let r=n;(0,g.isAllSubscriptionOptInClosed)(t.siteSettings.optin_settings)&&(r="closed");let a={};s&&(a=yield d.getSubscriber());const c=h(r,{city:a.city,country:a.country,state:a.state});e(c)}catch(e){c.default.error(e.message)}}))),{once:!0})},t.initializeSubscription=({segment:e,callback:t})=>r(void 0,void 0,void 0,(function*(){y("initializeSubscription");const i=(0,v.getAppData)(),n={};try{const t=yield d.showPermissionPrompt(),{permission:o,is_permission_changed:s,subscriber_id:r}=t;if("granted"===o&&e&&(Array.isArray(e)||"string"==typeof e))try{yield d.addSegment(e)}catch(e){c.default.error(e.message)}if(!s)return;let a=o;(0,g.isAllSubscriptionOptInClosed)(i.siteSettings.optin_settings)&&(a="closed");let l={};r&&(l=yield d.getSubscriber());const u=h(a,{city:l.city,country:l.country,state:l.state});Object.assign(n,u)}catch(e){Object.assign(n,m(e))}t&&_(t)&&t(n)})),t.isSubscribed=({callback:e})=>r(void 0,void 0,void 0,(function*(){if(y("isSubscribed"),"function"==typeof e)try{const t=yield d.getPermission();e("granted"===t)}catch(e){c.default.error(e.message)}else c.default.warn("Callback is not a function")})),t.showSubscriptionManagementWidget=({callback:e})=>r(void 0,void 0,void 0,(function*(){y("showSubscriptionManagementWidget");const t={};try{const e=yield d.showSubscriptionManagementWidget();Object.assign(t,Object.assign({statuscode:1},e))}catch(e){Object.assign(t,m(e))}e&&_(e)&&e(t)})),t.removeSubscriptionManagementWidget=({callback:e})=>r(void 0,void 0,void 0,(function*(){y("removeSubscriptionManagementWidget");const t={};try{const e=yield d.removeSubscriptionManagementWidget();Object.assign(t,Object.assign({statuscode:1},e))}catch(e){Object.assign(t,m(e))}e&&_(e)&&e(t)})),t.mergeConfig=({config:e})=>{var t,i,n,o,s,r,a;y("mergeConfig");const d=(0,v.getAppData)();if(!(0,b.isObject)(e))return;const c=e.subscription_management_widget,l=d.siteSettings.subscription_management_widget;(0,b.isObject)(c)&&l&&((null===(t=c.trigger_button)||void 0===t?void 0:t.enabled)&&l.trigger_button||delete c.trigger_button,(null===(i=c.segment_preference)||void 0===i?void 0:i.enabled)&&l.segment_preference||delete c.segment_preference,(null===(n=c.unsubscribe_options)||void 0===n?void 0:n.enabled)&&l.unsubscribe_options||delete c.unsubscribe_options,(null===(o=c.personal_notification_options)||void 0===o?void 0:o.enabled)&&l.personal_notification_options||delete c.personal_notification_options,(0,b.deepMerge)(l,c),0!=(null===(s=c.segment_preference)||void 0===s?void 0:s.enabled)&&Array.isArray(null===(r=c.segment_preference)||void 0===r?void 0:r.segments)&&l.segment_preference&&(l.segment_preference.segments=null===(a=c.segment_preference)||void 0===a?void 0:a.segments))}},6496:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initializeSDK=void 0;const a=r(i(7607)),d=s(i(6259)),c=s(i(2572)),l=i(6293),u=i(2837),g=i(4014),p=i(9851),b=i(7704),f=(e,...t)=>{for(let i=0;i<t.length;i++){const n=t[i];if(Array.isArray(n)){const[t,...i]=n;switch(t){case"add-to-segment":c.addSegment({segment:i[0],callback:i[1]});break;case"add-to-dynamic-segment":Array.isArray(i[0])?c.addSegmentWithDuration({segment:i[0],callback:i[1]}):c.addSegmentWithDuration({segment:{name:i[0],duration:i[1]},callback:i[2]});break;case"remove-to-segment":case"remove-segment":c.removeSegment({segment:i[0],callback:i[1]});break;case"add-to-profile":c.setProfileId({profileId:i[0],callback:i[1]});break;case"get-attributes":c.getAttributes(i[0]);break;case"add-attributes":c.addAttributes({attributes:i[0],callback:i[1]});break;case"set-attributes":c.setAttributes({attributes:i[0],callback:i[1]});break;case"remove-attributes":c.removeAttributes({attributeNames:i[0],callback:i[1]});break;case"add-to-trigger":c.sendTriggerEvent({trigger:i[0],callback:i[1]});break;case"add-alert":c.addAlert({alert:i[0],callback:i[1]});break;case"goal":c.sendGoal({goal:i[0],callback:i[1]});break;case"get-subscriber":"function"==typeof i[0]?c.getSubscriber({callback:i[0]}):c.getSubscriber({options:i[0],callback:i[1]});break;case"subscribe-on-click":case"subscribe":c.showNativePermissionPrompt({segment:i[0],callback:i[1]});break;case"unsubscribe-on-click":c.unsubscribe({callback:i[0]});break;case"subscriber-status":c.getPermission({callback:i[0]});break;case"is-subscribed":c.isSubscribed({callback:i[0]});break;case"show-subscription-management-widget":c.showSubscriptionManagementWidget({callback:i[0]});break;case"remove-subscription-management-widget":c.removeSubscriptionManagementWidget({callback:i[0]});break;case"init":e.disabledDefaultPrompt?c.initializeSubscription({segment:i[0],callback:i[1]}):c.initializeSubscriptionCallback({callback:i[1]});break;case"config":{const e=i[0];c.mergeConfig({config:e});break}default:a.default.warn("Event not supported",t)}}}},v=()=>Object.assign(Object.assign({},d),{push:b.handlePushEvent,isPushNotificationSupported:b.isPushNotificationSupported,getInitOptions:p.getSDKInitOptions,getAppConfig:p.getAppData});t.initializeSDK=({commands:e,legacyCommands:t})=>{const i=(0,p.getSDKInitOptions)(),n=v();window.PushEngage=Object.freeze(n),e&&Array.isArray(e)&&(0,b.handlePushEvent)(...e),window._peq=Object.freeze({push:f.bind(null,i)}),t&&Array.isArray(t)&&f(i,...t),(0,g.isUndefined)(window._pe)&&(window._pe=Object.freeze((0,u.getV1SDKMethods)())),(0,l.addSdkEventListeners)()}},1919:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addEventListenerForAddSegment=void 0;const s=o(i(4182)),r=o(i(7607)),a=i(1791),d=i(3110),c=i(953),l=i(9851);t.addEventListenerForAddSegment=()=>{const e=(0,l.getAppData)(),t=(0,l.getSDKInitOptions)();s.default.on("notificationPermissionReceived",(i=>n(void 0,void 0,void 0,(function*(){try{const{permission:n,subscriberId:o}=i;if("granted"!==n)return;if(!o)throw new Error("The subscriber ID is not available when the notification permission is granted.");let s=(0,d.getSegmentNamesFromRules)(e.segments);if(Array.isArray(t.segment)?s=[...s,...t.segment]:t.segment&&(s=[...s,t.segment]),0===s.length)return;try{yield(0,c.addSegmentToSubscriber)({subscriberId:o,segment:s,siteId:e.site.site_id})}catch(e){r.default.error(e.message)}}catch(t){r.default.error(t.message),(0,a.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}}))))}},8343:function(e,t,i){var n=this&&this.__createBinding||(Object.create?,o=this&&this.__setModuleDefault||(Object.create?,s=this&&this.__importStar||r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addEventListenerForShopifyCampaign=void 0;const d=a(i(4182)),c=a(i(7607)),l=i(1791),u=s(i(9432)),g=i(5827),p=i(7330),b=i(9892),f=i(3641),v=i(6206),m=i(9838),_=i(5869),h=i(2689),y=i(4014),w=i(9851);t.addEventListenerForShopifyCampaign=()=>{const e=(0,w.getAppData)();if(!(0,w.getSDKInitOptions)().isShopifySite)return;const t="pushengage-campaign-alert-widget";let i=!1;const n=t=>r(void 0,void 0,void 0,(function*(){var i,n,o;if(!(null===(i=window.Shopify)||void 0===i?void 0:i.shop))return;const s=(0,b.getShopifyCampaignDataFromStorage)(),r=yield(0,p.getCartItems)();if(0===r.length)return void(0!==(null===(n=null==s?void 0:s.cartVariantIds)||void 0===n?void 0:n.length)&&(yield Promise.all([(0,v.sendTriggerEvent)({subscriberId:t,trigger:{campaign_name:`browseabandonment${e.site.site_id}`,event_name:"add-to-cart"},siteId:e.site.site_id}),(0,v.sendTriggerEvent)({subscriberId:t,trigger:{campaign_name:`cartabandonment${e.site.site_id}`,event_name:"checkout"},siteId:e.site.site_id})]),(0,b.setShopifyCampaignDataToStorage)({cartVariantIds:[],browseVariantIds:[]})));const a=[],d=[];for(let i=0;i<r.length;i++){const n=r[i];if(null===(o=null==s?void 0:s.cartVariantIds)||void 0===o?void 0:o.includes(n.variant_id)){c.default.debug(`Cart Abandonment campaign has already been processed for variant id ${n.variant_id}.`);continue}const l=yield u.getImageUrlsFromCartItem(n),g={campaign_name:`cartabandonment${e.site.site_id}`,event_name:"add-to-cart",title:{productname:(0,f.stripTagsAndDecodeEntity)(n.title)},message:{price:u.convertPriceToFloat(n.price)},notification_url:{notificationurl:"https://"+window.Shopify.shop+"/cart"},notification_image:{imageurl:e.site.site_image||l.imageUrl||""},big_image:{bigimageurl:l.largeImageUrl||""}};a.push((0,v.sendTriggerEvent)({subscriberId:t,trigger:g,siteId:e.site.site_id})),d.push(n.variant_id)}yield Promise.all(a),d.length&&(yield(0,v.sendTriggerEvent)({subscriberId:t,trigger:{campaign_name:`browseabandonment${e.site.site_id}`,event_name:"add-to-cart"},siteId:e.site.site_id}),(0,b.setShopifyCampaignDataToStorage)({cartVariantIds:[...(null==s?void 0:s.cartVariantIds)||[],...d],browseVariantIds:[]}),c.default.debug(`Cart Abandonment campaign triggered successfully with variant ids ${d}.`))}));d.default.on("notificationPermissionReceived",(o=>r(void 0,void 0,void 0,(function*(){try{const{permission:s,subscriberId:a}=o;if("granted"!==s)return void(0,f.removeElement)(t);if(!a)throw new Error("The subscriber ID is not available when the notification permission is granted.");e.hasCartAbandonment&&(yield(t=>r(void 0,void 0,void 0,(function*(){var i,n;const o=null===(i=window.Shopify)||void 0===i?void 0:i.checkout;if(!(o&&o.total_price&&o.order_id))return;const s=(0,b.getShopifyCampaignDataFromStorage)();0!==(null===(n=null==s?void 0:s.cartVariantIds)||void 0===n?void 0:n.length)&&(yield Promise.all([(0,v.sendTriggerEvent)({subscriberId:t,trigger:{campaign_name:`browseabandonment${e.site.site_id}`,event_name:"add-to-cart"},siteId:e.site.site_id}),(0,v.sendTriggerEvent)({subscriberId:t,trigger:{campaign_name:`cartabandonment${e.site.site_id}`,event_name:"checkout",data:{revenue:o.total_price}},siteId:e.site.site_id})]),(0,b.setShopifyCampaignDataToStorage)({cartVariantIds:[],browseVariantIds:[]}),c.default.debug("Cart and Browse Abandonment campaigns cancelled successfully."))})))(a),yield n(a),(t=>{if(i)return;if(i=!0,"product"!==u.getPageType())return;let o=!1;const s=setInterval((()=>r(void 0,void 0,void 0,(function*(){if(!o){o=!0;try{yield n(t)}catch(t){c.default.error(t.message),(0,l.sendErrorLog)("sdk",t,{siteId:e.site.site_id}),clearInterval(s)}o=!1}}))),2e4)})(a)),e.hasBrowserAbandonment&&(yield(t=>r(void 0,void 0,void 0,(function*(){var i,n;if("product"!==u.getPageType())return;const o=(0,g.getProductTitleFromUrl)();if(!o)return;const s=yield(0,p.getProductByTitle)(o);if(!s)return;const r=u.getSelectedVariantId(),a=u.filterVariantFromVariantId(s,r);if(!a)return;const d=(0,b.getShopifyCampaignDataFromStorage)();if(d&&((null===(i=d.browseVariantIds)||void 0===i?void 0:i.includes(a.id))||(null===(n=d.cartVariantIds)||void 0===n?void 0:n.includes(a.id))))return void c.default.debug(`Browse Abandonment campaign has already been processed for variant id ${a.id}.`);const l=yield u.getImageUrlsFromVariant(a);let m=l.largeImageUrl,_=l.imageUrl;if(!m){const e=yield u.getImageUrlsFromProduct(s);m=e.largeImageUrl,_=e.imageUrl}const h={campaign_name:`browseabandonment${e.site.site_id}`,event_name:"browse",title:{productname:(0,f.stripTagsAndDecodeEntity)(a.name)},message:{price:u.convertPriceToFloat(a.price)},notification_url:{notificationurl:location.href},notification_image:{imageurl:e.site.site_image||_||""},big_image:{bigimageurl:m||""}};yield(0,v.sendTriggerEvent)({subscriberId:t,trigger:h,siteId:e.site.site_id}),(0,b.setShopifyCampaignDataToStorage)({browseVariantIds:[...(null==d?void 0:d.browseVariantIds)||[],a.id]}),c.default.debug(`Browse Abandonment campaign triggered successfully with variant id ${a.id}.`)})))(a)),(e.hasPriceDropAlert||e.hasBackInStockAlert)&&(yield(i=>r(void 0,void 0,void 0,(function*(){if(!e.siteSettings.shopify_options)return;if((0,f.getElementById)(t))return;if("product"!==u.getPageType())return;const n=(0,g.getProductTitleFromUrl)();if(!n)return;const o=yield(0,p.getProductByTitle)(n);if(!o)return;const s=u.getSelectedVariantId(),a=u.filterVariantFromVariantId(o,s);if(!a)return;yield(t=>r(void 0,void 0,void 0,(function*(){const i=(0,b.getShopifyCampaignDataFromStorage)();if(i&&i.nextAlertSyncTime&&i.nextAlertSyncTime>(0,h.getUnixTime)())return void c.default.debug("Syncing alerts from server is not required.");const n=yield(0,_.getAlerts)({subscriberId:t,siteId:e.site.site_id});if(!n)return;const o=[],s=[];n.forEach((e=>{"price_drop"===e.type?o.push((0,y.toInteger)(e.variant_id)):"inventory"===e.type&&s.push((0,y.toInteger)(e.variant_id))})),(0,b.setShopifyCampaignDataToStorage)({priceDropVariantIds:o,backInStockVariantIds:s,nextAlertSyncTime:(0,h.getUnixTime)(1)})})))(i);const d=o.available?"price_drop":"inventory";if(e.hasPriceDropAlert&&"price_drop"===d){(0,m.addCampaignAlertWidget)({alertType:d,alert:e.siteSettings.shopify_options.alert_campaign,site:e.site,variantId:a.id});const n=document.getElementById(`${t}-allow-button`);null==n||n.addEventListener("click",(()=>r(void 0,void 0,void 0,(function*(){try{yield(({variant:t,product:i,subscriberId:n})=>r(void 0,void 0,void 0,(function*(){var o;const s=(0,b.getShopifyCampaignDataFromStorage)();if(null===(o=null==s?void 0:s.priceDropVariantIds)||void 0===o?void 0:o.includes(t.id))return void c.default.debug(`Price Drop Alert campaign has already been processed for variant id ${t.id}.`);const r=yield u.getImageUrlsFromVariant(t);let a=r.largeImageUrl,d=r.imageUrl;if(!a){const e=yield u.getImageUrlsFromProduct(i);a=e.largeImageUrl,d=e.imageUrl}const l={type:"price_drop",product_id:`${i.id}`,link:location.href,price:u.convertPriceToFloat(t.price),variant_id:`${t.id}`,alert_price:u.convertPriceToFloat(t.price),availability:"inStock",title:(0,f.stripTagsAndDecodeEntity)(t.name),image_link:e.site.site_image||d||"",big_image_link:a||""};yield(0,_.addAlert)({subscriberId:n,alert:l,siteId:e.site.site_id}),(0,b.setShopifyCampaignDataToStorage)({priceDropVariantIds:[...(null==s?void 0:s.priceDropVariantIds)||[],t.id]}),c.default.debug(`Price drop alert triggered successfully with variant ids ${t.id}.`)})))({variant:a,product:o,subscriberId:i})}catch(t){c.default.error(t.message),(0,l.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}}))))}else if(e.hasBackInStockAlert&&"inventory"===d){(0,m.addCampaignAlertWidget)({alertType:d,alert:e.siteSettings.shopify_options.alert_campaign,site:e.site,variantId:a.id});const n=document.getElementById(`${t}-allow-button`);null==n||n.addEventListener("click",(()=>r(void 0,void 0,void 0,(function*(){try{yield(({variant:t,product:i,subscriberId:n})=>r(void 0,void 0,void 0,(function*(){var o;const s=(0,b.getShopifyCampaignDataFromStorage)();if(null===(o=null==s?void 0:s.backInStockVariantIds)||void 0===o?void 0:o.includes(t.id))return void c.default.debug(`Back in Stock Alert campaign has already been processed for variant id ${t.id}.`);const r=yield u.getImageUrlsFromVariant(t);let a=r.largeImageUrl,d=r.imageUrl;if(!a){const e=yield u.getImageUrlsFromProduct(i);a=e.largeImageUrl,d=e.imageUrl}const l={type:"inventory",product_id:`${i.id}`,link:location.href,price:u.convertPriceToFloat(t.price),variant_id:`${t.id}`,alert_price:u.convertPriceToFloat(t.price),availability:"outOfStock",title:(0,f.stripTagsAndDecodeEntity)(t.name),image_link:e.site.site_image||d||"",big_image_link:a||""};yield(0,_.addAlert)({subscriberId:n,alert:l,siteId:e.site.site_id}),(0,b.setShopifyCampaignDataToStorage)({backInStockVariantIds:[...(null==s?void 0:s.backInStockVariantIds)||[],t.id]}),c.default.debug(`Back in Stock alert triggered successfully with variant ids ${t.id}.`)})))({variant:a,product:o,subscriberId:i})}catch(t){c.default.error(t.message),(0,l.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}}))))}})))(a))}catch(t){c.default.error(t.message),(0,l.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}}))))}},2047:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addEventListenerForSubscriberRecoveryWidget=void 0;const s=o(i(4182)),r=i(3641),a=o(i(7607)),d=i(1791),c=i(9288),l=i(4014),u=i(2004),g=i(3110),p=i(9340),b=i(9851);t.addEventListenerForSubscriberRecoveryWidget=()=>{const e=(0,b.getAppData)(),t="pushengage-subscriber-recovery-widget",{chicklet_settings:i}=e.siteSettings;if(!i)return;const o=()=>n(void 0,void 0,void 0,(function*(){try{(0,r.removeElement)(t),yield(0,u.initializeSubscription)({triggerFrom:"onClick",options:{clickOptions:{widgetOptInType:p.widgetOptInType,isServiceWorkerAvailable:(0,g.isServiceWorkerAvailable)({optInSetting:e.siteSettings.optin_settings})}}}),a.default.debug("The subscription process was completed using the subscriber recovery widget.")}catch(t){a.default.error(t.message),(0,d.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}}));s.default.on("notificationPermissionReceived",(s=>n(void 0,void 0,void 0,(function*(){try{const{permission:a}=s,d=(0,r.getElementById)(t);if("denied"!==a)return void(0,r.removeElement)(t);if(d)return;i.bell?(yield(0,l.delay)(1e3*i.settings.delay),(i=>{(0,c.addSubscriberRecoveryBellWidgetToPage)({widget:i,site:e.site});const s=(0,r.getElementById)(`${t}-bell`);null==s||s.addEventListener("click",(()=>n(void 0,void 0,void 0,(function*(){yield o()}))))})(i.bell)):i.button&&(yield(0,l.delay)(1e3*i.settings.delay),(i=>{(0,c.addSubscriberRecoveryButtonWidgetToPage)({widget:i,site:e.site});const s=(0,r.getElementById)(`${t}-button`),a=(0,r.getElementById)(`${t}-close-button`);null==s||s.addEventListener("click",(()=>n(void 0,void 0,void 0,())),null==a||a.addEventListener("click",(()=>{(0,r.removeElement)(t)}))})(i.button))}catch(t){a.default.error(t.message),(0,d.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}}))))}},1860:function(e,t,i){var n=this&&this.__awaiter||o=this&&this.__importDefault||Object.defineProperty(t,"__esModule",{value:!0}),t.removeSubscriptionManagementWidget=t.showSubscriptionManagementWidget=t.addEventListenerForSubscriptionManagementWidget=void 0;const s=o(i(4182)),r=i(3641),a=o(i(7607)),d=i(1791),c=i(6086),l=i(3110),u=i(1920),g=i(953),p=i(3502),b=i(2004),f=i(9892),v=i(1730),m=i(9340),_=i(4014),h=i(9851),y=i(5021);let w=!1;const S=({widget:e,permission:t})=>"granted"!==t||!!(e.segment_preference||e.unsubscribe_options||e.personal_notification_options),I=({permission:e,subscriberId:t,widgetSettings:i,widgetId:o})=>n(void 0,void 0,void 0,(function*(){const u=(0,h.getAppData)();if("granted"===e&&!t)throw new Error("The subscriber ID is not available when the notification permission is granted.");let f=null;"granted"===e&&t&&(f=yield(0,p.getSubscriberData)(t)),(0,c.refreshSubscriptionManagementWidgetView)({widgetId:o,subscriberData:f,site:u.site,widget:i,notificationPermission:e}),n(void 0,void 0,void 0,(function*(){const e=()=>{const e=[];return document.querySelectorAll(`#${o}-opt-in-segment input[type="checkbox"]`).forEach((t=>{const i=t;i.checked&&e.push(i.value)})),e},t=`${o}-opt-in-subscribe`,i=(0,r.getElementById)(t),s=document.querySelector(`#${t} input[type="checkbox"]`);null==s||s.addEventListener("click",(t=>n(void 0,void 0,void 0,(function*(){const n=t.target;try{n.disabled=!0,n.checked=!1,null==i||i.classList.add("pushengage-opt-in__switch--spin"),yield(0,b.initializeSubscription)({triggerFrom:"onClick",options:{clickOptions:{widgetOptInType:m.widgetOptInType,segment:e(),isServiceWorkerAvailable:(0,l.isServiceWorkerAvailable)({optInSetting:u.siteSettings.optin_settings})}}}),a.default.debug("The subscription process was completed using the subscription management widget.")}catch(e){a.default.error(e.message),(0,d.sendErrorLog)("sdk",e,{siteId:u.site.site_id})}}))))})),"granted"===e&&t&&((e=>{n(void 0,void 0,void 0,(function*(){document.querySelectorAll(`#${o}-opt-in-segment input[type="checkbox"]`).forEach((t=>{t.addEventListener("click",(t=>n(void 0,void 0,void 0,(function*(){const i=t.target;try{i.checked?(yield(0,g.addSegmentToSubscriber)({subscriberId:e,segment:i.value,siteId:u.site.site_id}),a.default.debug(`This ${i.value} segment added successfully.`)):(yield(0,g.removeSegmentFromSubscriber)({subscriberId:e,segment:i.value,siteId:u.site.site_id}),a.default.debug(`This ${i.value} segment removed successfully.`))}catch(e){a.default.error(e.message),(0,d.sendErrorLog)("sdk",e,{siteId:u.site.site_id})}}))))}))}))})(t),(e=>{n(void 0,void 0,void 0,(function*(){const t=document.querySelector(`#${o}-opt-in-auto-notification input[type="checkbox"]`);null==t||t.addEventListener("click",(t=>n(void 0,void 0,void 0,(function*(){const i=t.target,n=i.checked?"enabled":"disabled",s=`${o}-opt-in-auto-notification`,c=(0,r.getElementById)(s);try{i.disabled=!0,i.checked="disabled"===n,null==c||c.classList.add("pushengage-opt-in__switch--spin"),yield(0,p.updateAutomatedNotificationStatus)({status:n,subscriberId:e,siteId:u.site.site_id}),a.default.debug(`Automated notification ${n} successfully.`)}catch(e){a.default.error(e.message),(0,d.sendErrorLog)("sdk",e,{siteId:u.site.site_id})}}))))}))})(t),(e=>{n(void 0,void 0,void 0,(function*(){const t=`${o}-opt-in-unsubscribe`,i=(0,r.getElementById)(t),c=(0,r.getElementById)(`${o}-unsubscribe-allow-button`),l=(0,r.getElementById)(`${o}-unsubscribe-close-button`),g=document.querySelector(`#${t} input[type="checkbox"]`),p=(0,r.getElementById)(`${o}-unsubscribe-popover`),b="pushengage-opt-in__switch--spin",f="pushengage-opt-in__popover--opened";g&&(g.addEventListener("click",(e=>n(void 0,void 0,void 0,(function*(){const t=e.target;t.disabled=!0,t.checked=!0,null==i||i.classList.add(b)})))),null==c||c.addEventListener("click",(()=>n(void 0,void 0,void 0,(function*(){try{null==p||p.classList.remove(f),yield(0,v.unsubscribeSubscription)({subscriberId:e,siteId:u.site.site_id,serviceWorkerSetting:u.siteSettings.service_worker}),a.default.debug("The subscription was unsubscribed through the subscription management widget."),s.default.trigger("notificationPermissionReceived",{permission:"denied",isPermissionChanged:!0})}catch(e){a.default.error(e.message),(0,d.sendErrorLog)("sdk",e,{siteId:u.site.site_id})}})))),null==l||l.addEventListener("click",(()=>n(void 0,void 0,void 0,(function*(){null==p||p.classList.remove(f),g.disabled=!1,null==i||i.classList.remove(b)})))))}))})(t))})),P=({widgetId:e,widgetSettings:t})=>n(void 0,void 0,void 0,(function*(){const i=(0,f.getSubscriberIdFromStorage)();if((0,r.getElementById)(e)){if(!1===S({widget:t,permission:i?"granted":"denied"}))return(0,r.removeElement)(e),void a.default.debug("The subscription management widget view is removed because the widget has empty content. id = ",e);yield I({widgetId:e,widgetSettings:t,permission:i?"granted":"denied",subscriberId:i||void 0}),a.default.debug("The subscription management widget view is being updated. id = ",e)}}));t.addEventListenerForSubscriptionManagementWidget=()=>{const e=(0,h.getAppData)(),t="pushengage-subscription-management-widget",{subscription_management_widget:i}=e.siteSettings,o=(0,u.detectDeviceType)();i&&(s.default.on("notificationPermissionReceived",(s=>n(void 0,void 0,void 0,(function*(){try{const n=yield(0,y.getGeoInfo)({isEu:e.site.is_eu}),{permission:d,subscriberId:c}=s;if("denied"!==d&&"granted"!==d)return void(0,r.removeElement)(t);if(!1===S({widget:i,permission:d}))return(0,r.removeElement)(t),void a.default.debug("The subscription management widget view is removed because the widget has empty.");if(!1===(e=>{var t;if(!i)return!1;if(!i.trigger_button)return!1;if(!(null===(t=i.trigger_button)||void 0===t?void 0:t.rules))return!0;const n=i.trigger_button.rules;return!!(0,l.isCountrySatisfyingCountryRules)({include_countries:n.include_countries,exclude_countries:n.exclude_countries},e.country||"")&&!!(0,l.isUrlSatisfyingUrlRules)({include:n.include,exclude:n.exclude},location.href)&&!!(0,l.isDeviceSatisfyingDeviceRules)({include_devices:n.include_devices,exclude_devices:n.exclude_devices},o)})(n))return;yield I({permission:d,subscriberId:c,widgetSettings:i,widgetId:t})}catch(t){a.default.error(t.message),(0,d.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}})))),s.default.on("updateSubscriptionManagementWidgetView",(()=>n(void 0,void 0,void 0,(function*(){try{yield P({widgetId:t,widgetSettings:i})}catch(t){a.default.error(t.message),(0,d.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}})))))},t.showSubscriptionManagementWidget=()=>n(void 0,void 0,void 0,(function*(){const e=(0,h.getAppData)(),t="pushengage-subscription-management-widget-api-triggered",{optin_settings:i,safari_options:o,subscription_management_widget:c}=e.siteSettings;if(!c)throw new Error("Subscription management widget is not enabled.");const l=yield(0,v.getUserSubscriptionState)({optInSetting:i,safariWebPushPackageSetting:o});if("default"===l)throw new Error("Your current notification permission is not granted or denied because the opt-in was not shown.");const u="subscribed"===l?"granted":"denied";if((0,r.getElementById)(t))throw new Error("Opt-in already showing on page.");if(!1===S({widget:c,permission:u}))throw new Error("Opt-in is not applicable to show on the page.");const g=(0,_.omit)(c,["trigger_button"]),p=()=>n(void 0,void 0,void 0,(function*(){try{yield P({widgetId:t,widgetSettings:g})}catch(t){a.default.error(t.message),(0,d.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}}));return yield I({widgetId:t,permission:u,subscriberId:(0,f.getSubscriberIdFromStorage)()||void 0,widgetSettings:g}),w||(s.default.on("updateSubscriptionManagementWidgetView",p),s.default.on("notificationPermissionReceived",p),w=!0),"Opt-in shown successfully on the page."})),t.removeSubscriptionManagementWidget=()=>n(void 0,void 0,void 0,(function*(){const e=(0,h.getAppData)(),{subscription_management_widget:t}=e.siteSettings,i="pushengage-subscription-management-widget-api-triggered";if(!t)throw new Error("Subscription management widget is not enabled.");if(!(0,r.getElementById)(i))throw new Error("Opt-in not showing on page.");return(0,r.removeElement)(i),"Opt-in removed successfully on the page."}))},9291:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.handleResubscribeSubscription=void 0;const o=i(8648),s=i(9892),r=i(9851);t.handleResubscribeSubscription=({subscription:e})=>n(void 0,void 0,void 0,(function*(){const t=(0,r.getAppData)(),i=yield(0,o.processSubscriptionData)({subscription:e,siteSettings:t.siteSettings,site:t.site,options:{tokenRefresh:!0}});(0,s.storeSubscriptionDataInStorage)({subscription:e,subscriberId:i,isSubDomain:!1})}))},1154:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.notifyPermissionPromptAndGetSubscription=void 0;const s=o(i(7607)),r=i(2768),a=i(1920),d=i(2471),c=i(9798),l=i(3395),u=i(9340);t.notifyPermissionPromptAndGetSubscription=({siteSettings:e,site:t})=>n(void 0,void 0,void 0,(function*(){s.default.debug("Requesting the notification permission prompt.");const{service_worker:i,safari_options:o,vapid_key:g,overlay_settings:p,optin_subscription_reminder:b}=e,f={},v=yield n(void 0,void 0,void 0,(function*(){try{"default"===(0,d.getNotificationPermission)({safariWebPushId:null==o?void 0:o.push_id})&&((0,c.addSubscriptionOverlayToPage)({site:t,overlay:p}),(0,l.addSubscriptionReminderPromptToPage)({site:t,reminderPrompt:b,overlay:p}));const{name:e}=(0,a.detectBrowser)();let i;return i="Safari"!==e||(0,d.hasSupportForPushApiInSafari)()?{permission:yield(0,r.requestNotificationPermission)()}:yield(0,r.requestSafariNotificationPermission)(o.push_id,u.env.__SAFARI_WEB_PUSH_PACKAGE_URL__,{app_id:t.site_key}),i}finally{(0,c.removeSubscriptionOverlay)(),(0,l.removeSubscriptionReminderPrompt)()}}));let m;if(s.default.debug(`User permission has been ${v.permission}.`),Object.assign(f,v),"granted"===v.permission){if(v.deviceToken)m=v;else{const e={vapidPublicKey:g.public_key};i.workerStatus&&(e.options={scope:i.scope?"/":void 0},e.scriptURL=i.worker);try{m=yield(0,r.subscribeToPushNotification)(e)}catch(t){if("InvalidStateError"!==t.name)throw t;yield(0,r.unsubscribeFromPushSubscription)(),m=yield(0,r.subscribeToPushNotification)(e)}}f.subscription=m}return f}))},226:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.addResetNotificationPermissionPopupToPage=void 0;const o=i(3641),s=i(7913),r=i(2471),a=i(9851);t.addResetNotificationPermissionPopupToPage=e=>n(void 0,void 0,void 0,(function*(){const t=(0,a.getAppData)();(0,s.addResetNotificationPermissionPopupViewToPage)(e);const i="pushengage-reset-notification-permission-popup";return new Promise(((e,s)=>{const a=(0,o.getElementById)(`${i}-retry`),d=(0,o.getElementById)(`${i}-close`);if(!d||!a)return s(new Error("Could not find reset notification permission popup buttons"));null==a||a.addEventListener("click",(()=>n(void 0,void 0,void 0,(function*(){var n;const s=(0,r.getNotificationPermission)({safariWebPushId:null===(n=t.siteSettings.safari_options)||void 0===n?void 0:n.push_id});if("denied"!==s)(0,o.removeElement)(i),e(s);else{const e=(0,o.getElementById)(`${i}-retry-loading`);e&&!e.classList.contains("disabled")&&(e.style.display="block",e.classList.add("disabled"),setTimeout((,2e3))}})))),null==d||d.addEventListener("click",(()=>n(void 0,void 0,void 0,(function*(){var n;(0,o.removeElement)(i);const s=(0,r.getNotificationPermission)({safariWebPushId:null===(n=t.siteSettings.safari_options)||void 0===n?void 0:n.push_id});e(s)}))))}))}))},9798:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeSubscriptionOverlay=t.addSubscriptionOverlayToPage=void 0;const n=i(3641),o=i(1920),s=i(7643),r="pushengage-subscription-overlay";t.addSubscriptionOverlayToPage=({overlay:e,site:t})=>{e&&"mobile"!==(0,o.detectDeviceType)()&&((0,n.getElementById)(r)||(0,s.addSubscriptionOverlayViewToPage)({site:t,overlay:e}))},t.removeSubscriptionOverlay=()=>{(0,n.removeElement)(r)}},3395:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeSubscriptionReminderPrompt=t.addSubscriptionReminderPromptToPage=void 0;const n=i(3641),o=i(1920),s=i(8312),r=i(2471),a=i(9892),d=i(2689),c=i(4014),l="pushengage-subscription-reminder-prompt";let u;t.addSubscriptionReminderPromptToPage=({reminderPrompt:e,overlay:t,site:i})=>{const g=(0,o.detectDeviceType)();if(t&&"desktop"===g)return;if(!e)return;if((0,n.getElementById)(l))return;if(!(0,r.isSupportQuieterUI)()||"desktop"!==g)return;const{count:p}=(0,a.getReminderPromptDataFromStorage)()||{};p&&p>=e.max_prompt||(u=setTimeout((()=>{(0,s.addSubscriptionReminderPromptViewToPage)({reminderPrompt:e,site:i}),(0,a.setReminderPromptDataToStorage)();const t=(0,n.getElementById)(`${l}-button`);null==t||t.addEventListener("click",(()=>{(0,n.removeElement)(l),clearTimeout(u)}))}),1e3*(e=>{const{lastShownTime:t}=(0,a.getReminderPromptDataFromStorage)()||{};if(!t)return e.show_after_initial_delay;const i=((0,d.getUnixTime)()-t)/1e3;return(0,c.toInteger)(Math.max(e.show_again_after-i,0).toFixed(0))})(e)))},t.removeSubscriptionReminderPrompt=()=>{(0,n.removeElement)(l),clearTimeout(u)}},8911:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initializeSubscriptionOptInOnClick=t.initializeSubscriptionOptInForSubDomain=t.initializeSubscriptionOptIn=t.handleNotificationPermission=void 0;const d=a(i(3321)),c=i(8648),l=i(7888),u=s(i(3641)),g=s(i(9892)),p=a(i(4182)),b=i(3110),f=a(i(7607)),v=i(2471),m=i(9340),_=i(1730),h=i(6547),y=i(4014),w=i(1154),S=i(226),I=i(9851),P=a(i(8267)),E=a(i(1625));t.handleNotificationPermission=({optInType:e,options:t={}})=>r(void 0,void 0,void 0,(function*(){var i,n,o,s;if(!P.default.isLocked("isNotificationPermissionPending"))try{yield P.default.acquireLock("isNotificationPermissionPending");const r=(0,I.getAppData)(),a=(0,v.isTokenRefresh)({safariWebPushId:null===(i=r.siteSettings.safari_options)||void 0===i?void 0:i.push_id});let d;"denied"===(0,v.getNotificationPermission)({safariWebPushId:null===(n=r.siteSettings.safari_options)||void 0===n?void 0:n.push_id})&&"denied"===(yield(0,S.addResetNotificationPermissionPopupToPage)(r.siteSettings.reset_notification_permission_popup))&&(d={permission:"denied"}),d||("default"===(0,v.getNotificationPermission)({safariWebPushId:null===(o=r.siteSettings.safari_options)||void 0===o?void 0:o.push_id})&&p.default.trigger("permissionPrompt",{optInType:t.widgetOptInType||e,state:"displayed",prompt:"native"}),d=yield(0,w.notifyPermissionPromptAndGetSubscription)({siteSettings:r.siteSettings,site:r.site})),p.default.trigger("permissionPrompt",{optInType:t.widgetOptInType||e,prompt:"native",state:"granted"===(0,v.getNotificationPermission)({safariWebPushId:null===(s=r.siteSettings.safari_options)||void 0===s?void 0:s.push_id})?"allow":"close"}),yield(0,c.processNotificationPermission)({permissionData:d,optInType:e,siteSettings:r.siteSettings,site:r.site,options:{tokenRefresh:a,segment:t.segment,widgetOptInType:t.widgetOptInType}});const l="default"===d.permission&&(0,_.isAllSubscriptionOptInClosed)(r.siteSettings.optin_settings)?"denied":d.permission;p.default.trigger("notificationPermissionReceived",{permission:l,subscriberId:g.getSubscriberIdFromStorage()||void 0,isPermissionChanged:!0})}finally{P.default.releaseLock("isNotificationPermissionPending")}}));const O=()=>r(void 0,void 0,void 0,(function*(){const e=(0,I.getAppData)(),t=(0,b.getSubDomainSubscriptionUrl)({customSubDomainSetting:e.siteSettings.custom_url,siteSubDomain:e.site.site_subdomain});"tab"===t.type?window.open(t.url,"_blank"):window.open(t.url,"_blank","width=800, height=600")}));t.initializeSubscriptionOptIn=({activeSubscriptionOptIns:e})=>r(void 0,void 0,void 0,(function*(){var i;const n=(0,I.getAppData)();f.default.debug("The initialization of the subscription opt-in has begun.");const o=e=>{const i=e.optin_type,o=`pushengage-opt-in-${i}`,s=`pushengage-opt-in-${i}-tooltip`,a=u.getElementById(`pushengage-opt-in-${i}-allow`),c=u.getElementById(`pushengage-opt-in-${i}-close`),l=u.getElementById(`pushengage-opt-in-${i}-powered-by`);return new Promise(((v,y)=>{try{if(!a)return void y(new d.default({message:"Allow button not found",type:"NotFoundException",details:{site:n.site.site_id}}));a.addEventListener("click",(()=>r(void 0,void 0,void 0,(function*(){try{yield new Promise(((r,a)=>{f.default.debug('The user clicked on the "Allow" button.'),p.default.trigger("permissionPrompt",{optInType:i,state:"allow",prompt:"html"});const c=(()=>{const e=[];return document.querySelectorAll(`#pushengage-opt-in-${i}__segments input[type="checkbox"]`).forEach((t=>{const i=t;i.checked&&e.push(i.value)})),e})();u.removeElement(o),u.removeElement(s),(0,b.canSubscribeViaServiceWorker)({isServiceWorkerAvailable:!!e.optin_sw_support})?(0,t.handleNotificationPermission)({optInType:i,options:{segment:c}}).then((()=>r())).catch((e=>a(e))):(E.default.set("subscriptionOnSubdomain",Object.assign(Object.assign({},E.default.get("subscriptionOnSubdomain")),{optInType:i,segment:c})),O(),p.default.on("notificationPermissionReceivedFromSubDomain",(e=>{try{const t=e;"error"in t?a(new d.default(Object.assign(Object.assign({},t.error),{details:{site_id:n.site.site_id}}))):r()}catch(e){a(e)}}),{once:!0}))})),v()}catch(e){y(e)}})))),c&&c.addEventListener("click",(()=>r(void 0,void 0,void 0,(function*(){try{yield r(void 0,void 0,void 0,(function*(){f.default.debug('The user clicked on the "Close" button.'),p.default.trigger("permissionPrompt",{optInType:i,state:"close",prompt:"html"}),u.removeElement(o),u.removeElement(s),g.storeOptInCloseDataInStorage({optInType:i,storageDuration:e.cookie_duration}),(0,_.isAllSubscriptionOptInClosed)(n.siteSettings.optin_settings)&&p.default.trigger("notificationPermissionReceived",{permission:"denied",isPermissionChanged:!0}),n.siteSettings.sub_analytics.enabled&&(yield(0,h.sendOptInAnalytics)({optin_type:e.optin_type,site_id:n.site.site_id,block_1:!0,optin_1:!0}))})),v()}catch(e){y(e)}})))),l&&l.addEventListener("click",(()=>r(void 0,void 0,void 0,()))}catch(e){y(e)}}))},s=({optIn:e,isHtmlView:i})=>{const s=()=>r(void 0,void 0,void 0,(function*(){f.default.debug(`Initialized the ${e.optin_name} subscription opt-in.`),i?(p.default.trigger("permissionPrompt",{state:"displayed",prompt:"html",optInType:e.optin_type}),(0,l.addOptInViewToPage)({optIn:e,site:n.site}),yield o(e)):yield(0,t.handleNotificationPermission)({optInType:e.optin_type})}));return new Promise(((t,i)=>{const n=()=>r(void 0,void 0,void 0,(function*(){if(!(u.getScrollPercentage()<e.optin_scroll)){window.removeEventListener("scroll",n);try{yield s(),t()}catch(e){i(e)}}}));let o;"delay"===e.optin_category?(f.default.debug(`Initializing the ${e.optin_name} subscription opt-in with a delay(${e.optin_delay}s).`),o=setTimeout((()=>r(void 0,void 0,void 0,(function*(){try{yield s(),t()}catch(e){i(e)}}))),1e3*e.optin_delay)):"scroll"===e.optin_category&&(f.default.debug(`Initializing the ${e.optin_name} subscription opt-in with a scroll(${e.optin_scroll}%).`),u.getScrollPercentage()>=e.optin_scroll?s().then((()=>t())).catch((e=>i(e))):window.addEventListener("scroll",n));const a=()=>{const t=`pushengage-opt-in-${e.optin_type}`,i=`pushengage-opt-in-${e.optin_type}-tooltip`;u.removeElement(t),u.removeElement(i),window.removeEventListener("scroll",n),o&&clearTimeout(o)};p.default.on("subscriptionInitializedFromClickManager",(()=>{try{a(),t()}catch(e){i(e)}}),{once:!0});const d=n=>{try{const{optInType:i,state:o,prompt:s}=n;if(P.default.isLocked("isNotificationPermissionPending")&&e.optin_type===m.optInTypes.singleStep)return;("allow"===o||"close"===o&&"native"===s)&&i!==e.optin_type&&(a(),t(),p.default.remove("permissionPrompt",d))}catch(e){i(e)}};p.default.on("permissionPrompt",d)}))},a=[],c=e.map((e=>e.optin_type));for(const t of e){if(g.isSubscriptionOptInClosed(t.optin_type))continue;f.default.debug(`Initializing the ${t.optin_name} subscription opt-in.`);const e={};switch(t.optin_type){case m.optInTypes.safari:case m.optInTypes.floatingBar:case m.optInTypes.bell:Object.assign(e,{optIn:t,isHtmlView:!0});break;case m.optInTypes.singleStep:if("denied"===(0,v.getNotificationPermission)({safariWebPushId:null===(i=n.siteSettings.safari_options)||void 0===i?void 0:i.push_id})){const i=1;c.length===i&&Object.assign(e,{optIn:t,isHtmlView:!0})}else(0,v.isUserGestureRequiredForPermissionPrompt)()?c.includes(m.optInTypes.bell)||Object.assign(e,{optIn:t,isHtmlView:!0}):Object.assign(e,{optIn:t});break;case m.optInTypes.largeSafari:case m.optInTypes.largeSafariWithSegments:case m.optInTypes.sleekOptInBox:Object.assign(e,{optIn:t,isHtmlView:!0});break;default:throw new d.default({message:"Opt-in type doesn't exist.",type:"NotFoundException",details:{site:n.site.site_id}})}(0,y.isEmptyObject)(e)||a.push(s(Object.assign({},e)))}yield Promise.all(a)})),t.initializeSubscriptionOptInForSubDomain=()=>{var e;const t=(0,I.getAppData)();if(!window.opener)return f.default.error("Window opener not found."),Promise.resolve();const i=document.referrer||"*",n=(0,v.isTokenRefresh)({safariWebPushId:null===(e=t.siteSettings.safari_options)||void 0===e?void 0:e.push_id}),o=()=>{window.opener.postMessage({source:"PushEngage",prompt:!0,siteId:t.site.site_id},i)},s=()=>new Promise(((e,i)=>{if((0,v.isUserGestureRequiredForPermissionPrompt)()){const n="pushengage-opt-in-intermediate-button",s=u.getElementById(n);if(!s)return void i(new d.default({message:"intermediate allow button not found",type:"NotFoundException",details:{site:t.site.site_id}}));s.style.visibility="visible",s.addEventListener("click",(()=>r(void 0,void 0,void 0,(function*(){o(),(0,w.notifyPermissionPromptAndGetSubscription)({siteSettings:t.siteSettings,site:t.site}).then((t=>e(t))).catch((e=>i(e))),s.style.visibility="hidden"}))))}else o(),(0,w.notifyPermissionPromptAndGetSubscription)({siteSettings:t.siteSettings,site:t.site}).then((t=>e(t))).catch(()}));return new Promise((e=>{const a={permission:"default"};let d=!1;window.addEventListener("beforeunload",(function(){return d||(window.opener.postMessage(Object.assign(Object.assign({},a),{source:"PushEngage",siteId:t.site.site_id}),i),d=!0),e()})),r(void 0,void 0,void 0,(function*(){var e;switch((0,v.getNotificationPermission)({safariWebPushId:null===(e=t.siteSettings.safari_options)||void 0===e?void 0:e.push_id})){case"granted":try{return{permission:"granted",subscription:yield(0,_.resubscribeSubscription)({vapidSetting:t.siteSettings.vapid_key,serviceWorkerSetting:m.defaultServiceWorkerSetting,safariWebPushPackageSetting:t.siteSettings.safari_options})}}catch(e){return yield s()}case"denied":{const e=yield(0,S.addResetNotificationPermissionPopupToPage)(t.siteSettings.reset_notification_permission_popup);return"denied"===e?{permission:"denied"}:("default"===e&&o(),yield(0,w.notifyPermissionPromptAndGetSubscription)({siteSettings:t.siteSettings,site:t.site}))}default:return yield s()}})).then((e=>{Object.assign(a,e,{tokenRefresh:n}),window.close()})).catch((e=>{Object.assign(a,{error:{message:e.message,name:e.name,type:e.type}}),window.close()}))}))},t.initializeSubscriptionOptInOnClick=({options:e})=>{const i=(0,I.getAppData)();return new Promise(((n,o)=>{var s;const r=m.optInTypes.singleStep;(0,b.canSubscribeViaServiceWorker)({isServiceWorkerAvailable:null===(s=null==e?void 0:e.isServiceWorkerAvailable)||void 0===s||s})?(0,t.handleNotificationPermission)({optInType:r,options:{segment:null==e?void 0:e.segment,widgetOptInType:null==e?void 0:e.widgetOptInType}}).then(n).catch(o):(E.default.set("subscriptionOnSubdomain",Object.assign(Object.assign({},E.default.get("subscriptionOnSubdomain")),{optInType:r,segment:null==e?void 0:e.segment,widgetOptInType:null==e?void 0:e.widgetOptInType})),O(),p.default.on("notificationPermissionReceivedFromSubDomain",(e=>{try{const t=e;"error"in t?o(new d.default(Object.assign(Object.assign({},t.error),{details:{site_id:i.site.site_id}}))):n()}catch(e){o(e)}}),{once:!0}))}))}},2004:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initializeSubscription=void 0;const s=i(3110),r=i(1730),a=o(i(7607)),d=i(1920),c=i(9291),l=i(8911),u=o(i(4182)),g=i(3502),p=i(9892),b=i(2471),f=i(9851),v=i(5021),m=o(i(8267)),_=o(i(1625)),h=o(i(3321));t.initializeSubscription=({triggerFrom:e,options:t})=>n(void 0,void 0,void 0,(function*(){const i=(0,f.getAppData)(),o=Object.assign({},(0,f.getSDKInitOptions)());if(o.isSubscriptionOnSubDomain)yield(0,l.initializeSubscriptionOptInForSubDomain)();else{const{optin_settings:f,vapid_key:y,safari_options:w,service_worker:S}=i.siteSettings,{name:I}=(0,d.detectBrowser)();if("Safari"===I&&!(0,b.hasSupportForPushApiInSafari)()&&!w)return void a.default.warn("The Safari web push settings are not configured, Please configure them through the PushEngage app dashboard.");const P=yield(0,r.evaluateUserSubscriptionState)({optInSetting:f,safariWebPushPackageSetting:w,serviceWorkerSetting:S,vapidSetting:y});"onClick"===e?yield(e=>n(void 0,void 0,void 0,(function*(){if(m.default.isLocked("isNotificationPermissionPending"))throw new Error("Notification permission is pending, which means the permission prompt is already being displayed on the screen.");u.default.trigger("subscriptionInitializedFromClickManager",void 0);const{state:n,subscription:o}=e,{privacy_settings:s,publisher_settings:r}=i.siteSettings,b=yield(0,v.getGeoInfo)({isEu:i.site.is_eu});switch(n){case"subscribed":{a.default.debug("User subscription state is subscribed.");const e=(0,p.getSubscriberIdFromStorage)();yield(0,g.syncSubscriberData)({subscriberId:e,browserInfo:(0,d.getBrowserInfo)(),geoInfo:s.geoLocationEnabled?b:void 0,isPublisherSettingEnabled:null==r?void 0:r.enabled}),u.default.trigger("notificationPermissionReceived",{subscriberId:e,permission:"granted"});break}case"resubscribe":{a.default.debug("User subscription state is resubscribe."),yield(0,c.handleResubscribeSubscription)({subscription:o});const e=(0,p.getSubscriberIdFromStorage)();u.default.trigger("notificationPermissionReceived",{subscriberId:e,permission:"granted",isPermissionChanged:!0});break}default:a.default.debug(`User subscription state is ${n}, showing opt-in.`),yield(0,l.initializeSubscriptionOptInOnClick)({options:null==t?void 0:t.clickOptions})}})))(P):yield(e=>n(void 0,void 0,void 0,(function*(){var n;const{state:r,subscription:b}=e,{optin_settings:f,optin_management_settings:m,optin_subscription_rule:y,privacy_settings:w,publisher_settings:S}=i.siteSettings;switch(r){case"subscribed":{a.default.debug("User subscription state is subscribed.");const e=(0,p.getSubscriberIdFromStorage)(),t=yield(0,v.getGeoInfo)({isEu:i.site.is_eu});yield(0,g.syncSubscriberData)({subscriberId:e,browserInfo:(0,d.getBrowserInfo)(),geoInfo:w.geoLocationEnabled?t:void 0,isPublisherSettingEnabled:null==S?void 0:S.enabled}),u.default.trigger("notificationPermissionReceived",{subscriberId:e,permission:"granted"});break}case"resubscribe":{a.default.debug("User subscription state is resubscribe."),yield(0,c.handleResubscribeSubscription)({subscription:b});const e=(0,p.getSubscriberIdFromStorage)();u.default.trigger("notificationPermissionReceived",{subscriberId:e,permission:"granted",isPermissionChanged:!0});break}case"unsubscribed":a.default.debug("User subscription state is unsubscribed."),u.default.trigger("notificationPermissionReceived",{permission:"denied"});break;case"denied":a.default.debug("User subscription state is denied."),u.default.trigger("notificationPermissionReceived",{permission:"denied"});break;case"closed":a.default.debug("Subscription closed: All opt-ins have been closed by the user."),u.default.trigger("notificationPermissionReceived",{permission:"denied"});break;default:{if(a.default.debug("User subscription state is default, showing opt-in."),!0!==(null===(n=null==t?void 0:t.initOptions)||void 0===n?void 0:n.forceInit)&&o.disabledDefaultPrompt)return void a.default.debug("Default prompt is disabled.");const e=yield(0,v.getGeoInfo)({isEu:i.site.is_eu});if(!(0,s.isSatisfyingSubscriptionRules)(m,e))return void a.default.info("No active subscription opt-in is available. Filtering by global rules.");const r=(0,s.filterSubscriptionOptInsByRules)(f,y,e);if(!r.length)return void a.default.info("No active subscription opt-in is available. Filtering by opt-in rules.");if(_.default.get("isSubscriptionInitialized"))throw new h.default({message:"Subscription is already initialized.",name:h.default.ERROR_NAME.SubscriptionAlreadyInitialized});_.default.set("isSubscriptionInitialized",!0),yield(0,l.initializeSubscriptionOptIn)({activeSubscriptionOptIns:r})}}})))(P)}a.default.debug("Subscription initialization completed.")}))},5544:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.syncDatabase=void 0;const s=i(9851),r=o(i(7607)),a=i(4318);t.syncDatabase=()=>{const e=(0,s.getAppData)();n(void 0,void 0,void 0,(function*(){try{yield(0,a.syncAppId)(e.site.site_key)}catch(e){r.default.error(`Error during sync appId to database, ${e.message}`)}}))}},4963:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addEventListenerForUnsubscribeWidget=void 0;const s=o(i(4182)),r=i(3641),a=i(5569),d=i(1730),c=o(i(7607)),l=i(1791),u=i(3502),g=i(3110),p=i(4014),b=i(9851);t.addEventListenerForUnsubscribeWidget=()=>{const e=(0,b.getAppData)(),t="pushengage-unsubscribe-widget",{sub_management_settings:i}=e.siteSettings;if(!i)return;const o=i=>n(void 0,void 0,void 0,(function*(){yield(0,d.unsubscribeSubscription)({subscriberId:i,siteId:e.site.site_id,serviceWorkerSetting:e.siteSettings.service_worker}),c.default.debug("The subscription was unsubscribed through the unsubscribe widget."),yield(0,p.delay)(2e3),(0,r.removeElement)(t),s.default.trigger("notificationPermissionReceived",{permission:"denied",isPermissionChanged:!0})}));s.default.on("notificationPermissionReceived",(s=>n(void 0,void 0,void 0,(function*(){try{const{permission:d,subscriberId:p}=s,b=(0,r.getElementById)(t);if("granted"!==d)return void(0,r.removeElement)(t);if(!p)throw new Error("The subscriber ID is not available when the notification permission is granted.");if(b)return;if(!(0,g.isUrlSatisfyingUrlRules)({include:i.settings.rules.include,exclude:i.settings.rules.exclude},location.href))return;if(i.bell){const s=yield(0,u.getSubscriberData)(p);(({widget:i,subscriberId:s,automatedNotification:d})=>{(0,a.addUnsubscribeWidgetBellViewToPage)({widget:i,automatedNotification:d,site:e.site});const g=(0,r.getElementById)(`${t}-unsubscribe-button`),p=(0,r.getElementById)(`${t}-automated-notification`);null==g||g.addEventListener("click",(()=>n(void 0,void 0,void 0,(function*(){try{const e=(0,r.getElementById)(t);null==e||e.classList.add("pushengage-unsubscribe-widget--hidden"),yield o(s)}catch(t){c.default.error(t.message),(0,l.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}})))),null==p||p.addEventListener("change",(i=>n(void 0,void 0,void 0,(function*(){try{const n=(0,r.getElementById)(t),o=i.target,a=o.checked,d="pushengage-unsubscribe-widget--automated-notification-enabled";o.disabled=!0,a?null==n||n.classList.add(d):null==n||n.classList.remove(d),yield(0,u.updateAutomatedNotificationStatus)({subscriberId:s,siteId:e.site.site_id,status:a?"enabled":"disabled"}),o.disabled=!1}catch(t){c.default.error(t.message),(0,l.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}}))))})({subscriberId:p,widget:i.bell,automatedNotification:!!(null==s?void 0:s.trigger_status)})}else i.button&&(({widget:i,subscriberId:s})=>{(0,a.addUnsubscribeWidgetButtonViewToPage)({widget:i,site:e.site});const d=(0,r.getElementById)(`${t}-unsubscribe-title`),u=(0,r.getElementById)(`${t}-action-yes`),g=(0,r.getElementById)(`${t}-action-no`),p=(0,r.getElementById)(`${t}-close-button`);null==d||d.addEventListener("click",(()=>{const e=(0,r.getElementById)(t);null==e||e.classList.remove("pushengage-unsubscribe-widget--initial-state"),null==e||e.classList.add("pushengage-unsubscribe-widget--action-state")})),null==g||g.addEventListener("click",(()=>{const e=(0,r.getElementById)(t);null==e||e.classList.remove("pushengage-unsubscribe-widget--action-state"),null==e||e.classList.add("pushengage-unsubscribe-widget--initial-state")})),null==u||u.addEventListener("click",(()=>n(void 0,void 0,void 0,(function*(){try{const e=(0,r.getElementById)(t);null==e||e.classList.add("pushengage-unsubscribe-widget--final-state"),yield o(s)}catch(t){c.default.error(t.message),(0,l.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}})))),null==p||p.addEventListener("click",(()=>{(0,r.removeElement)(t)}))})({subscriberId:p,widget:i.button})}catch(t){c.default.error(t.message),(0,l.sendErrorLog)("sdk",t,{siteId:e.site.site_id})}}))))}},3609:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeSubscriberIdFromTag=t.getColorTheme=t.isHostPushEngageSubDomain=t.getSDKInitOptions=t.isDOMContentLoaded=t.getSDKLoadCount=void 0;const n=i(4014),o=i(9340);t.getSDKLoadCount=()=>{const e=window.__PushEngageSdkLoadCount||0;return window.__PushEngageSdkLoadCount=e+1},t.isDOMContentLoaded=()=>new Promise((e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",():e()})),t.getSDKInitOptions=(e,t=[])=>{if(!e||!Array.isArray(e))return;let i;for(let t=0;t<e.length;t+=1){const n=e[t];if(Array.isArray(n)&&n.length>0){const[e,t]=n;if("init"===e&&"object"==typeof t){i=t;break}}}if(!i)return;if((0,n.isUndefined)(window.dialog_box)||(i.isSubscriptionOnSubDomain=!0),!i.isLegacySDK)return i;if(!Array.isArray(t))return i;let o=!1;for(let e=0;e<t.length;e+=1){const s=t[e];if(Array.isArray(s)&&s.length>0){const[e,t]=s;if("init"===e&&(o=!0,("string"==typeof t||Array.isArray(t))&&(i.segment=t)),"config"===e&&"object"==typeof t){const e={};(0,n.isUndefined)(t.worker)||(e.path=t.worker),(0,n.isUndefined)(t.scope)||(e.scope=t.scope),(0,n.isUndefined)(t.workerStatus)||(e.status=t.workerStatus),(0,n.isEmptyObject)(e)||(i.serviceWorker=e)}}}return o?i:Object.assign(Object.assign({},i),{disabledDefaultPrompt:!0})},t.isHostPushEngageSubDomain=e=>`${e}.${o.env.__DOMAIN_NAME__}`===location.host,t.getColorTheme=e=>{const t=e.replace("#","");return(.299*parseInt(t.substring(0,2),16)+.587*parseInt(t.substring(2,4),16)+.114*parseInt(t.substring(4,6),16))/255>.5?"light":"dark"},t.removeSubscriberIdFromTag=e=>{if(!e.includes("-"))return e;const t=e.lastIndexOf("-");return e.substring(0,t)}},8405:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getWidgetOptInNameByType=t.getOptInNameByType=t.getOptInRuleNameByType=t.getOptInTypeByName=void 0;const i=[{type:1,name:"safari",displayName:"Safari Style Box"},{type:2,name:"floating_bar",displayName:"Floating Bar"},{type:3,name:"bell",displayName:"Bell Placed Bar"},{type:4,name:"single_step",displayName:"Push Single Step Opt-in"},{type:6,name:"large_safari",displayName:"Large Safari Style Box"},{type:8,name:"large_safari_with_segment",displayName:"Large Safari Style with Segment"},{type:9,name:"sleek_opt_in_box",displayName:"Sleek Opt-in Box"}],n=[{type:127,name:"subscription_management_widget",displayName:"Subscriber Recovery/Subscription Management Widget"}];t.getOptInTypeByName=e=>{var t;return null===(t=i.find((t=>t.name===e)))||void 0===t?void 0:t.type},t.getOptInRuleNameByType=e=>{var t;return null===(t=i.find((t=>t.type===e)))||void 0===t?void 0:t.name},t.getOptInNameByType=e=>{var t;return null===(t=i.find((t=>t.type===e)))||void 0===t?void 0:t.displayName},t.getWidgetOptInNameByType=,9892:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSubscriptionOnSubDomain=t.setReminderPromptDataToStorage=t.getReminderPromptDataFromStorage=t.setShopifyCampaignDataToStorage=t.getShopifyCampaignDataFromStorage=t.deleteSubscriberDataFromStorage=t.setSubscriberDataToStorage=t.addSubscriberDataToStorage=t.getSubscriberDataFromStorage=t.getSubscriberIdFromStorage=t.storeSubscriptionUnsubscribedDataInStorage=t.storeSubscriptionDeniedDataInStorage=t.storeOptInCloseDataInStorage=t.storeSubscriptionDataInStorage=t.isSubscriptionDenied=t.isSubscriptionUnsubscribed=t.hasSubscriptionDataInStorage=t.isSubscriptionOptInClosed=t.clearSubscriptionUnsubscribedDataFromStorage=t.clearOldSubscriptionDataFromStorage=t.clearSubscriptionDeniedDataFromStorage=t.getParsedStorageData=void 0;const n=i(606),o=i(9340),s=i(4014),r=i(2689);t.getParsedStorageData=e=>{const t=(0,n.getDataFromLocalStorage)(e);return t&&(0,s.safeParse)(t)||{}},t.clearSubscriptionDeniedDataFromStorage=()=>{const e=(0,t.getParsedStorageData)(o.storageName),i=(0,s.omit)(e,["denied"]);(0,s.isEmptyObject)(i)?(0,n.deleteDataFromLocalStorage)(o.storageName):(0,n.setDataToLocalStorage)(o.storageName,i)},t.clearOldSubscriptionDataFromStorage=()=>{let e=(0,t.getParsedStorageData)(o.storageName);e=(0,s.omit)(e,["id","isSubDomain","endpoint","subscriber"]),(0,s.isEmptyObject)(e)?(0,n.deleteDataFromLocalStorage)(o.storageName):(0,n.setDataToLocalStorage)(o.storageName,e)},t.clearSubscriptionUnsubscribedDataFromStorage=()=>{let e=(0,t.getParsedStorageData)(o.storageName);e=(0,s.omit)(e,["unsubscribed"]),(0,s.isEmptyObject)(e)?(0,n.deleteDataFromLocalStorage)(o.storageName):(0,n.setDataToLocalStorage)(o.storageName,e),(0,n.deleteDataFromCookies)("PushSubscriberStatus")},t.isSubscriptionOptInClosed=e=>{const i=(0,t.getParsedStorageData)(o.storageName);if(!i.optInClosed)return!1;const n=i.optInClosed,a=Array.isArray(e)?e:[e];for(let e=0;e<a.length;e++){const t=(0,s.get)(n,`${a[e]}`);if(!t)return!1;const{data:i,expiresAt:o}=t;if(!i||o<=(0,r.getUnixTime)())return!1}return!0},t.hasSubscriptionDataInStorage=({notificationPermission:e})=>{const i=(0,t.getParsedStorageData)(o.storageName),n=i.isSubDomain||"granted"===e;return!!(i.endpoint&&i.id&&n)},t.isSubscriptionUnsubscribed=({notificationPermission:e})=>{const i=(0,t.getParsedStorageData)(o.storageName);if(!i.unsubscribed)return!1;const{data:n,expiresAt:s}=i.unsubscribed;return!(s<=(0,r.getUnixTime)()||(!1===n.isSubDomain&&"granted"!==e?((0,t.clearSubscriptionUnsubscribedDataFromStorage)(),1):!0!==n.status))},t.isSubscriptionDenied=({notificationPermission:e})=>{const i=(0,t.getParsedStorageData)(o.storageName);if(!i.denied)return!1;const{data:n,expiresAt:s}=i.denied;return!(s<=(0,r.getUnixTime)()||(!1===n.isSubDomain&&"denied"!==e?((0,t.clearSubscriptionDeniedDataFromStorage)(),1):!0!==n.status))},t.storeSubscriptionDataInStorage=({subscriberId:e,subscription:t,isSubDomain:i})=>{const s={isSubDomain:i,id:e,endpoint:t.endpoint||t.deviceToken};(0,n.setDataToLocalStorage)(o.storageName,s),(0,n.deleteDataFromCookies)(["PushSubscriberStatus","peclosed"])},t.storeOptInCloseDataInStorage=({optInType:e,storageDuration:i})=>{const s=(0,t.getParsedStorageData)(o.storageName),a={optInClosed:Object.assign(Object.assign({},s.optInClosed),{[e]:{data:!0,expiresAt:(0,r.getUnixTime)(i)}})};(null==s?void 0:s.reminderPrompt)&&(a.reminderPrompt=s.reminderPrompt),(0,n.setDataToLocalStorage)(o.storageName,a)},t.storeSubscriptionDeniedDataInStorage=({isSubDomain:e,storageDuration:i})=>{const s=(0,t.getParsedStorageData)(o.storageName),a={denied:{data:{status:!0,isSubDomain:e},expiresAt:(0,r.getUnixTime)(i)}};s.reminderPrompt&&(a.reminderPrompt=s.reminderPrompt),(0,n.setDataToLocalStorage)(o.storageName,a),(0,n.deleteDataFromCookies)(["PushSubscriberStatus","peclosed"])},t.storeSubscriptionUnsubscribedDataInStorage=e=>{const i=(0,t.getParsedStorageData)(o.storageName),s={unsubscribed:{data:{status:!0,isSubDomain:e},expiresAt:(0,r.getUnixTime)(365)}};i.reminderPrompt&&(s.reminderPrompt=i.reminderPrompt),(0,n.setDataToLocalStorage)(o.storageName,s),(0,n.deleteDataFromCookies)(["PushSubscriberStatus","peclosed"])},t.getSubscriberIdFromStorage=()=>{const e=(0,t.getParsedStorageData)(o.storageName);return e.id?e.id:null},t.getSubscriberDataFromStorage=e=>{const i=(0,t.getParsedStorageData)(o.storageName).subscriber;return!i||i.expiresAt<=(0,r.getUnixTime)()?null:e?i.data[e]||null:i.data},t.addSubscriberDataToStorage=e=>{const i=(0,t.getParsedStorageData)(o.storageName),s=Object.assign(Object.assign({},i),{subscriber:{expiresAt:(0,r.getUnixTime)(1),data:e}});(0,n.setDataToLocalStorage)(o.storageName,s)},t.setSubscriberDataToStorage=e=>{var i,s;const a=(0,t.getParsedStorageData)(o.storageName),d=(null===(i=a.subscriber)||void 0===i?void 0:i.expiresAt)||(0,r.getUnixTime)(1),c=Object.assign(Object.assign({},a),{subscriber:{expiresAt:d,data:Object.assign(Object.assign({},null===(s=null==a?void 0:a.subscriber)||void 0===s?void 0:s.data),e)}});(0,n.setDataToLocalStorage)(o.storageName,c)},t.deleteSubscriberDataFromStorage=()=>{const e=(0,t.getParsedStorageData)(o.storageName);if(!e.subscriber)return;const i=(0,s.omit)(e,["subscriber"]);(0,s.isEmptyObject)(e)?(0,n.deleteDataFromLocalStorage)(o.storageName):(0,n.setDataToLocalStorage)(o.storageName,i)},t.getShopifyCampaignDataFromStorage=()=>{const e=(0,t.getParsedStorageData)(o.storageName);return e.shopify?e.shopify:null},t.setShopifyCampaignDataToStorage=e=>{const i=(0,t.getParsedStorageData)(o.storageName),s=Object.assign(Object.assign({},i),{shopify:Object.assign(Object.assign({},null==i?void 0:i.shopify),e)});(0,n.setDataToLocalStorage)(o.storageName,s)},t.getReminderPromptDataFromStorage=()=>{const e=(0,t.getParsedStorageData)(o.storageName);return e.reminderPrompt?e.reminderPrompt:null},t.setReminderPromptDataToStorage=()=>{var e;const i=(0,t.getParsedStorageData)(o.storageName),a={reminderPrompt:{count:(0,s.toInteger)(null===(e=i.reminderPrompt)||void 0===e?void 0:e.count)+1,lastShownTime:(0,r.getUnixTime)()}};(null==i?void 0:i.denied)&&(a.denied=i.denied),(null==i?void 0:i.unsubscribed)&&(a.unsubscribed=i.unsubscribed),(null==i?void 0:i.optInClosed)&&(a.optInClosed=i.optInClosed),(0,n.setDataToLocalStorage)(o.storageName,a)},t.isSubscriptionOnSubDomain=,4318:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteFailedClickedNotificationTag=t.getFailedClickedNotificationTags=t.addFailedClickedNotificationTag=t.deleteFailedViewedNotificationTag=t.getFailedViewedNotificationTags=t.addFailedViewedNotificationTag=t.getNotificationTagsByKey=t.updateNotificationTagByKey=t.syncAppId=t.getAppId=void 0;const a=i(9340),d=s(i(1074)),c=i(4014);t.getAppId=()=>r(void 0,void 0,void 0,(function*(){const e=yield d.openDB(a.database.name,a.database.version,a.database.stores),t=yield d.getObject(e,"ids","appId");return(null==t?void 0:t.appId)||null})),t.syncAppId=e=>r(void 0,void 0,void 0,(function*(){const t=yield d.openDB(a.database.name,a.database.version,a.database.stores);yield d.upsertObject(t,"ids",{id:"appId",appId:e})})),t.updateNotificationTagByKey=(e,t)=>r(void 0,void 0,void 0,(function*(){const i=yield d.openDB(a.database.name,a.database.version,a.database.stores),n=yield d.getObject(i,"ids",t),o=(null==n?void 0:n.notificationTags)||[];yield d.upsertObject(i,"ids",{id:t,notificationTags:(0,c.keepLastMaxElements)([...o,e],5)})})),t.getNotificationTagsByKey=e=>r(void 0,void 0,void 0,(function*(){const t=yield d.openDB(a.database.name,a.database.version,a.database.stores),i=yield d.getObject(t,"ids",e);return i&&i.notificationTags||[]})),t.addFailedViewedNotificationTag=({tag:e})=>r(void 0,void 0,void 0,(function*(){const t="failedViewedNotificationTags",i=yield d.openDB(a.database.name,a.database.version,a.database.stores);(yield d.getObject(i,t,e))||(yield d.upsertObject(i,t,{id:e}))})),t.getFailedViewedNotificationTags=()=>r(void 0,void 0,void 0,(function*(){const e=yield d.openDB(a.database.name,a.database.version,a.database.stores);return yield d.getObjects(e,"failedViewedNotificationTags")})),t.deleteFailedViewedNotificationTag=e=>r(void 0,void 0,void 0,(function*(){const t=yield d.openDB(a.database.name,a.database.version,a.database.stores);yield d.deleteObject(t,"failedViewedNotificationTags",e)})),t.addFailedClickedNotificationTag=({tag:e,action:t})=>r(void 0,void 0,void 0,(function*(){const i="failedClickedNotificationTags",n=yield d.openDB(a.database.name,a.database.version,a.database.stores);(yield d.getObject(n,i,e))||(yield d.upsertObject(n,i,{action:t,id:e}))})),t.getFailedClickedNotificationTags=()=>r(void 0,void 0,void 0,(function*(){const e=yield d.openDB(a.database.name,a.database.version,a.database.stores);return yield d.getObjects(e,"failedClickedNotificationTags")})),t.deleteFailedClickedNotificationTag=e=>r(void 0,void 0,void 0,(function*(){const t=yield d.openDB(a.database.name,a.database.version,a.database.stores);yield d.deleteObject(t,"failedClickedNotificationTags",e)}))},2768:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeToPushNotificationFromWorker=t.getSubscriptionFromWorker=t.getDeviceTokenFromEndpoint=t.unregisterServiceWorker=t.unsubscribeFromPushSubscription=t.getSafariSubscription=t.getPushSubscription=t.subscribeToPushNotification=t.isServiceWorkerRegistered=t.requestSafariNotificationPermission=t.requestNotificationPermission=void 0;const s=o(i(3321)),r=i(4014),a=o(i(8267)),d=e=>{const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),i=("undefined"!=typeof window?window:self).atob(t),n=new Uint8Array(i.length);for(let e=0;e<i.length;e++)n[e]=i.charCodeAt(e);return n},c=({scriptURL:e,options:t})=>n(void 0,void 0,void 0,(function*(){var i;const n=Object.assign({},t);let o=e;if(!e){const e=yield navigator.serviceWorker.getRegistrations();if(0===e.length)throw new s.default({message:"The service worker is not registered and tries to get a subscription.",name:s.default.ERROR_NAME.ServiceWorkerNotFound});const[t]=e;if(o=null===(i=t.active)||void 0===i?void 0:i.scriptURL,!o)throw new s.default({message:"The service worker scriptURL is missing in the registration object.",name:s.default.ERROR_NAME.ServiceWorkerNotFound});t.scope===`${location.origin}/`&&(n.scope="/")}try{const e=yield navigator.serviceWorker.register(o,n);return(null==n?void 0:n.scope)?yield navigator.serviceWorker.ready:yield(0,r.delay)(500),e}catch(e){throw new s.default({message:e.message,name:s.default.ERROR_NAME.ServiceWorkerNotRegistering})}}));t.requestNotificationPermission=()=>n(void 0,void 0,void 0,(function*(){if(!("Notification"in window))throw new Error("This browser does not support notifications.");if(!("requestPermission"in Notification))throw new s.default({message:"This browser does not support requestPermission.",name:s.default.ERROR_NAME.RequestPermissionNotSupported});const e=yield Notification.requestPermission();return"default"===e&&"denied"===Notification.permission?"denied":e})),t.requestSafariNotificationPermission=(e,t,i)=>new Promise((function(n,o){if(!("safari"in window)||!("pushNotification"in window.safari))return void o(new Error("Safari push notifications are not supported."));const s=window.safari.pushNotification.permission(e);"default"===s.permission?window.safari.pushNotification.requestPermission(t,e,i,():n(JSON.parse(JSON.stringify(s)))})),t.isServiceWorkerRegistered=()=>n(void 0,void 0,void 0,(function*(){return"serviceWorker"in navigator&&(yield navigator.serviceWorker.getRegistrations()).length>0})),t.subscribeToPushNotification=({vapidPublicKey:e,scriptURL:t,options:i})=>n(void 0,void 0,void 0,(function*(){try{yield a.default.acquireLock("subscribeToPushNotification");const n={userVisibleOnly:!0,applicationServerKey:d(e)},o=yield c({scriptURL:t,options:i}),s=yield o.pushManager.subscribe(n);return JSON.parse(JSON.stringify(s))}catch(e){if("AbortError"===e.name||"NotAllowedError"===e.name)throw new s.default({message:e.message,name:s.default.ERROR_NAME.DisabledPushSubscriptionError});throw e}finally{a.default.releaseLock("subscribeToPushNotification")}})),t.getPushSubscription=({scriptURL:e,options:t})=>n(void 0,void 0,void 0,(function*(){const i=yield c({scriptURL:e,options:t}),n=yield i.pushManager.getSubscription();return n?JSON.parse(JSON.stringify(n)):null})),t.getSafariSubscription=e=>{const t=window.safari.pushNotification.permission(e);return JSON.parse(JSON.stringify(t))},t.unsubscribeFromPushSubscription=()=>n(void 0,void 0,void 0,(function*(){const e=yield navigator.serviceWorker.getRegistrations();for(let t=0;t<e.length;t++){const i=yield e[t].pushManager.getSubscription();i&&(yield i.unsubscribe())}})),t.unregisterServiceWorker=()=>n(void 0,void 0,void 0,(function*(){const e=yield navigator.serviceWorker.getRegistrations();for(let t=0;t<e.length;t++)yield e[t].unregister()})),t.getDeviceTokenFromEndpoint=e=>{let t="";return t=e.indexOf("token=")>-1?e.slice(e.search("token=")+6):e.split("/")[e.split("/").length-1],t},t.getSubscriptionFromWorker=()=>n(void 0,void 0,void 0,(function*(){try{const e=yield self.registration.pushManager.getSubscription(),t=JSON.parse(JSON.stringify(e));return t.endpoint?t:null}catch(e){return null}})),t.subscribeToPushNotificationFromWorker=e=>n(void 0,void 0,void 0,(function*(){const t={userVisibleOnly:!0,applicationServerKey:d(e)},i=yield self.registration.pushManager.subscribe(t);return JSON.parse(JSON.stringify(i))}))},5827:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getProductTitleFromUrl=t.isUrlSatisfyingRules=void 0;const n=i(3241);t.isUrlSatisfyingRules=(e,t=location.href)=>{const i=new Set([t,`${t}/`,encodeURI(t),(0,n.safeDecodeURIComponent)(t)]);for(const[o,s]of Object.entries(e)){const e=new Set([...s,...s.map(()]);switch(s.forEach((t=>{e.add(`http://${t}`),e.add(`https://${t}`),e.add(`http://${t}/`),e.add(`https://${t}/`),e.add(encodeURI(t)),e.add((0,n.safeDecodeURIComponent)(t))})),o){case"exact":if(Array.from(e).some(())return!0;break;case"contains":if(Array.from(e).some((e=>i.has(e)||t.includes(e))))return!0;break;case"start":if(Array.from(e).some(())return!0}}return!1},t.getProductTitleFromUrl=(e=location.href)=>{const t=e.split("/products/");if(t.length<2)return;const i=t.pop();return i?i.split("?")[0]:void 0}},2471:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isTokenRefresh=t.getNotificationPermission=t.isUserGestureRequiredForPermissionPrompt=t.isSupportQuieterUI=t.isPushNotificationSupported=t.supportsVapidPush=t.safariWebPushSupported=t.hasSupportForPushApiInSafari=void 0;const n=i(1920),o=i(3241),s=i(4014);t.hasSupportForPushApiInSafari=()=>{const{name:e}=(0,n.detectBrowser)();return"Safari"===e&&"serviceWorker"in navigator&&"Notification"in window&&"PushManager"in window},t.safariWebPushSupported=()=>{const{name:e,version:t}=(0,n.detectBrowser)();return"Safari"===e&&t>=11&&"Notification"in window&&"safari"in window&&"pushNotification"in window.safari},t.supportsVapidPush=()=>{const{name:e,version:t}=(0,n.detectBrowser)(),i=(0,n.detectDeviceType)(),r=(0,o.detectSiteType)();return!("Ucbrowser"===e||"Firefox"===e&&(48===t||49===t)||"Opera"===e&&41===t||"Yandex"===e&&"mobile"===i)&&(!!("http"===r&&"Firefox"===e&&t>=50)||"Notification"in window&&"PushManager"in window&&"undefined"!=typeof PushSubscriptionOptions&&(0,s.hasOwn)(PushSubscriptionOptions.prototype,"applicationServerKey"))},t.isPushNotificationSupported=()=>(0,t.supportsVapidPush)()||(0,t.safariWebPushSupported)(),t.isSupportQuieterUI=()=>{const{name:e,version:t}=(0,n.detectBrowser)(),i=(0,n.detectDeviceType)(),o=(0,n.getChromiumStatus)();return o.isChromium&&o.version>=80||"desktop"===i&&"Firefox"===e&&t>=72},t.isUserGestureRequiredForPermissionPrompt=()=>{const{name:e,version:t}=(0,n.detectBrowser)();return"Firefox"===e&&t>=72||"Safari"===e||"Yandex"===e},t.getNotificationPermission=({safariWebPushId:e})=>{const{name:i}=(0,n.detectBrowser)();return e&&"Safari"===i&&window.safari&&!(0,t.hasSupportForPushApiInSafari)()?window.safari.pushNotification.permission(e).permission:Notification.permission},t.isTokenRefresh=({safariWebPushId:e})=>"granted"===(0,t.getNotificationPermission)({safariWebPushId:e})},9838:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addCampaignAlertWidget=void 0;const n=i(7156),o=i(9340),s=i(3641),r=i(9892);t.addCampaignAlertWidget=({alert:e,alertType:t,site:i,variantId:a})=>{const d=(({alert:e,alertType:t,site:i,variantId:s})=>{var a,d;const c=(0,r.getShopifyCampaignDataFromStorage)();let l="";("price_drop"===t&&(null===(a=null==c?void 0:c.priceDropVariantIds)||void 0===a?void 0:a.includes(s))||"inventory"===t&&(null===(d=null==c?void 0:c.backInStockVariantIds)||void 0===d?void 0:d.includes(s)))&&(l="pushengage-campaign-alert-widget--alert-sent");const u=`visibility: hidden;\n  --bell-background-color: ${e.bell_background};\n  --bell-color: ${e.bell_color};\n  --bell-height: 50px;\n  --bell-width: 50px;\n  --bell-right: 30px;\n  --bell-left: 30px;\n  --bell-bottom:50px;\n  --text-color: ${e.text_color};\n  --allow-button-color: ${"#ffffff"===e.bell_color?e.bell_background:e.bell_color};\n  --popover-background-color: #ffffff;\n  --popover-color: #0d0d0d;\n`,g=i.is_whitelabel?"":`\n        <div\n          class="pushengage-campaign-alert-widget__powered-by"\n          id="pushengage-campaign-alert-widget-powered-by"\n        >\n          Powered by <strong>${o.brandName}</strong>\n        </div>\n      `;return`\n    <div\n      id="pushengage-campaign-alert-widget"\n      class="pushengage-campaign-alert-widget ${l}"\n      style="${(0,n.getStyleForHtmlElement)(u)}"\n    >\n      <div\n        class="pushengage-opt-in__bell pushengage-opt-in__bell--left pushengage-campaign-alert-widget__bell"\n      >\n        <div id="pushengage-campaign-alert-widget-bell" class="pushengage-opt-in__bell__icon">\n          ${o.bellIcon}\n        </div>\n      </div>\n\n      <div\n        class="pushengage-opt-in__popover pushengage-campaign-alert-widget__opt-in"\n        id="pushengage-campaign-alert-widget-opt-in"\n      >\n        <div class="pushengage-campaign-alert-widget__opt-in__title">\n          ${e.message[t].before_subscription}\n        </div>\n\n        <div\n          class="pushengage-campaign-alert-widget__opt-in__title pushengage-campaign-alert-widget__opt-in__title--alert-sent"\n        >\n          ${e.message[t].after_subscription}\n        </div>\n\n        <div\n          class="pushengage-campaign-alert-widget__opt-in__button"\n          id="pushengage-campaign-alert-widget-allow-button"\n        >\n          ${e.message[t].allow_btn_txt}\n        </div>\n\n        ${g}\n      </div>\n    </div>\n  `})({alert:e,alertType:t,site:i,variantId:a});(0,s.addContentAfterBody)(d),(()=>{const e="pushengage-campaign-alert-widget",t=`${e}-opt-in`,i=`${e}-bell`,s=document.getElementById(e),r=document.getElementById(`${e}-bell`),a=document.getElementById(`${e}-allow-button`),d=document.getElementById(`${e}-powered-by`),c=document.getElementById(t);if(!s||!c)return;const l="pushengage-opt-in__popover--opened",u=`${e}--alert-sent`;null==d||d.addEventListener("click",(()=>{window.open(o.poweredByReferralUrl,"_blank")})),null==a||a.addEventListener("click",(()=>{s.classList.add(u),setTimeout((()=>{c.classList.remove(l)}),3e3)})),null==r||r.addEventListener("click",(()=>{c.classList.contains(l)?c.classList.remove(l):(0,n.showPopoverView)({targetId:i,popoverId:t})}))})()}},7156:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.showPopoverView=t.getStyleForHtmlElement=t.showTooltipView=void 0;const n=i(3641);t.showTooltipView=({targetId:e,tooltipId:t})=>{const i=(0,n.getElementById)(e),o=(0,n.getElementById)(t);if(!i||!o)return;(0,n.addCSSProperties)(t,{inset:"unset"});const s=i.getBoundingClientRect(),r=window.innerWidth,a=window.innerHeight,d={},c=o.offsetHeight>s.height?s.height/2:o.offsetHeight/2;let l="",u="";const g=s.height>o.offsetHeight?(s.height-o.offsetHeight)/2:0;s.bottom>o.offsetHeight||s.bottom>a-s.bottom?(d.bottom=`${a-s.bottom+g}px`,u="pushengage-opt-in__tooltip__arrow--bottom",s.bottom<o.offsetHeight&&(d.top="0px")):(d.top=`${s.top}px`,u="pushengage-opt-in__tooltip__arrow--top",a-s.top<o.offsetHeight&&(d.bottom="0px")),s.left>o.offsetWidth?(d.right=r-(r-document.documentElement.clientWidth)-s.left+14+"px",l="pushengage-opt-in__tooltip__arrow--right"):(d.left=`${s.right+14}px`,l="pushengage-opt-in__tooltip__arrow--left"),(0,n.addCSSProperties)(t,d),o.classList.add("pushengage-opt-in__tooltip--opened",l,u),o.style.setProperty("--tooltip-arrow-offset",`${c}px`)},t.getStyleForHtmlElement=t.showPopoverView=({targetId:e,popoverId:t})=>{const i=(0,n.getElementById)(e),o=(0,n.getElementById)(t);if(!i||!o)return;(0,n.addCSSProperties)(t,{inset:"unset"});const s=i.getBoundingClientRect(),r=12,a=window.innerHeight,d=window.innerWidth,c={};o.classList.contains("pushengage-opt-in__popover--beside")?(s.left-r>d-s.right?c.right=`${s.width+r}px`:c.left=`${s.width+r}px`,s.bottom>o.offsetHeight||s.bottom>a-s.bottom?(c.bottom=a-s.bottom+"px",s.bottom<o.offsetHeight&&(c.top="0px",a<o.offsetHeight&&(c.bottom="0px"))):(c.top=`${s.top}px`,a-s.top<o.offsetHeight&&(c.bottom="0px",a<o.offsetHeight&&(c.top="0px")))):(o.classList.contains("pushengage-opt-in__popover--left")?c.left=`${s.left}px`:s.right>d-s.right?c.right=d-s.right+"px":c.left=`${s.left}px`,s.top>a-s.bottom||s.top>o.offsetHeight?(c.bottom=`${a-s.top+r}px`,s.top+r<o.offsetHeight&&(c.top="0px")):(c.top=`${s.bottom+r}px`,a-s.bottom+r<o.offsetHeight&&(c.bottom="0px"))),(0,n.addCSSProperties)(t,c),o.classList.add("pushengage-opt-in__popover--opened")}},2797:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.attachTooltipEventToBell=t.getBellPlacedBarView=void 0;const n=i(9340),o=i(3641),s=i(7156),r=i(1920),a=i(4014);t.getBellPlacedBarView=({optIn:e,site:t})=>{const i="pe-bottom-left"===e.placement?"left":"right",o=`visibility: hidden;\n  --bell-background-color: ${e.bg};\n  --bell-color: ${e.allowBtnBg};\n  --bell-height: 50px;\n  --bell-width: 50px;\n  --bell-right:30px;\n  --bell-left:30px;\n  --bell-bottom:50px;\n`,r=Array.isArray(e.optin_segments)&&e.optin_segments.length?"":`id="pushengage-opt-in-${e.optin_type}-allow"`;return`\n    <div id="pushengage-opt-in-${e.optin_type}">\n      <div\n        id="pushengage-opt-in-${e.optin_type}-bell"\n        class="pushengage-opt-in__bell pushengage-opt-in__bell--${i}"\n        style="${(0,s.getStyleForHtmlElement)(o)}"\n      >\n        <div ${r} class="pushengage-opt-in__bell__icon">${n.bellIcon}</div>\n      </div>\n      ${(({optIn:e,site:t})=>{let i="",o="";if(Array.isArray(e.optin_segments)&&e.optin_segments.length){const t=e.default_segment_selection?"checked":"";e.optin_segments.forEach(((n,o)=>{i+=`\n          <div class="pushengage-opt-in__checkbox" style="margin-top:${o>=1?"8px":"0px"}">\n            <input\n              type="checkbox"\n              id="pushengage-opt-in__segment-${e.optin_type}-${o}"\n              value="${n}"\n              ${t}\n            />\n            <label for="pushengage-opt-in__segment-${e.optin_type}-${o}"\n              >${(0,a.capitalizeFirstLetter)(n)}</label\n            >\n          </div>\n        `})),i=`\n      <div\n        id="pushengage-opt-in-${e.optin_type}__segments"\n        class="pushengage-opt-in__bell__tooltip__segments"\n      >\n        ${i}\n      </div>\n    `,o=`\n      <div\n        class="pushengage-opt-in__bell__tooltip__button"\n        id="pushengage-opt-in-${e.optin_type}-allow"\n      >\n        ${e.optin_allow_btn_txt}\n      </div>\n    `}const r=`--checkbox-checked-tick-color: ${e.checkbox_tick_color};\n  --checkbox-unchecked--color: ${e.checkbox_bg};\n  --checkbox-checked-background-color: #ffffff;\n  `,d=t.is_whitelabel?"":`\n        <div\n          class="pushengage-opt-in__bell__tooltip__powered-by"\n          id="pushengage-opt-in-${e.optin_type}-powered-by"\n        >\n          Powered by <strong>${n.brandName}</strong>\n        </div>\n      `;return`\n    <div\n      id="pushengage-opt-in-${e.optin_type}-tooltip"\n      class="pushengage-opt-in__tooltip pushengage-opt-in__bell__tooltip"\n      style="${(0,s.getStyleForHtmlElement)(r)}"\n    >\n      <div class="pushengage-opt-in__bell__tooltip__title">${e.optin_title}</div>\n      ${i} ${o} ${d}\n    </div>\n  `})({optIn:e,site:t})}\n    </div>\n  `},t.attachTooltipEventToBell=({optIn:e,site:t})=>{const i=`pushengage-opt-in-${e.optin_type}-bell`,n=`pushengage-opt-in-${e.optin_type}-tooltip`,a=Array.isArray(e.optin_segments)&&e.optin_segments.length||!t.is_whitelabel,d=(0,o.getElementById)(i),c=(0,o.getElementById)(n);if(!d||!c)return;const l=(0,r.detectDeviceType)(),u="pushengage-opt-in__tooltip--opened";if("desktop"===l){let e=!1,t=!1;d.addEventListener("mouseover",(()=>{t=!0,(0,s.showTooltipView)({tooltipId:n,targetId:i})})),d.addEventListener("mouseleave",(()=>{t=!1,setTimeout((()=>{e||c.classList.remove(u)}),500)})),a&&(d.addEventListener("click",(()=>{c.classList.contains(u)?c.classList.remove(u):(0,s.showTooltipView)({tooltipId:n,targetId:i})})),c.addEventListener("mouseover",(()=>{e=!0})),c.addEventListener("mouseleave",(()=>{setTimeout((()=>{e=!1,t||c.classList.remove(u)}),300)})))}else d.addEventListener("click",(()=>{c.classList.contains(u)?c.classList.remove(u):((0,s.showTooltipView)({tooltipId:n,targetId:i}),a||setTimeout((()=>{c.classList.remove(u)}),1e3))}),{passive:!0})}},3468:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFloatingBarView=void 0;const n=i(1920),o=i(3609),s=i(7156),r=i(9340),a=i(4014);t.getFloatingBarView=({optIn:e,site:t})=>{const i=(0,o.getColorTheme)(e.bg);let d=(0,n.detectDeviceType)();window.innerWidth<=650&&(d="mobile");const c=`pushengage-opt-in__floating-bar pushengage-opt-in__floating-bar--${e.placement} pushengage-opt-in__floating-bar--${d} pushengage-opt-in__floating-bar--${i}`;let l="";const u="#ffffff"===e.closeBtnBg?"1px solid #d8d8d8":`1px solid ${e.closeBtnBg}`,g=`visibility: hidden;\n  --opt-in-background-color: ${e.bg};\n  --allow-btn-background-color: ${e.allowBtnBg};\n  --close-btn-background-color: ${e.closeBtnBg};\n  --close-btn-border: ${u};\n  --opt-in-icon-url: url('${t.site_image}');\n  --checkbox-checked-tick-color: ${e.checkbox_tick_color};\n  --checkbox-unchecked--color: ${e.checkbox_bg};\n  --checkbox-checked-background-color: ${e.bg};\n  --opt-in-width: 100%;\n`;if(Array.isArray(e.optin_segments)&&e.optin_segments.length){const t=e.default_segment_selection?"checked":"";e.optin_segments.forEach(((i,n)=>{l+=`\n          <div class="pushengage-opt-in__checkbox" style="${"mobile"===d?"margin-top:"+(n>=2?"10px":"0px"):"margin:14px 17px 0 0"}">\n            <input\n              type="checkbox"\n              id="pushengage-opt-in__segment-${e.optin_type}-${n}"\n              value="${i}"\n              ${t}\n            />\n            <label for="pushengage-opt-in__segment-${e.optin_type}-${n}"\n              >${(0,a.capitalizeFirstLetter)(i)}</label\n            >\n          </div>\n        `})),l=`\n      <div\n        id="pushengage-opt-in-${e.optin_type}__segments"\n        class="pushengage-opt-in__floating-bar__segments"\n      >\n        ${l}\n      </div>\n    `}const p=t.is_whitelabel?"":`\n        <div\n          class="pushengage-opt-in__floating-bar__powered-by"\n          id="pushengage-opt-in-${e.optin_type}-powered-by"\n        >\n          Powered by <strong>${r.brandName}</strong>\n        </div>\n      `;return`\n    <div\n      id="pushengage-opt-in-${e.optin_type}"\n      class="${c}"\n      style="${(0,s.getStyleForHtmlElement)(g)}"\n    >\n      ${"desktop"===d?`\n            <div class="pushengage-opt-in__floating-bar__content">\n              ${t.site_image?'<div class="pushengage-opt-in__floating-bar__icon__container">\n                    <div class="pushengage-opt-in__floating-bar__icon"></div>\n                  </div>':`<div\n                    class="pushengage-opt-in__floating-bar__icon__container pushengage-opt-in__floating-bar__icon__container--default-icon"\n                  >\n                    ${r.bellIcon}\n                  </div>`}\n\n              <div>\n                <div class="pushengage-opt-in__floating-bar__title">${e.optin_title}</div>\n                ${l}\n              </div>\n            </div>\n\n            <div class="pushengage-opt-in__floating-bar__button">\n              <div\n                class="pushengage-opt-in__floating-bar__button__allow"\n                id="pushengage-opt-in-${e.optin_type}-allow"\n              >\n                ${e.optin_allow_btn_txt}\n              </div>\n              <div\n                class="pushengage-opt-in__floating-bar__button__close"\n                id="pushengage-opt-in-${e.optin_type}-close"\n              >\n                ${e.optin_close_btn_txt}\n              </div>\n            </div>\n          `:`\n            <div class="pushengage-opt-in__floating-bar__content">\n              ${t.site_image?'<div class="pushengage-opt-in__floating-bar__icon__container">\n                    <div class="pushengage-opt-in__floating-bar__icon"></div>\n                  </div>':`<div\n                    class="pushengage-opt-in__floating-bar__icon__container pushengage-opt-in__floating-bar__icon__container--default-icon"\n                  >\n                    ${r.bellIcon}\n                  </div>`}\n\n              <div class="pushengage-opt-in__floating-bar__title">${e.optin_title}</div>\n            </div>\n\n            ${l}\n\n            <div class="pushengage-opt-in__floating-bar__button">\n              <div\n                class="pushengage-opt-in__floating-bar__button__allow"\n                id="pushengage-opt-in-${e.optin_type}-allow"\n              >\n                ${e.optin_allow_btn_txt}\n              </div>\n              <div\n                class="pushengage-opt-in__floating-bar__button__close"\n                id="pushengage-opt-in-${e.optin_type}-close"\n              >\n                ${e.optin_close_btn_txt}\n              </div>\n            </div>\n          `}\n      ${p}\n    </div>\n  `}},6001:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLargeSafariStyleView=void 0;const n=i(1920),o=i(3609),s=i(7156),r=i(9340),a=i(4014);t.getLargeSafariStyleView=({optIn:e,site:t})=>{const i=(0,n.detectDeviceType)(),d=`pushengage-opt-in__large-safari-style pushengage-opt-in__large-safari-style--${i} pushengage-opt-in__large-safari-style--${(0,o.getColorTheme)(e.bg)}`;let c,l="";c="desktop"===i&&window.innerWidth>390?"390px":"mobile"===i&&window.innerWidth>360?"360px":`${window.innerWidth}px`;const u="#ffffff"===e.closeBtnBg?"1px solid #d8d8d8":`1px solid ${e.closeBtnBg}`,g=e.checkbox_tick_color===e.bg?e.checkbox_bg:e.checkbox_tick_color,p=`visibility: hidden;\n  --opt-in-width: ${c};\n  --opt-in-background-color: ${e.bg};\n  --allow-btn-background-color: ${e.allowBtnBg};\n  --close-btn-background-color: ${e.closeBtnBg};\n  --close-btn-border: ${u};\n  --opt-in-icon-url: url('${t.site_image}');\n  --checkbox-checked-tick-color: ${g};\n  --checkbox-unchecked--color: ${e.checkbox_bg};\n  --checkbox-checked-background-color: ${e.bg};\n`;if(Array.isArray(e.optin_segments)&&e.optin_segments.length){const t=e.default_segment_selection?"checked":"";e.optin_segments.forEach(((i,n)=>{l+=`\n          <div\n            class="pushengage-opt-in__checkbox"\n            style="margin-top:${n>=2?"10px":"0px"}"\n          >\n            <input\n              type="checkbox"\n              id="pushengage-opt-in__segment-${e.optin_type}-${n}"\n              value="${i}"\n              ${t}\n            />\n            <label for="pushengage-opt-in__segment-${e.optin_type}-${n}"\n              >${(0,a.capitalizeFirstLetter)(i)}</label\n            >\n          </div>\n        `})),l=`\n      <div\n        id="pushengage-opt-in-${e.optin_type}__segments"\n        class="pushengage-opt-in__large-safari-style__segments"\n      >\n        ${l}\n      </div>\n    `}const b=t.is_whitelabel?"":`\n        <div\n          class="pushengage-opt-in__large-safari-style__powered-by"\n          id="pushengage-opt-in-${e.optin_type}-powered-by"\n        >\n          Powered by <strong>${r.brandName}</strong>\n        </div>\n      `;return`\n    <div\n      id="pushengage-opt-in-${e.optin_type}"\n      class="${d}"\n      style="${(0,s.getStyleForHtmlElement)(p)}"\n    >\n      <div class="pushengage-opt-in__large-safari-style__content">\n        ${t.site_image?'<div class="pushengage-opt-in__large-safari-style__icon__container">\n              <div class="pushengage-opt-in__large-safari-style__icon"></div>\n            </div>':`<div\n              class="pushengage-opt-in__large-safari-style__icon__container pushengage-opt-in__large-safari-style__icon__container--default-icon"\n            >\n              ${r.bellIcon}\n            </div>`}\n\n        <div class="pushengage-opt-in__large-safari-style__title">${e.optin_title}</div>\n      </div>\n\n      ${l}\n\n      <div class="pushengage-opt-in__large-safari-style__button">\n        <div\n          class="pushengage-opt-in__large-safari-style__button__allow"\n          id="pushengage-opt-in-${e.optin_type}-allow"\n        >\n          ${e.optin_allow_btn_txt}\n        </div>\n        <div\n          class="pushengage-opt-in__large-safari-style__button__close"\n          id="pushengage-opt-in-${e.optin_type}-close"\n        >\n          ${e.optin_close_btn_txt}\n        </div>\n      </div>\n\n      ${b}\n    </div>\n  `}},7535:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSafariStyleView=void 0;const n=i(3609),o=i(7156),s=i(9340),r=i(4014);t.getSafariStyleView=({optIn:e,site:t})=>{const i=(0,n.getColorTheme)(e.bg),a=`pushengage-opt-in__safari-style pushengage-opt-in__safari-style--${e.placement} pushengage-opt-in__safari-style--${i}`,d="#ffffff"===e.closeBtnBg?"1px solid #d8d8d8":`1px solid ${e.closeBtnBg}`,c=`visibility: hidden;\n  --opt-in-width: ${window.innerWidth>370?370:window.innerWidth}px;\n  --opt-in-background-color: ${e.bg};\n  --allow-btn-background-color: ${e.allowBtnBg};\n  --close-btn-background-color: ${e.closeBtnBg};\n  --close-btn-border: ${d};\n  --opt-in-icon-url: url('${t.site_image}');\n  --checkbox-checked-tick-color: ${e.checkbox_tick_color};\n  --checkbox-unchecked--color: ${e.checkbox_bg};\n  --checkbox-checked-background-color: ${e.bg};\n`;let l="";if(Array.isArray(e.optin_segments)&&e.optin_segments.length){const t=e.default_segment_selection?"checked":"";e.optin_segments.forEach(((i,n)=>{l+=`\n          <div\n            class="pushengage-opt-in__checkbox"\n            style="margin-top:${n>=2?"10px":"0px"}"\n          >\n            <input\n              type="checkbox"\n              id="pushengage-opt-in__segment-${e.optin_type}-${n}"\n              value="${i}"\n              ${t}\n            />\n            <label for="pushengage-opt-in__segment-${e.optin_type}-${n}"\n              >${(0,r.capitalizeFirstLetter)(i)}</label\n            >\n          </div>\n        `})),l=`\n      <div\n        id="pushengage-opt-in-${e.optin_type}__segments"\n        class="pushengage-opt-in__safari-style__segments"\n      >\n        ${l}\n      </div>\n    `}const u=t.is_whitelabel?"":`\n        <div\n          class="pushengage-opt-in__safari-style__powered-by"\n          id="pushengage-opt-in-${e.optin_type}-powered-by"\n        >\n          Powered by <strong>${s.brandName}</strong>\n        </div>\n      `;return`\n    <div\n      id="pushengage-opt-in-${e.optin_type}"\n      class="${a}"\n      style="${(0,o.getStyleForHtmlElement)(c)}"\n    >\n      <div class="pushengage-opt-in__safari-style__content">\n        ${t.site_image?'<div class="pushengage-opt-in__safari-style__icon__container">\n              <div class="pushengage-opt-in__safari-style__icon"></div>\n            </div>':`<div\n              class="pushengage-opt-in__safari-style__icon__container pushengage-opt-in__safari-style__icon__container--default-icon"\n            >\n              ${s.bellIcon}\n            </div>`}\n\n        <div class="pushengage-opt-in__safari-style__title">${e.optin_title}</div>\n      </div>\n\n      ${l}\n\n      <div class="pushengage-opt-in__safari-style__button">\n        <div\n          class="pushengage-opt-in__safari-style__button__allow"\n          id="pushengage-opt-in-${e.optin_type}-allow"\n        >\n          ${e.optin_allow_btn_txt}\n        </div>\n        <div\n          class="pushengage-opt-in__safari-style__button__close"\n          id="pushengage-opt-in-${e.optin_type}-close"\n        >\n          ${e.optin_close_btn_txt}\n        </div>\n      </div>\n\n      ${u}\n    </div>\n  `}},9107:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSleekOptInBox=void 0;const n=i(9340),o=i(3609),s=i(7156),r=i(4014);t.getSleekOptInBox=({optIn:e,site:t})=>{const i=(0,o.getColorTheme)(e.bg),a=`pushengage-opt-in__sleek-opt-in-box pushengage-opt-in__sleek-opt-in-box--${e.placement} pushengage-opt-in__sleek-opt-in-box--${i}`,d=`visibility: hidden;\n   --opt-in-width: ${window.innerWidth>370?370:window.innerWidth}px;\n  --opt-in-background-color: ${e.bg};\n  --allow-btn-background-color: ${e.allowBtnBg};\n  --close-btn-background-color: ${e.closeBtnBg};\n  --opt-in-icon-url: url('${t.site_image}');\n  --checkbox-checked-tick-color: ${e.checkbox_tick_color};\n  --checkbox-unchecked--color: ${e.checkbox_bg};\n  --checkbox-checked-background-color: ${e.bg};\n`;let c="";if(Array.isArray(e.optin_segments)&&e.optin_segments.length){const t=e.default_segment_selection?"checked":"";e.optin_segments.forEach(((i,n)=>{c+=`\n          <div\n            class="pushengage-opt-in__checkbox"\n            style="margin-top:${n>=2?"10px":"0px"}"\n          >\n            <input\n              type="checkbox"\n              id="pushengage-opt-in__segment-${e.optin_type}-${n}"\n              value="${i}"\n              ${t}\n            />\n            <label for="pushengage-opt-in__segment-${e.optin_type}-${n}"\n              >${(0,r.capitalizeFirstLetter)(i)}</label\n            >\n          </div>\n        `})),c=`\n      <div\n        id="pushengage-opt-in-${e.optin_type}__segments"\n        class="pushengage-opt-in__sleek-opt-in-box__segments"\n      >\n        ${c}\n      </div>\n    `}const l=t.is_whitelabel?"":`\n        <div\n          class="pushengage-opt-in__sleek-opt-in-box__powered-by"\n          id="pushengage-opt-in-${e.optin_type}-powered-by"\n        >\n          Powered by <strong>${n.brandName}</strong>\n        </div>\n      `;return`\n    <div\n      id="pushengage-opt-in-${e.optin_type}"\n      class="${a}"\n      style="${(0,s.getStyleForHtmlElement)(d)}"\n    >\n      <div class="pushengage-opt-in__sleek-opt-in-box__body">\n        <div class="pushengage-opt-in__sleek-opt-in-box__header">\n          <div class="pushengage-opt-in__sleek-opt-in-box__header__title">\n            <div class="pushengage-opt-in__sleek-opt-in-box__bell-icon">${n.bellIcon}</div>\n            <div class="pushengage-opt-in__sleek-opt-in-box__site-name">${e.site_name}</div>\n          </div>\n          <div\n            class="pushengage-opt-in__sleek-opt-in-box__close-icon"\n            id="pushengage-opt-in-${e.optin_type}-close"\n          >\n            ${n.closeIcon}\n          </div>\n        </div>\n\n        <div class="pushengage-opt-in__sleek-opt-in-box__content">\n          <div class="pushengage-opt-in__sleek-opt-in-box__title">${e.optin_title}</div>\n          ${t.site_image?'<div class="pushengage-opt-in__sleek-opt-in-box__icon__container">\n                <div class="pushengage-opt-in__sleek-opt-in-box__icon"></div>\n              </div>':`<div\n                class="pushengage-opt-in__sleek-opt-in-box__icon__container pushengage-opt-in__sleek-opt-in-box__icon__container--default-icon"\n              >\n                ${n.bellIcon}\n              </div>`}\n        </div>\n\n        ${c}\n\n        <div class="pushengage-opt-in__sleek-opt-in-box__button">\n          <div\n            class="pushengage-opt-in__sleek-opt-in-box__button__allow"\n            id="pushengage-opt-in-${e.optin_type}-allow"\n          >\n            ${e.optin_allow_btn_txt}\n          </div>\n        </div>\n\n        ${l}\n      </div>\n    </div>\n  `}},7888:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addOptInViewToPage=void 0;const n=i(7535),o=i(6001),s=i(3468),r=i(9107),a=i(2797),d=i(9340),c=i(3641),l=i(1920);t.addOptInViewToPage=({optIn:e,site:t})=>{let i;switch(e.optin_type){case d.optInTypes.safari:i=(0,n.getSafariStyleView)({optIn:e,site:t});break;case d.optInTypes.floatingBar:i=(0,s.getFloatingBarView)({optIn:e,site:t});break;case d.optInTypes.bell:i=(0,a.getBellPlacedBarView)({optIn:e,site:t});break;case d.optInTypes.singleStep:i=(0,a.getBellPlacedBarView)({site:t,optIn:Object.assign(e,e.bell)});break;case d.optInTypes.largeSafari:case d.optInTypes.largeSafariWithSegments:i=(0,o.getLargeSafariStyleView)({optIn:e,site:t});break;case d.optInTypes.sleekOptInBox:i=(0,r.getSleekOptInBox)({optIn:e,site:t})}if(i&&(0,c.addContentAfterBody)(i),e.optin_type!==d.optInTypes.bell&&e.optin_type!==d.optInTypes.singleStep||(0,a.attachTooltipEventToBell)({optIn:e,site:t}),"mobile"===(0,l.detectDeviceType)()&&(e.optin_type===d.optInTypes.largeSafari||e.optin_type===d.optInTypes.largeSafariWithSegments)){const t=document.getElementById(`pushengage-opt-in-${e.optin_type}`);if(t){const{offsetWidth:e,offsetHeight:i}=t,n=(window.innerWidth-e)/2,o=(window.innerHeight-i)/2;n>0?t.style.left=`${n}px`:(t.style.left="0",t.style.right="0"),o>0?t.style.top=`${o}px`:(t.style.top="0",t.style.bottom="0")}}}},7913:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addResetNotificationPermissionPopupViewToPage=void 0;const n=i(3609),o=i(1920),s=i(3641),r=i(7156),a=i(9340);t.addResetNotificationPermissionPopupViewToPage=e=>{const t=(e=>{const t=(0,n.getColorTheme)(e.background_color),{name:i}=(0,o.detectBrowser)(),d=(0,o.detectDeviceType)(),c="#ffffff"===e.close_button_background_color?"1px solid #d8d8d8":`1px solid ${e.close_button_background_color}`,l=`visibility: hidden;\n    --popup-width: ${window.innerWidth>620?580:window.innerWidth-20}px;\n    --popup-background-color: ${e.background_color};\n    --retry-btn-background-color: ${e.retry_button_background_color};\n    --close-btn-background-color: ${e.close_button_background_color};\n    --close-btn-border: ${c};\n    --instruction-url: url('${(({variants:e,deviceType:t,browserName:i})=>{const n=e.find((e=>e.platform===`${t}-${i.toLowerCase()}`));if(!n){const i=e.find(();return null==i?void 0:i.url}return n.url})({deviceType:d,browserName:i,variants:e.variants})}');\n  `;return`<div\n    id="pushengage-reset-notification-permission-popup"\n    class="pushengage-reset-notification-permission-popup pushengage-reset-notification-permission-popup--${t} pushengage-reset-notification-permission-popup--${d}"\n    style="${(0,r.getStyleForHtmlElement)(l)}"\n  >\n    <div class="pushengage-reset-notification-permission-popup__title">\n      ${(({message:e,variants:t,deviceType:i,browserName:n})=>{const o=t.find((e=>e.platform===`${i}-${n.toLowerCase()}`));let r=e;return(null==o?void 0:o.message)&&(r=(0,s.richEditorHasNoValue)(o.message)?e:o.message),r})({deviceType:d,browserName:i,message:e.message,variants:e.variants})}\n    </div>\n\n    <div class="pushengage-reset-notification-permission-popup__image__container">\n      <div class="pushengage-reset-notification-permission-popup__image"></div>\n    </div>\n\n    <div class="pushengage-reset-notification-permission-popup__button">\n      <div\n        class="pushengage-reset-notification-permission-popup__button__retry"\n        id="pushengage-reset-notification-permission-popup-retry"\n      >\n        <span\n          class="pushengage-reset-notification-permission-popup__button__retry__loading"\n          id="pushengage-reset-notification-permission-popup-retry-loading"\n          >${a.loadingIcon}</span\n        >\n        ${e.retry_button_label}\n      </div>\n      <div\n        class="pushengage-reset-notification-permission-popup__button__close"\n        id="pushengage-reset-notification-permission-popup-close"\n      >\n        ${e.close_button_label}\n      </div>\n    </div>\n  </div>`})(e);(0,s.addContentAfterBody)(t)}},9288:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addSubscriberRecoveryBellWidgetToPage=t.addSubscriberRecoveryButtonWidgetToPage=void 0;const n=i(7156),o=i(3641),s=i(9340),r=i(3609),a=i(1920);t.addSubscriberRecoveryButtonWidgetToPage=({widget:e,site:t})=>{const i=(({widget:e,site:t})=>{const i=(0,r.getColorTheme)(e.bg),o=(0,a.detectDeviceType)(),d=e.desktop_position,c="desktop"===o?e.desktop_placement:e.mobile_placement,l=`visibility: hidden;\n    --widget-background-color: ${e.bg};\n    --widget-color: ${e.color};`,u=t.is_whitelabel?"":`\n        <div\n          class="pushengage-subscriber-recovery-widget__powered-by"\n          id="pushengage-subscriber-recovery-widget-powered-by"\n        >\n          Powered by <strong>${s.brandName}</strong>\n        </div>\n      `;return`\n    <div\n      id="pushengage-subscriber-recovery-widget"\n      class="pushengage-subscriber-recovery-widget pushengage-subscriber-recovery-widget--${d}-${c} pushengage-subscriber-recovery-widget--button pushengage-subscriber-recovery-widget--${i}"\n      style="${(0,n.getStyleForHtmlElement)(l)}"\n    >\n      <div class="pushengage-subscriber-recovery-widget__body">\n        <div class="pushengage-subscriber-recovery-widget__bell-icon">${s.bellIcon}</div>\n        <div\n          class="pushengage-subscriber-recovery-widget__title"\n          id="pushengage-subscriber-recovery-widget-button"\n        >\n          ${e.label}\n        </div>\n\n        ${u}\n      </div>\n\n      <div\n        class="pushengage-subscriber-recovery-widget__close-icon"\n        id="pushengage-subscriber-recovery-widget-close-button"\n      >\n        ${s.closeIcon}\n      </div>\n    </div>\n  `})({widget:e,site:t});(0,o.addContentAfterBody)(i),(()=>{const e="pushengage-subscriber-recovery-widget",t=(0,o.getElementById)(e),i=(0,o.getElementById)(`${e}-powered-by`);t&&t.style.setProperty("--widget-width",`${t.offsetWidth}px`),null==i||i.addEventListener("click",(()=>{window.open(s.poweredByReferralUrl,"_blank")}))})()},t.addSubscriberRecoveryBellWidgetToPage=({widget:e,site:t})=>{const i=(({widget:e,site:t})=>{const i="bl"===e.position?"left":"right",o=`visibility: hidden;\n  --bell-background-color: ${e.bg};\n  --bell-color: ${e.color};\n  --bell-height: 50px;\n  --bell-width: 50px;\n  --bell-right:30px;\n  --bell-left:30px;\n  --bell-bottom:50px;\n`;return`\n    <div\n      id="pushengage-subscriber-recovery-widget"\n      class="pushengage-subscriber-recovery-widget pushengage-subscriber-recovery-widget--bell"\n      style="${(0,n.getStyleForHtmlElement)(o)}"\n    >\n      <div\n        id="pushengage-subscriber-recovery-widget-bell"\n        class="pushengage-opt-in__bell pushengage-opt-in__bell--${i}"\n      >\n        <div class="pushengage-opt-in__bell__icon">${s.bellIcon}</div>\n      </div>\n\n      <div\n        id="pushengage-subscriber-recovery-widget-tooltip"\n        class="pushengage-opt-in__tooltip pushengage-subscriber-recovery-widget__tooltip"\n      >\n        <div class="pushengage-subscriber-recovery-widget__tooltip__title">${e.label}</div>\n\n        ${t.is_whitelabel?"":`\n              <div\n                class="pushengage-subscriber-recovery-widget__tooltip__powered-by"\n                id="pushengage-subscriber-recovery-widget-powered-by"\n              >\n                Powered by <strong>${s.brandName}</strong>\n              </div>\n            `}\n      </div>\n    </div>\n  `})({widget:e,site:t});(0,o.addContentAfterBody)(i),(e=>{const t="pushengage-subscriber-recovery-widget",i=`${t}-bell`,r=`${t}-tooltip`,d=(0,o.getElementById)(i),c=(0,o.getElementById)(r),l=(0,o.getElementById)(t),u=(0,o.getElementById)(`${t}-powered-by`);if(!d||!c||!l)return;const g=(0,a.detectDeviceType)(),p="pushengage-opt-in__tooltip--opened",b=!e.is_whitelabel;if("desktop"===g){let e=!1,t=!1;d.addEventListener("mouseover",(()=>{t=!0,(0,n.showTooltipView)({targetId:i,tooltipId:r})})),d.addEventListener("mouseleave",(()=>{t=!1,setTimeout((,500)})),b&&(c.addEventListener("mouseleave",(()=>{setTimeout((()=>{e=!1,t||c.classList.remove(p)}),300)})),c.addEventListener("mouseover",())}else d.addEventListener("click",(()=>{(0,n.showTooltipView)({targetId:i,tooltipId:r}),b||setTimeout((()=>{c.classList.remove(p)}),1e3)}));null==u||u.addEventListener("click",(()=>{window.open(s.poweredByReferralUrl,"_blank")}))})(t)}},6086:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.refreshSubscriptionManagementWidgetView=void 0;const n=i(3641),o=i(3609),s=i(9340),r=i(7156),a=i(1920),d=i(4014);t.refreshSubscriptionManagementWidgetView=({widgetId:e,site:t,widget:i,notificationPermission:c,subscriberData:l})=>{const u=`${e}-opt-in`,g="pushengage-opt-in__popover--opened",p=(0,n.getElementById)(e),b=(({widget:e,notificationPermission:t,subscriberData:i,site:n,widgetId:a})=>{var c,l,u,g,p,b,f,v,m,_,h,y,w,S;const I=(0,o.getColorTheme)(e.modal_background_color),P=(null===(c=e.trigger_button)||void 0===c?void 0:c.z_index)||2147483640;let E=46,O=48;if(null===(l=e.trigger_button)||void 0===l?void 0:l.size)switch(e.trigger_button.size){case"small":E=36,O=38;break;case"large":E=56,O=58;break;default:E=46,O=48}const k=`\n  --bell-background-color: ${null===(u=e.trigger_button)||void 0===u?void 0:u.icon_background_color};\n  --bell-color: ${null===(g=e.trigger_button)||void 0===g?void 0:g.icon_color};\n  --bell-bottom: ${Math.min((null===(p=e.trigger_button)||void 0===p?void 0:p.offset_bottom)||0,window.innerHeight-E)}px;\n  --bell-top: ${Math.min((null===(b=e.trigger_button)||void 0===b?void 0:b.offset_top)||0,window.innerHeight-E)}px;\n  --z-index: ${P};\n  --bell-height: ${E}px;\n  --bell-width: ${O}px;\n`,A=`\n  --popover-background-color: ${e.modal_background_color};\n  --popover-color: ${e.modal_text_color};\n  --opt-in-close-icon-color: ${e.modal_text_color};\n  --switch-checked-background-color: ${e.on_switch_color};\n  --switch-unchecked-background-color:${e.off_switch_color};\n  --z-index: ${P+1};\n`,D="#ffffff"===(null===(f=e.unsubscribe_options)||void 0===f?void 0:f.cancel_button_background_color)?"1px solid #d8d8d8":`1px solid ${null===(v=e.unsubscribe_options)||void 0===v?void 0:v.cancel_button_background_color}`,T=`\n  --popover-background-color: ${e.modal_background_color};\n  --popover-color: ${e.modal_text_color};\n  --allow-btn-background-color: ${null===(m=e.unsubscribe_options)||void 0===m?void 0:m.ok_button_background_color};\n  --close-btn-background-color: ${null===(_=e.unsubscribe_options)||void 0===_?void 0:_.cancel_button_background_color};\n  --allow-btn-color: ${null===(h=e.unsubscribe_options)||void 0===h?void 0:h.ok_button_text_color};\n  --close-btn-color: ${null===(y=e.unsubscribe_options)||void 0===y?void 0:y.cancel_button_text_color};\n  --close-btn-border: ${D};\n  --z-index: ${P+2};\n`,R=e.trigger_button?"":"pushengage-subscription-management-widget__opt-in--center pushengage-opt-in__popover--opened";let N="";if(Array.isArray(null===(w=e.segment_preference)||void 0===w?void 0:w.segments)&&(null===(S=e.segment_preference)||void 0===S?void 0:S.segments.length)){let n="";1==e.segment_preference.segments.length&&(n="flex-basis: 100%;"),e.segment_preference.segments.forEach(((o,s)=>{var r;let c;c="granted"===t?((null==i?void 0:i.segments)||[]).includes(o)?"checked":"":(null===(r=e.segment_preference)||void 0===r?void 0:r.default_segment_selection)?"checked":"",N+=`\n          <div\n            class="pushengage-opt-in__checkbox pushengage-opt-in__checkbox--small"\n            style="${n+"margin-top:"+(s>=2?"7px":"0px")}"\n          >\n            <input\n              type="checkbox"\n              id="${a}-opt-in-segment-${s}"\n              value="${o}"\n              ${c}\n            />\n            <label for="${a}-opt-in-segment-${s}"\n              >${(0,d.capitalizeFirstLetter)(o)}</label\n            >\n          </div>\n        `}));const o="#ecebee"===e.segment_preference.checkbox_background_color&&"#ffffff"===e.modal_background_color?"#ACB7C8":e.segment_preference.checkbox_background_color,s=`\n      --checkbox-checked-tick-color: ${e.segment_preference.checkbox_tick_color};\n      --checkbox-unchecked--color: ${o};\n      --checkbox-checked-background-color: ${e.modal_background_color};\n    `;N=`\n      <div\n        class="pushengage-subscription-management-widget__opt-in__segment"\n        id="${a}-opt-in-segment"\n        style="${(0,r.getStyleForHtmlElement)(s)}"\n      >\n        <div class="pushengage-subscription-management-widget__opt-in__segment__title">\n          ${e.segment_preference.title}\n        </div>\n\n        <div class="pushengage-subscription-management-widget__opt-in__segment__segments">\n          ${N}\n        </div>\n      </div>\n    `}return`<div\n    id="${a}"\n    class="pushengage-subscription-management-widget pushengage-subscription-management-widget--${I}"\n    style="visibility: hidden;"\n  >\n    ${e.trigger_button?`<div\n            class="pushengage-subscription-management-widget__bell pushengage-subscription-management-widget__bell--${e.trigger_button.size} \n            pushengage-subscription-management-widget__bell--${e.trigger_button.position_x} pushengage-subscription-management-widget__bell--${e.trigger_button.position_y}"\n            id="${a}-bell"\n            style="${(0,r.getStyleForHtmlElement)(k)}"\n          >\n            ${(e=>{let t;switch(e){case"bell":t=s.bellIcon;break;case"bell_badge":t=s.bellBadgeIcon;break;case"bell_check":t=s.bellCheckIcon;break;case"bell_circle":t=s.bellCircleIcon;break;case"bell_plus":t=s.bellPlusIcon;break;case"bell_ring":t=s.bellRingIcon;break;default:t=s.bellSettingIcon}return t})(e.trigger_button.icon_type)}\n          </div>\n\n          <div\n            id="${a}-tooltip"\n            class="pushengage-opt-in__tooltip pushengage-subscription-management-widget__tooltip"\n          >\n            <div class="pushengage-subscription-management-widget__tooltip__title">\n              ${e.title}\n            </div>\n          </div>`:""}\n    ${e.unsubscribe_options?`<div\n          class="pushengage-opt-in__popover pushengage-opt-in__popover--left pushengage-subscription-management-widget__unsubscribe__popover"\n          id="${a}-unsubscribe-popover"\n          style="${(0,r.getStyleForHtmlElement)(T)}"\n        >\n          <div class="pushengage-subscription-management-widget__unsubscribe__popover__title">\n            ${e.unsubscribe_options.confirm_message}\n          </div>\n          <div class="pushengage-subscription-management-widget__unsubscribe__popover__button">\n            <div\n              class="pushengage-subscription-management-widget__unsubscribe__popover__button_allow"\n              id="${a}-unsubscribe-allow-button"\n            >\n              ${e.unsubscribe_options.ok_text}\n            </div>\n\n            <div\n              class="pushengage-subscription-management-widget__unsubscribe__popover__button_close"\n              id="${a}-unsubscribe-close-button"\n            >\n              ${e.unsubscribe_options.cancel_text}\n            </div>\n          </div>\n        </div>`:""}\n    <div\n      id="${a}-opt-in"\n      class="pushengage-opt-in__popover pushengage-opt-in__popover--beside pushengage-subscription-management-widget__opt-in pushengage-subscription-management-widget__opt-in--${t} ${R}"\n      style="${(0,r.getStyleForHtmlElement)(A)}"\n    >\n      <div class="pushengage-subscription-management-widget__opt-in__header">\n        <div class="pushengage-subscription-management-widget__opt-in__title">${e.title}</div>\n\n        ${e.trigger_button?"":`<div\n              class="pushengage-subscription-management-widget__opt-in__close"\n              id="${a}-opt-in-close"\n            >\n              ${s.closeIcon}\n            </div>`}\n      </div>\n\n      <div\n        class="pushengage-subscription-management-widget__opt-in__subscribe pushengage-opt-in__switch pushengage-opt-in__switch--small"\n        id="${a}-opt-in-subscribe"\n      >\n        <label class="pushengage-opt-in__switch__label">\n          <input type="checkbox" />\n          <span class="pushengage-opt-in__switch__slider"></span>\n        </label>\n\n        <div class="pushengage-opt-in__switch__label-title">${e.allow_text}</div>\n      </div>\n\n      ${e.unsubscribe_options?`<div\n            class="pushengage-subscription-management-widget__opt-in__unsubscribe pushengage-opt-in__switch pushengage-opt-in__switch--small"\n            id="${a}-opt-in-unsubscribe"\n          >\n            <label class="pushengage-opt-in__switch__label">\n              <input type="checkbox" checked />\n              <span class="pushengage-opt-in__switch__slider"></span>\n            </label>\n\n            <div class="pushengage-opt-in__switch__label-title">${e.allow_text}</div>\n          </div>`:""}\n      ${e.personal_notification_options?`<div\n            class="pushengage-subscription-management-widget__opt-in__auto-notification pushengage-opt-in__switch pushengage-opt-in__switch--small"\n            id="${a}-opt-in-auto-notification"\n          >\n            <label class="pushengage-opt-in__switch__label">\n              <input type="checkbox" ${(null==i?void 0:i.trigger_status)?"checked":""} />\n              <span class="pushengage-opt-in__switch__slider"></span>\n            </label>\n\n            <div class="pushengage-opt-in__switch__label-title">\n              ${e.personal_notification_options.label}\n            </div>\n          </div>`:""}\n      ${N}\n      ${n.is_whitelabel?"":`\n            <div\n              class="pushengage-subscription-management-widget__opt-in__powered-by"\n              id="${a}-opt-in-powered-by"\n            >\n              Powered by <strong>${s.brandName}</strong>\n            </div>\n          `}\n    </div>\n  </div>`})({widgetId:e,site:t,widget:i,notificationPermission:c,subscriberData:l});let f;if(p){const t=(0,n.getElementById)(u);(null==t?void 0:t.classList.contains(g))&&(f=t.style.cssText),(0,n.removeElement)(e)}if((0,n.addContentAfterBody)(b),f){const e=(0,n.getElementById)(u);e&&(e.classList.add(g),e.style.cssText=f)}(e=>{const t=`${e}-bell`,i=`${e}-tooltip`,o=`${e}-opt-in`,d=`${e}-opt-in-unsubscribe`,c=`${e}-unsubscribe-popover`,l=(0,n.getElementById)(t),u=(0,n.getElementById)(i),g=(0,n.getElementById)(o),p=(0,n.getElementById)(`${e}-opt-in-powered-by`),b=(0,n.getElementById)(`${e}-opt-in-close`),f=document.querySelector(`#${d} input[type="checkbox"]`),v=(0,n.getElementById)(c),m=(0,n.getElementById)(d),_="pushengage-opt-in__tooltip--opened",h="pushengage-opt-in__popover--opened",y="pushengage-opt-in__switch--spin";if(!g)return;const w=(0,a.detectDeviceType)();if(g.classList.contains("pushengage-subscription-management-widget__opt-in--center")){const e=window.innerHeight,t=window.innerWidth,i={width:t>g.offsetWidth?"max-content":`${t}px`};e<g.offsetHeight&&Object.assign(i,{top:"0px",bottom:"0px",transform:"translate(-50%, 0px)"}),(0,n.addCSSProperties)(o,i)}"desktop"===w?(null==l||l.addEventListener("mouseenter",(()=>{g.classList.contains(h)||(0,r.showTooltipView)({targetId:t,tooltipId:i})})),null==l||l.addEventListener("mouseleave",(()=>{null==u||u.classList.remove(_)})),null==l||l.addEventListener("click",(()=>{g.classList.contains(h)?(g.classList.remove(h),null==v||v.classList.remove(h),null==m||m.classList.remove(y),f.disabled=!1):((0,r.showPopoverView)({targetId:t,popoverId:o}),null==u||u.classList.remove(_))}))):null==l||l.addEventListener("click",(()=>{g.classList.contains(h)?(g.classList.remove(h),null==v||v.classList.remove(h),null==m||m.classList.remove(y),f.disabled=!1):(0,r.showPopoverView)({targetId:t,popoverId:o})})),null==p||p.addEventListener("click",(()=>{window.open(s.poweredByReferralUrl,"_blank")})),null==b||b.addEventListener("click",(()=>{(0,n.removeElement)(e)})),null==f||f.addEventListener("click",()})(e)}},7643:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addSubscriptionOverlayViewToPage=void 0;const n=i(9340),o=i(3609),s=i(3641),r=i(1920),a=i(7156);t.addSubscriptionOverlayViewToPage=({site:e,overlay:t})=>{const i=(({site:e,overlay:t})=>{const i=(0,o.getColorTheme)(t.pc_notice_bg),{name:s}=(0,r.detectBrowser)(),d=`visibility: hidden;\n    --opt-in-width: ${window.innerWidth>362?342:window.innerWidth-20}px;\n    --notice-background-color: ${t.pc_notice_bg};\n    --notice-color: ${t.pc_notice_color};\n    --opt-in-quieterUI-permission-image: url('${(e=>"Firefox"===e?n.quieterUIPermissionImage.firefox:n.quieterUIPermissionImage.chrome)(s)}');\n    --opt-in-image-height: ${"Firefox"===s?"60px":"101px"};\n    --overlay-background-color: rgba(0, 0, 0, 0.${t.opacity});\n  `,c=t.pc_notice?"pushengage-subscription-overlay--notice-enabled":"",l=e.is_whitelabel?"":`\n        <div\n          class="pushengage-subscription-overlay__powered-by"\n          id="pushengage-subscription-overlay-powered-by"\n        >\n          Powered by <strong>${n.brandName}</strong>\n        </div>\n      `;return`<div\n    id="pushengage-subscription-overlay"\n    class="pushengage-subscription-overlay pushengage-subscription-overlay--${i} ${c}"\n    style="${(0,a.getStyleForHtmlElement)(d)}"\n  >\n    ${l}\n\n    <div\n      class="pushengage-subscription-overlay__close-btn"\n      id="pushengage-subscription-overlay-close-button"\n    >\n      ${n.closeIcon}\n    </div>\n\n    <div class="pushengage-subscription-overlay_opt-in">\n      ${"Safari"!==s?'<div class="pushengage-subscription-overlay_opt-in_image"></div>':""}\n\n      <div class="pushengage-subscription-overlay_opt-in_message">${t.label}</div>\n    </div>\n\n    <div class="pushengage-subscription-overlay__notice">\n      <div class="pushengage-subscription-overlay__notice__title">${t.pc_notice_text}</div>\n    </div>\n  </div>`})({site:e,overlay:t});(0,s.addContentAfterBody)(i),(()=>{const e="pushengage-subscription-overlay",t=(0,s.getElementById)(`${e}-powered-by`),i=(0,s.getElementById)(`${e}-close-button`);null==t||t.addEventListener("click",(()=>{window.open(n.poweredByReferralUrl,"_blank")})),null==i||i.addEventListener("click",()})()}},8312:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addSubscriptionReminderPromptViewToPage=void 0;const n=i(3609),o=i(3641),s=i(9340),r=i(7156),a=i(1920);t.addSubscriptionReminderPromptViewToPage=({reminderPrompt:e,site:t})=>{const i=(({reminderPrompt:e,site:t})=>{const i=(0,n.getColorTheme)(e.background),{name:o}=(0,a.detectBrowser)(),d=`visibility: hidden;\n    --opt-in-quieterUI-permission-image: url('${((o)}');\n    --opt-in-image-height: ${"Firefox"===o?"60px":"101px"};\n    --button-background-color: ${e.button_background};\n    --button-color: ${e.button_color};\n    --opt-in-background-color: ${e.background};\n    --opt-in-color: ${e.color};\n    --opt-in-width: ${window.innerWidth>362?342:window.innerWidth-20}px;\n  `,c=t.is_whitelabel?"":`\n        <div\n          class="pushengage-subscription-reminder-prompt__powered-by"\n          id="pushengage-subscription-reminder-prompt-powered-by"\n        >\n          Powered by <strong>${s.brandName}</strong>\n        </div>\n      `;return`<div\n    id="pushengage-subscription-reminder-prompt"\n    class="pushengage-subscription-reminder-prompt pushengage-subscription-reminder-prompt--${i} pushengage-subscription-reminder-prompt--${e.placement}"\n    style="${(0,r.getStyleForHtmlElement)(d)}"\n  >\n    <div class="pushengage-subscription-reminder-prompt__image"></div>\n\n    <div class="pushengage-subscription-reminder-prompt__content">\n      <div class="pushengage-subscription-reminder-prompt__message">\n        ${e.description}\n      </div>\n\n      <div\n        class="pushengage-subscription-reminder-prompt__button"\n        id="pushengage-subscription-reminder-prompt-button"\n      >\n        ${e.button}\n      </div>\n\n      ${c}\n    </div>\n  </div>`})({reminderPrompt:e,site:t});(0,o.addContentAfterBody)(i),(()=>{const e=(0,o.getElementById)("pushengage-subscription-reminder-prompt-powered-by");null==e||e.addEventListener("click",(()=>{window.open(s.poweredByReferralUrl,"_blank")}))})()}},5569:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addUnsubscribeWidgetButtonViewToPage=t.addUnsubscribeWidgetBellViewToPage=void 0;const n=i(7156),o=i(3641),s=i(9340),r=i(3609),a=i(1920);t.addUnsubscribeWidgetBellViewToPage=({widget:e,automatedNotification:t,site:i})=>{const r=(({widget:e,automatedNotification:t,site:i})=>{const o="bl"===e.position?"left":"right",r=`visibility: hidden;\n  --bell-background-color: ${e.bg};\n  --bell-color: ${e.color};\n  --bell-height: 50px;\n  --bell-width: 50px;\n  --bell-right:30px;\n  --bell-left:30px;\n  --bell-bottom:50px;\n  --switch-checked-background-color: ${"#ffffff"===e.color?e.bg:e.color};\n  --switch-unchecked-background-color: #BFBFBF;\n  --popover-background-color: #ffffff;\n  --popover-color: #0d0d0d;\n`,a=t?"checked":"";return`\n    <div\n      id="pushengage-unsubscribe-widget"\n      class="pushengage-unsubscribe-widget pushengage-unsubscribe-widget--${o} pushengage-unsubscribe-widget--bell ${t?"pushengage-unsubscribe-widget--automated-notification-enabled":""}"\n      style="${(0,n.getStyleForHtmlElement)(r)}"\n    >\n      <div\n        id="pushengage-unsubscribe-widget-bell"\n        class="pushengage-opt-in__bell pushengage-opt-in__bell--${o}"\n      >\n        <div class="pushengage-opt-in__bell__icon">${s.bellIcon}</div>\n      </div>\n\n      <div\n        id="pushengage-unsubscribe-widget-tooltip"\n        class="pushengage-opt-in__tooltip pushengage-unsubscribe-widget__tooltip"\n      >\n        <div\n          class="pushengage-unsubscribe-widget__tooltip__title pushengage-unsubscribe-widget__tooltip-msg"\n        >\n          ${e.unsubMsg}\n        </div>\n        <div\n          class="pushengage-unsubscribe-widget__tooltip__title pushengage-unsubscribe-widget__tooltip-thanks-msg"\n        >\n          ${e.thankMsg}\n        </div>\n      </div>\n\n      <div\n        class="pushengage-opt-in__popover pushengage-unsubscribe-widget__opt-in"\n        id="pushengage-unsubscribe-widget-opt-in"\n      >\n        <div class="pushengage-unsubscribe-widget__title">${e.boxTitle}</div>\n\n        ${e.unSubPersonalNoti?`\n              <div\n                class="pushengage-unsubscribe-widget__switch pushengage-opt-in__switch pushengage-opt-in__switch--small"\n              >\n                <label\n                  class="pushengage-opt-in__switch__label"\n                  id="pushengage-unsubscribe-widget-automated-notification"\n                >\n                  <input type="checkbox" ${a} />\n                  <span class="pushengage-opt-in__switch__slider"></span>\n                </label>\n                <div\n                  class="pushengage-opt-in__switch__label-title pushengage-opt-in__switch__label-title--enabled"\n                >\n                  ${e.unSubPersonalNotiUnsubBtnMsg}\n                </div>\n                <div\n                  class="pushengage-opt-in__switch__label-title pushengage-opt-in__switch__label-title--disabled"\n                >\n                  ${e.unSubPersonalNotiSubBtnMsg}\n                </div>\n              </div>\n            `:""}\n\n        <div\n          class="pushengage-unsubscribe-widget__button"\n          id="pushengage-unsubscribe-widget-unsubscribe-button"\n        >\n          ${e.unsubBtnMsg}\n        </div>\n\n        ${i.is_whitelabel?"":`\n              <div\n                class="pushengage-unsubscribe-widget__powered-by"\n                id="pushengage-unsubscribe-widget-powered-by"\n              >\n                Powered by <strong>${s.brandName}</strong>\n              </div>\n            `}\n      </div>\n    </div>\n  `})({widget:e,automatedNotification:t,site:i});(0,o.addContentAfterBody)(r),(()=>{const e="pushengage-unsubscribe-widget",t=`${e}-bell`,i=`${e}-tooltip`,r=`${e}-opt-in`,d=(0,o.getElementById)(t),c=(0,o.getElementById)(i),l=(0,o.getElementById)(`${e}-powered-by`),u=(0,o.getElementById)(r);if(!d||!c||!u)return;const g=(0,a.detectDeviceType)(),p="pushengage-opt-in__tooltip--opened",b="pushengage-opt-in__popover--opened";"desktop"===g?(d.addEventListener("mouseenter",(()=>{u.classList.contains(b)||(0,n.showTooltipView)({targetId:t,tooltipId:i})})),d.addEventListener("mouseleave",(),d.addEventListener("click",(()=>{u.classList.contains(b)?u.classList.remove(b):((0,n.showPopoverView)({targetId:t,popoverId:r}),c.classList.remove(p))}))):d.addEventListener("click",(()=>{u.classList.contains(b)?u.classList.remove(b):((0,n.showPopoverView)({targetId:t,popoverId:r}),(0,n.showTooltipView)({targetId:t,tooltipId:i}),c.classList.remove(p))})),null==l||l.addEventListener("click",(()=>{window.open(s.poweredByReferralUrl,"_blank")}))})()},t.addUnsubscribeWidgetButtonViewToPage=({widget:e,site:t})=>{const i=(({widget:e,site:t})=>{const i="bl"===e.position?"left":"right",o=(0,r.getColorTheme)(e.bg),a=`visibility: hidden;\n  --widget-background-color: ${e.bg};\n  --widget-color: ${e.color};`;return`\n    <div\n      id="pushengage-unsubscribe-widget"\n      class="pushengage-unsubscribe-widget pushengage-unsubscribe-widget--${i} pushengage-unsubscribe-widget--button pushengage-unsubscribe-widget--${o} pushengage-unsubscribe-widget--initial-state"\n      style="${(0,n.getStyleForHtmlElement)(a)}"\n    >\n      <div class="pushengage-unsubscribe-widget__opt-in">\n        <div\n          class="pushengage-unsubscribe-widget__title"\n          id="pushengage-unsubscribe-widget-unsubscribe-title"\n        >\n          ${e.unsubMsg}\n        </div>\n\n        <div class="pushengage-unsubscribe-widget__action">\n          <span>${e.confirmMsg}</span>\n          <span id="pushengage-unsubscribe-widget-action-yes">${e.ConfirmActionYes}</span\n          ><span id="pushengage-unsubscribe-widget-action-no">${e.ConfirmActionNo}</span>\n        </div>\n\n        <div class="pushengage-unsubscribe-widget__thanks-msg">${e.thankMsg}</div>\n\n        ${t.is_whitelabel?"":`\n              <div\n                class="pushengage-unsubscribe-widget__powered-by"\n                id="pushengage-unsubscribe-widget-powered-by"\n              >\n                Powered by <strong>${s.brandName}</strong>\n              </div>\n            `}\n      </div>\n\n      <div\n        class="pushengage-unsubscribe-widget__close-icon"\n        id="pushengage-unsubscribe-widget-close-button"\n      >\n        ${s.closeIcon}\n      </div>\n    </div>\n  `})({widget:e,site:t});(0,o.addContentAfterBody)(i),(()=>{const e=(0,o.getElementById)("pushengage-unsubscribe-widget-powered-by");null==e||e.addEventListener("click",()})()}}},t={};!5004)})();
//# sourceMappingURL=pushengage-subscription.js.map