!);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"redpop@b474a6ad4354f4ba5fde672fa4e9c2c267684761"};"use strict";(self.webpackChunk_tumblr_redpop=self.webpackChunk_tumblr_redpop||[]).push([[7671],{31564:(e,t,s)=>{s.r(t),s.d(t,{default:);var a=s(17276),l=s.n(a),n=s(54138),i=s.n(n),o=s(50209),r=s.n(o),g=s(95004),d=s(44009),h=s(38149),p=s(6135),c=s(52858),m=s(6233),f=s(46600),u=s(54382),T=s(13883),w=s(43523),x=s(42946),v=s(20943),y=s(59215),C=s(96467),b=s.n(C),M=s(40657),P=s(90127);let j={tagImage:"WTEWl",followedTagWrapper:"Etu_4",tagName:"FPxrw",tagDescription:"IVTyE",postsCount:"auLT4",desktopContainer:"Wlk_Y",tagList:"tl08r",loading:"pFCyy",header:"Vp1Z_",title:"Eysep",manageTagsLink:"mKLR_",manageTagsLinkWrapper:"XhmHL",emptyTagView:"lc7tb",emptyTagHeader:"DYeVK",emptyTagContent:"Wf0R5",tagActionButtons:"EGqIm",followTagsButton:"ZxFvh",tagCTAText:"NRavr",dismissEmptyButton:"HY9JY",nextPage:"FBnln"};var F=s(2629);class N extends g.Component{constructor(){super(...arguments),r()(this,"state",{isFollowModalOpen:!1,hasFetchedAllTags:!1,isTagManageModalOpen:!1,isFetchingTags:!1,followedTagsTimeline:this.props.followedTagsTimeline,isEmptyViewDismissed:!this.shouldShowEmptyView(),offset:0}),r()(this,"tagModalRef",(0,g.createRef)()),r()(this,"tagsPerPage",4),r()(this,"shouldRefreshTags",!1),r()(this,"nextPage",()=>{var e=this.state.followedTagsTimeline.elements.length,t=this.state.offset+this.tagsPerPage;if(t+2*this.tagsPerPage>e&&this.fetchOffset(e),t>e&&this.state.hasFetchedAllTags)this.setState({offset:0});else{if(t>e&&this.state.isFetchingTags)return;this.setState({offset:t})}}),r()(this,"dismissEmptyView",()=>{var e=this.props.appContext.setCookie;this.setState({isEmptyViewDismissed:!0}),e(T.zC.EXPLORE_TAGS_EMPTY_CTA_DISMISSED,T.Ox,{expires:new Date(Date.now()+x.g.Week)})}),r()(this,"toggleFollowModal",()=>{var e=this.props.appContext.logEvent;this.setState(t=>{var s=t.isFollowModalOpen;return s||e({eventName:w.J.FollowTagsModal}),{isFollowModalOpen:!s}},this.fetchTagsAfterModal)}),r()(this,"toggleTagManageModal",e=>{var t=this.props.appContext.logEvent;this.setState(s=>{var a=s.isTagManageModalOpen,l=s.followedTagsTimeline;return a&&e?(this.shouldRefreshTags=!0,{isTagManageModalOpen:!a,followedTagsTimeline:i()(i()({},l),{},{elements:[]})}):(a||t({eventName:w.J.ManageTagsModal}),{isTagManageModalOpen:!a})},this.refreshTagTimelineAfterUnfollow)})}render(){var e=this.props.appContext._t,t=this.state,s=t.isTagManageModalOpen,a=t.followedTagsTimeline.elements,l=t.isFetchingTags;return 0!==a.length||l?(0,F.jsxs)("div",{className:j.desktopContainer,children:[s&&(0,F.jsx)(c.Z,{onClose:this.toggleTagManageModal}),(0,F.jsxs)("div",{className:j.header,children:[(0,F.jsx)("span",{className:j.title,children:(0,F.jsx)(u.ZP,{comment:"Displayed above a list of tags the user follows",children:"Following"})}),(0,F.jsx)(d.Z,{label:e("Manage"),wrapperClassName:j.manageTagsLinkWrapper,className:j.manageTagsLink,onClick:children:(0,F.jsx)(u.ZP,{children:"Manage"})})]}),(0,F.jsx)("div",{className:j.tagList,children:this.renderCurrentTags()}),(0,F.jsx)("div",{className:j.nextPage,children:a.length>this.tagsPerPage&&(0,F.jsx)(d.Z,{label:e("Show more tags"),onClick:this.nextPage,children:(0,F.jsx)(u.ZP,{children:"Show more tags"})})})]}):this.renderEmptyView()}renderCurrentTags(){var e=this.state.followedTagsTimeline.elements,t=this.state.offset,s=e.slice(t,this.tagsPerPage+t);return s.length<this.tagsPerPage&&e.length>this.tagsPerPage&&!this.state.hasFetchedAllTags?(0,F.jsx)("div",{className:j.loading,children:(0,F.jsx)(p.Z,{})}):s.map(}fetchOffset(e){var t,s,a,n,i=this;return l()().async(function(o){for(;;)switch(o.prev=o.next){case 0:if(t=i.props.appContext.apiFetch,!(i.state.hasFetchedAllTags||i.state.isFetchingTags)){o.next=3;break}return o.abrupt("return");case 3:return i.setState({isFetchingTags:!0}),s=i.state.followedTagsTimeline,o.next=7,l()().awrap((0,v.KN)(t,e).fetch());case 7:0===(a=o.sent.response.timeline).elements.length?i.setState({hasFetchedAllTags:!0,isFetchingTags:!1}):(n={elements:[...s.elements,...a.elements],links:a.links},i.setState({followedTagsTimeline:n,isFetchingTags:!1}));case 10:case"end":return o.stop()}},null,null,null,Promise)}renderSingleTag(e){var t,s,a,l,n=e.postsCount?e.postsCount.toString():"0",i=(0,F.jsx)(F.Fragment,{children:e.tagName});return null!==(t=e.tagV2)&&void 0!==t&&null!==(t=t.style)&&void 0!==t&&t.colors&&(i=(0,F.jsx)(M._,{label:e.tagName,colors:e.tagV2.style.colors,iconKey:e.tagV2.style.iconKey})),(0,F.jsxs)("a",{className:j.followedTagWrapper,href:null!==(s=e.tagV2)&&void 0!==s&&s.name?(0,P.fO)(null===(a=e.tagV2)||void 0===a?void 0:a.name):null===(l=e.links)||void 0===l?void 0:l.tap.href,children:[(0,F.jsx)("div",{className:j.tagImage,children:(0,F.jsx)(h.pC,{imageResponse:[{url:e.backgroundImage,width:b().desktopPostAvatarSize,height:b().desktopPostAvatarSize}],isSquare:!0,altText:e.tagName,sizes:`${b().desktopPostAvatarSize}px`})}),(0,F.jsxs)("div",{className:j.tagDescription,children:[(0,F.jsx)("div",{className:j.tagName,children:i}),(0,F.jsx)("div",{className:j.postsCount,children:(0,F.jsxs)(u.M2,{comment:"The number of posts this topic has had recently. Placeholder is the count of posts",exemptNumberKeyFromParamCheck:!0,components:{b:(0,F.jsx)("b",{})},params:{newPostsCount:n},number:"1"===n?1:2,children:[(0,F.jsx)(u.CJ,{children:"[newPostsCount] recent post"}),(0,F.jsx)(u.CN,{children:"[b][newPostsCount][/b] recent posts"})]})})]})]},e.tagName)}shouldShowEmptyView(){return this.props.appContext.getCookie(T.zC.EXPLORE_TAGS_EMPTY_CTA_DISMISSED)!==T.Ox}renderEmptyView(){var e=this.props.appContext._t,t=this.state,s=t.isFollowModalOpen;if(t.isEmptyViewDismissed)return null;var a=e("Let's follow some tags"),l=e("Maybe later");return(0,F.jsxs)("div",{className:j.emptyTagView,children:[s&&this.renderFollowModal(),(0,F.jsx)("div",{className:j.emptyTagHeader,children:(0,F.jsx)(u.ZP,{comment:"Title displayed on the followed tags sidebar when the user does not follow any tag",children:"Let's get personal"})}),(0,F.jsxs)("div",{className:j.emptyTagContent,children:[(0,F.jsx)("span",{className:j.tagCTAText,children:(0,F.jsx)(u.ZP,{children:"Whatever you're into, Tumblr has it. Follow tags that matter to you, and the things you love will show up here."})}),(0,F.jsxs)("div",{className:j.tagActionButtons,children:[(0,F.jsx)(d.Z,{label:l,wrapperClassName:j.dismissEmptyButton,onClick:this.dismissEmptyView,children:l}),(0,F.jsx)(d.Z,{label:a,wrapperClassName:j.followTagsButton,onClick:this.toggleFollowModal,children:a})]})]})]})}renderFollowModal(){var e=this.props.appContext._t;return(0,F.jsx)(m.Z,{title:e("Let's follow some tags"),onClose:this.toggleFollowModal,children:(0,F.jsx)(f.Z,{})})}fetchTagsAfterModal(){var e,t,s=this;return l()().async(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=s.props.appContext.apiFetch,!s.shouldRefreshTags){a.next=9;break}return s.setState({isFetchingTags:!0}),a.next=5,l()().awrap((0,v.KN)(e).fetch());case 5:t=a.sent.response.timeline,s.setState({followedTagsTimeline:t,isFetchingTags:!1}),s.shouldRefreshTags=!1;case 9:case"end":return a.stop()}},null,null,null,Promise)}refreshTagTimelineAfterUnfollow(){this.shouldRefreshTags&&(this.fetchTagsAfterModal(),this.setState({offset:0}))}}let S=(0,y.X9)(N,{appContext:!0,paletteContext:!0})}}]);