/***************************************
 * @preserve
 * Copyright (c) 2020 Verint Systems, Inc. All rights reserved.
 * ForeSee Web SDK: Trigger
 * Version: 19.14.1
 * Built: October 20, 2020, 12:22:07 CDT
 ***************************************/
_fsDefine(["fs",_fsNormalizeUrl("$fs.utils.js"),_fsNormalizeUrl("$fs.compress.js"),"exports"],function(e,t,i,r){var s={SERVICE_TYPES:{mobileOnExitInitialize:{path:"/e",url:"/initialize"},mobileOnExitHeartbeat:{path:"/e",url:"/recordHeartbeat"}},ping:function(i,r,s,n){var o=e.getVendorConfig("fs"),a=new t.ImageTransport,c="https://"+o.mobileOnExitUrl+i.path+(i.url||"");a.send({url:c,success:s||function(){},failure:n||function(){},data:r})}},n=function(){function i(t,i,r,s){var n=e.getVendorConfig("fs");this.cfg=t,this.globalConfig=t.globalConfig||n,this.cpps=i,this.def=r,this.locale=i.get("locale")||"en",this.qual=s}var r=i.prototype;return r.decideEfmSurvey=function(e){var t=this.def.efmSurvey||{};return{efmChosen:t.efmPercentage&&t.surveyUrl&&t.efmPercentage>=e,efmPercentage:t.efmPercentage,surveyUrl:t.surveyUrl}},r.decideModernSurvey=function(e){var t,i,r,s,n,o,a=this.def.modernSurvey||{},c=a.modernPercentage&&this.globalConfig.modernSurveyUrl,d=this.cfg.config.abSurveyType,f=d&&d.shouldTest&&this.globalConfig.modernSurveyUrl,u=d.defs,l=f&&(t=u,i=this.def,r=i.name||"",s=i.section||"",n=i.site||"",o=r+"-"+s+"-"+n,t.filter([0]||null);return c?{modernChosen:a.modernPercentage>=e,modernPercentage:a.modernPercentage,singlePageView:a.singlePageView}:this.cfg.config.onlyModernSurvey?{modernChosen:!0,modernPercentage:100,singlePageView:a.singlePageView}:l?{modernChosen:l.modernPercentage>=e,modernPercentage:l.modernPercentage,singlePageView:a.singlePageView}:{modernChosen:!1,modernPercentage:0,singlePageView:a.singlePageView}},r.getMeasureId=function(){return[this.def.name,this.def.site,this.def.section,this.locale,this.qual?this.qual.qualifiesValue:null].filter(.join("-")},r.getUrl=function(){var e=Math.floor(100*Math.random()),i=this.decideEfmSurvey(e);if(i.efmChosen)return this._buildUrl(i.surveyUrl,this._getParams({}));var r=this.decideModernSurvey(e);if(r.modernChosen){var s=r.singlePageView?{paginationType:"single"}:{};return this._buildUrl(this.globalConfig.modernSurveyUrl,this._getParams(s))}var n=t.now()+"_"+Math.round(1e13*Math.random()),o=this._getParams({a:n,b:t.hash(n),c:864e5,mp:r.modernPercentage,ep:i.efmPercentage});return this._buildUrl(this.globalConfig.surveyUrl,o)},r._getParams=function(t){return e.ext({sid:this.getMeasureId(),cid:this.globalConfig.customerId,pattern:this.cpps.get(this.def.surveyLookupCPP)||this.def.surveyLookupCPP},t||{},!1)},r._buildUrl=function(t,i){var r=t+"?";for(var s in i)r+=e.enc(s)+"="+e.enc(i[s])+"&";return r+=this.cpps.toQueryString(["browser","os"])},r.getShortSurveyUrl=function(e){var t=e.pageView,i=e.paginationType,r=e.midOverride,s=e.respondentId,n=this.globalConfig.modernSurveyUrl;if(s)return n+"/"+s;var o=this._getParams({template:"contextual",pv:t,paginationType:i});return r&&(delete o.cid,delete o.sid,o.mid=r),o.paginationType||delete o.paginationType,this._buildUrl(n,o)},r.getShortSurveyOrigin=function(){return e.getVendorConfig("fs").modernSurveyUrl.replace(/\/sv$/,"")},i}(),o=function(){function i(t,i,r,s,n,o){this.itype=t,this.cfg=i,this.def=r,this.cpps=s,this.rid=n,this._measureName=this.def.name+"-"+(e.isDefined(this.def.site)?this.def.site+"-":"")+(e.isDefined(this.def.section)?this.def.section+"-":"")+(o||this.def.language.locale)}var r=i.prototype;return r.init=function(i,r){var o=e.getVendorConfig("fs");r=r||function(){};var a=new n(this.cfg,this.cpps,this.def,null).decideModernSurvey(),c=t.now()+"_"+Math.round(1e13*Math.random()),d={a:c,notify:i,b:t.hash(c),c:864e5,cid:o.customerId,sid:this._measureName,rid:this.rid,uid:t.now(),support:"SMSEMAIL"==this.itype?"b":"EMAIL"==this.itype?"e":"s",cpps:"version="+encodeURIComponent(o.codeVer)+"&"+this.cpps.toQueryString()};a.modernChosen&&(d=e.ext({fs_renderer:"modern"},d),a.singlePageView&&(d=e.ext(d,{cpps:d.cpps+"&cpp[paginationType]=single"}))),s.ping(s.SERVICE_TYPES.mobileOnExitInitialize,d,r,r)},r.beginHeartbeat=function(i){var r=this,n=e.getVendorConfig("fs");this._timer&&(clearTimeout(this._timer),this._timer=null);var o=function(){var o={cid:n.customerId,sid:r._measureName,rid:r.rid,uid:t.now()};i&&(o=e.ext(o,{unpin:"1",cpps:r.cpps.toQueryString()})),s.ping(s.SERVICE_TYPES.mobileOnExitHeartbeat,o,function(){},function(){})};this._timer=setInterval(o,6e4),o()},i}(),a={loadedEmitter:new t.FSEvent,initializedEmitter:new t.FSEvent,inviteShownEmitter:new t.FSEvent,inviteAcceptedEmitter:new t.FSEvent,inviteAbandonedEmitter:new t.FSEvent,inviteDeclinedEmitter:new t.FSEvent,trackerShownEmitter:new t.FSEvent,customInvitationRequested:new t.FSEvent,CPPS:null,_triggerResetLock:null,state:{didInvite:!1,inviteSuppressed:!1},inviteSetup:null},c="fs_inviteShown",d="fs_inviteAccepted",f="fs_inviteDeclined",u="fs_inviteAbandoned",l="fs_linksCancel",g=window,p=function(e,t,i,r,s,n,o,c){return a.inviteSetup?c.call(a.inviteSetup):a.inviteSetup=new h(e,t,i,r,s,n,o,c),a.inviteSetup},h=function(){function i(r,s,o,c,d,f,u,l){var p=this;this.trig=r,this.browser=s,this.stg=o,this.cpps=c,this.displayoverride=d,this.jrny=f,this.resourcesready=new t.FSEvent,this.triggerMethod=u;var h=e.getProductConfig("fs","trigger");this.config=h,g.fsReady(function(){var t;if(r.invite&&r.invite.dispose(),s.isMobile&&r.cfg.config.pagesInviteAvailable)if(null===(t=o.get("pia")))o.set("pia",r.cfg.config.pagesInviteAvailable-1);else if(t>0)o.set("pia",--t);else if(0===t)return;var f=i.getFittingDisplay(r.surveydef,d,c.get("locale"),s);o.set("dn",f.displayname),p.abTestShortSurvey(f),"SHORTSURVEY"!==f.inviteType?g._fsRequire([e.makeURI("$fs.invite.js")],function(e){p.invite=r.invite=new e(h,r.surveydef,s,f,c,a),l&&l.call(p)}):g._fsRequire([e.makeURI("$fs.shortsurvey.js")],function(e){var t=new n(h,c,r.surveydef);p.invite=r.invite=new e(h,r.surveydef,f,c,o,t),l&&l.call(p)})})}var r=i.prototype;return r.initialize=function(){var i=e.getProductConfig("fs","trigger"),r=e.getProductConfig("fs","record"),s=r?r.cxRecordDefs:[],n=this.trig,o=this.stg,c=this.cpps,l=this.invite,g=this.jrny;this.didInitialize?l.resetState():(this.didInitialize=!0,g.addEventsDefault("properties",{fs_defName:[n.surveydef.name],fs_section:[n.surveydef.section],fs_displayName:[l.display.displayname],fs_displayTemplate:[l.display.template],fs_pvInvited:[n.pageViewCount],fs_language:[l.locale],fs_samplePercentage:[n.surveydef.criteria.sp.reg],fs_loyaltyFactor:[n.surveydef.criteria.lf],fs_environment:[e.isProduction?"production":"staging"],fs_inviteType:["intercept"],fs_triggerMethod:[this.triggerMethod]}),c.set("TriggerMethod",this.triggerMethod),c.set("dn",l.display.displayname),c.set("dt",l.display.template),l.loadResources(this.resourcesready),l.declined.subscribe(function(r){var d=e.isDefined(i.active_surveydef)&&e.isDefined(i.active_surveydef.repeatDays)?i.active_surveydef.repeatDays:i.config.repeatDays;o.set("i","d"),o.setMaxKeyExpiration(24*d.decline*60*60*1e3),g.addEventObj({name:f,properties:{action:[r]}}),a.inviteDeclinedEmitter.fire(n.surveydef,o,i,c),!!t.findMatchingDefFromList(s,n.surveydef)&&a.rec&&"y"!=o.get("fbr")&&(a.rec.cancelRecord(),n.recordController=a.rec=null,e.globalState.rec=null),a.state.inviteSituation="DECLINED"}),l.abandoned.subscribe(function(){g.addEventString(u),o.set("i","a"),a.state.inviteSituation="ABANDONED",a.inviteAbandonedEmitter.fire(n.surveydef,o,i,c),o.set("rw",t.now()+24*i.config.repeatDays.abandon*60*60*1e3)}),l.accepted.subscribe(function(r,f){var u=e.isDefined(i.active_surveydef)&&e.isDefined(i.active_surveydef.repeatDays)?i.active_surveydef.repeatDays:i.config.repeatDays;switch(o.setMaxKeyExpiration(24*u.accept*60*60*1e3),a.inviteAcceptedEmitter.fire(n.surveydef,o,i,c),!!t.findMatchingDefFromList(s,n.surveydef)&&a.rec&&a.rec.recorder&&a.rec.beginTransmitting(),g.initPopupId(),g.addEventString(d),o.set("i","x"),a.state.inviteSituation="ACCEPTED",o.set("ixw",t.now()),r){case"TRACKER":n.popTracker(l);break;case"INSESSION":n.popSurvey();break;case"SMS":case"EMAIL":case"SMSEMAIL":v(n,f,r),n.stg.set("mhbi",{ui:f,it:r});break;case"SHORTSURVEY":break;default:throw new Error("Unknown inviteType: "+r)}}))},r.present=function(){var i=this,r=e.getProductConfig("fs","trigger"),s=this.invite,n=this.stg,o=this.jrny,d=this.trig,f=this.cpps;a.state.didInvite||(a.state.didInvite=!0,this.resourcesready.subscribe(function(){var u=r.config.inviteDelay;null!=s.display.inviteDelay&&(u=s.display.inviteDelay);var l=Math.max(0,u-(t.now()-e.startTS));"SHORTSURVEY"===s.display.inviteType&&(l="p"===n.i?0:l),setTimeout(function(){i.invite.present(i.browser),"p"!==n.get("i")&&o.addEvent(c),n.set("ipt",t.now()),n.set("i","p"),a.state.inviteSituation="PRESENTED",a.inviteShownEmitter.fire(d.surveydef,n,r,f)},l)},!0,!0))},r.abTestShortSurvey=function(e){if("SHORTSURVEY"===e.inviteType&&e.shortSurvey&&e.shortSurvey.abTestPercent&&e.shortSurvey.abTestPercent<100&&e.shortSurvey.abTestPercent>0){var t=new n(this.config,this.cpps,this.trig.surveydef).getMeasureId()+"-"+e.displayname+"-AB",i=this.stg.get(t);if(null==i)i=100*Math.random()<=e.shortSurvey.abTestPercent?1:0,this.stg.set(t,i);i||(e.inviteType="TRACKER")}},i}(),v=function(i,r,s){var n=i.stg.get("ipt"),a=(t.now()-n)/1e3;i.cpps.set("invite_presented_interval",a);var c=new o(s,e.getProductConfig("fs","trigger"),i.surveydef,i.cpps,i.stg.get("rid"),i.locale),d=i.stg.get("mbhsid")!==c._measureName;i.stg.set("mbhsid",c._measureName),i.stg.get("mhbi")?c.beginHeartbeat(d):c.init(r,function(){c.beginHeartbeat()})};h.getFittingDisplay=function(t,i,r,s){r=r||a.CPPS.get("locale")||"en";var n,o,c,d,f={},u={};if(n=(s=s||a.browser).isMobile&&t.display.mobile?t.display.mobile:t.display.desktop)for(d=0;d<n.length;d++)u=f.dialog||{},f=e.ext({},f),f=e.ext(f,n[d]),n[d].dialog&&f.dialog&&(f.dialog=e.ext(e.ext({},u),n[d].dialog)),n[d]=f;if(i){for(d=0;d<n.length;d++)if(n[d].displayname==i){c=n[d];break}}else c=n[Math.round(999999999999*Math.random())%n.length];return c.dialog.locales&&c.dialog.locales[r]&&(o=c.dialog.locales[r],c.dialog=e.ext(c.dialog,o),o.localeImages&&(c=e.ext(c,o.localeImages))),e.ext({inviteLogo:"",inviteThankyouLogo:"",trackerLogo:"",siteLogoAlt:""},c)};var m=function(){a.state.inviteSuppressed=!0;var e=a.inviteSetup;e&&e.invite&&e.invite.dispose()},y=function(){a.state.inviteSuppressed=!1;var e=a.inviteSetup;e&&e.invite&&!e.invite.isPresented&&!e.invite.isAbandoned&&e.invite.present()},b=function(){ar r=i.prototype;return r._bindToLink=function(i,r){for(var s=document.querySelectorAll(i.selector),n=function(e,i,r){return ,o=0;o<s.length;o++){var a=s[o],c=!0,d=void 0;if(i.attribute&&(c=!1,(d=a.getAttribute(i.attribute))&&(c=!0,i.patterns&&i.patterns.length>0))){c=!1;for(var f=0;f<i.patterns.length;f++)if(e.toLowerCase(d).indexOf(e.toLowerCase(i.patterns[f]))>-1){c=!0;break}}c&&t.Bind(a,"trigger:click",n(this,i,r))}},r.performBindings=function(e){if(e&&this.cfg){var t,i=this.cfg;if(i.cancel&&i.cancel.length>0){var r=for(t=0;t<i.cancel.length;t++)this._bindToLink(i.cancel[t],r)}if(i.survey&&i.survey.length>0){var s=function(){e.popSurvey()};for(t=0;t<i.survey.length;t++)this._bindToLink(i.survey[t],s)}if(!e.browser.isMobile&&i.tracker&&i.tracker.length>0){var n=for(t=0;t<i.tracker.length;t++)this._bindToLink(i.tracker[t],n)}}},i}();function S(t,i,r,s,n,o){var a={width:700,height:350,left:50,top:50,resizable:"no",scrollbar:"1",scrollbars:"1",toolbar:"no",menubar:"no",location:"0",directories:"no",status:"no"},c=o?function(e,t){var i=void 0!==window.screenLeft?window.screenLeft:screen.left,r=void 0!==window.screenTop?window.screenTop:screen.top,s=window.innerWidth;window.innerWidth||(s=document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width);var n=window.innerHeight;window.innerHeight||(n=document.documentElement.clientHeight?document.documentElement.clientHeight:screen.Height);return{left:s/2-e/2+i,top:n/2-t/2+r}}(r.width||a.width,r.height||a.height):{},d=e.ext(a,r,c),f="";for(var u in d)f+=u+"="+d[u]+",";var l=this._win=g.open(t,i,f);return l&&n&&(l.blur(),l.opener.window.focus(),g.focus(),s.isIE&&setTimeout(function(){l.blur(),l.opener.window.focus(),g.focus()},1e3)),l}var w,_,P=function(){function i(i,r,s,n,o,c,d){var f=this,u=e.getVendorConfig("fs");a.tracker&&(a.tracker.dispose(),a.tracker=null,e.globalState.tracker=null),a.tracker=this,e.globalState.tracker=this,e.ext(this,{template:i,def:r,cfg:s,disp:c,_fcBindings:[]},!1),this.cpps=o,this.br=d,this.stg=n;var l=0;window.performance&&window.performance.timing&&(l=window.performance.timing.domComplete-window.performance.timing.navigationStart),this.hbi=3*Math.max(s.config.trackerHeartbeatTimeout,a.pageLoadTime,l),i&&a.trackerShownEmitter.fire(r,n,s,o),u.storage!==t.storageTypes.MC&&u.storage!==t.storageTypes.MC_Hybrid&&this.stg._readyState.subscribe(function(){if(n._serverFails>0){var e=t.getGeneralStorage(d);e.set("i","f"),a.state.inviteSituation="BRAINFAILED",e.set("fw",t.now()+432e5)}},!0,!1),this.stg.ready.subscribe(function(){f.stg.set("tracker_hb",t.now(),f.hbi,!1);var e=function(e){f.stg.set("page_hb",t.now(),f.hbi,!!e)},i=f.stg.onCommit.subscribe(function(){null===n.get("tracker_hb")?t.now()-f.lastTimeSeenTracker>f.cfg.config.trackerHeartbeatTimeout&&(i.unsubscribe(),delete f.lastTimeSeenTracker,f.dispose()):f.lastTimeSeenTracker=t.now()},!1,!1);f._heartbeat=setInterval(e,Math.round(.5*f.cfg.config.trackerHeartbeatTimeout)),e(!0)},!0,!0),t.Bind(g,"unload",function(){f.hbi=f.cfg.config.trackerHeartbeatLongTimeout,f.stg.set("page_hb",t.now(),f.hbi,!0)});var p=e.enc;this._url=e.makeURI(["$fs.tracker.html?uid=",p(n.uid||""),"&sitekey=",p(u.siteKey),"&domain=",p(t.getRootDomain()),"&gw=",p(e.makeURI("trigger/__gwtest__")),"&brain_url=",p(u.brainUrl),"&fsrlocale=",p(o.get("locale")||"en"),"&_svu_=",p(u.surveyUrl),"&_cv_=",p(u.codeVer),"&_issh_=",p(e.isSelfHosted),"&_vt_=",p(e.tagVersion),"&_au_=",p(u.analyticsUrl),"&_pa_=",p(e.assetLocation),e.codeLocation?"&_cl_="+p(e.codeLocation):""].join("")),this._cppsOnSetHandler=this.cpps.onSet.subscribe(function(e,t){if(f.stg){var i={};i[e]=t,f.stg.set("ckcpps",i,2e5,!1)}}),this.stg.set("ckcpps",this.cpps.all(),2e5,!1),this._sendDefinition()}var r=i.prototype;return r._sendDefinition=function(){var i=e.getVendorConfig("fs"),r={method:"init",cfg:e.ext({active_surveydef:null},this.cfg,{globalConfig:i}),hb_i:this.hbi,cpps:this.cpps.all()};this.disp&&(r.display=this.disp),this.template&&(r.template=this.template),this.stg.set("page_hb",t.now(),this.cfg.config.trackerHeartbeatTimeout,!1),this.stg.set("trackerinfo",r,6e4,!1);var s=t.getGeneralStorage(this.br).get("ipt");this.stg.set("ipt",s),this.stg.set("ckcpps",this.cpps.all(),2e5,!1)},r.show=function(e){var t=e.isMobile&&this.cfg.active_surveydef.display.mobile?"mobile":"desktop";this.wref=S(this._url,"fsTracker",{width:this.cfg.active_surveydef.display[t][0].popupWindowWidth,height:this.cfg.active_surveydef.display[t][0].popupWindowHeight},e,!0,this.cfg.config.centerTrackerPopup)},r.applyExisting=function(e,t){this.wref=t,t.location=this._url},r.dispose=function(){for(var e=0;e<this._fcBindings.length;e++)this._fcBindings[e].unsubscribe();this._cppsOnSetHandler&&(this._cppsOnSetHandler.unsubscribe(),delete this._cppsOnSetHandler),t.getGeneralStorage(this.br)===this.stg&&this.stg.dispose(),this.stg=null,clearInterval(this._heartbeat)},i}(),k=function(){ar r=i.prototype;return r.popTracker=function(i){var r=this,s=this;this.stg.set("i","x"),a.state.inviteSituation="ACCEPTED",this.didPopTrackerAlready="y"==this.stg.get("tp"),a.state.didInvite=!0;var n=e.getProductConfig("fs","record"),o=n?n.cxRecordDefs:[];if(!this.didPopTrackerAlready){this.stg.set("tp","y");if(i)s.tracker=new P(i.template,s.surveydef,r.cfg,t.getBrainStorage(s.browser,s.stg.uid),s.cpps,i.display,s.browser),s.tracker.show(s.browser);else{var c=this.browser.isMobile&&this.cfg.active_surveydef.display.mobile?"mobile":"desktop",d=S("about:blank","fsTracker",{width:this.cfg.active_surveydef.display[c][0].popupWindowWidth,height:this.cfg.active_surveydef.display[c][0].popupWindowHeight},this.browser,!0,this.cfg.config.centerTrackerPopup);p(this,s.browser,s.stg,s.cpps,!1,s.jrny,"Traditional",function(){s.tracker=new P(this.invite.template,s.surveydef,s.cfg,t.getBrainStorage(s.browser,s.stg.uid),s.cpps,this.invite.display,s.browser),s.tracker.applyExisting(s.browser,d),!!t.findMatchingDefFromList(o,s.surveydef)&&a.rec&&a.rec.recorder&&a.rec.beginTransmitting()})}}},r.getFittingDisplay=r.getShortSurveyOptions=function(e){var t=new n(this.cfg,this.cpps,this.surveydef).getMeasureId(),i=this.stg.get(t+"pc")||0;return!(!this.stg.get(t+"li")&&e.shortSurvey.idleViewsBeforeStop<=i)&&{presentedCount:i}},r.popSurvey=function(e){if(this.stg.set("i","x"),a.state.inviteSituation="ACCEPTED",this.didPopTrackerAlready="y"==this.stg.get("tp"),a.state.didInvite=!0,this.didPopTrackerAlready)this.stg&&this.stg.get("page_hb")&&t.getBrainStorage(this.browser,this.stg.uid).set("trackercmd",{method:"survey"},6e4,!0);else{this.stg.set("tp","y");var i=new n(this.cfg,this.cpps,this.surveydef,null,e).getUrl(),r=this.browser.isMobile&&this.cfg.active_surveydef.display.mobile?"mobile":"desktop";S(i,"acsSurvey",{width:this.cfg.active_surveydef.display[r][0].popupWindowWidth,height:this.cfg.active_surveydef.display[r][0].popupWindowHeight},this.browser,!1,this.cfg.config.centerTrackerPopup)}},r.init=function(e){this.pageViewCount=this.stg.get("pv")||1;var i=e.def,r=e.showTracker;this.cfg.active_surveydef=i,this.surveydef=i,this.locale=this._initLocale(),this.cpps.set("locale",this.locale),i.section&&this.cpps.set("section",i.section),r&&(this.tracker=new P(null,i,this.cfg,t.getBrainStorage(this.browser,this.stg.uid),this.cpps,null,this.browser))},r._initLocale=function(){var i,r=this.surveydef,s=r.language;if(e.isDefined(s.src)&&e.isDefined(s.locales)){switch(s.src){case"variable":e.isDefined(s.name)&&(i=t.retrieveNestedVariable(window,s.name));break;case"cookie":if(e.isDefined(s.name))i=new t.Cookie({}).getByCookieName(s.name);break;case"url":var n=s.locales;if(e.isDefined(n))for(var o=0,a=n.length;o<a;o++)if(e.isDefined(n[o].locale)&&e.isDefined(n[o].match)&&location.href.match(n[o].match))return this.locale=n[o].locale,n[o].criteria&&e.ext(this.surveydef.criteria,n[o].criteria),this.locale!==r.language.locale&&(r.language.locale=this.locale),n[o].locale;break;default:throw new Error("Unknown locale src: "+s.src)}if(i)for(var c=0;c<s.locales.length;c++)if(s.locales[c].match==i)return s.locale=s.locales[c].locale,s.locales[c].criteria&&e.ext(this.surveydef.criteria,s.locales[c].criteria),s.locale}return s.locale||"en"},r.cancelTracker=function(){t.getBrainStorage(this.browser,this.stg.uid).set("trackercmd",{method:"close"},6e4,!0),this.stg.set("i","a"),a.state.inviteSituation="ABANDONED",e.isDefined(this.tracker)&&clearInterval(this.tracker._heartbeat)},r.logDefState=function(){if(this.surveydef){var e=new n(this.cfg,this.cpps,this.surveydef).getMeasureId();this.defPageViewCount=(this.stg.get(e+"pv")||0)+1,this.stg.set(e+"pv",this.defPageViewCount,this.cfg.config.pageViewsResetTimeout||864e5)}},r.evalLoyaltySampling=function(t){var i=this.surveydef,r=i[t]||i.criteria,s=this.stg.get("pl"),n=e.isDefined(s)&&1!=s?r.sp.outreplaypool||0:r.sp.reg||0,o=100*Math.random();return this.defPageViewCount>=r.lf&&o<=n},r.dispose=function(){if(!this.disposed){if(this.stg.save(!0),this.disposed=!0,this.invite){this.invite.dispose(!0)}delete a.inviteSetup,this.mouseoff&&this.mouseoff.dispose(),a.rec&&(a.RecordController.disposeInstance(),a.RecordController=null,a.rec=null,e.globalState.rec=null),t.Unbind("trigger:*")}},i}(),E=I=["_4c_s_","_4c_mc_","_4c_es_"],T=new t.FSEvent,C={set:function(e,t){T.subscribe(!0,!0)},get:function(e,t){t=t||console.log,T.subscribe(function(){t(a.CPPS.get(e))},!0,!0)},append:function(){var e;T.subscribe((e=arguments,,!0,!0)},all:function(e){e=e||console.table||console.log,T.subscribe(!0,!0)}};e.API.expose("CPPS",C);e.API.expose("dispose",function(){T.subscribe(!0,!0)});e.API.expose("getState",function(e){e=e||console.log,T.subscribe(!0,!0)});e.API.expose("optOut",function(){var e=g.location.toString();g.location=e.indexOf("#")>-1?e+"&fscommand=fsoptout":e+"#fscommand=fsoptout",g.location.reload()});e.API.expose("test",;var D=function(){T.subscribe(function(){w&&(clearTimeout(w),w=null),w=setTimeout(function(){if(w=null,!a._triggerResetLock){a._triggerResetLock=!0;var t=a.trig;t&&(t.dispose(),a.trig=null),e.resetStartTS();var i=e.API.retrieveFromAPI("runProductQualificationCheck");i&&i("trigger")?e.nextTick(_):a._triggerResetLock=!1}},250)},!0,!0)};e.API.expose("run",D),e.API.expose("pageReset",D);var R=function(){this.initialize(),this.present()};e.API.expose("showInvite",function(i){T.subscribe(function(){if(!a.state.inviteSuppressed&&!(document.getElementById("fsrInvite")||document.getElementById("acsMainInvite")||document.getElementById("fsrSurvey"))){var r=a.trig||E(a.stg,e.getProductConfig("fs","trigger"),a.browser,a.crit,a.CPPS),s=t.findSurveyDefinition(r.cfg,r.crit,r.stg,r.browser),n=r.crit.doesPassCriteria();n.passed||(a.state.inviteStatus=n.inviteStatus,a.state.reason=n.reason),s&&n.passed&&(r.init(s),r.surveydef&&(a.state.didInvite=!1,p(r,a.browser,a.stg,a.CPPS,i,a.jrny,"Traditional",R)))}},!0,!0)});e.API.expose("suppressInvite",function(){T.subscribe(m,!0,!0)});e.API.expose("allowInvite",;e.API.expose("setFSRVisibility",function(e){T.subscribe(!0,!0)}),e.API.expose("onLoaded",a.loadedEmitter),e.API.expose("onInitialized",a.initializedEmitter),e.API.expose("onInviteShown",a.inviteShownEmitter),e.API.expose("onInviteAccepted",a.inviteAcceptedEmitter),e.API.expose("onInviteAbandoned",a.inviteAbandonedEmitter),e.API.expose("onInviteDeclined",a.inviteDeclinedEmitter),e.API.expose("onTrackerShown",a.trackerShownEmitter),e.API.expose("customInvitationRequested",a.customInvitationRequested);var x={addEvent:function(e){T.subscribe(function(){a.jrny.addEvent(e)},!0,!0)},addEventObj:function(e){T.subscribe(function(){a.jrny.addEventObj(e)},!0,!0)},addEventString:function(e){T.subscribe(!0,!0)}};e.API.expose("Journey",x);var A={get:function(e,t){t=t||console.log,T.subscribe(!0,!0)},all:function(e){e=e||console.table||console.log,T.subscribe(function(){var t=a.stg.all(),i={};for(var r in t)1!==t[r].d&&(i[r]=t[r]);e(i)},!0,!0)}};e.API.expose("Storage",A);var L=new t.Cookie({path:"/",secure:!1,encode:!0}),M={get:function(e,t){t=t||console.log||function(){},T.subscribe(function(){try{return I.some(?t("_4c_s_"===e?JSON.parse(i.decompress(decodeURIComponent(L.getByNestedCookieName(e)))):L.getByNestedCookieName(e)):t(L.getByCookieName(e))}catch(r){console.error("trigger: couldn't read cookie",e)}},!0,!0)}};e.API.expose("Cookie",M);var V={set:function(e){T.subscribe(function(){try{t.setStorageIsEnabled(e)}catch(i){console.error("storageEnabled: couldn't set storageEnabled value",e)}},!0,!0)}};e.API.expose("enableStorage",V);var U=function(t,i,r,s,n){e.ext(a,{CPPS:r,crit:i,stg:t,jrny:s,browser:n},!1),T.fire()};var O=function(i,r,s,n,o,c){var d=e.getVendorConfig("fs"),f=e.API.retrieveFromAPI("isProductCurrentlyQualified");f&&f("record")&&r&&n&&d.products.record&&g._fsRequire([e.makeURI("$fs.record.js")],function(r){s.set("rc","true");var n={id:d.customerId||t.getRootDomain()||"record_customerId"};a.RecordController=r;var f=r.getInstance(i,g,s,n,o);a.rec=f,e.globalState.rec=f,c&&(c.recordController=a.rec)})},N={hash:g.location.hash,href:g.location.href,pathname:g.location.pathname},B=window!=g.top;function H(){var i=e.getVendorConfig("fs"),r=e.getProductConfig("fs","trigger"),s=e.getProductConfig("fs","record"),n=s?s.cxRecordDefs:[];if(a._triggerResetLock=!0,N.href.indexOf("fs.tracker.html")>-1)a._triggerResetLock=!1;else{var o=new t.Browser;o.ready.subscribe(function(){var s=t.getGeneralStorage(o),c=new t.CPPS(s,r.config.cppsResetTimeout);c.set("url",g.location.toString().replace(/(\?|&)(cpp\[[^&#]+\]+)=([^&#]*)/g,"")),c.set("env",e.isProduction?"prd":"stg");var d=new t.TriggerCriteria(s,r,c,o);s.ready.subscribe(function(){s.upgradeOldStorage(function(){a.pageLoadTime=t.now()-e.startTS,t.initBehavioralData(i.customerId||t.getRootDomain()||"trigger_customerId",s,o,c);var f=a._journey=new t.Journey({customerId:i.customerId||t.getRootDomain()||"trigger_customerId",appId:t.APPID.TRIGGER,stg:s,browser:o,useSessionId:!0,usePopupId:!1});f.addEventsDefault("properties",{fs_site:[t.getRootDomain()],fs_repeatDaysAccept:[r.config.repeatDays.accept],fs_repeatDaysDecline:[r.config.repeatDays.decline],fs_repeatDaysAbandon:[r.config.repeatDays.abandon]}),U(s,d,c,f,o);var u=s.get("i");setTimeout(function(){var l;if(s.get("ovr")&&(l=JSON.parse(s.get("ovr"))),l){for(var m=0;m<r.surveydefs.length;m++){var y=r.surveydefs[m].name;l.sp[y]&&(r.surveydefs[m].criteria.sp=l.sp[y]),l.lf[y]&&(r.surveydefs[m].criteria.lf=l.lf[y])}!0===l.pooloverride&&(d.pooloverride=!0)}if(a.state.codeVer=i.codeVer,a.state.siteKey=i.siteKey,a.state.didInvite="xda".indexOf(u)>-1,a.state.inviteSituation={x:"ACCEPTED",d:"DECLINED",a:"ABANDONED",p:"PRESENTED",f:"BRAINFAILED"}[u],"runRecordOnly"===r.config.workInIframes&&B){var S=n&&n.length>0;return O(o,S,s,!0,c),void(a._triggerResetLock=!1)}if("a"===u){var w="true"==s.get("rc")||!0===s.get("rc");return O(o,w,s,w,c),void(a._triggerResetLock=!1)}a.state.isinpool=!0;var _=a.trig=E(s,r,o,d,c,f);_.init(r.__foundDefinition),a.initializedEmitter.fire(),_.logDefState();var k=!!t.findMatchingDefFromList(n,_.surveydef);if(O(o,k,s,!0,c),"x"!=u){o.isMobile||o.isTablet||!_.surveydef.mouseoff||"off"===_.surveydef.mouseoff.mode||1!=s.get("pv")||s.set("sst",t.now());var I=_.getFittingDisplay(),T="SHORTSURVEY"===I.inviteType&&I.shortSurvey,C=T&&I.shortSurvey.idleViewsBeforeStop&&I.shortSurvey.idleViewsBeforeStop>0,D=C&&_.getShortSurveyOptions(I);if(!r.__canDisplayInvitation||T&&C&&!D)a._triggerResetLock=!1;else{var R=D&&I.shortSurvey.idleViewsShowConsecutively&&D.presentedCount>=1&&D.presentedCount<=I.shortSurvey.idleViewsBeforeStop;_.evalLoyaltySampling("criteria")||R?(s.set("def",_.surveydef.uid,_.cfg.config.surveyDefResetTimeout||864e5),g.fsReady(function(){a.state.inviteSuppressed||p(_,o,s,c,!1,f,"Traditional",})):s.get("sst")&&(_.evalLoyaltySampling("mouseoff")||R)?(s.set("def",_.surveydef.uid,_.cfg.config.surveyDefResetTimeout||864e5),g._fsRequire([e.makeURI("$fs.mouseoff.js")],function(e){if(!a.state.inviteSuppressed){a._triggerResetLock=!1;var t=_.mouseoff=new e(_,_.surveydef,o,s,f);t.initialize(),t.startListening(function(){this.inviteSetup=p(_,o,s,c,!1,f,"MouseOff",},}})):a._triggerResetLock=!1}}else{var x=_.stg.get("mhbi");if(x)v(_,x.ui,x.it);else if(t.isTrackerAlive(s)){var A=h.getFittingDisplay(_.surveydef);_.tracker=new P(A.template,_.surveydef,r,t.getBrainStorage(o,s.uid),c,A,o)}a._triggerResetLock=!1}_.surveydef.links&&new b(_.surveydef.links).performBindings(_)},Math.max(0,r.config.triggerDelay-(t.now()-e.startTS)))})},!0,!0)},!0,!0)}}return r.startup=function(){var i,r=e.getProductConfig("fs","trigger");if(!(r&&r.config&&r.surveydefs&&r.config.browserCutoff))throw new Error("Looks like the trigger config is missing or broken. Please push a trigger config to fix this error.");if(r.surveydefs.length&&"string"==typeof r.surveydefs[0])throw new Error("Looks like an old trigger config from pre-19.9.0. Please re-push the trigger settings with 19.9.0+ to fix this error.");t.registerProduct("foresee",r),a.loadedEmitter.fire(),g.__fsrtracker||g.location.toString().indexOf("survey.foreseeresults.com")>-1||(e.fsCmd("fstest")?g._fsRequire([e.makeURI("$fs.svadmin.js")],function(){}):e.fsCmd("fsoptout")?g._fsRequire([e.makeURI("$fs.optout.js")],:(e.domReady(H),_=H,r.config.ignoreNavigationEvents||t.pageNavEvent.subscribe(function(){var e=g,s=e.location,n=e[r.config.publicApiName||"FSR"],o=function(e){var t=e.split("#");return t.length>2?t[0]+t[1]:e.replace(/#/gi,"")},a=o(N.hash),c=o(s.hash);t.now()-t.startTime<(r.config.pageLoadUrlChangeBlackout||0)||(n&&a!=c||N.pathname!=s.pathname)&&g.fsReady(function(){clearTimeout(i),i=setTimeout(function(){N={hash:g.location.hash,href:g.location.href,pathname:g.location.pathname},n.pageReset()},1e3)})},!1,!1)))},r});
