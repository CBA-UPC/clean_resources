(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[577],{PsH8:function(e,o,n){"use strict";n.r(o),n.d(o,"MoveToFolderControlModuleNgFactory",(function(){return O}));var t=n("keVe"),l=n("QjXU"),r=n("pM41"),i=n("lUkk"),s=n("lrJm"),a=n("hhzZ"),u=n("BaAg"),c=n("p6Zr"),d=n("QOOv"),m=n("kpuN"),v=n("hZW2"),p=n("Uqr9"),f=n("cgnd"),h=n("PBJH"),b=n("uUrA"),g=n("pjz5"),T=n("zKXa"),y=function(){function e(e,o,n,l,r,i,s,a,u,c){this.accessTokenService=e,this.moveToFolderControlService=o,this.mruConfigService=n,this.clientStartupConfigService=l,this.locService=r,this.instrumentationService=i,this.renderer=s,this.globalErrorHandler=a,this.documentService=u,this.changeDetectorRef=c,this.dismiss=new t.q}return Object.defineProperty(e.prototype,"moveToFolderIframe",{set:function(e){var o=this;e&&!this._moveToFolderIframe&&(this.mobileMoveToFolderMenu&&(setTimeout((,0),this.documentService.disableTouchMove()),this._moveToFolderIframe=e,this.initControl())},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.isComponentReady()&&(this.isLoading=!0),this.errorText="",this.loadingText=this.locService.MoveToFolderControlLoadingText,this.titleAriaLabel=this.locService.MoveToFolderControlTitleAriaLabel,this.style=this.getStyleForMoveToFolder(),this.isMsa=this.clientStartupConfigService.config.authType===f.a.MSA},e.prototype.ngAfterViewInit=function(){var e=this;(this.mobileMoveToFolderMenu||this.contentMoveToFolderMenu)&&(this.moveToFolderControlOpenSubscription=this.moveToFolderControlService.subscribeToOpenEvents((function(o){var n,t,r;e.docUrl=o.docUrl,e.channelId=b.a.createGuid(),e.wopiHostData=o.wopiData;var i=g.a.removeFileNameFromDocUrl(e.docUrl);e.webUrl=e.wopiHostData.sharepointIds.siteUrl;var s=e.webUrl+"/_layouts/15/FilePicker.aspx",a={sdk:"8.0",messaging:{origin:location.origin,channelId:e.channelId},typesAndSources:{mode:"folders",pivots:Object(l.__assign)({recent:!1,search:!1,shared:!1},e.supportsCrossSiteMove?{}:{oneDrive:!1,sharedLibraries:!1})},selection:{mode:"pick"},entry:{sharePoint:{byPath:{web:e.webUrl,folder:i}}},commands:{pick:{action:"move",move:{sourceItems:[{parentReference:{sharepointIds:{listId:null===(n=e.wopiHostData.sharepointIds)||void 0===n?void 0:n.listId,siteUrl:null===(t=e.wopiHostData.sharepointIds)||void 0===t?void 0:t.siteUrl}},sharepointIds:{listItemId:null===(r=e.wopiHostData.sharepointIds)||void 0===r?void 0:r.listItemId}}]}}},authentication:{}};e.style=e.getStyleForMoveToFolder(),e.isLoading=!0,e.initTokens(),e.iframeUrl=s+"?"+function(e,o,n){var t="",l=!0;for(var r in e){var i=e[r];l?l=!1:t+="&",t+=r+"="+("object"==typeof i&&i&&i.uriValue?i.uriValue:encodeURIComponent(""+i))}return t}({app:"OfficeHome",scenario:"WACHost."+u.b[e.fileType],filePicker:JSON.stringify(a)}),e.onItemMoved=o.onItemMoved,e.changeDetectorRef.detectChanges()})),this.moveToFolderControlCloseSubscription=this.moveToFolderControlService.subscribeToCloseEvents(())},e.prototype.ngOnDestroy=e.prototype.onLeavingIframeFocus=e.prototype.handleClose=function(e){e&&e.preventDefault(),this.dismiss.emit(),(this.mobileMoveToFolderMenu||this.contentMoveToFolderMenu)&&this.moveToFolderControlService.hideControl({docUrl:this.docUrl,wopiData:this.wopiHostData,supportsCrossSiteMove:this.supportsCrossSiteMove})},e.prototype.isComponentReady=e.prototype.resetComponent=function(){if(this.windowMessageListener&&this.windowMessageListener(),clearTimeout(this.errorTimeout),this.isLoading){var e=p.a.now(),o=this.commonInstrumentationParams();o.Latency=Math.round(e-this.startInitTime).toString(),this.instrumentationService.logGenericEvent("Move_To_Folder_Control_Abandon",o)}(this.mobileMoveToFolderMenu||this.contentMoveToFolderMenu)&&(this.docUrl=null,this.wopiHostData=null,this._moveToFolderIframe=null,this.iframeUrl=null,this.errorText=null,this.isLoading=!1)},e.prototype.initTokens=function(){this.startInitTime=p.a.now();var e=this.getTokenType(this.docUrl),o=u.a.getFileExtensionFromUrl(this.docUrl);this.fileType=u.a.fileTypeFromExtension(o),this.tokenPromise=this.moveToFolderControlService.getToken(this.docUrl,this.mruConfigService.config.shareControlCAPPopupEnabled,this.fileType,e)},e.prototype.getTokenType=function(e){return this.isMsa?"Graph":this.moveToFolderControlService.getTokenType(e)},e.prototype.initControl=function(){var e=this;if(this.isComponentReady()){setTimeout((function(){return e.loadingContainer.nativeElement.focus()}),0);var o=function(o,n,t,l){e.isLoading&&(e.errorText=e.locService.MoveToFolderControlErrorText,e.isLoading=!1),(t||l)&&(o=o+". Error message: "+t+". Debug error message: "+l),e.instrumentError(o,n)},n=function(o){var n=o.data,t=e.commonInstrumentationParams(),l=p.a.now();if(t.Latency=Math.round(l-e.startInitTime).toString(),t.MoveToFolderControlLatency=Math.round(l-e.moveToFolderStartTime).toString(),"command"===n.type){e.port.postMessage({type:"acknowledge",id:n.id});var r=n.data;switch(r.command){case"authenticate":var i=r.resource,s=e.getTokenType(i);e.accessTokenService.getAccessToken(s,!1,i).then((function(o){o&&o.success&&e.port.postMessage({type:"result",id:n.id,data:{result:"token",token:o.token.trim()}})})),e.instrumentationService.logGenericEvent("Move_To_Folder_Control_Authenticate",t);break;case"pick":var a="pick"===n.data.command,u=!n.data.items[0].webDavUrl.startsWith(e.webUrl);a&&e.onItemMoved&&e.onItemMoved(a,u?e.webUrl:void 0,u),e.instrumentClick(r.command,u),e.handleClose(),e._moveToFolderIframe.nativeElement.src="";break;case"close":e.instrumentClick(r.command),e.handleClose()}}else if("notification"===n.type)switch(n.data.notification){case"page-loaded":e.isLoading=!1,e.errorText=null,e.changeDetectorRef.detectChanges(),setTimeout((,0),clearTimeout(e.errorTimeout),e.instrumentImpression(e.moveToFolderStartTime,"Move_To_Folder_Control_Impression");break;case"navigation-started":e.instrumentationService.logGenericEvent("Move_To_Folder_Control_Navigation_Started",t);break;case"navigation-ended":e.instrumentationService.logGenericEvent("Move_To_Folder_Control_Navigation_Ended",t)}},t=function(o){if(o.source&&e._moveToFolderIframe&&o.source===e._moveToFolderIframe.nativeElement.contentWindow&&o.origin===e.pickerOrigin){var l=o.data;"initialize"===l.type&&l.channelId===e.channelId&&(e.intervalId&&(clearInterval(e.intervalId),e.intervalId=void 0),e.port=o.ports[0],e.port.addEventListener("message",n),e.port.start(),window.removeEventListener("message",t),e.port.postMessage({type:"activate"}))}};this.tokenPromise.then((function(n){if(n.success){e.moveToFolderStartTime=p.a.now(),e.errorTimeout=setTimeout((,15e3);var l=e._moveToFolderIframe.nativeElement.contentWindow,r=l.document.createElement("form");l.document.body.appendChild(r);var i=l.document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name","access_token"),i.setAttribute("value",n.token.trim()||""),r.appendChild(i),r.setAttribute("method","POST"),r.setAttribute("action",e.iframeUrl),r.submit(),e.pickerOrigin=new URL(e.iframeUrl).origin,e.intervalId=setInterval((function(){l.postMessage({type:"identify-parent",channelId:e.channelId},e.pickerOrigin)}),200),e.windowMessageListener=e.renderer.listen("window","message",t)}else o("Token fetch failed")})).catch((function(n){e.globalErrorHandler.handleError(n,"oGPOu"),o("Initialization error")}))}},e.prototype.getStyleForMoveToFolder=function(){return{width:this.mobileMoveToFolderMenu?"100%":"800px",height:"600px",border:"none",display:"block"}},e.prototype.instrumentImpression=function(e,o){if(!this.loggedImpression){var n=p.a.now(),t=this.commonInstrumentationParams(),l=Math.round(n-e);this.instrumentationService.logPerformanceEvent(o,l,t),Object(r.a)({eventName:o,latency:l,instrumentationParams:t}),this.instrumentationService.logImpressionEvent("Move_To_Folder_Control_Impression",t),this.loggedImpression=!0}},e.prototype.instrumentClick=function(e,o){var n=this.commonInstrumentationParams();o&&(n.IsCrossSiteMove="true"),this.instrumentationService.logClickEvent("Move_To_Folder_Control_Click",e,a.b.Documents,null,"Web",n),Object(i.a)({result:"Navigate",target:"MoveToFolderControl",id:e,eventName:"Move_To_Folder_Control_Click",area:"Documents"})},e.prototype.instrumentError=function(e,o){var n=this.commonInstrumentationParams();n.Error=e,n.ItemCategory=o,this.instrumentationService.logGenericEvent("Move_To_Folder_Control_Error",n)},e.prototype.commonInstrumentationParams=function(){var e={},o=u.a.referralFromFileLocation(this.docUrl);return!o&&u.a.isConsumerDocument(this.docUrl)?o="Consumer":o===c.a.OneDrive?o="OneDrive":o===c.a.SharePoint&&(o="SharePoint"),e.StorageType=o,e},e}(),C=y,F=),M=n("TOqr"),I=t.Fb({encapsulation:2,styles:[],data:{animation:[{type:7,name:"openAndClose",definitions:[{type:1,expr:"* => open",animation:{type:10,animation:{type:8,animation:[{type:6,styles:{transform:"translate3d(0, 100%, 0)"},offset:null},{type:4,styles:{type:6,styles:{transform:"translate3d(0, 0, 0)"},offset:null},timings:"{{ slideDuration }} cubic-bezier(0.1, 0.9, 0.2, 1)"}],options:{params:{slideDuration:"300ms"}}},options:null},options:null},{type:1,expr:"open => closing",animation:{type:10,animation:{type:8,animation:[{type:6,styles:{opacity:1},offset:null},{type:4,styles:{type:6,styles:{opacity:0},offset:null},timings:"{{ fadeDuration }} 0ms linear"}],options:{params:{fadeDuration:"100ms"}}},options:null},options:null}],options:{}}]}});unction k(e){return t.jc(0,[(e()(),t.Hb(0,0,null,null,3,"div",[],null,null,null,null,null)),(e()(),t.Hb(1,0,null,null,0,"div",[["class","ms-Spinner-circle ms-Spinner--medium"]],null,null,null,null,null)),(e()(),t.Hb(2,0,null,null,1,"div",[["class","move-to-folder-control__label move-to-folder-control__spinner-label"],["role","status"]],null,null,null,null,null)),(e()(),t.gc(3,null,["",""]))],null,(function(e,o){e(o,3,0,o.component.loadingText)}))}function _(e){return t.jc(0,[(e()(),t.Hb(0,0,null,null,2,"div",[["role","status"]],null,null,null,null,null)),(e()(),t.Hb(1,0,null,null,1,"div",[["class","move-to-folder-control__label move-to-folder-control__error-label"]],null,null,null,null,null)),(e()(),t.gc(2,null,["",""]))],null,(function(e,o){e(o,2,0,o.component.errorText)}))}function w(e){return t.jc(0,[(e()(),t.Hb(0,0,[[2,0],["loadingContainer",1]],null,8,"div",[["class","officeHome-callout-main ms-bgc-w"],["tabindex","0"]],[[24,"@openAndClose",0]],null,null,null,null)),t.Gb(1,278528,null,0,M.i,[t.x,t.y,t.o,t.K],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),t.Zb(2,{"move-to-folder-control--mobile":0,"move-to-folder-control--content":1}),t.Gb(3,278528,null,0,M.n,[t.o,t.y,t.K],{ngStyle:[0,"ngStyle"]},null),(e()(),t.Hb(4,0,null,null,4,"div",[["class","spinner-container"]],null,null,null,null,null)),(e()(),t.qb(16777216,null,null,1,null,k)),t.Gb(6,16384,null,0,M.k,[t.W,t.S],{ngIf:[0,"ngIf"]},null),(e()(),t.qb(16777216,null,null,1,null,_)),t.Gb(8,16384,null,0,M.k,[t.W,t.S],{ngIf:[0,"ngIf"]},null)],(function(e,o){var n=o.component,t=e(o,2,0,n.mobileMoveToFolderMenu,n.contentMoveToFolderMenu&&!n.mobileMoveToFolderMenu);e(o,1,0,"officeHome-callout-main ms-bgc-w",t),e(o,3,0,n.style),e(o,6,0,n.isLoading),e(o,8,0,n.errorText)}),()}function U(e){return t.jc(0,[(e()(),t.Hb(0,0,null,null,7,null,null,null,null,null,null,null)),(e()(),t.Hb(1,0,null,null,6,"div",[],[[4,"visibility",null]],null,null,null,null)),(e()(),t.Hb(2,0,null,null,0,"a",[["href","#"],["style","width:0; height:0;"]],null,[[null,"focus"]],(function(e,o,n){var t=!0;return"focus"===o&&(t=!1!==e.component.onLeavingIframeFocus()&&t),t}),null,null)),(e()(),t.Hb(3,0,[[1,0],["moveToFolderIframe",1]],null,3,"iframe",[["class","officeHome-callout-main move-to-folder-iframe"],["sandbox","allow-scripts"]],[[1,"aria-label",0]],null,null,null,null)),t.Gb(4,278528,null,0,M.i,[t.x,t.y,t.o,t.K],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),t.Zb(5,{"move-to-folder-control--mobile":0,"move-to-folder-control--content":1}),t.Gb(6,278528,null,0,M.n,[t.o,t.y,t.K],{ngStyle:[0,"ngStyle"]},null),(e()(),t.Hb(7,0,null,null,0,"a",[["href","#"],["style","width:0; height:0;"]],null,[[null,"focus"]],(,null,null))],(function(e,o){var n=o.component,t=e(o,5,0,n.mobileMoveToFolderMenu,n.contentMoveToFolderMenu&&!n.mobileMoveToFolderMenu);e(o,4,0,"officeHome-callout-main move-to-folder-iframe",t),e(o,6,0,n.style)}),(function(e,o){var n=o.component;e(o,1,0,n.isLoading||n.errorText?"hidden":""),e(o,3,0,n.titleAriaLabel)}))}function E(e){return t.jc(0,[(e()(),t.Hb(0,0,null,null,8,"div",[],null,null,null,null,null)),t.Gb(1,278528,null,0,M.i,[t.x,t.y,t.o,t.K],{ngClass:[0,"ngClass"]},null),t.Zb(2,{"page-overlay":0}),(e()(),t.qb(16777216,null,null,1,null,S)),t.Gb(4,16384,null,0,M.k,[t.W,t.S],{ngIf:[0,"ngIf"]},null),(e()(),t.qb(16777216,null,null,1,null,w)),t.Gb(6,16384,null,0,M.k,[t.W,t.S],{ngIf:[0,"ngIf"]},null),(e()(),t.qb(16777216,null,null,1,null,U)),t.Gb(8,16384,null,0,M.k,[t.W,t.S],{ngIf:[0,"ngIf"]},null)],(function(e,o){var n=o.component,t=e(o,2,0,n.contentMoveToFolderMenu);e(o,1,0,t),e(o,4,0,(n.mobileMoveToFolderMenu||n.contentMoveToFolderMenu)&&n.iframeUrl),e(o,6,0,n.isLoading||n.errorText),e(o,8,0,n.iframeUrl)}),null)}function D(e){return t.jc(0,[t.cc(671088640,1,{moveToFolderIframe:0}),t.cc(671088640,2,{loadingContainer:0}),(e()(),t.qb(16777216,null,null,1,null,E)),t.Gb(3,16384,null,0,M.k,[t.W,t.S],{ngIf:[0,"ngIf"]},null)],(function(e,o){var n=o.component;e(o,3,0,n.iframeUrl||n.isLoading||n.errorText)}),null)}var H=t.Db("ohp-move-to-folder",y,(function(e){return t.jc(0,[(e()(),t.Hb(0,0,null,null,1,"ohp-move-to-folder",[],null,null,null,D,I)),t.Gb(1,4440064,null,0,y,[m.b,T.a,d.a,f.b,h.a,a.a,t.K,s.b,v.a,t.h],null,null)],(,null)}),{docUrl:"docUrl",wopiHostData:"wopiHostData",supportsCrossSiteMove:"supportsCrossSiteMove",mobileMoveToFolderMenu:"mobileMoveToFolderMenu",contentMoveToFolderMenu:"contentMoveToFolderMenu",onItemMoved:"onItemMoved"},{dismiss:"dismiss"},[]),L=n("CCRL"),O=t.Eb(F,[],(function(e){return t.Tb([t.Ub(512,t.k,t.hb,[[8,[H]],[3,t.k],t.D]),t.Ub(4608,M.m,M.l,[t.z]),t.Ub(1073742336,M.c,M.c,[]),t.Ub(1073742336,F,F,[]),t.Ub(256,L.a,C,[])])}))},zKXa:function(e,o,n){"use strict";n.d(o,"a",();var t=n("2dXW"),l=n("zvoD"),r=n("f0qX"),i=n("BaAg"),s=n("p6Zr"),a=n("kpuN"),u=n("pjz5"),c=n("keVe"),d=function(){eturn e.prototype.getToken=function(e,o,n,t){void 0===t&&(t=null);var l=u.a.getLocation(e),r=l?l.protocol+"//"+l.hostname:"";return null===t&&(t=this.getTokenType(e)),this.accessTokenService.getAccessToken(t,!1,r,o,{category:"Share",fileType:n})},e.prototype.getTokenType=function(e){return i.a.referralFromFileLocation(e)===s.a.OneDrive?"OneDrive":"SharePoint"},e.prototype.showControl=function(e){this.updateNext(e,0)},e.prototype.hideControl=e.prototype.subscribeToOpenEvents=function(e){return this.moveToFolderControl.asObservable().pipe(Object(l.a)((function(e){return e&&0===e.type})),Object(r.a)((function(e){return e.moveToFolderControl}))).subscribe(e)},e.prototype.subscribeToCloseEvents=function(e){return this.moveToFolderControl.asObservable().pipe(Object(l.a)((),Object(r.a)(()).subscribe(e)},e.prototype.updateNext=e.ɵprov=c.kc({factory,token:e,providedIn:"root"}),e}()}}]);
//# sourceMappingURL=move-to-folder-control.62a2ed112b41d5ed5fc9.chunk.v7.js.map