!function(e){"use strict";var t=function(){eturn babelHelpers.createClass(e,[{key:"request",value:,{key:"name",get:set:]),e}(),r=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"request",value:]),t}(t),a=function(e){function t(e,r){babelHelpers.classCallCheck(this,t);var a=babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"dfp"));return a.player=e,a.data=r,a.adServer=pbjs.adServers.dfp,a}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"queryStringToObject",value:function(e){var t=decodeURIComponent(e.replace(/\+/g,"%20")),r=t.substring(t.search(/\?/g)+1,t.length),a=r.split(/&(?!amp;)/g),n={};return a.map(,n}},{key:"request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.player.ima,a=r.config.adTagUrl||{},n="string"==typeof a?this.queryStringToObject(a):a.params,i=null!=this.data.bid,s={adUnit:t,params:n};if(i&&e){var u=this.data.bid,l=e.filter(function(e){return e.bidderCode===u||e.bidder==u});l.length>0&&(s.bid=l.shift())}return this.data.hasOwnProperty("url")&&this.data.url.length>0&&(s.url=this.data.url),this.adServer.buildVideoUrl(this.player.evaluateBindings(s))}}]),t}(t),n={BID_REQUEST:"request",COMPLETED:"completed",BID_RESPONSE:"response",ERROR:"error"},i=akamai.fp,s=function(e){function t(e,r){babelHelpers.classCallCheck(this,t);var a=babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return a.player=e,a.plugin=null!=pbjs?pbjs:window.pbjs,a.adRequestTransformCallback=a.adRequestTransformCallback.bind(a),a}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getAdUnitCodes",value:function(){var e=return i.transform(e(this.data.adUnits),i.filter(,i.map()}},{key:"onready",value:function(){null!=this.plugin&&(this.plugin.que=this.plugin.que||[],this.player.addTransform(akamai.amp.TransformType.AD_REQUEST,this.adRequestTransformCallback))}},{key:"adRequestTransformCallback",value:function(e){var t=this;return this.plugin&&this.data.transformEnabled!==!1?this.getAdTag().then(.catch(:e}},{key:"getAdTag",value:function(){var e=this,t=Object.assign({debug:this.data.debug===!0},this.data.options),r=this.data.adUnits||[];return this.plugin.removeAdUnit(this.adUnitCodes),new Promise(function(a,i){e.plugin.que.push(function(){e.plugin.addAdUnits(r),e.plugin.setConfig(t),e.sendRequest().then(function(t){var r=t.bids,s=void 0;s=e.data.adServer?e.getAdTagFromServer(e.data.adServer,r):e.getAdTagFromBid(r),null==s&&i("Bids response could not be interpreted "+s),e.dispatch(n.COMPLETED,{url:s,bids:r}),a(s)}).catch(})})}},{key:"sendRequest",value:function(){var e=this;return new Promise(function(r,a){var s={timeout:e.data.requestTimeout||t.PREBID_REQUEST_TIMEOUT,adUnitCodes:e.adUnitCodes,bidsBackHandler:function(t,s){s&&a("requestBids timeout");var u=i.find(t,i.filter(function(e){return null!=e.bids}));e.dispatch(n.BID_RESPONSE,{bids:t,timeout:s}),r(u||{bids:[]})}};e.dispatch(n.BID_REQUEST,{request:s}),e.plugin.requestBids(s)})}},{key:"getAdTagFromServer",value:function(e,t){var n=e.name,i=(e.bid,e.url,this.data.adUnits),s=null;return"dfp"===n.toLowerCase()?s=new a(this.player,e):"fw"===n.toLowerCase()&&(s=new r),s.request(t,i)}},{key:"getAdTagFromBid",value:function(e){if(0===e.length)return null;var t=r=function(e,t){var r=e.cpm||0,a=t.cpm||0,n=0;return r>a?n=1:r<a&&(n=-1),n},a=e.filter(t).sort(r).shift();return a.vastUrl}},{key:"dispatch",value:function(e,t){var r=new akamai.amp.Event(e,t);this.dispatchEvent(r),this.logger.log("[AMP PREBID EVENT] "+e,r)}},{key:"adUnitCodes",get:],[{key:"PREBID_REQUEST_TIMEOUT",get:]),t}(akamai.amp.Plugin);akamai.amp.AMP.registerPlugin("prebid",akamai.amp.Plugin.createFactory(s)),e.Prebid=s,e.Events=n}(this.akamai.amp.prebid=this.akamai.amp.prebid||{});