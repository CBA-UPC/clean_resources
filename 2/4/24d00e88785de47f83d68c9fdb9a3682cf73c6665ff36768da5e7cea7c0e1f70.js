/*! ravelinjs 1.5.0 - https://github.com/unravelin/ravelinjs. Copyright 2021 */
var Ravelin=function(){"use strict";var u,D="1.5.0-ravelinjs";unction e(u,D,t){return t=Array.prototype.slice.call(arguments,2),Function.prototype.bind?Function.prototype.bind.apply(u,[D].concat(t)):function n(){var D,t,e,n;if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues&&"undefined"!=typeof Int32Array){var F=new Int32Array(4);window.crypto.getRandomValues(F),D=F[0],t=F[1],e=F[2],n=F[3]}else D=4294967295*Math.random()|0,t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0;if(!u){u=[];for(var i=0;i<256;i++)u[i]=(i<16?"0":"")+i.toString(16)}return u[255&D]+u[D>>8&255]+u[D>>16&255]+u[D>>24&255]+"-"+u[255&t]+u[t>>8&255]+"-"+u[t>>16&15|64]+u[t>>24&255]+"-"+u[63&e|128]+u[e>>8&255]+"-"+u[e>>16&255]+u[e>>24&255]+u[255&n]+u[n>>8&255]+u[n>>16&255]+u[n>>24&255]}function F(u){this.Promise=u.Promise,this.key=u.key,this.api=u.api||function(u){if(!u||"publishable_key_"!=u.substr(0,16))return i;var D=u.substr(16).split("_");if(D.length<2)return i;var t=D[D.length-2];if("test"==t||"live"==t)return i;return"https://"+encodeURIComponent(t)+".ravelin.click"}(this.key),this.api=this.api[0]+this.api.substr(1).replace(/^\/+|\/$/g,""),this.sendRetryMs=u.sendRetryMs||150,this.cookie=u.cookie||"ravelinDeviceId",this.sessionCookie=u.sessionCookie||"ravelinSessionId",this.cookieExpiryDays=u.cookieExpiryDays||365,this.cookies=new t({domain:u.cookieDomain}),this._id=function(u,D){if(D&&"function"==typeof D.then)return D;return new u(()}(this.Promise,u.id),this.sync(),!1!==u.init&&this.attach(u.syncMs||2e3)}t.prototype.get=function(u){for(var D=document.cookie.split("; "),t=D.length-1;t>=0;t--){var e=D[t].split("=");if(e[0]===u)return e[1]}return undefined},t.prototype.set=function(u){var D=u.name+"="+u.value+";path="+(u.path||"/")+(u.expires?";expires="+u.expires.toUTCString():"")+(this.domain?";domain="+this.domain:"");if("undefined"==typeof this.samesite){if(!function(u){if(/\(iP.+; CPU .*OS 12[_\d]*.*\) AppleWebKit\//.test(u))return!0;if(/\(Macintosh;.*Mac OS X 10_14[_\d]*.*\) AppleWebKit\//.test(u)){if(/^Mozilla\/[\.\d]+ \(Macintosh;.*Mac OS X [_\d]+\) AppleWebKit\/[\.\d]+ \(KHTML, like Gecko\)$/.test(u))return!0;if(/Version\/.* Safari\//.test(u)&&!/Chrom(e|ium)/.test(u))return!0}return!1}(window.navigator.userAgent)?"https:"==window.location.protocol?this.samesite=";SameSite=None;Secure":this.samesite=";SameSite=Lax":this.samesite="",document.cookie=D+this.samesite,this.get(u.name)==u.value)return;this.samesite=""}document.cookie=D+this.samesite},F.prototype.id=F.prototype.ids=function(){if(this._ids)return this._ids;var u=this;return this._ids=this.sniffError(this._id).then(undefined,(function(){})).then((function(D){var t=D||u.cookies.get(u.cookie),e=u.cookies.get(u.sessionCookie);if(!D&&e){var F=e.indexOf(":");-1!=F&&(t=e.substr(0,F)),t&&e,t+":")&&(e=e.substr(t.length+1))}return{device:t||"rjs-"+n(),session:e||n()}})),this._ids},F.prototype.sync=function(){var u=this;return this.ids().then((function(D){var t;u.cookieExpiryDays>0&&u.cookies.set({name:u.cookie,value:D.device,expires:(t=u.cookieExpiryDays,new Date((new Date).getTime()+86400*t*1e3))}),u.cookies.set({name:u.sessionCookie,value:D.device+":"+D.session})}))},F.prototype.attach=function(u){setInterval(e(this.sync,this),u)};var i="https://live.ravelin.click";var r=window.XDomainRequest;function o(u){if(Array.prototype.toJSON){var D=Array.prototype.toJSON;delete Array.prototype.toJSON;var t=JSON.stringify(u);return Array.prototype.toJSON=D,t}return JSON.stringify(u)}function A(u,D){this.core=u,this.windowId=n();try{this.dimensions=C()}catch(t){}!1!==D.init&&(this.load(D.page),this._attachAll())}function C(){return{w:window.outerWidth||window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h:window.outerHeight||window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}nction a(u,D){var t;return function(){var e=Array.prototype.slice.call(arguments);t&&clearTimeout(t),t=setTimeout((,u)}}function B(u){u.Promise=u.Promise||B.Promise,this.core=new F(u),this.track=new A(this.core,u)}return F.prototype.reportError=function(u){var t=this;return this._ids?this._ids.then(undefined,(function(){})).then(e):e();function e(e){return t.send("POST","z/err",{deviceId:e&&e.device,libVer:D,type:u.name,msg:u.message||u,error:u.stack}).then((function(){}))}},F.prototype.sniffError=function(u){var D=this;try{var t="function"==typeof u?u():u;return t&&t.then&&t.then(undefined,(),t}catch(e){throw D.reportError(e),e}},F.prototype.bind=function(){var u=this,D=e.apply(null,Array.prototype.slice.call(arguments));return function(){var t=Array.prototype.slice.call(arguments);return u.sniffError(()}},F.prototype.send=function(u,D,t){if(!this.key)throw new Error("ravelin/core: no key set for API requests");var e=this.api+"/"+D.replace(/^\/+/,"");e=(e+=(-1==e.indexOf("?")?"?":"&")+"key="+encodeURIComponent(this.key)).replace(/^\/+/,"/");var n=this;return function(u,D,t,e){t||(t=2);var n=0;return new u((function(F,i){return function r(o){return new u(().then((function(){return D((function(u){throw{message:"promise-retry",err:u}}),++n)})).then(F,(function(u){if(u&&"promise-retry"===u.message)return n-1<t?r(o+(e||150)):void i(u.err);i(u)}))}(0)}))}(n.Promise,(function(D,F){return!function(u){var D=u.match("(https?)?://([^/]+)");return!D||D[2]==window.location.host&&(""==D[1]||D[1]==window.location.protocol.replace(/:/,""))}(e)&&r?n._sendXDR(u,e,o(t)):n._sendXHR(u,e,o(t)).then((function(u){return u.attempt=F,1223==u.status&&(u.status=204),u.status>=200&&u.status<300?u:(400==u.status&&""==u.text||u.status>=500?D(u):u.status||D(u),new n.Promise(())}))}),2,this.sendRetryMs).then(undefined,(function(D){if(D.attempt)throw new Error("ravelin/core: "+u+" "+e+" attempt "+D.attempt+" returned status "+D.status+(D.text?" and body "+D.text:""));throw D}))},F.prototype._sendXHR=function(u,D,t){return new this.Promise((function(e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&e({status:n.status,text:n.responseText})},n.open(u,D),n.send(t)}))},F.prototype._sendXDR=function(u,D,t){return new this.Promise((function(e,n){var F=new r;F.onload=function(){e({status:F.status||200,text:F.responseText})},F.onerror=F.onprogress=F.open(u,D),setTimeout((,0)}))},A.prototype._attachAll=function(){this._listeners=[],document.addEventListener&&this._attach({target:document,addFn:"addEventListener",delFn:"removeEventListener",event:"paste",handler:this.core.bind(this.paste,this)}),window.addEventListener?this._attach({target:window,addFn:"addEventListener",delFn:"removeEventListener",event:"resize",handler:a(250,this.core.bind(this.resize,this))}):window.attachEvent&&this._attach({target:window,addFn:"attachEvent",delFn:"detachEvent",event:"onresize",handler:a(250,this.core.bind(this.resize,this))})},A.prototype._attach=function(u){this._listeners.push(u);var D=u.target[u.addFn];return D.call?D.call(u.target,u.event,u.handler):D(u.event,u.handler)},A.prototype._detach=function(){for(;this._listeners&&this._listeners.length>0;){var u=this._listeners.pop(),D=u.target[u.delFn];D.call?D.call(u.target,u.event,u.handler):D(u.event,u.handler)}},A.prototype._send=function(u,t,e){var n=this;return this.core.ids().then((function(F){return n.core.send("POST","/z",{events:[{eventType:u,eventData:{eventName:t,properties:e},libVer:D,eventMeta:{trackingSource:"browser",url:window.location.href,ravelinDeviceId:F.device,ravelinSessionId:F.session,ravelinWindowId:n.windowId,pageTitle:document.title,referrer:document.referrer||undefined,clientEventTimeMilliseconds:Date.now?Date.now():+new Date}}]})}))},A.prototype.load=A.prototype.event=A.prototype.resize=function(){var u;try{u=C()}catch(t){return}var D=this.dimensions;this.dimensions=u,D.w===u.w&&D.h===u.h||this._send("resize","resize",{resolutionOld:{w:D.w,h:D.h},resolutionNew:{w:u.w,h:u.h}})},A.prototype.paste=function(u){var D=!1,t=!1,e={},n=u&&u.target;if(n&&(t=n.hasAttribute("data-rvn-pan"),e.fieldName=n.name||n.id||undefined,n.form&&(e.formName=s(n.form,"name")||s(n.form,"id"),e.formAction=s(n.form,"action")),(D="password"==n.type||function(u,D){for(;u&&u.hasAttribute;){if(u.hasAttribute(D))return!0;u=u.parentNode}return!1}(n,"data-rvn-sensitive"))||(n.value&&(e.fieldValue=E(n.value)),"number"==typeof n.selectionStart&&(e.selectionStart=n.selectionStart,e.selectionEnd=n.selectionEnd))),!D&&u&&u.clipboardData){var F=u.clipboardData.getData("Text")||u.clipboardData.getData("text/plain");F&&(t&&(e.panCleaned=function(u){u=u.replace(/[ -]+/g,"");var D,t=/\d+/g;for(;null!==(D=t.exec(u));)if(D[0].length>=12&&D[0].length<=19)return!0;return!1}(F)),e.pastedValue=E(F))}return t&&"undefined"==typeof e.panCleaned&&(e.panCleaned=!0),this._send("paste","paste",e)},B.Promise=window.Promise,B}();
//# sourceMappingURL=ravelin-core-track.min.js.map
