(()=>{var fi=Object.create;var Je=Object.defineProperty,gi=Object.defineProperties,hi=Object.getOwnPropertyDescriptor,mi=Object.getOwnPropertyDescriptors,vi=Object.getOwnPropertyNames,Ur=Object.getOwnPropertySymbols,yi=Object.getPrototypeOf,qr=Object.prototype.hasOwnProperty,_i=Object.prototype.propertyIsEnumerable;var Fr=x=je=var G=var J=wi=Br=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of vi(r))!qr.call(e,o)&&o!==t&&Je(e,o,{get:()=>r[o],enumerable:!(n=hi(r,o))||n.enumerable});return e};var Ht=(e,r,t)=>(t=e!=null?fi(yi(e)):{},Br(r||!e||!e.__esModule?Je(t,"default",{value:e,enumerable:!0}):t,e)),Si=function ze(){if(!gt&&(gt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!gt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return gt(Ii)}var gt,Ii,$t=G(;var Wr,$r=G(()=>{Wr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i});function Ei(e){return typeof e=="string"&&Wr.test(e)}var ye,Ye=G(()=>{$r();ye=Ei});function Ti(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(F[e[r+0]]+F[e[r+1]]+F[e[r+2]]+F[e[r+3]]+"-"+F[e[r+4]]+F[e[r+5]]+"-"+F[e[r+6]]+F[e[r+7]]+"-"+F[e[r+8]]+F[e[r+9]]+"-"+F[e[r+10]]+F[e[r+11]]+F[e[r+12]]+F[e[r+13]]+F[e[r+14]]+F[e[r+15]]).toLowerCase();if(!ye(t))throw TypeError("Stringified UUID is invalid");return t}var F,ht,_e,Qe=G(;ar Gr,Gt,Jt,zt,Jr,zr=G(;ar mt,Yt=G(()=>{Ye();mt=Pi});r Ci,xi,Qt=G(;on Li(e,r){return e<<r|e>>>32-r}r,Zr=G(()=>{Qr=ki});var Mi,Xr,en=G(()=>{Qt();Zr();Mi=vt("v3",48,Qr),Xr=Mi});function Ni(e,r,t){e=e||{};var n=e.random||(e.rng||ze)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,r){t=t||0;for(var o=0;o<16;++o)r[t+o]=n[o];return r}return _e(n)}var Se,tn=G(; rn,nn=G(;var qi,on,sn=G(;var an,cn=G(;ar dn,un=G(;var ln={};wi(ln,{NIL:()=>an,parse:()=>mt,stringify:()=>_e,v1:()=>Jr,v3:()=>Xr,v4:()=>Se,v5:()=>on,validate:()=>ye,version:()=>dn});var Ze=G(;var In=J(bn=>{var Ae=256,Tt=[],Et;for(;Ae--;)Tt[Ae]=(Ae+256).toString(16).substring(1);function os(){var e=0,r,t="";if(!Et||Ae+16>256){for(Et=Array(e=256);e--;)Et[e]=256*Math.random()|0;e=Ae=0}for(;e<16;e++)r=Et[Ae+e],e==6?t+=Tt[r&15|64]:e==8?t+=Tt[r&63|128]:t+=Tt[r],e&1&&e>1&&e<11&&(t+="-");return Ae++,t}bn.v4=os});var At=J((fd,Tn)=>{"use strict";var is=Object.prototype.hasOwnProperty,ss=String.prototype.charAt,as=Object.prototype.toString,cs=function(e,r){return ss.call(e,r)},tr=function(r,t){return is.call(r,t)},ds=function(r){return as.call(r)==="[object String]"},us=function(r){return r!=null&&typeof r!="function"&&typeof r.length=="number"},En=ls=ps=function(r){return r==null?[]:ds(r)?En(r,cs):us(r)?En(r,tr):ls(r)};Tn.exports=ps});var or=J((gd,nr)=>{"use strict";var rr=At(),fs=(Ze(),Si(ln)).v4,An={_data:{},length:0,setItem:getItem:removeItem:clear:key:;function gs(){try{if(!window.localStorage)return!1;var e=fs();window.localStorage.setItem(e,"test_value");var r=window.localStorage.getItem(e);return window.localStorage.removeItem(e),r==="test_value"}catch(t){return!1}}function hs(){return gs()?window.localStorage:An}nr.exports.defaultEngine=hs();nr.exports.inMemoryEngine=An});var Pt=J((hd,On)=>{"use strict";var ms=At(),Pn=Object.prototype.toString,vs=ys=typeof Array.isArray=="function"?Array.isArray:_s=function(r){return r!=null&&(ys(r)||r!=="function"&&vs(r.length))},ws=Ss=bs=On.exports=bs});var Rn=J((md,jn)=>{"use strict";var Is=or().defaultEngine,Cn=or().inMemoryEngine,xn=Pt(),Es=At(),kn=JSON;e.prototype.set=function(e,r){var t=this._createValidKey(e);if(!!t)try{this.engine.setItem(t,kn.stringify(r))}catch(n){Ts(n)&&(this._swapEngine(),this.set(e,r))}};Pe.prototype.get=function(e){try{var r=this.engine.getItem(this._createValidKey(e));return r===null?null:kn.parse(r)}catch(t){return null}};Pe.prototype.getOriginalEngine=function(){return this.originalEngine};Pe.prototype.remove=Pe.prototype._createValidKey=Pe.prototype._swapEngine=jn.exports=Pe;function Ts(e){var r=!1;if(e.code)switch(e.code){case 22:r=!0;break;case 1014:e.name==="NS_ERROR_DOM_QUOTA_REACHED"&&(r=!0);break;default:break}else e.number===-2147024882&&(r=!0);return r}});var Mn=J((vd,Ln)=>{"use strict";var As=Pt(),Ps=2,Dn={setTimeout:clearTimeout:Date:window.Date},Ne=Dn,Ot={ASAP:1,RESCHEDULE:2,ABANDON:3};e.prototype.now=le.prototype.run=le.prototype.cancel=le.prototype.cancelAll=le.prototype._handle=function(e,r,t,n){var o=this,i=o.now();return function(){if(delete o.tasks[e],n>=Ot.RESCHEDULE&&i+t*Ps<o.now()){n===Ot.RESCHEDULE&&o.run(r,t,n);return}return r()}};le.setClock=le.resetClock=le.Modes=Ot;Ln.exports=le});var Un=J((yd,Nn)=>{Nn.exports=D;.names=[];D.skips=[];D.enable=function(e){try{localStorage.debug=e}catch(o){}for(var r=(e||"").split(/[\s,]+/),t=r.length,n=0;n<t;n++)e=r[n].replace("*",".*?"),e[0]==="-"?D.skips.push(new RegExp("^"+e.substr(1)+"$")):D.names.push(new RegExp("^"+e+"$"))};D.disable=D.humanize=function(e){var r=1e3,t=60*1e3,n=60*t;return e>=n?(e/n).toFixed(1)+"h":e>=t?(e/t).toFixed(1)+"m":e>=r?(e/r|0)+"s":e+"ms"};D.enabled=function Os(e){return e instanceof Error?e.stack||e.message:e}try{window.localStorage&&D.enable(localStorage.debug)}catch(e){}});var Fn=J((_d,ir)=>{typeof ir<"u"&&(ir.exports=Y);prototype.on=Y.prototype.addEventListener=Y.prototype.once=Y.prototype.off=Y.prototype.removeListener=Y.prototype.removeAllListeners=Y.prototype.removeEventListener=Y.prototype.emit=Y.prototype.listeners=Y.prototype.hasListeners=);var dr=J((wd,qn)=>{"use strict";var Xe=In().v4,ar=Rn(),cr=Pt(),Ue=Mn(),xs=Un()("localstorage-retry"),ks=Fn();unction Q(e,r,t){typeof r=="function"&&(t=r),this.name=e,this.id=Xe(),this.fn=t,this.maxItems=r.maxItems||1/0,this.maxAttempts=r.maxAttempts||1/0,this.backoff={MIN_RETRY_DELAY:r.minRetryDelay||1e3,MAX_RETRY_DELAY:r.maxRetryDelay||3e4,FACTOR:r.backoffFactor||2,JITTER:r.backoffJitter||0},this.timeouts={ACK_TIMER:1e3,RECLAIM_TIMER:3e3,RECLAIM_TIMEOUT:1e4,RECLAIM_WAIT:500},this.keys={IN_PROGRESS:"inProgress",QUEUE:"queue",RECLAIM_START:"reclaimStart",RECLAIM_END:"reclaimEnd",ACK:"ack"},this._schedule=new Ue,this._processId=0,this._store=new ar(this.name,this.id,this.keys),this._store.set(this.keys.IN_PROGRESS,{}),this._store.set(this.keys.QUEUE,[]),this._ack=sr(this._ack,this),this._checkReclaim=sr(this._checkReclaim,this),this._processHead=sr(this._processHead,this),this._running=!1}ks(Q.prototype);Q.prototype.start=Q.prototype.stop=Q.prototype.shouldRetry=Q.prototype.getDelay=function(e){var r=this.backoff.MIN_RETRY_DELAY*Math.pow(this.backoff.FACTOR,e);if(this.backoff.JITTER){var t=Math.random(),n=Math.floor(t*this.backoff.JITTER*r);Math.floor(t*10)<5?r-=n:r+=n}return Number(Math.min(r,this.backoff.MAX_RETRY_DELAY).toPrecision(1))};Q.prototype.addItem=Q.prototype.requeue=Q.prototype._enqueue=function(e){var r=this._store.get(this.keys.QUEUE)||[];r=r.slice(-(this.maxItems-1)),r.push(e),r=r.sort(function(t,n){return t.time-n.time}),this._store.set(this.keys.QUEUE,r),this._running&&this._processHead()};Q.prototype._processHead=Q.prototype._ack=Q.prototype._checkReclaim=function(){var e=this;unction t(n){for(var o=[],i=e._store.getOriginalEngine(),s=0;s<i.length;s++){var a=i.key(s),c=a.split(".");c.length===3&&c[0]===n&&c[2]==="ack"&&o.push(new ar(n,c[1],e.keys))}return o}cr(t(this.name)),this._schedule.run(this._checkReclaim,this.timeouts.RECLAIM_TIMER,Ue.Modes.RESCHEDULE)};Q.prototype._reclaim=qn.exports=Q});var Qo=J(R=>{"use strict";R.__esModule=!0;R.COPPAPrivacyModesEnum=R.BrandsEnum=R.EnvNames=R.PlayerMediaStates=R.ResponseHandlers=R.ResponseStatusCodes=void 0;var dc;((dc=R.ResponseStatusCodes||(R.ResponseStatusCodes={}));var uc;((uc=R.ResponseHandlers||(R.ResponseHandlers={}));var lc;(function(e){e.PLAYING="playing",e.PENDING="pending"})(lc=R.PlayerMediaStates||(R.PlayerMediaStates={}));var pc;((pc=R.EnvNames||(R.EnvNames={}));var fc;((fc=R.BrandsEnum||(R.BrandsEnum={}));var gc;((gc=R.COPPAPrivacyModesEnum||(R.COPPAPrivacyModesEnum={}))});var Xo=J(Zo=>{"use strict";Zo.__esModule=!0});var ti=J(ei=>{"use strict";ei.__esModule=!0});var ni=J(;var oi=J(ue=>{"use strict";var hc=ue&&ue.__createBinding||(Object.create?,Vt=ue&&ue.__exportStar||ue.__esModule=!0;Vt(Qo(),ue);Vt(Xo(),ue);Vt(ti(),ue);Vt(ni(),ue)});var Re={name:"@turnercode/cdp-psm-core",version:"3.6.0",description:"Prism core functions",private:!0,main:"dist/psm.legacy.min.umd.cjs",module:"dist/psm.legacy.min.umd.mjs",exports:{".":{import:"./dist/psm.legacy.min.umd.mjs",require:"./dist/psm.legacy.min.umd.cjs"},"./web":{import:"./dist/psm.legacy.min.umd.mjs",require:"./dist/psm.legacy.min.umd.cjs"},"./rn":{import:"./dist/psm-rn.mjs",require:"./dist/psm-rn.cjs"},"./src/*":"./src/*","./package.json":"./package.json"},repository:{type:"git",url:"https://github.com/turnercode/cdp.git",directory:"packages/psm-core"},author:"The CDP Development Team <CDP-TECH-TEAM@warnermedia.com>",license:"UNLICENSED",scripts:{build:"tsup --minify",clean:"rm -rf .turbo && rm -rf node_modules && rm -rf dist",lint:"TIMING=1 eslint src --fix",test:"jest"},devDependencies:{"@iabtcf/cmpapi":"^1.5.3","@iabtcf/core":"^1.5.3","@segment/localstorage-retry":"^1.3.0","@turnercode/cdp-cookie":"workspace:*","@turnercode/cdp-feature-flag-client":"workspace:*","@turnercode/cdp-prism-module-telemetry":"workspace:*","@turnercode/eslint-config-cdp":"workspace:*","@turnercode/scripts":"workspace:*","@turnercode/tsconfig":"workspace:*","@turnercode/types":"workspace:*",tsup:"^6.1.3",uuid:"^8.3.2"},jest:{preset:"@turnercode/scripts/jest/node",testEnvironment:"jsdom"}};var O={lightningOrigin:"https://lightning.warnermediacdn.com",iFramePath:{DEV:"/cdptest/psmtk/getcdpid.html",TEST:"/cdptest/psmtk/getcdpid.html",PROD:"/cdp/psmtk/getcdpid.html",INTEGRATION:"/cdptest/psmtk/getcdpid.html",AUTOMATED_TEST:"/cdptest/psmtk/getcdpid.html"},thirdPartyCookie:"/cdp/psmtk/start.html",carouselScript:"/cdp/psm/assets/swiper/swiper-bundle.min.js",carouselStyles:"/cdp/psm/assets/swiper/swiper-bundle.min.css",locate:"https://geo.ngtv.io/locate",featureFlag:{DEV:"https://wmff.warnermediacdn.com/psm_2_dev_full.json",TEST:"https://wmff.warnermediacdn.com/psm_2_qa_full.json",PROD:"https://wmff.warnermediacdn.com/psm_2_prod_full.json",INTEGRATION:"https://wmff.warnermediacdn.com/psm_2_brand_integration_full.json",AUTOMATED_TEST:"https://wmff.warnermediacdn.com/psm_2_automated_test_full.json"},identity:{DEV:"https://dev.receive.wmcdp.io/v1/reg",TEST:"https://test.receive.wmcdp.io/v1/reg",PROD:"https://receive.wmcdp.io/v1/reg",INTEGRATION:"https://test.receive.wmcdp.io/v1/reg",AUTOMATED_TEST:"https://test.receive.wmcdp.io/v1/reg"},inbrain:{LOCAL:"http://localhost:8080/v1/render",DEV:"https://dev.inbrain.wmcdp.io/v1/render",TEST:"https://test.inbrain.wmcdp.io/v1/render",PROD:"https://inbrain.wmcdp.io/v1/render",INTEGRATION:"https://test.inbrain.wmcdp.io/v1/render",AUTOMATED_TEST:"https://test.inbrain.wmcdp.io/v1/render"},idresolve:{DEV:"https://dev.psm.wmcdp.io/v1/resolve",TEST:"https://test.psm.wmcdp.io/v1/resolve",PROD:"https://psm.wmcdp.io/v1/resolve",INTEGRATION:"https://integration.psm.wmcdp.io/v1/resolve",AUTOMATED_TEST:"https://test.psm.wmcdp.io/v1/resolve"},logs:{DEV:"https://dev.receive.wmcdp.io/v1/reg",TEST:"https://test.receive.wmcdp.io/v1/reg",PROD:"https://receive.wmcdp.io/v1/reg",INTEGRATION:"https://test.receive.wmcdp.io/v1/reg",AUTOMATED_TEST:"https://test.receive.wmcdp.io/v1/reg"},authSvc:{DEV:"https://dev.token.wmcdp.io/v1/token",TEST:"https://test.token.wmcdp.io/v1/token",PROD:"https://token.wmcdp.io/v1/token",INTEGRATION:"https://test.token.wmcdp.io/v1/token",AUTOMATED_TEST:"https://test.token.wmcdp.io/v1/token"}},De=["","US","GU","AS","PR","VI","MH","UM","MP"];var Vr={"auth-service":!1,"doppler-identity-onstart":!0,"doppler-identity-oncomplete":!0,"doppler-session":!0,"doppler-privacy":!0,"doppler-telemetry":!0,"doppler-consent-update":!0,"doppler-heartbeat-event":!1,"doppler-pubsub-event":!1,"outside-us-location-check":!1,"doppler-send-logs":!0,"doppler-send-token-event":!1,idresolve:!1,sendAuthToken:!1,sendHHID:!1,inbrain:!1,isInAuthTokenExperiment:!1,isInHHIDExperiment:!1,sendWMSegs:!1,inBrainTemplateBeta:!1,inBrainRecommendationsBeta:!1,"test-enabled":!0,"test-disabled":!1},ft={minRetryDelay:3e4,maxRetryDelay:12e4,maxItems:5,maxAttempts:10,backoffFactor:2,backoffJitter:0};var Wt=class{constructor(){this.ready=!1;this.config={platform:"web",brand:"",psmBrandToken:"",subBrand:"",productName:"",psmEnvironment:void 0,psmPlatform:"",psmTelEnabled:!0};this.consentRule="Other";this.flags=[];this.location={asn:{id:"",name:""},continent:"",continentName:"",country:"",country_alpha2:"",country_alpha3:"",ip_address:"",lat:"",lon:"",proxy:null,states:[{cities:[],counties:[],state:"",zipcodes:[]}]};this.timezone=null;this.wmukid="Unknown";this.cdpid=null}etConfig(){return this.config}getBrand(){return this.config.brand}getBrandToken(){return this.config.psmBrandToken}etCoppaPrivacyMode(){return this.coppaPrivacyMode}getCoreWMUKID(){return this.wmukid}etSessionProperties(){return this.session}validateConfig(r){let t=[];if(this.hasProperty("psmEnvironment",r)||t.push("Please specify your psmEnvironment."),this.hasProperty("brand",r)||t.push("Please specify your brand."),t.length)throw new Error(["[PSM]: Invalid configuration provided."].concat(t).join(`
`))}etLocationProperties(){return{city:this.location.states[0].cities[0],state:this.location.states[0].state,country:this.location.country,zip:this.location.states[0].zipcodes[0],timezone:this.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,locale:"locale",language:"language"}}initCoppaPrivacyMode(){var n;let r="ALL_ID";De.includes(this.getLocationProperties().country)?(n=this.config)!=null&&n.privacyMode&&(r=this.config.privacyMode):r="ZERO_ID",this.coppaPrivacyMode=r}},Hr=Wt;Ze();var Vi=Object.create,gn=Object.defineProperty,Ki=Object.getOwnPropertyDescriptor,hn=Object.getOwnPropertyNames,Hi=Object.getPrototypeOf,Wi=Object.prototype.hasOwnProperty,Le=(e,r)=>function(){return r||(0,e[hn(e)[0]])((r={exports:{}}).exports,r),r.exports},$i=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of hn(r))!Wi.call(e,o)&&o!==t&&gn(e,o,{get:()=>r[o],enumerable:!(n=Ki(r,o))||n.enumerable});return e},Gi=(e,r,t)=>(t=e!=null?Vi(Hi(e)):{},$i(r||!e||!e.__esModule?gn(t,"default",{value:e,enumerable:!0}):t,e)),Ji=Le({"../../node_modules/.pnpm/component-url@0.2.1/node_modules/component-url/index.js"(e){e.parse=function(t){var n=document.createElement("a");return n.href=t,{href:n.href,host:n.host||location.host,port:n.port==="0"||n.port===""?r(n.protocol):n.port,hash:n.hash,hostname:n.hostname||location.hostname,pathname:n.pathname.charAt(0)!="/"?"/"+n.pathname:n.pathname,protocol:!n.protocol||n.protocol==":"?location.protocol:n.protocol,search:n.search,query:n.search.slice(1)}},e.isAbsolute=e.isRelative=e.isCrossDomain=}),zi=Le({"../../node_modules/.pnpm/ms@2.0.0/node_modules/ms/index.js"),Yi=Le({"../../node_modules/.pnpm/debug@2.6.9/node_modules/debug/src/debug.js"(e,r){e=r.exports=o.debug=o.default=o,e.coerce=c,e.disable=s,e.enable=i,e.enabled=a,e.humanize=zi(),e.names=[],e.skips=[],e.formatters={};var t;=Le({"../../node_modules/.pnpm/debug@2.6.9/node_modules/debug/src/browser.js"(e,r){e=r.exports=Yi(),e.log=o,e.formatArgs=n,e.save=i,e.load=s,e.useColors=t,e.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:a(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function t(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=ction s(){var c;try{c=e.storage.debug}catch(u){}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}e.enable(s());}),Zi=Le({"../../node_modules/.pnpm/component-cookie@1.1.5/node_modules/component-cookie/index.js"(e,r){var t=Qi()("cookie");r.exports=function n(u,l,d){d=d||{};var p=a(u)+"="+a(l);l==null&&(d.maxage=-1),d.maxage&&(d.expires=new Date(+new Date+d.maxage)),d.path&&(p+="; path="+d.path),d.domain&&(p+="; domain="+d.domain),d.expires&&(p+="; expires="+d.expires.toUTCString()),d.secure&&(p+="; secure"),document.cookie=p}function o(){var u;try{u=document.cookie}catch(l){return typeof console<"u"&&typeof console.error=="function"&&console.error(l.stack||l),{}}return s(u)}unction s(u){var l={},d=u.split(/ *; */),p;if(d[0]=="")return l;for(var f=0;f<d.length;++f)p=d[f].split("="),l[c(p[0])]=c(p[1]);return l}function a(u){try{return encodeURIComponent(u)}catch(l){t("error `encode(%o)` - %o",u,l)}}}),Xi=Le({"../../node_modules/.pnpm/@segment+top-domain@3.0.1/node_modules/@segment/top-domain/lib/index.js"(e,r){"use strict";var t=Ji().parse,n=Zi();.levels=function(i){var s=t(i).hostname,a=s.split("."),c=a[a.length-1],u=[];if(a.length===4&&c===parseInt(c,10)||a.length<=1)return u;for(var l=a.length-2;l>=0;--l)u.push(a.slice(l).join("."));return u},o.cookie=n,e=r.exports=o}}),mn=Gi(Xi()),Te=(...e)=>{window.location.search.search(/[?&]wmpsm_debug=[1t]/)!==-1&&console.info(...e)};function _t(e,r,t){switch(arguments.length){case 3:case 2:return es(e,r,t);case 1:return ts(e);default:return vn()}}function es(e,r,t){t=t||{};let n=pn(e)+"="+pn(r);t.encode===!1&&(n=e+"="+r),r==null&&(t.maxage=-1),t.maxage&&!t.expires&&(t.expires=new Date(+new Date+t.maxage)),t.path&&(n+="; Path="+t.path),t.domain&&(n+="; Domain="+t.domain),t.expires&&(n+="; Expires="+t.expires.toUTCString()),t.samesite&&(n+="; SameSite="+t.samesite),t.secure&&(n+="; Secure"),Te("[COOKIE]: cookie.helper.set()",n,t),document.cookie=n}function vn(){let e;try{e=document.cookie}catch(r){return typeof console<"u"&&typeof console.error=="function"&&console.error(r.stack||r),{}}return rs(e)}function ts(e){let r=vn()[e];return Te(`[COOKIE]: helper.get() - getting ${e} cookie value ${r}`),r}function rs(e){let r={},t=e.split(/ *; */),n;if(t[0]=="")return r;for(let o=0;o<t.length;++o){let i=t[o].substr(0,t[o].indexOf("=")),s=t[o].substr(t[o].indexOf("=")+1);r[fn(i)]=fn(s)}return r}function pn(e){try{return encodeURIComponent(e)}catch(r){}}ar ns=class{constructor(e){this._options={},this.options=this.options.bind(this),this.set=this.set.bind(this),this.get=this.get.bind(this),this.getAll=this.getAll.bind(this),this.remove=this.remove.bind(this),this.options(e)}options(e){if(arguments.length===0)return this._options;e=e||{};let r=e.domain||`.${(0,mn.default)(window.location.href)}`;if(r==="."&&(r=null),this._options=je(x({maxage:31536e6,path:"/",samesite:"Lax",encode:!0},e),{domain:r}),this.set("psm:test",!0,this._options),!this.get("psm:test")){Te("[Cookie]: psm:test cookie could not be set at domain: ",this._options.domain);let t=new RegExp(document.location.hostname,"g");document.referrer!==""&&document.referrer.search(t)===-1?this._options.samesite="None":this._options.domain=null}this.remove("psm:test"),Te("[COOKIE]: this._options",this._options)}set(e,r,t={}){let n=x(x({},this._options),t);Te("[COOKIE]: this.set() options",n);try{return typeof r!="string"&&(r=JSON.stringify(r)),_t(e,r==="null"?null:r,n),!0}catch(o){return Te("[COOKIE]: this.set() encountered an error",o),!1}}get(e){let r=_t(e);try{return JSON.parse(r)}catch(t){return r||null}}getAll(){return _t()}remove(e){try{return _t(e,null,x({},this._options)),!0}catch(r){return Te("[COOKIE]: this.remove() encountered an error",r),!1}}},y=new ns,wt=mn.default;function ie(){try{let e=document.cookie;e="cookietest=1; SameSite=Strict;";let r=e.indexOf("cookietest=")!==1;return e="cookietest=1; SameSite=Strict; expires=Thu, 01-Jan-1970 00:00:01 GMT",r}catch(e){return!1}}unction St(){let e="__psm_test__";if(!Xt())return!1;try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(r){return!1}}function yn(){let e=window,r="inner";"innerWidth"in window||(r="client",e=document.documentElement||document.body);let t=e[r+"Width"],n=e[r+"Height"];return t>=0&&n>=0?t+"x"+n:null}function bt(){let e=document.documentElement,r=document.body,t=r?Math.max(r.offsetHeight,r.scrollHeight):0,n=Math.max(e.clientWidth,e.offsetWidth,e.scrollWidth),o=Math.max(e.clientHeight,e.offsetHeight,e.scrollHeight,t);return isNaN(n)||isNaN(o)?[0,0]:[n,o]}unction It(e){let r="";if(e)return e;try{r=window.top.document.referrer}catch(t){if(window.parent)try{r=window.parent.document.referrer}catch(n){r=""}}return r===""&&(r=document.referrer),r}function er(e,r){let t,n;return function o(...i){let s=Date.now();t=window.clearTimeout(t),!n||s-n>=r?(e(...i),n=s):t=window.setTimeout(o.bind(null,...i),r-(s-n))}}function wn(e){let r=e.getBoundingClientRect();return e.contains(document.elementFromPoint(r.right-r.width/2,r.bottom-r.height/2))}function Sn(){let e=window.navigator.userAgent,r=e.indexOf("Safari")>-1&&e.indexOf("Chrome")===-1&&e.indexOf("Chromium")===-1&&e.indexOf("CriOS")===-1&&e.indexOf("EdgiOS")===-1&&e.indexOf("FxiOS")===-1,t=(e.indexOf("Firefox")>-1||e.indexOf("FxiOS")>-1)&&e.indexOf("Seamonkey")===-1,n=(e.indexOf("Chrome")>-1||e.indexOf("CriOS")>-1)&&e.indexOf("Chromium")===-1&&e.indexOf("Edg")===-1&&e.indexOf("OPR")===-1,o=e.indexOf("Edg")>-1;switch(!0){case r:return"safari";case t:return"firefox";case n:return"chrome";case o:return"edge";default:return"unknown"}}ar Bn=Ht(dr());var Ct=class extends Error{constructor(t){let{request:n,url:o,opts:i}=t,s=n.responseText?n.responseText:"network failure";super(s);this.context={url:o,code:n.status,headers:i.headers,method:i.method}}};function Z(e,r={}){return new Promise((t,n)=>{let o=new XMLHttpRequest;o.open(r.method||"get",e),o.onload=()=>{if((o.status/100|0)==2)try{t(JSON.parse(o.responseText))}catch(i){t(o.responseText)}else n(new Ct({request:o,url:e,opts:r}))},o.onerror=()=>{n(new Ct({request:o,url:e,opts:r}))};for(let i in r.headers)o.setRequestHeader(i,r.headers[i]);o.send(r.body||null)})}var ur,qe,Fe;function Vn(e){qe=e.config.psmEnvironment?e.config.psmEnvironment.toUpperCase():"PROD",Fe=e,ur=new Bn.default("logger",ft,(r,t)=>{if(/bot|crawl|spider/i.test(window.navigator.userAgent))return t(null,{});r.ts=new Date().toISOString(),Z(O.logs[qe],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(n=>t(null,n)).catch(}),ur.start()}function xt(e,r){let t,n,o;e.err?(t=e.err.toString(),n=e.err.stack,o=e.err.context||{}):(t=e.message,o=e.context);let i={brand:Fe.config.brand,device:{type:window.navigator.platform,userAgent:window.navigator.userAgent},eventName:r,eventProperties:{logMessage:t,method:e.methodName,featureFlagValues:Fe.getFlags(),stackTrace:n},eventType:"log",eventTimestamp:new Date().toISOString(),library:{name:"PrismJS",version:Re.version,initConfig:Fe.config},platform:"web",session:Fe.session,wmukid:Fe.wmukid},s=Xt()&&window.localStorage.getItem("wmpsm_debug")=="true",a=window.location.search.includes("wmpsm_debug");return r!=="debug"&&(s||a||qe==="AUTOMATED_TEST"?qe==="AUTOMATED_TEST"?console[r](`[PSM]: ${r}:`,JSON.stringify(i.eventProperties)):console[r](`[PSM]: ${r}:`,i):i.eventProperties.featureFlagValues["doppler-send-logs"]&&ur.addItem(i)),i}function Oe(e){return xt(e,"info")}function C(e){return xt(e,"debug")}function Kn(e){return xt(e,"warn")}ar js=/^[1][nNyY-][nNyY-][nNyY-]$/,kt=class{etUSPrivacyString(){return this.baseString}etUSPrivacyString(r){let t=!1;if(js.test(r)){this.baseString=r,this.version=Number(r[0]);let n={version:Number(r[0]),uspString:r};y.set("usprivacy",r),y.set("uspData",n),t=!0}return t}};var jd=new kt;function Hn(e){let r=null,t;for(t=window;t;t=t.parent){try{if(t.frames&&t.frames[e]){r=t;break}}catch(n){throw new Error(n)}if(t===window.top)break}return r}function Wn(e={}){return new Promise(r=>{typeof window.__tcfapi!="function"&&r({shouldLoad:!1,categories:[]});let t=x({1:"data-store",3:"ads-person-prof",5:"content-person-prof",6:"consent-person",8:"measure-content",9:"measure-market",10:"product-develop"},e);window.__tcfapi("getTCData",2,(n,o)=>{if(o&&"purpose"in n&&"legitimateInterests"in n.purpose){let i=x(x({},n.purpose.legitimateInterests),n.purpose.consents),s=[],a=!0;Object.entries(t).forEach(([c,u])=>{i[c]?s.push({[u]:i[c]}):(s.push({[u]:!1}),a=!1)}),r({shouldLoad:a,categories:s.concat([{"special-purpose-1":!0},{"special-purpose-2":!0},{"feature-1":!0},{"feature-2":!0},{"feature-3":!0}])})}r({shouldLoad:!1,categories:[]})})})}var te="",j="",W="";function Rs(e){switch(e){case"Samsung TV":return!1;case"Vizio TV":return!1;case"LG TV":return!1;default:return!0}}unction Ds(){let e=Me("utm_term",window.location.href),r=new RegExp(/cdpid_([0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12})/i).exec(e),t=null;return r&&(t=r[1]),t}function $n(e,r){Jn(e)?(W=Ds()||e,y.set("CDPID",JSON.stringify({cdpId:W,wmukId:r}),{samesite:"None",secure:!0,encode:!1})):C({message:`CDPID value ${JSON.stringify(W)} is invalid. Returning without updating`,methodName:"updateCdpData",eventType:"cdpid"})}function Ls(e,r){let t=document.createElement("iframe");t.setAttribute("id",e),t.setAttribute("style","display:none"),t.setAttribute("src",r),document.body.appendChild(t)}var Gn=e=>e.split(";").map(r=>r.split("=")).reduce((r,t)=>(r[decodeURIComponent(t[0].trim())]=decodeURIComponent(t[1].trim()),r),{});function zn(e,r){return ie()?(te=r?Gn(document.cookie).WMUKID:y.get("WMUKID"),j=r?Gn(document.cookie).WMUKID_STABLE:y.get("WMUKID_STABLE"),C({message:`[PSM]: Cookies enabled. Retrieving ID values
    WMUKID: ${JSON.stringify(te)}
    WMUKID_STABLE: ${j}
    `,methodName:"initIdentity",eventType:"identity"}),j==null&&(te==null?(j=Se(),C({message:`WMUKID and WMUKID_STABLE cookies not found. Generating WMUKID_STABLE value: ${j}`,methodName:"initIdentity",eventType:"identity"})):typeof te=="object"&&"id"in te?(j=te.id,C({message:`Legacy WMUKID value ${te.id} found. Setting WMUKID_STABLE value: ${j}`,methodName:"initIdentity",eventType:"identity"})):(j=te,C({message:`WMUKID string value ${te} found. Setting WMUKID_STABLE value: ${j}`,methodName:"initIdentity",eventType:"identity"}))),C({message:`Setting WMUKID_STABLE cookie to ${j}. Cookie options: ${JSON.stringify(y.options())}`,methodName:"initIdentity",eventType:"identity"}),e==="ZERO_ID"?r?(document.cookie=`WMUKID_STABLE=${j}; max-age=0; SameSite=None; Secure`,document.cookie=`dateid=${te}; max-age=0; SameSite=None; Secure`):(y.set("WMUKID_STABLE",j,y.options({maxage:0})),y.set("datid",j,y.options({maxage:0}))):r?(document.cookie=`WMUKID_STABLE=${j}; SameSite=None; Secure`,document.cookie=`dateid=${te}; SameSite=None; Secure`):(y.set("WMUKID_STABLE",j),y.set("datid",j)),j):""}function Yn(e,r){return new Promise(t=>{if(window==null||window.addEventListener("message",n=>{n.origin===O.lightningOrigin&&(C({message:`Updating CDPID from iFrame value: ${JSON.stringify(n.data)}`,methodName:"initIdentity",eventType:"message"}),$n(n.data,j),t(n.data))},!1),ie()){W=y.get("CDPID");let n=W&&typeof W=="object"&&"cdpId"in W&&Jn(W.cdpId);if(C({message:`[PSM]: Cookies enabled. Retrieving ID values
    CDPID: ${JSON.stringify(W)}
    `,methodName:"initIdentity",eventType:"identity"}),W===null||!n)Hn("prism_toolkit")===null&&(Rs(r)?Ls("prism_toolkit",O.lightningOrigin+O.iFramePath[e]):t(""));else if(typeof W=="object"&&"cdpId"in W&&"wmukId"in W&&n){let o=W.cdpId,i=W.wmukId;j!==i?(C({message:`Updating CDPID value ${o} with WMUKID: ${j}`,methodName:"initIdentity",eventType:"cdpid"}),$n(o,j)):C({message:`CDPID cookie has already been set to value ${JSON.stringify(W)}. To start a new test, delete the CDPID cookie on this domain and lightning.warnermediacdn.com.`,methodName:"initIdentity",eventType:"cdpid"}),t(o)}}})}window.googletag=window.googletag||{cmd:[]};var et,pr=X=[],Qn=(...e)=>{window==null||window.location.search.search(/[?&]wmpsm_debug=[1t]/)};function Zn(e,r){let t=pr(),n=0;r.lastHoverStarted!==0&&(n=t-r.lastHoverStarted),e==="mouseleave"?r.totalHoverTime+=n:r.lastHoverStarted=t}function Xn(e,r){e.addEventListener("mouseenter",()=>{Zn("mouseenter",r)}),e.addEventListener("mouseleave",}var Ms=(e,r)=>{window.googletag=(window==null?void 0:window.googletag)||{cmd:[]},window==null||window.googletag.cmd.push(()=>{window.googletag.pubads().addEventListener("slotRenderEnded",t=>{let n=t.slot.getSlotElementId(),o=t.slot.getAdUnitPath(),i=document==null?void 0:document.getElementById(n),s="0x0";t.size&&(typeof t.size=="string"?s=t.size:s=t.size.join("x"));let a={slotId:n,slotSize:s,adUnitPath:o,totalViewTime:0,lastViewStarted:0,visibleOnStart:!1,adWasViewed:!1,rfv:t.slot.getTargeting("rfv")[0],creativeId:t.slot.getTargeting("creativeId")[0],lineItemId:t.slot.getTargeting("lineItemId")[0],totalHoverTime:0,lastHoverStarted:0};lr(a),i&&(e.observe(i),Xn(i,a))}),window.googletag.pubads().addEventListener("slotVisibilityChanged",t=>{let n=t.slot.getSlotElementId();r.forEach(o=>{o.slotId===n&&(o.rfv=t.slot.getTargeting("rfv")[0],o.creativeId=t.slot.getTargeting("creativeId")[0],o.lineItemId=t.slot.getTargeting("lineItemId")[0])})}),window.googletag.pubads().getSlots().forEach(t=>{let n=t.getSlotElementId(),o=document==null?void 0:document.getElementById(n),i={width:0,height:0};o&&(i=o.getBoundingClientRect());let s={slotId:n,slotSize:i?`${Math.round(i.width)}x${Math.round(i.height)}`:"0x0",adUnitPath:t.getAdUnitPath(),totalViewTime:0,lastViewStarted:0,visibleOnStart:!1,adWasViewed:!1,rfv:t.getTargeting("rfv")[0],creativeId:t.getTargeting("creativeId")[0],lineItemId:t.getTargeting("lineItemId")[0],totalHoverTime:0,lastHoverStarted:0};lr(s),o&&(e.observe(o),Xn(o,s))})})};function eo(){et=new IntersectionObserver(e=>{e.forEach(r=>{let t=r.target.id,n=Math.round(r.intersectionRatio)*100,o=r.boundingClientRect;r.isIntersecting?r.intersectionRatio>=.5&&wn(r.target)&&(Qn(`slotVisibilityChanged - ${t} is in view. (${n}% in view)`),X.forEach(i=>{i.slotId===t&&(i.visibleOnStart=!0,i.adWasViewed=!0,i.slotSize=`${o.width}x${o.height}`,oo(i))})):(Qn(`slotVisibilityChanged - ${t} is no longer in view. (${n}% in view)`),X.forEach(i=>{i.slotId===t&&(i.visibleOnStart=!1,i.lastViewStarted=0,i.lastHoverStarted=0)}))})},{root:null,rootMargin:"0px",threshold:[0,.5,1]}),Ms(et,X)}document==null||document.addEventListener("inbrain.loaded",e=>{e.detail.forEach(r=>{let t=document==null?void 0:document.getElementById(r);if(t){let n=t.getBoundingClientRect();lr({slotId:r,slotSize:n?`${Math.round(n.width)}x${Math.round(n.height)}`:"0x0",totalViewTime:0,lastViewStarted:0,visibleOnStart:!1,adWasViewed:!1,totalHoverTime:0,lastHoverStarted:0}),et.observe(t)}})});var lr=function to(){X.forEach(e=>{e.visibleOnStart&&(e.lastViewStarted=0);let r=document==null?void 0:document.getElementById(e.slotId);r&&et.unobserve(r)})}function ro(){X.forEach(e=>{e.visibleOnStart&&(e.lastViewStarted=pr());let r=document==null?void 0:document.getElementById(e.slotId);r&&et.observe(r)})}function no(){X.forEach(}function jt(){X.forEach(e=>{e.totalViewTime=0,e.totalHoverTime=0,e.adWasViewed=!1})}function oo(e){let r=e.lastViewStarted,t=pr();if(r){let n=t-r;e.totalViewTime+=n}e.lastViewStarted=t}var so=new Date().toISOString(),Rt,se={totalTime:0,engagedTime:0,interval:3e4/1e3,maxScrollDepth:window.scrollY<0?0:window.scrollY,currentScrollPosition:window.scrollY<0?0:window.scrollY,didScrollUpDuringInterval:!1},Ns=Us=["mousedown","mousemove","keydown"],Fs=["scroll","focus"];function io(){let e=window.scrollY,r=e<0?0:e,t=bt()[1];r>se.currentScrollPosition&&(se.maxScrollDepth=r>=t?t:r),r<se.currentScrollPosition&&(se.didScrollUpDuringInterval=!0),se.currentScrollPosition=r;let n=new Date;if(Rt){let o=Math.round((n.getTime()-Rt)/1e3);o<=3&&(se.engagedTime+=o)}Ns(n.getTime())}var ao=()=>{Us.forEach(e=>{window.addEventListener(e,er(io,1e3))}),Fs.forEach(},rt=()=>{let e=new Date,r=new Date(so);se.totalTime=Math.round((e.getTime()-r.getTime())/1e3)},Dt=()=>{se={totalTime:0,engagedTime:0,interval:3e4/1e3,maxScrollDepth:window.scrollY<0?0:window.scrollY,currentScrollPosition:window.scrollY<0?0:window.scrollY,didScrollUpDuringInterval:!1},so=new Date().toISOString(),Rt=Date.now()};var Be="inbrain-surveys",ae=window,$=document,co=[],uo=[],qs={watchSlidesProgress:!0,slidesPerView:"auto",spaceBetween:20,navigation:{nextEl:".inbrain-control-next",prevEl:".inbrain-control-prev"}},re,fo,gr=!1;async function go(e,r){let t=e.config.psmEnvironment.toUpperCase();if(re=r,!e.queryFlag("inbrain")&&!ae.optimizelyInControlOfInBrain||ae.optimizelyInControlOfInBrain&&!ae.optimizelyInBrainEnabled||e.wmukid=="Unknown")return;gr=ae.location.search.search(/[?&]surveyOverride=[1t]/)!==-1?!0:!!e.queryFlag("inBrainSurvey"),Ks("INBRAIN v2.0.5");let i=ae.location.search.search(/[?&]localhost=[1t]/)!==-1?O.inbrain.LOCAL:O.inbrain[t],s=null;try{s=await Z(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(mo(e,"true"))})}catch(d){be({err:d,eventType:"inbrain",methodName:"initInbrain"});return}if(!s){console.log("no render response");return}let{domain:a,pages:c,target:u,survey:l}=s;!Hs({domain:a,pages:c})||(Bs({psm:e,env:t,target:u,inbrainURL:i,response:s}),Vs({survey:l,psm:e,env:t}))}function Bs({psm:e,env:r,target:t,inbrainURL:n,response:o}){new IntersectionObserver((i,s)=>{i.forEach(a=>{a.isIntersecting&&(console.log("found ya crossing over did I?"),ho(t).then(async()=>{try{o=await Z(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(mo(e,"false"))})}catch(f){be({err:f,eventType:"inbrain",methodName:"initInbrain"});return}let{target:c,placement:u,html:l,carousel:d}=o,p;try{p=decodeURIComponent(l)}catch(f){be({err:f,eventType:"inbrain",methodName:"initInbrainV2"});return}switch(u){case"within":$.querySelector(c).innerHTML=p;break;case"before":$.querySelector(c).insertAdjacentHTML("beforebegin",p);break;case"after":$.querySelector(c).insertAdjacentHTML("afterend",p);break}Ws(d).then(()=>{fr({psm:e,env:r}),ae.inbrainCarousel.on("slideChange",,window.document.addEventListener("resize",,new IntersectionObserver((f,g)=>{f.forEach(h=>{(h.isIntersecting||h.intersectionRatio>=.9)&&(lo({psm:e,env:r}),g.disconnect())})},{root:null,rootMargin:"0px",threshold:[.5,1]}).observe($.querySelector(".inbrain-container"))}),$s().forEach(f=>{let g=f.dataset.inbrain,h=f.dataset.slotindex,v=f.href;f.addEventListener("click",()=>{ot({psm:e,id:g,promoPosition:h,destinationURL:v}),M(e,re),re.trackInbrain("Inbrain Click",new Date().toISOString(),w=>{nt({env:r,data:w}),r==="AUTOMATED_TEST"&&ae.localStorage.setItem("Inbrain-Click",JSON.stringify(w))})})})}),s.disconnect())})},{root:null,rootMargin:"250px"}).observe($.querySelector(t))}function Vs({survey:e,psm:r,env:t}){let n=e&&e.surveys&&e.surveys[0],o=JSON.parse(localStorage.getItem(Be))||{};if((!o||!o.hasOwnProperty(n))&&(o[n]={timesViewed:"0",answered:"false",choice:"",doNotShowAgain:"false"}),localStorage.getItem("inbrain-do-not-show-surveys")=="true"&&(gr=!1),gr&&e&&e.html!==""&&o[n].answered=="false"){let i=e.question,s=e.target;ho(s).then(()=>{let a;try{a=decodeURIComponent(e.html)}catch(h){be({err:h,eventType:"inbrain",methodName:"initInbrainV2"});return}switch(e.placement){case"within":$.querySelector(s).innerHTML=a;break;case"before":$.querySelector(s).insertAdjacentHTML("beforebegin",a);break;case"after":$.querySelector(s).insertAdjacentHTML("afterend",a);break}o[n].timesViewed=(parseInt(o[n].timesViewed)+1).toString(),localStorage.setItem(Be,JSON.stringify(o)),Js({psm:r,env:t,surveyID:n,surveyQuestion:i});let c=hr(),u=document.querySelector(".inbrain-survey-container span");.addEventListener("click",l);let d=document.getElementById("survey-submit-btn");d||document.querySelectorAll(".survey-choice-wrapper").forEach(h=>{h.addEventListener("click",()=>{let v=[],w=h.firstElementChild;v.push(w.value),po({psm:r,env:t},i,v,n),l(),o[n].answered="true",o[n].choice=v.toString(),localStorage.setItem(Be,JSON.stringify(o))})});function p(){let h=[],v=document.querySelector(".survey-question").innerHTML,b=document.querySelector(".inbrain-survey-body input").getAttribute("name"),S=document.getElementsByName(b),I=Array.from(S);for(let E=0;E<I.length;E++){let P=I[E];P.type=="checkbox"||P.type=="radio"?P.checked&&h.push(P.value):h.push(P.value)}po({psm:r,env:t},v,h,n),l(),o[n].answered="true",o[n].choice=h.toString(),localStorage.setItem(Be,JSON.stringify(o))}document.getElementById("do-not-show-survey-again").addEventListener("click",()=>{o[n].doNotShowAgain="true",localStorage.setItem(Be,JSON.stringify(o)),l()}),d.addEventListener("click",p),document.getElementById("survey-do-not-show-btn").addEventListener("click",})}}var Ks=(...e)=>{window.location.search.search(/[?&]wmpsm_debug=[1t]/)};function nt(e){let{env:r,data:t}=e;try{Z(O.identity[r],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(n){C({err:n,eventType:"inbrain",methodName:"sendEvent"})}}function Hs({domain:e,pages:r}){if(window.location.hostname!=e)return!1;let t=[];try{r.forEach(n=>{let o=n.split("/"),i=window.location.pathname.split("/"),s=!0;i.forEach((a,c)=>{o[c]!="*"&&o[c]!=a&&(s=!1)}),t.push(s)})}catch(n){return be({err:n,eventType:"inbrain",methodName:"shouldRender"}),!1}return t.indexOf(!0)!=-1}function ho(e){return new Promise(r=>{let t=$.querySelector(e);t&&r(t),new MutationObserver((n,o)=>{t=$.querySelector(e),t&&(r(t),o.disconnect())}).observe($.documentElement,{childList:!0,subtree:!0})})}function Ws(e){return e=e||qs,e.watchSlidesProgress=!0,e.slidesPerView="auto",new Promise(r=>{let t=$.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=O.lightningOrigin+O.carouselStyles,$.head.appendChild(t);let n=$.createElement("script");n.type="text/javascript",n.src=O.lightningOrigin+O.carouselScript,n.addEventListener("load",()=>{ae.inbrainCarousel=new Swiper(".inbrain-carousel",e),r(!0)}),$.head.appendChild(n)})}function mo(e,r="false"){let t=y.get("wmhhid"),n=y.get("usprivacy"),o=e.getLocationProperties(),i=e.getDeviceProperties(),s=e.getIds(),a=e.getBrand(),c=e.getFlags(),u=JSON.parse(localStorage.getItem(Be))||{};return{wmukid:e.wmukid,cdpid:e.getCDPID(),url:window.location.href,usp:n,betaTemplate:e.queryFlag("inBrainTemplateBeta")?"true":"false",betaRecommendations:e.queryFlag("inBrainRecommendationsBeta")?"true":"false",deviceType:i.type,location:o.state,language:o.language,ecid:s.ecid,kruxid:s.kruxid,brand:a,wmhhid:t,surveyStorage:u,flags:c,initialRequest:r}}function ot(e){let{psm:r,id:t,promoPosition:n,destinationURL:o,surveyQuestion:i,surveyResponse:s,surveyChoices:a,surveyID:c}=e;fo={id:t,promoPosition:n,destinationURL:o,surveyQuestion:i,surveyResponse:s,surveyChoices:a,surveyID:c,featureFlagValues:r.getFlags()}}unction yo(e=!1){let r=document.querySelectorAll(".swiper-slide-visible > div > a");if(r.length||(r=document.querySelectorAll(".inbrain-promo-inner > a")),e){let t=[];return r.forEach(,t}return r}function $s(){return document.querySelectorAll("[data-inbrain]")}function fr({psm:e,env:r}){yo().forEach(t=>{let n=t.dataset.inbrain;co.includes(n)||(ot({psm:e,id:n}),M(e,re),re.trackInbrain("Inbrain Promo Loaded",new Date().toISOString(),o=>{nt({env:r,data:o}),r==="AUTOMATED_TEST"&&ae.localStorage.setItem("Inbrain-Promo-Loaded",JSON.stringify(o))}),co.push(n))})}function lo({psm:e,env:r}){yo().forEach(t=>{let n=t.dataset.inbrain;uo.includes(n)||(ot({psm:e,id:n}),M(e,re),re.trackInbrain("Inbrain Promo Visible",new Date().toISOString(),o=>{nt({env:r,data:o}),r==="AUTOMATED_TEST"&&ae.localStorage.setItem("Inbrain-Promo-Visible",JSON.stringify(o))}),uo.push(n))})}unction Gs(){let e=document.querySelectorAll(".survey-answer"),r=[];return e.forEach(,r}function Js({psm:e,env:r,surveyID:t,surveyQuestion:n}){let i=hr().dataset.survey;ot({psm:e,id:i,surveyID:t,surveyQuestion:n}),M(e,re),re.trackInbrain("Inbrain Survey Visible",new Date().toISOString(),s=>{nt({env:r,data:s})})}function po({psm:e,env:r},t,n,o){let i=hr(),s=Gs(),a=i.dataset.survey;ot({psm:e,id:a,surveyQuestion:t,surveyResponse:n,surveyChoices:s,surveyID:o}),M(e,re),re.trackInbrain("Inbrain Survey Response",new Date().toISOString(),}function mr(){return typeof window.turner_getTransactionId=="function"?window.turner_getTransactionId():null}function vr(){return ie()?y.get("ug"):null}function yr(){var e,r;return ie()?((r=(e=window==null?void 0:window.mParticle)==null?void 0:e.Identity)==null?void 0:r.getCurrentUser().getMPID())||"":null}function Ve(){return St()?window.localStorage.getItem("kxkuid"):ie()?y.get("kxkuid"):null}function Ke(){if(ie()){let e=y.get("firstpartyuid");return e&&typeof e=="object"&&"id"in e?e.id:null}return null}function _r(){let e=null;return ie()&&(e=y.get("OptanonConsent")),e}function zs(e){let r=y.get("AMCV_7FF852E2556756057F000101@AdobeOrg");if(r){let t=r.split("|"),n=t.indexOf(e);if(n!=-1){let o=n+1;return t[o]}}return null}function He(){let e=y.get("s_ecid"),r=y.get("s_vi");return e||r||zs("MCMID")}function Ce(){let e=null,r=null;if(St()&&(r=window.localStorage.getItem("zion.cnn_uid"),r))try{r=JSON.parse(r),e=r.id}catch(t){window.location.search.includes("wmpsm_debug")}return e}function We(){if(St()){let e=["Conviva/sdkConfig","Conviva.sdkConfig","top-player::Conviva.sdkConfig"],r=null;for(let t=0;t<e.length;t++)if(r=window.localStorage.getItem(e[t]),r)try{return JSON.parse(r).clId}catch(n){window.location.search.includes("wmpsm_debug")}}return null}function $e(){let e=null;if(window.ZionMessageBus){let t=window.ZionMessageBus.getInstance().watching.id_found.messageQueue;if(t&&t instanceof Array){let n=t.find(o=>{var s;let i=(s=o.message)==null?void 0:s.type;if(typeof i=="string")return i.toLowerCase()==="zaid"});e=n?n.message.value:null}}return e}function _o(e,r){let t=null;if(e)for(let n of e){if(typeof n!="string")continue;r&&(n=n.replace(/^data/,r));let o=n.match(/[^.[\]()]+/g);for(let i=0;i<o.length;i++)if(i===0&&(t=window),t=t[o[i]],typeof t=="function"&&(t=t()),typeof t>"u"){t=null;break}if(t)return t}return t}function wo(e,r){let t={};return e&&e[r]&&e[r].forEach(n=>{let o=_o(n.staticLocations);o||(o=_o(n.dynamicLocations,"psmPubSubData."+r)),t[n.name]=o}),t}var M=(e,r)=>{let t=bt(),n=e.coppaPrivacyMode==="ALL_ID"?{attuuid:Ke(),cdpid:e.getCDPID(),cnnuid:Ce(),convivaid:We(),ecid:He(),kruxid:Ve(),liverampatsid:y.get("tok_lr"),mpid:yr(),tradedeskuid:y.get("tok_ttuid"),wmhhid:y.get("wmhhid"),wminid:y.get("wminid"),zionid:$e(),hhidVersion:y.get("hhidVersion")}:{};r.setPlatform(e.config.platform),r.addEntry("companyName","WarnerMedia"),r.setBrand(e.config.brand),r.setSubBrand(e.config.subBrand),r.setProductName(e.config.productName),r.setLibrary({name:"PrismJS",version:Re.version,initConfig:e.config}),r.setDevice({type:window.navigator.platform,userAgent:window.navigator.userAgent,totalWidth:t[0],totalHeight:t[1],screenResolution:_n(),viewportSize:yn()}),r.setNavigationProperties({url:window.location.href,rootDomain:wt(window.location.href),referrer:It(),path:window.location.pathname,search:window.location.search,title:window.document.title}),r.setClientResolvedIp(e.location.ip_address),r.setLocation({city:e.location.states[0].cities[0],state:e.location.states[0].state,country:e.location.country,zip:e.location.states[0].zipcodes[0],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone||null,locale:window.navigator.language,language:window.navigator.language.split("-")[0]||null}),r.setConsentProperties({uspString:y.get("usprivacy"),consentRule:e.consentRule,optanonConsent:_r(),psmPrivacyMode:e.coppaPrivacyMode}),r.setIABCategories({consentCategories:e.consentCategories}),r.setWMUKID(e.wmukid),r.setEventProperties({cookiesEnabled:ie(),doNotTrack:!!(window.navigator.doNotTrack||window.doNotTrack),featureFlagValues:e.getFlags(),cookies:y.getAll(),optimizelyFlagValues:{optimizelyInBrainEnabled:window.optimizelyInBrainEnabled||!1,optimizelyInControlOfInBrain:window.optimizelyInControlOfInBrain||!1},automatedTest:e.config.psmEnvironment==="AUTOMATED_TEST",heartbeat:se,inbrain:vo()}),r.setSessionProperties(e.session),r.setAdsProperties({guid:vr(),transid:mr(),ads:X}),r.setThirdPartyIds(n),r.setContentMetadata({page:wo(e.config.contentMetadata,"page"),video:wo(e.config.contentMetadata,"video")})};var Ys=e=>e.split(";").map(.reduce({}),So=e=>{let r=window;return r.WM=r.WM||{},r.WM.PSM=r.WM.PSM||{},{psmObject:r.WM.PSM,initWMUKID:zn,initCDPID:Yn,getWMUKID:n=>n?Ys(document.cookie).WMUKID_STABLE||"Unknown":y.get("WMUKID_STABLE")||"Unknown",getCDPID:()=>{let n=y.get("CDPID");return n&&typeof n=="object"&&"cdpId"in n&&"wmukId"in n?n.cdpId:n||"Unknown"},getConsentProperties:()=>({uspString:y.get("usprivacy"),consentRule:e.consentRule,optanonConsent:_r()||"",psmPrivacyMode:e.coppaPrivacyMode}),resolveAuthTokens:async(n,o,i)=>{if(!i.queryFlag("auth-service"))return C({message:"[PSM]: auth-service flag is disabled",methodName:"resolveAuthTokens",eventType:"authService"}),!1;let s=!0,a=!1,c=o.get("resolveAuthTimestamp");if(c){let T=new Date(c),A=(Date.now()-T.getTime())/1e3/60/60;if(A<24)return Oe({message:`Resolve Auth Token lifespan, ${A}, less than 24 hours`,methodName:"resolveAuthTokens",eventType:"authService"}),!1}let u,l,d,p,f,g=o.get("tok_lr"),h=o.get("tok_ttuid"),v=o.get("tok_lr2");v&&(u={provider:"Liveramp ATS",details:{id:v}},s=!1,a=!0);let w=Me("bt_ts",window.location.href),b=Me("utm_term",window.location.href);if(w&&b){let T=(Date.now()-parseInt(w))/1e3/60/60;if(T>24)return Oe({message:`bt_ts Parameter lifespan, ${T}, greater than 24 hours`,methodName:"resolveAuthTokens",eventType:"authService"}),!1;l={provider:"zeta",details:{id:b}}}let S=Me("primo",window.location.href);S&&(d={provider:"braze",details:{id:S}});let I=Ce();if(I&&(p={provider:"cnnAuthentication",details:{id:I}}),h&&(f={provider:"tradedesk",details:{id:h}}),g&&o.remove("tok_lr"),!v&&(!b||!w)&&!S&&!I)return C({message:"[PSM]: No token information present",methodName:"resolveAuthTokens",eventType:"authService"}),!1;let E=[];u!=null&&u.provider&&E.push(u),l!=null&&l.provider&&E.push(l),d!=null&&d.provider&&E.push(d),p!=null&&p.provider&&E.push(p),f!=null&&f.provider&&E.push(f);let P={wmukid:i.getWMUKID(),brand:i.config.brand,ids:{attuuid:Ke(),cdpid:i.getCDPID(),convivaid:We(),ecid:He(),kruxid:Ve(),wmhhid:o.get("wmhhid"),wminid:o.get("wminid"),zionid:$e(),cnnuid:Ce()},location:i.getLocationProperties(),consentProperties:{usp:o.get("usprivacy")},authentication:E};try{let T=await Z(O.authSvc[i.config.psmEnvironment],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)}),{tokens:A}=T,k=A.filter(U=>U.provider==="liveramp")[0];k&&(o.set("tok_lr",k.token,{expires:new Date(k.expiration)}),o.set("tok_lr2",k.token,{expires:new Date(k.expiration)}));let N=A.filter([0];N&&(o.set("tok_ttuid",N.token,{expires:new Date(N.expiration)}),o.set("tok_ttuid_refresh",N.refreshToken,{expires:new Date(N.expiration)}))}catch(T){C({err:T,eventType:"authService",methodName:"resolveAuthTokens"})}return i.setSessionProperties(),M(i,n),s&&n.trackTokenEvent("new token",new Date().toISOString(),T=>{i.queryFlag("doppler-send-token-event")&&(i.requestQueue.addItem(T),i.resetNewSessionFields())}),a&&n.trackTokenEvent("token updated",new Date().toISOString(),T=>{i.queryFlag("doppler-send-token-event")&&(i.requestQueue.addItem(T),i.resetNewSessionFields())}),o.set("resolveAuthTimestamp",new Date),!0},platform:window.navigator.platform}};Ze();var Qs=Object.create,Po=Object.defineProperty,Zs=Object.getOwnPropertyDescriptor,Oo=Object.getOwnPropertyNames,Xs=Object.getPrototypeOf,ea=Object.prototype.hasOwnProperty,m=ta=ra=ce=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/fails.js"),Co=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/function-bind-native.js"),de=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/function-uncurry-this.js"(e,r){var t=Co(),n=Function.prototype,o=n.bind,i=n.call,s=t&&o.bind(i,i);r.exports=t?}),na=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/classof-raw.js"),oa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/indexed-object.js"),xo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/require-object-coercible.js"(e,r){var t=TypeError;r.exports=}),st=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/to-indexed-object.js"),pe=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/global.js"),Ft=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/is-pure.js"),Ir=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/define-global-property.js"),Er=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/shared-store.js"),ko=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/shared.js"),jo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/to-object.js"),fe=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/has-own-property.js"),Ro=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/uid.js"),z=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/is-callable.js"),qt=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/get-built-in.js"),ia=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/engine-user-agent.js"),sa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/engine-v8-version.js"(e,r){var t=pe(),n=ia(),o=t.process,i=t.Deno,s=o&&o.versions||i&&i.version,a=s&&s.v8,c,u;a&&(c=a.split("."),u=c[0]>0&&c[0]<4?1:+(c[0]+c[1])),!u&&n&&(c=n.match(/Edge\/(\d+)/),(!c||c[1]>=74)&&(c=n.match(/Chrome\/(\d+)/),c&&(u=+c[1]))),r.exports=u}}),Do=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/native-symbol.js"),Lo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/use-symbol-as-uid.js"),at=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/well-known-symbol.js"(e,r){var t=pe(),n=ko(),o=fe(),i=Ro(),s=Do(),a=Lo(),c=n("wks"),u=t.Symbol,l=u&&u.for,d=a?u:u&&u.withoutSetter||i;r.exports=}),ct=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/is-object.js"(e,r){var t=z();r.exports=}),dt=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/an-object.js"),ge=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/descriptors.js"),Mo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/v8-prototype-define-bug.js"),No=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/document-create-element.js"),Uo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/ie8-dom-define.js"),Bt=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/function-call.js"),aa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-is-prototype-of.js"),Fo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/is-symbol.js"),ca=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/try-to-string.js"),da=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/a-callable.js"),ua=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/get-method.js"(e,r){var t=da();r.exports=}),la=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/ordinary-to-primitive.js"),pa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/to-primitive.js"),qo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/to-property-key.js"),xe=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-define-property.js"),fa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/math-trunc.js"),Bo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/to-integer-or-infinity.js"),ga=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/to-absolute-index.js"),ha=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/to-length.js"),ma=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/length-of-array-like.js"),va=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/array-includes.js"),Tr=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/hidden-keys.js"(e,r){r.exports={}}}),Vo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-keys-internal.js"),Ar=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/enum-bug-keys.js"),ya=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-keys.js"),_a=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-define-properties.js"),wa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/html.js"),Pr=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/shared-key.js"),Or=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-create.js"(e,r){var t=dt(),n=_a(),o=Ar(),i=Tr(),s=wa(),a=No(),c=Pr(),u=">",l="<",d="prototype",p="script",f=c("IE_PROTO"),g=function(){},h=v=w=b,S=i[f]=!0,r.exports=Object.create||}),Sa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/add-to-unscopables.js"(e,r){var t=at(),n=Or(),o=xe().f,i=t("unscopables"),s=Array.prototype;s[i]==null&&o(s,i,{configurable:!0,value:n(null)}),r.exports=}),Cr=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/iterators.js"),Ko=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/inspect-source.js"(e,r){var t=de(),n=z(),o=Er(),i=t(Function.toString);n(o.inspectSource)||(o.inspectSource=,r.exports=o.inspectSource}}),ba=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/native-weak-map.js"(e,r){var t=pe(),n=z(),o=Ko(),i=t.WeakMap;r.exports=n(i)&&/native code/.test(o(i))}}),xr=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/create-property-descriptor.js"),kr=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/create-non-enumerable-property.js"),Ho=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/internal-state.js"(e,r){var t=ba(),n=pe(),o=de(),i=ct(),s=kr(),a=fe(),c=Er(),u=Pr(),l=Tr(),d="Object already initialized",p=n.TypeError,f=n.WeakMap,g,h,v,w=b=t||c.state?(S=c.state||(c.state=new f),I=o(S.get),E=o(S.has),P=o(S.set),g=function(A,k){if(E(S,A))throw new p(d);return k.facade=A,P(S,A,k),k},h=v=function(A){return E(S,A)}):(T=u("state"),l[T]=!0,g=h=v=function(A){return a(A,T)});var S,I,E,P,T;r.exports={set:g,get:h,has:v,enforce:w,getterFor:b}}}),Ia=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-property-is-enumerable.js"),Wo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-get-own-property-descriptor.js"),$o=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/function-name.js"),Ea=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/make-built-in.js"(e,r){var t=ce(),n=z(),o=fe(),i=ge(),s=$o().CONFIGURABLE,a=Ko(),c=Ho(),u=c.enforce,l=c.get,d=Object.defineProperty,p=i&&!t(,f=String(String).split("String"),g=r.exports=Function.prototype.toString=g("toString")}}),jr=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/define-built-in.js"),Ta=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-get-own-property-names.js"),Aa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-get-own-property-symbols.js"),Pa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/own-keys.js"),Oa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/copy-constructor-properties.js"),Ca=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/is-forced.js"),xa=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/export.js"),ka=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/correct-prototype-getter.js"),Go=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-get-prototype-of.js"),Jo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/iterators-core.js"(e,r){"use strict";var t=ce(),n=z(),o=Or(),i=Go(),s=jr(),a=at(),c=Ft(),u=a("iterator"),l=!1,d,p,f;[].keys&&(f=[].keys(),"next"in f?(p=i(i(f)),p!==Object.prototype&&(d=p)):l=!0);var g=d==null||t(;g?d={}:c&&(d=o(d)),n(d[u])||s(d,u,function(){return this}),r.exports={IteratorPrototype:d,BUGGY_SAFARI_ITERATORS:l}}}),zo=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/set-to-string-tag.js"),ja=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/create-iterator-constructor.js"),Ra=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/a-possible-prototype.js"),Da=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/object-set-prototype-of.js"(e,r){var t=de(),n=dt(),o=Ra();r.exports=Object.setPrototypeOf||("__proto__"in{}?):void 0)}}),La=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/internals/define-iterator.js"),Ma=m({"../../node_modules/.pnpm/core-js@3.23.4/node_modules/core-js/modules/es.array.iterator.js"(e,r){"use strict";var t=st(),n=Sa(),o=Cr(),i=Ho(),s=xe().f,a=La(),c=Ft(),u=ge(),l="Array Iterator",d=i.set,p=i.getterFor(l);r.exports=a(Array,"Array","values");var f=o.Arguments=o.Array;if(n("keys"),n("values"),n("entries"),!c&&u&&f.name!=="values")try{s(f,"name",{value:"values"})}catch(g){}}});function Na(e,r){return r=r||{},new Promise(}async function Ua(e){let r=x({"Content-Type":"application/json"},e.headers),t=await Na(e.url,{method:e.method,headers:r,body:Fa(e)});if(t.ok)return qa(t);let n=new Error(t.statusText);return n.response=t,Promise.reject(n)}function Fa(e){return typeof e.payload=="string"?e.payload:e.payload instanceof String?e.payload.valueOf():JSON.stringify(e.payload)}async function qa(e){let r="";e.headers&&e.headers.entries().forEach(n=>r+=`${n[0]}: ${n[1]}\r
`);let t={status:e.status,statusText:e.statusText,headers:r,data:""};try{let n=await e.json();t.data=n}catch(n){new Error(`response.payload cannot be parsed. Failed with error:
 ${n}`)}return t}var Lt,Ba=new Uint8Array(16);ar Ka=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;ar Wa=Ha,q=[];for(Mt=0;Mt<256;++Mt)q.push((Mt+256).toString(16).substr(1));var Mt;ar Ga=$a;ar za=Ja;ar wr={ffLibraryVersionCode:1,ffLibraryVersionName:"1.0.2-beta",ffLibraryLanguage:"Javascript",minimumPollFrequencySeconds:60},bo="wmAppUserId",Nt="wmFeatureFlagConfig",Io="wmFeatureFlagUserId",Eo="wmFeatureFlagConfigEtag",Sr="wmFeatureFlagResults",To="wmConfigCacheStart",Ao="Cache was used due to remote loading failing.",Qa="Fallback used because remote config loading failed.",Za="Fallback or cache used because remote config loading failed.",Xa="Fallback used because a requested flag was present in it and not the remote.",ec="Remote config used because a fallback config is not present.",tc="There was a problem reading the config object from storage, possibly due to invalid config JSON.",it="Unable to access localStorage",rc="Unable to access sessionStorage",nc="A clientId must be provided for multiple instance support.",oc=class{constructor(e,r){if(this.storageType=e,this.clientId=r,this.warnings=[],!this.clientId){let t={code:"MULTIPLE_INSTANCES_SUPPORT",message:`${nc}`};this.warnings.push(t)}switch(this.storageType){case"localStorage":try{this.storage=localStorage}catch(t){let n={code:"UNABLE_TO_ACCESS_LOCAL_STORAGE",message:`${it}: ${t}`};this.warnings.push(n)}break;case"sessionStorage":try{this.storage=sessionStorage}catch(t){let n={code:"UNABLE_TO_ACCESS_SESSION_STORAGE",message:`${rc}: ${t}`};this.warnings.push(n)}break;case"inMemory":default:try{this.storage=localStorage;break}catch(t){let n={code:"UNABLE_TO_ACCESS_LOCAL_STORAGE",message:`${it}: ${t}`};this.warnings.push(n)}}}get(e){let r;if(typeof Storage>"u")return;let t=e;this.clientId&&(t=`${t}-${this.clientId}`);try{r=this.storage.getItem(t)}catch(n){let o={code:"UNABLE_TO_ACCESS_LOCAL_STORAGE",message:`${it}: ${n}`};this.warnings.push(o)}return r}set(e,r){if(typeof Storage>"u")return;let t=e;this.clientId&&(t=`${t}-${this.clientId}`);try{this.storage.setItem(t,r)}catch(n){let o={code:"UNABLE_TO_ACCESS_LOCAL_STORAGE",message:`${it}: ${n}`};this.warnings.push(o)}}delete(e){if(typeof Storage>"u")return;let r=e;this.clientId&&(r=`${r}-${this.clientId}`);try{this.storage.deleteItem(r)}catch(t){let n={code:"UNABLE_TO_ACCESS_LOCAL_STORAGE",message:`${it}: ${t}`};this.warnings.push(n)}}},mu=ra(Ma()),ic=()=>{Object.entries||(Object.entries=function(e){let r=Object.keys(e),t=r.length,n=new Array(t);for(;t--;)n[t]=[r[t],e[r[t]]];return n}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null)throw TypeError('"this" is null or not defined');let r=Object(this),t=r.length>>>0;if(typeof e!="function")throw TypeError("predicate must be a function");let n=arguments[1],o=0;for(;o<t;){let i=r[o];if(e.call(n,i,o,r))return i;o++}},configurable:!0,writable:!0})},sc=ic,br="input is invalid type",_="0123456789abcdef".split(""),ac=[-2147483648,8388608,32768,128],ne=[24,16,8,0],Ut=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],cc=class{constructor(){this.blocks=[],this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}pdate(e){if(this.finalized)return;let r,t=typeof e;if(t!=="string"){if(t==="object"){if(e===null)throw new Error(br);if(e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error(br)}else throw new Error(br);r=!0}let n,o=0,i,s=e.length,a=this.blocks;for(;o<s;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),r)for(i=this.start;o<s&&i<64;++o)a[i>>2]|=e[o]<<ne[i++&3];else for(i=this.start;o<s&&i<64;++o)n=e.charCodeAt(o),n<128?a[i>>2]|=n<<ne[i++&3]:n<2048?(a[i>>2]|=(192|n>>6)<<ne[i++&3],a[i>>2]|=(128|n&63)<<ne[i++&3]):n<55296||n>=57344?(a[i>>2]|=(224|n>>12)<<ne[i++&3],a[i>>2]|=(128|n>>6&63)<<ne[i++&3],a[i>>2]|=(128|n&63)<<ne[i++&3]):(n=65536+((n&1023)<<10|e.charCodeAt(++o)&1023),a[i>>2]|=(240|n>>18)<<ne[i++&3],a[i>>2]|=(128|n>>12&63)<<ne[i++&3],a[i>>2]|=(128|n>>6&63)<<ne[i++&3],a[i>>2]|=(128|n&63)<<ne[i++&3]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=a[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}finalize(){if(this.finalized)return;this.finalized=!0;let e=this.blocks,r=this.lastByteIndex;e[16]=this.block,e[r>>2]|=ac[r&3],this.block=e[16],r>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}hash(){let e=this.h0,r=this.h1,t=this.h2,n=this.h3,o=this.h4,i=this.h5,s=this.h6,a=this.h7,c,u,l,d,p,f,g,h,v,w,b,S=this.blocks;for(c=16;c<64;++c)p=S[c-15],u=(p>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,p=S[c-2],l=(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,S[c]=S[c-16]+u+S[c-7]+l<<0;for(b=r&t,c=0;c<64;c+=4)this.first?(h=704751109,p=S[0]-210244248,a=p-1521486534<<0,n=p+143694565<<0,this.first=!1):(u=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),l=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),h=e&r,d=h^e&t^b,g=o&i^~o&s,p=a+l+g+Ut[c]+S[c],f=u+d,a=n+p<<0,n=p+f<<0),u=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),l=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),v=n&e,d=v^n&r^h,g=a&o^~a&i,p=s+l+g+Ut[c+1]+S[c+1],f=u+d,s=t+p<<0,t=p+f<<0,u=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),l=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),w=t&n,d=w^t&e^v,g=s&a^~s&o,p=i+l+g+Ut[c+2]+S[c+2],f=u+d,i=r+p<<0,r=p+f<<0,u=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),l=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),b=r&t,d=b^r&n^w,g=i&s^~i&a,p=o+l+g+Ut[c+3]+S[c+3],f=u+d,o=e+p<<0,e=p+f<<0;this.h0=this.h0+e<<0,this.h1=this.h1+r<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+o<<0,this.h5=this.h5+i<<0,this.h6=this.h6+s<<0,this.h7=this.h7+a<<0}hex(){this.finalize();let e=this.h0,r=this.h1,t=this.h2,n=this.h3,o=this.h4,i=this.h5,s=this.h6,a=this.h7,c=_[e>>28&15]+_[e>>24&15]+_[e>>20&15]+_[e>>16&15]+_[e>>12&15]+_[e>>8&15]+_[e>>4&15]+_[e&15]+_[r>>28&15]+_[r>>24&15]+_[r>>20&15]+_[r>>16&15]+_[r>>12&15]+_[r>>8&15]+_[r>>4&15]+_[r&15]+_[t>>28&15]+_[t>>24&15]+_[t>>20&15]+_[t>>16&15]+_[t>>12&15]+_[t>>8&15]+_[t>>4&15]+_[t&15]+_[n>>28&15]+_[n>>24&15]+_[n>>20&15]+_[n>>16&15]+_[n>>12&15]+_[n>>8&15]+_[n>>4&15]+_[n&15]+_[o>>28&15]+_[o>>24&15]+_[o>>20&15]+_[o>>16&15]+_[o>>12&15]+_[o>>8&15]+_[o>>4&15]+_[o&15]+_[i>>28&15]+_[i>>24&15]+_[i>>20&15]+_[i>>16&15]+_[i>>12&15]+_[i>>8&15]+_[i>>4&15]+_[i&15]+_[s>>28&15]+_[s>>24&15]+_[s>>20&15]+_[s>>16&15]+_[s>>12&15]+_[s>>8&15]+_[s>>4&15]+_[s&15];return c+=_[a>>28&15]+_[a>>24&15]+_[a>>20&15]+_[a>>16&15]+_[a>>12&15]+_[a>>8&15]+_[a>>4&15]+_[a&15],c}toString(){return this.hex()}digest(){this.finalize();let e=this.h0,r=this.h1,t=this.h2,n=this.h3,o=this.h4,i=this.h5,s=this.h6,a=this.h7,c=[e>>24&255,e>>16&255,e>>8&255,e&255,r>>24&255,r>>16&255,r>>8&255,r&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,o>>24&255,o>>16&255,o>>8&255,o&255,i>>24&255,i>>16&255,i>>8&255,i&255,s>>24&255,s>>16&255,s>>8&255,s&255];return c.push(a>>24&255,a>>16&255,a>>8&255,a&255),c}rrayBuffer(){this.finalize();let e=new ArrayBuffer(32),r=new DataView(e);return r.setUint32(0,this.h0),r.setUint32(4,this.h1),r.setUint32(8,this.h2),r.setUint32(12,this.h3),r.setUint32(16,this.h4),r.setUint32(20,this.h5),r.setUint32(24,this.h6),r.setUint32(28,this.h7),e}};sc();var Yo=class{constructor(e,r,t=!1){if(this.addStorageWarnings=()=>{let o=[];return this.storage.warnings&&this.storage.warnings.length>0&&this.storage.warnings.map(,o},this.targetingPropsToLowerCase=o=>Object.entries(o).reduce((i,[s,a])=>{let c;return typeof a=="string"&&(c=a.toLowerCase()),Array.isArray(a)&&(c=a.map(),i[s.toLowerCase()]=c,i},{}),!e)throw new Error("Please provide a context object to the constructor.");if(!e.configUrl&&!r)throw new Error("Please provide either a config url or a valid config object.");this.config=void 0,this.configRefreshIntervalDefault=wr.minimumPollFrequencySeconds,this.context=e,this.fallbackConfig=r,this.featureFlagUserId="",this.libraryLanguage=wr.ffLibraryLanguage,this.initialized=!1,this.quickInit=t;let n=e&&e.storageType?e.storageType:"";this.storage=new oc(n,e.clientId),this.globalWarnings=[]}createHash(e,r){let n=new cc().create();return n.update(`${e}${r}`),n.hex()}etUserFeatureIndex(e){return parseInt(e.substring(0,10),16).toString().slice(-2)}async init(){let e=[],{config:r,fallbackConfig:t,initialized:n,featureFlagUserId:o,libraryLanguage:i,storage:s,configRefreshIntervalDefault:a,quickInit:c}=this,{configUrl:u,userId:l,configRefreshInterval:d}=this.context,p=typeof d<"u"?d:a,f=this.checkConfigCacheExpiry(p);if(!r||f){let g=s.get(Nt);try{g&&(this.config=JSON.parse(g))}catch(h){let v={code:"FAILED_TO_READ_CONFIG_FROM_STORAGE",message:tc};e.push(v)}if(!g||f)if(u){!f&&t&&this.updateConfig(t);let h=s.get(Eo)||"-1";h=g?h:"-1";try{if(c&&t)return g||this.updateConfig(t),this.loadAndSetRemoteConfig(u,h),e;if(c&&!t){let v={code:"REMOTE_CONFIG_USED_NO_FALLBACK_PRESENT",message:ec};e.push(v)}await this.loadAndSetRemoteConfig(u,h)}catch(v){if(g||t)this.setNoNewConfigWarning();else throw new Error(`Failed to load config file - no config url or default config provided. ${v}`)}}else{if(!t)throw new Error("Failed to load config file - no config url or default config provided.");this.updateConfig(t)}}if(n)return e;if(l)s.set(bo,l);else{let g=s.get(bo);g&&(this.context.userId=g)}if(!o){let g=s.get(Io);g&&(this.featureFlagUserId=g),g||(this.featureFlagUserId=this.createUserId(),s.set(Io,this.featureFlagUserId))}if(!this.context.userTargetingProperties||this.context.userTargetingProperties&&!this.context.userTargetingProperties.ffLibraryLanguage){let g={ffLibraryLanguage:i};this.updateContext(void 0,g)}return this.initialized=!0,e}checkConfigCacheExpiry(e){let{storage:r}=this,t=new Date,n=!1,o=i=r.get(To);if(!i){let c=new Date;o(JSON.stringify(c.getTime()))}let s=i?JSON.parse(i):t.getTime();if(n=t.getTime()-s>e,n===!0){let c=new Date;o(JSON.stringify(c.getTime()))}return n}async isFeatureEnabled(e){return(await this.queryFeatureFlag(e)).enabled}setNoNewConfigWarning(){let{fallbackConfig:e,storage:r}=this,t=r.get(Nt);if(t){let n={code:"CACHE_USED",message:Ao};this.globalWarnings.push(n)}else!t&&e&&(this.globalWarnings.push({code:"FALLBACK_USED_REMOTE_LOAD_FAILED",message:Ao}),this.updateConfig(e))}parseHeaders(e){return e.split(`\r
`).reduce({})}async loadAndSetRemoteConfig(e,r){try{let t=await this.loadConfig(e,r);if(t){this.config=t.data?t.data:this.config,t.data||this.globalWarnings.push({code:"FALLBACK_USED_REMOTE_LOAD_FAILED",message:Qa});let n=t.headers&&t.headers.etag?t.headers.etag:"";t.headers&&typeof t.headers=="string"&&(n=this.parseHeaders(t.headers).etag),n&&this.storage.set(Eo,n),this.storage.set(Nt,JSON.stringify(this.config))}}catch(t){this.globalWarnings.push({code:"FALLBACK_OR_CACHE_USED_REMOTE_LOAD_FAILED",message:Za}),this.setNoNewConfigWarning()}}async loadConfig(e,r="-1"){let t,n=`${e}?version=${wr.ffLibraryVersionCode}`,o={"If-None-Match":r},i={headers:o};try{t=await Ua({url:n,method:"GET",headers:o})}catch(s){throw new Error(`Failed to fetch config file: ${s}`)}return t}updateConfig(e){this.config=e,this.storage.set(Nt,JSON.stringify(e))}updateContext(e,r,t){let n=x({},this.context);if(e&&(n.userId=e),t)n.userTargetingProperties=r;else{let o=x(x({},n.userTargetingProperties),r);n.userTargetingProperties=o}this.context=n}getCohortConfig(e,r){let t=e.userId?"appUserId":"ffUserId",n={rolloutValue:"-1",cohortPriority:1,stickinessProperty:t},o=[...r];o.sort(;let i=this.targetingPropsToLowerCase(e.userTargetingProperties),s=o.find(a=>{let c=!1;if(!e.userId&&a.stickinessProperty==="appUserId")return!1;if(!a.cohortCriteria||a.cohortCriteria.length<1)return!0;let u=a.cohortCriteria;for(let l=0;l<u.length;l++){let{requiredFieldName:d}=u[l],{requiredFieldValues:p}=u[l];if(d=d.toLowerCase(),c=p.some(g=>{if(g=g.toLowerCase(),!i.hasOwnProperty(d)&&g==="")return!0;if(typeof i[d]=="string")return i[d]===g;if(Array.isArray(i[d]))return i[d].some(}),!c)break}return c});return s&&(n=x({},s)),n}cacheFlagResults(e){let{storage:r}=this,t=[],n=[],o=[];Array.isArray(e)?o=e?[...e]:[]:o.push(e);let i=r.get(Sr);t=[...i?JSON.parse(i):[]],t.length>0&&(n=t.reduce([]));let a=[...n,...o];return r.set(Sr,JSON.stringify(a)),a}checkIfFlagUpdated(e){let{storage:r}=this,t=r.get(Sr),n=t?JSON.parse(t):[];if(n.length<1)return!0;let o=n.find(;return o?o.enabled!==e.enabled:!0}async queryFeatureFlag(e,r=!1){let{context:t,fallbackConfig:n}=this,o=!1,i,s,a,c,u,l="appUserId",d=[],p=w=>{let b=r?[]:this.globalWarnings;return d.concat(w,b)},f=g=(w,b)=>{if(i=f(w,b),i){let S=this.addStorageWarnings();d=p(S);let I={clientId:t.clientId,flagId:i.id,flagName:i.name?i.name:void 0,enabled:i.defaultValue,updatedSinceLastQuery:!0,warnings:d};return I.updatedSinceLastQuery=this.checkIfFlagUpdated(I),this.cacheFlagResults(I),I}};try{if(d=(await this.init()).concat(d),c=this.context.userId?this.context.userId:void 0,!this.config||!this.config.flags)throw new Error("Operation failed - no config file or invalid config file detected.");if(i=f(this.config,e),!i){if(n){let U=g(n,e);if(U){let he={code:"FALLBACK_USED_FLAG_NOT_IN_REMOTE",message:Xa};return d.push(he),U}}throw new Error("Flag not found")}let{cohorts:b,defaultValue:S,name:I,type:E}=i;if(E&&E.toLowerCase()!=="boolean"&&!r)throw new Error("Flag not found");if(!b||b.length<1){let U=this.addStorageWarnings();d=p(U);let he={clientId:t.clientId,flagId:i.id,flagName:I,enabled:i.defaultValue,updatedSinceLastQuery:!0,warnings:d};return he.updatedSinceLastQuery=this.checkIfFlagUpdated(he),this.cacheFlagResults(he),he}s=I;let P=this.getCohortConfig(t,b),{rolloutValue:T}=P,{stickinessProperty:A}=P;T=T||"0";let k=i.id;a=this.context.userId?this.context.userId:void 0,A==="ffUserId"&&(c=this.featureFlagUserId,l="ffUserId",a=c);let N=a?this.createHash(a,k):void 0;if(u=N?this.getUserFeatureIndex(N):"-1",o=parseInt(u,10)<parseInt(T,10),parseInt(T,10)<0||parseInt(u,10)<0||parseInt(u,10)>99){if(typeof S>"u"){if(n){let U=g(n,e);if(U)return U;throw new Error("Flag not found")}throw new Error("Unable to determine flag default value")}o=S}}catch(w){throw new Error(`Failed to query feature flag: ${w}`)}let h=this.addStorageWarnings();d=p(h);let v={flagId:e,flagName:s,enabled:o,updatedSinceLastQuery:!0,clientId:t.clientId,userId:c,userIdType:l,warnings:d};return v.updatedSinceLastQuery=this.checkIfFlagUpdated(v),this.cacheFlagResults(v),v}async queryAllFeatureFlags(){await this.init();let{config:e}=this;if(!e||!e.flags)throw new Error("No config file or invalid config file detected.");let r={anyFlagsUpdatedSinceLastQuery:!1,globalWarnings:this.globalWarnings,results:[]},t=e.flags.map(async n=>{let o=await this.queryFeatureFlag(n.id,!0);o.updatedSinceLastQuery===!0&&(r.anyFlagsUpdatedSinceLastQuery=!0),r.results.push(o)});return Promise.all(t).then(()=>r)}};var li=Ht(dr()),Rr=Ht(oi());Ze();function mc(e){let r=e;return typeof r<"u"&&r!==null&&(r.constructor==={}.constructor||r.constructor===[].constructor)}unction oe(){let e={},r=(i,s)=>{s!=null&&s!==""&&(e[i]=s)};return{add:r,addMap:i=>{for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&r(s,i[s])},addJson:(i,s)=>{if(s&&vc(s)){let a=JSON.stringify(s);r(i,a)}},build:}function yc(e){return e==null||e==null?new Date().toISOString():new Date(e).toISOString()}var ii=e=>{let r={};return Array.isArray(e)?e:(Object.entries(e).forEach(([t,n])=>{n===Object(n)?r[t]=ii(n):n!=null&&(r[t]=e[t])}),r)};function si(e){let r={},t=n=(o,i,s)=>{o.addMap(ii(r)),o.add("eventTimestamp",yc(i)),o.add("eventId",Se()),typeof e=="function"&&e(o);try{s&&s(o.build())}catch(a){console.warn("[PSM]: error running custom callback")}return o};return{addEntry:t,setPlatform(o){t("platform",o)},setBrand(o){t("brand",o)},setSubBrand(o){t("subBrand",o)},setProductName(o){t("productName",o)},setWMUKID(o){t("wmukid",o)},setThirdPartyIds(o){t("ids",o)},setDevice(o){t("device",o)},setNavigationProperties(o){t("navigationProperties",o)},setClientResolvedIp(o){t("clientResolvedIp",o)},setLocation(o){t("location",o)},setConsentProperties(o){t("consentProperties",o)},setIABCategories(o){t("iabConsentCategories",o)},setLibrary(o){let s=window.WM,a=s==null?void 0:s.UserConsent,c=null;a&&(c={version:a.getVersion(),usingPsm:a.usingPSM(),initConfig:s.UserConsentConfig}),t("library",x({wmucLibrary:c},o))},setEventProperties(o){t("eventProperties",o)},setSessionProperties(o){t("session",o)},setAdsProperties(o){t("adsProperties",o)},setContentMetadatatrackAppLoad(o,i){let s=oe();return s.add("eventType","telemetry"),s.add("eventName","appLoad"),n(s,o,i)},trackHeartbeat(o,i){let s=oe();return s.add("eventType","telemetry"),s.add("eventName","heartbeat"),n(s,o,i)},trackPubSub(o,i,s){let a=oe(),c={eventTrigger:"pubsub"};return a.add("eventType","telemetry"),a.add("eventName",o),t("eventProperties",c),n(a,i,s)},trackIdentityRegistration(o,i,s){let a=oe();return a.add("eventType","identity"),a.add("eventName",o),n(a,i,s)},trackTokenEvent(o,i,s){let a=oe();return a.add("eventType","token"),a.add("eventName",o),n(a,i,s)},trackConsentUpdated(o,i,s,a){let c=oe(),u={eventTrigger:o,uspString:i==null?void 0:i.usp,region:i==null?void 0:i.region};return c.add("eventType","privacy"),c.add("eventName","consent update"),t("eventProperties",u),n(c,s,a)},trackConsentGranted(o,i){let s=oe();return s.add("eventType","privacy"),s.add("eventName","ccpaShareData"),n(s,o,i)},trackConsentWithdrawn(o,i){let s=oe();return s.add("eventType","privacy"),s.add("eventName","ccpaShareData"),n(s,o,i)},trackPageExit(o,i,s){let a=oe();return a.add("eventType","telemetry"),a.add("eventName","pageExit"),a.add("eventTrigger",o),n(a,i,s)},trackInbrain(o,i,s){let a=oe();return a.add("eventType","telemetry"),a.add("eventName",o),n(a,i,s)}}}function ai(e){return(r,t)=>{let n=["bot","crawl","spider"];if(new RegExp(n.join("|"),"i").test(window.navigator.userAgent))return t(null,{});r.sentAtTimestamp=new Date().toISOString(),Z(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(.catch(i=>{C({err:i,methodName:"sendRequest",eventType:r.eventType||"queue"}),t(i)})}}var ci=(e,r)=>{let t=r.psmObject;t.initPsm=e.initPsm.bind(e),t.getVersion=e.getVersion.bind(e),t.getWMUKID=r.getWMUKID.bind(e),t.getCDPID=r.getCDPID.bind(e),t.getConfig=e.getConfig.bind(e),t.getConsentProperties=r.getConsentProperties.bind(e),t.getBrand=e.getBrand.bind(e),t.getBrandToken=e.getBrandToken.bind(e),t.getSubBrand=e.getSubBrand.bind(e),t.getCoppaPrivacyMode=e.getCoppaPrivacyMode.bind(e),t.getDeviceProperties=e.getDeviceProperties.bind(e),t.getIds=e.getIds.bind(e),t.getLibrary=e.getLibrary.bind(e),t.getLocationProperties=e.getLocationProperties.bind(e),t.getDeviceProperties=e.getDeviceProperties.bind(e),t.getNavigationProperties=e.getNavigationProperties.bind(e),t.getSessionProperties=e.getSessionProperties.bind(e),t.isDopplerIdentityOnStartEnabled=()=>e.queryFlag("doppler-identity-onstart"),t.isDopplerIdentityOnCompleteEnabled=()=>e.queryFlag("doppler-identity-oncomplete"),t.isDopplerPrivacyEnabled=()=>e.queryFlag("doppler-privacy"),t.isDopplerTelemetryEnabled=e.setUspData&&(t.setUspData=e.setUspData.bind(e),t.getUspBoolean=e.getUspBoolean.bind(e),t.getUspString=e.getUspString.bind(e),t.getComScoreFromUsp=e.getComScoreFromUsp.bind(e),t.getUspData=e.getUspData.bind(e))};var ut=null;function di(e,r){window.document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?(to(),clearInterval(ut),ut=null,r()):(ro(),jt(),Dt(),ut=ut||setInterval(e,3e4))},!1),ut=setInterval(e,3e4)}var ui="3.2.1";var L=class extends Hr{constructor(){super();L.dependencies=So(this),ci(this,L.dependencies),L.dependencies.getFlags=this.getFlags.bind(this),L.dependencies.getAdsProperties=this.getAdsProperties.bind(this)}async initPsm(t){let n=window,o=n.psmInitialized;if(this.ready||o)return;if(n.psmInitialized=!0,this.browser=Sn(),this.config.browser=this.browser,this.config=Object.assign(this.config,t),Vn(this),typeof t>"u")throw new Error("[PSM]: Please provide a valid configuration to initPsm");let i=async()=>{let a=t.psmEnvironment.toUpperCase(),c=si();this.core=c,this.requestQueue=new li.default("prismCE",ft,ai(O.identity[a]));let u=!1;if(!(window.location!==window.parent.location&&t.psmBrandToken!=="cnnamp")){if(t.psmBrandToken==="cnnamp"&&(u=!0),this.wmukid=L.dependencies.initWMUKID(this.coppaPrivacyMode,u),this.coppaPrivacyMode!==Rr.COPPAPrivacyModesEnum.ZERO_ID){this.cdpid=await L.dependencies.initCDPID(a,this.config.platform);for(let l of document.links)l instanceof HTMLAnchorElement&&l.href.includes("hbomax.com/subscribe/plan-picker")&&l.addEventListener("click",()=>{M(this,c),c.trackPageExit("click",new Date().toISOString(),d=>{d.navigationProperties.destination=l.href,d.sentAtTimestamp=new Date().toISOString(),navigator.sendBeacon(O.identity[a],JSON.stringify(d))})});await this.resolveIds(u),this.setSendHHIDCookie(),this.setSendWMSegs(),this.setSendAuth2Token(),L.dependencies.resolveAuthTokens(c,y,this),window.ZionMessageBus&&window.ZionMessageBus.getInstance().publish("id_found",{type:"wmukid",value:this.wmukid})}if(this.setSessionProperties(!0),this.setIsInExperiment("isInAuthTokenExperiment"),this.setIsInExperiment("isInHHIDExperiment"),M(this,c),c.trackIdentityRegistration("identity on page start",new Date().toISOString(),l=>{this.queryFlag("doppler-identity-onstart")&&(this.requestQueue.addItem(l),this.resetNewSessionFields()),a==="AUTOMATED_TEST"&&window.localStorage.setItem("payload-on-start",JSON.stringify(l))}),window.addEventListener("load",()=>{this.setSessionProperties(),M(this,c),c.trackIdentityRegistration("identity on page complete",new Date().toISOString(),l=>{this.queryFlag("doppler-identity-oncomplete")&&(this.requestQueue.addItem(l),a==="AUTOMATED_TEST"&&window.localStorage.setItem("payload-on-complete",JSON.stringify(l)),this.resetNewSessionFields())})}),document.addEventListener("userConsentChanged",l=>{C({message:"userConsentChanged event received",methodName:"initPsm",eventType:"privacy",context:{eventDetails:l.detail}}),this.setSessionProperties(),M(this,c),c.trackConsentUpdated("userConsentChanged",l.detail,new Date().toISOString(),d=>{this.queryFlag("doppler-consent-update")&&(C({message:"Consent Update event registered",methodName:"initPsm",eventType:"privacy",context:{payload:d}}),this.requestQueue.addItem(d),this.resetNewSessionFields())})}),this.queryFlag("doppler-heartbeat-event")&&(eo(),ao(),this.wmukid!=="Unknown"&&(di(()=>{no(),rt(),this.setSessionProperties(),M(this,c),c.trackHeartbeat(new Date().toISOString(),d=>{this.requestQueue.addItem(d),this.resetNewSessionFields(),Dt(),jt()})},()=>{rt(),M(this,c),c.trackPageExit("visibilitychange",new Date().toISOString(),d=>{d.sentAtTimestamp=new Date().toISOString(),window.navigator.sendBeacon(O.identity[a],JSON.stringify(d))})}),window.addEventListener("beforeunload",()=>{rt(),M(this,c),c.trackPageExit("beforeunload",new Date().toISOString(),d=>{d.sentAtTimestamp=new Date().toISOString(),window.navigator.sendBeacon(O.identity[a],JSON.stringify(d))})}),window.addEventListener("pagehide",d=>{d.persisted||(rt(),M(this,c),c.trackPageExit("pagehide",new Date().toISOString(),p=>{p.sentAtTimestamp=new Date().toISOString(),window.navigator.sendBeacon(O.identity[a],JSON.stringify(p))}))}))),this.queryFlag("doppler-pubsub-event"))for(let l in t.topics)t.topics[l].forEach(d=>{window.PubSub&&window.PubSub.subscribe(d,(...p)=>{let f=typeof p[1]=="object"?p[1]:p[0];f=Object.keys(f).length<3&&f.video?f.video:f,window.psmPubSubData=window.psmPubSubData||{},window.psmPubSubData[l]=window.psmPubSubData[l]||{},Object.assign(window.psmPubSubData[l],f),M(this,c),c.trackPubSub(d,new Date().toISOString(),})});if(this.requestQueue.start(),this.coppaPrivacyMode!==Rr.COPPAPrivacyModesEnum.ZERO_ID)try{go(this,c)}catch(l){be({err:l,eventType:"inbrain",methodName:"initInbrain"})}this.ready=!0}};if(this.validateConfig(t),this.countryCode=this.hasProperty("countryCode",t)&&typeof t.countryCode<"u"&&this.config.countryCode.length?this.config.countryCode.toUpperCase():"",De.includes(this.countryCode)||this.countryCode==="")try{this.location=await Z(O.locate),this.countryCode=this.countryCode===""?this.location.country_alpha2:this.countryCode}catch(a){this.location.country=void 0,this.location.country_alpha2=void 0}try{let{shouldLoad:a,categories:c}=await Wn();De.includes(this.countryCode)?this.consentRule="US":a&&c.length>0&&(this.consentRule="GDPR"),this.consentCategories=c.reduce({})}catch(a){this.consentCategories={}}this.initCoppaPrivacyMode();let s=`psmFFClient-${this.config.brand}-${this.config.subBrand}`;this.ffClient=new Yo({configUrl:O.featureFlag[t.psmEnvironment.toUpperCase()],configRefreshInterval:6e4,userTargetingProperties:{Platform:["Web"],Brand:[t.brand],Browser:this.browser,ClientID:s,CountryCode:this.countryCode},clientId:s});try{let a=await this.ffClient.queryAllFeatureFlags();this.flags=a.results,(this.consentRule==="US"||this.consentRule==="GDPR"&&this.queryFlag("outside-us-location-check"))&&await i()}catch(a){console.log("[PSM]: Error encountered during location check",a)}}getWMUKID(){return L.dependencies.getWMUKID()}getCDPID(){return L.dependencies.getCDPID()}etSendHHIDCookie(){let t=this.queryFlag("sendHHID");return y.set("sendHHID",t)}setSendAuth2Token(){let t=this.queryFlag("sendAuthToken2");return y.set("sendAuthToken",t),y.set("sendAuthToken2",t)}setIsInExperimentetSendWMSegssync resolveIds(t){if(!this.queryFlag("idresolve"))return C({message:"[PSM]: idresolve flag is disabled",methodName:"resolveIds",eventType:"idresolution"}),!1;let n=y.get("idrTimestamp");if(n){let i=new Date(n),a=(new Date().getTime()-i.getTime())/1e3/60/60;if(a<24)return Oe({message:`[PSM]: IDR lifespan, ${a}, less than 24 hours`,methodName:"resolveIds",eventType:"idresolution"}),!1}let o={wmukid:L.dependencies.getWMUKID(t),ids:{attuuid:Ke(),cdpid:L.dependencies.getCDPID(),cnnuid:Ce(),convivaid:We(),ecid:He(),kruxid:Ve(),mpid:yr(),wmhhid:y.get("wmhhid"),wminid:y.get("wminid"),zionid:$e()}};try{let i=await Z(O.idresolve[this.config.psmEnvironment],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),{wmhhid:s,wminid:a,wmsegs:c,hhidVersion:u}=i;s||y.remove("wmhhid"),c||localStorage.removeItem("wmsegs"),s&&y.set("wmhhid",s),u&&y.set("hhidVersion",u.toString()),a&&y.set("wminid",a),c&&localStorage.setItem("wmsegs",c)}catch(i){C({err:i,eventType:"idresolution",methodName:"sendRequest"})}return y.set("idrTimestamp",new Date),!0}getPageLoadId(t,n){let o=y.get("psmPageLoadId"),i=o&&parseInt(o),s=i;return t&&(s=1),!t&&n&&i&&(s=i+1),s}setSessionProperties(t=!1){let n=new Date,o={isSessionStart:!0,pageloadid:this.getPageLoadId(!0,t),psmLastActiveTimestamp:n.toISOString(),psmSessionStart:n.toISOString(),sessionDuration:0,sessionid:Se()},i=y.get("psmSessionId"),s=y.get("psmSessionStart"),a=y.get("psmLastActiveTimestamp");if(i!==null){let c=new Date(a),u=new Date(s),l=n.getTime()-c.getTime();l>18e5?(Oe({message:`[PSM]: Session ${i} timed out after ${l/1e3} seconds.`,methodName:"setSessionProperties",eventType:"session"}),o=je(x({},o),{previousSession:{psmLastActiveTimestamp:a,psmSessionStart:s,sessionDuration:(c.getTime()-u.getTime())/1e3,sessionid:i}})):(C({message:`[PSM]: Session ${i} still active after ${l/1e3} seconds. Updating last active timestamp.`,methodName:"setSessionProperties",eventType:"session"}),o={isSessionStart:!1,pageloadid:this.getPageLoadId(!1,t),psmLastActiveTimestamp:n.toISOString(),psmSessionStart:s,sessionDuration:(n.getTime()-u.getTime())/1e3,sessionid:i})}else Oe({message:"[PSM]: Creating new session",methodName:"setSessionProperties",eventType:"session"});y.set("psmSessionId",o.sessionid),y.set("psmLastActiveTimestamp",o.psmLastActiveTimestamp),y.set("psmSessionStart",o.psmSessionStart),y.set("psmPageLoadId",JSON.stringify(o.pageloadid)),this.session=o}resetNewSessionFields(){this.session=je(x({},this.session),{isSessionStart:!1,previousSession:null})}getFlags(){return this.flags.reduce({})}getAdsProperties(){return{guid:vr()||"",transid:mr()||"",ads:X}}etLibraryetIds(){return{attuuid:Ke()||"",cdpid:L.dependencies.getCDPID(),cnnuid:Ce()||"",convivaid:We()||"",ecid:He()||"",kruxid:Ve()||"",liverampatsid:y.get("tok_lr"),wmhhid:y.get("wmhhid"),wminid:y.get("wminid"),zionid:$e()||""}}getNavigationProperties(){return{url:window.location.href,rootDomain:wt(window.location.href),referrer:It(),path:window.location.pathname,search:window.location.search,title:window.document.title}}queryFlag(t){let n=Vr[t]||!1;try{let{enabled:o}=this.flags.find(;n=o}catch(o){Kn({err:o,methodName:"queryFlag",eventType:"featureFlagging"})}return n}};var hl=new L;})();
//# sourceMappingURL=psm.legacy.min.umd.js.map