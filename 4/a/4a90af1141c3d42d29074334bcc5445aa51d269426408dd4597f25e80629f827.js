(function(){"use strict";var DEBUG_VIEW_TOKEN_KEY="tms_debug_view_token",DEBUG_VIEW_OPTIONS_STORAGE_KEY="tms_debug_view_options",VISUALISATION_OPTIONS_STORAGE_KEY="tms_visualisation_options",VISUALISATION_MODE_KEY="tms_visualisation_mode",SDK_ENV="prod",addressMap={dev:"/dist",prod:"https://deo.shopeemobile.com/shopee/shopee-trackingsdk-live-sg",staging:"https://tms.traffic.staging.shopee.io/sdk",test:"https://tms.traffic.test.shopee.io/sdk"},CDNAddress=addressMap[SDK_ENV],scriptAMDMap={requireJS:"".concat(CDNAddress,"/require.js"),trackingSDKRequireJS:"".concat(CDNAddress,"/require-trackingsdk.js")},sdkConfigLock=!1,sdkConfig$1=void 0;function isDebugModeNeeded(){try{if(new URL(self.window.location.href).searchParams.get(DEBUG_VIEW_TOKEN_KEY))return!0;var e=self.window.localStorage.getItem(DEBUG_VIEW_OPTIONS_STORAGE_KEY);return Boolean(e)}catch(e){return!1}}function isVisualisationNeeded(){try{if(self.window.localStorage.getItem(VISUALISATION_OPTIONS_STORAGE_KEY))return!0;var e=new URL(self.window.location.href);return!!new URLSearchParams(e.search).get(VISUALISATION_MODE_KEY)}catch(e){return!1}}function getSDKConfig(e){if(void 0===e&&(e=!1),sdkConfigLock)return Promise.resolve(sdkConfig$1);sdkConfigLock=!0;var n=e?"_testing":"";return new Promise((function(e,t){fetch("https://content.garena.com/shopee/track_config/split_by_market_config".concat(n,".json")).then(().then(().catch(()}))}function getInitParams(){var e=window.trackingSDK;if(e&&e.param)return"function"==typeof e.param?e.param()||e.param("ubt"):e.param}function hasDynamicImport(){var e=Promise&&Promise.prototype&&Promise.prototype.then,n=e&&Promise.resolve(!1);if(!e)return{then:;try{var t=Function('return import("data:text/javascript,")')();return t.then&&"function"==typeof t.then?t.then((function(){return!0}),(function(){return!1})):n}catch(e){return n}}ar requireLibURL=scriptAMDMap.trackingSDKRequireJS,githash="8f9af71",depMapping={core:["@shopee/tracking-core@".concat(githash)],ubt:["@shopee/tracking-ubt@".concat(githash)],algo:["@shopee/tracking-algo@".concat(githash)],apms:["@shopee/tracking-apms@".concat(githash)],mmp:["@shopee/tracking-mmp@".concat(githash)],exposure:["@shopee/tracking-exposure@".concat(githash)],debugview:["@shopee/tracking-internal-debugview@".concat(githash),isDebugModeNeeded],visualisation:["@shopee/tracking-internal-visualisation@".concat(githash),isVisualisationNeeded]},getDepAddress=function(e){return e.includes("-internal-")?"".concat(addressMap.staging,"/amd/").concat(e,".min.js"):"".concat(CDNAddress,"/amd/").concat(e,".min.js")},getEsDepAddress=function(e){return e.includes("-internal-")?"".concat(addressMap.staging,"/es/").concat(e,".min.js"):"".concat(CDNAddress,"/es/").concat(e,".min.js")},sdkConfig=void 0;function loadEntry(enableDynamicImport){var require;enableDynamicImport||(require=window.trackingSDK.require,require.config({waitSeconds:30}));var trackingSDK=window.trackingSDK,loadDeps=function(input){var _a=Array.isArray(input)?[input[0],"function"==typeof input[1]?input[1](input[0]):input[1]]:[input,"function"==typeof trackingSDK.param?trackingSDK.param(input):trackingSDK.param],name=_a[0],_b=_a[1],initParams=void 0===_b?{}:_b,depConfig=depMapping[name];if(depConfig){var depName=depConfig[0],_c=depConfig[1],isDepNeeded=void 0===_c?_c;if(isDepNeeded()){console.log("调 require 顺序",depName);var requireCallback=function(e){try{var n=new("default"in e?e.default:e)(initParams);n.init({version:trackingSDK.version,sdkConfig:sdkConfig}).then((function(){trackingSDK[name]=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return(t=n)[e].apply(t,r)},(trackingSDK.store[name]||[]).forn,e)})),delete trackingSDK.store[name]}))}catch(e){console.error("[@shopee/tracking-loader error] ".concat(name," failed to init"),e)}};if(enableDynamicImport){var url=getEsDepAddress(depName);return eval("import('".concat(url,"').then(requireCallback);"))}return require?require([getDepAddress(depNak(e)})):void 0}}else console.error("[@shopee/tracking-loader error] ".concat(name," does not exist"))};trackingSDK.load=function(e){null==e||e.forEach((function(e){var n="ubt",t=trackingSDK.param;"string"==typeof e&&(n=e),Array.isArray(e)&&(n=e[0]||n,t=e[1]||t),n in depMapping&&trackingSDK.__generateModule(n),loadDeps([n,t])}))};var loadModules=function(){var e;if(trackingSDK){var n=trackingSDK.dep;enableDynamicImport?null===(e=loadDeps("ubt"))||void 0===e||e.then((function(){var e=null==n?void 0:n.fi!==e}));null==e||e.forEach(loadDeps)})):"function"==typeof require&&(null==n||n.forEach(loadDeps))}};loadModules()}var initParams=getInitParams();if(!initParams)throw new Error("Missing Init Params");getSDKConfig(initParams.__testCCMS__).ig=e})).c",e)})).then((function(){sdkConfig&&sdkConfig.dynamic_import?hasDynamicImport().then((function(e){e?loadEntry(!0):loadScript(requireLibURL,(function(){loadEntry(!1)}))})):loadScript(requireLi(!1)}))}))})();