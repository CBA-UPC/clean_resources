![function(e,t,r){var n=r(2);t.LOG_LEVEL={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},t.ERROR_MESSAGES={CONDITION_EVALUATOR_ERROR:"%s: Error evaluating audience condition of type %s: %s",DATAFILE_AND_SDK_KEY_MISSING:"%s: You must provide at least one of sdkKey or datafile. Cannot start Optimizely",EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",FEATURE_NOT_IN_DATAFILE:"%s: Feature key %s is not in datafile.",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_DATAFILE_MALFORMED:"%s: Datafile is invalid because it is malformed.",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_KEY:"%s: Event key %s is not in datafile.",INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_ROLLOUT_ID:"%s: Invalid rollout ID %s attached to feature %s",INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",JSON_SCHEMA_EXPECTED:"%s: JSON schema expected.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",UNRECOGNIZED_ATTRIBUTE:"%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",UNABLE_TO_CAST_VALUE:"%s: Unable to cast value %s to type %s, returning null.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIABLE_KEY_NOT_IN_DATAFILE:'%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s.",VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT:"%s: Variation ID %s is not in the datafile.",INVALID_INPUT_FORMAT:"%s: Provided %s is in an invalid format.",INVALID_DATAFILE_VERSION:"%s: This version of the JavaScript SDK does not support the given datafile version: %s",INVALID_VARIATION_KEY:"%s: Provided variation key is in an invalid format."},t.LOG_MESSAGES={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FEATURE_ENABLED_FOR_USER:"%s: Feature %s is enabled for user %s.",FEATURE_NOT_ENABLED_FOR_USER:"%s: Feature %s is not enabled for user %s.",FEATURE_HAS_NO_EXPERIMENTS:"%s: Feature %s is not attached to any experiments.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NO_ROLLOUT_EXISTS:"%s: There is no rollout of feature %s.",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',ROLLOUT_HAS_NO_EXPERIMENTS:"%s: Rollout of feature %s has no experiments",SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is not in "Running" state. Not activating user.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",USER_ASSIGNED_TO_VARIATION_BUCKET:"%s: Assigned variation bucket %s to user %s.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned experiment bucket %s to user %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_BUCKETED_INTO_TARGETING_RULE:"%s: User %s bucketed into targeting rule %s.",USER_IN_FEATURE_EXPERIMENT:"%s: User %s is in variation %s of experiment %s on the feature %s.",USER_IN_ROLLOUT:"%s: User %s is in rollout of feature %s.",USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s bucketed into everyone targeting rule.",USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP:"%s: User %s is not in any experiment of group %s.",USER_NOT_BUCKETED_INTO_TARGETING_RULE:"%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",USER_NOT_IN_FEATURE_EXPERIMENT:"%s: User %s is not in any experiment on the feature %s.",USER_NOT_IN_ROLLOUT:"%s: User %s is not in rollout of feature %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s does not meet conditions for targeting rule %s.",USER_MEETS_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s meets conditions for targeting rule %s.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",USER_RECEIVED_DEFAULT_VARIABLE_VALUE:'%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Feature "%s" is not enabled for user %s. Returning default value for variable "%s".',VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Variable "%s" is not used in variation "%s". Returning default value.',USER_RECEIVED_VARIABLE_VALUE:'%s: Value for variable "%s" of feature flag "%s" is %s for user "%s"',VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s.",VARIABLE_REQUESTED_WITH_WRONG_TYPE:'%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',VALID_BUCKETING_ID:'%s: BucketingId is valid: "%s"',BUCKETING_ID_NOT_STRING:"%s: BucketingID attribute is not a string. Defaulted to userId",EVALUATING_AUDIENCE:'%s: Starting to evaluate audience "%s" with conditions: %s.',EVALUATING_AUDIENCES_COMBINED:'%s: Evaluating audiences for experiment "%s": %s.',AUDIENCE_EVALUATION_RESULT:'%s: Audience "%s" evaluated to %s.',AUDIENCE_EVALUATION_RESULT_COMBINED:"%s: Audiences for experiment %s collectively evaluated to %s.",MISSING_ATTRIBUTE_VALUE:'%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',UNEXPECTED_CONDITION_VALUE:"%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",UNEXPECTED_TYPE:'%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',UNEXPECTED_TYPE_NULL:'%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',UNKNOWN_CONDITION_TYPE:"%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",UNKNOWN_MATCH_TYPE:"%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",UPDATED_OPTIMIZELY_CONFIG:"%s: Updated Optimizely config to revision %s (project id %s)",OUT_OF_BOUNDS:'%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].',UNABLE_TO_ATTACH_UNLOAD:'%s: unable to bind optimizely.close() to page unload event: "%s"'},t.RESERVED_EVENT_KEYWORDS={REVENUE:"revenue",VALUE:"value"},t.CONTROL_ATTRIBUTES={BOT_FILTERING:"$opt_bot_filtering",BUCKETING_ID:"$opt_bucketing_id",STICKY_BUCKETING_KEY:"$opt_experiment_bucket_map",USER_AGENT:"$opt_user_agent"},t.JAVASCRIPT_CLIENT_ENGINE="javascript-sdk",t.NODE_CLIENT_ENGINE="node-sdk",t.REACT_CLIENT_ENGINE="react-sdk",t.NODE_CLIENT_VERSION="3.5.0",t.VALID_CLIENT_ENGINES=[t.NODE_CLIENT_ENGINE,t.REACT_CLIENT_ENGINE,t.JAVASCRIPT_CLIENT_ENGINE],t.NOTIFICATION_TYPES=n.NOTIFICATION_TYPES,t.DECISION_NOTIFICATION_TYPES={AB_TEST:"ab-test",FEATURE:"feature",FEATURE_TEST:"feature-test",FEATURE_VARIABLE:"feature-variable"},t.DECISION_SOURCES={FEATURE_TEST:"feature-test",ROLLOUT:"rollout"},t.FEATURE_VARIABLE_TYPES={BOOLEAN:"boolean",DOUBLE:"double",INTEGER:"integer",STRING:"string"},t.DATAFILE_VERSIONS={V2:"2",V3:"3",V4:"4"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(22);.getTimestamp=function(){return(new Date).getTime()},t.generateUUID=function(){return n.v4()},t.isValidEnum=t.groupBy=t.objectValues=o,t.objectEntries=t.find=t.keyBy=t.sprintf=t.NOTIFICATION_TYPES||(t.NOTIFICATION_TYPES={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getOptimizelyUserId",{enumerable:!0,get:function(){return n.getOptimizelyUserId}}),Object.defineProperty(t,"sanitizeVariant",{enumerable:!0,get:function(){return n.sanitizeVariant}}),Object.defineProperty(t,"sanitizeForcedVariant",{enumerable:!0,get:function(){return n.sanitizeForcedVariant}}),Object.defineProperty(t,"getForcedVariant",{enumerable:!0,get:function(){return n.getForcedVariant}}),Object.defineProperty(t,"getForcedRollout",{enumerable:!0,get:function(){return n.getForcedRollout}}),Object.defineProperty(t,"filterRunningExperiments",{enumerable:!0,get:function(){return n.filterRunningExperiments}}),Object.defineProperty(t,"getExperiments",{enumerable:!0,get:function(){return n.getExperiments}}),Object.defineProperty(t,"getExperimentDriver",{enumerable:!0,get:function(){return n.getExperimentDriver}}),Object.defineProperty(t,"getDriver",{enumerable:!0,get:function(){return n.getDriver}}),Object.defineProperty(t,"mapExperimentKeys",{enumerable:!0,get:function(){return n.mapExperimentKeys}}),Object.defineProperty(t,"mapFeatureKeys",{enumerable:!0,get:function(){return n.mapFeatureKeys}}),Object.defineProperty(t,"activateExperiment",{enumerable:!0,get:function(){return n.activateExperiment}}),Object.defineProperty(t,"activateExperiments",{enumerable:!0,get:function(){return n.activateExperiments}}),Object.defineProperty(t,"getVariation",{enumerable:!0,get:function(){return n.getVariation}}),Object.defineProperty(t,"getVariations",{enumerable:!0,get:function(){return n.getVariations}}),Object.defineProperty(t,"getRollouts",{enumerable:!0,get:function(){return n.getRollouts}}),Object.defineProperty(t,"getVariantVariables",{enumerable:!0,get:function(){return n.getVariantVariables}}),Object.defineProperty(t,"getFeatureFlagByExperimentId",{enumerable:!0,get:function(){return n.getFeatureFlagByExperimentId}}),Object.defineProperty(t,"getFeatureFlagsByExperimentId",{enumerable:!0,get:function(){return n.getFeatureFlagsByExperimentId}}),Object.defineProperty(t,"getForcedExperiments",{enumerable:!0,get:function(){return n.getForcedExperiments}}),Object.defineProperty(t,"COOKIE_NAME",{enumerable:!0,get:function(){return o.COOKIE_NAME}});var n=r(114),o=r(280)},function(e,t,r){var n=r(3),o=r(0),i=r(2).sprintf,a=r(57),s=r(251),u="PROJECT_CONFIG",c=o.ERROR_MESSAGES,l=o.LOG_MESSAGES,f=o.LOG_LEVEL,p=o.FEATURE_VARIABLE_TYPES;e.exports={createProjectConfig:function(e){var t,r=n.cloneDeep(e);return n.forEach(r.audiences,(),r.audiencesById=n.keyBy(r.audiences,"id"),n.assign(r.audiencesById,n.keyBy(r.typedAudiences,"id")),r.attributeKeyMap=n.keyBy(r.attributes,"key"),r.eventKeyMap=n.keyBy(r.events,"key"),r.groupIdMap=n.keyBy(r.groups,"id"),n.forEach(r.groupIdMap,(),r.rolloutIdMap=n.keyBy(r.rollouts||[],"id"),n.forOwn(r.rolloutIdMap,(),r.experimentKeyMap=n.keyBy(r.experiments,"key"),r.experimentIdMap=n.keyBy(r.experiments,"id"),r.variationIdMap={},r.variationVariableUsageMap={},n.forEach(r.experiments,(),r.experimentFeatureMap={},r.featureKeyMap=n.keyBy(r.featureFlags||[],"key"),n.forOwn(r.featureKeyMap,(function(e){e.variableKeyMap=n.keyBy(e.variables,"key"),n.forEach(e.experimentIds||[],()})),r},getExperimentId:function(e,t){var r=e.experimentKeyMap[t];if(n.isEmpty(r))throw new Error(i(c.INVALID_EXPERIMENT_KEY,u,t));return r.id},getLayerId:function(e,t){var r=e.experimentIdMap[t];if(n.isEmpty(r))throw new Error(i(c.INVALID_EXPERIMENT_ID,u,t));return r.layerId},getAttributeId:getEventId:getExperimentStatus:function(e,t){var r=e.experimentKeyMap[t];if(n.isEmpty(r))throw new Error(i(c.INVALID_EXPERIMENT_KEY,u,t));return r.status},isActive:function(t,r){return"Running"===e.exports.getExperimentStatus(t,r)},isRunning:getExperimentAudienceConditions:getVariationKeyFromId:getVariationIdFromExperimentAndVariationKey:getExperimentFromKey:getTrafficAllocation:getExperimentFromId:function(e,t,r){if(e.experimentIdMap.hasOwnProperty(t)){var n=e.experimentIdMap[t];if(n)return n}return r.log(f.ERROR,i(c.INVALID_EXPERIMENT_ID,u,t)),null},getFeatureFromKey:getVariableForFeature:getVariableValueForVariation:getTypeCastValue:getAudiencesById:function(e){return e.audiencesById},eventWithKeyExists:function(e,t){return e.eventKeyMap.hasOwnProperty(t)},isFeatureExperiment:tryCreatingProjectConfig:},function(e,t,r){var n=r(5).Symbol;e.exports=n},function(e,t,r){var n=r(149),o=r(150),i=r(151),a=r(152),s=r(153);function u(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=o,u.prototype.get=i,u.prototype.has=a,u.prototype.set=s,e.exports=u},function(e,t,r){var n=r(88),o=r(201)(n);e.exports=o},function(e,t,r){var n=r(142),o=r(46),i=r(47),a=i&&i.isTypedArray,s=a?o(a):n;e.exports=s},function(e,t,r){var n=r(7)(r(5),"Map");e.exports=n},function(e,t,r){var n=r(159),o=r(166),i=r(168),a=r(169),s=r(170);function u(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=o,u.prototype.get=i,u.prototype.has=a,u.prototype.set=s,e.exports=u},function(e,t,r){var n=r(12),o=r(6);e.exports=function(e){return"symbol"==typeof e||o(e)&&"[object Symbol]"==n(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(22);function o(e){return Object.keys(e).map((function(t){return e[t]}))}t.getTimestamp=function(){return(new Date).getTime()},t.generateUUID=function(){return n.v4()},t.isValidEnum=function(e,t){for(var r=!1,n=Object.keys(e),o=0;o<n.length;o++)if(t===e[n[o]]){r=!0;break}return r},t.groupBy=function(e,t){var r={};return e.forEach((function(e){var n=t(e);r[n]=r[n]||[],r[n].push(e)})),o(r)},t.objectValues=o,t.objectEntries=function(e){return Object.keys(e).map((function(t){return[t,e[t]]}))},t.find=function(e,t){for(var r,n=0,o=e;n<o.length;n++){var i=o[n];if(t(i)){r=i;break}}return r},t.keyBy=function(e,t){var r={};return e.forEach((function(e){var n=t(e);r[n]=e})),r},t.sprintf=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=0;return e.replace(/%s/g,(function(){var e=t[n++],r=typeof e;return"function"===r?e():"string"===r?e:String(e)}))},function(e){e.ACTIVATE="ACTIVATE:experiment, user_id,attributes, variation, event",e.DECISION="DECISION:type, userId, attributes, decisionInfo",e.LOG_EVENT="LOG_EVENT:logEvent",e.OPTIMIZELY_CONFIG_UPDATE="OPTIMIZELY_CONFIG_UPDATE",e.TRACK="TRACK:event_key, user_id, attributes, event_tags, event"}(t.NOTIFICATION_TYPES||(t.NOTIFICATION_TYPES={}))},function(e,t,r){var n=r(2).sprintf,o=r(96),i=r(3),a=r(0).ERROR_MESSAGES;e.exports={validate:isAttributeValid:},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_UPDATE_INTERVAL=3e5,t.MIN_UPDATE_INTERVAL=1e3,t.DEFAULT_URL_TEMPLATE="https://cdn.optimizely.com/datafiles/%s.json",t.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT=[0,8,16,32,64,128,256,512],t.REQUEST_TIMEOUT_MS=6e4},function(e,t,r){var n=r(78)(Object.getPrototypeOf,Object);e.exports=n},function(e,t,r){var n=r(86),o=r(51),i=r(10);e.exports=function(e){return n(e,i,o)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.areEventContextsEqual=,function(e,t,r){"use strict";var n=this&&this.__importDefault||Object.defineProperty(t,"__esModule",{value:!0});var o=r(98),i=r(238),a=r(4),s=r(58),u=n(r(239)),c=a.getLogger("EventProcessor"),l=function(){function e(e){var t=e.dispatcher,r=e.flushInterval,n=void 0===r?3e4:r,a=e.maxQueueSize,s=void 0===a?3e3:a,l=e.notificationCenter,f=this;this.dispatcher=t,n<=0&&(c.warn("Invalid flushInterval "+n+", defaulting to 30000"),n=3e4),(s=Math.floor(s))<1&&(c.warn("Invalid maxQueueSize "+s+", defaulting to 10"),s=10),s=Math.max(1,s),this.queue=s>1?new i.DefaultEventQueue({flushInterval:n,maxQueueSize:s,sink:function(e){return f.drainQueue(e)},batchComparator:o.areEventContextsEqual}):new i.SingleEventQueue({sink:function(e){return f.drainQueue(e)}}),this.notificationCenter=l,this.requestTracker=new u.default}return e.prototype.drainQueue=function(e){var t=this,r=new Promise((function(r){if(c.debug("draining queue with %s events",e.length),0!==e.length){var n=t.formatEvents(e);t.dispatcher.dispatchEvent(n,(),t.notificationCenter&&t.notificationCenter.sendNotifications(s.NOTIFICATION_TYPES.LOG_EVENT,n)}else r()}));return this.requestTracker.trackRequest(r),r},e.prototype.process=function(e){this.queue.enqueue(e)},e.prototype.stop=e.prototype.start=e}();t.AbstractEventProcessor=l},function(e,t,r){"use strict";var n=this&&this.__assign||Object.defineProperty(t,"__esModule",{value:!0});unction i(e){var t=e.layer,r=e.experiment,n=e.variation,o=t?t.id:null;return{decisions:[{campaign_id:o,experiment_id:r?r.id:null,variation_id:n?n.id:null}],events:[{entity_id:o,timestamp:e.timestamp,key:"campaign_activated",uuid:e.uuid}]}}.makeBatchedEventV1=t.buildImpressionEventV1=function(e){var t=a(e);return t.snapshots.push(i(e)),{client_name:e.context.clientName,client_version:e.context.clientVersion,account_id:e.context.accountId,project_id:e.context.projectId,revision:e.context.revision,anonymize_ip:e.context.anonymizeIP,enrich_decisions:!0,visitors:[t]}},t.buildConversionEventV1=,function(e,t,r){"use strict";function n(e){var t=e.variationKey,r=e.dotcomNav.opts.appInfo.viewChannel;if(t&&("homepage"===r||"cart"===r||"test"===r)){var n=document.getElementsByClassName("pre-l-header-container")[0],o=document.querySelectorAll('[data-search-input="standard"]')[0],i=document.querySelectorAll('[data-search-input="extended"]')[0];switch(t){case"CONTROL":null==n||n.classList.remove("mobile-header-exposed-search-enabled");break;case"VARIANT_1":null==n||n.classList.add("mobile-header-exposed-search-enabled"),null==i||i.remove();break;case"VARIANT_2":null==n||n.classList.add("mobile-header-exposed-search-enabled"),null==i||i.classList.remove("hide-search-input"),null==o||o.remove()}}}r.r(t),r.d(t,"default",(function(){return n}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVariantVariables=t.getFeatureVariable=t.getFeatureVariableObject=t.getFeatureFlagByExperimentId=t.getFeatureFlagsByExperimentId=t.getDriver=t.getExperimentDriver=t.filterRunningExperiments=t.activateExperiments=t.getRollouts=t.getVariations=t.activateExperiment=t.getVariation=t.getForcedRollout=t.sanitizeRollout=t.getForcedVariant=t.getForced=t.getForcedExperiments=t.sanitizeForcedVariant=t.sanitizeVariant=t.getExperiment=t.getExperiments=t.mapFeatureKeys=t.mapExperimentKeys=t.getOptimizelyUserId=t.ACTIVE_ROLLOUT_KEY=void 0;var n=s(r(115)),o=r(267),i=s(r(282)),a=s(r(268));VE_ROLLOUT_KEY="1";var d=function(e){return new i.default(o.canUseDOM?void 0:e).get("anonymousId")};t.getOptimizelyUserId=d;var y=function(e){return e.key};t.mapExperimentKeys=y;var g=y;t.mapFeatureKeys=g;var v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=[];try{return r=f(e.experiments),e.groups.forEach((),t?r.filter(t):r}catch(e){return r}};t.getExperiments=v;var h=t.getExperiment=h;var E=function(e,t,r){if(e&&r&&r.projectConfigManager.getConfig()){var n=function(){for(var e=v(r.projectConfigManager.getConfig()),n=0;n<e.length;n+=1)if(e[n].key===t)return e[n]}();if(!n)return;var o=n.variations.map(();return o.indexOf(e.toUpperCase())>-1?o[o.indexOf(e.toUpperCase())]:void 0}};t.sanitizeVariant=E;var _=E;t.sanitizeForcedVariant=_;var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"opxp",t=o.canUseDOM&&a.default.parse(document.location.search,{allowDots:!0,ignoreQueryPrefix:!0});return t&&t[e]||{}};t.getForcedExperiments=m;var I=function(e,t,r,n,o){var i=m(n),a=t&&t[n]&&t[n][e]||i[e];return r?o(a,e,r):a};t.getForced=I;var O=t.getForcedVariant=O;var b=function(e,t){return t.projectConfigManager.getConfig().featureFlags.map(g).find(()?e:void 0};t.sanitizeRollout=b;var R=function(e,t,r){var n=I(e,t,void 0,"oprp");return r?b(e,r)&&n:n};t.getForcedRollout=R;var T=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d(),n=arguments.length>3?arguments[3]:void 0,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:O,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=i&&"function"==typeof i&&i(t,void 0,a&&e);if(s)return e.setForcedVariation(t,r,s),s;var u="function"==typeof o?o(e,t,r,n,o,i,a):o;return e[u?"activate":"getVariation"](t,r,n)};t.getVariation=T;t.activateExperiment=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d(),n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:O,i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return T(e,t,r,n,!0,o,i)};var A=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:O,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s={};return t.forEach((function(t){s[t]=T(e,t,r,n,o,i,a)})),s};t.getVariations=A;t.getRollouts=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i={};return e.projectConfigManager.getConfig().featureFlags.map(g).forEach((function(a){var s=e.isFeatureEnabled(a,t,r);(n(a,o&&e)||s)&&(i[a]="1")})),i};t.activateExperiments=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:O,i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return A(e,t,r,n,!0,o,i)};t.filterRunningExperiments=var N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.default.createInstance(c({datafile:e,skipJSONValidation:!0},t))};t.getExperimentDriver=N;var S=N;t.getDriver=S;var x=t.getFeatureFlagsByExperimentId=x;var P=t.getFeatureFlagByExperimentId=P;var L=function(e,t){for(var r=0;r<e.featureFlags.length;r+=1){var n=e.featureFlags[r].variables.find(t);if(n)return n}};t.getFeatureVariableObject=L;var U=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d(),o=arguments.length>4?arguments[4]:void 0,i=L(e.projectConfigManager.getConfig(),(function(e){return e.key===r})),a=i.type;return function(){switch(a){case"integer":return e.getFeatureVariableInteger(t,r,n,o)||null;case"double":return e.getFeatureVariableDouble(t,r,n,o)||null;case"boolean":return null===e.getFeatureVariableBoolean(t,r,n,o)?null:e.getFeatureVariableBoolean(t,r,n,o);case"string":default:return e.getFeatureVariableString(t,r,n,o)||null}}()};t.getFeatureVariable=U;t.getVariantVariables=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o={},i=e.projectConfigManager.getConfig();return t.map(().filter(Boolean).forEach((function(t){o[t.key]={},t.variations.forEach((function(a){a.variables&&a.variables.forEach((function(a){var s=L(e.projectConfigManager.getConfig(),().key,u=P(i,t.id);u&&(o[t.key][s]=U(e,u.key,s,r,n))}))}))})),o}},function(e,t,r){r(116);var n=r(4),o=r(3),i=r(57),a=r(236),s=r(237),u=r(0),c=r(97),l=r(243),f=r(244),p=r(266),d=n.getLogger();n.setLogHandler(l.createLogger()),n.setLogLevel(n.LogLevel.INFO);var y=!1;e.exports={logging:l,errorHandler:a,eventDispatcher:s,enums:u,setLogger:n.setLogHandler,setLogLevel:n.setLogLevel,createInstance:function(e){try{(e=e||{}).errorHandler&&n.setErrorHandler(e.errorHandler),e.logger&&(n.setLogHandler(e.logger),n.setLogLevel(n.LogLevel.NOTSET)),void 0!==e.logLevel&&n.setLogLevel(e.logLevel);try{i.validate(e),e.isValidInstance=!0}catch(t){d.error(t),e.isValidInstance=!1}var t;null==e.skipJSONValidation&&(e.skipJSONValidation=!0),null==e.eventDispatcher?(t=new c.LocalStoragePendingEventsDispatcher({eventDispatcher:s}),y||(t.sendPendingEvents(),y=!0)):t=e.eventDispatcher,e=o.assignIn({clientEngine:u.JAVASCRIPT_CLIENT_ENGINE,eventBatchSize:10,eventFlushInterval:1e3},e,{eventDispatcher:t,logger:d,errorHandler:n.getErrorHandler()}),p.validateEventBatchSize(e.eventBatchSize)||(d.warn("Invalid eventBatchSize %s, defaulting to %s",e.eventBatchSize,10),e.eventBatchSize=10),p.validateEventFlushInterval(e.eventFlushInterval)||(d.warn("Invalid eventFlushInterval %s, defaulting to %s",e.eventFlushInterval,1e3),e.eventFlushInterval=1e3);var r=new f(e);try{if("function"==typeof window.addEventListener){var a="onpagehide"in window?"pagehide":"unload";window.addEventListener(a,(,!1)}}catch(e){d.error(u.LOG_MESSAGES.UNABLE_TO_ATTACH_UNLOAD,"INDEX_BROWSER",e.message)}return r}catch(e){return d.error(e),null}},__internalResetRetryState:function(){y=!1}}},function(e,t,r){(function(e,t){(function(){"use strict";ar n=setTimeout;function o(){}type.catch=i.prototype.then=i.prototype.finally=r,i.all=i.resolve=i.reject=i.race=i._immediateFn="function"==typeof e&&|i._unhandledRejectionFn=var p=);"Promise"in p?p.Promise.prototype.finally||(p.Promise.prototype.finally=r):p.Promise=i})()}).call(this,r(117).setImmediate,r(21))},function(e,t,r){var n=r(12),o=r(6);e.exports=function(e){return o(e)&&"[object Arguments]"==n(e)}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,r){var n=r(30);e.exports=function(e){return n(this,e).get(e)}},function(e,t,r){var n=r(13),o=r(10);e.exports=function(e,t){return e&&n(t,o(t),e)}},function(e,t,r){var n=r(13),o=r(51);e.exports=function(e,t){return n(e,o(e),t)}},function(e,t,r){var n=r(7)(r(5),"DataView");e.exports=n},function(e,t,r){var n=r(7)(r(5),"Promise");e.exports=n},function(e,t,r){var n=r(7)(r(5),"Set");e.exports=n},function(e,t,r){var n=r(52);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},function(e,t,r){var n=r(191),o=r(46),i=r(47),a=i&&i.isMap,s=a?o(a):n;e.exports=s},function(e,t,r){var n=r(20),o=r(6);e.exports=function(e){return o(e)&&"[object Map]"==n(e)}},function(e,t,r){var n=r(80),o=r(229),i=r(53),a=r(1);e.exports=function(e,t){return(a(e)?n:o)(e,i(t,3))}},function(e,t){e.exports={handleError:function(){}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4).getLogger("EventProcessor"),o=),i=);t.SingleEventQueue=i;var a=);t.DefaultEventQueue=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(58),o=r(4).getLogger("EventProcessor"),i=);t.LocalStorageStore=i},function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=;Object.defineProperty(t,"__esModule",{value:!0});var i=r(99),a=r(100),s=function(e){eturn o(t,e),t.prototype.formatEvents=t}(i.AbstractEventProcessor);t.LogTierV1EventProcessor=s},function(e,t,r){var n=r(3),o=r(59),i=r(245),a=r(0),s=r(252),u=r(253),c=r(97),l=r(254),f=r(255),p=r(14),d=r(2).sprintf,y=r(256),g=r(101),v=r(257),h=a.ERROR_MESSAGES,E=a.LOG_LEVEL,_=a.LOG_MESSAGES,m=a.DECISION_SOURCES,I=a.FEATURE_VARIABLE_TYPES,O=a.DECISION_NOTIFICATION_TYPES,b=a.NOTIFICATION_TYPES;function R(e){var t=e.clientEngine;-1===a.VALID_CLIENT_ENGINES.indexOf(t)&&(e.logger.log(E.INFO,d(_.INVALID_CLIENT_ENGINE,"OPTIMIZELY",t)),t=a.NODE_CLIENT_ENGINE),this.clientEngine=t,this.clientVersion=e.clientVersion||a.NODE_CLIENT_VERSION,this.errorHandler=e.errorHandler,this.eventDispatcher=e.eventDispatcher,this.__isOptimizelyConfigValid=e.isValidInstance,this.logger=e.logger,this.projectConfigManager=new v.ProjectConfigManager({datafile:e.datafile,datafileOptions:e.datafileOptions,jsonSchemaValidator:e.jsonSchemaValidator,sdkKey:e.sdkKey,skipJSONValidation:e.skipJSONValidation}),this.__disposeOnUpdate=this.projectConfigManager.onUpdate(function(e){this.logger.log(E.INFO,d(_.UPDATED_OPTIMIZELY_CONFIG,"OPTIMIZELY",e.revision,e.projectId)),this.notificationCenter.sendNotifications(b.OPTIMIZELY_CONFIG_UPDATE)}.bind(this)),this.__readyPromise=this.projectConfigManager.onReady();var r=null;if(e.userProfileService)try{y.validate(e.userProfileService)&&(r=e.userProfileService,this.logger.log(E.INFO,d(_.VALID_USER_PROFILE_SERVICE,"OPTIMIZELY")))}catch(e){this.logger.log(E.WARNING,e.message)}this.decisionService=i.createDecisionService({userProfileService:r,logger:this.logger,UNSTABLE_conditionEvaluators:e.UNSTABLE_conditionEvaluators}),this.notificationCenter=f.createNotificationCenter({logger:this.logger,errorHandler:this.errorHandler}),this.eventProcessor=new c.LogTierV1EventProcessor({dispatcher:this.eventDispatcher,flushInterval:e.eventFlushInterval,maxQueueSize:e.eventBatchSize,notificationCenter:this.notificationCenter}),this.eventProcessor.start(),this.__readyTimeouts={},this.__nextReadyTimeoutId=0}R.prototype.__isValidInstance=R.prototype.activate=function(e,t,r){try{if(!this.__isValidInstance())return this.logger.log(E.ERROR,d(_.INVALID_OBJECT,"OPTIMIZELY","activate")),null;if(!this.__validateInputs({experiment_key:e,user_id:t},r))return this.__notActivatingExperiment(e,t);var n=this.projectConfigManager.getConfig();if(!n)return null;try{var o=this.getVariation(e,t,r);if(null===o)return this.__notActivatingExperiment(e,t);if(!p.isRunning(n,e)){var i=d(_.SHOULD_NOT_DISPATCH_ACTIVATE,"OPTIMIZELY",e);return this.logger.log(E.DEBUG,i),o}return this._sendImpressionEvent(e,o,t,r),o}catch(r){this.logger.log(E.ERROR,r.message);var a=d(_.NOT_ACTIVATING_USER,"OPTIMIZELY",t,e);return this.logger.log(E.INFO,a),this.errorHandler.handleError(r),null}}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),null}},R.prototype._sendImpressionEvent=R.prototype.__emitNotificationCenterActivate=R.prototype.track=function(e,t,r,n){try{if(!this.__isValidInstance())return void this.logger.log(E.ERROR,d(_.INVALID_OBJECT,"OPTIMIZELY","track"));if(!this.__validateInputs({user_id:t,event_key:e},r,n))return;var o=this.projectConfigManager.getConfig();if(!o)return;if(!p.eventWithKeyExists(o,e))throw new Error(d(h.INVALID_EVENT_KEY,"OPTIMIZELY",e));n=this.__filterEmptyValues(n);var i=u.buildConversionEvent({eventKey:e,eventTags:n,userId:t,userAttributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:o});this.logger.log(E.INFO,d(a.LOG_MESSAGES.TRACK_EVENT,"OPTIMIZELY",e,t)),this.eventProcessor.process(i),this.__emitNotificationCenterTrack(e,t,r,n)}catch(e){this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e);var s=d(_.NOT_TRACKING_USER,"OPTIMIZELY",t);this.logger.log(E.INFO,s)}},R.prototype.__emitNotificationCenterTrack=R.prototype.getVariation=function(e,t,r){try{if(!this.__isValidInstance())return this.logger.log(E.ERROR,d(_.INVALID_OBJECT,"OPTIMIZELY","getVariation")),null;try{if(!this.__validateInputs({experiment_key:e,user_id:t},r))return null;var o=this.projectConfigManager.getConfig();if(!o)return null;var i=o.experimentKeyMap[e];if(n.isEmpty(i))return this.logger.log(E.DEBUG,d(h.INVALID_EXPERIMENT_KEY,"OPTIMIZELY",e)),null;var a=this.decisionService.getVariation(o,e,t,r),s=p.isFeatureExperiment(o,i.id)?O.FEATURE_TEST:O.AB_TEST;return this.notificationCenter.sendNotifications(b.DECISION,{type:s,userId:t,attributes:r||{},decisionInfo:{experimentKey:e,variationKey:a}}),a}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),null}}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),null}},R.prototype.setForcedVariation=R.prototype.getForcedVariation=R.prototype.__validateInputs=function(e,t,r){try{if(e.hasOwnProperty("user_id")){var n=e.user_id;if("string"!=typeof n||null===n||"undefined"===n)throw new Error(d(h.INVALID_INPUT_FORMAT,"OPTIMIZELY","user_id"));delete e.user_id}for(var i=Object.keys(e),a=0;a<i.length;a++){var s=i[a];if(!g.validate(e[s]))throw new Error(d(h.INVALID_INPUT_FORMAT,"OPTIMIZELY",s))}return t&&o.validate(t),r&&l.validate(r),!0}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),!1}},R.prototype.__notActivatingExperiment=function(e,t){var r=d(_.NOT_ACTIVATING_USER,"OPTIMIZELY",t,e);return this.logger.log(E.INFO,r),null},R.prototype.__filterEmptyValues=R.prototype.isFeatureEnabled=function(e,t,r){try{if(!this.__isValidInstance())return this.logger.log(E.ERROR,d(_.INVALID_OBJECT,"OPTIMIZELY","isFeatureEnabled")),!1;if(!this.__validateInputs({feature_key:e,user_id:t},r))return!1;var n=this.projectConfigManager.getConfig();if(!n)return!1;var o=p.getFeatureFromKey(n,e,this.logger);if(!o)return!1;var i=!1,a=this.decisionService.getVariationForFeature(n,o,t,r),s=a.variation,u={};s&&(i=s.featureEnabled,a.decisionSource===m.FEATURE_TEST&&(u={experimentKey:a.experiment.key,variationKey:a.variation.key},this._sendImpressionEvent(a.experiment.key,a.variation.key,t,r))),!0===i?this.logger.log(E.INFO,d(_.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",e,t)):(this.logger.log(E.INFO,d(_.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",e,t)),i=!1);var c={featureKey:e,featureEnabled:i,source:a.decisionSource,sourceInfo:u};return this.notificationCenter.sendNotifications(b.DECISION,{type:O.FEATURE,userId:t,attributes:r||{},decisionInfo:c}),i}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),!1}},R.prototype.getEnabledFeatures=function(e,t){try{var r=[];if(!this.__isValidInstance())return this.logger.log(E.ERROR,d(_.INVALID_OBJECT,"OPTIMIZELY","getEnabledFeatures")),r;if(!this.__validateInputs({user_id:e}))return r;var o=this.projectConfigManager.getConfig();return o?(n.forOwn(o.featureKeyMap,bind(this)),r):r}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),[]}},R.prototype.getFeatureVariable=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,null,r,n)}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),null}},R.prototype._getFeatureVariableForType=function(e,t,r,n,o){if(!this.__isValidInstance()){var i=r?"getFeatureVariable"+r.charAt(0).toUpperCase()+r.slice(1):"getFeatureVariable";return this.logger.log(E.ERROR,d(_.INVALID_OBJECT,"OPTIMIZELY",i)),null}if(!this.__validateInputs({feature_key:e,variable_key:t,user_id:n},o))return null;var a=this.projectConfigManager.getConfig();if(!a)return null;var s=p.getFeatureFromKey(a,e,this.logger);if(!s)return null;var u=p.getVariableForFeature(a,e,t,this.logger);if(!u)return null;if(r){if(u.type!==r)return this.logger.log(E.WARNING,d(_.VARIABLE_REQUESTED_WITH_WRONG_TYPE,"OPTIMIZELY",r,u.type)),null}else r=u.type;var c=!1,l=u.defaultValue,f=this.decisionService.getVariationForFeature(a,s,n,o);if(null!==f.variation){c=f.variation.featureEnabled;var y=p.getVariableValueForVariation(a,u,f.variation,this.logger);null!==y?!0===c?(l=y,this.logger.log(E.INFO,d(_.USER_RECEIVED_VARIABLE_VALUE,"OPTIMIZELY",t,s.key,l,n))):this.logger.log(E.INFO,d(_.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",s.key,n,t)):this.logger.log(E.INFO,d(_.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",t,f.variation.key))}else this.logger.log(E.INFO,d(_.USER_RECEIVED_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",n,t,s.key));var g={};f.decisionSource===m.FEATURE_TEST&&(g={experimentKey:f.experiment.key,variationKey:f.variation.key});var v=p.getTypeCastValue(l,r,this.logger);return this.notificationCenter.sendNotifications(b.DECISION,{type:O.FEATURE_VARIABLE,userId:n,attributes:o||{},decisionInfo:{featureKey:e,featureEnabled:c,source:f.decisionSource,variableKey:t,variableValue:v,variableType:r,sourceInfo:g}}),v},R.prototype.getFeatureVariableBoolean=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,I.BOOLEAN,r,n)}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),null}},R.prototype.getFeatureVariableDouble=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,I.DOUBLE,r,n)}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),null}},R.prototype.getFeatureVariableInteger=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,I.INTEGER,r,n)}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),null}},R.prototype.getFeatureVariableString=R.prototype.getOptimizelyConfig=R.prototype.close=function(){try{var e=this.eventProcessor.stop();return this.__disposeOnUpdate&&(this.__disposeOnUpdate(),this.__disposeOnUpdate=null),this.projectConfigManager&&this.projectConfigManager.stop(),Object.keys(this.__readyTimeouts).forEach(bind(this)),this.__readyTimeouts={},e.then((,()}catch(e){return this.logger.log(E.ERROR,e.message),this.errorHandler.handleError(e),Promise.resolve({success:!1,reason:String(e)})}},R.prototype.onReady=function(e){var t,r;"object"==typeof e&&null!==e&&(t=e.timeout),n.isFinite(t)||(t=3e4);var o=new Promise((),i=this.__nextReadyTimeoutId;this.__nextReadyTimeoutId++;var a=bind(this),s=setTimeout(a,t);return this.__readyTimeouts[i]={readyTimeout:s,onClose:,this.__readyPromise.then(bind(this)),Promise.race([this.__readyPromise,o])},e.exports=R},function(e,t,r){var n=r(246),o=r(249),i=r(0),a=r(3),s=r(14),u=r(101),c=r(2).sprintf,l="DECISION_SERVICE",f=i.ERROR_MESSAGES,p=i.LOG_LEVEL,d=i.LOG_MESSAGES,y=i.DECISION_SOURCES;.prototype.getVariation=function(e,t,r,n){var i=this._getBucketingId(r,n);if(!this.__checkIfExperimentIsActive(e,t))return null;var a=e.experimentKeyMap[t],s=this.getForcedVariation(e,t,r);if(s)return s;var u=this.__getWhitelistedVariation(a,r);if(u)return u.key;var f=this.__resolveExperimentBucketMap(r,n);if(u=this.__getStoredVariation(e,a,r,f))return this.logger.log(p.INFO,c(d.RETURNING_STORED_VARIATION,l,u.key,t,r)),u.key;if(!this.__checkIfUserIsInAudience(e,t,r,n))return null;var y=this.__buildBucketerParams(e,t,i,r),g=o.bucket(y);return(u=e.variationIdMap[g])?(this.__saveUserProfile(a,u,r,f),u.key):null},g.prototype.__resolveExperimentBucketMap=g.prototype.__checkIfExperimentIsActive=function(e,t){if(!s.isActive(e,t)){var r=c(d.EXPERIMENT_NOT_RUNNING,l,t);return this.logger.log(p.INFO,r),!1}return!0},g.prototype.__getWhitelistedVariation=g.prototype.__checkIfUserIsInAudience=function(e,t,r,n){var o=s.getExperimentAudienceConditions(e,t),i=s.getAudiencesById(e);this.logger.log(p.DEBUG,c(d.EVALUATING_AUDIENCES_COMBINED,l,t,JSON.stringify(o)));var a=this.audienceEvaluator.evaluate(o,i,n);if(this.logger.log(p.INFO,c(d.AUDIENCE_EVALUATION_RESULT_COMBINED,l,t,a.toString().toUpperCase())),!a){var u=c(d.USER_NOT_IN_EXPERIMENT,l,r,t);return this.logger.log(p.INFO,u),!1}return!0},g.prototype.__buildBucketerParams=g.prototype.__getStoredVariation=g.prototype.__getUserProfile=g.prototype.__saveUserProfile=g.prototype.getVariationForFeature=g.prototype._getVariationForFeatureExperiment=g.prototype._getExperimentInGroup=function(e,t,r){var n=o.bucketUserIntoExperiment(t,r,r,this.logger);if(n){this.logger.log(p.INFO,c(d.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,l,r,n,t.id));var i=s.getExperimentFromId(e,n,this.logger);if(i)return i}return this.logger.log(p.INFO,c(d.USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP,l,r,t.id)),null},g.prototype._getVariationForRollout=g.prototype._getBucketingId=g.prototype.removeForcedVariation=g.prototype.__setInForcedVariationMap=function(e,t,r){this.forcedVariationMap.hasOwnProperty(e)||(this.forcedVariationMap[e]={}),this.forcedVariationMap[e][t]=r,this.logger.log(p.DEBUG,c(d.USER_MAPPED_TO_FORCED_VARIATION,l,r,t,e))},g.prototype.getForcedVariation=g.prototype.setForcedVariation=e.exports={createDecisionService:},function(e,t,r){var n=r(247),o=r(248),i=r(0),a=r(3),s=r(2).sprintf,u=r(4).getLogger(),c=i.ERROR_MESSAGES,l=i.LOG_LEVEL,f=i.LOG_MESSAGES,p="AUDIENCE_EVALUATOR";.prototype.evaluate=function(e,t,r){if(!e||0===e.length)return!0;r||(r={});var o=function(e){var o=t[e];if(o){u.log(l.DEBUG,s(f.EVALUATING_AUDIENCE,p,e,JSON.stringify(o.conditions)));var i=n.evaluate(o.conditions,this.evaluateConditionWithUserAttributes.bind(this,r)),a=null===i?"UNKNOWN":i.toString().toUpperCase();return u.log(l.INFO,s(f.AUDIENCE_EVALUATION_RESULT,p,e,a)),i}return null}.bind(this);return n.evaluate(e,o)||!1},d.prototype.evaluateConditionWithUserAttributes=function(e,t){var r=this.typeToEvaluatorMap[t.type];if(!r)return u.log(l.WARNING,s(f.UNKNOWN_CONDITION_TYPE,p,JSON.stringify(t))),null;try{return r.evaluate(t,e,u)}catch(e){u.log(l.ERROR,s(c.CONDITION_EVALUATOR_ERROR,p,t.type,e.message))}return null},e.exports=d},function(e,t){var r=["and","or","not"];function n(e,t){if(Array.isArray(e)){var o=e[0],i=e.slice(1);switch(-1===r.indexOf(o)&&(o="or",i=e),o){case"and":return i,t);case"not":return i,t);default:return i,t)}}return t(e)}e.exports={evaluate:n}},function(e,t,r){var n=r(3),o=r(0),i=r(2).sprintf,a=o.LOG_LEVEL,s=o.LOG_MESSAGES,u="CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",c=["exact","exists","gt","lt","substring"],l={};exact=p,l.exists=l.gt=l.lt=l.substring=function(e,t,r){var n=e.name,o=t[e.name],c=typeof o,l=e.value;if("string"!=typeof l)return r.log(a.WARNING,i(s.UNEXPECTED_CONDITION_VALUE,u,JSON.stringify(e))),null;if(null===o)return r.log(a.DEBUG,i(s.UNEXPECTED_TYPE_NULL,u,JSON.stringify(e),n)),null;if("string"!=typeof o)return r.log(a.WARNING,i(s.UNEXPECTED_TYPE,u,JSON.stringify(e),c,n)),null;return-1!==o.indexOf(l)},e.exports={evaluate:function(e,t,r){var n=e.match;if(void 0!==n&&-1===c.indexOf(n))return r.log(a.WARNING,i(s.UNKNOWN_MATCH_TYPE,u,JSON.stringify(e))),null;var o=e.name;return t.hasOwnProperty(o)||"exists"==n?(l[n]||p)(e,t,r):(r.log(a.DEBUG,i(s.MISSING_ATTRIBUTE_VALUE,u,JSON.stringify(e),o)),null)}}},function(e,t,r){var n=r(0),o=r(250),i=r(2).sprintf,a=n.ERROR_MESSAGES,s=n.LOG_LEVEL,u=n.LOG_MESSAGES,c=Math.pow(2,32);e.exports={bucket:function(t){var r=t.experimentKeyMap[t.experimentKey].groupId;if(r){var n=t.groupIdMap[r];if(!n)throw new Error(i(a.INVALID_GROUP_ID,"BUCKETER",r));if("random"===n.policy){var o=e.exports.bucketUserIntoExperiment(n,t.bucketingId,t.userId,t.logger);if(null===o){var c=i(u.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",t.userId,r);return t.logger.log(s.INFO,c),null}if(o!==t.experimentId){var l=i(u.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r);return t.logger.log(s.INFO,l),null}var f=i(u.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r);t.logger.log(s.INFO,f)}}var p=i("%s%s",t.bucketingId,t.experimentId),d=e.exports._generateBucketValue(p),y=i(u.USER_ASSIGNED_TO_VARIATION_BUCKET,"BUCKETER",d,t.userId);t.logger.log(s.DEBUG,y);var g=e.exports._findBucket(d,t.trafficAllocationConfig);if(g){if(!t.variationIdMap.hasOwnProperty(g)){var v=i(u.INVALID_VARIATION_ID,"BUCKETER");return t.logger.log(s.WARNING,v),null}var h=t.variationIdMap[g].key,E=i(u.USER_HAS_VARIATION,"BUCKETER",t.userId,h,t.experimentKey);t.logger.log(s.INFO,E)}else{var _=i(u.USER_HAS_NO_VARIATION,"BUCKETER",t.userId,t.experimentKey);t.logger.log(s.DEBUG,_)}return g},bucketUserIntoExperiment:_findBucket:_generateBucketValue:},function(e,t,r){var n=r(0),o=r(3),i=r(102),a=r(14),s=r(59),u="https://logx.optimizely.com/v1/events";function c(e){var t=e.attributes,r=e.configObj,i=r.anonymizeIP,u=r.botFiltering;null==i&&(i=!1);var c={snapshots:[],visitor_id:e.userId,attributes:[]},l={account_id:r.accountId,project_id:r.projectId,visitors:[c],revision:r.revision,client_name:e.clientEngine,client_version:e.clientVersion,anonymize_ip:i,enrich_decisions:!0};return o.forOwn(t,(function(r,n){if(s.isAttributeValid(n,r)){var o=a.getAttributeId(e.configObj,n,e.logger);o&&l.visitors[0].attributes.push({entity_id:o,key:n,type:"custom",value:t[n]})}})),"boolean"==typeof u&&l.visitors[0].attributes.push({entity_id:n.CONTROL_ATTRIBUTES.BOT_FILTERING,key:n.CONTROL_ATTRIBUTES.BOT_FILTERING,type:"custom",value:u}),l}e.exports={getImpressionEvent:function(e){var t={httpVerb:"POST"},r=c(e);t.url=u;var n,i,s,l=(n=e.configObj,i=e.experimentId,s=e.variationId,{decisions:[{campaign_id:a.getLayerId(n,i),experiment_id:i,variation_id:s}],events:[{entity_id:a.getLayerId(n,i),timestamp:o.currentTimestamp(),key:"campaign_activated",uuid:o.uuid()}]});return r.visitors[0].snapshots.push(l),t.params=r,t},getConversionEvent:function(e){var t={httpVerb:"POST"},r=c(e);t.url=u;var s=e.configObj,e.eventKey,e.eventTags,e.logger);return r.visitors[0].snapshots=[s],t.params=r,t}}},function(e,t,r){var n=r(3),o=r(2).sprintf,i=r(4),a=r(57),s=r(258),u=r(0),c=r(14),l=r(265),f=i.getLogger(),p=u.ERROR_MESSAGES;prototype.__initialize=function(e){if(this.__updateListeners=[],this.jsonSchemaValidator=e.jsonSchemaValidator,this.skipJSONValidation=e.skipJSONValidation,!e.datafile&&!e.sdkKey){this.__configObj=null;var t=new Error(o(p.DATAFILE_AND_SDK_KEY_MISSING,"PROJECT_CONFIG_MANAGER"));return this.__readyPromise=Promise.resolve({success:!1,reason:d(t)}),void f.error(t)}var r,i=this.__getDatafileFromConfig(e);if(i)try{this.__configObj=c.tryCreatingProjectConfig({datafile:i,jsonSchemaValidator:this.jsonSchemaValidator,logger:f,skipJSONValidation:this.skipJSONValidation}),this.__optimizelyConfigObj=l.getOptimizelyConfig(this.__configObj)}catch(e){f.error(e),r=e,this.__configObj=null}else this.__configObj=null;if(e.sdkKey){var a={sdkKey:e.sdkKey};this.__validateDatafileOptions(e.datafileOptions)&&n.assign(a,e.datafileOptions),i&&this.__configObj&&(a.datafile=i),this.datafileManager=new s.HttpPollingDatafileManager(a),this.datafileManager.start(),this.__readyPromise=this.datafileManager.onReady().then(this.__onDatafileManagerReadyFulfill.bind(this),this.__onDatafileManagerReadyReject.bind(this)),this.datafileManager.on("update",this.__onDatafileManagerUpdate.bind(this))}else this.__configObj?this.__readyPromise=Promise.resolve({success:!0}):this.__readyPromise=Promise.resolve({success:!1,reason:d(r,"Invalid datafile")})},y.prototype.__onDatafileManagerReadyFulfill=y.prototype.__onDatafileManagerReadyReject=y.prototype.__onDatafileManagerUpdate=y.prototype.__getDatafileFromConfig=function(e){var t=null;try{e.datafile&&(a.validateDatafile(e.datafile),t="string"==typeof e.datafile||e.datafile instanceof String?JSON.parse(e.datafile):e.datafile)}catch(e){f.error(e)}return t},y.prototype.__validateDatafileOptions=y.prototype.__handleNewConfigObj=function(e){var t=this.__configObj;(t?t.revision:"null")!==e.revision&&(this.__configObj=e,this.__optimizelyConfigObj=l.getOptimizelyConfig(e),this.__updateListeners.forEach((function(t){t(e)})))},y.prototype.getConfig=function(){return this.__configObj},y.prototype.getOptimizelyConfig=function(){return this.__optimizelyConfigObj},y.prototype.onReady=function(){return this.__readyPromise},y.prototype.onUpdate=y.prototype.stop=e.exports={ProjectConfigManager:y}},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),a=r(68),s=o(r(262)),u=r(60),c=o(r(263)),l=i.getLogger("DatafileManager");ar p=function(){eturn e.prototype.get=function(){return this.currentDatafile},e.prototype.start=e.prototype.stop=e.prototype.onReady=function(){return this.readyPromise},e.prototype.on=e.prototype.onRequestRejected=e.prototype.onRequestResolved=function(e){if(this.isStarted){void 0!==e.statusCode&&f(e.statusCode)?this.backoffController.reset():this.backoffController.countError(),this.trySavingLastModified(e.headers);var t=this.getNextDatafileFromResponse(e);if(null!==t)if(l.info("Updating datafile from response"),this.currentDatafile=t,this.isReadyPromiseSettled){var r={datafile:t};this.emitter.emit("update",r)}else this.resolveReadyPromise()}},e.prototype.onRequestComplete=e.prototype.syncDatafile=e.prototype.resolveReadyPromise=e.prototype.rejectReadyPromise=e.prototype.scheduleNextUpdate=e.prototype.getNextDatafileFromResponse=function(e){return l.debug("Response status code: %s",e.statusCode),void 0===e.statusCode||304===e.statusCode?null:f(e.statusCode)?this.tryParsingBodyAsJSON(e.body):null},e.prototype.tryParsingBodyAsJSON=function(e){var t;try{t=JSON.parse(e)}catch(e){return l.error("Error parsing response body: %s",e.message,e),null}var r=null;return"object"==typeof t&&null!==t?r=t:l.error("Error parsing response body: was not an object"),r},e.prototype.trySavingLastModified=e}();t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){},o=);t.default=o},function(e,t,r){var n=r(14);unction i(e,t){return(e.featureFlags||[]).reduce((,{})}e.exports={getOptimizelyConfig:function(e){var t=function(e){var t=(e.rollouts||[]).reduce((,{}),r=(e.featureFlags||[]).reduce((,{});return(e.experiments||[]).reduce((function(i,a){return t[a.id]||(i[a.key]={id:a.id,key:a.key,variationsMap:(a.variations||[]).reduce((function(t,i){return t[i.key]={id:i.id,key:i.key,variablesMap:o(e,i,a.id,r)},n.isFeatureExperiment(e,a.id)&&(t[i.key].featureEnabled=i.featureEnabled),t}),{})}),i}),{})}(e);return{experimentsMap:t,featuresMap:i(e,t),revision:e.revision}}}},function(e,t,r){var n=r(3);e.exports={validateEventBatchSize:validateEventFlushInterval:},function(e,t,r){"use strict";r.r(t);var n=r(11),o=r(104),i=r.n(o),a="https://cdn.optimizely.com/public/6194110778/s/9011010262_dev.json",s="https://www.nike.com/assets/vendor/optimizely/prod/5aUCtZvFuDLjvdqdf2w53M.json",u=r(33),c=r.n(u),l=r(34),f=r.n(l),p=r(35),d=r.n(p),y=r(36),g=r.n(y),v=r(15),h=r.n(v);var E=function(e){eturn t.prototype=Object.create(e.prototype),Object.setPrototypeOf(t,e),t};function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=h()(e);if(t){var o=h()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return g()(this,r)}}var m=function(e){d()(r,e);var t=_(r);function r(e,n,o){var i;return c()(this,r),(i=t.call(this,e)).message=e,i.experiment=n,i.experimentManager=o,i}return f()(r,[{key:"name",get:function(){return this.constructor.name}}]),r}(E(Error));var I=r(16),O=r.n(I),b=r(105),R=r.n(b);ar A=function(e){d()(r,e);var t=T(r);function r(e,n){var o;return c()(this,r),(o=t.call(this,e)).message=e,o.experiment=n,o}return f()(r,[{key:"name",get:]),r}(E(Error));r(64);var N=r(37),S=r.n(N),x=r(38),P=r.n(x),L=[].concat(O()(Object.keys(S.a)),O()(Object.keys(P.a)));var U=function(e){function t(t){return function(r,n){var o=n||r;return"prod"!==e&&L.some((function(e){return o.includes(e)}))?console[t]("[dotcom-nav-experiments] ".concat(o)):null}}return{warn:t("warn"),info:t("info"),error:t("error"),log:t("log"),debug:t("debug")}};function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}ar D=function(e,t){var r=t.experiments,o=void 0===r?{}:r,i=t.features,a=void 0===i?{}:i,s=t.dotcomNav,u=t.sdk,c=[],l=[],f=U(s.env);function p(){try{return{country:s.locale.country.toLowerCase(),isDotcomNavTest:"prod"!==s.env?"true":"false"}}catch(e){return f.warn("Couldn't get attributes: ".concat(e.message))}}function d(e){if(e instanceof A)throw e;return e instanceof m?f.warn(e.message):(e&&f.error(e.message),null)}this.run=function(){var t=Object.keys(o),r=Object(n.getOptimizelyUserId)();if(!r)return Promise.reject(new m("No anonymousId value set"));var i=Object(n.getRollouts)(e,r);if((l=Object.keys(i)).forEach((function(e){try{return function(e){var t=a[e];if("function"!=typeof t)throw new m("feature '".concat(e,"' not found"));var r={name:e,dotcomNav:s,sdk:u};return t.call(this,r)}(e)}catch(e){return d(e)}})),!t.length)return f.warn("No experiments to run"),Promise.resolve();var y=Object(n.activateExperiments)(e,t,r,p());c=Object.keys(y).filter((function(e){return y[e]})).map(();var g=Object(n.getVariantVariables)(e,c.map((function(e){return e.experimentKey})),r,p()),v=c.map((function(e){var t=e.experimentKey,r=e.variationKey,n=g[t];try{return function(e,t,r){f.info("Running experiment ".concat(e,":").concat(t));var n=o[e];if(!n)throw new m("Experiment not found: ".concat(e,":").concat(t),n);return t)?null:n.call(this,{experimentKey:e,variationKey:t,attributes:r,dotcomNav:s,sdk:u})}(t,r,n)}catch(e){return d(e)}}));return Promise.all(v)},this.getDataFile=function(){return e.configObj},this.getAudienceAttributes=p,this.getActiveExperiments=function(){return c},this.getActiveFeatures=function(){return l},this.getExperimentData=function(e){if(!c.length)return{};var t=c.map((),r=e.abTest,n=void 0===r?{}:r,o=e.traits;return{abTest:w(w({},n),{},{optimizely:[].concat(O()(n.optimizely||[]),O()(t))}),traits:w(w({},o),p())}},this.getExperiments=function(){return o},this.getFeatures=function(){return a}};function C(e,t){var r=e.env,o=void 0===r?"prod":r;return function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.a,n=e?a:s;return r(n).then((function(e){if(200!==e.status)throw new m("Could not fetch ".concat(n,": Status code ").concat(e.status));return t?e.json():e.text()}))}("prod"!==o).then((function(r){var i=Object(n.getExperimentDriver)(r,{logger:U(o)});if(!i.__isOptimizelyConfigValid)throw new m("Optimizely client is not valid");var a=new D(i,{experiments:P.a,features:S.a,dotcomNav:e,sdk:t});return Object.defineProperty(e,"experimentManager",{value:a}),a}))}var V=function(){return new Promise((function(e,t){var r,n;null!==(r=window)&&void 0!==r&&null!==(n=r.NikePrivacy)&&void 0!==n&&n.isEnabled?window.addEventListener("@nikePrivacyCoreCustomEvent/initialized",(function(){return function(e,t){var r,n,o,i,a,s;null!==(r=window.NikePrivacy)&&void 0!==r&&null!==(n=r.permissions)&&void 0!==n&&null!==(o=n.get("performance"))&&void 0!==o&&o.isEnabled&&null!==(i=window.NikePrivacy)&&void 0!==i&&null!==(a=i.permissions)&&void 0!==a&&null!==(s=a.get("adtargetingBehavioralevents"))&&void 0!==s&&s.isEnabled?e():t("User has denied performance and adtargetingBehavioralevents")}(e,t)}),{once:!0}):e()}))};window.NikeDotcomNavReady((function(e,t){V().then(().then(().catch((function(e){console.error(e)}))}))},function(e,t,r){"use strict";r.r(t);var n=r(17);ar i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=);t.default=a}]);