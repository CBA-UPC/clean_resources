"use strict";(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[427],{20427:function(e,t,i){i.r(t);var n=i(49200),r=i(37311),s=i(2406),a=i.n(s),o=i(47189),c=i(57099),l=i.n(c),d=i(43229),u=i.n(d),p=i(42173),m=i.n(p),f=i(14561),g=i.n(f),_=i(95272),h=i(80589),y=i(96133),b=i(74114),v=i(44908),S=i.n(v),x=i(45578),P=i.n(x),w=i(16548),C=i(85476),M=i(45821);r E={see:"see",modify:"modify"},O=[{type:"all",title:(0,M.t)("logic.ModifyFilePermission.txt16"),description:(0,M.t)("logic.ModifyFilePermission.txt17")},{type:"part",title:(0,M.t)("logic.ModifyFilePermission.txt18"),description:(0,M.t)("logic.ModifyFilePermission.txt19")}],T={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"k-modify-file-permission"},[e.loading?i("k-loading"):e._e(),e._v(" "),e.mode||e.loading?e._e():i("section",[i("div",{staticClass:"switch-permission",style:{paddingBottom:e.isAllCanSee?"29px":"15px"}},[i("p",[i("span",[e._v("\n          "+e._s(e.lang_txt0)+"\n        ")]),e._v(" "),e.isShowSetting?i("span",[e._v("("+e._s(e.filePerSetting.banDownLoad?e.lang_txt1:e.lang_txt2)+e._s(e.lang_txt3)+")")]):e._e(),e._v(" "),e.isShowSetting?i("span",{staticClass:"file-permission-setting",on:{click:e.onFileSetting}},[e._v(e._s(e.lang_txt4))]):e._e()]),e._v(" "),i("el-dropdown",{attrs:{trigger:"click"},on:{command:function(t){return e.handleCommand(t.type,e.MODE_TYPES.see,e.isChecked(t,e.MODE_TYPES.see))}}},[i("span",{staticClass:"toogle"},[e._v("\n          "+e._s(e.isAllCanSee?e.PERMISSON_TYPES[0].title:e.PERMISSON_TYPES[1].title)+"\n          "),i("k-icon",{attrs:{type:"down"}})],1),e._v(" "),i("el-dropdown-menu",{staticClass:"permission-dropdown",attrs:{slot:"dropdown",visibleArrow:!1},slot:"dropdown"},e._l(e.READ_PERMISSON_TYPES,(function(t,n){return i("el-dropdown-item",{key:n,attrs:{command:t}},[i("div",{staticClass:"el-dropdown-menu__item-block el-dropdown-menu__item-block__large"},[e.isChecked(t,e.MODE_TYPES.see)?i("k-icon",{staticClass:"k-file-permission-check",attrs:{type:"m-check"}}):e._e(),e._v(" "),i("span",{staticClass:"el-dropdown-menu__item-block__title"},[e._v(e._s(t.title))]),e._v(" "),i("span",{staticClass:"el-dropdown-menu__item-block__append",attrs:{title:""+t.description+e.lang_txt5}},[e._v(e._s(t.description)+e._s(e.lang_txt5))])],1)])})),1)],1)],1),e._v(" "),!e.isAllCanSee&&e.membersCanSee.length>0?i("div",{staticClass:"members members-see",style:e.getScrollHeight(e.membersCanSee.length)},[i("KScroll",{staticClass:"scroll-list",attrs:{onLoad:function(){},canLoad:e.loadable,loading:e.loadingMore,showLoading:!1,onScroll:e.bodyClick}},[i("div",{staticClass:"members-item"},[i("div",{staticClass:"add-icon",on:{click:function(t){return e.toAddPage(e.MODE_TYPES.see)}}},[i("k-icon",{attrs:{type:"add"}})],1),e._v(" "),i("p",[e._v(e._s(e.lang_txt6))])]),e._v(" "),e._l(e.membersCanSee,(function(t,n){return i("div",{key:n,staticClass:"members-item",on:{mouseenter:function(t){e.hoverIndexT=n},mouseleave:function(t){e.hoverIndexT=-1}}},[e.hoverIndexT===n&&e.isMemer(t)?i("div",{staticClass:"error-icon",on:{click:function(i){return e.setPermission2(0,e.MODE_TYPES.see,t.id)}}},[i("k-icon",{attrs:{type:"close"}})],1):e._e(),e._v(" "),e.getNickName(t)?i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:e.getNickName(t),visibleArrow:!1,placement:"bottom-start",disabled:e.disableToolTip,popperClass:"search-popper-tips"}},[i("img",{attrs:{src:t.avatar}})]):i("img",{attrs:{src:t.avatar}}),e._v(" "),i("p",[e._v(e._s(t.name))])],1)}))],2)],1):e._e()]),e._v(" "),e.mode||e.loading?e._e():i("section",[i("div",{staticClass:"switch-permission switch-permission-modify"},[i("p",[e._v(e._s(e.lang_txt7))]),e._v(" "),i("el-dropdown",{attrs:{trigger:"click"},on:{command:function(t){return e.handleCommand(t.type,e.MODE_TYPES.modify,e.isChecked(t,e.MODE_TYPES.modify))}}},[i("span",{staticClass:"toogle"},[e._v("\n          "+e._s(e.isAllCanModify?e.PERMISSON_TYPES[0].title:e.PERMISSON_TYPES[1].title)+"\n          "),i("k-icon",{attrs:{type:"down"}})],1),e._v(" "),i("el-dropdown-menu",{staticClass:"permission-dropdown",attrs:{slot:"dropdown",visibleArrow:!1},slot:"dropdown"},e._l(e.MODIFY_PERMISSON_TYPES,(function(t,n){return i("el-dropdown-item",{key:n,attrs:{command:t}},[i("div",{staticClass:"el-dropdown-menu__item-block el-dropdown-menu__item-block__large"},[e.isChecked(t,e.MODE_TYPES.modify)?i("k-icon",{staticClass:"k-file-permission-check",attrs:{type:"m-check"}}):e._e(),e._v(" "),i("span",{staticClass:"el-dropdown-menu__item-block__title"},[e._v(e._s(t.title))]),e._v(" "),i("span",{staticClass:"el-dropdown-menu__item-block__append",attrs:{title:""+t.description+e.lang_txt8}},[e._v(e._s(t.description)+e._s(e.lang_txt8))])],1)])})),1)],1)],1),e._v(" "),!e.isAllCanModify&&e.membersCanModify.length>0?i("div",{staticClass:"members members-modify",style:e.getScrollHeight(e.membersCanModify.length)},[i("KScroll",{attrs:{onLoad:function(){},canLoad:e.loadable,loading:e.loadingMore,showLoading:!1,onScroll:e.bodyClick}},[i("div",{staticClass:"members-item"},[i("div",{staticClass:"add-icon",on:{click:},[i("k-icon",{attrs:{type:"add"}})],1),e._v(" "),i("p",[e._v(e._s(e.lang_txt6))])]),e._v(" "),e._l(e.membersCanModify,(function(t,n){return i("div",{key:n,staticClass:"members-item",on:{mouseenter:mouseleave:},[e.hoverIndexB===n&&e.isMemer(t)?i("div",{staticClass:"error-icon",on:{click:},[i("k-icon",{attrs:{type:"close"}})],1):e._e(),e._v(" "),e.getNickName(t)?i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:e.getNickName(t),visibleArrow:!1,placement:"bottom-start",disabled:e.disableToolTip,popperClass:"search-popper-tips"}},[i("img",{attrs:{src:t.avatar}})]):i("img",{attrs:{src:t.avatar}}),e._v(" "),i("p",[e._v(e._s(t.name))])],1)}))],2)],1):e._e()]),e._v(" "),e.mode&&!e.loading?i("k-member-selector",{ref:"memberSelector",attrs:{onSubmit:e.onSubmit,disableIds:e.disableIds,entrance:e.entrance,onCancel:e.onCancel,nextOnly:!0,showNextHeader:!1,showInfoCard:!1,listQuery:e.query,searchQuery:e.query,groupid:e.groupid,dialog:e.dialog}}):e._e()],1)},staticRenderFns:[],name:"KModifyFilePermission",components:{KLoading:_.Z,KIcon:h.default,ElDropdown:l(),ElDropdownMenu:u(),ElDropdownItem:m(),KScroll:y.Z,ElTooltip:g(),KMemberSelector:b.Z},props:{selectedFile:{type:Object,required:!0},groupid:{type:Number,required:!0},pid:{type:Number,required:!0},team:{type:Object,required:!0},isShowSetting:{type:Boolean,default:!1},updateAcl:{type:Function,default:,changeTitle:{type:Function},updateSetting:{type:Function,default:function(){}},isLinkGroup:{type:Boolean,default:!1},toFilePerSetting:{type:Function},dialog:{type:String,default:""}},data:function(){return{lang_txt0:(0,M.t)("logic.ModifyFilePermission.txt0"),lang_txt1:(0,M.t)("logic.ModifyFilePermission.txt1"),lang_txt2:(0,M.t)("logic.ModifyFilePermission.txt2"),lang_txt3:(0,M.t)("logic.ModifyFilePermission.txt3"),lang_txt4:(0,M.t)("logic.ModifyFilePermission.txt4"),lang_txt5:(0,M.t)("logic.ModifyFilePermission.txt5"),lang_txt6:(0,M.t)("logic.ModifyFilePermission.txt6"),lang_txt7:(0,M.t)("logic.ModifyFilePermission.txt7"),lang_txt8:(0,M.t)("logic.ModifyFilePermission.txt8"),PERMISSON_TYPES:O,MODE_TYPES:E,mode:"",groupAdmins:[],hoverIndexT:-1,hoverIndexB:-1,loading:!0,readMembers:[],writeMembers:[],read_range:"",write_range:"",parentReadRange:[],parentModifyRange:[],parentReadType:"",parentModifyType:"",query:{},filePerSetting:{}}},computed:{disableIds:function(){return S()(this.filterIds.concat(this.adminIds).map((function(e){return e.id})))},adminIds:READ_PERMISSON_TYPES:function(){return this.parentReadType===O[1].type?[O[1]]:O},MODIFY_PERMISSON_TYPES:function(){return this.parentModifyType===O[1].type?[O[1]]:O},membersCanSeeIds:function(){return this.readMembers.map((function(e){return e.id}))},membersCanModifyIds:filterIds:membersCanSee:function(){return this.isAllCanSee?this.readMembers:P()(this.groupAdmins.concat(this.removeAdmins(this.readMembers)),"id")},membersCanModify:function(){return this.isAllCanModify?this.writeMembers:P()(this.groupAdmins.concat(this.removeAdmins(this.writeMembers)),"id")},isAllCanSee:function(){return this.read_range===O[0].type},isAllCanModify:scrollContent:entrance:function(){var e,t=this.team,i=t.id,n=t.name;return e=(this.parentReadType===O[1].type?O[1].type:O[0].type)===O[0].type?{eType:"team",eName:n,id:i}:{eType:"filePermission",gid:i,fid:this.selectedFile.id,pid:this.pid},e}},created:function(){var e=this;return(0,r.Z)(a().mark((function t(){var i,n,r,s,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.pid){t.next=4;break}return t.next=4,e.getParentPermission();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),(0,C._N)(t.t0);case 9:return t.prev=9,e.initData(),t.finish(9);case 12:if(e.isLinkGroup||!e.isShowSetting){t.next=27;break}return t.prev=13,t.next=16,(0,o.Kpz)({groupid:e.groupid});case 16:i=t.sent,n=i.ban_download,r=i.ban_share,s=i.ban_delete,c=i.ban_creator_delete,e.filePerSetting=Object.assign({},e.filePerSetting,{banDownLoad:n,banShare:r,banDelete:s,banCreatorDelete:c}),t.next=27;break;case 24:t.prev=24,t.t1=t.catch(13),(0,C._N)(t.t1);case 27:case"end":return t.stop()}}),t,null,[[0,6,9,12],[13,24]])})))()},methods:{loadingMore:function(){},bodyClick:onFileSetting:function(){var e=this;this.$emit("change","KModifyFilePerSetting",F(F({title:(0,M.t)("logic.ModifyFilePermission.txt9"),groupid:this.groupid},this.filePerSetting),{},{updateSetting:function(t){e.updateSetting(t);var i=t.ban_download,n=t.ban_share,r=t.ban_delete,s=t.ban_creator_delete;e.filePerSetting=Object.assign({},e.filePerSetting,{banDownLoad:i,banShare:n,banDelete:r,banCreatorDelete:s})}})),this.toFilePerSetting&&this.toFilePerSetting()},isChecked:function(e,t){return t===E.see?this.isAllCanSee&&e.type===O[0].type||!this.isAllCanSee&&e.type===O[1].type:this.isAllCanModify&&e.type===O[0].type||!this.isAllCanModify&&e.type===O[1].type},getParentPermission:function(){var e=this;return(0,r.Z)(a().mark((function t(){var i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,o.CnI)({groupid:e.groupid,parentid:-1,fileids:e.pid});case 2:i=(i=t.sent)[0]||{},e.parentReadRange=i.read||[],e.parentModifyRange=i.write||[],e.parentReadType=i.read_range,e.parentModifyType=i.write_range;case 8:case"end":return t.stop()}}),t)})))()},getPermissonStatus:function(e){var t=this;return(0,r.Z)(a().mark((function i(){var n,r,s,c,l,d,u,p,m;return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,n=t.selectedFile.id,i.next=4,(0,o.CnI)({groupid:t.groupid,parentid:t.pid,fileids:n});case 4:r=i.sent,s=r[0]||{},c=s.write,l=void 0===c?[]:c,d=s.read,u=void 0===d?[]:d,p=s.read_range,m=s.write_range,t.writeMembers=l,t.readMembers=u,t.read_range=p||"all",t.write_range=m||"all",e&&e({read_type:t.read_range,write_type:t.write_range}),i.next=16;break;case 13:i.prev=13,i.t0=i.catch(0),(0,C._N)(i.t0);case 16:case"end":return i.stop()}}),i,null,[[0,13]])})))()},getGroupAdmins:function(){var e=this;return(0,r.Z)(a().mark((function t(){var i,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=200,t.next=3,(0,o.SvC)(e.groupid,{role:"creator,admin",count:i,offset:e.groupAdmins.length});case 3:n=t.sent,e.groupAdmins=e.groupAdmins.concat(n),n.length===i&&e.getGroupAdmins();case 6:case"end":return t.stop()}}),t)})))()},initData:function(){var e=this;return(0,r.Z)(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([e.getPermissonStatus(),e.getGroupAdmins()]);case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),(0,C._N)(t.t0);case 8:return t.prev=8,e.loading=!1,t.finish(8);case 11:case"end":return t.stop()}}),t,null,[[0,5,8,11]])})))()},toAddPage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.see;this.mode=e,this.query={rw:e===E.see?"read":"write"},this.$emit("propsChange",{title:(0,M.t)("logic.ModifyFilePermission.txt10")}),this.changeTitle&&this.changeTitle((0,M.t)("logic.ModifyFilePermission.txt10"))},onCancel:function(){if(this.mode="","folder"===this.selectedFile.ftype)this.$emit("propsChange",{title:"".concat(this.selectedFile.fname," ").concat((0,M.t)("logic.ModifyFilePermission.txt11"))}),this.changeTitle&&this.changeTitle("".concat(this.selectedFile.fname," ").concat((0,M.t)("logic.ModifyFilePermission.txt11")));else{var e=this.selectedFile.fname.split(".");e.pop(),this.$emit("propsChange",{title:"".concat(e," ").concat((0,M.t)("logic.ModifyFilePermission.txt20"))}),this.changeTitle&&this.changeTitle("".concat(e," ").concat((0,M.t)("logic.ModifyFilePermission.txt20")))}},getScrollHeight:function(e){return{height:e>=7?"151px":"77px"}},isMemer:function(e){return["admin","creator"].indexOf(e.role)<0},getNickName:function(e){return this.isMemer(e)?"":(0,M.t)("logic.ModifyFilePermission.txt12")},setPermission2:function(e,t,i){var n=this;return(0,r.Z)(a().mark((function s(){var c,l,d,u,p,m;return a().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(c=t===E.see,l=2===e,s.prev=2,![1,2].includes(e)||"file"===n.selectedFile.ftype){s.next=20;break}return s.next=6,(0,o.LBI)({groupid:n.groupid,fileid:n.selectedFile.id});case 6:if(d=s.sent,u=d.down_files||[],p=d.down_folder||[],!(m=u.concat(p)).length){s.next=15;break}n.onCancel(),n.$emit("change","KModifyPermissionInfoSub",{title:(0,M.t)("logic.ModifyFilePermission.txt13"),isAllMode:l,isSeeMode:c,memberList:n.addMemberList,downFile:m,callback:function(){var s=(0,r.Z)(a().mark((function r(){return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.addMemberList=[],r.next=3,n.setPermission(e,t,i,!0);case 3:case"end":return r.stop()}}),r)})));return ()}),s.next=18;break;case 15:return s.next=17,n.setPermission(e,t,i);case 17:n.onCancel();case 18:s.next=23;break;case 20:return s.next=22,n.setPermission(e,t,i);case 22:n.onCancel();case 23:s.next=29;break;case 25:s.prev=25,s.t0=s.catch(2),(0,C._N)(s.t0),n.onCancel();case 29:case"end":return s.stop()}}),s,null,[[2,25]])})))()},setPermission:function(){var e=arguments,t=this;return(0,r.Z)(a().mark((function i(){var n,r,s,c,l,d,u,p,m,f,g,_,h,y,b;return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n=e.length>0&&void 0!==e[0]?e[0]:1,r=e.length>1?e[1]:void 0,s=e.length>2?e[2]:void 0,c=[],l=[],d=t.selectedFile.id,u=r===E.see,p=t.isAllCanSee?"all":"part",m=t.isAllCanModify?"all":"part",f="",g="",_="",i.t0=n,i.next=0===i.t0?15:1===i.t0?17:2===i.t0?21:3===i.t0?23:25;break;case 15:return u?(f="del",(_=t.membersCanSee.find((function(e){return e.id===s})))&&c.push(_.id)):(f="add",(g=t.membersCanModify.find(())&&c.push(g.id)),i.abrupt("break",25);case 17:return f="add",u?c=s:l=s,l=l.concat(t.groupAdmins.map((function(e){return e.id}))),i.abrupt("break",25);case 21:return u?p=O[0].type:m=O[0].type,i.abrupt("break",25);case 23:return u?("part"===t.read_range&&(c=t.membersCanSeeIds),p=O[1].type):("part"===t.write_range&&(l=t.membersCanModifyIds),m=O[1].type),i.abrupt("break",25);case 25:if(i.prev=25,![0,1].includes(n)){i.next=36;break}return h={groupid:t.groupid,fileid:d,op:f},y=[],y=u?{ruser:c.join(","),wuser:l.join(",")}:0===n?{ruser:c.join(",")}:{wuser:l.join(",")},h=Object.assign({},h,y),i.next=33,(0,o.tiI)(h);case 33:t.updateSuccessCallback(),i.next=44;break;case 36:if(![2,3].includes(n)){i.next=44;break}return"part"===p&&"part"===t.write_range&&"all"===m?(p="all",m="all"):"part"===p&&"all"===t.read_range&&"all"===m&&(p="part",m="part"),b={groupid:t.groupid,fileid:d,parentid:t.pid,read_range:p,write_range:m,isfile:"folder"!==t.selectedFile.ftype},u?delete b.write_range:delete b.read_range,3===n&&(b=Object.assign({},b,{admins:t.groupAdmins.map((function(e){return e.id})).join(",")})),i.next=43,(0,o.OW2)(b);case 43:t.updateSuccessCallback();case 44:i.next=49;break;case 46:i.prev=46,i.t1=i.catch(25),(0,C._N)(i.t1);case 49:case"end":return i.stop()}}),i,null,[[25,46]])})))()},updateSuccessCallback:function(){var e,t=this,i="folder"!==this.selectedFile.ftype?(0,M.t)("logic.ModifyFilePermission.txt14"):(0,M.t)("logic.ModifyFilePermission.txt15");w.Z.success(i);try{e=function(){var e=(0,r.Z)(a().mark(());return ()}catch(e){(0,C._N)(e)}this.getPermissonStatus(e)},onSubmit:function(e){var t=this;return(0,r.Z)(a().mark((function i(){var n;return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n=e.users,!(n.length<=0)){i.next=4;break}return i.abrupt("return");case 4:return n=n.filter((function(e){return!t.adminIds.find(()})),t.addMemberList=n,i.next=8,t.setPermission2(1,t.mode,n.map(());case 8:case"end":return i.stop()}}),i)})))()},handleCommand:function(e,t,i){i?this.toast((0,M.t)("logic.ModifyFilePermission.txt14")):this.setPermission2(e===O[0].type?2:3,t)},removeAdmins:function(e){var t=this;return e.filter(()}},install:;t.default=T}}]);
