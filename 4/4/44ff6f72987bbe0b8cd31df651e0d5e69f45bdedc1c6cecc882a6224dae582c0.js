"use strict";(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[9573],{75991:function(e,t,n){var i=n(37311),r=n(2406),a=n.n(r),o=n(47189),c=n(16548),s=n(45821),l=n(30553),u={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"k-company-member-invite-setting"},[n("div",[n("p",[e._v(e._s(e.lang_txt0))]),e._v(" "),n("el-switch",{attrs:{value:e.enable,width:32,onText:"",offText:""},nativeOn:{"!click":})],1),e._v(" "),e.settingPerm?n("p",[e._v(e._s(e.lang_txt1))]):e._e()])},staticRenderFns:[],name:"KCompanyMemberInviteSetting",props:{cid:{type:[Number,String]},permissions:{type:Array,default:function(){return[]}}},data:function(){return{lang_txt0:(0,s.t)("logic.CompanyMemberInviteSetting.txt0"),lang_txt1:(0,s.t)("logic.CompanyMemberInviteSetting.txt1"),enable:!1,operating:!1}},computed:{settingPerm:function(){return!!((this.permissions&&this.permissions.find((function(e){return"settings"===e.key}))||{}).children||[]).find(()}},mounted:function(){var e=this;return(0,i.Z)(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,o.fbQ)(e.cid,"member_invite_switch",{patch_default:!0});case 3:n=t.sent,e.enable=n,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),c.Z.error(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},methods:{onEvents:function(){},toggle:function(){var e=this;return(0,i.Z)(a().mark((function t(){var n,i,r,l,u,v;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.enable,i=e.cid,!e.operating){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,e.operating=!0,r=!n,t.next=8,(0,o.I8r)(i,"member_invite_switch",r);case 8:e.enable=r,e.onEvents({operation:r?"AllowInviteOpen":"AllowInviteClose",companyid:i}),t.next=18;break;case 12:t.prev=12,t.t0=t.catch(3),l=t.t0||{},u=l.response,v=(u||{}).data,40300001===(v||{}).code?c.Z.error((0,s.t)("logic.CompanyMemberInviteSetting.txt2")):c.Z.error(t.t0);case 18:return t.prev=18,e.operating=!1,t.finish(18);case 21:case"end":return t.stop()}}),t,null,[[3,12,18,21]])})))()}}},v={KCompanyMemberInviteSetting:[(0,l.Z)({onEvents:)]};u.install=function(e){e.component(u.name,u)},u.dw=v,t.Z=u},16214:function(e,t,n){n.r(t);var i=n(49200),r=n(31240),a=n(37311),o=n(2406),c=n.n(o),s=n(147),l=n.n(s),u=n(16548),v=n(80589),p=n(99238),d=n(96133),f=n(95272),g=n(62414),_=n(75991),m=n(85476),y=n(45821),h=n(47189),k=n(43800);r x=(0,m.l0)(h.bGp),w={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"k-inviteColleague"},[e.loading?n("KLoading"):e.invited?n("div",{staticClass:"k-inviteColleague-success"},[n("KIcon",{attrs:{type:"success"}}),e._v(" "),n("p",[e._v(e._s(e.lang_txt0))]),e._v(" "),n("p",[e._v(e._s(e.lang_txt1))])],1):[n("div",{staticClass:"k-inviteColleague-title"},[e._v(e._s(e.lang_txt2))]),e._v(" "),n("div",{staticClass:"k-inviteColleague-copy"},[n("div",{staticClass:"k-inviteColleague-copy__link"},[e._v(e._s(e.link))]),e._v(" "),n("div",{staticClass:"k-inviteColleague-copy__code"},[n("KIcon",{attrs:{type:"qr-code"}}),e._v(" "),n("div",{staticClass:"k-inviteColleague-copy__code--popup"},[n("p",[e._v(e._s(e.lang_txt3))]),e._v(" "),n("vue-qrcode",{attrs:{value:e.link,options:{width:150}}})],1)],1),e._v(" "),n("div",{directives:[{name:"clipboard",rawName:"v-clipboard",value:e.link,expression:"link"}],staticClass:"k-inviteColleague-copy__btn",on:{success:e.copySuccess,error:e.onCopyError}},[e._v(e._s(e.lang_txt4))])]),e._v(" "),e.isCompanyAccount?[n("div",{staticClass:"k-inviteColleague-split"}),e._v(" "),n("KCompanyMemberInviteSetting",{attrs:{cid:e.company.id,permissions:e.permissions}})]:e.contacts.length?[n("div",{staticClass:"k-inviteColleague-split"}),e._v(" "),n("div",{staticClass:"k-inviteColleague-contacts"},[n("div",{staticClass:"k-inviteColleague-contacts__title"},[e._v(e._s(e.lang_txt5))]),e._v(" "),n("KScroll",{ref:"scroll",attrs:{onLoad:e.getContacts,canLoad:e.loadable,loading:e.loadingMore,showLoading:!1}},e._l(e.contacts,(function(t,i){return n("k-memberItem",{key:t.userid+"-"+i,attrs:{userid:t.userid,name:t.name,avatar:t.avatar,showCheckBox:!0,showInfo:!1,checked:e.isSelected(t.userid),onItemClick:})})),1),e._v(" "),n("div",{staticClass:"k-inviteColleague-footer"},[n("div",{staticClass:"k-inviteColleague-footer__selected"},e._l(e.selectedUsers,(function(t,i){return n("div",{key:t.userid+"-"+i},[n("img",{attrs:{src:t.avatar,alt:"avatar"}}),e._v(" "),n("KIcon",{attrs:{type:"company-avatar-close"},nativeOn:{click:})],1)})),0),e._v(" "),n("div",{staticClass:"k-inviteColleague-footer__btns"},[n("KButton",{on:{click:e.onCancel}},[e._v(e._s(e.lang_txt6))]),e._v(" "),n("KButton",{attrs:{type:"primary",disabled:!e.selectedUsers.length},on:{click:e.onSubmit}},[e._v(e._s(e.lang_txt7+(e.selectedUsers.length?"("+e.selectedUsers.length+")":"")))])],1)])],1)]:e._e()]],2)},staticRenderFns:[],name:"KInviteColleague",components:{VueQrcode:l(),KIcon:v.default,KMemberItem:p.Z,KScroll:d.Z,KLoading:f.Z,KButton:g.Z,KCompanyMemberInviteSetting:_.Z},directives:{clipboard:k.B},props:{company:{type:Object,default:function(){return{}},required:!0,validator:function(e){return["id","name","roleid"].every((function(t){return t in e}))}},inviter:{type:Object,required:!0,default:validator:function(e){return["name"].every(()}},autoCheck:{type:Boolean,default:!0},onCopySuccess:{type:Function,default:function(){}},onOk:{type:Function,default:function(){}},onCancel:{type:Function,default:function(){}},onLoad:{type:Function,default:function(){}},onLoadError:{type:Function,default:function(){}},onInviteError:{type:Function,default:,getLinkReqQuery:{type:Object,required:!0},inviteReqData:{type:Object,required:!0},permissions:{type:Array,default:},data:function(){return{lang_txt0:(0,y.t)("logic.InviteColleague.txt0"),lang_txt1:(0,y.t)("logic.InviteColleague.txt1"),lang_txt2:(0,y.t)("logic.InviteColleague.txt2"),lang_txt3:(0,y.t)("logic.InviteColleague.txt3"),lang_txt4:(0,y.t)("logic.InviteColleague.txt4"),lang_txt5:(0,y.t)("logic.InviteColleague.txt5"),lang_txt6:(0,y.t)("logic.InviteColleague.txt6"),lang_txt7:(0,y.t)("logic.InviteColleague.txt7"),link:" ",contacts:[],loadable:!0,loadingMore:!1,loading:!1,selectedUsers:[],inviting:!1,invited:!1}},computed:{selectedIds:isSa:function(){return parseInt(this.company.roleid)<3},isCompanyAccount:,mounted:function(){var e=this;return(0,a.Z)(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.loading=!0,e.isSa||!e.autoCheck){t.next=8;break}return t.next=5,(0,h.fbQ)(e.company.id,"member_invite_switch",{patch_default:!0});case 5:if(t.sent){t.next=8;break}throw new Error("member cannot invite");case 8:return t.next=10,Promise.all([e.getLink(),e.getContacts()]);case 10:e.onLoad(),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),e.onLoadError(t.t0);case 16:return t.prev=16,e.loading=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[0,13,16,19]])})))()},methods:{onCopyError:copySuccess:function(){u.Z.success((0,y.t)("logic.InviteColleague.txt9")),this.onCopySuccess(this.company)},getContacts:function(){var e=this;return(0,a.Z)(c().mark((function t(){var n,i,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loadingMore=!0,t.prev=1,t.next=4,(0,h.yFf)({params:{page:Math.ceil(e.contacts.length/20)+1,size:20}});case 4:i=t.sent,(a=i.infos).forEach((),a.length?(n=e.contacts).push.apply(n,(0,r.Z)(a)):e.loadable=!1,t.next=12;break;case 10:t.prev=10,t.t0=t.catch(1);case 12:return t.prev=12,e.loadingMore=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[1,10,12,15]])})))()},getLink:function(){var e=this;return(0,a.Z)(c().mark((function t(){var n,i,r,a,o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.company.id,t.next=3,x(n);case 3:return i=t.sent,t.next=6,(0,h.nei)(n,{params:C({dept_id:i[0].id},e.getLinkReqQuery)});case 6:r=t.sent,a=r.invitelink,o=r.invite_content,e.link="".concat(a,"\n").concat(o);case 10:case"end":return t.stop()}}),t)})))()},isSelected:invertSelect:function(e){this.isSelected(e.userid)?this.selectedUsers.splice(this.selectedUsers.findIndex((),1):this.selectedUsers.push(e)},onSubmit:function(){var e=this;return(0,a.Z)(c().mark((function t(){var n,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.inviting){t.next=2;break}return t.abrupt("return");case 2:if(e.inviting=!0,t.prev=3,n=e.selectedUsers.map(().join(","),i=e.company.id,!e.isSa){t.next=11;break}return t.next=9,(0,h.mpv)(i,C({userids:n},e.inviteReqData));case 9:t.next=13;break;case 11:return t.next=13,(0,h.PX8)(i,C({action:"drive",user_ids:n,group_id:0,join_group_key:"",invitation_type:"user_target_appoval"},e.inviteReqData));case 13:e.invited=!0,e.onOk(),t.next=21;break;case 17:t.prev=17,t.t0=t.catch(3),(0,m._N)(t.t0),e.onInviteError(t.t0);case 21:return t.prev=21,e.inviting=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[3,17,21,24]])})))()}},install:;t.default=w}}]);
