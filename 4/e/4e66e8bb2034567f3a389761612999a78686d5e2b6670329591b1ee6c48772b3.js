(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3137,2793],{92793:function(e,t,n){"use strict";n.r(t),n.d(t,{servicePush:function(){return l}});var r,i=n(809),s=n.n(i),a=n(92447),c=n(38347),o=n(81923),u=n.n(o),f=(n(42567),n(32196)),b=n(6188),p=!f.sk&&"undefined"!==typeof(null===(r=navigator)||void 0===r?void 0:r.serviceWorker),d=function(e){var t=e.data,n=(t=void 0===t?{}:t).firebaseMessaging;if(n){var r=n.payload.notification,i=n.type,s=r.title,a=r.click_action,o=void 0===a?window.location.pathname:a,u=(0,c.Z)(r,["title","click_action"]);switch(i){case"notification-clicked":window.location.push(o);break;case"push-received":new Notification(s,u).addEventListener("click",()}}},l={init:function(){var e=this;return(0,a.Z)(s().mark((function t(){var n,r,i,a,c;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n={apiKey:"AIzaSyCQacdw4a3CGV8PWBTBpxacVdo68vPePqU",projectId:"life-test-259610",messagingSenderId:"1028984457389",appId:"1:1028984457389:web:d2f019bde222eee48d5e24"},u().apps.length){t.next=18;break}return u().initializeApp(n),p&&navigator.serviceWorker.addEventListener("message",d),t.prev=4,r=u().messaging(),t.next=8,r.getToken();case 8:if(i=t.sent,localStorage.setItem("fcm_token",i),a=JSON.parse(localStorage.getItem("subscribeToPushNotification")),c=a.lastDateInSec,!(Math.round((new Date).getTime()/1e3)-c>604800)){t.next=14;break}return t.next=14,e.subscribe();case 14:t.next=18;break;case 16:t.prev=16,t.t0=t.catch(4);case 18:case"end":return t.stop()}}),t,null,[[4,16]])})))()},getToken:function(){return(0,a.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u().messaging(),e.next=3,t.getToken();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},isSubscribed:function(){return(0,a.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Notification&&"granted"===Notification.permission&&!!localStorage.getItem("fcm_token"));case 1:case"end":return e.stop()}}),e)})))()},subscribe:function(){return(0,a.Z)(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window,!(n=t.Notification)||"granted"!==n.permission){e.next=10;break}return e.next=4,l.getToken();case 4:return r=e.sent,localStorage.setItem("fcm_token",r),e.next=8,b.bl.post("/push/subscribe",{token:r});case 8:localStorage.removeItem("subscribeToPushNotification"),localStorage.setItem("subscribeToPushNotification",JSON.stringify({lastDateInSec:Math.round((new Date).getTime()/1e3),wasSubscribed:!0,token:r}));case 10:case"end":return e.stop()}}),e)})))()},unsubscribe:function(){return(0,a.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.getToken();case 2:return t=e.sent,e.next=5,b.bl.post("/push/unsubscribe",{token:t});case 5:localStorage.removeItem("subscribeToPushNotification"),localStorage.removeItem("fcm_token"),localStorage.setItem("subscribeToPushNotification",JSON.stringify({lastDateInSec:Math.round((new Date).getTime()/1e3),wasSubscribed:!1,token:null}));case 8:case"end":return e.stop()}}),e)})))()},destroy:function(){return(0,a.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p&&navigator.serviceWorker.removeEventListener("message",d);case 1:case"end":return e.stop()}}),e)})))()}}},43137:function(e,t,n){"use strict";n.r(t),n.d(t,{servicePush:);var r,i=n(32292),s=n(809),a=n.n(s),c=n(92447),o=n(92793),u={init:function(){var e=this;return(0,c.Z)(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=2;break}return t.abrupt("return",r);case 2:return window.OneSignal=window.OneSignal||[],(r=window.OneSignal).push((function(){r.isPushNotificationsSupported()&&r.init({appId:"7bb3e10b-5bd5-47bf-8c32-91afa0d6141c",safari_web_id:"web.ru.life",notifyButton:{enable:!1},welcomeNotification:{disable:!0}})})),t.next=7,o.servicePush.isSubscribed();case 7:if(!t.sent){t.next=17;break}return t.next=10,o.servicePush.init();case 10:return t.next=12,o.servicePush.unsubscribe();case 12:return t.next=14,e.isSubscribed();case 14:if(t.sent){t.next=17;break}return t.next=17,e.subscribe();case 17:case"end":return t.stop()}}),t)})))()},subscribe:function(){var e=this;return(0,c.Z)(a().mark((function t(){var n,i,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getSubscriptionState();case 2:n=t.sent,i=n.isPushEnabled,s=n.isOptedOut,i?r.setSubscription(!1):s&&r.setSubscription(!0);case 6:case"end":return t.stop()}}),t)})))()},unsubscribe:function(){var e=this;return(0,c.Z)(a().mark(())()},isSubscribed:function(){return(0,c.Z)(a().mark(())()},getSubscriptionState:function(){return(0,c.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([r.isPushNotificationsEnabled(),r.isOptedOut()]).then(());case 1:case"end":return e.stop()}}),e)})))()},destroy:}}]);