(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[817],{44168:78909:function(e,t,s){"use strict";s.d(t,{T:function(){return m},b:function(){return u}});var i=s(52322),r=s(50926),n=s(21002),l=s(47330);let a={Header:"Visitor",Cell:e=>{let{cell:{row:{original:t}}}=e;return(0,i.jsx)(n.jq,{visitor:t})}},o={id:"Company Account",Header:(0,i.jsx)(r.Z,{}),Cell:e=>{let{cell:{row:{original:t}}}=e;return(0,i.jsx)(n.T3,{companyAccount:{id:t.companyAccountId,name:t.companyName,websiteDomain:t.companyDomain}})},featureFlag:l.TT.Enrichment},d={Header:"City",Cell:e=>{let{cell:{row:{original:t}}}=e;return(0,i.jsx)("div",{className:"text-sm text-slate-600",children:t.mostRecentCity})},featureFlag:l.TT.IpGeoTracking},c={Header:"Last seen",Cell:e=>{let{cell:{row:{original:t}}}=e;return(0,i.jsx)("div",{className:"text-slate-600",children:(0,i.jsx)(n.DZ,{date:new Date(t.updatedAt)})})}},u=[a,o,{Header:"Total Time",Cell:e=>{let{cell:{row:{original:t}}}=e;return(0,i.jsx)(n.Ti,{totalTime:t.sessionTime})}},{Header:"Visits",Cell:e=>{let{cell:{row:{original:t}}}=e;return(0,i.jsx)(n.b1,{visits:t.sessionCount})}},c,d],m=[a,o,{Header:"Device",accessor:"browserOsDevice",Cell:e=>{let{cell:{value:t}}=e;return(0,i.jsx)("div",{className:"text-sm text-slate-600",children:t})}},c]},7237:function(e,t,s){"use strict";s.d(t,{w:function(){return useListVisitorsQuery}});var i=s(73235),r=s(66547),n=s(26806);function _templateObject(){let e=(0,i._)(["\n    query ListVisitors($data: VisitorQueryInput!) {\n  visitors(data: $data) {\n    id\n    results {\n      id\n      name\n      email\n      updatedAt\n      browser\n      device\n      os\n      browserOsDevice\n      converted\n      navigated\n      sessionTime\n      sessionCount\n      companyDomain\n      companyName\n      companyAccountId\n      mostRecentCountry\n      mostRecentCountryRegion\n      mostRecentCity\n    }\n  }\n}\n    "]);return _templateObject=function(){return e},e}let l=(0,r.ZP)(_templateObject());,49813:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return es}});var i=s(52322),r=s(2784),n=s(32660),l=s(47294),a=s(57473),o=s(18406),d=s(97185),c=s(30669),u=s(81291),m=s(25948),x=s(54532),p=s(70805),j=s(51904),v=s(35455),h=s(18484),g=s(1991),f=s(86414),w=s(93303),b=s(37876),y=s(53954),N=s(7967),Z=s(77512);let V=[{name:"Last view session",value:"last"},{name:"All sessions",value:"all"}];var Visitor_ExportVisitorsButton=e=>{let{sessionsEnabled:t}=e,[s,n]=(0,r.useState)(!1),[l,a]=(0,r.useState)(!0),[o,d]=(0,r.useState)("last"),{rqlFilter:c}=(0,w.Z)(),{searchText:u}=(0,b.Z)(),[m]=(0,y.AH)(),{workspace:x}=(0,y.cF)();return(0,i.jsxs)("div",{children:[(0,i.jsx)(v.Z,{onClick:()=>n(!0)}),(0,i.jsx)(h.Z,{title:"Export Visitors",open:s,handleClose:nextText:"Export",handleNext:()=>{let e=new URLSearchParams;e.append("privacy",m),e.append("workspaceId",x.id),e.append("sessions",o),l?(c&&e.append("filter",c),u&&e.append("searchText",u)):e.append("filter",N.QN.updatedAllTime().toString());let t="".concat((0,g.u4)(),"?").concat(e.toString());f.Z.track("exported_visitors",{download_url:t,sessions:o,rqlFilter:c,exportWithFilters:l}),window.open(t,"_blank"),n(!1)},subText:"all"===o?"Sessions will be downloaded as a CSV file containing up to 5,000 visitors.":"Visitors will be downloaded as a CSV file containing up to 5,000 rows.",exportWithFilters:l,setExportWithFilters:a,children:t?(0,i.jsxs)("fieldset",{className:"mb-8 border-none",children:[(0,i.jsx)("legend",{className:"label-base mb-3 text-sm",children:"Session View"}),(0,i.jsx)("div",{className:"space-y-4 sm:flex sm:items-center sm:space-x-10 sm:space-y-0",children:V.map(})]}):null})]})},_=s(66379),C=s(43913),F=s(68810),P=s(83122),T=s(99219),E=s(84038),S=s(19340),k=s(20851),D=s(75312);let O={id:"all-projects",name:"All Product Demos"};var Filter_FilterProject=()=>{var e,t;let{setRqlFilter:s,presetFilters:r}=(0,w.Z)(),{workspace:n}=(0,y.cF)(),[l,a]=(0,k.QZ)(r,e=>e.args[0]===N.Eu.ProjectId),o=(null===(e=l[0])||void 0===e?void 0:e.args[1])||O.id,[{data:d}]=(0,E.O)({variables:{data:{workspaceId:n.id,limit:100}}}),c=[O,...(null==d?void 0:null===(t=d.projects)||void 0===t?void 0:t.results)||[]],u=c.map(,m=new Map(c.map(),labelGetter=return(0,i.jsx)(D.Z,{options:u,value:o,optionLabelGetter:label:"Product Demos",onChange:e=>{if(e===O.id){s(new S.ZP("and",[...a]));return}s(new S.ZP("and",[...a,new S.ZP("eq",[N.Eu.ProjectId,e])]))}})},A=s(23150),B=s(51268),I=s(14270),Visitor_VisitorBooleanFilter=e=>{let{knownFilter:t}=e,{setRqlFilter:s,presetFilters:r}=(0,w.Z)();return(0,i.jsxs)("div",{className:(0,P.AK)(N.$k.get(t),"flex flex-row space-x-2 rounded px-2 py-1 text-sm text-white"),children:[(0,i.jsx)("span",{children:N.Pn.get(t)}),(0,i.jsx)(T.b0D,{"aria-label":"clear identified filter",height:"0.7rem",width:"0.7rem",className:"my-auto cursor-pointer",onClick:()=>{s(new S.ZP("and",[...r.filter(e=>e.args[0]!==t)]))}})]})},L=s(88108);let q=[N.QN.identified(),N.QN.converted(),N.QN.navigated(),N.QN.engaged()],isBooleanFilter=rqlToOption=e=>({id:e.args[0],value:e}),Q=q.map(rqlToOption),R=new Map(Q.map(),optionLabel=e=>N.Pn.get(e.id),optionDescription=var Visitor_VisitorBooleanFilterSelect=()=>{let{setRqlFilter:e,presetFilters:t}=(0,w.Z)(),[s,r]=(0,k.QZ)(t,isBooleanFilter),n=s.map(rqlToOption);return(0,i.jsx)(A.R,{value:n.map(,onChange:t=>{e(new S.ZP("and",[...r,...t.map(]))},multiple:!0,children:(0,i.jsxs)(I.Z,{children:[(0,i.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsxs)(A.R.Label,{className:"my-auto mr-3 py-1 text-sm font-medium text-gray-500",children:["Engagement:",0===n.length&&(0,i.jsx)("span",{className:"ml-2 text-sm font-normal text-gray-400",children:"Any"})]}),(0,i.jsx)("div",{className:"flex flex-row space-x-2",children:n.map(e=>(0,i.jsx)(Visitor_VisitorBooleanFilter,{knownFilter:e.value.args[0]},e.id))})]}),(0,i.jsx)(A.R.Button,{className:"my-auto ml-2 text-gray-400",children:)]}),(0,i.jsx)(A.R.Options,{className:"mt-4",children:Q.map(e=>(0,i.jsx)(A.R.Option,{value:e.id,children:t=>{let{selected:s,active:r}=t;return(0,i.jsxs)(L.Z,{active:r,selected:s,children:[optionLabel(e)," - ",optionDescription(e)]})}},e.id))})]})})},Visitor_VisitorFilterPanel=e=>{let{close:t}=e,{setRqlFilter:s}=(0,w.Z)();return(0,i.jsxs)("div",{className:"min-w-[400px] space-y-3",children:[(0,i.jsx)(Visitor_VisitorBooleanFilterSelect,{}),(0,i.jsx)(Filter_FilterProject,{}),(0,i.jsx)("div",{className:"mx-3 flex justify-start",children:(0,i.jsx)("button",{className:"mt-2 text-sm text-gray-500 hover:text-gray-700",onClick:children:"Clear all"})})]})},Visitor_VisitorFilterButton=()=>{let[e,t]=(0,r.useState)(null),[s,n]=(0,r.useState)(null),{x:l,y:a,strategy:o}=(0,_.YF)({placement:"bottom-start",elements:{reference:s,floating:e}}),{presetFilters:d}=(0,w.Z)(),c=d.filter(e=>e.args[0]&&![N.Eu.UpdatedAllTime,N.Eu.UpdatedGt30Days,N.Eu.UpdatedGt7Days].includes(e.args[0]));return(0,i.jsxs)(C.J,{children:[(0,i.jsx)(C.J.Button,{as:"div",ref:n,children:(0,i.jsxs)("button",{className:(0,P.AK)(c.length>0?"border-blue-primary text-blue-primary":"border-gray-200 text-zinc-500","flex items-center rounded-md border bg-zinc-50 px-3.5 py-2 text-base font-normal"),children:[(0,i.jsx)(T.eqi,{className:"-ml-.5 mr-1 h-3.5 w-3.5"}),"Filters"," ",c.length>0&&(0,i.jsxs)("span",{className:"ml-1",children:["(",c.length,")"]})]})}),(0,i.jsx)(F.u,{leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,i.jsx)(C.J.Panel,{ref:t,style:{position:o,top:null!=a?a:0,left:null!=l?l:0,width:"max-content"},className:"z-10 mt-2 rounded-md border bg-zinc-50 px-2 py-3 text-lg shadow-lg",children:)})]})},Visitor_VisitorSearchBar=()=>{let{searchText:e,setSearchText:t}=(0,b.Z)();return(0,i.jsx)(Z.E1,{value:e,onChange:t,placeholder:"Search visitors by name/email",className:"w-[20em]"})},H=s(78909),G=s(7237),M=s(2612),$=s(49323);let Empty=()=>(0,i.jsx)(M.r,{title:"No visitors found.",description:"Project visitors will appear here.",icon:(0,i.jsx)(T.oyc,{className:"mx-auto h-6 w-6 text-gray-300"})});var K=r.memo(e=>{var t;let{limit:s,skip:n,showDemoData:l}=e,{workspace:o}=(0,y.cF)(),{rqlFilter:d}=(0,w.Z)(),{searchText:c}=(0,b.Z)(),[{data:u,fetching:m}]=(0,G.w)({variables:{data:{rqlFilter:d,workspaceId:o.id,showDemoData:l,searchText:c,limit:s,skip:n}}}),x=(0,r.useMemo)([null==u?void 0:null===(t=u.visitors)||void 0===t?void 0:t.results]),p=(0,r.useMemo)(()=>H.b.filter(e=>!e.featureFlag||(0,y.NK)(o,e.featureFlag)),[o]);return(0,i.jsx)(a.ZP,{children:(0,i.jsx)($.Z,{columns:p,data:x,loading:m,Empty:Empty})})}),z=s(73235),U=s(66547),X=s(26806);et J=(0,U.ZP)(_templateObject());var W=s(47330),Y=s(48464),ee=s(69260),et=s(95965);function VisitorsPage(){var e;let{workspace:t}=(0,y.cF)(),{rqlFilter:s}=(0,w.Z)(),{searchText:d}=(0,b.Z)(),{startIndex:v,getNext:h,getPrev:g,isStart:f,isEnd:N,setTotalCount:Z}=(0,Y.Z)(ee.sg),[V]=(0,et.ZP)((0,c.$X)(t.id),!1),[{data:_,fetching:C}]=(e={variables:{data:{rqlFilter:s,workspaceId:t.id,showDemoData:V,searchText:d}}},X.aM({query:J,...e})),F=(0,r.useMemo)([_]);(0,r.useEffect)([F,Z]);let P=(0,y.NK)(t,W.TT.SessionsExport);return(0,i.jsxs)(a.ZP,{children:[(0,i.jsx)(j.Z,{}),(0,i.jsx)(n.Z,{}),(0,i.jsxs)(x.Z,{workspaceItem:W.KG.Customers,children:[(0,i.jsx)(u.Z,{title:"Visitors",includeSlug:!0}),(0,i.jsxs)(o.Z,{children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)(m.Z,{title:"Visitors"}),(0,i.jsx)(Visitor_ExportVisitorsButton,{sessionsEnabled:P})]}),(0,i.jsxs)("div",{className:"mt-5 flex flex-row justify-between",children:[(0,i.jsxs)("div",{className:"flex gap-x-3",children:[(0,i.jsx)(Visitor_VisitorSearchBar,{}),(0,i.jsx)(Visitor_VisitorFilterButton,{})]}),(0,i.jsx)("div",{className:"min-w-[135px]",children:(0,i.jsx)(l.Z,{})})]}),(0,i.jsx)("div",{className:"mt-4",children:(0,i.jsx)(K,{limit:ee.sg,skip:v,showDemoData:V})}),(0,i.jsx)("div",{className:"mt-4 pb-2",children:(0,i.jsx)(p.Z,{loading:C,isStart:f,isEnd:N,handlePrev:g,handleNext:h})})]})]})]})}VisitorsPage.getLayout=var es=VisitorsPage}},);
//# sourceMappingURL=visitors-6c3c812f5c177cf4.js.map