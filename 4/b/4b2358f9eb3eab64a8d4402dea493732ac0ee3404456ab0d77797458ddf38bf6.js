(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1010:function(t,e,r){"use strict";var a=r(128),i=r(1039),s=r(9),n={data:()=>({threeDSVerificationModal:null,threeDSStepUpForm:null,threeDSTimeoutId:void 0,closedByUser:!0,resFn:null,rejFn:null}),beforeDestroymethods:{createInputcreateForm(t,e){const r=document.createElement("form");return r.setAttribute("method","post"),r.setAttribute("id","3dsStepUpForm"),r.setAttribute("action",t),r.setAttribute("target","3dsStepUp"),e.forEach((),r},onMessage(t){var e,r,a;if([this.$baseUrl,"https://shorts.sex.com/api"].includes(null==t?void 0:t.origin)&&(null==t||null===(e=t.data)||void 0===e?void 0:e.eventType)===s.g.eventType&&"vue-devtools-backend"!==(null==t||null===(r=t.data)||void 0===r?void 0:r.source)&&"vue-devtools-proxy"!==(null==t||null===(a=t.data)||void 0===a?void 0:a.source)){const{data:e}=t;if(this.close3DSVerificationModal(),e.error){window.removeEventListener("message",this.onMessage);const{statusCode:t,extraData:r,code:a,message:i}=e.error,s=new Error(e.error.message);return s.statusCode=t,s.extraData=r,s.code=a,s.message=i,s.localizedMessage=i,this.rejFn(s)}return window.removeEventListener("message",this.onMessage),this.resFn(e)}},async try3DSVerification(t){if(!t||!t.response3DS)return t;await this.show3DSVerificationModal();const{response3DS:e}=t,{threeDSVersion:r}=e;if("2"===r){const{stepUpURL:t,stepUpJWT:r,md:a}=e,i=this.createInput("JWT",r),s=this.createInput("MD",a);this.threeDSStepUpForm=this.createForm(t,[i,s])}if("1"===r){const{acsUrl:t,paReq:r,termUrl:a,md:i}=e,s=this.createInput("TermUrl",a),n=this.createInput("PaReq",r),o=this.createInput("MD",i);this.threeDSStepUpForm=this.createForm(t,[n,s,o])}return document.body.appendChild(this.threeDSStepUpForm),this.threeDSStepUpForm.submit(),new Promise(((t,e)=>{this.resFn=t,this.rejFn=e,window.addEventListener("message",this.onMessage),this.threeDSTimeoutId=setTimeout((()=>{this.close3DSVerificationModal(),e(new Error("3DS verification was not finalized"))}),18e4)}))},show3DSVerificationModal(){return new Promise((t=>{this.threeDSVerificationModal=this.$modal.open({parent:this,component:i.default,canCancel:!0,full:!0,events:{mounted:},{close:()=>{window.removeEventListener("message",this.onMessage),clearTimeout(this.threeDSTimeoutId),this.threeDSStepUpForm&&(this.threeDSStepUpForm.remove(),this.threeDSStepUpForm=null),this.$nuxt.$emit("3DS-failure")}})}))},close3DSVerificationModal},o=r(264);const c=["payments.bank_declined","payments.bank_declined_or_account_over_limit"],l=e.a=t=>{let{on3DSFailure:e}=t;return{mixins:[n],data:()=>({paymentInProgress:!1,subscribeSuccess:!1,productIsBought:!1,paymentError:null,unwatchPaymentDataLoading:null}),computed:{...Object(a.b)({paymentData:"payments/getPaymentData",userSettings:"user/getSettings"}),paymentDataLoading(){var t;return this.paymentData.loading||(null===(t=this.$taxService)||void 0===t?void 0:t.fetchingTaxData)||this.paymentInProgress},fingerprintErrorbankDeclinedErrorhasCard,async mounted(){this.hasCard&&(this.paymentData.deviceFingerprintID||this.paymentData.loading||await this.$store.dispatch("payments/initPaymentToken")),this.$nuxt.$on("3DS-failure",(()=>{this.paymentInProgress=!1,this.$modal.close((t=>{let{meta:{name:e}}=t;return"PaymentConfirmation"===e})),"function"==typeof e&&e(this)})),this.unwatchPaymentDataLoading=this.$watch("paymentDataLoading",()},beforeDestroy(){this.$nuxt.$off("3DS-failure"),"function"==typeof this.unwatchPaymentDataLoading&&this.unwatchPaymentDataLoading()},methods:{async addCard(t){const{ioBlackBox:e}=this.paymentData;this.paymentInProgress=!0,this.paymentError=null;try{const{collectionJWT:r,collectionURL:a}=await this.$api.threeDS.init3DSDeviceFingerprinting(t),i={card:t,ioBlackBox:e,deviceFingerprintID:await Object(o.a)(r,a)},s=await this.$api.cards.add(i),{card:{lastFour:n}}=await this.try3DSVerification(s);this.$showSuccessMessage(this.$t("global.card_added_msg",[n]));const{user:c}=await this.$api.users.me();await this.$store.dispatch("user/updateUser",c),await this.$store.dispatch("payments/initPaymentToken")}catch(r){throw this.paymentError=r,this.$logError(r),r}finally{this.paymentInProgress=!1}},async confirmPayment(t,e){try{if(this.paymentInProgress=!0,this.paymentError=null,this.$taxService.hasTaxData(t)||await this.$taxService.fetchCardTaxData(t,!0),!this.$taxService.missingZipCode){if("confirmed"===await this.$confirmTaxAmount(t,this.price)){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];await e(...a)}}}catch(s){throw this.paymentError=s,this.$logError(s),s}finally{this.paymentInProgress=!1}},async sendTip(t){let e;if(this.$taxService.hasTaxData("tip")||await this.$taxService.fetchCardTaxData("tip",!0),!this.$taxService.missingZipCode){const{deviceFingerprintID:a,ioBlackBox:i}=this.paymentData,s={deviceFingerprintID:a,ioBlackBox:i,...t};try{this.paymentInProgress=!0,this.paymentError=null;const t=await this.$api.tips.sendTip(s);e=await this.try3DSVerification(t)}catch(r){throw this.paymentError=r,this.$logError(r),r}finally{this.paymentInProgress=!1}}return e},onSubscribeSuccessasync buyProduct(t){let e;if(this.$taxService.hasTaxData("ppvMedia")||await this.$taxService.fetchCardTaxData("ppvMedia",!0),!this.$taxService.missingZipCode){const{deviceFingerprintID:a,ioBlackBox:i}=this.paymentData,s={deviceFingerprintID:a,ioBlackBox:i,productUid:t};try{this.paymentInProgress=!0,this.paymentError=null;const t=await this.$api.products.purchaseProduct(s);e=await this.try3DSVerification(t),this.$emit("product-bought",e),this.productIsBought=!0}catch(r){throw this.paymentError=r,this.$logError(r),r}finally{this.paymentInProgress=!1}}},async subscribe(t){let e;if(this.$taxService.hasTaxData("subscription")||await this.$taxService.fetchCardTaxData("subscription",!0),!this.$taxService.missingZipCode){const{deviceFingerprintID:a,ioBlackBox:i}=this.paymentData,s={deviceFingerprintID:a,ioBlackBox:i,creatorUid:t};try{this.paymentInProgress=!0,this.paymentError=null;const t=await this.$api.subscriptions.createSubscription(s);e=await this.try3DSVerification(t),e&&e.subscription&&this.onSubscribeSuccess(e.subscription)}catch(r){throw this.paymentError=r,this.$logError(r),r}finally{this.paymentInProgress=!1}}return e},async doResubscribe(t){try{this.paymentInProgress=!0,this.paymentError=null;const{subscription:e}=await this.$api.subscriptions.enableRebill(t);this.onSubscribeSuccess(e)}catch(e){throw this.paymentError=e,this.$logError(e),e}finally{this.paymentInProgress=!1}},async showPurchaseModal(t,e){let r,a;try{if(this.paymentInProgress=!0,this.paymentError=null,"confirmed"===await this.$purchase(t)){a=this.$modal.getInstance((t=>{let{meta:{name:e}}=t;return"PaymentConfirmation"===e})),a&&a.$refs&&(a.$refs.component.inProgress=!0);const{deviceFingerprintID:i,ioBlackBox:s}=this.paymentData,n=await this.$api.media.purchaseMedia(t.videoUid||t.pictureUid,i,s,e);await this.try3DSVerification(n),r="purchased"}else r="not-sent";this.$modal.close(()}catch(n){var i;this.paymentError=n,null!==(i=a)&&void 0!==i&&null!==(i=i.$refs)&&void 0!==i&&i.component&&null!=n&&n.code&&(a.$refs.component.error=n,a.$refs.component.bankError=l(n)),this.$showErrorMessage(n.localizedMessage),this.$logError(n),r="not-sent"}finally{var s;this.paymentInProgress=!1,null!==(s=a)&&void 0!==s&&null!==(s=s.$refs)&&void 0!==s&&s.component&&(a.$refs.component.inProgress=!1)}return r}}}}},1014:function(t,e,r){var a=r(1031);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,r(8).default)("2143acfc",a,!0,{sourceMap:!1})},1030:function(t,e,r){"use strict";r(1014)},1031:function(t,e,r){var a=r(7)((function(t){return t[1]}));a.push([t.i,"/*purgecss start ignore*/\niframe[data-v-16254007]{\n  width:100%;\n  height:100%;\n  background:#fff;\n  overflow:hidden\n}\n\n/*purgecss end ignore*/",""]),a.locals={},t.exports=a},1039:function(t,e,r){"use strict";r.r(e);var a={data:mountedmethods:{iframeLoaded(t){t.target.contentDocument||(this.showSpinner=!1)}}},i=(r(1030),r(0)),s=Object(i.a)(a,(function(){var t=this,e=t._self._c;return e("sx-modal-card",{attrs:{title:"3DSecure verification",full:""}},[e("div",{staticClass:"flex h-full threeDS-modal items-center justify-center flex-col text-center sx-select"},[e("sx-spinner",{directives:[{name:"show",rawName:"v-show",value:t.showSpinner,expression:"showSpinner"}],staticStyle:{"margin-top":"40px"},attrs:{size:100,color:"inversed"}}),t._v(" "),e("iframe",{directives:[{name:"show",rawName:"v-show",value:!t.showSpinner,expression:"!showSpinner"}],attrs:{name:"3dsStepUp"},on:{load:t.iframeLoaded}})],1)])}),[],!1,null,"16254007",null);e.default=s.exports},1151:function(t,e,r){"use strict";r.r(e);var a=r(1147),i=r(175),s=r.n(i);const n={name:"",number:"",expirationDate:"",cvv:""};var o={directives:{mask:a.a},props:{willCharge:{type:Number,default:0},onSubmit:{type:Function,required:!0},submitText:{type:String,default:()=>(void 0).$t("card_form.default_ok_btn")},error:{type:Error,default:null},bankError:Boolean,buttonColor:{type:String,default:"c-secondary"}},data:()=>({cardChangedFields:{},card:{...n},forceSubmit:!1,success:!1,submitWaiting:!1}),computed:{cardType(){const t=s.a.number(this.card.number);return t.card&&t.card.type},cardIconNamecardMask,methods:{async onSubmitInternal(){const t=this.getCard();this.submitWaiting=!0,await this.onSubmit(t),this.success=!0},getCard(){const[t,e]=this.card.expirationDate.split("/");return{cardNumber:this.card.number.replace(/\s/g,""),expirationMonth:t,expirationYear:e,cvv:this.card.cvv}},clear(){this.card={...n}},onCvvBlurmarkFieldChangedvalidateOnBlur(t,e){this.cardChangedFields[t]&&e()},resetValidation},c=(r(1447),r(0)),l=Object(c.a)(o,(function(){var t=this,e=t._self._c;return e("sxc-form-container",{ref:"cardForm",staticClass:"relative flex flex-wrap",attrs:{"on-submit":t.onSubmitInternal,"force-submit":t.forceSubmit},scopedSlots:t._u([{key:"default",fn:function(r){let{formInfo:a}=r;return[e("div",{staticClass:"w-full p-2"},[e("ValidationProvider",{attrs:{name:t.$t("card_form.card_name_field"),rules:"required|alpha_hyphen_space|min:2|max:50",slim:""},scopedSlots:t._u([{key:"default",fn:function(r){let{errors:a}=r;return[e("sx-form-field",{attrs:{error:a[0]}},[e("sx-input",{attrs:{tabindex:4,type:"text",placeholder:t.$t("card_form.card_name_field"),name:"name on card",autocomplete:"cc-name","x-autocompletetype":"cc-full-name"},model:{value:t.card.name,callback:function(e){t.$set(t.card,"name",e)},expression:"card.name"}})],1)]}}],null,!0)})],1),t._v(" "),e("div",{staticClass:"w-full p-2"},[e("ValidationProvider",{attrs:{name:t.$t("card_form.card_number_field"),rules:"required|card_number",slim:""},scopedSlots:t._u([{key:"default",fn:function(r){let{errors:a,validate:i}=r;return[e("sx-form-field",{attrs:{error:a[0]}},[e("sx-input",{directives:[{name:"mask",rawName:"v-mask",value:t.cardMask,expression:"cardMask"}],staticClass:"card-number-input",attrs:{tabindex:1,name:"card number",placeholder:t.$t("card_form.card_number_field"),autocomplete:"cc-number","x-autocompletetype":"cc-number",autocorrect:"off",spellcheck:"false",inputmode:"numeric"},on:{input:()=>t.markFieldChanged("number"),blur:()=>t.validateOnBlur("number",i)},scopedSlots:t._u([{key:"iconRight",fn:function(){return[e("transition",{attrs:{name:"card-transition",mode:"out-in"}},[t.cardIconName?e("sx-icon",{key:"cardFront",staticClass:"card-icon",attrs:{name:t.cardIconName,height:"40"}}):t._e()],1)]},proxy:!0}],null,!0),model:{value:t.card.number,callback:function(e){t.$set(t.card,"number",e)},expression:"card.number"}})],1)]}}],null,!0)})],1),t._v(" "),e("div",{staticClass:"w-1/2 p-2"},[e("ValidationProvider",{attrs:{name:t.$t("card_form.expiry_date_field"),rules:"required|card_expiration_date",slim:""},scopedSlots:t._u([{key:"default",fn:function(r){let{errors:a,validate:i}=r;return[e("sx-form-field",{attrs:{error:a[0]}},[e("sx-input",{directives:[{name:"mask",rawName:"v-mask",value:"##/##",expression:"'##/##'"}],attrs:{tabindex:2,name:"expiry date",placeholder:t.$t("card_form.expiry_date_field"),autocomplete:"cc-exp","x-autocompletetype":"cc-exp",autocorrect:"off",spellcheck:"false",inputmode:"numeric"},on:{input:()=>t.markFieldChanged("expirationDate"),blur:,model:{value:t.card.expirationDate,callback:function(e){t.$set(t.card,"expirationDate",e)},expression:"card.expirationDate"}})],1)]}}],null,!0)})],1),t._v(" "),e("div",{staticClass:"w-1/2 p-2"},[e("ValidationProvider",{attrs:{name:"CVV",rules:"required|card_cvv",slim:""},scopedSlots:t._u([{key:"default",fn:function(r){let{errors:a,validate:i}=r;return[e("sx-form-field",{attrs:{error:a[0]}},[e("sx-input",{directives:[{name:"mask",rawName:"v-mask",value:"###",expression:"'###'"}],attrs:{tabindex:3,placeholder:"CVV",autocomplete:"off",autocorrect:"off",spellcheck:"false",inputmode:"numeric","data-cy-id":"cvv-input"},on:{input:blur:,model:{value:t.card.cvv,callback:expression:"card.cvv"}})],1)]}}],null,!0)})],1),t._v(" "),t.error?e("div",{staticClass:"w-full p-2.5 text-sm text-center mx-2",class:{"text-white bg-error mt-3 mb-1":t.bankError,"text-error":!t.bankError}},[t._v("\n    "+t._s(t.error.localizedMessage)+"\n  ")]):t._e(),t._v(" "),e("div",{staticClass:"w-full p-2 pt-4"},[e("sx-form-field",{attrs:{actions:""}},[e("sx-button",{attrs:{tabindex:5,"data-cy-id":"add-card-button",color:t.buttonColor,size:"R",block:"",loading:a.submitting}},[t._v("\n        "+t._s(t.submitText)+"\n      ")])],1)],1)]}}])})}),[],!1,null,"3168e2f4",null);e.default=l.exports},1266:1447:1448:]);