(()=>{"use strict";var e,t,i;!function(e){e.HISTORY_MUTATION="_pbstck_kleanads_historyMutation",e.PAGE_CHANGE="_pbstck_kleanads_pageChange"}(e||(e={})),function(e){e.SPA_RELOAD="admSPAReload"}(t||(t={})),function(e){e.REPLACE_STATE="replaceState",e.PUSH_STATE="pushState"}(i||(i={}));const n=t=>{window.history[t]=new Proxy(window.history[t],{apply(i,n,s){const o=window.location.href,a=i.apply(n,s),r=new CustomEvent(e.HISTORY_MUTATION,{detail:{referrer:o,stateObj:s[0],title:s[1],url:s[2],type:t}});return dispatchEvent(r),a}})};var s;const o=/kleanads:debug/.test(window.location.href),a=!!(null===(s=window.localStorage)||void 0===s?void 0:s.getItem)&&null!==window.localStorage.getItem("kleanads"),r=!1;function d(){return r||o||a}function l(e,t){return`[${e}] [${performance.now().toFixed(2)}] ${t}`}function c(e,t,...i){d()&&console.log(l(e,t),...i)}function u(e,t,...i){d()&&console.error(l(e,t),...i)}class f{constructor(e,t){this.tagId=e,this.kleanadsVersion=t}handleMessage(e,t){const i={source:"kleanads",type:"log",level:e,message:t,tagId:this.tagId,kleanadsVersion:this.kleanadsVersion,href:window.location.href};var n;n=i,navigator.sendBeacon("https://intake.pbstck.com/v1/trace",JSON.stringify(n)),m("[datadog] log sent to Datadog: ",i)}error(e){this.handleMessage("error",e)}warn(e){this.handleMessage("warn",e)}}const g="kleanads";let p,h="nd",v="nd",b="nd";function m(e,...t){c(g,e,...t)}function y(e,...t){!function(e,t,...i){d()&&console.debug(l(e,t),...i)}(g,e,...t)}function w(e,...t){!function(e,t,...i){d()&&console.warn(l(e,t),...i)}(g,e,...t),p.warn(e)}function A(e,...t){u(g,e,...t),p.error(e),navigator.sendBeacon(`https://intake.pbstck.com/v1/intake/error?tId=${h}&v=${v}&s=${b}&c=1`,JSON.stringify([{message:e}]))}function S(e,t){const i=document.createElement("meta");i.setAttribute("name",`pbstck:${e}`),i.content=t,document.getElementsByTagName("head")[0].appendChild(i)}function k(e){const t=document.querySelector(`meta[name="pbstck:${e}"]`);t&&t.remove()}function C(e,t){const i=document.createElement("meta");i.setAttribute("name",`ad:${e}`),i.content=t,document.getElementsByTagName("head")[0].appendChild(i)}function E(e){const t={};e.document.querySelectorAll('meta[name^="ad:"]').forEach((e=>{const i=function(e){var t;const i=(null===(t=e.attributes.getNamedItem("name"))||void 0===t?void 0:t.value)||"";return i.startsWith("ad:")?i.slice(3):i}(e);i&&(t[i]=function(e){var t;return((null===(t=e.attributes.getNamedItem("content"))||void 0===t?void 0:t.value)||"").split(",")}(e))}));const i=new URLSearchParams(e.location.search);for(const e of i.keys())e.startsWith("ad:")&&(c("kleanads-common",`Add key ${e} found in URL to metaTargetings`),t[e.slice(3)]=i.getAll(e));return t}function $(){const e=document.head.querySelector('meta[name="ad:no_cmp"]');return!!e&&"true"===e.content}function I(e,t){const i=function(e,t){const i=document.createElement("script");return i.setAttribute("src",e),t&&Object.keys(t).forEach((function(e){i.setAttribute("data-pubstack-"+e,t[e])})),i}(e,t);i.setAttribute("async","true"),i.setAttribute("data-kleanads","true"),document.head.append(i)}async function U(e,t=3){return x((()=>import(e)),t).then((e=>e)).catch((i=>{throw A(`Failed to load module ${e} after ${t} retries`,i),new Error("Too many failed attempt to load external module.")}))}const O=e=>new Promise((t=>setTimeout(t,e)));function x(e,t){return new Promise(((i,n)=>e().then(i).catch((i=>t>1?O(100).then(x.bind(null,e,t-1)).then((e=>e)).catch(n):n(i)))))}function T(e,t){return e.size<t.size?1:e.size>t.size?-1:0}function P(e){return e.filter(L)}function _(e){return e>=100||e>=Math.floor(100*Math.random())+1}function j(e){if(100!==e.reduce(((e,t)=>e+t),0))return m("The sum of all probabilities should be equal to 100 and is not, we use the first version of the ab test"),1;const t=e.reduce(((e,t)=>(e.length?e.push(e[e.length-1]+t):e.push(t),e)),[]),i=Math.floor(100*Math.random())+1;return t.findIndex((e=>i<=e))+1}function L(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}const R={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let N;const D=new Uint8Array(16);function M(){if(!N&&(N="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!N))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return N(D)}const z=[];for(let e=0;e<256;++e)z.push((e+256).toString(16).slice(1));const B=function(e,t,i){if(R.randomUUID&&!t&&!e)return R.randomUUID();const n=(e=e||{}).random||(e.rng||M)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=n[e];return t}return function(e,t=0){return z[e[t+0]]+z[e[t+1]]+z[e[t+2]]+z[e[t+3]]+"-"+z[e[t+4]]+z[e[t+5]]+"-"+z[e[t+6]]+z[e[t+7]]+"-"+z[e[t+8]]+z[e[t+9]]+"-"+z[e[t+10]]+z[e[t+11]]+z[e[t+12]]+z[e[t+13]]+z[e[t+14]]+z[e[t+15]]}(n)},F=(e,t)=>"fluid"===e&&"fluid"===t||e[0]===t[0]&&e[1]===t[1],W=e=>!!e.sizes.find((e=>F(e,[1800,1e3])));function H(e){var t;const i=null!==(t=e.values)&&void 0!==t?t:[];return e.value?e.value:i}function V(e){return e.pubstackNameOverride?e.pubstackNameOverride:e.adServerAdUnitName}function G(){window,window.sublime=window.sublime||{};const e=window.sublime.notifyId||B();return window.sublime.notifyId=e,e}const J=(e,t)=>({...e,bids:t,mediaTypes:{video:{mimes:["video/mp4","video/webm","application/javascript"],context:"instream",playerSize:[640,480]}}}),K=(e,t,i)=>({...t,bids:i.filter((t=>e.biddersOutstream.includes(t.bidder))),mediaTypes:{video:{context:"outstream",playerSize:[640,480],mimes:["video/mp4","video/ogg","video/webm","application/javascript"],protocols:[1,2,3,4,5,6,7,8,11,12,13,14],api:[1,2,3,5,6,7],playbackmethod:[2,3,4],skip:1,linearity:2,startdelay:0,placement:3,plcmt:4,playVideoVisibleThreshold:25,nonViewableBehavior:"pause"}},renderer:{url:"https://acdn.adnxs.com/video/outstream/ANOutstreamVideo.js",options:{adText:"",aspectRatio:"16:9",skippable:{enabled:!0,skipButtonText:"SKIP"}}}}),q=["adyoulike"],Y=(e,t,i)=>{const n=e.biddersSkin?i.filter((t=>{var i;return null===(i=e.biddersSkin)||void 0===i?void 0:i.includes(t.bidder)})):i,s={...t,bids:n.filter((e=>!q.includes(e.bidder))),mediaTypes:{banner:{sizes:[[1800,1e3]]}}},o=P(e.sizes).filter((e=>!F(e,[1800,1e3])));return o.length>0?[{...t,bids:i,mediaTypes:{banner:{sizes:o}}},s]:[s]},X=(e,t,i)=>({...t,bids:i,mediaTypes:{banner:{sizes:P(e.sizes)}}});const Q="[DOM]";function Z(e){return null!==document.getElementById(e)}function ee(e){const t=document.getElementById(e);return t?t.getBoundingClientRect().top:(A(`${Q} div ${e} not found`),0)}const te="adServerAdUnitName";function ie(e){return e&&"string"==typeof e?e:void 0}function ne(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function se(e){var t,i,n,s,o,a,r,d,l;if(!ne(e))throw new Error("unable to parse JSON: adUnit is not valid");const c=oe(e.divId,"divId"),u=oe(e.adUnitName,"adUnitName"),f=function(e,t){if(!Array.isArray(e))throw new Error(`Unable to parse JSON: the sizes field ${e} is not a valid list of Size`);return e}(e.sizes),g=function(e,t){if(!Array.isArray(e))throw new Error(`Unable to parse JSON: the bidders field ${e} is not a valid list of PrebidBidder`);for(const t of e)if("string"!=typeof t.bidder)throw new Error(`Unable to parse JSON: the bidder field ${t.bidder} (inside bidders) is not a valid bidder name`);return e}(e.bidders),p=ae(e.parallax,"parallax",!1),h=ae(e.dynamic,"dynamic",!1),v=ae(e.sticky,"sticky",!1),b=re(e.targeting,"targeting"),m=function(e,t){if(!e)return;if(!Array.isArray(e))throw new Error(`Unable to parse JSON: the ${t} field ${e} is not valid KeyValueTargeting list`);const i=[];for(const n of e){const e=re(n,t);e&&i.push(e)}return i}(e.extraTargetings,"extraTargetings");if("boolean"!=typeof e.lazyLoading)throw new Error("unable to parse JSON: the lazyLoading field is not valid");if(void 0!==e.pubstackNameOverride&&"string"!=typeof e.pubstackNameOverride)throw new Error("unable to parse JSON: the pubstackNameOverride field is not valid");if(void 0!==e.floors&&!ne(e.floors))throw new Error("unable to parse JSON: the floors field is not valid");if(void 0!==(null===(t=e.floors)||void 0===t?void 0:t.currency)&&"string"!=typeof(null===(i=e.floors)||void 0===i?void 0:i.currency))throw new Error("unable to parse JSON: the floors field is missing the currency");if(void 0!==(null===(n=e.floors)||void 0===n?void 0:n.schema)&&!ne(null===(s=e.floors)||void 0===s?void 0:s.schema))throw new Error("unable to parse JSON: the floors field is missing the schema");if(e.floors){if("string"!=typeof(null===(o=e.floors.schema)||void 0===o?void 0:o.delimiter))throw new Error("unable to parse JSON: the floors schema field is missing the delimiter");if(!Array.isArray(null===(a=e.floors.schema)||void 0===a?void 0:a.fields))throw new Error("unable to parse JSON: the floors field schema delimiter is not an array");for(const t of e.floors.schema.fields)if(void 0===t||"string"!=typeof t)throw new Error("unable to parse JSON: the bidder field inside bidders array is not valid")}if(void 0!==(null===(r=e.floors)||void 0===r?void 0:r.values)&&"object"!=typeof(null===(d=e.floors)||void 0===d?void 0:d.values))throw new Error("unable to parse JSON: the floors field is missing the values or they are not well formed");if(void 0!==e.extraAdServerSizes&&!Array.isArray(e.extraAdServerSizes))throw new Error(`unable to parse JSON: the extraAdServerSizes field for adunit ${c} is not valid: ${e.extraAdServerSizes}`);let y,w,A,S;if(void 0!==e.canOutstream&&"boolean"!=typeof e.canOutstream)throw new Error("unable to parse JSON: the canOutstream field is not valid");if(y=e.canOutstream,void 0!==e.isInstream&&"boolean"!=typeof e.isInstream)throw new Error("unable to parse JSON: the isInstream field is not valid");if(w=e.isInstream,e.biddersOutstream){if(!Array.isArray(e.biddersOutstream))throw new Error(`unable to parse JSON: the biddersOutstream field for adunit ${c} is not valid: ${e.biddersOutstream}`);for(const t of e.biddersOutstream)if("string"!=typeof t)throw new Error("unable to parse JSON: the value inside biddersOutstream array is not valid")}switch(e.outOfPageType){case"interstitial":case"default":A=e.outOfPageType;break;default:A=void 0}switch(e.roadblock){case"master":case"companion":S=e.roadblock;break;default:S=void 0}return{divId:c,adUnitName:u,sizes:f,pubstackNameOverride:e.pubstackNameOverride,adServerAdUnitName:e.adServerAdUnitName,slotName:e.slotName,bidders:g,parallax:p,dynamic:h,targeting:b,extraTargetings:m,lazyLoading:e.lazyLoading,sticky:v,stickyDivCreation:!!e.stickyDivCreation,floors:e.floors,extraAdServerSizes:e.extraAdServerSizes,headerBiddingEnabled:ae(e.headerBiddingEnabled,"headerBiddingEnabled",!0),canOutstream:y,isInstream:w,biddersOutstream:null!==(l=e.biddersOutstream)&&void 0!==l?l:[],outOfPageType:A,roadblock:S}}function oe(e,t){if("string"!=typeof e)throw new Error(`Unable to parse JSON: the ${t} field ${e} is not a valid string`);return e}function ae(e,t,i){if(void 0!==e&&"boolean"!=typeof e)throw new Error(`Unable to parse JSON: the ${t} field ${e} is not a valid boolean`);return null!=e?e:i}function re(e,t){if(!e)return;if(!ne(e))throw new Error(`Unable to parse JSON: the ${t} field ${e} is not a valid KeyValueTargeting`);const i=oe(e.key,t),n=ie(e.value),s=function(e){if(e&&Array.isArray(e))return e}(e.values);if(!n&&!s)throw new Error(`Unable to parse JSON: targeting.value(s) is not valid for field ${t}`);return{key:i,value:n,values:s}}function de(e,t,i,n,s){return e.flatMap((e=>{var o,a,r;const d=function(e,t,i,n){const s=[];if("number"!=typeof t&&""===t||s.push(t),i&&0!==i.length){const e=function(e,t){return e.filter((e=>e!==te)).map((e=>t.get(e))).filter((e=>e)).join("/")}(i,n);e&&s.push(e)}else w("Ad unit path config is missing for this site");const o=`/${s.join("/")}`;return i&&i.includes(te)?`${o}/${e}`:`${o}`}(e.adServerAdUnitName||e.divId,i,n,t);if(e.dynamic)return function(e,t,i){return function(e){var t;if(e.dynamic){const i=[],n=null!==(t=e.cssSelector)&&void 0!==t?t:`[id^="${e.divId}"]`;return document.querySelectorAll(n).forEach((t=>{const n=t.id.replace(e.divId,"");/[a-zA-Z]/g.test(n)&&!e.cssSelector||i.push(t.id)})),i}return[e.divId]}(e).map((n=>{var s,o,a;return{...e,canOutstream:null!==(s=e.canOutstream)&&void 0!==s&&s,isInstream:null!==(o=e.isInstream)&&void 0!==o&&o,extraTargetings:[...e.extraTargetings||[],...ue(e.divId),le(e.divId,n)],divId:n,slotName:e.slotName||t,dynamic:!1,adUnitPath:t,adServerAdUnitName:null!==(a=e.adServerAdUnitName)&&void 0!==a?a:e.divId,pubstackAdUnitPathDeclaration:ce(e,t,i)}}))}(e,d,s);{let t=e.divId;if(e.cssSelector){const i=function(e){try{return Array.from(document.querySelectorAll(e)).map((e=>e.id))}catch(t){return m(`${Q} ${e} is not a valid CSS selector`),[]}}(e.cssSelector);i.length&&(t=i[0])}return Z(t)||"interstitial"===e.outOfPageType||e.sticky&&e.stickyDivCreation?[{...e,divId:t,canOutstream:null!==(o=e.canOutstream)&&void 0!==o&&o,isInstream:null!==(a=e.isInstream)&&void 0!==a&&a,extraTargetings:[...e.extraTargetings||[],...ue(t)],adUnitPath:d,slotName:e.slotName||d,adServerAdUnitName:null!==(r=e.adServerAdUnitName)&&void 0!==r?r:t,pubstackAdUnitPathDeclaration:ce(e,d,s)}]:(m(`Div id missing for ${e.divId}, no further action on this ad unit`),[])}}))}function le(e,t){const i=new RegExp(`${e}|\\D`,"g");return{key:"ad_index",value:t.replace(i,"")}}function ce(e,t,i){var n;const s=null!==(n=e.extraTargetings)&&void 0!==n?n:[];e.targeting&&s.push(e.targeting);const o=(null!=i?i:[]).map((e=>{const t=s.find((t=>t.key===e));if(t)return t;{const t=E(window)[e];return t?{key:e,values:t}:void 0}})).filter((e=>!!e)).map((e=>`${e.key}=${function(e){const t=e.values?e.values.join(","):"";return e.value?e.value:t}(e)}`)).join("&"),a=t.includes("?")?"&":"?";return o.length>0?`${t}${a}${o}`:t}function ue(e){const t=document.getElementById(e);return(null==t?void 0:t.hasAttributes())?Array.from(t.attributes).filter((e=>e.name.startsWith("data-ad-"))).map((e=>({key:e.name.replace("data-ad-",""),value:e.value}))):[]}function fe(e){if(!e)return;if(!ne(e))throw new Error("unable to parse JSON: lazyLoadingGoogle field is not valid");if(0===Object.keys(e).length||!e.googleFetchMarginPercent&&!e.googleRenderMarginPercent&&!e.googleMobileScaling)return{};const t={};return"number"==typeof e.googleFetchMarginPercent&&(t.googleFetchMarginPercent=e.googleFetchMarginPercent),"number"==typeof e.googleRenderMarginPercent&&(t.googleRenderMarginPercent=e.googleRenderMarginPercent),"number"==typeof e.googleMobileScaling&&(t.googleMobileScaling=e.googleMobileScaling),t}function ge(e){if(null==e)return;if(!ne(e))throw new Error("unable to parse JSON: lazyLoadingKleanads field is not valid");let t;return"number"!=typeof e.viewportPercent?e.numberOfViewports&&"number"==typeof e.numberOfViewports?t=e.numberOfViewports:(w("unable to parse JSON: the lazyLoadingKleanads field is not valid, falling back to 0 viewport"),t=0):t=e.viewportPercent,{viewportPercent:t}}function pe(e){if(null!=e){if(!ne(e))throw new Error("unable to parse JSON: lazyLoading field is not valid");if("string"!=typeof e.configName)throw new Error("unable to parse JSON: the lazyLoading's configName field is not valid");return{configName:e.configName,lazyLoadingGoogle:fe(e.lazyLoadingGoogle),lazyLoadingKleanads:ge(e.lazyLoadingKleanads)}}}function he(e){if(!Array.isArray(e))throw new Error("unable to parse JSON: the adUnits field is not valid");const t=[];for(const i of e)try{t.push(se(i))}catch(e){A("Invalid ad unit configuration",e)}return t}function ve(e){if(!function(e){if(!e)throw new Error("unable to parse JSON: prebidConfig field is not valid");return Object.keys(e).includes("adCallTimeout")&&Object.keys(e).includes("pbjsConfig")}(e))throw new Error("unable to parse JSON: prebidConfig field is not valid");if("number"!=typeof e.adCallTimeout)throw new Error("unable to parse JSON: the prebidConfig's adCallTimeout field is not valid");return{adCallTimeout:e.adCallTimeout,pbjsConfig:be(e.pbjsConfig)}}function be(e){if(!ne(e))throw new Error("unable to parse JSON: pbjsConfig field is not valid");void 0===e.allowLocalStorage&&(e.allowLocalStorage=!0);const t=me(e,"userSync"),i=me(e,"outbrain"),n=me(e,"realTimeData"),s=me(e,"analytics"),o=me(e,"currency"),a=me(e,"bidderConfigs"),r=me(e,"priceGranularity"),d=me(e,"floors"),l=me(e,"schain");return{...e,...t&&{userSync:t},...i&&{outbrain:i},...n&&{realTimeData:n},...s&&{analytics:s},...a&&{bidderConfigs:a},...o&&{currency:o},...r&&{priceGranularity:r},...d&&{floors:d},...l&&{schain:l}}}const me=(e,t)=>{if(!(t in e))return;const i=ie(e[t]);if(i)try{return JSON.parse(i)}catch(e){A(`unable to parse JSON in pbjsConfigFromPartial: ${t} `,e)}};var ye,we;!function(e){e.BEGIN="begin",e.CMP_RESPONSE_AVAILABLE="cmp_response_available",e.MAIN_THREAD_END="main_thread_end",e.GOOGLETAG_READY="googletag_ready",e.APSTAG_READY="apstag_ready"}(ye||(ye={})),function(e){e.START_AUCTION="start_auction",e.END_PBJS_AUCTION="end_pbjs_auction",e.END_APS_AUCTION="end_aps_auction",e.START_AD_SERVER_CALL="start_ad_server_call",e.SLOT_RENDER_ENDED_TIME="slot_render_ended_time",e.SLOT_RESPONSE_RECEIVED_TIME="slot_response_received_time"}(we||(we={}));const Ae=[],Se=[],ke="getEntriesByName"in performance&&"measure"in performance&&"mark"in performance;function Ce(e){Ae.includes(e)||(Te(e),Ae.push(e))}function Ee(e,t){const i=xe(e,t);Se.includes(i)||(Te(i),Se.push(i))}function $e(e){if(Ae.includes(e))return function(e){if(ke)return performance.getEntriesByName(e)[0].startTime}(e)}function Ie(e,t){if(Ae.includes(e)&&Ae.includes(t))return Pe(e,t)}function Ue(e,t,i){const n=xe(e,i);if(Ae.includes(t)&&Se.includes(n))return Pe(t,n)}function Oe(e,t,i){const n=xe(e,t),s=xe(e,i);if(Se.includes(n)&&Se.includes(s))return Pe(n,s)}function xe(e,t){return`${e}_${t}`}function Te(e){ke&&(performance.mark(e.toString()),m(`[performance] [mark] ${e}: ${performance.getEntriesByName(e)[0].startTime.toFixed(2)}`))}function Pe(e,t){if(ke){const i=`measure_${e}_${t}`,n=performance.getEntriesByName(i);if(0!==n.length&&"measure"===n[0].entryType)return n[0].duration;try{return performance.measure(i,e,t).duration}catch{return}}}class _e{constructor(e){this.subscriptions=[],this.children=[],this.processingChain=e?[...e]:[]}subscribe(e,t){this.subscriptions.push({onEvent:e,onError:t})}pipe(...e){const t=new _e([...this.processingChain,...e]);return this.children.push(t),t}next(e){this.subscriptions.forEach((t=>{try{const i=this.processingChain.reduce(((e,t)=>{if(void 0!==e)return t(e)}),e);void 0!==i&&t.onEvent(i)}catch(e){t.onError&&t.onError(e)}})),this.children.forEach((t=>t.next(e)))}}const je=new _e;class Le{constructor(e,t,i,n){this.METRIC_THROTTLING_PERCENTAGE=10,this.tagId=e,this.kleanadsVersion=t,this.device=i,this.shouldSent=!n||100*Math.random()<this.METRIC_THROTTLING_PERCENTAGE,this.shouldSent||m("[datadog] metric won't be sent to datadog (throttling)")}handleMetric(e){const t={service:"kleanads-metrics",metricName:e.name,tagId:this.tagId,kleanadsVersion:this.kleanadsVersion,href:window.location.href,device:this.device,...e.values};this.shouldSent&&(function(e){const t=new XMLHttpRequest;t.open("POST","https://browser-http-intake.logs.datadoghq.com/v1/input/pub2f38e2a04ccec3ab476490c076a8ed37?ddsource=browser&ddtags=version:1.3.2",!0),t.setRequestHeader("Content-Type","text/plain"),t.send(JSON.stringify(e))}(t),m("[datadog] metric sent to Datadog: ",t))}}var Re;!function(e){e.UNKNOWN="unknown",e.ALREADY_CONSENT="already_consent",e.WAIT_USER_CONSENT="wait_user_consent",e.ALREADY_REFUSED="already_refused",e.WAIT_USER_REFUSED="wait_user_refused"}(Re||(Re={}));let Ne=Re.UNKNOWN;const De=[];function Me(e,t){De.includes(e)||(je.next({name:"adunit",values:Fe(e,t)}),De.push(e))}const ze=new Map;function Be(e){const t=function(e){const t=performance.getEntriesByName(e);return t.length>0&&"mark"===t[0].entryType}(ye.GOOGLETAG_READY);ze.set(e,t)}function Fe(e,t){return{adUnit:e,consentType:Ne,eventOrigin:t,startAuctionFromConsent:Ue(e,ye.CMP_RESPONSE_AVAILABLE,we.START_AUCTION),pbjsAuctionDuration:Oe(e,we.START_AUCTION,we.END_PBJS_AUCTION),apsAuctionDuration:Oe(e,we.START_AUCTION,we.END_APS_AUCTION),startAdServerCallFromConsent:Ue(e,ye.CMP_RESPONSE_AVAILABLE,we.START_AD_SERVER_CALL),slotRenderEndedFromConsent:Ue(e,ye.CMP_RESPONSE_AVAILABLE,we.SLOT_RENDER_ENDED_TIME),adServerResponseDuration:Oe(e,we.START_AD_SERVER_CALL,we.SLOT_RESPONSE_RECEIVED_TIME),totalAdCallDuration:Oe(e,we.START_AUCTION,we.SLOT_RENDER_ENDED_TIME),isGoogletagReadyAtPbjsAuctionEnd:ze.get(e)}}function We(e){return new Promise(((t,i)=>{!function(e,t,i){var n;(n=e,new Promise(((e,t)=>He(n,e,t)))).then((()=>{try{!function(e,t){(function(e){return e.__tcfapi})(e)("addEventListener",2,(e=>{if(e&&("useractioncomplete"===e.eventStatus||"tcloaded"===e.eventStatus)){m("[consent] Consent status ",e.eventStatus),Ce(ye.CMP_RESPONSE_AVAILABLE);const n=function(e){if(!e.purpose.consents||0===Object.keys(e.purpose.consents).length)return!1;for(const t in e.purpose.consents)if(!e.purpose.consents[t])return!1;return!0}(e);i=n?Re.WAIT_USER_CONSENT:Re.WAIT_USER_REFUSED,Ne=i,t(n)}var i}))}(e,t)}catch(e){m("[consent] Error while loading tcf api"),i(e)}})).catch((e=>{m("[consent] Error while loading tcf api",e),i(e)}))}(e,t,i)}))}function He(e,t,i){const n=e.__tcfapi;n&&function(e){if("function"!=typeof e)throw new Error("__tcfapi is not a function");return!0}(n)?t():setTimeout((()=>He(e,t,i)),100)}function Ve(e){return e.map((e=>({key:e.key.toLowerCase(),defaultValue:e.defaultValue?e.defaultValue.toLowerCase():void 0,otherValues:e.otherValues?e.otherValues.map((e=>e.toLowerCase())):[]})))}const Ge={pbjsFinished:!1,apsFinished:!1},Je="[executor] [instream]";class Ke{constructor(e,t,i,n,s){this.rank=1,this.adServer=e,this.pbjs=t,this.aps=i,this.bidderAliases=n,this.kleanadsRunCount=s}executeAdCall(e){setTimeout((()=>{Me(e.divId,"executorTimeout")}),2e4),this.adUnitAuctionStatus?w(`${Je} cannot make a new ad call, existing one on ${e.divId}.`):(m(`${Je} executeAdCall for adunit`,e),this.startAuction(e))}executeRefresh(e){this.adServer.cleanTargetings();const t={labels:["pubstackRefresh",`pubstackRefreshRank:${e.rank}`]};this.startAuction(e.adUnit,t)}startAuction(e,t){if(this.adUnitAuctionStatus=Ge,Ee(e.divId,we.START_AUCTION),m(`${Je} starting auctions for ${e.divId}`),this.pbjs){const i=this.pbjs.getPbjs();this.pbjs.startPbjsAuction([e],(()=>{this.kleanadsRunCount===si?this.pbjsFinished(i,e):m(`${Je} kleanads run count has changed (from ${this.kleanadsRunCount} to ${si}), avoid calling pbjsFinished`)}),this.bidderAliases,t)}this.aps&&this.aps.startApsAuction([e],((t,i)=>{this.kleanadsRunCount===si?this.apsFinished(t,e,i):m(`${Je} kleanads run count has changed (from ${this.kleanadsRunCount} to ${si}), avoid calling apsFinished`)})),this.pbjs||this.aps||this.adServer.executeWhenAdServerReady((()=>{this.kleanadsRunCount===si?this.callAdServer(e):m(`${Je} kleanads run count has changed (from ${this.kleanadsRunCount} to ${si}), avoid calling AdServer`)}))}isAlreadyMonetized(){return!!this.adUnitAuctionStatus}pbjsFinished(e,t){m(`${Je} pbjs end callback for ${t.divId}`,e.getAllPrebidWinningBids()),Ee(t.divId,we.END_PBJS_AUCTION),Be(t.divId),this.adServer.executeWhenAdServerReady((()=>{m(`${Je} pbjs end callback ad server ready ${t.divId}`),this.adServer.setPbjsTargetings(e,t),this.adUnitAuctionStatus&&(this.adUnitAuctionStatus.pbjsFinished=!0),this.canCallAdServer()&&this.callAdServer(t)}))}apsFinished(e,t,i){m(`${Je} aps end callback ${t.divId}`,i),Ee(t.divId,we.END_APS_AUCTION),this.adServer.executeWhenAdServerReady((()=>{m(`${Je} aps end callback ad server ready ${t.divId}`),this.adServer.setApsTargetings(e,i),this.adUnitAuctionStatus&&(this.adUnitAuctionStatus.apsFinished=!0),this.canCallAdServer()&&this.callAdServer(t)}))}canCallAdServer(){const e=this.adUnitAuctionStatus;return this.aps&&!this.pbjs?e&&e.apsFinished:this.pbjs&&!this.aps?e&&e.pbjsFinished:this.pbjs&&this.aps?e&&e.apsFinished&&e.pbjsFinished:void 0}callAdServer(e){Ee(e.divId,we.START_AD_SERVER_CALL),this.adServer.callAdServer(e,(()=>{m(`${Je} onCallFinished called, adding setTimeout to a new auction`),setTimeout((()=>{this.executeRefresh({adUnit:e,rank:this.rank}),this.rank++}),5e3)})),m(`${Je} ad server called ${e.divId}`)}}function qe(e){if("string"==typeof e)return!0;if(Array.isArray(e)){for(const t of e)if("string"!=typeof t)return!1;return!0}return!1}function Ye(e,t,i){const n=t.getTargeting(i);n&&n.length>0&&(m(`removing ${i} targeting from slot ${e}`),t.clearTargeting(i))}const Xe="bid_bidder",Qe="bid_size",Ze="bid_mediatype";class et{constructor(){this.uprEnabled=!0}setUprState(e){switch(e){case"disabled":this.uprEnabled=!1;break;case"tested":this.uprEnabled=_(50),this.uprTested=!0;break;default:this.uprEnabled=!0}}static getInstance(){return et.instance||(et.instance=new et),et.instance}}const tt="[GAM]",it="xp_name",nt="ad_adunitname",st=[3,1];let ot=!1;const at=[];function rt(e){return new Promise(((t,i)=>lt(e,t,i)))}const dt=50;function lt(e,t,i){if(e.googletag)try{e.googletag.apiReady?t():setTimeout((()=>lt(e,t,i)),dt)}catch(e){i(e)}else setTimeout((()=>lt(e,t,i)),dt)}const ct=e=>{const t=e.slot,i=t.getSlotElementId();Ee(i,we.SLOT_RENDER_ENDED_TIME),Me(i,"slotRenderEnded"),function(e,t){Ye(e,t,"ad_floor-rule"),Ye(e,t,"prkv")}(i,t),m(`slot render ended for ${i}`)},ut=e=>{const t=e.slot.getSlotElementId();m(`slot response received for ${t}`),Ee(t,we.SLOT_RESPONSE_RECEIVED_TIME)};function ft(e,t){let i=!1;if(e.targeting){const n=H(e.targeting),s=e.targeting.key;t.setTargeting(s,n),m(`${tt} adding targeting (${e.targeting.key}, ${n}) to adunit ${e.divId}`),s===nt&&(i=!0)}if(e.extraTargetings)for(const n of e.extraTargetings){const s=H(n),o=n.key;t.setTargeting(o,s),m(`${tt} adding targeting (${n.key}, ${s}) to adunit ${e.divId}`),o===nt&&(i=!0)}i||t.setTargeting(nt,[e.adServerAdUnitName])}function gt(e){ot?e():at.push(e)}class pt{constructor(e,t){var i;this.pubstackWindow=e,this.prebidOrderIds=(null===(i=t.globalRefreshConfig)||void 0===i?void 0:i.prebidOrderIds)||[]}init(e,t,i){!function(e,t,i,n){rt(e).then((()=>{m("googletag ready, starting initialization"),e.googletag.pubads().disableInitialLoad(),e.googletag.pubads().enableSingleRequest()||A("unable to enable single request"),function(e,t,i){const n=e.googletag.pubads();i.forEach(((e,t)=>{e&&n.setTargeting(t,e)}));const s=E(e);m("[targetings] here are the targetings",s),Object.keys(s).forEach((e=>{n.setTargeting(e,s[e])})),n.setTargeting("adm","1"),n.setTargeting("device",t),n.setTargeting(it,"1");const o=et.getInstance().grapeshotValues;if((null==o?void 0:o.length)&&n.setTargeting("gs_cat",o),et.getInstance().uprTested){m(`${tt} setting xp_variant/pbstck_ab_test gam targeting value any previous value will be ignored`);const e=`floor_optimization:${et.getInstance().uprEnabled}`;n.setTargeting("xp_variant",e),n.setTargeting("pbstck_ab_test",e)}}(e,t,i),e.googletag.enableServices(),n&&n.lazyLoadingGoogle&&e.googletag.pubads().enableLazyLoad({fetchMarginPercent:n.lazyLoadingGoogle.googleFetchMarginPercent,renderMarginPercent:n.lazyLoadingGoogle.googleRenderMarginPercent,mobileScaling:n.lazyLoadingGoogle.googleMobileScaling}),m("googletag initialized"),ot=!0,at.forEach((e=>e())),Ce(ye.GOOGLETAG_READY),je.next({name:"googletag",values:{consentType:Ne,googletagReady:Ie(ye.CMP_RESPONSE_AVAILABLE,ye.GOOGLETAG_READY),adUnitWithAuctionEnded:Array.from(ze.keys())}}),y("GAM","googletag slotRenderEnded listener added"),e.googletag.pubads().addEventListener("slotRenderEnded",ct),e.googletag.pubads().addEventListener("slotResponseReceived",ut)}))}(this.pubstackWindow,e,t,i)}declareAdUnits(e){return this.declareGoogleSlots(e)}cleanAdUnits(){m(`${tt} cleaning slots`,this.pubstackWindow.googletag.pubads().getSlots().map((e=>e.getSlotElementId())),this.pubstackWindow.googletag.pubads().getSlots());const e=[];this.pubstackWindow.googletag.pubads().getSlots().forEach((t=>{const i=this.pubstackWindow.googletag.destroySlots([t]);y(`${tt} slot ${t.getSlotElementId()} destroyed ? ${i}`),i||(e.push(t),m(`${tt} slot ${t.getSlotElementId()} not destroyed, retrying later`))})),e.length?A(`${tt} unable to destroy slot ${ht(e)}`):y(`${tt} all slots destroyed`),this.pubstackWindow.googletag.pubads().removeEventListener("slotRenderEnded",ct),this.pubstackWindow.googletag.pubads().removeEventListener("slotResponseReceived",ut),at.splice(0)}setPbjsTargetings(e,t){e?(m(`${tt} try to put pbjs targeting keys for ${t.map((e=>e.divId)).join(",")}`),t.forEach((t=>{const i=this.getSlot(t,"setPbjsTargetings");i&&function(e,t,i){i.getTargetingKeys().forEach((e=>{"bid_"!==e.substring(0,4)&&"hb_"!==e.substring(0,3)||i.clearTargeting(e)}));const n=t.getAdserverTargetingForAdUnitCode(e.divId);for(const t of Object.keys(n)){const s=n[t];qe(s)?i.setTargeting(t,s):w(`[targeting] unable to set targeting ${t}=${s} on adUnit ${e.divId}`)}}(t,e,i)}))):A(`${tt} no pbjs given: unable to put header bidding targetings`)}setApsTargetings(e,t,i){e&&(m(`${tt} putting targeting keys for aps auction`,i),e.setDisplayBids())}setRefreshTargeting(e){const t=this.getSlot(e.adUnit,"setPbjsTargetings");var i,n;t&&(i=t,n=e.rank,i.setTargeting("ad_refresh","1"),i.setTargeting("pbstck_refresh","1"),i.setTargeting("ad_refresh-rank",function(e){return e<10?`${e}`:"10-more"}(n)))}callAdServer(e){m(`${tt} preparing call to GAM for ${e.map((e=>e.divId)).join(",")}`,e);const t=this.pubstackWindow.googletag.pubads().getSlots(),i=e.map((e=>t.find((t=>t.getSlotElementId()===e.divId)))).filter((e=>!!e));m(`${tt} calling GAM with ${i.length} slots`,ht(i),ht(t)),this.pubstackWindow.googletag.pubads().refresh(i)}executeWhenAdServerReady(e){ot?e():at.push(e)}renderListener(e){gt((()=>{this.renderListenerCallback=t=>{const i=t.slot,n={divId:i.getSlotElementId(),orderId:t.campaignId,lineItemId:t.lineItemId,size:vt(t),isEmpty:t.isEmpty};if(t.campaignId&&this.prebidOrderIds.includes(t.campaignId)){const e=i.getTargeting(Xe);e&&(n.hb_bidder=Array.isArray(e)?e[0]:e);const t=i.getTargeting(Qe);t&&t[0]&&(n.size=function(e){if("fluid"===e)return"fluid";const[t,i]=e.split("x");return[parseInt(t,10),parseInt(i,10)]}(t[0]));const s=i.getTargeting(Ze);s&&(n.hb_mediaType=Array.isArray(s)?s[0]:s)}e(n)},this.pubstackWindow.googletag.pubads().addEventListener("slotRenderEnded",this.renderListenerCallback)}))}removeRenderListener(){this.renderListenerCallback&&(y("GAM","removing render listener"),this.pubstackWindow.googletag.pubads().removeEventListener("slotRenderEnded",this.renderListenerCallback))}getSlot(e,t){const i=this.pubstackWindow.googletag.pubads().getSlots().filter((t=>t.getSlotElementId()===e.divId));if(0!==i.length)return i.length>1&&A(`${tt} multiple slot found for adunit ${e.divId} on operation ${t}`),i[0];A(`${tt} slot not found for adunit ${e.divId} on operation ${t}`)}declareGoogleSlots(e){return new Promise((t=>{gt((()=>{const i=[];e.forEach((e=>{var t,n,s;if("interstitial"===e.outOfPageType){m(`${tt} define slot interstitial for ${e.divId} (${e.adUnitPath})`);const t=window.googletag.defineOutOfPageSlot(e.adUnitPath,googletag.enums.OutOfPageFormat.INTERSTITIAL);t&&(m("slot interstitial created"),t.addService(googletag.pubads()),i.push(t),ft(e,t))}else if(document.getElementById(e.divId)){let i;if("default"===e.outOfPageType)m(`${tt} define slot out of page for ${e.divId} (${e.adUnitPath})`),i=null===(t=window.googletag.defineOutOfPageSlot(e.adUnitPath,e.divId))||void 0===t?void 0:t.addService(googletag.pubads());else{const t=[st,...e.sizes,...null!==(n=e.extraAdServerSizes)&&void 0!==n?n:[]];m(`${tt} define slot for ${e.divId} (${e.adUnitPath})`),i=null===(s=window.googletag.defineSlot(e.adUnitPath,t,e.divId))||void 0===s?void 0:s.addService(googletag.pubads())}i?(m(`${tt} slot created, displaying ${e.divId}`),googletag.display(e.divId),ft(e,i)):A(`${tt} unable to create slot for ${e.divId}`)}else m(`${tt} unable to display ${e.divId}, the div does not exist`)})),i.forEach((e=>{m(`${tt} calling googletag.display for interstitial slot`,e),googletag.display(e)})),i.length>0&&googletag.pubads().refresh(i);const n=et.getInstance().declareXPLNTargetings;n&&n(),t()}))}))}}function ht(e){return e.map((e=>({id:e.getSlotElementId(),path:e.getAdUnitPath()})))}function vt(e){return e.size}const bt="[instream] [Dailymotion]";class mt{constructor(e,t,i,n){this.callbackAdded=!1,this.admDailymotionReadySent=!1,this.pubstackWindow=e,this.pageContext=t,this.device=i,this.targetings=wt(this.device,this.pubstackWindow),this.config=null!=n?n:{type:"dailymotion-v1"}}setApsTargetings(e,t){var i;if(!e||0===t.length)return;m(`${bt} putting targeting keys for aps auction of winning bidder`,t[0]);const n=null===(i=t[0].helpers)||void 0===i?void 0:i.qsParams();if(n)return void this.targetings.push(n.slice(1));const s=t[0].qsParams;s&&this.targetings.push(s.slice(1))}executeWhenAdServerReady(e){this.pubstackWindow.dailymotion?e():setTimeout(this.executeWhenAdServerReady.bind(this,e),100)}async callAdServer(e,t){var i,n,s;m(`${bt} call ad server`);const o=e.divId,a=await(null===(i=this.pubstackWindow.dailymotion)||void 0===i?void 0:i.getPlayer(o));if(a)switch(m(`${bt}`,o,a),this.customConfig=function(e,t,i){var n,s,o;const a=function(e){const t=[];return e.targeting&&t.push(yt(e.targeting)),e.extraTargetings&&e.extraTargetings.forEach((e=>t.push(yt(e)))),t}(e);m(`${bt} adUnitTargetings`,a);const r=a.concat(t).join("&"),d=Object.keys(null!==(s=null===(n=e.instreamParams)||void 0===n?void 0:n.vast)&&void 0!==s?s:{}).map((function(t){var i;return`${t}=${null===(i=e.instreamParams)||void 0===i?void 0:i.vast[t]}`})).join("&"),l=null===(o=e.instreamParams)||void 0===o?void 0:o.adDeactivationContext;let c=!1;if(l){const e=i.get(l.key);c=!!e&&l.values.includes(e)}const u={dynamiciu:e.adUnitPath,keyvalues:r,keyvalues2:d};return c?{...u,premium:"true"}:u}(e,this.targetings,this.pageContext),m(`${bt} generated customConfig`,this.customConfig),this.config.type){case"dailymotion-v1":m(`${bt} setCustomConfig`,this.customConfig),a.setCustomConfig(this.customConfig),m(`${bt} ad server called ${o}`),document.dispatchEvent(new CustomEvent("admDailymotionReady",{detail:{divId:o}})),m(`${bt} admDailymotionReady event dispatched`);break;case"dailymotion-v2":this.callbackAdded||(m(`${bt} add callback to event ${null===(n=this.pubstackWindow.dailymotion)||void 0===n?void 0:n.events.AD_READYTOFETCH}`),a.on(null===(s=this.pubstackWindow.dailymotion)||void 0===s?void 0:s.events.AD_READYTOFETCH,(()=>{m(`${bt} event AD_READYTOFETCH received, setCustomConfig`,this.customConfig),this.customConfig&&a.setCustomConfig(this.customConfig),t&&(m(`${bt} event AD_READYTOFETCH, call "onCallFinished"`),t())})),this.callbackAdded=!0);break;case"dailymotion-prisma":if(m(`${bt} setCustomConfig`,this.customConfig),this.customConfig.customParams=`${encodeURIComponent(this.customConfig.keyvalues)}&${this.customConfig.keyvalues2}/${encodeURIComponent(this.customConfig.dynamiciu)}`,m(`${bt} customParams`,this.customConfig.customParams),a.setCustomConfig(this.customConfig),m(`${bt} ad server called ${o}`),this.admDailymotionReadySent||(m(`${bt} dispatching admDailymotionReady event`),document.dispatchEvent(new CustomEvent("admDailymotionReady",{detail:{divId:o}})),this.admDailymotionReadySent=!0),t){let e=!1;a.on("AD_PLAY",(()=>{e||(m(`${bt} event AD_PLAY, call "onCallFinished"`),t()),e=!0}),{once:!0})}}else A(`${bt} no player found for ${o}`)}setPbjsTargetings(e,t){if(e){m(`${bt} put pbjs targeting keys for ${t.divId}`);const i=e.getAdserverTargetingForAdUnitCode(t.divId);for(const e of Object.keys(i)){const n=i[e];qe(n)?this.targetings.push(`${e}=${n}`):w(`${bt} [targeting] unable to set targeting ${e}=${n} on adUnit ${t.divId}`)}}else A(`${bt} no pbjs given: unable to put header bidding targetings`)}cleanTargetings(){this.targetings.splice(0),this.targetings.push(...wt(this.device,this.pubstackWindow))}}function yt(e){const t=H(e);return`${e.key}=${"string"==typeof t?t:t.join(",")}`}function wt(e,t){const i=[],n=E(t);Object.keys(n).forEach((e=>{const t=n[e].join(",");i.push(`${e}=${t}`)})),i.push("adm=1"),i.push(`device=${e}`),i.push(`${it}=1`);try{const e=JSON.parse(t.localStorage._pdfps).slice(0,250).join(",");""!==e?i.push(`permutive=${e}`):m(`[${bt}] no permutive targeting found`)}catch(e){m(`[${bt}] error reading permutive targeting`)}return i}class At{constructor(){this.name="AdServer",this.enableConsentless=!1}get adServer(){return this._adServer}isLoaded(){return!!this._adServer}async load({config:e}){this._adServer=new pt(window,e),this._adServer.renderListener((t=>{t.isEmpty||function(e,t,i,n,s){const o=`${n}_${s}`;navigator.sendBeacon(`https://intake.pbstck.com/v1/intake/gam-impression?sId=${t}&tId=${e}&c=1&s=${o}&v=${i}`)}(e.tagId,e.stack.scopeId,e.kleanadsVersion,e.stack.stackId,e.stackVersion)})),this.enableConsentless=e.enableConsentless}async onAfterConsentRefused(){this.enableConsentless&&(this.isLoaded()?I("https://pagead2.googlesyndication.com/tag/js/gpt.js"):A("AdServerModule - onAfterConsentRefused (with consentless enabled) - AdServer is not loaded"))}async onAfterConsentAccepted(){this.isLoaded()?I("https://securepubads.g.doubleclick.net/tag/js/gpt.js"):A("AdServerModule - onAfterConsentAccepted - AdServer is not loaded")}async onAdUnitConfigLoad({config:e,adUnitConfig:t}){var i;null===(i=this._adServer)||void 0===i||i.init(e.device,e.pageContext,t.lazyLoading)}async onPrepareAdUnits({toPreparedAdUnits:e}){var t;const i=(null!=e?e:[]).filter((e=>!e.isInstream));return null===(t=this._adServer)||void 0===t?void 0:t.declareAdUnits(i)}async clean(){var e;null===(e=this._adServer)||void 0===e||e.cleanAdUnits()}}function St(e){return function(t,i){return class extends t{constructor(){super(...arguments),this.deferLoadingTo=e}}}}let kt=4400;const Ct="[executor] [APS]";let Et=!1,$t=!1;function It(e){const t=e.apstag;if(t.kleanadsBlocker){m(`${Ct} getting apstag from blocker's methods`);const e=t;return{...t,fetchBids:e.fetchBidsKleanads,setDisplayBids:e.setDisplayBidsKleanads}}return t}class Ut{constructor(e,t){this.pubstackWindow=e,this.apsPubId=t}setEnableApsForTests(e){!function(e){A(`${Ct} this function should be used only for testing purpose`),Et=e}(e)}load(){!function(e){function t(t,i){var n,s;null===(s=null===(n=It(e))||void 0===n?void 0:n._Q)||void 0===s||s.push([t,i])}Et=!0,e.apstag||(m(`${Ct} overriding apstag`),e.apstag={_Q:[]}),m(`${Ct} overriding apstag functions`),e.apstag.init=(...e)=>t("i",e),m(`${Ct} init set!`,e.apstag.init),e.apstag.fetchBids=(...e)=>t("f",e),e.apstag.setDisplayBids=()=>{},e.apstag.targetingKeys=()=>[],I("//c.amazon-adsystem.com/aax2/apstag.js")}(this.pubstackWindow)}startApsAuction(e,t){if(!Et)return m(`${Ct} skipping auction for adunits [${e.map((e=>e.divId)).join(",")}]`),void t(void 0,[]);if(!$t)return w(`${Ct} cannot start auction: apstag is not initialized`),void t(void 0,[]);const i=It(this.pubstackWindow);if(!i)return w(`${Ct} cannot find apstag on the page`),void t(void 0,[]);const n=function(e){return e.filter((e=>e.headerBiddingEnabled)).reduce(((e,t)=>{if(t.isInstream){const t={slotID:"videoSlot",mediaType:"video",sizes:[[640,480]]};return[...e,t]}if(t.canOutstream){const i={slotID:t.divId,slotName:t.slotName,mediaType:"multi-format",multiFormatProperties:{display:{sizes:P(t.sizes)},video:{sizes:[[640,480]]}}};return[...e,i]}{const i={slotID:t.divId,slotName:t.slotName,sizes:P(t.sizes)};return i.sizes.length?[...e,i]:e}}),[])}(e);if(m(`${Ct} apsSlots created`,n),0===n.length)return void t(i,[]);m(`${Ct} calling fetchBids`);let s=!1;setTimeout((()=>{s||(w(`${Ct} fetchbids did not response before ${kt}ms, calling callback`),s=!0,t(i,[]))}),kt),i.fetchBids({slots:n},(e=>{s||(s=!0,t(i,e))})),m(`${Ct} auction started`,n)}initAps(e){if(Et){kt=e+1400,m(`${Ct} updating failsafe timeout to ${kt}`);const t=It(this.pubstackWindow);if(!t)return void w(`${Ct} cannot find apstag on the page`);t.init({pubID:this.apsPubId,adServer:"googletag",bidTimeout:e,deals:!0,videoAdServer:"DFP"},(()=>{m(`${Ct} apstag init done`),Ce(ye.APSTAG_READY),je.next({name:"apstag",values:{consentType:Ne,apstagReady:Ie(ye.CMP_RESPONSE_AVAILABLE,ye.APSTAG_READY)}})})),$t=!0}else m(`${Ct} apstag init skipped`)}}let Ot=(()=>{let e,t,i=[St("onAdUnitConfigLoad")],n=[];return t=class{constructor(){this.name="Aps"}get aps(){return this._aps}isLoaded(){return!!this._aps}async load({adUnitConfig:e}){var t;this._aps=function(e,t){if(e&&t.some((e=>e.headerBiddingEnabled&&e.sizes.some((e=>"fluid"!==e))))){m("downloading amazon apstag");const t=new Ut(window,e);return t.load(),t}}(null===(t=e.tamConfig)||void 0===t?void 0:t.apsPubId,e.adUnits)}async onAdUnitConfigLoad({config:e,adUnitConfig:t}){var i,n,s;null===(i=this._aps)||void 0===i||i.initAps(null!==(s=null===(n=t.prebidConfig)||void 0===n?void 0:n.adCallTimeout)&&void 0!==s?s:e.adCallTimeout)}async clean(){}},function(e,t,i){"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}(t,"ApsModule"),(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(function(e,t,i,n,s,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,d=n.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),f=!1,g=i.length-1;g>=0;g--){var p={};for(var h in n)p[h]="access"===h?{}:n[h];for(var h in n.access)p.access[h]=n.access[h];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,i[g])("accessor"===d?{get:u.get,set:u.set}:u[l],p);if("accessor"===d){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(r=a(v.get))&&(u.get=r),(r=a(v.set))&&(u.set=r),(r=a(v.init))&&s.unshift(r)}else(r=a(v))&&("field"===d?s.unshift(r):u[l]=r)}c&&Object.defineProperty(c,n.name,u),f=!0})(null,e={value:t},i,{kind:"class",name:t.name,metadata:s},null,n),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e)}(t,n)})(),t})();const xt="ModuleService";class Tt{constructor(e,t){this.modules=t,this.lifecycleState={config:e},m(`[${xt}] Init: ${this.modules.length} modules registered`);for(const e of this.modules)e.isLoaded()?m(`[${xt}] Module ${e.name} is already loaded`):m(`[${xt}] Registered module ${e.name}.${e.deferLoadingTo?`Deferred loading to ${e.deferLoadingTo}`:""}`)}getModules(){return this.modules}getLoadedModuleInstance(e){return this.modules.filter((e=>e.isLoaded())).find((t=>t instanceof e))}async loadModules(e){for(const t of e){m(xt,`Loading module ${t.name}`);try{await t.load(this.lifecycleState)}catch(e){A(xt,`Error while loading module ${t.name}`,e)}}}async loadInitialModules(){const e=this.modules.filter((e=>!e.deferLoadingTo&&!e.isLoaded()));m(`[${xt}] Loading initial modules. ${e.length} modules to load`),await this.loadModules(e)}async modulesDispatchEvent(e,...t){this.lifecycleState={...this.lifecycleState,...t[0]};const i=this.lifecycleState,n=this.modules.filter((t=>t.deferLoadingTo===e&&!t.isLoaded()));return m(`[${xt}] event call: ${e}. ${n.length} deferred modules to load`),await this.loadModules(n),new Promise((t=>{var n;const s=this.modules.filter((t=>t.isLoaded()&&t[e]&&"function"==typeof t[e]));m(`[${xt}] event call: ${e}. ${s.length} modules to call`);const o=[];for(const t of s){m(xt,`Calling ${e} on module ${t.name}`);const s=null===(n=t[e])||void 0===n?void 0:n.call(t,i);s instanceof Promise&&o.push(s)}t(o)}))}async modulesCleanUp(){const e=this.modules.filter((e=>e.isLoaded()));m(`[${xt}] Cleaning modules. ${e.length} modules cleanup started`);for(const t of e)m(xt,`Cleaning module ${t.name}`),await t.clean(this.lifecycleState);this.modules=[]}}const Pt=1900,_t="[executor] [GAM]";function jt(e,t=[]){const i=null==t?void 0:t.map((e=>e.bidderSource));return Array.from(new Set(e.flatMap((e=>e.bidders)).map((e=>e.bidder)).concat(i)))}function Lt(e,t){const i=e.cpm,n=i>0?function(e,t){let i;if(t.forEach((t=>{const n=parseFloat(t.max);n>e&&(i=!i||n<parseFloat(i.max)?t:i)})),!i)return Math.max(...t.map((e=>parseFloat(e.max))));const n=parseFloat(i.increment);return parseFloat((Math.floor(e/n)*n).toFixed(2))}(i,t):0,s=Math.max(...t.map((e=>parseFloat(e.max))));return Math.min(n,s).toFixed(2)}function Rt(e,t,i,n,s){const[o,a,r]=function(e){const t=[],i=[],n=[];return e.forEach((e=>{e.headerBiddingEnabled&&e.bidders.length>0?(t.push(e),i.push(e.divId)):n.push(e.divId)})),[t,i.join(","),n.join(",")]}(t);if(o.length>0){const t=null==s?void 0:s.timeout,d=null==s?void 0:s.labels,l=function(e){const t=e.getConfig("bidderTimeout");if(t){if("number"==typeof t)return t+Pt;if(parseInt(t))return parseInt(t)+Pt}return 4900}(e);let u=!1;setTimeout((()=>{u||(w(`${_t}prebid requestBids did not response before ${l}ms, calling callback`),u=!0,i())}),l);const f=()=>{u||(u=!0,i())},g=o.flatMap((e=>function(e,t){const i=e.bidders.map((e=>function(e,t){var i;return"sublime"===e.bidder||e.bidder===(null===(i=null==t?void 0:t.find((e=>"sublime"===e.bidderSource)))||void 0===i?void 0:i.bidderLabel)?(c("common","[Sublime] generate notify id"),{...e,params:{...e.params,notifyId:G()}}):e}(e,t))),n={code:e.divId,pubstack:{adUnitName:V(e),adUnitPath:e.pubstackAdUnitPathDeclaration},floors:e.floors,ortb2Imp:e.ortb2Imp};if(e.isInstream)return[J(n,i)];const s=[];return W(e)?s.push(...Y(e,n,i)):s.push(X(e,n,i)),e.canOutstream&&s.push(K(e,n,i)),s}(e,n)));m(`${_t}[executor] [pbjs] calling requestBids for ${g.map((e=>e.code)).join(",")}`),e.requestBids({timeout:t,adUnits:g,bidsBackHandler:f,labels:d}),m(`${_t}[executor] [pbjs] prebid auction started for [${a}] | prebid auction skipped for [${r}]`,o)}else m(`${_t}[executor] [pbjs] no prebid auction to start for [${r}]`),i()}class Nt{constructor(e){this.pbjs=e.getPbjs()}initPbjs(e,t,i,n){!function(e,t,i,n,s){var o,a;m(`${_t}[initPbjs] Start prebid initialization`);const{currency:r,userSync:d,priceGranularity:l,bidderAdjustments:c,bidderAliases:u,bidderConfigs:f,floors:g,analytics:p,schain:h,outbrain:v,realTimeData:b,allowLocalStorage:y,fledgeForGpt:A}=i,S=jt(t,u);if(e.setConfig(n),r&&(m(`${_t}[initPbjs] set currency config`,r),e.setConfig({currency:r,priceGranularity:"dense"}),l&&(m(`${_t}[initPbjs] set priceGranularity config`,l),e.setConfig({priceGranularity:l}))),d){m(`${_t}[initPbjs] set userSync config`,d);const t={filterSettings:{iframe:{bidders:["optidigital","richaudience","justpremium","impactify","smilewanted"],filter:"include"},image:{bidders:"*",filter:"include"}},...d};e.setConfig({userSync:t})}v&&(m(`${_t}[initPbjs] set Outbrain config:`,v),e.setConfig({outbrain:v})),b&&(m(`${_t}[initPbjs] set realTimeData config`,b),e.setConfig({realTimeData:b})),g&&(m(`${_t}[initPbjs] set floors config`,g),e.setConfig({floors:g}));const k=null==b?void 0:b.dataProviders.find((e=>"greenbidsRtdProvider"===e.name));if(p||k){const t=p||[];if(k){const e=null===(o=k.params)||void 0===o?void 0:o.pbuid;if(e&&!t.find((e=>"greenbids"===e.provider))){const i=function(e,t){return{provider:"greenbids",options:{pbuid:e,sampling:t}}}(e,null===(a=k.params)||void 0===a?void 0:a.sampling);t.push(i)}}m(`${_t}[initPbjs] enable analytics`,t),e.enableAnalytics(t)}if(h&&(m(`${_t}[initPbjs] set schain config`,h),e.setConfig({schain:h})),A&&e.setConfig({fledgeForGpt:{enabled:!0}}),f){m(`${_t}[initPbjs] set bidder config`,f);for(const t of f)e.setBidderConfig(t)}const C={};if(c){m(`${_t}[initPbjs] set bidder adjustments config`,c);for(const e of c)C[e.bidder]={bidCpmAdjustment:function(t){return t*e.adjustment}}}if(y)for(const e of S)C[e]={...C[e],storageAllowed:!0};if(C.standard={adserverTargeting:[{key:Xe,val:function(e){return e.bidderCode}},{key:"bid_id",val:function(e){return e.adId}},{key:"bid_cpm",val:function(e){return e.pbCg}},{key:Qe,val:function(e){return e.size}},{key:Ze,val:function(e){return e.mediaType}},{key:"bid_videoId",val:function(e){return e.videoCacheKey}}]},s&&et.getInstance().uprEnabled&&(C.standard={adserverTargeting:[...C.standard.adserverTargeting,{key:"prkv",val:e=>Lt(e,s)},{key:"ad_floor-rule",val:e=>Lt(e,s)}]}),Object.keys(C).length>0&&(e.bidderSettings=C),u){m(`${_t}[initPbjs] set alias bidder`,u);for(const t of u)e.aliasBidder(t.bidderSource,t.bidderLabel)}if(function(e,t){var i;const n=e.flatMap((e=>e.bidders)).map((e=>e.bidder)),s=[...new Set(n)],o=null===(i=null==t?void 0:t.find((e=>"sublime"===e.bidderSource)))||void 0===i?void 0:i.bidderLabel;return s.includes(o||"sublime")}(t,u)){const e=function(e,t){var i,n;const s=null===(i=null==t?void 0:t.find((e=>"sublime"===e.bidderSource)))||void 0===i?void 0:i.bidderLabel,o=e.filter((e=>e.bidders.find((e=>"sublime"===e.bidder||e.bidder===s))));if(0===o.length)return;if(o.length>1)return void w(`${_t} Sublime bidder has multiple adUnits ${o.map((e=>e.divId)).join("")}`,o);const a=null===(n=o[0].bidders.find((e=>"sublime"===e.bidder||e.bidder===s)))||void 0===n?void 0:n.params;if(a){const e=a.zoneId;if(e&&("string"==typeof e||"number"==typeof e))return`${e}`}else w(`${_t} unable to extract Sublime zoneId from ${o[0].divId}`,o[0])}(t,u);if(e){const t=`https://sac.ayads.co/sublime/${e}/prebid`;m(`${_t}[initPbjs] loading sublime script ${t}`),I(t)}}m(`${_t}[initPbjs] Prebid is initialized`)}(this.pbjs,e,t,i,n)}extractUniqAdaptersName(e,t=[]){return jt(e,t)}roundUpToNearestIncrement(e,t){return function(e,t){const i=e.sort(((e,t)=>e.max<t.max?-1:1)),n=i.filter((e=>t<=e.max));if(0===n.length)return m(`${_t}[Price granularity] round up - initial CpmValue : ${t} // rounded value : ${i[i.length-1].max} `),i[i.length-1].max.toFixed(2);const s=n[0].increment;let o=t%s==0?t:t+(s-t%s);const a=t.toString().split("."),r=a.length>1?a[1].split("").length:0;(o-s).toFixed(r)===t.toFixed(r)&&(o=t);const d=o.toFixed(2);return m(`${_t}[Price granularity] round up - initial CpmValue : ${t} // rounded value : ${d} `),d}(e,t)}startPbjsAuction(e,t,i,n){Rt(this.pbjs,e,t,i,n)}getPbjs(){return this.pbjs}setContextValuesAsTargeting(e,t,i){const n={};for(const[t,i]of e)n[t]=i;for(const e in t)1===t[e].length?n[e]=t[e][0]:n[e]=t[e];this.pbjs.setBidderConfig({bidders:i,config:{ortb2:{site:{ext:{data:n}}},appnexusAuctionKeywords:n}})}}let Dt=(()=>{let e,t,i=[St("onAdUnitConfigLoad")],n=[];return t=class{constructor(){this.name="Prebid"}get pbjs(){return this._pbjs}isLoaded(){return!!this._pbjs}async load({config:e,adUnitConfig:t}){this._pbjs=await async function(e,t){if(t.some((e=>e.headerBiddingEnabled&&e.bidders.length)))try{const t=await U(e);return new Nt(t)}catch(e){return void m("[config] Error while loading the kleanadsPbjs module",e)}}(e.newPrebidUrl,t.adUnits),this._pbjs&&this.aliasWindowPbjs(window,this._pbjs.getPbjs())}async onAdUnitConfigLoad({config:e,adUnitConfig:t}){var i,n,s,o,a;if(!this._pbjs)throw new Error("PrebidModule is not loaded");const r=null!==(n=null===(i=null==t?void 0:t.prebidConfig)||void 0===i?void 0:i.adCallTimeout)&&void 0!==n?n:e.adCallTimeout,d=null!==(o=null===(s=t.prebidConfig)||void 0===s?void 0:s.pbjsConfig)&&void 0!==o?o:e.pbjsConfig,l={bidderTimeout:r,useBidCache:!0,maxRequestsPerOrigin:6,consentManagement:e.noCmp?void 0:{gdpr:{cmpApi:"iab",timeout:8e3,defaultGdprScope:!0}},enableSendAllBids:!1,pageUrl:document.location.href,cache:{url:"https://prebid.adnxs.com/pbc/v1/cache",ignoreBidderCacheKey:!0},timeoutBuffer:d.timeoutBuffer};if(this._pbjs.initPbjs(t.adUnits,d,l,e.priceRuleBuckets),null===(a=null==d?void 0:d.targetingBehaviors)||void 0===a?void 0:a.sendKVTargetings){const i=E(window),n=this._pbjs.extractUniqAdaptersName(t.adUnits,d.bidderAliases).filter((e=>{var t;return!(null===(t=d.targetingBehaviors)||void 0===t?void 0:t.biddersBlackList.includes(e))}));this._pbjs.setContextValuesAsTargeting(e.pageContext,i,n)}}async clean(){var e;this.setDefaultPbjsConfig();const t=null===(e=this._pbjs)||void 0===e?void 0:e.getPbjs();t&&(t.bidderSettings={})}aliasWindowPbjs(e,t){e.pbjs=t}setDefaultPbjsConfig(){var e;null===(e=this._pbjs)||void 0===e||e.getPbjs().setConfig({bidderTimeout:3e3,enableSendAllBids:!0,useBidCache:!1,deviceAccess:!0,timeoutBuffer:400,disableAjaxTimeout:!1,maxNestedIframes:10,priceGranularity:"medium",customPriceBucket:{},mediaTypePriceGranularity:{},bidderSequence:"random",auctionOptions:{},userSync:{syncEnabled:!0,filterSettings:{image:{bidders:"*",filter:"include"}},syncsPerBidder:5,syncDelay:3e3,auctionDelay:0}})}},function(e,t,i){"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}(t,"PrebidModule"),(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(function(e,t,i,n,s,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,d=n.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),f=!1,g=i.length-1;g>=0;g--){var p={};for(var h in n)p[h]="access"===h?{}:n[h];for(var h in n.access)p.access[h]=n.access[h];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,i[g])("accessor"===d?{get:u.get,set:u.set}:u[l],p);if("accessor"===d){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(r=a(v.get))&&(u.get=r),(r=a(v.set))&&(u.set=r),(r=a(v.init))&&s.unshift(r)}else(r=a(v))&&("field"===d?s.unshift(r):u[l]=r)}c&&Object.defineProperty(c,n.name,u),f=!0})(null,e={value:t},i,{kind:"class",name:t.name,metadata:s},null,n),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e)}(t,n)})(),t})();class Mt{constructor(e,t){this.pubstackWindow=e,this.rule=t}isDivIdMatchingRule(e){const t=document.getElementById(e);if(t){const e=t.getBoundingClientRect();return this.rule(this.pubstackWindow,e)}return!1}}const zt=(e,t,i)=>{const n=-i*e.innerHeight,s=(1+i)*e.innerHeight>t.top,o=t.bottom>n;return s&&o};function Bt(e,t,i){const n=e.filter((e=>t.isDivIdMatchingRule(e.divId))).filter((e=>!i.isAlreadyMonetized(e)));i.executeAdCall(n),setTimeout((()=>Bt(e,t,i)),200)}const Ft="[POC][DisableHeaderBidding] ";function Wt(e){var t,i,n;return null===(n=null===(i=null===(t=e.pocOverrides)||void 0===t?void 0:t.spaConfig)||void 0===i?void 0:i[e.tagId])||void 0===n?void 0:n.mode}class Ht{constructor(e,t){this.adUnitConfig={...e},this.pocOverrides=t}withInstreamAdUnits(){var e,t;return(null===(e=this.pocOverrides)||void 0===e?void 0:e.instreamAdUnits)&&(null===(t=this.pocOverrides)||void 0===t||t.instreamAdUnits.forEach((e=>{this.adUnitConfig.adUnits.push({...e,isInstream:!0,dynamic:!1,parallax:!1,lazyLoading:!1,sticky:!1,canOutstream:!1,biddersOutstream:[]})}))),this}withFirstId(){var e,t,i;if(null===(e=this.pocOverrides)||void 0===e?void 0:e.firstId){const e=function(){const e=new RegExp("(?:(?:^|.*; *)firstid *= *([^;]*).*$)|^.*$","i"),t=document.cookie.match(e);return t&&t[1]?decodeURIComponent(t[1]):void 0}();if(e){const n=null!==(i=null===(t=this.adUnitConfig.prebidConfig.pbjsConfig.userSync)||void 0===t?void 0:t.userIds)&&void 0!==i?i:[];n.push({name:"pubProvidedId",bidders:["appnexus","pubmatic","rubicon","ix","nexx360","criteo","smartadserver"],params:{eids:[{source:"first-id.fr",uids:[{id:e,atype:1,ext:{stype:"ppuid"}}]}]}}),this.adUnitConfig.prebidConfig.pbjsConfig.userSync={...this.adUnitConfig.prebidConfig.pbjsConfig.userSync,userIds:n}}}return this}withDisableHeaderBidder(e){var t,i;return(null===(t=this.pocOverrides)||void 0===t?void 0:t.disableHeaderBidder)&&(this.adUnitConfig.adUnits=function(e,t,i){if(!e.key)return A(`${Ft} partial configuration: no context key. Using default configuration.`),i;if(!e.values||0===e.values.length)return A(`${Ft} partial configuration: no available values for the context key. Using default configuration.`),i;const n=t.get(e.key);return n?e.values.includes(n)?(m(`${Ft} Removing bidders for all adUnits (${e.key}=${n})`),i.map((e=>({...e,bidders:[]})))):(m(`${Ft} No need to remove bidder: ${n}`),i):(m(`${Ft} No valid ${e.key} meta found, using default config.`),i)}(null===(i=this.pocOverrides)||void 0===i?void 0:i.disableHeaderBidder,e,this.adUnitConfig.adUnits)),this}withInterstitialAdUnits(){var e,t;return(null===(e=this.pocOverrides)||void 0===e?void 0:e.interstitialAdUnits)&&(null===(t=this.pocOverrides)||void 0===t?void 0:t.interstitialAdUnits.length)>0&&this.adUnitConfig.adUnits.forEach((e=>{var t,i;(null===(i=null===(t=this.pocOverrides)||void 0===t?void 0:t.interstitialAdUnits)||void 0===i?void 0:i.includes(e.divId))&&(e.outOfPageType="interstitial")})),this}withAdUnitsOrder(){var e,t;return(null===(e=this.pocOverrides)||void 0===e?void 0:e.adUnitsOrder)&&(this.adUnitConfig.adUnits=(t=this.pocOverrides.adUnitsOrder,this.adUnitConfig.adUnits.sort(((e,i)=>t.indexOf(e.divId)-t.indexOf(i.divId))))),this}withSkinRenderingSettings(e,t){var i,n,s;const o=null===(i=this.pocOverrides)||void 0===i?void 0:i.skinRenderingSettings,a=null===(n=null==o?void 0:o.stackLevel)||void 0===n?void 0:n[t],r=null===(s=null==o?void 0:o.siteLevel)||void 0===s?void 0:s[e];return(null==r?void 0:r.disableSkinBids)||(null==a?void 0:a.disableSkinBids)?this.adUnitConfig.adUnits=this.adUnitConfig.adUnits.map((e=>({...e,sizes:e.sizes.filter((e=>!F(e,[1800,1e3])))}))):((null==r?void 0:r.biddersOverride)||(null==a?void 0:a.biddersOverride))&&(this.adUnitConfig.adUnits=this.adUnitConfig.adUnits.map((e=>{var t;return e.sizes.some((e=>F(e,[1800,1e3])))?{...e,biddersSkin:null!==(t=null==a?void 0:a.biddersOverride)&&void 0!==t?t:null==r?void 0:r.biddersOverride}:e}))),this}withReworldAbcdefTest(){var e,t;return(null===(t=null===(e=this.pocOverrides)||void 0===e?void 0:e.reworldAbcdefTest)||void 0===t?void 0:t.length)&&function(e,t){const i=j(t);switch(S("pbstck_reworld_test",`${i}`),C("pbstck_reworld_test",`${i}`),i){case 3:case 5:e.adUnits=e.adUnits.map((e=>({...e,bidders:[]})));break;case 4:delete e.tamConfig;break;case 6:delete e.tamConfig,e.adUnits=e.adUnits.map((e=>({...e,bidders:[]})))}}(this.adUnitConfig,this.pocOverrides.reworldAbcdefTest),this}withCssSelectors(){var e,t;return(null===(t=null===(e=this.pocOverrides)||void 0===e?void 0:e.cssSelectors)||void 0===t?void 0:t.length)&&this.adUnitConfig.adUnits.forEach((e=>{var t,i;const n=null===(i=null===(t=this.pocOverrides)||void 0===t?void 0:t.cssSelectors)||void 0===i?void 0:i.find((t=>t.divId===e.divId));n&&(e.cssSelector=n.cssSelector)})),this}withPrebidPpidSolution(e){var t,i,n,s;if(null===(i=null===(t=this.pocOverrides)||void 0===t?void 0:t.prebidPpidSolutions)||void 0===i?void 0:i.length){const t=null===(n=this.pocOverrides)||void 0===n?void 0:n.prebidPpidSolutions.find((t=>t.siteId===e)),i=null===(s=this.pocOverrides)||void 0===s?void 0:s.prebidPpidSolutions.find((e=>!e.siteId));(t||i)&&(this.adUnitConfig.prebidConfig.pbjsConfig.userSync={...this.adUnitConfig.prebidConfig.pbjsConfig.userSync,ppid:(null==t?void 0:t.prebidPpid)||(null==i?void 0:i.prebidPpid)})}return this}withRefreshSpecificRules(){var e,t;const i=null===(e=this.pocOverrides)||void 0===e?void 0:e.refreshSpecificRules;return i&&(null===(t=this.adUnitConfig.refreshConfig)||void 0===t||t.adUnitConfig.forEach((e=>{var t;e.specificRules=[...null!==(t=e.specificRules)&&void 0!==t?t:[],...i]}))),this}withRefreshAlwaysInView(){var e;const t=null===(e=this.pocOverrides)||void 0===e?void 0:e.refreshAlwaysInViewDivIds;if(this.adUnitConfig.refreshConfig&&t&&t.length>0){const e=[];this.adUnitConfig.refreshConfig.adUnitConfig.forEach((i=>{t.forEach((t=>{i.adUnits.includes(t)&&(e.push({...i,alwaysInView:!0,adUnits:[t]}),i.adUnits.splice(i.adUnits.indexOf(t),1))}))})),this.adUnitConfig.refreshConfig.adUnitConfig=[...this.adUnitConfig.refreshConfig.adUnitConfig.filter((e=>e.adUnits.length>0)),...e]}return this}withStickyDivCreation(){var e;const t=null===(e=this.pocOverrides)||void 0===e?void 0:e.stickyDivCreation;return t&&this.adUnitConfig.adUnits.filter((e=>e.sticky)).forEach((e=>e.stickyDivCreation=t)),this}withOutbrainConfig(e){var t;if(null===(t=this.pocOverrides)||void 0===t?void 0:t.outbrainConfig){const t=this.pocOverrides.outbrainConfig.find((t=>t.siteId===e)),i=this.pocOverrides.outbrainConfig.find((e=>!e.siteId)),n=t||i;n&&(this.adUnitConfig.prebidConfig.pbjsConfig.outbrain={bidderUrl:n.bidderUrl,usersyncUrl:n.usersyncUrl})}return this}withEnableXpln(){var e;return(null===(e=this.pocOverrides)||void 0===e?void 0:e.xplnEnabled)&&(this.adUnitConfig.xplnConfig={enabled:!0}),this}withFledgeForGpt(){var e,t;if(null===(e=this.pocOverrides)||void 0===e?void 0:e.fledgeForGpt){this.adUnitConfig.adUnits.forEach((e=>{var t;e.bidders.find((e=>"criteo"===e.bidder))&&(e.ortb2Imp={...e.ortb2Imp,ext:{...null===(t=e.ortb2Imp)||void 0===t?void 0:t.ext,ae:1}})})),this.adUnitConfig.prebidConfig.pbjsConfig.bidderConfigs||(this.adUnitConfig.prebidConfig.pbjsConfig.bidderConfigs=[]);const e=this.adUnitConfig.prebidConfig.pbjsConfig.bidderConfigs.find((e=>Array.isArray(e.bidders)&&e.bidders.includes("criteo")));e&&e.config?e.config.fledgeEnabled=!0:null===(t=this.adUnitConfig.prebidConfig.pbjsConfig.bidderConfigs)||void 0===t||t.push({bidders:["criteo"],config:{fledgeEnabled:!0}}),this.adUnitConfig.prebidConfig.pbjsConfig={...this.adUnitConfig.prebidConfig.pbjsConfig,fledgeForGpt:!0}}return this}build(){return this.adUnitConfig}}const Vt=e=>!!e.priority&&!!e.conditions,Gt=e=>!e.priority&&!e.conditions,Jt=e=>"elements"in e;const Kt={AND:({elements:e},t)=>e.every((e=>Yt(e,t))),OR:({elements:e},t)=>e.some((e=>Yt(e,t)))},qt={IN:({key:e,values:t},i)=>t.some((t=>t===i.get(e))),NOT_IN:({key:e,values:t},i)=>!t.some((t=>t===i.get(e)))};function Yt(e,t){return Jt(e)?Kt[e.op](e,t):qt[e.op](e,t)}const Xt={pbjsFinished:!1,apsFinished:!1},Qt="[executor] [buffered]";var Zt;!function(e){e[e.FirstCall=0]="FirstCall",e[e.Refresh=1]="Refresh"}(Zt||(Zt={}));class ei{constructor(e,t,i,n,s,o){this.buffer=[],this.auctionRunning=!1,this.adUnitAuctionStatus=new Map,this.adServer=e,this.pbjs=t,this.aps=i,this.logPrefix=`${Qt}${o?` [${o}]`:""}`,this.bidderAliases=n,this.kleanadsRunCount=s}executeAdCall(e){if(0===e.length)return;setTimeout((()=>{e.forEach((e=>Me(e.divId,"executorTimeout")))}),2e4);const t=e.filter((e=>!this.adUnitAuctionStatus.has(e.divId))).sort(((e,t)=>ee(e.divId)-ee(t.divId)));this.logAlreadyMonetizedAdUnits(e,t),m(`${this.logPrefix} buffering adunits`,e),t.forEach((e=>{this.bufferAdUnits({adUnits:[e],origin:Zt.FirstCall})}))}executeAdCallRoadblock(e){if(0===e.length)return;setTimeout((()=>{e.forEach((e=>Me(e.divId,"executorTimeout")))}),2e4);const t=e.filter((e=>!this.adUnitAuctionStatus.has(e.divId))).sort(((e,t)=>ee(e.divId)-ee(t.divId))).sort(((e,t)=>("master"===e.roadblock?0:1)-("master"===t.roadblock?0:1)));this.logAlreadyMonetizedAdUnits(e,t),m(`${this.logPrefix} buffering adunits`,e),this.bufferAdUnits({adUnits:t,origin:Zt.FirstCall})}bufferAdUnits(e){var t;switch(this.buffer.push(e),e.origin){case Zt.FirstCall:null===(t=e.adUnits)||void 0===t||t.forEach((e=>{this.adUnitAuctionStatus.set(e.divId,Xt)}));break;case Zt.Refresh:this.adUnitAuctionStatus.set(e.refreshableAdUnit.adUnit.divId,Xt);break;default:A(`${this.logPrefix} unknown buffer entry origin`)}this.startAuctionForBufferedAdUnits()}executeRefresh(e){this.bufferAdUnits({refreshableAdUnit:e,origin:Zt.Refresh})}startAuctionForBufferedAdUnits(){if(this.auctionRunning)return void m(`${this.logPrefix} auction already running, not starting a new one`);m(`${this.logPrefix} looking at buffer with ${this.buffer.length} entries`);const e=this.buffer.shift();if(m(`${this.logPrefix} adunits taken from buffer`,e),e)switch(e.origin){case Zt.FirstCall:this.startAuction(e.adUnits);break;case Zt.Refresh:this.startAuction([e.refreshableAdUnit.adUnit],{labels:["pubstackRefresh",`pubstackRefreshRank:${e.refreshableAdUnit.rank}`]});break;default:A(`${this.logPrefix} unknown buffer entry origin`)}else m(`${this.logPrefix} no more adunit to monetize in buffer`)}startAuction(e,t){if(this.auctionRunning=!0,e.forEach((e=>{Ee(e.divId,we.START_AUCTION)})),m(`${this.logPrefix} starting auctions for ${e.map((e=>e.divId))}`),this.pbjs){const i=this.pbjs.getPbjs();this.pbjs.startPbjsAuction(e,(()=>{this.kleanadsRunCount===si?this.pbjsFinished(i,e):m(`${Qt} kleanads run count has changed (from ${this.kleanadsRunCount} to ${si}), avoid calling pbjsFinished`)}),this.bidderAliases,t)}this.aps&&this.aps.startApsAuction(e,((t,i)=>{this.kleanadsRunCount===si?this.apsFinished(t,e,i):m(`${Qt} kleanads run count has changed (from ${this.kleanadsRunCount} to ${si}), avoid calling apsFinished`)})),this.pbjs||this.aps||this.adServer.executeWhenAdServerReady((()=>{this.kleanadsRunCount===si?this.callAdServer(e):m(`${Qt} kleanads run count has changed (from ${this.kleanadsRunCount} to ${si}), avoid calling AdServer`)}))}isAlreadyMonetized(e){return this.adUnitAuctionStatus.has(e.divId)}logAlreadyMonetizedAdUnits(e,t){if(e.length!==t.length){const t=e.filter((e=>this.adUnitAuctionStatus.has(e.divId)));w(`${this.logPrefix} cannot make a new ad call, existing one on ${t.map((e=>e.divId)).join(",")}.`)}}pbjsFinished(e,t){m(`${this.logPrefix} pbjs end callback for ${t.map((e=>e.divId)).join(",")}`,e.getAllPrebidWinningBids()),t.forEach((e=>{Ee(e.divId,we.END_PBJS_AUCTION),Be(e.divId)})),this.adServer.executeWhenAdServerReady((()=>{m(`${this.logPrefix} pbjs end callback ad server ready ${t.map((e=>e.divId)).join(",")}`),this.adServer.setPbjsTargetings(e,t),t.forEach((e=>{const t=this.adUnitAuctionStatus.get(e.divId);t&&this.adUnitAuctionStatus.set(e.divId,{...t,pbjsFinished:!0})})),this.canCallAdServer(t)&&this.callAdServer(t)}))}apsFinished(e,t,i){m(`${this.logPrefix} aps end callback ${t.map((e=>e.divId)).join(",")}`,i),t.forEach((e=>Ee(e.divId,we.END_APS_AUCTION))),this.adServer.executeWhenAdServerReady((()=>{m(`${this.logPrefix} aps end callback ad server ready ${t.map((e=>e.divId)).join(",")}`),this.adServer.setApsTargetings(e,t,i),t.forEach((e=>{const t=this.adUnitAuctionStatus.get(e.divId);t&&this.adUnitAuctionStatus.set(e.divId,{...t,apsFinished:!0})})),this.canCallAdServer(t)&&this.callAdServer(t)}))}canCallAdServer(e){const t=e.filter((e=>{const t=this.adUnitAuctionStatus.get(e.divId);return this.aps&&!this.pbjs?t&&t.apsFinished:this.pbjs&&!this.aps?t&&t.pbjsFinished:this.pbjs&&this.aps?t&&t.apsFinished&&t.pbjsFinished:void 0}));return t.length>0&&t.length!==e.length&&A(`${this.logPrefix} cannot call ad server for ${e.map((e=>e.divId)).join(",")}, some ad units are not ready`),t.length>0}callAdServer(e){if(this.auctionRunning=!1,this.startAuctionForBufferedAdUnits(),e.forEach((e=>{Ee(e.divId,we.START_AD_SERVER_CALL)})),e.length>0){this.adServer.callAdServer(e);const t=e.map((e=>e.divId));m(`${this.logPrefix} ad server called ${t.join(",")}`)}}}class ti{constructor(e,t,i,n){this.adUnitConfig=e,this.device=t,this.kleanAdsConfig=i,this.pageContext=n,this.adUnits=[],this.callbacks=[]}alreadyUsedDivIds(){return this.adUnits.map((e=>e.divId))}setConfig(e,t,i,n){this.adUnitConfig=e,this.device=t,this.kleanAdsConfig=i,this.pageContext=n,this.adUnits=[],this.callbacks=[]}async executeWhenAdUnitsFound(e){const t=(i=this.adUnitConfig,this.device,n=this.kleanAdsConfig,s=this.pageContext,ii(i.adUnits,i,0,n,s)).filter((e=>!this.alreadyUsedDivIds().includes(e.divId)));var i,n,s;if(this.adUnits.push(...t),await e(this.adUnits),this.callbacks.push(e),!this.adUnitObserver){const e=async e=>{const t=function(e,t,i,n,s){return ii([e],t,0,n,s)}(e,this.adUnitConfig,this.device,this.kleanAdsConfig,this.pageContext).filter((e=>!this.alreadyUsedDivIds().includes(e.divId))).reduce(((e,t)=>(e.find((e=>e.divId===t.divId))?A(`We tried to prepare two times the same divId, skipping adUnit ${t.adServerAdUnitName} from the list`,t):(e.push(t),y("New adUnit dynamicaly loaded",t.divId)),e)),[]);t.length>0&&(this.adUnits.push(...t),this.callbacks.forEach((async e=>{await e(t)})))};this.startAdUnitObserver(e)}}cleanObserverAndAdUnits(){var e;null===(e=this.adUnitObserver)||void 0===e||e.disconnect(),this.adUnitObserver=void 0,this.adUnits=[]}startAdUnitObserver(e){const t=this.alreadyUsedDivIds(),i=this.adUnitConfig.adUnits.filter((e=>!t.includes(e.divId)||e.dynamic)),n=document.body,s=new MutationObserver(function(e,t){return(i,n)=>{i.filter((e=>"childList"===e.type&&e.addedNodes.length>0)).forEach((i=>{Array.from(i.addedNodes).filter((e=>e.nodeType===Node.ELEMENT_NODE)).forEach((i=>{e.forEach((e=>{var n;const s=null!==(n=e.cssSelector)&&void 0!==n?n:e.dynamic?`[id^="${e.divId}"]`:`[id="${e.divId}"]`;(i.matches(s)||i.querySelectorAll(s).length>0)&&t(e)}))}))}))}}(i,e));s.observe(n,{childList:!0,subtree:!0}),this.adUnitObserver=s}}function ii(e,t,i,n,s){var o,a;const r=null!==(a=null===(o=null==t?void 0:t.gamConfig)||void 0===o?void 0:o.adUnitPathConfig)&&void 0!==a?a:[];return de(e,s,function(e,t){var i,n,s,o,a;const r=null!==(n=null===(i=null==t?void 0:t.gamConfig)||void 0===i?void 0:i.networkId)&&void 0!==n?n:e.networkId,d=(null===(s=null==t?void 0:t.gamConfig)||void 0===s?void 0:s.mcmIds)&&(null===(o=null==t?void 0:t.gamConfig)||void 0===o?void 0:o.mcmIds.length)>0?null===(a=null==t?void 0:t.gamConfig)||void 0===a?void 0:a.mcmIds:e.mcmIds;return r?d?[r,...d].join(","):r:""}(n,t),r,n.pubstackDeclarationTargetingKeys)}let ni=(()=>{let e,t,i=[St("onAdUnitConfigLoad")],n=[];return t=class{constructor(){this.name="AdUnitsManager"}get adUnitsManager(){return this._adUnitsManager}isLoaded(){return!!this._adUnitsManager}async load({config:e,adUnitConfig:t}){this._adUnitsManager=new ti(t,e.device,e,e.pageContext)}async onAdUnitConfigLoad({config:e,adUnitConfig:t}){var i;null===(i=this._adUnitsManager)||void 0===i||i.setConfig(t,e.device,e,e.pageContext)}async clean(){var e;null===(e=this._adUnitsManager)||void 0===e||e.cleanObserverAndAdUnits()}},function(e,t,i){"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}(t,"AdUnitsManagerModule"),(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(function(e,t,i,n,s,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,d=n.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),f=!1,g=i.length-1;g>=0;g--){var p={};for(var h in n)p[h]="access"===h?{}:n[h];for(var h in n.access)p.access[h]=n.access[h];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,i[g])("accessor"===d?{get:u.get,set:u.set}:u[l],p);if("accessor"===d){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(r=a(v.get))&&(u.get=r),(r=a(v.set))&&(u.set=r),(r=a(v.init))&&s.unshift(r)}else(r=a(v))&&("field"===d?s.unshift(r):u[l]=r)}c&&Object.defineProperty(c,n.name,u),f=!0})(null,e={value:t},i,{kind:"class",name:t.name,metadata:s},null,n),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e)}(t,n)})(),t})(),si=1;async function oi(e,t,s){var o,a,r;const d=window;if(!s&&d._kleanadslock)return void m("kleanads.js already started");var l,c;s&&d._kleanadslock&&m(`[SPA] reloading configuration (kleanadsRunCount: ${si})`),Ce(ye.BEGIN),m("starting kleanads.js Version",e.kleanadsVersion),window._kleanadslock=!0,l=e.tagId,c=e.kleanadsVersion,p=new f(l,c),h=l,v=c;const u=function(e,t){const i=t.sort(T);for(const t of i)if(e>=t.size)return t.device;return"desktop"}(d.innerWidth,e.screenSizeBreakpoints);et.getInstance().setUprState(null===(o=e.pocOverrides)||void 0===o?void 0:o.uprState);const g=function(e,t){const i=Ve(t),n=new Map(i.map((({key:e,defaultValue:t})=>[e,t])));e.document.querySelectorAll('meta[name^="pbstck_context:"]').forEach((e=>{var t,s;const o=null===(t=e.attributes.getNamedItem("name"))||void 0===t?void 0:t.value.substring(15).toLowerCase(),a=null===(s=e.attributes.getNamedItem("content"))||void 0===s?void 0:s.value.toLowerCase();if(o&&a){const e=i.find((({key:e})=>e===o));e&&(function(e,t){var i;return t.defaultValue===e||(null!==(i=t.otherValues)&&void 0!==i?i:[]).includes(e)}(a,e)?(n.set(o,a),m(`[context] found context ${o} with content ${a}`)):w(`[context] Unknown ${o} value ${a}`))}}));const s=new URLSearchParams(e.location.search);for(const e of s.keys())e.startsWith("pbstck_context:")&&(m(`[context] Add key ${e} found in URL to context`),n.set(e.slice(15),s.get(e)||""));return n}(d,e.context);0===g.size?m("[context] No context set"):(m("[context] The following context will be used:"),g.forEach(((e,t)=>{m(`[context] ${t} => ${e}`)})));const y=function(e,t){const i=e.filter(Vt).sort(((e,t)=>e.priority-t.priority)),n=e.filter(Gt);0===n.length&&A("[stacks] Could not find default stack"),n.length>1&&A("[stacks] Multiple default stacks found");const s=n[0],o=i.find((e=>function(e,t){return Array.isArray(e)?e.every((e=>t.get(e.key)===e.value)):Yt(e,t)}(e.conditions,t))),a=null!=o?o:s;return a?m(`[stacks] served stack: ${a.stackId} ${a===s?"(default stack)":""}`,a):A("[stacks] No stack to serve"),a}(e.stacks,g);if(!y)return void A("No stack found, stopping monetization");const E=function(e){const t=e.sort(((e,t)=>e.ratio-t.ratio));return _(void 0!==t[0].ratio?t[0].ratio:100)?t[0].version:t[1].version}(y.versions).toString();C("adm_stack",`${y.stackId}_v${E}`);const I={...e,device:u,stack:y,stackVersion:E,pageContext:g,enableConsentless:null!==(r=null===(a=e.pocOverrides)||void 0===a?void 0:a.enableConsentless)&&void 0!==r&&r,noCmp:$(),spaMode:Wt(e),pubstackWindow:d},U=new Tt(I,t);switch(await U.loadInitialModules(),I.spaMode){case"manual":m("[SPA] manual SPA enabled"),li((()=>{m("[SPA] manual page change requested, restarting kleanads.js"),ri(e,U)}));break;case"auto":m("[SPA] auto SPA enabled"),n(i.REPLACE_STATE),n(i.PUSH_STATE),di((()=>{m("[SPA] page change detected, restarting kleanads.js"),ri(e,U)}))}b=E;const O=async function(e,t,i,n){const s=function(e,t,i,n){const s=function(e,t,i,n,s){return`${e}/config/${t.scopeId.substring(0,8)}/${n.substring(0,8)}/${t.stackId}/${i}/${s}.json`}(e.configUrl,i,n,e.tagId,t);return s.replace(/([^:]\/)\/+/g,"$1")}(e,t,i,n);return new Promise((e=>{fetch(s).then((t=>{t.text().then((async t=>{const i=function(e){const t=JSON.parse(e);return{...t,lazyLoading:pe(t.lazyLoading),adUnits:he(t.adUnits),prebidConfig:ve(t.prebidConfig)}}(t);e(i)}))})).catch((async t=>{A(`unable to load the configuration ${t}`),e(void 0)}))}))}(e,u,y,E).then((e=>(e&&(e.prebidConfig.pbjsConfig.timeoutBuffer=function(){k("adm-ab-buffer"),function(e){const t=document.querySelector('meta[name="ad:adm-ab-buffer"]');t&&t.remove()}();let e=0;switch(j([70,10,10,10])){case 1:e=400;break;case 2:e=0;break;case 3:e=800;break;case 4:e=1600}return S("adm-ab-buffer",`${e}`),C("adm-ab-buffer",`${e}`),m("Timeout Buffer (ms) Ab test",e),e}()),e))).then((t=>t&&e.pocOverrides?function(e,t,i,n){return new Ht(e,t.pocOverrides||{}).withInstreamAdUnits().withFirstId().withDisableHeaderBidder(i).withInterstitialAdUnits().withAdUnitsOrder().withSkinRenderingSettings(t.tagId,n.stackId).withReworldAbcdefTest().withCssSelectors().withPrebidPpidSolution(t.tagId).withRefreshSpecificRules().withRefreshAlwaysInView().withStickyDivCreation().withEnableXpln().withOutbrainConfig(t.tagId).withFledgeForGpt().build()}(t,e,g,y):t));return{configPromise:O,kleanAdsConfig:I,moduleService:U}}async function ai(e){var t,i,n,s,o,a,r,d,l,c;const{configPromise:u,kleanAdsConfig:{device:f,pageContext:g,...p},moduleService:h}=e;m("StartKleanAds");const v=p.noCmp||await We(window);if(Ne!==Re.UNKNOWN&&je.next({name:"consent",values:{cmpResponseAvailable:$e(ye.CMP_RESPONSE_AVAILABLE),fromBeginCmpResponseAvailable:Ie(ye.BEGIN,ye.CMP_RESPONSE_AVAILABLE),consentType:Ne}}),await h.modulesDispatchEvent("onAfterConsent"),v?await h.modulesDispatchEvent("onAfterConsentAccepted"):await h.modulesDispatchEvent("onAfterConsentRefused"),v||p.enableConsentless){await h.modulesDispatchEvent("onBeforeAdUnitConfigLoad");const e=await u;if(m("[config] kleanAdsConfig :",p),m("[config] adUnitConfig :",e),e){if(p.pocOverrides&&p.pocOverrides.grapeshotTargetings){m("[pocOverrides] Poc Grapeshot enabled");const e=await async function(e){return new Promise((t=>{const i=`${e}${encodeURIComponent(window.location.href)}`,n=document.createElement("script");n.async=!0,n.src=i,n.onload=()=>t(window.gs_channels),setTimeout((()=>t(void 0)),3e3),n.onerror=()=>t(void 0),document.head.append(n)}))}(p.pocOverrides.grapeshotTargetings);et.getInstance().grapeshotValues=e}await h.modulesDispatchEvent("onAdUnitConfigLoad",{adUnitConfig:e}),(null===(t=p.pocOverrides)||void 0===t?void 0:t.waitForDOMLoaded)&&await new Promise((e=>{"complete"===document.readyState||"interactive"===document.readyState?(m(`${Q} document already loaded`),e()):window.addEventListener("DOMContentLoaded",(()=>{m(`${Q} DOMContentLoaded event fired`),e()}))}));const u=null===(i=h.getLoadedModuleInstance(Dt))||void 0===i?void 0:i.pbjs;u&&await h.modulesDispatchEvent("onAfterPrebidReady",{prebid:u});const v=null===(n=h.getLoadedModuleInstance(Ot))||void 0===n?void 0:n.aps,k=null===(s=h.getLoadedModuleInstance(At))||void 0===s?void 0:s.adServer,C=null===(o=h.getLoadedModuleInstance(ni))||void 0===o?void 0:o.adUnitsManager;if(!k)return void A("no adServer found, stopping monetization");if(!C)return void A("no adUnitManager found, stopping monetization");b=window,y=p.context,S=null!==(r=null===(a=e.gamConfig)||void 0===a?void 0:a.adUnitPathConfig)&&void 0!==r?r:[],function(e,t,i){const n=[],s=Ve(t).filter((e=>void 0!==e.defaultValue)).map((e=>e.key.toLowerCase())),o=[];e.document.querySelectorAll('meta[name^="pbstck_context:"]').forEach((e=>{var t;const i=null===(t=e.attributes.getNamedItem("name"))||void 0===t?void 0:t.value.substring(15).toLowerCase();i&&o.push(i)}));for(const e of i)s.includes(e)&&!o.includes(e)&&n.push(e);return n}(b,y,S).forEach((e=>{w(`[context] Missing ${e} context key used in adunit path`)}));const E=new ei(k,u,v,null!==(d=p.pbjsConfig.bidderAliases)&&void 0!==d?d:[],si),$=e.adUnits.some((e=>e.isInstream))?new Ke(new mt(window,g,f,null===(l=p.pocOverrides)||void 0===l?void 0:l.instreamConfig),u,v,null!==(c=p.pbjsConfig.bidderAliases)&&void 0!==c?c:[],si):void 0,I=async t=>{m("[config] adUnits to monetize:",t);const i=await h.modulesDispatchEvent("onPrepareAdUnits",{toPreparedAdUnits:t});Promise.all(i).then((()=>{m("[config] adUnits prepared"),h.modulesDispatchEvent("onAfterPrepareAdUnits",{preparedAdUnits:t})})),function(e,t,i,n){const s=e.filter((e=>e.roadblock)).filter((e=>!e.isInstream)).filter((e=>Z(e.divId))),o=e.filter((e=>!e.roadblock)).filter((e=>!e.lazyLoading)).filter((e=>!e.isInstream)).filter((e=>Z(e.divId))),a=e.filter((e=>!e.roadblock)).filter((e=>e.lazyLoading)).filter((e=>!e.isInstream)).filter((e=>Z(e.divId))),r=e.filter((e=>e.isInstream)).filter((e=>Z(e.divId)));t.executeAdCallRoadblock(s),t.executeAdCallRoadblock(o),r.length>0&&(r.length>1&&w(`cannot monetize multiple instream adunits, using only the first one ${r[0].divId}`),null==i||i.executeAdCall(r[0]));const d=function(e){if(e&&e.lazyLoadingKleanads){const t=e.lazyLoadingKleanads.viewportPercent/100;return m(`[lazyloading] lazy loading enabled with ${t} viewports`),(e,i)=>zt(e,i,t)}}(n);if(d){const e=new Mt(window,d);o.length>0?setTimeout((()=>{e&&Bt(a,e,t)}),1e3):Bt(a,e,t)}else o.length>0?setTimeout((()=>t.executeAdCall(a)),1e3):t.executeAdCall(a)}(t,E,$,e.lazyLoading)};await C.executeWhenAdUnitsFound(I);const O=e.refreshConfig,x=p.globalRefreshConfig;x&&O&&U(`${x.refreshModuleBaseUrl}/${p.kleanadsVersion}/kleanads-refresh.mjs`,3).then((e=>{e.initRefresh(C,E,O,k,p.pbjsConfig.bidderAliases)})).catch((e=>{A("Failed to load refresh module after 3 retries",e)}))}else A("no input configuration, stopping monetization")}else m("consent not given, no monetization");var b,y,S;Ce(ye.MAIN_THREAD_END)}const ri=async(e,t)=>{si+=1,m("Unloading Kleanads, run cleanup on all modules");const i=t.getModules();await t.modulesCleanUp(),m("Kleanads unloaded, restarting");const n=await oi(e,i,!0);n&&ai(n)},di=t=>{const i=new MutationObserver((()=>{s()})),n=e=>{const t=e,n=new URL(t.detail.referrer),s=(o=t.detail.url)?`${o}`.startsWith("http")?new URL(o).pathname:`${o}`:"";var o;n.pathname!==s&&i.observe(document.head,{attributes:!0,childList:!0,subtree:!0})};window.addEventListener(e.HISTORY_MUTATION,n);const s=()=>{window.removeEventListener(e.HISTORY_MUTATION,n),i.disconnect(),window.dispatchEvent(new CustomEvent(e.PAGE_CHANGE)),t()}},li=i=>{const n=()=>{s()};window.addEventListener(t.SPA_RELOAD,n);const s=()=>{window.removeEventListener(t.SPA_RELOAD,n),window.dispatchEvent(new CustomEvent(e.PAGE_CHANGE)),i()}};let ci=(()=>{let e,t,i=[St("onAfterConsent")],n=[];return t=class{constructor(){this.name="Collector",this._isLoaded=!1}isLoaded(){return!!this._isLoaded}async load(){this._isLoaded=!0}async onAfterConsent({config:e}){setTimeout((()=>{m("Downloading pubstack collector"),I(`https://boot.pbstck.com/v1/tag/${e.tagId}`)}),200)}async clean(){}},function(e,t,i){"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}(t,"CollectorModule"),(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(function(e,t,i,n,s,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,d=n.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),f=!1,g=i.length-1;g>=0;g--){var p={};for(var h in n)p[h]="access"===h?{}:n[h];for(var h in n.access)p.access[h]=n.access[h];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,i[g])("accessor"===d?{get:u.get,set:u.set}:u[l],p);if("accessor"===d){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(r=a(v.get))&&(u.get=r),(r=a(v.set))&&(u.set=r),(r=a(v.init))&&s.unshift(r)}else(r=a(v))&&("field"===d?s.unshift(r):u[l]=r)}c&&Object.defineProperty(c,n.name,u),f=!0})(null,e={value:t},i,{kind:"class",name:t.name,metadata:s},null,n),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e)}(t,n)})(),t})();let ui=(()=>{let e,t,i=[St("onAfterConsent")],n=[];return t=class{constructor(){this._isLoaded=!1,this.name="ExtraScripts"}isLoaded(){return this._isLoaded}async load({config:e}){var t,i;if(e.pocOverrides&&e.pocOverrides.extraScripts){m("Loading extraScripts");const n=(null!==(i=null===(t=e.pocOverrides)||void 0===t?void 0:t.extraScripts)&&void 0!==i?i:[]).filter((t=>t.tagId===e.tagId)),s=n.filter((({synchronous:e})=>!e)).flatMap((e=>e.scripts)),o=n.filter((({synchronous:e})=>e)).flatMap((e=>e.scripts));m(`downloading async extra script ${s}`),s.forEach((e=>I(e))),m(`downloading sync extra script ${o}`);for(const e of o)try{await U(e)}catch(e){m("[extra-script] Error while loading sync extra script",e)}this._isLoaded=!0}}async clean(){}},function(e,t,i){"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}(t,"ExtraScriptsModule"),(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(function(e,t,i,n,s,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,d=n.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),f=!1,g=i.length-1;g>=0;g--){var p={};for(var h in n)p[h]="access"===h?{}:n[h];for(var h in n.access)p.access[h]=n.access[h];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,i[g])("accessor"===d?{get:u.get,set:u.set}:u[l],p);if("accessor"===d){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(r=a(v.get))&&(u.get=r),(r=a(v.set))&&(u.set=r),(r=a(v.init))&&s.unshift(r)}else(r=a(v))&&("field"===d?s.unshift(r):u[l]=r)}c&&Object.defineProperty(c,n.name,u),f=!0})(null,e={value:t},i,{kind:"class",name:t.name,metadata:s},null,n),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e)}(t,n)})(),t})();let fi=(()=>{let e,t,i=[St("onAdUnitConfigLoad")],n=[];return t=class{constructor(){this.name="SkinRendering",this._isLoaded=!1,this.eligibleForSkinRendering=!1}isLoaded(){return this._isLoaded}async load({config:e,adUnitConfig:t}){var i,n,s,o,a,r,d,l,c,u;this.eligibleForSkinRendering=function(e,t){var i,n,s,o,a,r,d,l,c;return!!(null===(o=null===(s=null===(n=null===(i=e.pocOverrides)||void 0===i?void 0:i.skinRenderingSettings)||void 0===n?void 0:n.siteLevel)||void 0===s?void 0:s[e.tagId])||void 0===o?void 0:o.enabledSkinRenderAdaptation)&&!(null===(l=null===(d=null===(r=null===(a=e.pocOverrides)||void 0===a?void 0:a.skinRenderingSettings)||void 0===r?void 0:r.stackLevel)||void 0===d?void 0:d[e.stack.stackId])||void 0===l?void 0:l.disableSkinRenderAdaptation)&&(null===(c=t.adUnits)||void 0===c?void 0:c.some((e=>e.sizes.some((e=>F(e,[1800,1e3]))))))}(e,t);const{maxHeaderHeightPx:f,marginTopPx:g,siteContentWidthPx:p,additionalSkinRenderingCss:h}=null!==(u=null!==(a=null===(o=null===(s=null===(n=null===(i=e.pocOverrides)||void 0===i?void 0:i.skinRenderingSettings)||void 0===n?void 0:n.stackLevel)||void 0===s?void 0:s[e.stack.stackId])||void 0===o?void 0:o.style)&&void 0!==a?a:null===(c=null===(l=null===(d=null===(r=e.pocOverrides)||void 0===r?void 0:r.skinRenderingSettings)||void 0===d?void 0:d.siteLevel)||void 0===l?void 0:l[e.tagId])||void 0===c?void 0:c.style)&&void 0!==u?u:{};this.configuredMaxHeaderHeightPx=f,this.configuredMarginTopPx=g,this.configuredSiteContentWidthPx=p,this.configuredAdditionalSkinRenderingCss=h,this.eligibleForSkinRendering&&(this._isLoaded=!0)}async onAfterPrebidReady({prebid:e}){this.pbjs=e,this.eligibleForSkinRendering&&this.pbjs.getPbjs().onEvent("bidWon",this.applySkinRendering.bind(this))}async clean(){this.eligibleForSkinRendering&&this.pbjs&&this.pbjs.getPbjs().offEvent("bidWon",this.applySkinRendering.bind(this)),this._isLoaded=!1}shouldApplySkinRendering(e){var t;const i=["sublime","justpremium"],n=null===(t=this.pbjs)||void 0===t?void 0:t.getPbjs();if(n){const t=i.some((t=>e.bidderCode===t||n.aliasRegistry[e.bidderCode]===t));return"1800x1000"===e.size&&!t}return u("kleanads-refresh","shouldApplySkinRendering: unable to get aliasRegistry: prebid is not defined"),!1}applySkinRendering(e){var t,i,n,s;const o="pbstck_skin_rendering",a=document.getElementById(e.adUnitCode);if(a)if(this.shouldApplySkinRendering(e)){const r=null!==(t=this.configuredMaxHeaderHeightPx)&&void 0!==t?t:250,d=null!==(i=this.configuredMarginTopPx)&&void 0!==i?i:0,l=null!==(n=this.configuredSiteContentWidthPx)&&void 0!==n?n:1e3,c=null!==(s=this.configuredAdditionalSkinRenderingCss)&&void 0!==s?s:"",u=1e3,f=(1800-l)/2,g=f+l,p=document.createElement("style");p.textContent=`\n          #${e.adUnitCode}.${o} {\n            /* leave security margin to help display top of creative */\n            height: ${r}px;\n            /* set it properly in page flow */\n            display: block;\n            margin-top: ${d}px;\n          }\n\n          #${e.adUnitCode}.${o} > div {\n            /* horizontally center creative */\n            transform: translateX(-50%);\n            position: absolute;\n            left: 50%;\n\n            /* clipping out the unused part of the creative to leave content visible */\n            clip-path: polygon(0 0, 0% 100%, ${f}px ${u}px, ${f}px ${r}px, ${g}px ${r}px, ${g}px 100%, 100% 100%, 100% 0%);\n          }\n\n          ${c}\n          `,document.head.appendChild(p),a.classList.add(o)}else a.classList.contains(o)&&e.labels.includes("pubstackRefresh")&&a.classList.remove(o);else w(`onBidwon: skinRendering impossible - adUnitDiv not found for ${e.adUnitCode}`)}},function(e,t,i){"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}(t,"SkinRenderingModule"),(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(function(e,t,i,n,s,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,d=n.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),f=!1,g=i.length-1;g>=0;g--){var p={};for(var h in n)p[h]="access"===h?{}:n[h];for(var h in n.access)p.access[h]=n.access[h];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,i[g])("accessor"===d?{get:u.get,set:u.set}:u[l],p);if("accessor"===d){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(r=a(v.get))&&(u.get=r),(r=a(v.set))&&(u.set=r),(r=a(v.init))&&s.unshift(r)}else(r=a(v))&&("field"===d?s.unshift(r):u[l]=r)}c&&Object.defineProperty(c,n.name,u),f=!0})(null,e={value:t},i,{kind:"class",name:t.name,metadata:s},null,n),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e)}(t,n)})(),t})();const gi="adm-ad-loading",pi="adm-ad-empty",hi="adm-ad-rendered",vi="adm-ad-skin",bi="data-adm-skin";let mi=(()=>{let e,t,i=[St("onAdUnitConfigLoad")],n=[];return t=class{constructor(){this.name="CssClass",this._isLoaded=!1}async load({config:e}){this.pubstackWindow=e.pubstackWindow,gt((()=>{var e;null===(e=this.pubstackWindow)||void 0===e||e.googletag.pubads().addEventListener("slotRenderEnded",this.applyClassBySlotRenderEndedEvent)})),this._isLoaded=!0}async onAfterPrebidReady({prebid:e}){e.getPbjs().onEvent("bidWon",this.applyClassByBidWon)}async applyClassBySlotRenderEndedEvent(e){var t;const i=e.slot.getSlotElementId(),n=document.getElementById(i);n&&(e.isEmpty?(n.classList.replace(gi,pi),m(`[CSS Class] slot empty: ${i}`)):(n.classList.replace(gi,hi),n.classList.replace(pi,hi),(null===(t=e.size)||void 0===t?void 0:t.length)&&1800===e.size[0]&&1e3===e.size[1]?(n.classList.add(vi),n.setAttribute(bi,"gam"),m(`[CSS Class] slot rendered is skin: ${i}`)):(n.classList.remove(vi),n.removeAttribute(bi)),m(`[CSS Class] slot rendered: ${i}`)))}applyClassByBidWon(e){const t=document.getElementById(e.adUnitCode);"1800x1000"===e.size&&(null==t||t.classList.add(vi),null==t||t.setAttribute(bi,"prebid"),m(`[CSS Class] bidWon is skin: ${e.adUnitCode}`))}async onPrepareAdUnits({toPreparedAdUnits:e}){e&&e.forEach((e=>{const t=document.getElementById(e.divId);t&&t.classList.add(gi)}))}isLoaded(){return this._isLoaded}clean(){return this._isLoaded=!1,Promise.resolve(void 0)}},function(e,t,i){"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}(t,"CssClassModule"),(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(function(e,t,i,n,s,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,d=n.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),f=!1,g=i.length-1;g>=0;g--){var p={};for(var h in n)p[h]="access"===h?{}:n[h];for(var h in n.access)p.access[h]=n.access[h];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,i[g])("accessor"===d?{get:u.get,set:u.set}:u[l],p);if("accessor"===d){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(r=a(v.get))&&(u.get=r),(r=a(v.set))&&(u.set=r),(r=a(v.init))&&s.unshift(r)}else(r=a(v))&&("field"===d?s.unshift(r):u[l]=r)}c&&Object.defineProperty(c,n.name,u),f=!0})(null,e={value:t},i,{kind:"class",name:t.name,metadata:s},null,n),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e)}(t,n)})(),t})();class yi extends HTMLElement{static get observedAttributes(){return["height"]}constructor(){super(),this.attachShadow({mode:"open"}),this.mutationObserver=new MutationObserver((()=>{this.updateShadowLayout()}))}get height(){var e,t;return parseInt(null!==(e=this.getAttribute("height"))&&void 0!==e?e:"0")||parseInt(null!==(t=this.style.height)&&void 0!==t?t:"0")||yi.defaultParallaxHeight}connectedCallback(){this.isConnected&&(this.setAttribute("data-pbstck-component","no-ad"),this.setShadowDom("<div />"),this.updateShadowLayout(),this.mutationObserver.observe(this,{subtree:!0,childList:!0}))}disconnectedCallback(){this.mutationObserver.disconnect()}attributeChangedCallback(){this.updateShadowLayout()}getHighestChild(){const e=Array.from(this.children);if(0!==e.length)return wi(e)}setPosition(){const e=this.getBoundingClientRect(),t=this.getHighestChild();if(e&&t){const i=100-(e.top-yi.defaultMarges)/(window.innerHeight-2*yi.defaultMarges-this.offsetHeight)*100,n=t.offsetHeight-this.offsetHeight;t.style.bottom=i>0&&i<100?`-${i/100*n}px`:i>=100?`-${n}px`:"0px"}}setShadowDom(e){this.shadowRoot&&(this.shadowRoot.innerHTML=`\n        <style> \n            :host {\n            display:block;\n            min-width: 300px;\n            max-width: 100%;\n            min-height: ${this.height}px;\n            max-height: ${this.height}px;\n            overflow: hidden;\n            position: relative;\n            margin: 0 auto;\n            }\n        </style>\n        ${e}`)}setLayoutBanner(){const e=document.createElement("div");e.className="banner",e.style.width="100%",e.style.minHeight=`${this.offsetHeight}px`,e.style.maxHeight=`${this.offsetHeight}px`,e.style.display="flex",e.style.margin="0 auto",e.style.justifyContent="center",e.style.alignItems="center";const t=document.createElement("div"),i=document.createElement("slot");t.append(i),e.append(t),this.setAttribute("data-pbstck-component","banner"),this.setShadowDom(e.outerHTML),document.removeEventListener("scroll",(()=>{this.setPosition()}))}setLayoutParallax(){if(!this.shadowRoot)return;const e=document.createElement("div");e.className="parallax",e.style.width="100%",e.style.height=`${this.offsetHeight}px`,e.style.margin="0 auto",e.style.padding="0",e.style.position="relative",e.style.overflow="hidden";const t=document.createElement("div");t.style.minHeight="100%",t.style.clipPath="inset(0 0 0 0)";const i=document.createElement("slot"),n=document.createElement("div");n.append(i),t.append(n),e.append(t),this.setAttribute("data-pbstck-component","parallax"),this.setShadowDom(`${e.outerHTML}`);const s=this.getHighestChild();s&&(s.style.transform="translate3d(0,0,0)",s.style.position="absolute",s.style.transitionDuration="200ms",s.style.transition="bottom",s.style.left="0",s.style.right="0",s.style.margin="0 auto"),this.setPosition(),document.addEventListener("scroll",(()=>{this.setPosition()}))}updateShadowLayout(){var e;m(`[parallax] [better-parallax] element ${this.parentElement}`),0===(null===(e=this.parentElement)||void 0===e?void 0:e.offsetWidth)&&w(`[parallax] [better-parallax] parent element of better-parallax#${this.id} has a 0 width`);const t=this.getHighestChild();if(void 0===t)return;const i=getComputedStyle(t);parseInt(i.width),parseInt(i.height)<=this.height?this.setLayoutBanner():this.setLayoutParallax(),Array.from(this.querySelectorAll("iframe")).filter((e=>!e.hasAttribute("data-pbstck-loaded"))).forEach((e=>e.addEventListener("load",(()=>{e.setAttribute("data-pbstck-loaded","true"),this.updateShadowLayout()}))))}}yi.defaultParallaxHeight=310,yi.defaultMarges=40;const wi=e=>e.reduce(((e,t)=>{const i=getComputedStyle(e),n=getComputedStyle(t);return parseInt(n.height)>parseInt(i.height)?t:e}),e[0]);if("function"==typeof(null===customElements||void 0===customElements?void 0:customElements.define)&&"function"==typeof MutationObserver)try{customElements.define("better-parallax",yi)}catch(e){A(`[parallax] [better-parallax] unable to define better-parallax, error "${e}"`)}else w('[parallax] [better-parallax] unable to load better-parallax, error: "browser not compatible"');function Ai(e){if(e.parallax){const t=e.divId,i=document.getElementById(t);m("[parallax]",e);const n=document.createElement("better-parallax");if(n.id=t,n.style.width="100%",i){i.id=`${t}-parallax`,i.appendChild(n);const s=function(e){var t;const i=e.parentElement;return i&&1===i.childNodes.length&&i.style.minHeight&&null!==(t=parseInt(i.style.minHeight,10))&&void 0!==t?t:0}(i),o=Math.max(...P(e.sizes).map((([,e])=>e))),a=o/2+10,r=Math.max(310,a,s);n.style.height=`${r}px`,n.setAttribute("height",`${r}px`)}}}var Si;class ki extends HTMLElement{constructor(){super();const e=window.kleanadsPbjs;if(e)try{e.onEvent("bidWon",this.winningBid.bind(this))}catch(e){w("[pbstck-sticky] unable to listen to bidWon event",e)}else w("[pbstck-sticky] pbjs not loaded, unable to listen to bidWon event");this.attachShadow({mode:"open"}),this.mutationObserver=new MutationObserver((e=>{m("[pbstck-sticky] [mutationObs]",e),this.isAddingCreative(e)?(m("[pbstck-sticky] [mutationObs] add element on nested"),this.setDisplay()):(m("[pbstck-sticky] [mutationObs] no element in sticky"),this.unSetDisplay()),this.updateShadowLayout()}))}winningBid(e){e.adUnitCode===this.id&&(m("[pbstck-sticky] [winningBid]",e),m("[pbstck-sticky] [winningBid]",e.bidderCode,e.adUnitCode),"ogury"!==e.bidderCode&&"missena"!==e.bidderCode&&"seedtag"!==e.bidderCode||this.setSpecialBidder())}unSetDisplay(){Si.shouldDisplay=!1,this.updateShadowLayout()}setDisplay(){Si.shouldDisplay=!0,this.updateShadowLayout()}setSpecialBidder(){Si.specialBidder=!0,this.updateShadowLayout()}isAddingCreative(e){var t,i,n;return(null===(t=e[0])||void 0===t?void 0:t.addedNodes[0])&&(null===(n=null===(i=e[0])||void 0===i?void 0:i.target.parentElement)||void 0===n?void 0:n.id)===this.id}connectedCallback(){this.isConnected&&(m("[pbstck-sticky] no-ad"),this.setAttribute("data-pbstck-component","no-ad"),this.setShadowDom("<div></div>"),this.updateShadowLayout(),this.mutationObserver.observe(this,{subtree:!0,childList:!0}))}disconnectedCallback(){this.mutationObserver.disconnect()}attributeChangedCallback(){this.updateShadowLayout()}getHighestChild(){const e=Array.from(this.children);if(0!==e.length)return Ci(e)}setShadowDom(e){this.shadowRoot&&(Si.shouldDisplay&&!Si.specialBidder?this.shadowRoot.innerHTML=`\n          <style> \n              :host {\n                display: block;\n                width: 100%;\n                max-height: ${Si.maxHeight}px;\n                overflow: hidden;\n                position: fixed;\n                bottom: 0;\n                margin: 0;\n                padding: 0;\n                z-index: 99999999;\n              }\n              .sticky-button {\n                height: 28px;\n                width: 28px;\n                background: ${Si.backgroundColor};\n                position: absolute;\n                bottom: 0;\n                right: 0;\n                border-radius: 5px 0 0 0;\n                box-shadow: rgba(0, 0, 0, 0.2) -2px -2px 3px -1px, rgba(0, 0, 0, 0.1) -1px -1px 2px -1px !important;\n              }\n              .sticky-button-container {\n                height: 30px;\n                position: relative;\n              }\n              .sticky-button-text {\n                display: block;\n                height: 22px;\n                width: 22px;\n                padding: 3px;\n              }\n              .sticky-container {\n                background: ${Si.backgroundColor};\n                padding: 8px 0;\n                box-shadow: rgba(0, 0, 0, 0.2) 0px -1px 5px -1px, rgba(0, 0, 0, 0.1) 0px 1px 2px -1px !important;\n              }\n              .sticky-container slot > * {\n                position: relative;\n              }\n              ::slotted(*) {\n                position: relative;\n              }\n              .cross {\n                display: block;\n              }\n              .sticky-container slot {\n                width: fit-content;\n                width: -moz-fit-content;\n                block-size: fit-content;\n                margin: 0 auto !important;\n                display: block;\n              }\n            }\n          </style>\n          ${e}`:Si.shouldDisplay&&Si.specialBidder?(this.shadowRoot.innerHTML="\n          <style>\n              :host {\n                display: block;\n                width: 100%;\n                height: 1px;\n                background: transparent;\n                position: fixed;\n                bottom: 0;\n              }\n          </style><div></div>",Si.specialBidder=!1):this.shadowRoot.innerHTML="\n          <style>\n              :host {\n                display: none;\n              }\n          </style>")}updateShadowLayout(){if(m(`[pbstck-sticky] updating element ${this.id}`),!this.shadowRoot)return;this.setAttribute("data-pbstck-component","sticky");const e=document.createElement("div");e.className="sticky-container";const t=document.createElement("slot");e.append(t),this.setShadowDom(`${e.outerHTML}`);const i=this.getHighestChild();if(i){i.style.display="block",i.style.margin="0 auto",i.style.bottom="0",i.style.maxHeight=`${Si.maxCreativeHeight}px`;const e=document.createElement("div");e.className="sticky-button-container";const t=document.createElement("div");t.className="sticky-button";const n=document.createElement("div");n.className="sticky-button-text",n.addEventListener("click",(()=>{m("[pbstck-sticky] Close button pressed, hiding the sticky adunit"),this.unSetDisplay()}));const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M 5.3,18.7 C 5.5,18.9 5.7,19 6,19 6.3,19 6.5,18.9 6.7,18.7 l 5.3,-5.3 5.3,5.3 c 0.2,0.2 0.5,0.3 0.7,0.3 0.2,0 0.5,-0.1 0.7,-0.3 0.4,-0.4 0.4,-1 0,-1.4 L 13.4,12 18.7,6.7 c 0.4,-0.4 0.4,-1 0,-1.4 -0.4,-0.4 -1,-0.4 -1.4,0 L 12,10.6 6.7,5.3 c -0.4,-0.4 -1,-0.4 -1.4,0 -0.4,0.4 -0.4,1 0,1.4 l 5.3,5.3 -5.3,5.3 c -0.4,0.4 -0.4,1 0,1.4 z");const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("viewBox","0 0 24 24"),o.setAttribute("class","cross"),o.setAttribute("height","22px"),o.setAttribute("width","22px"),o.setAttribute("fill","#333"),o.append(s),n.append(o),t.append(n),e.append(t),this.shadowRoot.prepend(e)}}}Si=ki,ki.backgroundColor="rgb(250, 250, 250)",ki.maxCreativeHeight=216,ki.buttonHeight=32,ki.maxHeight=Si.maxCreativeHeight+Si.buttonHeight,ki.shouldDisplay=!1,ki.specialBidder=!1;const Ci=e=>e.reduce(((e,t)=>t.offsetHeight>e.offsetHeight?t:e),e[0]);if("function"==typeof(null===customElements||void 0===customElements?void 0:customElements.define)&&"function"==typeof MutationObserver)try{customElements.define("pbstck-sticky",ki)}catch(e){A(`[pbstck-sticky] unable to define pbstck-sticky, error "${e}"`)}else w('[pbstck-sticky] unable to load pbstck-sticky, error: "browser not compatible"');function Ei(e){if(e.sticky){const t=e.divId,i=document.getElementById(t);m("[pbstck-sticky]",e);const n=document.createElement("pbstck-sticky");if(n.id=t,i)m(`[pbstck-sticky] div ${t} existing`),i.id=`${t}-sticky`,i.appendChild(n);else{m(`[pbstck-sticky] div ${t} not existing`);const e=document.createElement("div");e.id=`${t}-sticky`,e.appendChild(n),document.body.appendChild(e)}}}let $i=(()=>{let e,t,i=[St("onAdUnitConfigLoad")],n=[];return t=class{constructor(){this.name="ContainersModule",this.loaded=!1}isLoaded(){return this.loaded}async load(){this.loaded=!0}async onPrepareAdUnits({config:e,toPreparedAdUnits:t}){for(const i of null!=t?t:[])i.parallax&&Ai(i),"mobile"===e.device&&i.sticky&&Ei(i)}async clean(){this.loaded=!1}},function(e,t,i){"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}(t,"ContainersModule"),(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(function(e,t,i,n,s,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,d=n.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),f=!1,g=i.length-1;g>=0;g--){var p={};for(var h in n)p[h]="access"===h?{}:n[h];for(var h in n.access)p.access[h]=n.access[h];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,i[g])("accessor"===d?{get:u.get,set:u.set}:u[l],p);if("accessor"===d){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(r=a(v.get))&&(u.get=r),(r=a(v.set))&&(u.set=r),(r=a(v.init))&&s.unshift(r)}else(r=a(v))&&("field"===d?s.unshift(r):u[l]=r)}c&&Object.defineProperty(c,n.name,u),f=!0})(null,e={value:t},i,{kind:"class",name:t.name,metadata:s},null,n),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e)}(t,n)})(),t})();let Ii=(()=>{let e,t,i=[St("onAfterPrepareAdUnits")],n=[];return t=class{constructor(){this.name="XplnModule",this.loaded=!1}async load(){this.loaded=!0}async onAfterPrepareAdUnits({config:e,adUnitConfig:t}){m("XplnModule declare xpln targeting when ready"),(null==t?void 0:t.xplnConfig)&&Oi(e.pubstackWindow)}async clean(){this.loaded=!1}isLoaded(){return this.loaded}},function(e,t,i){"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}(t,"XplnModule"),(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(function(e,t,i,n,s,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,d=n.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),f=!1,g=i.length-1;g>=0;g--){var p={};for(var h in n)p[h]="access"===h?{}:n[h];for(var h in n.access)p.access[h]=n.access[h];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,i[g])("accessor"===d?{get:u.get,set:u.set}:u[l],p);if("accessor"===d){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(r=a(v.get))&&(u.get=r),(r=a(v.set))&&(u.set=r),(r=a(v.init))&&s.unshift(r)}else(r=a(v))&&("field"===d?s.unshift(r):u[l]=r)}c&&Object.defineProperty(c,n.name,u),f=!0})(null,e={value:t},i,{kind:"class",name:t.name,metadata:s},null,n),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e)}(t,n)})(),t})();const Ui=(e,t)=>{if(!(t>15))return e.xpln_targeting&&e.xpln_targeting.toString().length>100?(e.xpln_targeting(),void m("XPLN targeting called")):void setTimeout((()=>Ui(e,t+1)),300);w("Could not declare XPLN targetings, xpln_targeting function is undefined")},Oi=e=>{Ui(e,0)};let xi=(()=>{let e,t,i=[St("onAdUnitConfigLoad")],n=[];return t=class{constructor(){this.name="PublicAccessModule",this._isLoaded=!1}isLoaded(){return this._isLoaded}async load({config:e,adUnitConfig:t}){e.pubstackWindow._pbstckKleanAds.getBootstrapConfig=()=>{const{pubstackWindow:t,...i}=e;return i},e.pubstackWindow._pbstckKleanAds.getStackConfig=()=>t,e.pubstackWindow._pbstckKleanAds.apiReady=!0,this._isLoaded=!0}async clean({config:e}){e.pubstackWindow._pbstckKleanAds.apiReady=!1,e.pubstackWindow._pbstckKleanAds.getBootstrapConfig=()=>{throw new Error("Not ready yet, wait for apiLoaded.")},e.pubstackWindow._pbstckKleanAds.getStackConfig=()=>{throw new Error("Not ready yet, wait for apiLoaded.")}}},function(e,t,i){"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}(t,"PublicAccessModule"),(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(function(e,t,i,n,s,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,d=n.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),f=!1,g=i.length-1;g>=0;g--){var p={};for(var h in n)p[h]="access"===h?{}:n[h];for(var h in n.access)p.access[h]=n.access[h];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,i[g])("accessor"===d?{get:u.get,set:u.set}:u[l],p);if("accessor"===d){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(r=a(v.get))&&(u.get=r),(r=a(v.set))&&(u.set=r),(r=a(v.init))&&s.unshift(r)}else(r=a(v))&&("field"===d?s.unshift(r):u[l]=r)}c&&Object.defineProperty(c,n.name,u),f=!0})(null,e={value:t},i,{kind:"class",name:t.name,metadata:s},null,n),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e)}(t,n)})(),t})();const Ti=[class{constructor(){this.name="DataDogMetric"}isLoaded(){return!!this._dataDogMetrics&&je.subscriptions.length>0}async load({config:e}){this._dataDogMetrics=new Le(e.tagId,e.kleanadsVersion,e.device,e.metricThrottling),je.subscribe((e=>{var t;return null===(t=this._dataDogMetrics)||void 0===t?void 0:t.handleMetric(e)}))}async clean(){this._dataDogMetrics=void 0,je.subscriptions=[]}},class{constructor(){this.name="Metas",this._isLoaded=!1,this.metaTags=[]}async load({config:e}){S("kleanads-version",e.kleanadsVersion),S("config-version",e.stackVersion),S("kleanads-stack-id",e.stack.stackId),this.metaTags.push("kleanads-version","config-version","kleanads-stack-id"),et.getInstance().uprTested&&(S("xp_variant",`floor_optimization:${et.getInstance().uprEnabled}`),this.metaTags.push("xp_variant")),this._isLoaded=!0}isLoaded(){return this._isLoaded}async clean(){this.metaTags.forEach((e=>{try{k(e)}catch(e){w(`Unable to remove meta tag ${k}`,e)}})),this._isLoaded=!1}},class{constructor(){this.name="UserSessions",this._isLoaded=!1}isLoaded(){return this._isLoaded}async load({config:e}){var t;this.isLoaded()||(null===(t=e.pocOverrides)||void 0===t?void 0:t.doNotLoadUserSessionsScript)||(m("Loading user-sessions script"),I(`https://boot.pbstck.com/v1/user-sessions/${e.tagId}`),this._isLoaded=!0)}async clean(){}},ui,Dt,Ot,At,ci,ni,fi,mi,$i,Ii,xi];class Pi{static getModules(){return Ti}}window._pbstckKleanAds={initKleanAds:async function(e){const t=await oi(e,Pi.getModules().map((e=>new e)));t&&ai(t)},apiReady:!1,getBootstrapConfig:()=>{throw new Error("Not ready yet, wait for apiReady.")},getStackConfig:()=>{throw new Error("Not ready yet, wait for apiReady.")}}})();