!function(){var e,t=new i,o="identity-resolver.api.kochava.com";if("undefined"!=typeof window){var n=window.kochava;window.kochava=t}.prototype.init=function(t,o,n,i){if(e.startTime=t,e.appID=o,e.page_name=c(),e.useCookie=i||!1,e.verbose=n||!1,"undefined"!=typeof console&&void 0!==console.log?e.logging=!0:e.logging=!1,null!=o&&""!=o){e.utm=g("ko_click_id",o+"_click",e.useCookie);var r=g("kv_id","kv_id",e.useCookie);e.kvID=""==r?_(e.useCookie):r,""==r&&e.install()}},i.prototype.identify=function(t,o){var n;if(""!=(n="string"==typeof t?JSON.stringify({custom_id:t}):JSON.stringify(t)||"")?(e.customTraits=n,v("c_trt",e.customTraits,e.useCookie)):e.customTraits=g("c_trt","c_trt",e.useCookie),""!=e.customTraits)try{var i={method:"POST",endpoint:"web-sdk.control.kochava.com/v1/cpi/identityLink.php",body:e.getIdentityPayload(e.customTraits),contentType:"application/json",retries:10,async:!0};e.verbose&&e.logging&&console.log("kochava.identify request: ",i),a(i,o)}catch(t){e.verbose&&e.logging&&console.log("kochava.identify error: ",t.message)}},i.prototype.submitCookieId=function(t,n,i,r,c,s){try{var l={method:"POST",endpoint:o+"/cookie/submit",body:{partner_cookie_id:t},contentType:"application/json",retries:10,async:c,appGuid:n,authCode:r,nonce:i,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.submitCookieId request: ",l),a(l,s)}catch(t){e.verbose&&e.logging&&console.log("kochava.submitCookieId error: ",t.message)}},i.prototype.getCookieId=function(t,n,i){try{var r={method:"GET",endpoint:o+"/cookie/retrieve",contentType:"application/json",retries:10,async:n,appGuid:t,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.getCookieId request: ",r),a(r,i)}catch(t){e.verbose&&e.logging&&console.log("kochava.getCookieId error: ",t.message)}},i.prototype.getMAID=function(t,n,i,r,c){try{var s={method:"GET",endpoint:o+"/maid/get",contentType:"application/json",retries:10,async:r,appGuid:t,authCode:i,nonce:n,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.getMAID request: ",s),a(s,c)}catch(t){e.verbose&&e.logging&&console.log("kochava.getMAID error: ",t.message)}},i.prototype.activity=function(t,o,n){t=t||"";try{var i={method:"POST",endpoint:"web-sdk.control.kochava.com/track/json",body:e.getPayload(t,o),contentType:"application/json",retries:10,async:!0};e.verbose&&e.logging&&console.log("kochava request: ",i),a(i,n)}catch(t){e.verbose&&e.logging&&console.log("kochava error: ",t.message)}},i.prototype.page=function(t,o,n){e.page_name=t||e.page_name,e.activity("page",o,n)},i.prototype.conversion=function(t,o,n){t=t||"",e.activity("conversion_"+t,o,n)},i.prototype.install=i.prototype.getKochavaId=i.prototype.getPayload=function(t,o){o=o||{};var n={kochava_app_id:e.appID,kochava_device_id:e.kvID,sdk_version:"2.1.0",data:{language:l(),device_orientation:p(),user_agent:s(),device_ids:{kochava_device_id:e.kvID}}};if("install"==t)n.action="install";else if(n.action="event",n.data.event_name=t,n.data.event_data={page_name:e.page_name},"object"==typeof o)for(key in o)o.hasOwnProperty(key)&&(n.data.event_data[key]=o[key]);else null!=o&&e.verbose&&e.logging&&console.log("Unexpected type of options_array");if("page"!=t&&"install"!=t){var i=(new Date).getTime()-e.startTime;n.data.event_data.time_on_page=Math.round(i/1e3)}var r=u(),a=d();return null!=r&&(n.data.disp_w=r),null!=a&&(n.data.disp_h=a),"string"==typeof e.utm&&""!=e.utm&&(n.data.conversion_data={},n.data.conversion_data.utm_source=e.utm),n},i.prototype.getIdentityPayload=function(t){var o={kochava_app_id:e.appID,device_id:{kochava_device_id:e.kvID}};if(""!=t)try{o.data=JSON.parse(t)}catch(t){e.verbose&&e.logging&&console.log("Error parsing custom_trait JSON: ")}return o};var r,a=function(t,o){var n=t.method||"GET",i=t.endpoint,r=t.body||{},c=t.contentType||"application/json",s=t.retries,l=t.async||!1,u=t.withCredentials||!1;i="undefined"==typeof document||t.secure?"https://"+i:("https:"===document.location.protocol?"https://":"http://")+i,r="application/json"===c?JSON.stringify(r):r,"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=;try{var d=new XMLHttpRequest;u&&(d.withCredentials=!0)}catch(t){return e.verbose&&e.logging&&console.log("Error completing request: ",t),void("function"==typeof o&&o(!0,null))}d.open(n,i,l),c&&d.setRequestHeader("Content-Type",c),t.authCode&&t.nonce&&t.appGuid?d.setRequestHeader("Authorization",t.appGuid+", "+t.nonce+", "+t.authCode):t.appGuid&&d.setRequestHeader("Authorization",t.appGuid),d.onerror=function(){if(--s>0){e.verbose&&e.logging&&console.log("Error: API call failed at the network level. Attempt:"+(10-s));var n=10-s;t.retries=s;var i=n*n*500;i>6e4&&(i=6e4),setTimeout(function(){a(t,o)},i)}else e.verbose&&e.logging&&console.log("Error: API call failed at the network level (retry limit hit)."),"function"==typeof o&&o(!0,null)},d.onload=function(n){if(200!=d.status&&204!=d.status){if(401==d.status&&(e.verbose&&e.logging&&console.log("unauthorzied request"),"function"==typeof o))return void o(!0,d.status);try{var i=(n=JSON.parse(d.responseText)).error,r=n.error_description}catch(e){}if(--s>0){e.verbose&&e.logging&&console.log("Error ("+d.status+")("+i+"): "+r);var c=10-s;t.retries=s;var l=c*c*500;l>6e4&&(l=6e4),setTimeout(l)}else e.verbose&&e.logging&&console.log("Error (retry limit hit) ("+d.status+")("+i+"): "+r),"function"==typeof o&&o(!0,n)}else if(e.verbose&&e.logging&&console.log("event sent successfully"),"function"==typeof o){try{n=JSON.parse(d.responseText)}catch(e){n=d.responseText}o(!1,n)}},d.send(r)},c=function(){var e="";return"undefined"!=typeof location&&(e=(e=location.pathname.substring(1)).replace(/\/+$/,"")),""==e?"/":e},s=function(){return"undefined"!=typeof navigator?navigator.userAgent:""},l=u=function(){return"undefined"!=typeof window?window.screen.availWidth:null},d=p=function(){return"undefined"!=typeof window?window.innerWidth<window.innerHeight?"portrait":"landscape":""},g=function(e,t,o){var n=w(e);if(""==n?n=f(t):v(t,n,o),o){if(""!=n)return h(t,n),n;""!=(n=m(t))&&v(t,n,o)}return null===n?"":n},v=function(e,t,o){y(e,t),o&&h(e,t)},f=function(e){if("undefined"==typeof localStorage)return"";var t;try{t=localStorage.getItem(e)}catch(e){return""}return null===t?"":t},y=function(e,t){if("undefined"==typeof localStorage)return!1;try{localStorage.setItem(e,t)}catch(e){return!1}return!0},h=function(e,t){var o,n=new Date;n.setTime(n.getTime()+31536e7),o="; expires="+n.toUTCString(),document.cookie=e+"="+(t||"")+o+"; path=/;domain="+k()},m=k=function(){try{return window.location.host.match(/[^\.]*\.[^.]*$/)[0]}catch(e){return window.location.host}},w=function(e){if("undefined"==typeof location||void 0===location.search)return"";e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},_=function(e){var t=b();return v("kv_id",t,e),t},b=if("undefined"!=typeof exports&&(exports.Kochava=i),n)for(;args=n.shift();){var T=args.shift();(r=t[T])&&r.constructor&&r.call&&r.apply&&t[T].apply(this,args)}}();