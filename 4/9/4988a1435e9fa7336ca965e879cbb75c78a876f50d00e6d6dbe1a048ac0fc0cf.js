(self.webpackChunkconversation=self.webpackChunkconversation||[]).push([["app_conversation_components_Main_tsx-app_conversation_services_legacy_helpers_browser-detect_ts"],{3845:(e,t,s)=>{"use strict";s.d(t,{OE:()=>c,RI:()=>r,T6:()=>o,YQ:()=>d,cX:()=>l,w4:()=>i});var n=s(784),a=s(4186);let o;!function(e){e.ShowMoreReplies="showMoreReplies",e.ShowMoreComments="showMoreComments"}(o||(o={}));const i=e=>{try{var t;null===(t=window.__SPOTIM__)||void 0===t||t.initApp("registration",{...e,source:n.Qd})}catch(t){a.q.error("openRegistrationModal",t,{mode:e.mode})}},r=c=(e={})=>{i({...e,mode:"signup",eventType:"signup-to-post"})},l=(e={})=>{i({...e,mode:"signin",eventType:"signup-to-post"})},d=()=>{try{var e;null===(e=window.__SPOTIM__)||void 0===e||e.initApp("registration",{mode:"init-disqus-login",source:n.Qd})}catch(e){a.q.error("initDisqusLogin",e)}}},7724:(e,t,s)=>{"use strict";s.d(t,{$C:()=>d,A2:()=>u,D_:()=>S,Hh:()=>v,Md:()=>f,N8:()=>h,Oo:()=>p,PZ:()=>I,V$:()=>y,Xb:()=>l,Yf:()=>E,d9:()=>g,hb:()=>m,pp:()=>_});var n=s(326),a=s.n(n),o=s(4186),i=s(784),r=s(1336);let c=!1;const l={isSupport:(()=>{const e="test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return o.q.error("localStorage",e),!1}})(),read(e){let t=null;return this.isSupport&&(t=window.localStorage.getItem(e)),t},write(e,t){return this.isSupport&&window.localStorage.setItem(e,t),!0}},d=e=>{var t;return null===(t=JSON.parse(window.localStorage.getItem(i.QJ.LockedGuestDisplayName)||"{}"))||void 0===t?void 0:t[e]},u=e=>{const t={...JSON.parse(window.localStorage.getItem(i.QJ.LockedGuestDisplayName)||"{}"),[e]:!0};return window.localStorage.setItem(i.QJ.LockedGuestDisplayName,JSON.stringify(t))},m=({isRegistered:e,isForceRegister:t,userId:s})=>!e&&!t&&!d(s),p=("-ms-scroll-limit"in document.documentElement.style&&document.documentElement.style,e=>((e)||e.isJournalist),g=function f(){return c}onst h=e=>null==e?void 0:e.toLocaleDateString(i.vc,{day:"numeric",month:"long",year:"numeric"}),v=e=>null==e?void 0:e.toLocaleTimeString(i.vc,{hour12:!0,hour:"2-digit",minute:"2-digit"}),_=e=>"spotim"===e?e:e?e.replace("net_",""):"",E=({labelId:e,convElementId:t})=>{var s,n,o;const c=(0,r.D)(t),l=(null==c||null===(s=c.dataset)||void 0===s?void 0:s.labelsSection)||a().get("elementOptions.labelsSection","default"),d=null===i.Do||void 0===i.Do||null===(n=i.Do[l])||void 0===n||null===(o=n.labels)||void 0===o?void 0:o.find((t=>t.id===e));return null==d?void 0:d.text},I=,8620:(e,t,s)=>{"use strict";var n=s(2987);t.Z=async(e,{data:t,method:s="GET",...a})=>{const o={...a,method:s};return"GET"!==s&&Object.assign(o,{body:JSON.stringify(t)}),{body:await(0,n.default)(e,o)}}},4836:(e,t,s)=>{"use strict";var n=s(4543),a=s.n(n),o=s(784);.Z=(e,{data:t,method:s="GET",spotId:n=o.D5,headers:r,...c})=>{const l={...i(c.postId,n),...r},d={...c,headers:l,method:s};return"GET"!==s&&Object.assign(d,{body:JSON.stringify(t)}),a()(e,d)}},5229:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(4675),a=s.n(n),o=s(146),i={faCircleCheck:{type:"fa-solid",name:"check-circle"},locationIcon:{type:"fa-solid",name:"map-marker-alt"},exclamationCircleSolidIcon:{type:"fa-solid",name:"exclamation-circle"},chevronRightIcon:{type:"fa-solid",name:"chevron-right"},chevronDownIcon:{type:"fa-solid",name:"chevron-down"},starIcon:{type:"fa-solid",name:"star"},closeIcon:{type:"fa-solid",name:"times"},halfStarIcon:{type:"fa-solid",name:"star-half-alt"},ideaLogo:{type:"fa-solid",name:"lightbulb"},problemLogo:{type:"fa-solid",name:"exclamation-triangle"},questionLogo:{type:"fa-solid",name:"question-circle"},exclamationIcon:{type:"fa-solid",name:"exclamation-circle"},thumbtackIcon:{type:"fa-solid",name:"thumbtack"},youtubeIcon:{type:"fa-brands",name:"youtube"},commentIcon:{type:"fa-regular",name:"comment"},mentionIcon:{type:"fa-solid",name:"at"},bellIcon:{type:"fa-solid",name:"bell"},regularBellIcon:{type:"fa-regular",name:"bell"},menuDots:{type:"fa-solid",name:"ellipsis-v"},arrowDown:{type:"fa-solid",name:"arrow-down"},trash:{type:"fa-solid",name:"trash"},flag:{type:"fa-solid",name:"flag"},flagRegular:{type:"fa-regular",name:"flag"},reply:{type:"fa-solid",name:"reply"},shareIcon:{type:"fa-solid",name:"share-alt"},linkIcon:{type:"fa-solid",name:"link"},emailIcon:{type:"fa-solid",name:"envelope"},facebookIcon:{type:"fa-brands",name:"facebook-f"},twitterIcon:{type:"fa-brands",name:"twitter"},instagramIcon:{type:"fa-brands",name:"instagram-square"},check:{type:"fa-solid",name:"check"},emoji:{type:"custom",name:"emoji-light"},cloudyIcon:{type:"fa-solid",name:"cloud-sun-rain"},outlinedLogo:{type:"custom",name:"spotim-logo-outline"},disqusIcon:{type:"custom",name:"disqus-logo-solid"},attachmentPhotoIcon:{type:"fa-solid",name:"image"},playIcon:{type:"fa-solid",name:"play"},boldIcon:{type:"fa-solid",name:"bold"},italicIcon:{type:"fa-solid",name:"italic"},ulListIcon:{type:"fa-solid",name:"list-ul"},olListIcon:{type:"fa-solid",name:"list-ol"},quoteRightIcon:{type:"fa-solid",name:"quote-right"},textSizeIcon:{type:"custom",name:"text-size"},fontCaseIcon:{type:"custom",name:"font-case-light"},gifIcon:{type:"custom",name:"gif-outlined"},gifIconSolid:{type:"custom",name:"gif-solid"},formatIcon:{type:"custom",name:"format-font-outlined"},formatIconSolid:{type:"custom",name:"format-font-solid"},cameraIcon:{type:"custom",name:"camera"},infoCircle:{type:"fa-solid",name:"info-circle"},onboardingNew:{type:"custom",name:"onboarding-new"},upVote:{type:"custom",name:"upvote"},upVoteFull:{type:"custom",name:"upvote-full"},downVote:{type:"custom",name:"down-vote"},downVoteFull:{type:"custom",name:"down-vote-full"},voteUpIcon:{type:"custom",name:"like"},voteUpIconFull:{type:"custom",name:"like-full"},voteDownIcon:{type:"custom",name:"unlike"},voteDownIconFull:{type:"custom",name:"unlike-full"},recommend:{type:"custom",name:"star"},recommended:{type:"custom",name:"full-star"}},r=({selector:e,className:t})=>{const s={...i[e],className:t};return a().createElement(o.Icon,s)}},5471:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>Yt,CV:()=>Gt});var n=s(8654),a=s(94),o=s(4675),i=s.n(o),r=s(6895),c=s.n(r),l=s(5281),d=s(5713),u=s.n(d),m=s(9413),p=s(3040),g=s(131),f=s(146),y=s(326),h=s.n(y),v=s(8692),_=s(9704),E=s(4051),I=s.n(E),S=s(4186),b=s(2712),T=s(2735);const C=function e(t,s){let n;return Array.isArray(s)?s.map((function(s){return"string"==typeof s?s:e(t,s)})):"object"==typeof s&&null!==s?(n=Object.keys(s),n.map(().reduce((function(a,o,i){const r=s[n[i]],c=e(t,r);return a[o]=c,a}),{})):s},w=function(e){return"string"==typeof e?(0,T.Z)(e):C(T.Z,e)};var A=s(1292),O=s(68),R=s(8143),M=s(6377),k=s(9850),N=s(7241),L=s(293);var D=s(6480),P=s(6506),U=s(9236),Z=s(3191),x=s(7785),$=s(1883);const V={};class F extends class{filter(e={},{filterMine:t=!1,filterConversationId:s}={}){if(s){let{conversation_id:t,conversationId:n}=e;if(n=n||t,!n||s!==n)return!1}return!0}execute(e,t,s){this.filter(e,t)&&s()}{constructor(e,t,s,n){super(),this.conversationId=e,this.subsctibeToRealTime=t,this.dispatch=s,this.getState=n,this.subscribeOpts=void 0,this.execute=void 0,this.unsubscribeCallbacks=void 0,this.wrapWithTryCatch=(e,t)=>function(s){try{t(s)}catch(t){S.q.error("wrapWithTryCatch",t,{handler:e})}},this.picker=this.subscribeOpts=[],this.unsubscribeCallbacks=[],this.registerEvents()}isSentByMe(e){return e)}getFilterOptionsgisterEvents(){this.subscribeOpts.push({topic:"conversation/new-messages",params:()=>({conversation_id:this.conversationId}),pick:this.picker,callback:this.wrapWithTryCatch("conversation/new-messages",(e=>{const{comments:t}=this.getState();var s;t.list.messages,e&&e.length>0&&(this.internalDispatch((s=e,function(e,t,{dispatchPublicEvent:n}){const a=t(),{conversation:o,comments:{list:i,pagination:{hasNext:r}}}=a,c=s.map((e=>{const{user:t,message:s}=(0,L.Z)(e);if(!R.Sf(i,s.id))return s.isNew=!0,n(k.$8,(({oldConversation:e,user:t,message:s})=>({source:"conversation",postId:e.postId,fromUser:{id:t.id,username:t.username,displayName:t.displayName},message:{type:0===s.depth?"comment":"reply",time:new Date(1e3*s.postedAt).getTime()}}))({message:s,oldConversation:o,user:t})),M.En({message:s,id:s.id,hasNext:s.hasNext})})).filter(Boolean);c.length>0&&e({type:A.bx,payload:{shouldAggregate:(0,O.nK)(),messagesStack:c,conversation:(0,N.o)(o,s),forceNonCommentsOnInit:(0,O.f$)(a),hasNext:r}})})),e.forEach(())}))}),this.subscribeOpts.push({topic:"conversation/count-messages",params:()=>({conversation_id:this.conversationId}),pick:this.picker,callback:this.wrapWithTryCatch("conversation/count-messages",(e=>{if(e&&e.length>0){const[t]=e;this.internalDispatch({type:A.vU,payload:w(t)})}}))}),this.subscribeOpts.push({topic:"online/users-count",params:()=>({conversation_id:this.conversationId}),pick:this.picker,callback:this.wrapWithTryCatch("online/users-count",(e=>{if(e&&e.length>0){const[t]=e;this.internalDispatch((0,$.X)(t.count)),S.q.send("fetch_users_count_viewing_indicator")}}))}),this.subscribeOpts.push({topic:"online/users",params:()=>({conversation_id:this.conversationId}),pick:this.picker,callback:this.wrapWithTryCatch("online/users",(e=>{if(e&&e.length>0){const{comments:t}=this.getState(),s=e.map((e=>e.id));this.internalDispatch({type:A.WX,payload:{...t.list,onlineUsersId:s}}),this.internalDispatch({type:A.Mv,payload:{...t.list,onlineUsersId:s}}),S.q.send("fetch_online_users")}}))}),this.subscribeOpts.push({topic:"conversation/updated-messages",params:()=>({conversation_id:this.conversationId}),pick:this.picker,callback:this.wrapWithTryCatch("conversation/updated-messages",(e=>{if(e&&e.length>0){const{reportedComments:t}=this.getState(),s=e.filter((e=>(null==e?void 0:e.id)&&!t[null==e?void 0:e.id]));this.internalDispatch((0,D.S)(s))}}))}),this.subscribeOpts.push({topic:"conversation/deleted-messages",params:()=>({conversation_id:this.conversationId,message_ids:[]}),pick:this.picker,callback:this.wrapWithTryCatch("conversation/deleted-messages",(e=>{if(e&&e.length>0){const{currentUser:t,reportedComments:s}=this.getState(),n=e.filter((e=>e.status===b.MessageStatus.Blocked)),a=e.filter((e=>(null==e?void 0:e.id)&&e.user_id!==(null==t?void 0:t.id)&&!s[null==e?void 0:e.id]&&"deleted"===e.status));n.length>0&&this.internalDispatch((0,U.$)(n)),a.length>0&&this.internalDispatch((0,P.q)(a))}}))}),this.subscribeOpts.push({topic:"conversation/typing-v2-users",params:()=>({conversation_id:this.conversationId,message_ids:[]}),pick:this.picker,callback:this.wrapWithTryCatch("conversation/typing-v2-users",(e=>{if(e&&e.length>0){const{currentUser:t}=this.getState();this.internalDispatch((0,Z.RN)(this.conversationId,e.map((),t.id)),S.q.send("typing_v2_users",{tags:{typingsCount:String(e.length)}})}}))}),this.subscribeOpts.push({topic:"conversation/notifications-count",params:pick:this.picker,callback:this.wrapWithTryCatch("conversation/notifications-count",(([e])=>{this.internalDispatch((0,x.N)(null==e?void 0:e.unseen))}))}),this.subscribeOpts.forEach(()}var B=s(784),G=s(218);const W=h().get("tenant_config.conversation.enable_realtime_retry",!1);function q(e){return{type:A.Y8,payload:{realtimeHandlerInstance:e}}}function H(e,t,s){const{conversation:n,tabs:{activeTabId:a}}=s();if(e&&(0,G.V6)(a))try{t(q(new F(e,(function(e){const{postId:t}=n;return I().subscribe({spotId:B.D5,postId:t,...e,enableRetry:W})}),t,s)))}catch(e){S.q.error("subscribeRealtime",e)}}function j(e,t){t(q(null));try{var s;null==e||null===(s=e.unsubscribeEvents)||void 0===s||s.call(e)}catch(e){S.q.error("unsubscribeRealtime",e)}}var K=s(135),J=s(1295),z=s(1326),Q=s(6826),Y=s(5002),X=s(8994),ee=s(9400),te=s(5216),se=s(4936),ne=s(971),ae=s(5765);const oe=ie=e=>{if(e.hasOwnProperty("entities")&&Array.isArray(e.entities)&&(0,ae.bZ)(e)){const t=(new Date).getTime();return!(e.expiresIn&&t-(null==e?void 0:e.expiresIn)>=0)}return!1};var re=s(3367),ce=s(1336),le=s(9717),de=s(6e3),ue=s(2408),me=s(1862);const pe=()=>async function(e,t){const s=t(),{moduleOptions:n,conversation:a,ignoreQueryParams:o}=s,{postId:i,elementId:r}=n,{contentType:c,authorId:l}=a,d=(0,ce.D)(r);if(!d)return;let u;e((0,le.g)({conversationStatus:te.su.FETCHING}));const m="true"===(null==d?void 0:d.getAttribute(B.iI)),p=new Promise((e=>{u=setTimeout((()=>{e(!1)}),B.kd)}));Promise.race([p,(0,re.GX)({postId:i,element:d,isPreview:m,ignoreQueryParams:o})]).then((t=>{if(!t||!t.data)return S.q.error("conversation failed to load",new Error("read failed")),void e((0,le.g)({conversationStatus:te.su.ERROR}));clearTimeout(u);const{data:s}=t;e((0,me.Y)({data:s,postId:i,contentType:c,authorId:l})),s.user&&e((0,de.u)((0,ue.nL)(s.user)))})).catch((t=>{S.q.error("conversation failed to load",t),e((0,le.g)({conversationStatus:te.su.ERROR}))}))};var ge=s(1784);const fe={entityType:"action",actionName:"reading-time",type:"action-registration",id:"action-post-comment"};var ye=s(1293),he=s(5758),ve=s(1885),_e=s(3845),Ee=s(6616),Ie=s(6577);const Se=({onClose:e,onImportClicked:t})=>{const{t:s}=(0,m.useTranslation)();return i().createElement("div",{className:Ie.Z.disqusWelcomeContainer,"data-spotim-class":"disqus-welcome-container"},i().createElement("span",{className:Ie.Z.icon},i().createElement(f.Icon,{name:"spotim-bubbles",type:"custom"})),i().createElement("div",{className:Ie.Z.textPlaceholder},i().createElement(f.Typography,{type:"heading3",colorType:"l6",weight:"bold"},s("disqusWelcome.meetYourCommunity","Meet your new conversation!")),i().createElement(f.Typography,{type:"t4",colorType:"l6",className:Ie.Z.margin},s("disqusWelcome.importDisqusProfile","Create your new profile by importing your Disqus information")),i().createElement(f.Button,{variant:"primary",onClick:,s("disqusWelcome.importProfile","Import Profile"))),i().createElement(f.CloseButton,{onClick:e,className:Ie.Z.closeButton}))};var be=s(403),Te=s(7724),Ce=s(2389);const we=/\{\{linkValue\}\}/g,Ae=/\{\{modalValue\}\}/g;var Oe=({onModalLinkClick:e,title:t})=>{const{value:s,linkValue:n,modalValue:a,linkUrl:o}=t;let r=null;function c(e,t){const s=(e||"").replace(we,`<a data-spot-im-class="community-guidelines-external-link" class=spcv_modal-link-text target="_blank" rel="noopener noreferrer" href="${o}">${n}</a>`);if(s.length)return i().createElement("span",{className:Ce.Z.modalLinkText,key:t,dangerouslySetInnerHTML:{__html:s}})}if(!s)return null;const[l,d]=s.split(Ae),u=c(l,"1"),m=c(d,"3");return a&&(r=function(t,s){return i().createElement("a",{href:"#!","data-spot-im-class":"community-guidelines-modal-link",key:"2",onClick:className:Ce.Z.modalLinkText},t)}(a)),i().createElement(i().Fragment,null,[u,r,m].filter((e=>e)))},Re=({onModalLinkClick:e,title:t})=>{const{t:s}=(0,m.useTranslation)("community-guidelines"),{value:n,key:a,modalValue:o,linkUrl:r,linkValue:c}=t;let l,d;const u=s(`${a}.value`,n,{modalValue:"{{modalValue}}",linkUrl:"{{linkUrl}}",linkValue:"{{linkValue}}"});return o&&(l=s(`${a}.modalValue`,o)),c&&(d=s(`${a}.linkValue`,c)),i().createElement(Oe,{title:{value:u,modalValue:l,linkValue:d,linkUrl:r},onModalLinkClick:e})};const Me=h().get("tenant_config.conversation.communityGuidelinesTitle",{key:"defaultTitle.0",value:"Your voice matters. Discussions are moderated for civility."});var ke,Ne=(0,l.connect)(()((({postId:e})=>{const t=(0,d.useTracking)(),s=(0,ge.c)(B.d1);function n(){S.q.send("community_guidelines_clicked"),t.trackEvent({type:"community-guidelines-clicked",item_type:"community-guidelines-page",target_type:"main"}),s({moduleName:B.g0,config:{postId:e}})}const a="CUSTOM"==(B.L9&&Me&&Me.key?"DEFAULT":"CUSTOM")?i().createElement(Oe,{title:Me,onModalLinkClick:n}):i().createElement(Re,{title:Me,onModalLinkClick:n});return B.L9&&i().createElement(i().Fragment,null,i().createElement(f.Typography,{type:"product-sub-heading",colorType:"l5",className:Ce.Z.subheaderContainer,role:"presentation"},a))})),Le=s(8657),De=s(2207),Pe=s(7686),Ue=s(7134),Ze=({messagesCount:e})=>{const t=(0,v.parseNumber)(e);return J.ZP?i().createElement(f.Typography,{className:Ue.Z.commentsCounter,type:"t4",colorType:"l5","data-spot-im-class":"comments-count"},i().createElement(De.L,{i18nKey:"inpage.header.shortNumComments",values:{messagesCount:t},count:e})):i().createElement(f.Typography,{className:c()(Ue.Z.commentsCounter),type:"t4",colorType:"l5","data-spot-im-class":"comments-count"},i().createElement(De.L,{i18nKey:"inpage.header.numComments",values:{messagesCount:t},count:e}))},xe=s(8813);!function(e){e.FULL="full",e.COMMENTS="comments"}(ke||(ke={}));const $e=h().get("tenant_config.conversation.header_format",ke.FULL),Ve=({handleConversationHeaderGotFocus:e,headerText:t,messagesCount:s})=>i().createElement(f.Button,{disabled:!0,className:c()(xe.Z.tabButton,{})},(()=>{let n=null;switch($e){case ke.FULL:n=i().createElement(f.Typography,{className:xe.Z.headerText,colorType:"product-heading",type:"product-heading",onFocus:e,"data-spot-im-class":"header-text"},t||i().createElement(De.L,{i18nKey:"inpage.header.conversation"}),s>0&&i().createElement(Ze,{messagesCount:s}));break;case ke.COMMENTS:{const a=(0,v.parseNumber)(s);n=i().createElement(f.Typography,{className:xe.Z.headerText,colorType:"product-heading",type:"product-heading",onFocus:e,"data-spot-im-class":"header-text"},t?i().createElement(i().Fragment,null,s>0&&i().createElement(i().Fragment,null,s," "),t):s>=0&&i().createElement(De.L,{i18nKey:"inpage.header.numComments",values:{...s>0?{messagesCount:a}:{},count:s}}));break}}return n})());var Fe=(0,l.connect)((e=>{const{moduleOptions:t,conversation:s}=e,{isStarsRatingEnabled:n,textsOverrides:a,spotId:o,isConversationPage:i}=t,{conversationHeaderText:r,starsRatingHeaderText:c}=a;return{isStarsRatingEnabled:n,conversationHeaderText:r,starsRatingHeaderText:c,messagesCount:s.messagesCount,spotId:o,isConversationPage:i}}),(e=>({preloadConversatio})))((({isStarsRatingEnabled:e,conversationHeaderText:t,starsRatingHeaderText:s,messagesCount:n=0,preloadConversation:a})=>{let o;return e?o=s||i().createElement(De.L,{i18nKey:"inpage.header.starsRating"}):t&&(o=t),i().createElement("div",{className:c()(Pe.Z.headers,Pe.Z.reversed,Pe.Z.singleTab),onMouseEnter:(0,Le.Z)(a)},i().createElement(Ve,{headerText:o,messagesCount:n}))})),Be=s(8608),Ge=s(6755);const We=h().get("tenant_config.conversation.display_viewers_count_only",!1);var qe=()=>{const{t:e}=(0,m.useTranslation)(),t=(0,te.ix)(O.GJ);if(!t||t<2)return null;const s=(0,v.parseNumber)(t),n=We||J.ZP;return i().createElement("div",{className:Ge.Z.viewingIndicator},i().createElement("span",{"aria-label":"Viewing",role:"img"},i().createElement(Be.SvgWrapper,{name:"user-friends-solid"})),i().createElement(f.Typography,{type:"t5",colorType:"l5"},n?s:e("inpage.header.viewing","Viewing",{viewersCount:s})))},He=s(1385);const je=h().get("tenant_config.conversation.show_disqus_header",!1),Ke=h().get("tenant_config.conversation.disable_header_facelist",!1);class Je extends i().Component{constructor(...e){super(...e),this.state={showDisqusHeader:je},this.headerRef=i().createRef(),this.openDiscusForumAccount,this.handleCloseDisqusHeader=()=>{this.setState({showDisqusHeader:!1})}}componentDidUpdate(){this.props.scrollToHeader&&this.headerRef.current&&!(0,Te.PZ)(this.headerRef.current)&&(this.headerRef.current.scrollIntoView(),this.props.finishScrollToHeader())}render(){const{showDisqusHeader:e}=this.state,{isLoggedIn:t,useDisqusLogin:s,enableConversationHeaderFacesList:n,handleDisqusLogin:a,isPostPage:o,isReadOnly:r}=this.props,c=!Ke&&n;return o?null:i().createElement("div",{ref:this.headerRef,className:He.Z.conversationHeader,"data-spot-im-class":"conversation-header"},!t&&s&&e&&i().createElement(Se,{onImportClicked:a,onClose:this.handleCloseDisqusHeader}),i().createElement("div",{className:He.Z.info},i().createElement("div",{className:He.Z.leftArea},i().createElement("div",{className:He.Z.titleFacesWrapper},i().createElement(Fe,null),c&&i().createElement(qe,null)),!r&&B.L9&&i().createElement(Ne,null))))}}var ze=(0,l.connect)((e=>{const{currentUser:t,conversation:s,readOnly:n}=e,{useDisqusLogin:a,enableConversationHeaderFacesList:o}=e.moduleOptions,{enable:i}=n;return{enableConversationHeaderFacesList:o,isLoggedIn:(0,X.jl)(t),messagesCount:s.messagesCount,isPostPage:s.contentType===te.zc.Post,useDisqusLogin:a,scrollToHeader:O.pX(e),isReadOnly:i}}),(e=>({handleDisqusLogin:_e.YQ,finishScrollToHeader(){e((0,ne.Z)(!1))}})))((0,he.withPublicEventDispatcher)(Je)),Qe=s(1890),Ye=s(3326),Xe=s(4934),et=s(5229),tt=s(4836),st=s(8257);function nt(e){const{t}=(0,m.useTranslation)(),s=[{type:"Idea",logoSelector:"ideaLogo",text:t("conversation.feedback.option.idea","Idea"),dataAttribute:"feedback-idea-button"},{type:"Problem",logoSelector:"problemLogo",text:t("conversation.feedback.option.problem","Problem"),dataAttribute:"feedback-problem-button"},{type:"Question",logoSelector:"questionLogo",text:t("conversation.feedback.option.question","Question"),dataAttribute:"feedback-question-button"}],n=t("conversation.feedback.email","Your Email"),a=t("conversation.feedback.addFeedback","Add your feedback..."),[r,l]=(0,o.useState)("Idea"),[d,u]=(0,o.useState)(!1),[p,g]=(0,o.useState)("main"),[y,h]=(0,o.useState)(!0),[v,_]=(0,o.useState)(""),[E,I]=(0,o.useState)(""),[S,b]=(0,o.useState)(!1),[T,C]=(0,o.useState)(!1);(0,o.useEffect)((()=>{e.showFeedbackModal&&(g("main"),l("Idea"),_(""),I(""),b(!1),C(!1),h(!0),u(!1))}),[e.showFeedbackModal]),(0,o.useEffect)((()=>{const e=setTimeout(),2e3);return()=>{clearTimeout(e)}}),[d]),(0,o.useEffect)((()=>{const e=setTimeout(),2e3);return()=>{clearTimeout(e)}}),[p]),(0,o.useEffect)(),[E,v]);const w,A=e=>{if((0,J.tq)()){"mouseleave"!==e.type&&b(!1);const t=e.relatedTarget;t&&"button"===t.type&&t.click()}},O=()=>{e.onClose()},R=()=>{h(!(E&&v))},M="main"===p?t("conversation.feedback.title","Feedback"):i().createElement("div",{className:c()(st.Z.feedbackWrapper,st.Z.after)},t("conversation.feedback.titleAfterSend","Feedback sent!"),i().createElement(et.Z,{selector:"faCircleCheck",className:st.Z.sentIcon}));return i().createElement(f.Modal,{shadowRootCssModules:Gt?["conversation"]:void 0,isLtr:B.ZO,showModal:e.showFeedbackModal,className:st.Z.modal,onClose:O,modalTitle:M,size:"md",bottomActions:"main"===p&&i().createElement(i().Fragment,null,i().createElement(f.Button,{variant:"secondary",onClick:O,"data-open-web-class":"feedback-cancel-button"},t("conversation.feedback.cancel","Cancel")),i().createElement(f.Button,{variant:"primary",onClick:async()=>{const{postId:t}=e;/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(E)?(C(!1),u(!0),await(({type:e,content:t,email:s,postId:n})=>(0,tt.Z)("v1.0.0/user/feedback",{method:"POST",postId:n,data:{type:e,email:s,content:t}}))({type:r,content:v,email:E,postId:t})):C(!0)},disabled:y,"data-open-web-class":"feedback-send-button"},d?i().createElement("div",{className:st.Z.spinnerWrapper},i().createElement(Xe.Z,null)):t("conversation.feedback.send","Send")))},i().createElement("div",{className:st.Z.feedbackWrapper},i().createElement(f.Typography,{type:"t4",colorType:"l6",className:c()(st.Z.headerText,{[st.Z.hidden]:!0===S})},"main"===p?t("conversation.feedback.message","We would love to hear what you think - any type of feedback will be highly appreciated!"):t("conversation.feedback.messageAfterSend","Thank you for your help.")),"main"===p&&i().createElement(i().Fragment,null,i().createElement("div",{className:c()(st.Z.buttonArea,{[st.Z.hidden]:!0===S})},i().createElement(f.Row,{gutter:"lg"},s.map(((e,t)=>{const s=c()(st.Z.button,{[st.Z.highlight]:e.type===r});return i().createElement(f.Button,{key:e.type,className:s,"data-open-web-class":e.dataAttribute,onClick:()=>)(e.type)},i().createElement(et.Z,{selector:e.logoSelector,className:c()(st.Z.logo,{[st.Z.ideaLogo]:"Idea"===e.type,[st.Z.problemLogo]:"Problem"===e.type,[st.Z.questionLogo]:"Question"===e.type})}),i().createElement("span",{className:st.Z.buttonText}," ",e.text))})))),i().createElement("div",{className:st.Z.inputWrapper},i().createElement(f.TextInput,{id:"feedback-modal-email",className:st.Z.input,placeholder:n,onChange:e=>{I(e.target.value)},onFocus:w,onBlur:A,onMouseLeave:A,hasError:T,"data-open-web-class":"email-input"})),i().createElement("div",{className:st.Z.textareaWrapper},i().createElement(f.Textarea,{id:"feedback-modal-feedback",onChange,onFocus:w,onBlur:A,onMouseLeave:A,placeholder:a,"data-open-web-class":"feedback-input"})),"main"===p&&i().createElement("div",{className:st.Z.gutterWrapper},T&&i().createElement("span",{className:c()(st.Z.error,{[st.Z.mobileError]:(0,J.tq)()})},"Invalid Email, Try Again")))))}var at=s(1669);const ot=h().get("tenant_config.conversation.disable_footer_links"),it=h().get("tenant_config.conversation.enable_unregistered_users_feedback",!0),rt=h().get("tenant_config.shared.homepage_url","https://www.openweb.com/?utm_source=Product&utm_medium=Footer"),ct=h().get("tenant_config.shared.enable_no_follow",!1),lt=(0,v.formatLanguageCode)(h().get("init_data.config.main_language","en")).slice(0,2),dt=(e,t)=>{const s=Object.keys(t),n=Object.values(t);return new Function(...s,`return \`${e}\`;`)(...n)},ut=dt(h().get("tenant_config.shared.terms_url_language",`https://www.openweb.com/${lt}/legal-and-privacy/terms-of-use?utm_source=Product&utm_medium=Footer`),{lng:lt}).replace("/en/","/"),mt=dt(h().get("tenant_config.shared.privacy_url_language",`https://www.openweb.com/${lt}/legal-and-privacy/privacy?utm_source=Product&utm_medium=Footer`),{lng:lt}).replace("/en/","/"),pt=h().get("tenant_config.conversation.disable_footer_power_by"),gt=h().get("tenant_config.conversation.disable_footer_logo"),ft=window.navigator.userAgent.match(/(MSIE|Trident)/),yt=({href:e,classname:t,id:s,title:n,text:a,target:o,onClick:r,ref:c})=>{const l="noopener noreferrer "+(ct?"nofollow":"");return i().createElement("a",{href:e,className:t,id:s,title:n,target:o,rel:l,onClick:r,ref:c},a)},ht=({classname:e})=>i().createElement("span",{className:e}),vt=({hasFeedback:e,postId:t,currentUser:s})=>{const n=(0,ge.c)(B.d1),a=(0,o.useRef)(null),[r,l]=(0,o.useState)(!1),d=(0,he.useDispatchPublicEvent)();(0,m.useTranslation)();const u=()=>{d(k.$7)},p,g=(0,o.useCallback)((()=>{const o=it||s.isRegistered;return i().createElement("div",{className:at.Z.disclaimer,"data-spot-im-class":"disclaimer"},!ot&&i().createElement(i().Fragment,null,yt({href:ut,classname:at.Z.footerLink,id:"spotim-footer-terms",target:"_blank",text:i().createElement(De.L,{i18nKey:"general.terms.short"},"Terms")}),ht({classname:at.Z.middleLine}),yt({href:mt,classname:c()(at.Z.footerLink),id:"spotim-footer-privacy",target:"_blank",onClick:u,text:i().createElement(De.L,{i18nKey:"general.privacy.short"},"Privacy")}),ht({classname:c()({[at.Z.middleLine]:e&&o})})),e&&o&&i().createElement("button",{ref:a,type:"button",className:at.Z.footerButton,id:"spotim-footer-feedback",onClick:e=>{e.preventDefault(),B.wK?n({moduleName:B._G,config:{postId:t,source:be.oF,tagVersion:'"v3.91.0"'},onClose:p}):l(!0)},title:"Opens add feedback dialog"},i().createElement(De.L,{i18nKey:"general.feedback"},"Feedback")))}),[e,t,s.isRegistered]);return i().createElement("div",{className:c()([at.Z.conversationFooter]),"data-spot-im-class":"conversation-footer"},i().createElement(f.Typography,{type:"t6",colorType:"l5"},yt({href:rt,onClick,classname:at.Z.siteLink,target:"_blank",text:i().createElement(i().Fragment,null,!J.ZP&&!pt&&i().createElement(m.Trans,{className:at.Z.poweredByText,i18nKey:"general.poweredBy"},"Powered by"),!gt&&i().createElement("div",{className:at.Z.logoContainer},i().createElement(f.Icon,{name:"openweb-symbol-v2",type:"custom",className:c()(at.Z.logoSymbol,{[at.Z.isOldBrowser]:ft}),"aria-hidden":"true"}),i().createElement(f.Icon,{name:"openweb-text-v2",type:"custom",className:c()(at.Z.logoText,{[at.Z.isOldBrowser]:ft}),alt:"Open Web"})))})),i().createElement(f.Typography,{type:"t6",colorType:"l5",className:at.Z.linksWrapper},g()),e&&t&&i().createElement(nt,{showFeedbackModal:r,onClose:p,postId:t}))},_t=h().get("tenant_config.conversation.showFooterFeedback",!0),Et=e=>{const t=(0,te.ix)((e=>e.currentUser)),{postId:s,isConnectEnabled:n,enableSSO:a}=(0,te.ix)()),o=(0,l.useDispatch)(),{isModerator:r}=e;return!(0,Qe.isLoggedIn)(t)&&(n&&!a||B.oC),i().createElement(vt,{isModerator:r,postId:s,onLogin,hasFeedback:_t,currentUser:t})};var It=s(4519),St=s(8817),bt=s(1700);var Tt=({value:e})=>e?i().createElement("span",{"data-spot-im-class":"community-question",className:bt.Z.communityQuestion},(e=>(0,St.Z)({pattern:/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g,decorator:function(e,t){return i().createElement("span",{className:bt.Z.emoji},e)},input:e}))(e)):null,Ct=s(6817);s(7835);var wt=s(7462),At=s(4561);const Ot={backgroundColor:"#f2f2f2",foregroundColor:"#e3e3e3"},Rt={backgroundColor:"#7b7f83",foregroundColor:"#b3b3b3"},Mt=e=>{const t=(0,f.useTheme)(),{isLTR:s}=e,n="dark"===t;return i().createElement("div",{style:{width:"100%",maxHeight:370}},i().createElement(At.default,(0,wt.Z)({rtl:!s,speed:2,width:"100%"},n?Rt:Ot),i().createElement("rect",{x:"88",y:"33",rx:"6",ry:"6",width:"60%",height:"54"}),i().createElement("rect",{x:"88",y:"113",rx:"6",ry:"6",width:"60%",height:"13"}),i().createElement("rect",{x:"88",y:"135",rx:"6",ry:"6",width:"45%",height:"13"}),i().createElement("circle",{cx:"51",cy:"59",r:"21"}),i().createElement("circle",{cx:"51",cy:"128",r:"21"}),i().createElement("rect",{x:"30",y:"172",rx:"6",ry:"6",width:"80%",height:"15"}),i().createElement("rect",{x:"30",y:"203",rx:"6",ry:"6",width:"80%",height:"15"})))};var kt=s(6762),Nt=s(6256);const Lt=["click"];var Dt=s(3471);const Pt="fau-hidden";var Ut=s(1121)function xt(e){const{open:t,unitStyles:s,onHide:n,onClickOutside:a}=e,{connect:r}=(0,kt.useConnectApp)("standalone-ui-kit",{moduleName:"feature-feedback-modal",config:{featureName:"Floating_unit"}}),l=function(e,t,s){const n=(0,o.useRef)(null);return(0,o.useEffect)((()=>{const t=(0,v.createEventListenerGroup)(),a=t=>{const a=t.composedPath().some());Array.isArray(s)?!a&&s.every())&&e(t):!n.current||a||n.current.contains(t.target)||e(t)};return Lt.forEach()),()=>{t.removeAll()}}),[n,e,s]),n}(a),{trackEvent:u}=(0,d.useTracking)(),m=(0,o.useMemo)((()=>{const{left:e,height:n,bottom:a,width:o}=s;return{left:e,height:98,bottom:t?a+n+2:-98,width:o}}),[t,s]);return i().createElement("div",{className:Ut.Z.floatingMenuContainer,style:m,ref:l},i().createElement($t,{icon:i().createElement(f.Icon,{type:"custom",name:"lightbulb",className:c()(Ut.Z.icon,Ut.Z.bulb)}),onClick:()=>{r(),u(Zt("feedback"))}},i().createElement(De.L,{i18nKey:"general.feedback"},"Feedback")),i().createElement("div",{className:Ut.Z.divider}),i().createElement($t,{icon:i().createElement(f.Icon,{type:"custom",name:"eye-slash",className:Ut.Z.icon}),onClick},i().createElement(De.L,{i18nKey:"floatingActionUnit.hide"},"Hide")))}function $t(e){const{icon:t,children:s,onClick:n}=e;return i().createElement(f.Typography,{className:Ut.Z.floatingMenuItem,onClick:n,type:"t4",colorType:"l5"},t,s)}function Vt(){const e=(0,te.ix)((e=>e.conversation.messagesCount)),t=(0,te.ix)()),s=(0,te.ix)((e=>e.isMobile.isMobile)),[a,r]=(0,o.useState)("static"),[l,u]=(0,o.useState)(!1),[p,y]=(0,o.useState)()),[h,_]=(0,o.useState)(""),[E,I]=(0,o.useState)(0),[S,b]=(0,o.useState)(0),[T,C]=(0,o.useState)(!1),w=(0,o.useRef)(null),A=(0,o.useRef)(0),O=(0,o.useRef)(!1),R=(0,o.useRef)(!1),M=(0,o.useRef)(!1),k=function(e){const{left:t,setLeft:s,onSwipeOut:n}=e,[a,i]=(0,o.useState)(0),[r,c]=(0,o.useState)(0),l=(0,o.useRef)(t);return{onTouchStart:e=>{const{clientX:s}=e.touches[0];i(s),c(s),l.current=t},onTouchMove:e=>{const{clientX:t}=e.touches[0],n=t-r;c(t),s())},onTouchEnd:()=>{const e=r-a,t=e>0?1:-1;Math.abs(e)>50?(s(t*document.documentElement.offsetWidth),n()):s(l.current)}}}({left:E,setLeft:I,onSwipeOut}),N=s?k:{},L=(0,kt.useSpotConfigPath)("tenant_config.conversation.floating_action_unit_bottom_offset",16),D=(0,kt.useSpotConfigPath)("tenant_config.conversation.floating_action_unit_threshold",100),{isHovered:P}=function(e){const[t,s]=(0,o.useState)(!1),n=(0,o.useCallback)((()=>{s(!0)}),[]),a=(0,o.useCallback)(),[]);return(0,o.useEffect)((()=>{const t=(0,v.createEventListenerGroup)();if(e)return t.attachListener(e,"mouseenter",n),t.attachListener(e,"mouseleave",a)}),[n,a,e]),{isHovered:t}}(w.current),{ref:U,inView:x,entry:$}=(0,g.useInView)(),V=(0,kt.useHost)(),{t:F}=(0,m.useTranslation)(),{trackEvent:B}=(0,d.useTracking)();!function(e){const{visible:t}=e,s=(0,o.useRef)(0),n=(0,v.usePageVisibility)(),{idle:a,stop:i,start:r}=(0,v.useIdleTimeout)(15e3),{trackEvent:c}=(0,d.useTracking)();(0,o.useEffect)((()=>{if(t&&n&&!a)s.current=Date.now();else if(s.current>0){const e=a?15e3:0,t=(Date.now()-s.current-e)/1e3;c({type:"floating_unit_viewed",count:t}),s.current=0}}),[t,n,a,c]),(0,o.useEffect)(),[n,i,r])}({visible:l});const G=t>0,W="back"===a,q=$&&$.boundingClientRect.bottom<0,H=(0,o.useCallback)((e=>{Bt(D)&&(u(!0),e())}),[D]),j=(0,o.useCallback)(),[G]),K=(0,o.useMemo)((()=>({height:40,bottom:l?L:-(L+40),left:E})),[L,E,l]),J=(0,o.useMemo)(),[K,S]),z=()=>{try{sessionStorage.setItem(Pt,"true"),y(!0)}catch(e){}};return(0,o.useEffect)(),[j,W]),(0,o.useEffect)((()=>{U(V)}),[V,U]),(0,o.useEffect)((()=>{let s="";switch(a){case"static":s=(0,v.parseNumber)(e);break;case"typing":s=F("floatingActionUnit.typingNow",{count:t});break;case"back":s=F("floatingActionUnit.back")}_(s)}),[a,t,e,F]),(0,o.useEffect)((()=>{let e;return Ft()<D&&(e=(0,v.attachListener)(window,"scroll",(0,n.default)((()=>{H((()=>{var t;null===(t=e)||void 0===t||t.remove()}))}),200)))}),[H,D]),(0,o.useEffect)((()=>{if(x===O.current){const e=R.current&&!M.current;q?u(!1):e&&(u(Bt(D)),M.current=!0)}else x?u(W):q?u(!1):(u(!0),j())}),[x,q,W,j,D]),(0,o.useEffect)(),[x]),(0,o.useEffect)((()=>{if(w.current){const e=V.getBoundingClientRect().left+(V.offsetWidth-w.current.offsetWidth)/2;I(e)}}),[V,h]),(0,o.useEffect)((()=>{const e=w.current;let t;return e&&(t=new ResizeObserver()),t.observe(e))}),[]),(0,o.useEffect)(),[]),p?null:i().createElement(i().Fragment,null,i().createElement("div",(0,wt.Z)({className:c()(Nt.Z.fauContainer,{[Nt.Z.visible]:l}),style:K,ref:w,onClick:()=>{switch(B(Zt(a)),a){case"typing":case"static":null==V||V.scrollIntoView({behavior:"smooth"}),r("back"),A.current=Ft();break;case"back":!function(e){const t={top:e,behavior:"smooth"};document.documentElement.scrollTo(t),document.body.scrollTo(t)}(A.current),j()}}},N),i().createElement("div",{className:Nt.Z.actionWrapper},"static"===a&&i().createElement(f.Icon,{name:"comments",type:"fa-solid",className:Nt.Z.commentsIcon}),"typing"===a&&G&&i().createElement(Dt.y,{className:Nt.Z.typing}),i().createElement(f.Typography,{colorType:"l6",type:"t5"},h),i().createElement(f.Icon,{type:"custom",name:"arrow-down",className:c()(Nt.Z.arrow,{[Nt.Z.back]:W})})),i().createElement("div",{onClick},i().createElement(f.Icon,{name:"ellipsis-h",type:"custom",className:c()(Nt.Z.options,{[Nt.Z.optionsSelected]:T,[Nt.Z.optionsHidden]:!(P||s||T)||W})}))),i().createElement(xt,{open:T&&l,unitStyles:J,onHide:z,onClickOutside}))function Bt(e){return Ft()>e}const Gt=h().get("tenant_config.conversation.isUseShadowDomOnOverlays",!0),Wt=h().get("tenant_config.conversation.isUseShadowDomOnMain",!0),qt=h().get("tenant_config.shared.defensiveJsMode",!1),Ht=h().get("tenant_config.conversation.cssModulesForShadowDOM","conversation conversation-survey @spotim/ui-components @spotim/ads @spotim/user-image feed @spotim/entities @spotim/user-info @spotim/rich-editor @spotim/toast-provider @spotim/svg-provider @spotim/notifications-bell notifications @spotim/message live-blog feed-v4 user-profile standalone-ui-kit"),jt=h().get("tenant_config.conversation.floating_action_unit_enabled",!1),Kt=(0,p.Z)()),Jt=(0,p.Z)()),zt=window[Symbol.for("openweb-launched")]?function(e){return e.children}:f.ThemeProvider;class Qt extends o.Component{constructor(...e){super(...e),this.el=null,this.eventListeners=(0,v.createEventListenerGroup)(),this.state={hasError:!1,errorDetails:{stack:"",message:""},conversationBodyLoaded:!1},this.handleViewportEnter=e=>{if(e){const e={type:"viewed"},t=this.getCommunityQuestion();t&&Object.assign(e,{taxonomy_subject:t}),S.q.send("viewed"),this.props.tracking.trackEvent(e),this.props.container.style.minHeight="auto",this.props.dispatchPublicEvent("spot-im-conversation-viewed")}},this.addResizeHandler=()=>{this.eventListeners.attachListener(window,"resize",(0,n.default)(),200),!1)},this.checkIsMobile=()=>{const{calculateIsMobile:e}=this.props;this.el&&e(this.el)},this.handleErrorBoxReload,this.handleConversationBodyLoaded=()=>{const{postId:e,initApp:t,currentUser:s}=this.props,{isRegistered:n}=s;this.setState({conversationBodyLoaded:!0});const a=h().get("tenant_config.registration.should_send_reading_time_notification",!1);!n&&a&&(({initApp:e,postId:t})=>{S.q.send("trigger reading time notification"),setTimeout((()=>{(({initApp:e,notification:t,postId:s})=>{try{null==e||e("notifications",{module:"sticky-notifications",data:[t],postId:s})}catch(e){S.q.error("unable to trigger sticky notification",e)}})({initApp:e,notification:fe,postId:t})}),B.oj)})({initApp:t,postId:e})},this.webviewOpenSdk=e=>{e.stopPropagation(),e.preventDefault(),this.props.dispatchPublicEvent("ow-sdk-open")},this.setRootRef,this.addListeners=()=>{this.addResizeHandler(),B.Ls&&this.eventListeners.attachListener(document,"data-spot-im-unmute-user",(e=>{const{detail:{userId:t}}=e,{unmuteUser:s}=this.props;s(t)})),B._C&&(this.eventListeners.attachListener(document,"ow-follow-user",(e=>{const{detail:{userId:t}}=e;this.props.updateFolloweesMap({[t]:!0})})),this.eventListeners.attachListener(document,"ow-unfollow-user",(e=>{const{detail:{userId:t}}=e;this.props.updateFolloweesMap({[t]:!1})})))}}UNSAFE_componentWillReceiveProps(e){const{conversation:t,onConversationChange:s,activeTabId:n}=this.props,{conversation:a,activeTabId:o}=e;a.id===t.id&&o===n||s({prevConversationId:t.id,nextConversationId:a.id})}componentDidMount(){const{enableAccessibilityColorContrast:e,conversation:t,scrollToComments:s,onConversationLoad:n,onScrollToConversation:a}=this.props,{id:o}=t;(()=>{const e=localStorage.getItem(B.QJ.DraftMessage);if(e)try{const t=JSON.parse(e);for(const[e,s]of Object.entries(t))oe(e)&&!ie(s)&&delete t[e];localStorage.setItem(B.QJ.DraftMessage,JSON.stringify(t))}catch(e){S.q.error("clearExpiredDraftMessages",e)}})(),o&&n(o),s&&a({conversationId:o}),!0===e&&document.body.classList.add(ve.Z.accessibilityMode),this.el&&this.el.classList.add("spot-im-conversation-module"),this.setMethodsOnWindow(),this.addListeners()}getCommunityQuestion(){const{conversation:e,communityQuestion:t}=this.props;return t||e.communityQuestion}setMethodsOnWindow(){this.props.isConversationPage||(window.__SPOTIM__={...window.__SPOTIM__,createMessage:async e=>{this.preloadConversation(),await this.props.createMessage(e)},switchTab:(e={})=>{this.props.scrollToHeader(),e.focusSayControl&&this.props.focusSayControlOnSwitchTab()},preloadConversation})componentDidUpdate(e){e.conversation.id!==this.props.conversation.id&&this.notifyConversationLoaded(),this.props.preloadConversation&&this.preloadConversation()}componentWillUnmount(){const{conversation:e,onConversationUnload:t}=this.props;t(e.id),this.eventListeners.removeAll()notifyConversationLoaded(){const{conversation:e,isStarsRatingEnabled:t,currentUser:s,dispatchPublicEvent:n}=this.props,{spotId:a,id:o}=e;n(k.Hc,{spotId:a,conversationId:o});const i=document.querySelectorAll(`${B.jU},\n      ${B.GR}`),r=i.length>0?i[0].offsetWidth:0,c={total_comments:e.messagesCount,in_view:(0,ee.E)().toString(),is_rating:t,avg_rate:e.averageStarsRating,is_registered:s.isRegistered,row:r};S.q.send("loaded"),this.props.tracking.trackEvent({...c,type:"loaded"})}isNarrowConversationView(){var e;const{isMobile:t}=this.props,s=(null===(e=this.el)||void 0===e?void 0:e.offsetWidth)||0;return t&&s>0&&(s<300||window.innerWidth!==s)}getConversationBody(){const{conversationStatus:e,conversation:t,summaryWidget:s,pagination:n}=this.props;if(e===te.su.ERROR){const{forceRefetchData:e}=this.props,t=window[Symbol.for("openweb-launched")]?e:pe;return i().createElement(It.Z,{onClick:t})}return e===te.su.FETCHING?i().createElement(Mt,{isLTR:B.ZO}):i().createElement(i().Suspense,{fallback:i().createElement(Mt,{isLTR:B.ZO})},i().createElement(Kt,{conversation:t,summaryWidget:s,pagination:n,onLoaded:this.handleConversationBodyLoaded}))}render(){const{conversation:e,currentUser:t,direction:s,container:n,dataAttributes:a,isConversationPage:o}=this.props,{communityQuestion:r,messagesCount:l}=e;let d;const{conversationBodyLoaded:u}=this.state,m=this.props.communityQuestion||r,{theme:p,labelsSection:f}=a;this.state.hasError;{const{hideNonReadOnlyElements:a,isWebviewMode:o,isMobile:r}=this.props,l=this.isNarrowConversationView(),p=c()(Ct.Z.conversationView,{[Ct.Z.rtl]:"rtl"===s,"read-only":a,[Ct.Z.mqMobile]:r,[Ct.Z.alignToCenter]:"CENTER",[Ct.Z.narrow]:l,[Ct.Z.notLoaded]:!u},ve.Z.conversationModule);d=i().createElement("div",{"data-spmark":`conversation conversation-id:${e.id}`,className:p,"data-spot-im-class":"conversation-root","data-tooltips-boundaries":!0,ref:this.setRootRef,"data-is-logged-in":!!(0,X.jl)(t)},o&&i().createElement("div",{onClick:this.webviewOpenSdk,className:Ct.Z.webviewOverlay}),!B.nA&&i().createElement(ze,null),i().createElement(i().Fragment,null,m&&i().createElement(Tt,{value:m}),i().createElement(_.ToastProvider,{isConversationPage:this.props.isConversationPage,placeholderClassName:Ct.Z.toastStyling},this.getConversationBody())),u&&i().createElement(Et,{isModerator:t.isModerator}),i().createElement("div",{id:"tooltip-section"}),i().createElement(Jt,{hostContainer:n}))}return i().createElement(zt,{moduleName:Ht,theme:p,defensiveMode:qt,rightToLeft:"rtl"===s,bypass:!Wt,onCreatedShadowDOM:e=>{var t;null==e||null===(t=e.host)||void 0===t||t.setAttribute("data-labels-section",null!=f?f:"")}},i().createElement(g.InView,{onChange:this.handleViewportEnter,triggerOnce:!0},i().createElement("div",{className:Ct.Z.mainContainer,"data-spotim-app":"conversation",style:{display:"none"},"ignore-host":""},d,jt&&!o&&l>=3&&i().createElement(Vt,null))))}}var Yt=(0,a.Z)((0,l.connect)((function(e){const{currentUser:t,moduleOptions:s,comments:n,conversation:a,summaryWidget:o,appState:{conversationStatus:i},isWebviewMode:r,tabs:{activeTabId:c}}=e,{enableAccessibilityColorContrast:l,isConversationPage:d,contentType:u}=s;return{enableAccessibilityColorContrast:l,hideNonReadOnlyElements:h().get("tenant_config.conversation.is_read_only_mode",!1),isMobile:O.tq(e),spotId:s.spotId,postId:s.postId,direction:s.direction,conversation:a,pagination:n.pagination,comments:n.list,scrollToComments:s.scrollToComments,communityQuestion:s.communityQuestion,isStarsRatingEnabled:s.isStarsRatingEnabled,summaryWidget:o,currentUser:t,preloadConversation:O.FZ(e),isConversationPage:d,contentType:u,conversationStatus:i,isWebviewMode:r,activeTabId:c}}),(function(e){return{calculateIsMobile:t=>e((e=>(t,s)=>{if(e){const n=s(),a=O.IZ(n),o=(0,J.lZ)(e,a);t({type:Y._,payload:{isMobile:o,isMobileUA:J.ZP}}),t((0,z.VY)(J.ZP?Q.V.MOBILE:Q.V.DESKTOP))}})(t)),onScrollToConversation:({conversationId:t})=>e(function({conversationId:e}){return{type:"SCROLL_TO_CONVERSATION",payload:{conversationId:e}}}({conversationId:t})),onConversationLoad:t=>e(t)),onConversationUnload:t=>e((function(e,t){j(t().conversation.realtimeHandlerInstance,e)})),onConversationChange:({prevConversationId:t,nextConversationId:s})=>e(function({prevConversationId:e,nextConversationId:t}){return function(e,s){j(s().conversation.realtimeHandlerInstance,e),H(t,e,s)}}({prevConversationId:t,nextConversationId:s})),unmuteUser:t=>e(t)),createMessage,focusSayControlOnSwitchTab(){e((0,ne.o)(!0))},scrollToHeade,retryConversationRea,updateFolloweesMa}})),u()((e=>{let t="conversation";return e.isConversationPage&&(t=e.contentType===te.zc.Post?"post-page":"conversation-page"),{source:t,total_comments:e.conversation.messagesCount,is_rating:e.isStarsRatingEnabled,avg_rate:e.conversation.starRatingSummary&&e.conversation.starRatingSummary.average,is_registered:e.currentUser.isRegistered,post_id:e.postId,spot_id:e.spotId,user_id:e.currentUser.id}}),{dispatch:K.R}),(0,m.withTranslation)(),ge.a,he.withPublicEventDispatcher)(Qt)},4934:(e,t,s)=>{"use strict";var n=s(4675),a=s.n(n),o=s(6895),i=s.n(o),r=s(7323);t.Z=({className:e,mode:t="center",size:s="small"})=>{const n=i()(r.Z.spinner,{[r.Z.center]:"center"===t,[r.Z.inline]:"inline"===t,[r.Z.small]:"small"===s,[r.Z.xSmall]:"x-small"===s,[r.Z.large]:"large"===s},e);return a().createElement("span",{className:n})}},2207:(e,t,s)=>{"use strict";s.d(t,{L:()=>i});var n=s(4675),a=s.n(n),o=s(9413);const i=e=>{(0,o.useTranslation)();const{textOverride:t,children:s=null,...n}=e;return t?a().createElement("span",null,t):a().createElement(o.Trans,n,s)}},4519:(e,t,s)=>{"use strict";var n=s(4675),a=s.n(n),o=s(146),i=s(5229),r=s(135),c=s(2207),l=s(9360);t.Z=({onClick:e,isLtr:t,spotId:s,postId:d})=>((0,n.useEffect)((function(){(0,r.R)({post_id:null!=d?d:"",spot_id:null!=s?s:"",type:"module-failed-to-load",source:"conversation"})}),[s,d]),a().createElement("div",{"data-spot-im-direction":t?"ltr":"rtl"},a().createElement("div",{className:l.Z.convLoadFailedWrapper},a().createElement(i.Z,{selector:"cloudyIcon",className:l.Z.icon}),a().createElement(o.Typography,{type:"heading3",colorType:"l6",weight:"bold",className:l.Z.title},a().createElement(c.L,{i18nKey:"general.failedConversation.title"},"Oops, something went wrong :(")),a().createElement(o.Typography,{type:"t5",colorType:"l5",className:l.Z.subtitle},a().createElement(c.L,{i18nKey:"general.failedConversation.message"},"We detected some connectivity issues therefore we’re unable to load the Conversation")),a().createElement(o.Button,{variant:"primary",onClick:e},a().createElement(c.L,{i18nKey:"general.failedConversation.button"},"Retry")))))},1543:(e,t,s)=>{"use strict";s.d(t,{g:()=>l,n:()=>d});var n=s(326),a=s.n(n),o=s(6793),i=s(68),r=s(4186),c=s(5128);const l=e=>{const t=a().get("tenant_config.conversation.message_fetch_count",o.K_);return e?o.Z6:t};function d(e){return async function(t,s){r.q.apm.start("load_more_comments");const n=s(),a=i.tq(n),o=l(a),{moduleOptions:{pageSize:d=o},comments:{loadingSource:u}}=n;u||(await t((0,c.W4)({pageSize:e||d,source:"load-more"})),r.q.apm.end("load_more_comments"))}}},7785:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});var n=s(221);function a(e=0){retu)}}},221:(e,t,s)=>{"use strict";s.d(t,{SR:()=>i,hR:()=>r,nl:()=>l,q_:()=>o,rM:()=>a,sA:()=>c});var n=s(326);const a="NOTIFICATIONS/GET_START",o="NOTIFICATIONS/GET_END",i="NOTIFICATIONS/MARK_ALL_READ",r="NOTIFICATIONS/MARK_AS_READ",c="NOTIFICATIONS/SET_UNSEEN_NOTIFICATION_COUNT",l="NOTIFICATIONS/SET_IS_LOADED";s.n(n)().get("tenant_config.notifications.use_notifier_v2",!0)},3471:(e,t,s)=>{"use strict";s.d(t,{y:()=>c});var n=s(4675),a=s.n(n),o=s(6895),i=s.n(o),r=s(5294);const c=({isSmall:e=!1,transparent:t=!1,className:s})=>{const n=i()(s,r.Z.typingAnimation,{[r.Z.small]:e,[r.Z.transparent]:t});return a().createElement("span",{className:n},a().createElement("span",null),a().createElement("span",null),a().createElement("span",null))}},784:(e,t,s)=>{"use strict";s.d(t,{BH:()=>L,Cs:()=>K,D5:()=>d,DE:()=>Z,DM:()=>S,Do:()=>k,GR:()=>c,Iv:()=>O,JD:()=>q,Jo:()=>P,KZ:()=>U,L9:()=>u,LB:()=>T,Ls:()=>g,NM:()=>I,OT:()=>$,Ph:()=>C,QJ:()=>z,Qd:()=>r,SD:()=>A,Tg:()=>b,Tt:()=>Q,U:()=>p,WF:()=>v,WJ:()=>D,Xw:()=>X,ZO:()=>y,_C:()=>te,_G:()=>H,bI:()=>w,d1:()=>W,eR:()=>M,fR:()=>G,g0:()=>j,he:()=>m,iI:()=>B,jA:()=>x,jU:()=>l,kd:()=>V,m6:()=>h,nA:()=>f,oC:()=>_,oO:()=>se,o_:()=>Y,oj:()=>J,pY:()=>F,vc:()=>E,wK:()=>N,xO:()=>ee,y9:()=>R});var n=s(326),a=s.n(n),o=s(8692),i=s(7211);const r="conversation",c='[data-spotim-module="conversation"]:not([data-spotim-not-for-self-bootstrapping])',l='[data-spot-im-module-default-area="conversation"]',d=a().get("spotId"),u=a().get("tenant_config.conversation.communityGuidelinesEnabled",!1),m=a().get("tenant_config.conversation.isAppealEnabled",!1),p=a().get("tenant_config.conversation.enable_read_only_context_menu",!1),g=a().get("tenant_config.conversation.enableUsersMuting",!1),f=a().get("tenant_config.conversation.hide_header",!1),y=a().get("init_data.config.ltr",!0),h=a().get("tenant_config.shared.enable_user_reputation",!1),v=a().get("tenant_config.shared.disable_user_avatar",!1),_=a().get("tenant_config.shared.enable_sso_login",!1),E=(a().get("tenant_config.shared.enable_sso_logout",!1),a().get("tenant_config.shared.date_format","en-US")),I=(a().get("tenant_config.conversation.disableCustomBodyScroll",!1),a().get("tenant_config.conversation.survey_below_show_more_comments_enabled",!1)),S=a().get("tenant_config.shared.disable_user_profile",!1),b=(a().get("tenant_config.shared.disable_user_profile_settings",!1),a().get("tenant_config.shared.disable_user_profile_privacy",!1),a().get("tenant_config.conversation.is_replies_sorting_v2_enabled",!1)),T=a().get("tenant_config.conversation.hide_user_area",!1),C=(a().get("tenant_config.shared.publisher_profile_settings",!1),a().get("tenant_config.conversation.show_cancel_button",!1)),w=a().get("tenant_config.conversation.child_count",2),A=a().get("tenant_config.conversation.is_best_score_testing_enabled",!1),O=(a().get("tenant_config.shared.enable_publisher_profile_settings",!1),a().get("tenant_config.moderation.is_community_question_moderation_v2_enabled",!1)),R=(a().get("tenant_config.shared.enable_comment_labels",!1),a().get("tenant_config.conversation.enable_share_button_in_context_menu",!0)),M=a().get("tenant_config.conversation.disable_share",!1),k=a().get("tenant_config.shared.comment_labels",{default:{labels:[],guideline_text:"",max_selected:1,min_selected:0}}),N=a().get("tenant_config.conversation.is_feedback_modal_v2_enabled",!1),L=a().get("tenant_config.conversation.is_verdict_aware_calls_enabled",!1),D=a().get("tenant_config.conversation.threading_lines_enabled",!1),P=a().get("tenant_config.conversation.is_featured_message_api_v2_enabled",!1),U=a().get("tenant_config.conversation.num_of_aggregate_expand",25),Z=a().get("tenant_config.conversation.realtime_typing_enabled",!0),x=a().get("tenant_config.conversation.typing_indicaction_in_toast",!1),$=a().get("tenant_config.conversation.disable_online_dot_indicator",!1),V=15e3,F="data-spotim-autorun",B="data-preview-mode",G=(0,o.isInSafeframe)(),W="standalone-ui-kit",q="user-profile",H="feedback-modal",j="community-guidelines-modal";let K;!function(e){e.Comment="comment",e.Reply="reply"}(K||(K={}));const J=a().get("tenant_config.registration.reading_time_delay_time",1e4);let z,Q,Y,"}(z||(z={})),function(e){e.DisagreeGuidelines="disagree-guidelines",e.DontUnderstandGuidelines="dont-understand-guidelines",e.CommentFollowsGuidelines="comment-follows-guidelines",e.Misunderstanding="misunderstanding",e.WasNotAwareGuidelines="was-not-aware-guidelines",e.Other="other"}(Q||(Q={})),function(e){e.AppealDialogExit="appeal_dialog_exit",e.AppealSubmitted="appeal_submitted",e.AppealCommentNoticeView="appeal_comment_notice_view",e.PCAExitClicked="pca-exit-clicked",e.PCAClicked="pca-clicked",e.PCAViewed="pca-viewed",e.FeedbackViewed="feedback-viewed",e.SuspendedFeedbackViewed="suspended-feedback-viewed"}(Y||(Y={}"}(X||(X={}));const ee=a().get("tenant_config.conversation.new_best_sort_enabled",!1)?i.h.NEW_BEST:i.h.BEST,te=a().get("tenant_config.user-profile.allowFollow",!1),se=a().get("tenant_config.conversation.disable_replies",!1)},8994:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>u,jl:()=>i.isLoggedIn,U8:()=>l});var n=s(5766),a=s(1776),o=s.n(a),i=s(1890),r=s(1292);const c="RESPONSE_PROFILE_IMAGE_UPLOAD";function l({user:e}){return{type:c,payload:e}}var d=s(6e3);var u=(0,n.handleActions)({[r.uC]:(e,{payload:{currentUser:t}})=>({...e,...t,isLoading:!1}),[c]:{next:o()(((e,t)=>{const{imageId:s}=t.payload;e.imageId=s}))},[r.An]:o()(((e,t)=>{const{displayName:s}=t.payload;e.displayName=s})),[d.O]:o()(((e,t)=>{const s=t.payload;e.ssoPrimaryKey=s.ssoPrimaryKey,e.location=s.location}))},{notificationsCount:0,messagesVoted:void 0})},6)},3367:(e,t,s)=>{"use strict";s.d(t,{GX:()=>_,JR:()=>f,s4:()=>y});var n=s(326),a=s.n(n),o=s(403),i=s(7724),r=s(4836),c=s(9400),l=s(5482),d=s(784),u=s(7211),m=s(2729),p=s(218);conste),f=()=>{const e=a().get("elementOptions.sortBy","");if(g(e))return e};function y(){const e=f(),t=null!=e?e:a().get("init_data.config.sort_by",d.xO),s=(0,l.k)();return s&&g(s)?s:t}var h;!function(e){e.Conversation="conversation",e.Post="post"}(h||(h={}));const v=a().get("queryParams.spot_im_content_type",h.Conversation);async function _({postId:e,element:t,isPreview:n,ignoreQueryParams:l,activeTab:u=m.m.All,sortBy:g=y(),spotId:f=""}){var _;if(n)return(await s.e("mock-data").then(s.bind(s,7172))).default;let E=(0,p.V6)(u)?(0,c.E)(t.dataset.messagesCount):0,I=a().get("queryParams.ow_module","conversation")!==o.oF||l||v!==h.Conversation?null:a().get("queryParams.spot_im_comment_id")||a().get("queryParams.spot_im_reply_id");const S=Boolean(I&&I.includes(`${f}_`)&&I.includes(`_${e}_`));(t.dataset.spotImScrollToReply||t.dataset.spotImScrollToComment)&&(I=t.dataset.spotImScrollToComment||t.dataset.spotImScrollToReply),0===E&&I&&(E=(0,c.k)());const b=a().get("queryParams.TEAM_ROUTE","v1.0.0"),T={sort_by:g,offset:0,count:E,message_id:S?I:null,depth:!a().get("tenant_config.conversation.should_collapse_replies",!1)||I||S?2:1,child_count:d.bI};((null==t||null===(_=t.dataset)||void 0===_?void 0:_.socialReviews)||a().get("elementOptions.socialReviews",!1))&&(T.with_star_rating=!0);const C=await(0,r.Z)(`${b}/conversation/read`,{data:T,method:"POST",postId:e});return(0,i.V$)(!0),{data:C}}},2594:(e,t,s)=>{"use strict";s.d(t,{P_:()=>d,zw:()=>l,F6:()=>u});var n=s(9829),a=s(326),o=s.n(a),i=s(4836);function r(e){return{method:"POST",postId:o().get("postId"),data:{user_ids:e}}}var c=s(1293);const l=(0,n.createAsyncThunk)("follow/get-followees-map",(async(e,{dispatch:t,getState:s})=>{let n=e;n||(n=Object.keys(s().follow.followeesMap));const a=(awa)}(n)).follow_map||{};t((0,c.r)(a))})),d=(0,n.createAsyncThunk)("follow/follow-user",(async e=>{var t;await(t=[e],(0,i.Z)("v1.0.0/profile/user/follow",r(t)))})),u=(0,n.createAsyncThunk)("follow/unfollow-user",(async e=>{var t;await(t=[e],(0,i.Z)("v1.0.0/profile/user/unfollow",r(t)))}))},1293:(e,t,s)=>{"use strict";s.d(t,{r:()=>i});var n=s(9829),a=s(2594);const o=(0,n.createSlice)({name:"follow",initialState:{followeesMap:{}},reducers:{updateFolloweesM}}},extraReducers:e=>{e.addCase(a.P_.fulfilled,((e,t)=>{e.followeesMap[t.meta.arg]=!0})).addCase(a.F6.fulfilled,((e,t)=>{e.followeesMap[t.meta.arg]=!1}))}}),{updateFolloweesMap:i}=o.actions;t.Z=o.reducer},6967:(e,t,s)=>{"use strict";s.d(t,{x:()=>i});var n=s(784),a=s(2594),o=s(1293);function i(e,t,s){if(!n._C)return;const i=Object.keys(t);if(0!==i.length)if(e)s((0,a.zw)(i));else{const e=i.reduce)),{});s((0,o.r)(e))}}},1784:(e,t,s)=>{"use strict";s.d(t,{a:()=>l,c:()=>c});var n=s(7462),a=s(4675),o=s.n(a),i=s(146),r=s(4262);const}},l=e=>t=>{const s=(0,i.useTheme)(),a=(0,r.useShadowRoot)();return o().createElement(e,(0,n.Z)({},t,{initApp:(e,t={})=>{window.__SPOTIM__.initApp(e,{theme:s,host:a,...t})}}))}},9400:(e,t,s)=>{"use strict";s.d(t,{E:()=>o,k:()=>i});var n=s(326),a=s.n(n);function o(e){return+(e||a().get("elementOptions.messagesCount")||a().get("tenant_config.conversation.read_batch_size",20)}},6377:(e,t,s)=>{"use strict";s.d(t,{Bu:()=>u,En:()=>r,FC:()=>c,KQ:()=>d,U_:()=>m,e6:()=>l,iT:()=>p,pk:()=>g});var n=s(1776),a=s.n(n),o=s(8692),i=s(6711);function r(e={}){const t={id:(0,o.guid)(),message:i.E(),isAggregated:!1,isPostCommentActionEnabled:!1,isOutOfOrder:!1,childrenStackIds:[],loadingTop:!1,loadingBottom:!1,hasNext:!1,hasPrev:!1,showAllReplies:!1,isLastMessage:!1,...e};return e.message&&(t.message=i.E(e.message)),t}function c(e){return e.messa]}function d(e){return e.message.repliesCount}const u=a()(((e,t)=>{e.hasNext=t.hasNext,e.message.offset=t.offset})),m=a()(((e,t)=>{e.childrenStackIds.push(t.id)})),p=a()(((e,t)=>{const s=t.message;e.message.depth=s.depth+1,s.deleted||(e.message.replyToUsername=s.user.username,s.user.isRegistered?e.message.replyToDisplayName=s.user.displayName:e.message.replyToDisplayName=s.userDisplayName)}));function g(e,t){return t===e.childrenStackIds[e.childrenStackIds.length-1]}},6711:(e,t,s)=>{"use strict";s.d(t,{E:()=>i,l:()=>r});var n=s(8692),a=s(2712),o=s(2408);function i(e={}){const t={id:(0,n.guid)(),clientId:(0,n.guid)(),postedAt:(new Date).getTime()/1e3,upVotesCount:0,downVotesCount:0,repliesCount:0,user:(0,o.ap)(),entities:[],isVotedUp:!1,isVotedDown:!1,isMine:!1,isNew:!1,isReported:!1,edited:!1,deleted:!1,status:a.MessageStatus.Approved,starsRating:void 0,depth:0,offset:0,tempMessageId:"",...e};return e.user&&(t.user=(0,o.ap)(e.user)),t.entities=e.entities||[]d}},8143:(e,t,s)=>{"use strict";function n(e={}){return{messages:{},rootOrder:[],aggregatedMessage:[],...e}}function a(e,t){return e.messages[t]}function o(e,t){var s;const n=e.messages[t];if(!n)return!1;const a=null==n||null===(s=n.message)||void 0===s?void 0:s.rootMessage;return e.rootOrder.includes(]}function r(e){return e.aggregatedMessage.map((t=>e.messages[t]))}function c(e){return e.rootOrder.mat]h}function d(e,t){let s=t,n=t;for(;n;)n=a(e,s.childrenStackIds[s.childrenStackIds.length-1]),n&&(s=n);return s}function u(e,t,s){var n;if(!t||(null==t||null===(n=t.message)||void 0===n?void 0:n.depth)<=s||s<0)return null;const o=function(e,t){const s=t.message.parentMessageId;return s?a(e,s):null}(e,t);return o?o.message.depth===s?o:u(e,o,s):null}function m(e,t){return 0===t.childrenStackIds.length?[]:e?t.childrenStackIds.mat))):[]}function p(e,t){return 0===t.childrenStackIds.length?[]:e?m(e,t).map((t=>[t,...p(e,t)])).reduct)),[]):[]}s.d(t,{$K:()=>n,G:()=>m,NV:()=>d,Np:()=>u,QX:()=>l,Sf:()=>a,WW:()=>r,ZY:()=>c,gH:()=>i,jb:()=>o,mD:()=>p}),s(1776)},674},9458:(e,t,s)=>{"use strict";function n(e={}){return{id:void 0,spotId:null,postId:"",etag:null,pageUrl:null,messagesCount:-1,commentsCount:-1,averageStarsRating:null,starsRatingCount:0,communityQuestion:void 0,isStrictModeEnabled:!1,...e}}function a(e,t){let{starsRatingCount:s,averageStarsRating:a}=e;return t>0&&a&&(a=(a*s-t)/s),n({...e,starsRatingCount:s,averageStarsRating:a})}function o(e="",t){return e.length>0&&(e+="."),function(){return{conversation_id:`${e}id`,etag:`${e}etag`,spot_id:`${e}spotId`,post_id:`${e}postId`,comments_count:`${e}commentsCount`,messages_count:`${e}messagesCount`,"stars.average":`${e}averageStarsRating`,"stars.count":`${e}starsRatingCount`,"stars.segments":`${e}starsRatingSegments`,"metadata.community_question":`${e}communityQuestion`,...t}}}s.d(t,{$2:()=>a,Oo:()=>n,c_:()=>o})},7505:(e,t,s)=>{"use strict";s.d(t,{$:()=>o,_:()=>i});var n=s(3222);function a(e,t){return(0,n.I)(function(e="",t){return e.length>0&&(e+="."),function(){return{type:`${e}type`,id:`${e}id`,text:`${e}text`,imageId:`${e}imageId`,thumbnailUrl:`${e}thumbnailUrl`,originalHeight:`${e}originalHeight`,originalWidth:`${e}originalWidth`,mediaHeight:`${e}mediaHeight`,mediaWidth:`${e}mediaWidth`,thumbnailHeight:`${e}thumbnailHeight`,thumbnailWidth:`${e}thumbnailWidth`,title:`${e}title`,description:`${e}description`,url:`${e}url`,originalUrl:`${e}originalUrl`,previewUrl:`${e}previewUrl`,previewHeight:`${e}previewHeight`,previewWidth:`${e}previewWidth`,embed:`${e}embed`,frameType:`${e}frameType`,userId:`${e}userId`,...t}}}("",t),e)}function o(e="",t){return e.length>0&&(e+="."),function(){return{id:`${e}id`,type:`${e}type`,status:`${e}status`,conversation_id:`${e}conversationId`,"rank.positive":`${e}upVotesCount`,"rank.negative":`${e}downVotesCount`,"rank.+":`${e}upVotesCount`,"rank.-":`${e}downVotesCount`,"+":`${e}upVotesCount`,"-":`${e}downVotesCount`,tags:`${e}tags`,views:`${e}viewsCount`,replies_count:`${e}repliesCount`,user_id:`${e}userId`,written_at:`${e}postedAt`,edited:`${e}edited`,deleted:`${e}deleted`,"metadata.version":`${e}version`,"metadata.reply_to.reply_id":`${e}parentMessageId`,"metadata.reply_to.user_id":`${e}replyToUserId`,"metadata.display_name":`${e}userDisplayName`,content:a(`${e}entities`),stars:`${e}starsRating`,depth:`${e}depth`,offset:`${e}offset`,reply_parent_deleted:`${e}isReplyParentDeleted`,reply_parent_id:`${e}parentMessageId`,parent_comment_id:`${e}rootMessageId`,featured:`${e}featured`,featuredComment:`${e}featuredComment`,user_display_name:`${e}userDisplayName`,published:`${e}published`,best_score:`${e}bestScore`,additional_data:`${e}additionalData`,...t}}}function i(e,t){return(0,n.I)(o("",t),e)}},6230:(e,t,s)=>{"use strict";s.d(t,{i:()=>a});var n=s(6680);function a(e,t,s=e.userId){if(e.user=t[s]?{...t[s]}:function(e){return(0,n.ap)({userId:e,displayName:"Guest",username:"Guest",isFallbackUser:!0})}(s),e.userDisplayName&&!e.user.isRegistered&&(e.user.displayName=e.userDisplayName),e.entities&&e.entities.forEach((e=>{"user-mention"===e.type.toLowerCase()&&(e.user=t[e.userId])})),e.replyToUserId&&!e.replyToDisplayName){const s=t[e.replyToUserId];s&&(e.replyToDisplayName=s.displayName||s.username)}}},5812:(e,t,s)=>{"use strict";s.d(t,{VN:()=>c,kW:()=>l});var n=s(3868),a=s(2408),o=s(1329),i=s(7505),r=s(6230);function c(e){return!e.entities||0===e.entities.length||e.entities[0].type===n.EntityType.Text&&""===e.entities[0].text&&1===e.entities.length}function l(e,t){const s=(0,i._)("comments",{parent_id:"parentMessageId",root_comment:"rootMessageId",has_next:"hasNext","rank.ranked_by_current_user":"meVote","rank.ranks_down":"downVotesCount","rank.ranks_up":"upVotesCount",index:"index"}),{comments:n=[]}=o.Z.map(t,{comments:s}),l=[],d={};return Object.keys(t.users).forEach((e=>{const s=Object.assign(t.users[e],{id:e}),n=(0,a.nL)(s);l.push(n),d[n.id]=n})),n.filtee))).forEach((t=>{var s;(s=t).entities[0].hasOwnProperty("text")&&(s.entities[0].text=s.entities[0].text.replace(/{{um:([^{}]*)}}/gm,'<span data-mention="$1,,"></span>')),t.conversationId=e,(0,r.i)(t,d),t.user||(t.user={id:t.userId}),t.isVotedUp=1===t.meVote,t.isVotedDown=-1===t.meVote,delete t.meVote,t.upVotesCount||(t.upVotesCount=0),t.downVotesCount||(t.downVotesCount=0)})),{comments:n,usersList:l}}},5826:(e,t,s)=>{"use strict";s.d(t,{Ci:()=>n,hA:()=>o,l0:()=>a,rJ:()=>i});const n="approved",a="blocked",o="pending";let "}(i||(i={}))},16)},523:(e,t,s)=>{"use strict";let n;s.d(t,{$:()=>n}),function(e){e.APPROVE_ALL="approve_all",e.PUBLISH_AND_MODERATE="publish_and_moderate",e.REQUIRE_APPROVAL="require_approval",e.BLOCK_ALL="block_all",e.FORCE_APPROVE_ALL="force_approve_all",e.FORCE_BLOCK_ALL="force_block_all",e.APPROVE="approve",e.REJECT="reject"}(n||(n={}))},5758:(e,t,s)=>{"use strict";s.d(t,{useDispatchPublicEvent:()=>o,withPublicEventDispatcher:()=>l}),s(2813);var n,a=s(8692);const o=null!==(n=window.__SPOTIM__.lib["@spotim/launcher-shared/hooks"].useDispatchPublicEvent)&&void 0!==nt};var i=s(7462),r=s(4675),c=s.n(r);function l(e){retu)}}},2813:()=>{},135:(e,t,s)=>{"use strict";s.d(t,{R:()=>c});var n=s(326),a=s.n(n),o=s(2832),i=s(4186),r=s(784);function c(e){if("object"!=typeof e){const t=`analytics event ${JSON.stringify(e)} will be missing critical information such as type`;i.q.error("analyticsTrack",t)}const{spot_id:t,post_id:s,source:n,...c}=e,l=t||r.D5,d=s||a().get("postId","");(0,o.trackEvent)({spot_id:l,post_id:d,source_version:"v3",source:n,conversation_id:`${l}_${d||""}`,...c})}},1329:(e,t,s)=>{"use strict";var n=s(245);function a(e,t){let s=null;return g(e)?s=i(e,t):f(e)&&(s=r(e,t)),s}function o(e){if(2===arguments.length)return a(e,arguments[1]);if(arguments.length>2){const t=[];for(let e=1;e<arguments.length;e++)t.push(arguments[e]);return Object.assign({},...t.map((t=>a(e,t))))}return nu)}function r(e,t){let s={};return p(t)&&(t=t()),f(t)&&Object.keys(t).forEach((function(a){if("~"===a)return;let o=t[a],l=function(e,t){const s=t.split(".");let n,a,o=e;for(var i=0;i<s.length&&o;i++)n=s[i],a=m(n),o=a.isArray?o[a.key][a.index]:o[n];return i!==s.length&&(o=void 0),o}(e,a);if(void 0!==l)e}(o))c(s,o,l);else if(p(o)&&(o=o()),f(o)){const e=o["~"];if(g(l)){if(!e)throw`Error: destination mapping root for ${a} is missing.`;l=i(l,o),c(s,e,l)}else{if(e)throw`Error: ${a} value expected to be an array.`;s=(0,n.h)(s,r(l,o))}}})),s}function c(e,t,s){const n=t.split(".");let a=e;const o=n[n.length-1];let i,r;for(let e=0;e<n.length-1;e++)i=n[e],r=m(i),r.isArray?(a=d(a,r.key),a=l(a,r.index)):a=l(a,i);r=m(o),r.isArray?(a[r.key]||(a[r.key]=[]),a[r.key][r.index]=s):a[o]}function u(e,t,s){let n=e[t];return void 0===n&&(n=s,e[t]=n),n}function m(e){const t=e.match(/(.+)\[(\d+)\]/),s=!!t,n={isArray:s};return s&&(n.key=t[1],n.index=t[2]),n}function p(e){return null!==e&&"function"==typeof}t.Z={map:o}},245:(e,t,s)=>{"use strict";function n(...e){const t=e.shift();return e.forEach((e=>{for(const s in e)e[s]&&e[s].constructor&&e[s].constructor===Object?(t[s]=t[s]||{},n(t[s],e[s])):t[s]=e[s]})),t}s.d(t,{h:()=>n})},1336:(e,t,s)=>{"use strict";function n(e){return document.querySelector(`[data-module-element-id="${e}"] [data-spot-im-shadow-host]`)||document.querySelector(`[data-module-element-id="${e}"]`)}function a(e){var t,s;return null!==(t=null===(s=n(e))||void 0===s?void 0:s.shadowRoot)&&void 0!==t?t:document}s.d(t,{D:()=>n,s:()=>a})},1295:(e,t,s)=>{"use stric)}function a(e,t=414){return"object"==typeof window&&(!!window.navigator.userAgent.toLocaleLowerCase().match(/(mobile|iemobile|android|webos|iphone|ipad|ipod|blackberry|windows phone)/)||e.offsetWidth>10&&e.offsetWidth<=t)}s.d(t,{lZ:()=>a,tq:()=>n}),t.ZP=n()},9434:(e,t,s)=>{"use strict";s.d(t,{G6:()=>n}),"object"==typeof window&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),"object"==typeof window&&/firefox/.test(navigator.userAgent.toLowerCase());const n="object"==typeof window&&/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)},7528:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(935);function a(e){return(0,n.Z)(e.split("_"))}},98"},6616:(e,t,s)=>{"use strict";s.d(t,{m7:()=>o,tF:()=>n});const n="disqus";function a(e){switch(e.toUpperCase()){case"FACEBOOK":return"facebook";case"TWITTER":return"twitter";case"EMAIL":return"email";case"DISQUS":return n;case"GOOGLE":return"google";case"MICROSOFT":return"microsoft";case"LINKEDIN":return"linkedin";case"VK":return"vk";default:return}}function o(e){return Array.isArray(e)?e.map(a).filte=e)):[]}},1326:(e,t,s)=>{"use strict";s.d(t,{VY:()=>a}),s(6826);const n="SET_PLATFORM";t.ZP=(e={},t)=>{switch(t.type){case n:return{...e,type:t.payload.platform};default:return e}};const})},68}},9963:(e,t,s)=>{"use strict";s.d(t,{$F:()=>h,$Z:()=>c,Bo:()=>f,GX:()=>l,Hd:()=>r,Ln:()=>y,MJ:()=>u,PP:()=>i,QK:()=>m,Yr:()=>o,_2:()=>g,ay:()=>d,fe:()=>p});var n=s(4836),a=s(403);async function o({conversationId:e,postId:t,entities:s,contentType:n,displayName:a,tempMessageId:o,starsRating:i,additionalData:r}){var c,l,d;const u=await h(`${n}/${e}/comment`,{method:"POST",data:{content:s,metadata:{...a?{display_name:a}:{},reply_to:{}},temp_id:o,stars:i,additional_data:r},postId:t,headers:{"x-full-url":(null===(c=window.spotimSafeframe)||void 0===c?void 0:c.hostUrl)||window.location.href}});return u.message.users=null!==(l=null==u||null===(d=u.message)||void 0===d?void 0:d.users)&&void 0!==l?l:[],u}async function i({conversationId:e,replyToMessageId:t,rootMessageId:s,entities:n,displayName:a,postId:o,contentType:i,tempMessageId:r,starsRating:c,additionalData:l}){var d,u,m;const p=t?{reply_id:t}:{},g=await h(`${i}/${e}/comment/${s}/reply`,{method:"POST",data:{content:n,metadata:{...a?{display_name:a}:{},reply_to:p},temp_id:r,stars:c,additional_data:l},postId:o,headers:{"x-full-url":(null===(d=window.spotimSafeframe)||void 0===d?void 0:d.hostUrl)||window.location.href}});return g.message.users=null!==(u=null==g||null===(m=g.message)||void 0===m?void 0:m.users)&&void 0!==u?u:[],g}async function r({contentType:e,messageId:t,entities:s,displayName:n,postId:a,starsRating:o,additionalData:i}){var r,c;const l=await h(`message/${t}`,{method:"PATCH",data:{content:s,metadata:{...n?{display_name:n}:{},reply_to:{}},stars:o,additional_data:i},postId:a});return l.message.users=null!==(r=null==l||null===(c=l.message)||void 0===c?void 0:c.users)&&void 0!==r?r:[],l}async function c({messageId:e,postId:t}){try{await h(`message/${e}`,{method:"DELETE",data:{},postId:t})}catch(e){}return{etag:0,messages_count:0,comments_count:0}}function l(e,t,s,n,o){const{path:i,data:r}=function(e,t,s,n){return{path:e?"messages/super-report":"message/report",data:{...e?{message_ids:Array.isArray(t)?t:[t],source:a.oF}:{message_id:t},...s&&{reasons:{main:s,sub:""},report_metadata:{user_description:n}}}}}(e,t,n,o);return h(i,{method:"POST",data:r,postId:s})}async function d(e,t,s){return await h("block-user",{method:"POST",data:{user:e,source:"conversation",apply_to_history:s},postId:t})}async function u(e,t){return await h("block-user",{method:"DELETE",data:{user:e,source:"conversation"},postId:t})}async function m(e,t){return await h("allow-user",{method:"POST",data:{user:e,source:"conversation"},postId:t})}async function p(e,t){return await h("allow-user",{method:"DELETE",data:{user:e,source:"conversation"},postId:t})}async function g(e,t){return await h("messages/approve",{method:"POST",data:e,postId:t})}async function f(e,t){return await h("messages/block",{method:"POST",data:e,postId:t})}async function y(e,t,s){return await h("message/appeal",{method:"POST",data:{message_id:e,reason:t,message:s})}},8178:(e,t,s)=>{"use strict";s.d(t,{EQ:()=>u,P0:()=>m,Vj:()=>h,io:()=>p,mE:()=>y,pd:()=>f,rl:()=>g});var n=s(326),a=s.n(n),o=s(523),i=s(5826);a().get("tenant_config.conversation.realtime_moderation_time_ms",500);const r=["Space"];function c(){return!a().get("init_data.config.policy.roger_mode",!0)}const l=a().get("tenant_config.shared.realtime_moderation_enbled",!l}function u(){return c()&&a().get("tenant_config.moderation.suspensions_enabled",!1)}function m(){return d()&&a().get("tenant_config.conversation.realtimeModerationEnabled",!1)}function p(e,t){return t.length>0&&[o.$.BLOCK_ALL,o.$.FORCE_BLOCK_ALL,o.$.REJECT].includes(e)}function g(e,t){return t.length>0&&[o.$.REQUIRE_APPROVAL,o.$.BLOCK_ALL,o.$.FORCE_BLOCK_ALL,o.$.REJECT].includes(e)}function f(e,t){return c()&&d()&&a().get("tenant_config.conversation.afterclickModerationEnabled",!1)&&!function(e,t){const{mainSayControl:{isMessageBlocked:s},messageSayControls:{[t]:n}}=e;return t?null==n?void 0:n.isMessageBlocked:s}(e,t)}function y(e){return[o.$.BLOCK_ALL,o.$.FORCE_BLOCK_ALL,o.$.REJECT].includes(e)?i.rJ.BLOCKED:[o.$.REQUIRE_APPROVAL,o.$.PUBLISH_AND_MODERATE]?i.rJ.PENDING)}},9675:(e,t,s)=>{"use strict";s.d(t,{e:()=>o});var n=s(4836),a=s(784);function o(e,t,s,o,i){return(0,n.Z)("v1.0.0/conversation/read",{method:"POST",postId:e,data:{count:o,offset:s,parent_id:t,...i&&{sort_by:i},child_count:a.bI}})}},1824:(e,t,s)=>{"use strict";s.d(t,{MI:()=>a,pe:()=>o,p5:()=>i,up:()=>r,c9:()=>c});var n=s(4836);const a=(e,t)=>(0,n.Z)("v1.0.0/moderation/verdict/afterclick",{method:"POST",postId:e,data:t}),o=(e,t)=>(0,n.Z)("v1.0.0/moderation/fe/verdict/afterclick",{method:"POST",postId:e,data:t}),i=(e,t)=>(0,n.Z)("v1.0.0/moderation/verdict/realtime",{method:"POST",postId:e,data:t}),r=(e,t)=>(0,n.Z)("v1.0.0/moderation/fe/verdict/realtime",{method:"POST",postId:e,data:t});var c=e=>(0,n.Z)("v1.0.0/moderation/verdict/user-suspended",{method:"GET",postId:e,data:{}})},5740:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var n=new cla}}on(e,t){return t&&"function"==typeof t?(this.events[e]=this.events[e]||[],this.events[e].push()}):()=>{}}once(e,t){if(t&&"function"==typeof t)var s=this.on()}))}trigger(e,...t){let s=[];this.events&&this.events[e]&&this.events[e].length>0&&(s=this.events[e]),s.forEact)))}off(e,t){this.events[e]&&this.events[e].length>0&&)}(this.events[e],t):this.events[e]=[])}}},3225:(e,t,s)=>{"use strict";s.d(t,{P:()=>n,a:()=>a});const n="FETCH_AUTHENTICATION_EN}}},1167:(e,t,s)=>{"use strict";s.d(t,{I:()=>a,y:()=>n});const n="CLOSE_SIGNUP_WIZAR}}},3326:(e,t,s)=>{"use strict";s.d(t,{e:()=>r,w:()=>i});var n=s(8994),a=s(4186),o=s(3845);let i;function r(e){const{mode:t="signin",username:s="",isNavigationToSignInDisabled:i=!1,onSignIn:r=(()=>{}),onClose:{})}=null!=e?e:{};return async function(l,d){try{const{currentUser:a,moduleOptions:{theme:l,shouldOpenLogin:u,isConnectEnabled:m}}=d();!u||!m||(0,n.jl)(a)&&"signin"===t||(0,o.w4)({mode:t,username:s,theme:(null==e?void 0:e.theme)||l,isNavigationToSignInDisabled:i,onSignin:r,onClose:c})}catch(e){a.q.error("openLoginSelectorModal",e)}"}(i||(i={}))},971:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o,o:()=>a});var n=s(1292);function a(e){return{type:n.LG,payload:}}},1862:(e,t,s)=>{"use strict";s.d(t,{Y:()=>T});var n=s(326),a=s.n(n),o=s(1292),i=s(5216),r=s(5812),c=s(1329),l=s(7528),d=s(9458),u=s(784),m=s(9910),p=s(221),g=s(3191),f=s(9810),y=s(9717),h=s(1543),v=s(6967),_=s(3172),E=s(4186),I=s(7526),S=s(4821);const b="OW_ON_HOLD_CONVERSATION_ACTION",T=({data:e,postId:t,contentType:s,authorId:n,loadMoreComments:T,ignoreComments:C})=>async function(w){w((0,y.g)({conversationStatus:i.su.REFETCHING}));const A=e.conversation.community_question,O=function(e,t,s,n){var o;const i=function(e){let t;e.pagination.sortBy||(e.pagination.sortBy=a().get("init_data.config.sort_by"));const{reportedCommentsFromRead:s}=e;try{t=window.localStorage.getItem(u.QJ.ReportedComments),t=JSON.parse(t),(t||s)&&(t=t||{},s&&Object.keys(s).forEach((e=>{t[e]=!0})),e.reportedComments=t)}catch(e){console.log(e)}return e}(function(e){const t=e.conversation,{conversation:s,followersIds:n,pagination:a,starRatingSummary:o}=c.Z.map(t,(0,d.c_)("conversation"),{avatars:"followersIds",offset:"pagination.offset",has_next:"pagination.hasNext",sort_by:"pagination.sortBy",star_rating_summary:"starRatingSummary"});s.postId=(0,l.Z)(s.id);const{comments:i,usersList:p}=(0,r.kW)(s.id,{comments:(0,m.z)(t.comments),users:t.users});let g=[];return n&&(g=function(e,t){return e.ma)))).filte!e))}(n,p)),a.sortBy=a.sortBy||u.xO,{conversation:s,followersIds:n,pagination:a,comments:i,followers:g,starRatingSummary:o,reportedCommentsFromRead:e.reported_comments}}(e));return i.shouldReloadComments=!0,i.conversation.postId=t,i.conversation.contentType=s,i.conversation.authorId=n,i.conversation.isStrictModeEnabled=null==e||null===(o=e.conversation)||void 0===o?void 0:o.strict_mode,i}(e,t,s,n||"");(0,v.x)(e.user.registered,e.conversation.users,w),function(e,t){var s;null!==(s=e.moduleOptions)&&void 0!==s&&s.isSterileConversation?t({type:o.Cr}):t({type:o.jm,payload:e})}({...O,ignoreComments:C},w),function(e,t){e&&t((0,h.n)())}(!!T,w),w((0,g.KS)(O.conversation.id)),w((0,f.k)(O.reportedComments)),w({type:o._l,payload:{moduleOptions:{communityQuestion:A}}}),w({type:p.nl,payload:{isLoaded:!1}}),w((0,y.g)({conversationStatus:i.su.LOADED})),w((async(e,t)=>{try{const s=sessionStorage.getItem(b),{isRegistered:n}=t().currentUser;if(!s||!n)return void sessionStorage.removeItem(b);const a=JSON.parse(s);switch(a.name){case _.cE.LIKE:(({dispatch:e,action:t})=>{if(t.name!==_.cE.LIKE)throw new Error(`wrong action handled by like handler - ${t}`);const{params:s}=t;if(!s||!s.message||!s.operation)throw new Error("missing params of on hold action");const{message:n,operation:a}=s;e((0,I.l)(n.id)),e((0,S.j)({message:n,operation:a}))})({dispatch:e,action:a});break;case _.cE.SHOW_MORE_REPLIES:(({dispatch:e,action:t})=>{if(t.name!==_.cE.SHOW_MORE_REPLIES)throw new Error(`wrong action handled by show more replies handler - ${t}`);const{params:s}=t;if(!s||!s.messageId)throw new Error("missing params of on hold action - show more replies");const{messageId:n}=s;e((0,I.l)(n))})({dispatch:e,action:a});break;case _.cE.SHOW_MORE_COMMENTS:(async({dispatch:e,action:t,getState:s})=>{if(t.name!==_.cE.SHOW_MORE_COMMENTS)throw new Error(`wrong action handled by show more comments handler - ${t}`);const n=s().moduleOptions.conversationId,{params:a}=t;if(!(a&&a.conversationId&&a.offset&&a.scrollToMessage))throw new Error("missing params of on hold action - show more replies");if(n===a.conversationId){const{moduleOptions:{isMobile:t},comments:{pagination:{offset:n}}}=s(),o=(0,h.g)(t),i=a.offset-n+o;await e((0,h.n)(i)),e((0,I.l)(a.scrollToMessage,!0))}})({dispatch:e,action:a,getState:t});break;default:throw new Error("unknown action name")}sessionStorage.removeItem(b)}catch(e){E.q.error("failed to recover on hold actions",e),sessionStorage.removeItem(b)}}))}},3368:(e,t,s)=>{"use strict";s.d(t,{D:()=>n});const n="EXPAND_AGGREGATED_MESSAGES"},7513:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>d,fF:()=>c,uh:()=>l});var n=s(4186),a=s(6793),o=s(9675),i=s(5812),r=s(9910);const c="GET_PREVIOUS_REPLIES_END",l="GET_PREVIOUS_REPLIES_END_ERROR";function d(e){return async function(t,s){const{conversation:d}=s();try{const s=await o.e(d.postId,e.message.id,e.message.offset,a.qC);if(!s)throw new Error("Couldn't fetch replies");const n=function(e,t){const{comments:s}=(0,i.kW)(t.id,{comments:(0,r.z)(e.conversation.comments),users:e.conversation.users});return s}(s,d),l=function(e){return{conversation:{hasNext:e.conversation.has_next,offset:e.conversation.offset}}}(s);t({type:c,payload:{replies:n,parentMessage:e.message,conversation:l.conversation}})}catch(e){throw n.q.error("getPreviousReplies",e),t({type:l,payload:{error:e},error:!0}),e}}}},6733:(e,t,s)=>{"use strict";s.d(t,{A6:()=>m,TP:()=>u,ZP:()=>g,gk:()=>p});var n=s(326),a=s.n(n),o=s(4186),i=s(6793),r=s(9675),c=s(5812),l=s(9910),d=s(6967);const u="GET_REPLIES_START",m="GET_REPLIES_END",p="GET_REPLIES_END_ERROR";function g(e){return async function(t,s){var n;o.q.apm.start("show_more_replies");const{conversation:u,comments:g}=s(),f=null==g||null===(n=g.pagination)||void 0===n?void 0:n.sortBy,y=a().get("tenant_config.conversation.amount_replies_per_fetch",i.qC);try{const s=await r.e(u.postId,e.message.id,e.message.offset,y,f);if(!s)throw new Error("Couldn't fetch replies");const n=function(e,t){const{comments:s}=(0,c.kW)(t.id,{comments:(0,l.z)(e.conversation.comments),users:e.conversation.users});return s}(s,u)}}(s);(0,d.x)(s.user.registered,s.conversation.users,t),t({type:m,payload:{comments:n,parentMessage:e.message,conversation:a.conversation}}),o.q.apm.end("show_more_replies")}catch(e){throw o.q.error("getReplies",e),t({type:p,payload:{error:e},error:!0}),e}}}},7526:(e,t,s)=>{"use strict";s.d(t,{l:()=>u});var n=s(5740),a=s(4836),o=s(9910),i=s(5812),r=s(8143),c=s(4186),l=s(218),d=s(1292);function u(e,t=!1){return async(s,u)=>{const{comments:m,moduleOptions:{postId:p}}=u();if(await(0,l.fv)(s),!(0,r.jb)(m.list,e))try{const{comments:t,usersList:n}=await async function(e,t){const s=await(0,a.Z)("v1.0.0/conversation/read",{method:"POST",data:{count:20,offset:0,sort_by:"newest",message_id:e},postId:t}),{replies:n,...r}=s.conversation.comments[0];r.replies=[],n.unshift(r);const c={comments:(0,o.z)(n),users:s.conversation.users};return(0,i.kW)(s.conversation.conversation_id,c)}(e,p);s({type:d.rd,payload:{comments:t,usersList:n}})}catch(e){c.q.error("fetch highlighted message",e)}n.Z.trigger("highlightMessage",e,t)}}},4936:(e,t,s)=>{"use strict";s.d(t,{t:()=>p});var n=s(8692),a=s(3868),o=s(1890),i=s(1292),r=s(4186),c=s(8178),l=s(4836),d=s(7724),u=s(1390),m=s(5691);function p({rootMessageId:e=null,replyId:t=null,depth:s=0,entities:p,replyToStackId:g=null,parentMessageId:f=null,replyToUserId:y=null,replyToUsername:h=null,replyToDisplayName:v=null,displayName:_=null,starsRating:E=0,isRetry:I=!1,id:S,dontModerate:b=!1,additionalData:T,rephraseId:C}){return async function(w,A){const O=A(),{comments:R,currentUser:M,moduleOptions:{forceRegister:k}}=O,N=E>0,L=!b&&!I&&(0,c.pd)(O,f),{failedMessageTemp:D}=R;var P;if(!I&&D&&w((P={message:null==D?void 0:D.message},{type:i.EQ,payload:P})),!(p&&0!==p.length||N))return w({type:i.aI,payload:{error:"Create message: no entities"},error:!0});const U=!!p.find((e=>e.type===a.EntityType.Text&&e.text.length>0||e.type!==a.EntityType.Text));if(!U&&!N)return w({type:i.aI,payload:{error:"Create message: no content"},error:!0});if(k&&!M.isRegistered)return w({type:i.aI,payload:{error:"Force register to comment"},error:!0});M.isRegistered||(0,d.A2)(M.id);const Z=S||(0,n.guid)(),x={id:Z,rootMessageId:e,postedAt:($=new Date,$.getTime()/1e3),replyId:t,entities:p,userDisplayName:_,user:M,parentMessageId:f,replyToUserId:y,replyToUsername:h,replyToDisplayName:v,starsRating:E,depth:s,additionalData:T};var $;const V="create_"+(0===s?"comment":"reply");return r.q.apm.start(V),w({type:i.aI,payload:{currentUser:M,isLoggedIn:(0,o.isLoggedIn)(M),message:x,replyToStackId:g,isRetry:I}}),w(!U&&N?function({message:e}){return async function(t,s){const{starsRating:n}=e,{currentUser:a,moduleOptions:{postId:c}}=s();try{r.q.apm.start("create_stars_rating");const s=await async function(e,t){const s={stars:e};return await(0,l.Z)("v1.0.0/conversation/rate",{postId:t,method:"POST",data:s})}(n,c);return r.q.apm.end("create_stars_rating"),"ok"===(null==s?void 0:s.status)?t({type:i.Np,payload:{message:e,isLoggedIn:(0,o.isLoggedIn)(a)}}):(r.q.error("create_stars_rating","Create stars rating failed"),t({type:i.WA,payload:{message:e}}),t({type:i.Np,payload:{error:"Create stars rating failed"},error:!0}))}catch(s){return r.q.error("create_stars_rating",s),t({type:i.WA,payload:{message:e}}),t({type:i.Np,payload:{error:"Create stars rating failed",message:e},error:!0})}}}({tempMessageId:Z,message:x}):L?(0,u.Z)({entities:p,message:x,tempId:Z,isRetry:I,rephraseId:C}):(0,m.Z)({tempMessageId:Z,message:x,isRetry:I,rephraseId:C}))}}},1390:(e,t,s)=>{"use strict";s.d(t,{c:()=>g,Z:()=>p});var n=s(3868),a=s(1890),o=s(1292),i=s(135);var r=s(8178),c=s(1824),l=s(1677),d=s(4186),u=s(784),m=s(5691);function p({entities:e=[],message:t,tempId:s,isRetry:p,rephraseId:f}){return async function(y,h){try{var v,_;const{starsRating:d,user:E}=t,I=g(e),{moduleOptions:{postId:S}}=h();let b;b=u.BH?await(0,c.pe)(S,{content:I,stars:d,metadata:{},unique_content_id:s}):await(0,c.MI)(S,{content:I,stars:d,metadata:{},unique_content_id:s});const{verdict:T,tags:C,is_eligible_for_rephrasing:w=!1}=b;(0,i.R)({type:"real_time_feedback",event_name:"real_time_feedback",element:JSON.stringify({action_name:"triggered",orginal_text:null!==(v=null===(_=I.finxt)))||void 0===_?void 0:_.text)&&void 0!==v?v:"",tags:C,rephraseId:f})});const A=r.rl(T,C);return y(r.EQ()&&C.includes(l.J.SUSPENDED)?function({isUserSuspended:e,verdict:t,taggers:s,isMessageBlockedVerdict:n,...a}){return(r,c)=>{return e&&r((l={type:"suspension-triggered"},(e,t)=>{const{currentUser:s}=t(),{isRegistered:n,id:a}=s;e((e=>(t,s)=>{var n;const{spotId:a,postId:o}=null===(n=s())||void 0===n?void 0:n.moduleOptions;(0,i.R)({spot_id:a,post_id:o,...e})})({item_type:"realtime-moderation",user_id:a,is_registered:n,...l}))})),r({type:o.kn,payload:{isUserSuspended:e,verdict:t,taggers:s,isMessageBlockedVerdict:n,...a}});var l}}({currentUser:E,isUserSuspended:!0,isLoggedIn:(0,a.isLoggedIn)(E),message:t,verdict:T,taggers:C,isMessageBlockedVerdict:A,isEligibleForRephrasing:w}):A?{type:o.yf,payload:{currentUser:E,isLoggedIn:(0,a.isLoggedIn)(E),message:t,verdict:T,taggers:C,isMessageBlockedVerdict:A,tempId:s,isEligibleForRephrasing:w}}:(0,m.Z)({tempMessageId:s,message:t,isRetry:p,isMessageBlockedVerdict:A,taggers:C,verdict:T,isEligibleForRephrasing:w,rephraseId:f}))}catch(e){return d.q.error("moderateAndPublishMessage",e),y((0,m.Z)({tempMessageId:s,message:t,isRetry:p,rephraseId:f}))}}}function g(e=[]){const t=e.finth));return e.length>1&&t?e.filtext)):e}},5691:(e,t,s)=>{"use strict";s.d(t,{Z:()=>S});var n=s(1890),a=s(326),o=s.n(a),i=s(1292),r=s(8994),c=s(4186),l=s(1824),d=s(135),u=s(9963),m=s(9850),p=s(784),g=s(2712);const f=o().get("tenant_config.conversation.status_fetch_interval_in_ms",300),y=o().get("tenant_config.conversation.status_fetch_timeout_in_ms",3e3),h=o().get("tenant_config.conversation.status_fetch_retry_count",12),v=o().get("tenant_config.conversation.status_fetch_default_fallback_status",g.MessageStatus.Approved);async function _(e,t,s=0){try{if(++s<=h){let n;n=p.BH?await((e,t)=>(0,u.$F)(`fe/message/${t}/status`,{method:"GET",postId:e,data:{}}))(t,e):await((e,t)=>(0,u.$F)(`message/${t}/status`,{method:"GET",postId:e,data:{}}))(t,e);const{status:a}=n;return"processing"===a?(await async function(e){return await new Promise((t=>setTimeout(t,e)))}(f),_(e,t,s)):a}return status||v}catch(n){return c.q.error("runFetchMessageStatus",n),_(e,t,s)}}var E=s(5826);const I=o().get("tenant_config.moderation.retry_debug_enabled",!1);function S({tempMessageId:e,message:t,isRetry:s=!1,rephraseId:a}){return async function(g,f,{dispatchPublicEvent:h}){const{rootMessageId:S,replyId:C,depth:w,entities:A,replyToStackId:O,parentMessageId:R,replyToUserId:M,replyToUsername:k,replyToDisplayName:N,starsRating:L,additionalData:D}=t,{currentUser:P,conversation:U,moduleOptions:{postId:Z}}=f(),x=o().get("tenant_config.moderation.content_aware_events",!1),$=T(f,t),V=A.filter((e=>"text"!==e.type||"text"===e.type&&""!==e.text)),F=w>0?p.Cs.Reply:p.Cs.Comment;let B,G=!0;if(s)try{let s;s=p.BH?await((e,t)=>(0,u.$F)(`fe/retry-status/${e}`,{method:"GET",postId:t,data:{}}))(e,Z):awa}))(e,Z);const{message_id:n,status:a}=s;n&&(G=!1,g((W={tempMessageId:e,messageId:n},{type:i.Tl,payload:W})),t.id=n,t.stat"}(a),B={...B,message:t})}catch(e){c.q.error("publishMessage_retry",e,{messageType:F})}var W;try{if(G){if(w>0){const t=w>1?R:null;B=await u.PP({conversationId:U.id,rootMessageId:S,replyToMessageId:t,entities:V,postId:Z,displayName:P.isRegistered?"":(0,n.getDisplayName)(P),contentType:U.contentType,tempMessageId:e,starsRating:L,additionalData:D})}else B=await u.Yr({conversationId:U.id,postId:Z,entities:V,displayName:P.isRegistered?"":(0,n.getDisplayName)(P),tempMessageId:e,contentType:U.contentType,starsRating:L,additionalData:D});if(I)throw new Error("Retry Debug Error")}}catch(t){return c.q.error("publishMessage_create",t,{messageType:F}),h(m.K$,{message_type:F,parent_id:R}),g({type:i.Np,payload:{error:t,message:{id:e,rootMessageId:S,parentMessageId:R,replyId:C,depth:w,entities:V,replyToStackId:O,replyToUserId:M,replyToUsername:k,replyToDisplayName:N,displayName:(0,n.getDisplayName)(P),starsRating:L,additionalData:D,user:P},isRetry:s},error:!0})}try{if(B){var q,H,j;""===(t=function(e,t,s,n){return Object.assign(e,{entities:e.entities?e.entities:e.content,type:t,commenter_id:n,metadata:{scope:s},stars:e.stars,users:[],starsRating:e.stars}),delete e.content,e}(B.message,F,U.contentType,P.id)).status&&(t.status=await function(e,t){return new Promise((async s=>{const n=setTimeou)}),y),a=await _(e,t);s(a||""),clearTimeout(n)}))}(t.id,Z)),Object.assign(t,{depth:w,tempMessageId:e,isNew:!0,conversationId:U.id,parentMessageId:R,replyToUserId:M,replyToUsername:k,replyToDisplayName:N,rootMessageId:S,user:P,additionalData:D}),x&&(0,l.MI)(Z,{content:V,stars:L,metadata:{},unique_content_id:$.tempMessageId||e,actual_message_id:t.id}),function(e,{message:t,currentUser:s,tempMessageId:n,rephraseId:a}){const o=T(e,t),{moduleOptions:{postId:i},conversation:r}=e(),c={message_id:t.id,user_id:s.id,is_registered:s.isRegistered,conversation_id:r.id,post_id:i,native:o.tempMessageId||n,...a&&{element:JSON.stringify({rephase_id:a})},...b(t,o)};0===t.depth?Object.assign(c,{type:"commented"}):t.depth>0&&Object.assign(c,{type:"replied",relatedMessageId:t.parentMessageId}),(0,d.R)(c)}(f,{message:t,currentUser:P,tempMessageId:e,rephraseId:a}),t.status=(e=>{let t=e;const s=o().get("init_data.config.policy.roger_mode",!1);return"require_approval"===e&&(t=E.hA),"block_all"===e&&(t=E.l0),t!==E.Ci&&s&&(t=E.Ci),t})(t.status);const n=`create_${F}`;return c.q.apm.end(n),h(m.ck,{message_id:t.id,message_type:F,parent_id:R,depth:t.depth}),g({type:i.Np,payload:{message:t,isLoggedIn:(0,r.jl)(P),isRetry:s,isStrictModeEnabled:null!==(q=null===(H=B)||void 0===H||null===(j=H.conversation)||void 0===j?void 0:j.strict_mode)&&void 0!==q&&q}})}}catch(e){c.q.error("publishMessage_status",e,{messageType:F}),h(m.K$,{message_type:F,parent_id:R}),g({type:i.Np,payload:{error:e}})}}}function b(e,t){return{item_"}(t),segment:e.status}}function T(e,t){const{mainSayControl:s,messageSayControls:n}=e();return t.depth>0&&t.parentMessageId?n[t.parentMessageId]:s}},4821:(e,t,s)=>{"use strict";s.d(t,{j:()=>r});var n=s(4186),a=s(4836),o=s(1292),i=s(9850);function r({operation:e,message:t}){return async function(s,r,{dispatchPublicEvent:l}){try{const{moduleOptions:{postId:d},conversation:{id:u,contentType:m},currentUser:{id:p}}=r(),{id:g,type:f,parentMessageId:y,isVotedUp:h,isVotedDown:v}=t,_={message_id:g,type:f,parent_id:y};"up"!==e||h?"down"!==e||v||l(i.f8,{..._,count:t.downVotesCount}):l(i.v9,{..._,count:t.upVotesCount}),"up"===e&&h&&s({type:o.O1,payload:p}),s({type:o.s$,payload:{operation:e,message:t}});const E=function(e,t,s){let n;switch(!0){case"up"===s&&!e&&!t:n="like";break;case"up"===s&&e&&!t:n="toggle-like";break;case"up"===s&&!e&&t:n="swap-to-like";break;case"down"===s&&!e&&!t:n="dislike";break;case"down"===s&&!e&&t:n="toggle-dislike";break;case"down"===s&&e&&!t:n="swap-to-dislike"}return{operation:n}}(h,v,e);await async function({data:e,postId:t}){return await(0,a.Z)("v1.0.0/rank/rank/message",{method:"POST",data:e,postId:t})}({postId:d,data:{...E,message_id:g,source:m}}),function(e,{operation:t,message:s,conversationId:a=null,userId:o=null}){const{id:i,featuredComment:r}=s,l={userId:o,conversationId:a,messageId:i};r&&(l.target_type="featured-comment",l.segment="top"===r?"top-featured-comment":"in-conversation-featured"),l.type=c(t,s),n.q.send(l.type)}(0,{operation:e,message:t,conversationId:u,userId:p})}catch(a){s({type:o.R9,payload:{error:a,operation:e,id},error:!0}),n.q.error("toggleVoteMessage",a,{voteType:c(e,t)})}}}function c(e,t){const{isVotedDown:s,isVotedUp:n}=t;let a;return a="up"===e?n?"liked-cancelled":"liked":s?"disliked-cancelled":"disliked",a}},6506:(e,t,s)=>{"use strict";s.d(t,{a:()=>n,q:()=>a});const n="DELETE_MESSAGES";function a(e){return function(t){const s=e.map(o);t({type:n,payload:{messages:s}})}}function o(e){return{id:e.id}}},6480:(e,t,s)=>{"use strict";s.d(t,{S:()=>l,m:()=>c});var n=s(5766),a=s(326),o=s.n(a),i=s(5826),r=s(293);const c="UPDATED_MESSAGES",l=(0,n.createAction)(c,(e=>e.map(r.Z).map((e=>o().get("init_data.config.policy.roger_mode",!1)&&e&&e.message&&e.message.status!==i.Ci?null:null==e?void 0:e.message))))},293:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(2712),a=s(2408),o=s(1329),i=s(7505);function r(e){const{message:t}=o.Z.map(e,(0,i.$)("message"));t.isVotedUp=1===e.rank.ranked_by_current_user,t.isVotedDown=-1===e.rank.ranked_by_current_user,t.downVotesCount=e.rank.ranks_down,t.upVotesCount=e.rank.ranks_up,t.hasNext=e.has_next,t.parentMessageId=e.parent_id;const s=(0,a.nL)(e.users[e.user_id]);return t.user=s,t.userDisplayName&&(t.user.displayName=s.isRegistered?s.displayName:t.userDisplayName),t.id!==e.root_comment?(t.depth=(t.depth||0)+1,t.rootMessageId=e.root_comment):(t.depth=0,t.rootMessageId=t.id),s.isOnline=!0,t.status===n.MessageStatus.Blocked&&t.deleted&&(t.deleted=!1),{user:s,message:t}}},9236:(e,t,s)=>{"use strict";s.d(t,{$:()=>i,e:()=>o});var n=s(326),a=s.n(n);const o="REJECT_MESSAGES";function i(e){return function(t){const s=e.map(r);a().get("init_data.config.policy.roger_mode",!1)||t({type:o,payload:{messages:s}}}}},2282:(e,t,s)=>{"use strict";s.d(t,{G:()=>n});const n="REALTIME_MESSAGE_VOTE"},9717:(e,t,s)=>{"use strict";s.d(t,{g:()=>i});var n=s(9850),a=s(5216),o=s(1292);function i(e){return async function(t,s,{dispatchPublicEvent:i}){(null==e?void 0:e.conversationStatus)===a.su.ERROR&&i(n.JO,"conversation read failed"),t({type:o.NN,payload:e})}}},1292:(e,t,s)=>{"use strict";s.d(t,{An:()=>fe,BJ:()=>ue,BZ:()=>de,Cr:()=>a,EQ:()=>v,FO:()=>x,FV:()=>te,HM:()=>ne,Hz:()=>K,JR:()=>ve,Js:()=>q,KM:()=>i,LG:()=>ye,Lk:()=>M,Mg:()=>be,Mv:()=>u,NN:()=>_e,Nb:()=>Ie,Np:()=>h,O1:()=>c,OB:()=>le,ON:()=>O,Ol:()=>F,Ox:()=>we,PJ:()=>z,QR:()=>P,R6:()=>Ee,R9:()=>N,TJ:()=>me,Tl:()=>R,UY:()=>_,Ug:()=>g,Ui:()=>H,W7:()=>se,WA:()=>Se,WX:()=>d,Y8:()=>Oe,YK:()=>V,ZQ:()=>G,_6:()=>ae,_Z:()=>$,_l:()=>W,aI:()=>y,as:()=>m,aw:()=>ee,bt:()=>T,bx:()=>D,e4:()=>ge,eI:()=>Ae,eo:()=>j,f6:()=>S,gF:()=>J,gL:()=>b,gu:()=>he,jX:()=>re,jk:()=>A,jm:()=>n,k$:()=>ie,kn:()=>pe,lI:()=>o,nA:()=>C,nI:()=>Z,nz:()=>U,ow:()=>X,rd:()=>l,s$:()=>k,sx:()=>w,t7:()=>L,th:()=>Te,u3:()=>B,uC:()=>p,ug:()=>I,vU:()=>Q,vY:()=>Ce,vz:()=>Y,wB:()=>f,xU:()=>oe,yf:()=>ce,z:()=>r,zD:()=>E});const n="INITIALIZE_CONVERSATION",a="CLEAR_CONVERSATION",o="INITIALIZE_MODULE_OPTIONS",i="REQUEST_GET_UP_VOTES",r="RESPONSE_GET_UP_VOTES",c="REMOVE_UP_VOTE",l="ADD_HIGHLIGHTED_MESSAGE",d="ONLINE_USER",u="OFFLINE_USER",m="RESET_UP_VOTES",p="SET_CURRENT_USER",g="RANK_CONVERSATION",f="GET_STARS_RATING_SUMMARY",y="CREATE_MESSAGE_START",h="CREATE_MESSAGE_END",v="CLEAN_FAILED_MESSAGE",_="APPROVE_MESSAGE_START",E="APPROVE_MESSAGE_END",I="APPROVE_MESSAGE_FAILED",S="DELETE_MESSAGE_START",b="DELETE_MESSAGE_END",T="REJECT_MESSAGE_START",C="REJECT_MESSAGE_END",w="REJECT_MESSAGE_FAILED",A="EDIT_MESSAGE_START",O="EDIT_MESSAGE_END",R="CHANGE_MESSAGE_ID",M="REPORT_MESSAGE_END",k="VOTE_TOGGLE_MESSAGE_START",N="VOTE_TOGGLE_MESSAGE_END",L="FETCH_CONVERSATION_START",D="REALTIME_MESSAGE_NEW",P="UPDATE_MESSAGE_FEATURED",U="APPEAL_MESSAGE",Z="OPEN_EDIT_SAY_CONTROL",x="OPEN_MESSAGE_SAY_CONTROL",$="RANK_CONVERSATION_MESSAGE_SAY_CONTROL",V="CLOSE_EDIT_SAY_CONTROL",F="CLOSE_REPLY_SAY_CONTROL",B="FOCUS_SAY_CONTROL",G="UNFOCUS_SAY_CONTROL",W="UPDATE_MODULE_OPTIONS",q="SET_IS_SETTING_COMMUNITY_QUESTION",H="MODERATION_USER_STATUS",j="GET_MODERATION_DEFAULT_POLICY",K="SET_MODERATION_DEFAULT_POLICY",J="SET_USER_VOTES",z="SHOW_REPORT_MESSAGE_MODAL",Q="UPDATE_CONVERSATION_MESSAGES_COUNT",Y="ADD_FEATURED_COMMENT",X="REMOVE_FEATURED_COMMENT",ee="PIN_FEATURED_COMMENT",te="MUTE_USER",se="UNMUTE_USER",ne="BLOCKLIST_USER_START",ae="BLOCKLIST_USER_FAILED",oe="BLOCKLIST_USER_END",ie="UPDATE_REPORTED_COMMENTS",re="SET_SIGN_UP_WIZARD_MESSAGE_ID",ce="MODERATE_MESSAGE_BLOCK",le="CLOSE_MODERATION_ALERT",de="NOTIFY_MODERATION_ALERT_RENDERED",ue="REALTIME_MODERATE",me="FETCH_USER_SUSPENSION_STATUS",pe="UPDATE_USER_SUSPENSION",ge="PRELOAD_CONVERSATION",fe="CHANGE_USER_DISPLAY_NAME",ye="SET_FOCUS_SAY_CONTROL",he="SCROLL_TO_HEADER",ve="SET_USER_INITIALIZED",_e="SET_CONVERSATION_STATUS",Ee="SET_TRANSLATION_INITIALIZED",Ie="SET_TOKEN_INITIALIZED",Se="NOTIFY_STARS_RATING_FAILED",be="SET_READ_ONLY_CONVERSATION",Te="SET_CONVERSATION_EXPIRATION_DATE",Ce="SET_RICH_EDITOR_FETCHED",we="SET_IS_WEBVIEW_MODE",Ae="SET_IGNORE_QUERY_PARAMS",Oe="UPDATE_REALTIME_HANDLER_INSTANCE"},5507:(e,t,s)=>{"use strict";s.d(t,{uw:()=>r,_V:()=>o,gN:()=>c,i5:()=>i,ZP:()=>l});var n=s(4186),a=s(8620);const o="REQUEST_VERIFY_USERNAME",i="RESPONSE_VERIFY_USERNAME",r="REQUEST_VERIFY_EMAIL",c="RESPONSE_VERIFY_EMAIL";function l({email:e,spotId:t,url:s}){return async function(o){o({type:r,payload:{email:e,spotId:t,url:s}});try{await function({email:e,url:t,spotId:s}){const n={email:e,spot_id:s,referer_url:t};return(0,a.Z)("email-connect/verify-start",{method:"POST",data:n})}({email:e,url:s,spotId:t}),o({type:c,payload:{email:e,spotId:t,url:s}})}catch(e){o({type:c,payload:{error:e},error:!0}),n.q.error("verifyEmail",e)}}}},50"},3179:(e,t,s)=>{"use strict";s.d(t,{Bl:()=>d,v1:()=>l,wu:()=>c});var n=s(1776),a=s.n(n),o=s(5766),i=s(1292);const r={isUserInitialized:!1,conversationStatus:s(5216).su.FETCHING,isTranslationInitialize:!1,isTokenInitialized:!1},c=(0,o.createAction)(i.Nb),l=(0,o.createAction)(i.JR),d=(0,o.createAction)(i.R6);t.ZP=(0,o.handleActions)({[i.JR]:a()(((e,t)=>{e.isUserInitialized=t.payload.isUserInitialized})),[i.Nb]:a()(((e,t)=>{e.isTokenInitialized=t.payload.isTokenInitialized})),[i.NN]:a()(((e,t)=>{e.conversationStatus=t.payload.conversationStatus})),[i.R6]:a()(((e,t)=>{e.isTranslationInitialize=t.payload.isTranslationInitialize}))},r)},7175:(e,t,s)=>{"use strict";s.d(t,{$s:()=>Z,lH:()=>U,DE:()=>P});var n=s(5766),a=s(1776),o=s.n(a),i=s(1890),r=s(2712),c=s(8143),l=s(6377),d=s(6733),u=s(7513),m=s(6480),p=s(2282),g=s(6506),f=s(3368),y=s(784),h=s(1292),v=s(1167),_=s(9236);function E(e={}){return{offset:0,sortBy:y.xO,hasNext:!1,...e}}var I=s(5128),S=s(7724),b=s(6711),T=(0,n.handleActions)({[h.aI]:o()(((e,t)=>{const{message:s,isRetry:n}=t.payload;!n&&(0,b.l)(s)&&e.offset++})),[h.EQ]:o()(((e,t)=>{const{message:s}=t.payload;(0,b.l)(s)&&e.offset--})),[h.bx]:o()(((e,t)=>{const{messagesStack:s}=t.payload;s.forEach((t=>{0===t.message.depth||e.offset++}))}))},E());function C(e,t,s){const n=e.findInde=t));-1!==n&&(e[n]=s)}function w(e){return{...e,isReported:!0,deleted:!0}}const A=(e,t)=>{const{message:s,isRetry:n}=t.payload;(0,b.l)(s)&&(!n&&(0,b.l)(s)&&e.unshift(s.id),C(e,s.tempId,s.id))};var O=(0,n.handleActions)({[(0,n.combineActions)(h.jm,h.rd,I.W4.fulfilled.type).toString()]:o()(((e,t)=>{const{shouldReloadComments:s,comments:n}=t.payload;s&&(e=[]);for(const t of n)(0,b.l)(t)&&!e.includes(t.id)&&e.push(t.id);return e})),[h.Np]:{next:o()(A),throw:o()(A)},[h.EQ]:o()(((e,t)=>{const{message:s}=t.payload;return(0,b.l)(s)?e.filter((e=>e!==s.id)):e}))},[]),R=(0,n.handleActions)({[(0,n.combineActions)(h.jk,h.ON).toString()]:{next:o()(((e,t)=>{const{message:s}=t.payload;e.message=M(e,s)})),throw:o()(((e,t)=>{const{message:s}=t.payload;e.message=M(e,s)}))},[h.Lk]:o()((e=>{const{message:t}=e;e.message=w(t)})),[p.G]:o()(((e,t)=>{const{message:s}=t.payload;e.message=M(e,s)})),[h.s$]:o()(((e,t)=>{const{operation:s,message:n}=t.payload,{isVotedDown:a,isVotedUp:o}=n;"up"===s?(a&&(e.message.isVotedDown=!1,e.message.downVotesCount-=1),o?(e.message.isVotedUp=!1,e.message.upVotesCount-=1):(e.message.isVotedUp=!0,e.message.upVotesCount+=1)):"down"===s&&(o&&(e.message.isVotedUp=!1,e.message.upVotesCount-=1),a?(e.message.isVotedDown=!1,e.message.downVotesCount-=1):(e.message.isVotedDown=!0,e.message.downVotesCount+=1))})),[h.FV]:o()((e=>{e.message.user.isMuted=!0})),[h.W7]:o()((e=>{e.message.user.isMuted=!1})),[h.WX]:o()((e=>{e.message.user.isOnline=!0})),[h.Mv]:o(1})),[h.Ui]:o()(((e,{payload:{isUserAllowed:t,isUserBlocked:s}})=>{e.message.user.isAllowListed=t,e.message.user.isBlockListed=s}))},l.En());function M(e,t){return{...e.message,...t,depth:e.message.depth,isVotedUp:e.message.isVotedUp,isVotedDown:e.message.isVotedDown,repliesCount:e.message.repliesCount,user:{...e.message.user,...t.user}}}var k=(0,n.handleActions)({[(0,n.combineActions)(h.jm,h.rd,I.W4.fulfilled.type).toString()]:o()(((e,t)=>{const{shouldReloadComments:s,comments:n,reportedComments:a}=t.payload;for(let t of n){if(!s&&e[t.id])continue;a&&a[t.id]&&(t=w(t));let n=l.En({id:t.id,message:t,hasNext:t.hasNext});if(t.parentMessageId){const s=e[t.parentMessageId];s&&(e[t.parentMessageId]=l.U_(e[t.parentMessageId],t),n=l.iT(n,s))}e[t.id]=n}})),[d.A6]:o()(((e,t)=>{const{comments:s,parentMessage:n,conversation:a}=t.payload;for(const t of s){let s=l.En({id:t.id,message:t,hasNext:t.hasNext});if(t.parentMessageId){const n=e[t.parentMessageId];e[t.parentMessageId]=l.U_(e[t.parentMessageId],t),s=l.iT(s,n)}e[t.id]=s}e[n.id]=l.Bu(e[n.id],a)})),[h.Np]:{next:o()(((e,t)=>{const{message:s,isLoggedIn:n,isRetry:a}=t.payload;N(e,a,s,n)})),throw:o()(((e,t)=>{const{message:s,isLoggedIn:n,isRetry:a}=t.payload;N(e,a,s,n)}))},[h.EQ]:o()(((e,t)=>{var s,n;const{message:a}=t.payload,o=null===(s=e[a.id])||void 0===s||null===(n=s.message)||void 0===n?void 0:n.parentMessageId;if(o){const t=e[o];t.childrenStackIds=t.childrenStackIds.filter((e=>e!==a.id)),t.message.repliesCount--}delete e[a.id]})),[h.WX]:o()(((e,t)=>{const{onlineUsersId:s}=t.payload;Object.values(e).filted))).forEach((s=>{e[s.id]=R(e[s.id],t)}))})),[h.Mv]:o()(((e,t)=>{const{onlineUsersId:s}=t.payload;Object.values(e).filter((e=>!s.includes(e.message.user.id))).forEach((s=>{e[s.id]=R(e[s.id],t)}))})),[(0,n.combineActions)(p.G,h.s$,h.Ui,h.Lk).toString()]:o()(((e,t)=>{const{message:s}=t.payload;e[s.id]=R(e[s.id],t)})),[m.m]:o()(((e,t)=>{for(const s of t.payload){if(!s||!s.id)continue;const t=e[s.id];t&&(t.message=M(t,s))}})),[u.fF]:o()(((e,t)=>{const{replies:s=[],parentMessage:n,conversation:a}=t.payload,o=[];for(const t of s){if(e[t.id])continue;let s=l.En({id:t.id,message:t,hasNext:t.hasNext});const a=e[t.parentMessageId];s=l.iT(s,a),t.parentMessageId===n.id?o.push(s.id):e[t.parentMessageId]=l.U_(e[t.parentMessageId],t),e[s.id]=s}const i=e[n.id];i.hasNext=a.hasNext,i.message.offset=a.offset,i.childrenStackIds.unshift(...o.reverse())})),[(0,n.combineActions)(h.FV,h.W7).toString()]:o()(((e,t)=>{const{userId:s}=t.payload;Object.values(e).filte=s)).forEach((s=>{e[s.id]=R(e[s.id],t)}))}))},{});function N(e,t,s,n){const a=l.En({id:s.id,message:{...s,isNew:!0,isMine:!0}});for(const t of Object.values(e))t.isPostCommentActionEnabled=!1;if(e[s.id]=a,!t&&!(0,b.l)(s)){const t=e[s.parentMessageId];t&&(n||(a.isPostCommentActionEnabled=!0),t.isAggregated&&(a.isAggregated=!0),t.childrenStackIds.unshift(s.id),t.message.repliesCount++)}if(a){e[s.id]=a;const{message:{tempMessageId:n}}=a;if(t&&n&&(e[n]=a),!(0,b.l)(s)){const t=e[s.parentMessageId];t&&C(t.childrenStackIds,s.tempId,s.id)}}}var L=(0,n.handleActions)({[(0,n.combineActions)(h.jm,h.aI,h.Np,h.EQ,h.rd,I.W4.fulfilled.type)]:o()(((e,t)=>{if(t.type===h.jm&&t.payload.ingoreComments)return e;e.messages=k(e.messages,t);const s=O(e.rootOrder.filtet))),t);if(0===s.length&&e.aggregatedMessage.length>0)for(let t=0;t<e.aggregatedMessage.length;t++){const n=e.aggregatedMessage[t];if(e.messages[n]&&(0,b.l)(e.messages[n]))return s.push(n),void e.aggregatedMessage.splice(t,1)}e.rootOrder=s})),[h.bx]:o()(((e,t)=>{const{shouldAggregate:s,messagesStack:n,forceNonCommentsOnInit:a,hasNext:o}=t.payload;n.forEach((t=>{0===t.message.depth?(function(t){return s&&!t.message.featuredComment&&(e.rootOrder.length>0||0===e.rootOrder.length&&o)}(t)?(t.isAggregated=!0,e.aggregatedMessage.push(t.id)):function(t){const s=Z({list:e},t);(!t.message.user.isMuted||s>0)&&e.rootOrder.unshift(t.id)}(t),t.isLastMessage=!0):function(t){const s=e.messages[t.message.parentMessageId];if(s){const n=s.message;t.message.depth=n.depth+1,t.message.replyToDisplayName=n.userDisplayName||n.user.displayName,t.message.replyToUsername=n.user.username,s.isLastMessage=!1,s.isAggregated&&!a&&(t.isAggregated=!0,e.aggregatedMessage.push(t.id)),s.childrenStackIds.push(t.id)}}(t),e.messages={...e.messages,[t.id]:t}}))})),EDIT_MESSAGE:o()(((e,t)=>{e.messages[t.payload.message.id]=t.payload.message})),[(0,n.combineActions)(h.jk,h.ON).toString()]:{next:o()(((e,t)=>{const s=t.payload.message.id;e.messages[s]=R(e.messages[s],t)})),throw:o()(((e,t)=>{const s=t.payload.message.id;e.messages[s]=R(e.messages[s],t)}))},[(0,n.combineActions)(m.m,p.G,h.s$,h.Ui,d.A6,u.fF,h.Lk,h.FV,h.W7,h.WX,h.Mv).toString()]:o()(((e,t)=>{e.messages=k(e.messages,t)})),[(0,n.combineActions)(h.f6).toString()]:o()(((e,t)=>{const{message:s}=t.payload,n=c.Sf(e,s.id);if(n){const t=0===n.message.depth;if(n.childrenStackIds.length>0)n.message.deleted=!0,n.childrenStackIds.map((t=>c.gH(e,t))).forEach((e=>{e.message.replyToUsername="",e.message.replyToDisplayName="",e.message.replyToUserId=void 0}));else if(t)n.message.deleted=!0;else{const t=c.Sf(e,s.parentMessageId);t.childrenStackIds=t.childrenStackIds.filteid)),t.message.repliesCount--,delete e.messages[s.id]}}})),[_.e]:o()(((e,t)=>{const{messages:s}=t.payload;s.forEach((t=>{const s=c.Sf(e,t.id);if(s)if(s.childrenStackIds.length>0||s.hasNext)s.message.status=r.MessageStatus.Blocked,e.messages[t.id].message.published=!1,s.childrenStackIds.map((t=>c.gH(e,t))).forEach((e=>{e.message.replyToUsername="",e.message.replyToDisplayName="",e.message.replyToUserId=void 0}));else{var n,a,o;const c=null==e||null===(n=e.messages)||void 0===n||null===(a=n[t.id])||void 0===a||null===(o=a.message)||void 0===o?void 0:o.parentMessageId;var i;if(c)(null==e||null===(i=e.messages)||void 0===i?void 0:i[c]).message.repliesCount--,e.messages[t.id].message.status=r.MessageStatus.Blocked,e.messages[t.id].message.published=!1;else s.message.status=r.MessageStatus.Blocked,e.messages[t.id].message.published=!1}}))})),[g.a]:o()(((e,t)=>{const{messages:s}=t.payload;s.forEach((t=>{const s=c.Sf(e,t.id);if(s)if(s.childrenStackIds.length>0||s.hasNext)s.message.deleted=!0,s.childrenStackIds.mat))).forEach((e=>{e.message.replyToUsername="",e.message.replyToDisplayName="",e.message.replyToUserId=void 0}));else{const{parentMessageId:n}=e.messages[t.id].message;n?(e.messages[n].message.repliesCount--,e.messages[t.id].message.deleted=!0):s.message.deleted=!0}}))}))},c.$K());const D={list:c.$K(),transferredFromAggregatedStackIds:[],pagination:E(),scrollTo:!1,isPostCommentActionEnabled:!1,messageIdsPostedThisSession:[]},P=(0,n.handleActions)({[I.LM.type]:o()((e=>{e.pagination=E(),e.list=c.$K()})),[I.Bg.type]:o(d})),[I.W4.rejected.type]:o()(((e,t)=>{(0,S.D_)(t.error)||(e.loadingSource=void 0)})),[h.jm]:o()(((e,t)=>{const{pagination:s,scrollToComments:n=!1,ignoreComments:a}=t.payload;a||(e.list=L(e.list,t),e.pagination=E(s),e.scrollTo=n)})),[h.Cr]:e=>({...e,...D}),[I.W4.fulfilled.type]:{next:o()(((e,t)=>{const{pagination:s,scrollToComments:n=!1}=t.payload,a=s.sortBy!==e.pagination.sortBy?c.$K():e.list;e.list=L(a,t),e.pagination=E(s),e.scrollTo=n,e.loadingSource=void 0}))},[h.rd]:o()(((e,t)=>{e.list=L(e.list,t)})),[f.D]:o()((e=>{const t=c.WW(e.list),s=Math.min(y.KZ,t.length),n={...e.list.messages};Object.keys(n).forEach((e=>{const s=t.some((t=>t.id===e));n[e].isAggregated=s}));for(let n=0;n<s;n++){const s=t[n];e.transferredFromAggregatedStackIds.push(s.id),0===s.message.depth&&e.list.rootOrder.unshift(s.id),e.list.aggregatedMessage.shift()}})),[h.uC]:o()(((e,{payload:{currentUser:t}})=>{(0,i.isLoggedIn)(t)&&Object.values(e.list.messages).forEach((e=>{e.isPostCommentActionEnabled=!1}))})),[v.y]:o()((e=>{Object.values(e.list.messages).forEach((e=>{e.isPostCommentActionEnabled=!1})),e.isPostCommentActionEnabled=!1})),[h.aI]:o()(((e,t)=>{var s,n;e.list=L(e.list,t),e.pagination=T(e.pagination,t),e.failedMessageTemp=void 0;const a=null===(s=t.payload)||void 0===s||null===(n=s.message)||void 0===n?void 0:n.id;a&&e.messageIdsPostedThisSession.push(a)})),[h.Np]:{next:o()(((e,t)=>{const{message:s,isLoggedIn:n}=t.payload;0!==s.depth||n||(e.isPostCommentActionEnabled=!0),e.list=L(e.list,t)})),throw:o()(((e,t)=>{const{message:s,isLoggedIn:n}=t.payload;0!==s.depth||n||(e.isPostCommentActionEnabled=!1),e.list=L(e.list,t),t.payload.error&&(e.failedMessageTemp=t.payload)}))},[h.EQ]:o()(((e,t)=>{e.failedMessageTemp=void 0,e.list=L(e.list,t),e.pagination=T(e.pagination,t)})),[h.Tl]:o()(((e,t)=>{e.list=L(e.list,t)})),[h.bt]:o()(((e,t)=>{e.list.messages[t.payload.message.id].message.messageModeratingStage=r.MessageModeratingStages.LOADING})),[h.nA]:o()(((e,t)=>{e.list.messages[t.payload.message.id].message.messageModeratingStage=r.MessageModeratingStages.FINISHED,e.list.messages[t.payload.message.id].message.status=r.MessageStatus.Blocked,e.list.messages[t.payload.message.id].message.published=!1})),[h.sx]:o()(((e,t)=>{e.list.messages[t.payload.message.id].message.messageModeratingStage=r.MessageModeratingStages.FAILED,e.list.messages[t.payload.message.id].message.messageModeratingVerdict=r.MessageModeratingVerdict.REJECT})),[(0,n.combineActions)(d.A6,u.fF,g.a,_.e,h.f6,h.Lk).toString()]:o()(((e,t)=>{e.list=L(e.list,t)})),[(0,n.combineActions)(h.jk,h.ON).toString()]:{next:o()(((e,t)=>{e.list=L(e.list,t)})),throw:o()(((e,t)=>{e.list=L(e.list,t)}))},[h.UY]:o()(((e,t)=>{e.list.messages[t.payload.messageId].message.messageModeratingStage=r.MessageModeratingStages.LOADING})),[h.zD]:o()(((e,t)=>{e.list.messages[t.payload.messageId].message.messageModeratingStage=r.MessageModeratingStages.FINISHED,e.list.messages[t.payload.messageId].message.status=r.MessageStatus.Approved})),[h.ug]:o()(((e,t)=>{e.list.messages[t.payload.messageId].message.messageModeratingStage=r.MessageModeratingStages.FAILED,e.list.messages[t.payload.messageId].message.messageModeratingVerdict=r.MessageModeratingVerdict.APPROVE})),[h.nz]:o()(((e,t)=>{e.list.messages[t.payload.messageId].message.status=r.MessageStatus.Pending,e.list.messages[t.payload.messageId].message.tags=[y.Xw.Appeal]})),[(0,n.combineActions)(h.Ui,h.s$,m.m,p.G,h.FV,h.W7,h.WX,h.Mv).toString()]:o()})),[h.PJ]:o()(((e,{payload:t})=>{e.showReportMessageModal=t})),[h.bx]:o()(((e,t)=>{e.list=L(e.list,t),e.pagination=T(e.pagination,t)})),[h.QR]:o()(((e,{payload:t})=>{const s=e.list.rootOrder.indexOf(t.id);s>-1&&e.list.rootOrder.splice(s,1),e.list.rootOrder.unshift(t.id),e.list.messages[t.id].message.featuredComment="top"})),[h.gF]:o()(((e,{payload:{messages:t}})=>{t.forEact}))})),[h.vz]:o()(((e,{payload:t})=>{e.list.messages[t.id].message.featured=!0})),[h.ow]:o()(((e,{payload:t})=>{"top"===t.featuredComment?(e.list.messages[t.id].message.featuredComment="",e.list.messages[t.id].message.featured=!0):e.list.messages[t.id].message.featured=!1})),[h.aw]:o()(((e,{payload:t})=>{for(const t in e.list.messages)"top"===e.list.messages[t].message.featuredComment&&(e.list.messages[t].message.featuredComment="");const s=e.list.rootOrder.indexOf(t.id);e.list.rootOrder.splice(s,1),e.list.rootOrder.unshift(t.id),e.list.messages[t.id].message.featuredComment="top",e.list.messages[t.id].message.featured=!0}))},D);function U(e,t){const s=l.e6(t).mat))).filteed)).length;return l.KQ(t)-s}function Z(e,t){let s=0;const n=function(e){return e.list}(e),a=c.Sf(n,l.FC(t).rootMessageId);return a&&(s=l.KQ(a)),s}},68:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>Ce,f$:()=>Re,IZ:()=>we,FZ:()=>Me,pX:()=>ke,GJ:()=>Ne,tq:()=>Ae,nK:()=>Oe});var n=s(1396),a=s(326),o=s.n(a),i=s(5766),r=s(1776),c=s.n(r),l=s(374),d=s(221);let u;!function(e){e.LIKED_MESSAGE="liked-message",e.REPLIED_YOUR_MESSAGE="replied-your-message",e.ALSO_REPLIED="also-replied",e.MENTION="user-mentioned"}(u||(u={}));const m={items:{},order:[],isLoading:!1,unseenCount:0,unreadCount:0,totalCount:0,isLoaded:!1};var p=(0,i.handleActions)({[d.nl]:c()(((e,t)=>{t.payload.isLoaded||Object.assign(e,m),e.isLoaded=t.payload.isLoaded})),[d.rM]:c()((e=>{e.isLoading=!0})),[d.q_]:c()(((e,t)=>{const{unseenCount:s,unreadCount:n,totalCount:a,notifications:o=[],reset:i=!1,offset:r=0}=t.payload;i&&Object.assign(e,m),null!=s&&(e.unseenCount=s),null!=n&&(e.unreadCount=n),null!=a&&(e.totalCount=a),e.isLoading=!1,0===r&&o.reverse();for(const t of o)e.items[t.id]||(0===r?e.order.unshift(t.id):e.order.push(t.id)),e.items[t.id]=g(t)})),[d.SR]:c()((e=>{for(const t of Object.values(e.items))t.read=!0})),[d.hR]:c()(((e,t)=>{const{id:s}=t.payload,n=e.items[s];n&&(n.read=!0)})),[d.sA]:c()(((e,t)=>{const{unseenNotificationsCount:s}=t.payload;e.unseenCount=s}))},m);function g(e){const t={read:!1,updatedAt:new Date,conversationId:void 0,conversationUrl:void 0,conversationTitle:void 0,spotId:void 0,userId:void 0,messageId:void 0,users:{},message:void 0,totalCount:0,...e};return t.users=(0,l.po)(e.users),t}var f=s(1326),y=s(8994),h=s(3191),v=s(5002),_=(0,i.handleActions)({[v._]:(e,{payload:t})=>({...e,isMobile:t.isMobile,isMobileUA:t.isMobileUA})},{isMobile:!1,isMobileUA:!1}),E=s(1293),I=s(5529),S=s(3225);var b=(0,i.handleActions)({FETCH_AUTHENTICATION_STA}),[S.P]:(e,{payload:{networkId:t,token:s}})=>(""===t&&(t="spotim"),{...e,networkId:t,token:s,status:{isLoading:!1,hasData:!0}})},{status:{isLoading:!1,error:void 0,hasData:!1},networkId:void 0,token:void 0}),T=s(6733),C=(0,i.handleActions)({[T.TP]:(e,{payload:{parentMessageId:t}})=>({...e,isLoading:!0,rootMessageId:t}),[T.A6]:(e,{payload:{parentMessage:t}})=>({...e,isLoading:!1,rootMessageId:t.id})},{rootMessageId:null,isLoading:!1}),w=s(6711),A=s(9458),O=s(5812),R=s(1292),M=s(7241),k=s(5128);const N=A.Oo();var L=(0,i.handleActions)({[R.jm]:(e,{payload:t})=>A.Oo({...N,...t.conversation,starRatingSummary:t.starRatingSummary,defaultPolicy:e.defaultPolicy}),[R.Cr]:()=>N,[k.W4.fulfilled.type]:(e,{payload:{conversation:t}})=>A.Oo({...e,...t}),[R.aI]:c()(((e,t)=>{const{message:s}=t.payload;(0,w.l)(s)?e.isSubmittingComment=!0:(e.isSubmittingReply=!0,e.submittedReplyParentMessageId=s.parentMessageId)})),[R.Np]:c()(((e,t)=>{const{message:s,isRetry:n,isStrictModeEnabled:a}=t.payload;n||((0,O.VN)(s)||e.messagesCount++,(0,w.l)(s)&&e.commentsCount++,s.starsRating>0&&(0,M.x)(e,s.starsRating)),e.hasCommented=!0,(0,w.l)(s)?e.isSubmittingComment=!1:(e.isSubmittingReply=!1,e.submittedReplyParentMessageId=s.parentMessageId),e.isStrictModeEnabled=a})),[(0,i.combineActions)(R.yf,R.kn).toString()]:c()(((e,t)=>{const{message:s}=t.payload;s&&((0,w.l)(s)?e.isSubmittingComment=!1:(e.isSubmittingReply=!1,delete e.submittedReplyParentMessageId))})),[R.Ol]:c()(((e,t)=>{e.isSubmittingReply=!1,delete e.submittedReplyParentMessageId})),[(0,i.combineActions)(R.f6,R.bt).toString()]:c()(((e,t)=>{const{message:s}=t.payload;if(s.starsRating>0){e.starsRatingCount-=1,e.averageStarsRating=e.starsRatingCount?(e.averageStarsRating*e.starsRatingCount+1-s.starsRating)/e.starsRatingCount:null;const t=e.averageStarsRating||0*e.starsRatingCount,n=e.starRatingSummary.total*e.starRatingSummary.average,a=e.starRatingSummary.total+e.starsRatingCount;e.starRatingSummary.average=(t+n)/a}e.messagesCount--,0===s.depth&&e.commentsCount--})),[(0,i.combineActions)(R.gL,R.nA).toString()]:(e,{payload:{conversation:t,starsRating:s}})=>A.$2(A.Oo({...e,...t}),s),[R.jk]:(e,{payload:{conversation:t,message:s}})=>A.Oo({...e,...t,isSubmittingEdit:!0,editedMessageId:s.id}),[R.ON]:(e,{payload:{conversation:t}})=>A.Oo({...e,...t,isSubmittingEdit:!1,editedMessageId:void 0}),[R.wB]:(e,{payload:{averageStarsRating:t,starsRatingCount:s}})=>A.Oo({...e,averageStarsRating:t,starsRatingCount:s}),[R.bx]:(e,{payload:{conversation:t}})=>A.Oo({...e,...t}),[R.eo]:c()(((e,t)=>{const{defaultPolicy:s}=t.payload;e.defaultPolicy=s})),[R.Hz]:c(s})),[R.vU]:c()(((e,t)=>{e.messagesCount=t.payload.replies+t.payload.comments,e.commentsCount=t.payload.comments})),[R.Js]:c()(((e,t)=>{e.isSettingCommunityQuestion=t.payload.isSettingCommunityQuestion})),[R.Y8]:c(e}))},N),D=s(2),P=s(9810),U=s(1883),Z=s(8178),x=s(1677),$=s(523),V=(0,i.handleActions)({[R.aI]:{next:(e,{payload:{message:t}})=>({...e,isStarsRatingFailed:!1})},[R.Np]:{next:(e,{payload:{message:t}})=>null!=t&&t.parentMessageId?e:{...e,starsRating:0,isMessageBlocked:!1,isModerationAlertVisible:!1,verdict:"",tempMessageId:null,isStarsRatingFailed:!1}},[R.Ug]:{next:(e,{payload:{starsRating:t}})=>({...e,starsRating:t})},[R.WA]:{next:(e,{payload:{message:t}})=>({...e,isStarsRatingFailed:!0})},[R.OB]:{next:(e,{payload:{parentMessageId:t}})=>t||!e.isMessageBlocked?e:{...e,isModerationAlertVisible:!1}},[R.yf]:{next:(e,{payload:{message:t,taggers:s,verdict:n,tempId:a,isEligibleForRephrasing:o}})=>null!=t&&t.parentMessageId?e:{...e,isMessageBlocked:!0,isModerationAlertVisible:!0,moderationTags:s,verdict:n,tempMessageId:a,isEligibleForRephrasing:o}},[R.BZ]:{ne})},[R.BJ]:{next:(e,{payload:{error:t,parentMessageId:s,tags:n,verdict:a}})=>{if(s||t||e.isMessageBlocked)return e;const o=Z.io(a,n),i={isModerationAlertVisible:o,moderationTags:o?n:[],verdict:o?a:null};return{...e,...i}}},[(0,i.combineActions)(R.kn,R.TJ)]:{next:(e,{payload:{isUserSuspended:t,verdict:s,moderationTags:n}})=>({...e,verdict:t?s||$.$.BLOCK_ALL:null,moderationTags:t?n||[x.J.SUSPENDED]:[],isMessageBlocked:t,isModerationAlertVisible:t})}},{starsRating:0,isMessageBlocked:!1,isModerationAlertVisible:!1,isModerationAlertRendered:!1,moderationTags:[],verdict:null,tempMessageId:null,isStarsRatingFailed:!1});const F={settings:{isModerationAlertRendered:!1,isUserSuspended:!1}};var B=(0,i.handleActions)({[R.jm]:{next:(e,{payload:{highlight:t={}}})=>{let s=F;const{id:n,isSayControlExpanded:a}=t;return!0===a&&(s={...s,[n]:G()}),s}},[R.Cr]:()=>F,[R.FO]:{next:(e,{payload:{messageId:t}})=>{let s={...e[t]};s&&!s.isCreate?s.isCreate=!0:s=G({isCreate:!0},e.settings.isUserSuspended);const n={...e};return n[t]=s,n}},[R.nI]:(e,{payload:{messageId:t,starsRating:s}})=>{let n=e[t];return n=n?{...n,starsRating:s,isEdit:!0}:G({starsRating:s,isEdit:!0}),{settings:e.settings,[t]:n}},[R._Z]:(e,{payload:{starsRating:t,messageId:s}})=>(e[s]={...e[s],starsRating:t},{...e}),[R.aI]:(e,{payload:{message:t=null}})=>{const s={...e};if(t&&t.parentMessageId){let n=e[t.parentMessageId];n||(n=G()),n.isCreate=!0,s[t.parentMessageId]=n}return s},[R.ON]:(e,{payload:{messageId:t}})=>({settings:{...e.settings,isModerationAlertRendered:!1}}),[R.YK]:(e,{payload:{messageId:t}})=>{const{[t]:s,...n}=e;return n},[R.Ol]:(e,{payload:{messageId:t}})=>{const{[t]:s,...n}=e;return n},[R.Np]:(e,{payload:{message:t}})=>{const{parentMessageId:s}=t;if(!s)return e;const{[s]:n,...a}=e;return a},[k.W4.fulfilled.type]:{next:(e,{payload:{highlight:t={}}})=>{const s={...e},{id:n,isSayControlExpanded:a}=t;!0===a&&(s[n]=G());const{settings:o,...i}=s;return{settings:o,...Object.entries(i).reduce(((e,[t,s])=>(e[t]={...s,isCreate:!1,isEdit:!1,isMessageBlocked:!1,isModerationAlertVisible:!1,moderationTags:[],verdict:null,tempMessageId:null},e)),{})}}},[R.yf]:{next:(e,{payload:{message:t,taggers:s,verdict:n,isEligibleForRephrasing:a,tempId:o}})=>{const i={...e};if(t&&t.parentMessageId){let r=e[t.parentMessageId];r||(r=G()),r.isMessageBlocked=!0,r.isCreate=!0,r.isModerationAlertVisible=!0,r.moderationTags=s,r.isEligibleForRephrasing=a,r.verdict=n,r.tempMessageId=o,i[t.parentMessageId]=r}return i}},[R.OB]:{next:(e,t)=>{const{parentMessageId:s}=t.payload,n={...e};if(s){let t=e[s];t||(t=G()),t.isModerationAlertVisible=!1,n[s]=t}return n}},[R.BZ]:{next:(e,t)=>{const s={...e.settings,isModerationAlertRendered:!0};return{...e,settings:s}}},[R.BJ]:{next:(e,{payload:{error:t,parentMessageId:s,tags:n,verdict:a}})=>{if(t||e.isMessageBlocked||e.settings.isUserSuspended)return e;const o=Z.io(a,n),i={...e};if(s){let t=e[s];t||(t=G()),t.isModerationAlertVisible=o,t.moderationTags=o?n:[],t.verdict=o?a:null,i[s]=t}return i}},[(0,i.combineActions)(R.kn,R.TJ)]:{next:(e,{payload:{isUserSuspended:t,verdict:s,moderationTags:n}})=>{const a={...e.settings,isUserSuspended:t};return{...t?Object.keys(e).filte=e)).reduce(((t,a)=>({...t,[a]:{...e[a],isMessageBlocked:!0,isModerationAlertVisible:!0,moderationTags:n||[x.J.SUSPENDED],verdict:s||$.$.BLOCK_ALL}})),{}):e,settings:a}}}},F);function G(e={},t=!1){return{starsRating:0,isEdit:!1,isCreate:!1,isMessageBlocked:t,isModerationAlertVisible:t,moderationTags:t?[x.J.SUSPENDED]:[],verdict:t?$.$.BLOCK_ALL:null,tempMessageId:null,...e}}var W=s(1167),q=(0,i.handleActions)({[W.y]:e=>({...e,enabled:!1}),[R.uC]:(e,{payload:{currentUser:t}})=>({...e,enabled:!(0,y.jl)(t)}),[R.aI]:(e,{payload:{message:t,isLoggedIn:s}})=>({...e,enabled:(0,w.l)(t)&&s})},{enabled:!1}),H=s(5507);const j="none",K="error",J={verifyEmailSent:!1,emailSignupUser:null,emailSignupStatus:j,emailSignupErrorType:null,username:null,usernameAvailable:!1,usernameSuggestions:[],usernameLoading:!1};var z=(0,i.handleActions)({[H.gN]:{next:e=>({...e,verifyEmailSent:!0})},[H._V]:{next:e=>({...e,usernameLoading:!0})},[H.i5]:{next:(e,{payload:{username:t,isAvailable:s,suggestions:n}})=>({...e,usernameLoading:!1,username:t,usernameAvailable:s,usernameSuggestions:n}),thr})},REQUEST_SET_CURRENT_USER_EMAIL_SIGNUP:{ne})},RESPONSE_SET_CURRENT_USER_EMAIL_SIGNUP:{next:(e,{error:t,payload:{currentUser:s,error:n}})=>(t?(e.emailSignupStatus=K,e.emailSignupErrorType=n):(e.emailSignupStatus="success",e.emailSignupUser=s),{...e}),throw:(e,{payload:{error:t}})=>({...e,emailSignupStatus:K,emailSignupErrorType:t&&t.body&&t.body.type||""})},SET_CURRENT_USER_RESET:{next:e=>({...e,emailSignupStatus:j,emailSignupErrorType:null,currentUser:null})}},J);function Q(e={}){return{isExpanded:!1,segments:[],...e}}function Y(e,t){const s=JSON.parse(JSON.stringify(e));return s.segments[t-1]++,s}const X=Q();var ee=(0,i.handleActions)({[R.aI]:{next:(e,{payload:{message:{starsRating:t}}})=>t>0?Y(e,t):e},[R.jk]:{next:(e,{payload:{message:{oldStarsRating:t,starsRating:s}}})=>function(e,t){const s=JSON.parse(JSON.stringify(e));return s.segments[t-1]--,s}(Y(e,s),t)},[R.wB]:{next:(e,{payload:{segments:t,isExpanded:s}})=>Q({...e,segments:t,isExpanded:s})}},X),te=s(6264),se=s(2408);const ne={conversationId:null,loading:!1,users:[],error:null,offset:0,count:0};var ae=(0,i.handleActions)({[R.as]:{ne})},[R.KM]:{next:(e,{payload:{offset:t,conversationId:s}})=>({...e,conversationId:s,loading:!0,users:0===t?[]:e.users,offset:t})},[R.z]:{next:(e,{payload:{conversationId:t,users:s,offset:n,count:a}})=>{s=s.map(se.ap);let o=e.users;return 0===n?o=s:s.length>0&&(o=(0,te.Z)(o,s,"id")),{...e,conversationId:t,loading:!1,users:o,offset:n,count:a}},throw:e=>({...e,loading:!1,conversationId:null,users:[]})},[R.O1]:{next:(e,{payload:t})=>({...e,users:e.users.filte=t))})}},ne),oe=s(6480),ie=s(2282),re=s(6506),ce=s(9236),le=s(3368),de=s(7513),ue=(0,i.handleActions)([R.jm,R.Cr,R.lI,R.t7,T.TP,T.gk,de.uh,R.aI,R.Np,R.EQ,R.f6,R.gL,R.bt,R.nA,R.jk,R.ON,R.R9,R.Lk,R.bx,oe.m,ie.G,re.a,ce.e,R.u3,R.ZQ,R.nI,R.YK,le.D,R.Ug,"SCROLL_HOST_START","SCROLL_HOST_STOP",R.wB,R.KM,R.z,H.uw,H.gN,k.W4.rejected.type].reduce(((e,t)=>(e[t]=function(e){return{throw:(t,{payload:{error:s}})=>(console.log("ERROR",e,s),[...t,s]),ne>e}}(t),e)),{}),[]),me=s(7175),pe=(0,i.handleActions)({[R.lI]:(e,{payload:{moduleOptions:t}})=>t,[R._l]:(e,{payload:{moduleOptions:t}})=>({...e,...t})},{}),ge=(0,i.handleActions)({[R.TJ]:c()(((e,{payload:{isUserSuspended:t,expirationTime:s}})=>{e.isFetched=!0,e.isUserSuspended=t,s&&(e.expirationTime=new Date(1e3*s).toLocaleDateString())})),[R.kn]:c(0}))},{isFetched:!1}),fe=(0,i.handleActions)({[R.e4]:c()((e=>{e.preloadConversation=!0})),[R.gu]:c()(((e,{payload:t})=>{e.scrollToHeader=t})),[R.LG]:c(t}))},{preloadConversation:!1,focusSayControlOnSwitchTab:!1,scrollToHeader:!1}),ye=(0,i.handleActions)({[R.HM]:c()(((e,{payload:t})=>{t?e.blockAndDeleteLoading=!0:e.blockOnlyLoading=!0})),[R._6]:c()((e=>{e.blockOnlyLoading=!1,e.blockAndDeleteLoading=!1,e.blockUserFailed=!0})),[R.xU]:c(0}))},{blockOnlyLoading:!1,blockAndDeleteLoading:!1,blockUserFailed:!1,isSuccess:!1}),he=s(3179),ve=s(2121),_e=s(2223),Ee=s(6492),Ie=s(3327),Se=s(3930);const be=o().get("tenant_config.conversation.aggregate_all",!0);let Te=!1;try{Te="true"===window.localStorage.getItem("SPOTIM_FORCE_AGGREGATION")}catch(e){}function Ce(e){return(0,n.combineReducers)({authentication:b,moduleOptions:pe,errors:ue,currentUser:y.ZP,conversation:L,ui:D.Z,comments:me.DE,appState:he.ZP,readOnly:ve.ZP,richEditor:_e.Z,isWebviewMode:Ee.Z,ignoreQueryParams:Ie.Z,notifications:p,viewers:U.Z,mainSayControl:V,messageSayControls:B,postCommentAction:q,registration:z,summaryWidget:ee,loadingReplies:C,upVotesList:ae,isMobile:_,reportedComments:P.Z,userSuspension:ge,platform:f.ZP,typingUsers:h.ZP,communityView:fe,blocklistUser:ye,viewedMessages:Se.ZP,follow:E.Z,tabs:I.D,...e})}function we(e){return function(e){return e.maxMobileWidth}(e.moduleOptions)}function Ae(e){retue}(e.isMobile}function Re(e){return 0===e.comments.list.rootOrder.length&&e.comments.pagination.hasNext}function Me(e){return e.communityView.preloadConversatir}function Ne(e){return e.viewers}},3327:(e,t,s)=>{"use strict";s.d(t,{T:()=>r});var n=s(1776),a=s.n(n),o=s(5766),i=s(1292);const r=(0,o.createAction)(i.eI);t.Z=(0,o.handleActions)({[i.eI]:a()(((e,t)=>t.payload.ignoreQueryParams))},!1)},2121:(e,t,s)=>{"use strict";s.d(t,{e1:()=>r,xI:()=>c});var n=s(1776),a=s.n(n),o=s(5766),i=s(1292);const r=(0,o.createAction)(i.Mg),c=(0,o.createAction)(i.th);t.ZP=(0,o.handleActions)({[i.Mg]:a(y})),[i.th]:a()(((e,t)=>{e.expirationDate=t.payload.expirationDate||void 0}))},{enable:!1,expirationDate:void 0})},9810:(e,t,s)=>{"use strict";s.d(t,{k:()=>r});var n=s(5766),a=s(1776),o=s.n(a),i=s(129}}t.Z=(0,n.handleActions)({[i.k$]:o()(((e,t)=>{const{reportedComments:s}=t.payload;s&&Object.keys(s).forEach((t=>{e[t]=!0}))}))},{})},2223:(e,t,s)=>{"use strict";s.d(t,{s:()=>r});var n=s(1776),a=s.n(n),o=s(5766),i=s(1292);const r=(0,o.createAction)(i.vY);t.Z=(0,o.handleActions)({[i.vY]:a(0}))},{richEditorFetched:!1})},2:(e,t,s)=>{"use strict";s.d(t,{a:()=>o});var n=s(5766),a=s(1292);const o=(0,n.createAction)(a.jX);t.Z=(0,n.handleActions)({[a.j})},{signUpWizardMessageId:null})},3930:(e,t,s)=>{"use strict";s.d(t,{E0:()=>c,SF:()=>d});var n=s(2478),a=s(6423),o=s(1776),i=s.n(o),r=s(5766);const c=(0,r.createAction)("ADD_MESSAGE_TO_SENT"),l=(0,r.handleActions)({[c.toString()]:i()}))},{viewedMessagesList:[]}),d=(e,t)=>{const s=(0,a.default)(e,"viewedMessages.sentMessageIds");return(0,n.Z)(s,t)};t.ZP=l},1883:(e,t,s)=>{"use strict";s.d(t,{X:()=>a});var n=s(5766);const a=(0,n.createAction)("REALTIME_VIEWERS_UPDATE");t.Z=(0,n.handleActions)({REALTIME_VIEWERS_UPDAad},null)},6492:(e,t,s)=>{"use strict";s.d(t,{v:()=>r});var n=s(1776),a=s.n(n),o=s(5766),i=s(1292);const r=(0,o.createAction)(i.Ox);t.Z=(0,o.handleActions)({[i.Ox]:a(de))},!1)},5216:(e,t,s)=>{"use strict";s.d(t,{ix:()=>n,su:()=>a,zc:()=>o});const n=s(5281).useSelector;let a,"}(a||(a={}"}(o||(o={}))},7241:(e,t,s)=>{"use strict";s.d(t,{o:()=>i,x:()=>a});const n=e=>"number"==typeof e.starsRating&&e.starsRating>0,a=(e,t)=>{e.starsRatingCount+=1,e.averageStarsRating=(e.averageStarsRating*(e.starsRatingCount-1)+t)/e.starsRatingCount;const s=e.averageStarsRating*e.starsRatingCount,n=e.starRatingSummary.total*e.starRatingSummary.average,a=e.starRatingSummary.total+e.starsRatingCount;e.starRatingSummary.average=(s+n)/a},o=(e,t)=>(a(e,t.starsRating),e),i=(e,t)=>{const s=t.filter(n);return s.length?s.reduce(o,(({starRatingSummary:e,...t})=>({...t,starRatingSummary:{...e}}))(e)):e}},4370:(e,t,s)=>{"use strict";s.d(t,{Z:()=>_});var n=s(2729),a=s(7211),o=s(5812),i=s(9910),r=s(784),c=s(218);const l=["count","child_count","offset","depth"],d=e=>(e=>{const{has_next:t,offset:s,sort_by:n,messages_count:a,users:r,comments:c,conversation_id:l}=e,d={hasNext:t,offset:s,sortBy:n},{comments:u}=(0,o.kW)(l,{comments:(0,i.z)(c),users:r});return{pagination:d,comments:u,messagesCount:a,users:r}})(e.conversation),u={id:n.m.All,dataParser:d,endpoint:"conversation/read",sortItems:[r.xO,a.h.NEWEST,a.h.OLDEST],getPaylo])},m={id:n.m.AllNewest,dataParser:d,endpoint:"conversation/read",getPayload:e=>({...(0,c.p6)(e,[...l,"conversation_id"]),sort_by:a.h.NEWEST})},p={id:n.m.AllOldest,dataParser:d,endpoint:"conversation/read",getPayload:e=>({...(0,c.p6)(e,[...l,"conversation_id"]),sort_by:a.h.OLDEST})},g={id:n.m.Featured,dataParser:d,endpoint:"conversation/tab/featured",sortItems:[a.h.NEWEST,a.h.OLDEST],getPaylo])},f={id:n.m.MostDiscussed,dataParser:d,endpoint:"conversation/tab/most-discussed",getPayload:e=>(0,c.p6)(e,l)},y={id:n.m.Popular,dataParser:d,endpoint:"conversation/tab/popular",getPayload:e=>(0,c.p6)(e,l)},h={id:n.m.Controversial,dataParser:d,endpoint:"conversation/tab/controversial",getPaylol)},v={id:n.m.MyMessages,dataParser:e=>{const{cursor:t,conversation_id:s,messages:n,users:a}=e,{has_next:r,offset:c,sort_by:l}=t,d={hasNext:r,offset:c,sortBy:l},{comments:u}=(0,o.kW)(s,{comments:(0,i.z)(n),users:a});return{pagination:d,comments:u,messagesCount:0,users:a}},endpoint:"",sortItems:[a.h.NEWEST,a.h.OLDEST]};function _(e){switch(e){case n.m.All:return u;case n.m.AllNewest:return m;case n.m.AllOldest:return p;case n.m.MyMessages:return v;case n.m.Featured:return g;case n.m.MostDiscussed:return f;case n.m.Popular:return y;case n.m.Controversial:return h}}},5128:(e,t,s)=>{"use strict";s.d(t,{W4:()=>T,Bg:()=>b,mp:()=>S,LM:()=>_,r7:()=>E,W_:()=>I});var n=s(9829),a=s(146),o=s(4186),i=s(784),r=s(6967),c=s(9400),l=s(7724),d=s(5482),u=s(4836);const m=new cla};var p=s(5529),g=s(7089),f=s(218),y=s(2729),h=s(4370);const v=10,_=(0,n.createAction)("tabs/reset-messages-data"),E=(0,n.createAsyncThunk)("tabs/set-active-tab",(function(e,{dispatch:t,getState:s}){const n=s(),a=(0,g.B2)(n);if(!a)throw new Error("Unable to set active tab for uninitialized tabs instance");t(T({tabId:e,source:"tab-switch",pageSize:(0,c.E)()})),(0,g.ec)(n)!==e&&((0,f.$D)(n,a,e),t(p.B.setActiveTabId(e)))})),I=(0,n.createAsyncThunk)("tabs/set-default-tab-as-active",(function(e,{dispatch:t,getState:s}){const n=s(),{tabs:{activeTabId:a,defaultTabId:o}}=n;a!==o&&t(E(o))})),S=(0,n.createAsyncThunk)("tabs/initialize-tabs",(async function(e,{getState:t,dispatch:s}){const n=t(),{postId:a}=n.moduleOptions,o=(0,f.mY)(a,n.currentUser.id);let i;try{i=awa)}(a)}catch(e){return console.error("[TABS]Unable to initialize tabs",e),{initialized:!0,activeTabId:y.m.All,instanceId:o}}const{tabs:r}=i,l=r.filter((({id:e})=>void 0!==(0,h.Z)(e))),d=(0,f.DU)(l,y.m.All),m=(0,f.DU)(l,y.m.AllNewest);d||m||console.error("[TABS]Unable to initialize tabs, missing default tab");const p=d?y.m.All:y.m.AllNewest,g=(0,f.MB)(n,o,p),v=(0,f.rD)(l,g)?g:p;return(0,f.V6)(v)||(s(_()),s(T({tabId:v,source:"tab-switch",pageSize:(0,c.E)(),instanceId:o}))),{instanceId:o,tabsList:l,activeTabId:v,initialized:!0,defaultTabId:p}})),b=(0,n.createAction)("tabs/fetch-start"),T=(0,n.createAsyncThunk)("tabs/fetch-messages",(async function(e,{dispatch:t,getState:s}){o.q.apm.start("fetch_conversation");const{currentUser:{id:n,isRegistered:c},comments:{list:{aggregatedMessage:p},pagination:{sortBy:g,offset:_}},moduleOptions:{shouldCollapseReplies:E,postId:I,conversationId:S},tabs:{activeTabId:T,instanceId:C}}=s(),{tabId:w=T||y.m.All,source:A,pageSize:O=v,sortBy:R,instanceId:M}=e,k=E?1:2,N=(0,h.Z)(w),L=C||M,D=R||("load-more"===A?g:(0,f.a2)(L,w,c)),{endpoint:P,getPayload:U,dataParser:Z}=N,x="tab-switch"===A,$="sorting"===A;D&&(L?(0,f.LZ)(L,w,D,c):(0,d.l)(D)),t(b(A));const V=x||$?0:_,F={conversation_id:S,child_count:i.bI,count:O,depth:k,offset:V,sort_by:D},B=null==U?void 0:U(F);let G;try{w===y.m.MyMessages?(G=await function(e){const{postId:t,conversationId:s,count:n,offset:a,sort_by:o,depth:i}=e,r={count:n.toString(),offset:a.toString(),sort_by:o,depth:i.toString()},c=new URLSearchParams(r).toString();return m.abort(),(0,u.Z)(`v1.0.0/profile/my-messages/${s}?${c}`,{postId:t,signal:m.signal})}({conversationId:S,count:O,offset:V,postId:I,sort_by:D||i.xO,userId:n,depth:k}),G.conversation_id=S):((0,a.assertIsDefined)(B),G=await function(e,t,s){return m.abort(),(0,u.Z)(`v1.0.0/${t}`,{method:"POST",postId:e,signal:m.signal,data:s})}(I,P,B))}catch(e){if(e instanceof Error)return(0,l.D_)(e)||function(e,t){let s="";switch(t){case"load-more":s="fetchConversation_showMoreComments";break;case"sorting":s="fetchConversation_sortingChange";break;case"tab-switch":s="fetchConversation"}o.q.error(s,e)}(e,A),Promise.reject(e)}const{comments:W,users:q,pagination:H,messagesCount:j}=Z(G);(0,r.x)(c,q,t),o.q.apm.end("fetch_conversation");const K=W.filted)));H.sortBy=D;let J=window.localStorage.getItem(i.QJ.ReportedComments);return J=J&&JSON.parse(J),{comments:K,pagination:H,messagesCount:j,shouldReloadComments:x,reportedComments:J,resolvedTabId:w}}))},5641:(e,t,s)=>{"use strict";s.d(t,{Jy:()=>c,N6:()=>o,Vt:()=>l,h3:()=>d,hU:()=>r,yh:()=>i,zo:()=>u});var n=s(7211),a=s(2729);const o="tenant_config.conversation.enable_tabs",i="OW-ACTIVE-TAB",r="OW-TAB-SORT",c=[a.m.All,a.m.AllNewest],l=[a.m.All,a.m.AllNewest,a.m.AllOldest],d=[a.m.AllNewest,a.m.AllOldest],u={[a.m.AllNewest]:n.h.NEWEST,[a.m.AllOldest]:n.h.OLDEST}},7089:(e,t,s)=>{"use strics}function a(e){return n(e).initialized}function o(e){return n(e).instanceId}function i(e){return n(e).tabsLid}s.d(t,{B2:()=>o,YI:()=>i,cp:()=>a,ec:()=>r})},5529:(e,t,s)=>{"use strict";s.d(t,{B:()=>l,D:()=>c});var n=s(9829),a=s(5128);const o={initialized:!1,instanceId:null,tabsList:[],activeTabId:null,resolvedTabId:null,defaultTabId:s(2729).m.All},i={setActiveTad}},r=(0,n.createSlice)({name:"tabs",initialState:o,reducers:i,extraReducers:function(e){e.addCase(a.mp.fulfille)})).addCase(a.W4.fulfilled,((e,t)=>{const s=e.tabsList.finId));s&&(s.count=t.payload.messagesCount,e.resolvedTabId=t.payload.resolvedTabId)}))}}),c=r.reducer,l=r.actions},27)},218:(e,t,s)=>{"use strict";s.d(t,{DU:()=>O,p6:()=>A,mY:()=>h,tt:()=>f,a2:()=>T,fv:()=>w,V6:()=>R,MB:()=>I,$D:()=>S,LZ:()=>C,rD:()=>v});var n=s(326),a=s.n(n),o=s(784),i=s(3367),r=s(5641),c=s(4370),l=s(5128);const d=a().get("queryParams.spot_im_highlight_immediate",!1),u=a().get("queryParams.spot_im_redirect_source",""),m=a().get("tenant_config.launcher.immediateConfig",[]),p=a().get(r.N6,!1),g={all:{key:"all",fallback:"All"},featured:{key:"featured",fallback:"Featured"},popular:{key:"popular",fallback:"Popular"},controversial:{key:"controversial",fallback:"Controversial"},most_discussed:{key:"mostDiscussed",fallback:"Most Discussed"},my_messages:{key:"myComments",fallback:"My Comments"},all_newest:{key:"allNewest",fallback:"Newest"},all_oldest:{key:"allOldest",fallback:"Oldest"}};function f(e,t,s){var n;const{key:a,fallback:o}=g[t]||{};return null!==(n=null!=s?s:e(`tabs.${a}`,o))&&void 0!==n?n}function v(e,t){return e.some((e=>e.id===t))}function _(e){return e.moduleOptions.isConversationPage||function(e){var t;if(e||!d)return!1;const s=m.finle));return!u||(null==s||null===(t=s.excludeSources)||void 0===t?void 0:t.includes(u))}(e.moduleOptions.isConversationPage}function I(e,t,s){if(_(e))return s;try{var n;return null!==(n=E(e.currentUser.isRegistered).getItem(y(t)))&&void 0!==n?n:s}catch(e){return s}}function S(e,t,s){if(!_(e))try{E(e.currentUser.isRegistered).setItem(y(t),s)}catch(e){}}function b(e,t){return`${r.hU}/${e}/${t}`}function T(e,t,s){try{if(e){const n=E(s).getItem(b(e,t));if(n)return n}}catch(e){}const n=(0,i.JR)(),r=null!=n?n:a().get("init_data.config.sort_by",o.xO),{sortItems:l}=(0,c.Z)(t)||{};if(l&&r)return l.includes(r)?r:l[0]}function C(e,t,s,n){if(e)try{E(n).setItem(b(e,t),s)}catch(e){}}async function w(e){return p&&await e((0,l.W_)()),Promise.resolve},72)},3191:(e,t,s)=>{"use strict";s.d(t,{KS:()=>y,Ni:()=>f,RN:()=>p,ZP:()=>m,xs:()=>g});var n=s(3402),a=s(6423),o=s(5304),i=s(1776),r=s.n(i);const c="typing-modules/INIT",l="typing-module/SET",d="Overall",u="NewComment";function m(e={},t){switch(t.type){case c:return{[t.payload]:{[d]:{count:0}}};case l:return r()(e,(e=>{const{conversationId:s,messagesTyping:n,currentUserId:a}=t.payload;e[s]={NewComment:{count:0,users:{}}};let i=0;(0,o.Z)(n,(t=>{const n=t.messageId||u;if(e[s][n]={count:t.count,users:{}},(0,o.Z)(t.users,(({user_id:t})=>{a===t&&(e[s][n].count-=1,i++)})),e[s][n].count>0){const o=function(e,t){let s=e.pop();return s&&s.user_id===t&&(s=e.pop()),s}(t.users,a);o&&(e[s][n].users[o.user_id]={imageId:o.image_id})}})),e[s].Overall.count-=i}));default:return }}function g(e,t=d){return(0,a.default)(e,`typingUsers["${e.conversation.id}"]["${t}"]`,{}).count||0}function f(e,t=u){return function(e,t){return(0,n.default)(e,"conversation")&&(0,n.default)(e,`typingUsers["${e.conversation.id}"]["${t}"]`)}(e,t)?function(e,t){const s=[],n=(0,a.default)(e,"conversation.id"),i=(0,a.default)(e,`typingUsers[${n}]`),r=[];return(0,o.Z)(i,((e,n)=>{t!==u&&t!==n||(0,o.Z)(e.users,((e,t)=>{e&&-1===s.indexOf(t)&&(r.push({id:t,imageId:e.imageId}),s.push(t))}))})),r}(e,t):}}},5482:(e,t,s)=>{"use strict";s.d(t,{k:()=>a,l:()=>o});var n=s(784);function a(){let e;try{e=window.localStorage.getItem(n.QJ.UserSorting)}catch(e){}return e}const o=e=>{try{window.localStorage.setItem(n.QJ.UserSorting,e)}catch(e){}}},24)},6680:(e,t,s)=>{"use strict";function n(e={}){return{id:(null==e?void 0:e.id)||(null==e?void 0:e.userId),displayName:void 0,imageId:void 0,username:void 0,isModerator:!1,isRegistered:!1,isSuperAdmin:!1,isCommunityModerator:!1,isJournalist:!1,isAdmin:!1,isFallbackUser:!1,reputation:{total:1},ssoData:{isSubscriber:void 0},email:void 0,isEmailVerified:!1,unseenNotificationsCount:void 0,notificationsCount:null==e?void 0:e.notificationsCount,messagesVoted:null==e?void 0:e.messagesVoted,location:null==e?void 0:e.location,...e}}s.d(t,{ap:()=>n}),s(1890)},374:(e,t,s)=>{"use strict";s.d(t,{h1:()=>l,nL:()=>r,po:()=>c});var n=s(1890),a=s(6680);function o(e="",t){return e.length>0&&(e+="."),function(){return{is_subscriber:`${e}isSubscriber`,...t}}}var i=s(3222);function r(e){return{...(0,n.parseUser)(e),notificationsCount:e.notifications_counter,isMuted:e.is_muted,messagesVoted:e.rank,location:e.location,isPrivate:e.is_private_profile}}function c(e){return e&&Array.isArray(e)?e.reduce(((e,t)=>(e[t.id]=(0,a.ap)(t),e)),{}):e}function l(e,t){return(0,i.I)(function(e="",t){return e.length>0&&(e+="."),function(){return{display_name:`${e}displayName`,id:`${e}id`,user_id:`${e}id`,image_id:`${e}imageId`,background_image_id:`${e}coverImageId`,about:`${e}about`,location:`${e}location`,language:`${e}language`,workplace:`${e}workplace`,interests:`${e}interests`,user_name:`${e}username`,online:`${e}isOnline`,points:`${e}points`,is_moderator:`${e}isModerator`,is_admin:`${e}isAdmin`,is_journalist:`${e}isJournalist`,notifications_counter:`${e}notificationsCount`,comments_count:`${e}commentsCount`,up_votes_count:`${e}upVotesCount`,up_votes_received_count:`${e}upVotesReceivedCount`,unseen_notifications_count:`${e}unseenNotificationsCount`,rank:`${e}messagesVoted`,email:`${e}email`,verified:`${e}isEmailVerified`,social:`${e}socialNetworks`,registered:`${e}isRegistered`,anonymous:`${e}isAnonymized`,spot_token:`${e}token`,"liked-message":`${e}emailNotifyLikedMessage`,"user-mentioned":`${e}emailNotifyUserMentioned`,"replied-your-message":`${e}emailNotifyRepliedYourMessage`,private_profile:`${e}isPrivate`,sso_user:`${e}isSsoUser`,is_super_admin:`${e}isSuperAdmin`,spotim_device_ticket:`${e}spotimDeviceTicket`,following:`${e}following`,actions:`${e}actions`,is_community_moderator:`${e}isCommunityModerator`,is_muted:`${e}isMuted`,network_device_ticket:`${e}networkDeviceTicket`,reputation:`${e}reputation`,sso_data:o(`${e}ssoData`),sso_primary_key:`${e}ssoPrimaryKey`,...t}}}("",t),e)}},3222:(e,t,s)=>{"use strict";function n(e,t){return function(){return Object.assign(e(),{"~":t})}}s.d(t,{I:()=>n})},9910:(e,t,s)=>{"use strict";function n(e=[]){let t=[];if(e)for(const s of e)t.push(s),t=t.concat(a(s));return t}function a(e){let t=[];if(0===e.replies.length)return t;for(const s of e.replies)t.push(s),t=t.concat(a(s));return t}s.d(t,{z:()=>n})},4"}}]);
//# sourceMappingURL=app_conversation_components_Main_tsx-app_conversation_services_legacy_helpers_browser-detect_ts-bundle.js.map