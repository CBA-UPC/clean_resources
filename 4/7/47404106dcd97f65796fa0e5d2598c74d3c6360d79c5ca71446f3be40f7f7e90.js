window.nvpack=window.nvpack||{},window.nvpack.anal=function(){"use strict";ass e{et(t,i,e,n){var s=new Date((new Date).setHours(23,59,59,0));e=e||0==e?"expires="+e:"expires="+s,n=n?"domain=."+n:"",document.cookie=t+"="+i+"; "+e+"; "+n+"; path=/; secure"}getLS(t,i){return this.lsSupport()&&localStorage.setItem(t,i)}getLSuration(t){var i=1,e="Fri, 31 Dec 1999 23:59:59 GMT";if(t)if(501==t)e="Fri, 31 Dec 1999 23:59:59 GMT";else if(0==t)e=0;else{500==t?i=365:t>0&&t<=90&&(i=t);var n=new Date;1!=i&&(i-=1,n.setTime(n.getTime()+24*i*60*60*1e3)),n.setHours(23,59,59,0),e=n}return e}}var n=()=>{var t,i,e=window.document,n=0;return{get:function(s,o,c,a){var h=-1!==s.indexOf("?")?"&":"?";o=o||{};var u=r();for(i in u&&Array.isArray(u)&&u.length>0&&(o.cookieData=u.join(";")),notify_visitors&&notify_visitors.cookie_domain&&(o.cookieDomain=notify_visitors.cookie_domain),o)o.hasOwnProperty(i)&&(h+=encodeURIComponent(i)+"="+encodeURIComponent(o[i])+"&");var d=c+ ++n;return window[d]=function(i){var n=e.createElement("script"),s=!1;n.src=i,n.async=!0,n.onload=n.onreadystatechange=!t&&(t=e.getElementsByTagName("head")[0]),t.appendChild(n)}(s+h+"js_callback="+d),d},post:function(t,i,e,n,s){s.ajax({url:t,type:"POST",data:i,contentType:!1,processData:!1,success:n})}}},s=()=>{return{bind:function(t,i,e,n){return n&&""!=n&&(window.notify_visitors.eventsRecord=window.notify_visitors.eventsRecord||{},window.notify_visitors.eventsRecord[n]=window.notify_visitors.eventsRecord[n]||[],window.notify_visitors.eventsRecord[n].push({n:i,e:t,c:e})),t.addEventListener?t.addEventListener(i,e):t.attachEvent?t.attachEvent("on"+i,e):void 0},unbind:},o=()=>{return ),{send:function(t,i){var e=new CustomEvent("notifyvisitors_callback",{detail:{data:t,url:document.location.href,type:i}});window.dispatchEvent(e)}}},r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=[];if(document&&document.cookie){var e=document.cookie.split(";");"all"===t&&(i=e),Array.isArray(t)&&e&&e.length>0&&(i=e.filter(function(i){var e=i.trim().split("=")[0];return!!t.includes(e)||0===e.indexOf("_nv_")}))}return i},c=function(){var t=i(function*(t){var i="";if(t)if("function"==typeof ga){var e=ga.getAll();i=Array.isArray(e)&&e.length?e[0].get("clientId"):""}else if("function"==typeof gtag){var n=t.gaEvents&&t.gaEvents.trackingID?t.gaEvents.trackingID:null;if(!n){var s=Object.keys(window.google_tag_manager||[]).filter(t=>"G-"==t.substring(0,2));n=Array.isArray(s)&&s.length?s[0]:null}if(n){i=yield new Promise(t=>{gtag("get",n,"client_id",t)})}}return i});return (),a="https://analytics.notifyvisitors.com/",h={event:a+"brand/t1/event",user:a+"brand/t1/users",dimensions:a+"brand/t1/dimensions",userSessions:a+"brand/t1/userSessions",collectSessions:a+"brand/t1/collectSessions"},u=new Date;class d{constructor(t){this.response={},this.session=t.data&&t.data.session||"",this.set_NV_UID=t.data&&t.data.set_NV_UID||"",this.config=this.config||{},this.data=this.data||{},this.bindEvent=s(),this.callbackNotifyEvent=o(),this.getJSONP=n(),this.callbackName="nv_anal_json",this.productName="analytics",this.cookieController=new e,this.checkAuth(t.Events.data),this.nvHandler,this.setGaClientID()}checkAuth(t,i){this.response=t,null!=t.auth&&(null!=t.async&&!1!==t.async?handleWindowLoad():this.init())}setGaClientID(){var t=this;return i(function*(){t.nvGaClientID=yield c(t.response)})()}handleWindowLoad(){"complete"==document.readyState?this.init():this.bindEvent.bind(window,"load",init,this.productName)}init(){if(nvpack.config=nvpack.config||{},nvpack.config.a)return!1;nvpack.config.a=!0,nvpack.callbackNotifyEvent=this.callbackNotifyEvent,this.config.urls=h,this.data.auth=this.response.auth||{},this.data.setting=this.response.auth||{},this.data.auth.ruleData&&(this.data.setting.ruleData=this.data.auth.ruleData=this.response.ruleData),this.response.tokens&&(this.data.setting.tokens=this.data.auth.tokens=this.response.tokens),this.data.setting.trafficSource=this.data.auth.trafficSource=document.referrer,this.data.setting.isPwa=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches?1:0,this.data.setting.pageUrl=this.data.auth.pageUrl=document.location,this.data.setting.gmOffset=this.data.auth.gmOffset=60*u.getTimezoneOffset()*-1,this.data.setting.screenWidth=this.data.auth.screenWidth=screen.width,this.data.setting.screenHeight=this.data.auth.screenHeight=screen.height,this.data.setting.storage=this.data.auth.storage=this.browserStorage(),this.data.setting.linkreferrer=this.data.auth.linkreferrer=document.referrer,this.callbackNotifyEvent.send("analytics_init","loadscript"),this.load()}load(){var t=this;if("fail"==this.response.Authentication)return!1;this.nvHandler=this.nvStaticEvent=function(){var i=t.response.event_integration;Object.keys(i).forEach(e=>{void 0!==i[e].event_initialize_type&&0!=i[e].event_initialize_type?this.callStaticEventonClick(i[e].event_initialize_type,i[e].event,i[e].attributes,i[e].ltv,i[e].scope):t.eventAction(i[e].event,i[e].attributes,i[e].ltv,i[e].scope,1)})},t.response.event_integration&&this.nvStaticEvent()}callStaticEventonClick(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=this;if(i)var r=setInterval(function(){var c;if("X-Path"===t.type){if(!document.evaluate)return clearInterval(r),0;c=document.evaluate(t.value,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}else c="css"===t.type?document.querySelector(t.value):document.querySelector("#"+t.value);null!==c&&(clearInterval(r),c.addEventListener("click",function(){o.eventAction(i,e,n,s,1)}))},500)}performEventActions(t){if(!t[0])return!1;switch(t[0]){case"user":this.userAction(t[1],t[2]);break;case"userevent":if(!(t[1]&&Array.isArray(t[1])&&t[1].length>3))break;this.userEventAction(t[1][0],t[1][1],t[1][2],t[1][3],t[1][4]||"",t[1][5]||"");break;case"pushuser":this.cookieController.get("_nv_push_subscribe")&&this.userAction(t[1],t[2]);break;case"event":this.eventAction(t[1],t[2],t[3],t[4]);break;case"pushevent":this.pusheventAction(t[1],t[2],t[3],t[4]);break;case"pushsubscribe":this.data.pushsubscribe.userID=t[1],this.data.pushsubscribe.event=t[2]}}userAction(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){var e=Object.assign({},this.data.setting);e.userID=t,this.nvGaClientID&&(i.nvGaClientID=this.nvGaClientID),i&&"object"==typeof i&&Object.keys(i).length&&(i.nvSegmentID||i.nvFormID||i.nvChannel)&&(i.nvSegmentID&&(e.segmentID=i.nvSegmentID,delete i.nvSegmentID),i.nvFormID&&(e.FormID=i.nvFormID,delete i.nvFormID),i.nvChannel&&(e.channel=i.nvChannel,delete i.nvChannel)),e.userParams=i?JSON.stringify(i):"",this.getJSONP.get(this.config.urls.user,e,this.callbackName,this.userActionResponse.bind(this))}}userActionResponse(t){t&&"object"==typeof t&&(t.campaignCookie&&this.session&&this.session(t.campaignCookie),t.nv_uid&&this.set_NV_UID&&this.set_NV_UID(t.nv_uid)),"object"==typeof t&&"success"==t.Authentication&&t.nv_uid&&(this.response.nv_uid!=t.nv_uid||t._nv_user_changed)&&(this.response.nv_uid=t.nv_uid,this.updateUserIdPushSubscribe(t)),t.callback_data&&this.callbackNotifyEvent.send(t.callback_data,"user")}updateUserIdPushSubscribe(t){window.notify_visitors.po&&window.notify_visitors.po.updateUserIdSubscription&&window.notify_visitors.po.updateUserIdSubscription(t.userID)}userEventAction(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;if(t&&e){var r=Object.assign({},this.data.setting);r.userID=t,this.nvGaClientID&&(i.nvGaClientID=this.nvGaClientID),i&&"object"==typeof i&&Object.keys(i).length&&(i.nvSegmentID||i.nvFormID||i.nvChannel)&&(i.nvSegmentID&&(r.segmentID=i.nvSegmentID,delete i.nvSegmentID),i.nvFormID&&(r.FormID=i.nvFormID,delete i.nvFormID),i.nvChannel&&(r.channel=i.nvChannel,delete i.nvChannel)),r.userParams=i?JSON.stringify(i):"",r.event_name=e,r.attributes=n?JSON.stringify(n):"",s&&(r.ltv=s),o&&(r.scope=o),this.getJSONP.get(this.config.urls.user,r,this.callbackName,this.userEventActionResponse.bind(this))}}userEventActionResponse(t){if(t&&"object"==typeof t&&Object.keys(t).length>0){var i=t.userResponse||"",e=t.eventResponse||"";i&&"object"==typeof i&&this.userActionResponse(i),e&&"object"==typeof e&&this.eventActionResponse(e)}}pusheventAction(t,i,e,n){this.cookieController.get("nv_push_subscribe")&&eventAction(t,i,e,n)}eventAction(t,i,e,n,s){if(t){var o=Object.assign({},this.data.setting);o.event_name=t,i&&(o.attributes=JSON.stringify(i)),e&&(o.ltv=e),n&&(o.scope=n),s&&(o.event_type=s),void 0!==this.data.pushsubscribe&&this.data.pushsubscribe.hasOwnProperty("userID")&&(o.userID=this.data.pushsubscribe.userID),this.getJSONP.get(this.config.urls.event,o,this.callbackName,this.eventActionResponse.bind(this))}}eventActionResponse(t){t.campaignCookie&&this.session&&this.session(t.campaignCookie),t.callback_data&&this.callbackNotifyEvent.send(t.callback_data,"event")}browserStorage(){var t={session:this.storage("sessionStorage"),local:this.storage("localStorage")};return JSON.stringify(t)}storage(t){var i={};return window[t]&&window[t].length>0&&Object.keys(window[t]).forEach(function(e){-1!==e.indexOf("_nv_")&&(i[e]=window[t][e])}),i}}var l=new d(window.notify_visitors);return d.nvHandler=l.nvHandler,d}();
