(function(h,q){var l=Brid.Util;h.$bp.Prebid=Brid.Abstract.extend({bidding:!1,timeout:3E3,ourBidding:!1,refreshTime:0,refreshingBids:!1,refreshingTimeouts:[],midrollBidding:!1,midrollLastBiddedCuepoint:.5,allowScroll:!1,adUnits:[],backfillAdUnits:[],adUnitBidLength:0,backfillAdUnitBidLength:0,bidCounter:0,backfillBidCounter:0,schainData:null,schainDataBackfill:null,userPrebidFinished:!1,playbackOccurred:!1,analyticsEventSet:!1,prebidConfig:null,prebidConfigBackfill:null,previousBid:-1,cachedBids:[],
init:function b(a,c){b.base.call(this,a,c);this.optimize_price=this.player.config.optimize_price?this.player.config.optimize_price:!1;if(a.config.Prebid)var d=a.config.Prebid;a.prebidConfig&&(d=a.prebidConfig);d&&(this.prebidConfig={},this.prebidConfig.prebid_variable=d.prebid_variable,this.prebidConfig.js_file=d.js_file,this.prebidConfig.adunit_codes=d.adunit_codes,this.prebidConfig.sellers_file=d.sellers_file,this.prebidConfig.global_config=d.global_config,this.prebidConfig.bidder_settings=d.bidder_settings,
this.prebidConfig.dont_use_dfp=d.dont_use_dfp?d.dont_use_dfp:!1,this.prebidConfig.prebid_ad_unit_width=d.prebid_ad_unit_width,this.prebidConfig.prebid_ad_unit_height=d.prebid_ad_unit_height,this.prebidConfig.gam_tag_params=d.gam_tag_params);a.config.Prebid&&a.config.Prebid.global_config&&a.config.Prebid.global_config.prebid_variable&&(a.config.Prebid.prebid_variable=a.config.Prebid.global_config.prebid_variable,this.prebidConfig.prebid_variable=a.config.Prebid.global_config.prebid_variable,delete a.config.Prebid.global_config.prebid_variable);
a.prebidConfig&&a.prebidConfig.global_config&&a.prebidConfig.global_config.prebid_variable&&(this.prebidConfig.prebid_variable=a.prebidConfig.global_config.prebid_variable,delete a.prebidConfig.global_config.prebid_variable);a.config.prebid_variable&&(a.config.Prebid&&(a.config.Prebid.prebid_variable=a.config.prebid_variable),this.prebidConfig&&(this.prebidConfig.prebid_variable=a.config.prebid_variable));a.config.Prebid&&a.config.Prebid.global_config&&a.config.Prebid.global_config.prebid_timeout&&
(this.timeout=parseInt(a.config.Prebid.global_config.prebid_timeout),delete a.config.Prebid.global_config.prebid_timeout);a.prebidConfig&&a.prebidConfig.global_config&&a.prebidConfig.global_config.timeout&&(this.timeout=parseInt(a.prebidConfig.global_config.timeout));a.config.prebid_timeout&&(this.timeout=parseInt(a.config.prebid_timeout));a.config.prebid_bid_refresh_time&&(this.refreshTime=parseInt(a.config.prebid_bid_refresh_time));a.config.Prebid&&(this.adUnits=this.generateAdUnits(a.config.Prebid.adunit_codes||
a.config.Prebid));a.config.AdSchedule&&(this.adUnits=this.generateNewAdUnits(a.config.AdSchedule));Brid.log("Prebid adUnits",this.adUnits);this.player.config.Partner.program&&this.player.config.Partner.program.Prebid&&(this.prebidConfigBackfill=this.player.config.Partner.program.Prebid,this.backfillAdUnits=this.generateBackfillAdUnits(this.prebidConfigBackfill));Brid.log("Prebid backfillAdUnits",this.backfillAdUnits,this.optimize_price);(this.prebidConfig&&(this.prebidConfig.js_file||this.prebidConfig.adunit_codes)&&
0!=this.adUnits.length||this.prebidConfigBackfill&&(this.prebidConfigBackfill.js_file||this.prebidConfigBackfill.adunit_codes))&&-1==l.getEmbededUrl().indexOf("#BridNoPrebid")&&a.config.monetize?(this.schainData=l.getSchain(this.player),this.schainDataBackfill=l.getSchain(this.player,"backfill"),this.player.add(["nextVideo","skipped"],this.$f(this.onNextVideo)),this.player.addOnce("playCalledDuringBidding",this.$f(this.onPlayCalledDuringBidding)),this.adUnits.some(function(a){return"midroll"==a.type})&&
(Brid.log("Prebid prepare to bid for midrolls during playback"),this.player.add("timeupdate",this.$f(this.onTimeupdate))),Brid.isMobilePlatform&&a.config.autoplay&&(Brid.log("Prebid set muted for mobile"),a.muted(!0)),this.hasPbjs()?(this.getPbjs("pbjs"),this.prebidConfig&&this.prebidConfig.adunit_codes||this.prebidConfigBackfill&&this.prebidConfigBackfill.adunit_codes?(Brid.log("Prebid JS found on page, waiting for adunits:",this.adUnits),a.add("ready",this.$f(this.waitForAdUnit))):(Brid.log("Prebid JS found on page, ignoring JS set in CMS"),
a.add("ready",this.$f(this.prebidReady)))):this.prebidConfig&&!this.prebidConfig.js_file?a.config.prebid_wait_time&&this.prebidConfig.adunit_codes?this.waitForPrebidOnPageToBecomeAvailable():(Brid.log("Prebid not found on page and JS file not specified, exiting..."),this.allowScroll=!0):(a=[],this.prebidConfig&&this.prebidConfig.js_file&&!this.hasPbjs(this.prebidConfig.prebid_variable)&&a.push({isStyle:!1,url:this.prebidConfig.js_file}),this.prebidConfigBackfill&&this.prebidConfigBackfill.js_file&&
!this.hasPbjs(this.prebidConfigBackfill.prebid_variable)&&a.push({isStyle:!1,url:this.prebidConfigBackfill.js_file}),Brid.log("Prebid load scripts",a),Promise.all(a.map(Brid.Loader.scriptLoad)).then(this.prebidReady.bind(this)))):(Brid.log("Prebid not valid unit config found, returning..."),this.allowScroll=!0)},optimizeFloorAdUnitFilterBackfill:function(b,a){return b.filter(function(b,d){return b.id.split("-")[3]==a})},optimizeFloorAdUnitFilter:function(b,a){return b.filter(function(b,d){return b.id.split("-")[2]==
a})},prebidReady:function(b){Brid.log("Prebid ready, bid_preload",b[0],this.player.config.bid_preload);this.prebidReadyFired=!0;b[0]&&b[0].message&&"Script not loaded"==b[0].message&&this.playback();if(this.player.config.bid_preload||this.playCalled)b=this.adUnits.filter(function(a){return"midroll"!=a.type}),this.runBidding(this.optimize_price?this.optimizeFloorAdUnitFilter(this.adUnits.filter(function(a){return"preroll"==a.type}),0).concat(this.optimizeFloorAdUnitFilter(this.adUnits.filter(function(a){return"postroll"==
a.type}),0)):b,0)},onPlayCalledDuringBidding:function(){this.playCalled=!0;if(!this.player.config.bid_preload&&this.prebidReadyFired){var b=this.adUnits.filter(function(a){return"midroll"!=a.type});this.runBidding(b)}},runCustomPrebid:function(){var b=this.adUnits.filter(function(a){return"midroll"!=a.type});this.playbackOccurred=this.allowScroll=!1;this.runBidding(b)},onTimeupdate:function(){var b=this.player,a=this.player.adsManager,c=a.getScheduledCuepoints();b.currentTime();var d=1;b.config.loop_ads&&
(d=.1);if(b.config.monetize&&c&&c.length&&!this.bidding&&!b.getAdInProgress()&&!b.waitingForAd&&(this.midrollLastBiddedCuepoint||(this.midrollLastBiddedCuepoint=c[0]),!(b.currentTime()-this.midrollLastBiddedCuepoint<d)&&c[0]!=this.midrollLastBiddedCuepoint&&(this.midrollLastBiddedCuepoint=c[0],d=this.adUnits.filter(function(a){return"midroll"==a.type}),0<d.length))){Brid.log("Prebid start bidding for midroll at cuepoint ",this.midrollLastBiddedCuepoint);for(b=0;b<a.ads.midroll.adTags.length;b++)a.ads.midroll.adTags[b]=
a.ads.midroll.adTags[b].filter(;this.midrollBidding=!0;this.runBidding(this.optimize_price?this.optimizeFloorAdUnitFilter(d,0):d,0,"midroll")}},calcPriceFloor:function(b,a){var c=this,d=this.player.highestBid,e=a?a:this.previousBid,m=-1,f=0,g={spotx:"price_floor",appnexus:"reserve",ix:"bidFloor",sharethrough:"floor",triplelift:"floor",rubicon:"floor",pubmatic:"kadfloor",openx:"customFloor",unruly:"floor",rise:"floorPrice",rhythmone:"floor",
yahoossp:"bidfloor",gumgum:"bidfloor",sovrn:"bidfloor",synacormedia:"bidfloor",medianet:"bidfloor",criteo:"bidFloor"};c.player.config.Partner.floor_setup&&c.player.config.Partner.floor_setup.lowestBid&&(f=c.player.config.Partner.floor_setup.lowestBid);Brid.log("CALCULATE PRICE FLOOR",b,d,e);l.each(b,function(a){Brid.log("CALCULATE PRICE BID ARRAY",a.bids);l.each(a.bids,function(a){Brid.log("CALCULATE PRICE BID OBJECT",a.bidder,a);Brid.log("CALC PRICE FLOOR FOR ",a.bidder);if("yahoossp"==a.bidder){if(a.params.bidOverride&&
a.params.bidOverride.imp&&a.params.bidOverride.imp.bidfloor){Brid.log("BASE FLOOR ",a.params.bidOverride.imp.bidfloor);c.player.config.Partner.floor_setup&&c.player.config.Partner.floor_setup.geo&&c.player.config.Partner.floor_setup.geo[c.player.config.co]&&(a.params.bidOverride.imp.bidfloor=c.player.config.Partner.floor_setup.geo[c.player.config.co],Brid.log("BASE FLOOR "+c.player.config.co,a.params.bidOverride.imp.bidfloor));Brid.isMobilePlatform&&c.player.config.Partner.floor_setup&&c.player.config.Partner.floor_setup.mobile&&
(a.params.bidOverride.imp.bidfloor=c.player.config.Partner.floor_setup.mobile,Brid.log("BASE FLOOR MOBILE",a.params.bidOverride.imp.bidfloor));if(-1<e){var b=c.player.Advertising.getFloorPriceBasic(a.params.bidOverride.imp.bidfloor,e);b=b>f?b:f;Brid.log("NEW FLOOR PRICE ",b);a.params.bidOverride.imp.bidfloor=parseFloat(b)}else a.params.bidOverride.imp.bidfloor=parseFloat(a.params.bidOverride.imp.bidfloor);m=a.params.bidOverride.imp.bidfloor}}else"kargo"==a.bidder?a.floorData&&a.floorData.floorMin&&
(Brid.log("BASE FLOOR ",a.floorData.floorMin),c.player.config.Partner.floor_setup&&c.player.config.Partner.floor_setup.geo&&c.player.config.Partner.floor_setup.geo[c.player.config.co]&&(a.floorData.floorMin=c.player.config.Partner.floor_setup.geo[c.player.config.co],Brid.log("BASE FLOOR "+c.player.config.co,a.floorData.floorMin)),Brid.isMobilePlatform&&c.player.config.Partner.floor_setup&&c.player.config.Partner.floor_setup.mobile&&(a.floorData.floorMin=c.player.config.Partner.floor_setup.mobile,
Brid.log("BASE FLOOR MOBILE",a.floorData.floorMin)),-1<e?(b=c.player.Advertising.getFloorPriceBasic(a.floorData.floorMin,e),b=b>f?b:f,Brid.log("NEW FLOOR PRICE ",b),a.floorData.floorMin=parseFloat(b)):a.floorData.floorMin=parseFloat(a.floorData.floorMin),m=a.floorData.floorMin):a.params[g[a.bidder]]&&(Brid.log("BASE FLOOR ",a.params[g[a.bidder]]),c.player.config.Partner.floor_setup&&c.player.config.Partner.floor_setup.geo&&c.player.config.Partner.floor_setup.geo[c.player.config.co]&&(a.params[g[a.bidder]]=
c.player.config.Partner.floor_setup.geo[c.player.config.co],Brid.log("BASE FLOOR "+c.player.config.co,a.params[g[a.bidder]])),Brid.isMobilePlatform&&c.player.config.Partner.floor_setup&&c.player.config.Partner.floor_setup.mobile&&(a.params[g[a.bidder]]=c.player.config.Partner.floor_setup.mobile,Brid.log("BASE FLOOR MOBILE",a.params[g[a.bidder]])),-1<e?(b=c.player.Advertising.getFloorPriceBasic(a.params[g[a.bidder]],e),b=b>f?b:f,Brid.log("NEW FLOOR PRICE ",b),a.params[g[a.bidder]]=parseFloat(b)):a.params[g[a.bidder]]=
parseFloat(a.params[g[a.bidder]]),m=a.params[g[a.bidder]]);"pubmatic"==a.bidder&&(a.params[g[a.bidder]]+="")})});Brid.log("DODELI previousBid",m);this.previousBid=m;return b},runPodBidding:function(b,a){Brid.log("PREBID runPodBidding",b,a);var c="0"==b?"preroll":"1"==b?"midroll":"postroll",d=this.adUnits.filter(function(a){return a.type==c}),d=d.filter(function(b,c){return c==a});b=this.previousBid;var e=this.backfillAdUnits.filter(function(a){return a.type==c}),e=e.filter(,d=JSON.parse(JSON.stringify(d)),e=JSON.parse(JSON.stringify(e));this.adUnitBidLength=d.length;this.ourBidding=this.bidding=!0;Brid.log("POD AD UNIT",d,c);d=this.calcPriceFloor(d);0<e.length&&(e=this.calcPriceFloor(e,b));"midroll"==c&&(this.midrollBidding=!0);return Promise.all([this.runCMSPrebid(d),this.runBackfillPrebid(e)]).then(function(a){this.bidding=!1;this.midrollBidding&&(this.midrollBidding=!1);return a}.bind(this))},runBidding:function(b,a,c){var d=this.player,e=this;b=JSON.parse(JSON.stringify(b));
var m=this.backfillAdUnits,f=[];c=c?c:"preroll";var g=this.previousBid;this.optimize_price&&0===a&&(m=this.optimizeFloorAdUnitFilterBackfill(this.backfillAdUnits.filter(,0));f=JSON.parse(JSON.stringify(m));this.adUnitBidLength=b.length;this.backfillAdUnitBidLength=f.length;this.bidding||(d.adsManager&&d.adsManager.checkOffsetAndFrequency()?(this.ourBidding=this.bidding=!0,Brid.log("RUN BIDDING AD UNITS",b),this.optimize_price&&(b=this.calcPriceFloor(b),0<f.length&&(f=
this.calcPriceFloor(f,g))),Promise.all([this.runCMSPrebid(b),this.runBackfillPrebid(f)]).then(function(a){"PLAYBACK"==a[0]&&"PLAYBACK"==a[1]?e.playback():e.allBidsFinished("TESTIS")})):this.playback())},runCMSPrebid:function(b){var a=this,c=this.player,d=this.prebidConfig,e=q.BridIframeBurst?h.top:h;Brid.log("RUN CMS PREBID",b);return new Promise(function(m,f){if(0==b.length)m("PLAYBACK");else try{a.auctionIds=[];a.bidCounter=0;a.getPbjs("pbjs");a.checkAliases(b);if(d.bidder_settings)try{var g=(new Function("return "+
d.bidder_settings))();"object"==typeof g&&(a.pbjs.bidderSettings=g,Brid.log("Prebid setting bidder_settings"))}catch(k){Brid.log("Prebid error parsing bidder_settings",k)}b.forEach(function(b){var g={code:b.id,mediaTypes:{video:{playerSize:h.prebidPlayerSizeBrid?a.getClosestPlayerSize(h.prebidPlayerSizeBrid):d.prebid_ad_unit_width&&d.prebid_ad_unit_height?[parseInt(d.prebid_ad_unit_width),parseInt(d.prebid_ad_unit_height)]:Brid.isMobilePlatform?[400,300]:[640,480],context:c.currentSrc()?"instream":
"outstream"}},bids:b.bids,pId:c.id},f=a.generateAuctionId();b.media_types&&l.merge(g.mediaTypes.video,b.media_types);g=a.replaceMacros(g);Brid.log("Prebid setting request",g,"auctionId",f,"libLoaded",a.pbjs.libLoaded);a.pbjs.que.push(function(){var k=h.prebidConfigBrid||d.global_config||{cache:{url:"https://prebid.adnxs.com/pbc/v1/cache"},priceGranularity:"auto",userSync:{iframeEnabled:!0,filterSettings:{iframe:{bidders:"*",filter:"include"}}}},n=a.pbjs.getConfig();a.schainData&&(k.schain=a.schainData);
a.pbjs.removeAdUnit(b.id);a.pbjs.adUnits.some(function(a){return a.code==b.id})||(Brid.log("Prebid addAdUnits",b.id,"config",k),Brid.log("Prebid addAdUnits",n),n.floors&&n.floors.data&&n.floors.data.values&&-1<a.previousBid&&(n.floors.data.values.video=a.previousBid),k.floors&&k.floors.data&&k.floors.data.values&&-1<a.previousBid&&(k.floors.data.values.video=a.previousBid),a.pbjs.addAdUnits(g));"function"===typeof e.__tcfapi?k.consentManagement||(k.consentManagement={gdpr:{timeout:5E3,defaultGdprScope:!0},
usp:{timeout:5E3}}):k.consentManagement&&delete k.consentManagement;a.pbjs.setConfig(a.replaceMacros(k));"undefined"!=typeof h.bidderSettingsBrid&&(a.pbjs.bidderSettings=h.bidderSettingsBrid);"undefined"!=typeof h.prebidAnalyticsConfigBrid&&a.pbjs.enableAnalytics(h.prebidAnalyticsConfigBrid);a.auctionIds.push(f);a.pbjs.requestBids({adUnitCodes:[b.id],auctionId:f,timeout:a.timeout,bidsBackHandler:function(e,f,k){var n=a.player.config.Partner;f=null;var h=.2;Brid.log("Prebid bidsBackHandler unit.id",
b.id,"auctionId",k,"bids",e);if(!a.player.A9||a.player.A9.bidding)Brid.log("PREBID RESET highestBid"),a.player.highestBid=-1;if(a.auctionIds.includes(k))if(e[b.id]){k=e[b.id].bids.slice().sort(function(a,b){return b.cpm-a.cpm})[0];c.highestBid=k.cpm>c.highestBid?k.cpm:c.highestBid;Brid.log("WINNING",k,g,b);if(a.optimize_price){if(e[b.id].bids&&0<e[b.id].bids.length){var p=JSON.parse(JSON.stringify(e[b.id].bids));p.map(function(c){var e=JSON.parse(JSON.stringify(g));e.bids=e.bids.filter(function(a){return a.bidder==
c.bidder});var f=a.buildVideoUrl(e,b,c,null),k=a.replaceMacros(b.custom_params||{});b.dont_use_dfp||d.dont_use_dfp||(f=f.replace(/cust_params=.*/g,""),f+="cust_params=hb_uuid%3D"+c.adserverTargeting.hb_uuid+"%26hb_cache_id%3D"+c.adserverTargeting.hb_cache_id+"%26hb_format%3D"+c.adserverTargeting.hb_format+"%26hb_size%3D"+c.adserverTargeting.hb_size+"%26hb_adid%3D"+c.adserverTargeting.hb_adid+"%26hb_bidder%3D"+c.adserverTargeting.hb_bidder+"%26hb_cache_path%3D%2Fcache%26hb_pb%3D"+c.adserverTargeting.hb_pb+
"%26hb_source%3D"+c.adserverTargeting.hb_source+"%26hb_adomain%3D"+c.adserverTargeting.hb_adomain+"%26hb_acat%3D"+c.adserverTargeting.hb_acat,Object.keys(k).forEach(function(a,b){f+="%26"+a+"%3D"+k[a]}));f=f.replace(/%5B((brid|item|step|preroll|video|bplr?)[_-][a-zA-Z0-9_]+?)%5D/g,"[$1]");d.gam_tag_params&&(f+="&"+d.gam_tag_params);d.prebid_ad_unit_width&&d.prebid_ad_unit_height&&(f=f.replace(/&sz=\d+x\d+/g,"&sz="+d.prebid_ad_unit_width+"x"+d.prebid_ad_unit_height));var e=b.id.split("-"),m={unitId:b.id,
unitIu:b.iu,bidder:c.bidder,cpm:c.cpm,timestamp:Date.now()};c.adObject={adTagUrl:f,adType:a.getAdType(b.type),adTimeType:"s",overlayStartAt:null,overlayDuration:null,pod:e[2],source:"prebid",cpm:c.cpm,data:m};c.adObject.ttl=6E5;c.adObject.created=Date.now();b.ad_source_id&&(c.adObject.id=b.ad_source_id,c.adObject.sc=b.sc_id)});a.cachedBids=a.cachedBids.concat(p);a.cachedBids=a.cachedBids.sort(function(a,b){return b.cpm-a.cpm});n.floor_setup&&n.floor_setup.lower_floor&&(h=n.floor_setup.lower_floor);
a.cachedBids=a.cachedBids.filter(function(a){return a.cpm>=h});a.cachedBids=a.cachedBids.filter(function(a){return Date.now()-a.adObject.created<a.adObject.ttl-100})}Brid.log("PREBID CACHED BIDS",p,a.cachedBids)}for(p=e[b.id].bids.length-1;0<=p;p--)k.bidder==e[b.id].bids[p].bidderCode&&(e[b.id].bids[p].bidWon=!0),a.player.trigger("bidderResponse",e[b.id].bids[p]);a.optimize_price||(f=a.buildVideoUrl(g,b,k,null),f=f.replace(/%5B((brid|item|step|preroll|video|bplr?)[_-][a-zA-Z0-9_]+?)%5D/g,"[$1]"),
d.gam_tag_params&&(f+="&"+d.gam_tag_params),Brid.log("Prebid vastUrl",f));p={unitId:b.id,unitIu:b.iu,bidder:k.bidder,cpm:k.cpm,timestamp:Date.now()};0<e[b.id].bids.length&&a.player.trigger("bidWon",p);0<e[b.id].bids.length&&Brid.log("Prebid BIDS LENGTH",e[b.id].bids.length,k.bidder,k.cpm);a.bidReturned(b,f,p).then(function(a){"PREBID_ALL_FINISHED"==a&&m("CMSPrebid DONE")})}else Brid.log("Prebid bids don't have response for brid_video unit"),a.bidReturned().then(function(a){"PREBID_ALL_FINISHED"==
a&&m("runCMSPrebid DONE")});else Brid.log("Prebid ignore auctionId",k),m("PLAYBACK")}})})},this)}catch(k){Brid.log("Prebid error occurred, going to playback...",k),m("PLAYBACK")}})},runBackfillPrebid:function(b){var a=this,c=this.player,d=this.prebidConfigBackfill,e=q.BridIframeBurst?h.top:h;Brid.log("Prebid runBackfillPrebid",this.refreshingBids);Brid.log("RUN BACKFILL PREBID",b);return new Promise(function(m,f){if(0!=b.length&&a.player.config.Partner.program)if(a.refreshingBids)m("REFERSH");else{a.player.config.Partner.program.backfill_prebid=
[];"bf"==a.player.config.Partner.mb&&(a.player.config.Partner.program.frontfill_prebid=[]);try{a.backfillBidCounter=0;a.backfillAuctionIds=[];a.getBackfillPbjs(d.prebid_variable);a.checkAliases(b);if(d.prebid_bidder_settings)try{var g=(new Function("return "+d.prebid_bidder_settings))();"object"==typeof g&&(a.pbjsBackfill.bidderSettings=g,Brid.log("Backfill Prebid setting bidder_settings"))}catch(k){Brid.log("Backfill Prebid error parsing bidder_settings",k)}b.forEach(function(b){var f={code:b.id,
mediaTypes:{video:{playerSize:h.prebidPlayerSizeBrid?a.getClosestPlayerSize(h.prebidPlayerSizeBrid):d.prebid_ad_unit_width&&d.prebid_ad_unit_height?[parseInt(d.prebid_ad_unit_width),parseInt(d.prebid_ad_unit_height)]:Brid.isMobilePlatform?[400,300]:[640,480],context:c.currentSrc()?"instream":"outstream"}},bids:b.bids,pId:c.id},g=a.generateAuctionId();b.media_types&&l.merge(f.mediaTypes.video,b.media_types);f=a.replaceMacros(f);Brid.log("Backfill Prebid setting request",f,"auctionId",g,"libLoaded",
a.pbjsBackfill.libLoaded);a.pbjsBackfill.que.push(function(){var k=d.prebid_global_config||{cache:{url:"https://prebid.adnxs.com/pbc/v1/cache"},priceGranularity:"auto"};a.schainDataBackfill&&(k.schain=a.schainDataBackfill);a.pbjsBackfill.removeAdUnit(b.id);a.pbjsBackfill.adUnits.some(function(a){return a.code==b.id})||(Brid.log("Backfill Prebid addAdUnits",b.id,"config",k),a.pbjsBackfill.addAdUnits(f));"function"===typeof e.__tcfapi?k.consentManagement||(k.consentManagement={gdpr:{timeout:5E3,defaultGdprScope:!0},
usp:{timeout:5E3}}):k.consentManagement&&delete k.consentManagement;a.pbjsBackfill.setConfig(a.replaceMacros(k));"undefined"!=typeof h.bidderSettingsBrid&&(a.pbjsBackfill.bidderSettings=h.bidderSettingsBrid);a.backfillAuctionIds.push(g);a.pbjsBackfill.requestBids({adUnitCodes:[b.id],auctionId:g,bidsBackHandler:function(e,g,k){var h=a.player.config.Partner;g=null;var n=.2;Brid.log("Backfill Prebid bidsBackHandler unit.id",b.id,"auctionId",k,"bids",e);if(a.backfillAuctionIds.includes(k))if(e[b.id]){k=
e[b.id].bids.slice().sort(function(a,b){return b.cpm-a.cpm})[0];Brid.log("WINNING BACKFILL",k,f,b);if(a.optimize_price){if(e[b.id].bids&&0<e[b.id].bids.length){var l=JSON.parse(JSON.stringify(e[b.id].bids));l.map(function(e){var g=JSON.parse(JSON.stringify(f));g.bids=g.bids.filter(function(a){return a.bidder==e.bidder});g=a.backfillBuildVideoUrl(g,b,e,null);g=g.replace(/%5B((brid|item|step|preroll|video|bplr?)[_-][a-zA-Z0-9_]+?)%5D/g,"[$1]");d.prebid_ad_unit_width&&d.prebid_ad_unit_height&&(g=g.replace(/&sz=\d+x\d+/g,
"&sz="+d.prebid_ad_unit_width+"x"+d.prebid_ad_unit_height));var k=b.id.split("-"),m={unitId:b.id,unitIu:b.iu,bidder:e.bidder,cpm:e.cpm,timestamp:Date.now()};e.adObject={adTagUrl:g,adType:a.getAdType(b.type),adTimeType:"s",overlayStartAt:null,overlayDuration:null,pod:k[3],source:"prebid",cpm:e.cpm,data:m,backfill:!0};c.config.owner_id&&"23680"==c.config.owner_id||(e.cpm=parseFloat((e.cpm*c.config.revenue_share/100).toFixed(2)));e.adObject.ttl=6E5;e.adObject.created=Date.now();b.ad_source_id&&(e.adObject.id=
b.ad_source_id,e.adObject.sc=b.sc_id)});a.cachedBids=a.cachedBids.concat(l);a.cachedBids=a.cachedBids.sort(;h.floor_setup&&h.floor_setup.lower_floor&&(n=h.floor_setup.lower_floor);a.cachedBids=a.cachedBids.filter(;a.cachedBids=a.cachedBids.filter(function(a){return Date.now()-a.adObject.created<a.adObject.ttl-100})}Brid.log("PREBID CACHED BIDS BACKFILL",l,a.cachedBids)}a.optimize_price||(g=a.backfillBuildVideoUrl(f,b,k,null),g=g.replace(/%5B((brid|item|step|preroll|video|bplr?)[_-][a-zA-Z0-9_]+?)%5D/g,
"[$1]"),Brid.log("Backfill Prebid vastUrl",g));l={unitId:b.id,unitIu:b.iu,bidder:k.bidder,cpm:k.cpm,timestamp:Date.now()};Brid.log("Backfill Prebid BIDS LENGTH",e[b.id].bids.length,e[b.id].bids[0].bidder,k.bidder,k.cpm);a.backfillBidReturned(b,g,l).then(function(a){"BACKFILL_PREBID_ALL_FINISHED"==a&&m("runBackfillPrebid DONE")})}else Brid.log("Backfill prebid bids don't have response for brid_video unit"),a.backfillBidReturned().then(;
else Brid.log("Backfill Prebid ignore auctionId",k),m("PLAYBACK")}})})},this)}catch(k){Brid.log("Backfill Prebid error occurred, going to playback...",k),m("PLAYBACK")}}else m("PLAYBACK")})},bidReturned:function(b,a,c){if(a){var d=this.prebidConfig;("string"==typeof a?[a]:a).forEach(function(a){d.prebid_ad_unit_width&&d.prebid_ad_unit_height&&(a=a.replace(/&sz=\d+x\d+/g,"&sz="+d.prebid_ad_unit_width+"x"+d.prebid_ad_unit_height));var e=b.id.split("-"),e={adTagUrl:a,adType:this.getAdType(b.type),adTimeType:"s",
overlayStartAt:null,overlayDuration:null,pod:e[2],source:"prebid",cpm:c.cpm,data:c};1<a.indexOf("videodiff.smartadserver.com")&&(e.source="prebid-smartadserver");b.ad_source_id&&(e.id=b.ad_source_id,e.sc=b.sc_id);b.loop_num&&(e.loop_num=b.loop_num);this.nonstopBiddingStarted?this.nonstopBiddingAds.push(e):this.refreshingBids||this.midrollBidding?(Brid.log("Prebid replacePrebidTag",a,"unit id",b.id,"ad object",e),this.player.Advertising.replacePrebidTag(e)):(Brid.log("Prebid setAd",a,"unit id",b.id,
"ad object",e),this.player.setAd(e,!0,null,!0))}.bind(this))}this.bidCounter++;Brid.log("Prebid checking counts adUnits length",this.adUnitBidLength,"counter",this.bidCounter);return this.bidCounter==this.adUnitBidLength?Promise.resolve("PREBID_ALL_FINISHED"):Promise.resolve("bidCounter: "+this.bidCounter+" || adUnits length: "+this.adUnitBidLength)},backfillBidReturned:function(b,a,c){if(a){var d=this.prebidConfigBackfill;("string"==typeof a?[a]:a).forEach(function(a){d.prebid_ad_unit_width&&d.prebid_ad_unit_height&&
(a=a.replace(/&sz=\d+x\d+/g,"&sz="+d.prebid_ad_unit_width+"x"+d.prebid_ad_unit_height));a+="&tfcd=0&description_url=[description_url]&npa=0";"Brid.Player"==this.player.name&&(a+="&vid_t=[video_title]&vid_d=[video_duration]&vid_kw=[video_tags]");var e={adTagUrl:a,adType:this.getAdType(b.type),adTimeType:"s",overlayStartAt:null,overlayDuration:null,pod:b.id.replace(/^.*-/,""),source:"prebid",data:c};Brid.log("Backfill Prebid setAd",a,"unit id",b.id,"ad object",e);this.player.setBackfillAd(e,"prebid")}.bind(this))}this.backfillBidCounter++;
Brid.log("Backfill Prebid checking counts adUnits length",this.backfillAdUnitBidLength,"counter",this.backfillBidCounter);return this.backfillBidCounter==this.backfillAdUnitBidLength?Promise.resolve("BACKFILL_PREBID_ALL_FINISHED"):Promise.resolve("backfillBidCounter: "+this.backfillBidCounter+"|| backfillAdUnits length: "+this.backfillAdUnitBidLength)},allBidsFinished:function(b){Brid.log("Prebid allBidsFinished call...",b);Brid.log("Prebid all bids returned");this.bidding=!1;if(0<this.refreshTime&&
(this.refreshingTimeouts[Date.now()]=setTimeout(this.$f(this.checkExpiredBids),1E3*this.refreshTime),this.refreshingBids)){this.refreshingBids=!1;Brid.log("Prebid allBidsFinished call...","refresh return");return}this.midrollBidding||this.player.adsManager.checkScheduledAds();this.playback()},playback:function(){this.midrollBidding?this.midrollBidding=!1:this.playbackOccurred||(Brid.log("Prebid playback",this.player.config.autoplay,this.player.values.playCalled,this.playCalled),this.bidding=!1,this.playbackOccurred=
this.allowScroll=!0,this.player.values.playCalled||this.playCalled?this.player.play():this.player.config.autoplay&&(this.player.config.autoplayInview?(this.player.isPlayerInView()||"Brid.OSPlayer"==this.player.name)&&this.player.play():this.player.play()))},waitForPrebidOnPageToBecomeAvailable:function(){Brid.log("Prebid waiting for variable to load, timeout",this.player.config.prebid_wait_time);var b=Date.now()+this.player.config.prebid_wait_time,a=setInterval(function(){this.hasPbjs()?(this.getPbjs("pbjs"),
Brid.log("Prebid JS found on page, waiting for adunits:",this.adUnits,"player ready",this.player.isReady),this.player.isReady?this.waitForAdUnit():this.player.add("ready",this.$f(this.waitForAdUnit)),clearInterval(a)):Date.now()>b&&(Brid.log("Prebid not found on page even after timeout, exiting..."),this.playback(),clearInterval(a))}.bind(this),50)},waitForAdUnit:function(){var b=this;setTimeout(this.$f(function(){Brid.log("Prebid timeout occurred - waitForAdUnit",this.userPrebidFinished);this.userPrebidFinished||
this.playback()}),this.timeout);this.pbjs.que.push(function(){b.pbjs.onEvent("auctionEnd",function(a){Brid.log("Prebid auctionEnded",a);setTimeout(b.$f(,500)})});this.checkVideoBidBack()},checkVideoBidBack:function(b){if(!this.playbackOccurred&&!this.biddingFinished){var a=this,c=[],d=h.videoUnit||h.videoUnits||h.adUnit||h.adUnits||[],c=c.concat(Array.isArray(d)?d:[d]);Brid.log("Prebid checking the following adUnits for vastUrl",c,"auctionEndData",b);0==c.length?
Brid.log("Prebid adUnits empty"):(c.map(function(c){this.adUnits.forEach(function(e){if(c.code==e.code&&c.vastUrl){var d=b&&b.bidsReceived.find(||{};this.bidReturned(e,c.vastUrl,d).then(bind(this));a.userPrebidFinished=!0}},this)},this),this.userPrebidFinished&&this.allBidsFinished("User Prebid"))}},generateNewAdUnits:function(b){var a=this,c=[];l.each(["preroll","midroll","postroll"],
function(d){b[d]&&l.each(b[d],function(b,h){if(b.mobile||b.desktop){if(!Brid.isMobilePlatform&&b.desktop)var e=b.desktop.adSources;else b.mobile&&(e=b.mobile.adSources);l.each(e,function(b,e){if(b.Prebid){var f=l.merge({},b.Prebid);f.pod=h;f.ad_source_id=f.id;f.sc_id=a.player.config.ad_schedule_id;b.loop_num&&(f.loop_num=b.loop_num);!Brid.isMobilePlatform&&b.Prebid.desktop?(f.bids=b.Prebid.desktop.bids,f.custom_params=b.Prebid.desktop.custom_params,f.iu=b.Prebid.desktop.iu,f.media_types=b.Prebid.desktop.media_types):
b.Prebid.mobile&&(f.bids=b.Prebid.mobile.bids,f.custom_params=b.Prebid.mobile.custom_params,f.iu=b.Prebid.mobile.iu,f.media_types=b.Prebid.mobile.media_types);f.id="brid-"+d+"-"+(void 0!=f.pod?f.pod:h)+"-"+e;f.type=d;f.index=h;c.push(f)}})}})});return c},generateAdUnits:function(b){var a=this,c=[];["preroll","midroll","postroll"].forEach(function(d){b[d]&&(Array.isArray(b[d])||(b[d]=[b[d]]),b[d].forEach(function(b,h){if(b.mobile||b.desktop)!Brid.isMobilePlatform&&b.desktop?(b.bids=b.desktop.bids,
b.custom_params=b.desktop.custom_params,b.iu=b.desktop.iu,b.media_types=b.desktop.media_types):b.mobile&&(b.bids=b.mobile.bids,b.custom_params=b.mobile.custom_params,b.iu=b.mobile.iu,b.media_types=b.mobile.media_types);b.media_types&&b.media_types.playerSize&&(b.media_types.playerSize=a.getClosestPlayerSize(b.media_types.playerSize));if(b.bids)for(var e=b.bids.length-1;0<=e;e--)if("ix"==b.bids[e].bidder&&b.bids[e].params&&b.bids[e].params.size&&(b.bids[e].params.size=a.getClosestPlayerSize(b.bids[e].params.size)),
b.bids[e].domain_list_type&&b.bids[e].domain_list){var g=l.isOnDomain(b.bids[e].domain_list);if("whitelist"==b.bids[e].domain_list_type&&!g||"blacklist"==b.bids[e].domain_list_type&&g)Brid.log("Prebid removing",b.bids[e].bidder,"type",b.bids[e].domain_list_type,"list",b.bids[e].domain_list,"onDomain",g),b.bids.splice(e,1)}b.id="brid-"+d+"-"+(void 0!=b.pod?b.pod:h);b.type=d;b.index=h;(b.bids&&0<b.bids.length||b.code)&&c.push(b)}))});return c},generateBackfillAdUnits:function(b){var a=this,c=[];Brid.log("generateBackfillAdUnits backfill behaviour",
this.player.config.Partner.mb,this.optimize_price);if(this.player.config.Ad)this.player.config.Ad.forEach(function(e){if("0"==e.adType||"1"==e.adType||"2"==e.adType)var d="0"==e.adType?"preroll":"1"==e.adType?"midroll":"postroll";else return!1;e=!Brid.isMobilePlatform&&e.desktop?e.desktop.length:e.mobile?e.mobile.length:0;for(var f=0;f<e;f++){var g=l.clone(b);if(b.mobile||b.desktop)!Brid.isMobilePlatform&&b.desktop?(g.bids=b.desktop.bids,g.custom_params=b.desktop.custom_params,g.iu=b.desktop.iu,g.media_types=
b.desktop.media_types):b.mobile&&(g.bids=b.mobile.bids,g.custom_params=b.mobile.custom_params,g.iu=b.mobile.iu,g.media_types=b.mobile.media_types);g.media_types&&g.media_types.playerSize&&(g.media_types.playerSize=a.getClosestPlayerSize(g.media_types.playerSize));if(g.bids)for(var k=g.bids.length-1;0<=k;k--)"ix"==g.bids[k].bidder&&g.bids[k].params&&g.bids[k].params.size&&(g.bids[k].params.size=a.getClosestPlayerSize(g.bids[k].params.size));g.id="brid-backfill-"+d+"-"+f;g.type=d;g.index=f;if(g.bids&&
0<g.bids.length||g.code)c.push(g),"bf"!=a.player.config.Partner.mb||a.optimize_price||(g=l.clone(g),g.id="brid-backfillfrontfill-"+d+"-"+f,c.push(g))}});else if(this.player.config.AdSchedule){var d=this.player.config.AdSchedule;l.each(["preroll","midroll","postroll"],function(e){if(d[e]){var h=d[e].length;Brid.log("BACKFILL PREBID AD SCHEDULE",e,h);for(var f=0;f<h;f++){var g=a.createBackfillUnit(b,e,f);if(g.bids&&0<g.bids.length||g.code)c.push(g),"bf"!=a.player.config.Partner.mb||a.optimize_price||
(g=l.clone(g),g.id="brid-backfillfrontfill-"+e+"-"+f,c.push(g))}}})}return c},createBackfillUnit:function(b,a,c){b=JSON.parse(JSON.stringify(b));if(b.mobile||b.desktop)!Brid.isMobilePlatform&&b.desktop?(b.bids=b.desktop.bids,b.custom_params=b.desktop.custom_params,b.iu=b.desktop.iu,b.media_types=b.desktop.media_types):b.mobile&&(b.bids=b.mobile.bids,b.custom_params=b.mobile.custom_params,b.iu=b.mobile.iu,b.media_types=b.mobile.media_types);b.media_types&&b.media_types.playerSize&&(b.media_types.playerSize=
this.getClosestPlayerSize(b.media_types.playerSize));if(b.bids)for(var d=b.bids.length-1;0<=d;d--)"ix"==b.bids[d].bidder&&b.bids[d].params&&b.bids[d].params.size&&(b.bids[d].params.size=self.getClosestPlayerSize(b.bids[d].params.size));b.id="brid-backfill-"+a+"-"+c;b.type=a;b.index=c;return b},backfillBuildVideoUrl:function(b,a,c,d){b={adUnit:b,params:{iu:a.iu,cust_params:this.replaceMacros(a.custom_params||{}),output:"vast",impl:"s",ad_type:"audio_video",env:"instream"}};d&&(b.bid=d);return this.getVASTUrl(b,
c,this.pbjsBackfill,!0)},buildVideoUrl:function(b,a,c,d){b={adUnit:b,params:{iu:a.iu,description_url:"[description_url]",cust_params:this.replaceMacros(a.custom_params||{}),output:"vast"}};d&&(b.bid=d);return this.getVASTUrl(b,c,this.pbjs,!1)},getVASTUrl:function(b,a,c,d){var e=d?this.prebidConfigBackfill:this.prebidConfig;return!d&&this.prebidConfig.global_config&&this.prebidConfig.global_config.smartAdServer&&(d=this.getSmartAdServerUrl(b,a))?d:e.dont_use_dfp||"undefined"==typeof c.adServers?(Brid.log("Prebid not using dfp.buildVideoUrl",
e.dont_use_dfp,typeof c.adServers),a.vastUrl||a.vastXML):c.adServers.dfp.buildVideoUrl(b)},getSmartAdServerUrl:function(b,a){var c=this.prebidConfig.global_config.smartAdServer;if((a=a.adserverTargeting)&&"prebid.adnxs.com"==a.hb_cache_host&&a.hb_cache_id&&c.siteId&&c.pageId&&c.formatId){var d=a.hb_pb.replace(/^0+(\d)|(\d)0+$/gm,"$1$2"),e=a.hb_size.split("x");b=(b=b.adUnit.code.match(/-(preroll|midroll|postroll)-/))&&"preroll"!=b[1]?"midroll"==b[1]?2:3:1;var h="";l.checkConsentInstant(;var f=new URL("https://videodiff.smartadserver.com/ac?");f.searchParams.append("siteid",c.siteId);f.searchParams.append("pgid",c.pageId);f.searchParams.append("fmtid",c.formatId);f.searchParams.append("oc","1");f.searchParams.append("visit","S");f.searchParams.append("vcn","s");f.searchParams.append("out","vast4");f.searchParams.append("ab",b);f.searchParams.append("ps","1");f.searchParams.append("pb","0");f.searchParams.append("bidfloor",d);f.searchParams.append("vpw",parseInt(e[0]));
f.searchParams.append("vph",parseInt(e[1]));f.searchParams.append("vpaidt","js");f.searchParams.append("vpaidv","2");f.searchParams.append("pgdomain",l.getHost());f.searchParams.append("vpt",1);f.searchParams.append("vpmt",this.player.config.autoplay?this.player.muted()?2:1:3);f.searchParams.append("schain",this.schainData?l.formatSchainMacro(this.schainData):"");f.searchParams.append("tgt","uuid="+a.hb_cache_id+";hb_pb="+d);f.searchParams.append("tmstp",Math.random().toString().slice(2,13));f.searchParams.append("gdpr_consent",
h);Brid.log("Prebid smartAdServer url",f.href);return f.href}Brid.log("Prebid smartAdServer cannot create URL, config",c,"targeting",a);return!1},hasPbjs:function(b){return h._pbjsGlobals?b?0<=h._pbjsGlobals.indexOf(b):this.prebidConfig&&this.prebidConfig.prebid_variable&&0>h._pbjsGlobals.indexOf(this.prebidConfig.prebid_variable)||this.prebidConfigBackfill&&this.prebidConfigBackfill.prebid_variable&&0>h._pbjsGlobals.indexOf(this.prebidConfigBackfill.prebid_variable)?!1:!0:!1},onNextVideo:function(b){if(!this.blockedByTimer){this.blockedByTimer=
!0;setTimeout(this.$f(,1E3);for(key in this.refreshingTimeouts)clearTimeout(this.refreshingTimeouts[key]);this.refreshingTimeouts=[];Brid.log("Prebid onNextVideo",b.type,this.player.currentIndex,!!this.player.adsManager);this.bidding?Brid.log("Prebid onNextVideo bidding still in progress...",this.bidding,this.midrollBidding):this.player.config.monetize&&(this.ourBidding?(this.allowScroll=this.playbackOccurred=this.bidding=!1,this.midrollLastBiddedCuepoint=.5,b=this.adUnits.filter(,this.runBidding(this.optimize_price?this.optimizeFloorAdUnitFilter(this.adUnits.filter(function(a){return"preroll"==a.type}),0).concat(this.optimizeFloorAdUnitFilter(this.adUnits.filter(,0)):b,0)):"function"==typeof h.requestVideoBidsAgain&&(Brid.log("Prebid calling window.requestVideoBidsAgain()"),this.userPrebidFinished=this.biddingFinished=this.allowScroll=this.playbackOccurred=!1,h.requestVideoBidsAgain(),setTimeout(this.$f(function(){Brid.log("Prebid timeout occurred");
this.userPrebidFinished||this.playback()}),this.timeout)))}},replaceMacros:function(b){var a=JSON.stringify(b),c=this.player,d=c.currentSource&&c.currentSource.id?c.currentSource:c.config.Video&&c.config.Video.length&&!c.config.shuffle?c.config.Video[0]:{},e=q.BridIframeBurst?h.top:h,m=function(a){return JSON.stringify((d.iab_categories||"").split(",").filter(function(b){var c=!isNaN(b);return 0<b.length&&("categories"==a&&c||"keywords"==a&&!c)}))},f=function(a){var b="";"gdpr"==a||"gdpr_consent"==
a?l.checkConsentInstant(function(c){b="gdpr"==a?c&&c.gdprApplies?"1":"0":c?c.tcString:""}):"us_privacy"==a&&(l.usPrivacy?b=l.usPrivacy:"function"===typeof e.__uspapi&&e.__uspapi("getUSPData",1,function(a,c){b=c?a.uspString:""}));return b},g=function(){if(c.isFullScreen)return 7;if("inglide"===c.positionType)return 2;var a=c.el.getBoundingClientRect();return a.top+.5*a.height<e.innerHeight?1:3},k=function(a){var b=c.muted(),e="auto_play_sound_on auto_play_sound_off click_to_play mouse_over viewport_sound_on viewport_sound_off".split(" "),
b=c.config.autoplay?c.config.autoplayInview?b?6:5:b?2:1:3;return a?JSON.stringify([b]):e[b-1]};a.indexOf("__")&&(a=a.replace(/"__playerId__"/g,c.config.id),a=a.replace(/"__playerWidth__"/g,1),a=a.replace(/"__playerHeight__"/g,1),a=a.replace(/"__player_width__"/g,parseInt(0==c.width()||0==c.height()?"100%"==c.config.width?640:c.config.width:c.width())),a=a.replace(/"__player_height__"/g,parseInt(0==c.width()||0==c.height()?"100%"==c.config.height?360:c.config.height:c.height())),a=a.replace(/"__videoIabCategories__"/g,
m("categories")),a=a.replace(/"__videoIabKeywords__"/g,m("keywords")),a=a.replace(/"__placement__"/g,g()),a=a.replace(/"__plcmt__"/g,"Brid.OSPlayer"==c.name?"4":c.config.autoplay||0==c.config.start_volume?"2":"1"),a=a.replace(/"__playbackMethod__"/g,k(!0)),a=a.replace(/__playbackMethodStr__/g,k(!1)),a=a.replace(/__playerSize__/g,c.width()+"x"+c.height()),a=a.replace(/__pageUrl__/g,l.getEmbededUrl()),a=a.replace(/__prerollStart__/g,c.config.autoplay?"autoplay":"clicktoplay"),a=a.replace(/__contentLanguage__/g,
(e.document.documentElement.lang||navigator.language).slice(0,2).toLowerCase()),a=a.replace(/__(?:brid|bplr)_([a-zA-Z0-9_-]+)__/g,function(a,b){a=h.bridMacros||e.bridMacros||{};return"object"==typeof a&&b in a?a[b]:""}),a=a.replace(/"__stepContextual__"/g,JSON.stringify(l.getStepValues("contextual"))),a=a.replace(/"__step1PSegment__"/g,JSON.stringify(l.getStepValues("segment"))),a=a.replace(/"__stepLimitedAds__"/g,JSON.stringify(l.getStepValues("limitedads"))),a=a.replace(/__gdpr__/g,f("gdpr")),a=
a.replace(/__gdprConsent__/g,f("gdpr_consent")),a=a.replace(/__usPrivacy__/g,f("us_privacy")),d.id&&d.src&&(a=a.replace(/__videoId__/g,d.id),a=a.replace(/__videoTitle__/g,d.title),a=a.replace(/__videoDuration__/g,c.duration()||d.duration),a=a.replace(/__videoUrl__/g,-1<d.src.indexOf("http")?d.src:"https:"+d.src)),b=JSON.parse(a));return b},checkAliases:function(b){b.forEach(function(a){a.bids.forEach(function(a){a.alias&&(this.aliases=this.aliases||[],this.aliases.includes[a.alias]||(Brid.log("Prebid setting alias",
a.alias,"=>",a.bidder),this.aliases.push(a.alias),this.pbjs.aliasBidder(a.bidder,a.alias)),a.bidder=a.alias,delete a.alias)},this)},this)},getClosestPlayerSize:function(b){var a=this.player.width();return Array.isArray(b)&&Array.isArray(b[0])?b.reduce(function(b,d){return Math.abs(d[0]-a)<Math.abs(b[0]-a)?d:b}):b},getAdType:checkExpiredBids:function(){var b=this.player.adsManager.ads.midroll,a=this.player.adsManager.ads.postroll,c=[],d=[];
b&&b.adTags&&(c=c.concat(b.adTags));a&&a.adTags&&(c=c.concat(a.adTags));c=c.reduce(;c.forEach(function(a){("prebid"==a.source||"combined"==a.source)&&a.data&&a.data.timestamp&&Date.now()-a.data.timestamp>=1E3*this.refreshTime&&d.push(a.data.unitId)}.bind(this));b=this.adUnits.filter(;0<b.length&&(this.refreshingBids=!0,this.runBidding(b));Brid.log("Prebid expired adTags",b)},getBackfillPbjs:function(b){Brid.log("Prebid backfill using",
b,"pbjsGlobals",h._pbjsGlobals);h[b]=h[b]||{};h[b].que=h[b].que||[];this.pbjsBackfill=h[b]},getPbjs:function(b){if(this.pbjs)this.pbjs.onEvent&&!this.analyticsEventSet&&(this.pbjs.onEvent("beforeRequestBids",function(a){a[0].pId==this.player.id&&this.player.trigger("beforeRequestBids",a)}.bind(this)),this.pbjs.onEvent("bidTimeout",function(a){for(var b=0;b<a.length;b++)a[b].pId==this.player.id&&this.player.trigger("bidderTimeout",a[b])}.bind(this)),this.analyticsEventSet=!0);else{if(this.prebidConfig&&
this.prebidConfig.prebid_variable)b=this.prebidConfig.prebid_variable;else if(h._pbjsGlobals&&0<h._pbjsGlobals.length)b=0<=h._pbjsGlobals.indexOf("pbjs")?"pbjs":h._pbjsGlobals[h._pbjsGlobals.length-1];else if(!b)return;Brid.log("Prebid using",b,"pbjsGlobals",h._pbjsGlobals);h[b]=h[b]||{};h[b].que=h[b].que||[];(this.pbjs=h[b])&&this.pbjs.onEvent&&!this.analyticsEventSet&&(this.pbjs.onEvent("beforeRequestBids",function(a){a[0].pId==this.player.id&&this.player.trigger("beforeRequestBids",a)}.bind(this)),
this.pbjs.onEvent("bidTimeout",function(a){for(var b=0;b<a.length;b++)a[b].pId==this.player.id&&this.player.trigger("bidderTimeout",a[b])}.bind(this)),this.analyticsEventSet=!0)}},generateAuctionId:function(){for(var b=[25,21,17,13],a="",c=32;0<c;--c)a+="0123456789abcdefghijklmnopqrstuvwxyz"[Math.floor(36*Math.random())],b.includes(c)&&(a+="-");return a},destroy:);h.$bp.plugin("bridprebid",function(a,c){a=a||this;c=c||{};a.isReady?a.addChild(new h.$bp.Prebid(a,c)):
h.$bp.Util.merge(a.config.children,{Prebid:{}})});Brid.event.trigger(q,"bridpluginloaded")})(window,document);
