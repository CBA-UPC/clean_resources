/*! For license information please see 280.436ed8af.js.LICENSE.txt */
(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[280],{40280:function(t,e,r){t.exports=function(){"use strict";r n={},o={};Object.defineProperty(o,"__esModule",{value:!0}),o.compareVersion=void 0,o.compareVersion=function(t,e){void 0===e&&(e="3.0.27");var r=/(\d+)\.(\d+)\.(\d+)/,n=t.match(r),o=e.match(r);if(!n||!o)return console.error("[dw-js-sdk] 传入版本错误! from="+t+" to="+e),0;for(var i=1;i<4;i++){var s=parseInt(n[i]),a=parseInt(o[i]);if(s!==a)return a>s?1:-1}return 0}])arguments)},c=Obnew l(t)}var h=Ob.default=e},p=Object.freeze({__proto__:nulype,new r)},){retur)}return r}y(e,r,s){e(r,n,t)}}adata(t,e)next())}))},}([i,a])}}},__createBinding:c,_||c(e,t,r)},__values:u,__read);return t},__s];return n},__ncat(n||e)},__await:l,__asy,i[0][1])}},__asyo(e):e}:o}},__alue)}))}}},__makeTem:t.raw=e,t},_n h(e,t),e},__imdefault:t}},__classPrive:e.get(t)},__classPrivset(t,r),r}}),f=e(p),v={exports:{}};!function(t,e){!function(n){var o=e,i=t&&t.exports==o&&t,s="object"==typeof r.g&&r.g;s.global!==s&&s.window!==s||(n=s);var a=function(t){this.message=t};(a.prototype=new Error).name="InvalidCharacterEw new a(t)},u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=/[\t\n\f\r ]/3)+"==");return i},version:"1.0.0"};if(o&&!o.nodeType)if(i)i.exports=l;else for(var h in l)l.hasOwnProperty(h)&&(o[h]=l[h]);else n.base64=l}(this)}(v,v.exports);var y={};!furn i}(a)}}(t)}(y);var g={},m={};Object.defineProperty(m,"__esModule",{value:!0}),m.validateBoolean=void 0,m.validateBoolean=function(t,e){if("boolean"!=typeof t)throw Error("sdk error: "+e+" only accept argument of a type of Boolean!");return!0};var _={};Object.defineProperty(_,"__esModule",{value:!0}),_.validateDeviceId=void 0,_.validateDeviceId=function(t){if("string"!=typeof t&&"number"!=typeof t)throw Error("sdk error: _dw.setDeviceKey(deviceId) call error, deviceId should be type of String or Number");return!0};var w={};Object.defineProperty(w,"__esModule",{value:!0}),w.validateString=void 0,w.validateString=function(t,e){if("string"!=typeof t)throw Error("sdk error: "+e+" only accept argument of a type of String!");return!0};var b={},D={};Object.defineProperty(D,"__esModule",{value:!0}),D.copy=voingify(t))},Object.defineProperty(b,"__esModule",{value:!0}),b.DWConfig=void 0;var E=D,SltConfig()}return t.prototype.generateDefaultConfig=function(){var t=this.Reporter.defaults;return{protocol:11,st:"js",sv:"3.0.27",accountId:"",deviceId:"",appKey:t.appKey||"",channel:"default_channel",version:t.appVersion||"default_version",dbg:t.debugMode||!1,dbgUrl:"",customPublicAttrs:{},customPV:t.customPV||!1,defaultEvents:!0,noEncrypted:t.noEncrypted||!1}},t.prototype.validateKey=function(t){if("string"!=typeof t)throw Error("[dw error] config key should be string.");if(!(t in this.data))throw Error("[dw error] the key '"+t+" is invalid.'")},t.pr.data[t]=e},t.pris.data[t]},t.protothis.data)},t.prototype.setCustomAttrs[t]=e},t}();b.DWConfig=S;var P={},T={};Object.defineProperty(T,"__esModule",{value:!0}),T.DWRequest=void 0;var A=function(){function t(){}return t.prototype.stopPost=function(){return this.stopped=!0,this},t.prototype.caned=!1,this},t.prototype.isPostStopped=function(){return this.stopped},t}();T.DWRequest=A;var B={};Object.defineProperty(B,"__esModule",{value:!0}),B.dateFormat=void 0,B.dateFormat=functi10?"0"+t:t},r=t,n=[r.getFullYear(),r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,e(r.getDate())].join("-"),o=e(r.getHours()),i=e(r.getMinutes()),s=e(r.getSeconds()),a=r.getMilliseconds().toString(),c=a.length<3?"000".slice(0,3-a.length)+a:a;return[n,[o,i,s].join(":")+"."+c,"+0800"].join(" ")};var C={};Object.defineProperty(C,"__esModule",{value:!0}),C.generateGuid=void 0,C.g()+t()+t()};var O={};Object.defineProperty(O,"__esModule",{value:!0}),O.getSessionId=void 0,O.getSessionId=function(){try{if("undefined"!=typeof document&&"string"==typeof document.cookie)return/SESS\w*ID=([^;]+)/i.test(document.cookie)?RegExp.$1:""}catch(t){}return""};var x={},R=Object.freeze({__proto__:n(e,r)}))}}}}),I=e(R),k={},M={};!function(t){var e,r;Object.defineProperty(t,"__esModule",{value:!0}),t.Http=void 0,(r=(e=t.Http||(t.Http={})).Type||(e.Type={})).GET="GET",r.POST="POST",r.JSONP="jsonp"}(M),Object.defineProperty(k,"__esModule",{value:!0}),k.DWDynamic=void 0;var j=f,W=M,F=tCount=0,r}return j.__extends(e,t),e.prototype.read=function(){return this.local=this.dwProcess.dwStorage.readDynamicData(),this},e.promicData(t)},e.prototype.remove=function(){return this.local=null,this.dwProcess.dwStorage.removeDynamicData()},e.prototype.checkExpire=function(){return j.__awaiter(this,void 0,void 0,(function(){var t,e,r,n,o;return j.__generator(this,(function(i){switch(i.label){case 0:return this.local?[4,this.local]:[2,!0];case 1:return(t=i.sent())&&t.serverTime?(e=this.dwProcess.getRemoteDate())?[3,3]:[4,this.dwProcess.dwStorage.readTimeDifference()]:[2,!0];case 2:if(!(r=i.sent()))return[2,!0];this.dwProcess.timeDifference=r,i.label=3;case 3:return n=new Date(t.serverTime),o=null!=e?e:this.dwProcess.getRemoteDate(),[2,n.toLocaleDateString()!==o.toLocaleDateString()]}}))}))},e.prototype.generateRequestBody=function(t,e){var r,n,o,i,s,a;return void 0===t&&(t={}),j.__awaiter(this,void 0,void 0,(function(){return j.__generator(this,(function(c){return[2,{appVersion:t.version,sendUrlVersion:null!==(n=null===(r=null==e?void 0:e.sendUrls)||void 0===r?void 0:r.version)&&void 0!==n?n:0,transportControlVersion:null!==(i=null===(o=null==e?void 0:e.uploadStrategy)||void 0===o?void 0:o.version)&&void 0!==i?i:0,eventsVersion:null!==(a=null===(s=null==e?void 0:e.events)||void 0===s?void 0:s.version)&&void 0!==a?a:0,abTestName:"",abTestGroupId:""}]}))}))},e.prototype.body=function(){var t=this,e=this.dwProcess.dwConfig;return this.local?this.requestBody=this.local.then((function(r){return t.generateRequestBody(e.getAll(),null!=r?r:{})})):this.requestBody=this.generateRequestBody(e.getAll()),this},e.prototype.post=function(t){return j.__awaiter(this,void 0,void 0,(function(){var e,r,n,o,i,s,a,c=this;return j.__generator(this,(function(u){switch(u.label){case 0:return this.requestBody?this.isPostStopped()?[2]:(e=this.dwProcess.dwConfig.get("appKey"))?this.retryCount>=parseInt("15")||this.redirectCount>=parseInt("10")?[4,this.stopRetry().remove()]:[3,2]:(this.appKeyCount<parseInt("60")?(this.appKeyCount++,this.retry()):console.error('[dw-js-sdk] appKey not be detected, please set the appKey by "dw.setAppKey()"!'),[2]):(console.error("[dw-js-sdk] dwDynamic.body() needs to be invoked"),[2]);case 1:return u.sent(),console.error("[dw-js-sdk] requestDynamic failed for max connect count!"),[2];case 2:return t?(this.url=t,[3,7]):[3,3];case 3:return r=this.dwProcess.Reporter,n=r.defaults,(o=r.fixed).dynamicUrl?(this.url=o.dynamicUrl,[3,7]):[3,4];case 4:return this.local?[4,this.local]:[3,6];case 5:return(i=u.sent())&&i.dynamicUrl?this.url=i.dynamicUrl:this.url=n.dynamicUrl,[3,7];case 6:this.url=n.dynamicUrl,u.label=7;case 7:return this.dwProcess.emit("before-dynamic-send",{dwDynamic:this,dwProcess:this.dwProcess}),this.isPostStopped()?[2]:[4,this.requestBody];case 8:return s=u.sent(),a=this.url+"/api/dynamicParam/v1/app/"+e,this.dwProcess.Reporter.adapters.http.send(a,{type:W.Http.Type.JSONP,timeout:parseInt("3000"),data:s},(function(t,e){return j.__awaiter(c,void 0,void 0,(function(){var r,n=this;return j.__generator(this,(function(o){return r=function(t){n.dwProcess.emit("after-dynamic-send",{dwDynamic:n,dwProcess:n.dwProcess,dynamicData:t})},t||!e?(this.retryCount++,this.retry(this.url),r(),[2]):"object"==typeof e&&1===Object.keys(e).length&&e.dynamicUrl?(this.redirectCount++,this.retry(e.dynamicUrl,0),r(),[2]):(this.data=Promise.resolve(e),this.stopRetry().mergeLocal(e).handleData().data.then(r),[2])}))}))})),[2]}}))}))},e.prototype.retry=function(t,e){var r=this;return void 0===e&&(e=parseInt("1000")),this.stopRetry(),this.retryTimer=,r.post(t)}),e),this},e.prototypimer),this},e.prototype.handleData=function(t){var e=this,r=this.dwProcess;return this.data?(this.data=this.data.then((function(n){return j.__awaiter(e,void 0,void 0,(function(){return j.__generator(this,(function(e){switch(e.label){case 0:return n?t?[3,2]:(n.localTime=Date.now(),[4,this.save(n)]):(console.error("[dw-js-sdk] dynamic data resolved is null"),[2,n]);case 1:e.sent(),e.label=2;case 2:return n.serverTime&&(n.localTime?(r.timeDifference=n.serverTime-n.localTime,r.dwStorage.saveTimeDifference(r.timeDifference)):r.dwStorage.readTimeDifference().then((function(t){r.timeDifference=null!=t?t:0}))),[2,n]}}))}))})),this):(console.error("[dw-js-sdk] dynamic data is not resolved"),this)},e.prototype.mergeLocal=function(t){return this.data=this.local?this.local.then((function(e){if(e){var r={};try{for(var n in t){var o=n,i=t[o];"[object Object]"!==Object.prototype.toString.call(i)?r[o]=i:r[o]=Object.assign({},e[o],i)}}catch(t){}return r}return t})):Promise.resolve(t),this},e.prototype.useLocal=function(){var t=this,e=this.dwProcess;return this.data=this.local.then((function(t){return t})),this.handleData(!0),thisicData:r})})),this},e}(T.DWRequest);k.DWDynamic=F,Object.defineProperty(x,"__esModule",{value:!0}),x.DWProcess=void 0;var L=f,N=L.__importDefault(I),V=k,z=P,H=function(){function t(e,r,n,o){this.Reporter=e,this.dwConfig=r,this.dwStorage=n,this.dwService=o,this.state="prepare",this.cache={appEndExtraEvents:[],defaultEventsData:{},others:{}},this.dwDynamic=new V.DWDynamic(this),this.eventBus=N.default(),t.instances.push(this)}return t.prototype.getRemoteDate=function(t){if(void 0===t&&(t=new Date),null!=this.timeDifference){var e=t.getTime()+this.timeDifference,r=60*(new Date).getTimezoneOffset()*1e3,n=new Date;return n.setTime(e+r+288e5),n}},t.prototype.sendPageView=function(){var e=this.Reporter.adapters.osInfo,r=this.cache.defaultEventsData,n=new z.DWEvent("_page_view",L.__assign(L.__assign(L.__assign({},r.common),r._page_view),{title:e.getTitle(),url:e.getUrl(),refer:e.getReferer()}),this);return t.printLog("Process","sendPageView","",n),n.post()},t.prototype.sendAppStart=function(t){return void 0===t&&(t={}),L.__awaiter(this,void 0,void 0,(function(){var e,r,n;return L.__generator(this,(function(o){switch(o.label){case 0:return[4,this.dwStorage.readIsFirstVisit()];case 1:return e=o.sent(),r=this.cache.defaultEventsData,e&&this.dwStorage.saveVisitAlready(),n=new z.DWEvent("_app_start",L.__assign(L.__assign(L.__assign(L.__assign({},r.common),r._app_start),{is_first_time:e.toString(),start_type:this.hotLaunch?"2":"1",resume_from_background:"false"}),t),this),this.startDate||(this.startDate=new Date),[2,n.post()]}}))}))},t.prototype.generateAppEndEvent=function(t){var e=this;void 0===t&&(t={});var r=[],n=this.cache.defaultEventsData;return this.cache.appEndExtraEvents.forEach((function(t){t.localDate=new Date,t.remoteDate=e.getRemoteDate(t.localDate)})),r.push.apply(r,L.__spreadArray([],L.__read(this.cache.appEndExtraEvents))),new z.DWEvent("_app_end",L.__assign(L.__assign(L.__assign(L.__assign({},n.common),n._app_end),{use_duration:this.startDate?Date.now()-this.startDate.getTime():0}),t),this,null,r).body()},t.prototype.sendAppEnd=function(t){void 0===t&&(t={});var e=this.generateAppEndEvent(t);return this.hotLaunch=!0,e.post()},t.prototype.prepare=function(){return L.__awaiter(this,void 0,void 0,(function(){var e;return L.__generator(this,(function(r){switch(r.label){case 0:return this.state="prepare",t.printLog("Process","prepare","preparing"),[4,new Promise((function(t){return setTimeout(t)}))];case 1:return r.sent(),[4,this.Reporter.adapters.osInfo.getInfo()];case 2:return r.sent(),e=this.cache,[4,this.dwStorage.readDeviceId(this.dwConfig.get("appKey"),this.dwConfig)];case 3:return e.deviceId=r.sent(),[4,this.dwStorage.readEvents(this)];case 4:return r.sent(),t.printLog("Process","prepare","prepare done"),this.state="normal",[2]}}))}))},t.prototype.refresh=function(e){var r;return L.__awaiter(this,void 0,void 0,(function(){var n,o;return L.__generator(this,(function(i){switch(i.label){case 0:return this.state="prepare",this.emit("before-refresh",{dwProcess:this}),n=null!==(r=this.getRemoteDate())&&void 0!==r?r:new Date,o=this.startDate&&n.toDateString()!==this.startDate.toDateString()||e,this.dwConfig.get("defaultEvents")&&o?[4,this.sendAppEnd()]:[3,2];case 1:i.sent(),i.label=2;case 2:return[4,this.init({fresh:!0,isForceRefresh:e})];case 3:return i.sent(),t.printLog("Process","refresh","",{currentDate:n,startDate:this.startDate},!0),this.state="normal",[2]}}))}))},t.prototype.init=function(e){var r,n;return void 0===e&&(e={}),L.__awaiter(this,void 0,void 0,(function(){var o,i,s,a=this;return L.__generator(this,(function(c){switch(c.label){case 0:return this.state="prepare",t.printLog("Process","init"),this.dwConfig.get("defaultEvents")?(o=function(){return L.__awaiter(a,void 0,void 0,(function(){var e;return L.__generator(this,(function(r){return(e=[]).push(this.sendAppStart()),this.dwConfig.get("customPV")||e.push(this.sendPageView()),t.printLog("Process","init","sending defaultEvent",e),[2,Promise.all(e)]}))}))},e.fresh&&this.startDate||e.isForceRefresh?(i=null!==(r=this.getRemoteDate())&&void 0!==r?r:new Date,t.printLog("Process","init","fresh",{startDate:this.startDate,currentDate:i,isForceRefresh:e.isForceRefresh}),i.toDateString()!==this.startDate.toDateString()||e.isForceRefresh?(this.startDate=null,this.hotLaunch=!1,[4,o()]):[3,2]):[3,3]):[3,6];case 1:c.sent(),c.label=2;case 2:return[3,5];case 3:return[4,o()];case 4:c.sent(),c.label=5;case 5:null===(n=this.Reporter.defaults)||void 0===n||n.handleAppEnd(this,e),c.label=6;case 6:e.fresh||(this.on("after-dynamic-send",(function(e){e.dynamicData&&(a.dynamicData=e.dynamicData,a.state="normal",t.printLog("Process","init","sending allStorages"),a.sendAllStorages())})),this.on("after-event-send",(function(e){(null==e?void 0:e.response)&&!e.response.error&&(clearTimeout(s),s=rages()}))}),800))}))),c.label=7;case 7:return c.trys.push([7,11,,13]),this.dwConfig.get("dbg")?(this.dwDynamic.read().body().post(),[3,10]):[3,8];case 8:return[4,this.dwDynamic.read().checkExpire()];case 9:c.sent()?(t.printLog("Process","init","getting dwDynamic"),this.dwDynamic.body().post()):this.dwDynamic.useLocal(),c.label=10;case 10:return[3,13];case 11:return c.sent(),[4,this.dwDynamic.remove()];case 12:return c.sent(),this.dwDynamic.body().retry(),[3,13];case 13:return[2]}}))}))},t.prototype.sendAllStorages=function(){this.dwService.sendWaitEvents(this),this.dwService.sendCacheEvents(this),this.dwService.sendFailEvents(this)},t.printLog=function(t,e,r,n,o,i){void 0===r&&(r="");try{((null===globalThis||void 0===globalThis?void 0:globalThis.dw_print_debug_log)||i)&&console.log("%c js-sdk-3.0.27 %c "+t+"-"+e+" %c "+(r||"")+"%c ","background:#35495e ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff","background: "+(o?"#e5447a":"#41b883")+" ; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff","background:transparent; font-weight: bolder","font-weight: normal",n||"")}catch(t){}},t.prototget("dbg")},t.prototype.on=function(t,e){return this.eventBus.on(t,e),this},t.prototype.off=function(t,e){return this.eventBus.off(t,e),this},t.pro(t,e),this},t.instances=[],t}();x.DWProcess=H,Object.defineProperty(P,"__esModule",{value:!0}),P.DWEvent=void 0;var K=f,U=B,q=C,J=O,G=x,X=function(t){function e(e,r,n,o,i){var s,a,c,u,d,l,h,p,f;void 0===i&&(i=[]);var v=t.call(this)||this;return v.name=e,v.data=r,v.dwProcess=n,v.mixin=o,v.combineEvents=i,v.id=null!==(a=null===(s=v.mixin)||void 0===s?void 0:s.id)&&void 0!==a?a:q.generateGuid(),v.from=null!==(u=null===(c=v.mixin)||void 0===c?void 0:c.from)&&void 0!==u?u:"event",v.position="event",v.failCount=null!==(l=null===(d=v.mixin)||void 0===d?void 0:d.count)&&void 0!==l?l:0,v.urls=null===(h=v.mixin)||void 0===h?void 0:h.urls,G.DWProcess.printLog("Event","constructor","generatingEvent",v),o?(null!==(p=v.name)&&void 0!==p||(v.name=o.name),null!==(f=v.data)&&void 0!==f||(v.data=o.data),v.localDate=o.localTime?new Date(o.localTime):new Date,v.remoteDate=o.remoteTime?new Date(o.remoteTime):n.getRemoteDate(v.localDate)):(v.localDate=new Date,v.remoteDate=n.getRemoteDate(v.localDate)),v.urls||v.generateEventUrls(),G.DWProcess.printLog("Event","constructor","generatedEvent",v),v}return K.__extends(e,t),Object.defineProperty(e.prototype,"urlsParsed",{get:function(){return[this.urls.replace(/^\(|\)$/g,"").split(" ")[0]]},enumerable:!1,configurable:!0}),e.prototype.generateEventUrls=function(){var t,e,r,n,o,i,s=this.dwProcess,a=s.dwConfig,c=s.dynamicData,u=s.Reporter,d=null!==(e=null===(t=null==c?void 0:c.sendUrls)||void 0===t?void 0:t.urls)&&void 0!==e?e:u.defaults.sendUrl,l=u.defaults.debugUrl,h=a.getAll(),p=d;if(h.dbg)p=h.dbgUrl||(null===(r=null==c?void 0:c.sendUrls)||void 0===r?void 0:r.debugUrls)||l;else for(var f=null!==(i=null===(o=null===(n=null==c?void 0:c.events)||void 0===n?void 0:n.data)||void 0===o?void 0:o.length)&&void 0!==i?i:0,v=0;v<f;v++){var y=c.events.data[v];if(y.name===this.name){p=(null==y?void 0:y.sendUrls)||d;break}}return G.DWProcess.printLog("Event","generateEventUrls","",{urls:p,name:this.name}),this.urls=p,this},e.prototype.generateEventObject=function(){var t,e,r,n,o,i,s,a,c=this.dwProcess,u=c.dynamicData;this.remoteDate||(this.remoteDate=c.getRemoteDate(this.localDate)),!this.dataEncrypted&&this.data&&c.emit("event-data-encrypt",{dwEvent:this,dwProcess:c,eventData:this.data});var d={_time:U.dateFormat(null!==(e=this.remoteDate)&&void 0!==e?e:this.localDate),_session_id:J.getSessionId(),_event_id:this.id,_abtest_name:null!==(n=null===(r=null==u?void 0:u.abTestTag)||void 0===r?void 0:r.name)&&void 0!==n?n:"",_abtest_group_id:null!==(i=null===(o=null==u?void 0:u.abTestTag)||void 0===o?void 0:o.groupId)&&void 0!==i?i:""};return G.DWProcess.printLog("Event","generateEventObject","",K.__assign(K.__assign({name:this.name},d),null!==(s=this.dataEncrypted)&&void 0!==s?s:this.data)),(t={_type:"general"})[this.name]=K.__assign(K.__assign({},d),null!==(a=this.dataEncrypted)&&void 0!==a?a:this.data),t},e.prototype.generateEventAdd=function(){var t=this.dwProcess.Reporter.adapters.osInfo;return{_brand:t.getBrand(),_os:t.getOs(),_model:t.getModel(),_screen:t.getScreen(),_os_ver:t.getOsVer(),_carrier:t.getCarrier(),_network:t.getNetwork(),_language:t.getLanguage(),_gps:t.getGps()}},e.prototype.generateEventBody=function(){var t,e=this.dwProcess,r=e.cache,n=e.dwConfig.getAll(),o=n.deviceId||r.deviceId,i=null!==(t=e.getRemoteDate())&&void 0!==t?t:new Date,s={_p:n.protocol,_st:n.st,_sv:n.sv,_app:n.appKey,_gid:o,_did:o,_aid:n.accountId,_ut:U.dateFormat(i),_rid:q.generateGuid(),_av:n.version,_ch:n.channel,_dbg:n.dbg,_add:this.generateEventAdd()};return Object.assign(s,n.customPublicAttrs),s},e.prototype.validate=function(){if(this.eventValidate)return this;if(!this.name)throw Error('"_dw.onEvent(name, data)" call error, name is not allowed to be empty!');if(this.name&&"string"!=typeof this.name)throw Error('"_dw.onEvent(name, data)" call error, name should be String!');if(void 0!==this.data){var t=Object.prototype.toString.call(this.data).toLowerCase();if("[object object]"!==t&&"[object null]"!==t)throw Error('"_dw.onEvent(name, data)" call error, data should be Object!');for(var e in this.data)if(Object.prototype.hasOwnProperty.call(this.data,e)&&null!=this.data[e]&&!/string|boolean|number/.test(typeof this.data[e]))throw Error('"_dw.onEvent(name, data)" call error, value should be string/number/boolean!')}return this.eventValidate=!0,this},e.prototype.body=function(){var t=this;if("wait"!==this.from&&this.validate(),!this.eventBody){this.eventBody=this.generateEventBody();try{this.events=this.eventBody._events=this.data?[this.generateEventObject()]:[]}catch(t){G.DWProcess.printLog("Event","body","generatedEventBody-error",{event:this,error:t})}var e=function(r){r.forEach((function(r){var n;try{r.name&&t.events.push(r.generateEventObject()),(null===(n=r.combineEvents)||void 0===n?void 0:n.length)&&e(r.combineEvents)}catch(e){G.DWProcess.printLog("Event","body","combineEvents-generatedEventBody-error",{event:t,error:e})}}))};e(this.combineEvents),this.urls||this.generateEventUrls()}return G.DWProcess.printLog("Event","body","generatedEventBody",this),this},e.prototype.checkDisabled=function(t){for(var e,r,n,o=null!==(n=null===(r=null===(e=null==t?void 0:t.events)||void 0===e?void 0:e.data)||void 0===r?void 0:r.length)&&void 0!==n?n:0,i=0;i<o;i++){var s=t.events.data[i];if(this.name===s.name&&(!0===s.disable||"true"===s.disable))return!0}return!1},e.prototype.post=function(t){return K.__awaiter(this,void 0,void 0,(function(){var e,r,n,o,i=this;return K.__generator(this,(function(s){return e=this.dwProcess,r=e.dwService,n=e.dynamicData,t&&(this.urls=t),this.isPostStopped()?(G.DWProcess.printLog("Event","post","event stopped",this,!0),[2,!1]):"prepare"===e.state?(G.DWProcess.printLog("Event","post","process preparing",this,!0),this.saveCache(),[2,!1]):this.checkDisabled(n)?(G.DWProcess.printLog("Event","post","event Expired",this,!0),[2,!1]):(e.emit("before-event-send",{dwEvent:this,dwProcess:e}),this.isPostStopped()?(G.DWProcess.printLog("Event","post","event stopped 2",this,!0),[2,!1]):(this.body(),this.eventBodyEncrypted||e.emit("event-body-encrypt",{dwEvent:this,dwProcess:e,eventBody:this.eventBody}),o=this.eventBodyEncrypted,this.isPostStopped()?[2,!1]:[2,new Promise((function(t,n){var s=0,a=0,c=function(t,r){e.emit("after-event-send",{dwEvent:i,dwProcess:e,response:{error:t,data:r}})},u=function(){var e,n=i.urlsParsed[s];if(!n)return t(!0);if("string"==typeof n)e=n;else{if(!(n.length>a))return a=0,s++,u();e=n[a]}r.sendEvent(e,o,(function(r,o){r?s===i.urlsParsed.length-1?(i.saveFail().log("event upload fail"),c(r,o),t(!1)):(s++,u()):"string"==typeof n||a===n.length-1?(i.log("event upload success",{url:e}),c(r,o),t(!0)):(a++,u())}))};u()}))]))}))}))},e.prototype.generateCommonStorageEvent=function(){var t,e;return{id:this.id,name:this.name,from:this.from,localTime:this.localDate.getTime(),remoteTime:null!==(e=null===(t=this.remoteDate)||void 0===t?void 0:t.getTime())&&void 0!==e?e:0,data:this.data}},e.prototype.saveCache=function(){var t=this.dwProcess.dwStorage;return this.cancelStopPost(),"cache"!==this.position&&(this.position="cache",G.DWProcess.printLog("Event","saveCache","saving events",this),t.cache.save([this])),this},e.prototype.saveWait=function(){G.DWProcess.printLog("Event","saveWait","saving events",this);var t=this.dwProcess.dwStorage,e=[],r=function(t){"wait"!==t.position&&(t.position="wait",e.push(t))};return this.cancelStopPost(),this.data&&r(this),this.combineEvents.forEach(r),t.wait.save(e),this},e.prototype.saveFail=function(){G.DWProcess.printLog("Event","saveFail","saving events",this);var t=this.dwProcess.dwStorage,e=parseInt("10"),r=[],n=function(t){t.failCount<e&&"fail"!==t.position&&(t.position="fail",r.push(t))};return this.cancelStopPost(),this.data&&n(this),this.combineEvents.forEach(n),t.fail.save(r),this},e.prototype.log=function(t,e){void 0===e&&(e={});var r=this.dwProcess,n=e.name,o=void 0===n?this.name:n,i=e.data,s=void 0===i?this.data:i,a=e.url,c=void 0===a?this.urls:a,u=e.body,d=void 0===u?this.eventBody:u;return G.DWProcess.printLog("LOG",t,"",{time:(new Date).toLocaleString(),name:o,data:s,url:c,length:d._events.length,body:d},!0,r.dwConfig.get("dbg")),this},e.prototype.destroy=function(){this.data=null,this.mixin=null,this.combineEvents.length=0,this.dataEncrypted=null,this.events=null,this.eventBody=null,this.eventBodyEncrypted=null},e}(T.DWRequest);P.DWEvent=X;var Z={},Y={};!function(t){var e,r;Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=void 0,(r=(e=t.Storage||(t.Storage={})).Name||(e.Name={})).STORE_FIRST_VISIT_NAME="dw_store_first_item_token",r.STORE_START_TIMESTAMP_NAME="dw_store_timestamp_key",r.STORE_FAILED_EVENTS_NAME="dw_store_queen_data_events",r.STORE_WAIT_SEND_EVENTS_NAME="dw_store_wait_send_events",r.STORE_CACHE_EVENTS_NAME="dw_store_cache_events",r.STORE_DYNAMIC_DATA_NAME="dw_store_dynamic_data",r.STORE_TIME_DIFFERENCE="dw_store_time_sub",(e.CommonName||(e.CommonName={})).STORE_DEVICE_ID_NAME="dw_store_device_id_key"}(Y),Object.defineProperty(Z,"__esModule",{value:!0}),Z.DWStorage=void 0;var Q=f,$=Y,tt=C,et=P,rt=x,nt=function(){function t(e,r,n){this.name=e,this.dwStorage=r,this.generateSyncData=n,this.data=[],this.suffixCount=0,t.instances.push(this)}return t.prototype.save=function(e){var r,n,o=t.instances,i=t.maxLength,ata.length}),0)+e.length-i;if(s<=0)(r=this.data).push.apply(r,Q.__spreadArray([],Q.__read(e)));else{var a=e.length-s;a>0&&(n=this.data).push.apply(n,Q.__spreadArray([],Q.__read(e.slice(0,a))))}this.debounceSync()},t.pro this.data},t.prototype.reset=function(){this.data=[],clearTimeout(this.debounceSyncTimer),this.sync()},t.prototype.sync=function(){return this.dwStorage.set(this.name,JSON.stringify(this.data.map(this.generateSyncData))).catch()},t.prototype.debounceSync=function(){var t=this,e=this.dwStorage,r=this.data;clearTimeout(this.debounceSyncTimer),this.debounceSyncTimer=setTimeout((function(){e.suffix?(t.suffixCount=0,e.set(t.name,JSON.stringify(r.map(t.generateSyncData))).catch()):(t.suffixCount<parseInt("60;")&&t.debounceSync(),t.suffixCount++)}),100)},t.prototype.resync=function(t){var e=this;return this.dwStorage.get(this.name).then((function(r){var n;try{""===r&&(r="[]");var o=JSON.parse(r);(n=e.data).push.apply(n,Q.__spreadArray([],Q.__read(o.map((function(e){return new et.DWEvent(null,null,t,e)})))))}catch(t){rt.DWProcess.printLog("Storage","resync","ERROR",t,!0),e.reset()}}))},t.instances=[],t.maxLength=parseInt("5000"),t}(),ot=function(){function t(t){this.Reporter=t,this.cache=new nt($.Storage.Name.STORE_CACHE_EVENTS_NAME,this,(function(t){return Q.__assign({type:"cache"},t.generateCommonStorageEvent())})),this.wait=new nt($.Storage.Name.STORE_WAIT_SEND_EVENTS_NAME,this,(function(t){return Q.__assign({type:"wait",urls:t.urls},t.generateCommonStorageEvent())})),this.fail=new nt($.Storage.Name.STORE_FAILED_EVENTS_NAME,this,(function(t){return Q.__assign({type:"fail",urls:t.urls,count:t.failCount+1},t.generateCommonStorageEvent())}))}return t.prototype.readEvents=function(t){return Promise.all([this.cache.resync(t),this.wait.resync(t),this.fail.resync(t)])},t.prototype.readDeviceId=function(t,e){return Q.__awaiter(this,void 0,void 0,(function(){var r,n,o,i,s,a,c,u,d,l,h,p,f,v,y,g,m;return Q.__generator(this,(function(_){switch(_.label){case 0:return r=this.Reporter.adapters,n=r.storage,o=r.osInfo,[4,nTimeout(t)}))];case 1:return _.sent(),i="web"===n.type,s=$.Storage.CommonName.STORE_DEVICE_ID_NAME,a=s+"@"+t,c=function(){var t=e.get("deviceId");return n.set(a,t),t},rt.DWProcess.printLog("Storage","readDeviceId","",{deviceId:c()}),c()?[2,c()]:[4,o.getDeviceId()];case 2:return u=_.sent(),c()?[2,c()]:u?[2,u]:[4,n.get(s)];case 3:if(d=_.sent(),c())return[2,c()];if(i){if(l=window.localStorage.getItem(a))return d||this.syncDeviceId(l,t,{common:"cover"}),[2,l];if(d)return this.syncDeviceId(d,t,{self:"cover"}),[2,d];for(h=s+"@",p=window.localStorage.length,f=0;f<p;f++)if(0===(v=window.localStorage.key(f)).indexOf(h)&&(y=window.localStorage.getItem(v)))return this.syncDeviceId(y,t,{common:"cover",self:"cover"}),[2,y];return g=tt.generateGuid(),this.syncDeviceId(g,t,{common:"cover",self:"cover"}),[2,g]}if(d)return[2,d];m=tt.generateGuid(),_.label=4;case 4:return _.trys.push([4,6,,8]),[4,n.set(s,m)];case 5:return _.sent(),[3,8];case 6:return _.sent(),[4,this.readDeviceId(t,e)];case 7:return[2,_.sent()];case 8:return[2,m]}}))}))},t.prototype.syncDeviceId=function(t,e,r){var n=this.Reporter.adapters.storage,o=$.Storage.CommonName.STORE_DEVICE_ID_NAME;if(rt.DWProcess.printLog("Storage","syncDeviceId","",{positions:r,deviceId:t,appKey:e}),"web"===n.type&&e){var i=o+"@"+e;switch(r.self){case"cover":n.set(i,t);break;case"fill":setTimeout((function(){n.get(i).then((function(e){!e&&n.set(i,t)}))}),50)}}switch(r.common){case"cover":n.set(o,t);break;case"fill":setTimeout((function(){n.get(o).then((function(e){!e&&n.set(o,t)}))}),50)}},t.prototyps.suffix=t},t.prototype.set=function(t,e){var r=this.getInnerKey(t);return this.Reporter.adapters.storage.set(r,e)},t.prototype.get=function(t){var e=this.getInnerKey(t);return this.Reporter.adapters.storage.get(e)},t.prototype.rm=function(t){var e=this.getInnerKey(t);return this.Reporter.adapters.storage.rm(e)},t.prototype.s.suffix:t},t.prototype.readIsFirstVisit=function(){return Q.__awaiter(this,void 0,void 0,(function(){return Q.__generator(this,(function(t){switch(t.label){case 0:return[4,this.get($.Storage.Name.STORE_FIRST_VISIT_NAME)];case 1:return[2,"true"!==t.sent()]}}))}))},t.prototype.saveVisitAlready=function(){return this.set($.Storage.Name.STORE_FIRST_VISIT_NAME,"true")},t.prototype.saveDynamicData=function(t){if("object"==typeof t)return this.set($.Storage.Name.STORE_DYNAMIC_DATA_NAME,JSON.stringify(t))},t.prototype.readDynamicData=function(){return Q.__awaiter(this,void 0,void 0,(function(){var t;return Q.__generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.get($.Storage.Name.STORE_DYNAMIC_DATA_NAME)];case 1:return t=e.sent(),[2,JSON.parse(t||"null")];case 2:return e.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.removeDynamicData=function(){return Q.__awaiter(this,void 0,void 0,(function(){return Q.__generator(this,(function(t){return[2,this.rm($.Storage.Name.STORE_DYNAMIC_DATA_NAME)]}))}))},t.prototype.saveTimeDifference=function(t){return void 0===t&&(t=0),this.set($.Storage.Name.STORE_TIME_DIFFERENCE,t.toString())},t.prototype.readTimeDifference=function(){return Q.__awaiter(this,void 0,void 0,(function(){var t;return Q.__generator(this,(function(e){switch(e.label){case 0:return[4,this.get($.Storage.Name.STORE_TIME_DIFFERENCE)];case 1:return t=e.sent(),[2,parseInt(t||"0")]}}))}))},t}();Z.DWStorage=ot;var it={};Object.defineProperty(it,"__esModule",{value:!0}),it.DWService=void 0;var st=P,at=M,ct=x,ut=function(){function t(t){this.Reporter=t}return t.prototype.sendCacheEvents=function(t){var e=t.dwStorage,r=e.cache.read();e.cache.reset(),e.wait.save(r),r.length&&ct.DWProcess.printLog("Service","sendCacheEvents","",r),this.sendWaitEvents(t)},t.prototype.sendFailEvents=function(t){var e=t.dwStorage,r=e.fail.read();e.fail.reset(),e.wait.save(r),r.length&&ct.DWProcess.printLog("Service","sendFailEvents","",r),this.sendWaitEvents(t)},t.prototype.sendWaitEvents=function(e){var r,n,o,i,s=e.dwStorage,a=e.dynamicData,c=s.wait.read();if(c.length&&ct.DWProcess.printLog("Service","sendWaitEvents","",c),c.length){s.wait.reset();var u={},d=(null!==(r=e.getRemoteDate())&&void 0!==r?r:new Date).getTime(),l=c.reduce((function(e,r){var n;return d-(null!==(n=r.remoteDate)&&void 0!==n?n:r.localDate).getTime()>t.maxExpireTime||r.id in u||(u[r.id]=1,e[r.urls]||(e[r.urls]=[]),e[r.urls].push(r),r.position="event"),e}),{});ct.DWProcess.printLog("Service","sendWaitEvents","eventMap",l);var h=null!==(i=null===(o=null===(n=null==a?void 0:a.uploadStrategy)||void 0===n?void 0:n.transportControl)||void 0===o?void 0:o.splitSize)&&void 0!==i?i:parseInt("100");for(var p in l)if(Object.prototype.hasOwnProperty.call(l,p)){var f=l[p];ct.DWProcess.printLog("Service","sendWaitEvents","newEvent-combineEvents",{key:p,events:f});for(var v=0;v<Math.ceil(f.length/h);v++)new st.DWEvent(null,null,e,{from:"wait"},f.slice(h*v,h*(v+1))).post()}}},t.prototype.sendEvent=function(t,e,r){return this.Reporter.adapters.http.send(t,{type:at.Http.Type.POST,data:e,header:{"dw-protocol":"1.0"},timeout:parseInt("3000")},r)},t.maxExpireTime=2592e6,t}();it.DWService=ut,Object.defineProperty(g,"__esModule",{value:!0}),g.Reporter=void 0;var dt=f,lt=m,ht=_,pt=w,ft=b,vt=P,yt=x,gt=Z,mt=it,_t=function(){function t(e){var r=this;void 0===e&&(e={}),this.options=e,this.dwProcess=new yt.DWProcess(t,new ft.DWConfig(t),new gt.DWStorage(t),new mt.DWService(t)),this.version="3.0.27",t.defaultBinds.length&&t.defaultBin.callback)})),yt.DWProcess.printLog("Reporter","init")}return t.appendPreBind=function(t){for(var e=0;e<this.defaultBinds.length;e++)if(this.defaultBinds[e].name===t.name)return this;this.defaultBinds.pusll(this,e)},t.prototype.onEvent=function(t,e){void 0===e&&(e={}),yt.DWProcess.printLog("Reporter","onEvent",t,e,!0),null===e&&(e={}),new vt.DWEvent(t,e,this.dwProcess).validate().post()},t.prototype.setAccountId=function(t){return void 0===t&&(t=""),this.dwProcess.dwConfig.set("accountId",String(t)),yt.DWProcess.printLog("Reporter","setAccountId",t),this},t.prototype.setAppKey=function(t){var e=this;if(t&&pt.validateString(t,"dw.setAppKey(appKey)")){var r=t;this.options.storageSuffix&&(r+="_"+this.options.storageSuffix);var n=function(){e.dwProcess.dwStorage.setSuffix(r),yt.DWProcess.printLog("Reporter","setSuffix",r),e.dwProcess.prepess.init()}))};yt.DWProcess.instpKey")===t}))?return n()}),300):n(),yt.DWProcess.printLog("Reporter","setAppKey",t),this.dwProcess.dwConfig.set("appKey",t)}return this},t.prototype.setChannel=function(t){return t&&pt.validateString(t,"dw.setChannel(channel)")&&(this.dwProcess.dwConfig.set("channel",t),yt.DWProcess.printLog("Reporter","setChannel",t)),this},t.prototype.setCustomPublicAttrs=function(t,e){if(yt.DWProcess.printLog("Reporter","setCustomPublicAttrs","",t),t){if("string"==typeof t)return this.dwProcess.dwConfig.setCustomPublicAttrs(t,e),this;if("object"==typeof t)return this.dwProcess.dwConfig.set("customPublicAttrs",t),this}throw Error("sdk error: setCustomPublicAttrs(key, value) arguments error!")},t.prototype.setCustomPV=function(t){return lt.validateBoolean(t,"dw.setCustomPV(bool)")&&(this.dwProcess.dwConfig.set("customPV",t),yt.DWProcess.printLog("Reporter","setCustomPV","",t)),this},t.prototype.setDebug=function(t,e,r){return void 0===e&&(e=""),void 0===r&&(r=!1),lt.validateBoolean(t,"dw.setDebug(debug, [url], noEncrypted)")&&this.dwProcess.dwConfig.set("dbg",t),e&&pt.validateString(e,"dw.setDebug(debug, [url], noEncrypted)")&&this.dwProcess.dwConfig.set("dbgUrl",e),e&&lt.validateBoolean(r,"dw.setDebug(debug, [url], noEncrypted)")&&this.dwProcess.dwConfig.set("noEncrypted",r),this},t.prototype.setDefaultEvents=function(t){return lt.validateBoolean(t,"dw.setDefaultEvents(bool)")&&(this.dwProcess.dwConfig.set("defaultEvents",t),yt.DWProcess.printLog("Reporter","setDefaultEvents","",t)),this},t.prototype.setDeviceKey=function(t){if(t&&ht.validateDeviceId(t)){var e=this.dwProcess,r=e.dwConfig,n=e.dwStorage;yt.DWProcess.printLog("Reporter","setDeviceKey",t),r.set("deviceId",t),n.syncDeviceId(t,r.get("appKey"),{common:"fill",self:"fill"})}return this},t.prototype.setDefaultEventsData=function(t,e){void 0===e&&(e="common");var r=this.dwProcess;return new vt.DWEvent("_setDefaultEventsData",t,r).validate(),yt.DWProcess.printLog("Reporter","setDefaultEventsData","",{data:t,position:e}),r.cache.defaultEventsData[e]=t,this},t.prototype.setAppEndExtraData=function(t,e){var r=this.dwProcess;return yt.DWProcess.printLog("Reporter","setAppEndExtraData","",{data:e,name:t}),"string"==typeof t?r.cache.appEndExtraEvents.push(new vt.DWEvent(t,e,r).validate()):r.cache.appEndExtraEvents=t.map((function(t){var e=dt.__read(t,2),n=e[0],o=e[1];return new vt.DWEvent(n,o,r).validate()})),this},t.prototype.setVersion=function(t){return t&&pt.validateString(t,"dw.setVersion(version)")&&(this.dwProcess.dwConfig.set("version",t),yt.DWProcess.printLog("Reporter","setVersion",t)),this},t.prototype.sendPageView=function(){return this.dwProcess.dwConfig.get("customPV")?this.dwProcess.sendPageView():console.error("[dw-js-sdk] sendPageView > 请先使用dw.setCustomPV(true)开启自定义pv"),this},t.prototype.on=function(t,e){return this.dwProcess.on(t,e),yt.DWProcess.printLog("Reporter","on","",t),this},t.adapters={http:{},osInfo:{},storage:{}},t.fixed={},t.defaults={},t.defaultBinds=[],t}();g.Reporter=_t;var wt={},bt={};Object.defineProperty(bt,"__esModule",{value:!0}),bt.HttpBase=bt.HttpAdapter=void 0;var Dt=function(){function t(){}return t.prototype.formatQuery=function(t){var e=[];for(var r in t){var n=t;e.push(encodeURIComponent(r)+"="+encodeURIComponent(n[r]))}return e.join("&")},t.prototype.transform=function(t,e){for(var r=0;r<e.length;r++){var n=e[r];"function"==typeof n&&(t=n(t))}return t},t.prototype.getJsonpTransformer=function(){return function(t){try{return JSON.parse(t.slice(t.indexOf("(")+1,t.length-1))}catch(e){return t}}},t}();bt.HttpBase=Dt;var Et=function(){};bt.HttpAdapter=Et,Object.defineProperty(wt,"__esModule",{value:!0}),wt.HttpAdapterWeb=void 0;var St=f,Pt=M,Tt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="web",e.send=function(t,r,n){void 0===r&&(r={});var o=r.transformResponse,i=void 0===o?[]:o;r.type===Pt.Http.Type.JSONP&&(r.type=Pt.Http.Type.GET,i.unshift(e.getJsonpTransformer()));var s=function(t,e){s.called||(s.called=!0,n&&n(t,e))},a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");for(var c in r.type===Pt.Http.Type.GET&&"object"==typeof r.data&&(t+=(t.includes("?")?"&":"?")+e.formatQuery(r.data)),a.open(r.type,t),r.type===Pt.Http.Type.POST&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.header)a.setRequestHeader(c,r.header[c]);a.onreadystatechange=function(){var t=a.status>=200&&a.status<=207;4===a.readyState&&t?s(null,a.responseText?e.transform(a.responseText,i):null):4!==a.readyState||t||0===a.status||s(new Error("http error 1: status not ok"))},a.onerror=function(){s(new Error("http error 2: onerror"))};try{a.or("http error 3: timeout"))},a.send("object"==typeof r.data?JSON.stringify(r.data):r.data)}catch(t){s(new Error("http er{cancel:function(){a.abort()}}},e}return St.__extends(e,t),e}(bt.HttpBase);wt.HttpAdapterWeb=Tt;var At={},Bt={};Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.OSInfoAdapter=void 0;var Ct=function(){};Bt.OSInfoAdapter=Ct,Object.defineProperty(At,"__esModule",{value:!0}),At.OSInfoAdapterWeb=void 0;var Ot=f,xt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="web",e.cache={info:{isMobile:!1,mobilePlatform:null,mobileOs:null,pcOs:null,brand:null,os:null}},e}return Ot.__extereturn this.cache.his.cache.info.os||"unknown"},e.prototype.getModel=function(){return this.getBrand()+"_"+(this.cache.info.isMobile?this.cache.info.mobilePlatform:this.cache.info.pcOs)},e.prototype.getScreen=function(){var t=screen.width,e=screen.height;return t&&e?t+"*"+e:""},e.prototype.getOsVer=function(){return""},e.prototype.getCarrier=function(){return""},e.prototype.getNetwork=function(){return"wurn navigator.language||"zh"},e.prototype.getGps=function(){return""},e.prototype.getPlatform=function(){return""},e.prototype.getCountryCode=function(){return"CN"},e.prototype.getTitle=function(){var t;return null!==(t=document.title)&&void 0!==t?t:""},e.prototype.getUrl=function(){var t;return null!==(t=location.href)&&void 0!==tt.referrer)&&void 0!==t?DeviceId=function(){return""},e.prototype.getInfo=function(t){void 0===t&&(t={});var e=t.ua,r=void 0===e?navigator.userAgent:e;if(this.cache.info.isMobile=/Android|webOS|iPhone|iPod|iPad|BlackBerry|windows phone/i.test(r))for(var n=[[/android|linux/i,"Android","Android"],[/iphone/i,"iPhone","iOS"],[/ipad/i,"iPad","iOS"],[/windows/i,"Windows Phone","Win mobile"],[null,"unknown","unknown"]],o=0;o<n.length;o++){var i=Ot.__read(n[o],3),s=i[0],a=i[1],c=i[2];if(!s||s.test(r)){this.cache.info.mobilePlatform=a,this.cache.info.os=this.cache.info.mobileOs=c;break}}else{a=navigator.platform?navigator.platform.toLowerCase():"";var u=[[/win/i,"Win"],[/mac/i,"MacOs"],[/linux/i,"Linux"],[null,"unknown"]];for(o=0;o<u.length;o++){var d=Ot.__read(u[o],2);if(s=d[0],c=d[1],!s||s.test(a)){this.cache.info.os=this.cache.info.pcOs=c;break}}}var l=[[/msie/i,"IE"],[/rv:11.0/i,"IE"],[/edge/i,"Edge"],[/firefox|fxios/i,"Firefox"],[/qq/i,"QQ"],[/micromessenger|wechat/i,"Wechat"],[/2345/i,"2345"],[/lbbrowser|liebao/i,"Cheetah"],[/opr/i,"Opera"],[/ubrowser|ucbrowser/i,"UC"],[/bidubrowser|baidu/i,"Baidu"],[/metasr|sogou/i,"Sogou"],[/qihoobrowser|360ee|360se/i,"360"],[/chrome|crios/i,"Chrome"],[/safari|mac/i,"Safari"]];for(o=0;o<l.length;o++){var h=Ot.__read(l[o],2),p=(s=h[0],h[1]);if(!s||s.test(r)){this.cache.info.brand=p;break}}return Promise.resolve(this.cache.info)},e}(Bt.OSInfoAdapter);At.OSInfoAdapterWeb=xt;var Rt={};Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.StorageAdaptefunction t(){this.type="web"}return t.prototype.set=function(t,e){return window.localStorage.setItem(t,e),Promise.resolve()},t.prototype.get=function(t){var e;return Promise.resolve(null!==(e=window.localStorage.getItem(t))&&voioveItem(t),Promise.resolve()},t}();Rt.StorageAdapterWeb=It;var kt={},Mt={},jt={exports:{}},Wt={exports:{}},Ft=e(Object.freeze({__proto__:null,default:{}}));!function(t,e){var n;t.exports=(n=n||function(t,e){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==r.g&&r.g.crypto&&(n=r.g.crypto get secure rando,r=new t,t.prototype=null,r}}(),s={.protot t.ingument&&(thi.init.prototype.extend(this)}}s.sigBytereturn(return2-r%4*.words=(o());return new u.init(e,t)}}),tring(8*4;return new u.init(rarCoden%4*8;return new u.inror("Mcape(encodeURIComponent(t)))}},f=a.BufferedBew u.inithis._nDaes-=d}return new u.init(r,d)},clone:function(){var t=c.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});a.Hasher=s.cfg.extend(t),this.reset()},reset:function(){f.reset.call(pend(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize(n new t.init(r).fi.HMAC.init(t,r).finalize(e)}}});var v=s.algo={};return s}(Math),n)}(Wt),funnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64}(),funacMD5=i._createHmacHelper(c)}(Math),r.MD5}();var Lt={exports:{}};!function(t,e){var r,n,o,i,s,a,c,u;n=(r=u=Wt.exports).lib,o=n.WordArray,i=n.Hasher,s=r.algo,a=[83102,271733878,,r[3]=r[3]+sh,thist._hash=this._hash.clone(),t}}),r.SHA1=i._createHelper(c),r.HmacSHA1=i._createHmacHelper(c),u.SHA1}(),function(t,e){var r,n,o;n=(r=Wt.exports).lib.Base,o=r.enc.Utes=s.sreset() this._hahis._oKey.clone().concat(r))}})}(),function(t,e){var r,n,o,i,s,a,c,u;t.exports=(o=(n=(r=u=Wt.exports).lib).Base,i=n.WordArray,a=(s=r.algo).MD5,c=s.EvpKDF=o.extend({cfg:o.extend({keySize:4{this.cft(r)}returnurn c.create(r).compute(t,e)},u.EvpKDF)}(Lt),function(t,e){varpt.call(this,t,e,o.key,n)}})}()}(),function(t,e){8});t.AES=e._createHelper(v)}(),r.AES)}(jt);var Nt={exports:{}};!function(t,e){t.exports=Wt.exports.enc.Uexports=Wt.exports.pad.Pkcs7}(Vt),Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.aesEncrypt=void 0;var zt=f,Ht=zt.__importDefault(jt.exports),Kt=zt.__importDefault(Nt.exports),Ut=zt.__importDefault(Vt.exports);function qt(t,e){var r="object"==typeof e?e=JSON.stringify(e):e,n=Kt.default.parse(""),o=Kt.default.parse(t);return e=Kt.default.parse(e),Ht.default.encrypt(r,o,{iv:n,padding:Ut.default}).toString()}Mt.aesEncrypt=qt;var Jt={install:function(t,e){t.appendPreBind({name:"plugin-encrypt-aes",event:"event-body-encrypt",callback:function(t){var r=t.dwEvent,n=t.eventBody,o=t.dwProcess.dwConfig.getAll();(o.dbg||o.debugMode)&&o.noEncrypted?r.eventBodyEncrypted=JSON.stringify(n):r.isPostStopped()||(r.eventBodyEncrypted=qt(e.aesKey,n))}})on Yt(){return new Zt(null)}Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.linebrk=Xt.hex2b64=void 0,"Microsoft Internet Explorer"==navigr[n++]=1073741823&c}return o},Gt=30):"Netscape"!=navig),r[n++]=67108863&s}retu,r[n++]=268435455&c}return o},Gt=28),Zt.prototype.DB=Gt,Zt.prototype.DM=(1<<Gt)-1,Zt.prototype.DV=1<<Gt,Zt.prototype.FV=Math.pow(2,52),Zt.prototype.F1=52-Gt,Zt.prototype.F2=2*Gt-52;var Qt,$t,te,ee,re,ne=new Array;for(Qt="0".charCodeAt(0),$t=0;$t<=9;++$t)ne[Qt++]=$t;for(Qt="a".charCodeAt(0),$t=10;$t<36;++$t)ne[Qt++]=$t;for(Qt="A".charCodeAt(0)55,re>=256&&(re-o(this.m)>=0?t.mod(t.revert=function(t){t){t.divRemTo(this.m,null,t)},ce.prototype.mulTo=function(t,e,r){t.multiplyTo(e,r),this.reduce(r)},ce.prototype.sqrTo=function(t,e){t.squareTo(e),this.reZERO)>0&&this.m.subTt.copyTo(e),this.redhis.m)>=0&&t.subTo(ltiplyTo(e,r),this.t.squareTo(e),this.rhis[e];t.t=this.t,t.s1?this[0]=t+this.DV:this,o&&Zt.ZERO.subTo(t&this[this.t-1]==t;)--tr]=0;e.t=this.t+t,e.s=th.max(this.t-t,0),e.s=s.t+s+1,e.s=this.s,e.c<<o),e.t=this.t-r,e&&(e[r++]=n),e.t=r,e.clas.s!=t.s&&Zt.ZERO.subT,t,2*r,0,1)),t.s=0,t.cr),s<0&&Zt.ZERO.subTo(.DV)%this.DV)>0?this=(this.t>0?1&thisr;r=n,n=s}return e.revo&&(i+=oe(r));returnturn Zt.ZERO.subT this.s<0?this.negate()s[r]-t[r]))return e;retis[this.t-1]^thiso(Zt.ZERO)>0&&t.subTo(ee(e):new ue(e),this.exp(t,r)},Zt.ZERO=se(0),Zhis.S[r]=n;this.i=this.S[t+this.S[this.i]&255]},null==ee){ee=new Array,re=0;var he=void 0;if(window.crypto&&window.crypto.getRandomValues){var pe=new Uint8Array(32);for(window.crypto.getRandomValues(pe),he=0;he<32;++he)ee[re++]=pe[he]}if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&window.crypto&&window.crypto.random){var fe=window.crypto.random(32);for(he=0;he<fe.length;++he)ee[re++]=255&fe.charCodeAt(he)}for(;re<256;)he=Math.floor(65536*Math.random()),ee[re++]=he>.dmq1=null,this.coefe=0;e<t.length;++e)t[en t.modPowInt(this.e,this.n)},ge.prototype.setPublic=function(t,e){null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=new Zt(t,16),this.e=parseInt(e,16)):alert("Invalid RSA publiturn 0==(1&n.length)?n:"0"+n};var me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";Xt.hex2b64=function(t){var e,r,n="";for(e=0;e+3<=t.length;e+=3)r=parseInt(t.substring(e,e+3),16),n+=me.charAt(r>>6)+me.charAt(63&r);for(e+1==t.length?(r=parseInt(t.substring(e,e+1),16),n+=me.charAt(r<<2)):e+2==t.length&&(r=parseInt(t.substring(e,e+2),16),n+=me.charAt(r>>2)+me.charAt((3&r)<<4));(3&n.length)>0;)n+="=";return n},Xt.linebrk=function(t,e){for(var r="",n=0;n+e<t.length;)r+=t.substring(n,n+e),n+=e;return r+t.substring(n,t.length)},Xt.default=ge;var _e={};Object.defineProperty(_e,"__esModule",{value:!0}),_e.generateRandomString=void 0,_e.generateRandomString=function(t){void 0===t&&(t=32);for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",r=e.length,n="",o=0;o<t;o++)n+=e.charAt(Math.floor(Math.random()*r));return n},function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.webEncrypt=t.rsaEncrypt=t.aesEncrypt=void 0;var e=f,r=e.__importStar(Mt),n=e.__importStar(Xt),o=_e,i=Mt;function s(t,e){if(n.default&&n.linebrk&&n.hex2b64){var r=0,o=function(t,e){var i=new n.default;i.setPublic(t,"10001");var s=i.encrypt(e);return 344!==(s=n.linebrk(n.hex2b64(s),64)).length&&r<10&&(r++,s=o(t,e)),r=0,s};return o(t,e)}return e}function a(t,e,n){for(var i=Object.assign({},t),a=o.generateRandomString(16),c=0,u=e.length;c<u;c++){var d=e[c],l=i[d];null!=l&&(i[d]=r.aesEncrypt(a,String(l)))}return{encryptedData:i,encryptedKey:s(n,a)}}Object.defineProperty(t,"anction(){return i.aesEncrypt}}),t.rsaEncrypt=s,t.webEncrypt=a;var c={install:function(t,e){t.appendPreBind({name:"plugin-encrypt-web",event:"event-data-encrypt",callback:function(t){var r,n,o,i=t.dwEvent,s=t.dwProcess;i.validate();var c=s.dwConfig.getAll();if((c.dbg||c.debugMode)&&c.noEncrypted)i.dataEncrypted=i.data;else{var u,d=null!==(o=null===(n=null===(r=s.dynamicData)||void 0===r?void 0:r.events)||void 0===n?void 0:n.data)&&void 0!==o?o:[];if("_page_view"===i.name)u=["title","url","refer"];else for(var l=0;l<d.length;l++){var h=d[l];if(h.name===i.name){h.encryptAttrs&&(u=h.encryptAttrs);break}}if(u&&i.data){var p=a(i.data,u,e.rsaKey),f=p.encryptedData,v=p.encryptedKey;if(v){var y={_encrypted_key:v,_encrypted_version:"20160113",_encrypted_fields:u.join(",")};Object.assign(f,y)}i.dataEncrypted=f}}}}),r.default.install(t,{aesKey:e.aesKey})}};t.default=c}(kt);var we={};Object.defineProperty(we,"__esModule",{value:!0}),we.default={install:function(t,e){var r=0,n=e.max;t.appendPreBind({name:"send-in-limit-connect-before-event",event:"before-event-send",callback:function(t){var e=t.dwEvent;e.isPostStopped()||(r>=n?e.saveWait().stopPost():r++)}}),t.appendPreBind({name:"send-in-limit-connect-after-event",event:"after-event-send",callback:function(t){t.dwProcess,r>0&&r--}}),t.appendPreBind({name:"send-in-limit-connect-before-dynamic",event:"before-dynamic-send",callback:function(t){var e=t.dwDynamic;e.isPostStopped()||(r>=n?(e.retry(),e.stopPost()):r++)}}),t.appendPreBind({name:"send-in-limit-connect-after-dynamic",event:"after-dynamic-send",callback:function(){r>0&&r--}})}};var be={};Object.defineProperty(be,"__esModule",{value:!0});var De={install:function(t,e){var r=null!=e?e:{},n=r.debounce,o=void 0===n?0:n,i=r.throttle,s=void 0===i?0:i,a=r.ignoreEventNames,c=void 0===a?[]:a;t.appendPreBind({name:"plugin-send-in-throttle",event:"before-event-send",callback:function(t){var e=t.dwEvent,r=t.dwProcess;r.cache.others.throttle||(r.cache.others.throttle={first:!1,debounceTimer:null,throttleTimer:null});var n=r.dwService,i=r.cache.others.throttle;if(!e.isPostStopped()&&"wait"!==e.from&&!c.includes(e.name)){var a=function(){i.first=!1,clearTimeout(i.debounceTimer),clearTimeout(i.throttleTimer),i.debounceTimer=null,i.throttleTimer=null,n.sendWaitEvents(r)};o>0&&(e.saveWait().stopPost(),clearTimeout(i.debounceTimer),i.debounceTimer=setTimeout(a,o)),s>0&&(i.first||(i.first=!0,clearTimeout(i.throttleTimer),i.throttleTimer=setTimeout(a,s)))}}})}};be.default=De,Object.defineProperty(i,"__esModule",{value:!0}),i.WebReporter=void 0;var Ee=f,Se=Ee.__importDefault(v.exports),Pe=Ee.__importDefault(y),Te=g,Ae=wt,Be=At,Ce=Rt,Oe=Ee.__importDefault(kt),xe=Ee.__importDefault(we),Re=Ee.__importDefault(be),Ie=x;Te.Reporter.adapters.http=new Ae.HttpAdapterWeb,Te.Reporter.adapters.osInfo=new Be.OSInfoAdapterWeb,Te.Reporter.adapters.storage=new Ce.StorageAdapterWeb,Te.Reporter.defaults={dynamicUrl:"//dw-online.ksosoft.com",sendUrl:"(//shuc-js.ksord.com/bat/js/cors)",debugUrl:"(//dw-collect-debug.ksord.com)",handleAppEnd:function(t,e){if(!e.fresh){var r=t.dwStorage,n=function(){if("function"==typeof navigator.sendBeacon){var e=t.generateAppEndEvent();if("boolean"==typeof navigator.onLine&&!navigator.onLine)return e.saveFail(),void r.fail.sync();var n=Se.default.encode(Pe.default.encode(JSON.stringify(e.eventBody))),o=new Blob([n],{type:"application/x-www-form-urlencoded"}),i=e.urlsParsed[0];t.isDebug()&&(console.log("beacon url",i),console.log("beacon body",JSON.stringify(e.eventBody))),navigator.sendBeacon("string"==typeof i?i:i[0],o)}else console.log('[dw-js-sdk] "sendBeacon" is not supported, use normal method to send app_end.'),t.sendAppEnd()};"onbeforeunload"in window?window.addEventListener("beforeunload",n,!1):window.addEventListener("pagehide",n,!1)}}},Te.Reporter.use(Oe.default,{aesKey:"ZctYg7JjXcPySXxw",rsaKey:"8762DEC337D703A5841A8090180350203AC0C2809A864BF6CA31979FCD7AA3D1BFA38CF8B243878984CBC9B83496CBAC87B448F74EA7550D579BD5820EFD17F5D22D0665AB114FB6EBA74261B4EB040828FBCA7CF95EF0D56BBFD9C67E5941AFFB34DE4C6FA2E737C16D9C703A43D90F65B40E7F3E44C1165C1ED3BD10BC449421863174E8EFA3CA618E0DEE7EDD65F07AAE0586AB1702B1D95F29F3BA447AD744E9B37ACB3F510D068A2D6BDBE4F0689B26A9AFCF66219160E7CF802D2F1A56503F462693B62747AD4163DBC1222687D154C53C03BBB5D2DE9ABC2DE6907E3B26E45C4FCA63F28258C4D07D3E152AE51F80A0DA7B77A3E1D0EFE72A988B57F9"}),Te.Reporter.use(Re.default,{debounce:parseInt("300"),throttle:parseInt("5000"),ignoreEventNames:["_app_end"]}),Te.Reporter.use(xe.default,{max:3});var ke=function(t){function e(e){void 0===e&&(e={});var r=t.call(this,e)||this;r.options=e;var n=new Date;return r._lastFreshDate=[n.getFullYear(),n.getMonth()+1,n.getDate()],r}return Ee.__extends(e,t),e.prototype.createReporter=function(t,r){if(!t)throw Error("createReporter requires param appKey.");return new e(r).setAppKey(t)},e.prototype.setDailyFresh=function(t){var e=this;void 0===t&&(t="00:15");var r=t.match(/(\d?\d):(\d?\d)/),n="请设置正确的时间格式 hh:mm";if(!r)throw Error(n);var o=parseInt(r[1]),i=parseInt(r[2]);if(o>24||i>60)throw Error(n);var s=this.dwProcess.getRemoteDate();if(Ie.DWProcess.printLog("WebReporter","setDailyFresh",t),s){var a=new Date(s),c=parseInt("21600000 # 6小时");a.setHours(o),a.setMinutes(i),a.setSeconds(0,0),a.setTime(a.getTime()+Math.random()*c);var u=a.getTime()-s.getTime(),d=864e5,l=u>0?u:u+d,h=function(){e.dwProcess.refresh(),e._dailyRefreshTimer=setTimeout(h,d)};clearTimeout(this._dailyRefreshTimer),thilse setTimeout((function(){return e.setDailyFresh(t)}),6e4);return this},e.prototype.forceFresh=function(){var t=new Date,e=[t.getFullYear(),t.getMonth()+1,t.getDate()],r=function(t,e,r){var n=e;return 1===r&&(n*=100),t+n};e.reduce(r)-this._lastFreshDate.reduce(r)<=0?Ie.DWProcess.printLog("WebReporter","forceFresh","fail: same date",{currentDate:e.join("-"),lastFreshDate:this._lastFreshDate.join("-")}):(Ie.DWProcess.printLog("WebReporter","forceFresh","success",{currentDate:e.join("-"),lastFreshDate:this._lastFreshDate.join("-")},!0),this.dwProcess.refresh(!0),this._lastFreshDate=e)},e}(Te.Reporter);return i.WebReporter=ke,i.default=ke,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.dw=void 0;var e=o,r=i;t.dw=function(){var t=window;if(void 0===t._dw)t._dw=t.dw=new r.WebReporter({});else{if(console.group("[dw-js-sdk] warn"),void 0===t._dw.version)return console.warn("[dw-js-sdk] 检测到您已引入旧版sdk, 请升级您的版本至v3.0.27或以上"),new r.WebReporter({});switch(e.compareVersion(t._dw.version)){case-1:console.log("[dw-js-sdk] 检测到新的版本, 请升级您的sdk");break;case 1:console.log("[dw-js-sdk] 检测到当前环境存在旧版本的sdk!")}console.log("[dw-js-sdk] (1/3) 当前环境已存在统计工具 window._dw"),console.log("[dw-js-sdk] (2/3) 可能的原因是存在重复引入 sdk 文件"),console.log('[dw-js-sdk] (3/3) 请使用 window._dw.createReporter("your-app-key") 创建一个新的统计工具'),console.groupEnd()}return t._dw}(),t.default=t.dw}(n),t(n)}()}}]);
