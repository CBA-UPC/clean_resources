"use strict";(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[2639],{31060:function(t,e,n){n.d(e,{Z:);var i=n(4942),s=n(15861),a=n(87757),r=n.n(a),o=n(89602),c=n(52966),u=n(10928),l=n.n(u),d=n(86839),m={computed:{isComment:isGroupEvent:},v=n(65856),f=n(81045),p={file_create:(0,f.GH)("stacks_events_action0"),file_update:(0,f.GH)("stacks_events_action1"),file_rename:(0,f.GH)("stacks_events_action2"),file_delete:(0,f.GH)("stacks_events_action3"),file_comment:(0,f.GH)("stacks_events_action4"),file_recover:(0,f.GH)("stacks_events_action5"),file_shift_in:(0,f.GH)("stacks_events_action6"),file_shift_out:(0,f.GH)("stacks_events_action7"),file_shift_delete:(0,f.GH)("stacks_events_action8"),file_share:(0,f.GH)("stacks_events_action9"),group_member_role_upgrade:(0,f.GH)("stacks_events_action10"),group_member_role_degrade:(0,f.GH)("stacks_events_action11"),group_member_join_by_link:(0,f.GH)("stacks_events_action12")+"("+(0,f.GH)("stacks_events_action13")+")",group_member_add:(0,f.GH)("stacks_events_action12"),group_member_quit:(0,f.GH)("stacks_events_action14"),group_member_delete:(0,f.GH)("stacks_events_action14"),group_rename:(0,f.GH)("stacks_events_action15"),group_create:(0,f.GH)("stacks_events_action16"),group_delete:(0,f.GH)("stacks_events_action17")},h=n(79984),_=n(34222),y=h.Z.methods,k=y.onSendInvitationClick,w=y.onCancelInvitationClick,g=y.onContactInvitationPanelLoad,$={methods:{dwMessageEvent:y.dwMessageEvent,onSendInvitationClick:k,onCancelInvitationClick:w,onContactInvitationPanelLoad:g,onCardEvent:_.Z.methods.onCardEvent}};n(20144).default.use(d.Z);var x={name:"YunEventHead",mixins:[m,$],data:props:{event:{type:Object}},computed:{avatar:function(){var t=this.event,e=t.data,n=t.operator,i=n&&n.avatar||"";return this.isGroupEvent&&e.user_name&&(i=e&&e.avatar||""),i},action:userid:function(){var t=this.event,e=t.data,n=t.operator;return(this.isComment||this.isGroupEvent)&&e.user_name?e.userid:n&&n.id},name:function(){var t=this.event,e=t.data,n=t.operator;return((this.isComment||this.isGroupEvent)&&e.user_name?e.user_name:n&&n.name)||""},nickname:function(){var t=this.$store.state.user;return this.userid===t.id?this.$t("stacks_events_Head0"):this.name},date:function(){var t=new Date(1e3*this.event.mtime),e=this.timer,n=0,i="";if(v.Z.isMonmentAgo(t,e))i=this.$t("stacks_events_Head1"),n=1;else if(v.Z.isSameHour(t,e))i=v.Z.minutesFromNow(t,e)+this.$t("stacks_events_Head2"),n=60;else if(v.Z.hoursFromNow(t,e)<=24)i=v.Z.hoursFromNow(t,e)+this.$t("stacks_events_Head3"),n=3600;else if(v.Z.daysFromNow(t,e)<=30)i=v.Z.daysFromNow(t,e)+this.$t("stacks_events_Head4"),n=86400;else if(v.Z.mouthsFromNow(t,e)<=12)i=v.Z.mouthsFromNow(t,e)+this.$t("stacks_events_Head5");else{var s=e.getTime()-t.getTime(),a=Math.floor(s/31536e6);i="".concat(a).concat(this.$t("stacks_events_Head6"))}return{text:i,unit:n}}},methods:{updateTimer:function(){var t=this;this.date.unit&&(this.hander=setTimeout((,1e3*this.date.unit))}},mounted:updated:beforeDestroy:,C=n(51900),b=(0,C.Z)(x,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"yun-events-head",class:{"new-layout":!0}},[n("kd-avatar",{attrs:{src:t.avatar,size:"medium"}}),n("div",{staticClass:"event-by-nickname",attrs:{title:t.nickname}},[t._v(" "+t._s(t.nickname)+" ")]),n("div",{staticClass:"event-by-other"},[t.action?n("span",{staticClass:"event-action"},[t._v(t._s(t.action))]):t._e(),n("span",{staticClass:"event-by-date"},[t._v(t._s(t.date.text))])])],1)}),[],!1,null,null,null).exports,E=n(21628),G=n(79835),H=n(95241),N=n(423),S=n(52477),T=n(85116),Z=["recycle","shared","activity"],I={name:"DriveFileName",mixins:[S.default],props:{id:Number,sid:String,onClick:Function,ftype:String,groupid:Number,fname:String,deltype:String,location:{type:String,default:""},path:{type:String,required:!1}},computed:{to:function(){var t="Team";return"folder"===this.ftype?{name:"Team",params:{tid:this.groupid,fid:this.id}}:(this.$store.state.team.myCloud.id===this.groupid?t="Index":this.$store.state.team.myUpload.id===this.groupid&&(t="Auto"),this.sid?{name:"Link",params:{sid:this.sid},query:{dwEntrance:"team_event",openSrc:t}}:this.id?{name:"Private",params:{fid:this.id},query:{dwEntrance:"team_event",openSrc:t}}:void 0)},filename:function(){var t=this.$slots.default&&this.$slots.default[0]||{};return this.fname?this.fname:t.text&&t.text.trim()||""},isWpsNote:isDecompressType:function(){var t=!!~H.uU.zip.indexOf((0,G.getExtName)(this.filename));return!(!this.$store.state.user.is_plus||~["file_delete","file_shift_delete"].indexOf(this.deltype))&&(this.$ua.wps2016||this.$ua.wps2018beta?t:t&&!~Z.indexOf(this.location))},doNotPreview:function(){return!(!~["file_delete","file_shift_delete","file_shift_out"].indexOf(this.deltype)&&"recycle"!==this.location)},isShortcutFile:function(){return(0,G.isShortcutFileByName)(this.fname)}},methods:{eventClickWpsNote:function(){var t=this;return(0,s.Z)(r().mark((function e(){var n,i,s,a,o,c,u,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,T.dc)(t.id);case 3:if(n=e.sent,i=n.fname,s=n.storid,a=n.groupid,o=n.parent,c=n.userid,"wpsnote"!==(0,G.getExtName)(i)){e.next=9;break}return u=t.$store.state.user.userid,l=parseInt(c)===u?"edit":"preview",e.abrupt("return",window.open("".concat(N.a9,"/").concat(l,"/").concat(c,"/").concat(s,"?groupid=").concat(a,"&parentid=").concat(o,"&entry=yunweb"),JSON.stringify({fid:s})));case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(0);case 13:case"end":return e.stop()}}),e,null,[[0,11]])})))()},toLinkPreview:function(){var t=this;return(0,s.Z)(r().mark((function e(){var n,i,s,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sid,i=t.id,s="".concat(location.protocol,"//").concat(location.hostname),e.prev=3,e.next=6,(0,T.iz)(t.id);case 6:a=e.sent,n=a.link_id,i=a.src_file_id,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(3);case 13:n?s="".concat(s,"/l/").concat(n):i&&(s="".concat(s,"/p/").concat(i)),window.open(s);case 15:case"end":return e.stop()}}),e,null,[[3,11]])})))()}}},F=I,O=(0,C.Z)(F,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"components-filename"},[n("div",{staticClass:"components-filename-text",class:{"new-layout":!0}},[t.doNotPreview?n("span",[t._t("default")],2):t.isWpsNote?n("div",{staticClass:"components-filename-text-content",on:{click:t.eventClickWpsNote}},[t._t("default")],2):t.isShortcutFile?n("div",{staticClass:"components-filename-text-content",on:{click:t.toLinkPreview}},[t._t("default")],2):n("router-link",{staticClass:"components-filename-text-content",attrs:{tag:"div",to:t.to},nativeOn:{click:function(e){return t.$emit("click",e)}}},[t._t("default")],2)],1)])}),[],!1,null,null,null).exports,L=n(83677),B=n(57397),D=["group_member_role_upgrade","group_member_role_degrade"],P={name:"YunEventBody",mixins:[m],components:{Filename:O,FormatIcon:B.Z},props:{event:{type:Object}},computed:{isLinkFile:filename:fname:function(){var t=this.filename.lastIndexOf("."),e=this.filename;return t>0&&(e=this.filename.substring(0,t)),this.isLinkFile&&(e=e.replace(/^(.+)(\..+)$/,()),(0,L.cutOffString)(e,8,16)},content:function(){var t=this.event,e=t.type,n=t.data,i=t.operator,s="";if(this.isComment)s=n&&n.comment_content&&(0,E.htmlEncode)(n.comment_content);else if(this.isGroupEvent){if(~D.indexOf(e)){var a="admin"===(n||{}).role?this.$t("stacks_events_Body0"):this.$t("stacks_events_Body1");s="".concat(p[e]).concat(a)}else s=p[e]||"";var r=(i||{}).name;"group_member_add"===e&&r&&(s="".concat(s," ").concat(this.$t("stacks_events_Body2")).concat(r," ").concat(this.$t("stacks_events_Body3")))}return s},isDeleted:function(){return Boolean(~["file_delete","file_shift_delete","file_shift_out"].indexOf(this.event.type))}}},q=(0,C.Z)(P,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"yun-events-body"},[t.filename?n("div",{staticClass:"yun-events-filename",class:{deleteFile:t.isDeleted}},[n("FormatIcon",{attrs:{size:16,fileName:t.filename,fileType:t.isLinkFile?"link":""}}),n("filename",{class:{deleteFile:t.isDeleted},attrs:{id:t.event.fileid,location:"activity",fname:t.filename,deltype:t.event.type,groupid:t.event.groupid}},[t._v(" "+t._s(t.fname)+" ")])],1):t._e(),t.isComment&&t.content?n("div",{directives:[{name:"dompurify-html",rawName:"v-dompurify-html",value:t.content,expression:"content"}],staticClass:"yun-events-content"}):t.content?n("div",{directives:[{name:"dompurify-html",rawName:"v-dompurify-html",value:t.content,expression:"content"}],staticClass:"yun-events-content"},[t._v(t._s(t.content))]):t._e()])}),[],!1,null,null,null).exports,A=n(81301),M={name:"YunEventsList",data:computed:{activity:function(){return this.$store.state.activity},scrollContent:scrollbar:style:,components:{Scroll:c.Z,YunEventHead:b,YunEventBody:q},methods:{fetchItems:function(){var t=this.$store.state.activity;return this.$store.dispatch(o.K3J,{q:{lastid:l()(t.list).id}})},onEnter:function(){var t=this.$el.querySelector(".scroll"),e=this.$el.querySelector(".drive-scroller-inner"),n=t.getBoundingClientRect(),i=e.getBoundingClientRect();n.height<i.height?this.width="calc(100% + ".concat(this.scrollbar,"px)"):this.width="100%"},onLeave:},W=(0,C.Z)(M,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"activity-lists",style:t.style,on:{mouseenter:t.onEnter,mouseleave:t.onLeave}},[n("Scroll",{attrs:{scrollContent:t.scrollContent}},[n("div",{staticClass:"activity-event-wrapper"},t._l(t.activity.list,(function(e){return n("div",{key:"event"+e.id,staticClass:"activity-event",class:{"new-layout":!0}},[e.type&&"event_unknown"!==e.type?[n("yun-event-head",{attrs:{event:e}}),n("yun-event-body",{attrs:{event:e}})]:t._e()],2)})),0)])],1)}),[],!1,null,null,null).exports,Y=["Team","Enterprise","Group"],j={name:"YunActivityStacks",components:{TeamStacks:W},props:{selectedTeamId:{type:Number}},computed:{component:function(){var t=this.$store.state.route,e=t.name,n=t.params;return~Y.indexOf(e)&&n.tid>0||this.selectedTeamId?"TeamStacks":null}}},z=(0,C.Z)(j,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"activity-stacks"},[n("div",{staticClass:"activity-stacks-inner"},[n(t.component,{tag:"component"})],1)])}),[],!1,null,null,null).exports,J=["Team","Enterprise","Group"];function R(t,e,n,i){var s=e.params.tid;if(i&&(s=i,e.params.selectedTeamId=i),s&&"0"!==s){var a=1;n||(a=Math.floor(t.state.activity.list.length/20)+1),a=a>5?5:a;var r=[t.dispatch(o.K3J,Object.assign({},e,{q:{offset:0,count:20*a}}))];return Promise.all(r)}return Promise.resolve(!0)}var U,K={name:"Overview",preFetch:(U=(0,s.Z)(r().mark((function t(e){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,R(e,e.state.route);case 2:case"end":return t.stop()}}),t)}))),,componentName:"Overview",props:{view:{type:String,default:"Activity"},secretLocked:{type:Boolean},selectedTeamId:{type:Number}},computed:{visiable:function(){var t=this.$store.state.route;if(~J.indexOf(t.name)||this.selectedTeamId){try{var e=this.$store.state.file.status.response,n=e.status,i=e.data;if(404===n||~["notGroupMember","groupNotExist"].indexOf(i.result))return!1}catch(t){}return!(!(parseInt(t.params.tid)||this.selectedTeamId)&&this.user.id)}return!1},klass:function(){return(0,i.Z)({"aside-right-overview":!0,"new-layout":!0},"aside-".concat(this.$route.name.toLocaleLowerCase()),!0)},user:,methods:{runLoader:function(){R(this.$store,this.$store.state.route)}},watch:{$route:function(t,e){var n=this;if(("Enterprise"===t.name||"Team"===t.name||"Group"===t.name)&&t.params.tid!==e.params.tid&&!this.$isServer){var i=this.$ua,s=i.isIE,a=i.version,r=i.wps2018beta;s&&a<12||r?window.requestAnimationFrame(():R(this.$store,t,1)}},selectedTeamId:function(t){R(this.$store,this.$store.state.route,null,t)}},mounted:function(){var t=this;return(0,s.Z)(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.user.id){e.next=8;break}return e.prev=1,e.next=4,R(t.$store,t.$store.state.route,null,t.selectedTeamId);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:case"end":return e.stop()}}),e,null,[[1,6]])})))()},components:{ActivityStacks:z},beforeRouteUpdate:function(t,e,n){this.user.id&&n()}},Q=K,V=(0,C.Z)(Q,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.visiable,expression:"visiable"}],class:t.klass,on:{click:},[t._t("default"),n("activity-stacks",{attrs:{selectedTeamId:t.selectedTeamId}})],2)}),[],!1,null,null,null).exports}}]);
