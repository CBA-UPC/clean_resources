// For license information, see `https://assets.adobedtm.com/f740f8a20d94/1dcfc2687ba3/cad02625de4c/RCa537dbff11d9400caea388b7a2cc2815-source.js`.
_satellite.__registerScript('https://assets.adobedtm.com/f740f8a20d94/1dcfc2687ba3/cad02625de4c/RCa537dbff11d9400caea388b7a2cc2815-source.min.js', "kiwi=window.kiwi||{},kiwi.flags=kiwi.flags||{};var ruleName=\"CER | kiwi.trackQueue > Handle Event\";try{var eventData=event.detail,eventTarget=event.target,trackSource=eventData.trackSource,ignoreWidgets=_satellite.getVar(\"kiwi.ddl.pageSettings.tech.ignoreWidgets\")||!1,expectWidgetsSetting=_satellite.getVar(\"kiwi.ddl.pageSettings.tech.expectWidgets\")||!1,expectSpa=_satellite.getVar(\"kiwi.ddl.pageSettings.tech.expectSpa\")||!1,updateDl=eventData.updateDl||!1,trackEventPayload=eventData.trackEventPayload||{},passedIn=eventData.passedIn||[],emptyEncStrObjPageName=\"%7B%22name%22:%22%22,%22trackSource%22:%22%22%7D\";expectWidgets=!ignoreWidgets&&(\"derive\"===expectWidgetsSetting?_satellite.getVar(\"kiwi.ddl.pageTech.hasAtlasWidgets\")||!1:eventData.expectWidgets||expectWidgetsSetting||!1),\"whileloggedin\"===expectSpa&&(expectSpa=_satellite.getVar(\"Kiwi Util | Processes | User | CB Web | Is Logged In\"));var tmosByTrackSource={\"fail-over\":_satellite.getVar(\"kiwi.ddl.pageSettings.tech.failOverTrackingTmoMs\")||5e3,\"page-load\":_satellite.getVar(\"kiwi.ddl.pageSettings.tech.pageLoadTrackTmoMs\")||2500,\"route-hash\":_satellite.getVar(\"kiwi.ddl.pageSettings.tech.routeHashTrackTmoMs\")||2500,\"spa-page\":_satellite.getVar(\"kiwi.ddl.pageSettings.tech.spaPageTrackTmoMs\")||1500,spa:1e3,widgets:1e3,\"asch-start\":0,\"asch-end\":750},oPageName={},handleEvent=function(e,t,a,i,r){var l=\"\",o=\"\";if(trackEventPayload&&trackEventPayload.key?(o=trackEventPayload.key,l=e+\":\"+o):l=e,_satellite.logger.info(kiwi._tqfn.ruleName+\" > {trackSource:\"+l+\", expectWidgets:\"+t+\", expectSpa:\"+a+\", updateDl:\"+i+\", passedIn:\"+JSON.stringify(r)+\"}\"),!e)return _satellite.logger.warn(kiwi._tqfn.ruleName+\" > Missing trackSource setting. Aborting. \\n\"+JSON.stringify(event.detail)),!1;kiwi._tq&&\"page-load\"!==e||kiwi._tqfn.initializeVars(),\"page-load\"===e&&kiwi._tqfn.resetDataAfterTrack(),i&&(kiwi._tq.oPageName=kiwi._tqfn.updateDlsAndGetLatestPageName());var n=0,s=\"link\",g=!kiwi._tq.pageTrackInProgress&&(e.match(/^(page-load|route-hash)$/i)||\"spa\"===e&&!kiwi._tq.inQueue[\"fail-over\"]);(g&&\"spa\"===e&&(e=\"spa-page\"),g)&&(_satellite.logger.log(ruleName+\" > New Page Track Queue started! with: \"+e),_satellite.getVar(\"AA-Settings | Kiwi | No Queue Track Pages\")[(_satellite.getVar(\"kiwi.ddl.pageName\")||{name:\"missing\"}).name]&&kiwi._tqfn.doTrack(\"no-queue-track\",\"page\",\"\",n));switch(kiwi._tq.pageTrackInProgress=g||kiwi._tq.pageTrackInProgress,kiwi._tq.pageTrackInProgress&&(s=\"page\"),kickOffFailOverTrackCall=function(){kiwi._tq.tmos[\"fail-over\"]||(kiwi._tq.timeStampTrackStart=Date.now(),n=1,kiwi._tq.startTrackSource=e,kiwi._tqfn.tmoStart(tmosByTrackSource[\"fail-over\"],\"fail-over\",s,kiwi._tq.oPageName,kiwi._tq.startTrackSource,!1))},e){case\"page-load\":kickOffFailOverTrackCall(),kiwi._tq.inQueue[e]=1,kiwi._tq.waitCount++,_satellite.logger.log(ruleName+\" > WaitCount++: \"+kiwi._tq.waitCount+\" for \"+l),kiwi._tq.inQueue[\"route-hash\"]=1,kiwi._tqfn.tmoStart(tmosByTrackSource[e],e,s,kiwi._tq.oPageName,kiwi._tq.startTrackSource,n),t&&(kiwi._tq.inQueue.expectwidgets=1,kiwi._tq.waitCount++,_satellite.logger.log(ruleName+\" > (expectWidgets) WaitCount++: \"+kiwi._tq.waitCount+\" for \"+l)),a&&(kiwi._tq.inQueue.expectspa=1,kiwi._tq.waitCount++,_satellite.logger.log(ruleName+\" > (expectSpa) WaitCount++: \"+kiwi._tq.waitCount+\" for \"+l));break;case\"route-hash\":case\"spa-page\":kickOffFailOverTrackCall(),kiwi._tq.inQueue[e]?_satellite.logger.log(ruleName+\" > \"+e+\" > already in queue!\"):(_satellite.logger.log(ruleName+\" > \"+e+\" > not yet in queue\"),kiwi._tq.inQueue[e]=1,kiwi._tq.waitCount++,_satellite.logger.log(ruleName+\" > WaitCount++: \"+kiwi._tq.waitCount+\" for \"+l),kiwi._tqfn.tmoStart(tmosByTrackSource[e],e,s,kiwi._tq.oPageName,kiwi._tq.startTrackSource,n));break;case\"spa\":case\"widgets\":kickOffFailOverTrackCall(),kiwi._tq.inQueue[e]?_satellite.logger.log(ruleName+\" > \"+e+\" > already in queue!\"):(_satellite.logger.log(ruleName+\" > \"+e+\" > not yet in queue\"),kiwi._tq.inQueue[e]=1,kiwi._tq.inQueue[\"expect\"+e]?kiwi._tqfn.tmoEnd(e,s,emptyEncStrObjPageName,kiwi._tq.startTrackSource,n):(kiwi._tq.waitCount++,_satellite.logger.log(ruleName+\" > WaitCount++: \"+kiwi._tq.waitCount+\" for \"+l),kiwi._tqfn.tmoStart(tmosByTrackSource[e],e,s,kiwi._tq.oPageName,kiwi._tq.startTrackSource,n)));break;case\"asch-start\":o&&(kiwi._tq.aschKeysStarted[o]||kiwi._tq.aschKeysLoaded[o]?_satellite.logger.log(ruleName+\" > no addition to waitcount: \"+kiwi._tq.waitCount+\" for \"+l+\"(already started/loaded)\"):(kiwi._tq.aschKeysStarted[o]=1,kiwi._tq.waitCount++,_satellite.logger.log(ruleName+\" > WaitCount++: \"+kiwi._tq.waitCount+\" for \"+l)));break;case\"asch-end\":o&&(kiwi._tq.aschKeysLoaded[o]?_satellite.logger.log(ruleName+\" > no tmoStart for async child: \"+o+\" (already loaded)\"):kiwi._tq.aschKeysStarted[o]?(_satellite.logger.log(ruleName+' > prior \"starting\" call found, so no addition to WaitCount: '+kiwi._tq.waitCount+\" for \"+l),kiwi._tqfn.tmoStart(tmosByTrackSource[e],l,s,kiwi._tq.oPageName,kiwi._tq.startTrackSource,n)):kiwi._tq.pageTrackInProgress?(kiwi._tq.aschKeysStarted[o]=1,kiwi._tq.aschKeysLoaded[o]=1,_satellite.logger.log(ruleName+\" > pagetrack already in progress so no tracking tmo kicked off for \"+l)):(kiwi._tq.aschKeysLoaded[o]=1,_satellite.logger.log(ruleName+' > no prior \"starting\" call found, and not within page track progress, so ignoring for '+l)));break;case\"acdl-page\":kiwi._tqdl=kiwi._tqdl||[];for(var k=0;k<r.length;k++)kiwi._tqdl.push(r[k]);kiwi._tq.pageTrackInProgress?(kiwi._tq.oPageName=kiwi._tqfn.updateDlsAndGetLatestPageName(),_satellite.logger.log(ruleName+\" > \"+e+\" > \"+kiwi._tq.oPageName.name),_satellite.track(\"cbTrack.viewInDom\")):(_satellite.logger.log(ruleName+\" > \"+e+\" > sending page track now\"),kiwi._tqfn.trackPage(e,\"\",\"acdl-page\"))}};kiwi._tqfn={ruleName:ruleName,initializeVars:function(){kiwi._tq={oPageName:_satellite.getVar(\"kiwi.ddl.pageName\"),pageLoadTracked:0,waitCount:0,tmos:{},inQueue:{},aschKeys:{},timeStampInit:Date.now(),timeStampTrackStart:0,timeStampTrackEnd:0,startTrackSource:\"\",pageTrackInProgress:0},_satellite.logger.log(ruleName+\" > WaitCount: \"+kiwi._tq.waitCount+\"  initializeVars\")},updateDlsAndGetLatestPageName:function(){return _satellite.getVar(\"Kiwi Util | Helpers | ADL | Update\"),_satellite.getVar(\"Kiwi Util | Helpers | DDL | Page View Update\"),_satellite.getVar(\"kiwi.ddl.pageName\")},tmoStart:function(e,t,a,i,r,l){e=e||0,i=i||kiwi._tq.oPageName||_satellite.getVar(\"kiwi.ddl.pageName\"),_satellite.logger.info(kiwi._tqfn.ruleName+\" > TMO Start for \"+e+\"ms > {\"+t+\", \"+i.name+\"} > \"+a);var o=encodeURI(JSON.stringify(i));e?kiwi._tq.tmos[t]=setTimeout('kiwi._tqfn.tmoEnd(\"'+t+'\", \"'+a+'\", \"'+o+'\", \"'+r+'\", '+l+\")\",e):kiwi._tqfn.tmoEnd(t,a,o,r,l)},tmoEnd:function(e,t,a,i,r){var l=e,o=e.split(\":\"),n=o[1];e=o[0],a=a||emptyEncStrObjPageName;var s=JSON.parse(decodeURI(a));if(_satellite.logger.info(kiwi._tqfn.ruleName+\" > TMO End > {\"+e+\", \"+s.name+\"} > \"+t),\"fail-over\"===e)kiwi._tqfn.doTrack(e,t,i,r);else{switch(e){case\"page-load\":case\"route-hash\":case\"spa-page\":case\"spa\":case\"widgets\":kiwi._tq.waitCount--,_satellite.logger.log(ruleName+\" > WaitCount--: \"+kiwi._tq.waitCount+\" for \"+l);break;case\"asch-end\":n&&(kiwi._tq.aschKeysStarted[n]?kiwi._tq.aschKeysLoaded[n]?_satellite.logger.log(ruleName+\" > no waitCount-- for \"+l+\" (already loaded)\"):(kiwi._tq.waitCount--,_satellite.logger.log(ruleName+\" > waitCount--: \"+kiwi._tq.waitCount+\" for \"+l)):kiwi._tq.pageTrackInProgress?_satellite.logger.log(ruleName+\" > pagetrack already in progress so ignoring \"+l+\" (rogue)\"):_satellite.logger.log(ruleName+' > no prior \"starting\" call found so ignoring '+l+\" (rogue)\"))}kiwi._tqfn.checkTrackReady(e,t,s,i,r)}},checkTrackReady:function(e,t,a,i,r){kiwi._tq.waitCount?_satellite.logger.info(kiwi._tqfn.ruleName+\" > Track Queue WAITING (\"+kiwi._tq.waitCount+\") {\"+e+\", \"+a.name+\"} > \"+t):(_satellite.logger.info(kiwi._tqfn.ruleName+\" > Track Queue Ready! (\"+kiwi._tq.waitCount+\") {\"+e+\", \"+a.name+\"} > \"+t),kiwi._tqfn.doTrack(e,t,i,r))},clearAllTmos:function(){_satellite.logger.info(kiwi._tqfn.ruleName+\" > Clearing all TMOs\"),window.clearTimeout(kiwi._tq.tmos[\"fail-over\"]),window.clearTimeout(kiwi._tq.tmos[\"page-load\"]),window.clearTimeout(kiwi._tq.tmos[\"route-hash\"]),window.clearTimeout(kiwi._tq.tmos[\"spa-page\"]),window.clearTimeout(kiwi._tq.tmos.spa),window.clearTimeout(kiwi._tq.tmos.widgets),window.clearTimeout(kiwi._tq.tmos[\"asch-end\"])},doTrack:function(e,t,a,i){var r=\"\",l=kiwi._tqfn.calculateWholeTrackSource(e,a,i);kiwi._tqfn.resetDataAfterTrack(),\"page\"===t?(r=kiwi._tqfn.updateDlsAndGetLatestPageName(),_satellite.logger.info(kiwi._tqfn.ruleName+\" > Track Queue TRACK! {\"+e+\", \"+r.name+\"} > \"+t),kiwi._tqfn.trackPage(e,r,l)):(_satellite.logger.info(kiwi._tqfn.ruleName+\" > Track Queue TRACK! {\"+e+\", \"+r.name+\"} > \"+t),kiwi._tqfn.trackLink(e,l))},trackPage:function(e,t,a){kiwi._tq.timeStampTrackEnd=Date.now(),t=t||kiwi._tqfn.updateDlsAndGetLatestPageName(),_satellite.logger.info(kiwi._tqfn.ruleName+\" > Calling kiwi.page.track {\"+a+\", \"+t.name+\"}\"),_satellite.logger.info(kiwi._tqfn.ruleName+\" > kiwi._tqdl is set to \"+JSON.stringify(kiwi._tqdl));var i=\"kiwi.page.track\";document.dispatchEvent(new CustomEvent(i,{bubbles:!0,detail:{pageName:t,pageTrackSource:a,timeToTrackDs:kiwi._tqfn.calculateTimeToTrack()}}))},trackLink:function(e,t){var a=\"Track Queue - \"+e;if(\"widgets\"===e)_satellite.logger.info(kiwi._tqfn.ruleName+\" > Calling kiwi.widgetsReady: {\"+t+\", \"+a+\"}\"),_satellite.track(\"kiwi.widgetsReady\");else{_satellite.logger.info(kiwi._tqfn.ruleName+\" > Calling kiwi.link.track: {\"+t+\", \"+a+\"}\");var i=\"kiwi.link.track\";document.dispatchEvent(new CustomEvent(i,{bubbles:!0,detail:{deKey:a,oData:{hasData:!0,trackSource:t}}}))}},resetDataAfterTrack:function(){kiwi._tq.pageLoadTracked=1,kiwi._tqfn.clearAllTmos(),kiwi._tq.waitCount=0,kiwi._tq.tmos={},kiwi._tq.inQueue={},kiwi._tq.aschKeysStarted=[],kiwi._tq.aschKeysLoaded=[],kiwi._tq.pageTrackInProgress=0,kiwi._tq.startTrackSource=\"\",_satellite.logger.log(ruleName+\" > WaitCount: \"+kiwi._tq.waitCount+\"  resetDataAfterTrack\")},calculateTimeToTrack:function(){var e=kiwi._tq.timeStampTrackStart||0,t=kiwi._tq.timeStampTrackEnd||0,a=e&&t?kiwi.util.getTimeDiff(e,t,\"ds\"):\"\";return kiwi._tq.timeStampTrackStart=0,kiwi._tq.timeStampTrackEnd=0,a},calculateWholeTrackSource:function(e,t,a){var i=e;return t&&(i=(a=a||!1)?t+\">\":t+\">\"+e),_satellite.logger.info(kiwi._tqfn.ruleName+\" > calculateWholeTrackSource {\"+e+\", \"+t+\", \"+a+\"}\"),i}},\"widgets\"===trackSource&&ignoreWidgets?_satellite.logger.info(ruleName+\" > suppressing widget tracking.\"):handleEvent(trackSource,expectWidgets,expectSpa,updateDl,passedIn)}catch(e){_satellite.logger.error(ruleName+\" > ERROR: \"+e.message)}");