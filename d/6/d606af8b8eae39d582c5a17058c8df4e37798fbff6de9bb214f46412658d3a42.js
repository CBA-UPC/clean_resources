(self.webpackChunktama_web=self.webpackChunktama_web||[]).push([[8135],{28135:(e,t,r)=>{"use strict";r.d(t,{LC:()=>w,KT:()=>Z,O7:()=>j,ZE:()=>A,SN:()=>E,L0:()=>S,w7:()=>x,jY:()=>_,OB:()=>L,bn:);var a=r(66062),n=r(41185),i=r(55752),o=r.n(i),l=r(76088),u=r.n(l),c=r(98231),d=r.n(c),y=r(18274),s=r(70709);unction m(){return(m=(0,a.Z)((function*(e){return fetch(e,{mode:"cors"})}))).apply(this,arguments)}var f=r(75457),g=r(16884),h=r(55761);r b=e=>{var t=d()(e,"entryUrl"),r=[];return Object.keys(t).forEach((e=>{var a=t[e],n=a.length;a.forEach(((e,t)=>{r.push(I(I({},e),{},{imageNumInEntry:n,imageIndexInEntry:t}))}))})),r},w=e=>({type:h.EK,payload:{layoutType:e}}),x=function O(e){var t=e,r=t.date.split("/");t.formatDate={year:r[0],month:r[1],date:r[2]};var a=t.pageUrl.match(/[0-9a-zA-Z-]+\/image-(\d{11})-(\d{11}).html/);return t.entryId=a[1],t.imageId=a[2],t}var U=(e,t,r,a,n,i,o,l,u,c)=>({type:h.mK,payload:{amebaId:e,year:t,assignedYearMonth:r,monthlyCounts:a,nextYearMonth:n,prevYearMonth:i,firstEntryId:o,isNoPostUser:l,isNoPostMonth:u,finishedFirstLoad:c}}),P=e=>({type:h.WK,payload:{error:e},error:!0}),j=(0,y.H)((function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return function(){var i=(0,a.Z)((function*(a,i,l){var{fetchr:u}=l,c=/^\d{6}$/.test(r);if(c){var d=r.slice(0,4);if(o()(i(),["imageState","imageArchiveMap",t,d,r,"imageData"],[])[0])return null}try{var y={year_month:c?r:"",limit:n},s=(yield u.read("blogImage").params({blogId:e,amebaId:t,options:y}).end()).data,p=o()(s,["paging","total_count"]),m=o()(s,["summary","next_year"],""),f=o()(s,["summary","prev_year"],""),g=!1;p||m||f||(g=!0);var h=!p,v=o()(s,["summary","assigned_year_month"]),I=v.slice(0,4),b=o()(s,["data","0","entry_id"],null),w=!b,x=o()(s,["summary","monthly_counts"],[]);return a(U(t,I,v,x,m,f,b,g,h,w))}catch(O){return a(P(O))}}));return ()})),E=()=>function(){var e=(0,a.Z)((function*(e,t){var r=o()(t(),["imageState","imageSession"]);if(!r.amebaId||!r.entryId)return null;var a=r.next,n=a.url;if(a.loading||!n)return null;e({type:h.XC,payload:{requestUrl:n}});try{var i=yield p(n);if(!i.ok)throw new Error(yield i.text());var{imgList:l,nextUrl:u}=yield i.json(),c=new Promise((),d=b(l);return c.then((()=>e(((e,t,r)=>({type:h.Ey,payload:{requestUrl:e,imageList:t.map(O),nextUrl:r}}))(n,d,u))))}catch(y){return e(((e,t)=>({type:h.m4,payload:{requestUrl:e,error:t},error:!0}))(n,y))}}));return function(t,r){return e.apply(this,arguments)}}(),S=()=>function(){var e=(0,a.Z)((function*(e,t){var r=o()(t(),["imageState","imageSession"]);if(!r.amebaId||!r.entryId)return null;var a=r.prev,n=a.url;if(a.loading||!n)return null;e({type:h.uH,payload:{requestUrl:n}});try{var i=yield p(n);if(!i.ok)throw new Error(yield i.text());var{imgList:l,nextUrl:u}=yield i.json();return e(((e,t,r)=>({type:h.Hu,payload:{requestUrl:e,imageList:t.map(O),prevUrl:r}}))(n,b(l),u))}catch(c){return e(((e,t)=>({type:h.UN,payload:{requestUrl:e,error:t},error:!0}))(n,c))}}));return function(t,r){return e.apply(this,arguments)}}(),M=(0,y.H)(((e,t,r,n)=>function(){var i=(0,a.Z)((function*(i,l){var c=o()(l(),["imageState","imageSession"],{});if(c.amebaId===e&&c.entryId===t)return null;i({type:h.Pt,payload:{amebaId:e,entryId:t,imagesPlaceholders:n||[]}}),n&&n.length>0&&i({type:h.jP,payload:{imageId:r,entryId:t}});try{var d={ameba_id:e,entry_id:t,sp:!0},y=function(){var e=(0,a.Z)((function*(e){var t=yield function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,s.ui)("".concat(window.process.env.API_IMAGE,"/read_ahead/get.json"),e);return fetch(t,{mode:"cors"})}(I(I({},d),{},{old:e}));if(!t.ok)throw new Error(yield t.text());return t.json()}));return (),[p,m]=yield Promise.all([y(!1),y(!0)]),f=p.nextUrl,g=m.nextUrl,v=u()([...(p.imgList||[]).slice().reverse(),...m.imgList],(e=>e.pageUrl)),w=b(v);return i(((e,t,r,a,n)=>({type:h.C8,payload:{amebaId:e,entryId:t,imageList:r.map(O),prevUrl:a,nextUrl:n}}))(e,t,w,f,g))}catch(x){return console.warn(x),i(((e,t,r)=>({type:h.pz,payload:{amebaId:e,entryId:t,error:r},error:!0}))(e,t,x))}}));return function(e,t){return i.apply(this,arguments)}}())),_=(e,t,r,n,i)=>function(){var l=(0,a.Z)((function*(a,l){if(e&&t&&r){n&&n("/".concat(e,"/image-").concat(r,"-").concat(t,".html"),{replace:!0,state:{isInternal:!0}});var u=o()(l(),["imageState","imageModal"],{});u.isOpen&&t===u.imageId&&r===u.entryId||a({type:h.jP,payload:{imageId:t,entryId:r}});var c=()=>o()(l(),["imageState","imageSession"],{}),d=()=>o()(l(),["imageState","imageSession","imageList"],[]),y=()=>d().findIndex((a=>a.pageUrl==="/".concat(e,"/image-").concat(r,"-").concat(t,".html")));c().amebaId===e&&-1!==y()||(yield a(M(e,r,t,i))),c().amebaId===e&&0===y()&&(yield a(S())),c().amebaId===e&&y()===d().length-1&&(yield a(E()))}}));return function(e,t){return l.apply(this,arguments)}}(),Z=e=>function(){var t=(0,a.Z)((function*(t,r){var a=o()(r(),["imageState","imageModal"],{}),n=o()(r(),["router","location","pathname"],"");a.isOpen&&(e&&e(n,{replace:!0,state:{isInternal:!0}}),t({type:h.fM}))}));return function(e,r){return t.apply(this,arguments)}}(),A=(e,t)=>function(){var r=(0,a.Z)((function*(r,a){var n=t&&t.slice(0,4),i=a();if(o()(i,["imageState","imageArchiveMap",e,n,t,"isAllFetched"],!1))return null;try{yield r(((e,t,n));var l,u=o()(i,["imageState","imageArchiveMap",e,n,t,"nextUrl"],null),c=o()(i,["imageState","imageMetaMap","firstEntryId"],null);if(!(l=u?yield u):yield function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{limit:5,to_old:!0},a=(0,s.ui)("".concat(window.process.env.API_IMAGE,"/blog/").concat(e,"/entries/").concat(t,"/neighbors"),r);return fetch(a,{mode:"cors"})}(e,c,{limit:10,to_old:!0})).ok)throw new Error(yield l.text());var d=yield l.json(),y=d.data||[],p=o()(d,["paging","nextUrl"]),m=!1,v=y.filter((e=>(e=>{if(!e||-1===e.indexOf("/"))return e;var t=e.split("/");return t[0]+t[1]})(e.date)===t||(m=!0,!1)));""===p&&(m=!0);var b=v.map((t=>{var{entryId:r}=t;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r="".concat(window.process.env.API_IMAGE,"/blog/").concat(e,"/entries/").concat(t,"/images");return fetch(r,{mode:"cors"})}(e,r)})),w=yield Promise.all(b);if(w.map(().includes(!1))throw new Error(yield l.text());var x=w.map((),O=yield Promise.all(x),U=v.reduce(((t,r)=>{var a=O.find(();return[...t,...a.data.map(((t,n)=>{var i;i=t.altText?t.altText:a.data.length>1?"\u753b\u50cf ".concat(t.title," \u306e\u8a18\u4e8b\u3088\u308a ").concat(n+1,"\u3064\u76ee"):"\u753b\u50cf ".concat(t.title," \u306e\u8a18\u4e8b\u3088\u308a");var o=(0,g.Z)(f.Z.Image,{amebaId:e,entryId:r.entryId,imageId:t.imageId}),l=(0,g.Z)(f.Z.Entry,{amebaId:e,entryId:r.entryId});return I(I({},t),{},{entryId:r.entryId,date:r.date,length:a.length,alt:i,imageDetailUrl:o,entryUrl:l})}))]}),[]);return r(((e,t,r,a,n,i)=>({type:h.AT,payload:{amebaId:e,imageList:t,nextUrl:r,yearMonth:a,isAllFetched:n,year:i}}))(e,U,p,t,m,n))}catch(P){return r(((e,t,r,a)=>({type:h.l0,payload:{error:e,amebaId:t,yearMonth:r,year:a},error:!0}))(P,e,t,n))}}));return (),L=,57703:4967:79505:98231:]);