!function(){var e=window.$ice.products.$create("intext",{createCandidate:function(e,t,n){var i=this.$root,o=i.utils,s=o.dom,r={};return r.sentence=n,r.node=e,r.parentNode=t,r.rendered=!1,r.type="intext",r.prod="i",r.bubble=o.object.clone(i.bubble.settings.base),r.fontSize=(1==e.nodeType?parseInt(s.element.getStyle(e,"lineHeight"),10):parseInt(s.element.getStyle(t,"fontSize"),10))||0,r.visible=s.element.isVisible(t),r.onViewPort=s.element.isOnViewport(t),r.wordCount=(t.innerText||t.textContent).replace(/\s+/g," ").length,r.importance=t.offsetWidth/s.viewport.getWidth(),r},estimateCandidatesFontSizeIE:function(e){var t,n=this.$root.browser;if(n.IE&&!(9<=n.getVersion(!0)))for(var i=0,o=e.length;i<o;i++)(t=e[i]).fontSize=t.node.firstChild.offsetHeight||0},scoreFactorsCalc:{fontSize:function(e){return!e||16<e||e<10?0:1},wordCount:importance:function(e){return.4<e?1:.2<e?.5:e}},scoreCandidates:function(e){for(var t,n=this.settings.scoreFactors,i=this.scoreFactorsCalc,o=0,s=e.length;o<s;o++)(t=e[o]).score=i.fontSize(t.fontSize)*n.fontSize+(t.visible?1:0)*n.visible+(t.onViewPort?1:0)*n.onViewPort+i.wordCount(t.wordCount)*n.wordCount+i.importance(t.importance)*n.importance},createStyleSheet:function(){var e=this.$root,t=this.settings,n=t.behavior.merged,i=e.browser,e=e.utils.dom,o=e.style,s=e.element.getStyle(document.body),s=(s&&"relative"==s.position&&s.width&&parseInt(s.width,10)<e.document.getWidth()&&(document.body.style.position="static"),o.buildHookUnderlineCSS(n.underline,n.linkColor,!0));o.addRule("."+t.hookClass,[s,"color:",n.linkColor," !important; background:transparent none repeat scroll 0% !important;cursor:pointer !important;position:static;display:inline !important;padding:0 0 1px 0 !important;float:none !important;"].join("")),n.linkHoverColor&&o.addRule("."+t.hookClass+"_HOVER",["color:",n.linkHoverColor," !important;border-bottom-color:",n.linkHoverColor," !important;"].join("")),n.simanitIcon&&(i.IE&&i.getVersion(!0)<=7?o.addRule("."+t.hookClass+"_ICON",["display:inline-block !important; position:static !important;cursor:pointer !important;margin:0 !important;padding:0 !important;background:transparent url(",n.simanitIcon,") no-repeat scroll ",n.simanitPosition," center; width:",n.simanitWidth,"px !important;float:none !important;"].join("")):o.addRule("."+t.hookClass+"_ICON",["display:inline !important;position:static !important;cursor:pointer !important;margin:0 !important;padding:0 !important;background:transparent url(",n.simanitIcon,") no-repeat scroll ",n.simanitPosition," center;padding-",n.simanitPosition,":",n.simanitWidth,"px !important; float:none !important;",i.IE?"height:1%;":""].join("")),n.simanitOver)&&o.addRule("."+t.hookClass+"_ICON_OVER",["background-image:url(",n.simanitOver,");"].join(""))},createHook:function(e,t,n){var i=this.$root,o=this.settings,s=i.settings,r=o.behavior.merged,a=i.browser,d=e.node=document.createElement("span"),n=(e.id=++s.hooksCount,o.hooksCount++,d.id=o.hookClass+e.id,n&&(e.updater=n),s.hooksMap[e.id]=e,d.className=o.hookClass,t.data||t.innerHTML.replace(/<\/?span>/gi,"")),o=(r.simanitIcon?(s=['<span class="',o.hookClass,'_ICON"></span>'].join(""),d.innerHTML="left"==r.simanitPosition?s+n:n+s):d.innerHTML=n,i.utils.dom.element.getStyle(e.parentNode)),r=[],s=i.utils.array.push;return o.fontFamily&&s(r,"font-family:",o.fontFamily," !important;"),o.fontWeight&&s(r,"font-weight:",o.fontWeight," !important;"),o.fontStyle&&s(r,"font-style:",o.fontStyle," !important;"),(!a.IE||8<a.getVersion(!0))&&!a.Opera&&o.fontSize&&null!=o.fontSize.match(/px$/)&&s(r,"font-size:",o.fontSize," !important;"),1!=t.nodeType&&!a.IE||s(r,this.fixIEAdNodeStyle(t)),i.utils.dom.style.addRule("#"+d.id,r.join("")),e.currentAdIndex=0,i.helpers.bindHookEvents(e),d},fixIEAdNodeStyle:function(e){var t=this.$root,n=this.settings.behavior.merged,i=t.browser,t=t.utils,o=t.dom.element,t=t.array.push,s=[],i=(1!=e.nodeType&&(e=e.parentNode),7<=i.getVersion()&&"double"==n.underline&&t(s,"border:1px solid transparent; border-bottom:1px solid ",n.linkColor,";"),"single"!=n.underline&&"none"!=n.underline&&t(s,"padding-bottom:2px;"),e.offsetParent),t=o.offset(e);return i&&null!=i.tagName.toLowerCase().match(/^(?:li|td)$/)&&t.top+e.offsetHeight>=o.offset(i).top+i.offsetHeight&&o.setStyle(i,{paddingBottom:"3px"}),t.top+e.offsetHeight>document.body.clientHeight&&o.setStyle(document.body,{paddingBottom:"3px"}),i=e.parentNode,"double"==n.underline&&o.getStyle(i,"styleFloat")&&parseInt(o.getStyle(i,"paddingBottom"))<2&&i.offsetHeight<18&&o.setStyle(i,{paddingBottom:"2px"}),s.join("")},revertCandidateNodesIE:function(e){var t,n,i,o,s,r,a,d,l=this.$root;if(l.browser.IE)for(n in d=(e||l.comm.settings.responses).impression.sentences)if(t=d[n].candidates)for(i=0,o=t.length;i<o;i++)r=t[i].node,s=document.createTextNode(r.innerText),(a=r.parentNode).insertBefore(s,r),a.removeChild(r),t[i].node=s}},{settings:{prodCode:"i",prodName:"intext",behavior:{def:{skin:"variant",theme:"def",highlightCount:1,underline:"double",favicon:!1,simanitIcon:null,simanitOver:null,simanitWidth:16,simanitPosition:"right"},sanitizer:{highlightCount:"int",underline:["double","single","dotted","dashed","none"],favicon:"str",simanitIcon:"str",simanitOver:"str",simanitWidth:"int",simanitPosition:["right","left"]}},hookClass:"IL_AD",hooksCount:0,maxCandidates:50,scoreFactors:{fontSize:10,visible:10,onViewPort:50,wordCount:30,importance:0},rendered:0}},!0);e.bind({event:"renderIntextProduct",listener:{renderIntext:function(){var e=this.$root;e.comm.settings.responses.impression.prs.i?(e.event.fire("productRenderStatus",{prod:"i",status:"during"}),e.utils.timer.start("tmr_hi"),e.event.fire("initIntext")):e.event.fire("productRenderStatus",{prod:"i",status:"none"})}}}),e.bind({event:"destroy",listener:{destroy:function(e){var t=this.$root,n=this.settings,t=(t.utils,n.behavior.merged);try{if("true"==t.gptDestroySlots)for(var i=document.getElementsByClassName(n.hookClass),o=0;o<i.length;o++)i[o].outerHTML=i[o].innerText}catch(e){}}}}),e.bind({event:"initIntext",listener:{init:function(e){var t=this.$root,n=t.settings.behavior,i=this.settings.behavior,o=t.comm.settings.responses.impression.prs.i,s=t.utils.object;t.bubble&&(i.customer=t.helpers.getCustomerBehavior("link_color highlight_count underline simanit_icon simanit_over simanit_width simanit_position"),i.impression=t.helpers.renameBehaviorProperties(o.behavior||{}),function(){for(var e=0;e<arguments.length;e++)"undefined"==t.what(arguments[e].underline)&&"undefined"!=t.what(arguments[e].doubleUnderline)&&(arguments[e].underline="false"==arguments[e].doubleUnderline.toString()?"dotted":"double")}(n.impression,i.impression,i.customer),i.merged=t.utils.object.extend({},n.def,i.def,n.impression,i.impression,n.customer,i.customer),t.helpers.sanitize(i.merged,s.extend({},n.sanitizer,i.sanitizer)),t.bubble.initialized||t.event.fire("initBubble",this.settings.prodName),t.event.fire("setIntextMarkers",e))}}}),e.bind({event:"setIntextMarkers",listener:{setCandidates:function(e){for(var t,n,i,o,s,r,a,d,l,c,m,h,p,u,g,f,b=this.$root,v=b.harvest.settings,C=this.settings,e=e.data&&e.data.updater?e.data.updater:null,v=v.instances[v.instances.length-1],k=[],x=e?(t=e).sentences={}:(t=b.comm.settings.responses,C.sentences={}),y=v.nodes,v=t.impression.sentences,I=t.impression.prs.i.sentences||[],S=b.utils.object.keys(v),N=0,w=I.length;N<w;N++){for(i=(n=S[I[N]]).replace(/([\+\.\?\(\)\[\]\*])/g,"\\$1").replace(/(\w+)/g,"\\b$1\\b").replace(/\s+/g,"\\s+"),o=new RegExp(i,"i"),l=x[n]={candidates:[],hooks:[],rendered:0},s=0,r=y.length;s<r&&!(l.candidates.length>=C.maxCandidates);s++)if((a=y[s]).parentNode&&"undefined"!=b.what(a.data)&&-1==b.utils.array.indexOf(k,a)&&(d=a.data,c=o.exec(d))&&a.parentNode.className!=C.hookClass&&null==d.substr(c.index+c[0].length).match(/^[\u2019']s/)){for(f=!1,m=document.createDocumentFragment(),h=a.parentNode,y.splice(s,1);c&&l.candidates.length<C.maxCandidates;)p=c[0],0!=c.index&&null!=d.charAt(c.index-1).match(/\w/)||!(d.length<=c.index+p.length||null==d.charAt(c.index+p.length).match(/\w/))||(f=!0,0<c.index&&(u=document.createTextNode(d.substr(0,c.index)),m.appendChild(u),y.splice(s++,0,u)),b.browser.IE&&b.browser.getVersion(!0)<9?(g=document.createElement("span")).innerHTML=["<span>",p.charAt(0),"</span>",p.substring(1)].join(""):g=document.createTextNode(p),b.utils.array.push(k,g),g=m.appendChild(g),b.utils.array.push(l.candidates,this.createCandidate(g,h,n))),d=d.substr(c.index+p.length),c=o.exec(d);f&&(""!=d&&(u=document.createTextNode(d),m.appendChild(u),y.splice(s,0,u)),h.insertBefore(m,a),h.removeChild(a),a.data="",r=y.length)}for(this.estimateCandidatesFontSizeIE(l.candidates),this.scoreCandidates(l.candidates),b.utils.array.insertionSort(l.candidates,"score",!1),s=C.behavior.merged.highlightCount,r=l.candidates.length;s<r;s++)b.utils.array.push(y,l.candidates[s].node)}b.event.fire("createIntextHooks",{updater:e})}}}),e.bind({event:"createIntextHooks",listener:{createIntextHooks:function(e){var t,n,i,o,s,r,a,d,l,c,m,h=this.$root,p=this.settings,u=p.behavior.merged,g=e.data&&e.data.updater?e.data.updater:null;h.helpers;for(g?o=(t=g).sentences:(t=h.comm.settings.responses,o=p.sentences,this.createStyleSheet()),e=t.impression.sentences,n=t.impression.prs.i.sentences,i=h.utils.object.keys(e),c=0,m=n.length;c<m;c++)for(s=o[i[n[c]]];s.candidates.length&&s.rendered<u.highlightCount;)(d=(a=(r=s.candidates[0]).node).parentNode||r.parentNode)&&(l=this.createHook(r,a,g),d.insertBefore(l,a),d.removeChild(a),r.rendered=!0,s.rendered++,0!=s.hooks.length||g||p.rendered++,h.utils.array.push(s.hooks,s.candidates.shift()),r.pos=h.utils.dom.element.offset(l));this.revertCandidateNodesIE(g),h.utils.timer.stop("tmr_hi"),g||h.event.fire("productRenderStatus",{prod:"i",status:"after"})}}}),e.bind({event:"intextHookMouseover",listener:{intextHookMouseover:function(e){var t,n=this.$root.settings,i=this.settings.behavior.merged,e=n.hooksMap[e.data.hookId];"none"==n.clickStatus&&(n=this.settings.hookClass,i.linkHoverColor&&(e.node.className=[n," ",n,"_HOVER"].join("")),i.simanitIcon)&&i.simanitOver&&(t=e.node.getElementsByTagName("span")).length&&(t[0].className=[n,"_ICON ",n,"_ICON_OVER"].join(""))}}}),e.bind({event:"intextHookMouseout",listener:{hookMouseout:function(e){var t=this.$root.settings,n=this.settings.behavior.merged,t=t.hooksMap[e.data.hookId],e=this.settings.hookClass;n.linkHoverColor&&(t.node.className=e),n.simanitIcon&&n.simanitOver&&(n=t.node.getElementsByTagName("span")).length&&(n[0].className=e+"_ICON ")}}})}();