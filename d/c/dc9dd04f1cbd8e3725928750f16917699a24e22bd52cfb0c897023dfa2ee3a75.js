/*
* Braze Web SDK v3.1.2
* (c) Braze, Inc. 2021 - http://braze.com
* License available at https://github.com/Appboy/appboy-web-sdk/blob/master/LICENSE
* Compiled on 2021-02-01
*/
'use strict';const h={K:;const l={I:;onst x={s:la:na:oa:info:error:;var y={CustomEvent:"ce",ba:"p",H:"pc",G:"ca",da:"i",ca:"ie",R:"cci",S:"ccic",O:"ccc",P:"ccd",ia:"ss",ha:"se",aa:"si",Z:"sc",Y:"sbc",$:"sfe",T:"iec",ga:"lr",L:"uae",N:"ci",M:"cc",ea:"lcaa",fa:"lcar",V:"inc",U:"add",W:"rem",X:"set"},z=w,A={h:{g:"AppboyServiceWorkerAsyncStorage",VERSION:5,c:{l:"data",F:"pushClicks",A:"pushSubscribed",o:"fallbackDevice",D:"cardUpdates",v:"optOut"},m:1}},B=x;function D(a,b,c){return new Promise(function(f,e){const d={};d.time=Math.floor((new Date).valueOf()/1E3);d.device_id=c;d.api_key=a;d.sdk_version="3.1.2";d.sdk_flavor="amp";d.respond_with={config:{config_time:0}};fetch(b+"/data/",{method:"POST",headers:{"Content-type":"application/json","X-Braze-Api-Key":a},body:JSON.stringify(d)}).then(.then(function(g){g.error?(B.error("Unable to get config: "+g.error),e()):
(g={userVisibleOnly:!0,applicationServerKey:h.K(g.config.vapid_public_key)},f(g))}).catch(})}
function H(a,b,c,f,e,d,g,k){return new Promise(function(m,n){const p={};p.device_id=c;p.api_key=a;p.sdk_version="3.1.2";null!=d&&(p.sdk_flavor=d);let E=null,F=null,G=null;e&&(G=e.endpoint,e.getKey&&(E=btoa(String.fromCharCode.apply(null,new Uint8Array(e.getKey("p256dh")))),F=btoa(String.fromCharCode.apply(null,new Uint8Array(e.getKey("auth"))))));p.time=Math.floor((new Date).valueOf()/1E3);p.attributes=[{user_id:f,push_token:G,custom_push_public_key:E,custom_push_user_auth:F}];fetch(b+"/data/",
{method:"POST",headers:{"Content-type":"application/json","X-Braze-Api-Key":p.api_key},body:JSON.stringify(p)}).then(.then(function(u){u.error?(B.error(k+" "+u.error),n()):(B.info(g),m())}).catch(})}
function I(a,b){return C().then(function(){const c=A.h;v(new z(c,B),c.c.l,function(f,e){f=Math.floor((new Date).valueOf()/1E3);const d=e.data;d.time=f;a.time=f;a.user_id=e.userId;d.events=[a];d.sdk_version="3.1.2";fetch(e.baseUrl+"/data/",{method:"POST",headers:{"Content-type":"application/json","X-Braze-Api-Key":d.api_key},body:JSON.stringify(d)}).then(.then(function(g){g.error?B.error("Unable to log "+b+":",g.error):
B.info("Successfully logged "+b);return Promise.resolve()}).catch(})}).catch(function(){return Promise.reject("Not sending data to Braze backend due to opt-out.")})};function J(){const a=self.location.search.match(/apiKey=([^&]+)/i);if(a)return a[1];B.error("Missing API key in query params.");return null}function M(a,b,c,f){return D(a,b,c).then(.then(function(e){L("amp-web-push-subscribe",null);return H(a,b,c,f,e,"amp","Successfully sent AMP push subscription to Braze backend.","Unable to send AMP push subscription to Braze backend.")}).catch(function(){B.error("Failed to subscribe for AMP push.");return Promise.reject()})}
function O(){const a=A.h,b=new z(a,B);return(new Promise(function(c,f){v(b,a.c.l,function(e,d){M(d.data.api_key,d.baseUrl,d.data.device_id,d.userId).then(function(){c()}).catch(function(){f()})},})).then(function(){return new Promise(function(c,
f){b.setItem(a.c.A,a.m,!0,c,f)})})}
function P(){return self.registration.pushManager.getSubscription().then(.then(function(){L("amp-web-push-unsubscribe",null);const a=A.h,b=new z(a,B);return(new Promise(function(c,f){v(b,a.c.l,function(e,d){H(d.data.api_key,d.baseUrl,d.data.device_id,d.userId,null,"amp","Successfully sent AMP push unsubscription to Braze backend.","Unable to send AMP push unsubscription to Braze backend.").then(function(){c()}).catch(function(){f()})},function(){v(b,a.c.o,function(e,
d){e=J();const g=K();H(e,g,d,null,null,"amp","Successfully sent AMP push unsubscription to Braze backend.","Unable to send AMP push unsubscription to Braze backend.").then(function(){c()}).catch(function(){f()})},})})).then(}).catch(function(){B.error("Failed to unsubscribe for AMP push.");return Promise.reject()})};B.s(!0);
elf.addEventListener("install",;self.addEventListener("activate",;
self.addEventListener("push",;
self.addEventListener("notificationclick",;self.addEventListener("pushsubscriptionchange",function(a){Q(a,C().then(.then(function(b){const c=A.h;return new Promise(function(f,e){v(new z(c,B),c.c.l,function(d,g){H(g.data.api_key,g.baseUrl,g.data.device_id,g.userId,b,null,"Successfully resubscribed user after expiration","Unable to resubscribe user").then(function(){f()}).catch(})})}).catch()});
self.addEventListener("message",;
