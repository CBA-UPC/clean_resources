"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1953],{23093:function(e,t,r){r.d(t,{W:function(){return PresentButton},Z:function(){return OfflineBar}});var i=r(52322),s=r(2784),o=r(8583),n=r(83122),l=r(76421),a=r(88741),d=r(5632),u=r(56958);function OfflineBar(e){let{projectId:t}=e,[r,d]=(0,s.useState)(!1);(0,s.useEffect)(()=>{t&&a.w.project.findFirst({where:t}).then(},[t]);let c=(0,s.useCallback)(()=>{u.A.promise((0,l.W3)(a.w,t).then(async()=>{let e=await a.w.project.findFirst({where:t});d(!!e)}),{loading:"Downloading...",success:"Downloaded!",error:"Error downloading"})},[t]);return(0,i.jsxs)("div",{className:(0,n.AK)("hidden","pwa:flex items-center justify-between rounded-md border bg-white px-4 py-3"),children:[(0,i.jsxs)("div",{className:"grid gap-1.5",children:[(0,i.jsxs)("div",{className:"flex items-center text-sm font-medium text-gray-700",children:[(0,i.jsx)(o.wQA,{className:"mr-1 h-3.5 w-3.5"}),"Offline version"]}),(0,i.jsx)("div",{className:"flex text-sm text-gray-500",children:r?"Version available":"No downloaded versions"})]}),(0,i.jsx)("div",{children:(0,i.jsxs)("div",{className:"flex gap-x-2",children:[(0,i.jsx)("button",{onClick:c,className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Download"}),(0,i.jsx)(PresentButton,{projectId:t,disabled:!r})]})})]})}function PresentButton(e){let{handlePresent:t,projectId:r,disabled:s}=e,o=(0,d.useRouter)();return(0,i.jsx)("button",{disabled:s,onClick:()=>{if(t){t(r);return}o.push({pathname:"/launchpad/present/offline/[id]",query:{id:r}})},className:"duration-70 flex items-center justify-between rounded-md border border-[#455CAD] bg-[#455CAD] px-3 py-1 text-sm text-white transition-all hover:bg-[#4258a6] focus:border-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-300 disabled:cursor-not-allowed disabled:opacity-75",children:"Present"})}},49323:87823:76421:function(e,t,r){r.d(t,{W3:function(){return syncProject}});var i=r(47330),s=r(79228),o=r(66786),n=r(47147),l=r(73750),a=r(81525),d=r(3583),u=r(83615),c=r(20851);async function syncStaticResource(e,t,r,i){if(t.startsWith("data:"))return;let o=(0,s.m1)(t);if(o){let n=await (0,s.M2)(e,t,r,i);if(!n)return;let a=(0,l.C)(n);if(!a)return;let{mime:d,base64:u}=a;if(!d.startsWith("text/css"))return;let c=u?atob(a.body):a.body,h=(0,s.d1)(r,{staticResourceId:o});await (0,s.$_)(e,c,h);return}let n=await (0,s.Cz)(t,i);if(!n)return;let a=(0,l.C)(n);if(!a)return n;let{mime:d,base64:u}=a;if(!d.startsWith("text/css"))return n;let c=u?atob(a.body):a.body,h=c;return await (0,s.Cf)(c,async(t,i)=>{let o=i[0].includes("@import"),n=(0,s.m1)(t),l=n?(0,s.d1)(r,{staticResourceId:n}):r,a=await syncStaticResource(e,t,l,o?"text/css":void 0);a&&(h=h.replace(t,a))}),"data:text/css;base64,".concat(btoa(h))}async function syncWebCapture(e,t,r){let{id:i,published:o}=t,n=(null==o?void 0:o.captureVersionId)||(null==o?void 0:o.id);if(n&&r.allWebCaptureVersions[n])return;r.allWebCaptureVersions[n]=!0;let l={id:n,webCaptureId:i,node:await (0,s.rT)({id:n})};if(!l.node){console.error("Capture ".concat(n," not found"));return}let d=(0,s.d1)(r,{webCaptureVersionId:n});return d.webCaptureVersionToStaticResources[n]=[],await (0,a.hv)(l.node,[(0,s.Or)({filter:u.hK,operation:(0,s.rw)(e,d)}),(0,s.tZ)({filter:s.u4,operation:(0,s.GR)(e,d)}),(0,s.tZ)({filter:s.If,operation:(0,s.Xw)(e,d)}),(0,s.tZ)({filter:s.aI,operation:(0,s.kC)(e,d)}),(0,s.tZ)({filter:s.Yn,operation:(0,s.dv)(e,d)}),(0,s.tZ)({filter:s.wq,operation:(0,s.oB)(e,d)}),(0,s.tZ)({filter:s.FU,operation:(0,s.EA)(e,d)}),(0,s.tZ)({filter:s.TE,operation:(0,s.hQ)(e,d)})],!0),d.guideToWebCaptureVersions[r.guideId].push(n),await e.webCaptureVersion.upsert({data:l})}async function syncWebCaptures(e,t,r){return await Promise.all(t.map(t=>syncWebCapture(e,t,r)))}async function syncScreenshotCapture(e,t,r){if(r.allScreenshotCaptures[t.id])return;r.allScreenshotCaptures[t.id]=!0;let{deviceScreenshot:i,deviceTemplate:n,...l}=t,a={...l,deviceScreenshot:i,deviceTemplate:void 0};if(i&&(a.deviceScreenshot=await (0,s.Cz)(i)),n){let e=o.Ak.find(;if(null==e?void 0:e.image){let t=(0,o.Gc)(e),r=await (0,s.Cz)(t);r&&(a.deviceTemplate={...e,image:r})}}return r.guideToScreenshotCaptures[r.guideId].push(t.id),await e.screenshotCapture.upsert({data:a})}async function syncScreenshotCaptures(e,t,r){return await Promise.all(t.map()}async function syncFlow(e,t,r){if(r.allGuides[t.id])return;if(r.allGuides[t.id]=!0,!("published"in t)){let e=await (0,s.sj)(t.id);if(!e){console.error("Flow ".concat(t.id," not found"));return}e.guide&&(e.published=e.guide),t=e}let o=t,n=(0,s.d1)(r,{guideId:o.id});n.guideToWebCaptureVersions[o.id]=[],n.guideToScreenshotCaptures[o.id]=[],n.guideToStaticResources[o.id]=[];let l=[],{steps:a,...d}=o.published,u=[],h=[],p=[];if(a)for(let{webCapture:t,screenshotCapture:r,...s}of a){if(t&&u.push(t),r&&h.push(r),(s.appearance===i.XB.Modal||s.appearance===i.XB.Tooltip)&&s.content){let t=(0,c.OA)(s.content);if(t)for(let r in t.entityMap)try{let i=t.entityMap[r];i.data.src&&l.push(syncStaticResource(e,i.data.src,n))}catch(e){}}p.push({...s,webCapture:t?{id:t.id,name:t.name}:void 0})}let{published:f,...w}=o.published.theme||{};f&&l.push(syncThemeVersion(e,f,n));let g={...o,published:{...d,steps:p,theme:o.published.theme?w:void 0},type:o.type};if((null==u?void 0:u.length)&&l.push(syncWebCaptures(e,u,n)),(null==h?void 0:h.length)&&l.push(syncScreenshotCaptures(e,h,n)),g.published.steps.length)for(let t of g.published.steps){let{backBtn:r,nextBtn:i,beacons:s,buttons:o,triggers:a}=t;(null==r?void 0:r.actions)&&l.push(scanActionsForFlowStarts(e,r.actions,n)),(null==i?void 0:i.actions)&&l.push(scanActionsForFlowStarts(e,i.actions,n)),(null==s?void 0:s.length)&&l.push(Promise.all(s.map(async t=>{t.actions&&await scanActionsForFlowStarts(e,t.actions,n)}))),(null==o?void 0:o.length)&&l.push(Promise.all(o.map(async t=>{t.actions&&await scanActionsForFlowStarts(e,t.actions,n)}))),(null==a?void 0:a.length)&&l.push(Promise.all(a.map(async t=>{t.actions&&await scanActionsForFlowStarts(e,t.actions,n)})))}l.push(e.guide.upsert({data:g})),await Promise.all(l)}async function syncChecklist(e,t,r){if(r.allGuides[t.id])return;if(r.allGuides[t.id]=!0,!("published"in t)){let e=await (0,s.sj)(t.id);if(!e){console.error("Checklist ".concat(t.id," not found"));return}let{guide:r,...i}=e;t={...i,published:r}}let i=t,o=(0,s.d1)(r,{guideId:i.id});o.guideToWebCaptureVersions[i.id]=[],o.guideToScreenshotCaptures[i.id]=[];let n=[],{steps:l,...a}=i.published,{published:d,...u}=i.published.theme||{};d&&n.push(syncThemeVersion(e,d,o));let c={...i,published:{...a,theme:i.published.theme?u:void 0},type:i.type};if(c.published.tasks)for(let t of c.published.tasks)t.actions&&n.push(scanActionsForFlowStarts(e,t.actions,o));n.push(e.guide.upsert({data:c})),await Promise.all(n)}let scanActionsForFlowStarts=async(e,t,r)=>await Promise.all(t.map(async t=>{t.startFlowId&&await syncFlow(e,{id:t.startFlowId},r)})),syncThemeVersion=async(e,t,r)=>{if(r.allThemeVersions[t.id]){r.themeVersionToGuides[t.id].includes(r.guideId)||r.themeVersionToGuides[t.id].push(r.guideId);return}if(r.allThemeVersions[t.id]=!0,r.themeVersionToGuides[t.id]=[r.guideId],t.dialogFontUrl){let i=await syncStaticResource(e,t.dialogFontUrl,r,"text/css");i&&(t.dialogFontUrl=i)}return await e.themeVersion.upsert({data:t})};async function syncProject(e,t){let r=await (0,s.$M)(t);if(!r){console.error("Project ".concat(t," not found"));return}if((0,n.MH)(r)){console.error("Project ".concat(t," is passcode protected"));return}let{checklist:i,flow:o,...l}=r,a={...l,flowId:null==o?void 0:o.id,checklistId:null==i?void 0:i.id},d=(0,s.d1)(t),u=[];if(o&&u.push(syncFlow(e,o,d)),i&&u.push(syncChecklist(e,i,d)),u.length&&await Promise.all(u),!a.screenshot){let e="";if(o){var c,h,p;let t=null===(c=o.published.steps)||void 0===c?void 0:c.find(e=>{var t,r,i;return(null===(r=e.webCapture)||void 0===r?void 0:null===(t=r.published)||void 0===t?void 0:t.id)||(null===(i=e.screenshotCapture)||void 0===i?void 0:i.deviceScreenshot)});t&&(e=(null===(h=t.screenshotCapture)||void 0===h?void 0:h.deviceScreenshot)?null===(p=t.screenshotCapture)||void 0===p?void 0:p.deviceScreenshot:"https://c.navattic.com/nv_static/".concat(t.webCapture.published.id))}e&&(a.screenshot=await (0,s.Cz)(e,null))}await updateItemConnections(e,d),await e.project.upsert({data:a})}async function updateItemConnections(e,t){var r,i,s;let{projectId:o,themeVersionToGuides:n,guideToScreenshotCaptures:l,guideToWebCaptureVersions:a,guideToStaticResources:u,webCaptureVersionToStaticResources:h,staticResourceToStaticResources:p}=t,f={};for(let e in n)for(let t of n[e])f[t]=e;let w={};for(let e in l)for(let t of l[e])w[t]=w[t]||[],w[t].push(e);let g={};for(let e in a)for(let t of a[e])g[t]=g[t]||[],g[t].push(e);let b={};for(let e in h)for(let t of h[e])b[t]=b[t]||[],b[t].push(e);let m={};for(let e in p)for(let t of p[e])m[t]=m[t]||[],m[t].push(e);let v={};for(let e in u)for(let t of u[e])v[t]=v[t]||[],v[t].push(e);let y=Object.keys(n),C=Object.keys(a),x=Object.keys(w),j=Object.keys(g),P=Object.keys(b),S=Object.keys(m),k=Object.keys(u),F=Object.keys(v),T=[e.projectToGuides.findFirst({where:o}),Promise.all(y.map(t=>e.themeVersionToGuideVersions.findFirst({where:t}))),Promise.all(x.map(t=>e.screenshotCaptureToGuides.findFirst({where:t}))),Promise.all(C.map(t=>Promise.all([e.guideToProjects.findFirst({where:t}),e.guideToScreenshotCaptures.findFirst({where:t}),e.guideToWebCaptureVersions.findFirst({where:t})]))),Promise.all(j.map(t=>Promise.all([e.webCaptureVersionToStaticResources.findFirst({where:t}),e.webCaptureVersionToGuides.findFirst({where:t})]))),Promise.all(P.map(t=>Promise.all([e.staticResourceToStaticResources.findFirst({where:t}),e.staticResourceToWebCaptureVersions.findFirst({where:t})]))),Promise.all(S.map(t=>e.staticResourceInStaticResources.findFirst({where:t}))),Promise.all(k.map(t=>e.guideToStaticResources.findFirst({where:t}))),Promise.all(F.map()],[I,R,V,G,N,A,W,E,q]=await Promise.all(T),O=new d.ci,Z=(null==I?void 0:I.guideIds)||[],D=(0,c.hp)(Z,C);D.length!==Z.length&&O.enqueue(e.projectToGuides.upsert({data:{projectId:o,guideIds:D}}));for(let t=0;t<y.length;++t){let r=y[t],i=R[t],s=(null==i?void 0:i.guideVersionIds)||[],o=n[r],l=(0,c.hp)(s,o);l.length!==s.length&&O.enqueue(e.themeVersionToGuideVersions.upsert({data:{themeVersionId:r,guideVersionIds:l}}))}for(let t=0;t<x.length;++t){let r=x[t],i=V[t],s=(null==i?void 0:i.guideIds)||[],o=w[r],n=(0,c.hp)(s,o);n.length!==s.length&&O.enqueue(e.screenshotCaptureToGuides.upsert({data:{screenshotCaptureId:r,guideIds:n}}))}for(let t=0;t<C.length;++t){let[r,i,s]=G[t]||[],n=C[t],d=(null==r?void 0:r.projectIds)||[],u=[o],h=(0,c.hp)(d,u);h.length!==d.length&&O.enqueue(e.guideToProjects.upsert({data:{guideId:n,projectIds:h}}));let p=(null==i?void 0:i.screenshotCaptureIds)||[],w=l[n]||[],g=(0,c.hp)(p,w);g.length!==p.length&&O.enqueue(e.guideToScreenshotCaptures.upsert({data:{guideId:n,screenshotCaptureIds:g}}));let b=(null==s?void 0:s.webCaptureVersionIds)||[],m=a[n]||[],v=(0,c.hp)(b,m);v.length!==b.length&&O.enqueue(e.guideToWebCaptureVersions.upsert({data:{guideId:n,webCaptureVersionIds:v}}));let y=f[n];y&&O.enqueue(e.guideToThemeVersion.upsert({data:{guideId:n,themeVersionId:y}}))}for(let t=0;t<j.length;++t){let[r,i]=N[t]||[],s=j[t],o=(null==r?void 0:r.staticResourceIds)||[],n=h[s]||[],l=(0,c.hp)(o,n);l.length!==o.length&&O.enqueue(e.webCaptureVersionToStaticResources.upsert({data:{webCaptureVersionId:s,staticResourceIds:l}}));let a=(null==i?void 0:i.guideIds)||[],d=g[s]||[],u=(0,c.hp)(a,d);u.length!==a.length&&O.enqueue(e.webCaptureVersionToGuides.upsert({data:{webCaptureVersionId:s,guideIds:u}}))}for(let t=0;t<P.length;++t){let[r,i]=A[t]||[],s=P[t],o=(null==r?void 0:r.staticResourceIds)||[],n=p[s]||[],l=(0,c.hp)(o,n);l.length!==o.length&&O.enqueue(e.staticResourceToStaticResources.upsert({data:{staticResourceId:s,staticResourceIds:l}}));let a=(null==i?void 0:i.webCaptureVersionIds)||[],d=b[s]||[],u=(0,c.hp)(a,d);u.length!==a.length&&O.enqueue(e.staticResourceToWebCaptureVersions.upsert({data:{staticResourceId:s,webCaptureVersionIds:u}}))}for(let t=0;t<S.length;++t){let i=(null===(r=W[t])||void 0===r?void 0:r.staticResourceIds)||[],s=m[S[t]]||[],o=(0,c.hp)(i,s);o.length!==i.length&&O.enqueue(e.staticResourceInStaticResources.upsert({data:{staticResourceId:S[t],staticResourceIds:o}}))}for(let t=0;t<k.length;++t){let r=(null===(i=E[t])||void 0===i?void 0:i.staticResourceIds)||[],s=u[k[t]]||[],o=(0,c.hp)(r,s);o.length!==r.length&&O.enqueue(e.guideToStaticResources.upsert({data:{guideId:k[t],staticResourceIds:o}}))}for(let t=0;t<F.length;++t){let r=(null===(s=q[t])||void 0===s?void 0:s.guideIds)||[],i=v[F[t]]||[],o=(0,c.hp)(r,i);o.length!==r.length&&O.enqueue(e.staticResourceToGuides.upsert({data:{staticResourceId:F[t],guideIds:o}}))}await Promise.all(O)}},47147:function(e,t,r){r.d(t,{E3:function(){return cacheProjectGuides},GG:function(){return fetchProject},Gt:function(){return fetchGuide},MH:function(){return isPasscodeProtected},YO:function(){return isPublishedChecklist},aV:function(){return loadFlowCaptures},fi:function(){return formatGuideResponse},pw:function(){return isPublishedFlow},r1:function(){return preloadStartFlowsFromChecklistTasks},vc:function(){return isPasscodeProtectedProject}});var i=r(47330),s=r(22146),o=r(20851),n=r(83408),l=r(23712);let a=new Map,d=new Map,isPublishedFlow=e=>"FLOW"===e.type,isPublishedChecklist=isPasscodeProtected=formatGuideResponse=cacheProjectGuides=isPasscodeProtectedProject=fetchProject=fetchGuide=t u=new Set,loadFlowCaptures=async function loadStartFlowsFromActions(e){for(let t of e){if(t.type!==i.yo.StartFlow||!t.startFlowId)continue;let e=await fetchGuide(t.startFlowId);(null==e?void 0:e.type)===i.De.Flow&&loadFlowCaptures(e.published)}}async function preloadStartFlowsFromChecklistTasks(e){var t;(null==e?void 0:null===(t=e.published)||void 0===t?void 0:t.tasks)&&function(e){if(e)for(let t of e)t.actions&&loadStartFlowsFromActions(t.actions)}(e.published.tasks)}},50733:function(e,t,r){r.d(t,{$M:function(){return i},SW:function(){return o},lk:function(){return s}});let i=Symbol("nv_node_ref"),s={width:1200,height:750},o=800},60028:]);
//# sourceMappingURL=1953-46599660415eeea9.js.map