import{debounced as i,domRemoveChildren as l,isFunction as t,objDataset as o,throttled as h,debug}from"../base/croco.js";import{LOGGERS as g,mediaQuery as p,isRTLEnabled as u}from"../base/config.js";const v=g.DEFAULT;const $=u();const S={pagination:{el:".js-slideshow-thumbs",elPrev:".js-slideshow-thumbs-prev",elNext:".js-slideshow-thumbs-next"},navigation:{elNext:".js-slideshow-control-right",elPrev:".js-slideshow-control-left"},indicatorsSelector:".js-slideshow-indicator",slideSelector:".slide",bulletSelector:".js-slideshow-bullet",activeClass:"is-active",isFullWidth:false,isSlideFullWidth:false,nbSlidesToMove:1};export const DATASET_KEY="snapslider";export class SnapSlider{constructor(i,options){this.options=Object.assign({},S,options);this.isTouch=document.documentElement.classList.contains("touchevents");this.$wrapper=i;this.$slider=this.$wrapper.querySelector(".js-slideshow");this.$pagination=this.$wrapper.querySelector(this.options.pagination.el);this.$paginationPrev=this.$wrapper.querySelector(this.options.pagination.elPrev);this.$paginationNext=this.$wrapper.querySelector(this.options.pagination.elNext);this.$indicators=this.$wrapper.querySelector(this.options.indicatorsSelector);this.$prev=this.$wrapper.querySelector(this.options.navigation.elPrev);this.$next=this.$wrapper.querySelector(this.options.navigation.elNext);this.nbSlidesToMove=this.options.nbSlidesToMove;this.minDelta=100;this.configureSlider();this.onChangeSlideCallback=o(this.$wrapper,"changeSlideCallback");o(this.$wrapper,DATASET_KEY,this);requestAnimationFrame(()=>{this.lastScrollLeft=this.$slider.scrollLeft;this.init()})}init(i){i&&this.configureSlider();if(this.$slides.length){this.$bullets.forEach(;!i&&this.bindEvents();this.onResize()}}configureSlider(){this.$slides=[...this.$slider.querySelectorAll(this.options.slideSelector)];this.$bullets=this.$pagination?[...this.$pagination.querySelectorAll(this.options.bulletSelector)]:[];this.maxIndex=this.$slides.length-1;this.activeSlide=-1;this.isMouseDown=false;this.isDragging=false;this.scrollTimer=null;this.scrollLeft=0;this.startX=0;this.sliderWidth=0;this.slideWidth=0;this.paginationCurrent=0}bindEvents(){if(this.hasControls()){this.$prev.addEventListener("click",h(350,this.onClickPrev.bind(this)));this.$next.addEventListener("click",h(350,this.onClickNext.bind(this)))}this.$pagination&&this.$pagination.addEventListener("click",this.onClickNav.bind(this));if(this.hasPaginationControls()){this.$paginationPrev.addEventListener("click",this.scrollToPagination.bind(this,-1));this.$paginationNext.addEventListener("click",this.scrollToPagination.bind(this,1))}this.$slider.addEventListener("scroll",this.onScroll.bind(this));this.$slider.addEventListener("mousedown",this.onMouseDown.bind(this));document.addEventListener("mousemove",this.onMouseMove.bind(this));document.addEventListener("mouseup",this.onMouseRelease.bind(this));document.addEventListener("mouseleave",this.onMouseRelease.bind(this));window.addEventListener("resize",i(200,this.onResize.bind(this)));this.onPreventClickEvent=this.onPreventClickEvent.bind(this)}scrollToPagination(i){const t=66;const l=(this.$pagination.scrollHeight-this.$pagination.offsetHeight)/t;this.paginationCurrent=Math.max(0,Math.min(l,this.paginationCurrent+i));this.$pagination.scroll({top:this.paginationCurrent*t,behavior:"smooth"});this.$paginationPrev.classList.toggle("is-hidden",this.paginationCurrent===0);this.$paginationNext.classList.toggle("is-hidden",this.paginationCurrent===l)}onClickPrev(){this.slideTo(Math.max(this.activeSlide-this.nbSlidesToMove,0))}onClickNext(){this.slideTo(Math.min(this.activeSlide+this.nbSlidesToMove,this.maxIndex))}onClickNav(e){const i=e.target.closest("button");if(i){const index=parseInt(i.dataset.index,10);this.$slides[index]&&this.slideTo(index)}}onScroll(){if(!this.isDragging){this.lastScrollLeft=this.$slider.scrollLeft}clearTimeout(this.scrollTimer);this.scrollTimer=setTimeout(()=>{if(!this.isDragging){this.slideTo(this.getActiveFromScrollPos(this.lastScrollLeft),this.isTouch)}},this.isTouch?30:100)}onMouseDown(e){e.preventDefault();e.stopPropagation();this.isMouseDown=true;this.startX=e.pageX-this.$slider.offsetLeft;this.scrollLeft=this.$slider.scrollLeft}onMouseMove(e){if(!this.isMouseDown){return}this.isDragging=true;e.preventDefault();const x=e.pageX-this.$slider.offsetLeft;const i=(x-this.startX)*1;this.$slider.scrollLeft=this.scrollLeft-i}onMouseRelease(e){this.isMouseDown=false;if(this.isDragging){const i=this.$slider.scrollLeft;const delta=(i-this.lastScrollLeft)*$?-1:1;const t=delta===0?0:-1;const direction=delta>0?1:t;if(Math.abs(delta)>this.minDelta&&Math.abs(delta)<=this.slideWidth){direction&&this.slideTo(this.activeSlide+direction)}else{this.slideTo(this.getActiveFromScrollPos(i))}window.addEventListener("click",this.onPreventClickEvent,true);this.isDragging=false}}onResize(){if(this.options.isSlideFullWidth){this.$slides.forEach(i=>{i.style.flex=this.$slider.clientWidth+"px 0 0"});this.$slider.scrollLeft=this.lastScrollLeft}this.getBoundingWidth();if(this.options.isFullWidth){this.maxIndex=this.$slides.length-Math.round(this.sliderWidth/this.slideWidth)}this.setLastSlideMargin();this.slideTo(this.getActiveFromScrollPos(this.$slider.scrollLeft))}onPreventClickEvent(e){e.preventDefault();e.stopPropagation();window.removeEventListener("click",this.onPreventClickEvent,true)}onChangeActiveSlide(current){this.updateActiveBullets();this.updateActiveControls();this.updateIndicators();if(t(this.onChangeSlideCallback)){this.onChangeSlideCallback(this.$slides,current)}}updateActiveBullets(){this.$bullets.length>0&&this.$bullets.forEach((i,index)=>{this.toggleActive(i,index===this.activeSlide)})}updateActiveControls(){if(this.hasControls()){this.toggleActive(this.$prev,this.activeSlide===0,false);this.toggleActive(this.$next,this.activeSlide===this.maxIndex,false)}}updateIndicators(){if(this.$indicators){this.$indicators.textContent=`${this.activeSlide+1} / ${this.maxIndex+1}`}}toggleActive(i,t,l=true){l&&i.classList.toggle(this.options.activeClass,t);if(t){i.setAttribute("disabled","disabled")}else{i.removeAttribute("disabled")}}getActiveFromScrollPos(i=0){const t=this.$slider.getBoundingClientRect()[$?"right":"left"];const l=i>this.lastScrollLeft?1/3:2/3;let o=0;for(let h=0,g=this.maxIndex;h<=g;h++){const index=$?this.maxIndex-h:h;const p=this.$slides[index].getBoundingClientRect()[$?"right":"left"];if(p-t+this.slideWidth*l>=0){o=index;break}}return o}getBoundingWidth(){this.sliderWidth=this.$slider.getBoundingClientRect().width;this.slideWidth=this.$slides[0]&&this.$slides[0].getBoundingClientRect().width}setLastSlideMargin(){const i=this.slideWidth*this.$slides.length>this.sliderWidth;const margin=Math.ceil(this.sliderWidth-this.slideWidth)-parseInt(getComputedStyle(this.$slider)[$?"paddingRight":"paddingLeft"],10);const t=this.$slides[this.$slides.length-1].children[0];requestAnimationFrame(()=>{if(t&&!this.options.isFullWidth){t.style[$?"marginLeft":"marginRight"]=`${i?margin:0}px`}this.toggleControlsAndIndicators(!i);if(this.isTouch){if($){l(this.$slider);[...this.$slides].reverse().forEach(;this.$slider.scrollLeft=this.$slider.scrollWidth}else{this.$slider.scrollLeft=this.lastScrollLeft}}})}toggleControlsAndIndicators(force){this.$indicators&&this.$indicators.classList.toggle("is-hidden",force);if(this.hasControls()){this.$prev.classList.toggle("is-hidden",force);this.$next.classList.toggle("is-hidden",force)}}slideTo(index,i=false){if(index<0||index>this.maxIndex){return}const offsetLeft=this.$slides[index].offsetLeft;if(this.activeSlide!==index){this.activeSlide=index;requestAnimationFrame(}!i&&this.$slider.scroll({left:offsetLeft-($?this.sliderWidth-this.slideWidth:0),behavior:"smooth"})}asPaginationControls(){return p.desktopOnly.matches&&this.$paginationPrev&&this.$paginationNext}}export function snapSliderInit(i=document){const t=i.querySelectorAll(".js-snap-slider-wrapper");if(t.length){[...t].forEach(i=>{let t=o(i,DATASET_KEY);if(!t){new SnapSlider(i)}})}else{debug("warn",v,"[snap-slider]","missing element")}}