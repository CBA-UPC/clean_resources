(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3822],{31612:18406:31024:function(e,t,n){"use strict";n.d(t,{Z:function(){return ActionsDropdown}});var r=n(52322),a=n(39708),i=n(99219),s=n(83122);,81291:78066:function(e,t,n){"use strict";n.d(t,{Z:function(){return Modal}});var r=n(52322),a=n(2784),i=n(68810),s=n(64529),o=n(83122),l=n(82002),c=n(89370);}},2594},5453},5526},75433:function(e,t,n){"use strict";n.d(t,{D:function(){return s}});var r=n(73235),a=n(66547),i=n(46678);function _templateObject(){let e=(0,r._)(["\n    fragment BoardProject on BoardProject {\n  createdAt\n  creatorId\n  project {\n    ...ProjectListItem\n  }\n  pinned\n}\n    ",""]);return _templateObject=function(){return e},e}let s=(0,a.ZP)(_templateObject(),i.c)},36763:function(e,t,n){"use strict";n.d(t,{d:function(){return useListBoardProjectsQuery}});var r=n(73235),a=n(66547),i=n(75433),s=n(26806);function _templateObject(){let e=(0,r._)(["\n    query ListBoardProjects($data: BoardProjectListFilterArgs!) {\n  boardProjects(data: $data) {\n    count\n    results {\n      ...BoardProject\n    }\n  }\n}\n    ",""]);return _templateObject=function(){return e},e}let o=(0,a.ZP)(_templateObject(),i.D);function useListBoardProjectsQuery(e){return s.aM({query:o,...e})}},7199:function(e,t,n){"use strict";n.d(t,{H:function(){return useListBoardsQuery}});var r=n(73235),a=n(66547),i=n(55261),s=n(26806);function _templateObject(){let e=(0,r._)(["\n    query ListBoards($workspaceId: String!, $filterForCurrentUser: Boolean) {\n  boards(workspaceId: $workspaceId, filterForCurrentUser: $filterForCurrentUser) {\n    ...Board\n  }\n}\n    ",""]);return _templateObject=function(){return e},e}let o=(0,a.ZP)(_templateObject(),i.V}},79022:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eM}});var r,a,i,s,o=n(52322),l=n(2784),c=n(94225);function DateTimeInput(e){let{value:t,onChange:},debounce:r=0}=e,a=(0,c.y1)(n,r),[i,s]=(0,l.useState)(t);return(0,l.useEffect},[t]),(0,o.jsx)("input",{className:"focus:border-blue-primary block rounded-md border border-gray-200 px-3 py-1 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-200 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500 disabled:ring-gray-200",type:"datetime-local",value:i,onChang}})}var d=n(36763),u=n(7199),m=n(73235),p=n(66547);function _templateObject(){let e=(0,m._)(["\n    fragment EngagementMetricSource on EngagementMetricSource {\n  id\n  sourceType\n  eventType\n  urlPattern\n}\n    "]);return _templateObject=function(){return e},e}let x=(0,p.ZP)(_templateObject());function engagementMetricExtended_templateObject(){let e=(0,m._)(["\n    fragment EngagementMetricExtended on EngagementMetricExtended {\n  id\n  createdAt\n  updatedAt\n  name\n  description\n  numerator {\n    ...EngagementMetricSource\n  }\n  denominator {\n    ...EngagementMetricSource\n  }\n  displayFormat\n  workspaceId\n}\n    ",""]);return engagementMetricExtended_templateObject=function(){return e},e}let g=(0,p.ZP)(engagementMetricExtended_templateObject(),x);var h=n(26806);function listEngagementMetrics_templateObject(){let e=(0,m._)(["\n    query ListEngagementMetrics($workspaceId: String!) {\n  engagementMetrics(workspaceId: $workspaceId) {\n    id\n    results {\n      ...EngagementMetricExtended\n    }\n    count\n  }\n}\n    ",""]);return listEngagementMetrics_templateObject=function(){return e},e}let v=(0,p.ZP)(listEngagementMetrics_templateObject(),g);var f=n(84038),y=n(47330),j=n(83122),b=n(53954),M=n(47643),C=n(87433),w=n(5632),T=n(99219),N=n(3016),_=n(25948),S=n(18318),D=n(77512),k=n(81179);function FilterButton(e){let{className:t,...n}=e;return(0,o.jsx)(D.zx,{variant:"secondary",className:(0,j.AK)("h-full",t),iconLeft:(0,o.jsx)(k.Z,{className:"h-4 w-4"}),...n,children:"Filter"})}var A=n(88724);function FilterMenu(e){let{onClose:t,children:n,className:r,...a}=e;return(0,o.jsxs)("div",{className:(0,j.AK)("flex w-full items-center justify-between bg-gray-100 p-2",r),...a,children:[(0,o.jsx)("div",{className:"flex gap-2",children:n}),t&&(0,o.jsx)(A.Z,{onClick:t,className:"h-4 w-4 cursor-pointer"})]})}var E=n(32517),F=n(78066);function createEngagementMetric_templateObject(){let e=(0,m._)(["\n    mutation CreateEngagementMetric($input: EngagementMetricCreateInput!) {\n  createEngagementMetric(input: $input) {\n    id\n    name\n    description\n    createdAt\n    updatedAt\n    displayFormat\n  }\n}\n    "]);return createEngagementMetric_templateObject=function(){return e},e}let P=(0,p.ZP)(createEngagementMetric_templateObject());function engagementMetric_templateObject(){let e=(0,m._)(["\n    fragment EngagementMetric on EngagementMetric {\n  id\n  createdAt\n  updatedAt\n  name\n  description\n  displayFormat\n  workspaceId\n}\n    "]);return engagementMetric_templateObject=function(){return e},e}let I=(0,p.ZP)(engagementMetric_templateObject());function updateEngagementMetric_templateObject(){let e=(0,m._)(["\n    mutation UpdateEngagementMetric($input: EngagementMetricUpdateInput!) {\n  updateEngagementMetric(input: $input) {\n    ...EngagementMetric\n  }\n}\n    ",""]);return updateEngagementMetric_templateObject=function(){return e},e}let O=(0,p.ZP)(updateEngagementMetric_templateObject(),I);var L=n(86414),Z=n(1422);let q={[y.$K.Number]:"Number",[y.$K.Percentage]:"Percentage",[y.$K.TimeDuration]:"Time Duration"},displayFormatToOptio),K={number:displayFormatToOption(y.$K.Number),percentage:displayFormatToOption(y.$K.Percentage),timeDuration:displayFormatToOption(y.$K.TimeDuration)},U=[{name:"Steps viewed",value:"stepsViewed",sourceInit:{sourceType:y.CK.Events,eventType:y.tw.ViewStep},unitSingular:"step view"},{name:"Navigations",value:"navigations",sourceInit:{sourceType:y.CK.Events,eventType:y.tw.Navigate,urlPattern:""},unitSingular:"navigation"},{name:"Conversion events",value:"conversions",sourceInit:{sourceType:y.CK.Events,eventType:y.tw.Converted},unitSingular:"conversion"},{name:"Flow start",value:"flowStarts",sourceInit:{sourceType:y.CK.Events,eventType:y.tw.StartFlow},unitSingular:"flow start"},{name:"Flow completions",value:"flowCompletions",sourceInit:{sourceType:y.CK.Events,eventType:y.tw.CompleteFlow},unitSingular:"flow completion"},{name:"Visitor identifications",value:"visitorIdentificactions",sourceInit:{sourceType:y.CK.Events,eventType:y.tw.IdentifyUser},unitSingular:"identification"},{name:"Unique sessions",value:"uniqueSessions",sourceInit:{sourceType:y.CK.Sessions},unitSingular:"session"},{name:"Unique visitors",value:"uniqueVisitors",sourceInit:{sourceType:y.CK.Visitors},unitSingular:"visitor"},{name:"Unique engaged visitors",value:"uniqueEngagedVisitors",sourceInit:{sourceType:y.CK.Visitors,eventType:y.tw.Engage},unitSingular:"engaged visitor"},{name:"Time spent",value:"activeTime",sourceInit:{sourceType:y.CK.ActiveTime},unitSingular:"millisecond"}],findMatchingSourceOption=e=>{let t=U.find(t=>t.sourceInit.sourceType===e.sourceType&&(t.sourceInit.sourceType!==y.CK.Events||t.sourceInit.eventType===e.eventType&&(t.sourceInit.eventType!==y.tw.Navigate||t.sourceInit.urlPattern===e.urlPattern)));return t};var Analytics_MetricFormModal=e=>{var t,n,r,a;let{metricInit:i,handleClose:s,open:c}=e,d=!!i,[u,m]=(0,l.useState)(null!==(t=null==i?void 0:i.name)&&void 0!==t?t:""),[p,x]=(0,l.useState)(null!==(n=null==i?void 0:i.name)&&void 0!==n&&n),[g,v]=(0,l.useState)(null!==(r=null==i?void 0:i.description)&&void 0!==r?r:""),[f,j]=(0,l.useState)(()=>i&&findMatchingSourceOption(i.numerator)||U[0]),[M,C]=(0,l.useState)(()=>i&&i.denominator?findMatchingSourceOption(i.denominator)||U[0]:null),w=(0,l.useMemoM,[M]),[,_]=h.Db(P),[,S]=h.Db(O),[k,A]=(0,l.useState)(!1),{workspace:I}=(0,b.cF)(),q=(0,l.useMemo)(()=>{let e=f.sourceInit.sourceType===y.CK.ActiveTime?[K.timeDuration]:[K.number];return w&&e.push(K.percentage),e},[f,w]),[$,H]=(0,l.useState)(null!==(a=null==i?void 0:i.displayFormat)&&void 0!==a?a:q[0].value);(0,l.useEffect)(()=>{q.find(e=>e.value===$)||H(q[0].value)},[$,q]),(0,l.useEffect)(()=>{p||(w?m("".concat(f.name," per ").concat(null==M?void 0:M.unitSingular)):m(f.name))},[w,M,f,p]);let handleCreate=async()=>{let e=await _({input:{name:u,description:g,workspaceId:null==I?void 0:I.id,numerator:f.sourceInit,denominator:null==M?void 0:M.sourceInit,displayFormat:$}});e.error?(0,E.Rn)((0,Z.q)(e.error.message)):((0,E.Vp)("Metric created successfully"),L.Z.track("engagement_metric_created"),s())},handleUpdate=async()=>{let e=await S({input:{id:null==i?void 0:i.id,name:u,description:g,numerator:f.sourceInit,denominator:null==M?void 0:M.sourceInit,displayFormat:$}});e.error?(0,E.Rn)((0,Z.q)(e.error.message)):((0,E.Vp)("Metric updated successfully"),L.Z.track("engagement_metric_updated"),s())},onSubmit=async()=>{A(!0),d?await handleUpdate():await handleCreate(),A(!1)};return(0,o.jsx)(F.Z,{open:c,title:d?"Edit metric":"Create new metric",handleClose:s,handleNext:onSubmit,nextText:k?(0,o.jsx)(T.L4p,{}):"Save",nextOnEnter:!0,nextDisabled:!u,children:(0,o.jsxs)("div",{className:"overflow-scroll pl-2 pr-3",children:[(0,o.jsx)(N.Z,{label:w?"Source (numerator)":"Source",items:U,onChange:e=>j(e),selected:f.value,mb:1}),(0,o.jsxs)("button",{className:"mb-4 cursor-pointer text-sm text-blue-500",onClick:()=>{w?C(null):C(U[0])},children:[w?"Remove":"Add"," denominator"]}),w&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(N.Z,{label:"Source (denominator)",items:U,onChang),selected:null==M?void 0:M.value})}),(0,o.jsx)(N.Z,{label:"Display format",items:q,onChang),field:"name",selected:$}),(0,o.jsx)(D.oi,{labelText:"Name",placeholder:"Enter name",className:"mb-4",onChang},value:u}),(0,o.jsx)(D.gx,{labelText:"Description",placeholder:"Enter description (optional)",onChange:v,className:"input-base mb-4 w-full placeholder-gray-400",value:g})]})})},Analytics_CreateNewMetricModal=e=>{let{handleClose:t,open:n}=e;return(0,o.jsx)(Analytics_MetricFormModal,{open:n,metricInit:void 0,handleClose:t})},Analytics_EditMetricModal=e=>{let{handleClose:t,metric:n,open:r}=e;return(0,o.jsx)(Analytics_MetricFormModal,{open:r,metricInit:n,handleClose:t})},$=n(31024),H=n(56268}let B=(0,p.ZP)(deleteEngagementMetric_templateObject(),I);function getEngagementMetricData_templateObject(){let e=(0,m._)(["\n    query GetEngagementMetricData($input: EngagementMetricDataQueryArgs!) {\n  engagementMetricData(input: $input) {\n    id\n    previousPeriod\n    currentPeriod\n    changeFromPreviousPeriod\n    timeResolution\n    timeSeries {\n      dt\n      value\n    }\n  }\n}\n    "]);return getEngagementMetricData_templateObject=function(){return e},e}let R=(0,p.ZP)(getEngagementMetricData_templateObject());var z=n(78991),V=n(61660),X=n(50603),Y=n(25556),G=n(3131),W=n(47857),Q=n(81073);let LoadingMetricChart=()=>(0,o.jsx)(o.Fragment,{children:[...Array(7).keys()].map(e=>(0,o.jsx)("div",{className:"h-4 w-full rounded bg-gray-100"},"loading-".concat(e)))}),LoadingMetricHeader=()=>(0,o.jsx)("div",{className:"h-4 w-1/2 rounded bg-gray-100"}),LoadingAnalyticsMetric=()=>(0,o.jsxs)("div",{className:"flex animate-pulse flex-col py-4",children:[(0,o.jsx)("div",{className:"mb-3 space-y-2",children:[...[,,].keys()].map(e=>(0,o.jsx)(LoadingMetricHeader,{},"loading-short-".concat(e)))}),(0,o.jsx)("div",{className:"space-y-2",children:(0,o.jsx)(LoadingMetricChart,{})})]}),LoadingMetricsGrid=()=>(0,o.jsx)(GridContainer,{children:[...Array(6).keys()].map(e=>(0,o.jsx)(LoadingAnalyticsMetric,{},"loading-card-".concat(e)))}),WorkspaceMetricsEmpt},MetricCardError=e=>{let{title:t,error:n}=e;return(0,o.jsxs)("div",{className:"mt-3 flex h-full flex-1 flex-col items-center justify-center space-y-2 rounded bg-gray-50/50",children:[(0,o.jsx)("div",{className:"text-sm font-medium text-gray-600",children:t}),!1]})},MetricsPageBodyConditional=e=>{let{fetching:t,error:n,children:r,empty:a,waitingForUserInput:i}=e;return t?(0,o.jsx)(LoadingMetricsGrid,{}):n?(0,o.jsx)(MetricCardError,{title:"Error loading analytics",error:n}):a?(0,o.jsx)(WorkspaceMetricsEmpty,{title:"No metrics yet."}):i?(0,o.jsx)(WorkspaceMetricsEmpty,{title:"Select demos to compare."}):(0,o.jsx)(o.Fragment,{children:r})},computeChange=e=>{let{previous:t,current:n}=e,r=void 0===t?0:n-t,a=Math.abs(r),i=roundToDecimalPlaces(a,1),s=void 0===t?0:r/t,o=s<1/0?100*s:0,l=o?o>0?"up":"down":"same",c=changeStateToSign(l),d=Math.abs(o||0),u=roundToDecimalPlaces(d,1);return{sign:c,percentChange:o,percentChangeAbsValueRounded:u,percentChangeAbsValue:d,change:r,changeState:l,changeAbsValue:a,changeAbsValueRounded:i}},MetricCardLoading=()=>(0,o.jsx)("div",{className:"animate-skeletonEnter",children:(0,o.jsxs)("div",{className:"mt-3 animate-pulse space-y-2",children:[(0,o.jsx)("div",{className:"mb-4",children:(0,o.jsx)(LoadingMetricHeader,{})}),(0,o.jsx)(LoadingMetricChart,{})]})});(r=i||(i={})).Up="up",r.Down="down",r.Same="same";let changeStateToSig},roundToDecimalPlaces=(e,t)=>Math.round(e*10**t)/10**t,formatNumberToDisplay=e=>{let{value:t,displayFormat:n}=e;switch(n){case y.$K.Number:return"".concat(roundToDecimalPlaces(t,2).toLocaleString());case y.$K.Percentage:return"".concat(roundToDecimalPlaces(100*t,2).toLocaleString(),"%");case y.$K.TimeDuration:return new z.Z({milliseconds:t}).toHumanReadable()}},formatNumberAsStat=e=>{let{value:t,displayFormat:n}=e;switch(n){case y.$K.Number:case y.$K.Percentage:return formatNumberToDisplay({value:t,displayFormat:n});case y.$K.TimeDuration:return new z.Z({milliseconds:t}).toHumanReadable({showMilliseconds:!1})}},formatDateTick=(e,t)=>{let{showTime:n}=t;return(0,C.Z)(e,"MMM dd ".concat(n?"HH:mm":""))},RechartTooltip=e=>{let{active:t,payload:n,title:r,formatYAxis:a,formatXAxis:i}=e;if(!t||!n||1!==n.length)return null;let s=n[0].payload;return(0,o.jsxs)("div",{className:"min-w-[110px] rounded border bg-white text-sm",children:[(0,o.jsx)("h4",{className:"border-b px-2 py-1 font-medium",children:r}),(0,o.jsxs)("div",{className:"flex justify-between space-x-1 p-2 font-medium text-gray-500",children:[(0,o.jsxs)("span",{children:[i(s.dt)," "]}),(0,o.jsxs)("span",{children:[a(s.value)," "]})]})]})},hydrateTimeSeriesData=e=>e.map((t,n)=>{let r=computeChange({current:t.value,previous:n>0?e[n-1].value:void 0});return{...t,...r,dt:new Date(t.dt)}}),StartEndXAxisTick=e=>{let{x:t,y:n,payload:r,tickFormatter:a,ticks:i}=e,s=r.value===i[0];return(0,o.jsx)("g",{transform:"translate(".concat(t,",").concat(n,")"),children:(0,o.jsx)("text",{x:0,y:0,dy:12,textAnchor:s?"start":"end",fill:"#6b7280",fontSize:13,children:a(r.value)})})},EndYAxisTick=e=>{let{x:t,y:n,payload:r,tickFormatter:a}=e;return(0,o.jsx)("g",{transform:"translate(".concat(t,",").concat(n,")"),children:(0,o.jsx)("text",{x:0,y:0,dy:-5,textAnchor:"start",fill:"#6b7280",fontSize:10,children:a(r.value)})})},MetricTimeSeriesChart=e=>{let{id:t,chartName:n,displayFormat:r,timeSeries:a,timeResolution:i}=e,s=hydrateTimeSeriesData(a),l=i===y.M7.Hour,c="gradient-".concat(t),d=[s[0].dt,s[s.length-1].dt],u=[Math.max(...s.mae))||1];function formatXAxis(e){let t=new Date(e);return formatDateTick(t,{showTime:l})}function formatYAxis(e){return formatNumberToDisplay({value:e,displayFormat:r})}return(0,o.jsx)(V.h,{width:"100%",height:"100%",children:(0,o.jsxs)(X.T,{data:s,margin:{top:15,right:10,left:0,bottom:15},children:[(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",{id:c,x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,o.jsx)("stop",{offset:"5%",stopColor:"#d5e5f0"}),(0,o.jsx)("stop",{offset:"95%",stopColor:"#FFFFFF"})]})}),(0,o.jsx)(Y.K,{dataKey:"dt",fontSize:12,height:8,offset:50,interval:0,axisLine:{stroke:"#d1d5db"},textAnchor:"end",tickLine:{stroke:"#e5e7eb"},ticks:d,tickFormatter:formatXAxis,tick:e=>(0,o.jsx)(StartEndXAxisTick,{ticks:d,...e})}),(0,o.jsx)(G.B,{width:10,axisLine:!1,tickLine:{stroke:"transparent"},allowDecimals:!1,textAnchor:"start",fontSize:10,style:{fontSize:10},domain:["dataMin","dataMax"],ticks:u,tickFormatter:formatYAxis,tick:e=>(0,o.jsx)(EndYAxisTick,{ticks:d,...e})}),(0,o.jsx)(W.u,{cursor:{fill:"transparent",stroke:"#d1d5db",strokeDasharray:3},wrapperStyle:{outline:"none"},content:(0,o.jsx)(RechartTooltip,{title:n,showTime:l,displayFormat:r,formatXAxis:formatXAxis,formatYAxis:formatYAxis})}),(0,o.jsx)(Q.u,{type:"linear",dataKey:"value",animationDuration:1e3,strokeWidth:2,fillOpacity:1,stroke:"#316CBF",fill:"url(#".concat(c,")")})]})})},ChangeStat=e=>{let{previous:t,current:n}=e,{sign:r,changeState:a,percentChangeAbsValueRounded:i}=computeChange({previous:t,current:n});return(0,o.jsxs)("span",{className:(0,j.AK)("flex flex-row space-x-2 rounded border px-1 text-[12px] font-semibold leading-[18px]","up"===a?"border-[#13862e]/30 bg-[#effff3] text-[#13862e]":"down"===a?"border-amber-300 bg-amber-100/70 text-amber-700":"border-gray-700/20 bg-gray-100 text-gray-700"),children:[r,roundToDecimalPlaces(i,1),"%"]})};var Analytics_MetricCard=e=>{var t,n,r,a,i,s,l;let{metric:c,timeSpan:d,openEditModal:u,guideId:m,projectIds:p,canEdit:x,storageTypeOverride:g,startTime:v,endTime:f}=e,j=(null==p?void 0:p.length)===0,[{data:b,fetching:M,error:C}]=(l={variables:{input:{id:c.id,timeSpan:d,guideId:m,projectIds:p,storageTypeOverride:g,startTime:d===y.U.TCustom?v:void 0,endTime:d===y.U.TCustom?f:void 0}},pause:j},h.aM({query:R,...l})),[,w]=h.Db(B),handleDelete=async()=>{if(!confirm("Are you sure you want to delete this metric?"))return;let e=await w({id:c.id});e.error?(0,E.Rn)((0,Z.q)(e.error.message)):L.Z.track("engagement_metric_deleted")},T=(null==b?void 0:null===(t=b.engagementMetricData)||void 0===t?void 0:t.timeSeries)||[];return(0,o.jsxs)("div",{className:"simpleEnter flex h-56  w-full flex-col rounded-lg",children:[(0,o.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,o.jsxs)("div",{className:"flex flex-row items-center space-x-3",children:[(0,o.jsx)("div",{className:"text-base font-semibold text-gray-700",children:c.name}),c.description&&(0,o.jsx)(H.Z,{children:c.description}),(0,o.jsx)(ChangeStat,{previous:(null==b?void 0:null===(n=b.engagementMetricData)||void 0===n?void 0:n.previousPeriod)||0,current:(null==b?void 0:null===(r=b.engagementMetricData)||void 0===r?void 0:r.currentPeriod)||0})]}),x&&en&&(0,o.jsx)($.Z,{tabs:[{id:"edit_metric",name:"Edit",onClick:u},{id:"delete_metric",name:"Delete",onClick:handleDelete}]})]}),(0,o.jsx)(o.Fragment,{children:M?(0,o.jsx)(MetricCardLoading,{}):j?(0,o.jsx)(WorkspaceMetricsEmpty,{title:"No metrics yet."}):C?(0,o.jsx)(MetricCardError,{title:"Error loading metric",error:C}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"my-1 mb-2 flex max-w-2xl items-center justify-between",children:(0,o.jsx)("div",{className:"w-full",children:(0,o.jsxs)("div",{className:"h-[10px]  w-full leading-[10px]",children:[(0,o.jsx)("span",{className:"align-baseline text-lg font-medium ",children:formatNumberAsStat({value:(null==b?void 0:null===(a=b.engagementMetricData)||void 0===a?void 0:a.currentPeriod)||0,displayFormat:c.displayFormat})}),(0,o.jsxs)("span",{className:"ml-1 align-baseline text-sm text-gray-500",children:[" ",formatNumberAsStat({value:(null==b?void 0:null===(i=b.engagementMetricData)||void 0===i?void 0:i.previousPeriod)||0,displayFormat:c.displayFormat})," ","last period"]})]})})}),(0,o.jsx)("div",{className:"mt-5 h-3/4",children:(0,o.jsx)(MetricTimeSeriesChart,{id:c.id,chartName:c.name,displayFormat:c.displayFormat,timeResolution:(null==b?void 0:null===(s=b.engagementMetricData)||void 0===s?void 0:s.timeResolution)||y.M7.Day,timeSeries:T})})]})})]})}let J=(0,p.ZP)(getEngagementMetricComparisonData_templateObject());var ee=n(32908),et=n(63004);let MetricCardCompare_MetricCardLoading=()=>(0,o.jsx)("div",{className:"animate-skeletonEnter",children:(0,o.jsxs)("div",{className:"mt-3 animate-pulse space-y-2",children:[(0,o.jsx)("div",{className:"mb-4",children:(0,o.jsx)(LoadingMetricHeader,{})}),(0,o.jsx)(LoadingMetricChart,{})]})});(a=s||(s={})).Up="up",a.Down="down",a.Same="same";let MetricCardCompare_roundToDecimalPlaces=(e,t)=>Math.round(e*10**t)/10**t,MetricCardCompare_formatNumberToDisplay=e=>{let{value:t,displayFormat:n}=e;switch(n){case y.$K.Number:return"".concat(MetricCardCompare_roundToDecimalPlaces(t,2).toLocaleString());case y.$K.Percentage:return"".concat(MetricCardCompare_roundToDecimalPlaces(100*t,2).toLocaleString(),"%");case y.$K.TimeDuration:return new z.Z({milliseconds:t}).toHumanReadable()}},MetricCardCompare_formatNumberAsStat=e=>{let{value:t,displayFormat:n}=e;switch(n){case y.$K.Number:case y.$K.Percentage:return MetricCardCompare_formatNumberToDisplay({value:t,displayFormat:n});case y.$K.TimeDuration:return new z.Z({milliseconds:t}).toHumanReadable({showMilliseconds:!1})}},MetricCardCompare_formatDateTick=(e,t)=>{let{showTime:n}=t;return(0,C.Z)(e,"MMM dd ".concat(n?"HH:mm":""))},MetricCardCompare_RechartTooltip=e=>{let{active:t,payload:n,formatYAxis:r,formatXAxis:a,line1:i,line2:s}=e;if(!t||!n||0===n.length)return null;let l=n[0].payload;return(0,o.jsxs)("div",{className:"min-w-[110px] rounded border bg-white text-sm",children:[(0,o.jsx)("h4",{className:"border-b px-2 py-1 font-medium",children:a(l.dt)}),(0,o.jsxs)("div",{className:"flex justify-between space-x-1 p-2 font-medium text-gray-500",children:[(0,o.jsx)("span",{className:"truncate",children:i.label}),(0,o.jsxs)("span",{children:[r(l.value1)," "]})]}),(0,o.jsxs)("div",{className:"flex justify-between space-x-1 p-2 font-medium text-gray-500",children:[(0,o.jsx)("span",{className:"truncate",children:s.label}),(0,o.jsxs)("span",{children:[r(l.value2)," "]})]})]})},MetricCardCompare_StartEndXAxisTick=e=>{let{x:t,y:n,payload:r,tickFormatter:a,ticks:i}=e,s=r.value===i[0];return(0,o.jsx)("g",{transform:"translate(".concat(t,",").concat(n,")"),children:(0,o.jsx)("text",{x:0,y:0,dy:12,textAnchor:s?"start":"end",fill:"#6b7280",fontSize:13,children:a(r.value)})})},MetricCardCompare_EndYAxisTick=e=>{let{x:t,y:n,payload:r,tickFormatter:a}=e;return(0,o.jsx)("g",{transform:"translate(".concat(t,",").concat(n,")"),children:(0,o.jsx)("text",{x:0,y:0,dy:-5,textAnchor:"start",fill:"#6b7280",fontSize:10,children:a(r.value)})})},MetricCardCompare_MetricTimeSeriesChart=e=>{let{id:t,chartName:n,displayFormat:r,timeSeries:a,timeResolution:i,line1:s,line2:l}=e,c=i===y.M7.Hour,d="gradient-".concat(t),u=[a[0].dt,a[a.length-1].dt],m=a.reduce((e,t)=>Math.max(e,t.value1,t.value2),0);function formatXAxis(e){let t=new Date(e);return MetricCardCompare_formatDateTick(t,{showTime:c}}return(0,o.jsx)(V.h,{width:"100%",height:"100%",children:(0,o.jsxs)(ee.w,{data:a,margin:{top:15,right:10,left:0,bottom:15},children:[(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",{id:d,x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,o.jsx)("stop",{offset:"5%",stopColor:"#d5e5f0"}),(0,o.jsx)("stop",{offset:"95%",stopColor:"#FFFFFF"})]})}),(0,o.jsx)(Y.K,{dataKey:"dt",fontSize:12,height:8,offset:50,interval:0,axisLine:{stroke:"#d1d5db"},textAnchor:"end",tickLine:{stroke:"#e5e7eb"},ticks:u,tickFormatter:formatXAxis,tick:e=>(0,o.jsx)(MetricCardCompare_StartEndXAxisTick,{ticks:u,...e})}),(0,o.jsx)(G.B,{width:10,axisLine:!1,tickLine:{stroke:"transparent"},allowDecimals:!1,textAnchor:"start",fontSize:10,style:{fontSize:10},domain:["dataMin","dataMax"],ticks:[m||1],tickFormatter:formatYAxis,tic)}),(0,o.jsx)(W.u,{cursor:{fill:"transparent",stroke:"#d1d5db",strokeDasharray:3},wrapperStyle:{outline:"none"},content:(0,o.jsx)(MetricCardCompare_RechartTooltip,{title:n,showTime:c,displayFormat:r,formatXAxis:formatXAxis,formatYAxis:formatYAxis,line1:s,line2:l})}),(0,o.jsx)(et.x,{type:"linear",dataKey:"value1",animationDuration:1e3,strokeWidth:2,fillOpacity:1,stroke:s.color,fill:"url(#".concat(d,")"),dot:!1}),(0,o.jsx)(et.x,{type:"linear",dataKey:"value2",animationDuration:1e3,strokeWidth:2,fillOpacity:1,stroke:l.color,fill:"url(#".concat(d,")"),dot:!1})]})})};var MetricCardCompare=e=>{var t,n,r,a,i;let{metric:s,timeSpan:l,project1:c,project2:d,storageTypeOverride:u,startTime:m,endTime:p}=e,[{data:x,fetching:g,error:v}]=(i={variables:{input:{id:s.id,timeSpan:l,projectId1:(null==c?void 0:c.id)||"",projectId2:(null==d?void 0:d.id)||"",storageTypeOverride:u,startTime:l===y.U.TCustom?m:void 0,endTime:l===y.U.TCustom?p:void 0}},pause:!c||!d},h.aM({query:J,...i})),f=(null==x?void 0:null===(t=x.engagementMetricComparisonData)||void 0===t?void 0:t.timeSeries)||[],j=null==x?void 0:null===(n=x.engagementMetricComparisonData)||void 0===n?void 0:n.value1Total,b=null==x?void 0:null===(r=x.engagementMetricComparisonData)||void 0===r?void 0:r.value2Total;return(0,o.jsxs)("div",{className:"simpleEnter flex h-56  w-full flex-col rounded-lg",children:[(0,o.jsx)("div",{className:"flex flex-row justify-between",children:(0,o.jsxs)("div",{className:"flex flex-row items-center space-x-3",children:[(0,o.jsx)("div",{className:"text-base font-semibold text-gray-700",children:s.name}),s.description&&(0,o.jsx)(H.Z,{children:s.description}),(0,o.jsx)(ChangeStat,{previous:b||0,current:j||0})]})}),(0,o.jsx)(o.Fragment,{children:!g&&c&&d?v?(0,o.jsx)(MetricCardError,{title:"Error loading metric",error:v}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"my-1 mb-2 flex max-w-2xl items-center justify-between",children:(0,o.jsx)("div",{className:"w-full",children:(0,o.jsxs)("div",{className:"h-[10px] w-full leading-[10px]",children:[(0,o.jsx)("span",{className:"align-baseline text-lg font-medium",children:MetricCardCompare_formatNumberAsStat({value:j||0,displayFormat:s.displayFormat})}),(0,o.jsxs)("span",{className:"ml-1 align-baseline text-sm text-gray-500",children:["vs ",MetricCardCompare_formatNumberAsStat({value:b||0,displayFormat:s.displayFormat})]})]})})}),(0,o.jsx)("div",{className:"mt-5 h-3/4",children:(0,o.jsx)(MetricCardCompare_MetricTimeSeriesChart,{id:s.id,chartName:s.name,displayFormat:s.displayFormat,timeResolution:(null==x?void 0:null===(a=x.engagementMetricComparisonData)||void 0===a?void 0:a.timeResolution)||y.M7.Day,timeSeries:f,line1:{label:c.name,color:c.lineColor},line2:{label:d.name,color:d.lineColor}})})]}):(0,o.jsx)(MetricCardCompare_MetricCardLoading,{})})]})};let en=!1,er={first:"#316CBF",second:"#d1d5db"},AddMetricButton=e=>{let{onClick:t}=e;return(0,o.jsxs)("button",{className:"btn-blue text-sm",onClick:t,children:[(0,o.jsx)(T.pOD,{className:"my-auto -ml-1 mr-1"}),"Add metric"]})},GridContaine},ea={[y.U.T_1D]:0,[y.U.T_7D]:1,[y.U.T_30D]:2,[y.U.T_3M]:3,[y.U.T_6M]:4,[y.U.T_1Y]:5,[y.U.TCustom]:6},ei=Object.values(y.U).filtel).sor]),es=ei.ma]),eo=new Map(es),timeSpanToHumanReadabl},el=ei.map(e=>e!==y.U.TCustom?{value:e,name:"Last ".concat(timeSpanToHumanReadable(e))}:{value:e,name:"Custom range"}),ec="previous",ed="demos",eu=[{value:ec,name:"Previous period"},{value:ed,name:"Product demos"}],em="all_boards",ep="all_guides",ex="all_projects",eg="loading",eh=new Date,ev=(0,M.Z)(eh,{days:-7});var Analytics_AnalyticsPageContent=()=>{var e;let t=(0,w.useRouter)(),{timespan:n,guide:r,project:a,board:i,startTime:s,endTime:c,compare:m,project1:p,project2:x}=(0,j.H8)(t.query),g=eo.get((null==n?void 0:n.toLowerCase())||"")||y.U.T_7D,M=r||ep,D=i||em,k=m||ec,A=s||(0,C.Z)(ev,"yyyy-MM-dd'T'HH:mm"),E=c||(0,C.Z)(eh,"yyyy-MM-dd'T'HH:mm"),F=a||ex,{workspace:P}=(0,b.cF)(),[I]=(0,b.AH)(),O=(0,b.BH)(P),[{data:L,fetching:Z,error:q}]=(e={variables:{workspaceId:P.id}},h.aM({query:v,...e})),[K,U]=(0,l.useState)(!1),[{data:$,fetching:H}]=(0,f.O)({variables:{data:{workspaceId:P.id,privacy:I,limit:500}}}),B="All Product Demos",[{data:R,fetching:z}]=(0,u.H)({variables:{workspaceId:P.id,filterForCurrentUser:!0},pause:!O}),[{data:V,fetching:X}]=(0,d.d)({variables:{data:{boardId:D,archived:!1,showPinnedFirst:!1}},pause:!O||D===em}),Y=(0,l.useMemo)(()=>{var e,t;if(H||X)return[{id:eg,name:"Loading..."}];if(O&&D!==em){let t=((null==V?void 0:null===(e=V.boardProjects)||void 0===e?void 0:e.results)||[]).map(e=>{let{project:t}=e;return{id:t.id,name:t.name||"Untitled (".concat(t.id,")")}});return[{id:ex,name:B},...t]}{let e=((null==$?void 0:null===(t=$.projects)||void 0===t?void 0:t.results)||[]).map(e=>({id:e.id,name:e.name||"Untitled (".concat(e.id,")")}));return[{id:ex,name:B},...e]}},[$,H,X,B,O,V,D]),G=(0,l.useMemo)(()=>{var e;return H?[{id:eg,name:"Loading..."}]:((null==$?void 0:null===(e=$.projects)||void 0===e?void 0:e.results)||[]).map(e=>({id:e.id,name:e.name||"Untitled (".concat(e.id,")")}))},[H,$]),W=new Map(G.ma})),Q=(0,l.useMemo)(()=>{if(z)return[{id:eg,name:"Loading..."}];let e=((null==R?void 0:R.boards)||[]).ma));return[{id:em,name:"All boards"},...e]},[R,z]),J=(0,l.useMemo},[L]),ee=(0,b.j_)(y.KG.Analytics),et=ee===y.KA.Edit,[ea,ei]=(0,l.useState)(!1),[es,ef]=(0,l.useState)(void 0),ey=(0,l.useMemo),[es,J]),ej=(0,l.useMemo)(()=>{var e;return F!==ex?[F]:O&&D!==em?null==V?void 0:null===(e=V.boardProjects)||void 0===e?void 0:e.results.ma}):void 0},[O,D,F,V]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,o.jsx)(_.Z,{title:"Analytics"}),et&&en&&(0,o.jsx)(AddMetricButton,{onClick:()=>ei(!0)})]}),(0,o.jsx)("div",{className:"mb-6",role:"separator"}),(0,o.jsxs)("div",{className:"mb-4 flex flex-row space-x-2",children:[g!==y.U.TCustom?(0,o.jsx)("div",{className:"min-w-[100px]",children:(0,o.jsx)(N.Z,{mb:0,className:"text-sm font-medium shadow-sm",items:el,selected:g,renderIcon:()=>(0,o.jsx)(T.Que,{className:"mr-1.5 h-3.5 w-3.5 text-gray-500"}),onChange:e=>{let{value:n}=e;return t.push({query:{...t.query,timespan:n.toLowerCase()}})}})}):(0,o.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,o.jsx)(N.Z,{mb:0,className:"text-sm font-medium shadow-sm",items:el,selected:g,renderIco),onChange:e=>{let{value:n}=e;return t.push({query:{...t.query,timespan:n.toLowerCase()}})}}),(0,o.jsx)(DateTimeInput,{id:"custom-range-start",name:"custom-range-start",value:A,onChange:e=>{t.push({query:{...t.query,startTime:e}})},debounce:1e3}),(0,o.jsx)(DateTimeInput,{id:"custom-range-end",name:"custom-range-end",value:E,onChange:e=>{t.push({query:{...t.query,endTime:e}})},debounce:1e3})]}),(0,o.jsx)("div",{className:"min-w-[100px]",children:(0,o.jsx)(N.Z,{mb:0,className:"text-sm font-medium shadow-sm",renderIcon:()=>(0,o.jsx)("div",{className:"mr-1 text-gray-500",children:"Compare:"}),items:eu,selected:k,onChange:e=>{let{value:n}=e;if(n===ec){let{compare:e,project1:n,project2:r,...a}=t.query;t.push({query:{...a}})}else{let{project:e,board:r,...a}=t.query;t.push({query:{...a,compare:n}})}}})}),k===ec&&(0,o.jsx)("div",{children:(0,o.jsx)(FilterButton,{className:"py-1.5 text-sm font-medium",onClic)})})]}),K&&k===ec?(0,o.jsxs)(FilterMenu,{onClose:()=>{U(!1);let{board:e,project:n,...r}=t.query;t.push({query:{...r}})},children:[O&&(0,o.jsx)(S.Z,{className:"text-sm font-medium",placeHolder:z?"Loading...":"Select board",items:Q,selected:D,renderSelectedIcon:()=>(0,o.jsx)("div",{className:"mr-1 text-gray-500",children:"Board:"}),onChange:e=>{let{id:n}=e;if(n!==eg){if(n===em){let{board:e,...n}=t.query;t.push({query:{...n}})}else t.push({query:{...t.query,board:n}})}}},"board"),(0,o.jsx)(S.Z,{className:"text-sm font-medium",placeHolder:H?"Loading...":"Select project",items:Y,selected:F,renderSelectedIco),onChange:e=>{let{id:n}=e;if(n!==eg){if(n===ex){let{project:e,...n}=t.query;t.push({query:{...n}})}else t.push({query:{...t.query,project:n}})}}},"project")]}):k===ed?(0,o.jsxs)(FilterMenu,{onClose:void 0,children:[(0,o.jsx)(S.Z,{className:"text-sm font-medium",placeHolder:"Select project 1",items:G,selected:p,renderSelectedIcon:()=>(0,o.jsx)("div",{className:"mr-2 h-2 w-2 shrink-0 rounded-full bg-[#316CBF]"}),onChange:e=>{let{id:n}=e;n!==eg&&t.push({query:{...t.query,project1:n}})}},"project1"),(0,o.jsx)(S.Z,{className:"text-sm font-medium",placeHolder:"Select project 2",items:G,selected:x,renderSelectedIco),onChange:e=>{let{id:n}=e;n!==eg&&t.push({query:{...t.query,project2:n}})}},"project2")]}):null,(0,o.jsx)(MetricsPageBodyConditional,{empty:0===J.length,fetching:Z,waitingForUserInput:k===ed&&(!p||!x),error:q,children:(0,o.jsx)(GridContainer,{children:J.map(e=>k===ec?(0,o.jsx)(Analytics_MetricCard,{canEdit:et,guideId:M===ep?void 0:M,projectIds:ej,openEditModa),timeSpan:g,metric:e,storageTypeOverride:"storageType"in t.query?t.query.storageType:void 0,startTime:new Date(A),endTime:new Date(E)},e.id):(0,o.jsx)(MetricCardCompare,{project1:p?{id:p,name:W.get(p)||"Unknown Project",lineColor:er.first}:void 0,project2:x?{id:x,name:W.get(x)||"Unknown Project",lineColor:er.second}:void 0,timeSpan:g,metric:e,storageTypeOverride:"storageType"in t.query?t.query.storageType:void 0,startTime:new Date(A),endTime:new Date(E)},e.id))})}),!es&&(0,o.jsx)(Analytics_CreateNewMetricModal,{open:ea,handleClos)}),es&&(0,o.jsx)(Analytics_EditMetricModal,{open:!!ey,handleClos),metric:ey})]})},ef=n(18406),ey=n(97185),ej=n(81291),eb=n(54532);let AnalyticsPage=()=>(0,o.jsxs)(eb.Z,{workspaceItem:y.KG.Analytics,children:[(0,o.jsx)(ej.Z,{title:"Analytics",includeSlug:!0}),(0,o.jsx)(ef.Z,{children:(0,o.jsx)(Analytics_AnalyticsPageContent,{})})]});AnalyticsPage.getLayout=e=>(0,o.jsx)(ey.Z,{navLeft:!0,children:e});var eM=AnalyticsPage},78991:function(e,t){"use strict";let secondsToMilliseconde,minutesToMilliseconds=e=>secondsToMilliseconds(60*e),hoursToMilliseconds=e=>minutesToMilliseconds(60*e),daysToMillisecond);let Duratio};t.Z=Duration}},function(e){e.O(0,[3211,8426,3265,1617,4637,5837,9391,8842,8613,4054,7330,9219,5306,6870,7156,6456,7185,9774,2888,179}),_N_E=e.O()}]);
//# sourceMappingURL=analytics-eb0327d6ca39c3c7.js.map