/***************************************
 * @preserve
 * Copyright (c) 2021 Verint Systems, Inc. All rights reserved.
 * ForeSee Web SDK: Feedback
 * Version: 19.14.9
 * Built: September 03, 2021, 12:56:52 CDT
 ***************************************/
_fsDefine(["fs",_fsNormalizeUrl("$fs.utils.js"),_fsNormalizeUrl("$fs.survey.js"),_fsNormalizeUrl("$fs.compress.js"),"exports"],function(e,t,i,s,n){var r={remove:hasClass:addClass:function(e){this.hasClass(e)||(this.className+=" "+e)},removeClass:function(e){this.className=(this.className||"").replace(e,""),this.className=this.className.replace(/[ ]+$/g,"")},$:css:function(t){for(var i in t)e.hasProp(t,i)&&(this.style[i]=t[i])}},a=function(t){if("string"==typeof t&&-1==t.indexOf("<"))return document.querySelectorAll(t);if("string"==typeof t){var i=document.createElement("div");i.innerHTML=t,t=i.firstChild}for(var s in r)e.hasProp(r,s)&&(t[s]=r[s]);return t},o=function(){function t(){var t=a('<img src="'+e.makeURI("$loader.gif")+'" class="acs-loader">');t.setAttribute("alt","loading survey"),this.$el=t}var i=t.prototype;return i.center=function(e){var t=this.$el.parentNode.offsetWidth,i=this.$el.offsetWidth;this.$el.css({left:(t-i)/2+"px",top:e?(t-i)/2+"px":"auto"})},i.remove=t}(),c=function(){function i(e,i,s,n,r,o){var c=this;this.sv=e,this.br=i,this.cfg=s,this.jrny=s.jrny,this.errTemplate=n,this.svTemplate=r,this.epTemplate=o,this.$domContent=[],this.$btns=[],this.networkError=new t.FSEvent,this.SurveySubmitted=new t.FSEvent,this.ajax=new t.AjaxTransport;for(var d=d||window,l=d.document.body.childNodes,f=0;f<l.length;f++)1===l[f].nodeType&&a(l[f]).hasClass("_acs")?this.$btns.push(l[f]):this.$domContent.push(l[f]);this.$el=a('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.sv.SubmitClicked.subscribe(function(){c.$content.removeClass("acsVisible"),c._showWait(),c._postSurveyData(function(){c.jrny.addEventObj({name:"feedback_submitted",properties:{mid:[s.mid]}}),c.$content.addClass("acsVisible"),c._showThankyou(),c._removeWait(),c.SurveySubmitted.fire()})}),this.networkError.subscribe(this.onNetworkError.bind(this)),this._getSurveyData(function(e){c.sv=e,c.show()})}var s=i.prototype;return s.onNetworkError=function(i){var s=this;this._removeWait(),i&&i.type?this.jrny&&this.jrny.addEventObj({name:"feedback_survey_"+i.type,properties:{mid:[this.sv.cfg.mid]}}):this.jrny&&this.jrny.addEventObj({name:"feedback_server_error",properties:{mid:[this.sv.cfg.mid]}}),this.$content=a('<div class="acsMainContainerMobile--'+this.sv.cfg.template+'"></div>'),this.$el=a('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.$closebtn=a('<span><img src="'+e.makeURI("$templates/feedback"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton" alt="Close Button" role="button"></span>'),this.$content.innerHTML=this.errTemplate(this.sv);var n=this.$content.$(".acs-serviceunavailable__message")[0];if("expired"===i.type){for(;n.firstChild;)n.removeChild(n.firstChild);this.sv.cfg.fbexpiremessage?n.appendChild(a("<p>"+this.sv.cfg.fbexpiremessage+"</p>")):n.appendChild(a("<p>This is an expired survey!</p>"))}else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(a("<p>Feedback isn't available right now.</p><p>Please check back later.</p>"))}t.Bind(this.$closebtn,"feedback:click",function(e){s.hide(e,!0)}),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content);var r=this.$el.$(".acs-close-button")[0];t.Bind(r,"feedback:click",function(e){s.hide(e,!0)}),this.$content.addClass("acsVisible"),window.document.body.innerHTML="",window.document.body.appendChild(this.$el)},s._renderSurvey=function(){var i=this,s=s||window,n=this,r=s.document.body;if(!this.sv.cfg.preview){t.Bind(document.body,"feedback:keyup",function e(i){"escape"==t.getKeyCode(i)&&(n.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[n.cfg.mid]}}),n.hide(i,!1)),t.Unbind(document.body,"feedback:keyup",e)})}r.innerHTML="",0===this.$el.children.length&&(this.$closebtn=a('<span><img src="'+e.makeURI("$templates/feedback/"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton" alt="Close Button" role="button"></span>'),this.$content=a('<div class="acsMainContainerMobile--'+this.sv.cfg.template+'"></div>'),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content)),r.appendChild(this.$el),this.sv.cfg.preview||t.Bind(this.$closebtn,"feedback:click",function(e){i.hide(e,!1)}),this._showWait()},s._showWait=function(){this._removeWait(),this._wait=new o,this.$el.appendChild(this._wait.$el),this._wait.center();var e=t.getScroll(window),i=t.getSize(window);this._wait.$el.css({position:"absolute",top:e.y+(i.h-this._wait.$el.offsetHeight)/2+"px",left:e.x+(i.w-this._wait.$el.offsetWidth)/2+"px"})},s._removeWait=function(){this._wait&&(this._wait.remove(),this._wait=null)},s.hide=function(t,i){window.document.body.innerHTML="";for(var s=0;s<this.$domContent.length;s++)window.document.body.appendChild(this.$domContent[s]);e.globalState.feedback.onFeedbackClosed.fire(),this.jrny&&t&&t.target&&!t.target.classList.contains("acs-feedback__button--epilogue")&&this.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[this.cfg.mid]}}),i||this._showBtns()},s.remove=s._showBtns=function(){for(var e=0;e<this.$btns.length;e++)window.document.body.appendChild(this.$btns[e])},s.show=function(){if(this._renderSurvey(),this._removeWait(),this.sv.ansLogoSrc=e.makeURI("$verint_foresee_logo.svg"),0===this.$content.children.length){var t=this.svTemplate(this.sv);this.$content.innerHTML=t,this.sv.bind(this.$content)}this.$content.addClass("acsVisible"),this.$el.addClass("acsVisible"),this.sv.SurveyUIUpdated.fire(),e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire(this.$el),this.jrny&&this.jrny.addEventObj({name:"feedback_survey_shown",properties:{mid:[this.sv.cfg.mid]}})},s._showThankyou=function(){var i=this;this._removeWait();var s=this.epTemplate(this.sv);this.$closebtn=a('<span><img src="'+e.makeURI("$templates/feedback/"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton" alt="Close Button" role="button"></span>'),this.sv.cfg.preview||t.Bind(this.$closebtn,"feedback:click",function(e){i.hide(e,!0)},!0),this.$content.innerHTML=s,this.jrny&&this.jrny.addEventObj({name:"feedback_thankyou_shown",properties:{mid:[this.cfg.mid]}}),this.$el.removeChild(this.$el.childNodes[0]),this.$el.removeChild(this.$el.childNodes[0]),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content);for(var n=this.$el.$(".acs-close-button")[0],r=this.$el.$("h1"),o=0;o<r.length;o++)a(r[o]).addClass("acs-feedback__heading acs-feedback__heading--h1");this.sv.cfg.preview||t.Bind(n,"feedback:click",},s._getSurveyData=function(){var e=this;if(this.sv.isExpired())this.networkError.fire({type:"expired"});else{var t={mid:this.sv.cfg.mid,cachebust:(new Date).getTime()};this.sv.cfg.version&&(t.version=this.sv.cfg.version),this._surveyTimer=setTimeout(function(){e.networkError.fire({type:"timedout"})},1e4),this.ajax.send({method:"GET",url:this.cfg.datauri,data:t,success:function(t){clearTimeout(e._surveyTimer),e.sv.SurveyData.fire(t,},failure:function(){e.networkError.fire({type:"getdata_failed"})}})}},s._postSurveyData=function(e){var i=this;if(this.sv.cfg.preview)setTimeout(function(){if(e)return e()},100);else{this._surveyTimer=setTimeout(function(){i.networkError.fire({type:"timedout"})},1e4);var s=JSON.parse(this.sv._serialize());this.jrny&&this.jrny.config&&this.jrny.config.disableCpps&&this.jrny.config.disableCpps.indexOf("url")>-1&&(s.url=""),this.ajax.send({method:"POST",url:this.cfg.posturi,data:s,contentType:"application/json",success:function(){if(clearTimeout(i._surveyTimer),e)return e()},failure:function(){clearTimeout(i._surveyTimer),t.SeshStorage.prototype.setItem("acsFeedbackSubmitted","true"),i.networkError.fire({type:"postdata_failed"})}})}},i}(),d={},l=!1;var f,h,u,p,b=function(){function i(e,i,s,n,r,o){var c=this;this.sv=e,this.cfg=e.cfg,this.instcfg=s,this.browser=i,this.em=n,this.noserv=n,this.eptemplate=o,this.jrny=e.cfg.jrny,this.SurveySubmitted=new t.FSEvent,this.networkError=new t.FSEvent,this.instcfg.surveyurl&&!this.instcfg.popup?this.addCustomSurveyModal(this.instcfg.surveyurl):(this.add(),this.modaltemplate=r,this.ajax=new t.AjaxTransport,this.sv.SubmitClicked.subscribe(function(){c.$content.removeClass("acsVisible"),c._showWait(),c._postSurveyData(function(){c.jrny&&c.jrny.addEventObj({name:"feedback_submitted",properties:{mid:[c.cfg.mid]}}),c.$content.addClass("acsVisible"),c._showThankyou(),c.SurveySubmitted.fire(),c._removeWait()})}),this.networkError.subscribe(function(e){c._removeWait(),e&&e.type?c.jrny&&c.jrny.addEventObj({name:"feedback_survey_"+e.type,properties:{mid:[c.cfg.mid]}}):c.jrny&&c.jrny.addEventObj({name:"feedback_server_error",properties:{mid:[c.cfg.mid]}}),c.$content.innerHTML=c.noserv(c.survey);var i=c.$content.$("h1"),s=c.$content.$(".acs-close-button")[0],n=c.$content.$(".acs-serviceunavailable__message")[0];if("expired"===e.type){for(;n.firstChild;)n.removeChild(n.firstChild);if(c.sv.cfg.fbexpiremessage)n.appendChild(a("<p>"+c.sv.cfg.fbexpiremessage+"</p>"));else{var r=c._unencodeHTML(c.sv.defaultCfg.expired);n.appendChild(a(r))}}else{for(;n.firstChild;)n.removeChild(n.firstChild);var o=c._unencodeHTML(c.sv.defaultCfg.unavailable);n.appendChild(a(o))}for(var d=0;d<i.length;d++)a(i[d]).addClass("acs-feedback__heading acs-feedback__heading--h1");c.cfg.preview||(c.positionModal(),t.Bind(s,"feedbackModal:click",function(){c.remove()})),c.$content.addClass("acsVisible")}),this._getSurveyData())}var s=i.prototype;return s._showThankyou=function(){var e=this,i=this.eptemplate(this.survey);this.$content.innerHTML=i;for(var s=this.$content.$("h1"),n=this.$content.$(".acs-close-button")[0],r=document.getElementById("fsrModalFocus"),a=0;a<s.length;a++)t.addClass(s[a],"acs-feedback__heading acs-feedback__heading--h1");this.positionModal(),this.cfg.preview||t.Bind(n,"feedbackModal:click",function(){e.remove()}),r.focus()},s._unencodeHTML=s._showWait=function(){this._removeWait(),this._wait=new o,this.$el.appendChild(this._wait.$el),this._wait.center();var e=t.getScroll(window),i=t.getSize(window);this._wait.$el.css({top:e.y+(i.h-this._wait.$el.offsetHeight)/2+"px"})},s._removeWait=s.remove=function(){this.$el&&this.$el.parentNode&&(t.Unbind("feedbackModal:*"),this.$el.parentNode.removeChild(this.$el),e.globalState.feedback.onFeedbackClosed.fire(this.$el))},s.addCustomSurveyModal=function(e){var i=this.browser.isMobile?"mobile":"desktop";new t.ModalIFrame(e,this.instcfg,i).show()},s.add=function(i){var s=this,n=(i=i||window).document.body,r=i.document.documentElement,o=Math.max(n.scrollHeight,n.offsetHeight,r.clientHeight,r.scrollHeight,r.offsetHeight),c="acsModalContainer--"+this.instcfg.template,d=this.sv.cfg,l=a('<div class="acsModalBackFace"></div>'),f=a('<div class="acsModalChrome"></div>');if(this.browser.isIE&&10==this.browser.browser.version&&(c+=" acsIE10"),this.$el=a('<div class="'+c+'"></div>'),this.$el.css({height:o}),!this.cfg.preview){var h=this;t.Bind(l,"feedbackModal:click",function(){(s.survey||s.networkError.didFire)&&(h.jrny&&h.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[d.mid]}}),s.remove())});t.Bind(document.body,"feedbackModal:keyup",function(e){"escape"==t.getKeyCode(e)&&(h.jrny&&h.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[d.mid]}}),h.remove(),h.focusOnBadge())}),t.Bind(f,"feedbackModal:click",function(e){var t=e.target;t&&t==f&&(h.jrny&&h.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[d.mid]}}),h.remove(),h.focusOnBadge())})}var u=this.head=a('<div class="acsModalContent" id="acsModalContent" role="dialog" aria-labelledby="acsFeedbackDialogTitle" aria-describedby="acsFeedbackDialogDesc"></div>'),p=a('<div class="acsModalHead" role="presentation"></div>'),b=a('<img id="fsrModalFocus" src="'+e.makeURI("$templates/feedback/"+(this.instcfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton" alt="Close Button" tabindex="0" role="button">');this.$head=p,p.appendChild(b),u.appendChild(p),this.$content=a('<div class="acsModalInnerContent" role="presentation"></div>'),u.appendChild(this.$content),f.appendChild(u),this.$el.appendChild(l),this.$el.appendChild(f),i.document.body.appendChild(this.$el),this.cfg.preview||(t.Bind(b,"feedbackModal:click",function(){s.jrny&&s.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[s.cfg.mid]}}),s.remove(),s.focusOnBadge()}),t.Bind(b,"feedbackModal:keypress",function(e){var i=t.getKeyCode(e);("enter"==i||"spacebar"==i)&&(s.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[s.cfg.mid]}}),s.remove(),s.focusOnBadge(),e.preventDefault())})),e.nextTick(function(){l.addClass("_acsActive")}),this._showWait(),this._trapKeyBoard(u,b)},s.renderSurvey=function(){this._removeWait(),this.$head.addClass("acsVisible"),this.survey.ansLogoSrc=e.makeURI("$verint_foresee_logo.svg"),this.survey.meta.prologuetext=this._addTitleDescIds(this.survey.meta.prologuetext),this.survey.meta.epiloguetext=this._addTitleDescIds(this.survey.meta.epiloguetext);var t=this.modaltemplate(this.survey);this.$content.innerHTML=t,this.sv.bind(this.$content),this.positionModal(),this.$content.addClass("acsVisible"),e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire(this.$el),this.jrny&&this.jrny.addEventObj({name:"feedback_survey_shown",properties:{mid:[this.cfg.mid]}}),e.globalState.feedback.onModalCssRetrieved.subscribe(!0,!0)},s._addTitleDescIds=function(e){var t=document.createElement("div");t.innerHTML=e;var i=t.childNodes[0],s=t.childNodes[1],n="";if(t.childNodes.length>2)for(t.removeChild(t.childNodes[0]),(s=document.createElement("div")).setAttribute("style","padding: 0; margin: 0;");t.hasChildNodes();){var r=t.firstChild;t.removeChild(r),s.appendChild(r)}return i.setAttribute("id","acsFeedbackDialogTitle"),n=i.outerHTML,s&&(s.setAttribute("id","acsFeedbackDialogDesc"),n+=s.outerHTML),n},s.positionModal=function(){var e,i=t.getSize(window),s=this.$content.offsetHeight||this.prevOffsetHeight;i.h>s&&(e=Math.max(0,(i.h-s-50)/2)+"px"),this.head.style.marginTop=e,d&&d.FBALTOVERFLOW&&this.$el.css({"overflow-y":"scroll",display:"block"})},s.show=function(){this.positionModal(),this.$el.css({display:"block"}),e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire(this.$el)},s.focusOnBadge=function(){var e=this.instcfg.badge&&this.instcfg.badge.$el;e&&e.focus()},s._trapKeyBoard=function(e,i){i=i||e,t.Bind(document.body,"feedbackModal:focus",function(s){var n=(s=s||window.event).target||s.srcElement,r=document.getElementById("acsMainInvite")||document.getElementById("fsrInvite");r&&t.DOMContains(r,n)||t.DOMContains(e,n)||i&&(s.stopPropagation(),i.focus())},!1)},s._getSurveyData=function(){var t=this;if(this.sv.isExpired())this.networkError.fire({type:"expired"});else{var i={mid:this.sv.cfg.mid,cachebust:(new Date).getTime()};this.sv.cfg.version&&(i.version=this.sv.cfg.version),this._surveyTimer=setTimeout(function(){t.networkError.fire({type:"timedout"})},1e4),this.ajax.send({url:this.sv.cfg.datauri,data:i,method:"GET",skipEncode:!1,success:function(i){t.networkError.didFire||(clearTimeout(t._surveyTimer),t.sv.SurveyData.fire(i,function(i){t.survey=i,t.survey.CSSprefix=e.CSSprefix,t.renderSurvey()}))},failure:function(){t.networkError.didFire||t.networkError.fire({type:"getdata_failed"})}})}},s._postSurveyData=function(i){var s=this;if(this.cfg.preview)e.nextTick(;else{var n=JSON.parse(this.sv._serialize());this.jrny&&this.jrny.config&&this.jrny.config.disableCpps&&this.jrny.config.disableCpps.indexOf("url")>-1&&(n.url=""),e.isArray(n.responses)&&n.responses.push({questionId:"deployment_type",answerText:"BADGE"}),e.globalState.feedback.onFeedbackSubmitted.fire(e.ext({rating:this.sv._getScore()},n)),this._surveyTimer=setTimeout(1e4),this.ajax.send({method:"POST",url:this.cfg.posturi,data:n,contentType:"application/json",success:function(){if(clearTimeout(s._surveyTimer),i)return i()},failure:function(){clearTimeout(s._surveyTimer),t.SeshStorage.prototype.setItem("acsFeedbackSubmitted","true"),s.networkError.fire({type:"postdata_failed"})}})}},i}(),m=null,v=null,g=t.now(),y={setup:function(i,s,n,r){var a=e.getVendorConfig("fs"),o=e.API.retrieveFromAPI("isProductCurrentlyQualified");o&&o("record")&&a.products.record?window._fsRequire([e.makeURI("$fs.record.js")],function(e){v||(v=t.getGeneralStorage(i));var n={id:a.customerId||t.getRootDomain()||"feedback_customerId"};m=e.getInstance(i,window,v,n,s),r(m)}):e.nextTick(r)},startProcessing:function(e,i,s){y.startTransmitting(e,i,s,function(e){e&&e.recorder&&e.recorder.processImmediately(Math.max(2e4-(t.now()-g),0))})},dispose:startTransmitting:function(e,i,s,n){if(g=t.now(),!0===s.replay)if(m){if(m.beginTransmitting(),n)return n(m)}else y.setup(e,i,s,function(e){if(e.beginTransmitting(),n)return n(e)})}},w=function(){function i(e,i,s){this.height=600,this.width=400,this.survey=e,this.cfg=i,this.cpps=e.cpps,this.SurveySubmitted=new t.FSEvent,this.br=s,this.jrny=i.jrny,this.networkError=t.FSEvent()}var n=i.prototype;return n._getCXRParams=function(){var t=e.getVendorConfig("fs"),i="";return!0===this.cfg.replay&&null!=m&&(i+="cxrid="+e.enc(m.getGlobalId())+"&cxrurl="+e.enc(t.recUrl)),i},n.show=function(){var i=e.getVendorConfig("fs");if(!this.winRef){var n,r=this.cfg.preview?null:JSON.stringify(this.cpps.all()),a=this,o=window,c=this.cfg.badge&&this.cfg.badge.btncfg&&this.cfg.badge.btncfg.surveyurl?this.cfg.badge.btncfg.surveyurl:this.cfg.surveyurl,d=this.cfg.badge&&this.cfg.badge.btncfg&&this.cfg.badge.btncfg.mid?this.cfg.badge.btncfg.mid:this.cfg.mid,l={global:i,product:this.cfg.preview?null:function(t,i){for(var s=e.ext({},i),n=0;n<s.instances.length;n++)if(t===s.instances[n].mid){s.instances=[e.ext({},s.instances[n],!1)];var r=s.instances[0];delete r.badge,delete r.jrny,delete r.record,delete r.stg;break}return s}(d,e.getProductConfig("fs","feedback"))},f=["&mid=",e.enc(d),"&_gwl_=",e.enc(e.home),"&_cv_=",e.enc(i.codeVer),"&_au_=",e.enc(i.analyticsUrl),"&_vt_=",e.enc(e.tagVersion),"&_issh_=",e.enc(e.isSelfHosted),"&_pa_=",e.enc(e.assetLocation),e.codeLocation?"&_cl_="+e.enc(e.codeLocation):""].join("");if(c)n=c+(-1===c.indexOf("?")?"?":"&")+this.cpps.toQueryString();else if(this.cfg.preview)n=e.makeURI(["$fs.feedbacksurvey.html?mid=",e.enc(this.survey.cfg.mid),"&t=",e.enc(this.cfg.template||"default"),"&datauri=",e.getParam("datauri"),"&ns=",e.enc("preview"),"&_gcfg_=",e.enc(s.compress(e.enc(JSON.stringify(l)))),f].join(""));else{n=e.makeURI(["$fs.feedbacksurvey.html?","&t=",e.enc(this.cfg.template||"default"),"&fsUrl=",e.enc(o.location.href),"&uid=",e.enc(e.globalState.feedback.stg.uid),"&ns=",e.enc(i.siteKey),"&brain=",e.enc(i.brainUrl),f].join("")),!0===i.products.record&&(n+="&"+this._getCXRParams()),t.getBrainStorage(this.br,e.globalState.feedback.stg.uid,this.cfg.preview?"preview":i.siteKey).set("fscfg",{gcfg:e.enc(s.compress(e.enc(JSON.stringify(l)))),cid:e.enc(i.customerId),cpps:e.enc(s.compress(r))})}this.br.isIE&&this.br.browser.actualVersion<=11&&("//"==n.substr(0,2)&&(n="https:"+n),"http:"==n.substr(0,5)&&n.replace("http:","https:")),this.cfg.preview&&(o!==o.top||o.location.toString().indexOf("fscommand=feedbackpreview")>-1)?o.location.href=n:(this.winRef=o.open(n,"_system"),this._checkerFailsAllowed=20,this._checker=setInterval(function(){try{if(!0===a.winRef.closed)return clearInterval(a._checker);var t=""+a.winRef.location,i="fsSurveyComplete=";if(t.indexOf(i)>-1){clearInterval(a._checker);var n=s.decompress(decodeURIComponent(t.substr(t.indexOf(i)+i.length)));e.globalState.feedback.onFeedbackSubmitted.fire(JSON.parse(n)),a.SurveySubmitted.fire(JSON.parse(n))}}catch(r){if(a._checkerFailsAllowed>0)return void a._checkerFailsAllowed--;clearInterval(a._checker),a.SurveySubmitted.fire()}},500))}e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire(this.winRef)},i}(),k=function(){function s(e,i,s,n,r,a){this.cfg=e,this.br=i,this.cpps=s,this.errortemplate=n,this.modaltemplate=r,this.eptemplate=a,this.jrny=e.jrny,this.init(),this.SurveySubmitted=new t.FSEvent,this.NetworkError=new t.FSEvent}var n=s.prototype;return n.init=function(){var t=this;switch(this.cfg.surveytype){case"popup":this.survey=new i.Survey(this.cfg,this.cpps,this.br),this.chrome=new w(this.survey,this.cfg,this.br),this.chrome.SurveySubmitted.subscribe(function(){t.SurveySubmitted.fire(),e.globalState.feedback.onFeedbackClosed.fire()}),this.chrome.show();break;case"modal":e.isDefined(this.chrome)?(this.chrome.show(),e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire()):(this.survey=new i.Survey(this.cfg,this.cpps,this.br),this.chrome=new b(this.survey,this.br,this.cfg,this.errortemplate,this.modaltemplate,this.eptemplate),this.chrome.SurveySubmitted.subscribe(function(){t.SurveySubmitted.fire()}),this.chrome.networkError.subscribe(function(){t.NetworkError.fire()}));break;case"fullpage":e.isDefined(this.chrome)?(this.chrome.show(),e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),e.globalState.feedback.onFeedbackShown.fire()):(this.survey=new i.Survey(this.cfg,this.cpps,this.br),this.chrome=new c(this.survey,this.br,this.cfg,this.errortemplate,this.modaltemplate,this.eptemplate),this.chrome.SurveySubmitted.subscribe(function(){t.SurveySubmitted.fire()}),this.chrome.networkError.subscribe(function(){t.NetworkError.fire()}));break;default:throw new Error("Unknown feedback surveytype: "+this.cfg.surveytype)}},n.show=n.remove=s}(),S={Current:null};S.getPopup=function(e){return!(t.getSize(window).w<=500)&&(!(!S.Current||S.Current.cfg.mid!=e)&&S.Current)},S.disposePopups=S.removePopup=function(e){S.Current&&S.Current.cfg.mid==e&&(S.Current.remove(),S.Current=null)},S.initialize=function(e,t,i,s,n,r){S.disposePopups(),e.surveytype||void 0===e.popup||(e.surveytype=e.popup?"popup":"modal"),e.surveytype=S.computeSurveyType(e.surveytype);var a,o=S.getPopup(e.mid);return o&&!o.cfg.popup?o.show():(o=new k(e,t,i,s,n,r),S.Current=o,o.SurveySubmitted.subscribe((a=e,),o.NetworkError.subscribe(function(){S.NetworkError.fire()})),o},S.computeSurveyType=function(i){return"fullpage"!==i&&(e.globalState.feedback.browser.isMobile||t.getSize(window).w<=500)?"popup":i},S.SurveySubmitted=new t.FSEvent,S.NetworkError=new t.FSEvent;var _={launchFB:function(i){var s=!1,n=!1,r=e.getProductConfig("fs","feedback").instances;clearTimeout(f),clearTimeout(h),t._preventUnloadFor(500);for(var a=0;a<r.length;a++)if(r[a].mid==i){s=r[a];break}if(s&&s.disabled)return"This feedback has been disabled.";if(s.topics&&s.topics.length)for(var o=0;o<s.topics.length;o++)if(t.checkFeedbackTopicAllowed(s.topics[o])){n=!0;break}if(!s)return"Error: MID provided is not valid";if(!n&&0!==s.topics.length)return"Error: Either this measure is disabled or there are no active topics";if((n||0===s.topics.length)&&!s.disabled){if(s.surveytype||void 0===s.popup||(s.surveytype=s.popup?"popup":"modal"),s.template||(s.template="default"),"popup"==S.computeSurveyType(s.surveytype))return void S.initialize(s,e.globalState.feedback.browser,e.globalState.feedback.CPPS);var c={},d=function(i,s,n,r){var a=e.makeURI("$templates/feedback/"+(i||"default")+"/"+s+".html");new t.TemplateFetcher({success:function(e){return n&&n.resolve(),r(e)},failure:function(){n&&n.error()}}).get(a)},l=new t.Async(!0,function(){console.warn("api: Fetched the templates "),void 0===e.globalState.feedback.browser&&(e.globalState.feedback.browser=new t.Browser),void 0===e.globalState.feedback.CPPS&&(e.globalState.feedback.CPPS=new t.CPPS(t.getGeneralStorage(e.globalState.feedback.browser))),S.initialize(s,e.globalState.feedback.browser,e.globalState.feedback.CPPS,c.emTemplate,c.svContentsTemplate,c.epTemplate)},;l.enqueue(function(i){t.loadCSS(e.makeURI("$templates/feedback/"+(this.template||"default")+"/main.css"),function(){e.globalState.feedback.onModalCssRetrieved.fire(),i&&i.resolve()},function(){i&&i.error()})}),l.enqueue(function(e){d(s.template,"epilogue",e,function(e){c.epTemplate=e})}),l.enqueue(function(e){d(s.template,"surveycontents",e,function(e){c.svContentsTemplate=e})}),l.enqueue(function(e){d(s.template,"serviceunavailable",e,function(e){c.emTemplate=e})})}},resetFeedback:function(){clearTimeout(h),f&&(clearTimeout(f),f=null),f=setTimeout(function(){for(f=null;p.length>0;){var i=p.pop();i.badge&&i.badge.dispose()}t.Unbind("feedback:*"),t.Unbind("feedbackModal:*"),y.dispose(),S.disposePopups();var s=e.API.retrieveFromAPI("isProductCurrentlyQualified");s&&s("feedback")&&(h=e.nextTick()},200)}},C=function(){function i(e,t,i){this.template=i,this.br=e,this.cpps=t,this.emTemplate=null,this.css=null,this.typeTemplate=null,this.svContentsTemplate=null,this.epTemplate=null}var s=i.prototype;return s.getCss=function(i){t.loadCSS(e.makeURI("$templates/feedback/"+(this.template||"default")+"/main.css"),function(t){t?(i&&i.resolve(),e.globalState.feedback.onModalCssRetrieved.fire()):i&&i.error()},null,this.br)},s.getTemplate=function(i,s,n){var r=e.makeURI("$templates/feedback/"+(this.template||"default")+"/"+i+".html");new t.TemplateFetcher({success:function(e){if(s&&s.resolve(),n)return n(e)},failure:).get(r)},s.grabTemplates=function(e){var i=this;this.queue=new t.Async(!0,function(){if(e)return e({typeTemplate:i.typeTemplate,emTemplate:i.emTemplate,epTemplate:i.epTemplate,svContentsTemplate:i.svContentsTemplate})},function(){}),this.queue.enqueue(,this.queue.enqueue(function(e){i.getTemplate("badge",e,function(e){i.typeTemplate=e})}),this.queue.enqueue(function(e){i.getTemplate("serviceunavailable",e,function(e){i.emTemplate=e})}),this.queue.enqueue(function(e){i.getTemplate("epilogue",e,function(e){i.epTemplate=e})}),this.queue.enqueue(function(e){i.getTemplate("surveycontents",e,})},i}(),T=function(e,i,s){var n=this;this.br=e,this.cpps=i,this.templateHolder={},this.loadSuccess=new t.FSEvent,this.loadFailure=new t.FSEvent;var r=new t.Async(!0,;s.forEach(function(e){r.enqueue(function(t){new C(n.br,n.cpps,e).grabTemplates(function(i){i?(n.templateHolder[e]=i,t.resolve()):t.error()})})})},$=function(){function i(i){this.br=i,this.mid=t.getHashParm("mid"),this.previewmode=e.toLowerCase(t.getHashParm("previewmode")),this.datauri=t.getHashParm("datauri"),this.template=t.getHashParm("template")||"default",this.surveytype=t.getHashParm("surveytype")?t.getHashParm("surveytype"):"modal",this.tempHolder={}}return i.prototype.show=function(){var e=this;if(!(this.mid&&this.previewmode&&this.datauri))throw new Error("You need mid, previewmode, and datauri.");var t=new T(this.br,{},[this.template]);t.loadSuccess.subscribe(function(t){e.tempHolder=t[e.template],S.initialize({mid:e.mid,datauri:e.datauri,posturi:"",reporturi:"",surveytype:e.surveytype,autowhitelist:!0,preview:!0,template:e.template,replay:!1},e.br,null,e.tempHolder.emTemplate,e.tempHolder.svContentsTemplate,e.tempHolder.epTemplate)}),t.loadFailure.subscribe(function(){})},i}(),F=function(){function i(i,s,n,r,a,o){this.cfg=i,this.cpps=n,this.jrny=i.jrny;var c,d="acsFeedbackResultsCounter",l=i.previewMode?i.previewMode.toLowerCase():"";(this.btncfg=i,this.badgeClicked=new t.FSEvent,this.surveyTriggered=new t.FSEvent,this.br=s,i.devices&&i.devices.overridesEnabled)&&(c=s.isTablet||"tablet"===l?i.devices.tablet:s.isMobile||"mobile"===l?i.devices.mobile:i.devices.desktop,e.ext(this.cfg,c),this.cfg.icon.lastIndexOf(".png")>-1&&(this.btncfg.icon=this.cfg.icon.replace(".png",".svg")));this.animationMove=4,i.counter&&(this.counter=0,sessionStorage.getItem(d)&&(this.counter=Math.round(parseFloat(sessionStorage.getItem(d))),this.counter=isNaN(this.counter)?0:this.counter),this.btncfg.counter=this.counter,this.btncfg.counterLocale=i.counter.toLocaleString()),this.btncfg.fbsize=this.cfg.fbsize||"medium",this.btncfg.btnClass="_acs _acs"+i.fbtype+"--"+i.template+" _acsbadge--"+this.btncfg.fbsize+" _acs"+i.fblocation,this.btncfg.fbcolortext=this.btncfg.fbcolortext||"#fff",this.btnTemplate=r,this.emtemplate=a,this.enabled=!!o}var s=i.prototype;return s.setBtnTemplate=function(){var e=this,i={btncfg:this.btncfg},s=this.btnTemplate(i),n=this;n.badgeClicked.subscribe(function(){n.jrny&&n.jrny.addEventObj({name:"feedback_clicked"+(n.br.isMobile?"_mobile":""),properties:{mid:[n.cfg.mid]}}),n.surveyTriggered.fire({emtemplate:n.emtemplate})},!1,!0),this.$el=document.createElement("div"),this.$el.innerHTML=s,this.$el=a(this.$el.querySelectorAll("a._acs")[0]),this.enabled&&(t.Bind(this.$el,"feedback:click",,t.Bind(this.$el,"feedback:keypress",function(e){var i=t.getKeyCode(e);"enter"!==i&&"spacebar"!==i||(n._unhover(),n.badgeClicked.fire(n.cfg))})),this.cfg.fbanimate&&(t.Bind(this.$el,"feedback:mouseenter",function(){n._hover()}),t.Bind(this.$el,"feedback:mouseleave",function(){n._unhover()})),this.btncfg.label.length||(this.$el.querySelector("._acsBadgeLabel").style.paddingLeft=0),document.body.appendChild(this.$el),d&&!d.FBALTPOSITION&&t.addClass(document.documentElement,"fsfb fsfb-relbody"),this.cfg.delay&&this.cfg.delay>0?setTimeout(this.cfg.delay):this.init()},s._hover=function(){this.cfg.fbanimate&&this.$el.addClass("_acsHover")},s._unhover=s.init=function(e){var i=this.$el.$("._acsBadgeLabel"),s=this,n=t.getGeneralStorage(this.br);if(e=e||function(){},s.jrny&&!n.get("fbb")&&(n.set("fbb","s",864e5),s.jrny.addEventObj({name:"feedback_button_shown",properties:{mid:[s.cfg.mid]}})),this.$el.css({visibility:"hidden"}),i&&i.length>0){if(e){var r=this.$el;setTimeout(function(){s._unhover(),setTimeout(250)},250),"vertical"==this.cfg.fbdirection&&(this.cfg.fblocation.indexOf("right")>-1?this.$el.addClass("_acsVertical_right"):this.$el.addClass("_acsVertical_left")),this.cfg.fbfixed&&this.$el.addClass("_acsFixed")}"none"===this.cfg.fbtype?this.$el.css({display:"none"}):this.$el.css({visibility:"visible"}),s.br.isMobile&&this.$el.setAttribute("role","link")}},s.remove=s.dispose=i}();function E(e,t){e=e||this.cfg,t=t||this.br;var i=e.previewMode?e.previewMode.toLowerCase():"",s=e.fbtype;return e&&t?(e.devices&&e.devices.overridesEnabled&&(s=t.isTablet||"tablet"===i?e.devices.tablet.fbtype||e.fbtype:t.isMobile||"mobile"===i?e.devices.mobile.fbtype||e.fbtype:e.devices.desktop.fbtype||e.fbtype),s):s}var j=function(){function e(e,t,i){this.cfg=e,this.br=t,this.cpps=i,this.cfg.template=void 0!==this.cfg.template?this.cfg.template:"default",this.cfg.surveytype=void 0!==this.cfg.surveytype?this.cfg.surveytype:"modal",this.cfg.fbcolor=void 0!==this.cfg.fbcolor?this.cfg.fbcolor:"#F24554",this.cfg.fbcolortext=void 0!==this.cfg.fbcolortext?this.cfg.fbcolortext:"#FFFFFF",this.cfg.replay=void 0!==this.cfg.replay&&this.cfg.replay}return e.prototype.renderBadge=function(){var e=this,t=new T(this.br,this.cpps,[this.cfg.template]);t.loadSuccess.subscribe(function(t){var i=t[e.cfg.template];e.cfg.badge=new F(e.cfg,e.br,e.cpps,i.typeTemplate,i.emTemplate,!1),e.cfg.badge.setBtnTemplate()}),t.loadFailure.subscribe(function(){})},e}();t.registerProduct("feedback");var M=[],I=window.location;function x(){var i=e.getVendorConfig("fs"),s=e.getProductConfig("fs","feedback"),n=!!t.getHashParm("previewmode"),r=!!e.getParam("previewbadgemode"),a=s.instances,o=[],c=!1,d=!1;I=JSON.parse(JSON.stringify(window.location));var l=new t.Browser;l.ready.subscribe(function(){var s=t.getGeneralStorage(l);s.ready.subscribe(function(){if(n){new $(l).show()}else{var f=new t.CPPS(s),h=i.adobeRsid;t.initBehavioralData(i.customerId||t.getRootDomain()||"feedback_customerId",s,l,f),f.set("code",i.codeVer),f.set("tz",-(new Date).getTimezoneOffset()),f.set("env",e.isProduction?"prd":"stg"),t.INT.GA.uid(;var u=if(t.INT.OM.uid(h,u),t.INT.OM.mcid(h,u),t.INT.OM.beacon(,r){var p=JSON.parse(e.getParam("cfg")),b=e.getQueryString("previewbadgemode")||"desktop";p.mid&&(p.previewMode=b,new j(p,l,f).renderBadge())}else{e.globalState.feedback.CPPS=f,e.globalState.feedback.browser=l,e.globalState.feedback.stg=s,e.globalState.feedback.__apiReady.fire();var m=e.API.retrieveFromAPI("isProductCurrentlyQualified");if(!m||m("feedback")){for(var g=!0===i.products.mpathy?"mpathy":"record",w=0;w<a.length;w++){var k=a[w];if(!0===i.products[g]&&!0===k.replay&&!1===k.disabled&&("mpathy"===g?d=!0:(c=!0,"y"!=s.get("fbr")&&s.set("fbr","y"))),(k.__didpass||k.topics&&0===k.topics.length)&&!k.disabled&&window==window.top){var _=!1;k.template||(k.template="default");for(var C=0;C<o.length;C++)o[C]===k.template&&(_=!0);_||o.push(k.template),k.jrny=new t.Journey({customerId:i.customerId||t.getRootDomain()||"feedback_customerId",appId:t.APPID.FEEDBACK,stg:s,browser:l,throttleDuration:1e3,useSessionId:!0,usePopupId:!1}),M.push(k)}}if(M.length>0){var I,x=o.length>0?o:["default"];new T(l,f,x).loadSuccess.subscribe(function(t){for(var i=0;i<M.length;i++){var s=M[i];if("badge"===E(s,l)){e.globalState.feedback.onFeedbackReady.didFire||e.globalState.feedback.onFeedbackReady.fire(),0==i&&l.isIE&&((I=document.createElement("div")).className="acs-feedback__forcefont",document.body.appendChild(I));var n=t[s.template];s.badge=new F(s,l,f,n.typeTemplate,n.emTemplate,!0),s.badge.setBtnTemplate(),s.badge.surveyTriggered.subscribe(r(s,n),!1,!1)}}function r(t,i){return function(){!0===t.replay&&(d?e.globalState.onRecordQualified.fire("feedback"):c&&y.startTransmitting(l,f,t)),t.jrny.initPopupId(),S.initialize(t,l,f,i.emTemplate,i.svContentsTemplate,i.epTemplate)}}S.SurveySubmitted.subscribe(function(e){var t,i;if(e&&e.mid)for(c&&y.startProcessing(l,f,e),t=0;t<M.length;t++)M[t].badge&&M[t].mid===e.mid&&M[t].badge.remove();else for(i=0;i<M.length;i++)M[i].badge&&M[i].badge.remove()})},!0,!0)}c&&y.setup(l,f,M[0],function(e){for(var t=0;t<M.length;t++)M[t].stg=v,M[t].record=e})}}}},!0,!0)},!0,!0)}return n.API=_,n.startup=function(){if(function(){var t=e.getProductConfig("fs","fbmods")||{},i=e.toLowerCase(window.location.href.toString());if((t.noPositionRelativeBody||i.indexOf("buildabear.c")>-1||i.indexOf("bab-dev-store.sparkred.")>-1||i.indexOf("humana.c")>-1||i.indexOf(".dteenergy.c")>-1||i.indexOf(".mcdonalds.")>-1)&&(d.FBALTPOSITION=!0),(t.overflowScroll||i.indexOf(".peco.c")>-1||i.indexOf(".bge.com")>-1||i.indexOf(".comed.com")>-1)&&(d.FBALTOVERFLOW=!0),(t.skipIFrames||i.indexOf("argos.co")>-1)&&window!==window.top)return!1;if(t.temporaryCssHack&&!l){l=!0;var s=document.createElement("style");s.innerHTML="\n/* ForSee Feedback CSS Styles */\n"+t.temporaryCssHack,document.head.appendChild(s)}return!0}()){if(e.fsCmd("feedbackreport")||e.supportsDomStorage&&"true"==sessionStorage.getItem("fsFeedbackLoaded"))return e.supportsDomStorage&&t.SeshStorage.prototype.setItem("fsFeedbackLoaded","true"),void window._fsRequire([e.makeURI("$fs.feedbackreport.js")],;u=x,p=M,e.domReady(x),e.globalState.feedback.pageResetFn=function(){var t,i=window.location,s=function(e){var t=(e=e||"").split("#");return t.length>2?t[0]+t[1]:e.replace(/#/gi,"")};s(I.hash)==s(i.hash)&&I.pathname==i.pathname||window.fsReady(function(){clearTimeout(t),t=setTimeout(function(){I=JSON.parse(JSON.stringify(window.location));var t=e.API.retrieveFromAPI("resetFeedback");e.isFunction(t)&&t()},1e3)})},t.pageNavEvent.subscribe(e.globalState.feedback.pageResetFn,!1,!1)}},n});
