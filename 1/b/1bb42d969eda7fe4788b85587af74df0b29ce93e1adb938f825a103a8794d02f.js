;/*FB_PKG_DELIM*/

/**
 * @codegen-command: scripts/shaka-player/build/fb_build.sh
 * @generated
 * @nopackage
 * @oncall video_playback_www
 * @preserve-whitespace
 * @providesModule Shaka
 */
__d("Shaka",["Promise","EventListener","VideoPlayerShakaPerformanceLogger","VideoPushParametersHelper","TimeSlice","VideoPlayerLocalBandwidthEstimator","VideoPlayerResourceTimer","ShakaSegmentReferenceHelper","SegmentRequestManager","concatArrayBuffer","BufferReplacementHelper","logLongAkamaiRequest","throttle","ViewportPriorityAdjuster","FirstLoadedVideoPriorityAdjuster","VideoPriorityCalculator","VideoStreamingManager","MultipleSegmentsProvider","LocalBitrateHelper","UnitConstants","BufferVelocity","VideoPlayerBitrateEstimator","VideoPlayerShakaGlobalConfig","getSeekRangeGapsFromShakaReferences","maybeConvertHiveErrorToShakaNetError","mergeSeekRangeGaps","NetworkStatusDetector","MosUtils","ODS","VideoDashPrefetchCache","VideoClientEdgeCooperation","VideoStreamingTaskQueueProvider","BinarySearch","ShakaTimelineSegmentIndexUtils","gkx","setTimeoutAcrossTransitions","setIntervalAcrossTransitions","setImmediateAcrossTransitions","clearTimeout","clearInterval","clearImmediate","dispatchEvent","EventListener","Event","extractCEA608","performanceNow","parseHeaders","canUseFetchStream","SubscriptionsHandler","VideoPushTracker","ShakaConstants"],(function $module_Shaka(global,require,requireDynamic,requireLazy,module,exports){

// run `scripts/shaka-player/build/fb_build.sh` to regenerate Shaka.js after modifying this
// file

var Promise = require('Promise');
var EventListener = require('EventListener');
var VideoPlayerShakaPerformanceLogger = require('VideoPlayerShakaPerformanceLogger');
var VideoPushParametersHelper = require('VideoPushParametersHelper');
var TimeSlice = require('TimeSlice');
var VideoPlayerLocalBandwidthEstimator = require('VideoPlayerLocalBandwidthEstimator');
var VideoPlayerResourceTimer = require('VideoPlayerResourceTimer');
var ShakaSegmentReferenceHelper = require('ShakaSegmentReferenceHelper');
var SegmentRequestManager = require('SegmentRequestManager');
var concatArrayBuffer = require('concatArrayBuffer');
var BufferReplacementHelper = require('BufferReplacementHelper');
var logLongAkamaiRequest = require('logLongAkamaiRequest');
var throttle = require('throttle');
var ViewportPriorityAdjuster = require('ViewportPriorityAdjuster');
var FirstLoadedVideoPriorityAdjuster = require('FirstLoadedVideoPriorityAdjuster');
var VideoPriorityCalculator = require('VideoPriorityCalculator');
var VideoStreamingManager = require('VideoStreamingManager');
var MultipleSegmentsProvider = require('MultipleSegmentsProvider');
var LocalBitrateHelper = require('LocalBitrateHelper');
var UnitConstants = require('UnitConstants');
var BufferVelocity = require('BufferVelocity');
var VideoPlayerBitrateEstimator = require('VideoPlayerBitrateEstimator');
var VideoPlayerShakaGlobalConfig = require('VideoPlayerShakaGlobalConfig');
var getSeekRangeGapsFromShakaReferences = require('getSeekRangeGapsFromShakaReferences');
var maybeConvertHiveErrorToShakaNetError = require('maybeConvertHiveErrorToShakaNetError');
var mergeSeekRangeGaps = require('mergeSeekRangeGaps');
var NetworkStatusDetector = require('NetworkStatusDetector');
var MosUtils = require('MosUtils');
var ODS = require('ODS');
var VideoDashPrefetchCache = require('VideoDashPrefetchCache');
var VideoClientEdgeCooperation = require('VideoClientEdgeCooperation');
var VideoStreamingTaskQueueProvider = require('VideoStreamingTaskQueueProvider');
var BinarySearch = require('BinarySearch');
var ShakaTimelineSegmentIndexUtils = require('ShakaTimelineSegmentIndexUtils');
var gkx = require('gkx');

var setTimeout = require('setTimeoutAcrossTransitions');
var setInterval = require('setIntervalAcrossTransitions');
var setImmediate = require('setImmediateAcrossTransitions');
var clearTimeout = require('clearTimeout');
var clearInterval = require('clearInterval');
var clearImmediate = require('clearImmediate');
var dispatchDomEvent = require('dispatchEvent');
var eventListenerCapture = require('EventListener').capture;
var eventKill = require('Event').kill;
var extractCEA608 = require('extractCEA608');
var performanceNow = require('performanceNow');
var parseHeaders = require('parseHeaders');
var canUseFetchStream = require('canUseFetchStream');
var SubscriptionsHandler = require('SubscriptionsHandler');
var VideoPushTracker = require('VideoPushTracker');
var ShakaConstants = require('ShakaConstants');

function setEventProperty(obj, name, handler) {
  obj[name] = TimeSlice.guard(handler, 'shaka ' + name);
};

if (
  VideoPlayerShakaGlobalConfig.getBool('shaka_native_promise', false)
) {
  Promise = window.Promise;
}

var g = {};

(function(window){var n,aa=this;*

 Copyright 2015 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function ba(){};function ca(a){var b=console[a];b?b.bind||(console[a]=:console[a]=function(){}}ca("error");ca("warn");ca("info");ca("log");ca("debug");var t={ka:function(a){t.zb[a]={ka:t.pc(),end:NaN}},end:function(a){if(a=t.zb[a])a.end=t.pc()},Cd:function(a,b,c){var d=t.get(a),e=t.get(b);if(!d||!e)return NaN;d-=e;for(e=2;e<arguments.length;++e){var f=t.get(arguments[e]);if(!f)return NaN;d-=f}return d},get:function(a){return(a=t.zb[a])&&a.end?a.end-a.ka:NaN}};t.pc=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now;t.zb={};/*

 Copyright 2004-present Facebook. All Rights Reserved.

*/
function ea(a,b,c,d,e,f,g,h){this.id=a;this.bandwidth=b||0;this.lang=c||"unknown";this.streamInfoID=d;this.mimeType=e||"";this.codecs=f||"";this.channels=g||null;this.samplingRate=h||null;this.active=!1}q("shaka.player.AudioTrack.compare",;var fa=ShakaConstants.numbers.shaka_default_request_timeout_timescale,ga=Math.floor(ShakaConstants.numbers.shaka_default_ajax_request_timeout_ms/fa),ha=Math.floor(ShakaConstants.numbers.shaka_default_ajax_request_timeout_ms/fa),ja=Math.floor(ShakaConstants.numbers.shaka_default_ajax_request_timeout_ms/fa);a.prototype.clone=function la(){this.fontSize="100%";this.fontColor=na;this.fontOpacity=oa;this.backgroundColor=pa;this.backgroundOpacity=oa;this.fontEdge=qa}q("shaka.player.TextStyle",la);
function ra(a){var b=[];b.push("font-size: "+a.fontSize);b.push("color: "+sa(a.fontColor,a.fontOpacity));b.push("background-color: "+sa(a.backgroundColor,a.backgroundOpacity));for(var c=[],d=0;d<a.fontEdge.length;++d){var e=a.fontEdge[d].slice(3,6);c.push(sa(a.fontEdge[d].slice(0,3),a.fontOpacity)+" "+e.join("px ")+"px")}b.push("text-shadow: "+c.join(","));return b.join("; ")}ar na=[255,255,255],pa=[0,0,0];
la.StandardColors={WHITE:na,BLACK:pa,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var oa=1;la.StandardOpacities={OPAQUE:oa,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var qa=[];
la.EdgeStyles={NONE:qa,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};("shaka.player.TextTrack.compare",;function ua(a,b,c,d,e,f,g,h,k,l,m,p,u){this.id=a;this.bandwidth=b||0;this.width=c||0;this.height=d||0;this.streamInfoID=e;this.fbQualityLabel=f;this.fbQualityClass=g;a=[];h&&(a=h.split(","));this.frameRate=k||"";this.mimeType=l||"";this.codecs=m||"";this.isHVQ=-1<a.indexOf("hvq");this.isInlineHVQ=-1<a.indexOf("hvq_www_inline");this.avoidOnPoorConnection=-1<a.indexOf("avoid_on_poor_connection");this.active=!1;this.playbackResolutionMos=p||null;this.playbackResolutionMosConfidenceLevel=u||null}
function va(a,b){var c=a.width*a.height,d=b.width*b.height;return c<d?-1:c>d?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0}q("shaka.player.VideoTrack.compare",va);function wa(a){for(var b=xa,c=[],d=0;d<a.length;++d){for(var e=!1,f=0;f<c.length&&!(e=b?b(a[d],c[f]):a[d]===c[f]);++f);e||c.push(a[d])}return c};ar za=0;function Aa(a){this.b=a;this.c=0==Ba;this.a=0}var Ba=1;unction Da(a){var b=a.b.getUint8(a.a);a.a+=1;return b}function v(a){var b=a.b.getUint32(a.a,a.c);a.a+=4;return b}function Ea(a){var b,c;a.c?(b=a.b.getUint32(a.a,!0),c=a.b.getUint32(a.a+4,!0)):(c=a.b.getUint32(a.a,!1),b=a.b.getUint32(a.a+4,!1));if(2097151<c)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");a.a+=8;return c*Math.pow(2,32)+b}
function Fa(a){if(a.a+16>a.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var b=new Uint8Array(a.b.buffer,a.a,16);a.a+=16;return b}function Ga(a,b){if(a.a+b>a.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");a.a+=b};function Ha(a){this.b=a;this.a=new Aa(a);Ia||(Ia=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var Ia;
function Ja(a){var b;b=Ka(a);if(7<b.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var c=0,d=0;d<b.length;d++)c=256*c+b[d];b=c;c=Ka(a);a:{for(d=0;d<Ia.length;d++)if(La(c,Ia[d])){d=!0;break a}d=!1}if(d)c=a.b.byteLength-a.a.a;else{if(8==c.length&&c[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var d=c[0]&(1<<8-c.length)-1,e=1;e<c.length;e++)d=256*d+c[e];c=d}c=a.a.a+c<=a.b.byteLength?c:a.b.byteLength-a.a.a;d=new DataView(a.b.buffer,
a.b.byteOffset+a.a.a,c);Ga(a.a,c);return new Ma(b,d)}function Ka(a){var b=Da(a.a),c;for(c=1;8>=c&&!(b&1<<8-c);c++);if(8<c)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var d=new Uint8Array(c);d[0]=b;for(b=1;b<c;b++)d[b]=Da(a.a);return d}function Ma(a,b){this.id=a;this.a=b}
function Na(a){if(8<a.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==a.a.byteLength&&a.a.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var b=0,c=0;c<a.a.byteLength;c++)var d=a.a.getUint8(c),b=256*b+d;return b};var Oa={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};function w(a){this.b=Math.exp(Math.log(.5)/a);this.nb=this.Ra=this.a=0}q("shaka.util.EWMA",w);w.prototype.sample=function(a,b){var c=Math.pow(this.b,a);this.a=b*(1-c)+c*this.a;this.Ra+=a;this.nb+=1};w.prototype.sample=w.prototype.sample;w.prototype.c=function(){return this.Ra};w.prototype.getTotalWeight=w.prototype.c;w.prototype.getEstimate=w.prototype.getEstimate=w.prototype.getEstimate;w.prototype.f=
w.prototype.reset=w.prototype.f;var Pa=window.CustomEvent;"function"!==typeof Pa&&(Pa=Pa.prototype=window.Event.prototype);function x(a){var b=new Pa(a.type,{detail:a.detail,bubbles:!!a.bubbles}),c;for(c in a)c in b||(b[c]=a[c]);return b}function Qa(a,b,c){Ra(b);Ra(c);return c==b||a>=Sa&&c==b.split("-")[0]||a>=Ta&&c.split("-")[0]==b.split("-")[0]?!0:!1}var Sa=1,Ta=2;var Ua={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",
fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",
lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",
srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};unction A(a,b){return Wa(a,b,"boolean")}function B(a,b,c){a=Wa(a,b,"number");if(null==a)return null;if(isNaN(a)||a==Number.NEGATIVE_INFINITY||a==Number.POSITIVE_INFINITY)throw new RangeError("'"+b+"' must be finite.");if(null!=c&&a<c)throw new RangeError("'"+b+"' must be >= "+c);return a}function Wa(a,b,c){a=a[b];if(null==a)return null;if(typeof a!==c)throw new TypeError("'"+b+"' must be a "+c+".");return a}function Ya(a,b,c){a=a[b];if(null==a)return null;if(!(a instanceof c))throw new TypeError("'"+b+"' must be an instance of "+c.name+".");return a};.prototype.push=C.prototype.set=C.prototype.get=function $a(a){var b=[],c;for(c in a.a)b.push.apply(b,a.a[c]);return b}C.prototype.remove=function ab(a){var b=[],c;for(c in a.a)b.push(c);return b};b.prototype.destroy=function D(a,b,c,d){b=new db(b,c,d);a.a.push(c,b)}bb.prototype.Ka=function(a,b){for(var c=this.a.get(b)||[],d=0;d<c.length;++d){var e=c[d];e.target==a&&(e.Ka(),this.a.remove(b,e))}};function cb(a){for(var b=$a(a.a),c=0;c<b.length;++c)b[c].Ka();a.a.a={}}db.prototype.Ka=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)};("shaka.util.FakeEventTarget",E);n=E.prototype;n.addEventListener=function(a,b){this.tb.push(a,b)};n.removeEventListener=
n.dispatchEvent=function(a){a.hasOwnProperty("srcElement")||(delete a.srcElement,Object.defineProperty(a,"srcElement",{get:function(){return null}}));if(a.hasOwnProperty("target"))a.target=this;else{delete a.target;var b=this;Object.defineProperty(a,"target",{get:function(){return b},set:function(a){b=a}})}if(a.hasOwnProperty("currentTarget"))a.currentTarget=null;else{delete a.currentTarget;var c=null;Object.defineProperty(a,"currentTarget",{get:set:)}return eb(this,
a)};n.gc=!1;n.Ba=function(a,b){return this.dispatchEvent(x({type:"debug/dashPlayerEvent",bubbles:!0,detail:{type:a,event:b}}))};function eb(a,b){b.currentTarget=a;for(var c=a.tb.get(b.type)||[],d=0;d<c.length;++d){var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(a,b)}catch(f){}}a.za&&b.bubbles&&eb(a.za,b);return b.defaultPrevented};function F(a){E.call(this,null);this.a={cb:{Ma:new w(ShakaConstants.numbers.fast_moving_average_half_life),lb:new w(ShakaConstants.numbers.slow_moving_average_half_life)},Ta:{Ma:new w(VideoPlayerShakaGlobalConfig.getNumber("aggressive_fast_moving_average_half_life",1E-4)),lb:new w(VideoPlayerShakaGlobalConfig.getNumber("aggressive_slow_moving_average_half_life",9.2335087917745))}};this.j=VideoPlayerShakaGlobalConfig.getNumber("min_delay_ms",50);this.h=a||5E5;this.l=ShakaConstants.numbers.min_sample_count;
this.b=0;this.c=[];this.i=ShakaConstants.numbers.max_recent_bandwidth_samples}r(F,E);q("shaka.util.EWMABandwidthEstimator",F);F.prototype.shouldExcludeSample=
F.prototype.sample=function(a,b,c,d,e,f,g){if(this.shouldExcludeSample(b,c))e&&e.setEvent("unsampled").setReason("audio").log();else{if(VideoPlayerShakaGlobalConfig.getBool("use_resource_timing_entry_for_bandwidth",!0)){if(!d){e&&e.setEvent("unsampled").setReason("resource_timing_entry_missing").log();return}a=d.timeToLastByte;if(0>a){e&&e.setEvent("unsampled").setReason("resource_timing_entry_invalid").log();return}VideoPlayerShakaGlobalConfig.getBool("exclude_time_to_first_byte",!1)&&(c=d.timeToFirstByte,
0<c&&0<a-c&&(a=a-c))}a=Math.max(a,this.j);c=1E3*UnitConstants.BITS_IN_BYTE*b/a;var h=a/1E3;this.a.Ta.Ma.sample(h,c,d);this.a.Ta.lb.sample(h,c,d);this.a.cb.Ma.sample(h,c,d);this.a.cb.lb.sample(h,c,d);g||this.dispatchEvent(x({type:"bandwidth"}));this.b=Date.now();d=parseInt(a,10);if(0<this.i)for(this.c.push([b,d]);this.c.length>this.i;)this.c.shift();e&&e.setEvent("sampled").setBytes(b).setDelayMs(d).log();f&&f.getEventLogger("bandwidth_sampled").setLength(b).setClientTimeBegin(this.b-d).setClientTimeEnd(this.b).log()}};
F.prototype.getBandwidth=function(a){a="aggressive"===a?this.a.Ta:this.a.cb;return this.canTrustEstimate()?Math.min(a.Ma.getEstimate(),a.lb.getEstimate()):this.h};F.prototype.getFastMovingBandwidth=function(a){a="aggressive"===a?this.a.Ta:this.a.cb;return this.canTrustEstimate()?a.Ma.getEstimate():this.h};F.prototype.getDataAge=F.prototype.canTrustEstimate=function(a){var b=this.a.Ta.Ma;return b.Ra>=(void 0===a?.5:a)||b.nb>=this.l};
F.prototype.supportsCaching=function(){return!1};F.prototype.setRepresentationID=function(){};F.prototype.flushABREvaluationSet=function(){return[]};F.prototype.getRecentSamples=function(){return this.c};/*

 Copyright 2015 Facebook Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function fb(a,b,c,d){F.call(this,d);this.g=a||0;this.f=void 0===b?Infinity:b;this.m=c}r(fb,F);q("shaka.util.EWMACacheBandwidthEstimator",fb);
fb.prototype.sample=function(a,b,c,d,e,f,g,h){var k=8E3*b/a;e&&e.setBytes(b).setDelayMs(parseInt(a,10));a<=this.g&&k>this.f&&!h?(e&&e.setEvent("unsampled").setReason("cached").log(),f&&!this.shouldExcludeSample(b,c)&&f.getEventLogger("bandwidth_sampled").setResult("aborted").setLength(b).setClientTimeBegin(Date.now()-parseInt(a,10)).setClientTimeEnd(Date.now()).log(),this.m()):F.prototype.sample.call(this,a,b,c,d,e,f,g)};fb.prototype.supportsCaching=function(){return Infinity!==this.f&&!!this.g};
fb.prototype.setRepresentationID=function(){};fb.prototype.flushABREvaluationSet=(gb,F);q("shaka.util.EWMASignedURLBandwidthEstimator",gb);gb.prototype.supportsCaching=function(){return!0};function H(){var a,b,c=new Promise(;c.resolve=a;c.reject=b;c.destroy=H.prototype.destroy;return c}H.prototype.destroy=function(){this.catch(function(){});var a=Error("Destroyed!");a.type="destroy";this.reject(a)};function hb(a){a.split("").reduce(function(a,c,d){return a+(d&&0==d%4?" "+c:c)})};function ib(){this.mb=new H;this.c=!1;this.sa=null;this.a=[];this.b=null}function jb(a,b){if(a.c)throw Error("Cannot append to a running task!");a.a.push(b)}ib.prototype.start=function(){if(this.c)throw Error("Task already started!");this.c=!0;this.a.unshift(function(){});kb(this,void 0)};ib.prototype.abort=function(){if(this.sa)return this.sa;if(!this.c)return this.c=!0,Promise.resolve();this.b&&(this.f=this.b());return this.sa=new H};ib.prototype.end=
function kb(a,b){var c=a.a[0](b),d;c?(d=c[0],a.b=c[1]):(d=Promise.resolve(),a.b=null);d.then(I(a,function(a){this.sa?(this.a=[],this.b=null,lb(this)):(this.a.shift(),this.a.length?kb(this,a):(this.mb.resolve(a),this.b=null))})).catch(I(a,function(a){this.a=[];this.b=null;this.sa?lb(this):this.mb.reject(a)}))}
function lb(a){function b(){var a=Error("Task aborted.");a.type="aborted";this.mb.reject(a);setTimeout(function(){this.sa.resolve();this.sa=null}.bind(this),5)}a.f?a.f.then(bind(a)):b.call(a)};function I(a,b){return b.bind(a)};function mb(a,b,c,d,e,f,g){MediaSource.isTypeSupported(c);E.call(this,e);e=b.addSourceBuffer(c);this.S=a;this.v=b;this.b=e;this.F=d;this.w=new bb;this.C=this.a=this.R=this.i=null;this.J=!1;this.I=this.G=this.H=0;this.B=null;this.N=this.A=!1;this.T=f;this.V=g?g:null;this.c=[];this.M=0;this.l=this.g=this.f=null;this.L=ja;this.m=this.o=0;this.s=this.K=!1;this.h=c&&c.charAt(0);D(this.w,this.b,"updateend",this.fd.bind(this));D(this.w,this.b,"error",this.Uc.bind(this));this.j=null}r(mb,E);
mb.prototype.ta=function(){return{SourceBuffer:this.b}};function nb(a,b,c){a.gc&&a.Ba(b,{type:a.h.charAt(0),segment:c,sourceBuffer:a.b})}var ob=1/60;mb.prototype.destroy=function(){this.abort().catch(function(){});this.g&&this.g.destroy();this.c=this.f=this.g=null;this.w.destroy();this.v=this.b=this.w=null};function pb(a){var b=a.c.length;return 0<b?a.c[b-1]:null}
function qb(a,b){for(var c=a.b.buffered,d=0;d<c.length;++d){var e=c.start(d)-ob,f=c.end(d)+ob;if(b>=e&&b<=f)return c.end(d)-b}return 0}function rb(a,b,c){var d=b.endTime?b.endTime-b.startTime:1,e=new sb;e.Wa=3;e.c=1E3*d;e.b=1E3*a.L;e.s=a.R;e.j=c;e.l=a.T;e.mimeType=a.h;e.h=a.V;e.o=b.isPredictive;return e}n=mb.prototype;
n.fetch=function(a,b,c,d,e,f,g,h){var k,l=f?"replacing_lower_quality_buffer":null;if(this.a){f=this.c[this.c.length-1];var m=null;f&&(m=1E3*(a.startTime-f.endTime));k=this.a.getOperationLogger("fetch").setReason(l).setResource(tb(a.url)).setType(ub(this)).setLength(Math.round(1E3*(a.endTime-a.startTime))).setSegmentStartTime(1E3*a.startTime).setSegmentEndTime(1E3*a.endTime).setSegmentTimeGap(m).start()}this.j=k;if(this.f)return g=Error("Cannot fetch ("+this.h+"): previous operation not complete."),
this.o>=this.H?(g.type="stream",k&&k.setError(g).log(),this.o=0):(this.o++,g.type="aborted"),Promise.reject(g);this.f=new ib;c!=this.b.timestampOffset&&(this.b.timestampOffset=c);c=rb(this,a,e);e=this.S.getBool("enable_streaming_code_path",!0);var p;p=e?a.url.stream(c,this.F,this.a,this.j,this.C,ub(this),l,g,h):a.url.fetch(c,this.F,this.a,this.j,this.C,ub(this),l,g);nb(this,"SegmentFetching",a);var u=J.prototype.Aa.bind(a.url);this.B&&this.A&&(d=this.B);var y=0,G=null;d&&(this.B=d,this.A=!1,jb(this.f,
function(){return[d.then(function(a){a.Pa>y&&(y=a.Pa);return vb(this,a,null)}.bind(this)),this.Sa.bind(this)]}.bind(this)));var V=function(a){a.Pa>y&&(y=a.Pa);G=a.byteLength;this.F.getBandwidth();this.K&&this.dispatchEvent(x({type:"cea608CaptionsBytesReceived",bubbles:!0,detail:{timescale:b,videoBytes:a}}))}.bind(this);e?(h&&(g=h.getProgressTracker(),this.i!==g&&(this.i=g)),jb(this.f,I(this,function(){var b=null,c=Math.max(0,(a.url.endByte||0)-a.url.startByte),d=ShakaConstants.numbers.streaming_append_per_segment,
e=0===d?0:c/d;return[p.then(function(c){b=c;this.s=!1;return wb(this,c,a,e)}.bind(this)).then(.then(V).catch(function(a){h&&(this.b.abort(),this.s=!0);return Promise.reject(a)}.bind(this)),function(){nb(this,"SegmentFailed",a);b&&(b.cancel("abort"),b=null,h&&(this.b.abort(),this.s=!0));u();return this.Sa()}.bind(this)]}))):jb(this.f,I(this,function(){return[p.then(function(b){nb(this,"SegmentFetched",a);V(b);return vb(this,b,a,l)}.bind(this)),function(){nb(this,"SegmentFailed",
a);u();return this.Sa()}.bind(this)]}));var ia=0==this.b.buffered.length&&0==this.c.length,da=null;jb(this.f,function(){if(0==this.b.buffered.length&&!this.N){var b=Error("Failed to buffer segment ("+this.h+").");b.type="stream";return[Promise.reject(b)]}this.b.buffered.length&&ia&&(b=a.startTime,da=this.b.buffered.start(0)-b);b=xb(this.c,a.startTime);0<=b?this.c.splice(b+1,0,a):this.c.push(a)}.bind(this));this.o=0;return yb(this).then(function(){k&&k.log();return Promise.resolve({U:da,Pc:y,D:a.endTime-
a.startTime,wc:G})}.bind(this),function(a){k&&k.setError(a).log();a=zb(a,"task","An unknown task error occurred.");return Promise.reject(a)}.bind(this))};
function wb(a,b,c,d){var e=new ArrayBuffer(0),f=new ArrayBuffer(0),g=function(){return b.read().then(function(a){var b=a.value;a=a.done;if(this.s||a&&0===f.byteLength)return e;if(!a&&!b)return g();b&&(b instanceof Uint8Array&&(b=b.buffer),f=concatArrayBuffer(f,b));return f.byteLength>=d||a?(this.i&&this.i.notifyBytesConsumed(f.byteLength),nb(this,"SegmentFetched",c),e=concatArrayBuffer(e,f),b=f,f=new ArrayBuffer(0),vb(this,b,c).then(g)):g()}.bind(this))}.bind(a);return g()}
function Ab(a){if(a.f){var b=Error("Cannot clear ("+a.h+"): previous operation not complete.");a.m>=a.G?(b.type="stream",a.m=0):(a.m++,b.type="aborted");return Promise.reject(b)}a.f=new ib;jb(a.f,function(){var a;a:if(0==this.b.buffered.length)a=Promise.resolve();else{try{this.b.remove(0,this.v.duration)}catch(b){b=zb(b,"clear_buffer","An error occured when clearing the buffer.");a=Promise.reject(b);break a}this.c=[];a=this.g=new H}return[a,this.Sa.bind(this)]}.bind(a));a.m=0;return yb(a)}
function Bb(a,b){if(a.f){var c=Error("Cannot clearAfter ("+a.h+"): previous operation not complete.");c.type="stream";return Promise.reject(c)}a.f=new ib;jb(a.f,function(){return[Cb(this,b),this.Sa.bind(this)]}.bind(a));return yb(a)}n.abort=function Db(a){for(var b=a.currentTime,c=b,d=0;d<a.buffered.length;d++)if(b<=a.buffered.start(d)){c=a.buffered.start(d);break}return c}
function Eb(a,b){for(var c=b.currentTime,d=0;d<b.buffered.length;d++)if(c>=b.buffered.start(d)&&c<=b.buffered.end(d)-a.I)return!1;return!0}function yb(a){a.f.start();return a.f.mb.then(I(a,).catch(I(a,function(a){this.f=null;a=zb(a,"task","An unknown task error occurred.");return Promise.reject(a)}))}
function vb(a,b,c,d){var e;if(a.a){var f=c?tb(c.url):"init";e=a.a.getOperationLogger("append").setReason(d).setResource(f).setType(ub(a)).setLength(b.byteLength).start();null!==c&&(e=e.setSegmentStartTime(1E3*c.startTime).setSegmentEndTime(1E3*c.endTime));a.j&&(e=e.setParentLogger(a.j))}try{a.b.appendBuffer(b)}catch(g){return g instanceof DOMException&&g.code===DOMException.QUOTA_EXCEEDED_ERR&&g.message.match(/^.*SourceBuffer.*full.*free\sspace.*$/)&&(g.type="sourcebuffer_full"),e&&e.setError(g).log(),
Promise.reject(g)}a.g=new H;a.l=c;return a.g.then(function(){e&&e.log()},function(a){e&&e.setError(a).log();return Promise.reject(a)})}n.Uc=function(a){a=a.error||Error("Call to appendBuffer failed to append the segment.");a=zb(a,"stream","Call to appendBuffer failed to append the segment.");this.g&&this.g.reject(a)};
function Cb(a,b){if(0==a.b.buffered.length)return Promise.resolve();var c=xb(a.c,b);if(-1==c||c==a.c.length-1)return Promise.resolve();try{a.b.remove(a.c[c+1].startTime,a.v.duration)}catch(d){return Promise.reject(d)}a.c=a.c.slice(0,c+1);a.g=new H;return a.g}n.Sa=function(){if(this.g){if("open"==this.v.readyState){var a=Error("Previous operation aborted.");a.type="aborted";this.g.reject(a);this.b.abort();this.J&&(this.A=!0);this.g=new H}return this.g}return Promise.resolve()};
n.fd=function(){this.g&&(this.l&&(nb(this,"SegmentAppended",this.l),this.l=null),this.g.resolve(),this.g=null)};n.vd=function(){return this.i};mb.prototype.getStreamProgressTracker=mb.prototype.vd;function ub(a){return"v"===a.h.charAt(0)?"video":"a"===a.h.charAt(0)?"audio":null}function zb(a,b,c){a||(a=Error(c));a.type||(a.type=b);a.message||(a.message=c);return a};("shaka.util.Uint8ArrayUtils.toString",Fb);("shaka.util.Uint8ArrayUtils.fromString",Gb);q("shaka.util.Uint8ArrayUtils.toBase64",function(a,b){var c=void 0==b?!0:b,d=window.btoa(Fb(a)).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")});q("shaka.util.Uint8ArrayUtils.fromBase64",Hb);q("shaka.util.Uint8ArrayUtils.fromHex",;("shaka.util.Uint8ArrayUtils.toHex",Ib);function Jb(){this.i=this.a="";this.withCredentials=!1;this.m=this.f=null;this.j=this.h=!1;this.l=this.g="";this.c=null;this.b=[]}function Kb(a,b){var c=new Jb;c.a=a.a;c.i=a.i;c.withCredentials=a.withCredentials;c.f=a.f;c.m=a.m;c.h=a.h;c.j=a.j;c.g=a.g;c.l=a.l;c.c=a.c?new Uint8Array(a.c.buffer):null;Lb(c,a.b);Lb(c,b.b);return c}function Lb(a,b){var c=a.b.concat(b.map(function(a){return{initData:new Uint8Array(a.initData.buffer),initDataType:a.initDataType}}));a.b=wa(c)}
function Mb(a,b,c,d){this.withCredentials=c;this.a=[];d&&this.a.push(d)}q("shaka.player.DrmSchemeInfo",Mb);Mb.DistinctiveIdentifier={OPTIONAL:0,REQUIRED:1};Mb.PersistentState={OPTIONAL:0,REQUIRED:1};Mb.createUnencrypted=function(){return new Mb(0,0,!1,null)};function Nb(a){this.systemIds=[];this.cencKeyIds=[];this.a=[];a=new Aa(new DataView(a.buffer));try{for(;Ca(a);){var b=a.a,c=v(a),d=v(a);1==c?c=Ea(a):0==c&&(c=a.b.byteLength-b);if(1886614376!=d)Ga(a,c-(a.a-b));else{var e=Da(a);if(1<e)Ga(a,c-(a.a-b));else{Ga(a,3);var f=Ib(Fa(a)),g=[];if(0<e)for(var h=v(a),k=0;k<h;++k){var l=Ib(Fa(a));g.push(l)}var m=v(a);Ga(a,m);this.cencKeyIds.push.apply(this.cencKeyIds,g);this.systemIds.push(f);this.a.push({start:b,end:a.a-1});a.a!=b+c&&Ga(a,c-(a.a-b))}}}}catch(p){}}
;var Ob=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;=K.prototype;n.ra="";n.La="";n.$="";n.Oa=null;n.la="";n.Ca="";
n.toString=
n.resolve=function(a){var b=this.clone();"data"===b.ra&&(b=new K);var c=!!a.ra;c?Pb(b,a.ra):c=!!a.La;c?b.La=a.La:c=!!a.$;c?b.$=a.$:c=null!=a.Oa;var d=a.la;if(c)Qb(b,a.Oa);else if(c=!!a.la){if("/"!=d.charAt(0))if(this.$&&!this.la)d="/"+d;else{var e=b.la.lastIndexOf("/");-1!=e&&(d=b.la.substr(0,e+1)+d)}if(".."==d||"."==d)d="";else if(-1!=d.indexOf("./")||-1!=d.indexOf("/.")){for(var e=0==d.lastIndexOf("/",0),d=d.split("/"),f=[],g=0;g<d.length;){var h=d[g++];"."==h?e&&g==d.length&&f.push(""):".."==h?
((1<f.length||1==f.length&&""!=f[0])&&f.pop(),e&&g==d.length&&f.push("")):(f.push(h),e=!0)}d=f.join("/")}}c?b.la=d:c=""!==a.a.toString();c?Rb(b,a.a.clone()):c=!!a.Ca;c&&(b.Ca=a.Ca);return b};n.clone=b=/[#\/\?@]/g,Xb=/[\#\?:]/g,Wb=/[\#\?]/g,Zb=/[\#\?@]/g,Yb=/#/g;b.prototype.a=null;Tb.prototype.c=null;
function ac(a,b,c){if(!a.a&&(a.a={},a.c=0,a.b))for(var d=a.b.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),g=null,h=null;0<=f?(g=d[e].substring(0,f),h=d[e].substring(f+1)):g=d[e];g=decodeURIComponent(g.replace(/\+/g," "));h=h||"";ac(a,g,decodeURIComponent(h.replace(/\+/g," ")))}a.b=null;(d=a.a.hasOwnProperty(b)&&a.a[b])||(a.a[b]=d=[]);d.push(c);a.c++}
Tb.prototype.toString=Tb.prototype.clone=function bc(a,b,c){var d=a.indexOf("<?xml");0<=d&&(a=a.substr(d));a=(new DOMParser).parseFromString(a,"text/xml");if(!a)return null;"string"===typeof b&&(b=[new K(b)]);b=b||[new K("")];c=c||[new K("")];return L({tc:b,baseUrl:c},a,cc)}q("shaka.dash.mpd.parseMpd",bc);
function cc(){this.id=this.url=null;this.type="static";this.FBIsLiveTemplated=this.FBWasLive=this.manifestIsLiveStreaming=!1;this.FBManifestIdentifier="";this.FBMS=!1;this.o=this.baseUrl=this.tc=null;this.j=this.i=this.h=0;this.b=null;this.l=5;this.f=this.c=this.g=null;this.m=1;this.lastVideoFrameTs=this.currentServerTimeMs=0;this.a=[]}function dc(){this.f=this.c=this.b=this.baseUrl=this.duration=this.start=this.id=null;this.a=[]}
function ec(){this.c=this.codecs=this.mimeType=this.height=this.width=this.contentType=this.lang=this.group=this.id=null;this.f=!1;this.i=this.h=this.g=this.baseUrl=null;this.j=[];this.a=[];this.b=null}function fc(){this.value=null}function gc(){this.lang=this.a=null}function ic(){this.a=this.b=this.f=this.g=this.baseUrl=this.h=this.frameRate=this.l=this.j=this.i=this.fbQualityClass=this.fbQualityLabel=this.codecs=this.mimeType=this.height=this.width=this.bandwidth=this.lang=this.id=null;this.c=[]}function jc(){this.value=this.a=null}jc.prototype.clone=jc.prototype.parse=function(a,b){this.a=M(b,"schemeIdUri",N,this.a);this.value=M(b,"value",N,this.value)};
function kc(){this.b=this.a=this.f=this.c=null}function lc(){this.parsedPssh=this.psshBox=null}function mc(){this.url=null}unction oc(){this.baseUrl=null;this.a=1;this.f=this.c=this.g=this.b=this.h=null}oc.prototype.clone=function(){var a=new oc;a.baseUrl=pc(this.baseUrl);a.a=this.a;a.h=this.h;a.b=O(this.b);a.g=O(this.g);a.c=O(this.c);a.f=O(this.f);return a};function qc(){this.a=this.url=null}
qc.prototype.clone=function(){var a=new qc;a.url=pc(this.url);a.a=O(this.a);return a};function rc(){this.a=this.url=null}rc.prototype.clone=function(){var a=new rc;a.url=pc(this.url);a.a=O(this.a);return a};function sc(){this.baseUrl=null;this.a=1;this.D=this.f=null;this.h=0;this.g=null;this.b=[];this.c=null}sc.prototype.clone=function(){var a=new sc;a.baseUrl=pc(this.baseUrl);a.a=this.a;a.f=this.f;a.D=this.D;a.h=this.h;a.g=O(this.g);a.b=pc(this.b)||[];a.c=O(this.c);return a};
c.prototype.clone=function(){var a=new tc;a.b=pc(this.b);a.a=O(this.a);return a};function uc(){this.a=1;this.D=this.f=null;this.i=0;this.b=this.g=this.c=this.h=null}uc.prototype.clone=function(){var a=new uc;a.a=this.a;a.f=this.f;a.D=this.D;a.i=this.i;a.h=this.h;a.c=this.c;a.g=this.g;a.b=O(this.b);return a};c.prototype.clone=function(){var a=new vc;a.b=this.b;a.c=this.c;a.a=pc(this.a)||[];return a};
c.prototype.clone=c.prototype.clone=cc.TAG_NAME="MPD";dc.TAG_NAME="Period";ec.TAG_NAME="AdaptationSet";fc.TAG_NAME="Role";gc.TAG_NAME="Accessibility";hc.TAG_NAME="ContentComponent";ic.TAG_NAME="Representation";kc.TAG_NAME="ContentProtection";
lc.TAG_NAME="cenc:pssh";mc.TAG_NAME="BaseURL";jc.TAG_NAME="AudioChannelConfiguration";nc.TAG_NAME="Location";oc.TAG_NAME="SegmentBase";qc.TAG_NAME="RepresentationIndex";rc.TAG_NAME="Initialization";sc.TAG_NAME="SegmentList";tc.TAG_NAME="SegmentURL";uc.TAG_NAME="SegmentTemplate";vc.TAG_NAME="SegmentTimeline";wc.TAG_NAME="S";
cc.prototype.parse=function(a,b){this.url=a.tc;this.id=M(b,"id",N);this.type=M(b,"type",N)||"static";this.manifestIsLiveStreaming="dynamic"===this.type;this.FBWasLive=M(b,"FBWasLive",yc)||!1;this.FBIsLiveTemplated=M(b,"FBIsLiveTemplated",yc)||!1;this.FBManifestIdentifier=M(b,"FBManifestIdentifier",N)||"";this.FBMS=M(b,"FBMS",yc)||!1;this.b=M(b,"mediaPresentationDuration",zc);this.l=M(b,"minBufferTime",zc,this.l);this.g=M(b,"minimumUpdatePeriod",zc,this.g);this.c=M(b,"availabilityStartTime",Ac,this.c);
this.f=M(b,"timeShiftBufferDepth",zc,this.f);this.currentServerTimeMs=M(b,"currentServerTimeMs",P);M(b,"firstAvTimeMs",P);this.lastVideoFrameTs=M(b,"lastVideoFrameTs",P);this.f=null;this.m=M(b,"suggestedPresentationDelay",zc,this.m);this.h=M(b,"loapStreamType",Bc,this.h);this.i=M(b,"usingASRCaptions",Bc,this.i);this.j=M(b,"isUsingAsrCaptionsEmployeeDogfooding",Bc,this.j);var c=a.baseUrl,d=Cc(this,b,mc);this.baseUrl=Dc(c,d);if(d=L(this,b,nc))this.o=Fc(c,d.url);this.a=Cc(this,b,dc)};
function Gc(a,b,c,d){if(0!==a.a.length){var e=new ec;e.contentType="text";e.lang=c||"en";e.f=!0;c=new ic;c.bandwidth=0;c.mimeType=d||"text/vtt";c.baseUrl=[new K(b)];e.a.push(c);a.a[0].a.push(e);Hc(a.a[0])}}dc.prototype.parse=function(a,b){this.id=M(b,"id",N);this.start=M(b,"start",zc);this.duration=M(b,"duration",zc);var c=Cc(this,b,mc);this.baseUrl=Dc(a.baseUrl,c);this.b=L(this,b,oc);this.c=L(this,b,sc);this.f=L(this,b,uc);this.a=Cc(this,b,ec);Hc(this)};
function Hc(a){for(var b=[],c=0;c<a.a.length;++c){var d=a.a[c];null!=d.group&&(b[d.group]=!0)}for(c=0;c<a.a.length;++c)if(d=a.a[c],null==d.group){for(var e=1;1==b[e];)++e;b[e]=!0;d.group=e}}
ec.prototype.parse=function(a,b){var c=L(this,b,hc)||{},d=L(this,b,fc);this.id=M(b,"id",N);this.group=M(b,"group",P);this.lang=M(b,"lang",N,c.lang);this.contentType=M(b,"contentType",N,c.contentType);this.width=M(b,"width",Q);this.height=M(b,"height",Q);this.mimeType=M(b,"mimeType",N);this.codecs=M(b,"codecs",N);this.c=M(b,"FBProjection",N);this.f=d&&"main"==d.value;this.lang&&(this.lang=Ra(this.lang));c=Cc(this,b,mc);this.baseUrl=Dc(a.baseUrl,c);this.j=Cc(this,b,kc);!this.contentType&&this.mimeType&&
(this.contentType=this.mimeType.split("/")[0]);this.g=a.b?Ic(this,b,a.b):L(this,b,oc);this.h=a.c?Ic(this,b,a.c):L(this,b,sc);this.i=a.f?Ic(this,b,a.f):L(this,b,uc);this.a=Cc(this,b,ic);this.b=L(this,b,gc);!this.mimeType&&this.a.length&&(this.mimeType=this.a[0].mimeType,!this.contentType&&this.mimeType&&(this.contentType=this.mimeType.split("/")[0]))};fc.prototype.parse=function(a,b){this.value=M(b,"value",N)};gc.prototype.parse=function(a,b){this.a=M(b,"schemeIdUri",N);this.lang=M(b,"lang",N)};
hc.prototype.parse=function(a,b){this.id=M(b,"id",N);this.lang=M(b,"lang",N);this.contentType=M(b,"contentType",N);this.lang&&(this.lang=Ra(this.lang))};
ic.prototype.parse=function(a,b){this.id=M(b,"id",N);this.bandwidth=M(b,"bandwidth",Q);this.width=M(b,"width",Q,a.width);this.height=M(b,"height",Q,a.height);this.mimeType=M(b,"mimeType",N,a.mimeType);this.codecs=M(b,"codecs",N,a.codecs);this.fbQualityLabel=M(b,"FBQualityLabel",N);this.fbQualityClass=M(b,"FBQualityClass",N);this.i=M(b,"FBAbrPolicyTags",N);this.j=M(b,"FBPlaybackResolutionMos",MosUtils.parsePlaybackMos);this.l=M(b,"FBPlaybackResolutionMosConfidenceLevel",N);VideoPlayerShakaGlobalConfig.getBool("mpd_parse_frame_and_audio_sampling_rate",
!1)&&(this.frameRate=M(b,"frameRate",N),this.h=M(b,"audioSamplingRate",Q));this.lang=a.lang;var c=Cc(this,b,mc);this.baseUrl=Dc(a.baseUrl,c);this.c=Cc(this,b,kc);this.g=L(this,b,jc);this.f=a.g?Ic(this,b,a.g):L(this,b,oc);this.b=a.h?Ic(this,b,a.h):L(this,b,sc);this.a=a.i?Ic(this,b,a.i):L(this,b,uc);this.c=this.c.concat(a.j)};kc.prototype.parse=function(a,b){this.c=b;this.f=M(b,"schemeIdUri",N);var c=M(b,"cenc:default_KID",N);c&&(this.b=c.replace(/[-]/g,""));this.a=L(this,b,lc)};
lc.prototype.parse=function(a,b){var c=Jc(b);if(c){this.psshBox=Hb(c);try{this.parsedPssh=new Nb(this.psshBox)}catch(d){if(!(d instanceof RangeError))throw d;}}};mc.prototype.parse=function(a,b){var c=b.childNodes,d="";if(1==c.length)d=Jc(b);else for(var e=0;e<c.length;e++)c[e].nodeType==Node.TEXT_NODE&&(d+=c[e].nodeValue);this.url=d};nc.prototype.parse=
oc.prototype.parse=function(a,b){this.baseUrl=a.baseUrl||this.baseUrl;this.a=M(b,"timescale",Q,this.a);this.h=M(b,"presentationTimeOffset",P,this.h);this.b=M(b,"indexRange",Kc,this.b);this.g=M(b,"FBFirstSegmentRange",Kc,this.g);this.c=L(this,b,qc)||this.c;this.f=L(this,b,rc)||this.f};qc.prototype.parse=function(a,b){var c=M(b,"sourceURL",N);this.url=Fc(a.baseUrl,c);this.a=M(b,"range",Kc,O(a.b))};
rc.prototype.parse=function(a,b){var c=M(b,"sourceURL",N);this.url=Fc(a.baseUrl,c);this.a=M(b,"range",Kc)};sc.prototype.parse=function(a,b){this.baseUrl=a.baseUrl||this.baseUrl;this.a=M(b,"timescale",Q,this.a);this.f=M(b,"presentationTimeOffset",P,this.f);this.D=M(b,"duration",Q,this.D);var c=M(b,"startNumber",Q);null!=c&&(this.h=c);this.g=L(this,b,rc)||this.g;this.b=(c=Cc(this,b,tc))&&0<c.length?c:this.b;this.c=L(this,b,vc)||this.c};
tc.prototype.parse=function(a,b){var c=M(b,"media",N);this.b=Fc(a.baseUrl,c);this.a=M(b,"mediaRange",Kc)};uc.prototype.parse=function(a,b){this.a=M(b,"timescale",Q,this.a);this.f=M(b,"presentationTimeOffset",P,this.f);this.D=M(b,"duration",Q,this.D);var c=M(b,"startNumber",P);null!=c&&(this.i=c);this.h=M(b,"media",N,this.h);this.c=M(b,"index",N,this.c);this.g=M(b,"initialization",N,this.g);this.b=L(this,b,vc)||this.b};
vc.prototype.parse=function(a,b){this.b=M(b,"FBPredictedMedia",N,this.b);this.c=M(b,"FBPredictedMediaEndNumber",Q);this.a=Cc(this,b,wc)};wc.prototype.parse=function(a,b){this.startTime=M(b,"t",P);this.duration=M(b,"d",P);this.repeat=M(b,"r",Bc)};function Dc(a,b){if(!b||0===b.length)return a;for(var c=[],d=0;d<b.length;d++){var e=b[d].url;null==a||0===a.length?c.push(new K(e)):(e=Fc(a.slice(0,1),e),c.push(e[0]))}return c}
function Fc(a,b){if(!b)return a;var c=new K(b);return a?a.map(function(a){return a.resolve(c)}):[c]}function Ic(a,b,c){var d=O(c);(b=Lc(b,c.constructor.TAG_NAME))&&d.parse(a,b);return d}function L(a,b,c){var d=null;if(b=Lc(b,c.TAG_NAME))d=new c,d.parse(a,b);return d}function Lc(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(a.childNodes[d].tagName==b){if(c)return null;c=a.childNodes[d]}return c}
function Cc(a,b,c){for(var d=[],e=0;e<b.childNodes.length;e++)if(b.childNodes[e].tagName==c.TAG_NAME){var f=new c;f.parse.call(f,a,b.childNodes[e]);d.push(f)}return d}function Jc(a){a=a.firstChild;return a.nodeType!=Node.TEXT_NODE?null:a.nodeValue}function pc(a){return a?a.map(function(a){return a.clone()}):null}unction M(a,b,c,d){a=a.hasAttribute(b)?c(a.getAttribute(b)):null;return null!=a?a:void 0!==d?d:null}
function Ac(a){if(!a)return null;a=Date.parse(a);return isNaN(a)?null:Math.floor(a/1E3)}function zc(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);if(!b)return null;a=0;var c=P(b[1]);c&&(a+=31536E3*c);(c=P(b[2]))&&(a+=2592E3*c);(c=P(b[3]))&&(a+=86400*c);(c=P(b[4]))&&(a+=3600*c);(c=P(b[5]))&&(a+=60*c);b=window.parseFloat(b[6]);(b=isNaN(b)?null:b)&&(a+=b);return a}
function Kc(a){var b=/([0-9]+)-([0-9]+)/.exec(a);if(!b)return null;a=P(b[1]);if(null==a)return null;b=P(b[2]);return null==b?null:new xc(a,b)}function Bc(a){a=window.parseInt(a,10);return isNaN(a)?null:a}function Q(a){a=window.parseInt(a,10);return 0<a?a:null}function P(a){a=window.parseInt(a,10);return 0<=a?a:null}function yc(a){switch(a.toLowerCase()){case "true":return!0;case "false":return!1;default:return null}}function Mc(a,b){this.url=a;this.c=b||new sb;this.i=-1;this.j=this.h=0;this.b=null;this.f=new H;this.g=null;this.m=this.c.i;this.a=this.c.m}q("shaka.util.AjaxRequest",Mc);
function sb(){this.body=null;this.Wa=1;this.c=1E3;this.b=0;this.method="GET";this.responseType="arraybuffer";this.Ha={};this.g=this.withCredentials=!1;this.l=this.a=this.s=null;this.j=!1;this.h=this.m=this.i=this.mimeType=null;this.o=!1;this.v=/(.*)\.(xx|fna)\.fbcdn\.net/;this.f=/livestream-lookaside\.(facebook|workplace)\.com$/}var Nc=!0;
function Oc(a){Pc(a);a.b&&(a.b.onload=null,a.b.onreadystatechange=null,a.b.onerror=null,a.b.ontimeout=null);a.b=null;a.c.body=null;a.f.destroy();a.f=null;a.g=null}function Pc(a){-1!==a.i&&(clearTimeout(a.i),a.i=-1)}
Mc.prototype.l=function(){if(this.b)return this.f;if(0==this.url.lastIndexOf("data:",0)){var a=this.url.split(":")[1].split(";").pop().split(","),b=a.pop(),b="base64"==a.pop()?window.atob(b.replace(/-/g,"+").replace(/_/g,"/")):window.decodeURIComponent(b);"arraybuffer"==this.c.responseType&&(b=Gb(b).buffer);a=JSON.parse(JSON.stringify(new XMLHttpRequest));a.response=b;a.responseText=b.toString();b=this.f;b.resolve(a);Oc(this);return b}if(0==this.url.lastIndexOf("idb:",0))return this.o();this.h=performanceNow();
this.j||(this.j=this.c.c);this.b=new XMLHttpRequest;var c=this.url,a=new K(c);Nc&&(this.g&&!this.g.supportsCaching()||this.c.g)&&ac(a.a,"_",Date.now());c=this.c.v.test(c);if(null!=this.c.a&&c){var d=this.c.a,e=a.a;null!=d.a&&(d.h=d.a.getSegmentsToPush(),d.f=d.a.getSegmentStartTime(),d.g=d.a.getSegmentOffset(),d.c=d.a.getPushVideoRepresentationID(),d.b=d.a.getPushAudioRepresentationID(),d.j=d.a.getUseLongCacheForManifest());null!=d.h&&ac(e,"_nc_p_n",d.h);null!=d.f?ac(e,"_nc_p_ts",d.f):null!=d.g&&ac(e,
"_nc_p_o",d.g);null!=d.c&&null!=d.b&&(ac(e,"_nc_p_rid",d.c),ac(e,"_nc_p_arid",d.b));d.i&&ac(e,"_nc_p_dbg","1");d.j&&ac(e,"_nc_nc","1")}1==this.c.j&&c&&ac(a.a,"_nc_playing",1);this.c.o&&ac(a.a,"_nc_sc",1);c=a.toString();a=this.c.f.test(a.$);this.b.open(this.c.method,c,!0);this.b.responseType=this.c.responseType;this.b.timeout=this.c.b;this.b.withCredentials=this.c.withCredentials||a;setEventProperty(this.b,"onload",this.Zc.bind(this));setEventProperty(this.b,"onreadystatechange",this.dd.bind(this));
setEventProperty(this.b,"onerror",this.Xc.bind(this));setEventProperty(this.b,"ontimeout",this.jd.bind(this));setEventProperty(this.b,"onabort",this.Tc.bind(this));for(b in this.c.Ha)this.b.setRequestHeader(b,this.c.Ha[b]);this.b.send(this.c.body);return this.f};Mc.prototype.send=Mc.prototype.l;function Qc(a,b,c){b=Error(b);b.type=c;b.status=a.b.status;b.url=a.url;b.responseHeaders=parseHeaders(a.b.getAllResponseHeaders());b.method=a.c.method;b.body=a.c.body;return b}n=Mc.prototype;
n.abort=function(){Pc(this);this.b&&this.b.readyState!=XMLHttpRequest.DONE&&this.b.abort()};n.Tc=function(){var a=Qc(this,"Request aborted.","aborted");this.f.reject(a);Oc(this)};
n.Zc=function(a){if(this.g){var b=VideoPlayerResourceTimer.getResourceTimingEntry(this.url,this.h,performanceNow());this.g.sample(performanceNow()-this.h,a.loaded||this.b.response&&this.b.response.byteLength||0,this.c.mimeType?"v"===this.c.mimeType.charAt(0):!1,b,this.m,this.a,VideoPlayerShakaGlobalConfig.getBool("evaluate_abr_on_fetch_end",!1))}200<=this.b.status&&299>=this.b.status?null!=parseHeaders(this.b.getAllResponseHeaders())["x-fb-video-replica"]?(a=Qc(this,"HTTP error.","net"),this.f.reject(a)):
this.f.resolve(this.b):(a=Qc(this,"HTTP error.","net"),this.f.reject(a));Oc(this)};n.dd=function(){if(this.b.readyState==XMLHttpRequest.HEADERS_RECEIVED&&(this.b.Pa=Date.now()-this.h,this.c.a&&this.c.l&&this.c.l.addPushDataFromXHR(this.b),this.c.h&&this.c.h.handleXHR(this.b),VideoClientEdgeCooperation.updateFromXHR(this.b),this.c.g)){var a=Date.parse(this.b.getResponseHeader("Date"));a&&(za=a-Date.now())}};n.Xc=function(){var a=Qc(this,"Network failure.","net");this.f.reject(a);Oc(this)};
n.jd=function(){var a=Qc(this,"Request timed out.","net");this.f.reject(a);Oc(this)};function J(a,b,c,d,e,f){this.c=b;this.startByte=c||0;this.baseUrl=this.toString();this.endByte=null!=d?d:null;this.isPredictive=e||!1;this.f=null;this.l=0;this.v=!1;this.Fc=this.g=null;this.m=a;this.i=null;this.j=this.o=!1;this.b=this.a=null;this.h=f||null}q("shaka.util.FailoverUri",J);J.prototype.s=function(a){this.v=a};J.prototype.setShouldReadXFbVideoBroadcastEndedHeader=J.prototype.s;J.prototype.A=function(){return this.l};J.prototype.getFbVideoBroadcastEndedResponseHeader=J.prototype.A;
J.prototype.B=function(){return this.startByte};J.prototype.getStartByte=J.prototype.B;J.prototype.w=function(){return this.endByte};J.prototype.getEndByte=J.prototype.w;function Rc(a,b){return a&&0!==a.length?a.map(:[b]}n=J.prototype;n.fetch=function(a,b,c,d,e,f,g,h){return this.f?this.f:this.f=Sc(this,0,a||new sb,b,c,d,e,f,g,h)};n.stream=function(a,b,c,d,e,f,g,h,k){return Tc(this,0,a||new sb,b,c,d,e,f,g,h,k)};
function Sc(a,b,c,d,e,f,g,h,k,l){return Tc(a,b,c,d,e,f,g,h,k,l).then(function(a){var b,c=function(){return a.read().then(function(a){var d=a.value;if(a.done)return b||new ArrayBuffer(0);d&&("string"===typeof d?b=(b||"")+d:b=concatArrayBuffer(b||new ArrayBuffer(0),d));return c()}.bind(this))}.bind(this);return c()})}n.Aa=function(){this.g&&(this.a=this.f=null,this.g.abort(),this.i=this.g=null);this.Fc&&(this.C.abort(),this.C=null);this.b&&(this.b.abortRequest(Uc(this)),this.b=null)};
function Tc(a,b,c,d,e,f,g,h,k,l,m){a.b=l||null;var p;e&&(c.a&&(c.a.i=!0),l=0,c.l&&(l=c.l.getPushCountForUrl(a.c[b].toString())),(p=e.getOperationLogger("request"))&&p.setReason(k||null).setPushed(l).setType(h||null).setInitiator("shaka").start(),f&&(p=p.setParentLogger(f)));var u=performanceNow();a.a=null;g&&(c.i=g);e&&(c.m=e);var y=Vc(a,a.c[b],c);k=null;a.j=!1;var G=VideoDashPrefetchCache.getCacheValue(y);G&&(k=G,a.j=!0,p&&(p.setConnectionQualityLevel(VideoDashPrefetchCache.getConnectionQualityLevel(y)),
p.setInitiator("prefetch")));if(!G&&m)return m.getStream(Uc(a)).then(function(a){return a.getReader()}.bind(a));m=null;if(a.b&&!a.b.isDisabled()&&!k)try{(k=m=a.b.getPromise(Uc(a)))?p=null:a.b.disable()}catch(V){e&&e.getEventLogger("request_info_not_found").setResource(y).log()}!k&&a.h&&a.h.createPromise&&(m=new K(y),m=c.f.test(m.$),k=a.h.createPromise({url:y,responseType:c.responseType,Ed:c.c,Ad:2,Wa:c.Wa,withCredentials:c.withCredentials||m,Ha:c.Ha},function(a){this.Fc=a;var b=performanceNow();a.onload=
function(f){if(d){var h=VideoPlayerResourceTimer.getResourceTimingEntry(y,b,performanceNow());d.sample(performanceNow()-b,f.loaded||a.response&&a.response.byteLength||0,c.mimeType?"v"===c.mimeType.charAt(0):!1,h,g,e,VideoPlayerShakaGlobalConfig.getBool("evaluate_abr_on_fetch_end",!1))}}}));k||(a.g=new Mc(y,c),a.l=0,d&&(a.g.g=d),k=a.g.l());p&&p.setResource(y);f&&f.setResource(y);var ia=!1,da=k.then(I(a,function(a){var c=this.h?this.h.onRequestSend:null;!c||"video"!=h&&"audio"!=h&&"manifest"!=h||c(!0,
h,a.response.byteLength);!this.b||this.b.isDisabled()||this.a?this.a||(this.a=VideoPlayerResourceTimer.getResourceTimingEntry(y,this.j?0:u,performanceNow())):this.a=this.b.getResourceTimingEntry(y);if(this.v)try{this.l=parseInt(a.getResponseHeader("x-fb-video-broadcast-ended"),10)}catch(d){}this.b=this.i=this.g=this.f=null;a.a?(this.i=new K(a.a),this.o=!0):this.i=this.c[b];a.response.Pa=a.Pa;p&&(p=p.setLength(a.response.byteLength||a.response.length).setWasPrefetchCacheHit(this.j),null!=this.a&&(p=
p.setTimeToLastByte(Math.round(this.a.timeToLastByte)).setTimeToFirstByte(Math.round(this.a.timeToFirstByte)).setTimeToRequestStart(Math.round(this.a.timeToRequestStart)),2E3<=this.a.timeToFirstByte&&-1<y.indexOf("akamaihd")&&logLongAkamaiRequest(a.getResponseHeader("Debug-Info")+", TTFB-> "+this.a.timeToFirstByte+", TTRS-> "+this.a.timeToRequestStart)),p.log());return G&&"FETCH"===a.initiator?a.response.arrayBuffer().then(:Promise.resolve({value:a.response,done:!1})})),
da=da.catch(I(a,function(a){var e=this.h?this.h.onRequestSend:null;e&&e(!1,h,0);if(this.f&&b+1<this.c.length)return this.f=Sc(this,b+1,c,d);this.b=this.a=this.f=this.g=null;p&&p.setError(a).log();return Promise.reject(a)}));return Promise.resolve({cancel:function(){},read:function(){return ia?Promise.resolve({value:null,done:!0}):da.then(}.bind(a)})}function Uc(a){return{baseUrl:a.toString(),isPredictive:a.isPredictive,startByte:a.startByte,endByte:a.endByte}}
n.clone=function(){return new J(this.m,this.c.map(function(a){return a.clone()}),this.startByte,this.endByte,this.isPredictive,this.h)};n.getResourceTimingEntry=function(){return this.a};
function Vc(a,b,c){var d=b.toString();if(a.startByte||a.endByte)b=b.$,!b.endsWith("fbcdn.net")||b.startsWith("interncache")||b.endsWith("ak.fbcdn.net")?c&&(c.Ha.Range="bytes="+(a.startByte+"-"+(null!=a.endByte?a.endByte:""))):(d+="&bytestart="+a.startByte,d+=null!==a.endByte?"&byteend="+a.endByte:"");a.m&&c&&(d=a.m(d,c.Ha)||d);return d}function tb(a){return Vc(a,a.c[0])}n.toString=function Wc(a,b,c,d){this.a=new sb;b=null!=b?b:ha;this.a.responseType="text";this.a.Wa=3;this.a.b=1E3*b;c&&(this.a.a=c);d&&(this.a.l=d);this.a.g=!0;this.a.withCredentials=this.a.f.test(a);this.b=a}
function Xc(a,b){var c=a.b;c.s(!0);return c.fetch(a.a,null,b,null,null,"manifest").then(function(a){a instanceof ArrayBuffer&&(a=String.fromCharCode.apply(null,new Uint8Array(a)));var e=!!c.l,f;b&&(f=b.getOperationLogger("parse_manifest").start());a=bc(a,c.c,[c.i]);f&&f.log();a&&"dynamic"===a.type&&e&&(a.type="static",b&&ODS.bumpEntityKey(2966,"videos.www.shaka","changed_manifest_to_dynamic_off_headers"));if(a)return Promise.resolve(a);e=Error("MPD parse failure.");e.type="dash";return Promise.reject(e)})}
function Yc(a){this.a=null;this.h=a;this.c=this.g=this.f=null;this.i=!1;this.j=this.b=null};c.prototype.destroy=Zc.prototype.create=function(a,b){var c=null;b&&(c=new sb,c.l=b);return!this.b&&this.a?this.a.fetch(c,null,a,null,null,"init"):Promise.resolve(this.b)};Zc.prototype.c=function(){return this.a};Zc.prototype.getFailoverUri=Zc.prototype.c;function $c(a,b){this.segmentOriginalEndTime=a;this.gapDistance=b}function ad(a,b,c,d,e,f,g){this.startTime=a;this.endTime=b;this.url=c;this.unscaledStartTime=d;this.unscaledDuration=e;this.timescaledGapInfo=f||null;this.isPredictive=g||!1;this.debugInfo=this.timescaledGapInfo?{endTime:this.timescaledGapInfo.segmentOriginalEndTime,delta:this.timescaledGapInfo.gapDistance}:null}function bd(a,b,c){return new ad(b,c,a.url,a.unscaledStartTime,a.unscaledDuration,a.timescaledGapInfo,a.isPredictive)}
function xb(a,b){for(var c=a.length-1;0<=c;--c){var d=a[c];if(b>=d.startTime&&(null==d.endTime||b<d.endTime))return c}return-1}function cd(a,b){return a.map(function(a){return bd(a,a.startTime+b,null!=a.endTime?a.endTime+b:null)})};function dd(a,b,c,d){for(var e=b.a,f=[],g=0;g<d;++g){var h=g+c,k=(h-1)*e.D,l=k/e.a,m=(k+e.D)/e.a,h=ed(a,b,e.i+h-1,k);if(!h)return null;f.push(new ad(l,m,h,k,e.D||0))}return f}function ed(a,b,c,d,e,f){if(!b.a)return null;e=e||!1;var g=b.a.h,h=b.a.b.b;if(!g)return b.baseUrl?new J(a,b.baseUrl,0,null,void 0,f):null;c=fd(e&&h?h:g,b.id,c,b.bandwidth,d);if(!c)return null;b=Rc(b.baseUrl,c);return new J(a,b,0,null,e,f)}
function fd(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};a=a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(a,b,c){if("$$"==a)return"$";var d=f[b];if(null==d)return a;"RepresentationID"==b&&c&&(c=void 0);a=d.toString();c=window.parseInt(c,10)||1;c=Math.max(0,c-a.length);return Array(c+1).join("0")+a});try{return new K(a)}catch(g){if(g instanceof URIError)return null;throw g;}}
function gd(a,b,c,d){var e=0,f=c*b;c=a.a;var g=d||0;d=[];var h=ShakaConstants.numbers.live_rewind_templated_last_x_segments_only;if(h){for(var k=0;k<c.length;++k){if(!c[k].duration)return d;var l=c[k].startTime,l=null!=l?l:e,m=c[k].repeat||0;if(0>m)if(m=c[k].duration,k+1===c.length)var p=c[0].startTime+f-l,m=Math.ceil(p/m)-1;else p=c[k+1].startTime,m=Math.ceil((p-l)/m)-1;c[k].startTime=l;c[k].repeat=m;e=c[k].startTime+c[k].duration*(c[k].repeat+1)}for(k=c.length-1;-1<k;--k)for(var u=0;u<=c[k].repeat;++u)if(l=
c[k].startTime+c[k].duration*(c[k].repeat-u),e=l+c[k].duration,a=null,d.length&&e!=d[d.length-1].start&&(p=d[d.length-1].start-e,a=new $c(e/b,p/b),e=d[d.length-1].start),d.push({start:l,end:e}),a&&(d[d.length-1].timescaledGapInfo=a),h&&d.length===h)return d=d.reverse();return d.reverse()}for(k=0;k<c.length;++k){if(!c[k].duration)return d;l=c[k].startTime;l=null!=l?l:e;m=c[k].repeat||0;0>m&&(m=c[k].duration,k+1===c.length?(p=c[0].startTime+f-l,m=Math.ceil(p/m)-1):(p=c[k+1].startTime,m=Math.ceil((p-
l)/m)-1));0<d.length&&l!=e&&(p=l-e,h=d[d.length-1],h.timescaledGapInfo=new $c(e/b,p/b),h.end=l);for(u=0;u<=m;++u)e=l+c[k].duration,d.push({start:l,end:e}),l=e}if(a.b&&0<c.length)for(b=c[0].duration,c=0;c<g;c++)d.push({start:l+c*b,end:l+(c+1)*b,nd:a.c+c});return d};function hd(a,b,c,d,e){this.j=a;this.i=b;this.f=c;this.U=0;this.a=c.a||0;this.l=!1;this.g=null;this.m=d;this.h=c.f||0;this.c=0;a:{b=c.b;var f=0;a=(a.duration||0)*this.a;c=b.a;for(d=0;d<c.length;++d){if(!c[d].duration){b.a=c.slice(0,d);break a}var g=c[d].startTime,f=null!=g?g:f,g=c[d].repeat||0;0>g&&(g=c[d].duration,g=d+1===c.length?Math.ceil((c[0].startTime+a-f)/g)-1:Math.ceil((c[d+1].startTime-f)/g)-1);c[d].startTime=f;c[d].repeat=g;f=c[d].startTime+c[d].duration*(c[d].repeat+1)}}this.c=ShakaTimelineSegmentIndexUtils.length(this.f.b.a);
this.o=e||null}hd.prototype.destroy=function(){this.c=this.f=this.i=this.j=null;this.g=function(){};this.m=null};hd.prototype.length=function(){return this.c};
function id(a,b,c){var d=[],e=-a.h/a.a+a.U;ShakaTimelineSegmentIndexUtils.getSegments(b,c,a.f.b.a,function(a,b,c,k,l){if(k){var m=d[d.length-1];m&&(m.timescaledGapInfo=new $c(l/this.a,k/this.a),m.debugInfo={endTime:m.timescaledGapInfo.segmentOriginalEndTime,delta:m.timescaledGapInfo.gapDistance},d[d.length-1]=bd(m,m.startTime,a/this.a+e))}c=ed(this.m,this.i,c+this.f.i,a,void 0,this.o);if(!c)throw a=Error("Failed to generate media URL."),a.type="dash",a;a=new ad(a/this.a+e,b/this.a+e,c,a,b-a,null);
d.push(a)}.bind(a));return d}hd.prototype.getSegments=function(){return id(this,0,this.c)||[]};hd.prototype.first=function(){if(!this.c)throw new RangeError("Index out of range.");return id(this,0,1)[0]};hd.prototype.last=function(){if(!this.c)throw new RangeError("Index out of range.");return id(this,this.c-1,this.c)[0]};hd.prototype.get=function(a){if(!this.c||0>a||a>=this.c)throw new RangeError("Index out of range.");return id(this,a,a+1)[0]};
hd.prototype.find=function(a){a=this.findIndex(a);return 0<=a?id(this,a,a+1)[0]:null};hd.prototype.findIndex=function(a){return ShakaTimelineSegmentIndexUtils.findIndex(a,this.f.b.a,this.a,-this.h/this.a+this.U)};n=hd.prototype;
n.Ja=function(a){var b=a.length(),c=b-this.c;if(0!==b&&(b!==this.c||0!==this.c&&a.last().endTime!==this.last().endTime)){this.l=!1;b=a.last();null!=b.endTime&&b.endTime<this.last().endTime&&b.endTime<this.first().startTime&&(this.l=!0);this.j=a.j;this.i=a.i;this.f=a.f;this.h=this.f.f||0;this.a=this.f.a||0;this.c=ShakaTimelineSegmentIndexUtils.length(this.f.b.a);this.first();this.last();a=[];c=this.c-c;for(0<c&&c--;c<this.c;++c)a.push(this.get(c));this.g&&this.g(a)}};
n.Za=function(a){var b=a-this.U;if(0==b)return 0;this.U=a;return b};n.$a=function(){return this.c?{start:this.first().startTime,end:this.last().endTime}:{start:0,end:0}};n.getSeekRangeGaps=function(){return ShakaTimelineSegmentIndexUtils.getSeekRangeGaps(this.f.b.a,this.a,-this.h/this.a+this.U)};n.fb=function(){return this.l};n.yc=function(a){this.g=a};n.xc=function(){this.g=null};n.ya=function(){};function jd(){}
jd.prototype.parse=function(a,b,c,d,e){var f=null;try{a:{var g=[],h=new Aa(a),k=v(h);if(1936286840!=v(h))f=null;else{1==k&&(k=Ea(h));var l=Da(h);Ga(h,3);Ga(h,4);var m=v(h);if(0==m)f=null;else{var p,u;0==l?(p=v(h),u=v(h)):(p=Ea(h),u=Ea(h));Ga(h,2);var y=h.b.getUint16(h.a,h.c);h.a+=2;a=p;b=b+k+u;for(u=k=0;u<y;u++){var G=v(h);p=(G&2147483648)>>>31;var l=G&2147483647,V=v(h);v(h);if(1==p){f=null;break a}var ia;ia=0==u&&e?e:new J(d,c,b,b+l-1);p=a/m;var da=(a+V)/m;0===u&&(k=p);g.push(new ad(p-k,da-k,ia,
a,V));a+=V;b+=l}g.a=m;f=g}}}}catch(Za){if(!(Za instanceof RangeError))throw Za;}return f};function R(a){this.b=a;this.a=this.b.a;this.h=[]}R.prototype.H=R.prototype.lastPollHadChanges=R.prototype.H;R.prototype.G=function(){var a=this.h,b=a.lastIndexOf(!0);if(1>b)return 0;a=a.lastIndexOf(!0,b-1);return 0>a?0:b-a-1};R.prototype.getFetchesBetweenRecentChanges=R.prototype.G;R.prototype.s=function(){return Math.floor((this.h.length-1-this.h.lastIndexOf(!0))/2)};R.prototype.getConsecutiveUpdatesWithoutChanges=R.prototype.s;
R.prototype.F=function(){return this.h.length-1-this.h.lastIndexOf(!1)};R.prototype.getConsecutiveUpdatesWithChanges=R.prototype.F;R.prototype.destroy=function(){this.b.destroy();this.b=null};R.prototype.length=function(){return this.b.length()};R.prototype.getSegments=function(){return this.b.getSegments()};R.prototype.getSegments=R.prototype.getSegments;R.prototype.first=function(){return this.b.first()};R.prototype.last=function(){return this.b.last()};R.prototype.last=R.prototype.last;
R.prototype.get=function(a){return this.b.get(a)};R.prototype.find=function(a){return this.b.find(a)};R.prototype.findIndex=function(a){return this.b.findIndex(a)};R.prototype.A=R.prototype.Qa=R.prototype.w=function(){return this.b.$a()};R.prototype.getSeekRangeGaps=function(){return this.b.getSeekRangeGaps()};R.prototype.getSeekRangeGaps=R.prototype.getSeekRangeGaps;R.prototype.fb=
function S(a,b,c,d){R.call(this,a);this.j=b;this.C=c;this.i=d;this.duration=this.j.b||this.j.a.reduce(function(a,b){return null==b.duration?NaN:a+b.duration},0)||0;this.c=this.o=this.g=null;od(this)}r(S,R);S.prototype.destroy=function(){this.C=this.j=null;R.prototype.destroy.call(this)};S.prototype.find=function(a){pd(this,ya()/1E3);return R.prototype.find.call(this,a)};
S.prototype.A=function(a){if(!(a instanceof S))return!1;this.b.Ja(a.b);this.duration=Math.max(this.duration,a.duration);null==this.g?(this.i=a.i,od(this)):qd(this);return!0};function od(a){qd(a);if(0!=a.length()){a.length();var b=null!=a.last().endTime?a.last().endTime:a.last().startTime;if(a.j.c>a.i)a.g=b;else{var c=a.i-(a.j.c+a.C.start);0>c?a.g=b:c<Math.max(a.last().startTime,a.last().endTime||0)?(a.last(),a.g=b):a.g=c}a.o=a.last().startTime;a.c=a.first().startTime}}
S.prototype.Qa=function(a){a=R.prototype.Qa.call(this,a);null!=this.g&&(this.o+=a,this.c+=a,this.g+=a);return a};S.prototype.w=function(){return rd(this,ya()/1E3)};
function rd(a,b){pd(a,b);if(null==a.g||null==a.o||null==a.c)return{start:0,end:0};var c=Number.POSITIVE_INFINITY;a.duration&&(c=a.duration);var d=b-a.i,e=a.g+d;null!=a.j.f&&(e=e-a.c-a.j.f,0<e&&(a.c+=e));a.c=Math.min(a.c,c);d=a.o+d;if(d<a.c)return{start:a.c,end:a.c};d=0<a.length()?null!=a.last().endTime?Math.min(d,a.last().endTime):d:a.c;d=Math.max(d,a.c);d=Math.min(d,c);return{start:a.c,end:d}}
function pd(a,b){if(a.b.b&&(qd(a),null!=a.j.f))if(null==a.g)a.length();else{for(var c=a.g+(b-a.i),d=0,e=0;e<a.b.b.length;++e){var f=null;e<a.b.b.length-1?f=a.b.b[e+1].endTime:(f=a.b.b[e],f=null!=f.endTime?f.endTime+(f.endTime-f.startTime):null);if(null!=f&&f<c-a.j.f)++d;else break}0<d&&a.b.b.splice(0,d)}}function qd(a){if(a.duration&&a.b.b){for(var b=0,c=a.b.b.length-1;0<=c;--c)if(a.b.b[c].startTime>a.duration)++b;else break;0<b&&a.b.b.splice(-b)}};function T(a,b){var c=ShakaConstants.numbers.templated_quarantine_idle_references_threshold;this.m=[];if(0<c){var d=a;a=d.splice(-c);this.m=d}this.b=a;this.U=0;this.a=b;this.l=!1;this.h=function(){}}T.prototype.destroy=function(){this.b=null};T.prototype.length=function(){return this.b.length};T.prototype.getSegments=T.prototype.getSegments=T.prototype.getSegments;
T.prototype.first=function(){if(0==this.b.length)throw new RangeError("SegmentIndexBase: There is no first SegmentReference.");return this.b[0]};T.prototype.last=function(){if(0==this.b.length)throw new RangeError("SegmentIndexBase: There is no last SegmentReference.");return this.b[this.b.length-1]};T.prototype.last=T.prototype.last;T.prototype.get=
T.prototype.find=function(a){a=this.findIndex(a);return 0<=a?this.b[a]:null};T.prototype.findIndex=
T.prototype.Ja=function(a){this.U!=a.U&&(a=new T(cd(a.b,this.U-a.U),a.a));if(0==this.length())this.b=a.b.slice(0),this.ya();else if(0!=a.length()&&null!=this.last().endTime)if(null!=a.last().endTime&&a.last().endTime<this.last().endTime)a.last().endTime<this.first().startTime&&(this.l=!0);else{this.l=!1;if(this.last().endTime<=a.first().startTime){var b=bd(this.last(),this.last().startTime,a.first().startTime);this.last();this.last();b=this.b.slice(0,-1).concat([b])}else{var c;for(c=0;c<this.b.length&&
!(this.b[c].endTime>=a.first().startTime);++c);this.b[c].startTime<a.first().startTime?(b=bd(this.b[c],this.b[c].startTime,a.first().startTime),b=this.b.slice(0,c).concat([b])):(this.first().startTime>a.first().startTime||a.first(),b=this.b.slice(0,c))}this.b=b.concat(a.b);this.h(a.b);this.ya()}};T.prototype.Za=function(a){var b=a-this.U;if(0==b)return 0;this.b=cd(this.b,b);this.ya();this.U=a;return b};
T.prototype.$a=function(){return 0<this.length()?{start:this.first().startTime,end:this.last().endTime}:{start:0,end:0}};T.prototype.getSeekRangeGaps=T.prototype.getSeekRangeGaps=T.prototype.getSeekRangeGaps;T.prototype.fb=function(){return this.l};T.prototype.yc=function(a){this.h=a};T.prototype.xc=T.prototype.ya=function(){};T.prototype.getIdleReferences=function(){return this.m};function sd(a,b,c,d,e){var f=1,g=0,h;if(a.c>d)h=null;else{var k=a.m||0,l=a.f||0;h=c.a;h=h.D/h.a;var m=d-(a.c+b.start);0>m?h=null:(l=m-2*h-l,0>l&&(l=0),l=Math.ceil(l/h)*h,m-=h,0>m?h=null:(k=Math.floor(m/h)*h-k,0>k&&(k=0),k=Math.floor(k/h)*h,h={mc:l/h+1,current:(k>=l?k:l)/h+1}))}h&&(f=h.mc,g=h.current-h.mc+1);f=dd(e,c,f,g);if(null==f)throw a=Error("Failed to generate SegmentReferences."),a.type="stream",a;f=new T(f,c.a.a||1);S.call(this,f,a,b,d);this.v=c;this.m=this.f=0<this.length()?a.c+b.start+this.last().endTime:
null;this.l=h?h.current+1:null;this.B=e}r(sd,S);sd.prototype.destroy=sd.prototype.find=function(a){var b=ya()/1E3;td(this,b);pd(this,b);return R.prototype.find.call(this,a)};sd.prototype.A=function(a){if(null!=this.f||!(a instanceof sd)||null==a.f)return!1;this.f=a.f;this.m=a.m;this.l=a.l;this.i=a.i;this.duration=a.duration;this.b.Ja(a.b);td(this,ya()/1E3);od(this);return!0};
sd.prototype.Qa=function(a){a=S.prototype.Qa.call(this,a);null!=this.f&&(this.f+=a,this.m+=a);return a};sd.prototype.w=function(){var a=ya()/1E3;td(this,a);return rd(this,a)};function td(a,b){if(null!=a.f&&null!=a.m&&null!=a.l){var c=a.v.a,c=c.D/c.a,d=Math.floor((a.m+(b-a.i)-a.f)/c);if(0!=d){var e=dd(a.B,a.v,a.l,d);Array.prototype.push.apply(a.b.b,cd(e,a.b.U));a.b.ya();a.f+=d*c;a.l+=d}}};function ud(a,b,c,d,e){this.g=a;this.f=b;this.b=c;this.i=d;this.a=null;this.h=e}ud.prototype.destroy=function(){this.h=this.b=this.f=this.g=null;this.a&&(this.a.destroy(),this.a=null)};
ud.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.g.type)try{this.a=new sd(this.g,this.f,this.b,this.i,this.h)}catch(a){return Promise.reject(a)}else{var b;b=this.b.a;if(b=dd(this.h,this.b,1,Math.ceil(this.f.duration/(b.D/b.a)))){if(0<b.length){var c=b[b.length-1];b[b.length-1]=bd(c,c.startTime,this.f.duration)}b=new T(b,this.b.a.a||1);b=new R(b)}else b=null;this.a=b;if(!this.a)return b=Error("Failed to generate SegmentReferences"),b.type="stream",Promise.reject(b)}return Promise.resolve(this.a)};
ud.prototype.c=function(){return this.a};function vd(a,b,c,d,e,f){this.f=a;this.b=b;this.h=c;this.a=null;this.i=d;this.g=e;this.j=f||null}vd.prototype.destroy=function(){this.g=this.h=this.b=this.f=null;this.a&&(this.a.destroy(),this.a=null)};
vd.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=this.h.b,b=[];a.c&&(b=gd(a.c,a.a||1,this.b.duration||0));var c=0;a.D&&a.h?c=(a.h-1)*a.D:0<b.length&&(c=b[0].start-(a.f||0));var d=c,e=a.b.length;0<b.length&&b.length!=a.b.length&&(e=Math.min(b.length,a.b.length));for(var f=[],g=0;g<e;++g){var h=a.b[g],k=c,l=k/a.a,m=c=null,p;a.D?(c=k+a.D,m=c/a.a):0<b.length?(p=b[g].timescaledGapInfo,c=b[g].end-(a.f||0),m=c/a.a):(m=l+this.b.duration,c=m*a.a);var u=0,y=null;h.a&&(u=h.a.ka,
y=h.a.end);m=Math.min(this.b.duration+d/a.a,m);f.push(new ad(l,m,new J(this.g,h.b,u,y,void 0,this.j),k,p||null))}a=new T(f,a.a||1);"dynamic"==this.f.type?this.a=new S(a,this.f,this.b,this.i):this.a=new R(a);return Promise.resolve(this.a)};vd.prototype.c=function(){return this.a};function wd(a,b,c){T.call(this,a,c);this.g=b;this.c=!1;this.o=ShakaConstants.strings.templated_perf_test_methods_under_test_csv_string.split(",")}r(wd,T);function xd(a,b){if(!(-1<a.o.indexOf("all")||-1<a.o.indexOf(b))||a.c)return null;var c=a.b;a.b=a.g;a.c=!0;return c}function yd(a,b){a.c&&(a.g=a.b,a.b=b)}wd.prototype.destroy=
wd.prototype.length=function(){var a=xd(this,"length"),b=T.prototype.length.call(this);a&&(yd(this,a),b=T.prototype.length.call(this),this.c=!1);return b};wd.prototype.getSegments=function(){var a=xd(this,"getSegments"),b=T.prototype.getSegments.call(this);a&&(yd(this,a),b=T.prototype.getSegments.call(this),this.c=!1);return b};wd.prototype.first=function(){var a=xd(this,"first"),b=T.prototype.first.call(this);a&&(yd(this,a),b=T.prototype.first.call(this),this.c=!1);return b};
wd.prototype.last=function(){var a=xd(this,"last"),b=T.prototype.last.call(this);a&&(yd(this,a),b=T.prototype.last.call(this),this.c=!1);return b};wd.prototype.get=function(a){var b=xd(this,"get"),c;c=b?T.prototype.get.call(this,a+(this.b.length-b.length)):T.prototype.get.call(this,a);b&&(yd(this,b),c=T.prototype.get.call(this,a),this.c=!1);return c};wd.prototype.find=function(a){var b=xd(this,"find"),c=T.prototype.find.call(this,a);b&&(yd(this,b),c=T.prototype.find.call(this,a),this.c=!1);return c};
wd.prototype.findIndex=function(a){var b=xd(this,"findIndex"),c=T.prototype.findIndex.call(this,a);b&&(yd(this,b),c=T.prototype.findIndex.call(this,a),this.c=!1);return c};n=wd.prototype;n.Ja=function(a){var b=xd(this,"merge"),c=T.prototype.Ja.call(this,a);b&&(yd(this,b),c=T.prototype.Ja.call(this,a),this.c=!1);return c};n.Za=function(a){var b=xd(this,"correct"),c=T.prototype.Za.call(this,a);b&&(yd(this,b),c=T.prototype.Za.call(this,a),this.c=!1);return c};
n.$a=function(){var a=xd(this,"getSeekRange"),b=T.prototype.$a.call(this);a&&(yd(this,a),b=T.prototype.$a.call(this),this.c=!1);return b};n.getSeekRangeGaps=function(){var a=xd(this,"getSeekRangeGaps"),b=T.prototype.getSeekRangeGaps.call(this);a&&(yd(this,a),b=T.prototype.getSeekRangeGaps.call(this),this.c=!1);return b};n.ya=function(){var a=xd(this,"assertCorrectReferences");T.prototype.ya.call(this);a&&(yd(this,a),T.prototype.ya.call(this),this.c=!1)};function zd(a,b,c,d,e,f,g,h){this.j=a;this.b=b;this.g=c;this.f=d;this.l=e;this.a=null;this.h=f;this.i=h||null}zd.prototype.destroy=function(){this.h=this.f=this.g=this.b=null;this.a&&(this.a.destroy(),this.a=null)};
zd.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if(this.b.FBIsLiveTemplated||this.b.FBWasLive)var a=new hd(this.g,this.f,this.f.a,this.h,this.i);else{for(var a=this.f.a,b=gd(a.b,a.a||1,this.g.duration||0,this.j.getNumber("num_predictive_segments",0)),c=[],d=0;d<b.length;++d){var e=b[d].start,f=b[d].end,g=b[d].nd||0,h=b[d].timescaledGapInfo,k=e/a.a,l=f/a.a,m=d+a.i,p=e,m=ed(this.h,this.f,0<g?g:m,p,0<g?!0:!1,this.i);if(!m)return a=Error("Failed to generate media URL."),a.type=
"dash",Promise.reject(a);var u=(a.f||0)/a.a;c.push(new ad(k-u,l-u,m,p,f-e,h||null,0<g))}ShakaConstants.numbers.templated_use_perf_test_segment_index_base_int&&this.b.FBIsLiveTemplated?(b=c,c=b.slice(-ShakaConstants.numbers.templated_use_perf_test_segment_index_base_int),a=new wd(c,b,a.a||1)):a=new T(c,a.a||1)}this.b.manifestIsLiveStreaming?this.a=new S(a,this.b,this.g,this.l):this.a=new R(a);return Promise.resolve(this.a)};zd.prototype.c=function(){return this.a};function Ad(){this.P=Bd++;this.id=this.X=this.O=null;this.a=0;this.height=this.width=this.bandwidth=null;this.codecs=this.mimeType="";this.f=this.fbQualityClass=this.fbQualityLabel=null;this.frameRate="";this.switchReason=this.h=this.g=this.c=null;this.b=[];this.ia=!1;this.W=!0}var Bd=0;Ad.prototype.destroy=function Dd(a){var b=a.mimeType||"";a.codecs&&(b+='; codecs="'+a.codecs+'"');return b}function Ed(){this.P=Fd++;this.id=null;this.contentType=this.lang="";this.f=this.b=!1;this.c=null;this.u=[];this.a=[]}var Fd=0;Ed.prototype.destroy=function(){for(var a=0;a<this.u.length;++a)this.u[a].destroy();this.a=this.u=null};function Gd(a){for(var b=[],c=0;c<a.a.length;++c){var d=new Hd;d.id=a.P;d.a=a.a[c];d.contentType=a.contentType;d.b=a.u.length?Dd(a.u[0]):"";b.push(d)}return b}
d.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Jd(){this.w=this.h=this.b=!1;this.m=this.l=this.v=0;this.j=this.g=this.c=null;this.f=0;this.a=[];this.i=!1;this.s="none";this.o=null}Jd.prototype.destroy=function U(a,b,c,d,e,f,g,h,k,l,m,p,u,y){E.call(this,a);this.c=b;this.w=c;this.b=new mb(c,d,e,f,this,h,y);this.Ea=h;this.m={};this.ga=f;this.pa=0;this.ca=this.g=this.f=null;this.ha=!1;this.A=this.S=null;this.L=!1;this.V=0;this.Z=!1;this.I=null;this.ja=this.i=!1;this.H=new H;this.B=this.M=this.v=!1;this.K=0;this.T=15;this.wa=this.ma=this.N=!1;this.ea=1;this.ua=g;this.oa=!1;this.a=null;this.xa=!1;this.C=this.F=this.G=null;this.R=!1;this.o=m||null;this.J=p||null;this.j=u||null;this.h=null;this.da=!1;
this.va=0;this.qa=e?e.split(";")[0]:"";this.Y=!1;this.na=0;this.aa=l;this.s=this.l=null}r(U,E);U.prototype.ta=U.prototype.getDebug=U.prototype.ta;function Kd(a){return new VideoPlayerBitrateEstimator(new w(ShakaConstants.numbers.live_bitrate_estimates_half_life),a,ShakaConstants.numbers.live_bitrate_estimates_minimum_sample_count,ShakaConstants.numbers.live_bitrate_estimates_large_sample_weight_factor)}
U.prototype.fa=function(a){null!=a.initialStreamBufferSize&&(this.K=Number(a.initialStreamBufferSize));var b=ShakaConstants.numbers.initial_stream_buffer_size_for_video_stream;0<b&&-1!==this.qa.indexOf("v")&&(this.K=b);null!=a.dynamicStreamBufferSize&&(this.V=Number(a.dynamicStreamBufferSize));null!=a.streamBufferSize&&(this.T=Number(a.streamBufferSize));null!=a.fixBufferingGoalDetermination&&(this.N=Boolean(a.fixBufferingGoalDetermination));null!=a.addCdnDebugQueryParameters&&(this.ma=Boolean(a.addCdnDebugQueryParameters));
null!=a.useInitialBufferSizeWhenPaused&&(this.wa=Boolean(a.useInitialBufferSizeWhenPaused));null!=a.segmentRequestTimeout&&(this.b.L=Number(a.segmentRequestTimeout));null!=a.resolveVideoTimeUpdateOnFragmentedTimeRanges&&(this.oa=Boolean(a.resolveVideoTimeUpdateOnFragmentedTimeRanges));null!=a.performanceLogger&&(this.a=this.m.performanceLogger=a.performanceLogger);null!=a.abrLogger&&(this.m.abrLogger=a.abrLogger);null!=a.reappendInitSegmentAfterAbort&&(this.m.reappendInitSegmentAfterAbort=Boolean(a.reappendInitSegmentAfterAbort));
null!=a.liveDataFetchMaxRetries&&(this.m.liveDataFetchMaxRetries=Number(a.liveDataFetchMaxRetries));null!=a.liveSourceBufferClearMaxRetries&&(this.m.liveSourceBufferClearMaxRetries=Number(a.liveSourceBufferClearMaxRetries));null!=a.skipEmptySegments&&(this.m.skipEmptySegments=Boolean(a.skipEmptySegments));null!=a.playheadFragmentedGapDiffAllowance&&(this.m.playheadFragmentedGapDiffAllowance=Number(a.playheadFragmentedGapDiffAllowance));null!=a.useMicroTaskTimeouts&&(this.xa=Boolean(a.useMicroTaskTimeouts));
a=this.b;b=this.m;null!=b.reappendInitSegmentAfterAbort&&(a.J=Boolean(b.reappendInitSegmentAfterAbort));null!=b.performanceLogger&&(a.a=b.performanceLogger);null!=b.abrLogger&&(a.C=b.abrLogger);null!=b.liveDataFetchMaxRetries&&(a.H=b.liveDataFetchMaxRetries);null!=b.liveSourceBufferClearMaxRetries&&(a.G=b.liveSourceBufferClearMaxRetries);null!=b.playheadFragmentedGapDiffAllowance&&(a.I=b.playheadFragmentedGapDiffAllowance);null!=b.skipEmptySegments&&(a.N=b.skipEmptySegments)};
U.prototype.destroy=function(){Ld(this);this.H.destroy();this.ga=this.f=this.H=null;this.b.destroy();this.za=this.o=this.c=this.b=null};n=U.prototype;n.Na=function(){return this.f};n.wb=function(){return this.g};n.Cc=function(a){this.v||a.then(function(){this.v=!0;this.A||Md(this,0)}.bind(this)).catch(function(){});return this.H};n.nc=n.Va=function(){return this.B};
n.ab=function(a,b,c,d,e){if(a!=this.f){var f=1;null!==this.l&&0<this.f.bandwidth&&(f=this.l.getEstimate()/this.f.bandwidth);var g=a.X;g&&(this.ca=g.create(this.a,this.Ea));a.O.create().then(I(this,function(h){if(this.c){var g=this.f;this.f=a;this.l=Kd((a.bandwidth||0)*f);var l=this.g;this.g=h;l&&l.b.xc();nd(this.g,function(a){this.j&&this.j.setSegments(this.g.getSegments());this.o&&(a=a?a:this.g.getSegments(),Od(this,this.f.id||"",a))}.bind(this));this.j&&this.j.setSegments(this.g.getSegments());
if(this.o){var l=[],m=ShakaConstants.numbers.templated_chunked_segment_update_limit_int;if(m){h=this.g.length();for(var m=Math.min(h,m),p=1;p<=m;++p)l.push(this.g.get(h-p))}else l=h.getSegments();Od(this,a.id||"",l)}this.ha=!0;this.S=d?d:null;this.L||(g?b?Pd(this,!0,c):e&&Pd(this,!1):Md(this,0))}})).catch(I(this,function(a){"aborted"!=a.type&&(this.v?(a=z(a),this.dispatchEvent(a)):this.H.reject(a))}))}};n.vc=n.zc=function(){this.Z=!0};n.Bc=function(a){this.va=a};
function Od(a,b,c){ShakaConstants.numbers.templated_chunked_segment_update_limit_int&&a.o.updateSegmentIndex(b,a.g);a.o.updateSegmentsByShakaReferences(b,c)}
function Pd(a,b,c){if(a.f&&!a.L){var d;a.a&&(d=a.a.getOperationLogger("resync").start());a.L=!0;Ld(a);a.M=!1;null!==a.s&&a.s.reset();a.b.abort().then(I(a,function(){var a=this.c.currentTime;this.w.getBool("set_current_time_in_resync",!1)&&0==a?(this.a&&ODS.bumpEntityKey(2966,"videos.www.shaka","set_current_time_in_resync"),a=this.g.first().startTime):this.w.getBool("better_set_current_time_in_resync",!1)&&a<this.g.first().startTime&&(ODS.bumpEntityKey(2966,"videos.www.shaka","set_current_time_in_resync"),
a=this.g.first().startTime+this.w.getNumber("resync_set_current_time_fudge_factor",0));if(!b&&0<qb(this.b,a)&&0<=xb(this.b.c,a))return Promise.resolve();if(c)return Bb(this.b,this.c.currentTime+c);this.da=!0;return Ab(this.b)})).then(I(a,function(){this.L=!1;Md(this,0);d&&d.log()})).catch(I(a,function(a){this.L=!1;Md(this,0);d&&d.setError(a).log();"aborted"!=a.type&&(this.v?(a=z(a),this.dispatchEvent(a)):this.H.reject(a))}))}}n.Ac=function(a){return 0<qb(this.b,a)&&0<=xb(this.b.c,a)};n.jb=function(){};
n.sb=function(){return!0};function Wd(a){a.ja=a.ja||!a.c.paused;var b=a.wa&&a.c.paused?a.K:a.T;a.c.paused&&1<a.ea&&(b*=a.ea);a.V&&!a.c.paused&&(b=Math.max(Math.min(a.g.last().endTime-a.c.currentTime,a.V),a.T));b=(a.N?a.i&&a.ja:a.i)?Math.max(a.K,b):a.K;if(0<ShakaConstants.numbers.audio_video_buffer_diff_threshold)var c=a.c.buffered.length?a.c.buffered.end(a.c.buffered.length-1):0,c=Math.max(0,c-a.c.currentTime),b=Math.min(b,c+ShakaConstants.numbers.audio_video_buffer_diff_threshold);return b}
function Xd(a,b){return a.i?b:b+(a.I||0)}function Yd(a){var b=a.w.getNumber("start_stream_buffer_size",1),c=a.w.getNumber("low_start_stream_buffer_size",1);if(b!==c){var d=a.w.getNumber("low_bandwidth_start_stream_buffer_size_threshold",0),e=ShakaConstants.numbers.scheduled_videos_start_stream_buffer_size_threshold;if(0<d&&a.ga.getBandwidth()<d&&VideoStreamingTaskQueueProvider.getQueueSize("video")>=e)return c}return b}
function Zd(a){if(a.i&&!a.v)return a.A=null,Promise.resolve();var b;if(b=a.v&&!a.B)b=1<a.b.b.buffered.length?!0:!1;if(b&&(a.Z||Eb(a.b,a.c)))return a.oa&&(a.c.currentTime=Db(a.c)),null===a.G&&(a.Z=!1,Pd(a,!0)),Promise.resolve();ShakaConstants.numbers.decouple_stream_on_update_loop_from_request_loop_int||(a.A=null);b=a.f;var c=a.g,d=a.c.currentTime;a.w.getBool("use_pending_seek_position_for_reference",!1)&&0===a.c.readyState&&!d&&a.F&&(d=a.F);if(a.N&&!a.i&&qb(a.b,Xd(a,d))>=Yd(a))return $d(a),Md(a,0),
Promise.resolve();var e=null,f=[];null!==a.G&&(d=a.G);if(qb(a.b,Xd(a,d))>=Wd(a))if(a.M=!0,null!==a.C&&a.C.resolve(),a.N||$d(a),f=[],0<f.length)e=f[0];else return Md(a,1E3/(5*(Math.abs(a.c.playbackRate)||1))),Promise.resolve();else{var g=1;a.j&&(g=a.j.getNumberOfSegments());var h=pb(a.b);a.R&&(h=null,null!==a.G&&(a.R=!1));h&&!c.b.b&&(h=c.find(h.startTime));null!=a.F&&(d=a.F,a.F=null);g=ae(a,d,c,g,h);e=g[0];a.j&&(a.j.setFutureSegments(g),a.j.setBufferingGoal(Wd(a)-qb(a.b,Xd(a,d))))}if(!e)return $d(a),
a.v&&!a.B&&(a.B=!0,Nd(a)),Md(a,200),Promise.resolve();be(a,ce(a,d,f),b.id||"");de(a,ce(a,d,f));e.url=e.url.clone();a.Y=!0;a.na=Date.now();"video"===b.mimeType.split("/")[0]&&a.ga.setRepresentationID(b.id);c=a.b.fetch(e,c.a,b.a+a.va,a.ca,a.ma&&!a.c.paused,0<f.length,a.o,a.J);c=c.then(I(a,,I(a,function(a){return Promise.reject(maybeConvertHiveErrorToShakaNetError(a))}));a.ua&&"video"===b.mimeType.split("/")[0]&&a.ua.add(e.startTime||0,e.endTime||
0,{id:b.id,reason:a.S,performanceLogger:a.a?a.a.getOperationLogger("stream_switch"):null});a.ca=null;a.ha&&(a.ha=!1,f=a.S,a.S=null,ee(a,b,f,a.ba()));a.B=!1;return c.then(I(a,).then(I(a,function(a){var b=a.U,c=a.Pc;this.i||(this.pa=c);null!=a&&0<a.wc&&0<a.D&&(null===this.l&&(this.l=Kd(this.f.bandwidth||0)),this.l.sample(8*a.wc,a.D));a=ShakaConstants.numbers.buffer_velocity_time_in_past_to_consider;0<a&&null!==this.f&&"video"===Cd(this.f)&&(null===this.s&&(this.s=new BufferVelocity(a)),
this.s.recordBufferAhead(qb(this.b,this.c.currentTime)));this.Y=!1;"video"===(this.f?this.f.mimeType.split("/")[0]:null)&&this.dispatchEvent(x({type:"fetch_end",bubbles:!0,detail:{stream_fetch_time_ms:Date.now()-this.na,segment_length_ms:1E3*(e.endTime-e.startTime)}}));null==this.I&&(this.I=b);this.da&&0<qb(this.b,d)&&(this.da=!1,b=x({type:"should_nudge"}),this.dispatchEvent(b));Md(this,0)})).catch(I(a,function(a){this.Y=!1;return Promise.reject(a)}))}
function ce(a,b,c){var d=Xd(a,b);return{additionalSegmentsRequired:c,playhead:b,bufferStart:d,bufferEnd:qb(a.b,Xd(a,b))+d,bufferingGoal:Wd(a),isPlaying:!a.c.paused}}unction fe(a,b,c){var d=null!==a.h&&-1<a.h&&a.h<c.length()-1?c.get(a.h):null,e=null;if(null===a.h||!d||d.startTime>b)return e=c.findIndex(b),a.h=e;for(d=a.h;d<=a.h+1;d++)if(e=c.get(d),e.startTime<=b&&e.endTime>b)return a.h=d;e=c.findIndex(b);return(a.h=e)||-1}
n.sc=function(){var a;if(this.a){var b=ShakaConstants.numbers.stream_onupdate_sampling;b&&0===Math.floor(Math.random()*b)&&(a=this.a.getOperationLogger("stream_onupdate").start())}var c;ShakaConstants.numbers.decouple_stream_on_update_loop_from_request_loop_int&&Md(this,ShakaConstants.numbers.decouple_stream_on_update_loop_from_request_loop_int);try{c=Zd(this)}catch(d){d.type="uncaught",a&&a.setError(d),c=Promise.reject(d)}c.catch(I(this,function(a){if("aborted"!=a.type){if("sourcebuffer_full"===
a.type)return Ab(this.b).then(I(this,);var b=[0,404,410,502,503,504];b.push(417,200);b=-1===b.indexOf(a.status);if("net"===a.type&&!b&&this.f)switch(a.status){case 404:Md(this,2E3);break;case 410:ge(this);break;case 417:case 200:a.responseHeaders&&null!=a.responseHeaders["x-fb-video-replica"]?this.dispatchEvent(x({type:"replicaswitch",bubbles:!0,replica:a.responseHeaders["x-fb-video-replica"],url:a.url,status:a.status})):b=!0;break;default:Md(this,1E3)}0===a.status?this.aa.informNetworkInterrupted():
this.aa.informNetworkResumed();b&&(b=z(a),this.dispatchEvent(b),this.a&&setTimeout(function(){var b=this.a.getEventLogger("stream_error_fallback").setError(a).setType(this.qa.split("/")[0]);this.c?b.setResult("failed"):b.setResult("success");b.log()}.bind(this),0))}}));a&&a.log()};function ae(a,b,c,d,e){var f=-1;null!=e?f=null!=e.endTime?c.findIndex(e.endTime):-1:(f=fe(a,b,c),0>f&&(f=c.length()?c.length()-1:-1));a=[];if(0<=f)for(b=f;b<f+d&&b<c.length();b++)a.push(c.get(b));return a}
function $d(a){if(!a.i&&null!=a.I){a.i=!0;var b=a.b,c=a.I,d=c-b.M;0!=d&&(b.c=cd(b.c,d),b.M=c);a.H.resolve(a.I)}}n.wd=function(){return this.i};U.prototype.hasStarted=U.prototype.wd;U.prototype.Ga=function(){return this.M};U.prototype.hasHitBufferingGoal=U.prototype.Ga;U.prototype.ba=function(){return null===this.l?null:this.l.getEstimate()};U.prototype.getBitrateEstimate=U.prototype.ba;U.prototype.eb=U.prototype.getBufferVelocity=U.prototype.eb;
function ee(a,b,c,d){var e=b.mimeType.split("/")[0];b=x({type:"adaptation",id:b.id,bubbles:!0,contentType:e,size:"video"!=e?null:{width:b.width,height:b.height},bandwidth:d||b.bandwidth,reason:c});a.dispatchEvent(b)}function ge(a){var b=x({type:"should_end_all_streams"});a.dispatchEvent(b)}function Nd(a){var b=x({type:"ended"});a.dispatchEvent(b)}U.prototype.Da=function(){return this.J};U.prototype.getVideoStreamingManager=U.prototype.Da;
function Md(a,b){Ld(a);!b&&a.xa?Promise.resolve().then(a.sc.bind(a)):a.A=setTimeout(a.sc.bind(a),b)}.prototype.gb=function(){return this.pa};U.prototype.Fa=U.prototype.getStreamProgressTracker=U.prototype.Fa;function he(a,b){a.G=b;a.R=!0;a.C||(a.C=new H);return a.C};e.prototype.destroy=ie.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=new ad(0,null,this.b,0,0),a=new T([a],1);this.a=new R(a);return Promise.resolve(this.a)};ie.prototype.c=function(){return this.a};function je(a,b){E.call(this,a);this.c=b;this.h=!0;this.j=this.g=null;this.f=new H;this.a=null}r(je,E);je.prototype.fa=function(){};je.prototype.destroy=function(){this.a&&this.c.removeChild(this.a);this.f.destroy();this.za=this.c=this.g=this.j=this.a=this.f=null};n=je.prototype;n.Na=function(){return this.g};n.wb=function(){return this.j};n.Cc=function(){return this.f};n.Va=function(){return!0};n.nc=function(){};
n.ab=function(a){a.O.create().then(I(this,function(b){if(this.c){if(0==b.length())return Promise.reject(Error("No subtitles URL available."));var c=this.g;this.g=a;this.j=b;b=b.first().url.c[0].toString();var d=this.sb();this.a&&(this.jb(!1),this.c.removeChild(this.a));this.a=document.createElement("track");this.c.appendChild(this.a);this.a.src=b;this.jb(d);b=x({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:a.bandwidth});this.dispatchEvent(b);c||this.f.resolve(0)}}))};n.vc=function(){};
n.zc=function(){};n.Ac=n.jb=function(a){this.h=a;this.a&&(this.a.track.mode=a?"showing":"disabled")};n.sb=function(){this.a&&(this.h="showing"==this.a.track.mode);return this.h};n.gb=function(){return 0};n.Bc=function(){};ke.prototype.parse=function(a,b,c,d){var e=null;try{var f;var g=new Ha(b);if(440786851!=Ja(g).id)f=null;else{var h=Ja(g);if(408125543!=h.id)f=null;else{var k=h.a.byteOffset,l;var m=new Ha(h.a);for(b=null;Ca(m.a);){var p=Ja(m);if(357149030==p.id){b=p;break}}if(b){for(var u=new Ha(b.a),p=1E6,m=null;Ca(u.a);){var y=Ja(u);if(2807729==y.id)p=Na(y);else if(17545==y.id)if(b=y,4==b.a.byteLength)m=b.a.getFloat32(0);else if(8==b.a.byteLength)m=b.a.getFloat64(0);else throw new RangeError("EbmlElement: floating point numbers must be 4 or 8 bytes.");}null==
m?l=null:(u=p/1E9,l={yb:u,duration:m*u})}else l=null;f=l?{sd:k,yb:l.yb,duration:l.duration}:null}}if(f){var G=Ja(new Ha(a));if(475249515!=G.id)e=null;else{var V=f.sd,ia=f.yb,da=f.duration;a=[];for(var Za=new Ha(G.a),k=f=G=-1;Ca(Za.a);){var kd=Ja(Za);if(187==kd.id){var ma;var ld=new Ha(kd.a),md=Ja(ld);if(179!=md.id)ma=null;else{var hf=Na(md),Qd=Ja(ld);if(183!=Qd.id)ma=null;else{var Rd=new Ha(Qd.a);for(l=0;Ca(Rd.a);){var Sd=Ja(Rd);if(241==Sd.id){l=Na(Sd);break}}ma={ob:hf,qd:l}}}if(ma){var Td=ia*ma.ob,
Ud=V+ma.qd;if(0<=G){var Ec=new J(d,c,k,Ud-1),jf=ma.ob-f;a.push(new ad(G,Td,Ec,ma.ob,jf))}G=Td;f=ma.ob;k=Ud}}}0<=G&&(Ec=new J(d,c,k,null),a.push(new ad(G,da,Ec,f,da/ia-f)));e=a}}else e=null}catch(Vd){if(!(Vd instanceof RangeError))throw Vd;}return e};function le(a,b,c,d,e,f,g,h,k,l,m){this.i=a;this.o=b;this.f=c;this.m=l||null;this.l=m||null;this.b=d;this.h=e;this.g=f;this.v=g;this.Ia=null;this.j=h;this.a=k||null;this.s=null}le.prototype.destroy=function(){this.j=this.o=this.i=null;this.b.Aa();this.b=null;this.g&&(this.g.Aa(),this.g=null);this.h&&(this.h.Aa(),this.h=null);this.Ia=null};le.prototype.Jc=function(){return this.Ia};le.prototype.create=function(){return me(this)};le.prototype.lc=
function me(a){if(a.Ia)return a.Ia;var b=null;a.a&&(b=a.a.getOperationLogger("create_container_segment_index_source").start());if(null!==a.m&&(null!==a.l||"webm"!==a.f))return ne(a,a.m,a.l,b);var c=[a.b.fetch(null,null,a.a,b)];"webm"==a.f&&c.push(a.h.fetch(null,null,a.a,b));a.Ia=Promise.all(c).then(I(a,function(a){return ne(this,a[0],a[1]||null,b)}));return a.Ia}
function ne(a,b,c,d){var e=null;"mp4"==a.f?(e=new jd,e=e.parse(new DataView(b),a.b.startByte,a.b.c,a.j,a.g)):"webm"==a.f&&(e=new ke,e=e.parse(new DataView(b),new DataView(c),a.b.c,a.j));if(!e)return a=Error("Failed to parse SegmentReferences from "+a.b.toString()+" (or one of its fallbacks)."),a.type="stream",Promise.reject(a);b=new T(e,e.a);var f;"dynamic"==a.i.type?f=new S(b,a.i,a.o,a.v):f=new R(b);d&&d.log();a.s=f;return Promise.resolve(f)}le.prototype.c=function(){return this.s};function pe(a,b,c){for(var d=ya()/1E3,e=0;e<b.a.length;++e)for(var f=b.a[e],g=0;g<f.a.length;++g){var h=f.a[g];if("text"!=h.contentType)for(var k=0;k<h.a.length;++k){var l=h.a[k],m=0,m=m+(l.f?1:0),m=m+(l.b?1:0),m=m+(l.a?1:0);0==m?(h.a.splice(k,1),--k):1!=m&&(l.f?(l.b=null,l.a=null):l.b&&(l.a=null))}}qe(b);for(e=0;e<b.a.length;++e)for(f=b.a[e],g=0;g<f.a.length;++g){k=h=f.a[g];l=null;for(m=0;m<k.a.length;++m){var p=k.a[m].mimeType||"";l?p!=l&&(k.a.splice(m,1),--m):l=p}0==h.a.length&&(f.a.splice(g,1),
--g)}b.manifestIsLiveStreaming&&null==b.c&&(b.c=d);e=new Jd;"dynamic"==b.type&&(e.b=!0,e.c=b.g,e.g=new J(c,b.o||b.url,void 0,void 0,void 0,a.b),e.j=b.c);e.v=b.h||0;e.l=b.i||0;e.m=b.j||0;e.f=b.l||5;for(f=0;f<b.a.length;++f){g=b.a[f];if(null==g.start)break;g=re(a,b,g,d,c);e.a.push(g)}e.h=b.FBIsLiveTemplated;a.a&&a.a.setIsTemplatedManifest(b.FBIsLiveTemplated);e.w=b.FBWasLive;a=null;c="none";for(f=0;f<b.a.length;f++)for(g=b.a[f],d=0;d<g.a.length;d++)for(h=g.a[d],k=0;k<h.a.length;k++)l=h.a[k].g,null!=
l&&null!=l.value&&(a=c=l.value,"urn:mpeg:dash:23003:3:audio_channel_configuration:2011"===l.a&&("1"===a?c="mono":"2"===a&&(c="stereo")));e.s=c;a=parseInt(a,10);e.o=0<a?a:null;return e}
function qe(a){if(a.a.length){null==a.a[0].start&&(a.a[0].start=0);var b=function(a){return 0==a||!!a};a.manifestIsLiveStreaming&&(a.b=null);b(a.b)&&1==a.a.length&&!b(a.a[0].duration)&&(a.a[0].duration=a.b);for(var c=0,d=!0,e=0;e<a.a.length;++e){var f=a.a[e-1],g=a.a[e],h=a.a[e+1]||{start:a.b};!b(g.start)&&f&&b(f.start)&&b(f.duration)&&(g.start=f.start+f.duration);!b(g.duration)&&b(h.start)&&(g.duration=h.start-g.start);null!=g.start&&null!=g.duration?c+=g.duration:d=!1}b(a.b)||(e=a.a[a.a.length-1],
d?a.b=c:b(e.start)&&b(e.duration)?a.b=e.start+e.duration:a.manifestIsLiveStreaming||(a.b=c))}}
function re(a,b,c,d,e){var f=new Id;f.id=c.id;f.start=c.start;f.duration=c.duration;var g=new C;c.a.forEach(;for(var h=ab(g),k=0;k<h.length;++k){var l=new C;g.get(h[k]).forEach(function(a){l.push(a.group,a)});for(var m=ab(l),p=0;p<m.length;++p){var u=new C;l.get(m[p]).forEach(;for(var y=ab(u),G=0;G<y.length;++G){var V=u.get(y[G]),V=se(a,b,c,V,d,e);f.a.push(V)}}}return f}
function se(a,b,c,d,e,f){ba(d.every(function(a){return a.group==d[0].group&&(a.lang||"")==(d[0].lang||"")&&(a.contentType||"")==(d[0].contentType||"")}));var g=new Ed,h=d.filter(;h.length==d.length&&(g.id=h.map(function(a){return a.id}).sort().reduce();g.b=!(!d[0].b||"urn:scte:dash:cc:cea-608:2015"!==d[0].b.a);g.lang=d[0].lang||"";g.contentType=d[0].contentType||"";g.f=d.some(function(a){return a.f});for(var h={},k=0;k<d.length;++k){var l=
d[k];l.c&&(g.c=l.c);for(var m=0;m<l.a.length;++m){var p=l.a[m],u=te(a,p),y=g.a.slice(0);ue(u,y);0==y.length&&0<g.a.length||!(p=ve(a,b,c,p,e,f))||(g.u.push(p),g.a=y,h[p.P]=l)}}if(g.a.some()return g.u.forEach(,g;a=we(d);for(k=0;k<g.u.length;++k)p=g.u[k],l=h[p.P],l==a&&(p.ia=!0);return g}
function we(a){for(var b=null,c=null,d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.a.length;++f){var g=e.a[f],g=(g.width||1)*(g.height||1)*(g.bandwidth||1);if(null==b||g<b)b=g,c=e}return c}function ue(a,b){if(0==b.length)Array.prototype.push.apply(b,a);else for(var c=0;c<b.length;++c){for(var d=!1,e=0;e<a.length;++e){var f=b[c],g=a[e];if(f.a==g.a&&f.i==g.i&&f.withCredentials==g.withCredentials&&f.h==g.h&&f.j==g.j&&f.g==g.g&&f.l==g.l&&La(f.c,g.c)){d=!0;Lb(b[c],a[e].b);break}}d||(b.splice(c,1),--c)}}
function te(a,b){var c=[];if(0==b.c.length)c.push(new Jb);else if(a.c)for(var d=0;d<b.c.length;++d)c.push.apply(c,xe(a,b.c[d]));return c}
function xe(a,b){var c=[];if(2!=a.c.length)return[];var d=a.c(b.f||"",b.c);if(!(d&&d instanceof Array))return[];for(var e=0;e<d.length;++e){var f;var g=d[e];f=new Jb;if(g){var h=Xa(g,"keySystem");if(null!=h)f.a=h;else throw Error("'keySystem' cannot be null.");var k=Xa(g,"licenseServerUrl");if(null!=k)f.i=k;else if(h)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");h=A(g,"withCredentials");null!=h&&(f.withCredentials=h);h=Ya(g,"licensePostProcessor",Function);
null!=h&&(f.f=h);h=Ya(g,"licensePreProcessor",Function);null!=h&&(f.m=h);h=A(g,"distinctiveIdentifierRequired");null!=h&&(f.h=h);h=A(g,"persistentStateRequired");null!=h&&(f.j=h);h=Xa(g,"audioRobustness");null!=h&&(f.g=h);h=Xa(g,"videoRobustness");null!=h&&(f.l=h);h=Ya(g,"serverCertificate",Uint8Array);null!=h&&(f.c=h);if(h=Ya(g,"initData",Object)){g=Ya(h,"initData",Uint8Array);if(null==g)throw Error("'initData.initData' cannot be null.");h=Xa(h,"initDataType");if(null==h)throw Error("'initData.initDataType' cannot be null.");
f.b.push({initData:new Uint8Array(g.buffer),initDataType:h})}}0==f.b.length&&b.a&&b.a.psshBox&&Lb(f,[{initData:b.a.psshBox,initDataType:"cenc"}]);c.push(f)}return c}
function ve(a,b,c,d,e,f){if(!d.baseUrl||0===d.baseUrl.length)return null;var g=null,h=1,k=0;if(d.f){g=d.mimeType.split("/")[1];if("mp4"!=g&&"webm"!=g)g=null;else{var l=d.f;"webm"!=g||l.f?l.b||l.c&&l.c.a?(h=l.c,h||(h=new qc,h.url=d.baseUrl,h.a=l.b?l.b.clone():null),k=ye(a,h,f),h=l.f?ye(a,l.f,f):null,l.g?(l=l.g,l=new J(f,d.baseUrl,l.ka,l.end,void 0,a.b)):l=null,a=new le(b,c,g,k,h,l,e,f,a.a,null,null),b=new Zc(h,null),c=new Ad,c.O=a,c.X=b,g=c):g=null:g=null}h=d.f.a;k=d.f.h}else if(d.b)g=d.b,!g.D&&!g.c&&
1<g.b.length?g=null:g.D||c.duration||g.c||1!=g.b.length?g.c&&0===g.c.a.length?g=null:(g=g.g?ye(a,g.g,f):null,a=new vd(b,c,d,e,f,a.b),b=new Zc(g),c=new Ad,c.O=a,c.X=b,g=c):g=null,h=d.b.a,k=d.b.f;else if(d.a){a:if(g=d.a,h=0+(g.c?1:0),h+=g.b?1:0,h+=g.D?1:0,0==h?h=!1:(1!=h&&(g.c?(g.b=null,g.D=null):g.b&&(g.D=null)),h=!0),h){h=null;if(g.g&&(h=(g=d.a.g)?ze(d,g,rc):null,!h)){g=null;break a}g=h?ye(a,h,f):null;h=d.a;h.c?(h=d.mimeType.split("/")[1],"mp4"!=h&&"webm"!=h?a=null:"webm"!=h||g?ed(f,d,1,0,void 0,
a.b)?(k=(k=d.a.c)?ze(d,k,qc):null)?(k=ye(a,k,f),a=new le(b,c,h,k,g,null,e,f,a.a)):a=null:a=null:a=null):a=h.h?h.b?new zd(a.f,b,c,d,e,f,0,a.b):h.D?b.manifestIsLiveStreaming||null!=c.duration?new ud(b,c,d,e,f):null:null:null;a?(b=new Zc(g),c=new Ad,c.O=a,c.X=b,g=c):g=null}else g=null;h=d.a.a;k=d.a.f}else"text"==d.mimeType.split("/")[0]&&(g=new Ad,g.O=new ie(new J(f,d.baseUrl)));if(!g)return null;g.id=d.id;k&&(g.a=-1*k/h);g.bandwidth=d.bandwidth;g.width=d.width;g.height=d.height;g.mimeType=d.mimeType||
"";g.codecs=d.codecs||"";g.g=d.j||null;g.h=d.l||null;g.fbQualityLabel=d.fbQualityLabel||null;g.fbQualityClass=d.fbQualityClass||null;g.f=d.i||null;g.frameRate=d.frameRate||"";g.c=d.h||null;for(a=0;a<d.c.length;++a)b=d.c[a],b.b&&g.b.push(b.b);return g}function ze(a,b,c){b=fd(b,a.id,null,a.bandwidth,null);if(!b)return null;c=new c;c.url=Rc(a.baseUrl,b);return c}function ye(a,b,c){var d=b.url,e=0,f=null;b.a&&(e=b.a.ka,f=b.a.end);return new J(c,d,e,f,void 0,a.b)};function Ae(a,b,c,d,e,f,g){this.c=new J(null,[new K(a)]);this.a=e;this.g=b;this.f=1;this.h=a;this.b=new sb;this.b.body=b;this.b.method=c;this.b.Wa=3;this.b.withCredentials=d;this.b.b=1E3*(null!=g?g:ga);a=f||{};for(var h in a)this.b.Ha[h]=a[h]}
function Be(a){return a.c.fetch(a.b).then(function(a){return this.c.o&&0<this.f?(this.f--,null!==this.a&&null!==this.c.i&&this.a.setReason("Redirected to URL: "+this.c.i.toString()),this.c=new J(null,[new K(this.h)]),this.b.body=this.g,Be(this)):Promise.resolve(new Uint8Array(a))}.bind(a))};function Ce(a,b,c,d){E.call(this,a);this.f=b;this.l=c;this.b=this.i=null;this.j=new bb;this.c=[];this.g=[];this.m=0;this.h=new H;this.o=null;this.w=ga;this.a=d}r(Ce,E);Ce.prototype.destroy=function(){this.za=null;for(var a=0;a<this.g.length;++a)this.g[a].close().catch(function(){});this.g=[];this.c=this.b=this.i=null;this.h.destroy();this.h=null;this.j.destroy();this.j=null;this.o&&(clearTimeout(this.o),this.o=null);this.f=this.l=null};
Ce.prototype.initialize=function(){for(var a=new C,b=De(this.l),c=0;c<b.length;++c){var d=b[c];d.a.a||d.b&&!Ee(d.b)||a.push(d.contentType,d)}for(var c={},d=!1,e=0;e<b.length;++e){var f=b[e];if(f.a.a&&!a.a.hasOwnProperty(f.contentType)){var g=f.a.a,h=c[g];h||(h=f.a,h={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:h.h?"required":"optional",persistentState:h.j?"required":"optional",sessionTypes:["temporary"]},c[g]=h);if(f.b&&(g=f.contentType+"Capabilities",
g in h)){d=!0;h[g]||(h[g]=[]);var k;"audio"==f.contentType?k=f.a.g:"video"==f.contentType&&(k=f.a.l);h[g].push({contentType:f.b,robustness:k})}}}if(!d)if(b.length)this.b=b[0].a;else throw a=Error("No DrmInfo exists!"),a.type="drm",a;if(0==Object.keys(c).length)return Fe(this.l,a),this.h.resolve(),Promise.resolve();k=new H;c=Ge(c,k);c=c.then(this.v.bind(this,b,a));k.reject(null);this.a&&this.a.getEventLogger("eme_init").log();return c};
function Ge(a,b){for(var c in a)b=b.catch(bind(null,c,a[c]));return b}
Ce.prototype.v=function(a,b,c){if(!this.f)return He();for(var d=c.keySystem,e=c.getConfiguration(),f=["audio","video"],g=0;g<f.length;++g){var h=f[g];if(!b.a.hasOwnProperty(h)){var k=e[h+"Capabilities"];if(k){for(var k=k[0],l=[],m={},p=0;p<a.length;++p){var u=a[p],y=k?u.b==k.contentType:u.contentType==h;u.a.a!=d||!y||u.id in m||(l.push(u),m[u.id]=!0,this.b=this.b?Kb(this.b,u.a):u.a)}b.set(h,l)}}}Fe(this.l,b);if(this.f.mediaKeys)this.i=this.f.mediaKeys;else return c.createMediaKeys().then(function(a){this.i=
a}.bind(this))};function Ie(a){return a.f?a.i?a.f.setMediaKeys(a.i).then(I(a,function(){return this.f?this.b.c?this.i.setServerCertificate(this.b.c):Promise.resolve():He()})).then(I(a,function(){if(!this.f)return He();for(var a=0;a<this.b.b.length;++a){var c=this.b.b[a];this.s({type:"encrypted",initDataType:c.initDataType,initData:c.initData})}0==this.b.b.length&&D(this.j,this.f,"encrypted",this.s.bind(this))})):Promise.resolve():He()}
function He(){var a=Error("EmeManager destroyed");a.type="destroy";return Promise.reject(a)}
Ce.prototype.s=function(a){var b=new Uint8Array(a.initData);this.a&&this.a.getEventLogger("encrypted_sample").log();for(var c=0;c<this.c.length;++c)if(La(b,this.c[c].data))return;try{var d=Je(this)}catch(e){b=z(e);this.dispatchEvent(b);this.a&&this.a.getEventLogger("eme_error").setError(e).log();this.h.reject(e);return}a=d.generateRequest(a.initDataType,a.initData);this.c.push({data:b,ib:d});a.catch(I(this,function(a){if(this.f){for(var b=0;b<this.c.length;++b)if(this.c[b].ib==d){this.c.splice(b,
1);break}b=z(a);this.dispatchEvent(b);this.a&&this.a.getEventLogger("eme_error").setError(a).log();this.h.reject(a)}}));this.g.push(d)};function Ke(a){for(var b=[],c=0;c<b.length;++c){var d=Je(a),e=d.load(b[c]);a.g.push(d);e.then(I(a,function(){this.m++;this.m>=this.g.length&&this.h.resolve()})).catch(I(a,function(a){var b=z(a);this.dispatchEvent(b);this.a&&this.a.getEventLogger("eme_error").setError(a).log()}))}}
function Je(a){var b=null,b=a.i.createSession();D(a.j,b,"message",a.B.bind(a));D(a.j,b,"keystatuseschange",a.A.bind(a));return b}Ce.prototype.B=function(a){Le(this,a.target,this.b,a.message)};
Ce.prototype.A=function(a){a=a.target;var b={};a.keyStatuses.forEach(function(a,c){if("string"===typeof a){var f=a;a=c;c=f}if("com.microsoft.playready"==this.b.a&&16==a.byteLength){var f=new DataView(a),g=f.getUint32(0,!0),h=f.getUint16(4,!0),k=f.getUint16(6,!0);f.setUint32(0,g,!1);f.setUint16(4,h,!1);f.setUint16(6,k,!1)}f=Ib(new Uint8Array(a));b[f]=c}.bind(this));if(a.expiration<Date.now()){for(var c=0;c<this.c.length;++c)if(this.c[c].ib==a){this.c.splice(c,1);break}a.close();this.g.splice(this.g.indexOf(a),
1)}this.a&&this.a.getEventLogger("eme_key_status_change").log();Me(this.l,b)};
function Le(a,b,c,d){d=Ne(c,d);var e=null;a.a&&(e=a.a.getOperationLogger("license_request").start());Be(new Ae(d.url,d.body,d.method,c.withCredentials,e,d.headers,a.w)).then(I(a,function(a){e&&(e.setResult("success"),e.log());c.f&&(a=c.f(a));e=null;this.a&&(e=this.a.getOperationLogger("eme_post_license_session_update").start());null===a||void 0===a||0===a.byteLength?null!==e&&(e.setError("empty license"),e.setResult("failed").log()):b.update(a).then(I(this,function(){e&&(e.setResult("success"),e.log());
var a=x({type:"sessionReady",detail:b});this.dispatchEvent(a);this.m++;this.m>=this.g.length&&this.h.resolve()})).catch(I(this,function(a){a.ib=b;var c=z(a);e&&(e.setResult("failed"),e.setError(a).log());this.dispatchEvent(c)}))})).catch(I(a,function(a){if(c.f){var d=JSON.stringify({data:[{error:a}]}),d=new Uint8Array(d.split("").map();c.f(d)}a.ib=b;d=z(a);e&&e.setError(a).log();this.dispatchEvent(d)}))}
function Ne(a,b){var c={url:a.i,body:b.slice(0),method:"POST",headers:{},key_system:a.a};if("com.microsoft.playready"===a.a){for(var d=String.fromCharCode.apply(null,new Uint16Array(c.body)),d=(new DOMParser).parseFromString(d,"application/xml"),e=d.getElementsByTagName("name"),f=d.getElementsByTagName("value"),g=0;g<e.length;g++)c.headers[e[g].childNodes[0].nodeValue]=f[g].childNodes[0].nodeValue;c.body=window.atob(d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!a.m)return c;
a.m(c);c.url=Xa(c,"url");if(null==c.url)throw Error("'url' cannot be null.");if(!(c.body instanceof ArrayBuffer||"string"===typeof c.body||null==c.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");c.method=Xa(c,"method");if("GET"!=c.method&&"POST"!=c.method)throw Error("'method' must be either 'GET' or 'POST'.");c.headers=Ya(c,"headers",Object);if(null==c.headers)throw Error("'headers' cannot be null.");return c};function W(a,b,c,d,e,f,g){E.call(this,null);this.b=a;this.j=b;this.c=null;this.g=new bb;this.o=this.l=null;this.K=0;this.T=g;this.H=null;this.A=this.h=!1;this.R=this.S=!0;this.i=!1;this.f={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:ga,mpdRequestTimeout:ha,segmentRequestTimeout:ja,preferredLanguage:"en",restrictions:new ka};this.a=c;this.G=d;this.V=e;this.Z=f;this.s=null;this.m=1;this.L=null;this.v=this.B=this.w=!1;this.J=this.C=null}r(W,E);
q("shaka.player.Player",W);W.version="v1.6.4-fb";W.isBrowserSupported=
W.prototype.ta=function(){var a={},b=this.c;if(b){var c=b.Qb();a.BandwidthEstimator=c.BandwidthEstimator;var d=c.VideoSourceStream;d&&(a.VideoSourceStream=d,(d=a.VideoBufferManager=d.ta().SourceBufferManager)&&(a.VideoSourceBuffer=d.ta().SourceBuffer));(d=a.AudioSourceStream=c.AudioSourceStream)&&(d=a.AudioBufferManager=d.ta().SourceBufferManager)&&(a.AudioSourceBuffer=d.ta().SourceBuffer);a.TextSourceStream=c.TextSourceStream;a.getManifest=b.Mb.bind(b)}else a.getManifest=function(){};a.Dd=!0;return a};
W.prototype.getDebug=W.prototype.ta;W.prototype.ma=function(a){this.S=a};W.prototype.setResumeAfterBuffering=W.prototype.ma;function Ee(a){return"text/vtt"==a?!!window.VTTCue:MediaSource.isTypeSupported(a)}W.isTypeSupported=Ee;W.setTextStyle=function(a){var b=document.getElementById("ShakaPlayerTextStyle");b||(b=document.createElement("style"),b.id="ShakaPlayerTextStyle",document.head.appendChild(b));for(b=b.sheet;b.cssRules.length;)b.deleteRule(0);b.insertRule("::cue { "+ra(a)+" }",0)};
W.prototype.destroy=function(){return this.N().then(I(this,function(){this.g.destroy();this.b=this.g=null;this.J&&this.J.remove()})).catch(function(){})};W.prototype.destroy=W.prototype.destroy;W.prototype.N=function(){this.i=!0;return Oe(this)};W.prototype.unload=W.prototype.N;
function Oe(a){var b;a.a&&(b=a.a.getOperationLogger("unload").start());if(!a.c)return b&&b.log(),Promise.resolve();a.h&&Pe(a,"unloading");a.b.pause();cb(a.g);Qe(a);Re(a);a.l&&(a.l.destroy(),a.l=null);a.c&&(a.c.destroy(),a.c=null);a.j.getBool("www_videos_playback_remove_src_attr_on_unload",!1)?a.b.removeAttribute("src"):a.b.src="";a.j.getBool("www_videos_playback_call_load_on_unload",!1)&&a.b.load();var c=a.b.setMediaKeys&&"function"===typeof a.b.setMediaKeys?a.b.setMediaKeys(null):Promise.resolve(),
c=c.then(function(){b&&b.log();var c=x({type:"unload"});a.dispatchEvent(c)});a.h=!1;a.A=!1;a.B=!1;a.v=!1;return c}function Se(a,b){for(var c=0;c<a.length;c++)b.push(a[c].contentType,a[c])}W.prototype.Da=W.prototype.load=W.prototype.Da;
function Te(a,b){var c;a.a&&(c=a.a.getOperationLogger("load").setState("loading").start(),b.a=b.g.performanceLogger=a.a);a.G&&(b.Gb=b.g.abrLogger=a.G);a.T&&(b.ga=a.T);a.V&&(b.G=a.V);a.Z&&b.ba.push(a.Z);Ue(b,a.b);var d=null;a.i=!1;D(a.g,b,"initiallivemanifestrequestfailure",a.ea.bind(a));D(a.g,b,"replicaswitch",a.aa.bind(a));a.c&&(d=Oe(a).then(I(a,));a.b.autoplay&&(t.ka("load"),D(a.g,a.b,"timeupdate",a.Yc.bind(a)));b.bc(a.f);b.da=a.L;a.L=null;d||(d=b.kb());d.catch(I(a,);return d.then(I(a,function(){if(!this.b||this.i)return Ve();this.c=b;this.g.Ka(this.c,"initiallivemanifestrequestfailure");this.g.Ka(this.c,"replicaswitch");D(this.g,this.c,"seekrangechanged",this.ha.bind(this));D(this.g,this.c,"allStreamsStarted",this.xd.bind(this));var a=new C;Se(De(this.c),a);Fe(this.c,a);a=this.Y();c&&0<a.length&&(a=a.reduce(function(a,b){if(null===a||b.bandwidth<a.bandwidth)a=b;return a},null),c.setLowestQualityRepresentationID(a.streamInfoID));if(!this.f.enableContentProtection)return Promise.resolve();
this.l=new Ce(this,this.b,this.c,this.a);return this.l.initialize()})).then(I(a,function(){if(!this.b||this.i)return Ve();We(this);D(this.g,this.b,"playing",this.cd.bind(this));D(this.g,this.b,"pause",this.fa.bind(this));D(this.g,this.b,"waiting",this.ld.bind(this));D(this.g,this.b,"play",this.ga.bind(this));return Xe(this.c,this,this.b)})).then(I(a,function(){if(!this.b||this.i)return Ve();if(this.f.enableContentProtection){var a;this.a&&(a=this.a.getOperationLogger("eme_attach"),a.start());return Ie(this.l).then(function(){a&&
a.log()})}return Promise.resolve()})).then(I(a,function(){if(!this.b||this.i)return Ve();Ye(this);c&&c.updateState("ready").log()})).catch(I(a,function(a){c&&c.setError(JSON.stringify(a)).log();if(!this.b||this.i)return Ve();if("destroy"!=a.type){var b=z(a);this.dispatchEvent(b)}return this.N().then(}))}n=W.prototype;
n.xd=function(){var a,b;this.j.getBool("www_videos_extended_spl_logging_for_connected_tv",!1)&&this.a&&(a=this.a.getOperationLogger("on_all_streams_started"),b=this.a.getOperationLogger("restore_video_playback_rate"));this.A=!0;this.h?this.F():(this.b.playbackRate=this.m,b&&b.log());a&&a.log()};function Ve(){var a=Error("Player destroyed");a.type="destroy";return Promise.reject(a)}
function We(a){var b=a.b.parentNode;b&&(a.J=eventListenerCapture(b,"playing",bind(a)))}n.Yc=function(){t.end("load");this.g.Ka(this.b,"timeupdate")};n.ld=function(a){Ze(this);this.h||this.F(a)};n.cd=function(){t.ka("playing");this.a&&this.a.getEventLogger("playing").setState("playing").log();!this.o&&0>this.m&&(this.b.playbackRate=0,this.I(this.b.currentTime,Date.now(),this.m));this.h&&!this.R&&Pe(this,"playing")};n.td=function(a){this.v=a};
W.prototype.setPendingPlayRequest=W.prototype.td;W.prototype.ga=function(){this.v=!0};W.prototype.fa=function(){this.a&&this.a.getEventLogger("pause").setState("paused").log();t.end("playing");t.get("playing");Re(this)};W.prototype.ha=W.prototype.Y=function(){return this.c?this.c.R():[]};W.prototype.getVideoTracks=W.prototype.Y;W.prototype.qa=function(){return this.c?this.c.pa():[]};W.prototype.getAudioTracks=W.prototype.qa;
W.prototype.wa=W.prototype.getTextTracks=W.prototype.wa;W.prototype.selectVideoTrack=function(a,b){return this.c?this.c.selectVideoTrack(a,void 0==b?!0:b):!1};W.prototype.selectVideoTrack=W.prototype.selectVideoTrack;W.prototype.Ea=function(a,b,c){return this.c?$e(this.c,"audio",a,void 0==b?!0:b,c):!1};W.prototype.selectAudioTrack=W.prototype.Ea;W.prototype.Fa=function(a){return this.c?$e(this.c,"text",a,!1):!1};W.prototype.selectTextTrack=W.prototype.Fa;
W.prototype.pa=W.prototype.enableTextTrack=W.prototype.pa;W.prototype.ja=function(a){Re(this);this.w&&this.h||!(0<=a)?this.b.paused||(this.b.playbackRate=0,this.I(this.b.currentTime,Date.now(),a)):this.b.playbackRate=a;this.m=a};W.prototype.setPlaybackRate=W.prototype.ja;W.prototype.ca=function(){return this.m};W.prototype.getPlaybackRate=W.prototype.ca;W.prototype.va=W.prototype.getManifest=W.prototype.va;
W.prototype.Xa=function(a){this.L=a};W.prototype.setPlaybackStartTime=W.prototype.Xa;W.prototype.M=function(){return this.c?!!this.c.J():!1};W.prototype.isLive=W.prototype.M;
W.prototype.oa=function(a){if(a){var b=A(a,"enableAdaptation");null!=b&&(this.f.enableAdaptation=b);b=A(a,"endBufferingOnPlaying");null!=b&&(this.R=b);b=A(a,"usePlaybackRateForBuffering");null!=b&&(this.w=b);b=B(a,"streamBufferSize",0);null!=b&&(this.f.streamBufferSize=b);b=B(a,"dynamicStreamBufferSize",0);null!=b&&(this.f.dynamicStreamBufferSize=b);null!=a.smartBufferAdjustmentParams&&(this.f.smartBufferAdjustmentParams=a.smartBufferAdjustmentParams);b=A(a,"addCdnDebugQueryParameters");null!=b&&
(this.f.addCdnDebugQueryParameters=b);b=B(a,"initialStreamBufferSize",0);null!=b&&(this.f.initialStreamBufferSize=b);b=A(a,"includeStreamBufferSizeInStartOffset");null!=b&&(this.f.includeStreamBufferSizeInStartOffset=b);b=B(a,"jumpToLiveThreshold");null!=b&&(this.f.jumpToLiveThreshold=b);b=B(a,"liveStreamEndTimeout",0);null!=b&&(this.f.liveStreamEndTimeout=b);b=B(a,"licenseRequestTimeout",0);null!=b&&(this.f.licenseRequestTimeout=b);b=B(a,"mpdRequestTimeout",0);null!=b&&(this.f.mpdRequestTimeout=
b);b=B(a,"minMpdRefreshInterval",0);null!=b&&(this.f.minMpdRefreshInterval=b);b=A(a,"enableLiveInterruptionDetection");null!=b&&(this.f.enableLiveInterruptionDetection=b);b=A(a,"enableManifestDebug");null!=b&&(this.f.enableManifestDebug=b,E.prototype.gc=b,b||(E.prototype.Ba=function(){}));b=A(a,"resolveVideoTimeUpdateOnFragmentedTimeRanges");null!=b&&(this.f.resolveVideoTimeUpdateOnFragmentedTimeRanges=b);b=B(a,"liveInterruptionConsecutiveUpdatesWithoutChange");null!=b&&(this.f.liveInterruptionConsecutiveUpdatesWithoutChange=
b);b=B(a,"liveInterruptionConsecutiveUpdatesWithChange");null!=b&&(this.f.liveInterruptionConsecutiveUpdatesWithChange=b);b=A(a,"reappendInitSegmentAfterAbort");null!=b&&(this.f.reappendInitSegmentAfterAbort=b);b=A(a,"liveSendPushHeaders");null!=b&&(this.f.liveSendPushHeaders=b);b=B(a,"liveMaxManifestFetchesWithPush");null!=b&&(this.f.liveMaxManifestFetchesWithPush=b);b=B(a,"liveMaxSegmentsToPush");null!=b&&(this.f.liveMaxSegmentsToPush=b);b=B(a,"segmentRequestTimeout",0);null!=b&&(this.f.segmentRequestTimeout=
b);b=Xa(a,"preferredLanguage");null!=b&&(this.f.preferredLanguage=b);b=Ya(a,"restrictions",ka);null!=b&&(this.f.restrictions=b.clone());b=a.liveInitialPushRepresentation;null!=b&&(this.f.liveInitialPushRepresentation=b);b=a.liveAudioPushRepresentation;null!=b&&(this.f.liveAudioPushRepresentation=b);b=a.useInlineInitSegment;null!=b&&(this.f.useInlineInitSegment=b);b=A(a,"disableCacheBustingEvenThoughItMayAffectBandwidthEstimation");null!=b&&(Nc=!b);b=A(a,"currentTimeDuringReadyStateZeroThrows");null!=
b&&(this.f.currentTimeDuringReadyStateZeroThrows=b);b=B(a,"liveDataFetchMaxRetries");null!=b&&(this.f.liveDataFetchMaxRetries=b);b=B(a,"liveSourceBufferClearMaxRetries");null!=b&&(this.f.liveSourceBufferClearMaxRetries=b);b=A(a,"useLongCacheForManifest");null!=b&&(this.f.useLongCacheForManifest=b);b=A(a,"jumpToEarliestPositionInCurrentBlock");null!=b&&(this.f.jumpToEarliestPositionInCurrentBlock=b);b=A(a,"ignoreMinBufferTime");null!=b&&(this.f.ignoreMinBufferTime=b);b=B(a,"playheadFragmentedGapDiffAllowance");
null!=b&&(this.f.playheadFragmentedGapDiffAllowance=b);b=A(a,"fixBufferingGoalDetermination");null!=b&&(this.f.fixBufferingGoalDetermination=b);b=A(a,"skipEmptySegments");null!=b&&(this.f.skipEmptySegments=b);(b=A(a,"useMicroTaskTimeouts"))&&(this.f.useMicroTaskTimeouts=b);(b=A(a,"enableRequestPipelining"))&&(this.f.enableRequestPipelining=b);(b=A(a,"enableStreaming"))&&(this.f.enableStreaming=b);(a=A(a,"enableContentProtection"))&&(this.f.enableContentProtection=a);this.c&&this.c.bc(this.f)}};
W.prototype.configure=W.prototype.oa;W.prototype.Ga=function(a){this.c&&this.c.fc(a)};W.prototype.setEnableLiveheadCatchup=W.prototype.Ga;W.prototype.xa=W.prototype.isLiveheadCatchupEnabled=W.prototype.xa;
function Ze(a){var b=a.c?a.c.rb():null;if(b)for(var c=ShakaConstants.numbers.skip_manifest_gap_boundary_precision_ms/1E3,d=b.Ya,e=a.b.playbackRate,f=a.b.currentTime,g=0;g<d.length;++g){var h=d[g].startTime-c,k=d[g].endTime+c;f<=k&&f>=h&&(0<=e?b.end>k&&(a.b.currentTime=k):b.start<h&&(a.b.currentTime=h))}}W.prototype.da=function(){var a=this.c&&this.c.rb();return(a=a&&{start:a.start,end:a.end,last:a.last,seekRangeGaps:a.Ya})||null};W.prototype.getVideoSourceStreamLimits=W.prototype.da;
W.prototype.ua=function(){return this.f};W.prototype.getConfiguration=W.prototype.ua;unction Ye(a){var b;a.j.getBool("www_videos_extended_spl_logging_for_connected_tv",!1)&&a.a&&(b=a.a.getOperationLogger("start_watchdog"));Qe(a);a.H=setTimeout(a.F.bind(a),100);b&&b.log()}
function Qe(a){var b;a.j.getBool("www_videos_extended_spl_logging_for_connected_tv",!1)&&a.a&&(b=a.a.getOperationLogger("cancel_watchdog"));a.H&&(clearTimeout(a.H),a.H=null);b&&b.log()}W.prototype.I=function(a,b,c){this.o=null;var d=(Date.now()-b)/1E3*c;this.b.currentTime<this.K+(this.M()?1:.05)?this.b.pause():(d=Math.max(this.K,a+d),this.b.currentTime=d,this.o=setTimeout(this.I.bind(this,a,b,c),250))};
function Pe(a,b){if(a.A){t.end("buffering");null!==a.C&&(a.C=null);a.s&&(a.s.setConcluder(b).log(),a.s=null);if(a.G){var c=Date.now();a.G.setEvent("buffering").setClientTimeBegin(Math.round(c-t.get("buffering"))).setClientTimeEnd(Math.round(c)).log()}a.w&&(a.b.playbackRate=a.m);a.h=!1;a.dispatchEvent(x({type:"bufferingEnd"}));a.B&&(a.B=!1,dispatchDomEvent(a.b,"playing"));a.v=!1}}W.prototype.ba=W.prototype.dispatchEventExtern=W.prototype.ba;
W.prototype.F=function(a){if(!this.i){Ye(this);var b=a?a.type:"",c="waiting"===b;if(!this.b.ended&&!this.b.seeking||c){var d;this.j.getBool("www_videos_extended_spl_logging_for_connected_tv",!1)&&this.a&&(d=this.a.getOperationLogger("watchdog"));var e=this.b.buffered,f=e.length?e.end(e.length-1):0,e=Math.max(f-this.b.currentTime,0),g=this.b.currentTime,h=this.j.getNumber("www_videos_shaka_use_xbox_buffered_fudge_factor",.05),k=this.M()?ShakaConstants.numbers.live_buffering_underflow_threshold:ShakaConstants.numbers.buffering_underflow_threshold,
l=this.b.duration,h=isNaN(l)?0:Math.max(l-h,0),f=f>=h||g>=h,b=b||"watchdog_timer";this.h?(bf(this,a),a=cf(this.c),c=0<a?e/a:0,e>a||df(this.c)||f?(Pe(this,b),this.S&&!this.w&&this.b.play()):this.C!==c&&(this.C=c,this.dispatchEvent(x({type:"bufferingProgress",progress:c})))):(this.b.paused&&!c||!(!f&&e<k||!this.A)||(this.h=!0,this.w?this.b.playbackRate=0:this.b.pause(),this.a&&!this.s&&(e=this.b.buffered,e=e.length?e.end(e.length-1):0,e=Math.max(e-this.b.currentTime,0),e=1E3*(cf(this.c)-e),this.s=this.a.getOperationLogger("buffering").setLength(Math.round(e)).setType(this.v?
"start/unpause":"in_play").setInitiator(b).start()),t.ka("buffering"),this.dispatchEvent(x({type:"bufferingStart"})),Ze(this),bf(this,a)),df(this.c)&&Pe(this,b));d&&d.log()}else bf(this,a)}};W.prototype.ea=function(a){this.dispatchEvent(a)};W.prototype.aa=function bf(a,b){b&&"playing"===b.type&&(a.B=!0,eventKill(b))}W.prototype.na=function(a){if(this.c){var b=this.c;b.c.video&&b.c.video.Bc(a)}};W.prototype.setVideoStreamOffset=W.prototype.na;function ef(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d){for(var e=c.a[d],f=e,g=/video\/webm; codecs="av01.*"/,h=!1,k=0;k<f.u.length;++k){var l=f.u[k];Ee(Dd(l))?g.test(Dd(l))&&(h=!0):(f.u.splice(k,1),--k)}if(h)for(k=0;k<f.u.length;++k)l=f.u[k],g.test(Dd(l))||(f.u.splice(k,1),--k);0==e.u.length&&(c.a.splice(d,1),--d)}for(b=0;b<a.length;++b)for(c=a[b],d=0;d<c.a.length;++d)c.a[d].u.sort(ff)}
function ff(a,b){var c=a.bandwidth||Number.MAX_VALUE,d=b.bandwidth||Number.MAX_VALUE;return c<d?-1:c>d?1:0};f.prototype.destroy=gf.prototype.update=function(a){var b=kf(a),c=kf(this.a);return Promise.all([b,c]).then(I(this,function(b){var c=b[0];b=b[1];ef(this.a.a);a.b&&!this.a.b&&(a.i=!0);a.c=this.a.c;a.g=this.a.g?this.a.g.clone():null;a.f=this.a.f;var f=[];lf(a,this.a,c,b,f);ef(a.a);return Promise.resolve(f)}))};
function kf(a){ar c=a.a.map(function(a){return a.a}).reduce(b,[]).map(function(a){return a.u}).reduce(b,[]);a=c.map(function(a){return a.O.create()});a=Promise.all(a);return a.then(function(a){for(var b={},f=0;f<c.length;++f)b[c[f].P]=a[f];return Promise.resolve(b)})}
function lf(a,b,c,d,e){var f=new C;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new C;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=ab(f);for(b=0;b<a.length;++b){var h=a[b],k=f.get(h);1<k.length||(h=g.get(h))&&0!=h.length&&1==h.length&&(mf(k[0],h[0],c,d,e),k[0].duration=h[0].duration)}}
function mf(a,b,c,d,e){var f=new C;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new C;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=ab(f);for(b=0;b<a.length;++b){var h=a[b],k=f.get(h);1<k.length||(h=g.get(h))&&0!=h.length&&1==h.length&&nf(k[0],h[0],c,d,e)}}
function nf(a,b,c,d,e){var f=new C;a.u.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new C;b.u.forEach(function(a,b){g.push(a.id||""+b,a)});b={};for(var h=ab(f),k=0;k<h.length;++k){var l=h[k];b[l]=l;var m=f.get(l);1<m.length||((l=g.get(l))&&0!=l.length?1==l.length&&(of(m[0],l[0],c,d),m[0].X=l[0].X,l[0].X=null,m[0].a=l[0].a):(e.push(m[0]),a.u.splice(a.u.indexOf(m[0]),1)))}h=ab(g);for(k=0;k<h.length;++k)l=h[k],b[l]||(b[l]=l,l=g.get(l),a.u.push(l[0]))}
function of(a,b,c,d){a=c[a.P];d=d[b.P];(b=a.length())&&a.last();a.A(d)&&(d=a.length(),a.h.push(b!==d||!1),50<a.h.length&&a.h.shift())};function X(){this.a=this.b=null;this.f=new bb;this.c=Number.POSITIVE_INFINITY;this.i=!0;this.g=!1}q("shaka.media.SimpleAbrManager",X);X.prototype.destroy=X.prototype.initialize=
X.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4E3,D(this.f,this.b.getEstimator(),"bandwidth",this.l.bind(this)),D(this.f,this.a,"adaptation",this.j.bind(this)),D(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)};X.prototype.enable=function(a){this.i=a};X.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var a=pf(this);return a?a.id:null};X.prototype.getInitialSwitchReason=function(){return null};X.prototype.getInitialAudioTrackId=
X.prototype.selectVideoTrack=function(a,b,c){this.g&&this.a.selectVideoTrack(a.id,b,c)};X.prototype.l=function(){Date.now()<this.c||this.h()};X.prototype.h=function(){if(this.i){var a=pf(this);if(a){if(a.active){this.c=Date.now()+3E3;return}this.selectVideoTrack(a,!1)}this.c=Number.POSITIVE_INFINITY}};X.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3E4)};
function pf(a){var b=a.a.R();if(0==b.length)return null;b.sort(va);var c;a:{c=a.a.pa();for(var d=0;d<c.length;++d)if(c[d].active){c=c[d];break a}c=null}c=c?c.bandwidth:0;a=a.b.getBandwidth();for(var d=b[0],e=0;e<b.length;++e){var f=b[e],g=e+1<b.length?b[e+1]:{bandwidth:Number.POSITIVE_INFINITY};if(f.bandwidth&&(g=(g.bandwidth+c)/.85,a>=(f.bandwidth+c)/.95&&a<=g&&(d=f,d.active)))break}return d};function Y(a,b,c,d){E.call(this,null);this.b=a;this.j=b;this.pb=c;this.ub=new VideoPlayerLocalBandwidthEstimator(this,c,b);this.i=new bb;this.h=new MediaSource;this.T=this.video=null;this.qb=0;this.ec=this.Sb=!1;this.Ab=ha;this.Gb=this.M=this.ga=this.a=null;this.xb=3;this.ma=this.Tb=this.wa=this.va=!1;this.Ga=0;this.l=new VideoPushTracker;this.Y=null;this.ac=1;this.Zb=Infinity;this.Nb=this.Lb=!1;this.ja=this.Fa=null;this.Pb=this.Ob=this.xa=this.Wb=this.fa=!1;this.f=new C;this.w=d;this.w.initialize(this.ub,
this);this.I=!1;this.L="en";this.qa=!1;this.H=new H;this.vb=new H;this.o=new ka;this.B=null;this.c={};this.na=new H;this.Ea=0;this.Xa=15E3;this.m=null;this.Yb=!1;this.Xb=0;this.Ib=!1;this.A={};this.da=this.ca=this.K=null;this.g={};this.S=!1;this.j.getNumber("buffering_overflow_threshold",0);this.Hb=null;this.s={};this.v={};this.aa=null;this.ba=[];this.Z=this.G=null;this.F=new NetworkStatusDetector;this.$b=!1;this.ha=!0;this.V=!1;this.ic=new SubscriptionsHandler;this.Rb=!1;this.hc=1;this.ea=null;this.ic.addSubscriptions(this.F.addListener("networkInterrupted",
this.Lc,this),this.F.addListener("networkResumed",this.Mc,this),this.F.addListener("systemWake",this.Nc,this))}r(Y,E);q("shaka.player.StreamVideoSource",Y);Y.prototype.Qb=Y.prototype.getStreamDebug=Y.prototype.Qb;Y.prototype.Hc=function(){return this.b?this.b.s:"none"};Y.prototype.getMpdAudioConfig=Y.prototype.Hc;
Y.prototype.bc=function(a){null!=a.streamBufferSize&&(this.g.streamBufferSize=a.streamBufferSize);null!=a.initialStreamBufferSize&&(this.g.initialStreamBufferSize=a.initialStreamBufferSize);null!=a.dynamicStreamBufferSize&&(this.g.dynamicStreamBufferSize=a.dynamicStreamBufferSize);null!=a.smartBufferAdjustmentParams&&(this.g.smartBufferAdjustmentParams=a.smartBufferAdjustmentParams);null!=a.addCdnDebugQueryParameters&&(this.g.addCdnDebugQueryParameters=a.addCdnDebugQueryParameters);null!=a.segmentRequestTimeout&&
(this.g.segmentRequestTimeout=a.segmentRequestTimeout);null!=a.resolveVideoTimeUpdateOnFragmentedTimeRanges&&(this.g.resolveVideoTimeUpdateOnFragmentedTimeRanges=a.resolveVideoTimeUpdateOnFragmentedTimeRanges);null!=a.reappendInitSegmentAfterAbort&&(this.g.reappendInitSegmentAfterAbort=a.reappendInitSegmentAfterAbort);null!=a.liveDataFetchMaxRetries&&(this.g.liveDataFetchMaxRetries=a.liveDataFetchMaxRetries);null!=a.liveSourceBufferClearMaxRetries&&(this.g.liveSourceBufferClearMaxRetries=a.liveSourceBufferClearMaxRetries);
null!=a.playheadFragmentedGapDiffAllowance&&(this.g.playheadFragmentedGapDiffAllowance=a.playheadFragmentedGapDiffAllowance);null!=a.fixBufferingGoalDetermination&&(this.g.fixBufferingGoalDetermination=a.fixBufferingGoalDetermination);null!=a.skipEmptySegments&&(this.g.skipEmptySegments=a.skipEmptySegments);null!=a.useMicroTaskTimeouts&&(this.g.useMicroTaskTimeouts=a.useMicroTaskTimeouts);qf(this);null!=a.includeStreamBufferSizeInStartOffset&&(this.Sb=Boolean(a.includeStreamBufferSizeInStartOffset));
null!=a.liveAudioPushRepresentation&&(this.ja=String(a.liveAudioPushRepresentation));null!=a.liveInitialPushRepresentation&&(this.Fa=String(a.liveInitialPushRepresentation));null!=a.enableAdaptation&&this.w.enable(Boolean(a.enableAdaptation));null!=a.mpdRequestTimeout&&(this.Ab=Number(a.mpdRequestTimeout));null!=a.minMpdRefreshInterval&&(this.xb=Number(a.minMpdRefreshInterval)/1E3);null!=a.enableManifestDebug&&(this.Nb=!!a.enableManifestDebug);null!=a.liveStreamEndTimeout&&(this.Xa=Number(a.liveStreamEndTimeout));
null!=a.preferredLanguage&&(this.L=Ra(String(a.preferredLanguage)));null!=a.liveSendPushHeaders&&(this.ma=Boolean(a.liveSendPushHeaders));null!=a.liveMaxManifestFetchesWithPush&&(this.Ga=Number(a.liveMaxManifestFetchesWithPush));null!=a.currentTimeDuringReadyStateZeroThrows&&(this.Lb=Boolean(a.currentTimeDuringReadyStateZeroThrows));null!=a.liveMaxSegmentsToPush&&(this.Zb=Number(a.liveMaxSegmentsToPush));null!=a.jumpToLiveThreshold&&(this.Xb=Number(a.jumpToLiveThreshold));null!=a.restrictions&&(this.o=
a.restrictions,this.I&&rf(this));null!=a.useLongCacheForManifest&&(this.fa=Boolean(a.useLongCacheForManifest));null!=a.jumpToEarliestPositionInCurrentBlock&&(this.Wb=Boolean(a.jumpToEarliestPositionInCurrentBlock));null!=a.ignoreMinBufferTime&&(this.xa=Boolean(a.ignoreMinBufferTime));null!==a.enableRequestPipelining&&(this.Ob=Boolean(a.enableRequestPipelining));null!==a.enableStreaming&&(this.Pb=Boolean(a.enableStreaming))};
Y.prototype.destroy=function(){this.H.destroy();this.na.destroy();this.na=this.H=null;this.ca&&(clearTimeout(this.ca),this.ca=null);this.K&&(clearTimeout(this.K),this.K=null);this.A=null;this.i.destroy();this.i=null;Va(this.c).forEach(function(a){a.destroy()});this.f=this.c=null;this.b&&(this.b.destroy(),this.b=null);this.w.destroy();this.za=this.o=this.video=this.h=this.pb=this.w=null;Object.keys(this.s).forEach(function(a){(a=this.s[a])&&a.disable()}.bind(this));this.s={};Object.keys(this.v).forEach(bind(this));this.v={};this.G&&(this.G.disable(),this.G=null);this.aa&&(this.aa.cleanup(),this.aa=null);for(var a=0;a<this.ba.length;a++)this.ba[a].cleanup();this.ba=[];this.ic.release()};function Ue(a,b){if(a.a){var c=a.a.getOperationLogger("media_source_open").start();a.vb.then(}D(a.i,a.h,"sourceopen",a.ad.bind(a));b.src=window.URL.createObjectURL(a.h)}n=Y.prototype;n.oc=function(){};
function Xe(a,b,c){var d;a.a&&(d=a.a.getOperationLogger("source_attach").start());if(!a.I)return a=Error("Cannot call attach() right now."),a.type="app",d&&d.setError(a).log(),Promise.reject(a);a.za=b;a.video=c;a.T=null;D(a.i,a.video,"loadedmetadata",a.$c.bind(a));D(a.i,a.pb,"bandwidth",a.yd.bind(a));a.b.b&&(D(a.i,b,"bufferingStart",a.Wc.bind(a)),D(a.i,b,"bufferingEnd",a.Vc.bind(a)));b=a.j.getBool("enable_content_protection",!1)?(b=a.video.mediaKeys)&&a.video.setMediaKeys?a.video.setMediaKeys(b):
Promise.resolve():Promise.resolve();sf(a).then(I(a,function(){d&&this.J()&&d.setLiveheadPosition(tf(uf(this)));this.H&&this.H.resolve();this.oc()})).catch(I(a,);return Promise.all([a.H,b]).then(function(){d&&d.log()})}
n.kb=function(){if(this.I){var a=Error("Cannot call load() right now.");a.type="app";return Promise.reject(a)}if(!this.b||0==this.b.a.length)return a=Error("The manifest does not specify any content."),a.type="stream",Promise.reject(a);ef(this.b.a);if(0==this.b.a.length||0==this.b.a[0].a.length||!this.b.a[0].a.some()return a=Error("The manifest specifies content that cannot be displayed on this browser/platform."),a.type="stream",Promise.reject(a);this.I=
!0;this.xa||(this.g.initialStreamBufferSize=Math.max(this.g.initialStreamBufferSize||0,this.b.f));this.ga&&this.ga.setStreamType(this.b.v);qf(this);rf(this);return Promise.resolve()};function vf(a){var b=x({type:"manifestwrapped",bubbles:!0});a.dispatchEvent(b)}function wf(a,b){var c=x({type:"liveheadIdleAt",seconds:b,bubbles:!0});a.dispatchEvent(c)}function tf(a){return Math.min.apply(Math,a.map(function(a){return a.length()?a.last().endTime:null}).filter()}
n.Bb=function(a,b){var c;this.M&&(this.M.log(),this.M=null);this.a&&(c=this.a.getOperationLogger("update_manifest").start());if(!b||this.I){var d=Date.now(),e=this.K=null,f,g;if(this.ma&&(!this.Ga||this.Ga>this.ac)){f=Math.floor(xf(this))+1;f=Math.min(f,this.Zb);var h=this.c.video;if(h=h?h.wb():null)h=h.last(),null!=h.unscaledStartTime&&(g=h.unscaledStartTime);if(this.video.paused||this.S)f=0}f&&this.ac++;h=this.b.g;h=h.clone();c&&!a&&c.setResource(h.toString());(a?this.qc():this.rc(h,f,g)).then(I(this,
function(b){a||this.F.informNetworkResumed();e=new gf(b);var c;this.a&&(c=this.a.getOperationLogger("update_manifest_info").start());b=e.update(this.b);b.then(function(){c&&c.log()},.catch(function(){});return b})).then(I(this,function(a){e.destroy();e=null;var f=uf(this);this.Ba("SegmentIndexesUpdated",f);var h=ShakaConstants.numbers.live_playhead_idle_all_stream_threshold,g=ShakaConstants.numbers.live_playhead_idle_single_stream_threshold;if(uf(this).every(function(a){return a.s()>=
h})||uf(this).some(){var u=tf(f);wf(this,u)}f.some(function(a){return a.fb()})&&vf(this);u=yf(this,f);c&&this.J()&&c.setLiveheadPosition(tf(f));c&&c.setManifestType(this.b.b?"dynamic":"static").setUpdatePeriod(null===this.b.c?null:Math.ceil(1E3*this.b.c));this.ha&&zf(this,u);if(df(this))return c&&c.log(),this.Ua();for(f=0;f<a.length;++f)Af(this,a[f]);this.xa||(this.g.initialStreamBufferSize=Math.max(this.g.initialStreamBufferSize||0,this.b.f));this.g.useInitialBufferSizeWhenPaused=
this.b.b;qf(this);rf(this);0==Object.keys(this.c).length?sf(this):(a=Date.now(),b||Bf(this,(a-d)/1E3));c&&c.log();this.hb()&&extractCEA608.prepare();a=this.hb();this.Rb!==a&&(f=x({type:"cea608AvailabilityChanged",bubbles:!0}),this.dispatchEvent(f),this.Rb=a)})).catch(I(this,function(a){c&&c.setError(a).log();e&&(e.destroy(),e=null);if(!b){var d=[0,410];d.push(417,200);d=d.concat([502,503]);d=-1===d.indexOf(a.status);if("net"===a.type&&!d)switch(a.status){case 410:this.$b=!0;this.m&&(clearTimeout(this.m),
this.m=null);this.Ua();break;case 200:case 417:a.responseHeaders&&null!=a.responseHeaders["x-fb-video-replica"]?this.dispatchEvent(x({type:"replicaswitch",bubbles:!0,replica:a.responseHeaders["x-fb-video-replica"],url:a.url,status:a.status})):d=!0;break;default:Bf(this,0)}0===a.status?this.F.informNetworkInterrupted():this.F.informNetworkResumed();"delay"==a.type?Bf(this,0):d&&"aborted"!=a.type&&(a=z(a),this.dispatchEvent(a),this.b&&Bf(this,0))}}))}};n.rc=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};
n.qc=function zf(a,b){b&&a.b&&a.b.b&&(a.V?b.end>a.video.currentTime+10&&(a.V=!1,a.video.currentTime=b.end):a.video.paused&&b.end>a.video.currentTime+10&&(a.V=!1,a.video.currentTime=b.end))}
function Bf(a,b){if(null==a.b.c)ODS.bumpEntityKey(2966,"videos.www.live","update_period_is_null");else if(!a.wa){var c=Math.max(a.b.c,a.xb),c=Math.max(c-b,0),d=a.Bb.bind(a,!1);!c&&a.g.useMicroTaskTimeouts?Promise.resolve().then(d):(a.M&&a.M.setResult("failed").log(),a.a&&(a.M=a.a.getOperationLogger("schedule_manifest_update").start().setUpdatePeriod(Math.ceil(1E3*c))),a.K=setTimeout(d,1E3*c))}}
function Af(a,b){var c=Cd(b),d=a.c[c];if(d&&d.Na()==b){var e=a.f.get(Cd(b)).map(function(a){return a.u}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return a.ia&&a.W});if(0==e.length){c=Error("All usable streams have been removed from the manifest.");c.type="app";c=z(c);a.dispatchEvent(c);return}a.A[c].Dc==b&&delete a.A[c];d.ab(e[0],!0);b.destroy()}b.destroy()}n.ud=function(a){this.Hb=a};Y.prototype.setTaggedTimeRanges=Y.prototype.ud;
Y.prototype.od=function(){return 0===Object.keys(this.c).length?!1:["audio","video"].every(I(this,)};Y.prototype.hasHitBufferingGoal=Y.prototype.od;
Y.prototype.R=function(a){if(!this.f||!this.f.a.hasOwnProperty("video"))return[];a=a&&a.useLocalBitrate||!1;var b=this.c.video,c=b?b.Na():null,d=c?c.P:0,e=1,f=null;this.J()&&null!=b&&(f=b.ba(),null!=c&&0<c.bandwidth&&(e=f/c.bandwidth));for(var c=[],g=this.f.get("video"),h=0;h<g.length;++h)for(var k=g[h],l=0;l<k.u.length;++l){var m=k.u[l];if(m.ia&&m.W){var p=null;if(a&&null!==m.O){var u=m.O.c();this.J()||null===u||null===b?p=null:(p=fe(b,this.video.currentTime,u),u.getSegments(),p=LocalBitrateHelper.getLocalBitrate(u.getSegments(),
p,ShakaConstants.numbers.local_bitrate_segments_ahead))}u=m.P;p=p||m.bandwidth;null!=f&&(u===d?p=Math.max(p,f):1<e&&(p=p*e),p=Math.round(p));m=new ua(u,p,m.width,m.height,m.id,m.fbQualityLabel,m.fbQualityClass,m.f,m.frameRate,m.mimeType,m.codecs,m.g,m.h);u==d&&(m.active=!0);c.push(m)}}return c};Y.prototype.getVideoTracks=Y.prototype.R;
Y.prototype.Ic=function(){if(this.Y)return this.Y;if(!this.b)return null;for(var a=0;a<this.b.a.length;++a)for(var b=this.b.a[a],c=0;c<b.a.length;++c)if(this.Y=b.a[c].c)return this.Y;return null};Y.prototype.getVideoProjection=Y.prototype.Ic;Y.prototype.Gc=function(){return this.ub};Y.prototype.getLocalEstimator=Y.prototype.Gc;function Cf(a){a=a.R();for(var b=0;b<a.length;b++)if(a[b].active)return a[b]}
Y.prototype.pa=function(){if(!this.f||!this.f.a.hasOwnProperty("audio"))return[];for(var a=this.c.audio,a=(a=a?a.Na():null)?a.P:0,b=[],c=this.f.get("audio"),d=0;d<c.length;++d)for(var e=c[d],f=e.lang,g=0;g<e.u.length;++g){var h=e.u[g];if(h.ia&&h.W){var k=h.P,h=new ea(k,h.bandwidth,f,h.id,h.mimeType,h.codecs,this.b.o,h.c);k==a&&(h.active=!0);b.push(h)}}return b};Y.prototype.getAudioTracks=Y.prototype.pa;
Y.prototype.cc=function(){if(!this.f||!this.f.a.hasOwnProperty("text"))return[];for(var a=this.c.text,b=a?a.Na():null,b=b?b.P:0,c=[],d=this.f.get("text"),e=0;e<d.length;++e)for(var f=d[e],g=f.lang,h=0;h<f.u.length;++h){var k=f.u[h].P,l=new ta(k,g);k==b&&(l.active=!0,l.enabled=a.sb());c.push(l)}return c};Y.prototype.getTextTracks=Y.prototype.cc;Y.prototype.Ub=function(){return this.b&&this.b.l&&0<this.b.l?!0:!1};Y.prototype.isUsingASRCaptions=Y.prototype.Ub;
Y.prototype.Vb=function(){return this.b&&this.b.m&&0<this.b.m&&gkx("1176251")?!0:!1};Y.prototype.isUsingASRCaptionsEmployeeDogfooding=Y.prototype.Vb;function cf(a){var b=Number(a.g.initialStreamBufferSize);a.g.fixBufferingGoalDetermination&&(b=1);var c=a.j.getNumber("buffering_overflow_threshold",0);0<c&&(b=c);return a.Tb?Number(a.g.streamBufferSize):b}
function De(a){if(a.I){a=a.b.a[0];for(var b=[],c=0;c<a.a.length;++c)b.push.apply(b,Gd(a.a[c]));a=b}else a=[];return a}
function Fe(a,b){if(a.I){for(var c={},d=a.b.a[0],e=0;e<d.a.length;++e){var f=d.a[e];c[f.P]=f}a.f.a={};d=ab(b);for(e=0;e<d.length;++e){var f=d[e],g=b.get(f);if("video"==f){var h=g[0].id;a.f.push(f,c[h])}else if("audio"==f){if(0<g.length)for(var h=g[0].b.split(";")[0],k=0;k<g.length;++k){var l=g[k];l.b.split(";")[0]==h&&a.f.push(f,c[l.id])}}else for(k=0;k<g.length;++k)h=g[k].id,a.f.push(f,c[h])}a.qa=!0;if(c=a.f.get("audio"))Df(a,c),a.f.set("audio",c),c=c[0].lang||a.L,Qa(2,a.L,c)&&(a.qa=!1);if(c=a.f.get("text"))Df(a,
c),a.f.set("text",c),c=c[0].lang||a.L,Qa(2,a.L,c)||(a.qa=!1)}}Y.prototype.Oc=function(){this.va=!0};Y.prototype.setClearBufferAfterSeeking=Y.prototype.Oc;Y.prototype.selectVideoTrack=function(a,b,c,d,e){return $e(this,"video",a,b,c,d,e)};Y.prototype.resumeVideoFetching=function(){var a=this.c.video?this.c.video.J:null;a&&a.resumeVideoFetching()};Y.prototype.resumeVideoFetching=Y.prototype.resumeVideoFetching;Y.prototype.rd=function(){var a=this.c.video?this.c.video.J:null;a&&a.stopUntilSegmentsUpdate()};
Y.prototype.stopUntilVideoStreamSwitch=Y.prototype.rd;function af(a,b){var c=a.c.text;c&&c.jb(b)}
function rf(a){if(a.o){for(var b=!1,c=0;c<a.b.a.length;++c)for(var d=a.b.a[c],e=0;e<d.a.length;++e){var f=d.a[e];if("video"==f.contentType)for(var g=0;g<f.u.length;++g){var h=f.u[g],k=h.W;h.W=!0;a.o.maxWidth&&h.width>a.o.maxWidth&&(h.W=!1);a.o.maxHeight&&h.height>a.o.maxHeight&&(h.W=!1);a.o.minHeight&&h.height<a.o.minHeight&&(h.W=!1);a.o.maxBandwidth&&h.bandwidth>a.o.maxBandwidth&&(h.W=!1);a.o.minBandwidth&&h.bandwidth<a.o.minBandwidth&&(h.W=!1);k!=h.W&&(b=!0)}}0!=$a(a.f).length&&b&&(Ef(a),0<a.R().length||
(b=Error("The application has restricted all video tracks!"),b.type="app",b=z(b),a.dispatchEvent(b)))}}Y.prototype.J=Y.prototype.isLive=Y.prototype.J;Y.prototype.Qc=function(a){this.Tb=a};Y.prototype.setIsLiveInterrupted=Y.prototype.Qc;Y.prototype.md=Y.prototype.forceResyncVideoBuffer=Y.prototype.md;
function Me(a,b){for(var c,d=!1,e=new C,f=$a(a.f),g=0;g<f.length;++g)for(var h=f[g],k=0;k<h.u.length;++k){var l=h.u[k];l.b.forEach(}for(c in b)if(f=Oa[b[c]]||null,h=e.get(c))for(g=0;g<h.length;++g)l=h[g],k=l.ia,l.ia=!f,k!=l.ia&&(d=!0);else hb(c);d&&(Ef(a),d=a.pa(),c=a.R(),d=a.f.a.hasOwnProperty("audio")&&0==d.length,c=a.f.a.hasOwnProperty("video")&&0==c.length,d||c)&&(c=Error("The key system has restricted all "+(d&&c?"audio and video tracks.":d?"audio tracks.":"video tracks.")),
c.type="drm",c=z(c),a.dispatchEvent(c))}function Ef(a){var b=x({type:"trackschanged",bubbles:!0});a.dispatchEvent(b)}function $e(a,b,c,d,e,f,g){g=!!g;if(!a.f.a.hasOwnProperty(b)||!a.c[b])return!1;for(var h=a.f.get(b),k=0;k<h.length;++k)for(var l=h[k],m=0;m<l.u.length;++m){var p=l.u[m];if(p.P==c){if(!p.ia||!p.W)return!1;if("text"!=b&&!a.Ib)return c=a.A[b],a.A[b]={Dc:p,jc:null!=c&&c.jc||d,kc:null!=c&&c.kc||e,switchReason:f,Aa:g},!0;a.c[b].ab(p,d,e,f,g);return!0}}return!1}
function Df(a,b){for(var c=0;2>=c;++c)for(var d=0;d<b.length;++d){var e=b[d];if(Qa(c,a.L,e.lang)){b.splice(d,1);b.splice(0,0,e);return}}for(d=0;d<b.length;++d)if(e=b[d],e.f){b.splice(d,1);b.splice(0,0,e);break}}n=Y.prototype;n.ad=
function sf(a){var b;a.a&&(b=a.a.getOperationLogger("start_streams").start());for(var c=[],d=["audio","video","text"],e=0;e<d.length;++e){var f=d[e];a.f.a.hasOwnProperty(f)&&c.push(a.f.get(f)[0])}for(var g=Ff(a,c),e=0;e<d.length;++e)if(f=d[e],a.f.a.hasOwnProperty(f)&&!g[f])return a=Error("Unable to select an initial "+f+" stream: all "+f+" streams have been restricted (by the application or by the key system)."),a.type="stream",b&&b.setError(a).log(),Promise.reject(a);c=Va(g).map(;
c.push(a.vb);return Promise.all(c).then(I(a,function(a){a.pop();if(!a.every(function(a){return a.length()}))return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);a=yf(this,a);if(!a)return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);if(!Gf(this,g))return a=Error("Failed to create Stream objects."),a.type="stream",Promise.reject(a);this.w.start();Hf(this,g,a);return Promise.resolve()})).then(function(){b&&b.log()}).catch(I(a,function(a){if("aborted"==
a.type)b&&b.setError(a).log();else{Object.keys(this.c);if(this.b.b)return ya()<this.b.j?(a=Math.max(this.b.j-Date.now()/1E3,this.xb),this.K=setTimeout(this.Bb.bind(this,!0),1E3*a)):Bf(this,0),b&&b.log(),Promise.resolve();b&&b.setError(a).log();return Promise.reject(a)}}))}
function Ff(a,b){for(var c={},d=0;d<b.length;++d){var e=b[d],f=null;if("video"==e.contentType){var g=a.w.getInitialVideoTrackId();if(null==g)continue;f=e.u.filter(function(a){return a.P==g});if(0==f.length)continue;f=f[0]}else if("audio"==e.contentType)if(g=a.w.getInitialAudioTrackId(),f=e.u.filter(,0==f.length){f=e.u.filter(;if(0==f.length)continue;f=e.u[Math.floor(f.length/2)]}else f=f[0];else 0<e.u.length&&(f=e.u[0]);c[e.contentType]=f}return c}
function Gf(a,b){var c={},d;for(d in b){var e=b[d],e="text"==d?new je(a,a.video):If(a,e);if(!e)return Va(c).forEach(,!1;c[d]=e}a.dc(a.ec);a.c=c;return!0}
function If(a,b){var c=Dd(b),d;d=c.split(";")[0];d="v"===d.charAt(0)?"video":"a"===d.charAt(0)?"audio":null;var e=null,f=a.ub,g=null,h=null;a.Pb&&canUseFetchStream()?(h=new MultipleSegmentsProvider(a.j.getNumber("streaming_segment_size",4)),g=Jf(a,h,d,f)):a.Ob&&("video"===d?(e=a.s[d],e||(e=new SegmentRequestManager(a.j,d,a.J()?VideoPriorityCalculator.calculateLive:VideoPriorityCalculator.calculate,a.a,f,a.Gb,a.l,a.ga),a.aa&&e.updatePriorityWithNewAdjustment(a.aa.getPriorityAdjustment()),a.s[d]=e)):
e=null);a.f.get(d);c=new U(a,a.video,a.j,a.h,c,f,a.Hb,a.l,0,a.F,e,g,h,a.ga);c.fa(a.g);return c}function Jf(a,b,c,d){var e=a.v[c];if(!e&&"audio"!==c){var e=new VideoStreamingManager(a.j,b,c,a.a,a.ba),f="video"===c;f&&e.addListener("bandwidthUpdate",function(a){d.sample(a.timeTaken,a.bytesRead,f,{timeToLastByte:a.timeTaken},this.Gb,this.a,!1)}.bind(a))}e&&(a.v[c]=e);return e||null}function Kf(a,b){a.video.currentTime=b;a.video.currentTime+1<b&&Lf(a,b);a.B=b}
function Hf(a,b,c){a.video.playbackRate=0;Mf(a,c);var d;d=a.b.h;(!ShakaConstants.numbers.templated_adjust_stream_limits_start_offset_int&&!ShakaConstants.numbers.templated_jump_to_live_sidx_end_offset||!d)&&a.da&&a.da<=c.end&&a.da>=c.start?d=a.da:a.b.b?(d=Nf(a,c),a.Yb=!0):d=c.start;D(a.i,a.video,"seeking",a.ed.bind(a));a.G?(a.G.setOnPlaying(a.bb.bind(a,!0)),a.G.setOnPaused(a.bb.bind(a,!1)),a.G.enable()):(D(a.i,a.video,"playing",a.bb.bind(a,!0)),D(a.i,a.video,"play",a.bb.bind(a,!0)),D(a.i,a.video,
"pause",a.bb.bind(a,!1)));D(a.i,a.video,"seeking",a.Ec.bind(a));D(a.i,a.video,"timeupdate",throttle(a.Ec.bind(a),ShakaConstants.numbers.scheduler_priority_update_interval));if(a.video.currentTime!=d)if(a.Lb)0!==a.video.readyState?Kf(a,d):Lf(a,d);else try{Kf(a,d)}catch(e){Lf(a,d)}Of(a,c.start,c.end,c.last,c.Ya);var f=[],g;for(g in a.c){c=a.c[g];I(a,function(a){f.push(a.Cc(this.na).then(I(this,function(b){var c=a.gb();c>this.qb&&(this.qb=c);return b})))})(c);D(a.i,c,"ended",a.gd.bind(a));D(a.i,c,"should_end_all_streams",
a.hd.bind(a));D(a.i,c,"should_nudge",a.bd.bind(a));d=b[g];var h=a.w.getInitialSwitchReason()||void 0;c.ab(d,!1,void 0,h)}Promise.all(f).then(I(a,function(a){Pf(this)&&Qf(this,a)})).catch(I(a,function(a){"destroy"!=a.type&&(a=z(a),this.dispatchEvent(a))}));af(a,a.qa)}
n.bb=function(a){Object.keys(this.s).forEach(bind(this));Object.keys(this.v).forEach(bind(this));if(this.a){var b=yf(this,uf(this));b&&this.video.currentTime<b.start&&ODS.bumpEntityKey(2966,"videos.www.shaka","current_time_at_playing_less_than_stream_limits_start")}a&&null!==this.ea&&(this.hc=1,Rf(this,this.hc),Sf(this))};
n.Ec=function(){this.video&&(Object.keys(this.s).forEach(bind(this)),Object.keys(this.v).forEach(function(a){this.v[a].getPriorityUpdater().updatePriorityWithNewPlayhead(this.video.currentTime)}.bind(this)))};function Lf(a,b){a.T=b;for(var c in a.c){var d=a.c[c];a.T&&(d.F=a.T)}}function Pf(a){return!Object.keys(a.c).some(I(a,)}
function Qf(a,b){ba(b&&b.length==Object.keys(a.c).length);for(var c=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,e=0;e<b.length;++e)var f=b[e],c=Math.min(c,f),d=Math.max(d,f);c=uf(a);for(e=0;e<c.length;++e)c[e].Qa(d);Tf(a,c,d);var g=Va(a.c).map(,e=$a(a.f).map(function(a){return a.u}).reduce([]).filter(.map(I(a,function(a){var b=[a.O.lc?a.O.lc():a.O.create()];a.X&&b.push(a.X.create(this.a,this.l));
return Promise.all(b)}));Promise.all(e).then(I(a,function(a){for(var b=0;b<a.length;++b)a[b][0].Qa(d);this.Ib=!0;for(var c in this.A)a=this.A[c],this.c[c].ab(a.Dc,a.jc,a.kc,a.switchReason,a.Aa);this.A={}})).catch(I(a,function(a){"aborted"!=a.type&&(a=z(a),this.dispatchEvent(a))}))}
function Tf(a,b,c){var d;a.j.getBool("www_videos_extended_spl_logging_for_connected_tv",!1)&&a.a&&(d=a.a.getOperationLogger("stream_video_source_begin_playback"));if(b=yf(a,b))Mf(a,b),Of(a,b.start,b.end,b.last,b.Ya);0!=c?(c=a.video.currentTime+c,a.j.getNumber("www_videos_nudge_timestamp_correction_s",0)&&(c+=a.j.getNumber("www_videos_nudge_timestamp_correction_s",0)),a.video.currentTime=c,a.B=c):a.Yb&&b&&(c=Nf(a,b),Math.abs(c-a.video.currentTime)>=a.Xb&&(a.video.currentTime=c));c=x({type:"allStreamsStarted",
bubbles:!0});a.dispatchEvent(c);a.b.b&&null!=a.b.c&&Bf(a,0);Uf(a);a.na.resolve();d&&d.log()}
function Nf(a,b){var c=b.end;void 0!==b.uc&&(c=b.uc);if(a.Wb){var d=a.video.currentTime,e=b.start;if(ShakaConstants.numbers.templated_adjust_stream_limits_start_offset_int&&a.b&&a.b.h){for(var f=uf(a),g=0,h=0;h<f.length;++h){var k=f[h],l=Math.min(ShakaConstants.numbers.templated_adjust_stream_limits_start_offset_int,k.length());k.length()&&0<l&&l<=k.length()&&(g=Math.max(k.get(k.length()-l).startTime,g))}e=Math.max(e,g)}if(d>=e&&d<=b.end&&d<c)if(ShakaConstants.numbers.templated_jump_to_live_sidx_end_offset&&
a.b&&a.b.h){f=uf(a);k=null;e=Number.POSITIVE_INFINITY;for(h=0;h<f.length;++h)f[h].length()<e&&(e=f[h].length(),k=f[h]);k&&e>ShakaConstants.numbers.templated_jump_to_live_sidx_end_offset&&(f=k.get(k.length()-ShakaConstants.numbers.templated_jump_to_live_sidx_end_offset).startTime,d>=f&&(c=d))}else c=d}return c}
function Mf(a,b){if(a.b.b)isNaN(a.h.duration)&&(a.h.duration=b.end+2592E3);else if(isNaN(a.h.duration)||b.end>a.h.duration){a.h.duration=b.end;for(var c=ShakaConstants.numbers.append_window_end_fudge_factor,d=0;d<a.h.sourceBuffers.length;++d)a.h.sourceBuffers[d].appendWindowEnd=b.end+c}}
n.kd=function(){this.ca=null;Uf(this);var a=yf(this,uf(this));if(a){var b=this.b.b;(b=b||this.b.i)&&this.Ea!=a.last&&(this.Ea=a.last,null!=this.m&&(clearTimeout(this.m),this.m=null));Of(this,a.start,a.end,a.last,a.Ya);this.video.paused||Vf(this,this.video.currentTime,a.start,a.end)}};function Of(a,b,c,d,e){b=x({type:"seekrangechanged",bubbles:!0,start:b,end:c,last:d,seekRangeGaps:e});a.dispatchEvent(b)}
n.ed=function(){var a=this.video.currentTime,b=yf(this,uf(this));this.a&&b&&a<b.start&&ODS.bumpEntityKey(2966,"videos.www.shaka","current_time_at_seek_less_than_stream_limits_start");if(null!=this.B){if(a>=this.B-.01&&a<=this.B+.01){this.B=null;this.a&&b&&a<b.start&&ODS.bumpEntityKey(2966,"videos.www.shaka","ignored_seek_when_current_time_at_seek_less_than_stream_limits_start");return}this.B=null}if(b){var c=b.end,d;(d=Vf(this,a,b.start,c))||(a<=c+.01||this.b.b&&!Wf(this,c)?d=!1:(this.video.currentTime=
c,d=!0));if(d)this.a&&a<b.start&&ODS.bumpEntityKey(2966,"videos.www.shaka","clamp_playhead_when_current_time_at_seek_less_than_stream_limits_start");else{for(var e in this.c)this.c[e].vc(this.va);this.va=!1}}};function Vf(a,b,c,d){if(b>=c-.01)return!1;b=0;a.b.b&&(b=.5,Wf(a,c+b)||(b=a.b.f));a.video.currentTime=Math.min(c+b,d);return!0}function Wf(a,b){for(var c in a.c)if(!a.c[c].Ac(b))return!1;return!0}n.gd=function(){if(!this.b.b||this.wa){for(var a in this.c)if(!this.c[a].Va())return;this.Ua()}};
n.hd=function(){clearTimeout(this.K);this.wa=!0;for(var a in this.c)this.c[a].Va()||this.c[a].nc()};n.bd=function(){this.B=this.video.currentTime;this.video.currentTime+=.001};n.hb=function(){if(this.Ub()||this.Vb())return!0;var a=this.b,b=null,c=null;a&&a.a&&a.a[0]&&(b=a.a[0]);b&&b.a&&b.a[0]&&(c=b.a[0]);return!!c&&c.b};Y.prototype.hasInlinedCea608Subtitles=Y.prototype.hb;Y.prototype.dc=function(a){this.ec=a;var b=this.c;"video"in b&&(a=a&&this.hb(),b.video.b.K=a)};
Y.prototype.setEnableCea608Parsing=Y.prototype.dc;function df(a){var b=ShakaConstants.numbers.live_buffering_underflow_threshold,c=a.$b,d=!1;if(a.b.i){var d=ShakaConstants.numbers.live_stream_end_slack,e;for(e in a.c)a.c[e].Va()||(d=0);d=a.video.currentTime+b+d>a.Ea}return c||d}n=Y.prototype;n.Wc=function(){this.S=!0;if(this.b&&this.b.b){if(df(this))return this.Ua();!this.F.isNetworkInterrupted()&&Va(this.c).every(function(a){return a.Va()})&&Xf(this,this.Xa)}};
function Xf(a,b){a.m=setTimeout(a.Ua.bind(a),b)}n.Vc=function(){this.S=!1;null!=this.m&&(clearTimeout(this.m),this.m=null)};n.$c=function(){null!==this.T&&(Kf(this,this.T),Lf(this,null))};n.yd=function(){};n.Ua=function(){this.S=!1;this.m=null;var a;a:{if(this.h)for(a=0;a<this.h.sourceBuffers.length;++a)if(this.h.sourceBuffers[a].updating){a=!0;break a}a=!1}if(a)return Xf(this,1E3);this.h&&"open"==this.h.readyState&&this.h.endOfStream()};
function uf(a){return Va(a.c).map(.filter(function(a){return null!=a})}function xf(a){return Math.max(a.b?a.b.f:1,a.Sb?a.g.streamBufferSize||0:0)}
function yf(a,b){for(var c=0,d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,f=0;f<b.length;++f){var g=b[f].w(),c=Math.max(c,g.start);null!=g.end&&(d=Math.min(d,g.end));b[f].length()&&(e=Math.min(e,b[f].last().endTime))}if(d==Number.POSITIVE_INFINITY)if(d=a.b.a[0],d.duration)d=(d.start||0)+d.duration;else return null;if(a.b.b){var f=xf(a),d=Math.max(d-f,c),h;a.ma&&b.length&&(g=Math.floor(xf(a)/1)+1,f=b[0],g=f.length()-g,(f=f.get(g))&&(h=f.startTime))}if(c>d)return null;d=Math.floor(1E5*d)/1E5;
return{start:c,end:d,last:e,Ya:[],uc:h}}n.rb=Y.prototype.computeStreamLimits=Y.prototype.rb;function Uf(a){a.b.b&&(a.ca=setTimeout(a.kd.bind(a),1E3))}function qf(a){for(var b in a.c)a.c[b].fa(a.g)}Y.prototype.gb=function(){return this.qb};Y.prototype.getLongestInitResponseTime=Y.prototype.gb;Y.prototype.Lc=function(){var a=x({type:"networkinterrupted",bubbles:!0});this.dispatchEvent(a);this.Z=this.Z||Date.now();this.S&&this.m&&clearTimeout(this.m)};
Y.prototype.Mc=function(){var a=x({type:"networkresumed",bubbles:!0});this.dispatchEvent(a);a=ShakaConstants.numbers.max_network_interrupted_time_before_seek;null!==this.Z&&Date.now()-this.Z>=a&&(this.Z=null,this.V=!0);this.S&&Xf(this,this.Xa)};Y.prototype.Nc=Y.prototype.fc=function(a){this.ha=a};Y.prototype.setEnableLiveheadCatchup=Y.prototype.fc;Y.prototype.pd=Y.prototype.isLiveheadCatchupEnabled=Y.prototype.pd;
Y.prototype.Kc=Y.prototype.getVideoStreamProgressTracker=Y.prototype.Kc;Y.prototype.eb=Y.prototype.getBufferVelocity=Y.prototype.eb;function Rf(a,b){for(var c in a.c)a.c[c].ea=b}
function Sf(a){var b=[];if(null!==a.ea){var c=a.ea,d;for(d in a.c)b.push(he(a.c[d],a.ea));Promise.all(b).then(I(a,function(){if(c){for(var a in this.c){var b=this.c[a];b.G=null;b.R=!1;b.C=null}c>this.video.currentTime&&(this.video.currentTime=c)}}))}a.ea=null};function Z(a,b,c,d,e,f,g){d||(d=new F);e||(e=new X);Y.call(this,null,b,d,e);"string"===typeof a?this.Cb=a:this.Eb=a;this.j=b;this.C=null;this.oa=c;this.ua=[];this.Jb=[];this.Kb=[];this.Da=0;this.N=null;this.Db=g||null}r(Z,Y);q("shaka.player.DashVideoSource",Z);Z.prototype.zd=function(a){this.C=a;this.Bb(!0,!0)};Z.prototype.updateManifest=Z.prototype.zd;Z.prototype.Fb=Z.prototype.getManifest=Z.prototype.Fb;Z.prototype.Mb=
Z.prototype.debugGetManifest=Z.prototype.Mb;Z.prototype.Rc=function(a,b,c){this.ua.push(a);this.Jb.push(b||"");this.Kb.push(c||"")};Z.prototype.addExternalCaptions=Z.prototype.Rc;Z.prototype.Sc=Z.prototype.setNetworkCallback=Z.prototype.Sc;Z.prototype.destroy=
Z.prototype.kb=function(){var a;this.a&&(a=this.a.getOperationLogger("source_load").start());var b,c=I(this,function(a){a=maybeConvertHiveErrorToShakaNetError(a);switch(a.status){case 200:case 417:if(a.responseHeaders&&null!=a.responseHeaders["x-fb-video-replica"])return this.dispatchEvent(x({type:"replicaswitch",bubbles:!0,replica:a.responseHeaders["x-fb-video-replica"]})),new Promise(}0===a.status&&this.dispatchEvent(x({type:"initiallivemanifestrequestfailure",bubbles:!0,status:a.status,
url:this.Cb}));throw a;}),d=I(this,function(c){this.Ba("MPDFetchDuration",(Date.now()-b)/1E3);this.C=c;for(var d=0;d<this.ua.length;d++)Gc(c,this.ua[d],this.Jb[d],this.Kb[d]);var d=new oe(this.j,this.oa,this.a,this.Db),e;this.a&&(e=this.a.getOperationLogger("process_manifest").start());this.b=pe(d,c,this.N);e&&e.log();a&&a.setManifestType(this.b.b?"dynamic":"static");return Y.prototype.kb.call(this).then(});if(this.Eb)return b=Date.now(),d(this.Eb);var e=[new K(this.Cb)],f;
if(this.ma){var g=new VideoPushParametersHelper(this.Cb);g.setStreamEndOffset(Math.floor(xf(this)/1));this.Fa&&g.setPushVideoRepresentationID(this.Fa);this.ja&&g.setPushAudioRepresentationID(this.ja);this.fa&&g.setUseLongCacheForManifest(this.fa);f=new Yc(null);f.a=g}e=new J(this.N,e,void 0,void 0,void 0,this.Db);f=new Wc(e,this.Ab,f,this.l);b=Date.now();return Xc(f,this.a).then(d,c)};
Z.prototype.oc=function(){if(this.Nb){var a=this.b;if(a=(a=a&&a.a)&&a[0]){var a=a.a.reduce([]),b=Promise.all(a.map(function(a){a=a.O;return a.Jc?a.Ia:a.create()})).then(function(a){a=a.filter(b);this.Ba("InitialSegmentIndexes",a)}.bind(this));Promise.all(a.map().then(function(a){a=a.filter(b);this.Ba("SegmentInitSources",a)}.bind(this))}}};
Z.prototype.rc=function(a,b,c){if(this.video.paused&&this.Da+1E4>Date.now()&&this.b)return Promise.reject({type:"delay"});var d;if(b&&void 0!=c)d=new Yc(b),d.f=c,b=Cf(this),null!=b&&(d.c=b.streamInfoID,d.b=this.ja);else for(b=a.c,c=0;c<b.length;c++){var e=new VideoPushParametersHelper(b[c].toString());this.fa&&e.setUseLongCacheForManifest(this.fa);b[c]=new K(e.getURL())}a=new Wc(a,this.Ab,d,this.l);var f=Date.now();return Xc(a,this.a).then(I(this,function(a){this.Da=Date.now();this.Ba("MPDFetchDuration",
(this.Da-f)/1E3);a.manifestIsLiveStreaming="dynamic"===(this.C?this.C.type:a.type);this.C=a;var b=new oe(this.j,this.oa,this.a,this.Db);if(this.a)var c=this.a.getOperationLogger("process_manifest").start();a=pe(b,a,this.N);c&&c.log();return Promise.resolve(a)}),I(this,)};Z.prototype.qc=function(){var a=pe(new oe(this.j,this.oa),this.C,this.N);return Promise.resolve(a)};}.bind(g, global))();

module.exports = g.shaka;


/*  */}),null);