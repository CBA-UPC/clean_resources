import{ApolloLink as I}from"./bundle.esm_43932ba3_r24-02-0_b0_t240129-161140.js";import{a7 as R,a6 as N,a8 as j,n as q}from"./index_31ad23dc_r24-02-0_b0_t240129-161140.js";import"./vendor_6ed58054_r24-02-0_b0_t240129-161140.js";import"./bundle.esm_43583291_r24-02-0_b0_t240129-161140.js";import"./ast_dd2f4d00_r24-02-0_b0_t240129-161140.js";const D=t=>{const e=t;return((e==null?void 0:e.reservationObj)??!1)&&(e.reservationObj="--REDACTED--"),((e==null?void 0:e.paymentObject)??!1)&&(e.paymentObject="--REDACTED--"),e},G=t=>{const e=n=>{let o=0;return typeof n=="boolean"?o=4:typeof n=="string"?o=n.length*2:typeof n=="number"?o=8:typeof n=="object"&&(n===null?o=4:Object.keys(n).forEach(i=>{o+=8,o+=e(n[i])})),o};return e(t)},F=async({ngsUniqueId:t,operationName:e="undefinedOperation",apiUrl:n="",country:o,locale:i,timestamp:c,cartGuid:u="",requestPayloadVariables:f={}})=>{const g=await R();return{ngsUniqueId:t,amznTraceId:`Root=${t};LeviId=${N()}`,operationName:e,apiUrl:n,country:o,locale:i,timestamp:c,cartGuid:u,requestPayload:j("REQUESTLOG")?g(f):D(g(f))}},T=async({ngsUniqueId:t,ngsUniqueIdResponse:e,operationName:n="undefinedOperation",responsePayload:o={},statusCodes:i=["undefinedStatusCode"],dataMsg:c=null,errorResponse:u=null,extensionCode:f=null,isError:g=!1,timings:m})=>{var l,a,O,d,x,y;const p=await R(),b=G(o),r={ngsUniqueId:t,operationName:n,statusCodes:i,responseSize:b,timings:m};if(e&&e!==t&&(r.ngsUniqueIdResponse=e),b>0&&j("RESPONSELOG")&&(r.responsePayload=p(o)),g){if(u){const s={...u};(a=(l=s==null?void 0:s.extensions)==null?void 0:l.exception)==null||delete a.stacktrace,((s==null?void 0:s.extensions)??!1)&&(delete s.extensions.query,s.extensions.variables=p(s.extensions.variables)),r.errorResponse=s,j("ERRORLOG")||(r.errorResponse.errorMessage=((x=(d=(O=s==null?void 0:s.extensions)==null?void 0:O.exception)==null?void 0:d.data)==null?void 0:x.message)||"",(y=r.errorResponse)==null||delete y.extensions)}(c||f)&&(r.dataMsg=c,r.extensionCode=f)}return r},Q=new I((t,e)=>{const n=t.getContext(),{requestNgsUniqueId:o,country:i,locale:c,requestStart:u,cartGuid:f,uri:g}=n,m=t==null?void 0:t.operationName,p=o,b=F({ngsUniqueId:p,operationName:m,apiUrl:g,country:i,locale:c,timestamp:u.toISOString(),cartGuid:f,requestPayloadVariables:t.variables});return q.request(b),e(t).map(r=>{var L,S;const l=t.getContext(),a=(L=l==null?void 0:l.response)==null?void 0:L.headers,O=(S=a==null?void 0:a.get)==null?void 0:S.call(a,"X-NGS-UNIQUEID"),{statusCodes:d,dataMsg:x,errorResponse:y,extensionCode:s,isError:C,timings:k}=l,E=T({ngsUniqueId:p,ngsUniqueIdResponse:O,operationName:m,responsePayload:r,statusCodes:d,country:i,locale:c,dataMsg:x,errorResponse:y,extensionCode:s,isError:C,timings:k});return q.response(E),r})});export{Q as default};
