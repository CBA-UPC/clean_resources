/*! For license information please see squatch.min.js.LICENSE.txt */
!self,(function(){return function(){var e={264:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(822),o=n(615),i=n(787);class a{constructor(e){var t,n=function(e){if(!(0,i.Kn)(e))throw new Error("'options' should be an object");return e}(e);this.domain=(null==n?void 0:n.domain)||(null===(t=(0,i.iE)())||void 0===t?void 0:t.domain)||r.cE}pushAnalyticsLoadEvent(e){if(e.externalUserId&&e.externalAccountId){var t=encodeURIComponent(e.tenantAlias),n=encodeURIComponent(e.externalAccountId),r=encodeURIComponent(e.externalUserId),i=encodeURIComponent(e.engagementMedium),a=e.programId?"&programId=".concat(encodeURIComponent(e.programId)):"",s="/a/".concat(t,"/widgets/analytics/loaded?externalAccountId=").concat(n,"&externalUserId=").concat(r,"&engagementMedium=").concat(i).concat(a),c=this.domain+s;return(0,o.Mx)(c,JSON.stringify({}))}}pushAnalyticsShareClickedEvent(e){var t=encodeURIComponent(e.tenantAlias),n=encodeURIComponent(e.externalAccountId),r=encodeURIComponent(e.externalUserId),i=encodeURIComponent(e.engagementMedium),a=encodeURIComponent(e.shareMedium),s="/a/".concat(t,"/widgets/analytics/shared?externalAccountId=").concat(n,"&externalUserId=").concat(r,"&engagementMedium=").concat(i,"&shareMedium=").concat(a),c=this.domain+s;return(0,o.Mx)(c,JSON.stringify({}))}}},745:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(615),o=n(787);class i{constructor(e){var t=e,n=(0,o.ww)(t);this.tenantAlias=n.tenantAlias,this.domain=n.domain}track(e,t){var n=t,i=function(e){if(!(0,o.Kn)(e))throw new Error("tracking parameter must be an object");if(null==e||!e.accountId)throw new Error("accountId field is required");if(null==e||!e.events)throw new Error("events field is required");if(null==e||!e.userId)throw new Error("userId field is required");var t=e;if(!Array.isArray(t.events))throw new Error("'events' should be an array");return t}(e),{jwt:a}=n),s=encodeURIComponent(this.tenantAlias),c=encodeURIComponent(i.userId),d=encodeURIComponent(i.accountId),u="/api/v1/".concat(s,"/open/account/").concat(d,"/user/").concat(c,"/events"),l=this.domain+u;return(0,r.Mx)(l,JSON.stringify(i),a)}}},139:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(861),o=n(572),i=n(955),a=n(615),s=n(787);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class u{constructor(e){(0,o.Z)(this,"referralCookie",this.squatchReferralCookie);var t=e,n=(0,s.ww)(t);this.tenantAlias=n.tenantAlias,this.domain=n.domain,this.npmCdn=n.npmCdn}upsertUser(e){var t=e,n=(0,s.xW)(t),{widgetType:r,engagementMedium:o="POPUP",jwt:c,locale:d,user:u}=n,l=encodeURIComponent(this.tenantAlias),p=u.accountId?encodeURIComponent(u.accountId):null,h=u.id?encodeURIComponent(u.id):null,f=function(e){var{widgetType:t,engagementMedium:n,locale:r}=e,o=new URLSearchParams;return o.append("engagementMedium",n),t&&o.append("widgetType",t),r&&o.append("locale",r),"?".concat(o.toString())}({widgetType:r,engagementMedium:o,locale:d}),g="/api/v1/".concat(l,"/widget/account/").concat(p,"/user/").concat(h,"/upsert").concat(f),m=this.domain+g,w=(i.Z||window.Cookies).get("_saasquatch");return w&&(u.cookies=w),(0,a.iR)(m,JSON.stringify(u),c)}render(e){var t,n=e,o=(0,s.ZL)(n),{widgetType:i,engagementMedium:c="POPUP",jwt:d,user:u}=o,l=encodeURIComponent(this.tenantAlias),p=null!=u&&u.accountId?encodeURIComponent(u.accountId):null,h=null!=u&&u.id?encodeURIComponent(u.id):null,f=null!==(t=o.locale)&&void 0!==t?t:(0,s.Qb)(navigator.language.replace(/\-/g,"_")),g="/api/v1/".concat(l,"/graphql"),m=this.domain+g;return new Promise(function(){var e=(0,r.Z)((function*(e,t){try{var n,r=yield(0,a.Rf)(m,"\n  query renderWidget ($user: UserIdInput, $engagementMedium: UserEngagementMedium, $widgetType: WidgetType, $locale: RSLocale) {\n    renderWidget(user: $user, engagementMedium: $engagementMedium, widgetType: $widgetType, locale: $locale) {\n      template\n      user {\n        id\n        accountId\n      }\n      jsOptions\n      widgetConfig {\n        values\n      }\n    }\n  }\n",{user:h&&p?{id:h,accountId:p}:null,engagementMedium:c,widgetType:i,locale:f},d);e(null==r||null===(n=r.data)||void 0===n?void 0:n.renderWidget)}catch(e){t(e)}}));return ())}squatchReferralCookie(){var e=this;return(0,r.Z)((function*(){var t=encodeURIComponent(e.tenantAlias),n=(i.Z||window.Cookies).get("_saasquatch")||"",r=n?"?cookies=".concat(encodeURIComponent(n)):"",o="".concat(e.domain,"/a/").concat(t,"/widgets/squatchcookiejson").concat(r),s=yield(0,a.gc)(o);return Promise.resolve(d(d({},s),{},{encodedCookie:n}))}))()}}},762:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(822);function o(){var e,t=window[r.q9]?r.q9:r.zG,n=[...(null===(e=window["_"+t])||void 0===e?void 0:e.ready)||[],window.impactOnReady||window.squatchOnReady].filter(();setTimeout((()=>{window[r.zG]&&(window[r.q9]=window[r.zG],n.forEach((),window[r.zG]._auto(),window["_"+t]=void 0,delete window["_"+t])}),0)}},510:function(e,t,n){"use strict";.d(t,{R:function(){return r}})},822:518:998:function(e,t,n){"use strict";n.d(t,{F:function(){return l},b:function(){return h}});var r=n(572),o=n(227),i=n(955);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c=(0,o.debug)("squatch-js"),d=u=(e,t)=>{var n=n=>d(t[n])&&e.hasOwnProperty(n)&&d(e[n]),r=Object.getOwnPropertyNames(t).map((r=>({[r]:n(r)?u(e[r],t[r]):t[r]}))).reduce((,{});return s(s({},e),r)};nction h(){var e=window.location.search,t=new URLSearchParams(e).get("_saasquatch")||"";if(t){var n="",r="",o="";try{n=JSON.parse(l(t))}catch(e){return void c("Unable to decode params",e)}try{r=JSON.parse(l(i.Z.get("_saasquatch"))),c("existing cookie",r)}catch(e){c("Unable to retrieve cookie",e)}try{var a=function(){var e,t,n="weird_get_top_level_domain=cookie",r=document.location.hostname.split(".");for(e=r.length-1;e>=0;e--)if(t=r.slice(e).join("."),document.cookie=n+";domain=."+t+";",document.cookie.indexOf(n)>-1)return document.cookie=n.split("=")[0]+"=;domain=."+t+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",t}();if(c("domain retrieved:",a),r){var s=u(r,n);o=p(JSON.stringify(s)),c("cookie to store:",s)}else o=p(JSON.stringify(n)),c("cookie to store:",n);i.Z.set("_saasquatch",o,{expires:365,secure:!1,sameSite:"Lax",domain:a,path:"/"})}catch(e){c("Unable to set cookie",e)}}}},936:function(e,t,n){"use strict";function r(e,t){var n,r=[],o=e,i=o.documentElement.doScroll,a="DOMContentLoaded",s=(i?/^loaded|^c/:/^loaded|^i|^c/).test(o.readyState);return s||o.addEventListener(a,n=()=>{for(o.removeEventListener(a,n),s=!0;n=r.shift();)n()}),s?setTimeout(t,0):r.push(t)}n.d(t,{V:function(){return r}})},615:function(e,t,n){"use strict";n.d(t,{Mx:function(){return h},Rf:function(){return d},gc:function(){return l},iR:function(){return g}});var r=n(572),o=n(861),i=n(227),a=n(787);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}unction u(){return(u=(0,o.Z)((function*(e,t,n,r){var o=r||(0,a.LP)(),i=c(c({Accept:"application/json","Content-Type":"application/json"},o?{Authorization:"Bearer ".concat(o)}:{}),{},{"X-SaaSquatch-Referrer":window?window.location.href:""});try{var s=yield fetch(e,{method:"POST",body:JSON.stringify({query:t,variables:n}),headers:i});if(!s.ok)throw new Error(yield s.text());return yield s.json()}catch(e){throw e}}))).apply(this,arguments)}unction p(){return p=(0,o.Z)((function*(e){var t={Accept:"application/json","Content-Type":"application/json"},n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")||(0,a.LP)();n&&(t["X-SaaSquatch-User-Token"]=n);try{var r=yield fetch(e,{method:"GET",credentials:"include",headers:t}),o=yield r.text();if(!r.ok)throw new Error(o);return o?JSON.parse(o):o}catch(e){throw e}})),p.apply(this,arguments)}function h(e,t,n){return f.apply(this,arguments)}function f(){return(f=(0,o.Z)((function*(e,t,n){var r={Accept:"application/json","Content-Type":"application/json"},o=n||(0,a.LP)();o&&(r["X-SaaSquatch-User-Token"]=o);try{var i=yield fetch(e,{method:"POST",body:t,headers:r}),s=yield i.text();if(!i.ok)throw new Error(s);return s?JSON.parse(s):s}catch(e){throw e}}))).apply(this,arguments)}unction m(){return(m=(0,o.Z)((function*(e,t,n){var r={Accept:"application/json","Content-Type":"application/json","X-SaaSquatch-Referrer":window?window.location.href:""},o=n||(0,a.LP)();o&&(r["X-SaaSquatch-User-Token"]=o);try{var i=yield fetch(e,{headers:r,method:"PUT",credentials:"include",body:t}),s=yield i.text();if(!i.ok)throw new Error(s);return s?JSON.parse(s):s}catch(e){throw e}}))).apply(this,arguments)}(0,i.debug)("squatch-js:io")},8:function(e,t,n){"use strict";n.d(t,{G:function(){return u}});var r=n(572);ar i=n(227),a=n(998);r d=(0,i.debug)("squatch-js");function u(e){var t=window.location.search,n=new URLSearchParams(t).get("_saasquatchExtra")||"";if(n){var r;try{r=JSON.parse((0,a.F)(n))}catch(e){return void d("Unable to decode _saasquatchExtra config")}var{domain:i,tenantAlias:s,widgetConfig:u}=function(e){var t,n=Object.keys(e||{})[0],r=Object.keys((null==e?void 0:e[n])||{})[0],o=null==e||null===(t=e[n])||void 0===t?void 0:t[r];return{domain:n?"https://".concat(n):void 0,tenantAlias:r,widgetConfig:o}}(r);if(i&&s&&u){var{autoPopupWidgetType:l}=u;return{widgetConfig:c({widgetType:l,displayOnLoad:!0},o(u,["autoPopupWidgetType"])),squatchConfig:c(c({},e?{configIn:e}:{}),{},{domain:i,tenantAlias:s})}}d("_saasquatchExtra did not have an expected structure")}else d("No _saasquatchExtra param")}},787:function(e,t,n){"use strict";n.d(t,{Kn:function(){return i},LP:function(){return d},Qb:function(){return a},ZL:function(){return c},iE:function(){return u},ww:function(){return o},xW:function(){return s}});var r=n(822);function o(e){if("object"!=typeof e)throw new Error("config must be an object");var t=window.squatchTenant,n=u(),o={tenantAlias:(null==e?void 0:e.tenantAlias)||t,domain:(null==e?void 0:e.domain)||(null==n?void 0:n.domain),npmCdn:(null==e?void 0:e.npmCdn)||(null==n?void 0:n.npmCdn),debug:(null==e?void 0:e.debug)||(null==n?void 0:n.debug)};if("string"!=typeof o.tenantAlias)throw new Error("tenantAlias not provided");return{tenantAlias:o.tenantAlias,domain:"string"==typeof o.domain&&o.domain||r.cE,debug:"boolean"==typeof o.debug&&o.debug||!1,npmCdn:"string"==typeof o.npmCdn&&o.npmCdn||r.eu}}unction a(e){if(e&&/^[a-z]{2}_(?:[A-Z]{2}|[0-9]{3})$/.test(e))return e}function s(e){if(!i(e))throw new Error("Widget properties must be an object");if(null==e||!e.user)throw new Error("Required properties missing.");return e}unction d(){return window.impactToken||window.squatchToken},75:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(861),o=n(572),i=n(227),a=n(657),s=n(936),c=(0,i.debug)("squatch-js:EMBEDwidget");class d extends a.Z{constructor(e,t){super(e),(0,o.Z)(this,"show",this.open),(0,o.Z)(this,"hide",this.close),t&&(this.container=t)}load(){var e=this;return(0,r.Z)((function*(){var t,n,o=e._createFrame(),i=e._findElement();null!==(t=e.context)&&void 0!==t&&t.container&&(i.style.visibility="hidden",i.style.height="0",i.style["overflow-y"]="hidden"),e.container?i.shadowRoot?"IFRAME"===(null===(n=i.shadowRoot.lastChild)||void 0===n?void 0:n.nodeName)?i.shadowRoot.replaceChild(o,i.shadowRoot.lastChild):i.shadowRoot.appendChild(o):i.firstChild?i.replaceChild(o,i.firstChild):i.appendChild(o):i.firstChild&&"#text"!==i.firstChild.nodeName||i.appendChild(o);var{contentWindow:a}=o;if(!a)throw new Error("Frame needs a content window");var d=a.document;d.open(),d.write(e.content),d.write('<script src="'.concat(e.npmCdn,'/resize-observer-polyfill@1.5.x"><\/script>')),d.close(),(0,s.V)(d,(0,r.Z)((function*(){var t=a.squatch||a.widgetIdent;o.height=d.body.scrollHeight;var n=new a.ResizeObserver((e=>{for(var t of e){var{height:n}=t.contentRect;o.height=n}})),r=yield e._findInnerContainer(o);n.observe(r),e._shouldFireLoadEvent()&&(e._loadEvent(t),c("loaded"))})))}))()}open(){var e=this._findFrame();if(!e)return c("no target element to open");if(!e.contentWindow)return c("Frame needs a content window");var t=this._findElement();t.style.visibility="unset",t.style.height="auto",t.style["overflow-y"]="auto",e.contentWindow.document.dispatchEvent(new CustomEvent("sq:refresh"));var n=e.contentWindow.squatch||e.contentWindow.widgetIdent;this.context.user&&(this._loadEvent(n),c("loaded"))}close(){if(!this._findFrame())return c("no target element to close");var e=this._findElement();e.style.visibility="hidden",e.style.height="0",e.style["overflow-y"]="hidden",c("Embed widget closed")}_error(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"embed",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return super._error(e,t,n)}_shouldFireLoadEvent(){var e=!this.container,t=this.container instanceof HTMLElement&&(this.container.tagName.startsWith("SQUATCH-")||this.container.tagName.startsWith("IMPACT-"));return!!this.context.user&&(e||t)}}},658:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(861),o=n(572),i=n(227),a=n(936),s=n(657),c=(0,i.debug)("squatch-js:POPUPwidget"),d=0;class u extends s.Z{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".squatchpop";super(e),(0,o.Z)(this,"show",this.open),(0,o.Z)(this,"hide",this.close),this.trigger=t,this.container?this.id="squatchModal":(this.id=0===d?"squatchModal":"squatchModal__".concat(d),d+=1),document.head.insertAdjacentHTML("beforeend","<style>#".concat(this.id,"::-webkit-scrollbar { display: none; }</style>"))}_initialiseCTA(){if(this.trigger){var e;try{e=document.querySelector(this.trigger)||document.querySelector(".impactpop"),this.trigger&&!e&&c("No element found with trigger selector",this.trigger)}catch(e){c("Not a valid selector",this.trigger)}e&&(e.onclick=}}_createPopupDialog(){var e=document.createElement("dialog");return e.id=this.id,e.setAttribute("style","width: 100%; max-width: 500px; border: none; padding: 0;"),e.addEventListener("click",(t=>{t.stopPropagation(),t.target===e&&e.close()})),e}load(){var e=this;return(0,r.Z)((function*(){var t,n=e._createFrame();e._initialiseCTA();var r=e.container?e._findElement():document.body,o=r.shadowRoot||r,i=e._createPopupDialog();i.appendChild(n),"DIALOG"===(null===(t=o.lastChild)||void 0===t?void 0:t.nodeName)?o.replaceChild(i,o.lastChild):o.appendChild(i);var{contentWindow:a}=n;if(!a)throw new Error("Frame needs a content window");var s=a.document;s.open(),s.write(e.content),s.write('<script src="'.concat(e.npmCdn,'/resize-observer-polyfill@1.5.x"><\/script>')),s.close(),c("Popup template loaded into iframe"),yield e._setupResizeHandler(n)}))()}_setupResizeHandler(e){var t=this;return(0,r.Z)((function*(){var{contentWindow:n}=e;if(!n)throw new Error("Frame needs a content window");var o=n.document;(0,a.V)(o,(0,r.Z)((function*(){o.body.style.overflowY="hidden",e.height="".concat(o.body.offsetHeight,"px"),new n.ResizeObserver((t=>{for(var n of t){var{top:r,bottom:o}=n.contentRect,i=o+r;e.height=i+"",n.target.style=""}})).observe(yield t._findInnerContainer(e))})))}))()}open(){var e=this.container?this._findElement():document.body,t=(e.shadowRoot||e).querySelector("#".concat(this.id));if(!t)throw new Error("Could not determine container div");t.showModal();var n=this._findFrame();if(!n)throw new Error("Could not find iframe");var{contentWindow:r}=n;if(!r)throw new Error("Squatch.js has an empty iframe");var o=r.document;(0,a.V)(o,(()=>{var e,t=r.squatch||r.widgetIdent;null===(e=n.contentDocument)||void 0===e||e.dispatchEvent(new CustomEvent("sq:refresh")),this.context.user&&(this._loadEvent(t),c("Popup opened"))}))}close(){var e=this.container?this._findElement():document.body,t=(e.shadowRoot||e).querySelector("#".concat(this.id));if(!t)throw new Error("Could not determine container div");t.close(),c("Popup closed")}_clickedOutsideerror(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modal",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return super._error(e,t,n||"body { margin: 0; } .modal { box-shadow: none; border: 0; }")}}},657:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(861),o=n(227),i=n(264),a=n(787),s=(0,o.debug)("squatch-js:widget");class c{constructor(e){var t;s("widget initializing ..."),this.content="error"===e.content?this._error(e.rsCode):e.content,this.type=e.type,this.widgetApi=e.api,this.npmCdn=e.npmCdn,this.analyticsApi=new i.Z({domain:e.domain}),this.context=e.context,this.container=(null===(t=e.context)||void 0===t?void 0:t.container)||e.container}_findElement(){var e;if("string"==typeof this.container?(e=document.querySelector(this.container),s("loading widget with selector",e)):this.container instanceof HTMLElement?(e=this.container,s("loading widget with container",e)):this.container?(e=null,s("container must be an HTMLElement or string",this.container)):(e=document.querySelector("#squatchembed")||document.querySelector(".squatchembed")||document.querySelector("#impactembed")||document.querySelector(".impactembed"),s("loading widget with default selector",e)),!(e instanceof HTMLElement))throw new Error("element with selector '".concat(this.container||"#squatchembed, .squatchembed, #impactembed, or .impactembed","' not found.'"));return e}_createFrame(){var e=document.createElement("iframe");return e.squatchJsApi=this,e.id="squatchFrame",e.width="100%",e.src="about:blank",e.scrolling="no",e.setAttribute("style","border: 0; background-color: none; width: 1px; min-width: 100%;"),e}_findFrame(){var e=this.container?this._findElement():document.body;return(e.shadowRoot||e).querySelector("iframe#squatchFrame")}_loadEvent(e){var t;if(e){if(!(0,a.Kn)(e))throw new Error("Widget Load event identity property is not an object");var n;if("programId"in e){if(!(e.tenantAlias&&e.accountId&&e.userId&&e.engagementMedium))throw new Error("Widget Load event missing required properties");n={tenantAlias:e.tenantAlias,externalAccountId:e.accountId,externalUserId:e.userId,engagementMedium:e.engagementMedium,programId:e.programId}}else{var{analytics:r,mode:o}=e;n={tenantAlias:r.attributes.tenant,externalAccountId:r.attributes.accountId,externalUserId:r.attributes.userId,engagementMedium:o.widgetMode}}null===(t=this.analyticsApi.pushAnalyticsLoadEvent(n))||void 0===t||t.then((e=>{s("".concat(n.engagementMedium," loaded event recorded."))})).catch((e=>{s("ERROR: pushAnalyticsLoadEvent() ".concat(e))}))}}_shareEvent(e,t){e&&this.analyticsApi.pushAnalyticsShareClickedEvent({tenantAlias:e.analytics.attributes.tenant,externalAccountId:e.analytics.attributes.accountId,externalUserId:e.analytics.attributes.userId,engagementMedium:e.mode.widgetMode,shareMedium:t}).then((n=>{s("".concat(e.mode.widgetMode," share ").concat(t," event recorded. ").concat(n))})).catch(()}_error(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modal";return'<!DOCTYPE html>\n    \x3c!--[if IE 7]><html class="ie7 oldie" lang="en"><![endif]--\x3e\n    \x3c!--[if IE 8]><html class="ie8 oldie" lang="en"><![endif]--\x3e\n    \x3c!--[if gt IE 8]>\x3c!--\x3e<html lang="en">\x3c!--<![endif]--\x3e\n    <head>\n      <link rel="stylesheet" media="all" href="https://fast.ssqt.io/assets/css/widget/errorpage.css">\n      <style>\n        '.concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",'\n      </style>\n    </head>\n    <body>\n\n      <div class="squatch-container ').concat(t,'" style="width:100%">\n        <div class="errorheader">\n          <button type="button" class="close" onclick="window.frameElement.squatchJsApi.close();">&times;</button>\n          <p class="errortitle">Error</p>\n        </div>\n        <div class="errorbody">\n          <div class="sadface"><img src="https://fast.ssqt.io/assets/images/face.png"></div>\n          <h4>Our referral program is temporarily unavailable.</h4><br>\n          <p>Please reload the page or check back later.</p>\n          <p>If the persists please contact our support team.</p>\n          <br>\n          <br>\n          <div class="right-align errtxt">\n            Error Code: ').concat(e,"\n          </div>\n        </div>\n      </div>\n    </body>\n    </html>")}_findInnerContainer(e){return(0,r.Z)((function*(){var{contentWindow:t}=e;if(!t)throw new Error("Squatch.js frame inner frame is empty");for(var n,r,o=t.document,i=null,a=0;a<5&&(void 0,void 0,n=o.getElementsByTagName("sqh-global-container"),r=o.getElementsByClassName("squatch-container"),!(i=n.length>0?n[0]:r.length>0?r[0]:null));a++)yield d(100);return i||o.body}))()}reload(e,t){var{email:n,firstName:r,lastName:o}=e,i=this._findFrame();if(!i)throw new Error("Could not find widget iframe");var a,c=i.contentWindow,d=this.context.engagementMedium||"POPUP";if(!c)throw new Error("Frame needs a content window");if("upsert"===this.context.type){if(!this.context.user)throw new Error("Can't reload without user ids");var u={email:n||null,firstName:r||null,lastName:o||null,id:this.context.user.id,accountId:this.context.user.accountId};a=this.widgetApi.upsertUser({user:u,engagementMedium:d,widgetType:this.type,jwt:t})}else{if("passwordless"!==this.context.type)throw new Error("can't reload an error widget");a=this.widgetApi.render({user:void 0,engagementMedium:d,widgetType:this.type,jwt:void 0})}a.then((e=>{var{template:t}=e;t&&(this.content=t,this.__deprecated__register(i,{email:n,engagementMedium:d},(()=>{this.load(),"POPUP"===d&&this.open()})))})).catch((e=>{var{message:t}=e;s("".concat(t))}))}__deprecated__register(e,t,n){var r=e.contentWindow.document,o=r.createElement("button"),i=r.getElementsByClassName("squatch-register")[0];if(i){o.className="btn btn-primary",o.id="show-stats-btn",o.textContent="REFERRER_WIDGET"===this.type?"Show Stats":"Show Reward";var a="POPUP"===t.engagementMedium?"margin-top: 10px; max-width: 130px; width: 100%;":"margin-top: 10px;";o.setAttribute("style",a),o.onclick=n,i.style.paddingTop="30px",i.innerHTML="<p><strong>".concat(t.email,"</strong><br>Has been successfully registered</p>"),i.appendChild(o)}}},452:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(861),o=n(227),i=n(139),a=n(787),s=n(75),c=n(658),d=(0,o.debug)("squatch-js:widgets");class u{constructor(e){var t=(0,a.ww)(e);this.tenantAlias=t.tenantAlias,this.domain=t.domain,this.npmCdn=t.npmCdn,this.api=new i.Z(t)}upsertUser(e){var t=this;return(0,r.Z)((function*(){var n=e,r=(0,a.xW)(n);try{var o=yield t.api.upsertUser(r);return{widget:t._renderWidget(o,r,{type:"upsert",user:r.user,engagementMedium:e.engagementMedium,container:e.container,trigger:e.trigger}),user:o.user}}catch(n){throw d(n),n.apiErrorCode&&t._renderErrorWidget(n,e.engagementMedium),new Error(n)}}))()}render(e){var t=this;return(0,r.Z)((function*(){var n=e,r=(0,a.ZL)(n);try{var o=yield t.api.render(r);return{widget:t._renderWidget(o,r,{type:"passwordless",engagementMedium:r.engagementMedium,container:r.container,trigger:r.trigger}),user:o.user}}catch(e){throw e.apiErrorCode&&t._renderErrorWidget(e,r.engagementMedium),new Error(e)}}))()}autofill(e){var t=this;return(0,r.Z)((function*(){var n=e;if("function"!=typeof n){if("string"!=typeof n)throw new Error("Autofill accepts a string or function");var r,o=document.querySelectorAll(n);if(!(o.length>0))throw d("Element id/class or function missing"),new Error("Element id/class or function missing");r=o[0];try{var i=yield t.api.squatchReferralCookie();r.value=i.codes[0]}catch(e){throw new Error(e)}}else try{n(yield t.api.squatchReferralCookie())}catch(e){throw d("Autofill error",e),new Error(e)}}))()}_renderWidget(e,t,n){var r,o;if(d("Rendering Widget..."),!e)throw new Error("Unable to get a response");var i=!!t.displayOnLoad,a=e.jsOptions||{},s={content:e.template,type:t.widgetType||(null===(r=a.widget)||void 0===r?void 0:r.defaultWidgetType),api:this.api,domain:this.domain,npmCdn:this.npmCdn,context:n};return a.widgetUrlMappings&&a.widgetUrlMappings.forEach((t=>{var n,r;u._matchesUrl(t.url)&&("CONVERSION_WIDGET"!==t.widgetType||null!==(n=e.user)&&void 0!==n&&null!==(r=n.referredBy)&&void 0!==r&&r.code?(i=t.displayOnLoad,d("Display ".concat(t.widgetType," on ").concat(t.url))):d("Don't display ".concat(t.widgetType," when no referral on widget rule match ").concat(t.url)))})),a.fuelTankAutofillUrls&&(d("We found a fuel tank autofill!"),a.fuelTankAutofillUrls.forEach((t=>{var n,r,{url:o,formSelector:i}=t;if(u._matchesUrl(o)&&(d("Fuel Tank URL matches"),null!==(n=e.user)&&void 0!==n&&null!==(r=n.referredBy)&&void 0!==r&&r.code)){var a,s=document.querySelector(i);s?s.value=(null===(a=e.user.referredBy.referredReward)||void 0===a?void 0:a.fuelTankCode)||"":d(new Error("Element with id/class ".concat(i," was not found.")))}}))),"EMBED"===t.engagementMedium?o=this._renderEmbedWidget(s):(o=this._renderPopupWidget(s),i&&o.open()),o}_renderPopupWidget(e){var t=new c.Z(e,e.context.trigger);return t.load(),t}_renderEmbedWidget(e){var t=new s.Z(e,e.context.container);return t.load(),t}_renderErrorWidget(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POPUP",{apiErrorCode:n,rsCode:r,message:o}=e;d(new Error("".concat(n," (").concat(r,") ").concat(o)));var i={content:"error",rsCode:r,api:this.api,domain:this.domain,npmCdn:this.npmCdn,type:"ERROR_WIDGET",context:{type:"error"}};"EMBED"===t?new s.Z(i).load():"POPUP"===t&&new c.Z(i).load()}static _matchesUrl(e){return!!window.location.href.match(new RegExp(e))}}},22:function(e,t,n){"use strict";n.d(t,{U:function(){return w},n:function(){return v}});var r=n(861),o=n(572),i=n(227),a=n.n(i),s=n(264),c=n(139),d=n(998),u=(0,i.debug)("squatch-js:decodeUserJwt"),l=n(787),p=n(75),h=n(658),f=n(822),g=a()("squatch-js:DeclarativeWidget");class m extends HTMLElement{constructor(){super(),(0,o.Z)(this,"_setWidget",((e,t)=>{var n,r={api:this.widgetApi,content:e,context:{type:t.type,user:t.user,container:this.container||void 0,engagementMedium:this.type},type:this.widgetType,domain:(null===(n=this.config)||void 0===n?void 0:n.domain)||f.cE,npmCdn:f.eu,container:this};if("EMBED"===this.type)return new p.Z(r);var o=this.firstChild?null:void 0;return new h.Z(r,o)})),(0,o.Z)(this,"setErrorWidget",(e=>{var t,n={api:this.widgetApi,content:"error",context:{type:"error",container:this.container||void 0},type:"ERROR_WIDGET",domain:(null===(t=this.config)||void 0===t?void 0:t.domain)||f.cE,npmCdn:f.eu,container:this};if("EMBED"===this.type)return new p.Z(n);var r=this.firstChild?null:void 0;return new h.Z(n,r)})),(0,o.Z)(this,"reload",this.renderWidget),(0,o.Z)(this,"show",this.open),(0,o.Z)(this,"hide",this.close),this.attachShadow({mode:"open"}).innerHTML="<style>:host { display: block; }</style><slot></slot>",this.config=(0,l.iE)(),this.token=(0,l.LP)(),this.tenant=window.squatchTenant,this.container=this}_setupApis(e){var t,n;if(!this.tenant)throw new Error("tenantAlias not provided");this.widgetApi=new c.Z({tenantAlias:(null==e?void 0:e.tenantAlias)||this.tenant,domain:(null==e?void 0:e.domain)||(null===(t=this.config)||void 0===t?void 0:t.domain)||f.cE}),this.analyticsApi=new s.Z({domain:(null==e?void 0:e.domain)||(null===(n=this.config)||void 0===n?void 0:n.domain)||f.cE})}renderPasswordlessVariant(){var e=this;return(0,r.Z)((function*(){return e._setupApis(),g("Rendering as an Instant Access widget"),yield e.widgetApi.render({engagementMedium:e.type,widgetType:e.widgetType,locale:e.locale}).then((t=>e._setWidget(t.template,{type:"passwordless"}))).catch(e.setErrorWidget)}))()}renderUserUpsertVariant(){var e=this;return(0,r.Z)((function*(){e._setupApis();var t=function(e){try{var t,n=e.split(".")[1];if(void 0===n)return null;var r=(0,d.F)(n);return null===(t=JSON.parse(r))||void 0===t?void 0:t.user}catch(e){return u(e),null}}(e.token);return t?(g("Rendering as a Verified widget"),yield e.widgetApi.upsertUser({user:t,locale:e.locale,engagementMedium:e.type,widgetType:e.widgetType,jwt:e.token}).then((n=>e._setWidget(n.template,{type:"upsert",user:t}))).catch(e.setErrorWidget)):e.setErrorWidget(Error("No user object in token."))}))()}getWidgetInstance(){var e=this;return(0,r.Z)((function*(){var t;if(e.widgetType=e.getAttribute("widget")||void 0,e.locale=e.getAttribute("locale")||e.locale,!e.widgetType)throw new Error("No widget has been specified");return t=e.token?yield e.renderUserUpsertVariant():yield e.renderPasswordlessVariant(),e.widgetInstance=t,e.widgetInstance&&e.dispatchEvent(new CustomEvent("sq:widget-loaded")),t}))()}renderWidget(){var e=this;return(0,r.Z)((function*(){yield e.getWidgetInstance(),yield e.widgetInstance.load()}))()}open(){if(!this.widgetInstance)throw new Error("Widget has not loaded yet");this.widgetInstance.open()}class w extends m{tatic get observedAttributes(){return["widget","locale"]}attributeChangedCallback(e,t,n){if(t!==n&&this.loaded)switch(e){case"locale":case"widget":this.connectedCallback()}}connectedCallback(){var e=this;return(0,r.Z)((function*(){var t,n;e.loaded=!0,e.container=e.getAttribute("container"),yield e.renderWidget();var r=null===(t=e.shadowRoot&&Array.from(e.shadowRoot.children))||void 0===t?void 0:t.find(();r&&(null===(n=e.shadowRoot)||void 0===n||n.removeChild(r)),null!==e.getAttribute("open")&&e.open()}))()}}class v extends m{constructor(){super(),this.type="POPUP",this.loaded=!1,this.addEventListener("click",()}ttributeChangedCallback(e,t,n){if(t!==n&&this.loaded)switch(e){case"locale":case"widget":this.connectedCallback()}}connectedCallback(){var e=this;return(0,r.Z)((function*(){e.loaded=!0,e.container=e.getAttribute("container"),yield e.renderWidget(),null!==e.getAttribute("open")&&e.open()}))()}}window.customElements.get("squatch-embed")||window.customElements.define("squatch-embed",class extends w{}),window.customElements.get("impact-embed")||window.customElements.define("impact-embed",class extends w{}),window.customElements.get("squatch-popup")||window.customElements.define("squatch-popup",class extends v{}),window.customElements.get("impact-popup")||window.customElements.define("impact-popup",},227:447:824:861:572:function(e,t,n){"use strict";d(t,{Z:function(){return o}})},955:,t={};.n=n.d=n.o=n.r=var r={};return function(){"use strict";n.r(r),n.d(r,{DeclarativeEmbedWidget:function(){return p.U},DeclarativePopupWidget:function(){return p.n},EmbedWidget:function(){return o.Z},PopupWidget:function(){return i.Z},WidgetApi:function(){return a.Z},Widgets:function(){return t.Z},_auto:function(){return j},api:function(){return E},autofill:function(){return q},events:function(){return x},help:init:function(){return P},pushCookie:function(){return _},ready:function(){return I},widget:function(){return A},widgets:);var e=n(227),t=n(452),o=n(75),i=n(658),a=n(139),s=n(745),c=n(762),d=n(787),u=n(998),l=n(8),p=n(22),h=n(518),f={};for(var g in h)["default","Widgets","EmbedWidget","PopupWidget","DeclarativeEmbedWidget","DeclarativePopupWidget","WidgetApi","api","widgets","events","widget","_auto","init","ready","autofill","pushCookie"].indexOf(g)<0&&(f[g]=bind(0,g));n.d(r,f);var m,w=n(510),v=(0,e.debug)("squatch-js"),y=null,b=null,C=null;function E(){return y||P({}),y}function O(){return b||P({}),b}function x(){return C||P({}),C}unction j(e){var t=(0,l.G)(e);if(t){var n,{squatchConfig:r,widgetConfig:o}=t;return P(r),null===(n=O())||void 0===n?void 0:n.render(o)}}function P(n){var r=n,o=(0,d.ww)(r);o.tenantAlias.match("^test")||o.debug?e.debug.enable("squatch-js*"):e.debug.disable(),v("initializing ..."),y=new a.Z(o),b=new t.Z(o),C=new s.Z(o),v("Widget API instance",y),v("Widgets instance",b),v("Events API instance",C)}defined"==typeof document||window.SaaSquatchDoNotAutoDrop||_(),null!==(m=window.squatch)&&void 0!==m&&m.init&&v("Squatchjs is being loaded more than once. This may lead to multiple load events being sent, duplicated widgets, and inaccurate analytics."),"undefined"!=typeof document&&(0,c.Z)()}(),r}()}));