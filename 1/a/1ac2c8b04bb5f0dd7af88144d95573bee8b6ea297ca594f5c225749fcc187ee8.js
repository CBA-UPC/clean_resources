"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[625,1113],{94290:function(e,n,t){t.r(n),t.d(n,{SearchMap:function(){return Kn}});var o=t(94624),r=t(30196),i=t(21379),a=t(89774),u=t(40811),c=t(58058),l=t(94405),s=t(10115),d=t(80376),p=t(99480),f=t(59003),m=t(2842),v=t(51113),g=(0,i.Sk)((function(e){var n=e.map,t=e.position,o=e.children,r=(0,i.sO)(),a=(0,i.sO)();(0,i.d4)((function(){var e=(0,v.createControl)((function(){return a.current=document.createElement("div"),(0,v.isolateControlEvents)(a.current),a.current}));return r.current=new e({position:t}),n.current.addControl(r.current),function(){r.current.remove()}}),[]),(0,i.d4)((,[o])})),h=t(17759),y=t(24172),_=t(89879),b=t(26829),S=(0,i.Sk)((function(e){var n=(0,p.j3)("small"),t=(0,l._)((0,i._Y)((function(e){return!!n&&!e}),e.defaultListHidden&&n),2),o=t[0],r=t[1],d=e.values.every(()?(0,s.dW)("lbl_metro"):(0,s.dW)("lbl_zones"),f=(0,b.s)();return(0,y.m)((0,c._)((0,u._)({},e),{hideList:o,headerText:d,onHeaderActionClick:n?function(e){r(e),o||f&&f.mapOpen(_.N3.Place)}:void 0,headerActionBtnTxt:o?(0,s.dW)("act_show_list"):(0,s.dW)("lbl_show_map")}))})),M=t(77266);function w(){var e=(0,o._)(['\n    <div class="im-geolocation leaflet-bar">\n        <a class="im-geolocation__button" onClick=',">\n            ","\n        </a>\n    </div>\n"]);return w=function(){return e},e}var k=function(e){var n=e.onClick;return(0,i.dy)(w(),n,(0,f.J)({name:"scope"}))},E=t(62765),C=t(54201);function T(){var e=(0,o._)([' <div class="im-searchMapView" data-cy="map-view">',"</div> "]);return T=function(){return e},e}function z(){var e=(0,o._)(['\n        <div class="im-searchMapWrapper">\n            <div class="im-searchMapSide" data-cy="map-side">\n                '," ","\n                ","\n            </div>\n            ","\n        </div>\n    "]);return z=function(){return e},e}var x=function(e){var n=e.currentMode,t=e.leftSide,o=e.map,r=e.isMobile,a=e.confirmButtonVisible,u=e.handleConfirm,c=e.title,p=void 0===c?null:c,f=e.modalAutoSubmit;if(!p)switch(n){case _.N3.Place:p=r?(0,s.dW)("search_map_header_zones_title"):(0,s.dW)("search_map_header_select_place_title");break;case _.N3.DrawCircle:p=(0,s.dW)("search_option_close_to_you_label");break;case _.N3.DrawPolygon:p=(0,s.dW)("search_option_draw_on_map_label");break;case _.N3.Route:p=(0,s.dW)("search_option_point_distance")}var m=(0,l._)((0,i.eJ)(!0),2),v=m[0],g=m[1];return(0,i.dy)(z(),(0,E.d)({title:p,showClose:v}),t,a&&function(e){var n=e.onClick,t=e.text,o=void 0===t?null:t,r=(0,l._)((0,i.eJ)(!1),2),a=r[0],u=r[1];return(0,C.zx)({style:"filledSecondary",text:o||(0,s.dW)("act_confirm"),customClasses:(0,d.AK)("im-searchMap__confirm",a&&"is-loading"),onClick:function(e){u(!0),n(e)},disabled:a})}({onClick:text:f?(0,s.dW)("act_search"):null}),o&&(0,i.dy)(T(),o))},P=t(28642),L=t(7298),O=t(4876),I=t(52586),A=t(82634),R=function(e){var n=(0,i.Ye)((,[]),t=(0,i.sO)();return(0,i.d4)((function(){t.current=(0,v.createMap)(n,e()),t.current.zoomControl.setPosition("bottomright")}),[]),(0,i.d4)((function(){var e=return n.addEventListener("touchmove",e,{passive:!1}),),[]),{mapElement:n,map:t}},B=function(e,n,t,o){(0,i.d4)((function(){if(t)return e.current.on("move zoomend",o),function(){e.current.off("move zoomend",o)};function o(){n.current=[e.current.getCenter(),e.current.getZoom()]}}),[t]),(0,i.d4)((function(){o&&e.current.setView(n.current[0],n.current[1],{animate:!1})}),[t])},W=t(84595),D=t(21682),F=t(58260),J=function(e){var n=e.x,t=e.y,o=e.z;return"".concat(n,"|").concat(t,"|").concat(o)},N=Z=function(e){return e.type===a.lU.cityZone?"".concat(N(e),"|").concat(e.path[0].slice(0,10)):e.path[0]},U=var V=function(e,n,t,o){var r=[t?null:a.lU.region,o?null:a.lU.country].filter(Boolean),s=(0,l._)((0,i._Y)((function(e,n){return"add"==n.type?(0,c._)((0,u._)({},e),(0,F._)({},n.key,n.data)):(0,c._)((0,u._)({},e),(0,F._)({},n.key,void 0))}),{}),2),d=s[0],p=s[1],f=(0,i.sO)(new Map).current;var m=(0,i.Ye)((function(){return function(e){var n=new Set,t=[];return Object.values(e).forEach((function(e){e&&e.forEach(()})),t}(d)}),[d]),v=f.size>0;return{loadTile:function(n){var t=J(n),o=e(n).then((function(e){f.get(t)===o&&p({type:"add",data:e.polygons.concat(e.boundaries).filter((),key:t}),f.delete(t)})).catch((function(){return f.delete(t)}));return f.set(t,o),o},unloadTile:function(e){var n=J(e);f.delete(n),p({type:"remove",key:n})},loadPolygon:function(e){var t=N(e),o=m.filter((function(n){return(0,a.Qy)(n,e)}));o.length&&p({type:"add",data:o,key:t});var r=n(e).then((function(e){f.get(t)===r&&p({type:"add",data:e.polygons,key:t}),f.delete(t)})).catch(();return f.set(t,r),r},unloadPolygon:function(e){var n=N(e);f.delete(n),p({type:"remove",key:n})},polygons:m,loading:v}},j=H=function(e){var n=e.map,t=e.values,o=e.getKey,r=e.createLayer,a=e.getDerivedState,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],c=(0,i.Ye)((,[]);(0,i.d4)((function(){for(var e=new Set(c.keys()),i=0;i<t.length;i++){var u=t[i],l=o(u),s=c.get(l),d=a&&a(u,l);if(s){if(s.update){var p=s.update(u,d,s.state);if(s.state=d,p&&p!==s.layer){var f=s.layer.marker;f&&f.remove(),s.layer.remove(),p.addTo(n.current),s.layer=p}}e.delete(l)}else{var m=r(u,l,d),v=void 0;(v="layer"in m?m:{layer:m,update:void 0,state:d}).state=d,v.layer.addTo(n.current),c.set(l,v)}}e.forEach((function(e){var n=c.get(e).layer.marker;n&&n.remove(),c.get(e).layer.remove(),c.delete(e)}))}),[t].concat(u))},Y="#439ECC",q=.2,G=.4,K="#3D7A99",Q=1,X=2,$={fillColor:Y,fillOpacity:0,color:"#A1ADB3",opacity:Q,weight:X},ee=(0,c._)((0,u._)({},$),{fillOpacity:G}),ne={fillColor:Y,fillOpacity:q,color:K,opacity:Q,weight:X},te=(0,c._)((0,u._)({},ne),{fillOpacity:G}),oe={fillColor:Y,fillOpacity:.1,color:K,opacity:Q,weight:X};var re=function(e,n){e.setStyle(n.highlight?n.isSelected||n.parentSelected?te:ee:n.isSelected?ne:n.parentSelected?oe:$),queueMicrotask((function(){n.isSelected||n.parentSelected?function(e){e._map&&e.bringToFront()}(e):function(e){e._map&&e.bringToBack()}(e)}))},ie=function(e,n,t,o,r,s,d,p){var f=(0,l._)((0,i.eJ)(),2),m=f[0],g=f[1],h=V((,t,d,p),y=h.loadTile,_=h.unloadTile,b=h.loadPolygon,S=h.unloadPolygon,M=h.polygons,w=h.loading,k=M.filter((function(e){return e.type!==a.lU.metroLine&&e.type!==a.lU.metro}));!function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,i.sO)();o.current=n;var r=!1!==t.enabled;(0,i.d4)((function(){if(r){var n=new A.mU((0,c._)((0,u._)({},t),{tileSize:256*(t.sizeMultiplier||1)})),i=new Map;return n.createTile=function(e,n){var t=document.createElement("div"),r=o.current(e),a=r.data,u=r.onUnload;return Promise.resolve(a).then((),i.set(j(e),u),t},n.on("tileunload",(function(e){var n=e.coords,t=i.get(j(n));t&&t(),i.delete(j(n))})),n.addTo(e.current),function(){n.remove(),i.forEach((),i.clear()}}}),[r])}(e,(function(e){var n=e.x,t=e.y,o=e.z;return{data:y({x:n,y:t,z:o}),onUnload:}),{sizeMultiplier:4,enabled:r}),function(e,n,t,o){var r=(0,i.sO)(),a=r.current||new Map,u=new Map;e.forEach((function(e){var o=n(e);u.set(o,e),a.has(o)?a.delete(o):t(e)})),a.forEach((),r.current=u}(o.values,N,b,S);var E=(0,i.Ye)((function(){return new Set(o.values.filter(().map(N))}),[o.values]),C=(0,i.Ye)((function(){var e=[],n=[],t=new Set,o=new Set;return k.forEach((function(e){E.has(N(e))?e.parents.forEach((function(e){o.add(N(e))})):e.parents.forEach(()})),k.forEach((function(r){var i=N(r);t.has(i)?(E.has(i)||o.has(i))&&n.push(r):e.push(r)})),{polygons:e,boundaries:n}}),[k,o.values]),T=C.polygons,z=C.boundaries;return H({map:e,values:T,getKey:Z,getDerivedState:function(e){return{isSelected:E.has(N(e)),parentSelected:e.parents.some((),highlight:Boolean(m&&U(m,e))}},createLayer:function(e,n,t){var o=(0,a.UI)(e.path),r=(0,v.createPolygon)(o,$);return re(r,t),"ontouchstart"in window||(r.on("mouseover",(function(){g(e)})),r.on("mouseout",(function(){g((function(n){return n&&(0,a.Qy)(n,e)?null:n}))}))),r.on("click",(function(){s(e)})),{layer:r,update:function(n,t,o){return["isSelected","parentSelected","highlight"].some((function(e){return o[e]!==t[e]}))&&(re(r,t),t.highlight?ae(e,r):ue(r)),r}}}},[m,o.values]),H({map:e,values:z,getKey:Z,createLayer:function(e){var n=(0,a.UI)(e.path),t=(0,v.createPolyline)(n,(0,c._)((0,u._)({},ne),{weight:4}));return t.bringToFront(),{layer:t,update:function(){t.bringToFront()}}}}),{loading:w}},ae=function(e,n){var t=e.label,o=e.type,r=(0,a.wj)(e);n.getTooltip()&&n.isTooltipOpen()||(o===a.lU.cityZone&&r&&(t="".concat(t," (").concat(r.label,")")),n.bindTooltip(t,{offset:[0,-35],permanent:!0,direction:"center",opacity:1}))},ue=ce=t(95006);var le={DefaultStyle:(0,c._)((0,u._)({},$),{opacity:0,stroke:!1,radius:400,weight:3}),SelectedStyle:(0,c._)((0,u._)({},ne),{stroke:!0,weight:3}),SelectedHoverStyle:(0,c._)((0,u._)({},te),{stroke:!0,weight:3}),DefaultHoverStyle:(0,c._)((0,u._)({},ee),{stroke:!0,weight:3})},se={weight:3},de={1731:"im-searchMapMetroTooltip--barcelona",3130:"im-searchMapMetroTooltip--bilbao",7140:"im-searchMapMetroTooltip--madrid",5630:"im-searchMapMetroTooltip--malaga",2747:"im-searchMapMetroTooltip--palma",6928:"im-searchMapMetroTooltip--sevilla",7418:"im-searchMapMetroTooltip--valencia"},pe=parseInt("-".concat(10)),fe=A.bb.extend({createIcon:function(){var e=document.createElement("div");this._setIconStyles(e,"icon"),this.div=e,this.setIsMinimized(this.options.isMinimized),this.div.setAttribute("data-cy","metro-icon");var n=document.createElement("div");return n.appendChild(e),n},setIsMinimized:function(e){var n;this.div.style.transform="translate(-50%, 0)",(n=this.div.classList).add.apply(n,(0,r._)(this.options.classes.split(" "))),this.div.classList.toggle(this.options.isMinimizedClass,e),this.div.parentElement&&(e?this.div.parentElement.style.zIndex="0":(this.div.parentElement.style.zIndex="999",this.div.parentElement.style.position="relative")),this.div.innerHTML=e?"":this.options.label,this.div.style.width=e?"".concat(20,"px"):"auto",this.div.style.height="".concat(e?20:32,"px"),this.div.style.marginTop="".concat(e?pe:pe+-6,"px")}}),me=function(e){var n=e.classes,t=e.label,o=e.isMinimized,r=e.isMinimizedClass;return new fe({iconSize:["auto","auto"],classes:n,label:t,isMinimized:o,isMinimizedClass:r})},ve=function(e,n){e.setStyle(n.highlight?n.isSelected?le.SelectedHoverStyle:le.DefaultHoverStyle:n.isSelected?le.SelectedStyle:le.DefaultStyle),queueMicrotask((function(){n.isSelected?function(e){e._map&&e.bringToFront()}(e):e)}))},ge=ce.vl[a.lU.metro]+1,he=function(e,n,t,o,r,i){if(!n.getTooltip()||!n.isTooltipOpen()){var u=!o&&(r||t<ge),c=de[(0,a.WY)(e,a.lU.city).id],l=(0,A.WJ)(parseFloat(e.lat),parseFloat(e.lng)),s=(0,v.createMarker)([0,0],{icon:me({classes:(0,d.AK)("im-searchMapMetroTooltip",c),label:e.label,isMinimized:u,isMinimizedClass:"im-searchMapMetroTooltip--onlyIcon"})});return s.setLatLng(l),s.addTo(i.current),s}},ye=function(e,n,t,o,r,i){var a=!o&&(r||t<ge);e.options.icon.setIsMinimized(a)},_e=t(82936),be=t(70385),Se=t(30850),Me=t(60610);function we(){var e=(0,o._)(["\n                ","\n            "]);return we=function(){return e},e}function ke(){var e=(0,o._)(["\n                    <span class=",">\n                        ","\n                    </span>\n                "]);return ke=function(){return e},e}ar Ce=(0,i.Sk)((function(e){var n=e.mapConfig,t=e.mapPosition,o=e.currentMode,r=e.onConfirm,y=e.initialValues,w=e.metroEnabled,E=e.modalAutoSubmit,C=e.onAutoSubmit,T=e.searchMetroDisabled,z=e.regionSearchEnabled,F=e.countrySearchEnabled,J=e.internationalEnabled,Z=e.internationalLabelsEnabled,U=e.alternatePolygonsApiEnabled,V=o===_.N3.Place,j=(0,I.T)(V),Y=document.documentElement.lang.slice(0,2);if(j){y=function(e){var n,t;return!(!z&&(null===e||void 0===e||null===(n=e[0])||void 0===n?void 0:n.type)===a.lU.region||!F&&(null===e||void 0===e||null===(t=e[0])||void 0===t?void 0:t.type)===a.lU.country)}(y)?y:[];var q=(0,b.s)(),G=R((function(){return(0,c._)((0,u._)({},n),{scrollWheelZoom:!0,center:y.length?null:n.center,minZoom:n.placeSelectionMinZoom,maxZoom:n.placeSelectionMaxZoom})})),K=G.mapElement,Q=G.map,X=(0,i.Ye)((,[]);(0,i.d4)((function(){y.length&&(0,ce.DM)(y[0],X,Q,te)}),[]),(0,i.d4)((function(){Q.current.invalidateSize()}),[V]);var $=(0,i.sO)(),ee=(0,L.X)(y),ne=ee.values,te=(0,p.j3)("small"),oe=(0,l._)((0,i.eJ)(te),2),re=oe[0],ae=oe[1],ue=(0,W.sc)(ne[0]),de=(0,D.A)(ne[0]).metroListItems,pe=function(e,n){ee.add(e,!0),ze.current=null,ae(!0),(0,ce.DM)(e,X,Q,te),q&&q.autocompleteSelection(n,!0),$.current.blur()},fe=(0,P.Z)(ne,$,pe,ee.removeAll,Q,w,z,F,J,Z);(0,p.lo)($,(function(e){te||V&&!ee.values.length&&e.focus()}),[V]);var me=fe.inFocus&&""===fe.search,Ce=!me&&Boolean(ue.city&&ue.list)&&!fe.inFocus,Te=Boolean(ee.values.length)&&!fe.inFocus,ze=(0,i.sO)(null);!(ne.length>0)||ze.current&&function(e,n){return e.length>0&&e.every((function(e){return n.find((function(n){return(0,a.Qy)(n,e)||n.children.find(()}))}))}(ne,ze.current)||de===ze.current||(ze.current=de);var xe=!me&&(ze.current&&ze.current.length>0||ne.length>0&&ne.every(be.hY))&&!fe.inFocus,Pe=(0,O.ZZ)(Q);B(Q,t,V,!Te);var Le=(0,i.Ye)((function(){return e=n.polygonServiceHost,t=n.polygonsServiceVersion,o=U?Y:n.polygonsServiceLanguage,function(n,r){return(0,Me.d)("".concat(e,"/api-next/geography/polygons/").concat(n.z,"/").concat(n.x,"/").concat(n.y,"/").concat(r,"/").concat(t,"/").concat(o,"/")).json()};var e,t,o}),[]);ie(Q,Le,X,ee,!ze.current,(,z,F),function(e,n,t){var o=(0,l._)((0,i.eJ)(),2),r=o[0],s=o[1],d=(0,l._)((0,i.eJ)(!1),2),p=d[0],f=d[1],m=(0,i.Ye)((function(){var e=[];return n.values.forEach((function(n){switch(n.type){case a.lU.metro:e.push(n.id);break;case a.lU.metroLine:n.children.forEach(()}})),new Set(e)}),[n.values]),g=(0,l._)((0,i.eJ)([]),2),h=g[0],y=g[1];(0,i.d4)((function(){t?e.current.setMinZoom(ge-2):e.current.setMinZoom(e.current.options.placeSelectionMinZoom)}),[t]),(0,i.d4)((function(){var e=[],n={};t&&t.forEach((function(t){t.children.forEach(()})),y(e)}),[t]);var _=(0,l._)((0,i.eJ)(-1),2),b=_[0],S=_[1];(0,i.d4)((function(){var n=return e.current.on("zoomend",n),),[]),(0,i.d4)((function(){var n=function(){f(!0)};e.current.on("mousedown",n);var t=function(){f(!1)};return e.current.on("mouseup",t),),[]),H({map:e,values:t||[],getKey:N,getDerivedState:null,createLayer:function(n){var t=n.tracks?n.tracks.map((function(e){return new A.aH(e&&e.map((),(0,c._)((0,u._)({},se),{color:n.color||"#A1ADB3"}))})):null,o=new A.ex;return t&&t.forEach((),o}},[n.values,t]),H({map:e,values:h,getKey:N,getDerivedState:function(e){return{isSelected:m.has(e.id),highlight:!p&&!!r&&(0,a.Qy)(r,e),zoomLevel:b}},createLayer:function(t,o,r){var i=(0,v.createCircle)(new A.MP(t.lat,t.lng),le.DefaultStyle);return i.marker=he(t,i,b,r.highlight,r.isSelected,e),ve(i,r),"ontouchstart"in window||(i.on("mouseover",(),i.on("mouseout",(function(){s((function(e){return e&&(0,a.Qy)(e,t)?null:e}))}))),i.on("click",(),{layer:i,update:function(n,o,r){if(["isSelected","highlight"].some(()&&(ve(i,o),ye(i.marker,t,o.zoomLevel,o.highlight,o.isSelected,e)),r.zoomLevel!==o.zoomLevel){var a=r.zoomLevel>=ge&&o.zoomLevel<ge,u=r.zoomLevel<ge&&o.zoomLevel>=ge;!a&&!u&&o.highlight===r.highlight||o.isSelected||ye(i.marker,t,o.zoomLevel,o.highlight,o.isSelected,e)}return i}}}},[r,n.values,t,b])}(Q,ee,ze.current),(0,i.d4)((function(){ne.find(be.IE)&&q&&q.triggerMicrozoneSearch(!0),ne.find(be.hY)&&q&&q.triggerMetroSearch(!0)}),[ne]);var Oe=(0,i.Ye)((function(){return(0,i.dy)(we(),(Ce||xe)&&S({source:Ce?ue.city:null,items:Ce?ue.list:ze.current,onAdd:function(e){ee.add(e),(0,ce.DM)(e,X,Q,te),q&&q.checkInteraction()},onRemove:ee.remove,values:ne,defaultListHidden:!re}))}),[Ce,xe,ue.city,ue.list,ze.current,ne,re]),Ie=(0,i.dy)(Ee(),(0,d.AK)(Se.z.autocomplete,Se.z.searchMapBox),!!ne.length&&(0,M.U)({values:ne,onRemove:function(){ee.removeAll(),$.current.focus()},onClick:function(){(0,ce.DM)(ee.values[0],X,Q,te)},internationalLabelsEnabled:Z}),!ne.length&&(0,i.dy)(ke(),Se.z.autocompleteIcon,fe.inFocus&&te?(0,f.J)({name:"arrow-right",className:Se.z.autocompleteIconBack}):(0,f.J)({name:"lens"})),Se.z.autocompleteInput,T?(0,s.dW)("lu_hp_select_location"):(0,s.dW)("hp_select_location"),$,fe.inFocus&&(0,m.aV)({highlight:fe.highlight,items:fe.items,onClick:fe.selectItem,searchString:fe.search,loading:fe.loading}),me&&(0,h.q)({values:ne,withGeolocation:!0,onGeolocationRequest:Pe.locateUser,onSelect:function(e){ee.setValues(e),pe(e[0],!0)},metroEnabled:w,internationalLabelsEnabled:Z}),Oe,!te&&g({position:"bottomright",children:k({onClick:Pe.locateUser}),map:Q}));return V&&x({currentMode:o,map:K,leftSide:Ie,isMobile:te,confirmButtonVisible:Te,handleConfirm:function(){if(r(ne),E){var e=document.querySelector("nd-search-module");e&&e.submit(),null===C||void 0===C||C(ne)}},title:ze.current&&ze.current.length>0?te?(0,s.dW)("search_map_header_select_metro_title"):(0,s.dW)("search_map_header_metro_title"):null,modalAutoSubmit:E})}})),Te=t(21880),ze=t(67828),xe=t(1841),Pe=(0,i.Sk)((function(e){var n=xe.t0.get();switch(e.drawMode){case _.N3.DrawCircle:n=n.filter((function(e){return"route"===e.type||e.geometry&&"Point"===e.geometry.type&&e.properties&&"Route"!==e.properties.type}));break;case _.N3.DrawPolygon:n=n.filter((function(e){return"route"===e.type||e.geometry&&"Point"!==e.geometry.type&&e.properties&&"Route"!==e.properties.type}));break;case _.N3.Route:n=n.filter(()}return(0,ze.Q)((0,c._)((0,u._)({},e),{items:n}))})),Le=t(32635);function Oe(){var e=(0,o._)(["\n    <div class=",">\n        <div class=",">","</div>\n    </div>\n"]);return Oe=function(){return e},e}function Ie(){var e=(0,o._)(['\n                          <div class="im-searchMap__bottomControls">\n                              ',"\n                          </div>\n                      "]);return Ie=function(){return e},e}ar Re,Be,We=function(e){return(0,i.dy)(Oe(),Se.z.drawToolbarMessageBox,Se.z.drawToolbarMessageBoxTitle,e)},De=(0,i.Sk)((function(e){var n=e.drawingMode,t=e.shapePoints,o=e.tooBig,r=e.needMoreZoom,a=e.setDrawingMode,u=e.currentMode,c=(0,p.j3)("small");return(0,i.dy)(Ae(),(function(){switch(n){case Te.oO.Circle:return We((0,s.dW)("box_msg_select_point"));case Te.oO.Polygon:case Te.oO.Freehand:return We(o?(0,s.dW)("box_msg_polygon_too_big"):c?(0,s.dW)("box_msg_draw_area"):(0,s.jn)("box_msg_draw_polygon",t))}return r?We((0,s.dW)("box_msg_need_more_zoom")):c?(0,i.dy)(Ie(),u===_.N3.DrawCircle?(0,C.zx)({text:(0,s.dW)("act_select_point"),style:"outline",onClick:):(0,C.zx)({text:(0,s.dW)("act_draw_freehand_area"),style:"outline",onClick:)):null}))})),Fe=t(28394),Je=t(76933);Be=Re||(Re={})).point_of_interest="point_of_interest",Be.locality="locality",Be.route="route",Be.neighborhood="neighborhood",Be.street_address="street_address";var Ze=function(){function e(n){var t=this;(0,Fe._)(this,e),this.geocode=function(e){return t.doRequest("".concat(t.baseUrl,"/geocode"),{q:e.address,city:e.city,bbox:Ve(e.bounds),proximity:je(e.proximity),language:e.language||t.opts.language,country:e.country||t.opts.country,limit:e.limit,key:t.opts.key})},this.reverse=function(e){return t.doRequest("".concat(t.baseUrl,"/reverse"),{q:je(e.latLng),language:e.language||t.opts.language,limit:e.limit,key:t.opts.key})},this.autocomplete=function(e){return t.doRequest("".concat(t.baseUrl,"/autocomplete"),{q:e.address,city:e.city,bbox:Ve(e.bounds),proximity:je(e.proximity),language:e.language||t.opts.language,country:e.country||t.opts.country,limit:e.limit,key:t.opts.key})},this.opts=n}return(0,Je._)(e,[{key:"baseUrl",get:,{key:"payTheBill",value:,{key:"doRequest",value:function(e,n){var t=this;return n.language&&"it"===n.language&&(n.language="it-IT"),(0,Me.d)(e,{searchParams:n}).json().then((function(o){return t._payTheBill=Ue(e,n,o.requestId),o}))}}]),e}(),Ue=function(e,n,t){return function(){return Me.d.post(e,{json:Ne({requestId:t},n)})}},Ve=function(e){return"object"==typeof e&&null!==e&&void 0!==e.toBBoxString?e.toBBoxString():e},je=function(e){return"object"==typeof e&&null!==e?"".concat(e.lat,",").concat(e.lng):e},He=function(e){var n=(0,i.Ye)((,[]),t=(0,m.o9)({input:e.input,autocompleteApi:function(t){return n.autocomplete({address:t,bounds:(o=e.map.current.getBounds(),o.getSouthEast().distanceTo(o.getNorthWest())?e.map.current.getBounds().toBBoxString():null),limit:10,proximity:e.map.current.getCenter()}).then((function(e){return e.results.map((function(e){return(0,c._)((0,u._)({icon:"marker",id:e.address,label:e.address,description:e.context,type:e.type},e.geometry.location),{zoom:(n=e,n.type===Re.locality?12:15)});var n}))}));var o},reducer:function(t,o){return"ADD_ITEM"===o.type?(n.payTheBill(),e.onSelect&&e.onSelect(o.item),[o.item]):o.changes}}),o=t.values[0],r=t.inFocus?t.search:o?o.label:"";return(0,p.lo)(e.input,(,[r]),t};unction qe(e,n){var t=document.documentElement.lang.replace("_","-"),o=e<1e3?0:n?1:2,r=new Intl.NumberFormat(t,{style:"decimal",minimumFractionDigits:o,maximumFractionDigits:o}).format;return e<1e3?r(e)+" m":r(e/1e3)+" km"}var Ge={radius:750,maxDefaultRadius:15e3,minRadius:200,maxRadius:5e4,editable:!0,draggable:!0,color:"#0e4e73"},Ke={editable:!0,color:"#0e4e73",addMarkers:!0,closeTitle:(0,s.dW)("lbl_title_draw_close_polygon")},Qe=function(e,n){var t=function(e){var n=e.radius,t=e.isMobile;return(0,i.dy)(Ye(),qe(n,t),Se.z.circleTooltip,(0,f.J)({name:"expand"}))}({radius:e.getRadius(),isMobile:n});e.bindTooltip(t.create(),n?{direction:"center",anchor:"bottom"}:void 0).on("change resizing",(function(e){var o=e.radius;!function(e){var n=e.tooltip,t=e.radius,o=e.isMobile;n.update([qe(t,o),Se.z.circleTooltip,(0,f.J)({name:"expand"})])}({tooltip:t,radius:o,isMobile:n})}))},Xe=function(e){var n=(0,l._)(e.getLatLngs(),1)[0];return n?Array.isArray(n)?n.length:1:0},$e={shape:null,mode:null,shapePoints:0};var en=function(e){if(!e)return $e;var n={};return(0,A.to)(e,{onEachFeature:function(t,o){var r;(r=t).geometry&&"Point"===r.geometry.type?(n.shape=new Te.Hz(o.getLatLng(),(0,u._)({},Ge,t.properties)),n.mode=Te.oO.Circle,n.shapePoints=0):e.properties&&"Route"===e.properties.type?n.mode=Te.oO.Polygon:(n.shape=new Te.gC(o.getLatLngs(),(0,u._)({},Ke,t.properties)),n.mode=Te.oO.Polygon,n.shapePoints=Xe(n.shape))}}),n},nn=function(e,n){switch(n.type){case"SET_SHAPE":return(0,c._)((0,u._)({},e),{shape:n.payload,shapePoints:e.mode===Te.oO.Polygon?Xe(n.payload):0});case"SET_MODE":return(0,c._)((0,u._)({},$e),{mode:n.payload});case"ADD_POINT":return e.mode!==Te.oO.Polygon||e.shape?e:(0,c._)((0,u._)({},e),{shapePoints:e.shapePoints+1});case"CLEAR":return $e;case"RESET":return n.payload}},tn=t(79652),on=t(59312); cn=(0,A.BP)({iconSize:[40,40],iconAnchor:[20,40],html:(0,f.J)({name:"marker--active"}).create().firstElementChild.outerHTML}),ln=(0,i.Sk)((function(e){var n=e.mapConfig,t=e.mapPosition,o=e.currentMode,r=e.onConfirm,a=e.initialValue,h=e.modalAutoSubmit,y=e.onAutoSubmit,b=o===_.N3.DrawPolygon;if((0,I.T)(b)){var S=R((function(){return(0,c._)((0,u._)({},n),{scrollWheelZoom:!0,maxZoom:n.drawOnMapMaxZoom,minZoom:6})})),M=S.mapElement,w=S.map,E=function(e,n){var t=(0,i.sO)(),o=(0,l._)((0,i._Y)(nn,n,en),2),r=o[0],a=r.shape,c=r.mode,s=r.shapePoints,d=o[1],f=(0,p.j3)("small");function m(){t.current.clear(),d({type:"CLEAR"})}function v(){var n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a&&e.current.fitBounds(a.getBounds().pad(f?.2:.1),{animate:n})}(0,i.d4)((function(){var n=t.current=(0,Te.cG)(e.current,{handlers:[new Te.hW(e.current,Ke),new Te.M1(e.current,(0,u._)({},Ge)),new Te.EY(e.current,Ke)]});c&&n.setShape(c,a),n.on("overlaycomplete",(),n.on("pointadd",()}),[]),(0,i.d4)((function(){c===Te.oO.Circle&&a&&Qe(a,f)}),[a,c]),(0,i.d4)((,[]),(0,i.d4)(v,[a]),(0,i.d4)((function(){if(a&&f)return window.addEventListener("resize",e),),[a,f]),(0,i.d4)((function(){a&&(a.on("remove",m),a.on("change",())}),[a]),(0,i.d4)((function(){a&&c===Te.oO.Circle&&a.on("change",v)}),[a]);var g=a&&a.toGeoJSON();return g&&c===Te.oO.Circle&&(g.properties.radius=a.getRadius()),{geoJSON:(0,i.Ye)((,[g&&JSON.stringify(g)]),shape:a,shapePoints:s,deleteShape:m,drawManager:t,drawingMode:c,setDrawingMode:function(e){t.current.setMode(e),d({type:"SET_MODE",payload:e})},reset:function(e){var n=en(e);t.current.setShape(n.mode,n.shape),d({type:"RESET",payload:n})}}}(w,a),C=(0,l._)((0,i.eJ)(null),2),T=C[0],z=C[1];(0,i.d4)((,[E.geoJSON]),(0,i.d4)((function(){if(!E.shape)switch(o){case _.N3.DrawCircle:E.setDrawingMode(Te.oO.Circle);break;case _.N3.DrawPolygon:V||E.setDrawingMode(Te.oO.Polygon)}}),[o,E.drawingMode]);var P=E.drawingMode!==Te.oO.Circle&&E.shape&&(0,be.hT)(E.shape)>2e4,L=Boolean(E.shape)&&!P,W=(0,i.sO)(),D=!E.geoJSON,F=He({input:W,config:n.geocodingOptions,map:w,onSelect:function(e){E.deleteShape(),xe.t0.add(e),W.current.blur()}}),J=(0,l._)(F.values,1)[0],N=L&&!F.inFocus,Z=""===F.search&&F.inFocus,U=(0,O.ZZ)(w);(0,i.d4)((,[b]);var V=(0,p.j3)("small");(0,i.d4)((function(){V||b&&!J&&D&&W.current.focus()}),[b]),(0,i.d4)((,[D]),(0,i.d4)((function(){if(J){if(D){var e=(0,A.WJ)(parseFloat(J.lat),parseFloat(J.lng));w.current.setView(e,J.zoom);var n=(0,v.createMarker)([0,0],{icon:cn});return n.setLatLng(e),n.addTo(w.current),F.removeItem(J)}}),[F.values,D]),B(w,t,b,b&&D);var j=(0,l._)((0,i.eJ)(!1),2),H=j[0],Y=j[1];(0,i.d4)((function(){w.current.setMinZoom(E.drawingMode?n.drawOnMapMinZoom:6)}),[E.drawingMode]),(0,i.d4)((function(){function e(){Y(n.drawOnMapMinZoom>w.current.getZoom())}return w.current.on("zoomend",e),),[]);var q=(0,i.dy)(un(),(0,d.AK)(Se.z.autocomplete,Se.z.searchMapBox),E.geoJSON&&(0,Le.x)({value:T||!a?E.geoJSON:a,onClick:onRemove:),(0,i.dy)(an(),!E.geoJSON&&(0,i.dy)(rn(),Se.z.autocompleteIcon,F.inFocus&&V?(0,f.J)({name:"arrow-right",className:Se.z.autocompleteIconBack}):(0,f.J)({name:"lens"})),Se.z.autocompleteInput,(0,s.dW)("insert_address"),W),F.inFocus&&(0,m.aV)({onItemHover:F.handleItemHover,highlight:F.highlight,items:F.items,onClick:F.selectItem,searchString:F.search,loading:F.loading}),Z&&Pe({withGeolocation:!0,onGeolocationRequest:onSelect:function(e){(0,tn.isGeoJSON)(e)?(E.reset(e),xe.t0.add(e)):F.selectItem(e)},drawMode:o}),!L&&g({position:"bottomcenter",children:De({drawingMode:E.drawingMode,shapePoints:E.shapePoints,tooBig:P,needMoreZoom:H,setDrawingMode:E.setDrawingMode,currentMode:o}),map:w}),g({position:"bottomright",children:k({onClick:function(){U.locateUser(),(0,on.MZ)("map")}}),map:w}));return b&&x({currentMode:o,map:M,leftSide:q,isMobile:V,confirmButtonVisible:N,handleConfirm:function(){if(r(T||!a?E.geoJSON:a),h){var e=document.querySelector("nd-search-module");e&&e.submit(),null===y||void 0===y||y(T||!a?E.geoJSON:a)}},modalAutoSubmit:h})}}));function sn(){var e=(0,o._)(['<input\n            type="range"\n            step="1"\n            class="im-range__input"\n            ref="','"\n            min="','"\n            max="','"\n            value="','"\n            onMouseUp=',"\n            onTouchend=","\n            onInput=","\n        /> "]);return sn=function(){return e},e}var dn=pn=(0,i.Sk)((function(e){var n=e.intervals,t=e.initialValue,o=e.value,r=e.onSlideEnd,a=void 0===r?dn:r,u=e.onChange,c=void 0===u?dn:u,l=(0,i.sO)(null),s=fn(n),d=s.transformer,p=s.reverse;(0,i.d4)((function(){if(t){var e=p(t).toFixed(0);l.current.value="".concat(e),l.current.style.setProperty("background-size","".concat(e,"% 100%"))}}),[t,p]),(0,i.d4)((function(){if(o){var e=p(o).toFixed(0);l.current.style.setProperty("background-size","".concat(e,"% 100%"))}}),[o,p]);var f=(0,i.I4)((function(e){var n=e.target;n.style.setProperty("background-size","".concat(n.value,"% 100%"));var t=+n.value;c&&c(d(t))}),[c,d]),m=(0,i.I4)((function(e){var n=+e.target.value;a&&a(d(n))}),[a,d]);return(0,i.dy)(sn(),l,0,100,o&&p(o).toFixed(2),m,m,f)})),fn=function(e){var n=(0,i.I4)((function(n){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=t?1:0;if(n<=e[0][o]){var r=e.slice(0,2);return[r[0],r[1]]}if(n>=e[e.length-1][o]){var i=e.slice(-2);return[i[0],i[1]]}var a=e.findIndex(();return[e[a-1],e[a]]}),[e]);return{transformer:(0,i.I4)((function(e){var t=(0,l._)(n(e),2),o=t[0],r=t[1],i=100*mn({min:o[0],max:r[0]})(e),a=vn({min:o[1],max:r[1]}),u=a.min,c=a.scale;return+Math.exp(u+c*(i-0)).toFixed(0)}),[n,mn,0]),reverse:(0,i.I4)((function(e){var t=(0,l._)(n(e,!0),2),o=t[0],r=t[1],i=vn({min:o[1],max:r[1]}),a=i.min,u=i.scale,c=(Math.log(0===e?1:e)-a)/u+0;return(r[0]-o[0])*(c/100)+o[0]}),[0,n])}},mn=function(e){return function(n){return(n-e.min)/(e.max-e.min)}},vn=function(e){var n=e.min,t=e.max,o=Math.log(0===n?1:n),r=Math.log(t);return{min:o,max:r,scale:(r-o)/100}};function gn(){var e=(0,o._)(["",":\n              <strong\n                  >","</strong\n              >"]);return gn=function(){return e},e}function hn(){var e=(0,o._)(["",""]);return hn=function(){return e},e}function yn(){var e=(0,o._)(["",":\n              <strong\n                  >","</strong\n              >"]);return yn=function(){return e},e}function _n(){var e=(0,o._)(["",""]);return _n=function(){return e},e}function bn(){var e=(0,o._)([" ",""]);return bn=function(){return e},e}var Sn=function(e){var n=e.isMobile,t=e.type,o=e.value;return(0,i.dy)(bn(),"time"===t?function(e){var n=e.isMobile,t=e.value;return(0,i.dy)(hn(),n?(0,s.dW)("travel_time_short_minutes_label",[t]):(0,i.dy)(gn(),(0,s.dW)("travel_time_label"),(0,s.dW)("travel_time_minute_label",[t],{count:parseInt(t)})))}({isMobile:n,value:o}):function(e){var n=e.isMobile,t=e.value,o=t>=1e3?t/1e3:t,r=t>=1e3?(0,s.dW)("travel_radius_distance_label"):(0,s.dW)("travel_radius_distance_label_meters");return(0,i.dy)(_n(),n?"".concat(o," ").concat(r):(0,i.dy)(yn(),(0,s.dW)("travel_radius_label"),t>=1e3?"".concat(t/1e3," ").concat((0,s.dW)("travel_radius_distance_label")):"".concat(t," ").concat((0,s.dW)("travel_radius_distance_label_meters"))))}({isMobile:n,value:o}))},Mn=t(90687);function wn(){var e=(0,o._)(["\n                                        <span class=","\n                                            >","\n                                        </span>\n                                    "]);return wn=function(){return e},e}function kn(){var e=(0,o._)(['\n                                <div class="im-radio__likeSwitch">\n                                    <label class="nd-switch__item"\n                                        ><input\n                                            class="nd-switch__nativeControl"\n                                            name="transport"\n                                            type="radio"\n                                            checked=',"\n                                            onClick=","\n                                            value=",'\n                                        />\n                                        <div class="nd-switch__control">\n                                            ',"\n                                        </div></label\n                                    >\n                                    ","\n                                </div>\n                            "]);return kn=function(){return e},e}function En(){var e=(0,o._)(["\n                          <div class=",">\n                              ","\n                          </div>\n                      "]);return En=function(){return e},e}function Cn(){var e=(0,o._)(["<div class=",">\n                              ","\n                          </div>"]);return Cn=function(){return e},e}function Tn(){var e=(0,o._)(["\n            <div class=",'>\n                <div class="nd-switch nd-switch--group">\n                    ',"\n                </div>\n            </div>\n\n            <div class=",">\n                ","\n                <div class=",">\n                    ","","\n                </div>\n            </div>\n        "]);return Tn=function(){return e},e}var zn=[{iconName:"car",value:"car",label:(0,s.dW)("move_on_car")},{iconName:"bike",value:"bike",label:(0,s.dW)("move_on_bike")},{iconName:"walker",value:"foot",label:(0,s.dW)("move_on_foot")},{iconName:"radius",value:"radius",label:(0,s.dW)("radius_distance")}],xn=[[0,5],[10,10],[30,15],[100,45]],Pn=[[0,200],[20,1e3],[40,2e3],[80,25e3],[100,5e4]],Ln=function(e){return 1e3*(0,be.m1)(e,1,"number")},On=(0,i.Sk)((function(e,n,t,o,r,a){var u=(0,p.j3)("small"),c=parseInt(e&&e.time,10)||10,s=t?n:c,m=t?Pn:xn,v=(0,l._)((0,i.eJ)(),2),g=v[0],h=v[1];(0,i.d4)((function(){t&&a()}),[t,a]),(0,i.d4)((function(){h(s)}),[s,h]);var y=(0,i.I4)((function(e){var n=t?Ln(+e):e;h(n)}),[t,h]),_=(0,i.I4)((function(e){a(),r(t?Ln(+e):e)}),[r,t,a]);return(0,i.dy)(Tn(),(0,d.AK)(Se.z.routeOptions,Se.z.searchMapBox),zn.map((function(n){return(0,i.dy)(kn(),e&&(e.transport===n.value||"radius"===n.value&&t),(,n.value,(0,f.J)({spriteUrl:Mn,name:n.iconName}),!u&&(0,i.dy)(wn(),Se.z.routeOptionsLabel,n.label))})),(0,d.AK)(Se.z.routeOptions,Se.z.searchMapBox),!u&&g?(0,i.dy)(En(),Se.z.routeOptionsTitle,Sn(t?{isMobile:u,type:"radius",value:g}:{isMobile:u,type:"time",value:g})):null,Se.z.routeOptionsRange,pn({value:s,intervals:m,onChange:y,onSlideEnd:_}),u&&g?(0,i.dy)(Cn(),Se.z.routeOptionsRangeLabel,Sn(t?{isMobile:u,type:"radius",value:g}:{isMobile:u,type:"time",value:g})):null)})),In=t(65762),An=Rn={polygon:null,simplePolygon:null},Bn=function(e,n,t,o){var r=(0,l._)((0,i._Y)((function(e,n){switch(n.type){case"SET":return{polygon:n.payload.polygon,simplePolygon:n.payload.simplePolygon};case"CLEAR":return Rn;default:return e}}),Rn),2),a=r[0],s=r[1],d=(0,i.I4)((function(){s({type:"CLEAR"}),e.current&&e.current.remove()}),[s]),p=(0,i.I4)((function(e,n){s({type:"SET",payload:{polygon:e,simplePolygon:n}})}),[s]),f=(0,i.I4)((,[p]),m=(0,i.I4)((,[p,a.polygon]);return(0,i.d4)((function(){var r;a.polygon&&0!==a.polygon.length&&(e.current&&e.current.remove(),e.current=(r=a.polygon[0].map((function(e){return new A.MP(e[1],e[0])})),new Te.gC(r,(0,c._)((0,u._)({},Ke),{noResize:!0}))),e.current.addEventListener("removeclick",(function(e){o&&o(e)})),e.current.addTo(n.current),n.current.fitBounds(e.current.getBounds(),t?{paddingTopLeft:[0,0],paddingBottomRight:[0,-170]}:{}))}),[a.polygon]),{polygon:a.polygon,simplePolygon:a.simplePolygon,removePolygons:d,setPolygon:f,setSimplePolygon:m}},Wn=function(e){var n=e.center,t=e.transport,o=e.time,r=e.simplify;return Me.d.get("/api-next/geocode/isolines/?locations={lng},{lat}&range={time}&transportation={transport}&simplify={simplify}".replace("{lat}",n.lat).replace("{lng}",n.lng).replace("{transport}",t).replace("{time}",o).replace("{simplify}",r)).json()},Dn=function(e,n){return"foot"!==n?e[0].length>250?"0.006":e[0].length>150?"0.005":"0.003":e[0].length>250?"0.0006":e[0].length>150?"0.0005":"0.0003"},Fn=function(e,n,t,o,r,a){var d=(0,p.j3)("small"),f=(0,i.sO)(),m=function(e){var n=(0,l._)((0,i._Y)((function(e,n){return"SET"===n.type?(0,u._)((0,c._)((0,u._)({},e),{time:e&&e.time||"10",transport:e&&e.transport||"car"}),n.payload):e}),e&&e.properties?{time:e.properties.time,transport:e.properties.transport}:null),2),t=n[0],o=n[1],r=(0,i.I4)((,[o]),a=(0,i.I4)((function(e){r({time:e})}),[r]),s=(0,i.I4)((,[r]),d=(0,i.I4)((,[o]);return{routeFormValid:An(t),state:t,setTime:a,setFormData:r,setTransport:s,clearForm:d}}(n),v=m.state,g=m.setTransport,h=m.setTime,y=m.setFormData,_=m.routeFormValid,b=m.clearForm,S=Bn(f,e,d,r),M=S.polygon,w=S.simplePolygon,k=S.removePolygons,E=S.setPolygon,C=S.setSimplePolygon;return(0,i.d4)((function(){v&&t&&a&&(k(),Wn({center:{lat:t.lat,lng:t.lng},transport:v.transport,time:v.time,simplify:"foot"===v.transport?"0":"0.001"}).then((function(e){E(e.features[0].geometry.coordinates),o(null)})).catch((function(){r(),o("immobiliare-it"===(0,be.wv)()?(0,s.dW)("lbl_not_valid_search_imm"):(0,s.dW)("lbl_not_valid_search_ies"))})))}),[v,t,a]),(0,i.d4)((function(){v&&t&&M&&0!==M.length&&a&&M[0].length>=100&&Wn({center:{lat:t.lat,lng:t.lng},transport:v.transport,time:v.time,simplify:Dn(M,v.transport)}).then((function(e){C(e.features[0].geometry.coordinates)}))}),[M,t,v]),{routeState:v,routePolygon:w||M,transportLayer:f,routeFormValid:_,removeRoutePolygons:k,setTransport:g,setTime:h,setRouteData:y,clearRoutePolygons:function(){f.current&&f.current.remove(),E(null),C(null)},clearRouteForm:b}},Jn={radius:750,maxDefaultRadius:1e3,minRadius:200,maxRadius:5e4,editable:!0,draggable:!0,color:"#0e4e73"},Nn=function(e){return Me.d.get("/api-next/geocode/reverse/?q={lat},{lng}&language=IT&limit=10".replace("{lat}",e.lat).replace("{lng}",e.lng)).json()},Zn=function(e,n,t,o,r,a,s){var d=(0,l._)((0,i.eJ)(s&&n&&n.geometry?(0,A.WJ)(n.geometry.coordinates[1],n.geometry.coordinates[0]):null),2),f=d[0],m=d[1];(0,i.d4)((function(){t&&!s&&m((0,A.WJ)(parseFloat(t.lat),parseFloat(t.lng)))}),[t,s]);var v=(0,l._)((0,i.eJ)(n&&n.properties&&n.properties.radius?n.properties.radius:1e3),2),g=v[0],h=v[1],y=function(e,n,t){var o=(0,p.j3)("small"),r=(0,l._)((0,i._Y)((function(o,r){switch(r.type){case"SET_SHAPE":o&&e.current.hasLayer(o)&&e.current.removeLayer(o);var i=new Te.Hz(r.payload.center,(0,c._)((0,u._)({},Jn),{radius:r.payload.radius}));return n&&(i.on("change",(),i.on("remove",(function(){f()})),i.on("removeclick",()),e.current.addLayer(i),i;case"CLEAR_SHAPE":return o&&e.current.hasLayer(o)&&e.current.removeLayer(o),null;default:return o}}),null),2),a=r[0],s=r[1];(0,i.d4)((function(){a&&function(e,n,t){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];n&&e.current.hasLayer(n)&&e.current.fitBounds(n.getBounds().pad(t?.2:.1),{animate:o})}(e,a,o)}),[a]);var d=(0,i.I4)((,[]),f=(0,i.I4)((function(){s({type:"CLEAR_SHAPE"})}),[]),m=(0,i.Ye)((function(){return function(e){var n=e&&e.toGeoJSON();return n&&(n.properties.radius=e.getRadius()),n}(a)}),[a]);return{shape:a,setShape:d,clearShape:f,geoJSON:m}}(e,(0,i.I4)((function(e){var n=(0,be.SQ)(e.radius,e.target.options.minRadius,e.target.options.maxRadius);e.latLng&&n&&b(e.latLng,n),h(n),m(e.latLng),Nn(e.latLng).then((function(e){a((0,be._x)(e.results[0]))}))}),[g,f]),(function(){a(null),m(null)})),_=y.shape,b=y.setShape,S=y.clearShape,M=y.geoJSON;(0,i.d4)((,[s]),(0,i.d4)((,[s,f,g]);var w=(0,i.I4)((,[]),k=Boolean(_);return{drawFormValid:k,value:k?M:null,shape:_,radius:g,setRadius:h,center:f,setCenter:m,cleanDrawings:w}};unction Vn(){var e=(0,o._)(["\n                ","\n            "]);return Vn=function(){return e},e}function jn(){var e=(0,o._)(["\n                    <div class=",">\n                        <div class=",">\n                            ","\n                        </div>\n                    </div>\n                "]);return jn=function(){return e},e}ar Yn=(0,A.BP)({iconSize:[40,40],iconAnchor:[20,40],html:(0,f.J)({name:"marker--active"}).create().firstElementChild.outerHTML}),qn=(0,i.Sk)((function(e){var n=e.mapConfig,t=e.mapPosition,o=e.currentMode,r=e.onConfirm,a=e.initialValue,h=e.modalAutoSubmit,y=e.onAutoSubmit,b=o===_.N3.Route||o===_.N3.DrawCircle,S=(0,I.T)(b),M=(0,l._)((0,i.eJ)(a&&a.properties?a.properties.address:null),2),w=M[0],E=M[1];(0,i.d4)((function(){a&&a.properties&&a.properties.radius&&Nn((0,A.WJ)(a.geometry.coordinates[1],a.geometry.coordinates[0])).then((function(e){E((0,be._x)(e.results[0]))}))}),[]);var C=(0,l._)((0,i.eJ)(null),2),T=C[0],z=C[1],P=(0,l._)((0,i.eJ)(a&&"Feature"===a.type&&a.properties&&"Route"!==a.properties.type||o===_.N3.DrawCircle),2),L=P[0],W=P[1],D=(0,p.j3)("small"),F=R((function(){return(0,c._)((0,u._)({},n),{scrollWheelZoom:!0,maxZoom:n.drawOnMapMaxZoom,minZoom:6})})),J=F.mapElement,N=F.map;(0,i.d4)((function(){N.current.invalidateSize()}),[b]);var Z=Fn(N,a,w,z,(,!L),U=Z.routeState,V=Z.routePolygon,j=Z.transportLayer,H=Z.routeFormValid,Y=Z.removeRoutePolygons,q=Z.setTransport,G=Z.setTime,K=Z.setRouteData,Q=Z.clearRoutePolygons,X=Z.clearRouteForm,$=Zn(N,a,w,0,0,E,L),ee=$.drawFormValid,ne=$.value,te=$.shape,oe=$.radius,re=$.setRadius,ie=$.setCenter,ae=$.cleanDrawings;if(S){(0,i.d4)((function(){ce.removeItem(w)}),[V]);var ue=(0,i.sO)(),ce=He({input:ue,config:n.geocodingOptions,map:N,onSelect:function(e){xe.t0.add(e),ue.current.blur(),E(e),ie((0,A.WJ)(parseFloat(e.lat),parseFloat(e.lng)))}}),le=(0,i.sO)(),se=(0,i.I4)((function(e){if(le.current)return clearTimeout(le.current),void(le.current=null);le.current=setTimeout((function(){if(Nn(e.latlng).then((function(e){return E((0,be._x)(e.results[0])),Q(),le.current=null,e})).then((function(e){3===o&&G(U?U.time:"10")})).catch((function(){z("immobiliare-it"===(0,be.wv)()?(0,s.dW)("lbl_not_valid_search_imm"):(0,s.dW)("lbl_not_valid_search_ies"))})),L){Q();var n=e.latlng;n&&(ie(n),le.current=null)}}),200)}),[E,Q,z,ie,L,G,o]);(0,p.o$)(N.current,"click",se);var de=(H&&w||ee)&&!ce.inFocus,pe=""===ce.search&&ce.inFocus,fe=(0,O.ZZ)(N);(0,i.d4)((,[w]),(0,i.d4)((function(){if(w&&!L){var e=(0,A.WJ)(parseFloat(w.lat),parseFloat(w.lng)),n=(0,v.createMarker)([0,0],{icon:Yn});return n.setLatLng(e),n.addTo(N.current),function(){n.remove()}}}),[w,L]);var me=(0,i.I4)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&ce.removeItem(w),E(null),Y()}),[E,Y,ce]);(0,p.lo)(J,(,[]),B(N,t,b,b&&!w);var ve=(0,i.I4)((function(e){if("radius"===e)return W(!0),void X();W(!1),q(e)}),[]);(0,i.d4)((,[L]);var ge=(0,i.I4)((,[L,G,re]),he=!!(w&&U&&U.transport&&U.time),ye=!!ne&&ne.properties&&ne.properties.radius,_e=(0,i.dy)(Hn(),(0,d.AK)(Se.z.autocomplete,Se.z.searchMapBox),he&&(0,In.z)({address:(0,u._)({},w),transport:U.transport,time:U.time,onClick:function(){N.current.fitBounds(j.current.getBounds())},onRemove:function(){me(!0),ie(null),ue.current.focus()}}),ye&&(0,Le.x)({value:ne,onClick:onRemove:function(){ae(),E(null),ue.current.focus()}}),!(w||ye)&&(0,i.dy)(Un(),Se.z.autocompleteIcon,ce.inFocus&&D?(0,f.J)({name:"arrow-right",className:Se.z.autocompleteIconBack}):(0,f.J)({name:"lens"}),Se.z.autocompleteInput,(0,s.dW)("insert_address"),ue),ce.inFocus&&(0,m.aV)({onItemHover:ce.handleItemHover,highlight:ce.highlight,items:ce.items,onClick:ce.selectItem,searchString:ce.search,loading:ce.loading}),pe&&Pe({withGeolocation:!0,onGeolocationRequest:function(){fe.locateUser(),(0,on.Gj)("historyList")},onSelect:function(e){(0,tn.isGeoJSON)(e)?(E(e.properties.address),e.properties.transport?(W(!1),K({transport:e.properties.transport,time:e.properties.time})):(W(!0),ie((0,A.WJ)(e.geometry.coordinates[1],e.geometry.coordinates[0])),re(e.properties.radius))):ce.selectItem(e)},drawMode:L?_.N3.DrawCircle:_.N3.Route}),!ce.inFocus&&(0,i.dy)(Vn(),On(U,oe,L,ve,ge,Y)),g({position:"bottomright",children:k({onClick:function(){fe.locateUser(),(0,on.Gj)("map")}}),map:N}),!w&&!te&&g({position:"bottomcenter",children:(0,i.dy)(jn(),Se.z.drawToolbarMessageBox,Se.z.drawToolbarMessageBoxTitle,T||(0,s.dW)("box_msg_select_point")),map:N}));return b&&x({currentMode:o,map:J,leftSide:_e,isMobile:D,confirmButtonVisible:de,handleConfirm:function(){if(r(L?ne:{type:"Feature",properties:(0,c._)((0,u._)({type:"Route"},U),{address:w,label:(0,be.mC)(w,U.transport,U.time)}),geometry:{type:"Polygon",coordinates:V}}),h){var e=document.querySelector("nd-search-module");e&&e.submit(),null===y||void 0===y||y(L?ne:{type:"Feature",properties:(0,c._)((0,u._)({type:"Route"},U),{address:w,label:(0,be.mC)(w,U.transport,U.time)}),geometry:{type:"Polygon",coordinates:V}})}},modalAutoSubmit:h})}}));function Gn(){var e=(0,o._)(["\n            ","\n            ","\n            ","\n        "]);return Gn=function(){return e},e}var Kn=(0,i.Sk)((function(e){var n,t=e.mapConfig,o=e.initialMode,u=void 0===o?_.N3.Place:o,c=e.initialDraw,l=e.initialValues,s=e.onConfirm,d=e.metroEnabled,p=e.modalAutoSubmit,f=e.searchMetroDisabled,m=e.regionSearchEnabled,v=e.countrySearchEnabled,g=e.internationalEnabled,h=e.internationalLabelsEnabled,y=e.alternatePolygonsApiEnabled,b=e.onAutoSubmit,S=[m?null:a.lU.region,v?null:a.lU.country].filter(Boolean),M=(n=[t.center,t.zoom],(0,i.sO)(n));return(0,i.dy)(Gn(),Ce({currentMode:u,initialValues:l&&l.filter((function(e){return!S.includes(e.type)})),mapConfig:t,mapPosition:M,onConfirm:function(e){s(_.N3.Place,(0,r._)(e))},metroEnabled:d,modalAutoSubmit:p,searchMetroDisabled:f,regionSearchEnabled:m,countrySearchEnabled:v,internationalEnabled:g,internationalLabelsEnabled:h,alternatePolygonsApiEnabled:y,onAutoSubmit:b}),ln({currentMode:u,initialValue:c,mapConfig:t,mapPosition:M,onConfirm:function(e){s(u,e)},modalAutoSubmit:p,onAutoSubmit:b}),qn({currentMode:u,initialValue:c,mapConfig:t,mapPosition:M,onConfirm:modalAutoSubmit:p,onAutoSubmit:b}))}))},51113:function(e,n,t){t.r(n),t.d(n,{Map:function(){return m},addControl:function(){return _},createBounds:function(){return l.SI},createCircle:function(){return d},createControl:function(){return p},createIcon:function(){return l.qv},createLatLng:function(){return l.WJ},createMap:function(){return y},createMarker:function(){return l.Jw},createPolygon:function(){return f},createPolyline:function(){return l.Rx},createPopup:function(){return l.gk},createRectangle:increaseZoom:function(){return E},isolateControlEvents:function(){return z},onMapChange:function(){return M},onMapLoad:function(){return w},reloadMap:function(){return k},setMaxZoom:function(){return b},setMinZoom:function(){return S}});var o=t(96804),r=t(28394),i=t(76933),a=t(69863),u=t(97135),c=t(69335),l=t(82634),s=t(56756);function d(e,n){return n=l.Zr.extend({radius:300},n),new l.Cd(e,n)}var p=f=m=function(e){(0,a._)(t,e);var n=(0,c._)(t);function t(e,i){var a;return(0,r._)(this,t),(a=n.call(this,e,l.Zr.extend({fadeAnimation:!1,scrollWheelZoom:!1},i))).attributionControl.setPrefix(""),a._tileLayer=new l.Im(h(i,l.AR.retina?2:1),{attribution:v()}),a._tileLayer.addTo((0,o._)(a)),(0,u._)(a)}return(0,i._)(t,[{key:"getTileLayer",value:]),t}(l.D5),v=g=h=function(e,n){var t=e.tilesUrlTemplate,o=e.language;return(0,s.v_)(t,(0,s.qC)({language:g(o||"it"),scale:n||1}))},y=function _(e,n){e.addControl(n)}function b(e,n){e.setMaxZoom(n)}nction w(e,n){var t=e.on("load",t)}function k(e){e.invalidateSize()}ar C=["dblclick","mousedown","touchstart","click","pointerdown","wheel"];unction z(e){C.forEach(()}}}]);
//# sourceMappingURL=search-map.3bc0f75a3c588052.js.map