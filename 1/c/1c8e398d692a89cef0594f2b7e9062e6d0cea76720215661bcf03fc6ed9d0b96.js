![function(t,e,r){var n=r(1);f.addEventListener("install",(),self.addEventListener("activate",();var u=0,c={};self.addEventListener("message",function(){var t=a(n.mark((function t(e){var r,i,a,u,s,f;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.data){t.next=2;break}return t.abrupt("return");case 2:r=e.data,i=r.id,a=r.key,u=r.type,s=o(r,["id","key","type"]),"history"===u&&e.waitUntil(p(e)),"info"===u&&c[a]&&c[a][i]&&((f=c[a][i]).data=s,f.resolve()),"confirm"===u&&c[a]&&c[a].id===i&&c[a].resolve(s.value);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());var s=function(){var t=a(n.mark((function t(e){var r,o,i,a,s;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=++u,c[r]={},o=c[r],t.next=5,clients.matchAll();case 5:return t.t0=function(t){return new Promise((function(e){o[t.id]={client:t,resolve:e,data:{}},t.postMessage({id:t.id,key:r,type:"info"})}))},i=t.sent.map(t.t0),t.next=9,Promise.race([new Promise((function(t){return setTimeout(t,50)})),Promise.all(i)]);case 9:if(s=!1,Object.keys(o).forEach((function(t){var r=o[t],n=r.client,i=r.data,u=i.focused,c=i.url,f=i.loading;i.unregister&&(s=!0),f&&(a&&!u||c===e&&(a=n))})),delete c[r],!s){t.next=15;break}return t.next=15,self.registration.unregister();case 15:return t.abrupt("return",a);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),f=function(t,e){return!!/^[23]\d+/.test(t.status)&&!!/id="fusion-app"/.test(e)},l=function(){var t=a(n.mark((function t(e){var r,o,i,a,l,p;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s(e.request.referrer);case 2:return r=t.sent,t.next=5,fetch(e.request);case 5:return o=t.sent,i=o.clone(),t.next=9,o.text();case 9:if(a=t.sent,!r||!f(o,a)){t.next=19;break}return l=++u,t.next=14,Promise.race([new Promise((),new Promise((function(t){c[l]={id:r.id,resolve:t},r.postMessage({id:r.id,key:l,spa:!0,url:e.request.url,currentUrl:e.request.referrer,html:a})}))]);case 14:if(p=t.sent,delete c[l],p){t.next=18;break}return t.abrupt("return",i);case 18:return t.abrupt("return",new Response(null,{status:204,statusText:"SPA link detected"}));case 19:return t.abrupt("return",i);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),p=function(){var t=a(n.mark((function t(e){var r,o,i,a,u;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.data.url,o=e.source,i=new URL(r).searchParams,i.get("logging")&&console.log("Fetching spas:",r),t.next=6,fetch(r);case 6:return a=t.sent,t.next=9,a.text();case 9:if(u=t.sent,f(a,u)){t.next=13;break}return o.postMessage({type:"reload",spa:!1}),t.abrupt("return");case 13:o.postMessage({spa:!0,currentUrl:r,html:u});case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();self.addEventListener("fetch",function(){var t=a(n.mark((function t(e){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"navigate"===e.request.mode&&e.request.referrer!==e.request.url&&e.respondWith(l(e));case 1:case"end":return t.stop()}}),t)})));return ())},);