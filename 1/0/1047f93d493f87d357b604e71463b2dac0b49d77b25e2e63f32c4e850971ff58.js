import{clearRequestInterval as t,objDataset as o,requestInterval as i}from"../base/croco.js";import{mediaQuery as h}from"../base/config.js";const p=60;function toFixed(value,t){const pow=10**t;return Math.round(value*pow)/pow}export function videosInit(t){const i=h.mobileOnly.matches;const o=[];const p=[];[...t].forEach(t=>{const provider=i?t.dataset.mobileProvider:t.dataset.desktopProvider;if(provider==="youtube"){o.push(t)}else{p.push(t)}});o.length&&import("./youtube-video.js").then(({youtubeVideoInit:t})=>t(o));p.length&&import("./static-video.js").then(({staticVideoInit:t})=>t(p))}export class AbstractVideo{getFpsInterval(){return 1e3/p}play(){this.playPromise=this.$video?.play()}pause(){if(this.playPromise){this.playPromise.then(()=>{this.$video?.pause()})}else{this.$video?.pause()}}togglePlay(){this.$video&&this[this.$video?.paused?"play":"pause"]()}toggleMute(){this.$wrapper.classList[this.$video?.muted?"remove":"add"]("is-muted");this.$video.muted=!this.$video?.muted}onPlay(){this.$wrapper.classList.remove("is-ended");this.$wrapper.classList.remove("is-paused");this.$wrapper.classList.add("is-loaded");if(this.renderTimeline){t(this.requestUpdateTimeline);if(this.updateTimeline){this.requestUpdateTimeline=i(this.updateTimeline.bind(this),this.getFpsInterval())}}}onPause(){t(this.requestUpdateTimeline);this.$wrapper.classList.add("is-paused")}bindCallback(t){let i=o(this.$wrapper,t);if(i&&typeof i==="function"){i()}}onEnded(){t(this.requestUpdateTimeline);this.$wrapper.classList.add("is-ended");this.bindCallback("endCallback")}getDuration(t){const duration=this.$video?.duration;const round=t?0:2;return duration?toFixed(duration,round):0}getCurrentTime(t){const currentTime=this.$video?.currentTime;const round=t?0:2;return currentTime?toFixed(currentTime,round):0}}