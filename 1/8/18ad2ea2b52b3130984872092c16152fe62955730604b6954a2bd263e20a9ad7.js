webpackJsonp([27],[function(e,t,i){i(1594),i(1595),i(1596),i(1597),i(1598),i(1599),i(1600),i(1601),i(1602),i(1603),i(1604),i(1605),i(1606),i(1607),i(1608),i(1609),i(1610),i(1611),i(1612),i(1613),i(1614),i(1615),i(1616),i(1617),i(1618),i(1619),i(1620),i(1621),i(1622),i(1623),i(1624),i(1625),i(1626),i(1627),i(1628),i(1629),i(1630),i(1631),i(1632),i(1633),i(1634),i(1635),i(1636),i(1637),i(1638),i(1639),i(1640),i(1641),i(1642),i(1643),i(1644),i(1645),i(1646),i(1647),i(1648),i(1649),i(1650),e.exports=i(1651)},,,,,function(e,t,i){"use strict";var n=i(3),s=i(6).sprintf,o=i(7),r=i(9),a=i(126),l=i(178);l();var c=i(129),u=i(132),h=i(180),d=i(181),p=i(182),g=i(224),f=i(773),_=i(776),m=i(777),v=i(778),b=i(782),y=i(544),w=i(813),C=i(816),k=a.extend({getName:function(){return this.name=c.get("Context/name"),s("Context/%s",this.name)},logs:function(){var e=[i(817),i(833),i(834),i(835),i(836),i(837),i(838),i(839),i(840),i(841),i(842),i(843),i(844).default,i(847).default,i(853),i(854),i(855),i(856),i(857),i(858),i(859)];return n.union(e,a.prototype.logs.apply(this))},constructor:function(){a.apply(this,arguments),this.startHistory(),this.initializeApp()},bootloader:function(e){a.prototype.bootloader.apply(this,arguments),d.init(),u.log("Exec","Bootstrap/DOMEventor"),u.log("Exec","Bootstrap/Legacy"),i(860)},initializeApp:function(){h.bool("is_mobile_handset")?new b:new g,new f,new _,h.bool("indash_blogs")&&(this.peepr=new m),h.bool("ask_form")&&(this.askForm=new v({user:p()})),h.bool("livephotos_web")&&(this.livePhotos=y.getInstance()),r.locale(c.get("Context.language")),h.bool("lrec_on_blog_pages_peepr")&&(this.yamPlusAd=new w),new C},startHistory:function(e){o.History.started||n.isEmpty(this.routes)||(this.routeFound=o.history.start({pushState:"pushState"in window.history,hashChange:!!e&&!("pushState"in window.history),root:this.root}))}});e.exports=k},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n=i(3),s=i(7),o=i(127),r=i(129),a=i(130),l=i(132),c=i(134),u=i(135),h=s.Router.extend({root:"/",constructor:function(e){e||(e={}),e.bootstrap||(e.bootstrap=o()),this.bootloader(e.bootstrap),s.Router.apply(this,arguments)},getName:function(){return"Prima/Router"},logs:bootloader:function(e){n.isEmpty(e),r.setup(e),l.log("Exec","Bootstrap/Data"),a.setup(e.Translations,n.get(e,"Context.language_simple","en")),l.log("Exec","Bootstrap/Translations"),c.startLogs(this.logs()),l.log("Exec","Bootstrap/logs"),new u({})}},{start:);e.exports=h},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n,s=i(214),o=i(225),r=s.extend({name:"header",autoAppend:!0,append:function(){this.headerView=new o({el:this.container}),this.enableFunctionality()},enableFunctionality:function(){this.headerView.enableCompose()},disableSticky:);e.exports=,function(e,t,i){"use strict";var n=i(8),s=i(226),o=i(180),r=i(136),a=i(129),l=i(229),c=i(231),u=i(628),h=i(629),d=i(639),p=i(640),g=i(182),f=s.extend({defaults:{headerHeight:52,headerTop:0},events:{"click .tab_discover > a":"onClickExplore","click .login-button":"onClickLogin","click .signup-button":"onClickSignup",mouseenter:"__mouseenter",mouseleave:"__mouseleave"},initialize:function(){var e=o.bool("is_logged_in");this.logo=new u({el:'[prima-component="header-logo"]',data:a.get("Components/DesktopDashboardLogo")}),e&&(this.accountMenu=new h({el:".tab_nav_account"}),n(".tab_activity").length&&(this.activityMenu=new d({el:".tab_activity"})),this._initializeMessaging()),this.set("headerTop",this.$el.position().top),this.listenTo(r,"Header:hide",this.hide),this.listenTo(r,"Header:show",this.show),this.listenTo(r,"Header:setTransparent",this.setTransparent),this.listenTo(r,"notificationBannerManager:update",this.onNotificationBannerChange),this.$window=n(window)},onNotificationBannerChange:enableCompose:disableSticky:setTransparent:hide:function(){var e=this.$window.scrollTop()+this.get("headerTop"),t=e<this.get("headerHeight")?e:this.get("headerHeight");this.$el.css({position:"absolute",top:e+"px"}),this.$el.velocity({translateY:[-t,0],translateZ:"0px"},150).velocity({translateY:"0px",translateZ:"0px",top:0},0)},show:function(){var e=this,t=this.$window.scrollTop(),i=t<this.get("headerHeight")?t:this.get("headerHeight");this.$el.css({position:"absolute",top:t+"px",transform:"translateY("+-i+"px) translateZ(0)"}),this.$el.velocity({translateY:[0,-i],translateZ:"0px"},150,.css({position:"fixed",top:this.get("headerTop")})},onClickExplore:onClickLogin:function(){r.trigger("Kraken:ClickLogin")},onClickSignup:function(){r.trigger("Kraken:ClickSignup")},_initializeMessaging:function(){var e=g(),t=this.$(".tab_messaging"),i=o.bool("is_logged_in")&&t.length>0&&e.canMessage();i?this.messaging=new p({inboxAnchorEl:t,inboxPopoverOptions:{isFixedPosition:"fixed"===this.$el.css("position")}}).render():t.length&&t.hide()},__mouseenter:function(){r.trigger("Header:mouseenter")},__mouseleave:);e.exports=f},function(e,t,i){"use strict";var n=i(219),s=i(136),o=i(230),r=n.extend({mixins:[o],el:".compose-button",events:{click:"toggleOpen"},defaults:{open:!1},loggingData:{source:"compose-button"},initialize:function(){this.on("change:open",this.onChangeOpen),this.listenTo(s,"fastCompose:init:complete",this.open),this.listenTo(s,"fastCompose:dismiss:complete",this.close)},toggleOpen:function(){this.toggle("open")},open:function(){this.set("open",!0)},close:function(){this.set("open",!1)},onChangeOpen:function(e,t){t?s.trigger("fastCompose:init",{loggingData:this.loggingData}):s.trigger("fastCompose:dismiss",{loggingData:this.loggingData})}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(7),o=i(187),r=i(217),a=new o(n.extend({},r.props,{defaults:n.extend({},s.Events),before:{initialize:function(){var e=n.defaults({},n.result(this,"defaults"));this.attributes={},this.set(e),this.changed={}}}}));e.exports=a},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(214),r=i(136),a=i(232),l=i(234),c=o.extend({name:"switcher",mixins:[a],keycommands:{"keydown:alt+c":"macFastCompose","keydown:z+c":"winFastCompose"},loggingData:{},initialize:function(){this.$body=n("body"),this.$glass=null,this.suspended=!1,this.bindEvents()},bindEvents:function(){this.listenTo(r,"keycommands:suspend",this.suspend),this.listenTo(r,"keycommands:resume",this.resume),this.listenTo(r,"fastCompose:close:complete",this.dismissFastCompose),this.listenTo(r,"fastCompose:dismiss",this.dismissFastCompose),this.listenTo(r,"fastCompose:init",this.initFastCompose)},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},macFastCompose:function(e){"MacIntel"===navigator.platform&&this.initFastCompose(e)},winFastCompose:initFastCompose:function(e){this.suspended||this.fastCompose||(this.determineSource(e),this.fastCompose=new l({loggingData:this.loggingData}),this.$body.append(this.fastCompose.render().el),this.showPlexi(),this.fastCompose.open(),r.trigger("fastCompose:init:complete"))},dismissFastCompose:function(){this.fastCompose&&(this.hidePlexi(),this.fastCompose.teardown(),this.fastCompose=null),r.trigger("fastCompose:dismiss:complete")},showPlexi:function(){this.$glass=n("<div>",{class:"glass show"}).appendTo(this.$body),s.defer(s.bind(function(){this.$glass.addClass("blue")},this)),r.trigger("drawer:suspend")},hidePlexi:function(){this.$glass.remove(),this.$glass=null,r.trigger("drawer:resume")},determineSource:function(e){this.loggingData.source="fast-compose",e&&(e.originalEvent instanceof window.KeyboardEvent?this.loggingData.source="keycommand":e.loggingData&&e.loggingData.source&&(this.loggingData.source=e.loggingData.source))}});e.exports=c},function(e,t,i){"use strict";var n=i(187),s=i(136),o=i(3),r=i(233),a=new n({__bindKeycommands:function(){o.result(this,"keycommands")&&(o.each(o.result(this,"keycommands"),this.__bindKey,this),r.add({id:this.__keyId,keys:o.keys(o.result(this,"keycommands"))}))},__bindKey:function(e,t){this.listenTo(s,"DOMEventor:"+t,this.__keyFn)},__keyFn:function(e,t){!this.__keysDisabled&&r.shouldRun(t,this.__keyId)&&this[this.keycommands[t]].apply(this,arguments)},focusKeys:function(){r.focus(this.__keyId)},unfocusKeys:function(){r.unfocus(this.__keyId)},soloKeys:unSoloKeys:disableKeys:function(){this.__keysDisabled=!0},enableKeys:function(){this.__keysDisabled=!1},before:{initialize:function(){this.keycommands||(this.keycommands={}),this.__keysDisabled=!1,this.__keyId=o.uniqueId("keycomms"),this.__bindKeycommands()},stopListening:function(e){(o.isEmpty(e)||e===this)&&r.remove(this.__keyId)}}});e.exports=a},function(e,t,i){"use strict";var n=i(215),s=i(3),o=n.extend({soloId:null,constructor:add:function(e){this.keySets.unshift(e)},remove:function(e){var t=this.getSetForId(e);t&&(this.unSolo(e),this.keySets=s.without(this.keySets,t),this.soloBubblingWhitelist=s.without(this.soloBubblingWhitelist,e))},focus:function(e){var t=this.getSetForId(e);t&&(this.keySets=s.without(this.keySets,t),this.keySets.unshift(t))},unfocus:function(e){var t=this.getSetForId(e);t&&(this.keySets=s.without(this.keySets,t),this.keySets.push(t))},solo:function(e,t){var i=this.getSetForId(e);i&&(this.soloId=e,t===!0&&this.soloBubblingWhitelist.push(e))},unSolo:function(e){this.soloId===e&&(this.soloId=null,this.soloBubblingWhitelist=s.without(this.soloBubblingWhitelist,e))},getSetForId:function(e){return this.keySets[s.findIndex(this.keySets,{id:e})]},getSetsWithKey:function(e){return s.where(this.keySets,{keys:[e]})},shouldRun:function(e,t){var i=this.getSetsWithKey(e);return this.soloId===t||!(!s.isEmpty(this.soloBubblingWhitelist)&&!s.contains(this.soloBubblingWhitelist,t))&&(!(i.length>1)||i[0].id===t)}});e.exports=new o},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(235),r=i(129),a=i(130),l=i(192),c=i(219),u=i(136),h=i(180),d=i(232),p=i(230),g=i(236),f=i(627),_=c.extend({template:f,className:"fast-compose",defaults:{tabIndex:-1,icons:[{name:"text",label:"Text"},{name:"photo",label:"Photo"},{name:"quote",label:"Quote"},{name:"link",label:"Link"},{name:"chat",label:"Chat"},{name:"audio",label:"Audio"},{name:"video",label:"Video"}]},events:{"click .post-tab-switching .tab-post-type":"clickCreate","mouseover .post-tab-switching .tab-post-type":"mouseoverIcon","click .post-tab-switching":"close"},mixins:[p,d],keycommands:{"keydown:c":"nextIcon","keydown:shift+c":"previousIcon","keydown:tab":"nextIcon","keydown:shift+tab":"previousIcon","keydown:right":"nextIcon","keydown:left":"previousIcon","keydown:enter":"enterCreate","keydown:escape":"close"},initialize:function(e){this.loggingData=e?e.loggingData:{},s.forEach(this.get("icons"),,this.$body=n("body"),this.$glass=null,this.$plexiInstance=n('.plexi[data-token="body-plexi"]'),this.resumeKeycommandsOnClose=!0},bindEvents:function(){this.listenTo(u,"DOMEventor:keydown:tab",this.disableKey),this.listenTo(u,"DOMEventor:keydown:shift+tab",this.disableKey),this.listenTo(this,"change:tabIndex",function(e,t){this.$(".selected").removeClass("selected"),this.$('[data-index="'+t+'"]').addClass("selected")})},render:function(){return this.$el.append(this.template(this.toJSON())),this.bindEvents(),this},open:function(){s.defer(s.bind(this.show,this))},show:function(){u.trigger("keycommands:suspend");var e=50;s.forEach(this.$(".tab-post-type"),function(t,i){var s=n(t),r=s.find(".post-type-icon"),a=s.find(".post-type-name");o.animate(r,{opacity:["1","0"],translateY:["0px","15px"]},{duration:150,delay:i*e}),o.animate(a,{opacity:["1","0"],translateY:["0px","-15px"]},{duration:150,delay:i*e})},this),n(".post-tab-switching").addClass("finish-animating")},enterCreate:function(e){var t=this.$(".selected");if(t.length){var i=t.attr("data-post-type");this.createNew(i),this.close()}},clickCreate:disableKey:function(e){e.preventDefault()},mouseoverIcon:function(e){this.$(".selected").removeClass("selected"),this.set("tabIndex",n(e.currentTarget).data("index"))},nextIcon:function(e){var t=this.get("tabIndex")+1;t>=this.get("icons").length&&(t=0),this.set("tabIndex",t)},previousIcon:function(e){var t=this.get("tabIndex")-1;t<0&&(t=this.get("icons").length-1),this.set("tabIndex",t)},createNew:function(e){this.resumeKeycommandsOnClose=!1,r.has("Components/PostFormBuilder")?u.trigger("postForms:open",{updateURL:!1,postFormType:g.containerType("modal"),postType:e,fastCompose:!0,loggingData:this.loggingData}):u.trigger("fastCompose:create",{type:e,loggingData:this.loggingData})},close:function(){var e=50,t=this.$(".tab-post-type"),i=Math.floor(.5*(t.length-1));l.all(s.map(t,function(t,s){var r=n(t),a=Math.floor(Math.abs(s-i))*e;return o.animate(r,{opacity:["0","1"],translateY:["-500px","0px"]},{duration:150,delay:a})},this)).then(function(){u.trigger("fastCompose:close:complete")})},teardown:function(){return this.resumeKeycommandsOnClose&&u.trigger("keycommands:resume"),this.remove()}});e.exports=h.bool("is_logged_in")?_:s.noop},,function(e,t,i){"use strict";var n=(i(237),i(3)),s=i(8),o=i(192),r=i(238),a=i(240),l=i(214),c=i(136),u=i(181),h=(i(132),i(7)),d=(i(241),i(242)),p=i(243),g=i(246),f="/dashboard",_=i(130),m=s("body"),v=i(247),b=i(213),y=i(182),w=i(251),C=i(353),k=i(618),x=i(619),S=i(621),T=i(626),E=l.extend({name:"PostFormBuilder",initialize:function(){var e=this.data;if(this.user=y(),this.user){c.trigger("postForms:initializing"),v(n.bind(function(e){this.PostFormComponent=e},this));var t={baseRoute:null,currentChannel:null,supportImageSearch:!1,minFullWidthSize:300,redirectTo:!1,reblogActionContext:!1,updateURL:!0};n.extend(this,t,n.pick(e,n.keys(t))),this._addGlobalEventListeners(),this.user.set(e.limits),this.user.set(e.dashboardSettings),this.user.set("language",e.language||"en_US"),C.setEmbedRegexes(e.embedRegexes),this.glassView=new k,this.modal=new x,this.modalContainer=new S({className:"post-form-modal-content",animateHeightWithContent:!0}),this.modal.setContentSubView(this.modalContainer),this.postButtons=new T({el:"#new_post"}),this.postButtonsContainer=new S({el:this.postButtons.$el.parent(),originalContent:this.postButtons,transitionBackground:!0,animateHeightWithContent:!0,useLoader:!1}),this.scrollHelper=new d,this.saveHook=new p(n.extend({$postButtonsContainer:this.postButtonsContainer.$el},e)),this.legacyEvents(),this._updateData=n.once(this.updateData),this.render()}},updateData:function(){var e=s.ajax({url:"/svc/post/get_post_form_builder_data",type:"POST",withFormKey:!0,data:{}});return e.then(n.bind(function(e){var t=e.response;return n.forEach(t.channels,function(e){var t=!!e.name&&this.user.getChannel(e.name);t&&t.set(n.omit(e,"name"))},this),this.user.set(t.limits),t},this))},legacyEvents:function e(){var e={"postForms:closed":["post:form:hide","keycommands:resume"],"postForms:saved":["post:form:success"],"postForms:opened":["post:form:show","keycommands:suspend"]};n.forEach(e,function(e,t){this.listenTo(c,t,function(){var t=n.toArray(arguments);n.each(e,function(e){c.trigger.apply(c,[].concat(e,t))},this)})},this)},_addGlobalEventListeners:function(){this.listenTo(c,"postForms:open",this.fetchAndCreatePostFormComponent),this.listenTo(c,"postForms:new",this._createPostFormNew),this.listenTo(c,"postForms:edit",this._createPostFormEdit),this.listenTo(c,"postForms:reblog",this._createPostFormReblog),this.listenTo(c,"postForms:saved",this.destroyPostForm),this._registerDismissListener(),this.listenTo(c,"postForms:dismissListener:suspend",function(){this._toggleDismissListener(!1)}),this.listenTo(c,"postForms:dismissListener:resume",function(){this._toggleDismissListener(!0)})},_toggleDismissListener:function(e){this.stopListening(c,"postForms:close"),e&&this._registerDismissListener()},_registerDismissListener:createInlineContainer:function(e){return!!e&&new S({el:e.parent(),originalContent:e,transitionBackground:!0})},fetchAndCreatePostFormComponent:function(e){n.isEmpty(this.PostFormComponent)?v(n.bind(this)):this._createPostForm(e)},_createPostFormNew:function(e){this.fetchAndCreatePostFormComponent(e)},_createPostFormEdit:function(e){e.postEl&&(e.containerView=this.createInlineContainer(e.postEl),e.postFormType=g.inline),this.fetchAndCreatePostFormComponent(e);var t=new RegExp(/\/blog\/\w+\/review/);if(this.baseRoute&&this.baseRoute.match(t)){var i={loggingData:{post_id:e.editId,blog_name:e.channelId,page:"EditPost"}};c.trigger("Kraken:EditPost",i)}},_createPostFormReblog:function(e){this.fetchAndCreatePostFormComponent(e)},_createPostForm:function(e){if(this.postForm)return this.destroyPostForm(e).then(n.bind(this));c.trigger("postForms:opening"),e=n.extend({fastCompose:!1,supportImageSearch:this.supportImageSearch,minFullWidthSize:this.minFullWidthSize,updateURL:this.updateURL,glass:!0,postFormType:g.modal},e),n.defaults(e,{containerView:e.postFormType===g.inline?this.postButtonsContainer:null}),this.glass=e.glass,e.post||(e.post=this._createPostModel(e)),e.url||(e.url=this._postFormUrl(e.post)),e.containerView===this.postButtonsContainer&&this.postButtons.setPostType(e.post.get("type")),this._updateData();var t=e.postFormType===g.modal,i=["supportImageSearch","minFullWidthSize","post"];"photo"===e.post.get("type")&&i.push("showPhotoBooth");var a=this.postForm=new this.PostFormComponent(n.extend(n.pick(e,i),{isModal:t,popoverContainer:t?this.modal.$el:m,redirectTo:this.redirectTo,reblogActionContext:this.reblogActionContext,fastCompose:e.fastCompose})),l=this.postFormContainer=e.containerView||this.modalContainer;if(!l)throw new Error("No post form container!");this.listenTo(a,"pauseScrollHelper",this.pauseScrollHelper),this.listenTo(a,"resumeScrollHelper",this.resumeScrollHelper),l.isRendered()||l.render(),l.setPostFormComponent(a);var d=n.once(n.bind(function(){return e.glass?this.glassView.show():o.resolve()},this)),p=r([function(){return c.trigger("Header:hide"),o.join(l.prepare(d),a.whenRendered(!0))},function(){return e.updateURL&&h.history.navigate(e.url,{replace:!0}),function(){var e=u.rect(),i=e.windowScrollTop,o=e.windowHeight,r=a.getRect(),h=r.offsetHeight,d=l.$el.offset().top,p=d+h,g=20,f=s("[prima-component=header]").height()||0,_=h+2*g<o,m=this.scrollHelper.calculateScrollTop(d-g,p+g+f,o,_),v=400,b=t?this.modal.$el:null;l===this.postButtonsContainer&&i<m&&o>h&&(m=i),this.previousScrollPosition=!t&&i,this.scrollHelper.scrollToPosition(m,v,b),this.listenTo(c,"Photoset:dragScroll",function(e,t){n.isNumber(t)||(t=50);var i=u.rect().windowScrollTop+e;this.scrollHelper.scrollToPosition(i,t,b)}),this.listenTo(c,"Photoset:scrollToRow",function(e,t,i){n.isNumber(i)||(i=50),e+=0,this.scrollHelper.checkScrollBounds(!1,{keepInside:!0,contentPadding:70,contentRect:{offsetTop:e,offsetHeight:t}})})}.call(this),l.showPostForm(d)},function(){return d()},function(){a.enable()}],this).then(n.bind(function(){return c.trigger("postForms:opened"),m.addClass("postforms-open"),a},this),n.bind(function(){this.destroyPostForm()},this));return e.postFormType===g.inline&&p.then(n.bind(this)),p.catch(function(e){e instanceof Error&&n.defer(function(){throw e})}),p},_postFormStateChanged:function(e){if(this.postForm){var t=this.postForm.initialPostState,i=this.postForm.post;return i.deepHasChanged(t)}return!1},dismissPostForm:function(){this.postForm&&!this.postForm.isEnabled()||(this._postFormStateChanged()?this._buildDismissPrompt():this.destroyPostForm())},_buildDismissPrompt:function(){var e=_("Discard this post?");this.postForm&&this.postForm.post&&"edit"===this.postForm.post.get("mode")&&(e=_("Discard edits to this post?"));var t={text:e,text_ok:_("Discard"),text_cancel:_("Nevermind"),keycommand_maintain:!0};b.confirm(t,n.bind(this),,c.trigger("postForms:dismissListener:suspend")},destroyPostForm:function(e,t){e=n.extend({updateURL:this.updateURL,url:this.baseRoute,glass:this.glass},e),this.scrollHelper.stop();var i=this.postForm,s=this.postFormContainer,a=!!i.fastCompose;this.postForm=null,this.postFormContainer=null,this.stopListening(i),this.stopListening(c,"Photoset:dragScroll");var l=n.once(n.bind(function(){return e.glass?this.glassView.hide():o.resolve()},this)),u=i&&!!i.postForm.get("saved"),d=i&&i.post&&i.post.get("state"),p={didSave:u,newState:u?d:null};c.trigger("postForms:closing",p);var g=r([function(){u&&this.saveHook.preExecute(t)},function(){i&&i.disable()},function(){if(function(){if(this.previousScrollPosition!==!1){var e=this.previousScrollPosition,t=400;this.scrollHelper.scrollToPosition(e,t)}}.call(this),s)return s.hidePostForm(l).then(function(){s.teardown()})},function(){if(i&&i.remove(),e.updateURL){var t=h.history.root||"",n=e.url?e.url.replace(new RegExp("^"+t),""):"";h.history.navigate(n,{replace:!0})}},function(){u&&t&&(this.saveHook.$inlinePostEl=s.$el,this.saveHook.execute(t,{fastCompose:a}))}],this).then(function(){return c.trigger("postForms:closed",p),c.trigger("Header:show"),m.removeClass("postforms-open"),i});return g.catch(function(e){e instanceof Error&&n.defer(function(){throw e})}),g},pauseScrollHelper:function(){this.scrollHelper&&this.scrollHelper.pause()},resumeScrollHelper:function(){this.scrollHelper&&this.scrollHelper.resume()},_createPostModel:function(e){"string"==typeof e&&(e={postType:e});var t=n.extend({tumblelog:e.channelId||this.currentChannel||this.user.getChannel().get("name"),editorType:this.user.get("defaultEditorType"),contextData:{baseRoute:this.baseRoute,contextPage:e.contextPage}},n.pick(e,"tags","sourceUrl","loggingData"));return e.reblogId?n.defaults(t,{lookupData:{reblog_id:e.reblogId,reblog_key:e.reblogKey,reblog_blog_name:e.reblogBlogName||"",carousel_index:e.carousel_index},mode:"reblog",pt:e.pt,reblogSource:e.reblogSource}):e.editId?n.defaults(t,{lookupData:{post_id:e.editId,channel_id:e.channelId||this.redirectChannel},mode:"edit"}):n.defaults(t,{type:e.postType||e.type||"text",mode:"new"}),new w(t)},_postFormUrl:function(e){if(e){if(e.has("lookupData")){var t=e.get("lookupData");return t.reblog_id?this._reblogPostUrl(t.reblog_id,t.reblog_key):t.post_id?this._editPostUrl(t.post_id):this._newPostUrl(e.get("type"))}return e.has("reblog_id")?this._reblogPostUrl(e.get("reblog_id"),e.get("reblog_key")):e.has("id")?this._editPostUrl(e.get("id")):this._newPostUrl(e.get("type"))}return this._newPostUrl("text")},_newPostUrl:function(e){var t=this.baseRoute!==f?this.baseRoute:"";return t+"/new/"+e},_editPostUrl:_reblogPostUrl:render:function(){return this.glassView.render().$el.appendTo("body"),this.modal.render().$el.appendTo("body"),this},updateBaseRoute:function(e){var t;e?this.baseRoute=e:(t=h&&h.history?h.history.location.pathname:f,this.baseRoute=t)}},{containerType:function(e){return g[e]}});a.applyTo(E.prototype),e.exports=E},function(e,t,i){"use strict";var n=i(3),s=i(239),o=function(e,t){e=n.map(e,t||this);var i=Array.prototype.slice.call(arguments,1);return i[0]=e,s.apply(null,i)};e.exports=o},function(e,t,i){var n;/** @license MIT License (c) copyright 2011-2013 original author or authors */
!function(s){n=function(e){var t=i(192),n=t.Promise.all,s=Array.prototype.slice;return function(e){ar o=[];return n(s.call(arguments,1)).then(}}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))}(i(196))},function(e,t,i){"use strict";var n=i(3),s=i(192),o=i(187),r=new o({defaults:{whenEvent:function(e,t){return 1===arguments.length&&(t=e,e=this),s.promise(n.bind(function(i,n){this.listenToOnce(e,t,function(){i.call(null,arguments)})},this))}}});e.exports=r},function(e,t){"use strict";var i=1,n=n.get=function(){return i},n.set=e.exports=n},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(235).animate,r=i(241),a=i(215),l=i(7),c=i(181),u=i(136),h=i(132),d=s("html"),p=a.extend({defaults:{keepInside:!1,scrollSpeedMs:250,triggerPadding:-50,contentPadding:20,debounceMs:200},start:function(e){return this._running&&this.stop(),this._running=!0,e&&!n.isPlainObject(e)&&(e={el:e}),this.options=e=n.extend({},this.defaults,e),this.$el=s(e.el),this.updateContentRect(),this.listenTo(u,"DOMEventor:flatscroll",this.checkScrollBounds),this},stop:function(){return this._running=!1,this._scrollTop=!1,this._ignoreScroll=!0,this.cancelEnforceScrollBounds(),this.stopListening(),this},pause:resume:updateContentRect:function(){this.contentRect||(this.contentRect={}),this.lastContentRect&&(this.lastContentRect.offsetTop=this.contentRect.offsetTop,this.lastContentRect.offsetLeft=this.contentRect.offsetLeft,this.lastContentRect.offsetHeight=this.contentRect.offsetHeight,this.lastContentRect.offsetWidth=this.contentRect.offsetWidth);var e=this.$el.offset();return this.contentRect.offsetTop=e.top,this.contentRect.offsetLeft=e.left,this.contentRect.offsetHeight=this.$el.outerHeight(),this.contentRect.offsetWidth=this.$el.outerWidth(),this.lastContentRect||(this.lastContentRect=n.clone(this.contentRect)),this.contentRect},calculateScrollTop:function(e,t,i,n){return n?e:t-i},checkScrollBounds:function(e,t){if(!this._ignoreScroll){t=t?n.extend({},this.defaults,this.options,t):this.options,e||(e=c.rect());var i,s,o=t.contentRect||this.updateContentRect(),r=t.triggerPadding||0,a=t.contentPadding||0,l=o.offsetHeight,u=o.offsetTop,h=u+l,d=e.windowHeight,p=Math.max(0,e.windowScrollTop),g=p+d;return t.keepInside?(i=p-u,s=h-g):(i=p-h,s=u-g),s>r?(this._scrollTop=this.calculateScrollTop(u-a,h+a,d,l+2*a>d),this.enforceScrollBounds(t),!0):i>r?(this._scrollTop=this.calculateScrollTop(u-a,h+a,d,t.bottom||l+2*a<d),this.enforceScrollBounds(t),!0):(this._scrollTop=!1,this.cancelEnforceScrollBounds(),!1)}},enforceScrollBounds:function(e){var t=null!=e.scrollTop?e.scrollTop:this._scrollTop,i=e.scrollSpeedMs,s=e.debounceMs,o=e.container;s?this._enforceTimeout||(this._enforceTimeout=n.delay(n.bind(function(){null==e.scrollTop&&(t=this._scrollTop),this.scrollTop!==!1&&this.scrollToPosition(t,i,o)},this),s)):this.scrollToPosition(t,i,o)},cancelEnforceScrollBounds:function(){this._enforceTimeout,clearTimeout(this._enforceTimeout),this._enforceTimeout=!1},scrollToPosition:function(e,t,i){return this._ignoreScroll||"undefined"==typeof e||null===e?void h.logSaw("PostFormBuilder","scrollToPosition -- returning early",this._ignoreScroll,e):(this._ignoreScroll=!0,o(d,"stop"),void o(d,"scroll",{offset:e,container:i,duration:r(t||this.defaults.scrollSpeedMs)}).then(n.bind(function(){this._ignoreScroll=!1},this)))}});n.extend(p.prototype,l.Events),e.exports=p},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(244),r=i(136),a=i(245),l=i(182),c=function(){var e=".post_container",t=".post:not([data-is-pinned])",i=["dashboard","drafts","inbox"],c={preExecute:function(){if("queue"===this.contextData.contextPage)return s(window).off("beforeunload"),void window.location.replace(this.contextData.baseRoute)},execute:function(e,t){if(t=n.merge({fastCompose:!1},t||{}),this.saveResponse=e.responseJSON,i.indexOf(this.contextData.contextPage)!==-1){var r=!this.saveResponse.post.is_edit&&!this.saveResponse.post.is_reblog,a="post_dashboard_html"in this.saveResponse,c=!(!this.saveResponse.post||!this.saveResponse.post.is_edit)&&this.contextData.contextPage!==this.saveResponse.post_context_page&&this.$inlinePostEl.hasClass("post_container");if(r?this._fetchMorePosts():a&&(c?this._removeInline():this._updateInline()),this._displayNotification(this.saveResponse,t),this.saveResponse.context_tumblelog){var u=this.saveResponse.context_tumblelog.name_or_id,h=s('#dashboard_controls_open_blog[data-blog-name="'+u+'"]');n.forEach(this.saveResponse.context_tumblelog,function(e,t){if(t.match(/_count$/i)){var i=h.find('[data-blog-controls-count="'+t+'"]');i.toggleClass("count_0",e<="0"),i.find(".count").text(o(e).format("0,0"))}},this);var d=l().getChannel(u),p=n.pick(this.saveResponse.context_tumblelog,d.keys());d.set(p)}}},_fetchMorePosts:function(){var e=this.contextData.baseRoute.replace(/^\/|\/$/g,""),t="drafts"===this.contextData.contextPage?"after":"before",i=this._findLatestPostId(),s=new a;s.fetch({pageRoot:e,direction:t,refPostID:i,success:n.bind(this._fetchSuccess,this),error:this._fetchFailure})},_fetchSuccess:function(i){var n=s(i.get("dashboardHTML")),o=this.contextData.$postButtonsContainer.nextAll(e).has(t).first();0===o.length?this.contextData.$postButtonsContainer.parent().append(n):n.insertBefore(o),s(".no_posts_found").remove(),r.trigger("posts:load")},_fetchFailure:function(){console.error("Failed loading dashboard HTML after successful post submission.")},_findLatestPostId:function(){var i=this.contextData.$postButtonsContainer.nextAll(e).find(t).first().data("post-id");return i},_updateInline:function(){var e=s(this.saveResponse.post_dashboard_html.trim());this.$inlinePostEl.replaceWith(e.eq(0)),r.trigger("posts:load")},_removeInline:function(){var e=this.contextData.baseRoute.split("/");e.splice(-1,1);var t=this.$inlinePostEl;if(t.fadeOut(200,function(){t.remove()}),s("#posts .post").not(".new_post").length<=1)return void(window.location=e.join("/"))},_displayNotification:function(e,t){var i=this.contextData.baseRoute.split("/"),s=i[1]||"",o=e.message,a=n.parseInt(this.contextData.notificationDelay),l={type:"dashboard"===e.post_context_page?"dashReblog":e.post_context_page,url:e.post_tumblelog.post_url,tumblelog:{name:e.post_tumblelog.name_or_id,url:e.post_tumblelog.url,avatar:e.post_tumblelog.avatar}};(!e.created_post||e.post.is_reblog||t&&t.fastCompose||"tagged"===s.toLowerCase())&&n.delay(a)}},u=function(e){this.contextData=n.defaults(e||{},{notificationDelay:250}),n.extend(this,c)};return u}();e.exports=c},,function(e,t,i){"use strict";var n=i(3),s=i(6).sprintf,o=i(185),r=o.extend({endpoint:"/svc/post/%s/%s/%s",parse:sync:function(e,t,i){if("read"!==e)throw new Error("The DashboardPostFetch model may only READ from server!");if(i=n.defaults(i||{},{pageRoot:!1,direction:!1,refPostID:!1}),!1===(i.pageRoot&&i.direction))throw new Error(s("These two fetch params must be passed: pageRoot [%s], direction [%s]",i.pageRoot,i.direction));return n.defaults(i,{dataType:"html",emulateHTTP:!0,url:s(this.endpoint,i.pageRoot,i.direction,i.refPostID)}),o.prototype.sync.call(this,e,t,i)}});e.exports=r},function(e,t){"use strict";var i={modal:1,inline:2};e.exports=i},function(e,t,i){"use strict";var n=i(248),s=function(e){i.e(1,function(t){try{e(i(249))}catch(e){n(e,"post-form")}})};e.exports=s},function(e,t,i){"use strict";var n=i(130),s=i(213),o=function(e,t,i){var o=n("Sorry, we seem to be having technical trouble. Please try again later.");throw"function"==typeof i?i(e):s.alert("string"==typeof i?i:o),new Error("require.ensure error: "+t+": "+e)};e.exports=o},,function(e,t,i){"use strict";var n=i(3),s=[16,24,30,40,48,64,96,128,512],o=n.last(s),r=128,a=function(e){return e>=o?o:n.find(s,},l=function(e,t){var i=function(t){return t=null==t?r:a(t),(e||"").replace(/^(.*_)?(\d+)(\D.*)?$/,"$1"+t+"$3")};return i.toString=null!=t?i(t):i};e.exports=l},function(e,t,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=i(3),o=i(185),r=i(237),a=i(252),l=i(253),c=i(255),u=i(263),h=i(264),d=i(267),p=i(268),g=i(269),f=i(271),_=i(272),m=i(254),v=i(265),b=i(266),y=i(129),w=o.extend({mixins:[a],typeDelegateMap:{text:l,photo:c,quote:u,link:h,chat:d,audio:p,video:g,note:f},_VALID_STATES:{published:"0",draft:"1",queued:"2",scheduled:"on.2",private:"private",unapproved:"0 3",transcoding:"4"},_FORMAT_CODE_TO_EDITOR_TYPE:{0:"rich",1:"html",2:"markdown"},_STATE_CODE_TO_TEXT:{published:"published",0:"published","0 3":"published",1:"draft",2:"queued",3:"unapproved",4:"transcoding","on.2":"scheduled",private:"private"},defaults:{carouselDisplay:!1,postDate:String(),customUrl:String(),sourceUrl:String(),state:"published",editorType:"rich",tags:[],publish_on:String(),tumblelog:String(),uploading:!1,mode:"new",contentStats:{},loading:!1,hasLoadingInlineImages:!1,members_only:!1,owner_flagged_nsfw:!1,canBeLiked:!0,canBeReblogged:!0,enableCTA:!1,tspSkipLightbox:!0,ctaTextCode:"0",enableRedirectUrls:!1,redirectUrlPrimary:String(),redirectUrlIOS:String(),redirectUrlAndroid:String()},shortUrlLength:29,typeAttributes:{},editorField:!1,resetPreserveFields:[],resetAttributes:[],allowAnswerFields:[],_syntheticAttributes:{pseudoState:function(){var e=this.get("state"),t=this.get("publish_on");return"published"===e&&1===parseInt(this.get("is_private"),10)&&(e="private"),"queued"===e?s.isEmpty(t)?"queued":"scheduled":e},formattedSourceUrl:function(){var e,t=this.get("sourceUrl");return s.isEmpty(t)?"":(e=v.addProtocolIfMissing(t,"https:"),b.isUrl(e)?e:t)},formattedRedirectUrlPrimary:function(){var e,t=this.get("redirectUrlPrimary");return s.isEmpty(t)?"":(e=v.addProtocolIfMissing(t,"https:"),b.isUrl(e)?e:t)}},initialize:function(e,t){s.has(e,"tags")||this.set("tags",[]),this._assignPostTypeFunctionality()},_assignPostTypeFunctionality:function(){var e=this.get("type"),t=s.bind(this);e?(this.delegateObject(t(e)),this.afterDelegate()):this.listenToOnce(this,"change:type",function(e,i){this.delegateObject(t(i)),this.afterDelegate()})},afterDelegate:_normalizeType:function(e,t){var i={regular:"text",conversation:"chat"};return t===!1&&(i=s.invert(i)),e in i?i[e]:e},get:function(e){return(this._syntheticAttributes[e]||o.prototype.get).apply(this,arguments)},getHtmlStripped:function(e,t,i){return"undefined"!=typeof t||(t=!0),"undefined"!=typeof i||(i=" "),s.trim(m.stripHtml(this.get(e)||"",t,i))},fetch:function(e){var t={data:e};return o.prototype.fetch.call(this,t)},parse:function(e,t){if(t.parse===!1)return this.attributes;var i=e.post,n=t.data,o={},r=i.id?"edit":"reblog";o.type=this._normalizeType(i.type,!0),o.can_reblog_as=s.map(i.can_reblog_as,s.bind(this)),this.set("type",o.type),s.forEach(this.genericFieldMap,function(e,t){o[e]=i[t]});var a=["one","two","three","state","publish_on","tags","type","can_reblog_as"];return s.extend(o,s.omit(i,a),{createdPost:!!e.created_post,postTumblelog:e.post_tumblelog||{},postContextPage:e.post_context_page}),"edit"===r?(o["post-id"]=i.id,o.tags=i.tags?i.tags.split(","):[],o.tumblelog=o.postTumblelog.name_or_id||!1):"reblog"===r&&s.extend(o,s.pick(n,["reblog_id","reblog_key"])),"state"in i&&(o.state=this._extractState(i)),i.from_app&&1===s.parseInt(i.format)||(o.editorType=this._FORMAT_CODE_TO_EDITOR_TYPE[s.parseInt(i.format||0)]),o.editorType||(o.editorType=this.get("editorType")||this._FORMAT_CODE_TO_EDITOR_TYPE[0]),s.has(i,"custom_tweet")&&(o.customTweet=i.custom_tweet),s.extend(o,{sourceUrl:o.source_url||"",carouselDisplay:o.carousel_display||!1,htmlEdited:"rich"!==o.format&&!(this.editorField&&!i[this.editorField]),postDate:o.date||"",customUrl:o.slug||"",canBeLiked:o.can_be_liked,canBeReblogged:o.can_be_reblogged},s.mapValues(s.pick(o,["html_mode","members_only","carousel_display","owner_flagged_nsfw"]),_)),s.has(i,"ads_cta_text_code")&&null!==i.ads_cta_text_code&&(o.enableCTA=!0,o.ctaTextCode=i.ads_cta_text_code||"0"),s.has(i,"redirect_url_primary")&&null!==i.redirect_url_primary&&(o.enableRedirectUrls=!0,o.redirectUrlPrimary=i.redirect_url_primary||"",o.redirectUrlIOS=i.redirect_url_ios||"",o.redirectUrlAndroid=i.redirect_url_android||""),"edit"!==r||"queued"!==o.state||s.isEmpty(i.publish_on)||(o.state="scheduled",o.publish_on=i.publish_on),this.parseForType(o,i)},parseForType:sync:function(e,t,i){var n={create:"/svc/post/update",read:"/svc/post/fetch",update:"/svc/post/update"};return s.defaults(i||(i={}),{emulateHTTP:!0,forServer:!0,url:n[e]}),i.parse="read"===e,o.prototype.sync.call(this,e,t,i)},toJSON:function(e){return e=s.defaults(e||{},{forServer:!1}),e.forServer?this.serializeForServer(e):o.prototype.toJSON.call(this,e)},serializeForServer:function(){var e=this,t=e.attributes,i={channel_id:t.tumblelog,post_id:t["post-id"],"post[date]":t.postDate,"post[one]":this.getAttributeFromGeneric("one"),"post[publish_on]":t.publish_on,"post[slug]":t.customUrl,"post[tags]":t.tags.join(),"post[two]":this.getAttributeFromGeneric("two"),"post[three]":this.getAttributeFromGeneric("three"),thumbnail:this.getAttributeFromGeneric("thumbnail"),editor_type:t.editorType,send_to_twitter:t.send_to_twitter,custom_tweet:t.customTweet,loggingData:t.loggingData,carousel_display:t.carouselDisplay,members_only:t.members_only,owner_flagged_nsfw:t.owner_flagged_nsfw,content_stats:t.contentStats,carousel_index:t.carousel_index,can_be_liked:t.canBeLiked,can_be_reblogged:t.canBeReblogged,enable_cta:t.enableCTA,tsp_skip_lightbox:t.tspSkipLightbox,cta_text_code:t.ctaTextCode,enable_redirect_urls:t.enableRedirectUrls,redirect_url_primary:e.get("formattedRedirectUrlPrimary"),redirect_url_ios:t.redirectUrlIOS,redirect_url_android:t.redirectUrlAndroid};"edit"===t.mode&&(i.edit_post_id=t["post-id"]),i["post[source_url]"]=e.get("formattedSourceUrl"),i["post[state]"]=e._VALID_STATES[t.state],i["post[type]"]=this._normalizeType(t.type,!1);var n={reblog:t.is_reblog,reblog_key:t.reblog_key,reblog_post_id:t.reblog_id,pt:t.pt||window.name,remove_reblog_tree:t.remove_reblog_tree,reblog_source:t.reblogSource};s.extend(i,s.pick(n,function(e){return!s.isUndefined(e)})),this.getAttributeFromGeneric("thumbnail")&&(i.thumbnail_pre_upload="1");var o=this.getContextPage();return s.extend(i,{context_id:t.tumblelog,context_page:o,context_bundle:y.get("Context/name"),"is_rich_text[one]":"0","is_rich_text[two]":"0","is_rich_text[three]":"0"}),this.editorField&&(i["is_rich_text["+this.editorField+"]"]="1"),t.reblogActionContext&&(i.reblog_source=t.reblogActionContext),t.shareData&&s.isObject(t.shareData)&&(t.shareData.canonicalUrl=i["post[source_url]"],i.share_data=t.shareData),i},validate:function(e,t){var i="errors"in t?t.errors:[];if(e.state&&(s.has(this._VALID_STATES,e.state)||i.push('Invalid "state" value')),e.hasLoadingInlineImages&&i.push("There are still pending images."),s.each(this.defaults,function(t,s){("undefined"==typeof t?"undefined":n(t))!==n(e[s])&&i.push('Invalid "'+s+'" type. Expected '+("undefined"==typeof t?"undefined":n(t))+", got "+n(e[s])+".")}),i.length)return i},_extractState:function(e){var t=this._STATE_CODE_TO_TEXT[e.state];return 1===parseInt(e.is_private,10)&&(t="private"),t},findBlogChannelByName:function(e){if(this.attributes.tumblelog&&this.attributes.tumblelog.collection&&"findWhere"in this.attributes.tumblelog.collection)return this.attributes.tumblelog.collection.findWhere({name_or_id:e})},getPreservedData:function(){return this.resetPreserveFields.some(s.bind(function(e){return this.get(e)&&this.get(e).length>0},this))},softReset:function(){s.forEach(this.resetAttributes,function(e){s.has(this.typeAttributes,e)?this.set(e,this.typeAttributes[e]):s.has(this.defaults,e)?this.set(e,this.defaults[e]):this.unset(e)},this)},getLookupData:function(){if("reblog"===this.get("mode"))return{reblog_id:this.get("reblog_id"),reblog_key:this.get("reblog_key"),post_type:this.get("type")}},getContextPage:function(){var e=this.attributes,t="dashboard";return e.contextData&&(e.contextData.contextPage?t=e.contextData.contextPage:"baseRoute"in e.contextData&&(t=e.contextData.baseRoute.split("/").pop())),t},getAttributeFromGeneric:getTweetText:function(){var e=this.get("customTweet");return s.isString(e)||(e=this.generateTweetText(280-this.shortUrlLength-1),e?e+=" [URL]":e="[URL]"),e},getTweetTextLength:function(e){s.isString(e)||(e=this.getTweetText()),e=s.trim(e).replace(/([^\s])\[URL\]/gi,"$1 [URL]").replace(/\[URL\]([^\s])/gi,"[URL] $1");var t=e.length;return t+=(this.shortUrlLength-5)*(e.match(/\[URL\]/gi)||"").length},generateTweetText:function(e){return""},canEditMedia:isReblog:allowsTypeSwitch:function(e){return!1},canPreview:function(){return this.isValid()},deepHasChanged:function(e){var t=this.toJSON(),i=this.get("mode"),n=s.keys(e),o=s.keys(t);if(s.isEqual(e,t))return!1;if("new"!==i)return!0;var r=s.difference(o,n),a=s.reduce(r,function(e,i){var n=t[i],o=s.isUndefined(n)||s.isNull(n)?0:n.length;return e+o},0);return a>0||(e=s.omit(e,r),t=s.omit(t,r),!s.isEqual(e,t))}});r({"Tumblr.Prima.PostForms.Post":w}),e.exports=w},function(e,t,i){"use strict";var n=i(3),s=i(187),o=new s({delegateObject:function(e){var t={},i={};e&&(n.each(e,function(e,n){"undefined"!=typeof e&&("function"==typeof e?t[n]=e:i[n]=e)},this),s.onto(this,t),n.extend(this,i))}});e.exports=o},function(e,t,i){"use strict";function n(){}var s=i(3),o=i(6).sprintf,r=i(254).truncateLongStrings;n.prototype.genericFieldMap={one:"title",two:"body"},n.prototype.editorField="two",n.prototype.typeAttributes={title:"",body:""},n.prototype.allowAnswerFields=["title","body"],n.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("title"),n=this.getHtmlStripped("body");n=n.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var s;return s=i&&n?o("%s - %s",i,n):i||n||"",r(s,t)},n.prototype.validate=function(e,t,i){var n=[],o=!s.isUndefined(t.reblog_tree)&&t.reblog_tree!==!1&&""!==t.reblog_tree;return(!t.body||t.body.length<1)&&(!t.title||t.title.length<1)&&(o||n.push("Post body empty.")),e.call(this,t,{errors:n})},e.exports=n},function(e,t,i){"use strict";var n=i(3),s={normalizeSpace:,stripScripts,stripTags:function(e){return e.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},truncateLongStrings:function(e,t,i){return n.isString(e)||(e=""),i||(i="â€¦"),e.length<=t?e:n.trunc(e,t-i.length,i)},stripHtml:function(e,t,i){if(!e)return"";"undefined"==typeof t&&(t=!0);var s=e;"string"==typeof i&&(s=n.trim(s.replace(/(<br\s*\/?>)/gi,"$1"+i).replace(/(<\/(?:p|figure|h[1-6])\s*>)/gi,"$1"+i)));try{var o=document.implementation.createHTMLDocument("");o.body.innerHTML=this.stripScripts(s),s=o.body.textContent||o.body.innerText||"",s=s.trim()}catch(e){s=this.stripScripts(this.stripTags(s)).trim()}return t&&(s=this.normalizeSpace(s)),s}};e.exports=s},function(e,t,i){"use strict";function n(){}var s=i(3),o=i(256),r=i(254).truncateLongStrings;n.prototype.genericFieldMap={two:"caption",three:"linkthrough"},n.prototype.editorField="two",n.prototype.typeAttributes={caption:"",layout:"",linkthrough:"",photos:[]},n.prototype.allowAnswerFields=["caption"],n.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),r(i,t)},n.prototype.MAX_IMAGES=10,n.prototype.resetPreserveFields=["caption","tags"],n.prototype.afterDelegate=function(e){e.apply(this,s.rest(arguments)),this.photos=new o(this.attributes.photos,{parse:!0}),this.on("change:photos",function(e,t){this.photos.reset(t,{parse:!0}),delete this.attributes.photos},this),this.trigger("change:photos",this,this.get("photos")),this.listenTo(this.photos,"add remove change:preuploadUrl change:externalUrl",function(){this.trigger("validate")})},n.prototype.parseForType=function(e,t,i){return t.layout=i.photoset_layout,delete t.photoset_layout,t},n.prototype.serializeForServer=function(e){var t=this,i=e.apply(this,s.rest(arguments));return s.forEach(this.photos.toJSON(),function(e){i["images["+e.id+"]"]=e.uploadUrl,i["caption["+e.id+"]"]=(e.caption||"").substr(0,200),i["photo_redirect_url_primary["+e.id+"]"]=e.primaryUrl||"",i["photo_redirect_url_ios["+e.id+"]"]=e.iosUrl||"",i["photo_redirect_url_android["+e.id+"]"]=e.androidUrl||"",e.photoRaw&&(i.photo_raw=e.photoRaw,i.is_selfie_gif=e.isSelfieGif,i.is_selfie=e.isSelfie)}),i["post[carousel_display]"]=t.get("carouselDisplay"),i["post[redirect_url_primary]"]=t.get("redirectUrlPrimary"),i["post[photoset_layout]"]=t.get("layout"),i["post[photoset_order]"]=this.photos.pluck("id").join(","),i},n.prototype.canAddPhotS},n.prototype.validate=function(e,t,i){var n=[];0===this.photos.length&&n.push("No photos specified.");var s=this.photos.all(function(e){return e.getUploadUrl()||!e.has("upload")});return s||n.push("Uploads in progress."),e.call(this,t,{errors:n})},e.exports=n},function(e,t,i){"use strict";var n=i(3),s=i(190),o=i(257),r=s.extend({model:o,add:function(e,t){return e&&!n.isArray(e)&&(e=[e]),n.forEach(e,function(e,t){e.id||(n.isFunction(e.set)?e.set("id",this.generateId(t)):e.id=this.generateId(t))},this),s.prototype.add.apply(this,arguments)},generateId:function(e){var t=1+(e||0),i=n.map(n.range(this.length+1),function(e){return"o"+(t+e)});return n.find)},this)},setIdOrder:function(e,t){t||(t={}),this.models=n.map)},this),t.silent||this.trigger("sort",this,t)}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(258),r=i(185),a=i(259),l=i(260),c=i(262),u=1080,h=r.extend({defaults:{url:"",preuploadUrl:"",externalUrl:"",file:null,photoRaw:null,base64:null,isSelfie:!1,isSelfieGif:!1,width:null,height:null,caption:"",id:"",livephotoUrl:"",livephotoStillImageTime:"",primaryUrl:"",iosUrl:"",androidUrl:""},initialize:function(){this.on("change:externalUrl",function(e,t){t&&this.readUrl(t),this.set({preuploadUrl:null,base64:null})},this),this.get("externalUrl")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file")),this.on("change:file",function(e,t){t&&this.readFile(t),this.set({externalUrl:null,base64:null})},this),this.get("file")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file"))},readUrl:function(e,t){t||(t="photo:readUrl"),a.load(e).then(n.bind(function(e){this.set({url:e.src,width:e.width,height:e.height}),this.trigger(t,!0,this)},this),n.bind(function(i){this.set({url:e,width:null,height:null}),this.trigger(t,!1,this)},this))},readFile:function(e){return l.canReadFiles()?void l.read(e).then(n.bind(function(e){if(!e.file.type.match(/image\/(jpg|jpeg|png)/i))return this.readUrl(e.objectUrl||e.base64,"photo:readFile");var t=s("<img/>");t.attr("src",e.objectUrl||e.base64),a.load(e.objectUrl||e.base64).then(n.bind(function(i){var n=c.drawScaledAndRotated(t,i.width,i.height,e.rotation,e.mirrored,u);return this.readUrl(n.toDataURL(e.file.type),"photo:readFile")},this))},this),n.bind(function(){this.trigger("photo:readFile",!1,this)},this)):void this.trigger("photo:readFile",!1,this)},getDisplayUrl:function(){return this.get("preuploadUrl")?this.get("preuploadUrl"):this.get("externalUrl")?this.get("externalUrl"):this.get("base64")?this.get("base64"):this.get("url")},getUploadUrl:function(){return this.get("preuploadUrl")?this.get("preuploadUrl"):this.get("externalUrl")?this.get("externalUrl"):""},par)},toJSON:function(){var e=r.prototype.toJSON.apply(this,arguments);return e.displayUrl=this.getDisplayUrl(),e.uploadUrl=this.getUploadUrl(),e}});e.exports=h},function(e,t,i){"use strict";var n=i(3),s=function e(t,i){return null==i?i=5:n.isNumber(i)||(i=0),n.transform(t,function(t,s,o){i&&n.isObject(s)&&(s=e(s,i-1)),t[n.camelCase(o)]=s})};e.exports=r},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(3),r=i(192),a=i(261),l="FileReader"in window&&"readAsDataURL"in FileReader.prototype,c=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,u=[],h=function(){function e(t){n(this,e),null!=t&&this.read(t)}return s(e,[{key:"read",value:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.file=e,!e)return r.reject("No file to read");if(!l)return r.reject("FileReader is not supported");e.type.match(/image\/(jpg|jpeg)/i)||(i=!1);var n=void 0;return n=i&&"readAsBinaryString"in FileReader.prototype?this.readBinaryString(e).then(function(i){try{var n=new a.JpegFile(i.binary,e.name);i.rotati}}(n.tiff.Orientation.value),i.mirrored=function(e){switch(e){case 2:return!0;case 4:return!0;case 5:return!0;case 7:return!0;default:return!1}}(n.tiff.Orientation.value)}catch(e){}return t.readDataUrl(e).then(function(e){return o.extend(i,e)})}):this.readDataUrl(e),this.promise=n,n}},{key:"readDataUrl",value:function(e){var t=new FileReader;return"readAsDataURL"in t?r.promise(function(i,n){t.onload=function(e){var n=e.target.result;i(n),t.onload=null,t.onerror=null},t.onerror=function(){n(),t.onload=null,t.onerror=null},t.readAsDataURL(e)}).then(o.bind(this._onLoadDataUrl,this),o.bind(this._onError,this)):r.reject("FileReader.readAsDataURL is not supported")}},{key:"_onLoadDataUrl",value:function(e){var t={base64:e,file:this.file};return c&&(t.objectUrl=c(this.file),u.push(t.objectUrl)),r.resolve(t)}},{key:"readBinaryString",value:function(e){var t=new FileReader;return"readAsBinaryString"in t?r.promise(function(i,n){t.onload=function(e){var n=e.target.result;i(n),t.onload=null,t.onerror=null},t.onerrl},t.readAsBinaryString(e)}).then(o.bind(this._onLoadBinaryString,this),o.bind(this._onError,this)):r.reject("FileReader.readAsBinaryString is not supported")}},{key:"_onLoadBinaryString",value:function(e){return r.resolve({binary:e,file:this.file})}},{key:"_onError",value:function(e){return r.reject("Failed to read file")}}],[{key:"read",vale}},{key:"canReadFiles",value:function(){return l}}]),e}();e.exports=h},function(e,t,i){"use strict";var n=function(){},s=e.exports={};s.stringIsClean=function(e){for(var t=0;t<e.length;t++)if(e.charCodeAt(t)<32)return!1;return!0},s.parseNum=function(e,t,i,n){var s,o,r=">"===e;for(void 0===i&&(i=0),void 0===n&&(n=t.length-i),s=r?i:i+n-1;r?s<i+n:s>=i;r?s++:s--)o<<=8,o+=t.charCodeAt(s);return o},s.parseSnum=function(e,t,i,n){var s,o,r,a=">"===e;for(void 0===i&&(i=0),void 0===n&&(n=t.length-i),s=a?i:i+n-1;a?s<i+n:s>=i;a?s++:s--)void 0===r&&(r=128===(128&t.charCodeAt(s))),o<<=8,o+=r?255&~t.charCodeAt(s):t.charCodeAt(s);return r&&(o+=1,o*=-1),o},s.Rational=function(e,t){return this.num=e,this.den=t||1,this},s.Rational.prototype.toString=function(){return 0===this.num?""+this.num:1===this.den?""+this.num:1===this.num?this.num+" / "+this.den:this.num/this.den},s.Rational.prototype.asFlon},s.MetaGroup=function(e,t){return this.fieldName=e,this.description=t,this.metaProps={},this},s.MetaGroup.prototype._addProperty=function(e,t,i){var n=new s.MetaProp(e,t,i);this[n.fieldName]=n,this.metaProps[n.fieldName]=n},s.MetaGroup.prototype.toString=function(){return"[MetaGroup "+this.description+"]"},s.MetaPrs},s.MetaProp.prototype.toStrie},s.JpegFile=function(e,t){var i=this._SOS;this.metaGroups={},this._binary_data=e,this.filename=t;var n,o,r,a,l,c,u,h=0,d=0;if(this._binary_data.slice(0,2)!==this._SOI_MARKER)throw new Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+".");for(h+=2;h<this._binary_data.length&&(n=this._binary_data.charCodeAt(h++),o=this._binary_data.charCodeAt(h++),d=h,n==this._DELIM)&&o!==i;){for(l=s.parseNum(">",this._binary_data,h,2),h+=l;h<this._binary_data.length;)if(n=this._binary_data.charCodeAt(h++),n==this._DELIM&&(r=this._binary_data.charCodeAt(h++),0!==r)){h-=2;break}a=h-d,this._markers[o]?(c=this._markers[o][0],u=this._markers[o][1]):(c="UNKN",u=void 0),u&&this[u](o,d+2)}if(void 0===this.general)throw Error("Invalid JPEG file.");return this},s.JpegFile.prototype.toString=function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"},s.JpegFile.prototype._SOI_MARKER="Ã¿Ã˜",s.JpegFile.prototype._DELIM=255,s.JpegFile.prototype._EOI=217,s.JpegFile.prototype._SOS=218,s.JpegFile.prototype._sofHandler=function(e,t){if(void 0!==this.general)throw Error("Unexpected multiple-frame image");this._addMetaGroup("general","General"),this.general._addProperty("depth","Depth",s.parseNum(">",this._binary_data,t,1)),this.general._addProperty("pixelHeight","Pixel Height",s.parseNum(">",this._binary_data,t+1,2)),this.general._addProperty("pixelWidth","Pixel Width",s.parseNum(">",this._binary_data,t+3,2)),this.general._addProperty("type","Type",this._markers[e][2])},s.JpegFile.prototype._JFIF_IDENT="JFIF\0",s.JpegFile.prototype._JFXX_IDENT="JFXX\0",s.JpegFile.prototype._EXIF_IDENT="Exif\0",s.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]},s.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],
259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition","PhotmetricInerpretation",{2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries","PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]},s.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient","OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response","SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode","Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41989:["Focal length in 35 mm film","FocalLengthIn35mmFilm"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]},s.JpegFile.prototype._gpstags={0:["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision","GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]},s.JpegFile.prototype._markers={192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count â€œ0â€"],209:["RST1",null,"Restart with modulo 8 count â€œ1â€"],210:["RST2",null,"Restart with modulo 8 count â€œ2â€"],211:["RST3",null,"Restart with modulo 8 count â€œ3â€"],212:["RST4",null,"Restart with modulo 8 count â€œ4â€"],213:["RST5",null,"Restart with modulo 8 count â€œ5â€"],214:["RST6",null,"Restart with modulo 8 count â€œ6â€"],215:["RST7",null,"Restart with modulo 8 count â€œ7â€"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["APP13",null],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM",null],1:["JPG13",null]},s.JpegFile.prototype._addMetaGroup=function(e,t){var i=new s.MetaGroup(e,t);return this[i.fieldName]=i,this.metaGroups[i.fieldName]=i,i},s.JpegFile.prototype._parseIfd=function(e,t,i,o,r,a,l){var c,u,h,d,p,g,f,_,m,v,b,y=s.parseNum(e,t,i+o,2);b=this._addMetaGroup(a,l);for(var w=0;w<y;w++)if(c=i+o+2+12*w,u=s.parseNum(e,t,c,2),d=s.parseNum(e,t,c+2,2),g=s.parseNum(e,t,c+4,4),f=s.parseNum(e,t,c+8,4),void 0!==this._types[d]){if(h=this._types[d][0],p=this._types[d][1],f=p*g<=4?c+8:i+f,"UNDEFINED"==h)_=void 0;else if("ASCII"==h)_=t.slice(f,f+g),_=_.split("\0")[0],s.stringIsClean(_)||(_="");else{_=[];for(var C=0;C<g;C++,f+=p)"BYTE"!=h&&"SHORT"!=h&&"LONG"!=h||_.push(s.parseNum(e,t,f,p)),"SBYTE"!=h&&"SSHORT"!=h&&"SLONG"!=h||_.push(s.parseSnum(e,t,f,p)),"RATIONAL"==h&&(m=s.parseNum(e,t,f,4),v=s.parseNum(e,t,f+4,4),_.push(new s.Rational(m,v))),"SRATIONAL"==h&&(m=s.parseSnum(e,t,f,4),v=s.parseSnum(e,t,f+4,4),_.push(new s.Rational(m,v))),_.push();1===g&&(_=_[0])}r.hasOwnProperty(u)?b._addProperty(r[u][1],r[u][0],_):n("WARNING(jpegmeta.js): Unknown tag: ",u)}},s.JpegFile.prototype._jfifHandler=function(e,t){if(void 0!==this.jfif)throw Error("Multiple JFIF segments found");this._addMetaGroup("jfif","JFIF"),this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(t+5)),this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(t+6)),this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value),this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(t+7)),this.jfif._addProperty("Xdensity","X density",s.parseNum(">",this._binary_data,t+8,2)),this.jfif._addProperty("Ydensity","Y Density",s.parseNum(">",this._binary_data,t+10,2)),this.jfif._addProperty("Xthumbnail","X Thumbnail",s.parseNum(">",this._binary_data,t+12,1)),this.jfif._addProperty("Ythumbnail","Y Thumbnail",s.parseNum(">",this._binary_data,t+13,1))},s.JpegFile.prototype._app0Handler=function(e,t){var i=this._binary_data.slice(t,t+5);i==this._JFIF_IDENT?this._jfifHandler(e,t):i==this._JFXX_IDENT},s.JpegFile.prototype._app1Handler=function(e,t){var i=this._binary_data.slice(t,t+5);i==this._EXIF_IDENT&&this._exifHandler(e,t+6)},s.JpegFile.prototype._exifHandler=function(e,t){if(void 0!==this.exif)throw new Error("Multiple JFIF segments found");var i,n,o,r=this._binary_data.slice(t,t+2);if("II"===r)i="<";else{if("MM"!==r)throw new Error("Malformed TIFF meta-data. Unknown endianess: "+r);i=">"}if(n=s.parseNum(i,this._binary_data,t+2,2),42!==n)throw new Error("Malformed TIFF meta-data. Bad magic: "+n);if(o=s.parseNum(i,this._binary_data,t+4,4),this._parseIfd(i,this._binary_data,t,o,this._tifftags,"tiff","TIFF"),this.tiff.ExifIfdPointer&&this._parseIfd(i,this._binary_data,t,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif"),this.tiff.GPSInfoIfdPointer){if(this._parseIfd(i,this._binary_data,t,this.tiff.GPSInfoIfdPointer.value,this._gpstags,"gps","GPS"),this.gps.GPSLatitude){var a;a=this.gps.GPSLatitude.value[0].asFloat()+1/60*this.gps.GPSLatitude.value[1].asFloat()+1/3600*this.gps.GPSLatitude.value[2].asFloat(),"S"===this.gps.GPSLatitudeRef.value&&(a=-a),this.gps._addProperty("latitude","Dec. Latitude",a)}if(this.gps.GPSLongitude){var l;l=this.gps.GPSLongitude.value[0].asFloat()+1/60*this.gps.GPSLongitude.value[1].asFloat()+1/3600*this.gps.GPSLongitude.value[2].asFloat(),"W"===this.gps.GPSLongitudeRef.value&&(l=-l),this.gps._addProperty("longitude","Dec. Longitude",l)}}}},function(e,t,i){"use strict";var n=i(8),s=i(3),o=function(e,t,i){if(0===i)return 0;var n=null==i?t:t/i;return 2===arguments.length?Math.round(e*n):void 0},r=function(e,t,i){if(0===i)return 0;var n=null==i?t:t/i;return Math.round(e/n)},a=function(e,t,i,n){var s=e,a=t,l=e/t,c=i/n;return(e>i||t>n)&&(l>c?(s=i,a=r(s,l)):(a=n,s=o(a,l))),{width:s,height:a}},l=function(e,t,i,n,s,a){null!=s||(s=.5),null!=a||(a=.5);var l=0,c=0,u=e,h=t,d=e/t,p=i/n;return d>p?(u=o(t,p),l=Math.round(s*(e-u))):d<p&&(h=r(e,p),l=Math.round(a*(t-h))),{left:l,top:c,width:u,height:h}},c=function(e){var t;e instanceof n?(t=e,e=t.get(0)):t=n(e);var i=document.createElement("canvas");return i.width=e.width||t.width(),i.height=e.height||t.height(),i},u=function(e){var t=e.$(".needs-drawing");s.each(t,function(e){var t=e.getContext("2d"),i=new Image,s=4;t.mozImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1,t.msImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1;var o=function(){t.fillStyle="#FFF",t.fillRect(0,0,e.width,e.height),t.drawImage(i,0,0,s,s),t.drawImage(e,0,0,s,s,0,0,e.width,e.height)};i.onload=o,i.src=n(e).data("image-url")}),t.removeClass("needs-drawing")},h=function(e,t,i){var s;e instanceof n?(s=e,e=s.get(0)):s=n(e),t?t instanceof n&&(t=t.get(0)):t=c(e);var o=t.width,r=t.height,a=t.getContext("2d");return a.save(),i&&(a.translate(t.width,0),a.scale(-1,1)),a.drawImage(e,0,0,o,r),a.restore(),t},d=function(e,t,i,s,o,a){var l;e instanceof n?(l=e,e=l.get(0)):l=n(e);var c=90===s||270===s;c?a&&i>a&&(t=r(a,i,t),i=a):a&&t>a&&(i=r(a,t,i),t=a);var u=document.createElement("canvas");c?(u.width=i,u.height=t):(u.width=t,u.height=i);var h=u.getContext("2d");return h.save(),h.translate(.5*u.width,.5*u.height),h.rotate(s*Math.PI/180),o&&h.scale(-1,1),h.drawImage(e,-.5*t,-.5*i,t,i),h.restore(),u},p={widthForHeight:o,heightForWidth:r,maxSize:a,cropBox:l,createCanvasForEl:c,drawElToCanvas:h,drawScaledAndRotated:d,drawPixelatedImages:u};e.exports=p},function(e,t,i){"use strict";function n(){}var s=i(6).sprintf,o=i(254).truncateLongStrings;n.prototype.genericFieldMap={one:"quote",two:"source"},n.prototype.typeAttributes={quote:"",source:""},n.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("quote"),n=this.getHtmlStripped("source");n=n.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var r;return r=n&&i.length+(n.length>1?7:6)<=t?r=s("â€œ%sâ€ - %s",i,n):i?s("â€œ%sâ€",o(i,t-2)):n,o(r,t)},n.prototype.editorField="two",n.prototype.validate=function(e,t,i){var n=[];return(!t.quote||t.quote.length<1)&&n.push("No quote."),e.call(this,t,{errors:n})},e.exports=n},function(e,t,i){"use strict";function n(){}var s=i(3),o=i(6).sprintf,r=i(265),a=i(254).truncateLongStrings,l=i(266);n.prototype.genericFieldMap={one:"title",two:"url",three:"caption",thumbnail:"thumbnail",excerpt:"excerpt",author:"author"},n.prototype.typeAttributes={title:"",url:"",caption:"",excerpt:"",author:""},n.prototype.allowAnswerFields=["caption"],n.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("title"),n=this.getHtmlStripped("url"),s=this.getHtmlStripped("caption");s=s.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var l;return l=i&&s?o("%s - %s",i,s):i||s||r.parseUrl(n).host||"",a(l,t)},n.prototype.editorField="three",n.prototype.typeAttributes={title:"",url:"",excerpt:"",author:""},n.prototype.resetPreserveFields=["caption","tags"],n.prototype.resetAttributes=["title","url","thumbnail","excerpt","author"],n.prototype.softReset=function(e){e.apply(this,s.rest(arguments)),s.isEmpty(this.get("thumbnail"))||"new"===this.get("mode")||this.set("remove_thumbnail",1)},n.prototype.serializeForServer=function(e){var t=e.apply(this,s.rest(arguments));return this.get("remove_thumbnail")&&(t.remove_thumbnail=this.get("remove_thumbnail")),s.extend(t,{author:this.getAttributeFromGeneric("author"),excerpt:this.getAttributeFromGeneric("excerpt")}),t},n.prototype.validate=function(e,t,i){var n=[];return t.loading&&n.push("Loading OpenGraph data."),(!t.url||t.url.length<1)&&n.push("No url."),l.isUrl(t.url)||n.push("Not a valid URL"),e.call(this,t,{errors:n})},e.exports=n},function(e,t,i){"use strict";var n="function"==typbol&&e!==Symbol.prototype?"symbol":typeof e},s=i(3),o={aElement:document.createElement("a"),acceptedProtocols:["http:","https:","tumblr:","mailto:"],_setUrl:function(e){return this.aElement.setAttribute("href",e),this.aElement.setAttribute("href",this.aElement.href),this.aElement.href},parseUrl:function(e){if(!s.startsWith(e,"http"))throw new URIError("Missing protocol in URL to be parsed. Must be http or https");return this._setUrl(e),{url:e,href:this.aElement.href,protocol:this.aElement.protocol,host:this.aElement.hostname,port:this.aElement.port,query:this.aElement.search,hash:this.aElement.hash,path:this.aElement.pathname}},parseTumblelogUrl:function(e){try{e.indexOf("://")===-1&&(e="https://"+e);var t=this.parseUrl(e),i=!1;if(s.endsWith(t.host,"tumblr.com")?i=t.host.match(/([a-zA-Z0-9-_]+)\.tumblr\.com/i):s.endsWith(t.host,"tumblr.net")?i=t.host.match(/(?:^|\/\/)(?:([\w\-\_]+)\.)(?:[\w\-\_]+\.)*tumblr\.net/i):s.endsWith(t.host,"t.dev")&&(i=t.host.match(/([a-zA-Z0-9-_]+)\.t\.dev/i)),i){var n=i[1];if("www"===n)return!1;var o={tumblelog_name:n},r=t.path.match(/post\/([0-9]+)/i);return r&&(o.post_id=r[1]),o}return!1}catch(e){return!1}},isTumblelogUrl:function(e){return this.parseTumblelogUrl(e)!==!1},parseTumblelogShortUrl:function(e){try{e.indexOf("://")===-1&&(e="https://"+e);var t=this.parseUrl(e);return"tmblr.co"===t.host&&(s.startsWith(t.path,"/m")?{mentionKey:t.path.match(/^\/m([^\/]+)/)[0]}:!!s.startsWith(t.path,"/Z")&&{postTinyUrlHash:t.path.match(/^\/Z([^\/]+)/)[0]})}catch(e){return!1}},isTumblelogShortUrl:function(e){return this.parseTumblelogShortUrl(e)!==!1},isTumblrMediaUrl:function(e){return!!e&&(e.indexOf("://")===-1&&(e="https://"+e),!!e.match(/^https?:\/\/(\d+\.)media\.tumblr\.com\//i))},hasAllowedProtocol:function(e){this._setUrl(e);var t=this.aElement.protocol;if(":"===t&&(t=location.protocol),this.acceptedProtocols.indexOf(t)===-1)throw new Error("Unsupported protocol detected in URL: "+e);return!0},isAbsoluteUrl:function(e){var t=new RegExp("^(?:[a-z]+:)?//","i");return!!t.test(e||"")},getParameter:function(e){var t=new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)"),i=t.exec(location.search)||[null,""],n=i[1].replace(/\+/g,"%20"),s=decodeURIComponent(n);return s||null},httpBuildQuery:function(e,t){var i=[];for(var s in e)if(e.hasOwnProperty(s)){var o=t?t+"["+s+"]":s,r=e[s];if(!r)continue;i.push("object"===("undefined"==typeof r?"undefined":n(r))?this.httpBuildQuery(r,o):encodeURIComponent(o)+"="+encodeURIComponent(r))}return i.join("&")},buildUrl:function(e,t){var i=this.httpBuildQuery(t);return e[^&]*))?","g"),function(e,i,n,s){t[i]=s}),t},isProtocolRelative:function(e){var t=new RegExp("^//[^/]","i");return t.test(e||"")},getExtension:function(e){var t,i;return this.isProtocolRelative(e)&&(e=this.addProtocolIfMissing(e,"https:")),s.startsWith(e,"http")&&(i=this.parseUrl(e),s.isEmpty(i.path)||(t=i.path)),t||(t=e),s.last(t.split("."))},addProtocolIfMissing:function(e,t){if(s.any(this.acceptedProtocols,function(t){return s.startsWith(e,t)}))return e;if(this.acceptedProtocols.indexOf(t)===-1)throw new Error("Attempting to add an unsupported protocol: "+t);return(this.isProtocolRelative(e)?t:t+"//")+e}};e.exports=o},function(e,t){"use strict";var i={isUrl:function(e){var t="%[0-9a-fA-F]{2}",i="(http|https):\\/\\/",n='([a-zA-Z0-9$\\-_.+!*"(),;:&=]|'+t+")+@",s="(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])",o="("+s+"(\\."+s+"){3})",r="a-zA-Z0-9\\-\\_\\~",a="\\u00C0-\\u9FFF",l="(["+r+a+"]+\\.)+([a-zA-Z]{2,})",c="[0-9]+",u="("+o+"|localhost|"+l+")(:"+c+")?",h=r+a+".:\\[\\]@!$&'()*+,;=",d="(["+h+"]|"+t+")*",p=d+"(\\/"+d+")*",g="\\?(["+h+"/?]|"+t+")*",f="\\#(["+h+"/?]|"+t+")*",_=new RegExp("^"+i+"("+n+")?"+u+"(\\/?("+p+")?("+g+")?("+f+")?)?$");return _.test(e)===!0},isImageUrl:function(e){var t=i.isUrl(e),n=/.+[.](jpg|jpeg|png|gif)([?]|$)/.test(e)===!0;return t&&n}};e.exports=i},function(e,t,i){"use strict";function n(){}var s=i(3),o=i(6).sprintf,r=i(254).truncateLongStrings;n.prototype.genericFieldMap={one:"title",two:"chat"},n.prototype.typeAttributes={title:"",chat:""},n.prototype.generateTweetText=function(e,t){var i,n=this.getHtmlStripped("title"),s=this.getHtmlStripped("chat");return i=n&&s?o("%s - %s",n,s):n||s||"",r(i,t)},n.prototype.validate=function(e,t,i){var n=[];return(!t.chat||t.chat.length<1)&&n.push("No chat."),e.call(this,t,{errors:n})},n.prototype.serializeForServer=function(e){var t=this,i=e.apply(this,s.rest(arguments));return i["post[two]"]=t.get("chat").replace(/\u00A0/gm," "),i},e.exports=n},function(e,t,i){"use strict";function n(){}var s=i(3),o=i(130),r=i(254).truncateLongStrings;n.prototype.genericFieldMap={two:"caption",three:"url"},n.prototype.editorField="two",n.prototype.allowsTypeSwitch=function(){return"new"===this.get("mode")},n.prototype.typeAttributes={service:!1,preuploadUrl:"",trackTitle:"",trackArtist:"",trackAlbum:"",preuploadAlbumArt:!1,albumArt:"",caption:"",confirmTos:!1},n.prototype.allowAnswerFields=["caption"],n.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),r(i,t)},n.prototype.resetPreserveFields=["caption","tags"],n.prototype.resetAttributes=["service","url","preuploadUrl","trackTitle","trackArtist","trackAlbum","confirmTos","preuploadAlbumArt","albumArt","copyrightFallback"],n.prototype.parseForType=function(e,t,i){i.service&&"direct"!==i.service||(t.url=i.audio_url),delete t.audio_url,t.albumArt=i.audio_artwork,delete t.audio_artwork;var n=i.id3_tags||{};return delete t.id3_tags,t.trackTitle=n.Title||"",t.trackArtist=n.Artist||"",t.trackAlbum=n.Album||"",t},n.prototype.serializeForServer=function(e){var t=e.apply(this,s.rest(arguments)),i={"id3_tags[title]":this.get("trackTitle")||null,"id3_tags[artist]":this.get("trackArtist")||null,"id3_tags[album]":this.get("trackAlbum")||null,preuploaded_url:this.get("preuploadUrl"),confirm_tos:this.get("confirmTos"),artwork_pre_upload:this.get("preuploadAlbumArt"),album_art:this.get("albumArt"),remove_album_art:"edit"===this.get("mode")&&s.isEmpty(this.get("albumArt")),copyright_fallback:this.get("cop.pick(i,function(e){return!s.isUndefined(e)})),s.isEmpty(t.preuploaded_url)||(t["post[three]"]=null),t},n.prototype.validate=function(e,t,i){var n=[];return s.isEmpty(t.url)?n.push(o("Please choose an audio source before continuing.")):t.preuploadUrl?t.confirmTos||n.push(o("You must agree that you have permission to share this file.")):s.isEmpty(t.url)&&n.push(o("Please choose an audio source before continuing.")),e.call(this,t,{errors:n})},e.exports=n},function(e,t,i){"use strict";function n(){}var s=i(3),o=i(130),r=i(270),a=i(258),l=i(254).truncateLongStrings;n.prototype.genericFieldMap={one:"embedCode",two:"caption"},n.prototype.allowAnswerFields=["caption"],n.prototype.editorField="two",n.prototype.resetPreserveFields=["caption","tags"],n.prototype.resetAttributes=["preuploadUrl","preuploadKey","embedCode","confirmTos","copyrightFallback"],n.prototype.typeAttributes={caption:"",confirmTos:!1},n.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),l(i,t)},n.prototype.validate=function(e,t,i){var n=[];return t.embedCode?0===t.embedCode.length&&n.push("No embed specified."):t.preuploadUrl?t.confirmTos||n.push(o("You must agree that you have permission to share this file.")):t.video?0===t.video.embed_code.length&&n.push("Direct embed missing."):n.push("No video specified."),e.call(this,t,{errors:n})},n.prototype.canPreview=function(){return!this.get("preuploadKey")&&this.isValid()},n.prototype.serializeForServer=function(e){var t=e.apply(this,s.rest(arguments)),i=s.omit({preuploaded_url:this.get("preuploadUrl"),preuploaded_ch:this.get("preuploadKey"),confirm_tos:this.get("confirmTos"),copyright_fallback:this.get("copyrightFallback")},s.isUndefined);return s.extend(t,i),t=r(t,{embedCode:"embed_code"})},n.prototype.getEmbedData=function(e){var t=!1;return this.has("video")?(t=a(this.get("video")),t={isNativeVideo:!0,embedRenderContext:"inline",width:t.dimensions.width,height:t.dimensions.height,previewIframe:t.previewIframe,embedCode:t.embedCode}):this.has("video_embed")&&(t=a(this.get("video_embed"))),t},e.exports=n},function(e,t,i){"use strict";function n(e,t){return o.zipObject(e,o.map(e,t))}function s(e,t){return o.isFunction(t)&&(t=n(o.keys(e),t)),o.transform(e,function(e,i,n){e[o.result(t,n)||n]=i},{})}var o=i(3);s.createKeyMap=n,e.exports=s},function(e,t,i){"use strict";function n(){}var s=(i(3),i(254).truncateLongStrings);n.prototype.genericFieldMap={one:"ask",two:"answer",three:"caption"},n.prototype.editorField="three",n.prototype.typeAttributes={ask:"",answer:"",caption:""},n.prototype.generateTweetText=function(e,t){return s(this.getHtmlStripped("ask"),t)},n.prototype.validate=function(e,t,i){var n=[];return t.ask||n.push("Post question empty."),e.call(this,t,{errors:n})},e.exports=n},function(e,t,i){"use strict";var n=i(3),s=function(e){if(n.isString(e)){if(e=e.toLowerCase(),"true"===e||"1"===e||"on"===e)return!0;if("false"===e||""===e||"off"===e)return!1;if(e=n.parseInt(e),n.isNaN(e))return!0}return!!e};e.exports=s},function(e,t,i){"use strict";var n=i(3),s=i(190),o=i(274),r=i(1tenTo(e,"change",this._onUploadModelChange)},_stopListeningToUploadModel:function(e){this.stopListening(e)},_onUploadModelChange:function(e){n.has(e.changed,"complete")&&this.trigger("complete",this,e),n.has(e.changed,"error")&&e.get("error")&&this.trigger("error",this,e),n.has(e.changed,"complete")&&this.allComplete()&&this.trigger("allComplete",this)},add:function(e){return n.isArray(e)?n.forEach(e,this._listenToUploadModel,this):this._listenToUploadModel(e),s.prototype.add.apply(this,arguments)},remove:function(e){return n.isArray(e)?n.forEach(e,this._stopListeningToUploadModel,this):this._stopListeningToUploadModel(e),s.prototype.remove.apply(this,arguments)},removeIncomplete:function(e){var t=this.where({uploading:!1,complete:!1});return this.remove(t,e)},removeFailed:function(e){var t=this.filter(function(e){return e.get("error")});return this.remove(t,e)},allComplete:function(){return!!this.length&&this.every(function(e){return e.get("complete")})},anyUploading:function(){return this.length>0&&this.any(function(e){return e.get("uploading")})},getProgress:function(){var e=0,t=0;return this.forEach(function(i){i.get("error")&&(e+=i.get("bytesLoaded")||0,t+=i.get("bytesTotal")||0)}),t?e/t:0},promise:function e(){if(this.allComplete())return r.resolve(this);var e=r.promise(n.bind(function(e,t){var i,s;i=n.bind(function(){this.stopListening(this,"uploads:allComplete",i),this.stopListening(this,"uploads:error",s),e.apply(this,arguments)},this),s=n.bind(function(){this.stopListening(this,"uploads:allComplete",i),this.stopListening(this,"uploads:error",s),t.apply(this,arguments)},this),this.listenToOnce(this,"uploads:allComplete",i),this.listenToOnce(this,"uploads:error",s)},this));return e}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(185),o=s.extend({defaults:{url:"",file:null,error:!1,uploading:!1,complete:!1,bytesLoaded:0,bytesTotal:0},initialize:function(e,t){this.options=n.extend({},t),this.options.jqXHR&&this.setUploadRequest(this.options.jqXHR)},setUploadRequest:function(e){return this.jqXHR=e,e.then(function(){}),e},_uploadDone:function(){this.set({errois.set({error:!0,uploading:!1,complete:!1})},cancelUpload:function(){var e;return this.jqXHR&&(e=this.jqXHR.abort(),this.jqXHR=null),e},getProgress:function(){return this.get("bytesTotal")?this.get("bytesLoadedmoved=!0,this.subViews=null}}"use strict";function n(e){return s.trim(e)}var s=i(3),o=i(187),r=function(e,t){return e=n(e),t&&s.isFunction(this.$$)&&this.$$.cache.delete(e),e},a=function(e){if(this.$$)return e=n(e),this.$(e)},l=function(e){this.$$&&(e=n(e),this.$$.cache.delete(e))},c=function(e){if(this.$$)return e=n(e),this.$$.cache.delete(e),this.$(e)},u=function(){this.$$&&(this.$$.cache=new s.memoize.Cache)},h=function(e){return"[data-js-"+e+"]"},d=function(e){return function(){var e=s.memoize(s.bind(a,this),s.bind(r,this));e.update=s.bind(c,this),e.remove,this);var t=function(t,i){return e(h(t),i)};return t(h(t))},t.remove=function(t){e.remove(h(t))},this.$$=e,this.js$=t,this.$$initialize=s.noop,e}.call(e)},p=new o({defaults:{$$cacheKeys:{},$$cacheSelectors:function(e){return"undefined"==typeof e&&(e=this.$$cacheKeys),s.forEach(e,function(e){this.$$.update(e)},this),thistion(){return d(this).apply(this,arguments)}},before:{initialize:function(){this.$$initialize()},render:function(){this.$$.empty()}},after:{setElement:function(){s.isFunc.isFunc.$$cacheSelectors)&&t,s.extend(n.prototype,r.Events),e.exports=n},,,,,,,,function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(219),r=i(136),a=i(293),l=i(276),c=i(277),u=i(230),h=i(312),d=o.extend({defaults:{placeholder:"",name:"",syncWithModel:!0,forceSingleLine:!1,smartQuotesEnabled:!1},events:{},mixins:[u,l,c],template:h,initialize:function(e){this.set(e),this.onChange=e.onChange||n.noop,this.onClientEvent=e.onClientEvent||n.noop,this.pasteHook=e.pasteHook||n.noop,this.smartQuotesEnabled=e.smartQuotesEnabled,this.disableEdit=e.disableEdit||!1;var t=this.get("name");t&&this.get("syncWithModel")&&this.$el.attr("data-name",t)},_initializeEditor:function(e,t){var i={placeholder:t,onChange:this._composeOnChange(),onClientEvent:this._composeOnClientEvent(),pasteHook:this.pasteHook,runIFrameSanitization:!0,forceSingleLine:this.get("forceSingleLine"),filterRules:{elements:["p","br"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}},smartQuotes:{enabled:this.smartQuotesEnabled}};this.editor=new a.PlainTextEditor(e,i),this.disableEdit&&this.disable()},_composeOnChange:function(){var e=[this.onChange],t=this;return this.get("syncWithMoction(i){n.each(e,function(e){e.call(t,i)})}},_composeOnClientEvent:function(){var e=this.onClientEvent,t=this;return function(i){r.trigger("plainTextEditor:onClientEvent",i,t.editor),e.call(this,i)}},render:function(){this.$el.html(this.template({ariaLabel:this.get("ariaLabel")}));var e=this.js$("plainTextEditor").get(0);if(this._initializeEditor(e,this.get("placeholder")),this.get("syncWithModel")){var t=this._modelValue().length>0;t&&this.set("placeholder",!1),this.urn this.$el.empty(),delete this.editor,this},serialize:function(){return this.toJSON()},getEditorValue:function(e){return"undefined"!=typeof e||(e=!0),this.editor?this.editor.getData(e):null},setEditorValue:function(e){this.editor&&this.editor.setData(e)},updateModelFromEditor:function(){if(!this.editor)return!1;var e=this.get("name"),t=this.getEditorValue();""!==t?s(this.editor.element).addClass("has-text"):s(this.editor.element).removeClass("has-text"),this.model.get(e)!==t&&this.model.set(e,t)},updateEditorFromModel:function(){var e=this.getEditorValue(),t=this._modelValue();t.trim()&&t.trim()!==e.trim()&&this.setEditorValue(t)},_modelValue:function(){returnnction(){this.editortCursorToEnd)&&this.editor.setCursorToEnd()},enable:function(){s(this.editor.itor.element).removeAttr("contenteditable")}});e.exports=d},function(e,t,i){var n=i(3),s=i(294);e.exports=n.extend(s,{RichTextEditor:i(295),PlainTextEditor:i(311),SelectionContext:i(305),SelectionPersistence:i(299),Utils:i(298),HumanKeys:i(310)})},function(e,t){var i={debugMode:!1};e.exports=i},function(e,t,i){var n=i(3),s=i(8),o=i(296).animate,r=i(297),a=i(302),l=i(303),c=i(299),u=i(305),h=i(306),d=i(298),p=i(307),g=i(308),f=i(309),_=i(310),m=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,v=i(301),b=function(){function e(e,t){return n.mapValues(e,function(e,t){return t.match(/^on[A-Z]/)&&n.isFunction(e)?n.bind(e,this):e},t)}function t(){U.call(this,de);var e=s("<div />",{"data-js":"editor-wrapper",class:"editor-wrapper"}).css("position","relative"),t=s("<div />",{"data-js":"editor-slot",class:"editor-slot"}).css("position","relative");s(this.element).wrap(e).wrap(t),t=s(this.element).parent(),this.wrapper=t.parent().get(0),this.placeholderElement=s("<div />",{"data-js":"editor-placeholder",class:"editor-placeholder"}).css("position","absolute"),this.placeholderElement.on("click",n.bind(function(e){this.focus()},this)),t.append(this.contextualControls.element),t.append(this.linkControl.element),t.append(this.placeholderElement),t.append(this.inlineControls.element),$.call(this),this.controlBar=s("<div />",{"data-js":"control-bar",class:"control-bar disabled"});var o=s("<div />",{class:"static-controls control"});this.controlBar.append(o),this.controlBar.append(this.staticControls.element);var r=this;o.on("mousedown",function(e){e.preventDefault(),e.stopPropagation();var t=u.getNodeList();r.staticControls.setActives(n.pluck(t,"nodeName"));var i=s(this).position();return r.staticControls.isShown?r.staticControls.hide():r.staticControls.open(i.left+s(this).width()/2,0),r.contextualControls.hide(),r.linkControl.close(),!1}),this.config.showStaticControls&&s(this.wrapper).append(this.controlBar),i.call(this),T.call(this)}function i(){var e=this,t=function(){var t=e.inlineControls.isTrayOpen||e.contextualControls.isShown||e.staticControls.isShown||e.linkControl.isShown;return t};s(this.element).on("input keydown keyup keypress mousedown mouseup",function(t){e.controlBar.removeClass("disabler i=function(){O.call(this),this.onChange()};s(this.element).on("keydown",function(i){if(i.keyCode===ye.shift)e.keyModifiers.shift=!0;else if(n.contains([ye.metaLeft,ye.metaRight],i.keyCode))e.keyModifiers.meta=!0;else{if(i.keyCode===ye.esc)return void(t()&&(e.contextualControls.hide(),e.staticControls.hide(),e.inlineControls.isTrayOpen&&e.inlineControls.toggleTrayWithIntent(!1),i.stopPropagation()));i.keyCode===ye.backspace?(S.call(e,i),G.call(e)):i.keyCode===ye.enter&&(C.call(e,i),w.call(e,i),d.browser.safari&&i.shiftKey&&(i.preventDefault(),y.call(e)))}var s=n.contains(n.values(n.omit(ye,"enter")),i.keyCode);!b.call(e)||s||e.keyModifiers.meta||(e.keyModifiers.meta=!1,i.preventDefault()),F.call(e,i),O.call(e,i)}),s(this.element).on("keyup",function(t){t.keyCode===ye.shift?e.keyModifiers.shift=!1:n.contains([ye.metaLeft,ye.metaRight],t.keyCode)?e.keyModifiers.meta=!1:t.keyCode===ye.enter?G.call(e):t.keyCode!==ye.backspace&&t.keyCode!==ye.delete||(R.call(e),n.defer(function(){x.call(e)}));var s=!1;t.keyCode===ye.right&&!t.shiftKey&&e.inlineControls&&(s=e.inlineControls.isShown),t.keyCode===ye.esc||s||i.call(e)}),s(this.element).on("input",function(){i.calent).on("mouseup",function(){o=!is.element).on("mousedown",function(e){o=!0}),document.addEventListener("mousedown",function(t){var i=function(){o=!1,k.call(e),e.controlBar.addClass("disabled")};e.wrapper===t.target||s.contains(e.wrapper,t.target)||e.config.documentMousedownHook(t,i)||r("mouseup",function(t){o&&(O.call(e),o=!1)},!0),s(this.element).on("focus",function(){if(e.controlBar.removeClass("disabled"),!W.call(e)){var t=s(e.element).children(ge.join());if(t.length){var i=t.first().get(0);c.setToStart(i)}}n.defer(function(){e.onChange()})}),s(this.element).on("blur",function(i){var s=function(i){if(!t()){var s=u.getSelection();s&&u.isInContexunction(){e.onChange(),n.isFunction(i)&&i()})}};e.config.blurHook(i,s)||n.defer(s)}),s(this.element).on("paste",function(t){var i=(t.originalEvent||t).clipboardData;i&&(e.config.pasteHook(i,e.keyModifiers.shift)||B.call(e,i),V.call(e),t.preventDefault())}),s(this.element).on("cut",function(t){e.contextualControls.hide(),e.staticCfunction(){x.call(e),V.call(e),e.onChange()})})}function b(){return!!this.config.characterLimit&&this.element.innerText.length>this.config.characterLimit}function y(){for(var e=W.call(this),t=n.contains(_e,e.nodeName)?"\n":"<br>",i=u.isCursorAtEnd(e)&&!u.isCursorAtStart(e)?1:0,s=0;s<i;s++)t+=t;H.call(this,t)}function w(e){var t,i,o=u.getNodeByNames(_e);o&&!this.keyModifiers.shift&&u.isCursorAtEnd(o)&&(i=s(o),t=i.text(),e.preventDefault(),t.match(/\n\n$/)?(n.last(i.contents()).remove(),this.insertNewParagraphAfter(o)):(i.append("\n\n"),c.setToEnd(o)))}function C(e){var t=u.getNodeByNames(["BLOCKQUOTE"]);if(t&&!this.keyModifiers.shift&&u.isCursorAtEnd(t,!0)){var i="P"===t.lastElementChild.nodeName?t.lastChild:null;i&&i.previousSibling&&this.dataFilter.isEmptyElement(i,!0)&&(e.preventDefault(),s(i).remove(),this.insertNewParagraphAfter(t))}}function k(){this.contextualControls.hide(),this.staticControls.hide(),this.linkControl.close(),this.inlineControls.close()}function x(){if(!s(this.element).has(be.join()).length){var e=s(this.element).find("ul:not(:has(li)),ol:not(:has(li))");e.remove();var t),function(e){return e.textContent.length>0});t||(U.call(this,""),G.call(this),$.call(this))}}function S(e){var t=u.getSelection();if(t.isCollapsed){var i=W.call(this);if(i&&!(c.saveSelection(i).start>0)){var n=s(i).prev().get(0);n&&ce.call(this,n)&&(s(n).remove(),e.preventDefault())}}}function T(){var e=this,t=s(e.element).offset().top,i=null,o="dragstart dragenter dragleave dragover dragend drop",r=!1,a=function(e){var t=e.datransfer.types,function(e){return"Files"===e});return t},l=function(e){return"false"===s(e.target||e.srcElement).attr("contenteditable")},c=funcction(t){e.config.onFileAdded.call(e,t,i,s)}),O.call(e))},u=function(e,t){return e<t.top+.66*t.height},h=function(e,i){var n=s(i).offset().top-t,o=s(i).get(0).getBoundingClientRect().height,r=e>n+.66*o;return{element:i,top:n,bottom:n+o,height:o,isAfter:r}},d=function(){s(e.element).find(".over-top, .over-bottom").each(function(){s(this).removeClass("over-top").removeClass("over-bottom"),""===s(this).attr("class").trim()&&s(this).removeAttr("class")})},p=function(n){var o=null,r=n.pageY-t,a=s(e.element).children();i&&r>i.top&&u(r,i)||(a.each(function(){var e=h(r,this);if(u(r,e)&&(n.target||n.srcElement)!==this)return o=e,!1}),o||(o=h(r,a.last().get(0)),o.isAfter=!0),o&&i&&i.element===o.element&&i.isAfter===o.isAfter||(d(),i=o))};s(e.els(e.element).on("dragleave",function(e){d()}),s(e.element).on("dragover",function(e){return r?(n.debounce(p,100)(e.originalEvent),i&&(s(i.element).addClass(i.isAfter?"over-bottom":"over-top"),a(e.originalEvent)&&e.stopPropagation()),void e.preventDefault()):(e.preventDefault(),void e.stopPropagation())}),s(e.element).on("dragenter",function(e){e.preventDefault(),a(e.originalEvent)&&(r="file")}),s(e.element).on("dragstart",function(t){if(k.call(e),l(t.originalEvent)){r="media";var i=t.originalEvent.target||t.originalEvent.srcElement,o=t.originalEvent.dataTransfer;if(o){o.effectAllowed="move",o.dropEffect="move";try{var a=s(i).find("img").attr("src")||"";a.match(/^\s*data:/)&&(a=""),o.setData("text/uri-list",a),o.setData("text/plain",a)}catch(e){}}n.defer(function(){s(i).addClass("dragging")})}}),s(e.element).on("drop",function(e){d(),a(e.originalEvent)&&c(e.originalEvent.dataTransfer.files,i.element,i.isAfter?1:-1),e.stopPropagation(),e.preventDefault()}),s(e.element).on("dragend",function(t){if(l(t.originalEvent)){d();var n=t.originalEvent.target||t.originalEvent.srcElement,o=s(n).data("origHeight"),a=n;if(i&&a!==i.element){var c=s(n).remove();i.isAfter?s(i.element).after(c):s(i.element).before200,function(){s(a).removeClass("dragging")}),e.onChange(),O.call(e)}r=!1})}function E(e,t,i){var n=s(this.element),o=c.saveSelection(this.element);n.find(i).wrap("<"+t+">"),n.find(i).contents().unwrap(),c.restoreSelection(o),window.document.execCommand(e),n.find(t).wrap("<"+i+">"),n.find(t).contents().unwrap(),c.restoreSelection(o)}function P(e,t,i){var o=this,r=function(){window.document.execCommand(e),o.config.flattenBlocks&&N.call(o)},a=function(){var e=c.saveSelection(o.element),t=200,n=240;!i||i.isAnimating||e.selection.isCollapsed||setTimeout(function(){s(o.linkControl.linkEditInput).focus();var r=function(i,n){var r=i-s(o.wrapper).offset().left,a=n-s(o.wrapper).offset().top;o.linkControl.size(t),o.linkControl.show(r,a),o.linkControl.createLink(e)};i.closeWithShim(i.element.find(".link").get(0),t,n,r),e.selection.removeAllRanges(),o.blur(!0)},30)},l=function(e){var t=c.saveSelection(o.element),i=u.getRootElements();switch(n.each(fe,function(e){var t=u.getNodesByNames(i,[e]);t.length&&I.call(o,"formatBlock",e)}),M.call(o),e.toLowerCase()){case"blockquote":i=u.getRootElements();var r=[],a=[];i=n.each(i,function(e){n.contains(ve,e.nodeName.toUpperCase())?a.push(e):(r.(t){s(t).wrapAll(document.createElement(e))});break;case"pre":window.document.execCommand("formatBlock",!1,"<"+e+">"),A.call(this);break;default:window.document.execCommand("formatBlock",!1,"<"+e+">")}c.restoreSelection(t)},h=function(){var e=o.contextualControls.controls,t=o.contextualControls.getActiveStates();n.each(t,function(t,i){var n=e[i];t&&I.call(o,n.command,n.el)}),window.document.execCommand("removeFormat")};switch(e){case"formatBlock":l(t);break;case"createLink":a();break;case"insertOrderedList":r();break;case"insertUnorderedList":r();break;case"removeFormat":h();break;case"insertHTML":E.call(this,"underline","U",t);break;default:window.document.execCommand(e)}O.call(this),R.call(this),o.onChange()}function I(e,t){var i=this;switch(e){case"formatBlock":var o=c.saveSelection(this.element);M.call(i),n.each(u.getRootElements(),function(e){i.dataFilter.unBlock(e),"pre"===e.nodeName.toLowerCase()&&(e.innerHTML=e.innerHTML.replace("\n","<br>"));var t=e.nodeName.toUpperCase();if(n.contains(fe,t)){var o=s(e).contents();s(o).wrapAll("<p>"),s(e.firstChild).unwrap()}}),c.restoreSelection(o);break;case"insertOrderedList":M.call(this);break;case"insertUnorderedList":M.call(this);break;case"createLink":window.document.execCommand("unlink");break;case"insertHTML":E.call(this,"underline","U",t);break;default:window.document.execCommand(e)}R.call(this),O.call(this),this.onChange()}function F(e){var t=function(){var e=u.getNodeByNames(["UL","OL"]);return!!e};e.keyCode===ye.tab&&t()&&(e.preventDefault(),e.stopPropagation(),e.shiftKey?(P.call(this,"outdent"),t()||P.call(this,"formatBlock","p")):P.call(this,"indent"))}function A(){var e=u.getNodeByNames(_e);e&&s(e).find("br").replaceWith("\n")}function M(){var e=u.getNodeByNames(me);if(e){do window.document.execCommand("outdent");while(u.getNodeByNames(me));u.getNodeByNames(["H2"])||window.document.execCommand("formatBlock",!1,"<p>"),this.dataFilter.blockifyInlineNodes(this.element)}}function N(){var e=c.saveSelection(this.element),t=u.getNodeList(null,!0);this.dataFilter.unwrapParentBlocks(t),c.restoreSelection(e)}function R(){var e=c.saveSelection(this.element),t=u.getNodeList(),i=this.dataFilter.scrubSpansAndBadAttrs(t);i&&e.end>e.start&&c.restoreSelection(e)}function O(e){var t=this;setTimeout(function(){var i=u.getSelection();return i?(i.isCollapsed?D.call(t,i):j.call(t,i),ie.call(t),K.call(t),t.config.onSelection.call(t,i),u.isInContext(i,t.element)&&(t.lastSelection=c.saveSelection(t.element)),V.call(t),$.call(t),void(n.isFunction(e)&&e())):(ie.call(t),void(n.isFunction(e)&&e()))},20)}function j(e){if(u.isInContext(e,this.element)){var t=u.getContextCoordinates(s(this.element).parent().parent()),i=u.getNodeList(e);this.contextualControls.setActives(n.pluck(i,"nodeName")),this.staticControls.setActives(n.pluck(i,"nodeName")),this.linkControl.close(),this.inlineControls.close(),""!==e.toString().trim()&&t&&!this.staticControls.isShown&&this.contextualControls.open(t.x,t.y)}}function D(e){this.contextualContrn.find(t,function(e){return"A"===e.nodeName});if(this.linkControl.isValidLink(i)){var o=u.getContextCoordinates(s(this.element).parent().parent(),i);this.linkControl.showOptions(i),this.linkControl.showOverTarget(o.x,o.y)}else this.linkControl.close();this.staticControls.setActives(n.pluck(t,"nodeName"))}function V(){var e=u.getSelection(),t=e&&e.isCollapsed;if(!t||!u.isInContext(e,this.element))return void this.inlineControls.close();var i=W.call(this);if(i&&"P"===i.nodeName&&this.dataFilter.isEmptyElement(i)&&!this.isEmpty())this.inlineControls.open(i);else if(this.isEmpty()){this.inlineControls.open(i);var n=d.calcTextWidth(this.placeholderElement,this.config.placeholder);this.inlineControls.open(i,n)}else this.inlineControls.close()}function $(){var e=this.isEmpty()?this.config.placeholder:"",t=s(this.placeholderElement);t.html(e);var i=t.outerHeight();i&&s(this.element).css("min-height",Math.max(parseInt(t.css("min-height"),10)||0,i))}function L(e){var t=this.element.innerText.length,i=this.config.characterLimit;if(t+e.length>=i){var n=i-t,s=n>0?n:0;e=e.slice(0,s)}return e}function B(e){var t="";if(efunction(e){return/image\/\w+/.test(e.type)});if(i){var o=i.getAsFile();if(o)return void this.config.onFileAdded.call(this,o)}}n.contains(e.types,"text/html")?t=e.getData("text/html"):(t=e.getData("text/plain"),t=this.dataFilter.filterPlaintext(t,!0)),t=t.replace(new RegExp("</t(d|h)></tr>","g"),"<br></td></tr>"),t=t.replace(/\u00a0/g," "),t=this.dataFilter.filterHTML(t),t=this.dataFilter.convertToBrowserSpaces(t),this.config.characterLimit&&(t=L.call(this,t));var r=document.createElement("div");r.innerHTML=t,this.dataFilter.flattenBlocksDown(r,!0),s(r).find(be.join()).remove();var a=n.some(r.children,function(e){return n.contains(ge,e.nodeName)});if(a){var l=u.getSelection(),c=l.getRangeAt(0);c.deleteContents();var h=W.call(this);if(""===s(h).text().trim()){var d=s(h).index(),p=s(h).parent(),g=d+r.children.length-1;s(h).replaceWith(r.children);var f=s(p).children().eq(g).get(0);c.selectNodeContents(f),c.collapse(!1),l.removeAllRanges(),l.addRange(c)}else this.dataFilter.inlinify(r),H.call(this,r.innerHTML)}else H.call(this,r.innerHTML);this.onChange()}function U(e){s(this.element).html(e)}function z(){return s(this.element).html().trim()}function H(e){if(!e)return void v.warn("Cannot insert empty data");var t=u.getSelection();if(!t||!t.focusNode)return void v.warn("Cannot insert without the editor having a cursor or selection");var i=t.getRangeAt(0);i.deleteContents(),e=this.dataFilter.convertToBrowserSpaces(e);var n=document.createElement("div");n.innerHTML=e;for(var s,o=n.lastChild,r=document.createDocumentFragment();s=n.firstChild;)r.appendChild(s);i.insertNode(r),i.setStartAfter(o),i.collapse(!1),t.removeAllRanges(),t.addRange(i)}function q(){var e=W.call(this);if(!e){var t=s(this.element).children(ge.join());if(!t.length)return null;e=t.last().get(0)}return e}function W(){var e=u.getSelection()||this.lastSelection;return u.getNodeByNames(ge,!0,e)}function G(){var e=q.call(this);if(e){if("div"===e.nodeName.toLowerCase())try{window.document.execCommand("formatBlock",!1,"<p>")}catch(e){}}else U.call(this,de),this.setCursorToStart()}function K(){var e=s(this.element).children(ve.join()).last().get(0);e||s(this.element).append(de)}function Q(e,t,i,o,r){var a=this,l=function(e){var l,c,u,h,d=n.uniqueId(),p=0===e.lastIndexOf("data:",0)?"file":e;a.mediaTracker[d]={originalSource:p,file:t},c=s("<img />",{src:e}),l=c.get(0),h=s("<figure />"),u=h.get(0),c.attr(a.config.imgKeyAttr,d),h.append(c),ee.call(a,u,i,o,r),X.call(a,l,function(i){J.call(a,l,i),a.config.onAsyncImageAdded.call(a,d,e,t,i||{})}),a.onChange()};if(!e&&t)if(der;c.onload=function(e){l(e.target.result)},c.readAsDataURL(t)}else{if("string"!=typeof e)return void a.config.onAsyncImageFailed.call(a);l(e)}}function J(e,t){var i,o={},r=this.config,a=s(e).parent("figure").get(0),l={toImg:e,toImgParent:a};r.addImgAttrs&&(i=n.reduce(l,function(e,t,i){return r.addImgAttrs!==!0&&r.addImgAttrs[i]!==!0||e.push(t),e},[])),n.isEmpty(i)||!r.imgSizeAttrs||n.isEmpty(t)||(r.imgSizeAttrs.height&&(o[r.imgSizeAttrs.height]=t.height),r.imgSizeAttrs.height&&(o[r.imgSizeAttrs.width]=t.width),s(i).attr(o))}function X(e,t){var i=function(e){var i={width:e.naturalWidth,height:e.naturalHeight};n.isFunction(t)&&t.call(this,i)};e.complete?i.call(this,e):s(e).one({"load.getImageAttributes":n.bind(n.partial(i,e),this),error:n.bind(function(){s(e).off(".getImageAttributes"),t.call(this,null)},this)})}function Y(e){return s(this.element).find("img["+this.config.imgKeyAttr+'="'+e+'"]').get(0)}function Z(e,t,i){var o=Y.call(this,e);n.isEmpty(i)||o&&J.call(this,o,i),t&&(s(o).attr("src",t),this.mediaTracker[e].updatedSource=t)}function ee(e,t,i,n){var o;t=t||q.call(this),o=this.dataFilter.isEmptyElement(t.outerHTML,!0)?0:u.isCursorAtStart(t)?-1:1,i="number"==typeof i?i:o;var r=s(e).get(0),a=se.call(this,r);oe.call(this,a),i<0?s(t).before(a):i>0?s(t).after(a):0===i&&s(t).replaceWith(a),k.call(this);var l=s(a).nextAll(ve.join()).get(0);l||(l=s(de).get(0),s(a).after(l)),n||(this.focus(!0),c.setToStart(l)),te.call(this,a,!1,O)}function te(e,t,i){var r=this;t=t||!1,i=i||n.noop;var a=s(e),l=a.find("figure"),c=a.find(".media-button"),u=200;return a.length&&l.length?(t&&c.length&&c.hide(),o(l,{opacity:t?0:[1,0],translateY:t?-25:[0,-25]},{duration:.9*u,easing:"easeOutQuad",complete:function(){l.removeAttr("style")}}),void o(e,t?"slideUp":"slideDn:function(){a.css("pointer-events","none")},complete:function(){a.css("pointer-events",""),i.call(r,e)}})):void i.call(r)}function ie(){var e=this,t=W.call(this);s(t).removeClass(e.config.fakeClass),s(e.element).children("p").each(function(i,n){t!==n&&e.dataFilter.isEmptyElement(n)&&(0===i&&ce.call(e,s(n).next().get(0))||s(n).is(":last-child")&&ce.call(e,s(n).prev().get(0))?ne.call(e,n):ce.call(e,s(n).prev().get(0))&&ce.call(e,s(n).next().get(0))?ne.call(e,n):s(n).hasClass(e.config.fakeClass)&&s(n).remove()),void 0!==s(n).attr("class")&&""===s(n).attr("class").trim()&&s(n).removeAttr("class")}),s(this.element).children("."+this.config.mediaHolderClass).each(function(t,i){var n=s(this).next().get(0);n&&!ce.call(e,n)||s(this).after(ne.call(e));var o=s(this).prev().get(0);o||s(this).before(ne.call(e))})}function ne(e){return e=e||s(de).get(0),s(e).addClass(this.config.fakeClass),e}function se(e){var t=s(e),i=s("<div />",{class:this.config.mediaHolderClass,contentEditable:!1,draggable:!0});t.wrap(i),i=t.parent(),n.isFunction(this.config.mediaHolderCallback)&&this.config.mediaHolderCallback(this,e,t,i);var o=s(this.config.mediaKillerMarkup);o.addClass("media-killer"),i.append(o);var r=!i.hasClass("media-holder-draggable");if(r){var a=s(this.config.mediaMoverMarkup);a.addClass("media-mover"),i.append(a)}return i}function oe(e){var t=this,i=e?s(e):s(this.element).find('[contenteditable="false"]'),n=this.config.mediaHolderEvents;i.each(function(e,i){var o=s(i),r=null;o.off("keydown").on("keydown",function(e){n.keydown.call(null,e,o),e.isPropagationStopped()||(e.keyCode!==ye.delete&&e.keyCode!==ye.backspace||o.remove(),e.preventDefault(),e.st("keyup",function(e){n.keyup.call(null,e,o)}),o.on("mousedown",function(e){r=e.originalEvent.target,n.mousedown.call(null,e,o,r)}),o.on("mouseup",function(e){n.mouseup.call(null,e,o,r);var i=s(r);i.hasClass("media-killer")&&r===e.target&&te.call(t,o,!0,function(){o.remove(),x.call(t),O.call(t),t.onChange()})}),o.on("mouseenter",function(e){s(e.currentTarget).addClass("show-controls"),n.mouseenter.call(null,e,o,r)}),o.on("mouseleave",function(e){s(e.currentTarget).removeClass("show-controls"),n.mouseleave.call(null,e,o,r)}),o.on("dragstart",function(e){var t=s(r);t.hasClass("media-killer")&&(e.preventDefault(),e.stopPropagation()),o.hasClass("media-holder-draggable")||t.hasClass("media-mover")||(e.preventDefault(),e.stopPropagation()),n.dragstart.call(null,e,o,r)})})}function re(e){n.each(s(e).find("."+this.config.mediaHolderClass),function(e){s(e).find(".media-killer, .media-mover").remove();var t=s(e).children().first();t.length?s(t).unwrap():(s(e).contents().wrap("<div>"),s(e).children().first().unwrap().contents().unwrap())})}function ae(e){var t=this,i=s(e).find("."+this.config.fakeClass+", ."+this.config.fakeClass+"-intent");n.each(i,function(e){t.dataFilter.isEmptyElement(e)&&s(e).remove()})}function le(){var e=this;n.each(s(this.element).find(be.join()),funcunction(e){return n.contains(be,e.nodeName)});ue.call(e,t)||s||se.call(e,t)})}function ce(e){return s(e).hasClass(this.config.mediaHolderClass)}function ue(e){var t=s(e).closest("[class="+this.config.mediaHolderClass+"]");return t.length?t.get(0):null}function he(e,t,i){var o,r;return t=!!n.isBoolean(t)&&t,e=e||q.call(this),o=s(e)[t?"prev":"next"](),!i&&o.length>0&&this.dataFilter.isEmptyElement(o)?(c.setToStart(o.get(0)),o):(r=s(de).get(0),s(e)[t?"before":"after"](r),c.setToStart(r),r)}var de="<p><br></p>",pe="<p></p>",ge=["P","FIGURE","H2","BLOCKQUOTE","UL","OL","DIV","PRE"],fe=["H2","BLOCKQUOTE","PRE"],_e=["PRE"],me=["UL","OL"],ve=["P","H2","BLOCKQUOTE","UL","OL","PRE"],be=["IMG","IFRAME","FIGURE","HR"],ye={shift:16,enter:13,esc:27,backspace:8,delete:46,tab:9,right:39,metaLeft:91,metaRight:93,leftArrow:37,rightArrow:38,upArrow:39,downArrow:40},we=function(i,o){if(!i)throw new Error("A valid element parameter is required to initalize the editor");o=o||{},this.element=i,this.humanKeys=new _,this.keyComboEvents=o.keyComboEvents||new f({element:this.element,humanKeys:this.humanKeys});var d=n.template("<%= title %> (<%= shortcut %>)"),m=n.bind(function(e,t){return d({title:e,shortcut:this.humanKeys.pretty(t)})},this);this.config={labels:{},
placeholder:!1,characterLimit:null,onChange:n.noopn(e){},onAsyncImageAdded:function(e,t,i,n){},onAsyncImageFailed:function(){v.warn("Unknown sourceg an image.")},onFileAdded:function(e,t,i){},onClientEvent:function(e){},flattenBlocks:!0,smartQuotes:{enabled:!1,config:{}},runIFrameSanitization:!1,mediaHolderClass:"media-holder",mediaHolderCallback:function(e,t,i,s){i.is("hr, img, figure")&&n.isEmpty(i.find("iframe"))&&s.addClass("media-holder-draggable"),s.addClass("media-holder-"+i.prop("tagName").toLowerCase())},mediaHolderEvents:{keydown:n.noop,keyup:n.noop,mousedown:n.noop,mouseup:n.noop,mouseenter:n.noop,mouseleave:n.noop,click:n.noop,dragstart:n.noop},imgKeyAttr:"data-img-key",imgSizeAttrs:{width:"data-orig-width",height:"data-orig-height"},addImgAttrs:{toImg:!1,toImgParent:!1},fakeClass:"fake",mediaKillerMarkup:"<div>Ã—</div>",me597;</div>",pasteHook:function(e,t){return!1},blurHook:function(e){return!1},documentMousedownHook:function(e){return!1},filterForSetData:function(e){return e},filterForGetData:function(e){return e},filterRules:{elements:["a","b","i","ul","ol","li","p","h2","blockquote","img","iframe","figure","br","hr","pre","sub","sup","small"],attributes:{a:["href","title"],img:["src","alt","data-orig-width","data-orig-height"],hr:["data-label"],iframe:["src","width","height","frameborder"],figure:["data-orig-width","data-orig-height"]},classnames:{hr:["read-more"]},remove_contents:["style","noscript","script","meta"],protocols:{a:{href:["http","https","mailto"]}}},animateShowControls:function(e){e.element.show()},animateHideControls:function(e){e.element.hide()},linkConfonChange:function(){this.onChange.call(this)},onDismiss:function(){this.lastSelection&&(c.restoreSelection(this.lastSelection),O.call(this))}},inlineControlsConfig:{openTray:h.prototype.openTray,closeTray:h.prototype.closeTray,onTrayOpened:function(e){},onTrayClosed:function(e){},keyboardEvents:this.keyComboEvents},formattingControlsConfig:{controls:{bold:{el:"b",className:"bold",command:"bold",type:"inline",title:m("Bold","meta+b"),keyboard:"meta+b"},italic:{el:"i",className:"italic",command:"italic",type:"inline",title:m("Italic","meta+i"),keyboard:"meta+i"},headline:{el:"h2",className:"headline",command:"formatBlock",type:"block",title:m("Headline","meta+shift+2"),keyboard:"meta+shift+2"},link:{el:"a",className:"link",command:"createLink",type:"inline",title:m("Link","meta+k"),keyboard:"meta+k"},strikethrough:{el:"strike",className:"strikethrough",command:"strikethrough",type:"inline",title:m("Strikethrough","meta+shift+6"),keyboard:"meta+shift+6"},orderedList:{el:"ol",className:"ordered-list",command:"insertOrderedList",type:"list",title:m("Ordered List","meta+shift+7"),keyboard:"meta+shift+7"},unorderedList:{el:"ul",className:"unordered-list",command:"insertUnorderedList",type:"list",title:m("Unordered List","meta+shift+8"),keyboard:"meta+shift+8"},blockquote:{el:"blockquote",className:"quote",command:"formatBlock",type:"block",title:m("Blockquote","meta+shift+9"),keyboard:"meta+shift+9"},clear:{el:"",command:"removeFormat",type:"inline",keyboard:"meta+shift+0"},pre:{el:"pre",command:"formatBlock",type:"block",keyboard:"meta+alt+1"},superscript:{el:"sup",command:"superscript",type:"inline",keyboard:"meta+dot"},subscript:{el:"sub",command:"subscript",type:"inline",keyboard:"meta+comma"},small:{el:"small",command:"insertHTML",type:"inline",keyboard:"meta+shift+minus",keyboardInverse:"meta+shift+plus"}},controlsOrder:["bold","italic","headline","link","strikethrough","orderedList","unorderedList","blockquote"],onShow:function(e){n.isFunction(this.animateShowControls)?this.animateShowControls.call(this,e):e.element.show()},onHide:function(e){n.isFunction(this.animateHideControls)?this.animateHideConion(e){var t=u.getNodeList();e.setActives(t)}},showStaticControls:!0},n.merge(this.config,o||{}),this.applyCommand=n.bind(P,this),this.inverseCommand=n.bind(I,this),this.animateShowControls=n.bind(this.config.animateShowControls,this),this.animateHideControls=n.bind(this.config.animateHideControls,this),this.onChange=function(e){var t=z.call(this);this.previousRawData!==t&&($.call(this),this.config.onChange.call(this),this.previousRawData=t)};var b=e(this.config.linkConfig,this);this.linkControl=new r(b);var y=e(this.config.inlineControlsConfig,this);this.inlineControls=new h(y);var w=e(n.defaults({keyboardEvents:this.keyComboEvents},this.config.formattingControlsConfig),this);this.contextualControls=new a(this.applyCommand,this.inverseCommand,w);var C=this.config.formattingControlsConfig.onShow,k=this.config.formattingControlsConfig.onHide,x=e(n.defaults({onShow:function(e){C.apply(this,arguments),e.listener=e.listener||function(t){var i=u.getNodeList();e.setActives(i),document.removeEventListener("mousedown",e.listener,!1)},document.addEventListener("mousedown",e.listener)},onHide:function(e){k.apply(this,arguments),document.removeEventListener("mousedown",e.listener,!1)}},this.config.formattingControlsConfig),this);this.staticControls=new a(this.applyCommand,this.inverseCommand,x),this.dataFilter=new l(this.config.filterRules),this.keyModifiers={shift:!1,meta:!1},this.undoManager=new p(this,n.bind(function(){for(var e in this.mediaTracker){var t=this.mediaTracker[e].updatedSource;if(t){var i=Y.call(this,e);s(i).attr("src",t)}}V.call(this)},this)),this.config.smartQuotes.enabled&&(this.smartQuoter=new g(this,this.config.smartQuotes.config)),this.mediaTracker={},t.call(this)};return we.prototype.getData=function(e,t){var i=this,o=z.call(this);o=this.config.filterForGetData.call(this,o),this.config.runIFrameSanitization&&(o=this.dataFilter.unSanitizeIFrames(o));var r=document.createElement("div");if(r.innerHTML=o,re.call(this,r),ae.call(this,r),t||s(r).find("["+i.config.imgKeyAttr+"]").removeAttr(i.config.imgKeyAttr),e)for(var a=function(e){var t=s(r).children(":"+e+"-child").get(0);return tn(){return n.compact([a("fgth;)n.forEach(l(),function(e){s(e).remove()});return r.innerHTML},we.prototype.setData=function(e,t,i){t&&(e=this.config.filterForSetData.call(this,e),e=this.dataFilter.filterHTML(e)),this.config.runIFrameSanitization&&(e=this.dataFilter.sanitizeIFrames(e)),U.call(this,e),i?this.dataFilter.flattenBlocksDown(this.element):this.dataFilter.blockifyInlineNodes(this.element),G.call(this),le.call(this),oe.call(this),K.call(this),this.onChange()},we.prototype.insertData=function(e,t,i){t&&(e=this.dataFilter.filterHTML(e)),H.call(this,e),i&&this.dataFilter.flattenBlocksDown(u.getNearestElement()),this.onChange()},we.prototype.blur=function(e){return e||k.call(this),s(this.element).blur()},we.prototype.focus=function(e){var t=s(this.element).focus();return e||tnction(){return s(this.elemeon(e){this.config.placeholder=e,$.call(this)},we.prototype.insertMedia=function(e,t,i,n){t&&(e=this.dataFilter.filterHTML(e)),ee.call(this,e,i,n),this.onChange()},we.prototype.addControl=function(e){var t=s(this.wrapper).find("[data-js=control-bar]");t.append(e)},we.prototype.isEmpty=function(){var e=z.call(this);return""===e||"<br>"===e||ement=function(){return u.geAsyncImage=function(e){return Y.call(this,e)},we.prototype.insertAsyncImage=function(e,t,i,n,s){Q.call(this,e,t,i,n,s),this.onChange()},we.prototype.updateAsyncImage=function(e,t,i){Z.call(this,e,t,i),this.onChange("updateAsyncImage")},we.prototype.setCursorToStart=function(e,t){var i=s(this.element);e=e&&i.find(e).first().get(0)||i.children().first().get(0),e&&c.setToStart(e),t||O.call(this)},we.prototype.setCursorToEnd=function(e,t){var i=s(this.element);e=e&&i.find(e).last().get(0)||i.children().last().get(0),e&&c.setToEnd(e),t||O.call(this)},we.prototype.insertNewParagraphAfter=function(e,t){return he.call(this,e,!1,t)},we.prototype.insertNewParagraphBefore=function(e,t){return he.call(this,e,!0,t)},we.prototype.isEmptyElement=function(e){return e=e||q.call(this),this.dataFilter.isEmptyElement(e)},we.prototype.hasSelection=function(e){return e=e||q.call(this),u.hasSelection(e)},we.prototype.isCursorAtEnd=function(e){return e=e||q.call(this),u.isCursorAtEnd(e)},we.prototype.isCursorAtStart=function(e){return e=e||q.call(this),u.isCursorAtStart(e)},we.prototype.teardown=function(){this.undoManager.teardown(),this.keyComboEvents.off()},we}();e.exports=b},function(e,t){/*! VelocityJS.org (1.4.3). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License */
/*! VelocityJS.org jQuery Shim (1.0.1). (C) 2014 The jQuery Foundation. MIT @license: en.wikipedia.org/w||0===t||"number"==ar i=functi.isWindypeof e?s[r.call(e)]||"obArray||function(1}for(t in e);return void 0===t||o.call(e,t)},i.each=function(e,i,n){var s,o=0,r=e.length,a=t(e);if(n){if(a)for(;o<r&&(s=i.apply(e[o],n),s!==!1);o++);else for(o in e)if(e.hasOwnProperty(o)&&(s=i.apply(e[o],n),s===!1))break}else if(a)for(;o<r&&(s=i.call(e[o],o,e[o]),s!==!1);o++);else for(o in e)if(e.hasOwnProperty(o)&&(s=i.cal=++i.uuid);reh(t,functtend(u,r,n)):void 0!==n&&(a[s]=n)));return a},i.queue=function(e,n,s){functio 0!==t[n];)e[s++]=t[n++];return e.length=s,e}(n,"string"==typeof e?[e]:e):[].push.call(n,e)),n}if(e){n=(n||"fx")+"queue";var r=i.data(e,n);return s?(!r||i.isArray(s)?r=i.ss"),o.call(n,function(0]=e,thent.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function e(e){for(var t=e.offsetParent;t&&"html"!==t.nodeName.toLowerCase()&&t.style&&"static"===t.style.position;)t=t.offsetParent;return t||document}var t=this[0],n=e(t),s=this.offset(),o=/^(?:body|html)$/i.test(n.nodeName)?{top:0,left:0}:i(n).offset();return s.top-=parseFloat(t.style.marginTop)||0,s.left-=parseFloat(t.style.marginLeft)||0,n.style&&(o.top+=parseFloat(n.style.borderTopWidth)||0,o.left+=parseFloat(n.style.borderLeftWidth)||0),{top:s.top-o.top,left:s.left-o.left}}};var n={};i.expando="velocity"+(new Date).getTime(),i.uuid=0;for(var s={},o=s.hasOwnProperty,r=s.toString,a="Boolean Number String Function Array Date RegExp Object Error".split(" "),l=0;l<a.length;l++)s["[object "+a[l]+"]"]=a[l].toLowerCase();i.fn.init.proton"==typeof define&&define.amd?define(t):t()}(funnction(t){retut,i){return 3*o(t,i)*e*e+2*r(t,i)*e+a(t)}function u(t,i){for(var s=0;s<f;++s){var o=c(i,e,n);if(0=,i+y)}function g(){x=!0,e===i&&n===s||h()}var f=4,_=.001,m=1e-7,v=10,b=11,y=1/(b-1),w="Float32Array"in t;if(4!==arguments.length)return!1;for(var C=0;C<4;++C)if("number"!=typeof arguments[C]||isNaN(arguments[C])||!isFinite(arguments[C]))return!1;e=Math.min(e,1),n=Math.min(n,1),e=Math.max(e,0),n=Math.max(n,0);va),e===i&&n===s?t:0=oints=function(){return[{x:e,y:i},{x:n,y:s}]};var T="generateBezier("+[e,i,n,s]),u,_),1===w&&p(o)}}k.State.isTicking&&E(d)}function p(e,t){if(!k.State.calls[e])return!1;for(var i=k.State.calls[e][0],s=k.State.calls[e][1],o=k.State.calls[e][2],a=k.State.calls[e][4],l=!1,c=0,u=i.length;c<u;c++){var h=i[c].element;t||o.loop||("none"===o.display&&S.setPropertyValue(h,"display",o.display),"hidden"===o.visibility&&S.setPropertyValue(h,"visibility",o.visibility));var d=r(h);if(o.loop!==!0&&(g.queue(h)[1]===n||!/\.velocityQueueEntryFlag/i.test(g.queue(h)[1]))&&d){d.isAnimating=!1,d.rootPropertyValue).test(s)&&(p=!0,delete d.transformCache[t])}),o.mobileHA&&(p=!0,delete d.transformCache.translate3d),p&&S.flushTransformCache(h),S.Values.removeClass(h,"velocity-animating")}if(!t&&o.complete&&!o.loop&&c===u-1)try{o.complete.call(s,s)}catch(e){setTimeout(function(){throw e},1)}a&&o.loop!==!0&&a(s),=t.unitType&&(t.endValue=0,t.startValue=100)}),k(h,"reverse",{loop:!0,delay:o.delay})),o.queue!==!1&&g.dequeue(h,o.queue)}k.State.calls[e]=!1;for(var f=0,_=k.State.calls.length;f<_;f++)if(k.State.calls[f]!==!1){l=!0;break}l===!1&&(k.State.isTicking=!1,dName-e)),e=n+i,setTimeout(function(){t(n+i)},i)}}(),m=function(){var e=t.performance||{};if(!Object.prototype.hasOwnProperty.call(e,"now")){var i=e.timing&&e.timing.domComplete?e..now=function(){return(new Date).getTime()-i}}return e}(),v=function(){var e=Array.prototype.slice;try{e.call(i.documentElement)}catch(t){e=function(){for(var e=this.length,t=[];--e>0;)t[e]=this[e];return t}}return e}(),b={isNumber:fsString:function(e){return"string"==typeof e},isArray:Array.isArray||function(e){return"[object Array]"===nction](e)},isNode:function(e){return e&&e.nodeType},isWrapped:function(e){return e&&b.isNumber(e.length)&&!b.isString(e)&&!b.isFunction(e)&&!b.isNturn t.SVGElemn e)if(e.hasOwnProperty(t))return!1;return!0}},y=!1;if(e.fn&&e.fn.jquery?(g=e,y=!0):g=t.Velocity.Utilities,f<=8&&!y)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(f<=7)return void(jQuery.fn.velocity=jQuery.fn.animate);var w=400,C="swing",k={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:t.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:i.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[],delayedElements:{count:0}},CSS:{},Utilities:g,Redirects:{},Easings:{},Promise:t.Promise,defaults:{queue:"",duration:w,easing:C,begin:n,complete:n,progress:n,display:n,visibility:n,loop:!1,delay:!1,mobileHA:!ootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,mite.delayedte.delayedElements,function(e,i){i&&l(i,t)})}};t.pageYOffset!==n?(k.State.scrollAnchor=t,k.State.scrollPropertyLeft="pageXOffset",k.State.scrollPropertyTop="pageYOffset"):(k.State.scrollAnchor=i.documentElement||i.body.parentNode||i.body,k.State.scrollPropertyLeft="scrollLeft"o?function(e){return c[e*(c.length-1)|0]}:u}}();g:functurn 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)}},g.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.1tion(e,t){k.Easings[t[0]]=u.apply(null,t[1])});var S=k.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"],units:["%","em","ex","ch","rem","vw","vh","vmin","vmax","cm","mm","Q","in","pc","pt","px","deg","grad","rad","turn","s","ms"],colorNames:{aliceblue:"240,248,255",antiquewhite:"250,235,215",aquamarine:"127,255,212",aqua:"0,255,255",azure:"240,255,255",beige:"245,245,220",bisque:"255,228,196",black:"0,0,0",blanchedalmond:"255,235,205",blueviolet:"138,43,226",blue:"0,0,255",brown:"165,42,42",burlywood:"222,184,135",cadetblue:"95,158,160",chartreuse:"127,255,0",chocolate:"210,105,30",coral:"255,127,80",cornflowerblue:"100,149,237",cornsilk:"255,248,220",crimson:"220,20,60",cyan:"0,255,255",darkblue:"0,0,139",darkcyan:"0,139,139",darkgoldenrod:"184,134,11",darkgray:"169,169,169",darkgrey:"169,169,169",darkgreen:"0,100,0",darkkhaki:"189,183,107",darkmagenta:"139,0,139",darkolivegreen:"85,107,47",darkorange:"255,140,0",darkorchid:"153,50,204",darkred:"139,0,0",darksalmon:"233,150,122",darkseagreen:"143,188,143",darkslateblue:"72,61,139",darkslategray:"47,79,79",darkturquoise:"0,206,209",darkviolet:"148,0,211",deeppink:"255,20,147",deepskyblue:"0,191,255",dimgray:"105,105,105",dimgrey:"105,105,105",dodgerblue:"30,144,255",firebrick:"178,34,34",floralwhite:"255,250,240",forestgreen:"34,139,34",fuchsia:"255,0,255",gainsboro:"220,220,220",ghostwhite:"248,248,255",gold:"255,215,0",goldenrod:"218,165,32",gray:"128,128,128",grey:"128,128,128",greenyellow:"173,255,47",green:"0,128,0",honeydew:"240,255,240",hotpink:"255,105,180",indianred:"205,92,92",indigo:"75,0,130",ivory:"255,255,240",khaki:"240,230,140",lavenderblush:"255,240,245",lavender:"230,230,250",lawngreen:"124,252,0",lemonchiffon:"255,250,205",lightblue:"173,216,230",lightcoral:"240,128,128",lightcyan:"224,255,255",lightgoldenrodyellow:"250,250,210",lightgray:"211,211,211",lightgrey:"211,211,211",lightgreen:"144,238,144",lightpink:"255,182,193",lightsalmon:"255,160,122",lightseagreen:"32,178,170",lightskyblue:"135,206,250",lightslategray:"119,136,153",lightsteelblue:"176,196,222",lightyellow:"255,255,224",limegreen:"50,205,50",lime:"0,255,0",linen:"250,240,230",magenta:"255,0,255",maroon:"128,0,0",mediumaquamarine:"102,205,170",mediumblue:"0,0,205",mediumorchid:"186,85,211",mediumpurple:"147,112,219",mediumseagreen:"60,179,113",mediumslateblue:"123,104,238",mediumspringgreen:"0,250,154",mediumturquoise:"72,209,204",mediumvioletred:"199,21,133",midnightblue:"25,25,112",mintcream:"245,255,250",mistyrose:"255,228,225",moccasin:"255,228,181",navajowhite:"255,222,173",navy:"0,0,128",oldlace:"253,245,230",olivedrab:"107,142,35",olive:"128,128,0",orangered:"255,69,0",orange:"255,165,0",orchid:"218,112,214",palegoldenrod:"238,232,170",palegreen:"152,251,152",paleturquoise:"175,238,238",palevioletred:"219,112,147",papayawhip:"255,239,213",peachpuff:"255,218,185",peru:"205,133,63",pink:"255,192,203",plum:"221,160,221",powderblue:"176,224,230",purple:"128,0,128",red:"255,0,0",rosybrown:"188,143,143",royalblue:"65,105,225",saddlebrown:"139,69,19",salmon:"250,128,114",sandybrown:"244,164,96",seagreen:"46,139,87",seashell:"255,245,238",sienna:"160,82,45",silver:"192,192,192",skyblue:"135,206,235",slateblue:"106,90,205",slategray:"112,128,144",snow:"255,250,250",springgreen:"0,255,127",steelblue:"70,130,180",tan:"210,180,140",teal:"0,128,128",thistle:"216,191,216",tomato:"255,99,71",turquoise:"64,224,208",violet:"238,130,238",wheat:"245,222,179",whitesmoke:"245,245,245",white:"255,255,255",yellowgreen:"154,205,50",yellow:"255,255,0"}},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrir a=i+s[{var t=S.Hooks.registered[e];return t?t[0]:e},getUnit:function(e,t){var i=(e.substr(t||0,5).match(/^[a-z%]+/)||[])[0]||"";return i(")+S.Lists.colorNames[SNullValue(t)ring().matchEx.valueSplit),s[a]=t,o=s.join(" "," ")":returnase"extract":return i;case"inject":return i}}},register:function(){function e(e,t,i){var n="border-box"===S.getPropertyValue(t,"boxSizing").toString().toLowerCase();if(n===(i||!1)){var s,o,r=0,a="width"===e?["Left","Right"]:["Top","Bottom"],l=["padding"+a[0],"padding"+a[1],"border"+a[0]+"Width","border"+a[1]+"Width"];for(s=0;s<l.length;s++)o=parseFloat(S.getPropertyValue(t,linject":return parseFloat(o)-e(t,s,i)+"px"}}}f&&!(f>9)||k.State.isGingerbread||(S.Lists.transformsBase=S.Lists.transformsBase.concat(S.Lists.transforms3D));forCache[e]="("+s+")"),r(i).transformCache[e]}s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")")}}}();S.Normalizations.registered.innerWidth=t("width",!0),S.Normalizations.registered.innerHeight=t("height",!0),S.Normalizations.registered.outerWidth=t("width"),S.Normalizations.register\w)/g,functionsform"),newState.prefixMatcheparseInt(t[2],1nsparent|(rgty|red|green|bl(tbody)$/||"";e.setAt+t.split(" ").join),k.debug>=2&&conole.log("Set "+i+" ("+a+"): "+n)}return[a,n]},flushTransformCache:function(e){var t="",i=r(e);if((f||k.State.isA){return parseFloat(S.getPropertyValue(e,t))},s={translate:[n("translateX"),n("translateY")],skewX:[n("skewX")],skewY:[n("skewY")],scale:1!==n("scale")?[n("scale"),n("scale")]:[n("scaleX"),n("scaleY")],rotate:[&&(t+=e+"("+s[e].join(" ")+") ",delete s[rotateZ"===i&&(i="rotate"),void(t+=i+o+" "))}),a&&(t="perspective"+a+" "+t)}S.setPropertyValue(e,"transform",t)}};S.Hooks.=a[0]&&k.CSS.fluson(){function e(){return u?x.promise||null:f}function s(e,s){function o(o){var u,p;if(l.begin&&0=(m,m)}catch(e){setTimeout(function(){throw e},1)}if("scroll"===A){var f,_,w,C=/^x$/i.test(l.axis)?"Left":"Top",T=parseFloat(l.offset)||0;l.container?b.isWrapped(l.container)||b.isNode(l.container)?(l.container=l.container[0]||l.container,f=l.container["scroll"+C],w=f+g(e).position()[C.toLowerCase()]+T):l.container=null:(f=k.State.scrollAnchor[k.State["scrollProperty"+C]],_=k.State.scrollAnchor[k.State["scrollProperty"+("Left"===C?"Top":"Left")]],w=g(e).offset()[C.toLowerCase()]+T),c={scroll:{rootPropertyValue:!1,startValue:f,currentValue:f,endValue:w,unitType:"",easing:l.easing,scrollData:{container:l.container,direction:C,alternateValue:_}},element:e},k.debug&&console.log("tweensContainer (scroll): ",c.scroll,e)}else if("reverse"===A){if(u=r(e),!u)return;if(!u.tweensContainer)return void g.dequeue(e,l.queue);"none"===u.opts.display&&(u.opts.display="auto"),"hidden"===u.opts.visibility&&(u.opts.visibility="visible"),u.opts.loop=!1,u.opts.begin=null,u.opts.complete=null,y.easing||delete l.easing,y.duration||delete l.duration,l=g.extend({},u.opts,l),p=g.extend(!0,{},u?u.tweensContainer:null);for(var I in p)if(p.hasOwnProperty(I)&&"element"!==I){var F=p[I].startValue;p[I].startValue=p[I].currentValue=p[I].endValue,p[I].endValue=F,b.isEmptyObject(y)||(p[I].easing=l.easing),k.debug&&console.log("reverse tweensContainer ("+I+"): "+JSON.stringify(p[I]),e)}c=p}else if("start"===A){u=r(e),u&&u.tweensContainer&&u..isFunction(r)&&(r=r.call(e,s,E)),[n||0,o,r]},N=function(s,o){var r,h=S.Hooks.getRoot(s),d=!1,f=o[0],_=o[1],m=o[2];if(!(u&&u.isSVG||"tween"===h||S.Names.prefixCheck(h)[1]!==!1||S.Normalizations.registered[h]!==n))return void(k.debug&&console.log("Skipping ["+h+"] due to a lack of browser support."));
(l.display!==n&&null!==l.display&&"none"!==l.display||l.visibility!==n&&"hidden"!==l.visibility)&&/opacity|filter/.test(s)&&!m&&0!==f&&(m=0),l._cacheValues&&p&&p[s]?(m===n&&(m=p[s].endValue+p[s].unitType),d=u.rootPropertyValueCache[h]):S.Hooks.registered[s]?m===n?(d=S.getPropertyValue(e,h),m=S.getPropertyValue(e,s,d)):d=S.Hooks.templates[h][1]:m===n&=e,""}),i||(i=S.Values.getUnitType(e)),[n,i]};if(m!==f&&b.isString(m)&&b.isString(f)){r="";var T=0,E=0,P=[],I=[],F=0,A=0,M=0;for(m=S.Hooks.fixColors(m),f=S.Hooks.fixColors(f);T<m.length&&E<f.length;){var N=m[T],R=f[E];if(/[\d\.-]/.test(N)&&/[\d\.-]/.test(R)){for(var O=N,j=R,V=".",$=".";++T<m.length;){if(N=m[T],N===V)V="..";else if(!/\d/.test(N))break;O+=N}for(;++E<f.length;){if(R=f[E],R===$)$="..";else if(!/\d/.test(R))break;j+=R}var L=S.Hooks.getUnit(m,T),B=S.Hooks.getUnit(f,E);if(T+=L.length,E+=B.length,L===B)O===j?r+=O+L:(r+="{"+P.length+(A?"!":"")+"}"+L,P.push(parseFloat(O)),I.push(parseFloat(j)));else{var U=parseFloat(O),z=parseFloat(j);r+=(F<5?"calc":"")+"("+(U?"{"+P.length+(A?"!":"")+"}":"0")+L+" + "+(z?"{"+(P.length+(U?1:0))+(A?"!":"")+"}":"0")+B+")",U&&(P.push(U),I.push(0)),z&&(P.push(0),I.push(z))}}else{if(N!==R){F=0;break}r+=N,T++,E++,0===F&&"c"===N||1===F&&"a"===N||2===F&&"l"===N||3===F&&"c"===N||F>=4&&"("===N?F++:(F&&F<5||F>=4&&")"===N&&--F<5)&&(F=0),0===A&&"r"===N||1===A&&"g"===N||2===A&&"b"===N||3===A&&"a"===N||A>=3&&"("===N?(3===A&&"a"===N&&(M=1),A++):M&&","===N?++M>3&&(A=M=0):(M&&A<(M?5:4)||A>=(M?4:3)&&")"===N&&--A<(M?5:4))&&(A=M=0)}}T===m.length&&E===f.length||(k.debug&&console.error('Trying to pattern match mis-matched strings ["'+f+'", "'+m+'"]'),r=n),r&&(P.length?(k.debug&&console.log('Pattern found "'+r+'" -> ',P,I,"["+m+","+f+"]"),m=P,f=I,y=w=""):r=n)}r||(v=x(s,m),m=v[0]ce(/^([+-\/*])=/,function(e,t){return C=t,""}),y=v[1],m=parseFloat(m)||0,f=parseFloat(f)||0,"%"===y&&(/^(fontSize|lineHeight)$/.test(s)?(f/=100,y="em"):/^scale/.test(s)?(f/=100,y=""):/(Red|Greene.log("Unit ratios: "+JSON.stringify(a),e),a};if(/[\/*]/.test(C))y=w;else if(w!==y&&0!==m)if(0===f)y=w;else{a=a||H();var q=/margin|padding|left|right|width|text|word|letter/i.test(s)||/X$/.test(s)||"x"===s?"x":"y";switch(w){case"%":m*="x"===q?a.percentToPxWidth:a.percentToPxHeight;break;case"px":break;default:m*=a[w+"ToPx"]}switch(y){case"%":m*=1/("x"===q?a.percentToPxWidth:a.percentToPxHeight);break;case"px":break;default:m*=1/a[y+"ToPx"]}}switch(C){case"+":f=m+f;break;case"-":f=m-f;break;case"*":f*=m;break;case"/":f=m/f}c[s]={rootPropertyValue:d,startValue:m,currentValue:m,endValue:f,unitType:y,easing:_},r&&(c[s].pattern=r),k.debug&&console.log("tweensContainer ("+s+"): "+JSON.stringify(c[s]),e)};for(var R in v)if(v.hasOwnProperty(R)){var O=S.Names.camelCase(R),j=M(v[R]);if(S.Lists.colors.indexOf(O)>=0){var $=j[0],L=j[1],B=j[2];if(S.RegEx.isHex.test($)){for(var U=["Red","Green","Blue"],z=S.Values.hexToRgb($),H=B?S.Values.hexToRgb(B):n,q=0;q<U.length;q++){var W=[z[q]];L&&W.push(L),H!==n&&W.push(H[q]),N(O+U[q],W)}continue}}N(O,j)}c.element=e}c.element&&(S.Values.addClass(e,"velocity-animating"),V.push(c),u=r(e),u&&(""===l.queue&&(u.tweensContainer=c,u.opts=l),u.isAnimating=!0),P===E-1?(k.State.calls.push([V,m,l,null,x.resolver,null,0]),k.State.isTicking===!1&&(k.State.isTicking=!0,d())):P++)}var a,l=g.extend({},k.defaults,y),c={};switch(r(e)===n&&k.init(e),parseFlut:setTimeout(t,parseFloat(l.delay)),next:n}}),l.duration.toString().toLowerCase()){case"fast":l.duration=200;break;case"normal":l.duration=w;break;case"slow":l.duration=600;break;default:l.duration=parseFloat(l.duration)||1}if(k.mock!==!1&&(k.mock===!0?l.duration=l.delay=1:(l.duration*=parseFloat(k.mock)||1,l.delay*=parseFloat(k.mock)||1)),l.easing=h(l.easing,l.duration),l.begin&&!b.isFunction(l.begin)&&(l.begin=null),l.progress&&!b.isFunction(l.progress)&&(l.progress=null),l.complete&&!b.isFunction(l.complete)&&(l.complete=null),l.display!==n&&null!==l.display&&(l.display=l.display.toString().toLowerCase(),"auto"===l.display&&(l.display=k.CSS.Values.getDisplayType(e))),l.visibility!==n&&null!==l.visibility&&(l.visibility=l.visibility.toString().toLowerCase()),l.mobileHA=l.mobileHA&&k.State.isMobile&&!k.State.isGingerbread,l.queue===!1)if(l.delay){var u=k.State.delayedElemenunction(){k.State.delayedElements[e]=!1,o()}}(u);r(e).delayBegin=(new Date).getTime(),r(e).delay=parseFloat(l.delay),r(e).delayTimer={setTimeout:setTimeout(o,parseFloat(l.de,!0):(k.velocityQueueEntryFlag=!0,void o(e))});""!==l.queue&&"fx"!==l.queue||"inprogress"===g.queue(e)[0]||g.dequeue(e)}var c,u,f,_,m,v,y,C=arguments[0]&&(arguments[0].p||g.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||b.isString(arguments[0].properties));b.isWrapped(this)?(u=!1,_=0,m=this,f=this):(u=!0,_=1,m=C?arguments[0].elements||arguments[0].e:arguments[0]);var x={promise:null,resolver:null,rejecter:numise(function(e,t){x.resolver=e,x.rejecter=t})),C?(v=arguments[0].properties||arguments[0].p,y=arguments[0].options||arguments[0].o):(v=arguments[_],y=arguments[_+1]),m=o(m),!m)return void(x.promise&&(v&&y&&y.promiseRejectEmpty===!1?x.resolver():x.rejecter()));var E=m.length,P=0;if(!/^(stop|finish|finishAll|pause|resume)$/i.test(v)&&!g.isPlainObject(y)){var I=_+1;y={};for(var F=I;F<arguments.length;F++)b.isArray(arguments[F])||!/^(fast|normal|slow)$/i.test(arguments[F])&&!/^\d/.test(arguments[F])?b.isString(arguments[F])||b.isArray(arguments[F])?y.easing=arguments[F]:b.isFunction(arguments[F])&&(y.complete=arguments[F]):y.duration=arguments[F]}var A;switch(v){case"scroll":A="scroll";break;case"reverse":A="reverse";break;case"pause":var M=(new Date).getTime();return g.each(urn t[5]={resume:!1},i=!0,!1}),!i&resume":return g.each(turn t[5].resume=!0,i=!0,!1}),!i&&void 0))})}),e();cas(t)&&t()}),g.queue(t,b.isString(y)?y:"",[]))});var N=[];return g.each(k.State.calls,function(e,t){t&&g.each(t[1],function(i,s){var o=y===n?"":y;return o!==!0&&t[2].queueish"!==v&&"finishAll"!==v||,"stop"===v&&(g.each(N,function(e,t){p(t,!0)}),x.promise&&x.resolver(m)),e();default:if(!g.isPlainObject(v)||b.isEmptyObject(v)){if(b.isString(v)&&k.Redirects[v]){c=g.extend({},y);var R=c.duration,O=c.delay||0;return c.backwards==rects[v].call(t,t,c||{},e,E,m,x.promise?x:n)}),e()}var j="Velocity: First argument ("+v+") was not a property map, a known action, or a registered redirect. Aborting.";return x.promise?x.rejecter(new Error(j)):console.log(j),e()}A="start"}var D={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToP];g.each(m,function(e,t){b.isNode(t)&&s(t,e)}),c=g.extend({},k.defaults,y),c.loop=parseInt(c.loop,10);var $=2*c.loop-1;if(c.loop)for(var L=0;L<$;L++){var B={delay:c.delay,progress:c.progress};L===$-1&&(B.display=c.display,B.visibility=c.visibility,B.complete=c.complete),T(m,"reverse",B)}return e()};k=g.extend(T,k),k.animate=T;var E=t.requestAnimationFrame(!0)},16)},d()):E=t.requestAnimationFrame||_};P(),i.addEventListener("visibilitychange",P)}return e.Velocity=k,e!==t&&(e.fn.velocity=T,e.fn.veloc(u&&u.call(r,r),a&&a.resolver(r))},k(e,d,l)}}),g.each(["In","Out"],function(e,t){k.Redirects["fade"+t]=function(e,i,s,o,r,a){var l=g.extend({},i),c=l.complete,u={opacity:"In"===t?1:0};0!==s&&(l.be=function(){c&&c.call(r,r),a&&a.resolver(r)},l.display===n&&(l.display="In"===t?"auto":"none"),k(this,u,l)}}),k}(window.jQuery||window.Zepto||window,window,window?window.document:void 0)})},function(e,t,i){var n=i(3),s=i(8),o=i(296),r=i(298),a=i(299),l=i(300),c=i(301),u=function(){function e(){this.element=s("<div />",{class:"link-bubbles"}).css({position:"absolute",top:0,left:0}),this.linkUrl=s("<div />",{class:"url"}),this.linkEditInput=s("<input />",{type:"text",placeholder:"http://"}),this.linkEditDone=s("<div />",{class:"done"}).text(this.actionNames.done),this.linkUrl.hide(),this.linkUrl.append(this.linkEditInput).append(this.linkEditDone),t.call(this),this.element.append(this.linkUrl),this.hide()}function t(){var e=:"options"}),n={edit:function(){i.call(this)},remove:function(){var e=window.getSelection(),t=document.createRange();t.selectNodeContents(this.linkElement),e.removeAllRanges(),e.addRange(t),window.document.execCommand("unlink",!1,null),e.removeAllRanges(),this.onChange(),this.hide()},open:function(){var e=s(this.linkElement).attr("href");e.indexOf("://")===-1&&(e="http://"+e),window.open(e,"_blank")}};for(var o in n){var r=s("<div />",{class:ck",function(t){return function(){t.call(e)}}(n[o])),t.append(r)}t.hide(),s(this.element).append(t)}function i(){this.linkElement||c.error("Cannot edit link without a valid lin;u.call(this,function(t){s(e).attr("href",t)},s(e).attr("href"))}function u(e,t){t&&(this.linkEditInput.val(t),this.linkUrl.addClass("modified"));var i=this,n=function(){var t=s(i.linkEditInput).val().trim();e(t),i.onChange(),i.close()};s(this.linkEditInput).on("keydown",function(e){i.linkUrl.addClass("modified"),e.keyCode===d.enter?(e.preventDefault(),n()):e.keyCode===d.esc&&(i.close(),i.onDismiss(),e.stopPropCode!==d.esc&&e.keyCode!==d.enter&(e){i.linkUrl.addClass("modified"),h.call(i)}),this.linkEditDone.on("click",function(e){e.preventDefault(),n()}),this.element.find(".options").hide(),this.linkUrl.show(),this.show(),h.call(this),s(this.linkEditInput).focus()}function h(){var e=s(this.linkEditInput).val(),t=s(this.linkEditDone).outerWidth(),i=s(this.linkUrl).outerWidth()-s(this.linkUrl).width(),n=r.calcTextWidth(s(this.linkEditInput).get(0),e),a=r.calcTextWidth(s(this.linkEditInput).get(0),"A"),l=n+t+i+a,c=l<this.minWidth?this.minWidth:l;c=c>this.maxWidth?this.maxWidth:c;var u=s(this.element),h=c-u.width();if(0!==h){var d=Math.floor(h/2);o(u,{width:c,left:"-="+d},{duration:40,easing:"ease"})}}var d={shift:16,enter:13,esc:27,delete:8,tab:9},p=function(t){this.onChange="onChange"in t&&n.isFunction(t.onChange)?t.onChange:n.noop,this.onDismiss=t.onDismiss||n.noop,this.bypassClasses="bypassClasses"in t&&n.isArray(t.bypassClasses)?t.bypassClasses:[],this.maxWidth="maxWidth"in t&&n.isNumber(t.maxWidth)?t.maxWidth:600,this.minWidth="minWidth"in t&&n.isNumber(t.minWidth)?t.minWidth:200,this.linkElement=null,this.labels=n.extend({},{Edit:"Edit",Remove:"Remove",Open:"Open",Done:"Done"},t.labels),this.actionNames={edit:this.labels.Edit,remove:this.labels.Remove,open:this.labels.Open,done:this.labels.Done},e.call(this),l.call(this)};return n.assign(p.prototype,l.prototype),p.prototype.createLink=function(e){u.call(this,function(t){a.restoreSelection(e),window.document.execCommand("createLink",!1,t);var i=window.getSelection(),n=i.getRangeAt(0);n.collapse(!1),i.removeAllRanges(),i.addRange(n)})},p.prototype.showOptions=function(e){this.linkElement=e,this.linkUrl.hide(),this.element.css({width:"",left:0}),this.element.find(".options").show()},p.prototype.close=function(){this.linkUrl.hide(),this.element.find(".options").hide(),this.element.css("width",""),this.linkEditInput.val("").unbind(),this.linkEditDone.unbind(),this.linkUrl.removeClass("modified"),this.linkElement=null,this.hide()},p.prototype.isValidLink=funcsClasses,function(t){return s(e).hasClass(t)})},p}();e.exports=u},function(e,t,i){var n=i(3),s=i(8),o=function(){var e=function(){};return e.calcTextWidth=function(e,t){var i=["font-style","font-weight","font-size","font-family"],o=n.reduce(i,function(t,i){return t+" "+s(e).css(i)},"").trim(),r=document.createElement("canvas"),a=r.getContext("2d");a.font=o;var l=a.measureText(t);return Math.round(l.width)},e.browser=function(){var e=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(trident)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},t=e(navigator.userAgent),i={};return t.browser&&(i[t.browser]=!0,i.version=t.version),i.trident&&(i.msie=!0),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0),i}(),e}();e.exports=o},function(e,t){var i=function(){return{saveSelection:function(e,t){if(t=t||window.getSelection(),!t||!t.rangeCount)return null;for(var i,n,s,o=t.getRangeAt(0),r=0,a=[e];!s&&(i=a.pop());){if(i.nodeType===i.TEXT_NODE)i===o.startContainer?(r+=o.startOffset,s=!0):r+=i.length;else{var l=i.childNodes.length;if("false"!==i.getAttribute("contenteditable"))for(;l--;)a.push(i.childNodes[l])}n=i}return{container:e,endContainer:o.endContainer,start:r,end:r+o.toString().length,selection:t,anchorNode:t.anchorNode}},restoreSelection:function(e){if(e){var t=0,i=document.createRange();i.setStart(e.container,0),i.collapse(!0);for(var n,s,o=[e.container],r=!1,a=!1;!a&&(n=o.pop());){if(n.nodeType===n.TEXT_NODE){var l=t+n.length;!r&&e.start>=t&&e.start<l&&(i.setStart(n,e.start-t),r=!0),r||l!==e.end||(i.setStart(n,e.end-t),r=!0),r&&e.end>=t&&e.end<=l&&(i.setEnd(n,e.end-t),a=!0),t=l}else{var c=n.childNodes.length;if("false"!==n.getAttribute("contenteditable"))for(;c--;)o.push(n.childNodes[c])}s=n}if(!a){var u=e.end-t;try{i.setEnd(e.endContainer,u)}catch(e){}}var h=window.getSelection();h.removeAllRanges();try{h.addRange(i)}catch(e){}}},setToStart:function(e){if(e){var t=document.createRange();t.setStart(e,0),t.setEnd(e,0),t.collapse(!0);var i=window.getSelection();i.removeAllRanges();try{i.addRange(t)}catch(e){}}},setToEnd:function(e){for(var t=[e],i=null,n=e,s=0;i=t.pop();)if(3===i.nodeType)n=i,s=i.length;else for(var o=i.childNodes.length;o--;)t.push(i.childNodes[o]);var r=document.createRange();r.setStart(n,s),r.setEnd(n,s),r.collapse(!0);var a=window.getSelection();a.removeAllRanges();try{a.addRange(r)}catch(e){}}}}();e.exports=i},function(e,t,i){var n=i(301),s=function(){function e(e,t){"number"==typeof e&&"number"==typeof t&&this.element.css({left:e+"px",top:t+"px"})}function t(){var e=this.element.get(0).getBoundingClientRect().left;e<0&&this.element.css("left","+="+-1*e+"px");var t=this.element.get(0).getBoundingClientRect().top;t<0&&this.element.css("top","+="+-1*t+"px")}var i=function(e){return this.element?(e=e||{},this.onShow=e.onShow||functinHide=e.onHide||function(e){e.element.hide()},this.isShown=!1,void this.element.hide()):(n.error("ControlBase requires an element"),null)};return i.prototype.hide=function(){this.isShown&&(this.isShown=!1,this.onHide(this))},i.prototype.showOverTarget=function(e,i){var n=e-this.element.width()/2,s=i-this.element.height()-10;this.show(n,s),t.call(this)},i.prototype.show=function(t,i){e.call(this,t,i),this.isShown||(this.isShown=!0,this.onShow(this))},i.prototype.size=function(e,t){e&&"number"==typeof e&&this.element.width(e),t&&"number"==typeof t&&this.element.width(t)},i}();e.exports=s},function(e,t,i){var n=i(3),s=i(294),o=["assert","clear","constructor","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","timeline","timelineEnd","trace","warn"],r=function(e){return function(){return s.debugMode?window.console[e].bind(window.console)n.noop}},a={};n.each(o,function(e){a[e]=r(e)}),e.exports=a},function(e,t,i){var n=i(3),s=i(8),o=i(296),r=o.animate,a=i(300),l=function(){function e(){var e=this,t=n.reduce(this.controlsOrder,function(e,t){return n.has(this.controls,t)&&e.push(this.template(n.extend({name:t},this.controls[t]))),e},[],this);this.element=s("<div />",{class:"bubbles"}).css({position:"absolute",top:0,left:0}).html(t),this.buttons=s(this.element).find("[data-comman("mousedown",function(e){eunction(t){t.preventDefault(),l.call(e,this)})}function t(){n.each(this.controls,function(e,t){n.has(e,"keyboard")&&this.keyboardEvents.on(e.keyboard,n.partial(o.bind(this),t)),n.has(e,"keyboardInverse")&&this.keyboardEvents.on(e.keyboardInverse,n.partial(i.bind(this),t))},this)}function i(e){n.has(this.controls,e)&&d[e]&&o.call(this,e)}function o(e){var t,i,s,o;n.has(this.controls,e)&&(t=d[e],i=this.controls[e],s=i.command,o=i.el,t&&this.inverseCommand&&"function"==typeof this.inverseCommand?this.inverseCommand(s,o,this):this.applyCommand&&"function"==typeof this.applyCommand&&this.applyCommand(s,o,this),this.onAction(this))}function l(e){o.call(this,s(e).attr("data-name"))}function c(){this.buttons.removeClass("active"),this.buttons.filter(function(){return d[s(this).attr("data-name")]}).addClass("active")}function u(e,t){var i=!1;return s.each(e,function(e,n){if(n===t||"undefined"!=typeof n.nodeName&&n.nodeName===t)return i=!0,!1}),i}var h='<div class="<%= className %>" title="<%= title %>" data-name="<%= name %>" data-el="<%= el %>" data-command="<%= command %>" data-type="<%= type %>">&nbsp;</div>',d={},p=function(i,s,o){o=o||{},this.applyCommand=i,this.inverseCommand=s,this.template=n.template(o.template||h),this.controls=o.controls||{},this.controlsOrder=o.controlsOrder||n.keys(this.controls),this.onAction=o.onAction||n.noop,this.keyboardEvents=o.keyboardEvents,e.call(this),this.keyboardEvents&&t.call(this),a.call(this,o)};return n.assign(p.prototype,a.prototype),p.prototype.setActives=function(e){d=n.reduce(this.controls,function(t,i,n){var s=i.command,o=(i.el||"").toUpperCase(),r=u(e,o),a=!1;try{a=document.queryCommandEnabled(s)&&document.queryCommandState(s)}catch(e){a=!1}return t[n]=a||r,t},{},this),c.call(this)},p.prototype.open=function(e,t){if(!this.isShown){var i=s(this.element).children("[data-command]"),n=s(this.element).find(".shim");s(this.element).css({width:"auto"}),n.remove(),i.removeAttr("style")}this.showOverTarget(e,t)},p.prototype.closeWithShim=function(e,t,i,o){var a=s(this.element),l=s(e),c=s('<div class="shim">&nbsp;</div>').get(0),u=n.has(r,"Promise");i=u?i:200;var h=a.width();a.css("width",h+t);var d=l.position().left,p=h/2-(d+t/2);l.before(c).hide();var g=s(c).offset().left+p,f=s(c).offset().top;this.isAnimating=!0,n.forEach(this.buttons,function(e,t){r(e,"stop"),r(e,{opacity:0},{duration:.5*i})}),r(a,{left:"+="+p},{easing:"ease",duration:i});var _=r(c,{width:t},{easing:"ease",duration:i}),m=n.bind(function(){n.isFunction(o)&&o.call(this,g,f),this.isAnimating=!1,this.hide()},this);u?_.thenrototype.getActiveStates=function(){return d},p}();e.exports=l},function(e,t,i){var n=i(3),s=i(8),o=i(304),r=function(){function e(e){e.normalize();for(var t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);t.nextNode();){var i=t.currentNode,n=s(i).parent().is(e);n&&""!==i.nodeValue.trim()&&s(i).wrap("<p>")}}function t(t){e(t),s(t).children().each(function(){var e=s(this).get(0),t=e.nodeName===_,i=e.nodeName===m;v(e)||b(e)||t||i||s(this).wrap("<p>")})}function "*").toArray(),function(e){return v(e)||w(e)})}function r(e,o){e.normalize(),o||t(e);var r=i(e);!r.length&&o||(o&&(t(e),r=i(e)),s(e).empty(),n.each(r,functchildren().toArray(),function(e){return v(e)});(w(t)||!h(t)&&!i)&&s(e).append(t)}))}function a(e){if(!w(e)){var t=s(e).children(g.join()).toArray(),i=!1;n.each(t,function(e){i||(s(e).unwrap(),i=!0),a(e)})}}function l(e,t){var o=i(e);n.each(o,function(e){s(e).find("li").contents().unwrap(),t&&(s(e).find("br:last-child").remove(),s(e).append("<br>")),s(e).contents().unwrap()})}function c(e){var i=C(e);i.shift();for(var n=i.shift();n&&!s(n).is("[contentEditable]");){var o=n.parentNode;s(n).contents().unwrap(),t(o),n=i.shift()}}function u(e){if(e&&e.length){for(var t=e.shift(),i=!1,o=["style","dir"];t;){var r=s(t).find("span").toArray();"SPAN"===t.nodeName&&r.push(t),r.length&&(i=!0),s(r).contents().unwrap(),n.each(o,function(e){s(t).removeAttr(e),s(t).find("["+e+"]").removeAttr(e)}),t=e.shift()}return i}}function h(e,t){var i=s(e).text();t&&(i=i.replace(/\n|\r/gm,"").trim());var n=e&&e.nodeName===m;return""===i&&!b(e)&&!y(e)&&!n}function d(e){var t=document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t.body}function p(e){var t=document.implementation.createHTMLDocument("");return t.body.appendChild(e.cloneNode(!0)),t.body}var g=["P","FIGURE","H2","BLOCKQUOTE","UL","OL","PRE"],f=["FIGURE","IFRAME","IMG","HR"],_="DIV",m="HR",v=function(e){return n.contains(g,e.nodeName)},b=function(e){return e&&n.contains(f,e.nodeName)},y=funreturn"false"===s(e).attr("contenteditable")},C=function(e){return n.filter(e,function(e){return n.contains(g,e.nodeName)})},k=function(e){this.sanitizeConfig=e};return k.prototype.flattenBlocksDown=function(e,t){r(e,t)},k.prototype.unBlock=function(e){a(e)},k.prototype.unwrapParentBlocks=function(e){c(e)},k.prototype.scrubSpansAndBadAttrs=function(e,t){return u(e,t)},k.prototype.blockifyInlineNodes=function(e){t(e)},k.prototype.inlinify=function(e,t){l(e,t)},k.prototype.getBlockNodes=function(e){return i(e)},k.prototype.isEmptyElement=function(e,t){return h(e,t)},k.prototype.filterHTML=function(e){var t=d(e),i=new o(this.sanitizeConfig),n=i.clean_node(t),s=p(n),r=s.innerHTML,a=r.replace(/[<]p[>][ ]*[<]\/p[>]/g,"");return a},k.prototype.filterPlaintext=function(e,t){var i=n.escape(e);return i=i.replace(/\r\n/g,"\n"),i=i.replace(/\r/g,"\n"),t&&(i=i.replace(/\n([ ]*\n)+/g,"</p><p>")),i=i.replace(/\n/g,"<br>"),t&&(i="<p>"+i+.replace(/[ ]{2}/g," Â ").replace(/[ ]$/,"Â ")},k.prototype.sanitizeIFrames=function(e){var t=d(e);return s(t).find("iframe").each(function(){s(this).attr("data-original-src",s(this).attr("src")),s(this).attr("src","javascript:''")}),t.innerHTML},k.prototype.unSanitizeIFrames=function(e){var t=d(e);retsrc")),s(this).removeAttr("data-original-src")}),t.innerHTML},k}();e.exports=r},function(e,t){function i(){var e,t;for(t=arguments[0]||{},this.config={},this.config.elements=t.elements?t.elements:[],this.config.attributes=t.attributes?t.attributes:{},this.config.attributes[i.ALL]=this.config.attributes[i.ALL]?this.config.attributes[i.ALL]:[],this.config.allow_comments=!!t.allow_comments&&t.allow_comments,this.allowed_elements={},this.config.protocols=t.protocols?t.protocols:{},this.config.classnames=t.classnames?t.classnames:{},this.config.add_attributes=t.add_attributes?t.add_attributes:{},this.dom=t.dom?t.dom:document,e=0;e<this.config.elements.length;e++)this.allowed_elements[this.config.elements[e]]=!0;if(this.config.remove_element_contents={},this.config.remove_all_contents=!1,t.remove_contents)if(t.remove_contents instanceof Array)for(e=0;e<t.remove_contents.length;e++)this.config.remove_element_contents[t.remove_contents[e]]=!0;else this.config.remove_all_contents=!0;this.transformers=t.transformers?t.transformers:[]}i.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,i.RELATIVE="__RELATIVE__",i.ALL="__ALL__",i.prototype.clean_node=function(e){function t(e,t){var i;for(i=0;i<t.length;i++)if(t[i]===e)return i;return-1}function n(){var e,t,i=[],n={};for(e=0;e<arguments.length;e++)if(arguments[e]&&arguments[e].length)for(t=0;t<arguments[e].length;t++)n[arguments[e][t]]||(n[arguments[e][t]]=!0,i.push(arguments[e][t]));return i}function s(e){var t;switch(e.nodeType){case 1:r.call(this,e);break;case 3:t=e.cloneNode(!1),this.current_element.appendChild(t);break;case 5:t=e.cloneNode(!1),this.current_element.appendChild(t);break;case 8:this.config.allow_comments&&(t=e.cloneNode(!1),this.current_element.appendChild(t));break;default:console&&console.log&&console.log("unknown node type",e.nodeType)}}function o(e,i){for(var n=[],s=0;s<e.length;s++)t(e[s],i)!==-1&&n.push(e[s]);return n}function r(e){var r,l,c,u,h,d,p,g,f,_,m=a.call(this,e);if(e=m.node,c=e.nodeName.toLowerCase(),l=this.current_element,this.allowed_elements[c]||m.whitelist){this.current_element=this.dom.createElement(e.nodeName),l.appendChild(this.current_element);var v=this.config.attributes;for(u=n(v[c],v[i.ALL],m.attr_whitelist),this.config.classnames[c]&&this.config.classnames[c].length&&u.push("class"),r=0;r<u.length;r++){d=u[r];var b="object"==typeof u[r]||u[r]instanceof Object;if(d=b?u[r].name:u[r],h=e.attributes[d]){g=h.value;var y=g.toLowerCase();if(_=!0,this.config.protocols[c]&&this.config.protocols[c][d]){_=!1,f=this.config.protocols[c][d],f.push(i.RELATIVE);for(var r in f)if(0===y.indexOf(f[r].toLowerCase())){_=!0;break}}"class"===d&&this.config.classnames[c]&&(g=o(g.split(" "),this.config.classnames[c]).join(" "),_=!!g),b&&(_=y.match(u[r].value)),_&&(p=document.createAttribute(d),p.value=g,this.current_element.setAttributeNode(p))}}if(this.config.add_attributes[c])for(d in this.config.add_attributes[c])p=document.createAttribute(d),p.value=this.config.add_attributes[c][d],this.current_element.setAttributeNode(p)}else if(t(e,this.whitelist_nodes)!==-1){for(this.current_element=e.cloneNode(!0);this.current_element.childNodes.length>0;)this.current_element.removeChild(this.current_element.firstChild);l.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[c])for(r=0;r<e.childNodes.length;r++)s.call(this,e.childNodes[r]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=l}function a(e){var i,s,o,r={attr_whitelist:[],node:e,whitelist:!1};for(i=0;i<this.transformers.length;i++)if(o=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:e,node_name:e.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),null!==o){if("object"!=typeof o)throw new Error("transformer output must be an object or null");if(o.whitelist_nodes&&o.whitelist_nodes instanceof Array)for(s=0;s<o.whitelist_nodes.length;s++)t(o.whitelist_nodes[s],this.whitelist_nodes)===-1&&this.whitelist_nodes.push(o.whitelist_nodes[s]);r.whitelist=!!o.whitelist,o.attr_whitelist&&(r.attr_whitelist=n(r.attr_whitelist,o.attr_whitelist)),r.node=o.node?o.node:r.node}return r}var l=this.dom.createDocumentFragment();this.current_element=l,this.whitelist_nodes=[];for(var c=0;c<e.childNodes.length;c++)s.call(this,e.childNodes[c]);return l.normalize&&l.normalize(),l},e.exports=i},functtotype.indexOf.call(e.parentNode.childNodes,e)},t=function(e){return e instanceof HTMLElement},i={getParentNodes:function(e,t){if(t=t||[],!e||i.isEditorNode(e))return t;var n=e.parentNode;return i.isEditorNode(n)?t:n?(t.push(n),i.getParentNodes(n,t)):t},getRootElements:function(n){n=n||i.getSelection();var s=n&&n.anchorNode?n.anchorNode:null;if(!s||i.isEditorNode(s))return[];var o=i.getParentNodes(s),r=n.focusNode,a=i.getParentNodes(r),l=o.length?o.pop():s,c=a.length?a.pop():r,u=e(l),h=e(c);if(h<u){var d=u;u=h,h=d}for(var p=[],g=l.parentNode,f=u;f<=h;f++){var _=g.childNodes[f];t(_)&&p.push(_)}return p},getNodeList:function(e,t){e=e||i.getSelection();var s=e&&e.anchorNode?e.anchorNode:null;if(!s||i.isEditorNode(s))return[];var o=e.focusNode,r=[s];o&&!i.isEditorNode(o)&&(r=r.concat([o]));var a=i.getParentNodes(s);if(r=r.concat(a),!t){var l=i.getParentNodes(o);r=r.concat(l)}var c=n.union(r);return c},getNodeByNames:function(e,t,n){var s=i.getNodeList(n);
return s=t?s.reverse():s,this.getNodesByNames(s,e)[0]},getNodesByNames:function(e,t){return n.filter(e,function(e){return n.indexOf(t,e.nodeName)!==-1})},getNearestElement:function(e){e=e||i.getSelection();var t=i.getNodeList();return n.find(t,function(e){return 1===e.nodeType})},getContextCoordinates:function(e,t){var n=i.getSelection(),o=n.getRangeAt(0).cloneRange(),r=s(e).offset();if(t||!n.isCollapsed){var a=(t||o).getBoundingClientRect();return{x:a.left+a.width/2-r.left,y:a.top-r.top+s(window).scrollTop()}}if(o.getClientRects){o.collapse(!0);var l=o.getClientRects()[0];if(l)return{x:l.left-r.left,y:l.top-r.top+s(window).scrollTop()}}},getSelection:function(){var e=window.getSelection();if(e.anchorNode){var t=s(e.anchorNode).closest("[contenteditable]").length;return t?e:null}return null},collapseToEnd:function(){var e=i.getSe{var e=i.getSelection();e&&e.collapseToStart()},isInContext:function(e,t){return s((e){return s(e).is('[contentEditable="true"]')},hasSelection:function(){var e=i.getSelection();return e&&!e.isCollapsed},rangeFromElement:function(e){var t,n,s=i.getSelection();return!(!s||!s.isCollapsed)&&(n=s.getRangeAt(0),t=n.cloneRange(),t.selectNodeContents(e),t.setEnd(n.startContainer,n.startOffset),t)},isCursorAtEnd:function(e,t){var i=this.rangeFromElement(e);if(!i)return!1;var n=i.toString(),s=e.textContent;return t&&(n=n.trim(),s=s.trim()),n.length===s.length},isCursorAtStart:function(e){var t=this.rangeFromElement(e);return!!t&&(0===t.startOffset&&0===t.endOffset)}};return i}();e.exports=o},function(e,t,i){var n=i(3),s=i(8),o=i(300),r=function(){function e(){this.element=s("<div />",{class:"inline-controls"}).css({position:"absolute",top:0,left:0}),this.opener=s("<div />",{class:"opener"}),this.isTrayOpen=!1;var e=this;this.opener.on("mousedown",function(i){return i.preventDefault(),i.stopPropagation(),t.call(e,null,!0),!1}),this.tray=s("<div />",{class:"tray"}),this.element.append(this.opener),this.element.append(this.tray),this.hide()}function t(e,t){"boolean"!=typeof e&&(e=!this.isTrayOpen),e?(this.openTray.call(this,this.tray),this.isTrayOpen=!0,this.onTrayOpened.call(this,t)):(this.closeTray.call(this,this.tray),this.isTrayOpen=!1,this.onTrayClosed.call(this,t)),s(this.opener).toggleClass("open",this.isTrayOpen),t?s(this.opener).toggleClass("closed",!this.isTrayOpen):s(this.opener).removeClass("closed")}var i=function(t){t=t||{},this.openTray=t.openTray||this.openTray,this.closeTray=t.closeTray||this.closeTray,this.onTrayOpened=t.onTrayOpened||function(e){},this.onTrayClosed=t.onTrayClosed||function(e){},this.customOffset=t.customOffset||n.noop,this.keyboardEvents=t.keyboardEvents,e.call(this),o.call(this,t)};n.assign(i.prototype,o.prototype);var r=n.memoize(function(e,t){var i;return n.isFunction(t)?i=t.call():n.isObject(t)&&(i=t),n.pick(n.defaults(n.isObject(i)?i:{},{x:e.x||e,y:e.y||0}),["x","y"])});return i.prototype.addToTray=function(e,t){var i;t=t||{},this.tray.append(e),i=t.keyboard,this.keyboardEvents&&i&&this.keyboardEvents.on(i.shortcut,i.callback,i.context)},i.prototype.openTray=function(e){e.show()},i.prototype.closeTray=function(e){e.hide()},i.prototype.open=function(e,i){if(e){i=r(i||0,this.customOffset||0);var n=s(e).position(),o=parseInt(s(e).css("margin-top"),10)||0;t.call(this,!1),this.se.close=function(){t.call(this,!1leTrayWithIntent=function(e){t.call(this,e,!0)},i}();e.exports=r},function(e,t,i){var n=i(3),s=i(8),/.test(navigator.platform)?e.metaKey:e.ctrlKey};s(this.editor.element).on("keydown.undoManager",function(s){if(s.keyCode===u.z&&n(s)&&!s.altKey)return s.shiftKey?i.call(e):t.call(e),s.preventDefault(),!1})}function t(){if(l.call(this),this.undoStates.length){var e=this.undoStates.pop();c.call(this,e),this.redoStates.push(this.currState),r.call(this)}}function i(){if(this.redoStates.length){var e=this.redoStates.pop();c.call(this,e),this.undoStates.push(this.currState),r.call(this)}}function r(){this.currState=a.call(this)}function a(){var e={data:this.editor.getData(!0,!0),selection:o.saveSelection(this.editor.element)};return e}function l(){var e=a.call(this);return this.currState?void(e.data!==this.currState.data&&(this.undoStates.push(this.currState),this.currState=e)):void(this.currState=e)}function c(e){if(this.isRestoring=!0,this.editor.setData(e.data,!0),e.selection)o.restoreSelection(e.selection);else{var t=window.getSelection();t.removeAllRanges()}this.afterRestore()}var u={command:91,control:17,shift:16,z:90},h=500,d=function(t,i){this.editor=t,this.modifierKeyCode=!1,this.isShift=!1,this.currState=null,this.undoStates=[],this.redoStates=[],this.afterRestore=i||function(=n.debounce(function(){s.isTorndown||l.call(s)},h);this.defaultOnChange=t.onChange,t.onChange=function(e){if(s.isRestoring)s.isRestoring=!1;else{if("updateAsyncImage"===e)return;s.currState?o():l.call(s)}s.defaultOnChange.call(this)},e.call(this)};return d.prototype.undo=function(){t.call(this)},d.prototype.redo=function(){i.call(this)},d.prototype.teardown=function(){this.isTorndown=!0,this.editor.onChange=this.defaultOnChange,this.undoStates.length=0,this.redoStates.length=0,this.currState=null,s(this.editor.element).off(".undoManager")},d}();e.exports=r},function(e,t,i){var n=i(3),s=i(8),o=i(305),r=i(299),a=i(298),l=function(){function e(){var e=this;s(this.editor.element).on("keypress",function(n){var s=!1;if(34===n.charCode)s=i.call(e);else{if(39!==n.charCode)return;s=t.call(e)}s&&n.preventDefault()})}function t(){var e=this.config.singleQuotes;return l.call(this,e.open,e.close,e.prime)}function i(){var e=this.config.doubleQuotes;return l.call(this,e.open,e.close,e.prime)}function l(e,t,i){var a=o.getSelection();if(!a.isCollapsed)return!1;var l=a.anchorNode;l.normalize();var c=r.saveSelection(l),u=l.textContent,h=u.slice(0,c.start),d=h.charAt(h.length-1),p=l.lastChild&&"BR"===l.lastChild.nodeName?l.lastChild:null,g=n.any(this.config.openingMatches,function(e){return e.test(d)})||p,f="";f=!d||g?e:/\d/.test(d)?i:t;var _=document.createTextNode(f),m=a.getRangeAt(0);return m.deleteContents(),m.insertNode(_),p&&p.previousSibling&&"BR"===p.previousSibling.nodeName&&s(p).remove(),m.setEndAfter(_),m.collapse(!1),a.removeAllRanges(),a.addRange(m),!0}var c=function(t,i){return a.browser.msie?null:(this.editor=t,this.config={openingMatches:[/\s/,/\u200B/,/[=]/],singleQuotes:{open:"â€˜",close:"â€™",prime:"â€²"},doubleQuotes:{open:"â€œ",close:"â€",prime:"â€³"}},n.extend(this.config,i||{}),void e.call(this))};return c}();e.exports=l},function(e,t,i){var n=i(3),s=i(8),o=i(310),r=function(){function e(){s(this.element).on("keydown.keycombos",i.bind(this)),this.listening=!0}function t(){s(this.element).off("keydown.keycombos"),this.listening=!1}function i(e){var t=this.humanKeys.translate(e);t&&a.call(this,t)&&(r.call(this,t,e),e.preventDefault(),e.stopImmediatePropagation())}function r(e,t){n.each(c.call(this,e),function(i){n.has(i,"callback")&&n.has(i,"context")&&i.callback.call(i.context,t,e)})}function a(e){return c.call(this,e).length>0}function l(e,t){var i=c.call(this,e);return n.filter(i,{callback:t}).length>0}function c(e){return n.has(this.subscribers,e)?this.subscribers[e]:[]}function u(t,i,s){if(!l.call(this,t,i))return n.has(this.subscribers,t)||(this.subscribers[t]=[]),this.subscribers[t].push({callback:i,context:s}),this.listening||e.call(this),this}function h(){this.subscribers={},t.call(this)}function d(e,i){return e?n.has(this.subscribers,e)?(i&&(this.subscribers[e]=n.reject(this.subscribers[e],{callback:i})),i&&0!==this.subscribers[e].length||delete this.subscribers[e],0===n.values(this.subscribers).length&&t.call(this),this):this:(h.call(this),this)}var p=function(e){e=e||{},this.debounceRate=e.debounceRate||100,this.element=e.element||document,this.humanKeys=e.humanKeys||new o,this.subscribers={},this.listening=!1};return p.prototype.on=function(e,t,i){n.each((e||"").split(" "),function(e){u.call(this,this.humanKeys.normalize(e),t,i)},this)},p.prototype.off=function(e,t){e?n.each(e.split(" "),function(e){d.call(this,this.humanKeys.normalize(e),t)},this):d.call(this,null,t)},p}();e.exports=r},function(e,t,i){var n=i(3),s=function(){function e(){return navigator.platform.match(/^Win/i)?"Win":navigator.platform.match(/^Mac/i)?"Mac":navigator.platform.match(/^Linux/i)?"Linux":navigator.platform}function t(){return n.extend({},this.prettyMapping,this.platformPrettyMapping[e.call(this)])}function i(){return this.platformModifiers[e.call(this)]||{}}function s(){var t=e.call(this);return n.has(this.platformPrettySeperators,t)?this.platformPrettySeperators[t]:this.seperator}function o(e){return this.specialKeys[e.keyCode]||String.fromCharCt{return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}var l=["ctrl","meta","alt","shift"],c="+",u={37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",187:"PLUS",61:"PLUS",188:"COMMA",189:"MINUS",173:"MINUS",190:"DOT",32:"SPACE"},h={LEFT:"â†",RIGHT:"â†’",DOWN:"â†“",UP:"â†‘",PLUS:"+",COMMA:",",MINUS:"-",DOT:".",SPACE:"Space"},d={Win:{meta:"ctrl"},Linux:{meta:"ctrl"}},p={Mac:{meta:"âŒ˜",shift:"â‡§",alt:"âŒ¥"}},g={Win:"-",Linux:"-",Mac:""},f=function(e){e=e||{},this.modifiers=e.modifiers||l,this.separator=e.separator||c,this.specialKeys=e.specialKeys||u,this.prettyMapping=e.prettyMapping||h,this.platformModifiers=e.platformsModififiers||d,this.platformPrettyMapping=e.platformPrettyModifiers||p,this.platformPrettySeperators=e.platformPrettySeperators||g};return f.prototype.translate=function(e){var t=r.call(this,e);return 0===t.length?null:t.concat(o.call(this,e)).join(this.separator)},f.prototype.normalize=function(e){var t=e.split(this.separator),s=i.call(this),o="";return n.each(this.modifiers,function(e){var i=n.indexOf(t,e.toLowerCase()),r=s[e]||e;i>=0&&(o+=r+this.separator,t.splice(i,1))},this),o+t.join(this.separator).toUpperCase()},f.prototype.pretty=function(e){var i=this.normalthis);return n.map(i.split(this.separator),function(e){return o[e]||a(e)},this).join(r)},f}();e.exports=s},function(e,t,i){var n=i(3),s=i(8),o=i(303),r=i(299),a=i(305),l=i(307),c=i(308),u=i(309),h=i(301),d=function(){function e(){f.call(this,x);var e=s("<div />",{"data-js":"editor-wrapper",class:"editor-wrapper"}).css("position","relative"),i=s("<div />",{"data-js":"editor-slot",class:"editor-slot"}).css("position","relative");s(this.element).wrap(e).wrap(i),this.placeholderElement=s("<div />",{"data-js":"editor-placeholder",class:"editor-placeholder"}).css("position","absolute"),i=s(this.element).parent(),i.append(this.placeholderElement),d.call(this),t.call(this)}function t(){var e=this,t=function(){y.call(this),i.call(this),this.onChankeypress mousedown mouseup",function(t){e.config.onClientEvent.call(e,t)}),s(this.element).on("keydown",function(t){if(t.keyCode===E.shift)e.keyModifiers.shift=!0;else if(t.keyCode===E.backspace)k.call(e);else if(t.keyCode===E.enter)return e.config.forceSingleLine||t.metaKey||v.call(e,this,!1),void t.preventDefault();n.defer(function(){e.onChange(t)})}),s(this.element).on("keyup",function(i){i.keyCode===E.shift?e.keyModifiers.shift=!1:i.keyCode===E.enter?k.call(e):i.keyCode!==E.backspace&&i.keyCode!==E.delete||n.defer(function(){k.call(e)}),t.call(e)}),s(this.element).on("input",function(i){t.call(e)}),s(this.element).on("blur",function(t){e.onChange()});var o=!1;s(this.element).on("mouseup",function(){o=!1,i.call(e)}),s(this.enction(e){o=!0}),s(this.element).on("mouseleave",function(){o&&i.call(e)}),s(this.element).on("paste",function(t){var i=(t.originalEvent||t).clipboardData;e.config.pasteHook(i,e.keyModifis.element).on("drop",function(e){e.stopPropagation(),e.preventDefault()}),this.placeholderElement.on("click",,s(this.element).on("focus",function(){n.defer(function(){e.onChange()})})}function i(){var e=this;setTimeout(function(){var t=a.getSelection();e.config.onSelection.call(e,t)},200)}function d(){var e=this.isEmpty()?this.config.placeholder:"",t=s(this.placeholderElement);t.html(e);var i=t.outerHeight();i&&s(this.element).css("min-height",Math.max(parseInt(t.css("min-height"),10)||0,i))}function p(e,t){var i="";if(n.contains(e.types,"text/plain"))i=e.getData("text/plain"),i=this.dataFilter.filterPlaintext(i),m.call(this,i);else{if(!n.contains(e.types,"text/html"))return;i=e.getData("text/html"),i=this.dataFilter.filterHTML(i);var s=i.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1"),o=document.implementation.createHTMLDocument("");o.body.innerHTML=s;var r=o.body,a=r.textContent||r.innerText||"",l=a.split("\n").join("<br>");m.call(this,l)}if(this.config.forceSingleLine){var c=_.call(this).replace(/<br\s*\/*>/g," ");f.call(this,c)}this.onChange(t)}function g(){s(this.element).contents().filter(function(){return 3===this.nodeType}).wrap("<span></span>")}function f(e){s(this.element).html(e)}function _(){return s(this.element).html().trim()}function m(e){if(e=e.replace(/[<]br\s?\/?[>]$/,""),e=this.dataFilter.convertToBrowserSpaces(e),!e)return void h.warn("Cannot insert empty data");var t=a.getSelection();if(!t||!t.focusNode)return void h.warn("Cannot insert without the editor having a cursor or selection");var i=t.getRangeAt(0);i.deleteContents();var n=i.createContextualFragment(e);i.insertNode(n),t.removeAllRanges(),i.collapse(!1),t.addRange(i)}function v(e,t){t||e.lastChild&&"br"===e.lastChild.nodeName.toLowerCase()||e.appendChild(document.createElement("br"));var i=a.getSelection();if(i){var n=i.getRangeAt(0),s=document.createElement("br");n.deleteContents(),n.insertNode(s),n.setStartAfter(s),n.setEndAfter(s),n.collapse(!1),i.removeAllRanges(),i.addRange(n)}}function b(e){s(e).contents().each(function(e,t){t.nodeType===Node.TEXT_NODE?t.textContent=t.textContent.replace(T,""):t.nodeType===Node.ELEMENT_NODE&&b(t)})}function y(){if(!this.isEmpty()){var e=w.call(this);if(e&&e.nodeType===Node.ELEMENT_NODE){var t=e.textContent||e.innerText||"",i=t.match(T);if(i){var n=r.saveSelection(e);n.start-=(t.substr(0,n.start).match(T)||"").length||0,n.end-=(t.substr(0,n.end).match(T)||"").length||0,b(e),r.restoreSelection(n)}}}}function w(){var e=C.call(this);if(!e){var t=s(this.element).children();if(!t.length)return null;e=t.last().get(0)}return e}function C(e){return e||(e=!a.getSelection()&&this.lastSelection?a.getParen()),n.find(e.reverse(),function(e){return e.nodeType===Node.ELEMENT_NODE})}function k(){this.isEmpty()&&(f.call(this,x),this.setCursorToEnd())}var x="<span>&#8203;</span>",S="<span>â€‹</span>",T=/\u200B/g,E={shift:16,enter:13,esc:27,backspace:8,delete:46,tab:9,right:39},P=function(t,i){if(!t)throw new Error("A valid element parameter is required to initalize the editor");this.element=t,this.keyComboEvents=i.keyComboEvents||new u({element:this.element}),this.keyComboEvents.on("meta+b meta+i meta+k meta+u",n.noop),this.config={placeholder:!1,onChange:function(){},onSelection:function(e){},onClientEvent:function(e){},pasteHook:function(e,t){return!1},filterForSetData:function(e){return e},filterForGetData:function(e){return e},filterRules:{elements:["p","br","div"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}},forceSingleLine:!1,smartQuotes:{enabled:!1,config:{}}},n.extend(this.config,i||{}),this.dataFilter=new o(this.config.filterRules),this.onChange=function(){this.previousRawData!==_.call(this)&&(g.call(this),d.call(this),this.config.onChange.apply(this,arguments),this.previousRawData=_.call(this))},this.keyModifiers={shift:!1},this.undoManager=new l(this),this.config.smartQuotes.enabled&&(this.smartQuoter=new c(this)),e.call(this)};return P.prototype.getData=function(e){var t=_.call(this);t=this.config.filterForGetData.call(this,t);var i=t.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1").replace(T,""),n=document.createElement("div");n.innerHTML=i;var s=n.textContent||n.innerText||"",o=e?s.trim():s;return o},P.prototype.setData=function(e){e=this.config.filterForSetData.call(this,e),e=this.dataFilter.filterPlonChange()},P.prototype.setHTML=function(e){f.call(this,e),this.onChange()},P.prototype.getHTML=function(){return _.call(this)},P.prototype.insertData=function(e,t){t&&(e=thisthis.onChange()},P.prototype.blur=function(){return s(this.element).blur()},P.prototype.focus=function(e){var t=s(this.element).focus();return e||this.setCursorToEnd(),t},P.prototype.hasFocus=function(){return s(this.element).is(":focus")},P.prototype.setPlaceholder=function(e){this.config.placeholder=e,d.call(this)},P.prototype.isEmpty=function(){var e=this.getData(!1);if(""===e||"\n"===e||"\r\n"===e)return!0;var t=_.call(this);return t===x||t===S||""===t},P.prototype.getCurrentElement=function(){return a.getNearestElement()},P.prototype.setCursorToStart=function(e){var t=s(this.element);e=e&&t.find(e).first().get(0)||t.children().first().get(0),e&&r.setToStart(e)},P.prototype.setCursorToEnd=function(e){var t=s(this.element);e=e&&t.find(e).last().get(0)||t.children().last().get(0),e&&r.setToEnd(e)},P.prototype.teardown=function(){this.undoManager.teardown(),this.keyComboEvents.off()},P}();e.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="editor editor-plaintext" aria-label="'+__e(ariaLabel)+'" contenteditable="true" data-js-plaintexteditor></div>';return __p}.toString()).apply(void 0,_values(_imports))},,,,function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(219),r=i(235),a=o.extend({initialize:function(e){this.el=e.el||null,this.itemSelector=e.itemSelector||".item",this.dropInParent=e.dropInParent||!1,this.transparentPlaceholder=e.transparentPlaceholder,this.beforeDragStart=e.beforeDragStart||n.noop,this.afterDragEnd=e.afterDragEnd||n.noop,this.scrollable=e.scrollable||!1,this.$items=this.$(this.itemSelector),this.isAnimating=!1,this.disableAnimation=e.disableAnimation||!1,this.disableAnimation&&(this.calculateDropTarget=n.throttle(this.calculateDropTarget,500)),this.$currentlyDraggedItem=null,this.$placeholder=null,this.placeholderElement=null,this.renderedPlaceholder=!1,this.reloadItems()},itemEvents:function(e){e||(e=this.itemSelector);var t={};return t["dragstart "+e]="setPlaceholder",t["dragenter "+e]="calculateDropTarget",t["dragend "+e]="resetPlaceholder",this.dropInParent?(t.dragover="cancelEvent",t.drop="dropItemAndResetPlaceholder"):(t["dragover "+e]="cancelEvent",t["drop "+e]="dropItem"),t},setPlaceholder:function(e){this.renderedPlaceholder=!1,e.originalEvent.dataTransfer.effectAllowed="move";try{e.originalEvent.dataTransfer.setData("text/html","")}catch(e){}if(this.$currentlyDraggedItem=s(e.currentTarget),this.$currentlyDraggedItem){if(this.$placeholder=this.$currentlyDraggedItem.clone().addClass("sortable-placeholder"),this.transparentPlaceholder&&this.$placeholder.addClass("transparent-placeholder"),!this.disableAnimation){var t=this.$currentlyDraggedItem.outerWidth();this.$placeholder.data("item-width",t).data("need-animation",!1)}this.placeholderElement=this.$placeholder.get(0),this.$currentlyDraggedItem.addClass("sortable-dragging"),this.beforeDragStart(),this.trigger("dragstart",this),this.scrollable&&(this.$el.on("dragover."+this.cid,n.throttle(function(e){var t=.2,i=window.innerHeight,n=e.originalEvent.clientY/i,s=this.getBoundingClientRect();n<t&&s.top<0?window.scrollBy(0,-(200*(t-n))):n>1-t&&window.scrollBy(0,200*(t+n-1)),e.preventDefault()},50)),this.$currentlyDraggedItem.one("dragend",n.bind(function(){this.$el.off(["dragenter."+this.cid,"dragover."+this.cid].join(" "))},this)))}},calculateDropTarget:function(e){if(this.$currentlyDraggedItem&&!this.isAnimating){e.preventDefault(),this.renderedPlaceholder=!0;var t=e.currentTarget,i=s(t);if(t===this.placeholderElement)return!1;this.$currentlyDraggedItem.hide();var n,o=i.index(this.itemSelector),r=this.$placeholder.index(this.itemSelector),a=this.$placeholder.data("need-animation")||!1,l=this.$placeholder.data("item-width");return this.disableAnimation||(n=s("<span>").css({width:l,display:"inline-block"}),this.$placeholder.after(n),a&&this.$placeholder.css({width:0,padding:0})),r<o?i.after(this.placeholderElement):i.before(this.placeholderElement),this.disableAnimation||(a?this.animatePlaceholderWidth(n,this.$placeholder,l,200):this.$placeholder.data("need-animation",!0)),this.lastDroppable=t,!1}},animatePlaceholderWidth:function(e,t,i,s){this.isAnimating=!0,r.animate(e,dth:0},s,"easeInOutQuart",n.bind(function(){e.remove(),this.is")},cancelEvent:function(e){this.$currentlyDraggedItem&&e.preventDefault()},dropItem:function(e){return this.$currentlyDraggedItem&&this.renderedPlaceholder&&this.placeholderElement&&(e.stopPropagation(),this.$currentlyDraggedItem.insertAfter(this.placeholderElement)),!1},resetPlaceholder:function(e){this.renderedPlaceholder=!1,this.placeholderElement=null,this.$currentlyDraggedItem&&(this.$currentlyDraggedItem.removeClass("sortable-dragging").show(),this.$currentlyDraggedItem=null,this.$placeholder.detach(),e.stopPropagation(),this.afterDragEnd(),this.tretPlaceholder:function(e){return this.dropItem(e),this.resetPlaceholder(e)},sequence:function(){var e=this.$(this.itemSelector).toArray();return n.uniq(n.pluck(e,"id"))},reloadItems:function(){return this.$items=this.$(this.itemSelector),n.each(this.$items,function(e){e.draggable=!0,s(e).find("a").attr("draggable",!1),s(e).find("img").attr("draggable",!1)}),this.delegateEvents(this.itemEvents(sableItems:function(){return n.each(this.$items,function(e){e.draggable=!1}),this.undelegateEvents(),this},teardown:function(){return this.undelegateEvents(),this.scrollable&&this.$el.off(["dragenter."+this.cid,"dragover."+this.cid].join(" ")),n.each(this.$items,function(e){s(e).add("a, img",e).removeAttr("draggable")}),this.$items=null,this.$placeholder=null,this.beforeDragStart=null,this.afterDragEnd=null,this.calculateDropTarget=null,this}});e.exports=a},,,,,,,,,,,,,,,function(e,t,i){"use strict";var n=i(332);e.exports=n},function(e,t,i){"use strict";var n=i(226),s=i(333),o=n.extend({className:"knight-rider-container",template:s,defaults:{variation:"",loading:!1},_onChangeLoading:function(e,t){this.$el.toggleClass("loading",t),this.$el.find("[data-js-knightRider]").toggleClass("animate",t),this.$el.toggle(t)},afterRender:function(){this._onChangeLoading(this,this.get("loading")),this.listenTo(this,"change:loading",this._onChangeLoading)}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="knight-rider-loader '+__e(variation)+'" data-js-knightrider><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div><div class="knight-rider-bar"></ata=this.model.toJSON()),n.isObject(t)&&(e=n.extend(e,t)),e}});e.exports=o},,,,,function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(192),r=i(354),a=2e3,l=i(215),a=2e3,c=function(e,t,i){this.name="EmbedError",this.message=e,this.input=t,this.data=i,this.stack=(new Error).stack};c.prototype=new Error;var u=l.extend({constructor:function(e){this.setEmbedRegexes(e||[])},setEmbedRegexes:function(e){this.regexes=e,this.services=n.unique(n.values(e))},isValidEmbedService:function(e){return n.any(this.regexes,function(t,i){return new RegExp(i,"mi").test(e)})},isValidEmbedServiceName:function(e){return n.contains(this.services,e)},getUrlFromEmbedCode:function(e){var t=s(r.nodeFromString(e)),i=t.find("iframe[src], embed[src], script[src]").first(),n=t.find("object[data]").first();return i.attr("src")||n.attr("data")||!1},fetchEmbedData:function(e,t,i){var r=s.ajax({url:"/svc/post/get_video_data",type:"POST",withFormKey:!0,data:JSON.stringify({embed_url:e,embed_width:t})});return o(r).then(n.bind(function(s){if(n.isEmpty(s)||"false"===s||!n.isPlainObject(s))throw new c("Invalid embed response",e,s);if(s.thumbnail||i)return s;var r=n.bind(this.fetchEmbedData,this,e,t,!0);return o.promise(function(e,t){n.delay(function(){r().then(function(e){return e},function(){return s})},a)})},this)).catch(function(e){return o.reject(e)})},parseEmbedData:function(e,t){if(!n.isString(e))throw"The input is invalid. Expected a string";var i=n.trim(e);if(this.isValidEmbedService(i))return this.fetchEmbedData(i,t);var s=this.getUrlFromEmbedCode(i);return n.isEmpty(s)?o.reject(new c("Invalid embed code",e)):o.resolve({unsupported:!0,thumbnail:!1,embed_render_context:"blank",url:s,preview_iframe:"",embed_code:e})}});e.exports=new u},function(e,t,i){"use strict";function n(e){var t=document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t.body}function s(e){var t=document.implementatidy.appendChild(e.cloneNode(!0)),t.body}function o(e){return s(e).innerHTML}function r(e){var t,i=document.implementation.createHTMLDocument("");return i.body.innerHTML=e,t=i.body.textContent||i.body.innerText||"",t=t.trim()}e.exports={nodeFromString:n,wrapNode:s,outerHTML:o,stripTags:r}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(214),r=i(136),a=i(428),l=[],c=o.extend({name:"CrtControl",maxLoopTime:10,playerSelector:"[data-crt-video]",peeprOpen:!1,initialize:function(e){e=e||{},this.listenTo(r,"CrtControl:newPlayer",this.playerFactory,this),this.listenTo(r,"DOMEventor:flatscroll",n.throttle(this.onScroll,500),this),this.listenTo(r,"peepr:close",this.onPeeprClose,this),this.listenTo(r,"peepr:open",this.onPeeprOpen,this)},onPeeprOpen:function(){this.peeprOpen=!0},onPeeprClose:function(){this.peeprOpen=!1},findPlayers:function(e){var t=s(this.playerSelector);t.length&&this.playerFactory(t,e)},playerFactory:function(e,t){n.defer(n.bind(function(){n.each(e,function(e){this.newPlayer(e,t)},this)},this))},newPlayer:function(e,t){if(e.player)return e.player;var i=new a(e,t);return l.push(i),i.render(),this.bindPlady",this.onPlayerReady),this.listenTo(e,"teardown",this.onPlayerTeardown)},onPlayerReady:function(){this.playInViewport()},onPlayerTeardown:function(e){if(e=n.where(l,{_id:e._id}),e.length){var t=n.indexOf(l,e[0]);t>-1&&(e=l.splice(t,1))}},onScroll:function(){this.playInViewport()},pauseAutoplaying:function(){n.each(l,function(e){e.get("autoplay")&&e.get("loaded")&&e.pause()})},getInViewport:function(){var e=this;return n.filter(l,function(t){return!(!t.watcher||e.peeprOpen&&!t.get("isInPeepr"))&&(t.watcher.isFullyInViewport&&t.$el.is(":visible"))})},playInViewport:function(){var e=this.getInViewport();if(e.length){var t=e[0];t.get("paused")&&t.get("autoplay")&&(this.pauseAutoplaying(),t.play())}}});e.exports=new c},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(138),r=i(429),a=i(215),l=i(230),c=i(180),u=i(136),h=i(430),d=i(431),p=a.extend({mixins:[l],defaults:{loaded:!1,paused:!0,muted:!0,autoplay:!1,_preload:!1,_preloadThreshold:10,loop:!0,autoheight:!1,watch:!0,duration:0,hideFullscreen:!1,_elapsed:0,_position:0,_startSeekJumpTime:null,minLoopDuration:0,isAd:!1,isInPeepr:!1,isFullscreen:!1},classNames:{base:"crt-video crt-skin-default",autoplay:"crt-state-autoplaying",autoheight:"crt-autoheight",hideFullscreen:"crt-hide-fullscreen-toggle"},constructor:function(e,t){this._id=n.uniqueId("crtplayer"),this.initialize(e,t)},initialize:function(e,t){t||(t={}),n.isObject(t.attributes)&&this.set(t.attributes),this.video=e,this.$video=s(this.video);var i=this.$video.data("crt-options")||{};this.$video.removeAttr("data-crt-options"),this.vjsOptions=n.defaults({crt:this,crtOptions:i},t.vjsOptions||{}),i&&i.duration&&this.set("duration",i.duration),this.vjsOptions.crtOptions.lration",60)),r.write(function(){this.$video.addClass(this.classNames.base)},this)},render:function(){return r.write(function(){d(this.video,this.vjsOptions).then(n.bind(this.ready,this))},this),this},ready:function(e){this.player=e,this.player.muted(this.get("muted")),this.el=e.player_.el(),this.$el=s(this.el),this.$post=this.$el.closest(".post, .video-ad"),this.playerID=this.player.id_,this.hasLooped=!1,this._bindEvents(),this.setLoopState(!0),this.setAutoheightState(n.get(this.vjsOptions,"crtOptions.autoheight")),this.setFullscreenControl(!h.prop("requestFullscreen")),this.shouldForceHD()&&this.player.src({src:this.vjsOptions.crtOptions.hdUrl,type:"video/mp4"}),this.get("watch")&&this.setupWatcher()},_bindEvents:function(){this.listenTo(u,"peepr:open",this.pause),this.listenTo(u,"post:form:show",this.pause),this.listenTo(u,"post:docked:afterRender",this.onDockedAfterRender),this.on("change:autoplay",this.onChangeAutoplay,this),this.on("change:autoheight",this.onChangeAutoheight,this),this.on("change:duration",this.onChangeDuration,this),this.on("change:loop",this.onChangeLoop,this),this.on("change:muted",this.onChangeMuted,this),this.player.one("loadedmetadata",n.bind(this.onLoadedMetadata,this)),this.player.on("durationchange",n.bind(this.onUpdateDuration,this)),this.player.on("play",n.bind(this.onPlay,this)),this.player.on("pause",n.bind(this.onPause,this)),this.player.on("ended",n.bind(this.onEnded,this)),this.player.on("fullscreenchange",n.bind(this.onFullscreenChange,this)),this.player.on("error",n.bind(this.onError,this))},setupWatcher:function(){this.watcher=o.create(this.el,-100),this.watcher.fullyEnterViewport(n.bind(function(){this.trigger("fullyEnterViewport")},this)),this.watcher.partiallyExitViewport(n.bind(function(){this.trigger("partiallyExitViewport")},this)),this.watcher.exitViewport(n.bind(function(){this.trigger("exitViewport"),this.shouldAutoplay()&&this.pause()},this))},onClickPlayer:function(e){s(e.target).closest(".vjs-mute-control").length||s(e.target).closest(".vjs-fullscreen-control").length||this.pause(),this.set("autoplay",!1),this.set("muted",!1),this.$el.off("click.crtAutoPlay touchend.crtAutoPlay")},restart:function(){this.get("autoplay")&&(this.set("autoplay",!1),this.set("muted",!1),this.onTimeUpdate(),this.player.trigger({type:"restart",start:this.player.currentTime(),end:0}),this.player.currentTime(0))},pollTimeUpdate:function(){this.get("paused")||"undefined"==typeof this.player||null==this.player||(this.onTimeUpdate(),setTimeout(n.bind(this.pollTimeUpdate,this),150))},shouldAutoplay:function(){return!(!this.get("autoplay")||c.bool("is_mobile")||!this.$el.is(":visible")||!(this.get("duration")>this.get("minLoopDuration")||0===tion(){return!(!this.vjsOptions.forceHD||!this.vjsOptions.crtOptions.hdUrl)},play:function(e){e||(e={}),this.player.paused()&&(this.player.play(),e.skipLog||(e.type="userPlay",this.player.trigger(e)))},pause:function(e){e||(e={}),this.player.pausr("pause"))},onPlay:function(){this.set("paused",!1),this.p},onUpdateDuration:function(e){this.set("duration",this.player.duration())},onLoadedMetadata:function(e){var t=this.shouldAutoplay();this.setMutedState(t),this.setAutoplayState(t),t&&this.$el.on("click.crtAutoPlay touchend.crtAutoPlay",n.bind(this.onClickPlayer,this)),u.trigger("CrtPlayer:ready",this),this.trigger("playerReady",this),this.trigger("ready",this),this.set("loaded",!0)},onEnded:function(e){this.get("loop")===!0?(this.play({skipLog:!0}),this.player.trigger("loop"),this.get("autoplay")||this.hasLooped||(this.hasLooped=!0)):(this.pause({skipLog:!0}),this.player.trigger("end"))},onError:function(e){this.set("paused",!0),this.set("er("error",e)},onChangeAutoplay:function(e,t,i){this.setAutoplayState(t,i)},onetAutoheightState(t)},onChangeDuration:function(e,t){this.setLoopState(!0)},onChangeLoop:function(e,t){this.setLoopState(t)},onChangeMuted:function(e,t){this.player.muted(t)},onFullscreenChange:function(){this.$post.hasClass("docked")&&(this.player.isFullscreen()?(this.cached_top=this.$el.position().top,this.$el.css("top",0)):this.$el.css("top",this.cached_top))},onDockedAfterRender:function(e){n.isEmpty(e.embedID)||this.playerID===e.embedID&&this.player.trigger("CRTPlayer:updateDimensions")},setLoopState:function(e){n.isUndefined(e)&&(e=this.get("loop")),this.set("loop",e),"undefined"!=typeof this.get("duration")&&this.get("duration")<=this.get("minLoopDuration")&&this.set("loop",!1)},setMutedState:function(e){n.isUndefined(e)&&(e=this.get("muted")),this.set("muted",e)},setAutoplayState:function(e){n.isUndefined(e)&&(e=this.get("autoplay")),this.set("autoplay",e),this.toggleAttrClass("autoplay",e),!e&&this.get("duration")&&this.setLoopState(!0)},setAutoheightState:function(e){(n.isUndefined(e)||n.isNull(e))&&(e=this.get("autoheight")),this.set("autoheight",e),this.toggleAttrClass("autoheight",e)},setFullscreenControl:function(e){n.isUndefined(e)&&(e=this.get("hideFullscreen")),this.set("hideFullscreen",e),this.toggleAttrClass("hideFullscreen",e)},onTimeUpdate:function(){var e=.3,t=this.get("_position"),i=this.player.currentTime(),n=Math.abs(t-i);n<e&&this.set("_elapsed",this.get("_elapsed")+n),this.set("_position",i),this.set("_startSeekJumpTime",i)},getStartSeekJumpPosition:function(){return this.get("_startSeekJumpTime")},position"))},getElapsed:function(){return Math.floor(this.get("_elapsed"))},toggleAttrClass:function(e,t){this.classNames[e]&&r.write(function(){this.$el.toggleClass(this.classNames[e],t)},this)},teardown:function(){this.trigger("teardown",this),this.off(),this.stopListening(),this.watcher&&(this.watcher.destroy(),this.watcher=null),this.player&&(this.player.dispose(],this.lastId=0,this.raf=n,this.batch={hash:{},read:[],write:[],mode:null}}var n=window.requestAnimationFrame||window.webkitRequestAnimaow.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)};i.prototype.read=function(e,t){var i=this.add("read",e,t),n=i.id;this.batch.read.push(i.id);var s="reading"===this.batch.mode||this.batch.scheduled;return s?n:(this.scheduleBatch(),n)},i.prototype.write=function(e,t){var i=this.add("write",e,t),n=this.batch.mode,s=i.id;this.batch.write.push(i.id);
var o="writing"===n||"reading"===n||);var n=this,s=e-1.batch[t.type],n=i.indeFrame=function(e){var t=the(0,function(){e.batch.scheduled=!1,e.runBatch()}),this.batch.scheduledtype.flush=function(eh(this.batch.wri){var n=this.uniid],!this.onError)return i.call(t);try{i.call(t)}catch(e){this.onError(e)}},i.prototype.loop=function(){var e=this,t=this.raf;this.looping||(t(function i(){var n=e.frames.shift();e.fram{return this.frames[e]?this.schedule(e+1,t):(this.loop(),this.frames[e]=t)},t=t||new i,"undefined"!=typeof e&&e.exports?e.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):window.fastdom=t}(window.fastdom)},function(e,t,i){"use strict";var n=i(3),s=i(215),o={requestFullscreen:["requestFullScreen"]},r=s.extend({vendors:["moz","webkit","ms","o","khtml"],cssPrefixes:["-moz-","-webkit-","-ms-","-o-","",""],el:document.body||document.documentElement,get:n.memoize(function(e){var t=this._getProp(e);return!t&&o[=this._getProp(e);i&&(t=i)},this),t}),prop:function(e){return!!this.get(e)},cssFilters:n.memoize(function(){var e=document.createElement("div");return e.style.cssText=this.cssPrefixes.join("filter:blur(5px); "),!!e.style.length}),positionSticky:n.memoize(function(){var e=document.createElement("div");return e.style.cssText=this.cssPrefixes.join("position: sticky; "),!!e.style.length}),_getProp:function(e){var t=!1;return"string"==typeof this.el[e]?e:"string"==typeof this._styles()[e]?e:(e=e.charAt(0).toUpperCase()+e.substr(1),n.forEach(this.vendors,function(i){var n=i+e;n in this.el&&(t=n),n in this._styles()&&(t=n)},this),t)},_styles:n.memoize(function(){return this.el.style})});e.exports=new r},function(e,t,i){"use strict";function n(e,t){var i=s.merge({},p(),t);t.crtOptions.techOrder&&(i.techOrder=t.crtOptions.techOrder);var n=r.defer(),l=function(){var e;t.src&&t.type?(this.src(t),n.resolve(this)):t.file?(e=t.file.type||"video/mp4",this.src({src:a(t.file),type:e}),n.resolve(this),delete t.file):n.resolve(this)},c=o(e,i,l);return"function"==typeof c.skippy&&c.skippy(),n.promise}var s=i(3),o=i(432);window.videojs=o;var r=i(192),a=i(433),l=i(434),c=i(439),u=i(440);o.registerComponent("BigPlayToggle",i(441)),o.registerComponent("AnimatingMuteToggle",i(442)),o.registerComponent("CrtSeekBar",i(444)),o.registerComponent("LoadingSpinner",i(445)),o.registerComponent("HDToggle",i(446)),o.registerComponent("CrtDurationDisplay",i(447)),o.log=s.noop,o.log.error=s.noop,o.log.warn=s.noop,o.log.history=[];var h=function(e){this.crt=this.options_.crt,this.options_.crt=null,this.hoverSlider=new l(this,e),this.detectBuffering=new c(this,e),this.eventDispatcher=new u(this,e)};o.plugin("crt",h);var d,p=function(){return d||(d={children:["mediaLoader","posterImage","bigPlayToggle","loadingSpinner",{name:"controlBar",children:["playToggle","timeDivider","crtDurationDisplay",{name:"progressControl",children:["crtSeekBar"]},"fullscreenToggle","hDToggle","animatingMuteToggle"]},"errorDisplay"],hls:{withCredentials:!1},plugins:{crt:{}},crtOptions:{filmstrip:!1,hdUrl:!1,duration:null,livestream:!1},controls:!0,autoplay:!1,volume:.8,muted:!0,techOrder:["html5"]}),d};e.exports=n},,function(e,t){"use strict";var i=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL;e.exports=i},function(e,t,i){"use strict";var n=i(3),s=i(432),o=i(435),r=i(436),a=i(437),l=i(438),c=s.extend(o,{elSelector:".vjs-progress-holder",initialize:function(e,t){this.children={},this.$el=this.$$(this.elSelector),this.createChildren(),this.$player.on("mousemove.sliderHover",this.elSelector,n.bind(this.onMouseMove,this)),this.$player.on("mouseenter.sliderHover",this.elSelector,n.bind(this.onMouseEnter,this)),this.$player.on("mouseout.sliderHover",this.elSelector,n.bind(this.onMouseOut,this)),this.player.on("dispose",n.bind(this.dispose,this))},createChildren:function(){this.children.hoverSliderHandle=new r(this.player),this.children.hoverSliderTime=new a(this.player),this.player.options_.crtOptions.filmstrip&&(this.$el.addClass("with-filmstrip"),this.children.progressBarTooltip=new l(this.player)),this.appendChildren()},appendChildren:function(){n.each(this.children,updateChildren:function(e){n.each(this.children,function(t){t.update(e)})},onMouseMove:function(e){this.$el.removeClass("auto-hide");var t=this.$el.offset(),i=this.$el.width(),n=e.pageX-t.left,s=Math.max(0,Math.min(1,(e.pageX-t.left)/i)),o=s*this.player.player().duration(),r=o/this.player.player().duration();n<0?n=0:n>i&&(n=i),this.updateChildren({hoverX:n,hoverTime:o,hoverPercent:r})},onMouseOut:function(e){this.$el.addClass("auto-hide")},onMouseEnter:function(e),dispose:function(){n.each(this.children,function(e){n.result(e,"dispose")}),o.prototype.dispose.apply(this,arguments)}});e.exports=c},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(432),r=o.getComponent("Component"),a=o.extend(r,{constructor:function(e,t){this.options=t||{},this.player=e,this.$player=s(this.player.el()),this._selectorCache(),this.player.on("dispose",n.bind(this.dispose,this)),this.player.ready(n.bind(function(){this.initializeCache:function(){this.$$=n.memoize(e)},n.identity),this.$$.remove=n.bind(function(e){this.$$.cache.delete(e)},this),this.$$.clear=n.bind(function(){this.$$.cache=new n.memoize.Cache},this)},initialize:function(){},dispose:function(){this.$$.clear(),this.$player.off()}});e.exports=a},function(e,t,i){"use strict";var n=i(8),s=i(432),o=i(435),r=s.extend(o,{seeking:!1,render:function(){return this.$el=n('<div class="vjs-hover-handle vjs-slider-handle" aria-live="off"><span class="vjs-control-text"></span></div>'),this},update:function(e){e||(e={}),this.$time_el=this.$time_el||this.$el.find(".vjs-hover-handle-time");var t=e.hoverX||0,i=e.hoverTime||"0:00",n=s.formatTime(i);this.$time_el.html(n),this.$el.css("left",t+"px")}});e.exports=r},function(e,t,i){"use strict";var n=i(8),s=i(432),o=i(435),r=s.extend(o,{render:function(){return this.$el=n('<div class="vjs-hover-slider-time" aria-live="off"></div>'),this},update:function(e){e||(e={});var t=e.hoverX||0,i=e.hoverTime||"0:00",n=s.formatTime(i);this.$el.html(n),this.$el.css("left",t+"px")}});e.exports=r},function(e,t,i){"use strict";var n=i(8),s=i(432),o=i(435),r=s.extend(o,{filmstrip_thumbnail_count:10,render:function(){var e=this.player.options_.crtOptions.filmstrip,t=e.url,i=.5*e.width,s=.5*e.height,o=6;return this.$el=n('<div class="crt-progress-tooltip"></div>'),this.$thumbnail=n('<div class="crt-progress-tooltip-thumbnail"></div>'),this.$el.css({transform:"translateX(-50%)",width:i+o+"px",height:s+o+"px"}),this.$thumbnail.css({width:i+"px",height:s+"px","background-image":"url("+t+")","background-size":i*this.filmstrip_thumbnail_count+"px "+s+"px"}),this.$el.append(this.$thumbnail),this},update:function(e){e||(e={});var t=e.hoverX||0;this.$el.css("left",t+"px");var i=isNaN(e.hoverPercent)?0:100*e.hoverPercent,n=100/(this.filmstrip_thumbnail_count-1),s=Math.floor(i/this.filmstrip_thumbnail_count)*n;this.$thumbnail.css("background-position",s+"% 0%")}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(432),o=i(435),r=s.extend(o,{elSelector:".vjs-progress-holder",lastPlayPosition:0,currentPlayPosition:0,lastWaitedTime:0,buffering:!1,polling:!1,interval:100,initialize:function(e,t){this.player.on("play",n.bind(this.startPolling,this)),this.player.on("ended",n.bind(this.stopPolling,this)),this.player.on("pause",n.bind(this.stopPolling,this)),this.player.one("dispose",n.bind(this.stopPolling,this))},checkBuffering:function(){this.currentPlayPosition=this.player.currentTime();var e=1/this.interval;if(!this.buffering&&this.currentPlayPosition<this.lastPlayPosition+e&&!this.player.paused()&&(this.lastWaitedTime=n.now(),this.$player.trigger("waiting"),this.buffering=!0),this.buffering&&this.currentPlayPosition>this.lastPlayPosition+e&&!this.player.paused()){var t=n.now()-this.lastWaitedTime;this.$player.trigger("stopwaiting",{timeWaited:t}),this.buffering=!1}this.lastPlayPosition=this.currentPlayPosition},tick:function(){this.polling&&(this.chal))},startPng||(this.polling=!0,this.tick())},stopPolling:function(e){this.polling=!1}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(432),r=i(136),a=i(180),l=i(435),c=o.extend(l,{videoConversionLogged:!1,loggingInProgress:!1,startSeekTime:null,loadStartTime:0,triggerElement:s(),initialize:function(e,t){this.player.crt.on("playerReady",n.bind(function(){this.setPlayerData(),this.bindEvents(),this.cacheUnloadData(),this.playerData.duration=this.player.duration(),this.player.options_.crtOptions["hls-service"]&&(n.isFinite(this.playerData.duration)?this.playerData.type="replay":this.playerData.type="live")},this)),this.$doc=s(document)},setPlayerData:function(){var e=this.player.crt.$post.data("json");if(this.playerData={postData:e,platform:"web",app_version:null,type:"video",post_id:null,root_post_id:null,blog_uuid:null,vendor:null,duration:this.player.crt.get("duration"),time_elapsed:null},"undefined"!=typeof e)this.playerData.post_id=e["post-id"],this.playerData.root_post_id=e.root_id,this.playerData.blog_uuid=e.tumblelog;else{var t=this.player.options_.crtOptions;"undefined"!=typeof t["iframe-post-data"]&&(this.playerData.post_id=t["iframe-post-data"].post_id,this.playerData.blog_uuid=t["iframe-post-data"].blog);var i=t["hls-service"];i&&(this.playerData.type="live",this.playerData.vendor=i)}},bindEvents:function(){this.$player.on("mousedown touchstart",n.bind(this.setTriggerElement,this)),this.player.on("userPlay",n.bind(this.onUserPlay,this)),this.player.on("play",n.bind(this.onVJSPlay,this)),this.player.on("pause",n.bind(this.onVJSPause,this)),this.player.on("loop",n.bind(this.onLooped,this)),this.player.on("end",n.bind(this.onVideoEnded,this)),this.player.on("restart",n.bind(this.onRestart,this)),this.player.on("muteClicked",n.bind(this.onMuteClicked,this)),this.player.on("fullscreenchange",n.bind(this.onFullscreenChange,this)),this.player.on("error",n.bind(this.onError,this)),this.player.on("seeking",n.bind(this.onSeeking,this)),this.player.on("resolutionchange",n.bind(this.onResolutionChange,this)),this.player.on("timeupdate",n.bind(this.onTimeUpdate,this)),this.$player.on("stopwaiting",n.bind(this.onStopWaiting,this)),this.player.on("firstplay",n.bind(this.onLoadStart,this)),this.player.on("loadeddata",n.bind(this.onLoadedData,this))},triggerEvent:function(e,t){t=this._buildLoggingData(t),r.trigger("VideoPlayer:"+e,{loggingData:t})},_buildLoggingData:function(e){return e=n.extend({},this.playerData,e),e.time_elapsed=this.player.crtosition(),e},siggerElement=s(e.target)},onLogComplete:function(){this.triggerElement=s()},cacheUnloadData:function(){this.triggerEvent("cacheUnload")},onError:function(e){var t=this.player.error(),i="MEDIA_ERR_CUSTOM";if(t){switch(t.code){case 1:i="MEDIA_ERR_ABORTED";break;case 2:i="MEDIA_ERR_NETWORK";break;case 3:i="MEDIA_ERR_DECODE";break;case 4:i="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:i="MEDIA_ERR_ENCRYPTED"}this.triggerEvent("failed",lay:function(e){this.onPlay(!0,e)},onVJSPlay:function(e){this.onPlay(!1,e)},onPlay:function(e,t){if(e||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length){var i=this.player.crt.get("autoplay"),n={};t.onDock&&(n.onDock=!0),this.logConversion({name:"CONVERSION_ACTION_HTML5_VIDEO",extra:{player:this.player.techName,player_version:2}}),this.triggerEvent(i?"auto_play":"play",n),this.onLogComplete()}},onVJSPause:function(){this.onPause(!1)},onPause:function(e){(e||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length)&&(this.triggerEvent("pause",this.playerData),this.onLogComplete())},onLooped:function(){this.triggerEvent("loop")},onVideoEnded:function(){this.triggerEvent("end")},onRestart:function(e){var t=n.pick(e,["start","end"]);this.triggerEvent("restart",t)},onFullscreenChange:function(){var e=this.player.isFullscreen();this.triggerEvent("fullscreen",{fullscreen:e}),this.player.crt.set("isFullscreen",e),this.onLogComplete()},onMuteClicked:function(){var e=this.player.muted()?"mute":"unmute";this.triggerEvent(e),this.player.crt.set("muted","mute"===e),this.onLogComplete()},onSeeking:function(){if(0!==this.triggerElement.closest(".vjs-progress-control").length){this.startSeekTime||(this.startSeekTime=this.player.crt.getStartSeekJumpPosition());var e={start:this.startSeekTime};this.triggerEvent("scrub_start",e),this.$doc.one("mouseup.crtEvents touchend.crtEvents",n.bind(this.onSeeked,this))}},onSeeked:function(){if(this.startSeekTime){var e={start:this.startSeekTime,end:this.player.currentTime()};this.triggerEvent("scrub_stop",e),this.startSeekTime=null}},onTimeUpdate:function(){this.triggerEvent("timeupdate")},onResolutionChange:function(e){var t=n.pick(e,"resolution");this.triggerEvent("resolutionchange",t)},onStopWaiting:function(e,t){!t.timeWaited||t.timeWaited<2e3||this.triggerEvent("waiting",t)},onLoadStart:function(){this.loadStartTime=n.now()},onLoadedData:function(){var e=n.now()-this.loadStartTime;this.triggerEvent("initialLoad",{loadTime:e})},logConversion:function(e){if(!this.videoConversionLogged&&a.bool("is_logged_in")&&!this.loggingInProgress){this.loggingInProgress=!0;var t=s.ajax({url:"/svc/log/conversion",type:"POST",contentType:"application/x-www-form-urlencoded",withFormKey:!0,data:"log="+JSON.stringify(e)});t.done(n.bind(this.onConversionSuccSuccess:function(){this.videoConversionLogged=!0,this.loggingInProgress=!1},onConversionFail:function(){this.loggingInProgress=!1}});e.exports=c},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(432),r=i(220).animation,a=o.getComponent("ClickableComponent"),l=o.extend(a,{constructor:function(){a.prototype.constructor.apply(this,arguments),this.player().usingNativeControls()&&this.player().controls(!1)},createEl:function(){return a.prototype.createEl.call(this,"div",{className:"vjs-big-play-button",innerHTML:'<span class="vjs-big-play-button-icon"></span><span class="vjs-big-pause-button-icon"></span></span><span aria-hidden="true"></span>'},{"aria-label":"play video"})},handleClick:function(){this.$el=this.$el||n(this.el()),this.player_.userActive(!0),this.player().usingNativeControls()?this.player().paused()&&(this.player().play(),this.playerr(this.$el,s.bind(function(e){this.$el.removeClass("poof-play poof-pause")},this)),this.player().paused()?(this.player().play(),this.$el.removeClass("poof-pause").addClass("poof-play")):(this.player-pause"))},ready:function(){"Flash"===this.player().techName_&&this.hide()}});e.exports=l},function(e,t,i){"use strict";var n=i(432),s=i(443),o=n.getComponent("MuteToggle"),r=n.getComponent("ClickableComponent"),a=n.extend(o,{constructor:function(e,t){o.prototype.constructor.call(this,e,t),this.addListeners(e)},addListeners:function(e){this.on("click",this.onMuteClick)},onMuteClick:function(){this.player_.trigger("muteClicked")},createEl:function(){var e="vjs-mute-control vjs-control";return this.player_.options_.muted&&(e+=" vjs-vol-0"),r.prototype.createEl.call(this,"div",{className:e,innerHTML:s()},{})},update:function(){var e=this.player_.volume(),t=3;0===e||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2),this.controlText(this.player_.muted()?"Unmute":"Mute");for(var i=0;i<4;i++)n.removeClass(this.el_,"vjs-vol-"+i);n.addClass(this.el_,"vjs-vol-"+t)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="mute-icon"><div class="speaker"></div><div class="unmuted"></div><div class="muted"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(432),s=i(3),o=n.getComponent("SeekBar"),r=n.extend(o,{constructor:function(){o.prototype.constructor.apply(this,arguments),this.handle=document.createElement("div"),this.handle.className="vjs-seek-handle vjs-slider-handle",this.handle.setAttribute("aria-live","off"),this.el_.appendChild(this.handle),this.boundDetectDuration=s.bind(this.detectDuration,this),tunction(e){o.prototype.handleMouseMove.apply(this,arguments),this.update()},detectDuration:function(){s.isFinite(this.player().duration())||null==this.el_||this.dispose()},update:function(){if(this.el_){var e=this.getPercent();isNaN(e)&&(e=0);var t=(100*e).toFixed(2)+"%";this.handle.style.left=t,this.bar.el().style.width=t}},dispose:function(){this.player().off("loadedmetadata",this.boundDetectDuration),o.prototype.dispose.apply(this,arguments)}});e.exports=r},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(432),r=o.getComponent("Component"),a=o.extend(r,{isHidden:!0,constructor:function(e,t){r.call(this,e,t),e.ready(s.bind(this.onReady,this))},onReady:function(){this.$player=n(this.player().el_),this.$el=n(this.el()),this.$loader=this.$el.find(".Knight-Rider-loader");var e=s.bind(this.hideLoader,this),t=s.bind(this.showLoader,this);this.player().on("waiting",t),this.player().on("canplay",e),this.player().on("canplaythrough",e),this.player().on("playing",e),this.player().on("seeking",t),this.player().on("seeked",e),this.player().on("ended",e),this.player().on("resolutionchange",t)},createEl:function(){return r.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",innerHTML:'<div class="Knight-Rider-loader centered"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>'},{"aria-label":"loading"})},hideLoader:function(e){return this.isHidden?this:(this.$loader.removeClass("animate"),this.$player.removeClass("vjs-loading"),this.isHidden=!0,this)},showLoader:function(e){return this.isHidden?(this.$loader.addClass("animate"),this.$player.addClass("vjs-loading"),this.isHidden=!1,this):this},dispose:function(){r.prototype.dispose.apply(this,arguments),this.$player=null,this.$el=null}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(432),o=s.getComponent("Component"),r=s.extend(o,{sdURL:nul:function(e,tListeners(e)},addListeners:function(e){this.on("click",this.toggleHDState)},createEl:function(){if(this.hdURL=this.player_.options_.crtOptions.hdUrl,this.forceHD=this.player_.options_.forceHD,!this.hdURL||this.forceHD)return o.prototype.createEl.call(this,"div",{},{});this.player_.addClass("vjs-has-hd-toggle");var e=o.prototype.createEl.call(this,"div",{className:"vjs-hd-toggle vjs-sd vjs-menu-button vjs-control",innerHTML:"<span>HD</span>"},{});return e},currentSource:function(){return this.player_.currentSrc()},toggleSrc:function(){var e;this.isUsingSD?(this.sdURL=this.currentSource(),e=this.hdURL,s.removeClass(this.el_,"vjs-sd"),s.addClass(this.el_,"vjs-hd")):(e=this.sdURL,s.removeClass(this.el_,"vjs-hd"),s.addClass(this.el_,"vjs-sd")),this.isUsingSD=!this.isUsingSD,this.player_.src({src:e,type:"video/mp4"})},toggleHDState:function(){var e=this.player_.currentTime(),t=this.player_.paused(),i=this.player_.muted();this.player_.addClass("vjs-quality-toggling"),this.player_.trigger({type:"resolutionchange",resolution:this.isUsingSD?"hd":"sd"}),n.delay(n.bind(function(){this.player_.pause(),this.toggleSrc(),this.player_.ready(function(){this.player_.one("loadedmetadata",n.bind(function(){this.player_.currentTime(e)},this)),this.timeIntervalBinding=n.bind(function(){this.player_.currentTime()-e>.1&&(this.player_.removeClass("vjs-quality-toggling"),this.player_.off("timeupdate",this.timeIntervalBinding),t&&(this.player_.pause(),this.player_.muted(i)))},this),this.player_.on("timeupdate",this.timeIntervalBinding),n.defer(n.bind(function(){this.player_.load(),i===!1&&t===!0&&this.player_.muted(!0),this.player_.play()},this))})},this),300)}});e.exports=r},function(e,t,i){"use strict";var n=i(432),s=i(3),o=n.getComponent("DurationDisplay"),r=n.extend(o,{constructor:function(){o.prototype.constructor.apply(this,arguments),this.boundDetectDuration=s.bind(this.detectDuration,this),this.player().on("loadedmetadata",this.boundDetectDuration)},detectDuration:function(){s.isFinite(this.player().duration())||null==this.el_||this.dispose()},dispose:function(){this.player().off("loadedmetadata",this.boundDetectDuration),o.prototype.dispose.apply(this,arguments)}});e.exports=r},,,,,,,,,,,,,,function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(283),r=i(462),a=s.extend({className:"popover--gif-search",mixins:[o],defaults:{query:null},initialize:function(e){this.gifSearch=new r(n.pick(e,"collection","query","imageWidth","loadFullImageBeforeSelect","selectedIthis.listenTo(this,"change:query",function(e,t){this.gifSearch.setQuery(t)}),this.listenTo(this.gifSearch,"all",this.trigger)},render:function(){this.gifSearch.render().$el.appendTo(this.$el)},teardown:function(){return n.result(this.gifSearch,"remove"),this.$el.remove(),this}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(7),o=i(136),r=i(214),a=i(463),l=i(495),c=function(){};c.extend=s.Model.extend,n.extend(c.prototype,s.Events);var u=new c,h=r.extend({name:"ImageSearch",selector:"body",defaults:{resultLimit:200,imageWidth:250,loadFullImageBeforeSelect:!1,query:null,selectedImageUrl:null,loggingContext:null},initialize:function(e){e=e||{},n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"collection")),n.isEmpty(this.collection)&&(this.collection=new l),this.view=new a(n.extend({eventBus:u,collection:this.collection,query:this.get("query"),imageWidth:this.get("imageWidth"),loadFullImageBeforeSelect:this.get("loadFullImageBeforeSelect"),resultLimit:this.get("resultLimit"),selectedImageUrl:this.get("selectedImageUrl"),loggingContext:this.get("loggingContext")},this.viewOptions)),this.listenTo(u,"image:select",function(e,t){this.logGifSearchEvent("select",t),this.trigger("selectImage",e.toJSON(),this.getQuery())}),this.listenTo(u,"image:impression",function(e){this.logGifSearchEvent("impression",e)}),this.listenTo(u,"gifsearch:resultChange",function(e){this.logGifSearchResultChange("search",e)}),this.listenTo(this.view,"dismiss",function(){this.trigger("dismiss")})},render:function(){return this.view.render(),this.trigger("append"),this.view},setQuery:function(e){this.view.setQery()},getCurrentResults:function(){return this.view.get("currentResults")},logGifSearchEvent:function(e,t){var i={popularSearch:t.model.get("popularSearchTag")?t.model.get("popularSearchTag"):null,query:this.getQuery()?this.getQuery():null,resultsIndex:this.getCurrentResults().indexOf(t.model),top:Math.round(t.$el.position().top),left:Math.round(t.$el.position().left),postBlog:t.model.get("postBlog"),postId:t.model.get("postId"),context:this.get("loggingContext")};o.trigger("gifsearch:"+e,{loggingData:i})},logGifSearchResultChange:function(e,t){var i=this.getQuery();if(i){var n={query:i,context:this.get("loggingContext")};o.trigger("gifsearch:"+e,{loggingData:n})}}});e.exports=h},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(464),a=i(232),l=i(468),c=i(470),u=i(486),h=i(489),d=i(494),p=o.extend({className:"gif-search-container",template:d,mixins:[a],keycommands:{"keydown:tab":"_onKeyPressTab","keydown:shiBus,keyboardManager:e.keyboardManager,keyboardNamespace:"gifsearch:input"}}},searchResults:{constructor:c,options:function(e){return{imageWidth:e.get("imageWidth"),selectedImageUrl:e.get("selectedImageUrl"),loadFullImageBeforeSelect:e.get("loadFullImageBeforeSelect"),eventBus:e.eventBus,keyboardManager:e.keyboardManager,kearchMessage:{constructor:u,options:function(e){return{eventBus:e.eventBus}}}},defaults:{imageWidth:null,loadFullImageBeforeSelect:!0,resultLimit:200,selectedImageUrl:"",query:null,loggingContext:null,focusIndex:0,tabbingView:null},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","collection")),this.keyboardManager=new r({allowMultipleActiveViews:!0}),this.noResults=[s("Nothing turned up. Bummer."),s("Looked around but didn't see anything about that."),s("Sadly, nothing."),s("Tragically, nothing."),s("Welcome to the void. There is nothing here."),s("We found nothing. Here it isn't."),s("Couldn't find that. Please, don't be upset. Please."),s("Sincerely, we found nothing."),s("Maybe try a similar search but use different words? Dunno.")],this.listenTo(this,"change:query",this._onChangeQuery),this.listenTo(this.eventBus,"image:tag",function(e,t){this.set("query",e),this.searchInput.setValue(this.get("query"))}),this.listenTo(this.eventBus,"showHiddenResults",function(){this.searchResults.setCollection(this.get("currentResults")),this.hasResults()&&this.searchMessage.hide()})},afterRenderSubviews:function(){this.listenTo(this,"change:focusIndex",this._onChangeFocusIndex),this.listenTo(this.searchInput,"focus",this._onChangeFocusView),this.listenTo(this.searchResults,"focus",this._onChangeFocusView),this.listenTo(this.searchInput,"userQueryChanged",function(e){this.setQuery(e)}),this.loader=new h({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),n.isString(this.get("query"))&&(this._onChangeQuery(this,this.get("query")),this.searchInput.setValue(this.get("query"))),n.defer(n.bind(function(){this.rendered&&this.searchInput.focus()},this)),this._focusViews=[this.searchInput,this.searchResults],this._tabbableViews=[this.searchResults],thidManager.remove("gifsearch"),this.currentQuery&&this.currentQuery.reject()},hasResults:function(){return!(n.isEmpty(this.get("currentResults"))||n.isEmpty(this.get("currentResults").models))},dismiss:function(){this.trigger("dismiss")},_onKeyPressTab:function(e){e.preventDefault(),this._moveFocusDown()},_onKeyPressShiftTab:function(e){e.preventDefault(),this._moveFocusUp()},_moveFocusUp:function(){var e=this.get("tabbingView");e&&e.set("isFocused",!1),this.set("focusIndex",Math.max(0,this.get("focusIndex")-1))},_moveFocusDown:function(){var e=this._focusViews||[];this.set("focusIndex",Math.min(e.length-1,this.get("focusIndex")+1))},_onChangeFocusView:function(e){var t=this._focusViews,i=n.indexOf(t,e);this.set("tabbingView",n.contains(this._tabbableViews,e)?e:null),this.set("focusIndex",i)},_onChangeFocusIndex:function(e,t){var i=n.get(this._focusViews,t);this.set("tabbingView",n.contains(this._tabbableViews,i)?i:null),n.result(i,"focus")},_onChangeQuery:function(e,t){n.isString(t)&&(this.rendered&&this.loader.set("loading",!0),this.currentQuery&&this.currentQuery.reject(),this.searchResults.cancelPreloads(),this.searchResults.cancelFullImageLoads(),this.currentQuery=this.collection.fetchGifs(t,this.get("resultLimit"),this.get("loggingContext")),this.currentQuery.promise.then(n.bind(function(e){if(this.set("currentResults",e.media),this.rendered){this.loader.set("loading",!1);var t=e.get("message");t&&(t.header||t.body)?this.searchMessage.setMessage(t.header,t.body,this.hasResults()):(this.searchResults.setCollection(this.get("currentResults")),this.hasResults()?this.searchMessage.hide():this.searchMessage.setMessage("",n.sample(this.noResults),!1))}this.currentQuery=null},this)))},setQuery:function(e){this.set("query",e)},getQuery:function(){return this.get("query")}});e.exports=p},function(e,t,i){"use strict";var n=i(3),s=i(465),o=s.extend({name:"MessagingKeyboardManager",addKeyboardAccess:function(e){return!!n.isFunction(n.get(e,"soloKeys"))&&(e.enableKeys(),e.soloKeys(!0),!0)},removeKeyboardAccess:function(e){return!!n.isFunction(n.get(e,"unSoloKeys"))&&(e.disableKeys(),e.unSoloKeys(),!0)}});e.exports=o},function(e,t,i){"use strict";var n=i(3),s=i(214),o=i(466),r=s.extend({name:"BaseKeyboardManager",defaults:{isDebugEnabled:!1,keepInactiveItems:!0,allowMultipleActiveViews:!1},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),this.collection=new o,this.listenTo(this.collection,"add",this._onAddItem),this.listenTo(this.collection,"remove",this._onRemoveItem),this.listenTo(this.collection,"change:isActive",this._onItemActiveChange)},addKeyboardAccess:n.noop,removeKeyboardAccess:n.noop,add:function(e,t){return!(!e||!t)&&(!this.collection.get(e)&&(this.get("keepInactiveItems")||this.get("allowMultipleActiveViews")||this.collection.remove(this.collection.models),this.collection.unshift({namespace:e,view:t}),this._adjustActiveStates(),!0))},remove:function(e){var t=this.collection.getByNamespace(e);return!n.isEmpty(t)&&(this.collection.remove(t),this._adjustActiveStates(),!0)},toggle:function(e,t,i){return i?this.add(e,t):this.remove(e)},_onAddI,_onRemoveItem:function(e){return this.removeKeyboardAccess(e.get("view"))},_adjustActiveStates:function(){var e,t;0!==this.collection.length&&(e=this.collection.first(),t=this.collection.reget("allowMultipleActiveViews")||n.each(t,function(e){e.set("isActive",!1)},this))},_onItemActiveChange:function(e,t){return t?this.addKeyboardAccess(e.get("view")):this.removeKeyboardAccess(e.get("view"))}});e.exports=r},function(e,t,i){"use strict";var n=i(190),s=i(467),o=n.extend({model:s,getByNamespace:function(e){return this.filter(function(t){return this._isNamespaceMatch(e,t.get("namespace"))},this)},_isNamespaceMatch:function(e,t){return e===t||0===t.indexOf(e+":")}});e.exports=o},function(e,t,i){"use strict";var n=i(185),s=n.extend({idAttribute:"namespace",defaults:{namespace:null,view:null,isActive:!0}});e.exports=s},function(e,t,i){"use strict";var n=i(226),s=i(232),o=i(277),r=i(469),a=i(130),l=i(3),c=i(292),u=n.extend({className:"gif-search-input",template:r,mixins:[s,o],defaults:{isFocused:!1},events:{"focus [data-js-plainTextEditor]":"_onFocus","blur [data-js-plainTextEditor]":"_onBlur"},subviews:{textEditor:{constructor:c,options:function(e){return{forceSingleLine:!0,placeholder:a("Find a GIF"),syncWithModel:!1,onChange:l.debounce(l.bind(e._onUserChangeInput,e),250)
}}}},initialize:function(e){e=l.extend({},e),l.extend(this,l.pick(e,"eventBus","keyboardManager","keyboardNamespace"))},afterRender:function(){this.listenTo(this,"change:isFocused",this._onChangeIsFocused)},_onChangeIsFocused:function(e,t){t?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.keyboardManager.renction(){this.trigger("userQueryChanged",this.textEditor.getEditorValue())},focus:function(){this.textEditor.focus()},_onFocus:function(){this.set("isFocused",!0)},_onBlur:function(){this.set("isFocused",!1)},setValue:function(e){this.textEditor.setEditorValue(e)}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="textEditor"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=s.prototype,r=i(471),a=i(232),l=i(472),c=i(473),u=i(475),h=i(235),d=h.animate,p=h.hook,g=i(192),f=i(485),_=function(e){var t=Math.round(e.position().top),i=Math.round(t+e.height());return{top:t,bottom:i}},m=function(e,t){return!(t.bottom<e.top||t.top>e.bottom)},v=function(e,t){return t.bottom>=e.bottom&&t.top<=e.top},b=function(e){return{top:Math.round(e.scrollTop()),bottom:Math.round(e.scrollTop()+e.height())}},y=function(e,t){return Math.floor(t.position().top/e.height())},w=function(e){return Math.floor(e.scrollTop()/e.outerHeight(!0))},C=function(e){return Math.ceil(e.get(0).scrollHeight/e.height())},k=s.extend({className:"gif-search-results",template:l,mixins:[a,r],keycommands:{"keydown:down":"_onKeyPressDown","keydown:up":"_onKeyPressUp","keydown:enter":"_onKeyPressEnter"},subviews:{searchResults:{constructor:c,options:function(e){return{eventBus:e.eventBus,imageWidth:e.get("imageWidth"),onSelect:n.bind(e._onSubviewSelect,e),onClear:n.bind(e._onSubviewClear,e),loadFullImageBeforeSelect:e.get("loadFullImageBeforeSelect")}},collection:function(e){return e.collection}}},defaults:{renderBatchSize:50,renderBatchDelay:5,selectedImageUrl:"",imageWidth:null,loadFullImageBeforeSelect:!0,enablePreloading:!0,isPreloading:!1,preloadPollInterval:1e3,selectedView:null,isFocused:!1},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","collection","keyboardManager","keyboardNamespace")),this.keyboardViewName="searchResults"},setCollection:function(e){this.collection&&this.stopListening(this.collection),this.collection=e,this.eventBus.trigger("gifsearch:resultChange",this.collection),this.rendered&&this.render()},populatePreloadQueue:function(){this._preloadQueue=n.range(C(this.$el)),this.sortPreloadQueue()},sortPreloadQueue:function(){var e;n.isEmpty(this._preloadQueue)||(e=w(this.$el),this._preloadQueue=n.sortBy(this._prerPreloadQueue:function(){this._preloadQueue&&(this._preloadQueue.length=0)},processPreloadQueue:function(){var e,t;if(!this.get("isPreloading")){if(!this.rendered||n.isEmpty(this._preloadQueue))return void this.stopPreloadPoller();e=this._preloadQueue.shift(),t=this.getViewsAtPageIndex(e),this.set("isPreloading",!0),this.preloadSubviews(t).finally(n.bind(function(){this.set("isPreloading",!1)},this)).catch(n.noop)}},startPreloadPoller:function(){this.stopPreloadPoller(),this._preloadTimer=setInterval(n.bind(this.pr_preloadTimer&&(clearInterval(this._preloadTimer),this._preloadTimer=null)},renderCollectionSubviews:function(e){if("searchResults"!==e)return o.renderCollectionSubviews.apply(this,arguments);var t=this.subviews[e],i=t.container||n.bind(function(){return this.$('[data-subview="'+e+'[]"]')},this),s=t.prepareView||function(i,n){var s=new t.constructor(n);return s.$el.attr("data-subview",e),i.append(s.$el),s},r=t.options||{},a=t.collection;if(n.isFunction(a)&&(a=a(this)),!a)return null;var l=this.get("renderBatchSize._deferredRenders=n(a.models).groupBy(function(e,t){return Math.floor(t/l)}).toArray().map(function(t,o){return n.delay(this.createCollectionSubviewRenderer(t,i,s,r,e,!!o),o*c)},this).value()},hideViews:function(e){n.each(e,function(e){e.rendered&&(e.set("isSelectable",!1),e.$el.css("opacity",0))})},animateShowViews:function(e){var t=0;n.each(e,function(e){this.animateShowView(e,100*t++)},this)},animateShowView:function(e,t,i,s){var o,r=!1;s=n.isNumber(s)?s:250,t=n.isNumber(t)?t:0,i=n.isNumber(i)?i:1e3,p(e.$el,"translateY","40px");var a=function(){r=!0,d(e.$el,"stop"),d(e.$el,{translateY:0,opacity:1},{duration:s,delay:t,complete:n.bind(function(){e.rendered&&(e.set("isSelectable",!0),e.$el.css({transform:"",opacity:""}))},this)})};i>0&&(o=setTimeout(a,i)),eender:function(){this.$el.css("visibility","hidden"),this.removeSubviews()},afterRender:function(){this.collection&&0!==this.collection.length&&(this.listenTo(this.eventBus,"image:full:loading",this.cancelPreloads),this.listenTo(this,"change:selectedView",this._onChangeSelectedView),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this._setIsFocusedDebounced=n.debounce(n.bind(this._setIsFocused,this),0),n.defer(n.bind(function(){if(this.rendered){this._deferredRenders||(this._deferredRenders=[]);var e=n.delay(n.bind(this.resetMasonry,this),this.get("renderBatchDelay")*this._deferredRenders.length);this._deferredRenders.push(e),this.scrollbar?this.scrollbar.update():this.scrollbar=new f(this.$el)}},this)))},removeSubviews:function(){return n.forEach(this._deferredRenders,clearTimeout),this._deferredRenders=[],delete this.masonry,o.removeSubviews.apply(this,arguments)},resetMasonry:function(){this.setupMasonary(),this.setupElementCaches(),this.get("enablePreloading")&&(this.populatePreloadQueue(),this.startPreloadPoller()),this.setSelectedImage(),this.setupVirtualization();var e=this.getSubviewsInBounds();this.hideViews(e),this.$el.css("visibility",""),this.animateShowViews(e)},getViewBounds:function(e){return n.result(this._elementPositionCache,e.cid)?this._elementPositionCache[e.cid]:_(e.$el)},getSubviewsInBounds:function(e){return e=e||b(this.$el),n.filter(this.searchResults,function(t){return m(this.getViewBounds(t),e)},this)},setupMasonary:function(){this.masonry?this.masonry.reload():this.masonry=new u(this.$(".results-scroller").get(0),{transitionDuration:0,isFitWidth:!0,gutter:10},this)},setupElementCaches:function(){var e=this.$el;this._pageIndexCache={},this._elementPositionCache={},n.each(this.searchResults,function(t){var i=y(e,t.$el);n.isArray(this._pageIndexCache[i])||(this._pageIndexCache[i]=[]),this._pageIndexCache[i].pus,this)},getViewsAtPageIndex:function(e){retuction(){this.rendered&&(this.sortPreloadQueue(),this.virtualizeSubviews())},this),t=n.debounce(e,250);this.$el.off(".image-search-virtualization").on("scroll.image-search-virtualization",t),this.virtualizeSubviews()},setSelectedImage:function(){var e,t;if(this.get("selectedImageUrl")&&(t=n.find(this.searchResults,function(e,t){return e.model.get("mediaUrl")===this.get("selectedImageUrl")},this))){if(t.set("isPreselected",!0),e=t.$el.offset().top-this.$el.offset().top,0===e)return;e-=ancelPreloads:function(){this.stopPreloadPoller(),this.clearPreloadQueue()},cancelFullImageLoads:function(){this.eventBus.trigger("image:full:cancelLoad")},preloadSubviews:function(e,t){return g.all(n.map(e,function(e){return e.loadImage()}))},_virtualizeSubviews:function(e,t,i){n.forEach(this.searchResults,function(s,o){if(s&&s.$el){var r=this.getViewBounds(s);m(r,e)?n.isFunction(t)&&t.call(this,s,v(r,e)):n.isFunction(i)&&i.call(this,s)}},this)},virtualizeSubviews:function(){var e=this.$el,t={top:e.scrollTop(),bottom:e.scrollTop()+e.height()};this._virtualizeSubviews(t,function(e,t){e.set({isVirtualized:!1}),t&&e.get("isImpressionLogged")===!1&&(t,e),e.set("isImpressionLogged",!0))},function(e){e.set({isVirtualized:!0})})},beforeRemove:function(){this.$el.off(),this.cancelPreloads(),this.cancelFullImageLoads(),this.keyboardManager.remove(this.keyboardNamespace),this.scrollbar&&this.scrollbar.destroy()},_setIsFocused:function(e){this.rendered&&this.set("isFocused",e)},_onChangeSelectedView:function(e,t){var i=this.previous("selectedView");i&&i.setSelected(!1),t&&t.setSelected(!0)},_onChangeIsFocused:function(e,t){t?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.set("selectedView",null),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onSubviewSelect:function(e){this.get("isFocused")||this._setIsFocused(!0),this.setSelectedIndex(this.keyboardViewName,n.indexOf(this.searchResults,e)),this.set("selectedView",this.getSelectedView(this.keyboardViewName))},_onSubviewClear:function(){this.set("selectedView",null),this.deselect(this.keyboardViewName)},focus:function(){var e=this.get("selectedView"),t=!n.isEmpty(e);this._setIsFocused(!0),t?this.setSelectedIndex(this.keyboardViewName,n.indexOf(this.searchResults,e)):this.set("selectedView",this.selectFirst(this.keyboardViewName))},isLastViewSelected:functiViewSelected:function(){return this.isFirstSelected(this.keyboardViewName)},_onKeyPressDown:function(e){var t;e.preventDefault(),t=this.isLastViewSelected()?this.selectFirst(this.keyboardViewName):this.selectNext(this.keyboardViewName),this.set("selectedView",t)},_onKeyPressUp:function(e){var t;e.preventDefault(),t=this.isFirstViewSelected()?this.selectLast(this.keyboardViewName):this.selectPrevious(this.keyboardViewName),this.set("selectedView",t)},_onKeyPressEnter:function(e){var t=this.get("selectedView");e.preventDefault(),t&&t.select(e)}});e.exports=k},function(e,t,i){"use strict";var n=i(3),s=i(187),o=new s({defaults:{hasSelection:function(e){return this._validateParams(e)?n.has(this._selectedIndexes,e):null},getSelectedIndex:function(e){return this._validateParams(e)?n.get(this._selectedIndexes,e,0):null},deselect:function(e){this._validateParams(e)&&this.hasSelection(e)&&delete this._selectedIndexes[e]},resetSelected:function(e){this._validateParams(e)&&this.setSelectedIndex(e,0)},setSelectedIndex:function(e,t){var i;return this._validateParams(e)?(i=n.get(this,e,[]),t=Math.max(0,Math.min(t,i.length-1)),n.set(this._selectedIndexes,e,t),t):null},getSelectedView:function(e){var t;return this._validateParams(e)?(t=n.get(this,e,[]),n.get(t,this.getSelectedIndex(e))):null},isFirstSelected:function(e){return this._validateParams(e)?0===this.getSelectedIndex(e):null},isLastSelected:function(e){var t;return this._validateParams(e)?(t=n.get(this,e,[]),this.getSelectedIndex(e)===t.length-1):null},selectFirst:function(e){var t;if(!this._validateParams(e))return null;t=n.get(this,e,[]);var i=this.setSelectedIndex(e,0);return n.get(t,i)},selectLast:function(e){var t;if(!this._validateParams(e))return null;t=n.get(this,e,[]);var i=this.setSelectedIndex(e,t.length-1);return n.get(t,i)},selectNext:function(e){var t,i;return this._validateParams(e)?this.hasSelection(e)?(t=n.get(this,e,[]),i=this._increaseSelectedIndex(e),n.get(t,i)):this.selectFirst(e):null},selectPrevious:function(e){var t,i;return this._validateParams(e)?(t=n.get(thseSelectedIndex(e),n.get(t,i)):null},_validateParams:function(e){return!!e},_increaseSelectedIndex:function(e){return this._validateParams(e)?this.setSelectedIndex(e,this.getSelectedIndex(e)+1):null},_decreaseSelectedIndex:function(e){return this._validateParams(e)?thdIndex(e)-1):null}},before:{initialize:function(){this._selectedIndexes={}}}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="results-scroller" data-subview="searchResults[]"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(474),a=i(259),l=i(277),c=i(331),u=i(192),h=o.extend({className:"gif-search-result",tagName:"a",attributes:{href:"#",tabIndex:1},template:r,events:{"click [data-js-select]":"_onClickSelect","click [data-js-tag]":"_onClickTag",mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},mixins:[l],defaults:{skipTags:["gif","gifs"],imageWidth:null,isVirtualized:!0,hasStillImage:!0,isPreselected:!1,unloadImageOnVirtualize:!1,isLoaded:!1,isSelectable:!0,loadFullImageBeforeSelect:!0,loadingFullImage:!1,containerWidth:150,isImpressionLogged:!1,isSelected:!1},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","onSelect","onClear")),this._loadDefer=u.defer()},afterRender:function(){this.listenTo(this,"change:isPreselected",this._onChangeIsPreselected),this.listenTo(this,"change:isVirtualized",this._onChangeIsVirtualized),this.listenTo(this,"change:hasStillImage",this._onChangeHasStillImage),this.listenTo(this,"change:isSelectable",this._onChangeIsSelectable),this.listenTo(this,"change:isLoaded",this._onChangeIsLoaded),this.listenTo(this,"change:isSelected",this._onChangeIsSelected),this.listenTo(this.eventBus,"image:full:cancelLoad",this._onCancelAllFullImageLoads),this._onChangeIsVirtualized(this,this.get("isVirtualized")),this._onChangeHasStillImage(this,this.get("hasStillImage")),this._onChangeIsPreselected(this,this.get("isPreselected")),this._onChangeIsSelectable(this,this.get("isSelectable")),this._onChangeIsLoaded(this,this.get("isLoaded"))},getTemplateData:function(){var e=this.model.toJSON(),t=e.popularSearchTag?[e.popularSearchTag]:e.postTags,i=this.get("skipTags"),s=this.get("containerWidth"),o=Math.rounh")));return t=n.reject(t,function(e){return n.contains(i,e.toLowerCase())}),n.extend(e,{tags:t.slice(0,3),width:s,height:o}),this.get("imageWidth")&&n.extend(e,{mediaUrl:e.mediaUrl.replace(/_\d+\./,"_"+this.get("imageWidth")+".")}),e},loadImage:function(){var e=this.js$("img"),t=e.attr("data-img-src");return this.get("isLoaded")||(e.attr("src",t),a.load(t,100).then(n.bind(function(){this.rendered&&this.set("isLoaded",oadDefer.promise},unloadImage:function(){this.js$("img").removeAttr("src")},refreshStillImage:function(){this._onChangeHasStillImage(this,this.get("hasStillImage"))},getLoadPromise:function(){return this._loadDefer.promise},_onCancelAllFullImageLoads:function(){this._cancelLoadFullImage()},_onClickSelect:function(e){e.preventDefault(),n.isFunction(this.onSelect)&&this.onSelect(this,this.model);var t=this.model.get("mediaUrl"),i=this.js$("img").attr("src"),s=function(){this.$el.addClass("gif-search-result--selected"),this.eventBus.trigger("image:select",this.model,this)};this.get("loadFullImageBeforeSelect")&&t!==i?this._loadFullImage(t,s):s.call(this)},select:function(e){this._onClickSelect(e)},_loadFullImage:function(e,t){this.eventBus.trigger("image:full:cancelLoad"),this.set("loadingFullImage",!0),this.eventBus.trigger("image:full:loading"),this.loader=new c({variation:"centered small",loading:!0}),this.$el.addClass("loading-full").append(this.loader.render().$el),a.load(e).then(n.bind(function(){this.get("loadingFullImage")&&n.isFunction(t)&&t.call(this)},this)).finally(n.bind(this._cancelLoadFullImage,this))},_cancelLoadFullImage:function(){this.rendered&&this.get("loadingFullImage")&&(this.loader&&(this.loader.remove(),this.loader=null),this.$el.removeClass("loading-full"),this.set("loadingFullImage",!1))},_onClickTag:function(e){var t=s(e.target).attr("data-js-tag");this.eventBus.trigger("image:tag",t,this.model),e.preventDefault(),e.stopPropagation()},_onChangeIsPreselected:function(e,t){this.$el.toggleClass("gif-search-result--preselected",t)},_onChangeIsVirtualized:function(e,t){this.$el.toggleClass("off",t),t&&this.get("unloadImageOnVirtualize")?this.unloadImage():t||this.loadImage()},_onChangeHasStillImage:function(e,t){this._removeStillCanvas(),t&&this._prepareCreateStillCanvas()},_onChangeIsSelectable:function(e,t)able",t)},_onChangeIsLoaded:function(e,t){this.$el.toggleClass("loaded",t)},_createStillCanvas:function(){if(this.rendered){var e,t=this.js$("img"),i=t.parent(),n=parseInt(t.width(),10),o=parseInt(t.height(),10),r=s("<canvas />").attr({width:n,height:o});this.$("canvas").remove(),i.append(r),e=r.get(0).getContext("2d"),e.drawImage(t.get(0),0,0,n,o),this.$el.addClass("show-still")}},_prepareCreateStillCanvas:function(){this.getLoadPromise().then(n.bind(this._createStillCanvas,this)).catch(n.noop)},_removeStillCanvas:function(w-still")},setSelected:function(e){this.rendered&&this.set("isSelected",e)},_onChangeIsSelected:function(e,t){this.$el.toggleClass("selected",t),this.$el.focus()},_onMouseEnter:function(e){n.isFunction(this.onSelect)&&this.onSelect(this)},_onMouseLeave:function(e){n.isFunction(this.onClear)&&this.onClear(this)}});e.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<figure data-js-select style="width: '+__e(width)+"px; height: "+__e(height)+'px"><img data-js-img data-img-src="'+__e(mediaUrl)+'" width="'+__e(width)+'" height="'+__e(height)+'"></figure><footer><nav class="tags"> ',_.each(tags,function(e){__p+=" ",_.isEmpty(e)||(__p+=' <a href="#" data-js-tag="'+__e(e)+'">#'+__e(e)+"</a> "),__p+=" "}),__p+=' </nav><a class="attribution" href="http://tmblr.co/'+__e(rootPostUrlHash)+'" target="_blank">'+__e(__("Originally posted by %1$s",rootBlog))+"</a></footer>";return __p}.toString()).apply(void 0,_values(_imports))},,,,,,,,,,,function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(429),r=i(136),a=i(219),l=i(230),c=a.extend({mixins:[l],tplScrollbarWrapper:'<div class="tx-scroll"></div>',tplScrollbarTrackVertical:'<div data-js-track-vertical class="tx-scrollbar-track tx-scrollbar-track--vertical"><div data-js-thumb-vertical class="tx-scrollbar-thumb"></div></div>',tplScrollbarTrackHorizontal:'<div data-js-track-horizontal class="tx-scrollbar-track tx-scrollbar-track--horizontal"><div data-js-thumb-horizontal class="tx-scrollbar-thumb"></div></div>',defaults:{trackActiveClass:"tx-scrollbar-track--active",scrollingClass:"tx-scroll--scrolling",containerClass:"tx-scroll-container",containerClassVertical:"tx-scroll-container--vertical",containerClassHorizontal:"tx-scroll-container--horizontal",infiniteScrollPercent:.9,isScrollable:!1,isScrollableHorizontal:!1,isScrollableVertical:!1,isScrolling:!1,nativeScrollbarSize:20},events:{"mousedown [data-js-thumb-vertical]":"_onVerticalThumbMousedown","mousedown [data-js-thumb-horizontal]":"_onHorizontalThumbMousedown"},destroyed:!1,constructor:function(e){var t=this._getElementFromOptions(e);return null===t?null:(this.container=t,this.$container=s(t),n.extend(e,{el:this._getWrappedElement(t)}),a.prototype.constructor.call(this,e))},initialize:function(e){this.$window=s(window),this._onScrollStopDebounced=n.debounce(n.bind(this._onScrollStop,this),150),this._onResizeDebounced=n.debounce(n.bind(this._onResize,this),150),this.render()},render:function(){return this.rendered&&!this.destroyed?this:(this.listenTo(r,"DOMEventor:flatresize",this._onResizeDebounced),this.listenTo(this,"change:isScrollableVertical",this._onChangeIsScrollableVertical),this.listenTo(this,"change:isScrollableHorizontal",this._onChangeIsScrollableHorizontal),this.listenTo(this,"change:isScrollable",this._onChangeIsScrollable),this.update(),this.destroyed=!1,a.prototype.render.apply(this,arguments))},getVerticalTrack:function(){return this.$verticalTrack},getHorizontalTrack:function(){return this.$horizontalTrack},getVerticalThumb:function(){return this.$verticalThumb},getHorizontalThumb:function(){return this.$horizontalThumb},getScrollContainer:function(){return this.container},isScrollable:function(){return this.get("isScrollable")},isScrollableVertical:function(){return this.get("isScrollableVertical")},isScrollableHorizontal:function(){return this.get("isScrollableHorizontal")},update:function(){var e,t,i;this.destroyed||(e=this._isScrollableVertical(),t=this._isScrollableHorizontal(),i=e||t,this.set({isScrollableVertical:e,isScrollableHorizontal:t,isScrollable:i}),this._updateScrollConstants(),e&&(this._updateVerticalThumbHeight(),this._positionVerticalThumb()),t&&(this._updateHorizontalThumbWidth(),this._positionHorizontalThumb()))},remove:function(){return this.destroy()},destroy:function(){this.$container.off(".txScroll"),this.$window.off(".txScroll"),this.set({isScrollable:!1,isScrollableHorizontal:!1,isScrollableVertical:!1}),this.undelegateEvents(),this.stopListening(),this._unwrapContainer(),this.destroyed=!0},_getElementFromOptions:function(e){var t;return t=e instanceof s?e.get(0):e instanceof window.Element?e:n.get(e,"el",null)},_getWrappedElement:function(e){var t=e instanceof s?e:s(e),i=s(this.tplScrollbarWrapper);return t.wrap(i),i=t.parent(),i.get(0)},_unwrapContainer:function(){this.$container.unwrap()},_appendVerticalTrack:function(){var e=s(this.tplScrollbarTrackVertical);this.$verticalTrack=e,this.$verticalThumb=e.find("[data-js-thumb-vertical]"),this.$el.append(e)},_removeVerticalTrack:function(){var e=this.getVerticalTrack();e&&(e.remove(),delete this.$verticalTrack,delete this.$verticalThumb)},_appendHorizontalTrack:function(){var e=s(this.tplScrollbarTrackHorizontal);this.$horizontalTrack=e,this.$horizontalThumb=e.find("[data-js-thumb-horizontal]"),this.$el.append(e)},_removeHorizontalTrack:function(){var e=this.getHorizontalTrack(!0);e&&(e.remove(),delete this.$horizontalTrack,delete this.$horizontalThumb)},_onChangeIsScrollable:function(e,t){var i;this.destroyed||(i="ontouchstart"in document.documentElement,i||this.$container.off("wheel.txScroll"),this.$container.off("scroll.txScroll"),this.$container.toggleClass(this.get("containerClass"),t),t&&(this.$container.on("scroll",n.bind(this._onScroll,this)),i||this.$container.on("wheel.txScroll",n.bind(this._stealScroll,this))))},_onChangeIsScrollableVertical:function(e,t){this.destroyed||(this.$container.toggleClass(this.get("containerClassVertical"),t),t?this._appendVerticalTrack():this._removeVerticalTrack())},_onChangeIsScrollableHorizontal:function(e,t){this.destroyed||(this.$container.toggleClass(this.get("containerClassHorizontal"),t),t?this._appendHorizontalTrack():this._removeHorizontalTrack())},_updateScrollConstants:function(){var e=this.getVerticalTrack(),t=this.getHorizontalTrack(),i=this.getVerticalThumb(),n=this.getHorizontalThumb();this.currentScrollTop=this.$container.scrollTop(),this.currentScrollLeft=this.$container.scrollLeft(),this.get("isScrollableVertical")&&e&&i&&(this.percentageDifferenceVertical=(this.container.scrollHeight-this.$container.height())/(e.height()-i.height())),this.get("isScrollableHorizontal")&&t&&n&&(this.percentageDifferenceHorizontal=(this.contah()-n.width()))},_onResize:function(){this.trigger("resize"),this.update()},_getAddedScrollbarHeight:function(){return this.get("isScroll{return this.get("isScrollableVertical")?this.get("nativeScrollbarSize"):0},_isScrollableVertical:function(){return this.container&&this.container.scrollHeight>this.$container.height()+this._getAddedScrollbarHeight()},_isScrollableHorizontal:function(){return this.container&&this.container.scrollWidth>this.$container.width()+this._getAddedScrollbarWidth()},_getScrollTop:function(e,t){return e.pageY-t.offset().top},_getScrollLeft:function(e,t){return e.pageX-t.offset().left},_onVerticalThumbMousedown:function(e){var t=this.getVerticalTrack();e.preventDefault(),t&&(t.addClass(this.get("trackActiveClass")),this.$window.on("mousemove.txScroll",n.bind(this._onVerticalThumbMousemove,this)),this.$window.on("mouseup.txScroll",n.bind(this._onVerticalThumbMouseup,this)),this.mouseDownOriginalOffsetY=this._getScrollTop(e,t),this._updateScrollConstants())},_onHorizontalThumbMousedown:function(e){var t=this.getHorizontalTrack();e.preventDefault(),t&&(t.addClass(this.get("trackActiveClass")),this.$window.on("mousemove.txScroll",n.bind(this._onHorizontalThumbMousemove,this)),this.$window.on("mouseup.txScroll",n.bind(this._onHorizontalThumbMouseup,this)),this.mouseDownOriginalOffsetX=this._getScrollLeft(e,t),this._updateScrollConstants())},_onVerticalThumbMousemove:function(e){var t,i=this.getVerticalTrack();i&&o.read(function(){this.destroyed||(t=this._getScrollTop(e,i)-this.mouseDownOriginalOffsetY,o.write(function(){this.destroyed||this.$container.scrollTop(this.currentScrollTop+t*this.percentageDifferenceVertical)},this))},this)},_onVerticalThumbMouseup:function(e){var t=this.getVerticalTrack();e.preventDefault(),t&&t.removeClass(this.get("trackActiveClass")),this.$window.off(".txScroll")},_onHorizontalThumbMousemove:function(e){var t,i=this.getHorizontalTrack();i&&o.read(function(){this.destroyed||(t=this._getScrollLeft(e,i)-this.mouseDownOriginalOffsetX,o.write(function(){this.destroyed||this.$container.scrollLeft(this.currentScrollLeft+t*this.percentageDifferenceHorizontal)},this))},this)},_onHorizontalThumbMouseup:function(e){var t=this.getHorizontalTrack();e.preventDefault(),t&&t.removeClass(this.get("trackActiveClass")),this.$window.off(".txScroll")},_updateVerticalThumbHeight:function(){var e,t=this.getVerticalThumb(),i=this.getVerticalTrack();i&&t&&(e=this.$container.height()/this.container.scrollHeight,t.height(i.height()*e))},_updateHorizontalThumbWidth:function(){var e,t=this.getHorizontalThumb(),i=this.getHorizontalTrack();i&&t&&(e=this.$container.width()/this.container.scrollWidth,t.width(i.width()*e))},_positionVerticalThumb:function(){var e,t,i,n=this.getVerticalTrack(),s=this.getVerticalThumb();!this.destroyed&&n&&s&&(i=this.container.scrollTop,e=i/(this.container.scrollHeight-this.$container.height()),t=n.height()-s.height(),o.write(function(){this.destroyed||(s.css("transform","translate3d(0, "+t*e+"px, 0)"),this.trigger("scroll:vertical",i,e),this.trigger("scroll",i,e),e>this.get("infiniteScrollPercent")&&this.trigger("infinitescroll",i,e))},this))},_positionHorizontalThumb:function(){var e,t,i,n=this.getHorizontalTrack(),s=this.getHorizontalThumb();!this.destroyed&&n&&s&&(i=this.container.scrollLeft,e=i/(this.container.scrollWidth-this.$container.width()),t=n.width()-s.width(),o.write(function(){this.destroyed||(s.css("transform","translate3d("+t*e+"px, 0, 0)"),this.trigger("scroll:horizontal",i,e))},this))},_onScroll:function(){this.get("isScrolling")||(this.trigger("scrollstart"),this.$el.addClass(this.get("scrollingClass"))),this.set("isScrolling",!0),this._onScrollStopDebounced(),this.get("isScrollableVertical")&&o.read(n.bind(this._positionVerticalThumb,this)),this.get("isScrollableHorizontal")&&o.read(n.bind(this._positionHorizontalThumb,this))},_onScrollStop:function(){this.destroyed||(this.trigger("scrollstop"),this.set("isScrolling",!1),this.$el.removeClass(this.get("scrollingClass")))},_stealScroll:function(e){var t=e.currentTarget,i=e.originalEvent.deltaX,n=e.originalEvent.deltaY,o=Math.abs(i)>0,r=Math.abs(n)>0;this.get("isScrollableHorizontal")&&o&&(i<0&&t.scrollLeft<=0&&e.preventDefault(),i>0&&t.scrollLeft>=t.scrollWidth-s(t).width()-this._getAddedScrollbarWidth()&&e.preventDefault()),this.get("isScrollableVertical")&&r&&(n<0&&t.scrollTop<=0&&e.preventDefault(),n>0&&t.scrollTop>=t.scrollHeight-s(t).height()-this._getAddedScrollbarHeight()&&e.preventDefault())}});e.exports=c},function(e,t,i){"use strict";var n=i(3),s=i(487),o=i(226),r=i(488),a=o.extend({className:"gif-search-message",template:r,defaults:{header:"",body:"",hasResults:ckShowResults"},initialize:function(e){n.extend(this,n.pick(e,"eventBus"))},_onClickShowResults:function(){this.eventBus.trigger("showHiddenResults")},_filterMessageHtml:function(e,t){t.find("script, link").remove(),t.find("a[onerror]").removeAttr("onerror")},getTemplateData:function(){var e=o.prototype.getTemplateData.apply(this,arguments);return e.body=s(e.body||"",this._filterMessageHtml),e},afterRender:function(){this.rendered||this.listenTo(this,"change",this.render),this.$el.toggleClass("gif-search-message--hidden",!(this.get("header")||this.get("message")))},setMessage:function(e,t,i){n.isString(t)||(t=e,e=""),n.isBoolean(i)||(i=this.get("hasResults")),this.set({header:e,body:t,hasResults:i}),t||e?this.show():this.hide()},show:function(){this.$el.removeClass("gif-search-message--hidden")},hide:function(){this.$el.addClass("gif-search-message--hidden")}});e.exports=a},function(e,t,i){"use strict";function n(e,t){var i=r.node;return s.isFunction(t)&&(t=s.rest(arguments)),s.each(t,function(e){e(i,n)}),n.html()}var s=i(3),o=i(8),r=i(354);e.exports=n},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="gif-search-message-container"> ',header&&(__p+=' <h2 class="gif-search-message-header">'+(null==(__t=header)?"":__t)+"</h2> "),__p+=' <div class="gif-search-message-body">'+(null==(__t=body)?"":__t)+"</div> ",hasResults&&(__p+=' <p><span class="gif-search-show-results" data-js-showresults>'+__e(__("View results anyway"))+"</span></p> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(490);e.exports=n},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(491),r=i(493),a=s.extend({className:"loader-container",template:r,defaults:{type:"",classModifiers:"",loading:!1},initialize:function(e){this.options=n.extend({},this.defaults,e),this.$container=e.$container,"bar"===this.get("type")&&this.createBarLoader(),this.listenTo(this,"change:loading",this._onChangeLoading),this.attach()},createBarLoade},_onChangeLoading:function(e,t){this.subviews.loaderType.toggleLoading(t)},attach:function(){this.render(),this.$el.attr("data-subview=loader"),this.$container.find("[data-subview=loader]").replaceWith(this.$el)}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(492),r=s.extend({className:"loader-bar",template:o,defaults:{classModifiers:"",loading:!1},initialize:function(e){this.options=n.extend({},this.defaults,e),this.$el.addClass(this.get("classModifiers")),this.interval=null,this.timeout=null},afterRender:function(){this.$bars=this.$el.find(".bar"),this.get("loading")===!0&&this.toggleLoading(this.get("loading"))},toggleLoading:function(e){this.currentBar=0,this.counter=0,e===!0?(clearTimeout(this.timeout),this.$el.addClass("loading"),this.$bars.addClass("animating"),this.startAnimating()):(this.$el.removeClass("loading"),this.stopAnimating(),this.timeout=setTimeout(n.bind(function(){
this.$bars.removeClass("animating")},thlass("active")},hideBar:function(e){this.$bars.eq(e).removeClass("active")},loop:function(){var e=this.$bars.eq(this.currentBar);e.remove(),this.$el.append(e),this.currentBar+=1,this.currentBar>=this.$bars.length&&(this.currentBar=0),this.counter++},startAnimating:function(){this.stopAnimating(),this.loop(),this.in.loop()},thiseRemove:function(){clearInterval(this.interval),clearTimeout(this.timeout)}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="bar white"></div><div class="bar red"></div><div class="bar orange"></div><div class="bar green"></div><div class="bar purple"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="loader-type" data-subview="loaderType"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="searchInput"></div><div data-subview="loader"></div><div data-subview="searchResults"></div><div data-subview="searchMessage"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(192),o=i(190),r=i(496),a=3e5,l=o.extend({model:r,resultCountForQuery:function(e){e=(e||"").toLowerCase().trim();var t=this.get(e);return t?t.media.length:0},fetchGifs:function(e,t,i,o){var l,c=s.defer();e=(e||"").toLowerCase().trim();var u=this.get(e);return u||(u=new r({query:e,limit:t,loggingContext:i}),this.add(u)),!o&&n.now()-u.get("ts")<a?(this.trigger("s.trigccess:function(){l=function(e){l=ne.catch(function(){l&&l.abort()}),c},clearCache:function(e){this.remove(e)}});e.exports=l},function(e,t,i){"use strict";var n=i(3),s=i(185),o=s.prototype,r=i(497),a=function(e,t,i){this.name="EmbedError",this.message=e,this.input=t,this.data=i,this.stack=(new Error).stack},l=s.extend({idAttribute:"query",url:"/svc/sear",limit:200,loggingContext:null},initialize:function(e,t){this.media=new r},fetch:function(e){var t=this.get("loggingContext"),i={q:this.get("query"),limit:this.get("limit")};return n.isEmpty(t)||n.extend(i,{context:t}),e=n.extend({type:"POST",withFormKey:!0,data:i},e),o.fetch.call(this,e)},parse:function(e,t){if(t&&t.xhr&&(e=(e||{}).response),n.isEmpty(e))throw new a("Invalid GIF search response",this.get("query"),e);return this.media.reset(e.media),delete e.media,e.ts=n.now(),e},toJSON:function(){var e=o.toJSON.apply(this,arguments);return e.media=this.media?this.media.toJSON():[],e}});e.exports=l},function(e,t,i),r=s.extern this.rotateFrom(e,-1)},nextFrom:function(e){return this.rotateFrom(e,1)},rotateFrom:function(e,t){for(var i=(n.isNumber(e)?this.at(e):this.findWhere({mediaUrl:e}))||this.sample(),s=this.indexOf(i)+t;s<0;)s+=this.length;return this.at(s%this.length)}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(185),o=i(258),r=s.extend({defaults:{mediaUrl:"",postUrl:"",rootPostUrl:"",rootPostUrlHash:"",rootBlog:"",rootBlogUrl:"",rootBlogKey:"",postTags:[],popularSearchTag:"",width:0,height:0},initialize:function(e,t){this.attributes={},this.set(n.defaults(o(e||{}),this.defaults))}});e.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n=i(3),s=i(214),o=i(524),r=i(273),a=(i(274),s.extend({name:"Upload",initialize:function(e){e=n.extend({},e),this.collection=e.collection||(e.collection=new r),this.indexView=new o(e),this.listenvent)},_rthis,arguments)},addFiles:function(e){return this.indexView.a{returnremove:topListening(),this},render:function(){return this.indexView.renderis.indexView.$el},getCurrentRequest:function(){return this.indexView.jqXHR}}));e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(6).sprintf,o=i(219),r=i(187),a=i(192),l=i(136),c=i(130),u=i(273),h=i(274),d=i(525),p=["add","submit","send","done","fail","always","progress","progressall","start","stop","change","paste","drop","dragover","chunksend","chunkdone","chunkfail","chunkalways"],g=["add","send","progress","active","enable","disable"],f=o.extend({tagName:"input",attributes:{type:"file"},defaults:{name:"photo",maxUploadSize:!1,uploadPattern:!1,mediaType:"image",fileUpload:{singleFileUploads:!0,limitConcurrentUploads:1,sequentialUploads:!1,autoUpload:!0,formData:[],dataType:"json",dropZone:null,pasteZone:null}},_createUploadModel:function(e,t){var i=new h(e);return this.collection.add(i,t||{}),i},_createUploadModelForFile:function(e,t,i){t=n.extend({file:e},t);var s=this._createUploadModel(t,i);return e._uploadModel=s,s},initialize:function(e){if(this.defaults.message={cancel:c("Canceled upload"),error:c("Upload error"),filesize:c("The file is too big. Squish it down, and try again!"),filetype:{image:c("This is not a valid image file."),video:c("This is not a valid video file."),audio:c("This is not a valid audio file."),default:c("This is not a supported file.")}},this.options=n.merge({},this.defaults,e),this.options.url&&(this.options.fileUpload.url=this.options.url),this.options.collection?this.collection=this.options.collection:this.collection=new u,!this.options.fileUpload.url)throw new Error("Upload requires an endpoint URL");this.$el.prop("tabindex",-1),this.options.fileUpload.multiple&&this.$el.prop("multiple",!0),this.options.accept&&this.$el.prop("accept",this.options.accept);var t=n.merge({},this._fileUploadWrap);n.forEach(p,function(e){n.isFunction(t.defaults[e])||(t.defaults[e]=n.noop)},this);var i=new r(t);i.applyTo(this.options.fileUpload),n.forEach(p,function(e){this.options.fileUpload[e]=d(this.options.fileUpload[e],this)},this),this.$el.attr("name",this.options.name).fileupload(this.options.fileUpload),this._fileUpload=this.$el.data("blueimp-fileupload"),n.forEach(g,function(e){this[e]=function(){var t=n.toArray(arguments);t.unshift(e),this._fileUploadInvoke.apply(this,t)}},this)},_fileUploadInvoke:function(e){return this._fileUpload[e].apply(this._fileUpload,n.rest(arguments))},validateFile:function(e,t){t||(t=this.options);var i=[];return t.maxUploadSize&&e.size>t.maxUploadSize&&(l.trigger("postform-interaction:upload-limit-hit",{loggingData:{fileSize:e.size,fileType:e.type,maxSize:t.maxUploadSize}}),i.push({type:"filesize",message:s(t.message.filesize,t.maxUploadSize)})),t.uploadPattern&&e.type&&!t.uploadPattern.test(e.type)&&i.push({type:"filetype",mess||t.message.filetype.default}),i},upload:function(e){this.add({files:[e]})},cancel:function(){var e;return this.jqXHR?(e=this.jqXHR.abort(),this.jqXHR=null):e=a.reject(this.options.message.cancel),e},_forMatchingFiles:function(e,t){var i=n.rest(arguments);this.collection.forEach(function(s){if(n.containsapply(this,o)}},this)},promise:function(){return this.collection.promise()},_fileUploadWrap:{defaults:{change:function(e,t,i){this._fileUpload.options.replaceFileInput&&this.setElement(e)},add:function(e,t,i){var s=i.files[0],o=this.validateFile(s),r={},a={};if(!n.isEmpty(o)){r.error=n.pluck(o,"message"),r.file=s;var l={errorType:"validation",messages:o,file:s};this.collection.trigger("invalid",this.collection,new this.collection.model(r)),this.trigger("error",l),reateUploadModelForFile(s,r,a),n.isEmpty(o)},send:function(e,t,i){return!0}},before:{},after:{done:function(e,t,i){var s,o=n.get(i,"result.meta.status"),r=n.get(i,"result.response"),a=n.get(i,"result.errors");if(200!==o||n.isEmpty(r)){var l=function(){return r&&r.msg?r.msg:n.isArray(a)?n.isEmpty(a)?c("Woops :("):a:a.join(" ")}();s={error:l,uploading:!1}}else n.isArray(r)&&(r=r[0]),s=n.extend({complete:!0,uploading:!1},r);this._forMatchingFiles(i.files,function(e,t){e.set(t)},s)},fail:function(e,t,i){var s;s="abort"===i.errorThrown?{uploading:!1}:{error:this.options.message.error,uploading:!1},s.responseJSON=n.get(i,"jqXHR.responseJSON"),this._forMatchingFiles(i.files,function(e,t){e.set(t)},s)},progress:function(e,t,i){this._forMatchingFiles(i.files,function(e,t){e.set(t)},{bytesLoaded:i.loaded,bytesTotal:i.total})}},around:{add:function(e,t,i,s){var o=e.apply(this,n.rest(arguments));return o!==!1&&!i.isDefaultPrevented()&&((s.autoUpload||s.autions.autoUpload)&&s.process().done(n.bind(function(){this.jqXHR=s.submit()},this)),o)},send:function(e,t,i,s){s.withFormKey=!0st(arguments));if(o){this._forMatchingFiles(s.files,function(e,t){e.set(t)},{uploading:!0});var r={files:s.files};this.collection.trigger("send",this.collection,r),this.trigger("send",r)}return o}}}});e.exp=Array.prototype.slice.call(arguments);return i.unshift(this)i){"use strict";function n(){return o||(o=new r),o}fun];return function(t,i){return e[t]=i,e.filter(Boolean).join("\n")}}()}])})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n=i(597);e.exports=n},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var s=i(226),o=n(s),r=i(3),a=n(r),l=i(598),c=n(l),u=i(8),h=n(u),d=i(136),p=n(d),g=o.default.extend({className:"native-audio-container",template:c.default,events:{"click .play-pause":"playPause","mousedown .audio-player":"onMouseDown","mousemove .audio-player":"onMouseMove","mouseup .audio-player":"onMouseUp","mouseleave .audio-player":"onMouseLeave"},initialize:function(e){e=e||{},this.streamUrl=e.streamUrl+"?plead=please-dont-download-this-or-our-lawyers-wont-let-us-host-audio",this.playing=!1,this.track=e.track,this.artist=e.artist,this.albumArt=e.albumArt,this.preview=e.preview,this.noId3=e.noId3,this.model=e.model,this.dragging=!1,this.mousedown=!1},render:function(){this.$el.html(this.template({post:this.model,streamUrl:this.streamUrl,track:this.track,artist:this.artist,albumArt:this.albumArt,noId3:this.noId3}));var e=this.$("audio"),t=this.$(".audio-source");return this.player=e[0],this.icon=this.$(".icon"),this.progress=this.$(".progress"),this.$player=this.$(".audio-player"),this.artist||this.track||this.$(".track-no-id3").css("display","block"),e.on("playing",a.default.bind(this.onPlay,this)),e.on("pause",a.default.bind(this.onPause,this)),e.on("timeupdate",a.default.bind(this.onTimeUpdate,this)),e.on("error",a.default.bind(this.onError,this)),t.on("error",a.default.bind(this.onError,this)),this.listenTo(p.default,"NativeAudio:play",this.stopOtherAudio),this},onPlay:function(){this.model&&p.default.trigger("NativeAudio:play",this.model.get("id")),this.icon.removeClass("icon_play").addClass("icon_pause"),this.playing=!0},stopOtherAudio:function(e){this.model&&this.model.get("id")!==e&&(this.pause(),this.setPlayerTime(0))},onMouseDown:function(e){(0,h.default)(e.ta.addClass("icon_close"),this.$el.addClass("error"),this.undelegateEvents()},onMouseMove:function(e){if(this.mousedown){this.dragging=!0,this.playing&&this.pause();var t=(0,h.default)(e.target),i=void 0;if(t.hasClass("audio-player"))i=e.offsetX/this.$player.outerWidth()*this.player.duration;else{var n=t.closest(".audio-player").offset();i=(e.pageX-n.left)/this.$player.outerWidth()*this.player.duration}this.setPlayerTime(i)}},onMouseUp:function(e){var t=(0,h.default)(e.target);if(this.playing){if(this.mousedown&&!this.dragging&&t.hasClass("audio-player")){var i=e.offsetX/this.$player.outerWidth()*this.player.duration;this.setPlayes.dragging=!1},onMouseLeave:function(e){this.mousedown=!1,this.dragging=!1},onPause:function(){this.icon.rnction(){tause:function(e){e.stopPropagation(),this.playing?this.pause():this.play()},play:function(){this.player.play()},pause:function(){this.player.pause()layer.currentTime=e)},teardown:function(){(0,h.default)(this.player).off()},onTimeUpdate:function(){this.player.currentTime===this.player.duration?this.progress.css("width",0):this.progress.css("width",this.player.currentTime/this.player.duration*100+"%")}});e.exports=g},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="audio-player',albumArt&&(__p+=" has-art "),__p+='"><div class="progress"></div><div class="play-pause"><i class="icon icon_play"></i></div><div class="audio-info"><div class="track-name">'+__e(track)+'</div><div class="track-artist">'+__e(artist)+'</div><div class="track-no-id3">'+__e(noId3)+'</div></div><audio preload="none"><source class="audio-source" src="'+__e(streamUrl)+'"></audio></div> ',albumArt&&(__p+=' <div class="audio-image"><img src="'+__e(albumArt)+'" alt="'+__e(track)+'"></div> ');return __p}.toString()).apply(void 0,_values(_imports))},,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n=i(3),s=i(235).animate,o=i(219),r=i(241),a=i(276),l=i(277),c=i(230),u=o.extend({className:"post-forms-glass",mixins:[a,l,c],initialize:function(e){this.options=e=n.extend({active:!1,visible:!1},e),this.set({active:!!e.active,visible:!!e.visible}),this.get("visible")?this.$el.css({opacity:1,display:"block"}):this.$el.css({opacity:0,display:this.get("active")?"block":"none"}),this.listenTo(this,{"change:active":this._changeActive,"change:visible":this._changeVisible})},show:function(e){return this.set("active",!(null!=e&&!e)),this.attributes.visible&&this._showing?this._showing:(this.attributes.visible=!0,this._show())},hide:function(e){return this.set("active",!(null==e&&!e)),!this.attributes.visible&&this._hiding?this._hiding:(this.attributes.visible=!1,this._hide())},_show:function(){var e=this._showing=s(this.$el,{opacity:1},{duration:r(150),display:"block"});return e},_hide:function(){var e=this._hiding=s(this.$el,{opacity:0},{duration:r(150),display:this.get("active")?"block":"none"});return e},_changeActive:function(e,t){t?this.$el.addClass(this.className+"_active active"):(this.$el.removeClass(this.className+"_active active"),!this._changing||n.has(this.changed,"visible")||this.get("visible")||this.$el.css("display","none"))},_changeVisible:function(e,t){t?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},render:function(){return this}});e.exports=u},function(e,t,i){"use strict";var n=i(8),s=i(235).animate,o=i(219),r=i(241),a=i(276),l=i(277),c=i(230),u=i(620),h=o.extend({className:"post-forms-modal",mixins:[a,l,c],template:u,initialize:function(e){this.set("visible",e&&e.visible),this.get("visible")?this.$el.css({opacity:1,display:"block"}):this.$el.css({opacity:0,display:"none"}),this.$body=n("body"),this.listenTo(this,"change:visible",this._toggleVisible)},show:function(){return this.attributes.visible=!0,this._show()},hide:function(){return this.attributes.visible=!1,this._hide()},setContentSubView:function(e){return this.subViews.content&&(this.stopListening(this.subViews.content),this.subViews.content.remove()),this.subViews.content=e,this.listenTo(e,"prepared",this._onSubViewPrepare),this.listenTo(e,"torndown",this._onSubViewTeardown),this.isRendered()&&this.attachSubView("content"),this},_onSubViewPrepare:function(e){this.show()},_onSubViewTeardown:function(e){this.hide()},_show:function(){this._disableBodyScroll(),this.$el.css("display","block");var e=s(this.$el,{opacity:1},{duration:r(100),display:"block"});return e},_hide:function(){this._enableBodyScroll();var e=s(this.$el,{opacity:0},{duration:r(100),display:"none"});return e},_toggleVisible:function(e,t){t?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},_disableBodyScroll:function(){this.$body.css("overflow","hidden")},_enableBodyScroll:function(){this.$body.css("overflow","")},render:function(){return this.$el.html(this.template(this.attributes)),this.attachSubViews(),this}});e.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="v-center-outer"><div class="v-center-inner"><div class="v-center-content"><div data-subview="content"></div></div></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(192),o=i(235).animate,r=i(238),a=i(241),l=i(240),c=i(219),u=(i(132),i(276)),h=i(277),d=i(230),p=i(622),g=i(623),f=i(625),_=c.extend({mixins:[u,h,d,l],template:f,defaultOptions:{animateDuringPrepare:!0,animateHeightWithContent:!1,startHeight:null,useLoader:!0,loaderDelay:250,transitionBackground:!1},defaults:{minHeight:!1,pretransition:!1,midtransition:!1},initialize:function(e){e instanceof c&&(e={postForm:e}),this.options=e=n.extend({},this.defaultOptions,e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),e.postForm&&this.setPostForm(e.postForm),this.listenTo(this,"change:minHeight",this._onChangeMinHeight),this.listenTo(this,"change:pretransition",this._onChangePretransition),this.listenTo(this,"change:midtransition",this._onChangeMidtransition)},_onChangeMinHeight:function(e,t){o(this.$el,"stop"),t||n.isNumber(t)?o(this.$el,{"min-height":t},{duration:a(Math.min(Math.max(250,t),750))}):(t=n.parseInt(this.$el.css("min-height"),10)||0,o(this.$el,{"min-height":[0,t]},{duration:a(Math.min(Math.max(250,t),750))}).then(n.bind(function(){this.$el.css("min-height","")},this)))},_onChangePretransition:function(e,t){t?this.$el.addClass("post-form-container-pretransition"):this.$el.removeClass("post-form-container-pretransition")},_onChangeMidtransition:function(e,t){t?this.$el.addClass("post-form-container-transition"):this.$el.removeClass("post-form-container-transition")},setPostFormComponent:function(e){if(this._postFormComponent!==e)return this._postFormComponent&&this.stopListening(this._postFormComponent),this._postFormComponent=e,this.postForm=e.postForm,this},prepare:function(e){return this.isRendered()||this.render(),this.trigger("prepared",this),this.loadingDelay=n.delay(n.bind(function(){this.loader&&this.options.useLoader&&this.loader.set("loading",!0)},this),this.options.loadingDelay),this.options.animateDuringPrepare&&(this._hideOriginalContent=this.hideOriginalContent(e).then(n.bind(function(){return this._hideOriginalContent=!1,this},this))),s.resolve(this)},attach:function(e){return this.loader&&(clearTimeout(this.loadingDelay),this.loader.set("loading",!1)),this.set("pretransition",!0),this.postForm.forceHidden(),this.attachSubView(this.postForm,"postForm"),s.resolve(this)},hideOriginalContent:function(e){var t=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return t||this.options.originalContent||(t=i),r([function(){null!=t&&this.$el.css("height",t),this.set("midtransition",!0),this.originalContent.set("enabled",!1)},function(){return s.join(e(),this.originalContent.animateHide(a(100)))}],this)},showPostForm:function(e){var t=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return t||this.options.originalContent||(t=i),r([function(){if(!this.options.animateHeightWithContent&&!this.originalContent.get("hidden"))return this._hideOriginalContent||this.hideOriginalContent(e)},function(){var n=[];return this.options.animateHeightWithContent&&!this.originalContent.get("hidden")&&n.push(this._hideOriginalContent||this.hideOriginalContent(e)),null==i||null==t||(i===t?this.$el.height(i):n.push(o(this.$el,{height:[i,t]},{duration:a(150),easing:[.4,1.3,.7,1]}))),s.all(n)},function(){return this.set("placeholder",!1),this.postForm.animateShow(a(100))},function(){this.set("pretransition",!1),this.set("midtransition",!1),this.$el.css("height","")}],this)},hidePostForm:function(e){var t=this.postForm.measureHeight(),i=this.originalContent.measureHeight();return i||this.options.originalContent|t("midtransition",!0)},function(){return this.postForm.animateHide(a(100))},function(){if(this.set("pretransition",!0),null==i||null==t);else{if(i!==t)return o(this.$el,{height:[i,t]},{duration:a(100),easing:[0,0,.6,1]});this.$el.height(i)}},function(){return s.join(e(),this.originalContent.animateShow(a(50)))},function(){this.set("midtransition",!1),this.set("pretransition",!1),this.$el.css("height",""),this.originalContent.set("enabled",!0)}],this)},serialize:function(){return{originalContent:!!this.options.originalContent,transitionBackground:this.options.transitionBackground}},beforeRender:function(){this.loader||(this.loader=new g),this.originalContent||(this.options.originalContent instanceof p?this.originalContent=this.options.originalContent:this.originalContent=new p({el:this.options.originalContent})),this.originalContent.$el.detach()},render:function(){return this.$el.html(this.template(this.serialize())),this.subViews.originalContent=this.originalContent,this.subViews.loader=this.loader,t$el.addClass("pubViews()},beforeTeardown:function(){return this.subViews.loader=null,this},afterTeardown:function(){return this.$el.removeClass("post-forms-above-glass post-form-container-pretransition post-form-container-transition is_persistent"),this.loader&&(this.loader.remove(),this.loader=null),this.$el.children(".post-transition-background").remove(),delete this.postForm,this.trigger("torndown",this),this.teardownSubViews()}});e.exports=_},function(e,t,i){"use strict";var n=i(3),s=i(235).animate,o=i(219),r=i(276),a=i(230),l=o.extend({defaults:{hidden:!1,enabled:!0},mixins:[r,a],initialize:function(e){this.set("hasContent",e&&e.el),this.originalCSS=this._getCSS(["opacity"]),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:hidS:function(e){var t={};return n.forEach(e,function(e){t[e]=this.$el.css(e)},this),t},_onChangeEnabled:function(e,t){this.$el.toggleClass("no-pointer-events",!t)},_onChangeHidden:function(e,t){this.$el.toggleClass("collapse",t)},measureHeight:function(){if(!this.get("hasContent"))return null;var e=this.get("hidden");this.set("hidden",!1);var t=this.$el.outerHeight();return this.set("hidden",e),t},animateShow:function(e,t){return e||(e=0),t||(t=0),s(this.$el,{opacity:1},{duration:e,delay:t,begin:n.bind(function(){this.set("hidden",!1)},this)})},animateHide:function(e,t){return e||(e=0),t||(t=0),s(this.$el,{opacity:0},{duration:e,delay:t}).then(n.bind(functieturn this},teardown:function(){return this.$el.css(this.originalCSS),this}});e.exports=l},function(e,t,i){"use strict";var n=i(219),s=i(276),o=i(277),r=i(230),a=i(624),l=n.extend({className:"post-forms-loader",mixins:[s,o,r],template:a,initialize:function(e){this.listenTo(this,"change:loading",this._onChangeLoading),this.set("loading",e&&e.loading)},_onChangeLoading:function(e,t){this.isRendered()&&(t?(this.$el.addClass("loading"),this.$$(".Knight-Rider-loader").addClass("animate")):(this.$el.removeClass("loading"),this.$$(".Knight-Rider-loader").removeClass("animate")))},render:function(){return this.$el.html(this.template(this.attributes)),this}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div class="Knight-Rider-loader ',loading&&(__p+="animate"),__p+='"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)transitionBackground&&(__p+=' <div class="post-transition-background"></div> '),__p+=" ",originalContent&&(__p+=' <div data-subview="originalContent"></div> '),__p+=' <div data-subview="loader"></div><div data-subview="postForm"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(192),o=i(235).animate,r=i(622),a=i(277),l=i(230),c=i(136),u=i(246),h=r.extend({mixins:[a,l],events:{"click [data-js-text]":"_onClickNewPost","click [data-js-photo]":"_onClickNewPost","click [data-js-quote]":"_onClickNewPost","click [data-js-link]":"_onClickNewPost","click [data-js-chat]":"_onClickNewPost","click [data-js-audio]":"_onClickNewPost","click [data-js-video]":"_onClickNewPost"},setPostType:function(e){this.postType=e},animateShow:function(e,t){return e||(e=0),t||(t=0),this.$el.css({display:"block",opacity:1}),function(i){var n=this.js$(i),r=n.children("i"),a=n.children(".new_post_label_text"),l=this.$(".new_post_label").not(n),c=l.children("i"),u=l.children(".new_post_label_text"),h=[o(c,{scale:1,translateY:[0,10],opacity:1},{duration:e,delay:t}),o(u,{translateY:[0,10],opacity:1},{duration:e,delay:t})];return n.length&&r.length&&h.push(o(r,{scale:[1,1.5],translateY:[0,0],opacity:1},{duration:e,delay:t}),o(a,{translateY:[0,0],opacity:1},{duration:e,delay:t})),s.all(h)}.call(this,this.postType)},animateHide:function(e,t){e||(e=0),t||(t=0),function(i){var n=this.js$(i),r=n.children("i"),a=n.children(".new_post_label_text"),l=this.$(".new_post_label").not(n),c=l.children("i"),u=l.children(".new_post_label_text"),h=[o(c,{scale:[1,1],translateY:[10,0],opacity:0},{duration:e,delay:t}),o(u,{translateY:[10,0],opacity:0},{duration:e,delay:t})];return n.length&&r.length&&h.push(o(r,{scale:[1.5,1],translateY:[0,0],opacity:0},{duration:e,delay:.5*e+t}),o(a,{translateY:[0,0],opaci.postType).then(n.bind(function(){this.$el.css({display:"none",opacity:0})},this))},_onClickNewPost:function(e){if(e.stopPropagation(),e.preventDefault(),this.get("enabled")){var t=e.currentTarget.getAttribute("data-post-endpoint")||e.currentTarget.getAttribute("data-post-type");c.trigger("postForms:open",{postType:t,postFormType:u.inline})}}});e.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="post-tab-switching"><div class="tab-post-types count-'+__e(icons.length)+'"> ',_.forEach(icons,function(e,t){__p+=' <div class="tab-post-type item" data-index="'+__e(t)+'" data-post-type="'+__e(e.name)+'"><div class="post-type-icon icon-'+__e(e.name)+'"><i class="post-type-icon-overlay"></i></div><div class="post-type-name"><span class="post-type-name-span">'+__e(e.label)+"</span></div></div> "}),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(226),s=i(129),o=i(3),r=i(8),a=n.extend({events:{mouseleave:"onMouseLeave",mouseenter:"onMouseEnter"},defaults:{totalImages:1,changeOnHover:!0,image:!1,shouldAnimate:!1},initialize:function(e){this.assetsHost=s.get("Context/hosts/assets_host"),this.isRetina=window.devicePixelRatio&&window.devicePixelRatio>1,this.$imageContainer=this.$(".preload-container"),this.animations=o.get(e,"data.animations",[]);var t=Array.isArray(this.animations)&&this.animations.length>0;this.set("shouldAnimate",t),t&&(this.set("totalImages",this.animations.length),this.generateImageIds(),this.get("image")||(this.applyRandomImage(),this.addImageToContainer()),timage",function(e,t){this.addImageToContainer(),this.setBackgroundImage(t)}))},generateImageIds:function(){
this.imageIds=o.shuffle(o.range(1,this.get("totalImages")+1))},onMouseEnter:function(e){var t=this;if(this.get("shouldAnimate")){var i=this.getCurrentImageObject();i.get(0)&&i.get(0).complete?this.$el.addClass("opacity-switch"):i.on("load",function(){t.$el.is(":hover")&&t.get("image")===i.data("imgId")&&t.onMouseEnter()})}},onMouseLeave:function(e){var t=this;this.get("shouldAnimate")&&(this.$el.removeClass("opacity-switch"),this.get("changeOnHover")&&setTimeout(function(){t.applyRandomImage()},200))},addImageToContainer:function(){if(!this.getCurrentImageObject().get(0)){var e=this.get("image");if(e>this.animations.length)return;var t=this.animations[e-1],i=this.isRetina?1:0;if(!Array.isArray(t)||i>t.length)return;var n=t[i];n&&r('<img data-img-id="'+e+'" alt="Tumblr">').attr("src",n).appendTo(this.$imageContainer)}},applyRandomImage:function(){0===this.imageIds.length&&this.generateImageIds(),this.set("image",this.imageIds[0]),this.imageIds.shift()},getCurrentImageObject:function(){return this.$imageContainer.find('[data-img-id="'+this.get("image")+'"]')},setBackgroundImage:function(e){this.$imageContainer.css("background-image","url("+this.getCurrentImageObject().attr("src")+")")}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(136),r=i(182),a=i(630),l=s.extend({events:{click:"openPopover"},updateBadge:function(e){e>0&&this.$(".tab_notice_value").text(e>99?"99+":e),this.$(".tab_notice").toggleClass("tab-notice--active",e>0)},initialize:function(){this.popover=null,this.user=r(),this.updateBadge(this.user.getUnreadCount()),this.popoverOptions={container:this.$el,viewOptions:{}}},openPopover:function(e){if(e.preventDefault(),this.popover)this.popover.show();else{var t=this.$el.closest(".l-header-container");t.length&&(this.popoverOptions.viewOptions.isFixedPosition="fixed"===t.css("position")),a(n.bind(function(e){this.popover=new e(this.popoverOptions).render()},this))}var i={loggingData:{source:"app-header"}};o.trigger("Kraken:AccountClick",i)}});e.exports=l},function(e,t,i){"use strict";var n=i(248),s=i(631),o=new s("account-popover"),r=function(e){o.start(),i.e(2,function(t){try{e(i(632))}catch(e){n(e,"account-popover")}finally{o.end()}})};e.exports=r},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(3),r=i(136),a=function(){function e(t){if(n(this,e),o.isString(t)?t={chunkName:t}:t||(t={}),!t.chunkName,!1)throw new Error("Async latency logger requires a chunkName");this.chunkName=t.chunkName||""}return s(e,[{key:"start",value:function(){this.startTime=Date.now()}},{key:"end",value:function(){this.startTime&&r.trigger("async-loading:complete:"+this.chunkName,{loggingData:{chunkName:this.chunkName,latency:Date.now()-this.startTime,userAgent:o.get(window,"navigator.userAgent",""),path:o.get(document,"location.pathname")}})}}]),e}();e.exports=a},,,,,,,,function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(136),r=i(182),a=s.extend({initialize:function(e){this.user=r(),this.channels=this.user.channels,this.mentionKeys=this.channels.reduce(function(e,t){return e[t.get("mention_key")]=t.id,e},{}),this.listenTo(o,"activity:updateActivityUnreadCounts",this.getUnreadActivityBadgeCount),this.listenTo(this.channels,"change:unread_activity_count_sum",this.updateBadge),this.listenTo(o,"refresh_activities_count",this.user.getUnreadActivityBadgeCount)},getUnreadActivityBadgeCount:function(e){n.each(e,function(e,t){var i=this.mentionKeys[t],n=this.channels.get(i);n&&n.set("unread_activity_count_sum",e)},this)},updateBadge:function(){var e=n.sum(this.channels.pluck("unread_activity_count_sum"));e>0&&this.$(".tab_notice_value").text(e>99?"99+":e),this.$(".tab_notice").toggleClass("tab-notice--active",e>0)}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(180),r=i(214),a=i(136),l=i(182),c=i(212),u=i(213),h=i(191),d=i(641),p=i(642),g=i(643),f=i(646),_=i(647),m=i(650),v=i(657),b=i(464),y=i(673),w=i(674),C=i(679),k=i(680),x=i(713),S=i(769),T=i(670),E=i(658),P=i(770),I=i(771),F=i(705),A=i(495),M=new f,N={CONVERSATION_OPEN_TUMBLELOGS:"messaging:conversation:open:tumblelogs",CONVERSATION_OPEN_MODEL:"messaging:conversation:open:model",CONVERSATION_OPEN_ID:"messaging:conversation:open:id",CONVERSATION_OPEN_NAME:"messaging:conversation:open:name",INBOX_OPEN:"messaging:inbox:open"},R=r.extend({name:"Messaging",defaults:{resetPollingTypingDebounceRate:3e4},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"inboxAnchorEl","inboxPopoverOptions")),this.eventBus=M,this.user=l(),this.channels=this._getChannelsEnabledForMessagingAsCollection(),this.activeWindow=new d,this.inboxCollection=new P,this.currentBlogModel=new S({channel:this._getInitiallySelectedChannel()}),this.favoritesCollection=new F,this.emptyInboxCollection=new F,this.unreadManager=new _({channels:this.channels}),this.inboxBadge=new C({el:this.inboxAnchorEl,channels:this.channels}).render(),this.messagingLogger=new p,this.messagingNotifier=new y({isEnabled:this.isDesktopNotificationEnabled(),notificationIcon:this.getMessagingNotificationIcon()}),this.keyboardManager=new b,this.windowPersistenceManager=new v({user:this.user,isSyncEnabled:!1}),this.notificationSoundManager=new w,this.searchImageQueries=new A,this.windowManager=new m({eventBus:this.eventBus,user:this.user,channels:this.channels,currentBlogModel:this.currentBlogModel,keyboardManager:this.keyboardManager,persistenceManager:this.windowPersistenceManager,inboxConfig:{constructor:k,options:{favoritesCollection:this.favoritesCollection,emptyInboxCollection:this.emptyInboxCollection,appendFavoritesToInboxLimit:this.getAppendFavoritesToInboxLimit(),isAutoFetch:!1,isNewEmptyInboxEnabled:this.isNewEmptyInboxEnabled()},popoverOptions:n.extend({autoTeardown:!0,pinnedSide:"bottom",isFixedPosition:!0,pinnedTarget:this.inboxAnchorEl},this.inboxPopoverOptions)},conversationConfig:{constructor:x,options:{isAutoFetch:!1,collection:this.searchImageQueries,imageUploadMaxBytes:this.getImageUploadMaxBytes(),canModifySafeMode:this.getCanModifySafeMode(),isSafeModeEnabled:o.bool("safe_mode")&&this.user.get("safe_mode"),isProjectXEnabled:!0}}}),this._onConversationMessageInputThrottled=n.throttle(this._onConversationMessageInput,this.get("resetPollingTypingDebounceRate"),{leading:!0,trailing:!1}),this.listenTo(a,N.CONVERSATION_OPEN_TUMBLELOGS,this._onEventBusOpenConversationUsingTumblelogModels),this.listenTo(a,N.CONVERSATION_OPEN_MODEL,this._onEventBusOpenConversationUsingModel),this.listenTo(a,N.CONVERSATION_OPEN_ID,this._onEventBusOpenConversationUsingIdAndParticipant),this.listenTo(a,N.CONVERSATION_OPEN_NAME,this._onEventBusOpenConversationUsingBlogName),this.listenTo(a,N.INBOX_OPEN,this._onEventBusOpenInboxFromRoute),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_CONVERSATION_MODEL,this._onOpenConversationUsingConversationModel),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,this._onOpenConversationUsingParticipantModels),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_TUMBLR_URL,this._onConversationClickBlog),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_MESSAGING_URL,this._onConversationClickMessagingBlog),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_DELETE_MODEL,this._onConversationDelete),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_FETCHING,this._onConversationFetching),this.listenTo(this.eventBus,this.eventBus.BLOCK,this._onBlock),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGES_SEND_REQUESTED,this._onConversationMessagesSendRequested),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGE_SENT,this._onConversationMessageSent),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGE_FAILED,this._onConversationMessageFailed),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGE_INPUT,this._onConversationMessageInputThrottled),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGES_UNREAD_FETCHED,this._playConversationSounds),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MARK_AS_SPAM,this._onConversationMarkAsSpam),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_PREVIEW_ADD,this._onConversationImagePreviewAdd),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_PREVIEW_DISMISS,this._onConversationImagePreviewDismiss),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_PREVIEW_EDIT,this._onConversationImagePreviewEdit),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_LIGHTBOX,this._onConversationImageLightbox),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_COMPOSE_PLUGIN_CLICK,this._onConversationComposePluginClick),this.listenTo(this.eventBus,this.eventBus.NEW_EMPTY_INBOX_SUGGESTION_CLICK,this._onEmptyInboxSuggestionClick),this.listenTo(this.eventBus,this.eventBus.OLD_EMPTY_INBOX_SUGGESTION_CLICK,this._onEmptyInboxSuggestionClick),this.listenTo(this.eventBus,this.eventBus.NEW_EMPTY_INBOX_NEW_MESSAGE_CLICK,this._onEmptyInboxNewMessageClick),this.listenTo(this.eventBus,this.eventBus.OLD_EMPTY_INBOX_NEW_MESSAGE_CLICK,this._onEmptyInboxNewMessageClick),this.listenTo(a,"toaster:updateMessagingUnreadCounts",this._onPollUpdate),this.listenTo(a,"logout",this._onEventBusLogout),this.listenTo(this.currentBlogModel,"change",this._onCurrentBlogModelChange),this.listenTo(this.windowManager,"change",this._onWindowManagerChange),this.listenTo(this.unreadManager,"change:channel",this._onUnreadManagerChannelChange),this.listenTo(this.unreadManager,"change:conversation",this._onUnreadManagerConversationChange),this.listenTo(this.windowManager,"inbox:added",this._onWindowManagerInboxAdded),this.listenTo(this.windowManager,"inbox:removed",this._onWindowManagerInboxRemoved),this.listenTo(this.windowManager,"conversation:added",this._onWindowManagerConversationAdded),this.listenTo(this.windowManager,"conversation:removed",this._onWindowManagerConversationRemoved),this.listenTo(this.windowManager,"conversations:loaded",this._onWindowManagerConversationsLoaded),this.listenTo(this.windowManager,"conversation:minimized",this._onWindowManagerConversationMinimized),this.listenTo(this.windowManager,"conversation:unminimized",this._onWindowManagerConversationUnminimized),this.listenTo(this.messagingNotifier,"notification:display",this._onDesktopNotificationDisplayed),this.listenTo(this.messagingNotifier,"notification:permission:change",this._onDesktopNotificationPermissionChange),this.listenTo(this.channels,"change:unread_messages_count_sum",n.debounce(n.bind(this._onChannelsUnreadMessageCountChange,this),0)),this.messagingPoller=new g({channels:this.channels,user:this.user,callback:n.bind(this._onPollUpdate,this),frequency:this.getPollingFrequencyInbox()}),this._onWindowManagerChange(this.windowManager)},render:function(){return this.inboxAnchorEl&&this.inboxAnchorEl.on("click.messaging",n.bind(this._onClickInboxAnchover||(this.inboxPopover=this.windowManager.addInbox(this.inboxCollection))},openConversationPopover:function e(t,i){var e;return n.isEmpty(t.get("participantUuid"))&&t.set("participantUuid",this.getCurrentBlogId()),e=this.windowManager.getConversationPopover(t),this.windowManager.removeInbox(this.inboxCollection),e?void e.refresh(t):void this.windowManager.addConversation(t,{context:i})},fetchInbox:function(){var e=this.getCurrentBlogId();if(this._pendingInboxRequest&&this._pendingInboxBlog){if(e===this._pendingInboxBlog)return;this._pendingInboxRequest.abort()}this._pendingInboxBlog=ebind(function(){thiunction(){this.messagingLogger.logInboxOpened(this.inboxCollection.size())},this))},getCurrentChannel:function(){return this.currentBlogModel.getChannel()},getCurrentBlogId:function(){return this.currentBlogModel.getId()},getPollingFrequencyInbox:function(){return n.get(this.data,"polling_frequency_inbox")},getCanModifySafeMode:function(){return n.get(this.data,"can_modify_safe_mode")},getPollingFrequencyConversation:function(){return n.get(Limit:function(){return n.get(this.data,"append_favorites_to_inbox_limit")},isDesktopNotificationEnabled:function(){return n.get(this.data,"is_desktop_notifications_enabled",!1)},isNewEmptyInboxEnabled:function(){rempty_inbox_enabled",!1)},getoffRatesConversation:function(){return[1,1,1,1,2,2,2,2,4,4,4,4,8,8,8,8,16]},getMessagingNotificationIcon:function(){returBytes:function(){return n.get(this.data,"image_upload_max_bytes",10485760)},_onWindowManagerInboxAdded:function(e,t){this.fetchInbox()},_onWindowManagerInboxRemoved:function(e,t){delete this.inboxPopover,this.messagingLogger.logInboxClosed()},_onWindowManagerConversationAdded:function(e,t,i){var s=n.get(i,"isFromPersistence",!1);t.isMinimized()||(t.fetch().always(n.bind(function(){s||this.messagingLogger.logConversationOpened(e,n.get(i,"context"))},this)),t.focus())},_onWindowManagerConversationRemoved:function(e,t,i){this.messagingLogger.logConversationClosed(e,n.get(i,"context"))},_onWindowManagerConversationsLoaded:function(e,t){0===e.length&&0===t.length||this.messagingLogger.logConversationWindowsLoaded(e,t)},_onWindowManagerConversationMinimized:function(e,t){this.messagingLogger.logConversationMinimized(e)},_onWindowManagerConversationUnminimized:function(e,t){this.messagingLogger.logConversationUnminimized(e)},_getChannelsEnabledForMessagingAsCollection:function(){return new I(n.invoke(this.user.getChannelsEnabledForMessaging(),"toJSON"))},_getInitiallySelectedChannel:function(){return this.channels.get(this.user.getCurrentMessagingChannelUuid())||n.first(this.channels.models)},_onClickInboxAnchor:function(e){e.preventDefault(icipant:function(e,t,i){this._openConversationUsingIdAndParticipant(e,t,i)},_onEventBusOpenConversationUsingTumblelogModels:function(e,t){this._openConversationUsingTumblelogModels(e,t)},_onEventBusOpenConversationUsingModel:function(e,t){this.openConversationPopover(e,t)},_onEventBusOpenConversationUsingBlogName:function(e,t){this._openConversationFromBlogName(e,t)},_onEventBusOpenInboxFromRoute:function(){this.openInboxPopover()},_onOpenConversationUsingConversationModel:function(e,t){this.openConversationPopover(e,t)},_openConversationUsingIdAndParticipant:function(e,t,i){var s=new E({id:e,participantUuid:t});s.fetchConversation().then(n.bind(function(){this.openConversationPopover(s,i)},this))},_openConversationUsingTumblelogModels:function(e,t){var i=n.map(e,function(e){return new T(e.toJSON(),{parse:!0})});this._onOpenConversationUsingParticipantModels(i,t)},_onOpenConversationUsingParticipantModel().toJSON()),s=n.find(e,function(e){return e.get("name")===i.get("name")});if(n.isEmpty(s)){var o=new E({participants:[i].concat(e),participantUuid:this.getCurrentBlogId()});this.openConversationPopover(o,t)}},_onPollUpdate:function(e){e=n.get(e,"unread_messages"),n.get(e,"error")!==!0&&this.unreadManager.setData(e)},_onConversationClickBlog:function(e){var t=n.get(e,"url"),i=n.get(e,"blogName"),s=n.get(e,"postId"),o=n.get(e,"searchTagTerm"),r=n.get(e,"originalEvent"),l=n.get(e,"otherParticipant"),c=!!l&&l.get("seconds_since_last_activity")!==-1;r&&r.preventDefault(),a.trigger("peepr-open-request",{url:t,tumblelog_name:i,post_id:s,searchTagTerm:o}),this.messagingLogger.logPeeprOpen(t,i,s,o,c)},_onConversationClickMessagingBlog:function(e){var t=n.get(e,"blogName"),i=n.get(e,"originalEvent");i&&i.preventDefault(),this._openConversationFromBlogName(t,"conversation-permalink"),this.messagingLogger.logMessagingPermalinkOpen(t)},_onDesktopNotificationDisplayed:function(e){thisPermissionGranted():this.messagingLogger.logNotificationPermissionDenied()},_onConversationMarkAsSpam:function(e,t){var i;e&&t&&(i=s("%1$s will be blocked and reported. And any trace of this conversation will disappear from your inbox.",t.get("name")),u.confirm(i,n.bind(function(){this.messagingLogger.logConversationSpamIntent(e),this._removeConversation(e),e.markAsSpam().then(n.bind(function(){this.messagingLogger.logConversationSpamSuccess(e)},this)).fail(n.bind(function(){this.messagingLogger.logConversationSpamFail(e)},this))},this),null,s("Mark it spam"),s("Nevermind")))},_onConversationImagePreviewAdd:function(e,t){this.messagingLogger.logImagePreviewAdd(e,t)},_onConversationImagePreviewDismiss:function(e,t){this.messagingLogger.logImagePreviewDismiss(e,t)},_onConversationImagePreviewEdit:function(e,t){this.messagingLogger.logImagePreviewEdit(e,t)},_onConversationImageLightbox:function(e){var t=n.get(e,"lightBoxImageData"),i=n.get(e,"lightBoxIndex",0);a.trigger("lightbox-open-request",t,i)},_onConversationComposePluginClick:function(e,t){this.messagingLogger.logComposePluginClick(e,t)},_onBlock:function(e,t){n.ind(function(){c.block(e).then(n.bind(function(){this._onBlockSuccess(e,t)},this))},this))},_onBlockSuccess:function(e,t){n.isEmpty(e)||(t&&this._removeConversation(t),a.trigger("blocks:block_added",{loggingData:{from:"messaging"}}),this.messagingLogger.logBlock(e))},_removeConversation:function(e){this.windowManager.removeConversation(e),this.inboxCollection.remove(e)},_copyCollectionData:function(e,t){t.reset(e.models),t.setNextLink(e.getNextLink())},_onCurrentBlogModelChange:function(){var e=this.currentBlogModel.getPrevChannel(),t=this.currentBlogModel.getChannel();e&&this._copyCollectionData(this.inboxCollection,e.get("conversations")),t&&(this._copyCollectionData(t.get("conversations"),this.inboxCollection),this.user.setCurrentMessagingChannelUuid(t.get("uuid"))),this.fetchInbox()},_onConversationDelete:function(e){u.confirm(s("Permanently delete this conversation?"),n.bind(function(){this.messagingLogger.logConversationDeleted(e),e.destroy(),this.windowManager.removeConversation(e),this.inboxCollection.remove(e.tionFetching:function(e){this.unreadManager.setConversationModelCount(e,0)},_onUnreadManagerChannelChange:function(e,t){var i=this.getCurrentChannel(),s=n.sum(t);this.windowManager.isInboxOpen()&&i===e&&this.fetchInboxgenerateBrowserNotification(e,t,i),this._setConversationUnreadCount(e,t,i)},_onChannelsUnreadMessageCountChange:function(e,t){var i=e.previous("unread_messages_count_sum");t>i&&this._playSoundName("notification-sound")},_playConvershis.user.isSoundsEnabled()&&this.notificationSoundManager.playSoundName(e)},_setConversationUnreadCount:function(e,t,i){var n=this.windowManager.getConversationModelByIdAndParticipant(e,i.get("uuid"));n&&n.set("unreadCount",t)},_generateBrowserNotification:function(e,t,i){var n,s=!1;t<=0||(this.activeWindow.isActive&&this.windowManager.get("isConversationOpen")?(n=this.windowManager.getConversationModelByIdAndParticipant(e,i.get("uuid")),n&&this.windowManager.isConversationMinimized(n)&&(s=!0)):s=!0,s&&this.messagingNotifier.notifyOnUnread(e,i))},_showErrorMessage:function(e){u.alert(e)},_onWindowManagerChange:function(e){var t,i,n=e.isInboxOpen(),s=e.isConversationOpen(),o=n||s;return this.user.isVerifiedEmail()&&o?(s?(t=this.getPollingFrequencyConversation(),i=this.getBackoffRatesConversation()):(t=this.getPollingFrequencyInbox(),i=this.getBackoffRatesInbox()),this.messagingPoller.setFrequency(t),this.messagingPoller.setBackoffRates(i),void this.messagingPoller.start()):void this.messagingPoller.stop()},_onConversationMessagesSendRequested:function(){this._playSoundName("send-sound")},_onConversationMessageSent:function(tionMessageFailed:function(e,t){this.messagingLogger.logMessageFailed(e,t)},_onConversationMessageInput:function(e,t){this.messagingPoller.resetPollingFrequency(),this.messagingPoller.poll()},_openConversationFromBlogName:function(e,t){var i=new h({name:e});return i.fetch_popover_data().then(n.bind(function(){return n.isEmpty(i.get("uuid"))?void this._showErrorMessage(s("Could not load conversation.")):i.get("can_receive_messages")?void this._openConversationUsingTumblelogModels([i],t):void this._showErrorMessage(s("This Tumblr can't receive messages."))},this))},_onEventBusLogout:function(){this.windowPersistenceManager.clear()},_onEmptyInboxNewMessageClick:function(e){this.messagingLogger.logInboxEmptyNewMessageClick(this.currentBlogModel.getChannel().get("name"),e)},_onEmptyInboxSuggestionClick:function(e,t,i){this.messagingLogger.logEmptySuggestionClick(this.currentBlogModel.getChannel().get("name"),e.get("name"),t,i)}});e.exports=R},function(e,t,i){"use strict";var n=i(3),s=function(){window.onfocus=n.bind(this.onFocus,this),window.onblur=n.bind(this.onBlur,this)};s.prototype.onFocus=function(e){this.isActive=!0},s.prototype.onBlur=function(e){this.isActive=!1},s.prototype.isActive=!0;var o,r=function(){return null==o&&(o=new s),o};e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(180),o=i(214),r=i(136),a=o.extend({name:"MessagingLogger",defaults:{isDebugEnabled:!1,platform:"web"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults)))},logInboxOpened:function(e){var t={conversationCount:e,status_indicator_enabled:s.bool("status_indicator")};this._logIt("inbox:open",t)},logInboxClosed:function(){this._logIt("inbox:closed")},logConversationOpened:function(e,t){this._logIt("conversation:open",{conversationId:e.get("id"),context:t,status_indicator_enabled:s.bool("status_indicator"),status_indicator:e.getOtherParticipant().get("seconds_since_last_activity")!==-1?"greendot":"none"})},logConversationClosed:function(e,t){this._logIt("conversation:closed",{conversationId:e.get("id"),context:t})},logConversationDeleted:function(e){this._logIt("ationStarted:function(e,t){this._logIt("conversation:started",{context:t})},logMessageSent:function(e,t){!n.isEmpty(t)&&t.isNew()&&this.logConversationStarted(t),this._logIt("message:sent",this._getMessageLoggingData(e,t))},logMessageFailed:function(e,t){this._logIt("message:failure",this._getMessageLoggingData(e,t))},logF("block",{blockiication:function(e){this._logIt("notification:display",{conversationId:e})},logNotificationPermissionGranted:function(){this._logIt("notification:permission:granted")},logNotificationPermissionDenied:function(){this._logIt("notification:permission:denied")},logConversationWindowsLoaded:function(e,t){this._logIt("conversation:windows:loaded",{numOpen:e.length,numMinimized:t.length})},logConversationMinimized:function(e){this._logIt("conversation:minimized",{conversationId:e.get("id")})},logConversationUnminimized:function(e){this._logIt("conversation:unminimized",{conversationId:e.get("id")})},logConversationSpamIntent:function(e){this._logIt("conversation:spam:intent",{conversationId:e.get("id")})},logConversationSpamSuccess:function(e){this._logIt("conversation:spam:success",{conversationId:e.get("id")})},logConversationSpamFail:function(e){this._logIt("conversation:spam:fail",{conversationId:e.get("id")})},logImagePreviewAdd:function(e,t){this._logImagePreviewAction("add",e,t)},logImagePreviewDismiss:function(e,t){this._logImagePreviewAction("dismiss",e,t)},logImagePreviewEdit:function(e,t){this._logImagePreviewAction("edit",e,t)},logComposePluginClick:function(e,t){var i,s=t.getName();n.isEmpty(s)||(i=s+":intent",this._logIt(i,{conversationId:e.get("id")}))},logPeeprOpen:function(e,t,i,o,r){var a={url:e,blogName:t,status_indicator_enabled:s.bool("status_indicator"),status_indicator:r?"greendot":"none"};n.isEmpty(i)||n.extend(a,{postId:i}),n.isEmpty(o)||n.extend(a,{searchTagTerm:o}),this._logIt("punction(e){var t={blogName:e};this._logIt("conversation-permalink:open",t)},logInboxEmptyNewMessageClick:function(e,t){var i={blogName:e},n=t?"new:inbox:empty:new-message:button:click":"old:inbox:empty:new-message:button:click";this._logIt(n,i)},logEmptySuggestionClick:function(e,t,i,n){var s={sendingBlog:e,receivingBlog:t,context:i},o=n?"new:inbox:empty:suggestion":"old:inbox:empty:suggestion";this._logIt(o,s)},_logImagePreviewAction:function(e,t,i){var s,o,r,a=i.get("context");n.isEmpty(a)||(s=i.get("loggingData"),o=a+":"+e,r=n.extend({},s,{conversationId:t.get("id")}),this._logIt(o,r))},_getMessageLoggingData:function(e,t){var i,s,o,r,a,l,c,u,h;return n.isEmpty(e)?null:(l=e.isPost(),i=l?0:(e.getMessage()||"").length,s=e.get("type"),o=e.get("context"),a=e.get("loggingData"),h=e.get("creationUserAction"),r=n.extend({},a,{conversationId:t?t.get("id"):null,messageLength:i,messageType:s}),n.isEmpty(h)||n.extend(r,{creationUserAction:h}),l&&(c=e.get("post").toJSON(),u=n.get(c,"blog.uuid")||n.get(c,"blog"),n.extend(r,{postBlogUuid:u,postId:n.get(c,"id")})),n.isEmpty(o)||n.extend(r,{context:o}),r)},_logIt:function(e,t){t=t||{},n.extend(t,{platform:this.get("platform")}),r.trigger("Kraken:Messaging:"+e,{loggingData:t})}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(644),o=i(645),r=s.extend({name:"MessagingPoller",defaults:n.defaults({url:o,frequency:15e3},s.prototype.defaults),initialize:function(e){return e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"channels","user")),this._requestData={unread_messages:!0},s.prototype.initialize.apply(this,arguments)},getRequestData:function(){return this._requestData},hasResponseChanged:function(e){return!n.isEmpty(n.get(e,"unread_messages"))}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(214),r=o.extend({name:"BasePoller",defaults:{url:null,requestType:"GET",dataType:"JSON",cache:!1,frequency:6e4,backoffRates:[],stopAfterNumErrors:3,isPolling:!1,hasPolled:!1,isDebugEnabled:!1},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"callback")),this.currentErrorCount=0,this.currentUnchangedCount=0},start:function(e){this.set("isPolling",!0),e?this.scheduleNextPoll():this.poll()},stop:function(){this.set("isPolling",!1),this.cancel()},cancel:function(){this.cancelCurrent(),this.cancelNext()},cancelCurrent:function(){this._currentRequest&&(n.result(this._currentRequest,"abort"),this._currentRequest=null)},cancelNext:function(){this._nextPollToken&&(clearTimeout(this._nextPollToken),this._nextPollToken=null)},beforeRemove:function(){this.stop()},setFrequency:function(e){this.set("frequency",e),this.resetPollingFrequency()},setBackoffRates:function(e){thiFrequency:function(){this.currentUnchangedCount=0,this.set("hasPolled",!1)},poll:function(){this.cancel(),this._lastPollTime=(new Date).getTime();var e=this.makeRequest.call(this);return e.done(n.bind(this._onRequestSuccess,this)).fail(n.bind(this._onRequestFail,this)).always(n.bind(this._onRequestAlways,this)),this._currentRequest=e,e},getRequestData:function(){return{}},hasResponseChanged:function(){return!0},resetErrorCount:function(){this.currentErrorCount=0,this.start()},parse:function(e){return e},getBackoffRate:function(){var e,t=this.get("backoffRates");return n.isEmpty(t)||!n.isArray(t)||0===this.currentUnchangedCount?1:(e=Math.min(this.curreingFrequency:function(){return this.get("frequency")*this.getBackoffRate()},makeRequest:function(){var e=this.getRequestData(),t={url:this.get("url"),type:this.get("requestType"),dataType:this.get("dataType"),cache:this.get("cache"),data:e};return s.ajax(t)},scheduleNextPoll:function(){var e=this.getPollingFrequency();return this.set("hasPolled",!0),!!this.get("isPolling")&&void(!n.isFinite(e)||e<=0||(this.currentErrorCount<=this.get("stopAfterNumErrors")?(this.cancelNext(),this._nextPollToken=setTimeout(n.bind(this.poll,this),e)):this.stop()))},_onRequestSuccess:function(e){this.currentErrorCount=0,e=this.parse(e),this.callback&&this.callback(e,this._lastPollTime),this.hasResponseChanged(e)||!this.get("hasPolled"urrentUnchangedCount++},_onRequestFail:function(){this.currentErrorCexports=r},function(e,t){"use strict";var i="/svc/user/counts";e.exports=i},function(e,t,i){"use strict";var n=i(7),s=i(3),o={CONVERSATION_FETCHING:"conversation:fetching",CONVERSATION_OPEN_CONVERSATION_MODEL:"conversation:open:model:conversation",CONVERSATION_OPEN_PARTICIPANT_MODELS:"conversation:open:model:partipants",CONVERSATION_OPEN_TUMBLR_URL:"conversation:open:tumblr:url",CONVERSATION_OPEN_MESSAGING_URL:"conversation:open:messaging:url",CONVERSATION_DELETE_MODEL:"conversation:delete:model",CONVERSATION_MESSAGE_SENT:"conversation:message:sent",CONVERSATION_MESSAGE_SENDING:"conversation:message:sending",CONVERSATION_MESSAGE_FAILED:"conversation:message:failed",CONVERSATION_MESSAGE_INPUT:"conversation:message:input",CONVERSATION_MESSAGES_SEND_REQUESTED:"conversation:messages:send:requested",CONVERSATION_MESSAGES_SENDING:"conversation:messages:sending",CONVERSATION_MESSAGES_UNREAD_FETCHED:"conversation:messages:unread:fetched",CONVERSATION_MARK_AS_SPAM:"conversation:spam",CONVERSATION_IMAGE_PREVIEW_ADD:"conversation:image:preview:add",CONVERSATION_IMAGE_PREVIEW_DISMISS:"conversation:image:preview:dismiss",CONVERSATION_IMAGE_PREVIEW_EDIT:"conversation:image:preview:edit",CONVERSATION_IMAGE_LIGHTBOX:"conversation:image:lightbox",CONVERSATION_COMPOSE_PLUGIN_CLICK:"conversation:compose:plugin:click",BLOCK:"block",NEW_EMPTY_INBOX_SUGGESTION_CLICK:"new:inbox:suggestion:click",NEW_EMPTY_INBOX_NEW_MESSAGE_CLICK:"new:inbox:new-message:click",OLD_EMPTY_INBOX_SUGGESTION_CLICK:"old:inbox:suggestion:click",OLD_EMPTY_INBOX_NEW_MESSAGE_CLICK:"old:inbox:new-message:click"},r=function(){};r.extend=n.Model.extend,s.extend(r.prototype,n.Events),s.extend(r.prototype,o),e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(214),o=i(648),r=s.extend({name:"MessagingUnreadManager",defaults:{dataChannelKey:"mention_key",overridesExpirationInMs:500},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(tels"));var t=this.channels.map(function(e){return{channelId:e.get("uuid")}});this.unreadCollection=new o(t),this.unreadCollectionOverrides=new o(t),this.listenTo(this.unreadCollection,"change:data",this._onUnreadCollectionChange)},setData:function(e){this._pruneOverrides(),this._updateUnreadCollection(e),this.unreadData=e},setConversationModelCount:function(e,t){var i,n=e.get("id"),s=e.get("participantUuid"),o=this.unreadCollectionOverrides.findWhere({channelId:s});o&&(i=o.get("data")||{},i[n]=t,o.set({data:i,updateDate:new Date}),this._updateUnreadCollection(this.unreadData))},_getOverridesData:function(){var e=this.get("dataChannelKey");return this.unreadCollectionOverrides.reduce(function(t,i){
var s=i.get("data"),o=this.channels.get(i.get("channelId")),r=o.get(e);return n.isEmpty(s)||(t[r]=s),t},{},this)},_pruneOverrides:function(){var e=new Date,t=this.get("overridesExpirationInMs");this.unreadCollectionOverrides.each(function(i){var s=i.get("updateDate");n.isDate(s)&&e-s>t&&i.set({updateDate:null,data:null})})},_updateUnreadCollection:function(e,t){var i=this._getOverridesData();this.unreadCollection.each(function(t){var s=this.channels.get(t.get("channelId")),o=s.get(this.get("dataChannelKey")),r=n.get(e,o),a=n.get(i,o);n.isEmpty(a)||(r=n.merge({},r,a)),t.set("data",r)},this)},_onUnreadCollectionChange:function(e){var t,i=e.get("data")||null,s=e.previous("data")||null,o=this.channels.get(e.get("channelId"));this.trigger("change:channel",o,i),n.each(i,function(e,i){t=n.get(s,i),t!==e&&this.trigger("change:conversation",i,e,o)},this)}});e.exports=r},function(e,t,i){"use strict";var n=i(190),s=i(649),o=n.extend({model:s});e.exports=o},function(e,t,i){"use strict";var n=i(185),s=n.extend({idAttribute:"channelId",defaults:{channelId:null,data:null}});e.exports=s},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(192),r=i(214),a=i(651),l=i(652),c=i(654),u=i(655),h=i(656),d=r.extend({name:"MessagingWindowManager",defaults:{isInboxOpen:!1,isConversationOpen:!1,inboxAnimationSpeed:100,conversationAnimationSpeed:250,isMultipleOpenWindowsEnabled:!1,conversationPopoversContainerClass:"messaging-conversation-popovers",containerClass:"messaging-conversations-container",openConversationsContainerClass:"messaging-open-conversations",minimizedConversationsContainerClass:"messaging-minimized-conversations",bodyClassConversationsHasOpen:"messaging-conversations-open",bodyClassConversationsHasMinimized:"messaging-conversations-minimized",containerClassConversationsHasOpen:"has-open",containerClassConversationsHasMinimized:"has-minimized",persistenceKeyOpen:"open",persistenceKeyMinimized:"minimized"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","user","channels","currentBlogModel","keyboardManager","inboxConfig","conversationConfig","persistenceManager")),this.openConversations=new l,this.minimizedConversations=new l,this.onlineStatusModel=new c,this.onlineStatusModel.on("sync",this._setParticipantOnlineStatuses,this),this.listenTo(this.openConversations,"add remove",this._onConversationsCollectionChange),this.listenTo(this.minimizedConversations,"add remove",this._onConversationsCollectionChange),this.listenTo(this.openConversations,"add remove",this._onOpenConversationsCollectionChange),this.listenTo(this.minimizedConversations,"add remove",this._onMinimizedConversationsCollectionChange),this.listenTo(this.openConversations,"add",this._onConversationAdd),this.listenTo(this.openConversations,"remove",this._onConversationRemove),this.listenTo(this.minimizedConversations,"add",this._onConversationAdd),this.listenTo(this.minimizedConversations,"remove",this._onConversationRemove),this.persistenceManager&&this.listenTo(this.persistenceManager,"sync",this._onPersistenceManagerSync)},remove:function(e){this.isInboxOpen()&&this.removeInbox(),this.isConversationOpen()&&this.removeConversations(e)},saveConversationsState:function(e,t){this.persistenceManager&&!this.get("isSyncing")&&this.persistenceManager.save(e.pluck("model"),t)},loadConversationsState:function(){var e,t;this.persistenceManager&&(t=this.persistenceManager.load(this.get("persistenceKeyMinimized")),e=this.persistenceManager.load(this.get("persistenceKeyOpen")),t.then(s.bind(function(e){var t=this;this._addLoadedConversationModels(e,this.minimizedConversations,{isMinimized:!0}),e.length&&setTimeout(function(){t._getOnlineStatusOfParticipants(e)},1e3),this.trigger("conversations:loaded:minimized",e)},this)),e.then(s.bind(function(e){this._addLoadedConversationModels(e,this.openConversations),th(e,t).spread(s.bind(function(e,t){this.trigger("conversations:loaded",e,t)},this)))},_addLoaion(e,n){s.delay(s.bind(function(){this._addLoadedConversationModel(e,t,i)},this),n)},this)},_getOnlineStatusOfParticipants:function(e){this.otherParticipants=e.map(function(e){return e.getOtherParticipant()}),this.onlineStatusModel.fetch({data:{participantIds:this.otherParticipants.map(function(e){return e.get("uuid")})}})},_setParticipantOnlineStatuses:function(e){var te,i){var n=s.find(t.otherParticipants,function(e){return e.get("name")===i});n.set("seconds_since_last_activity",e)}),delete this.otherParticipants},_addLoadedConversationModel:function(e,t,i){var n={skipAnimationOnRender:!0},s=this._createConversationPopover(e,n,i),o={isFromPersistence:!0,context:"persistence"};return t.add({model:e,popover:s,options:o},o)},addInbox:function(e,t){var i=this.get("inboxAnimationSpeed");return this.isInboxOpen()?this.inboxPopover:(this.inboxCollection=e,this.inboxPopover=this._createInboxPopover(e),this.trigger("inbox:adding",e,this.inboxPopover,t),i>0?setTimeout(s.bind(function(){this._afterInboxOpened(t)},this),i):this._afterInboxOpened(t),this.listenToOnce(this.inboxPopover,"close",function(){this._onInboxClose(t)}),this.set("isInboxOpen",!0),this.inboxPopover)},removeInbox:function(e){e||(e=this.inboxCollection),e===this.inboxCollection&&this.inboxPopover&&this.inboxPopover.teardown()},isInboxOpen:function(){return this.get("isInboxOpen")},addConversation:function(e,t){var i,n=this.get("isMultipleOpenWindowsEnabled");return n||this.minimizeConversations(!0),i=this._createConversationPopover(e),e.set("lastOpenedDateTs",(new Date).getTime()),this.openConversations.add({model:e,popover:i,options:t}),i},removeConversation:function(e,t){var i=this._getWindowModel(e);this.openConversations.remove(i,{skipAnimation:t})},isConversationMinimized:function(e){var t,i=this.getConversationPopover(e);return!!i&&(t=i.getView(),t&&t.isMinimized())},removeConversations:function(e){this.openConversations.remove(this.openConversations.models,{skipAnimation:e})},isConversationOpver:function(e){var t=this._getWindowModel(e);return t?t.getPopover():null},getConversationModelByIdAndParticipant:function(e,t){return this.openConversations.getByIdAndParticipant(e,t)||this.minimizedConversations.getByIdAndParticipant(e,t)},minimizeConvhis.openConversations.models);s.each(t,function(t){t.getView().minimize(e)})},_createConversationPopover:function(e,t,i){var n,o=s.result(this.conversationConfig,"options"),r=s.get(this.conversationConfig,"constructor"),a=s.get(this.conversationConfig,"popoverOptions"),l=s.bind(function(t){return s.extend({},o,{eventBus:this.eventBus,user:this.user,channels:this.channels,model:e,popoverContainer:t.el,keyboardManager:this.keyboardManager},i)},this);return a=s.extend({},a,{viewConstructor:r,viewOptions:l},t),this.conversationsPopoversContainer||this._createConversationsPopoversContainer(),n=new u(a),n.render(),this._removeTimer&&clearTimeout(this._removeTimer),n},_createInboxPopover:function(e){var t,i=s.result(this.inboxConfig,"options"),n=s.get(this.inboxConfig,"constructor"),o=s.result(this.inboxConfig,"popoverOptions"),r=s.bind(function(t){return s.extend({},i,{eventBus:this.eventBus,collection:e,user:this.user,channels:this.channels,currentBlogModel:this.currentBlogModel,keyboardManager:this.keyboardManager,popoverContainer:t.el})},this);return o=s.extend({},o,{viewConstructor:n,animationSpeed:this.get("inboxAnimationSpeed"),viewOptions:r}),t=new a(o),t.render(),t},_removeConversationPopover:function(e,t){var i=this.get("conversationAnimationSpeed");t||i<=0?e.remove():e.teardown(),this._checkRemoveConversationPopoversContainer(t)},_checkRemoveConversationPopoversContainer:function(e){var t=this.get("conversationAnimationSpeed"),i=function(){var e=this.openConversations.length>0,t=this.minimizedConversations.length>0;e||t||this._removeConversationPopoversContainer()};this._removeTimer&&(clearTimeout(this._removeTimer),this.moveTimer=setTimeout(s.bind(function(){i.call(this),this._removeTimer=null},this),t)},_focusNextConversationWindow:function(e){return this._incrementFocusConversationWindow(e,1)},_focusPreviousConversationWindow:function(e){return this._incrementFocusConversationWindow(e,-1)},_incrementFocusConversationWindow:function(e,t){var i,n,o,r,a,l=[];return l.push.apply(l,this.openConversations.models),l.push.apply(l,this.minimizedConversations.models),a=l.length,!(a<2)&&(i=s.indexOf(l,e),n=i+=t,!(n>=a||n<0)&&(o=s.get(l,n),!s.isEmpty(o)&&(r=o.getPopover(),r.focus(),!0)))},_callAfterDelay:function(e,t){t>0?setTimeout(s.bind(e,this),t):e.call(this)},_onConversationAdd:function(e,t,i){var n=s.get(i,"isMoving",!1);n||this._afterConversationWindowModelAdded(e,i)},_onConversationRemove:function(e,t,i){var n=s.get(i,"skipAnimation",!1),o=s.get(i,"isMoving",!1);o||this._afterConversationWindowModelRemoved(e,n)},_onPersistenceManagerSync:function(e,t){this._syncFlushData||(this._syncFlushData={}),s.set(this._syncFlushData,e,t),this._syncFlushTimer||(this._syncFlushTimer=setTimeout(s.bind(function(){this._flushSync(this._syncFlushData),delete this._syncFlushTimer,delete this._syncFlushData},this),50))},_flushSync:function(e){var t=s.get(e,this.get("persistenceKeyOpen"),[]),i=s.get(e,this.get("persistenceKeyMinimized"),[]),n=this.openConversations.pluck("model"),o=this.minimizedConversations.pluck("model"),r=this._getConversationLookupCache(t),a=this._getConversationLookupCache(i),l=this._getConversationLookupCache(n),c=this._getConversationLookupCache(o),u=[],h=[],d=[],p=[];this.set("isSyncing",!0),s.each(l,s.bind(function(e,t){s.has(r,t)||(s.has(a,t)?h.push(e):u.push(e))},this)),d=s.reduce(c,s.bind(function(e,t,i){return!s.has(a,i)&&s.has(r,i)&&e.push(t),e},this),[]),p=s.reduce(r,s.bind(function(e,t,i){return s.has(l,i)||s.has(c,i)||e.push(t),e},this),[]),s.each(h,s.bind(function(e){var t=this.openConversations.getByConversationModel(e);t.getView().minimize(!0)},this)),s.each(d,s.bind(function(e){var t=this.minimizedConversations.gmize(!0)},this)),s.each(u,s.bind(function(e){this.removeConversation(e,!0)},this)),s.each(p,s.bind(function(e){this.addConversation(e)},this)),this.set("isSyncing",!1)},_getConversationLookupCacheKey:function(e){var t=[e.getParticipantId()].conpCache:function(e){return s.mapKeys(e,this._getConversationLookupCacheKey)},_insertElementAtIndex:function(e,t,i){var n=t.children();0===n.length||0===i?t.prepend(e):i>=n.length?t.append(e):e.insertBefore(s.get(n,i))},_onConversationWindowTab:function(e,t){this._focusNextConversationWindow(e)&&t.preventDefault()},_onConversationWindowShiftTab:function(e,t){this._focusPreviousConversationWindow(e)&&t.preventDefault()},_onMinimizedConversationsCollectionChange:function(e,t,i){s.get(i,"isFromPersistence")||this.saveConversationsState(this.minimizedConversations,this.get("persistenceKeyMinimized"))},_onOpenConversationsCollectionChange:function(e,t,i){s.get(i,"isFromPersistence")||this.saveConversationsState(this.openConversations,this.get("persistenceKeyOpen"))},_onConversationsCollectionChange:function(){var e=this.openConversations.length>0||this.minimizedConversations.length>0;this.set("isConversationOpen",e),this._addBodyClasses(),this._addContainerClasses()},_addBodyClasses:function(){var e=n("body");e.toggleClass(this.get("bodyClassConversationsHasOpen"),this.openConversations.length>0),e.toggleClass(this.get("bodyClassConversationsHasMinimized"),this.minimizedConversations.length>0)},_addContainerClasses:function(){var e=this.conversationsPopoversContainer;e&&(e.toggleClass(this.get("containerClassConversationsHasOpen"),this.openConversations.length>0),e.toggleClass(this.get("containerClassConversationsHasMinimized"),this.minimizedConversations.length>0))},_onInboxClose:function(e){var t=this.get("inboxAnimationSpeed");this.trigger("inbox:removing",this.inboxCollesInboxOpen",!1),t>0?setTimeout(s.bind(function(){this._afterInboxClosed(e)},this),t):this._afterInboxClosed(e)},_onChangeConversationMinimized:function(e,t){var i=t?this.openConversations:this.minimizedConversations,n=t?this.minimizedConversations:this.openConversations,s=i.getByConversationModel(e),o=t?"conversation:minimized":"conversation:unminimized",r={isMoving:!0};t||this.get("isMultipleOpenWindowsEnabled")||this.minimizeConversations(!0),i.remove(s,r),n.add(s,r),this.trigger(o,s.getConversation(),s.getPopover())},_afterInboxOpened:function(e){this.trigger("inbox:added",this.inboxCollection,this.inboxPopover,e)},_afterInboxClosed:function(e){this.trigger("inbox:removed",this.inboxCollection,this.inboxPopover,e),this.inboxPopover=null,this.inboxCollection=null},_createConversationsPopoversContainer:function(){return this.conversationsPopoversContainer?this.conversationsPopoversContainer:(this.conversationsPopoversContainer=n("<div />").addClass(this.get("conversationPopoversContainerClass")),this.openConversationsContainer=new h({collection:this.openConversations,className:[this.get("containerClass"),this.get("openConversationsContainerClass")].join(" ")}).render(),this.minimizedConversationsContainer=new h({collection:this.minimizedConversations,className:[this.get("containerClass"),this.get("minimizedConversationsContainerClass")].join(" "),isScrollEnabled:!0,isAdjustToBrowserHeightEnabled:!0}).render(),this.conversationsPopoversContainer.append(this.openConversationsContainer.$el),this.conversationsPopoversContainer.append(this.minimizedConversationsContainer.$el),n("body").append(this.conversationsPopoversContainer),this._addContainerClasses()ConversationsCononversationModel(e)||this.minimizedConversations.getByConversationModel(e)},_addConversationWindowEvents:function(e){var t=e.getView();this.listenTo(t,"keydown:tab",function((t,"keydown:shift+tab",functienToOnce(t,"close",function(){this.rem",function(t,i){this._onChangeConversationMinimized(e.getConversation(),i)})},_afterConversationWindowModelAdded:function(e){var t=e.getConversation(),i=e.getPopover(),n=e.getOptions(),s=this.get("conversationAnimationSpeed"),o=function(){this.trigger("conversation:added",t,i,n)};this.trigger("conversation:adding",t,i,n),this._addConversationWindowEvents(e),this._callAfterDelay(o,s)},_afterConversationWindowModelRemoved:function(e,t){var i=this.get("conversationAnimationSpeed"),n=e.getView(),o=e.getPopover(),r=e.getConversation(),a=e.getOptions(),l=function(){this.trigger("conversation:removed",r,o,a)};this.stopListening(o),this.stopListening(n),this._removeConversationPopover(o,t),this.trigger("conversation:removing",r,o,a),t||i<=0?l.call(this):setTimeout(s.bind(l,this),i)}});e.exports=d},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(283),a=o.extend({className:"popover--inbox-popover",mixins:[r],defaults:{animationSpeed:100},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"viewOptions","viewConstructor"))},render:function(){return this.$wrapper=s("<div />").addClass("popover-inner").appendTo(this.$el),this.$wrapper.addClass("hide-popover"),this.$pinned.addClass("active"),this._createView(this.viewOptions),n.defer(n.bind(function(){this.$wrapper.removeClass("hide-popover")},this)),this},teardown:function(){var e=this.get("animationSpeed");return this.$wrapper.addClass("hide-popover"),this.$pinned.removeClass("active"),e>0?setTimeout(n.bind(this._afterHide,this),this.get("animationSpeed")):this._afterHide(),this},getView:function(){return this.inboxView},_createView:function(e){e=n.isFunction(e)?e.call(this,this):e,this.inboxView&&this.inboxView.remove(),this.inboxView=new this.vierHide:function(){this.inboxView&&this.inboxView.remove(),this.$el.remove()}});e.exports=a},function(e,t,,comparator:function(e){return e.getConversation().get("lastOpenedDateTs")},getByIdAndParticipant:function(e,t){var i=this.find(function(i){var n=i.getConversation();return n.get("id")===e&&n.get("participantUuid")===t});return i?i.getConversation():null},getByConversationModel:function(e){return this.find(function(t){var i=t.getConversation();return!n.isEmpty(i)&&i.isSameConversation(e)})}});e.exports=r},function(e,t,i){"use strict";var n=i(185),s=n.extend({defaults:{popover:null,model:null,options:null,skipAnimation:!1,isMinimizing:!1},getOptions:function(){return this.get("options")},getConversation:function(){return ter")},getView:function(){var e=this.getPopover();return e?e.getView():null}});e.exports=s},function(e,t,i)rl:"/svc/onlinestatus",parse:function(e){return n.result(e,"response")||{}}});e.exports=o},function(e,t,i){"use strict";var n=i(3),s=i(226),o=s.extend({className:"popover--conversation-popover",defaults:{animationSpeed:250,skipAnimationOnRender:!1,skipAnimationOnRemove:!1},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"viewOptions","viewConstructor")),n.isFunction(this.viewOptions)&&(this.viewOptions=this.viewOptions.call(this,this))},render:function(){return this.conversationView=new this.viewConstructor(this.viewOptions),this.$el.html(this.conversationView.render().$el),!this.get("skipAnimationOnRender")&&this.get("animationSpeed")>=0&&this._animateIn(),this},teardown:function(){var e=this.get("animationSpeed");return!this.get("skipAnimationOnRemove")&&e>=0?(this.$el.addClass("hide-popover"),setTimeout(n.bind(this.remove,this),e)):this.remove(),this},beforeRemove:function(){this.conversationView&&this.conversationView.remove()},getView:function(){return this.conversat.poll()},refresh:function(e){var t=this.getView();if(t)return t.refresh(e)},fetch:function(){var e=this.getView();if(e)return e.fetch()},isMinimized:function(){var e=this.getView();if(e)return e.isMinimizeefer(n.bind(function(){this.rendered&&this.$el.removeClass("hide-popover")},this))}});e.exports=o},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(226),r=i(485),a=o.extend({defaults:{isScrollEnabled:!1,isAdjustToBrowserHeightEnabled:!1},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"collection"))},render:function(){return this.get("isScrollEnabled")?(this.$rootContainer=n("<div />").addClass("scroller").appendTo(this.$el),this.scrollBar=new r({el:this.$rootContainer.get(0)}),this.get("isAdjustToBrowserHeightEnabled")&&this.listenTo(this.scrollBar,"resize",this._onScrollResize)):this.$rootContainer=this.$el,this.listenTo(this.collection,"reset",this._onCollectionReset),this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this._renderAllPopovis.scrollBar&&(this.stopListening(this.scrollBar),this.scrollBar.remove())},_renderAllPopovers:function(){var e=this.$rootContainer;this.rendered&&(e.empty(),this.collection.each(s.bind(function(t){var i=t.getPopover();this.rendered&&i&&e.append(i.$el)},this)))},_updateScroll:function(){this.rendered&&this.scrollBar&&(this.get("isAdjustToBrowserHeightEnabled")&&this._updateScrollHeight(),this.scrollBar.update())},_updateScrollHeight:function(){var e,t,i=89;this.scrollBar&&this.rendered&&(e=n(window).height(),t=this.$rootContainer.get(0).scrollHeight,this.$el.height(Math.min(e-i,t)),this.$rootContainer.scrollTop(t))},_onCollectionAdd:function(e,t,i){var n=e.getPopover(),o=n.$el,r=t.indexOf(e),a=this.$rootContainer,l=a.children();this.rendered&&(0===l.length||0===r?a.prepend(o):r>=l.length?a.append(o):o.insertBefore(s.get(l,r)),this.scrollBar&&this._updateScroll())},_onCollectionRemove:function(e,t,i){this.scrollBar&&s.defer(s.bind(this._updateScroll,this))},_onCollectionReset:function(e,t){this._renderAllPopovers()},_onScrollResize:function(){this._updateScrollHeight()}});e.exports=a},function(e,t,i){"use strict";var n=i(8),s=i(192),o=i(3),r=i(214),a=i(658),l=r.extend({name:"MessagingWindowPersistence",defaults:{storageKeyPrefix:"messaging",isSyncEnabled:!1},initialize:function(e){e=o.extend({},e),o.extend(this.attributes,o.pick(e,o.keys(this.defaults))),o.extend(this,o.pick(e,"user")),this.get("isSyncEnabled")&&this._addSyncListeners()},save:function(e,t){var i,n=s.defer(),r=this._getStorageKey(t);return i=o.map(e,this._getObjectFromModel),this._saveLocalStorage(r,i),n.resolve(),n.promise},load:function(e){var t=s.defer(),i=this._getStorageKey(e),n=this._loadLocalStorage(i),r=o.map(n,this._getModelFromObject);return t.resolve(r||[]),t.promise},clear:function(){var e,t=window.localStorage;if(t){e=this._getStorageKey();try{o.each(o.keys(t),function(i){o.star},remove:function("storage.messaging-window-persistence",o.bind(this._onStorageChange,this))},_removeSyncListeners:function(){n(window).off(".messaging-window-persistence")},_onStorageChange:function(e){var t,i,n=o.get(e,"originalEvent.key"),s=o.get(e,"originalEvent.newValue"),r=this._getStorageKey(),a=n.substring(r.length+1);if(!o.isEmpty(n)&&!o.isEmpty(a)&&o.startsWith(n,r)&&!o.isEmpty(s))try{t=JSON.parse(s),i=o.map(t,this._getModelFromObject),this.trigger("sync",a,i),this.trigger("sync:"+a,i)}catch(e){this._triggerError(e)}},_getStorageKey:function(e){var t=[this.get("storageKeyPrefix"),this.user.get("name"),e];return o.compact(t).join(":")},_saveLocalStorage:function(e,t){if(window.localStorage)try{window.localStorage.setItem(e,JSON.stringify(t))}catch(e){this._triggerError(e)}},_loadLocalStorage:function(e){var t;if(!window.localStorage)return[];try{return t=window.localStorage.getItem(e),o.isEmpty(t)?[]:JSON.parse(t)}catch(e){return this._triggerError(e),[]}},_getObjectFromModel:function(e){vtar_url","theme"],i=e.get("participants").map(function(e){return e.pick(t)});return{id:e.get("id"),participantUuid:e.get("participantUuid"),participants:i,lastOpenedDateTs:e.get("lastOpenedDateTs")}},_getModelFromObject:function(e){return new a(e)},_triggerError:function(e){this.trigger("error",e)}});e.exports=l},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(659),r=i(660),a=i(185),l=i(661),c=i(667),u=i(669),h=a.extend({url:"/svc/conversations/messages",mixins:[o,r],relations:{messages:c,participants:u},relationsOrder:["participants","messages"],defaults:{id:null,status:null,last_modified_ts:null,last_read_ts:null,participants:null,messages:null,can_send:!0,is_possible_spam:!1,is_blurred_images:!1,lastOpenedDateTs:null,participantUuid:null,unreadCount:0},fetchNonErrorCodes:[404],fetchNoRetryOnErrorCodes:[403,429],isUnread:function(){retu},flushMessageQueue:function(e){return this.flushQueue(this.sendMessage,e)},canRetryFetch:function(e){return n.isFinite(e)&&!n.contains(this.fetchNoRetryOnErrorCodes,e)},markAsRead:function(){var e=(new Date).getTime();this.set({last_read_ts:parseInt(e/1e3,10),unreadCount:0})},parse:function(e,t){var i=n.get(e,"response")||e;return n.get(t,"isFetchInbox")&&n.extend(i,this.pick("is_possible_spam","is_blurred_images")),i},destroy:function(e){var t={conversation_id:this.get("id"),participant:this.get("participantUuid")};return e=n.extend({},e,{url:this.url+"?"+s.param(t)}),a.prototype.destroy.call(this,e)},markAsSpam:function(e){e=e||"inline";var t={conversation_id:this.get("id"),participant:this.get("participantUuid"),context:e,type:"spam"};return s.ajax({url:"/svc/conversations/flag",method:"POST",withFormKey:!0,data:t})},fetchConversation:function(e){var t=new s.Deferred,i=function(){t.resolve.apply(this,arguments)},o=function(){t.reject.apply(this,arguments)};return this.fetch(this._getFullFetchOptions(e)).then(n.bind(i,this)).fail(n.bind(function(e,t){var s=n.get(e,"status");this.isNew()&&n.contains(this.fetchNonErrorCodes,s)?i.call(this,{},t):o.apply(this,arguments)},this)),t},poll:function(e,t){var i;return this.isNew()?(new s.Deferred).reject():(i={participant:this.get("participantUuid"),conversation_id:this.get("id")},t&&n.extend(i,{limit:t}),this.get("messages").poll({isPolling:!0,data:i}))},getConversationDataForMessage:function(){var e={participant:this.get("participantUuid")};return this.isNew()?n.extend(e,{participants:this.getParticipantsIds()}):n.extend(e,{conversation_id:this.get("id")}),e},addMessage:function(e,t){return t=t||{},e.set(this.getConversationDataForMessage()),this.get("messages").add(e),e},sendMessage:function(e,t){return t=t||{},e.set(this.getConversationDataForMessage()),e.save(null,t).then(n.bind(function(e){var i=this.parse(e,t);this.isNew()?this.set(n.omit(i,"messunction(){return this.get("participants").get(this.get("participantUuid"))},getParticipantId:function(){return this.get("participantUuid")},getParticipantsIds:function(){return this.get("participants").pluck("uuid")},getOtherParticipant:function(){var e=this.get("participants").getWithout([this.getParticipantId()]);return n.first(e)},getInboxMessage:function(){var e=this.get("messages").where({isError:!1});return n.last(e)},isSameConversation:function(e){var t=e.getParticipantId(),i=e.getParticipantsIds(),s=this.getParticipantId(),o=this.getParticipantsIds();return s===t&&n.union(o,i).length===o.length},unblurImages:function(){this.set("is_blurred_images",!1);var e={conversation_id:this.get("id"),participant:this.get("participantUuid"),type:"unblur"};s.ajax({url:"/svc/conversations/flag",method:"POST",withFormKey:!0,data:e})},shouldBlurImageMessage:function(e){return!(!this.get("is_blurred_images")||!e.isImage())&&e.get("participant")!==this.getParticipantId()},_getFullFetchOptions:function(e){var t=this.isNew()?this._getDataForFetchByParticipants():this._getDataForFetchById();return t=n.extend({},t,{participant:this.get("participantUuid")}),n.)},_getDataForFetchById:functiohByParticipants:function(e){return{participants:this.getParticipantsIds()}}},{createPostMessage:function(e,t,i){return i=n.extend({},i,{type:l.POST,post:{blog:t,id:e,is_nsfw:n.get(i,"is_nsfw",!1)}}),new l(n.omit(i,"is_nsfw"))},createTextMessage:function(e,t){return t=n.extend({},t,{type:l.TEXT,message:e,content:{text:e}}),new l(t)},createImagePostMessage:function(e,t,i,n,s,o){var r=h.createPostMessage(e,t,o),a=r.getPost();return a.setType("photo"),a.addThumbnail(i,n,s),r},createImageMessage:function(e,t,i,s,o){return o=n.extend({},o,{type:l.IMAGE,file:t,image:{original_size:{width:i,height:s,url:e}}}),new l(o)},createStickerMessage:function(e,t,i,s){return s=n.extend({},s,{type:l.STICKER,sticker_id:e,sticker:{url:t,original_size_url:i}}),new l(s)}});e.exports=h},function(e,t),r=new o({degetRelations:function(){return n.pick(this.attributes,this.relationKeys())}},before:{initializelection:function(e){return e instanceof s.Collection||e instanceof s.Model},_bootstrapRelations:function(e,t){this._isBootstrapped||(n.forEach(this.relations,function(i,s){var o=this.attributes[s];!n.isEmpty(o)&&o instanceof i||(this.attributes[s]=new i(e[s],t))},this),this._isBootstrapped=!0)}},around:{set:function(e,t,i,o){var r,a,l,c,u,h,d=this.attributes,p=this.relationKeys(),g=!this._isBootstrapped;return n.isObject(t)?(r=t,o=i):(r={})[t]=i,o=o||{},u=n.result(o,"relationalSetOptions")||{},this._bootstrapRelations(r,o),a=n.pick(r,p),n.isEmpty(a)?e.apply(this,n.rest(arguments)):(h=n.isEmpty(this.relationsOrder)?n.keys(a):this.relationsOrder,g||n.forEach(h,function(e){r[e]&&(c=a[e],l=d[e],this._isModelOrCollection(l)&&(o.unset?l instanceof s.Collection?l.reset():l instanceof s.Model&&l.clear():(this._isModelOrCollection(c)&&(c=c.toJSON()),o.reset&&l instanceof s.Collection?l.reset(c,n.extend({},o,u[e])):l.set(c,n.extend({},o,u[e])))))},this),e.call(this,n.omit(r,p),o))},toJSON:function(e){var t=e.apply(this,n.rest(arguments))||{};for(var i in this.relations)this.relations.hasOwnProperty(i)&&(t[i]=n.result(t[i],"toJSON")||t[i]);return t}}});e.exports=r},functi{extend:{getQuhis.queue},ck(this.getQueuee().lengt_isFlushingQueue===!0},hasQueue:function(){return this.getQueue().length>0},appendToQueue:function(e,t){var i=this.getQueue();return e=this._getItemsAsArray(e),i.push.apply(i,this._constructItemWrappers(e,t)),i},prependToQueue:function(e,t){var i=this.getQueue();return e=this._getItemsAsArray(e),i.unshift.apply(i,this._constructItemWrappers(e,t)),i},removeFromQueue:function(e){return e=this._getItemsAsArray(e),this.queue=n.reduce(this.getQueue(),function(t,i){var s=n.get(i,"item");return n.contains(e,s)?t:(t.push(i),t)},[]),this.queue},flushQueue:function(e,t){var i,o=this.getQueue();return this._isFlushingQueue?this._flushQueueDeferred:n.isFunction(e)?(this._isFlushingQueue=!0,this._flushQueueDeferred=new s.Deferred,i=function(){var s,r,a;if(this._isFlushingQueue){if(0===o.length)return this._isFlushingQueue=!1,void this._onQueueSuccess(t);s=o.shift(),r=n.get(s,"item"),a=n.get(s,"options"),this._onQueueItemStart(r,a,t),e.call(this,r,a,t).then(n.bind(function(){this._onQueueItemSuccess(r,a,t),i.call(this)},this)).fail(n.bind(function(){this._isFlushingQueue=!1,this._onQueueItemFail(r,a,t)},this))}},ilushingQueue&&(this._isFlushingQueue=!1,this._flushQueueDeferred.reject())},_getItemsAsArray:function(e){return nWrappers:function(e,t){return n.map(e,function(e){return{item:e,options:t}})},_onQueueItemStart:function(e,t,i){this._flushQueueDeferred.notify(e,!1,t,i,this.getQueueItems())},_onQueueItemSuccess:function(e,t,i){this.unction(e,t,i){this._flushQueueDeferred.reject(e,t,i,this.getQueueItems())},_onQueueSuccess:function(e){this._flushQueueDeferred.resolve(e)}}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(185),r=i(523),a=i(659),l=i(662),c=i(663),u=i(664),h={TEXT:"TEXT",POST:"POSTREF",IMAGE:"IMAGE",STICKER:"STICKER"},d=o.extend({
mixins:[a],relations:{content:l,post:c,image:u},idAttribute:"ts",defaults:{conversation_id:null,type:h.TEXT,ts:null,participant:null,participants:null,content:null,message:null,post:null,image:null,file:null,sticker:null,sticker_id:null,collapseGroup:null,clientTs:null,tsHeader:null,isQueued:!1,isPending:!1,isError:!1,isCollapsed:!1,canRetry:!0,hasAnimation:!1,context:null,creationUserAction:null},persistedFields:["conversation_id","type","participant","participants","message","post","context","sticker_id"],saveNoRetryOnErrorCodes:[403,404],validSendMessageContexts:["post-chrome","messaging-gif","messaging-image-upload"],initialize:function(){return this.set("clientTs",Date.now()),o.prototype.initialize.apply(this,arguments)},parse:function(e,t){var i=n.get(e,"response.messages.data.0")||e,s=n.get(i,"images");return n.isArray(s)&&n.extend(i,{image:n.first(s)}),i},save:function(e,t){var i,a,l,c,u;return t=n.extend({validate:!0,parse:!0},t),e=e||{},e&&this.set(e),a=this.toJSON(),l=n.pick(a,this.persistedFields),c=this._getServerLoggingContext(),n.isEmpty(c)?delete l.context:n.extend(l,{context:c}),n.extend(t,{data:l,emulateJSON:!0}),this.isImage()?(u=this.get("file"),this.uploader=new r({name:"data",uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:this.url(),fileUpload:{multiple:!1,formData:l}}),this.uploader.addFiles([u]),i=this.uploader.getCurrentRequest(),i?i.then(n.bind(function(e){t.parse&&(e=this.parse(e,t)),this.set(e,t)},this)):(i=new s.Deferred,i.reject())):i=o.prototype.save.call(this,e,t),this.set({isPending:!0,isQueued:!1}),i.then(n.bind(function(){this.set("isError",!1)},this)).fail(n.bind(function(e){this.set({isError:!0,canRetry:this._canRetryOnErrorCode(n.get(e,"status"))})},this)).always(n.bind(function(){this.set("isPending",!1)},this)),i},getActionMarkup:function(e,t,i){return t=t||"",i=i||"",this.isText()?n.isEmpty(e)?null:t+n.escape(e)+i:this.isPost()?this.getPost().getActionMarkup(e,t,i):this.isImage()?this.getImage().getActionMarkup(e,t,i):null},getPost:function(){return this.get("post")},getImage:function(){return this.get("image")},getTimestamp:function(){var e=this.get("ts");return e?parseInt(e,10):this.get("clientTs")},getMessage:function(){return this.isText()?this.get("content").get("text"):this.isPost()?this.getPost().getMessage():""},isError:function(){return this.get("isError")},isText:function(){return this.get("tget("type")===h.POST},isImage:function(){return this.get("type")===h.IMAGE},isDisabledPost:function(){return this.isPost()&&this.get("post").isDisabled()},isPending:function(){return this.get("isPendiction(e){return n.isFinite(e)&&!n.contains(this.saveNoRetryOnErrorCodes,e)},_getServerLoggingContext:function(){var e=this.get("context");return!n.isEmpty(e)&&(e=n.first(e.split(":")),n.contains(this.validSendMessageContexts,e))?e:null}},h);e.exports=d},function(e,t,i){"use strict";var n=i(185),s=n.extend({defaults:{text:null,formatting:[]}});e.exports=s},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(185),r=i(265),a=o.extend({defaults:{type:null,summary:null,state:null,photos:[],is_nsfw:!1},setType:function(e){var t=["photo","link","quote","audio","video","chat"];n.contains(t,e)&&this.set("type",e)},getMessage:function(){return"gif"===this.getType()?null:this.get("summary")},getActionMarkup:function(e,t,i){var o,r,a,l,c;return t=t||"",i=i||"",e=n.escape(e),r=!n.isEmpty(e),l=r?s("%1$s%2$s%3$s sent a post that's no longer available",t,e,i):s("sent a post that's no longer available"),this.isDisabled()?l:(o=this.getType(),a=r?s("%1$s%2$s%3$s sent a post",t,e,i):s("sent a post"),c=r?{photo:s("%1$s%2$s%3$s sent a photo post",t,e,i),photoset:s("%1$s%2$s%3$s sent a photoset",t,e,i),gif:s("%1$s%2$s%3$s sent a GIF",t,e,i),link:s("%1$s%2$s%3$s sent a link",t,e,i),quote:s("%1$s%2$s%3$s sent a quote",t,e,i),audio:s("%1$s%2$s%3$s sent an audio post",t,e,i),video:s("%1$s%2$s%3$s sent a video",t,e,i),chat:s("%1$s%2$s%3$s sent a chat",t,e,i)}:{photo:s("sent a photo post"),photoset:s("sent a photoset"),gif:s("sent a GIF"),link:s("sent a link"),quote:s("sent a quote"),audio:s("sent an audio post"),video:s("sent a video"),chat:s("sent a chat")},n.has(c,o)?n.get(c,o):a)},getType:function(){var e;if("photo"===this.get("type")){if(this._isThumbnailGIF())return"gif";if(e=this.get("photos")||[],e.length>1)return"photoset"}return this.get("type")},getThumbnail:function(e){var t,i=this._getClientThumbnail();return n.inull:t):i},hasThumbnail:function(e){return!n.isEmpty(this.getThumbnail(e))},getScaledDimensionsForWidth:function(e,t){var i;return n.has(e,"width")&&n.has(e,"height")?(i=Math.round(neight:i}):null},isDisabled:function(){return"disabled"===this.get("state")},addThumbnail:function(e,t,i){!n.isEmpty(e)&&n.isNumber(t)&&n.isNumber(i)&&this.set("clientThumbnail",{url:e,width:t,height:i})},_getClientThumbnail:function(){return this.get("clientThumbnail")},_getPostThumbnail:function(e){var t,i,s=this.get("thumbnail_url"),o=this.get("thumbnail_height"),r=this.get("thumbnail_width"),a=this.get("photos");return e=e||250,!n.isEmpty(a)||!n.isEmpty(s)&&n.isFinite(o)&&n.isFinite(r)?n.isEmpty(a)?{url:s,height:o,width:r}:(i=n.sortBy(n.get(n.first(a),"alt_sizes"),"width"),t=n.find(i,function(t){return n.get(t,"width",0)>=e}),n.isEmpty(t)?n.last(i):t):null},_isThumbnailGIF:function(){var e,t=n.get(this.getThumbnail(),"url");return!n.isEmpty(t)&&(e=r.getExtension(t),"gif"===(e||"").toLowerCase())}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(185),r=i(659),a=i(665),l=i(666),c=o.extend({mixins:[r],relations:{alt_sizes:a,original_size:l},defaults:{alt_sizes:null,original_size:null},getActionMarkup:function(e,t,i){return e=n.escape(e),t=t||"",i=i||"",n.isEmpty(e)?s("sent a photo"):s("%1$s%2$s%3$s sent a photo",t,e,i)},getAltSizes:function(){return this.get("alt_sizes")},getHighResImageUrl:function(){var e=this.getAltSizes().sort().last();return n.isEmpty(e)?null:e.get("url"riginal_size")},hasAltSizes:function(){return!this.getAltSizes().isEmpty()},getImageAtSize:function(e){var t,i=this.getAltSizes().sort();return e=e||250,i.isEmpty()?this.getOriginalSize():(t=i.find(function(t){return t.get("width")>=e}),n.isEmpty(t)&&(t=i.last()),t)}});e.exports=c},functi,s=i(666),o=n.extend({model:s,comparator:function(e){return e.get("width")}});e.exports=o},function(e,t,i){"use strict";var n=i(185),s=n.extend({idAttribute:"url",defaults:{width:null,height:null,url:null}});e.exports=s},function(e,t,i){"use strict";var n=i(3),s=i(190),o=i(668),r=i(661),a=s.extend({url:"/svc/conversations/messages",mixins:[o],model:r,_getRoot:function(e){return n.has(e,"response")?n.get(e,"response.messages"):e},parse:function(e,t){return n.get(this._getRoot(e),"data")||[]},parsePreviousLink:function(e,t){return n.get(this._getRoot(e),"_links.previous")},parseNextLink:function(e,t){return n.get(this._getRoot(e),"_links.next")},poll:function(e){return e=e||{},n.extend(e,{cache:!1,remove:!1,skipParseLinks:!0}),this.fetch(e)}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(192),o=i(187),r=new o({extend:{setNextLink:function(e){var t,i=this.hasNextPage();this._nextLink=e,t=this.hasNextPage(),i!==t&&this.trigger("change:hasNextPage",this,t)},setPreviousLink:function(e){var t,i=this.hasPreviousPage();this._previousLink=e,t=this.hasPreviousPage(),i!==t&&this.trigger("change:hasPreviousPage",this,t)},getNextLink:function(){return this._nextLink},getPreviousLink:function(){return this._previousLink},hnk())},hasPreviousPage:function(){return!n.isEmpty(this.getPreviousLink())},fetchNextPage:function(e,t){return e=e||{},this.hasNextPage()?(e.isInfiniteScroll!==!1&&n.extend(e,{skipParsePreviousLink:!0,remove:!1}),this._fetchPage(this.getNextLink(),e)):s.reject()},fetchPreviousPage:function(e,t){return e=e||{},this.hasPreviousPage()?(e.isInfiniteScroll!==!1&&n.extend(e,{skipParseNextLink:!0,remove:!1}),this._fetchPage(this.getPreviousLink(),e)):s.reject()},_fetchPage:function(e,t){var i=n.isString(e)?e:e.href;return t=t||{},n.extend(t,{url:i}),this.fetcousLink:functioefore:{reset:function(e){this.setPreviousLink(null),this.setNextLink(null)},parse:function(e,t){t=t||{},t.skipParseLinks||(!t.skipParsePreviousLink&&n.isFunction(this.parsePreviousLink)&&this.setPreviousLink(this.parsePreviousLink(e,t)),!t.skipParseNextLink&&n.isFunction(this.parseNextLink)&&this.setNextLink(this.parseNextLink(e,t)))}}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(190),o=i(670),r=s.extend({model:o,getSortedByChannels:function(e,t){var i=this.clone(),s=t?-1:1,o=e.length;return i.sortBy(function(t){var i=n.indexOf(e,t.get("uuid")),r=i>-1,a=r?o-i:-1;return s*a})},getWithout:function(e){var t=this.clone();return t.filter(function(t){return!n.contains(e,t.get("uuid"))})}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(659),o=i(250),r=i(185),a=i(671),l=r.extend({url:"/svc/conversations/participant_info",mixins:[s],relations:{theme:a},defaults:{theme:null,is_blog_following_you:!1,is_following_blog:!1,duration_blog_following_you:null,duration_following_blog:null,seconds_since_last_activity:-1,blog_tags:[]},idAttribute:"uuid",parse:function(e){return!n.has(e,"theme")&&n.has(e,"global_theme_params")&&n.extend(e,{theme:n.get(e,"global_theme_params")}),n.get(e,"response",e)},getAvatarUrl:function(e){return e=e||96,o(this.get("avatar_url"),e)},getAvatarShape:function(){return this.get("theme").get("avatar_shape")},getBlogTags:function(){var e=this.get("blog_tags");return n.isArray(e)?e:[]},getDescription:function(){return this.get("theme").get("show_description")!==!0?"":this.get("description")},fetchAdditionalInfo:function(e,t){return t=n.extend({},t,{merge:!0,data:{q:this.get("uuid"),participant:e}}),this.fetch(t)},isFollowingYou:function(){return this.get("is_blog_following_you")===!0},=!0},isMutuals:function(){return this.isFollowingYou()&&this.isFollowing()},getDurationFollowingYouSeconds:function(){var e=this.get("duration_blog_following_you");return this.isFollowingYou()&&n.isNumber(e)?e:null},getDurationFollowingSeconds:function(){var e=this.get("duration_following_blog");return this.isFollowing()&&n.isNumber(e)?e:null},getDurationMutualsSeconds:function(){var e,t;return this.isMutuals()?(e=this.getDurationFollowingSeconds(),t=this.getDurationFollowingYouSeconds(),Math.min(e,t)):null}});e.exports=l},function(e,t,i){"use strict";var n=i(3),s=i(672),o=i(185),r=o.extend({defaults:{background_color:null,link_color:null,avatar_shape:null,header_image_focused:null,show_header_image:!0,adjustBrightnessFactor:.3},getHeaderImage:function(){return this.get("show_header_image")===!0?this.get("header_image_focused"):null},getBackgroundTint:r"))},getAccentTint:function(){return this.getTint(this.get("link_color"))},getTint:function(e){var t;return this.get("tint"+e)?this.get("tint"+e):n.isEmpty(e)?null:(t=s.isLight(e,.5)?s.isLight(e,.05et("tint"+e,t),t)},isDark:function(e){return this.getTint(e)===r.TINT_DARK},isReadableOn:function(e,t){return e=s.hexToHsv(e),t=s.hexToHsv(t),!s.compare(e,t)},adjustColorForBackground:function(e,t){var i=this.get("adjustBrightnessFactor");return this.isReadableOn(e,t)?e:this.adjustBrightness(e,this.isDark(e)?i:i*-1)},getReadableColor:fu,t)?e:s.readable(e)},adjustBrightness:function(e,t){return s.brighten(e,t)},getTintSuffix:function(e){return e===r.TINT_WHITE?"-white":e===r.TINT_LIGHT?"-light":e===r.TINT_DARK?"-dark":voidsvToRgb:r,hexToHsv:a,hsvToHex:l,brighten:c,readable:h,compare:d,isLight:u}},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(214),r=i(136),a=o.extend({name:"MessagingNotifier",defaults:{isEnabled:!1,notificationTimeout:5e3,notificationIcon:null},initialize:function(e){n.extend(this.attributes,n.pick(e,n.keys(this.defaults)))},notifyOnUnread:function(e,t){var i=s("New message for %1$s",t.get("name")),n={conversationId:e,channelUuid:t.get("uuid")};this._generateNotification(i,n)},_supportsNotifications:function(){return this.get("isEnabled")&&"Notification"in window},_needsNotificationPermission:function(){return this._supportsNotifications()&&"granted"!==window.Notification.permission&&"denied"!==window.Notification.permission},_isNotificationPermissionGranted:function(){return this._supportsNotin},_requestPermission:function(e){window.Notification.requestPermission(e)},_generateNotification:function(e,t){var i,s;this._supportsNotifications()&&(s={icon:this.get("notificationIcon")},this._isNotificationPermissionGranted()?(i=new Notification(e,s),i instanceof Notification&&(i.addEventListener("click",n.bind(function(e){r.trigger("messaging:conversation:open:id",t.conversationId,t.channelUuid,"notification"),e.target.close()}),this),n.delay(n.bind(function(){this.close()},i),this.get("notificationTimeout")),this.trigger("notification:display",t.conversationId))):this._needsNotificationPermission()&&this._requestPermission(n.bind(function(i){this.trigger("notification:permission:change","granted"===i),this._generateNotification(e,t)},this)))}});e.exports=a},function(e,t,i){"use strict";var n,s=i(214),o=i(3),r=i(675),a=i(676),l=i(677),c=s.extend({name:"NotificationSoundManager",initialize:function(){var e=o.get(this.data,"sounds",[]),t=o.get(this.data,"soundpacks",{});this.soundCollection=new r(this._getSoundModels(e)),this.soundPackCollections=this._getSoundpackCollections(t)},playSoundName:function(e){var t=this.soundCollection.get(e);o.isEmpty(t)||this._playSoundModel(t)},playRandomFromSoundpack:function(e){var t=o.get(this.soundPackCollections,e);t&&this._playSoundModel(t.sample())},_playSoundModel:function(e){var t=new l({model:e}).render();this.listenToOnce(t,"ended",this._removeSoundView),t.play()},_removeSfunction(e){return o.map(e,function(e,t){return new a({name:t,filePath:e})})},_getSoundpackCollections:function(e){var t=this;return o.rr(t._getSoundModels(i)),e},{})}}),u=function(){return null==n&&(n=new c),n};e.exports=u},function(e,t,i){"use strict";var n=i(190),s=i(676),o=n.extend({model:s});e.exports=o},function(e,t,i){"use strict";var n=i(185),s=n.extend({idAttribute:"name",defaults:{name:null,filePath:null,fileType:"audio/mpeg"}});e.exports=s},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(678),r=s.extend({tagName:"audio",template:o,defaults:{filePath:null,fileType:null},events:{ended:"triggerRemove"},initialize:function(e){n.extend(this,n.pick(e,"model"))},getTemplateData:function(tion(){this.el.__e(fileType)+'">';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=s.extend({renderWithTemplate:n.noop,initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick_sum",this._onChangeChannelUnreadCount),this._onChangeChannelUnreadCount()},updateBadge:function(e){e>0&&this.$(".tab_notice_value").text(e>99?"99+":e),this.$(".tab_notice").toggleClass("tab-notice--active",e>0)},_onChangeChannelUnreadCount:function(){this.updateBadge(n.sum(this.channels.pluck("unread_messages_count_sum")))}});e.exports=o},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(277),r=i(226),a=i(489),l=i(681),c=i(694),u=i(704),h=i(708),d=i(689),p=i(712),g=r.extend({className:"messaging-inbox",template:p,defaults:{isLoading:!1,isAutoFetch:!0,isEmpty:!1,isLoadingEmptyInboxFavoritetainer:e.popoverContainer,isNewEmptyManager:e.keyboardManager,isNewEmptyInboxEpendFavoritesToInboxLimit,isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}},inboxRecipientsView:{constructor:d,options:function(e){return{eventBus:e.eventBus,collection:e.favoritesCollection,title:s("Recently Followed"),context:"new:inbox:empty",isNewEmp:function(e){return{eventBus:e.eventBus,collection:e.emptyInboxCollection}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","collection","user","channels","favoritesCollection","emptyInboxCollection","popoverContainer","currentBlogModel","appendFavoritesToInboxLimit","keyboardManager","isNewEmptyInboxEnabled"))},afterRenderSubviews:function(){this.loader=new a({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),this.set({isLoading:!this.getCurrentChannel().get("isInboxFetched"),isEmpty:0===this.collection.length}),this.listenTo(this,"change",this._setViewStates),this.listenTo(this.collection,"sync error",this._onSyncCollection),this.listenTo(this.collection,"update reset",this._onChangeCollection),this.listenTo(this.collection,"request",this._onRequestCollection),this.listenTo(this.composeView,"submit",this._onComposeSubmitRecipient),this.listenTo(this.headerView,"change:isComposing",this._setViewStates),this._setViewStates(),this.get("isAutoFetch")&&this.fetch(),this._fetchEmptyInboxFavorites(),this.isNewEmptyInboxEnabled&&this._fetchFavorites()},beData:function(){return{isNewEmptyInboxEnabled:this.isNewEmptyInboxEnabled}},gech:function(e){this.collecthis.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_NAMES,e)},_setViewStates:function(){var e=this.get("isEmpty"),t=this.get("isLoading")||this.get("isLoadingEmptyInboxFavorites"),i=this.headerView.get("isComposing");this.loader.set("loading",t&&!i),this.conversationsView.toggle(!i&&!e&&!t),this.emptyView.toggle(e&&!i&&!t&&!this.isNewEmptyInboxEnabled),this.inboxRecipientsView&&this.inboxRecipientsView.toggle(e&&!i&&!t&&this.isNewEmptyInboxEnabled),this.composeView.$el.toggle(i),i&&this.composeView.focus()},_onChangeCollection:function(){this.set("isEmpty",0===this.collection.length)},_onSyncCollection:function(){this.set({isLoading:!1,isEmpty:0===this.collection.length}),this.getCurrentChannel().set("isInboxFetched",!0)},_onRequestCollection:function(e,t,i){this.set({isEmpty:0===this.collection.length,isLoading:!this.getCurrentChannel().get("isInboxFetched")})},_fetchEmptyInboxFavorites:function(){var e=this;this.set("isLoadingEmptyInboxFavorites",!0),this.emptyInboxCollection.fetchFavorites(null,null,null,this.isNewEmptyInboxEnabled,"empty").then(function(){e.rendered&&(e.isNewEmptyInboxEnabled||e.favoritesCollection.res)}).always(function(){e.rendered&&e.set("isLoadingEmptyInboxFavorites",!1)})},_fetchFavorites:function(){var e=this.get("numFavorites"),t=this.currentBlogModel.getId();this.favoritesCollection.fetchFavorites(e,t,null,!0)}});e.exports=g},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(682),a=i(277),l=i(331),c=i(683),u=i(688),h=i(689),d=i(693),p=o.extend({className:"inbox-conversations",template:d,mixins:[a,r],defaults:{isPaginating:!1,showFavorites:!1,hasNextPage:!0,showLoadingContainer:!0,appendFavoritesToInboxLimientBus:e.eventBus,channels:e.channels,currentBlogModel:e.currentBlogModel}},collection:function(e){return e.collection}},paginationLoaderView:{constructor:l,options:{variation:"small h-centered",loading:!1}},favoritesView:{constructor:h,options:function(e){return{showMessageOnEmpty:!1,eventBus:e.eventBus,collection:e.favoritesCollection,title:s(e.isNewEmptyInboxEnabled?"Recently Followed":"More Tumblrs to talk to"),context:"inbox:moretumblrs",isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","collection","channels","favoritesCollection","currentBlogModel","isNewEmptyInboxEnabled"))},afterRenderSubviews:function(){this.scrollBar=new u({el:this.el}),this.listenTo(this,"change:isPaginating",this._onChangeIsPaginating),this.listenTo(this,"change:showFavorites",this._onChangeShowFavorites),this.listenTo(this,"change:hasNextPage",this._onChangeHasNextPage),this.listenTo(this,"change:showLoadingContainer",this._onChangeShowLoadingContainer),this.listenTo(this.collection,"sort",this._onCollectionSort),this.listenTo(this.collection,"update reset change",this._onCollectionChange),this.listenTo(this.favoritesCollection,"update reset",this._onFavoritesCollectionChange),this.listenTo(this.collection,"reset",this._onCollectionReset),this.listenTo(this,"batch:rendered:conversations",this._onConversationsBatchRendered),this.listenTo(this.collection,"sync",this._onCollectionSync),this.listenTo(this.collection,"change:hasNextPage",this._onChangeCollectionHasNextPage),this.listenTo(this.scrollBar,"scrollbottom",this._onScrollBottom),this._setViewStates(),this._onChangeCollectionHasNextPage(this.collection,this.collection.hasNextPage()),this._onChangeShowFavorites(this,this.get("showFavorites")),this._onChangeHasNextPage(this,this.get("hasNextPage")),this._onChangeShowLoadingContainer(this,this.get(llBar,this))},toggle:function(e){this.$el.toggle(e),this.updateScrollBar()},beforeRemove:function(){this.scrollBar&&this.scrollBar.destroy()},getNextPage:function(){this.rendered&&this.collection.hasNextPage()&Page().always(n.bind(function(){this.rendered&&this.set("isPaginating",!1)},this)))},updateScrollBar:function(){this.scrollBar&&this.scrollBar.update()},_setViewStates:function(){var e=this.get("hasNextPage"),t=this.collection.length>0&&!e&&this.collection.length<=this.get("appendFavoritesToInboxLimit");this.set({showF_saveModelOrder:function(){this.lastModelOrder=this._getModelOrderString()},_getModelOrderString:function(){return n.pluck(this.collection.models,"cid").join(" ")},_onCollectionSort:function(e){var t=this._getModelOrderString();this.lastModelOrder&&t.indexOf(this.lastModelOrder)===-1&&this.renderCollectionSubviews("conversations"),this._saveModelOrder()},_onCollectionChange:fuChangeCollectionHasonCollectionReset:function(e){this.$el.scrollTop(0),this._saveModelOrder()},_onConversationsBatchRendered:function(){this.updateScrollBar()},_onChangeCollectionHasNextPage:function(e,t){this.set("hasNextPage",t&&e.length>=10)},_onChangeHasNextPage:function(e,t){this._setViewStates()},_onChangeIsPaginating:function(e,t){this.paginationLoaderView.set("loading",t)},_onScrollBottom:function(e){e&&this.getNextPage()},_onChangeShowFavorites:function(e,t){this.favoritesView.$el.toggle(t)},_onChangeShowLoadingContainer:function(e,t){this.js$("loader-container").toggle(t)},_onFavoritesCollectionChange:function(){this.updateScrollBar()}});e.exports=p},function(e,t,i){"use strict";var n=i(3),s=i(187),o=new s({defaults:{removeCollectionSubviews:function(e){var t=this[e];this.subviews[e]&&!n.isEmpty(t)&&(t=this[e],this._subviews=n.difference(this._subviews,t),n.invoke(t,"remove"),this[e].length=0)},removeCollectionSubview:function(e,t){var i,s=this[e];this.subviews[e]&&!n.isEmpty(s)&&(i=n.findWhere(s,{model:t}),i&&(this._subviews=n.without(this._subviews,i),i.remove(),this[e]=n.without(this[e],i)))},addNewCollectionSubview:function(e,t,i){var s=this.subviews[e];if(i||(i=this._getSubviewCollection(e)),s&&i){var o=s.container||this._createDefaultContainerFunction(e),r=s.prepareViewForAdd||this._createDefaultPrepareViewForAddFunction(e),a=s.options||{},l={insertionIndex:i.indexOf(t)},c=n.has(this,e),u=this.createCollectionSubviewRenderer([t],o,r,a,e,c,l);return this._isBatchRenderingInProgress(e)?void this.once("rendered:"+e,u,this):void(this.rendered?u():this.once("rendered",u,this))}},sortCollectionSubviews:function(e,t){var i,s=this.subviews[e];t||(t=this._getSubviewCollection(e)),s&&t&&this[e]&&(i=n.pluck(t.ength)),this[e]=n.sortBy(this[e],function(e){return n.get(i,e.model.cid,0)}))},batchRenderCollectionSubviews:function(e){var t=this.subviews[e];if(t){var i=t.container||this._createDefaultContainerFunction(e),s=t.prepareView||this._createDefaultPrepareViewFunction(e),o=t.options||{},r=n.result(t,"batchSize")||5,a=n.result(t,"batchDelay")||100,l=this._getSubviewCollection(e),c=n.chunk(l.models,r),u=n.map(c,function(t,r){return n.bind(function(){var n=this.createCollectionSubviewRenderer(t,i,s,o,e,r>0);return n.call(this)},this)},this),h=n.bind(function(){this._scheduleBatchRenders(e,u,a)},this);this.rendered?h():this.once("rendered",h,this)}},_isBatchRenderingInProgress:function(e){return n.get(this._deferredRenders,e,[]).length>0},_scheduleBatchRenders:function(e,t,i){var s=t.length,o=function(){this._afterBatchRenderCollectionSubviews(e)},r=function(t){t.call(this,e),this._afterEachBatchRenderCollectionSubviews(e),s--,0===s&&o.call(this)};return this._deferredRenders||(this._deferredRenders={}),n.has(this._deferredRenders,e)||(this._deferredRenders[e]=[]),this._cancelBatchRenders(e),0===s?void o.call(this):void n.each(t,function(t,s){var o;return 0===s?void r.call(this,t):(o=setTimeout(n.bind(function(){r.call(this,t),this._deferredRenders[e]=n.without(this._deferredRenders[e],o)},this),i*(s+1)),void this._deferredRenders[e].push(o))},this)},_cancelBatchRenders:function(e){n.isEmpty(this._deferredRenders)||(n.isEmpty(e)||n.has(this._deferredRenders,e))&&(n.isEmpty(e)?(n.each(this._deferredRenders,function(e,t){n.each(e,function(e){clearTimeout(e)},this)},this),this._deferredRenders={}):(n.each(this._deferredRenders[e],function(e){clearTimeout(e)},this),this._deferredRenders[e].length=0))},_afterEachBatchRenderCollectionSubviews:functioafterBatchRenderCollectionSubviews:function(e){this.trigger("rendered:"+e)},_attachCollectionListeners:function(e){var t=this._getSubviewCollection(e);t&&(this.listenTo(t,"add",n.partial(this.addNewCollectionSubview,e)),this.listenTo(t,"remove",n.partial(this.removeCollectionSubview,e)),this.listenTo(t,"reset",n.partial(this.renderCollectionSubviews,e)),this.listenTo(t,"update",n.partial(this.sortCollectionSubviews,e)))},_getSubviewCollection:function(e){var t=n.get(this.subviews[e],"collection");return t===!0?this.collection:n.isFunction(t)?t(this):t?t:null},_createDefaultPrepareViewForAddFunction:function(e){var t=this.subviews[e];return n.bind(function(i,s){var o=i.children(),r=new t.constructor(s),a=s.insertionIndex;return r.$el.attr("data-subview",e),n.isNumber(a)&&a<o.length?r.$el.insertBefore(o.get(a)):i.appeis.subviews,function(e,t){e.collection&&this._attachCollectionListeners(t)},this)},beforeRemove:function(){this._cancelBatchRenders()}},around:{renderCollectionSubviews:function(e,t){var i=this.subviews[t];if(i)return this.removeCollectionSubviews(t),n.result(i,"enableBatchRendering")===!0?this.batchRenderCollectionSubviews(t):e.apply(this,n.rest(arguments))}}});e.exports=o},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(684),a=i(685),l=i(277),c=i(262),u=i(180),h=i(182),d=i(686),p=o.extend({className:"inbox-conversation",template:r,mixins:[l],subviews:{statusIndicator:{constructor:d,options:function(e){return{isOnline:e.otherParticipant.get("seconds_since_last_activity")!==-1,canSeeUIFlag:u.bool("status_indicator"),name:e.otherParticipant.get("name")}}}},defaults:{maxInitialMessageLength:100,currentMessage:null},events:{"click [data-open-conversation]":"_onClickConversation"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","channels","currentBlogModel")),this.participants=this.model.get("participants"),this.sortedParticipants=this.participants.getSortedByChannels(this._getOwnSortedBlogIds()),this.otherParticipant=n.first(this.sortedParticipants),this.set("currentMessage",this.model.getInboxMessage())},afterRender:function(){this.listenTo(this.model,"change:last_read_ts change:last_modified_ts",this._onChangeTimestamps),
this.listenTo(this,"change:currentMessage",this._onChangeCurrentMessage),this._onChangeCurrentMessage(this,this.get("currentMessage"));var e=this.$el.find(".pixelated-avatar");n.each(e,n.bind(function(e){s(e).removeClass("hide").addClass("show"),c.drawPixelatedImages(this)},this))},openConversation:function(){this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_CONVERSATION_MODEL,this.model,"inbox")},getTemplateData:function(){var e=h(),t=this.otherParticipant.get("is_adult"),i=e.get("channels").map(function(e){return e.name}),s=n.contains(i,this.model.get("blogName")),o=u.bool("safe_mode")&&e.get("safe_mode");return{name:this.otherParticipant.get("name"),avatarUrl:this.otherParticipant.getAvatarUrl(),message:this._getEscapedMessageMarkup(this.get("currentMessage")),isSafeModeEnabled:o,isUser:s,blogIsAdult:t}},getMessageParticipant:function(e){return this.participants.get(e.get("participant"))},_getEscapedMessageMarkup:function(e){var t,i=this._getAdditionalBlogName(e),s=n.escape(e.getMessage());return n.isEmpty(s)||(s=s.substring(0,this.get("maxInitialMessageLength"))),t=e.getActionMarkup(i,'<span class="name">',"</span>"),n.compact([t,s]).join(": ")},_safeTruncateMessage:function(e){var t=this.js$("message"),i=this.js$("message-text"),s=function(){a(t),n.isFunction(e)&&e.call(this,i.html())};t.height()?s.call(this):(this.$el.css("visibility","hidden"),n.defer(n.bind(function(){this.rendered&&(s.call(this),this.$el.css("visibility",""))},this)))},_isLastMessageFromSelf:function(e){return!n.isEmpty(e)&&!n.isEmpty(this.otherParticipant)&&this.otherParticipant.get("uuid")!==e.get("uuid")},_getAdditionalBlogName:function(e){var t;return n.isEmpty(e)?null:(t=this.getMessageParticipant(e),n.isEmpty(t)?null:this._isLastMessageFromSelf(t)?t.get("name"):null)},_onChangeTimestamps:function(e){this.set("currentMessage",this.model.getInboxMessage())},_onChangeCurrentMessage:function(e,t){var i=this.getMessageParticipant(t),s=t.get("truncatedText");this.$el.toggleClass("is-unread",this.model.isUnread()&&!this._isLastMessageFromSelf(i)),n.isEmpty(s)?(this.js$("messeMarkup(t)),this._safeTruncateMessage(function(e){t.set("truncatedText",e)})):this.js$("message-text").html(s)},_onClickConversation:function(){return this.channels.getSortedIds(this.currentBlogModel.getId())}});e.exports=p},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a data-open-conversation href="#" class="inbox-row"><div data-subview="statusIndicator"></div> ',__p+=blogIsAdult&&isSafeModeEnabled&&!isUser?' <canvas class="avatar post-activity-avatar-image post_sub_avatar_image pixelated-avatar needs-drawing hide" data-image-url="'+__e(avatarUrl)+'" width="36" height="36" alt="'+__e(name)+'"></canvas> ':' <img class="avatar" src="'+__e(avatarUrl)+'"> ',__p+=' <div class="info-container"><div class="name-container"><h3 class="name">'+__e(name)+'</h3></div><h4 class="message" data-js-message><span class="text" data-js-message-text>'+(null==(__t=message)?"":__t)+"</span></h4></div></a>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";function n(e,t){return e.scrollHeight-t.maxHeight<5}function s(e){return parseInt(c(e).css("max-height"),10)}function o(e,t,i){var s,o=e.nodeValue,r=l.get(t,"truncationString","..."),a="",c="",u=0,h=o.length;if(n(i,t))return!0;for(;u<=h;)s=u+h>>>1,a=l.trimRight(o.substring(0,s))+r,e.nodeValue=a,n(i,t)?(u=s+1,a.length>c.length&&(c=a)):h=s-1;return c.length>0?(e.nodeValue=c,!0):(e.nodeValue="",!1)}function r(e,t,i){var n=c(e).contents();l.each(n.get().reverse(),function(e){e.nodeType===Node.TEXT_NODE?o(e,t,i):r(e,t,i)})}function a(e,t){if(t=t||{},l.defaults(t,{truncationString:"..."}),e instanceof c&&(e=e.get(0)),l.has(t,"maxHeight")||l.extend(t,{maxHeight:s(e)}),l.isFinite(l.urn this.get("isOnline")?s.prototype.render.call(this):this}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div aria-label="'+__e(ariaText)+'" title="online" class="status-indicator"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(485),o=s.extend({defaults:n.defaults({isDisabled:!1,isAtTop:!1,isAtBottom:!1,topThreshold:50,bottomThreshold:50},s.prototype.defaults),initialize:function(e){return this.options=e||{},s.prototype.initialize.call(this,this.options.el,this.options)},render:function(){return this.listenTo(this,"change:isAtTop",this._changeIsAtTop),this.listenTo(this,"change:isAtBottom",this._changeIsAtBottom),s.prototype.render.apply(this,arguments)},_stealScroll:function(e){return this.get("isDisabled")?(e.preventDefault(),void e.stopPropagation()):s.prototype._stealScroll.apply(this,arguments)},update:function(){return this._updateInpdateInfiniteScrollFt,scrollBottom:this._currentScrollBottom,scrollTop:this._currentScrollTop}},isAtTop:function(){return this.get("isAtTop")},isAtBottom:function(){return this.get("isAtBottom")},_isAtTop:function(e){return this._isUserScroll()&&!this.get("isDisabled")&&this._currentScrollTop<=e&&this._currentHeight>e},_isAtBottom:function(e){return this._isUserScroll()&&!this.get("isDisabled")&&this._currentScrollBottom<=e&&this._currentHeight>e},_isUserScroll:function(){var e,t=5;return!!n.isFinite(this._previousScrollHeight)&&(e=Math.abs(this._currentScrollHeight-this._previousScrollHeight),e<=t)},setDisabled:function(e){this.set("isDisabled",e)},isDisabled:function(){return this.get("isDisabled")},_setCurrentPositions:function(){var e=this.container;this._previousScrollHeight=this._currentScrollHeight,this._currentScrollHeight=e.scrollHeight,this._currentHeight=e.clientHeight,this._currentScrollBottom=e.scrollHeight-e.scrollTop-this.container.clientHeight,this._currentScrollTop=e.scrollTop},_updateInfiniteScrollFlags:function(){return!this.destroyed&&(this._setCurrentPositions(),void this.set({isAtTop:this._isAtTop(this.get("topThreshold")),isAtBottom:this._isAtBottom(this.get("bottomThreshold"))}))},_changeIsAtTop:function(e,t){this.trigger("scrolltop",t)},_changeIsAtBottom:function(e,t){this.trigger("scrollbottom",t)}});e.exports=o},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(682),r=i(277),a=i(232),l=i(471),c=i(690),u=i(692),h=s.extend({className:"inbox-recipients",template:u,mixins:[r,a,o,l],keycommands:{"keydown:down":"_onKeyPressDown","keydown:up":"_onKeyPressUp","keydown:enter":"_onKeyPressEnter"},defaults:{isEmpty:!0,showMessageOnEmpty:!0,selectedView:null,context:"inbox:recipients"},subviews:{recipients:{constructor:c,options:function(e){return{eventBus:e.eventBus,onSelect:n.bind(e._onSubviewSelect,e),onClear:n.bind(e._onSubviewClear,e),context:e.context,isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}},collection:function(e){return e.collection}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","collection","title","context","isNewEmptyInboxEnabled")),this.keyboardViewName="recipients",this.disableKeys()},afterRender:function(){this.listenTo(this.collection,"reset update",this._onCollectionChange),this.listenTo(this.collection,"sync",this._onCollectionSync),this.listenTo(this.collection,"sort",this._onCollectionSort),this.listenTo(this,"change:isEmpty",this._onChangeIsEmpty),this.listenTo(this,"change:selectedView",this._onChangeSelectedView),this._onCollectionChange(this.ctitle:this.title,noResultsText:this.collection.getNoResultsFoundMessage()}},toggle:function(e){this.$el.toggle(e),e&&this.deselect(this.keyboardViewName)},_onChangeSelectedView:function(e,t){var i=this.previous("selectedView");i&&i.setSelected(!1),t&&t.setSelected(!0)},_onChangeIsEmpty:function(e,t){this.get("showMessageOnEmpty")?this.js$("no-results-container").toggle(t):(this.js$("container").toggle(!t),this.js$("no-results-container").hide())},_shuffleNoResultsText:function(){this.js$("no-results-text").text(this.collection.getNoResultsFoundMessage())},_onCollectionSort:function(){this.renderCollectionSubviews("recipients")},_onCollectionChange:function(e){this.set("isEmpty",0===e.length),this.deselect(this.keyboardViewName)},_onCollectionSync:function(e){0===e.length&&this.get("showMessageOnEmpty")&&this._shuffleNoResultsText()},_onSubviewSelect:function(e){this.set("selectedView",e),this.setSelectedIndex(this.keyboardViewName,n.indexOf(this.recipients,e))},_onSubviewClear:function(e){this.set("selectedView",null),this.deselect(this.keyboardViewName)},_onKeyPressDown:function(e){var t;e.preventDefault(),t=this.isLastSelected(this.keyboardViewName)?this.selectFirst(this.keyboardViewName):this.selectNext(this.keyboardViewName),this.set("selectedView",t)},_onKeyPressUp:function(e){var t;e.preventDefault(),t=this.isFirstSelected(this.keyboardViewName)?this.selectLast(this.keyboardViewName):this.selectPrevious(this.keyboardViewName),this.set("selectedView",t)},_onKeyPressEnter:function(e){var t,i=this.get("selectedView");e.preventDefault(),i?t=i.model:1===this.collection.length&&(t=this.collection.first()),t&&this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,[t],this.context)}});e.exports=h},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(262),r=i(685),a=i(277),l=i(180),c=i(226),u=i(182),h=i(691),d=c.extend({className:"inbox-recipient",template:h,mixins:[a],defaults:{isSelected:!1,context:"inbox:recipients"},events:{"click [data-start-conversation]":"_onStartConversationClick",mouseenter:"_onRecipientHover",mouseleave:"_onRecipientLeave"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","onSelect","onClear","context","isNewEmptyInboxEnabled"))},afterRender:function(){this.listenTo(this,"change:isSelected",this._onChangeIsSelected),this.isNewEmptyInboxEnabled&&r(this.js$("tags-string"));var e=this.$el.find(".pixelated-avatar");n.each(e,n.bind(function(e){this.$(e).removeClass("hide").addClass("show"),o.drawPixelatedImages(this)},this))},setSelected:function(e){this.rendered&&this.set("isSelected",e)},getTemplateData:function(){var e=u(),t=this.model.get("is_adult"),i=n.pluck(e.get("channels"),"name"),s=n.contains(i,this.model.get("name")),o=l.bool("safe_mode")&&e.get("safe_mode");return{name:this.model.get("name"),title:this.model.get("title"),avatarUrl:this.model.getAvatarUrl(),isNewEmptyInboxEnabled:this.isNewEmptyInboxEnabled,tagsString:this.getTagsString(),isSafeModeEnabled:o,isUser:s,blogIsAdult:t}},getTagsString:function(){var e=this.model.get("tags");return n.isEmpty(e)?null:e.length>1?s("Posts about #%1$s and #%2$s",e[0],e[1]):1===e.length?s("Posts about #%1$s",e[0]):void 0},_onStartConversationClick:function(e){e.preventDefault(),this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,[this.model],this.get("context")),this.isNewEmptyInboxEnabled&&this.eventBus.trigger(this.eventBus.NEW_EMPTY_INBOX_SUGGESTION_CLICK,this.model,this.get("context"),!0)},_onChangeIsSelected:function(e,t){this.$el.toggleClass("selected",t)},_onRecipientHover:function(){n.isFunction(this.onSelect)&&this.onSelect(this,this.model)},_onRecipientLeave:function(){n.isFunction(this.onClear)&&this.onClear(this,this.model)}});e.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a data-start-conversation href="/conversation/new/'+__e(name)+'" class="inbox-row"> ',__p+=blogIsAdult&&isSafeModeEnabled&&!isUser?' <canvas class="avatar post-activity-avatar-image post_sub_avatar_image pixelated-avatar needs-drawing hide" data-image-url="'+__e(avatarUrl)+'" width="36" height="36" alt="'+__e(name)+'"></canvas> ':' <img class="avatar" src="'+__e(avatarUrl)+'"> ',__p+=' <div class="info-container"> ',__p+=isNewEmptyInboxEnabled?" <h3>"+__e(name)+'</h3><h4 class="tags" data-js-tags-string>'+__e(tagsString)+'</h4><h4 class="send-link">'+__e(__("Send a message"))+"</h4> ":" <h3>"+__e(name)+"</h3><h4>"+__e(title)+"</h4> ",__p+=" </div></a>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<div data-js-container> ",title&&(__p+=" <h2>"+__e(title)+"</h2> "),__p+=' <div data-subview="recipients[]"></div><div data-js-no-results-container class="no-results"><p data-js-no-results-text>'+__e(noResultsText)+"</p></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-js-conversations-container><div data-subview="conversations[]"></div><div data-subview="favoritesView"></div></div><div class="inbox-pagination-loader" data-js-loader-container><div data-subview="paginationLoaderView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(695),r=i(701),a=i(703),l=s.extend({className:"inbox-header",template:a,defaults:{isComposing:!1},subviews:{senderView:{constructor:o,options:function(e){return{eventBus:e.eventBus,user:e.user,channels:e.channels,popoverContainer:e.popoverContainer,currentBlogModel:e.currentBlogModel}}},composeToggleView:{constructor:r,options:function(e){return{eventBus:e.eventBus,isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","user","channels","popoverContainer","currentBlogModel","isNewEmptyInboxEnabled"))},afterRenderSubviews:function(){this.listenTo(this.composeToggleView,"change:isComposing",function(e,t){this.set("isComposing",t)}),this.listenTo(this,"change:isComposing",function(e,t){this.composeToggleView.set("isComposing",t)})}});e.exports=l},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(696),r=i(700),a=s.extend({className:"inbox-sender",template:r,subviews:{blogSelector:{constructor:o,options:function(e){return{className:"inbox-sender-blog-selector",collection:e.channels,popoverOptions:{popoverContainer:e.popoverContainer},currentTumblelog:e.channels.findWhere({uuid:e.currentBlogModel.getId()}),badgeCountField:"unread_messages_count_sum"}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","user","channels","currentBlogModel","popoverContainer"))},afterRenderSubviews:function(){this.listenTo(this.blogSelector,"change:currentTumblelog",this._onBlogSelectorChange)},_onBlogSelectorChange:function(e,t){this.currentBlogModel.setChannel(t)}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(697),r=i(698),a=i(277),l=i(250),c=s.extend({template:o,mixins:[a],defaults:{currentTumblelog:!1,isOpen:!1,requiresDropdown:!1,showCaret:!0,showName:!0,dropdownClass:null,popoverOptions:null,avatarSize:96,badgeCountField:null,showTotalBadge:!0,showNumberInBadge:!1,includeCurrentBlogInTotalBadge:!1,maxBadgeCount:99,badgeActiveClass:"has-badge"},events:{"click [data-js-button]":"toggleDropdown"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"collection")),this.get("currentTumblelog")||this.set("currentTumblelog",this.collection.findWhere({is_current:!0})),this.set("requiresDropdown",this.collection.length>1),!n.isEmpty(this.get("badgeCountField"))&&this.get("requiresDropdown")||this.set("showTotalBadge",!1)},getTemplateData:function(){var e=this.get("showTotalBadge"),t=e&&this.get("showNumberInBadge"),i=e?this.getBadgeCount():null;return{avatarUrl:l(this.getCurrentTumblelogProperty("avatar_url"),this.get("avatarSize")),displayName:this.getCurrentTumblelogProperty("name"),requiresDropdown:this.get("requiresDropdown"),hasBadge:e&&i>0,badgeCountString:t?this.getBadgeCountString(i):null}},createDropdown:function(){var e=n.extend({},this.get("popoverOptions"),{identifier:"blogSelector:dropdown",pinnedTarget:this.js$("avatar"),shift:{x:86,y:10},collection:this.collection,currentTumblelog:this.getCurrentTumblelog(),badgeCountField:this.get("badgeCountField"),maxBadgeCount:this.get("maxBadgeCount")});this.dropdown=new r(e),this.get("dropdownClass")&&this.dropdown.$el.addClass(this.get("dropdownClass")),this.listenTo(this.dropdown,"change:currentTumblelog",this.adjustCurrentTumblelog),this.listenTo(this.dropdown,"open",this._onDropdownOpen),this.listenTo(this.dropdown,"close",this._onDropdownClose)},_onDropdownOpen:function(){this.set("isOpen",!0)},_onDropdownClose:function(){this.set("isOpen",!1)},_onChangeIsOpen:function(e,t){this.js$("caret").toggleClass("is-open",t)},toggleDropdown:function(){this.get("requiresDropdown")&&(this.dropdown.isOrWasRecentlyRendered()||(this.createDropdown(),this.dropdown.render()))},afterRender:function(){return this.get("showTotalBadge")&&(this.listenTo(this.collection,"change:"+this.get("badgeCountField"),this._onBadgeCountChange),this._onBadgeCountChange()),this.get("requiresDropdown")&&(this.createDropdown(),this.js$("button").addClass("has-dropdown"),this.listenTo(this,"change:isOpen",this._onChangeIsOpen),this.listenTo(this,"change:showCaret",this._onChangeShowCaret),this._onChangeIsOpen(this,this.get("isOpen")),this._onChangeShowCaret(this,this.get("showCaret"))),this.listenTo(this,"change:showName",this._onChangeShowName),this._onChangeShowName(this,this.get("showName")),this},getCurrentTumblelog:function(){return this.get("currentTumblelog")},getCurrentTumblelogProperty:function(e){var t=this.getCurrentTumblelog();if(t&&t.has(e)&&n.isString(e))return t.get(e)},adjustCurrentTumblelog:function(){var e;this.set("currentTumblelog",this.dropdown.get("currentTumblelog")),this.rendered&&(e=l(this.getCurrentTumblelogProperty("avatar_url"),this.get("avatarSize")),this.js$("avatar").attr("src",e),this.js$("label").text(this.getCurrentTumblelogProperty("name")),this.get("showTotalBadge")&&!this.gthis._onBadgeCountChange())},teardown:function(){return this.remove(),this},getBadgeCount:function(){var e,t=this.get("currentTumblelog");return this.get("badgeCountField")?(e=n.sum(this.collection.pluck(this.get("badgeCountField"))),t&&!this.get("includeCurrentBlogInTotalBadge")&&(e-=t.get(this.get("badgeCountField"))),Math.max(0,e)):null},getBadgeCountString:function(e){var t=this.get("maxBadgeCount");return e>t?t+"+":e>0?e:""},updateBadge:function(e){var t=this.js$("badge");t.toggleClass(this.get("badgeActiveClass"),e>0),this.get("she))},_onBadgeCountChange:function(){this.updateBadge(this.getBadgeCount())},_onChangeShowCaret:function(e,t){this.js$("caret").toggle(t)},_onChangeShowName:function(e,t){this.js$("label").toggle(t)}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="blog-selector-container"><div class="selected-blog" data-js-button><img class="avatar" src="'+__e(avatarUrl)+'" alt="'+(null==(__t=displayName)?"":__t)+'" data-js-avatar> <span class="name" data-js-label>'+(null==(__t=displayName)?"":__t)+"</span> ",requiresDropdown&&(__p+=' <span class="caret '+__e(hasBadge?"has-badge":"")+'" data-js-caret data-js-badge>',badgeCountString&&(__p+=__e(badgeCountString)),__p+="</span> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(699),r=i(283),a=i(277),l=i(250),c=i(485),u=s.extend({className:"popover--blog-selector-dropdown",events:{"click [data-js-tumblelog]":"selectBlog"},mixins:[a,r],template:o,defaults:{currentTumblelog:!1,avatarSize:96,badgeCountField:null,maxBadgeCount:99,badgeActiveClass:"tab-notice--active"},initialize:function(e){if(e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"collection")),!this.get("currentTumblelog")){var t=this.collection.findWhere({is_current:!0});this.set("currentTumblelog",t)}},selectBlog:function(e){var t=this.$(e.currentTarget).index();this.set("currentTumblelog",this.collection.at(t)),this.teardown()},createScrollbar:function(){this.scrollbar||(this.scrollbar=new c(this.js$("scrollbar")))},afterRender:function(){return this.js$("scrollbar").addClass("popover-sublist popover-sublist--scrollable"),n.defer(n.bind(this.createScrollbar,this)),this.delegateEvents(),this.isShowBadges()&&this.listenTo(this.collection,"change:"+this.get("badgeCountField"),this._onBadgeCountChange),this},isShowBadges:function(){return!n.isEmpty(this.get("badgeCountField"))},getBadgeCount:function(e){return this.get("badgeCountField")&&e?e.get(this.get("badgeCountField")):null},getBadgeCountString:function(e){var t=this.get("maxBadgeCount");return e<=0?"":e>t?t+"+":e},getTemplateData:function(){var e,t=this.toJSON(),i=this.get("currentTumblelog");return i&&n.extend(t,{currentTumblelog:i.get("name")}),e=this.collection.map(function(e){return n.extend({avatarUrl:l(e.get("avatar_url"),this.get("avatarSize")),displayName:e.getDisplayName(),badgeCountString:this.getBadgeCountString(this.getBadgeCount(e))},e.toJSON())},this),llbar&&(this.scrollbar.destroy(),this.scrollbar=null),this.stopListening()},teardown:function(){return this.remove()},updateBadge:function(e){var t,i=this.$$("[data-js-channel-badge="+e.get("name")+"]");0!==i.length&&(t=this.getBadgeCount(e),i.toggleClass(this.get("badgeActiveClass"),t>0),t>0&&i.find("[data-js-channel-badge-text]").text(this.getBadgeCountString(t)))},_onBadgeCountChange:function(e){return this.updateBadge(e)}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="pop-menu"><ul class="inner select-right" data-js-scrollbar> ',_.forEach(channels,function(e){__p+=' <li class="item-option '+__e(e.name===currentTumblelog?"selected":"")+'" data-js-tumblelog><div class="avatar"><img src="'+__e(e.avatarUrl)+'" alt="'+__e(e.name)+'"> ',isShowBadges&&(__p+=' <span class="unread-indicator tab_notice tab-notice--outlined on-light ',e.badgeCountString&&(__p+="tab-notice--active "),__p+='" data-js-channel-badge="'+__e(e.name)+'"><span class="tab_notice_value" data-js-channel-badge-text>'+__e(e.badgeCountString)+"</span></span> "),__p+=' </div><div class="info-container"><p class="name">'+__e(e.displayName)+'</p><p class="title">'+(null==(__t=e.directory_safe_title)?"":__t)+"</p></div></li> "}),__p+=" </ul></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="blogSelector" class="blog-selector"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(702),a=o.extend({className:"inbox-compose-toggle",template:r,defaults:{isComposing:!1},events:{"click [data-js-compose-toggle]":"_onClickToggleCompose"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","isNewEmptyInboxEnabled"))},afterRender:function(){this.listenTo(this,"change:isComposing",this._onChangeIsComposing)},getTemplateData:function(){return{message:s(this.isNewEmptyInboxEnabled?"New Message":"Compose message")}},_onChangeIsComposing:function(e,t){this.$el.toggleClass("active",t)},_onClickToggleCompose:function(e){var t=void 0;e.preventDefault(),this.set("isComposing",!this.get("isComposing")),t=this.isNewEmptyInboxEnabled?this.eventBus.NEW_EMPTY_INBOX_NEW_MESSAGE_CLICK:this.eventBus.OLD_EMPTY_INBOX_NEW_MESSAGE_CLICK,this.eventBus.trigger(t,this.isNewEmptyInboxEnabled)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<a href="#" class="compose-toggle compose-start" data-js-compose-toggle>'+__e(message)+'</a><a href="#" class="compose-toggle compose-cancel" data-js-compose-toggle>'+__e(__("Nevermind"))+"</a>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="senderView"></div><div data-subview="composeToggleView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(130),r=i(226),a=i(277),l=i(705),c=i(689),u=i(489),h=i(707),d=r.extend({className:"inbox-compose",template:h,defaults:{isShowFavorites:!0,isLoading:!1,showLoadingAfterMs:250,hasEditorFocus:!1},events:{"input [data-js-textinput]":"_onTextInputChange","focus [data-js-textinput]":"_onTextInputFocus","blur [data-js-textinput]":"_onTextInputBlur"},mixins:[a],subviews:{favoritesView:{constructor:c,options:function(e){return{showMessageOnEmpty:!1,eventBus:e.eventBus,collection:e.favoritesCollection,title:o(e.isNewEmptyInboxEnabled?"Recently Followed":"Favorites"),context:"inbox:favorites",isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}},searchResultView:{constructor:c,options:function(e){return{eventBus:e.eventBus,collection:e.collection,context:"inbox:typeahead"}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","favoritesCollection","currentBlogModel","keyboardManager","isNewEmptyInboxEnabled")),this.collection=new l,this._debouncedSearch=n.bind(n.debounce(this._search,250),this)},afterRenderSubviews:function(){this.loader=new u({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),this.listenTo(this,"change:isShowFavorites",this._onChangeIsShowFavorites),this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this,"change:hasEditorFocus",this._onChangeHasEditorFocus),this._onChangeIsShowFavorites(this,this.get("isShowFavorites"))},_setKeyboardState:function(){this.keyboardManager.remove("inbox:compose"),this.get("hasEditorFocus")&&(this.get("isShowFavorites")?this.keyboardManager.add("inbox:compose:favorites",this.favoritesView):this.keyboardManager.add("inbox:compose:results",this.searchResultView))},_onChangeHasEditorFocus:function(e,t){this._setKeyboardState()},fetchResults:function(e){var t=this.currentBlogModel.getChannel().get("uuid");return this.set("isLoading",!0),this.collection.fetchByQuery(e,t).always(n.bind(function(){this.rendered&&this.set({isShowFavorites:!1,isLoading:!1})},this))},clear:function(){this.js$("textinput").val("")},focus:function(){this.js$("textinput").focus()},blur:function(){this.js$("textinput").blur()},beforeRemove:function(){this.keyboardManager.remove("inbox:compose")},_search:function(e){n.isEmpty)},_onTextInputChange:function(e){this._debouncedSearch(s(e.target).val())},_onTextInputBlur:function(e){this.set("hasEditorFocus",!1)},_onTextInputFocus:function(e){this.set("hasEditorFocus",!0)},_onChangeIsShowFavorites:function(e,t){this.favoritesView.toggle(t),this.searchResultView.toggle(!t),this._setKeyboardState()},_onChangeIsLoading:function(e,t){return this._loaderTimeout&&(clearTimeout(this._loaderTimeout),this._loaderTimeout=null),t?void(this._loaderTimeout=setTimeout(n.bind(function(){this.loader.set("loading",!0)},this),this.get("showLoadingAfterMs"))):this.loader.set("loading",!1)}});e.exports=d},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(130),r=i(190),a=i(670),l=i(706),c=r.extend({url:"/svc/conversations/participant_suggestions",model:a,resultCache:{},fetchFlags:["empty","post"],initialize:function(){return this.getNoResultsFoundMessage=l([o("That isn't anyone."),o("Uh, who?"),o("Huh what?"),o("Never heard of 'em."),o("???"),o("Eh?"),o("Whaaa?")]),r.prototype.initialize.apply(this,arguments)},parse:function(e,t){return s.get(e,"response.blogs")||e},fetchByQuery:function(e,t,i){return i=i||{},s.extend(i,{reset:!0,data:{q:e,participant:t}}),this.fetch(i)},fetchFavorites:function(e,t,i,n,o,r){return e=e||8,r=r||{},s.extend(r,{reset:!0,data:{limit:e,participant:t,include_recent:i,exclude_active:n},flag:o}),this.fetch(r)},fetch:function(e){var t=JSON.stringify(s.get(e,"data")),i=s.get(e,"flag",""),o=new n.Deferred,a=s.get(this.resultCache,t);return this.cancelFetch(),a&&this.fetchFlags.indexOf(i)!==-1?(this.reset(a),this.trigger("sync",this),o.resolve(),o):(this._request=r.prototype.fetch.apply(this,arguments),this._request.then(s.bind(function(e){this.fetchFlags.indexOf(i)!==-1&&s.set(this.resultCache,t,this.parse(e))},this)).always(s.bind(function(){this._request=null},this)),this._request)},cancelFetch:function(){this._request&&(this._request.abort(),this._request=null)}});e.exports=c},function(e,t,i){"use strict";function n(e){var t,i;return e=e||[],function(){return s.isEmpty(t)&&(t=s.shuffle(e),s.isEmpty(i)||(t=s.without(t,i))),i=t.pop()}}var s=i(3);e.exports=n},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){
obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="inbox-compose-input"><label class="label"><span class="label-text-container"> '+__e(__("To:"))+' </span><span class="input-container"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="input" data-js-textinput></span></label></div><div class="inbox-compose-main"><div data-subview="loader"></div><div data-subview="favoritesView"></div><div data-subview="searchResultView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(277),r=i(226),a=i(709),l=i(711),c=r.extend({className:"inbox-empty",template:l,mixins:[o],subviews:{blogsView:{constructor:a,options:function(e){return{collection:e.collection,eventBus:e.eventBus}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.deection"))},getTemplateData:function(){return{header:s("Talk to a Tumblr")}},toggle:function(e){this.$el.toggle(e)}});e.exports=c},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(710),a=o.extend({className:"inbox-empty-blogs",template:r,defaults:{numItemsPerRow:4},events:{"click [data-js-start-conversation]":"_onStartConversation"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","collection"))},afterRender:function(){this.listenTo(this.collection,"update reset",this.render)},getTemplateData:function(){var e,t=this.get("numItemsPerRow"),i=n.map(this.collection.models,function(e){return n.extend(e.toJSON(),{avatarUrl:e.getAvatarUrl()})});return i.length>0&&(e=Math.max(1,Math.floor(i.length/t)),i=i.slice(0,e*t)),{blogs:i}},_onStartConversation:function(e){var t=s(e.currentTarget).attr("data-js-start-conversation"),i=this.collection.findWhere({name:t});this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,[i],"inbox:empty"),this.eventBus.trigger(this.eventBus.OLD_EMPTY_INBOX_SUGGESTION_CLICK,i,"old:inbox:empty",!1),e.preventDefault()}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)_.isEmpty(blogs)||(__p+=' <div class="blogs"> ',_.each(blogs,function(e){__p+=' <a class="blog" href="/messaging/conversation/'+__e(e.name)+'" data-js-start-conversation="'+__e(e.name)+'"><img class="avatar" src="'+__e(e.avatarUrl)+'" alt="'+__e(e.name)+'" title="'+__e(e.name)+'" width="40" height="40"> </a> '}),__p+=" </div> ");return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="content"><div class="header-container"><h2 class="header" data-js-header>'+__e(header)+'</h2></div><div data-subview="blogsView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div data-subview="headerView"></div><div data-subview="composeView"></div><div class="inbox-main"><div data-subview="loader"></div><div data-subview="conversationsView"></div></div> ',isNewEmptyInboxEnabled&&(__p+=' <div class="empty-suggestions"><div data-subview="inboxRecipientsView"></div></div> '),__p+=' <div data-subview="emptyView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(235),r=i(130),a=i(226),l=i(331),c=i(277),u=i(220).animation,h=i(430),d=i(136),p=i(714),g=i(716),f=i(742),_=i(744),m=i(748),v=i(751),b=i(753),y=i(728),w=i(658),C=i(755),k=i(758),x=i(720).html,S=i(706),T=i(760),E=i(765),P=i(768),I=a.extend({template:P,className:"messaging-conversation-wrapper",defaults:{isError:!1,canSend:!0,isPossibleSpam:!1,isLoading:!0,isHidePendingPost:!1,isFetching:!0,isFetched:!1,isFetchingIcebreakers:!1,isOffline:!1,isAutoFetch:!0,isMinimized:!1,isDropping:!1,isCurrentDropValid:!0,animateInMessageDuration:500,minimizeOpeningClass:"is-minimize-opening",minimizeClosingClass:"is-minimize-closing",droppingClassName:"is-dropping",noBlurSupportClass:"no-blur-support",imagePreviewAnimateInDurationMs:300,imagePreviewAnimateOutDurationMs:200,imagePreviewAnimateInEasing:[.22,.685,.03,.895],imagePreviewAnimateOutEasing:[.895,.03,.685,.22],imageUploadMaxBytes:null,canModifySafeMode:!0,isProjectXEnabled:!1},events:{"click [data-js-tumblelog-name]":"_onBlogClick","click [data-js-messaging-tumblelog-name]":"_onMessagingBlogClick","click [data-js-lightbox-url]":"_onImageLightboxUrlClick","click [data-js-main]":"_onMainContainerClick",dragover:"_onDragOver",dragenter:"_onDragEnter",dragleave:"_onDragLeave",drop:"_onDragDrop",keydown:"_onKeyDown"},mixins:[c],subviews:{conversationLoaderView:{constructor:l,options:{variation:"small centered",loading:!1}},headerView:{constructor:p,options:function(e){return{eventBus:e.eventBus,participants:e.sortedParticipants,theme:e.theme,channels:e.channels,user:e.user}}},messagesView:{constructor:g,options:function(e){return{eventBus:e.eventBus,collection:e.model.get("messages"),participants:e.model.get("participants"),conversation:e.model,isSafeModeEnabled:e.isSafeModeEnabled,messageFormatter:e.messageFormatter,animateInMessage:n.bind(e._animateInMessage,e),otherParticipant:e.otherParticipant,canModifySafeMode:e.canModifySafeMode,wAnimateInEasing"),animateOutEasing:e.get("imagePreviewAnimateOutEasing")}}},composeView:{constructor:m,options:function(e){return{eventBus:e.eventBus,keyboardManager:e.keyboardManager,keyboardNamespace:e.keyboardNamespace+":compose",pluginsArray:e.getPluginsArray(),pluginAnimateInDurationMs:e.get("imagePreviewAnimateOutDurationMs"),pluginAnimateOutDurationMs:e.get("imagePreviewAnimateInDurationMs"),pluginAnimateInEasing:e.get("imagePreviewAnimateOutEasing"),pluginAnimateOutEasing:e.get("imagePreviewAnimateInEasing")}}},minimizedView:{constructor:v,options:function(e){return{eventBus:e.eventBus,model:e.model}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","user","model","channels","messageFormatter","popoverContainer","keyboardManager","collection","isSafeModeEnabled","canModifySafeMode","isProjectXEnabled")),this.keyboardNamespace="conversation:"+this.cid,this.model||(this.model=new w),this.messageFormatter||(this.messageFormatter=new x),this.conversation=this.model,this.sortedParticipants=this._getSortedParticipantsCopy(),this.otherParticipant=this.conversation.getOtherParticipant(),this.getGenericErrorMessage=S([r("Something went screwy."),r("Something's busted."),r("Something got snagged."),r("Something's acting up."),r("Something sucks!"),r("Internet is being dumb."),r("Computer weirdness."),r("The server is being foolish."),r("Something fizzled."),r("The internet evaporated."),r("The internet is being wiggly."),r("Something went splat."),r("Server turned to dust."),r("Something's wonky."),r("Something's not happening."),r("Something's not working."),r("Something got messed up."),r("Unknown, totally annoying error."),r("A nameless error mysteriously occurred."),r("Our computer is a loser."),r("Something pooped out."),r("Something fell into a volcano."),r("Something is all gummed up."),r("Something melted.")]),this.permanentPostErrorMessage=r("Can't send this post."),this.getRetryPostErrorMessage=S([r("Hrm. Post didn't send."),r("Blegh. Post didn't send."),r("Fffft. Post didn't send."),r("Welp. Post didn't send."),r("Sending machine broke.")]),this.customErrorMessages={403.7001:r("Please verify your email address before talking to a Tumblr."),403.7003:r("Sorry, %1$s only allows messages from Tumblrs they follow.",this.otherParticipant.get("name")),409:r("You can only send messages to Tumblrs you follow."),429:r("You've hit the daily limit on new conversations. Impressive.")},this.getSpamErrorMessage=S([r("Look sketchy?"),r("Look suspicious?"),r("Look fishy?"),r("Look shady?"),r("Seem fake?"),r("Is this spam?")]),this.easeOutExpo=[.19,1,.22,1],this.dragCount=0},render:function(){return this.imageUploadPlugin=new E({imageUploadMaxBytes:this.getImageUploadMaxBytes()}),a.prototype.render.apply(this,arguments)},afterRenderSubviews:function(){this.listenTo(this,"change:isError change:isLoading",this._setOpenViewStates),this.listenTo(this,"change:isHidePendingPost change:isFetching change:isError change:isFetchingIcebreakers",this._setLoadingState),this.listenTo(this,"change:isOffline",this._onChangeIsOffline),this.listenTo(this,"change:canSend",this._onChangeCanSend),this.listenTo(this,"change:isPossibleSpam",this._onChangeIsPossibleSpam),this.listenTo(this,"change:isMinimized",this._onChangeIsMinimized),this.listenTo(this,"change:isDropping",this._onChangeIsDropping),this.listenTo(this,"change:isCurrentDropValid",this._onChangeIsCurrentDropValid),this.listenTo(d,"tumblr_lightbox:form:hide",this._onTumblrLightboxFormHide),this.listenTo(this.composeView,"submit",this._onComposeSubmit),this.listenTo(this.composeView,"resize",this._onComposeResize),this.listenTo(this.composeView,"input",this._onComposeInput),this.listenTo(this.composeView,"focus",this._onComposeFocus),this.listenTo(this.composeView,"blur",this._onComposeBlur),this.listenTo(this.composeView,"plugin:preview:add:image",this._onComposeViewPluginPreviewAddImage),this.listenTo(this.composeView,"plugin:click",this._onComposeViewPluginClick),this.listenTo(this.composeView,"pasteBlob",this._onComposePasteBlob),this.listenTo(this.headerView,"closeClick",this._onTriggeredClose),this.listenTo(this.headerView,"minimizeClick",this._onHeaderMinimizeClick),this.listenTo(this.headerView,"moreActionsClick",this._onHeaderMoreActions),this.listenTo(this.conversation,"change:id",this._onChangeId),this.listenTo(this.conversation,"change:unreadCount",this._onChangeUnreadCount),this.listenTo(this.conversation,"change:can_send",this._onChangeConversationCanSend),this.listenTo(this.conversation,"change:is_possible_spam",this._onChangeConversationIsPossibleSpam),this.listenTo(this.conversation.get("messages"),"change:hasNextPage",this._onChangeMessagesHasNextPage),this.listenTo(this.messagesView,"pillClick",this._onPillClick),this.listenTo(this.messagesView,"messageRetryClick",this._onMessageRetryClick),this.listenTo(this.messagesView,"messageImageUnblur",this._onMessageImageUnblur),this.listenTo(this.composeView,"close",this._onTriggeredClose),this.listenTo(this.minimizedView,"click",this._onMinimizedViewClick),this.listenTo(this.previewView,"close",this._onPreviewViewClose),this.listenTo(this.previewView,"closing",this._onPreviewViewClosing),this.listenTo(this.previewView,"dismiss",this._onPreviewViewDismiss),this.listenTo(this.previewView,"edit",this._onPreviewViewEdit),this._setLoadingState(),this._setMainViewStates(),this._setOpenViewStates(),this._onChangeConversationCanSend(this.conversation,this.conversation.get("can_send")),this._onChangeCanSend(this,this.get("canSend")),this._onChangeConversationIsPossibleSpam(this.conversation,this.conversation.get("is_possible_spam")),this._onChangeIsPossibleSpam(this,this.get("isPossibleSpam")),this.get("isAutoFetch")&&this.fetch(),this.mainTheme=this._applyTheme(this.el),this.js$("conversation-open").toggleClass(this.get("noBlurSupportClass"),!h.cssFilters())},beforeRemove:function(){this.conversation.get("messages").reset(this.conversation.getInboxMessage()),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("close")},fetch:function(e){return e=e||{},n.extend(e,{error:n.bind(this._onFetchConversationFail,this)}),this.set("isFetching",!0),this.eventBus.trigger(this.eventBus.CONVERSATION_FETCHING,this.conversation),this._pendingQueueItems=this.conversation.getQueueItems(),this.conversation.clearQueue(),this.conversation.fetchConversation(e).then(n.bind(this._onFetchConversationSuccess,this)).always(n.bind(this._onFetchConversationAlways,this))},poll:function(e,t){return e=e||{},this.eventBus.trigger(this.eventBus.CONVERSATION_FETCHING,this.conversation),this.conversation.poll(e,t).then(n.bind(function(){this.messagesView.scrollToBottom()},this))},refresh:function(e){t){return this.isMinimized()?this.focusMinimized():this.focusCompose(),this},getImageUploadMaxBytes:function(){return this.get("imageUploadMaxBytes")},getPluginsArray:function(){var e=[];return e.push(new T({collection:this.collection})),n.isEmpty(this.imageUploadPlugin)||e.push(this.imageUploadPlugin),e},isMinimized:function(){return this.get("isMinimized")},focusMinimized:function(){this.minimizedView&&this.minimizedView.focus()},focusCompose:function(){this.composeView&&this.composeView.focus()},toggleMinimize:function(e,t){var i,o,r,a=new s.Deferred,l=this.get("minimizeOpeningClass"),c=this.get("minimizeClosingClass"),u=this.js$("conversation-open"),h=this.js$("conversation-mimized()?(new s.Deferred).resolve():(i=function(){this.set("isMinimized",e)},o=function(){a.resolve()},t?(i.call(this),o.call(this)):e?this._addAnimationClass(u,c).then(n.bind(function(){i.call(this),this._addAnimationClass(h,l).then(n.bind(o,this))},this)):this._addAnimationClass(h,c).then(n.bind(function(){i.call(this),this._addAnimationClass(u,l).then(n.bind(o,this))},this)),e||this.get("isFetched")||(r=this.fetch(),d.push(r)),s.when.appgleMinimize(!0,e)},unminimize:function(e){return this.toggleMinimize(!1,e)},_showError:function(e){var t,i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.conversationErrorView&&this.conversationErrorView.remove(),i=this.js$("main"),t=new b(e),i.append(t.render().$el),this.conversationErrorView=t,this.set({isOffline:n,isError:!0}),this._applyTheme(t.el),t},_hideError:function(){this.conversationErrorView&&(this.conversationErrorView.remove(),this.conversationErrorView=null),this.set({isError:!1,isOffline:!1}),this.focus()},_onFetchConversationSuccess:function(){this.rendered&&(this.set("isFetched",!0),this._hideError(),this.conversation.markAsRead(),this.otherParticipant.set(this.conversation.getOtherParticipant().toJSON()),this.messagesView.statusBannerView.trigger("setActiveTime",this.otherParticipant.get("seconds_since_last_activity")),this.minimizedView.trigger("setIsOnline",this.otherParticipant.get("seconds_since_last_activity")!==-1),this._queueMessages(this._pendingQueueItems),this._pendingQueueItems=null,this.conversation.get("messages").hasNextPage()||(this.set("isFetchingIcebreakers",!0),this._createIcebreakersView().always(n.bind(function(){this.set("isFetchingIcebreakers",!1),this.focus()},this))))},_flushMessageQueue:function(){var e;return this.conversation.hasQueue()?(e=this.conversation.getQueueItems(),this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGES_SEND_REQUESTED,e,this.conversation),this.conversation.isFlushingQueue()?this._flushDefer:(this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGES_SENDING,e,this.conversation),this._flushDefer=this.conversation.flushMessageQueue().progress(n.bind(this._onFlushProgress,this)).fail(n.bind(this._onFlushFail,this)).always(n.bind(this._onFlushAlways,this)),this._flushDefer)):(new s.Deferred).reject()},_onFlushProgress:function(e,t){this.rendered&&this.set("isHidePendingPost",!t&&!this._canRenderPendingMessage(e)),t?this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_SENT,e,this.conversation):this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_SENDING,e,this.conversation)},_onFlushFail:function(e){this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_FAILED,e,this.conversation),this.rendered&&(this._canRenderPendingMessage(e)||(this.conversation.get("messages").remove(e),this._showPostSendingError(e)),this._flushMessageQueue())},_onFlushAlways:function(){this.rendered&&(this.set("isHidePendingPost",!1),this.focus())},_onFetchConversationFail:function(e,t){var i,s=t.status,o=n.get(t,"responseJSON.errors.0.code");this.rendered&&(n.isFinite(o)&&o>0&&(i=this.customErrorMessages[s+"."+o]),n.isEmpty(i)&&(i=n.get(this.customErrorMessages,s,this.getGenericErrorMessage())),this._showError({message:i,buttonCallback:n.bind(this._onConversationErrorRetryClick,this),showButton:e.canRetryFetch(n.get(t,"status"))}))},_showPostSendingError:function(e){var t,i,s;if(this.rendered){if(!e.canRetry())return t=this.permanentPostErrorMessage,i=r("Close"),s=this._onPostSendingErrorCloseClick,void this._showError({message:t,buttonCallback:n.bind(s,this),buttonText:i},!1);t=this.getRetryPostErrorMessage(),s=n.partial(this._onPostSendingErrorRetryClick,e),this._showError({message:t,buttonCallback:n.bind(s,this),buttonText:i})}},_onPostSendingErrorCloseClick:function(){this._hideError()},_onPostSendingErrorRetryClick:function(e){this._resendMessage(e).then(n.bind(function(){this._hideError()},this))},_onFetchConversationAlways:function(){this.rendered&&this.set("isFetching",!1)},_onComposeSubmit:function(e,t){var i,s,o=this.previewView.getMessage(),r=!n.isEmpty(e),a=!n.isEmpty(o);r&&(i=w.createTextMessage(e,{hasAnimation:!0,creationUserAction:t})),a&&(o.set({isFromPreview:!0,hasAnimation:!0,creationUserAction:t}),r&&i.set({context:o.get("context")})),s=n.compact([o,i]),a?this.previewView.close().then(n.bind(function(){n.delay(n.bind(function(){this.rendered&&this._queueMessages(s)},this),150)},this)):this._queueMessages(s),this.messagesView.scrollToBottom()},_canRenderPendingMessage:function(e){return!n.isEmpty(e)&&(!e.isPost()||e.getPost().hasThumbnail())},_queueMessages:function(e,t){return n.isEmpty(e)?(new s.Deferred).reject():(t=n.extend({},t,{isSendingMessage:!0}),n.isArray(e)||(e=[e]),n.each(e,n.bind(function(e){e.set("isQueued",!0),this.conversation.addMessage(e,t)},this)),this.conversation.appendToQueue(e,t),this._flushMessageQueue())},_resendMessage:function(e){var t=this.conversation.get("messages");return t.last()!==e&&t.remove(e),this._queueMessages(e)},_onComposeResize:function(){this.messagesView.updateScrollBar()},_onComposeInput:function(e,t){this.trigger("compose:input",e,t),this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_INPUT,this.conversation,e)},_onComposeFocus:function(e){this.trigger("compose:focus",e)},_onComposeBlur:function(e){this.trigger("compose:blur",e)},_onComposePasteBlob:function(e){this._i"clipboard")},_onChangeId:function(e){e.isNew()||this.trigger("created",e)},_onChangeUnreadCount:function(e,t){0===t||this.isMinimized()||(this.messagesView.isAtBottom()?this._fetchUnreadMessages().then(n.bind(function(){this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGES_UNREAD_FETCHED)},this)):this.messagesView.showPill(t).then(n.bind(this._fetchUnreadMessages,this)).catch(n.noop))},_fetchUnreadMessages:function(){var e=this.conversation.get("unreadCount"),t=Math.min(10,e+5);return 0===e?(new s.Deferred).reject():(this.conversation.markAsRead(),this.poll(null,t))},_getSortedParticipantsCopy:function(){var e=this.conversation.get("participants"),t=this.channels.getSortedIds(this.conversation.get("participantUuid")),i=e.getSortedByChannels(t,!0);return new e.constructor(i)},_setLoadingState:function(){var e=this.get("isFetching")||this.get("isHidePendingPost")||this.get("isFetchingIcebreakers");this.set("isLoading",!this.get("isError")&&e)},_setMainViewStates:function(){var e=this.get("isMinimized"),t=this.js$("conversation-open"),i=this.js$("conversation-minimized");t.toggle(!e),i.toggle(e),e?i.css("display",""):t.css("display","")},_setOpenViewStates:function(){var e=this.get("isError"),t=this.get("isLoading");this.messagesView.toggle(!e&&!t),this.composeView.set("isDisabled",e||t),this.conversationLoaderView.set("loading",t)},_setDragDropClasses:function(){var e=this.get("droppingClassName"),t=this.get("isCurrentDropValid"),i=this.get("isDropping"),n=this._isFileDropEnabled(),s=n&&i&&t;this.js$("conversation-open").toggleClass(e,s),this.js$("conversation-minimized").toggleClass(e,s)},_createIcebreakersView:function(){var e;return this.icebreakersView?(e=new s.Deferred,e.reject(),e):this.otherParticipant.fetchAdditionalInfo(this.conversation.getParticipantId()).then(n.bind(function(){var e;this.rendered&&(e=this.conversation.isNew(),this.icebreakersView=new k({participant:this.otherParticipant,isShowTags:e,isShowRelationship:!e,isShowDescription:!e}),this.messagesView.addHeaderView(this.icebreakersView))},this))},_onTriggeredClose:function(){this.trigger("close")},_onHeaderMoreActions:function(e){this.actionsPopover&&this.actionsPopover.isOrWasRecentlyRendered()||this._showMoreActionsPopover(e)},_onHeaderMinimizeClick:function(){this.minimize()},_onMinimizedViewClick:function(){this.unminimize()},_onPillClick:function(){this.focus()},_onBlogClick:function(e){var t=s(e.currentTarget);this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_TUMBLR_URL,{blogName:t.attr("data-js-tumblelog-name"),postId:t.attr("data-js-post-id"),searchTagTerm:t.attr("data-js-tumblelog-tag"),url:t.attr("href"),originalEvent:e,otherParticipant:this.otherParticipant})},_onMessagingBlogClick:function(e){var t=s(e.currentTarget);this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_MESSAGING_URL,{blogName:t.attr("data-js-messaging-tumblelog-name"),url:t.attr("href"),originalEvent:e})},_onImageLightboxUrlClick:function(e){e.preventDefault();var t,i=s(e.currentTarget),o=i.attr("data-js-lightbox-width"),r=i.attr("data-js-lightbox-height"),a=i.attr("data-js-lightbox-lowres-url"),l=i.attr("data-js-lightbox-url");n.isEmpty(a)||n.isEmpty(l)||(t={width:o,height:r,low_res:a,high_res:l},n.get(t,"low_res")&&(this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_LIGHTBOX,{lightBoxImageData:[t]}),this.composeView.set("isLightboxOpen",!0)))},_onActionsBlock:function(e){var t=this.conversation.getParticipantModel();n.isEmpty(t)||this.eventBus.trigger(this.eventBus.BLOCK,{currentTumblelog:t.get("name"),bventBus.trigger(this.eventBus.CONVERSATION_DELETE_MODEL,this.conversation)},_applyTheme:function(e){var t;return n.isEmpty(this.otherParticipant)?null:(t=this.otherParticipant.get("theme"),n.isEmpty(t)?null:new y({el:e,theme:t}).render())},_showMoreActionsPopover:function(e){var t;this.actionsPopover&&this.actionsPopover.remove(),this.actionsPopover=new C({autoTeardown:!0,pinnedSide:"bottom",pinnedTarget:e,popoverContainer:this.popoverContainer,viewOptions:{participants:this.conversation.get("participants"),user:this.user}}),t=this.actionsPopover.getView(),this.listenTo(t,"block",this._onActionsBlock),this.listenTo(t,"delete",this._onActionsDelete),this.actionsPopover.render()},_animateInMessage:function(e,t,i){var s,r,a=e.$el,l=this.composeView.$el.offset(),c=a.offset(),u=Math.max(0,l.top-c.top)+a.height();i.get("isFromPreview")?s=0:(r=t.offset(),s=l.left-r.left),this.messagesView.setIsAnimating(!0),o.animate(a,{translateY:[0,u],translateX:[0,s],opacity:[1,1]},{duration:this.get("animateInMessageDuration"),easing:this.easeOutExpo,complete:n.bind(function(){this.messagesView.setIsAnimating(!1),i.set("hasAnimation",!1),a.css("transform","")},this)})},_addAnferred;return e.removeClass(t),u(e,function(){e.removeClass(tew:function(e,t){var i=function(){this.imageUploadPlugin.addImageFile(e,t)};this.isMinimized()?this.unminimize().then(n.bind(i,this)):i.call(this)},_isFileDropEnabled:function(){return this.rendered&&!this.previewView.hasImage()"isError")},_onConversationErrorRetryClick:function(e){return this.fetch()},_onChangeIsOffline:function(e,t){this.composeView.set("isOffline",t)},_onage(e)},_onMessageImageUnblur:function(e){this.conversation.unblurImages()},_onChangeConversationCanSehangeConversationIsPossibleSpam:function(e,t){this.set("isPossibleSpam",t)},_onChangeCanSend:function(e,t){var i=r("This Tumblr can't receive messages.");this.composeView.toggle(t),!t&&this.canSendErrorView||t&&!this.canSendErrorView||(t?(this.messagesView.removeFooterView(this.canSendErrorView),delete this.canSendErrorView):(this.canSendErrorView=new f({message:i,showErrorIcon:!0}),this.messagesView.addFooterView(this.canSendErrorView)))},_onChangeIsPossibleSpam:function(e,t){t&&this.isPossibleSpamView||!t&&!this.isPossibleSpamView||(t?(this.isPossibleSpamView=new f({message:this.getSpamErrorMessage(),actionText:r("Mark as spam"),actionCallback:n.bind(this._onMarkAsSpamLinkClick,this)}),this.messagesView.addFooterView(this.isPossibleSpamView)):(this.messagesView.removeFooterView(this.isPossibleSpamView),delete this.isPossibleSpamView))},_onChangeIsMinimized:function(e,t){this._setMainViewStates(),t||n.defer(n.bind(function(){this.messagesView.updateScrollBar(),this.focus(),this.conversation.get("unreadCount")>0&&(this._fetchUnreadMessages(),this.messagesView.scrollToBottom())},this)),this.trigger(t?"minimized":"unminimized")},_onChangeIsDropping:function(e,t){this._setDragDropClasses()},_onChangeIsCurrentDropValid:function(e,t){this._setDragDropClasses()},_onMainContainerClick:function(){window.getSelection().isCollapsed&&this.focus()},_onKeyDown:function(e){var t=e.keyCode;9===t&&(e.shiftKey?this.trigger("keydown:shift+tab",e):this.trigger("keydown:tab",e))},_onDragOver:function(e){var t=n.get(e,"originalEvent.dataTransfer.types",[]),i=n.contains(t,"Files"),s=this._isFileDropEnabled();e.preventDefault(),this.set("isCurrentDropValid",i),n.set(e,"originalEvent.dataTransfer.dropEffect",i&&s?"copy":"none")},_onDragEnter:function(){this.dragCount++,this.set("isDropping",!0)},_onDragLeave:function(){this.dragCount--,this.set("isDropping",this.dragCount>0)},_onDragDrop:function(e){var t=n.get(e,"originalEvent.dataTransfer.files",[]);if(e.preventDefault(),this.dragCount=0,this.set("isDropping",!1),0!==t.length)return this.previewView.hasImage()?void(this.isMinimized()&&this.unminimize()):void(this._isFileDropEnabled()&&this._addImageToFilePreview(n.last(t),"drop"))},_onComposeViewPluginPreviewAddImage:function(e){this.previewView.addImage(e),this.messagesView.updateScrollBar(),this.composeView.toggleAutoValidation(!1),this.focus(),this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_PREVIEW_ADD,this.conversation,e)},_onComposeViewPluginClick:function(e){this.eventBus.trigger(this.eventBus.CONVERSATION_COMPOSE_PLUGIN_CLICK,this.conversation,e)},_onPreviewViewClosing:function(e){this.focus()},_onPreviewViewClose:function(e){this.messagesView.updateScrollBar(),this.composeView.toggleAutoValidation(!0),this.focus()},_onPreviewViewDismiss:function(e){this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_PREVIEW_DISMISS,this.conversation,e)},_onPreviewViewEdit:function(e){this.eventBus.trigger(this.eventBus.CventBus.CONVERSATION_MARK_AS_SPAM,this.conversation,this.otherParticipant)},_onChangeMessagesHasNextPage:function(e,t){!this.rendered||this.converumblrLightboxFormHide:function(){this.composeView.set("isLightboxOpen",!1)}});e.exports=I},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(715),a=s.extend({className:"conversation-header",template:r,mixins:[o],defaults:{separator:"+"},attributes:{"data-js-theme-background-color-or-image-class":!0,"data-js-theme-accent-color-on-background":!0},events:{"click [data-js-close]":"_onClickCloseButton","click [data-js-more-actions]":"_onClickMoreActions","click [data-js-minimize]":"_onClickMinimizeButton"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","participants","user","channels"))},getTemplateData:function(){var e;return e=this.channels.length>1?this.participants.toJSON():n.invoke(this.id")),"toJSON"),e=n.filter(e,function(e){return!n.isEmpty(n.get(e,"name"))}),{participants:e,separator:this.get("separator")}},_onClickCloseButton:function(e){this.trigger("closeClick"),e.preventDefault()},_onClickMoreActions:function(e){var t=e.currentTarget;thinimizeButton:function(e){this.trigger("minimizeClick"),e.preventDefault()}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="conversation-header-image" data-js-theme-header-image></div><div class="conversation-header-main"><div data-js-title class="title"> ';var lastIndex=participants.length-2;__p+=" ",_.each(participants,function(e,t){__p+=' <a href="'+__e(e.url)+'" target="_blank" data-js-tumblelog-name="'+__e(e.name)+'">'+__e(e.name)+"</a> "+__e(t===lastIndex?" "+separator+" ":t<lastIndex?", ":"")+" "}),__p+=' </div><div class="controls" data-js-theme-accent-color-on-background><a href="#" data-js-more-actions class="more-actions">'+__e(__("Actions"))+'</a><a href="#" data-js-minimize class="minimize">'+__e(__("Minimize"))+'</a><a href="#" data-js-close class="close">'+__e(__("Close"))+"</a></div></div>"}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(9),o=i(192),r=i(226),a=i(682),l=i(277),c=i(331),u=i(688),h=i(717),d=i(736),p=i(738),g=i(739),f=r.extend({className:"conversation-messages",template:p,mixins:[l,a],defaults:{isVisible:!0,isPaginating:!1,tsHeaderThreshold:36e5,collapseMessagesThreshold:6e4,pillClickScrollSpeed:500,pillBottomThreshold:80},subviews:{paginationLoaderView:{constructor:c,options:{variation:"small h-centered",loading:!1}},messagesView:{constructor:h,options:function(e){return{eventBus:e.eventBus,participants:e.participants,conversation:e.conversation,formatter:e.messageFormatter,animateInMessage:e.animateInMessage,isSafeModeEnabled:e.isSafeModeEnabled,afterRetryClick:n.bind(e.afterRetryClick,e),afterImageUnblur:n.bind(e.afterImageUnblur,e),canModifySafeMode:e.canModifySafeMode,isProjectXEnabled:e.isProjectXEnabled}},collection{otherParticipant:e.otherParticipant,name:e.otherParticipant.get("name")}}},pillView:{constructor:d,options:function(e){return{eventBus:e.eventBus}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","collection","participants","conversation","messageFormatter","animateInMessage","isSafeModeEnabled","otherParticipant","canModifySafeMode","isProjectXEnabled"))},afterRenderSubviews:function(){this.scrollBar=new u({el:this.el,
bottomThreshold:this.get("pillBottomThreshold")}),this.listenTo(this.collection,"update reset",this._onCollectionUpdate),this.listenTo(this.collection,"change:hasNextPage",this._onChangeHasNextPage),this.listenTo(this.collection,"change:isError",this._onChangeMessageIsError),this.listenTo(this.scrollBar,"scrolltop",this._onScrollChangeIsAtTop),this.listenTo(this.scrollBar,"scrollbottom",this._onScrollChangeIsAtBottom),this.listenTo(this.scrollBar,"scrollstop",this._createPositionSnapshot),this.listenTo(this.pillView,"click",this._onPillViewClick),this.listenTo(this,"change:isPaginating",this._onChangeIsPaginating),this.listenTo(this,"change:isVisible",this._onChangeIsVisible),this._onChanion(){this._processMessages(),this.updateScrollBar(),this.scrollToBottom()},this))},befory()},scrollToBottom:function(e){this._setScrollTop(this.el.scrollHeight,e)},getNextPage:function(){this.collection.hasNextPage()&&(this.set("isPaginating",!0),this.collection.fetchNextPage({at:0,isPaginating:!0,scrollBottom:this._getCurrentScrollBottom()}).always(n.bind(function(){this.set("isPaginating",!1)},this)))},updateScrollBar:function(){var e,t=this.scrollBar.isDisabled();this.scrollBar.setDisabled(!0),this.scrollBar&&this.scrollBar.update(),e=this._getPositionDiff(),e&&this._setScrollTop(this.$el.scrollTop()+e.height+e.scrollTop),this._createPositionSnapshot(),this.scrollBar.setDisabled(t)},afterRetryClick:function(e){this.trigger("messageRetryClick",e)},afterImageUnblur:function(e){this.trigger("messageImageUnblur",e)},toggle:function(e){this.set("isVisible",e)},isAtBottom:function(){return!this._lastPosition||!this.scrollBar||this._lastPosition.scrollBottom<this.get("pillBottomThreshold")},showPill:function(e){return this._pillDefer&&this._pillDefer.reject(),this._pillDefer=o.defer(),this.pillView.setCount(e),this._pillDefer.promise},addHeaderView:function(e){var t=this._getCurrentScrollBottom();return this.js$("header").append(e.render().$el),this._adjustScrollbarAfterNewElements(t),e},removeHeaderView:function(e){return e.remove()},addFooterView:function(e){return this.js$("footer").append(e.rendemove()},setIsAnimating:function(e){this.$el.toggleClass("is-animating",e)},_onChangeIsVisible:function(e,t){this.$el.css("visibility",t?"":"hidden"),t&&(this.updateScrollBar(),this.scrollToBottom())},_setScrollTop:function(e,t){t?this.$el.animate({scrollTop:e},t):this.$el.scrollTop(e),this._createPositionSnapshot()},_getCurrentScrollBottom:function(){return this.el.scrollHeight-this.$el.scrollTop()},_onCollectionUpdate:function(e,t){this._processMessages(t),n.get(t,"isPaginating")&&th.defer(n.bind(function(){this.rendered&&this._adjustScrollbarAfterFetch(t)},this))},_adjustScrollbarAfterFetch:function(e){this.scrollBar&&this.scrollBar.update(),n.get(e,"isPolling")||n.get(e,"isPaginating")||this.scrollToBottom(),this._createPositionSnapshot()},_adjustScrollbarAfterNewElements:function(e){n.isNumber(e)&&(this.scrollBal.scrollHeight-e),n.delay(n.bind(function(){this.scrollBar.setDisabled(!1)},this),500))},_onChangeIsPaginating:function(e,t){this.paginationLoaderView.set("loading",t)},_onChangeHasNextPage:function(e,t){this.js$("loader-container").toggle(t)},_processMessages:function(e){var t,i=this.get("tsHeaderThreshold"),s=this.get("collapseMessagesThreshold"),o=(new Date).getTime();n.get(e,"isPolling")&&(o="new"),this.collection.each(function(e){e.set({tsHeader:this._getTimestampHeader(e,t,i),isCollapsed:this._getIsCollapsed(e,t,s,o)}),t=e},this)},_getTimestampHeader:function(e,t,i){var n=e?e.getTimestamp():null,o=t?t.getTimestamp():null,r=!o||n-o>i;return r?s(n).calendar():null},_getIsCollapsed:function(e,t,i,n){return e.has("collapseGroup")||e.set("collapseGroup",e.isNew()?"new":n),!!t&&(e.get("collapseGroup")===t.get("collapseGroup")&&(e.get("participant")===t.get("participant")&&e.getTimestamp()-t.getTimestamp()<i))},_getScrollPosition:function(){return this.scrollBar.getCurrentPositions()},_createPositionSnapshot:function(){this._lastPosition=this._getScrollPosition()},_getPositionDiff:function(){if(this._lastPosition){var e=this._getScrollPosition();return{scrollTop:this._lastPosition.scrollTop-e.scrollTop,scrollBottom:this._lastPosition.scrollBottom-e.scroleight-e.height}}},_onScrollChangeIsAtTop:function(e){e&&this.getNextPage()},_onScrollChangeIsAtBottom:function(e){e&&this._pillDefer&&(this._pillDefer.resolve(this.pillView.getCount()),this.pillView.setCount(0))},_onPillViewClick:function(){this.pillView.setCount(0),this.scrollToBottom(this.get("pillClickScrollSpeed")),this._pillDefer&&this._pillDefer.resolve()},_onChangeMessageIsError:function(){this.scrollToBottom()}});e.exports=f},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(277),a=i(661),l=i(718),c=i(719),u=i(725),h=i(727),d=i(730),p=i(732),g=i(734),f=o.extend({className:"conversation-message",template:l,mixins:[r],defaults:{pendingClassName:"is-pending"},events:{"click [data-js-retry-button]":"_onRetryClick"},messagesTypes:{},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","participants","conversation","afterRetryClick","formatter","animateInMessage","afterImageUnblur","isSafeModeEnabled","canModifySafeMode","isProjectXEnabled")),this.addMessageType(a.STICKER,g,function(e){return{conversation:e.conversation}}),this.isProjectXEnabled&&!this.canModifySafeMode&&this.model.get("post").get("is_nsfw")===!0?this.addMessageType(a.POST,h,function(e){return{conversation:e.conversation,canModifySafeMode:e.canModifySafeMode}}):this.addMessageType(a.POST,u),this.addMessageType(a.IMAGE,d,function(e){return{conversation:e.conversation,afterImageUnblur:n.bind(e.afterImageUnblur,e)}}),this.addMessageType(a.TEXT,c,function(e){return{formatter:e.formatter}})},afterRenderSubviews:function(){var e=this.createMessageView(this.model.get("type"));return e?(this.js$("message-container").html(e.render().$el),this.model.get("hasAnimation")&&n.isFunction(this.animateInMessage)&&this.animateInMessage(this,this.js$("message-bubble"),this.model),this.listenTo(this.model,"change:isPending",this._onChangeIsPending),this.listenTo(this.model,"change:isError",this._onChangeIsError),this.listenTo(this.model,"change:isCollapsed",this._onChangeIsCollapsed),this.listenTo(this.model,"change:isQueued",this._onChangeIsQueued),this.listenTo(this.model,"change:tsHeader",this._onChangeTsHeader),this.listenTo(this.model,"change:isPending change:isError change:canRetry change:id",this.setRetryButtonState),this._onChangeIsPending(this.model,this.model.get("isPending")),this._onChangeIsError(this.model,this.model.get("isError")),this._onChangeTsHeader(this.model,this.model.get("tsHeader")),this._onChangeIsCollapsed(this.model,this.model.get("isCollapsed")),this._onChangeIsQueued(this.model,this.model.get("isQuessageType:function(e,t,i){this.messagesTypes[e]={constructor:t,options:i}},getMessageType:function(e){return n.get(this.messagesTypes,e)},createMessageView:function(e){var t,i=this.getMessageType(e);return n.isEmpty(i)||!n.has(i,"constructor")?null:(t=n.get(i,"options",{}),n.isFunction(t)&&(t=t.call(this,this)),n.extend(t,{model:this.model,participants:this.participants,eventBus:this.eventBus,setRetryButtonState:n.bind(this.setRetryButtonState,this)}),new i.constructor(t))},setRetryButtonState:function(){var e,t,i,n,o,r,a,l;this.rendered&&(e=this.js$("retry-button",!0),0!==e.length&&(o=this.model.isNew(),t=this.model.get("isPending"),i=this.model.get("canRetry"),n=this.model.get("isError"),r=s(i?"Retry":"Could not send"),a=t?s("Trying..."):r,l=n&&o,e.toggle(l),l&&(e.text(a).prop("disabled",t||!i),e.toggleClass(this.get("pendingClassName"),t))))},_onChangeTsHeader:function(e,t){this.timestampView&&this.timestampView.remove(),n.isEmpty(t)||(this.timestampView=new p({model:this.model}),this.$el.prepend(this.timestampView.render().$el))},_onChangeIsCollapsed:function(e,t){this.$el.toggleClass("collapsed",t)},_onChangeIsPending:function(e,t){this.$el.toggleClass("pending",t)},_onChangeIsError:function(e,t){this.$el.toggleClass("error",t)},_onChangeIsQueued:function(e,t){this.$el.toggleClass("queued",t)},_onRetryClick:function(e){e.preventDefault(),this.model.get("canRetry")&&(this.trigger("retryClick",this.model),n.isFunction(this.afterRetryClick)&&this.afterRetryClick(this.model))}});e.exports=f},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+="<div data-js-message-container></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(720).html,a=i(8),l=i(262),c=i(724),u=s.extend({className:"conversation-message-text message-container",mixins:[o],template:c,defaults:{fullWidthBubblePercentThreshold:60,fullWidthBubbleClass:"full-width-bubble"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","participants")),this.formatter=e.formatter||new r},afterRenderSubviews:function(){this.listenTo(this.model.get("content"),"change",this.render),this.$el.width()?this._setBubbleStyles():n.defer(n.bind(this._setBubbleStyles,this));var e=this.$el.find(".pixelated-avatar");n.each(e,n.bind(function(e){a(e).removeClass("hide").addClass("show"),l.drawPixelatedImages(this)},this))},getTemplateData:function(){var e=this.participants.get(this.model.get("participant")),t=this.model.toJSON(),i=this.formatter.render(n.get(t,"content.text"),n.get(t,"content.formatting"));return{message:i,canPixelateAvatar:e?e.get("can_pixelate_avatar"):null,avatarUrl:e?e.getAvatarUrl():null,name:e?e.get("name"):null,url:e?e.get("url"):null}},_setBubbleStyles:function(){var e=this.get("fullWidthBubblePercentThreshold"),t=this.js$("message-bubble"),i=this.$el.width(),n=t.widtss"))}});e.exports=u},function(e,t,i){"use strict";e.exports={html:i(721)}},function(e,t,i){"use strict";var n=i(3),s=i(722),o=i(723),r=s.extend({name:"html",formatters:{link:o},escape:function(e){return n.escape(e)},applyFormatting:function(e,t){var i=n.bind(this.escape,this),s=n.bind(this.getFormatter,this),o={};n.forEach(t,function(e){var t=s(e.type);if(t){var i=e.position,r=e.attributes,a=i[0],l=i[1];n.isEmpty(o[a])&&(o[a]=[]),n.isEmpty(o[l])&&(o[l]=[]),o[a].push(n.bind(t.open,this,r)),o[l].unshift(n.bind(t.close,this,r))}},this);var r,a,l=n.sortBy(n.keys(o),function(e){return n.parseInt(e)}),c="",u=0;return n.forEach(l,function(t){r=o[t],a=e.substr(u,t-u),c+=i(a),n.forEach(r,function(e){c+=e()}),u=t},this),a=e.substr(u),c+=i(a)}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(215),o=s.extend({name:"unknown",formatters:{},constructor:function(e){this.options=e||{},n.isFunction(this.formatters)?this.formatters=this.fthis.formattermatters[e]=t},getFormatter:function(e){retur:function(e){return e},applyFormatting:f e},render:function(e,t){return this.postFilter(this.applyFormatting(e,t))}});e.exports=o},function(e,t,i){"use strict";function n(e){return s(e).omit(s.isUndefined).reduce(function(e,t,i){return(e?e+" ":"")+o('%s="%s"',s.escape(i),s.escape(t))},"")}var s=i(3),o=i(6).sprintf,r={open:function(e){var t=n({"data-js-tumblelog-name":e.blog_name,"data-js-post-id":e.post_id,"data-js-messaging-tumblelog-name":e.messaging_blog_name,target:"_blank",href:e.url});return"<a "+t+">"},close:function(e){return"</a>"}};e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a class="avatar" href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"> ',__p+=canPixelateAvatar?' <canvas class="pixelated-avatar needs-drawing hide" data-image-url="'+__e(avatarUrl)+'" alt="'+__e(name)+'"></canvas> ':' <img src="'+__e(avatarUrl)+'"> ',__p+=' </a><div class="message-bubble" data-js-message-bubble><div class="message-bubble-header"><a href="'+__e(url)+'" class="name" target="_blank" data-js-tumblelog-name="'+__e(name)+'">'+__e(name)+'</a><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+'</button></div><div class="message">'+(null==(__t=message)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(685),a=i(726),l=s.extend({className:"conversation-message-post",mixins:[o],template:a,defaults:{thumbnailWidth:210},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","participants","model","setRetryButtonState"))},afterRenderSubviews:function(){this.listenTo(this.model,"change:isError change:isPending",this._onModelChange),this.listenTo(this.model.get("post"),"change:summary change:state",this._onModelChange),this._startTruncateSummary()},getThumbnailAtWidth:function(e){var t,i=this.model.get("post"),s=i.getThumbnail(e);return n.isEmpty(s)?null:(t=i.getScaledDimensionsForWidth(s,e),n.extend({},s,t))},getTemplateData:function(){var e=this.model.get("post"),t=this.participants.get(this.model.get("participant")),i=this.getThumbnailAtWidth(this.get("thumbnailWidth"));return{postType:e.getType(),isDisabled:e.isDisabled(),isError:this.model.get("isError"),isPending:this.model.get("isPending"),actionString:t?e.getActionMarkup(t.get("name")):null,message:e.getMessage(),thumbnail:i,avatarUrl:t?t.getAvatarUrl():null,name:t?t.get("name"):null,blogUrl:t?t.get("url"):null,url:e.get("post_url"),postBlogName:e.get("blog_name"),postId:e.get("id")}},_startTruncateSummary:function(){n.defer(n.bind(this._truncateSummary,this))},_truncateSummary:function(){r(this.js$("summary",!0))},_onModelChange:function(){this.renderWithTemplate(),this._startTruncateSummary(),n.isFunction(this.setRetryButtonState)&&this.setRetryButtonState()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container conversation-message-post--'+__e(postType)+" "+__e(_.isEmpty(thumbnail)?"no-thumbnail":"has-thumbnail")+__e(isDisabled?" is-disabled":"")+'"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div> ',isDisabled?__p+=' <div class="message-bubble" data-js-message-bubble><div class="message-bubble-header">'+__e(actionString)+"</div></div> ":(__p+=' <div class="message-bubble" data-js-message-bubble> ',_.isEmpty(url)||(__p+=' <a href="'+__e(url)+'" data-js-tumblelog-name="'+__e(postBlogName)+'" data-js-post-id="'+__e(postId)+'"> '),__p+=' <div class="message-bubble-header" data-js-summary><span class="name">'+__e(actionString)+"</span> ",_.isEmpty(message)||(__p+=' <span class="text">'+__e(message)+"</span> "),__p+=" </div> ",_.isEmpty(url)||(__p+=" </a> "),__p+=' <button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button></div> ",_.isEmpty(url)||(__p+=' <a href="'+__e(url)+'" data-js-tumblelog-name="'+__e(postBlogName)+'" data-js-post-id="'+__e(postId)+'" class="icon"></a> '),__p+=" "),__p+=" </div> ",_.isEmpty(thumbnail)||(__p+=' <div class="thumbnail"> ',_.isEmpty(url)||(__p+=' <a href="'+__e(url)+'" data-js-tumblelog-name="'+__e(postBlogName)+'" data-js-post-id="'+__e(postId)+'"> '),__p+=' <img class="full-width" src="'+__e(_.get(thumbnail,"url"))+'" width="'+__e(_.get(thumbnail,"width"))+'" height="'+__e(_.get(thumbnail,"height"))+'"> ',_.isEmpty(url)||(__p+=" </a> "),__p+=" </div> ");return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(725),o=i(728),r=i(729),a=i(136),l=i(8),c=s.extend({className:"conversation-message-safemode-post",template:r,events:{"click .link-safemode-settings":"_onlinkClick"},initialize:function(e){n.extend(this,n.pick(e,"conversation","canModifySafeMode")),s.prototype.initialize.apply(this,arguments)},getTemplateData:function(){var e=this.model.get("post"),t=this.participants.get(this.model.get("participant")),i=this.getThumbnailAtWidth(this.get("thumbnailWidth"));return{postType:e.getType(),isDisabled:e.isDisabled(),actionString:t?e.getActionMarkup(t.get("name")):null,thumbnail:i,avatarUrl:t?t.getAvatarUrl():null,name:t?t.get("name"):null,blogUrl:t?t.get("url"):null,canModifySafeMode:this.canModifySafeMode?this.canModifySafeMode:null,isProjectXEnabled:this.isProjectXEnabled?this.isProjectXEnabled:null}},afterRenderSubviews:function(){this.theme=new o({el:this.el,theme:this.conversation.getOtherParticipant().get("theme")}).render()},_onlinkClick:function(e){e.preventDefault();var t={source:"messaging_post"};a.trigger("Kraken:safeMode:FilteringSettingLinkClicked",{loggingData:t}),window.open(l(e.currentTarget).attr("href"))}});e.exports=c},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(277),r=i(230),a=i(180),l=s.extend({mixins:[o,r],defaults:{removeDataAttrAfterApplyingTheme:!0},configuration:{"theme-background-color":{themeField:"background_color",applyStyle:"background-color"},"theme-accent-color":{themeField:"link_color",applyStyle:"color"},"theme-accent-color-on-white":{themeField:"link_color",unsetMissingStyle:"color",applyStyle:function(e,t,i){e.css("color",i.adjustColorForBackground(t,"#ffffff"))}},"theme-accent-color-on-grey":{themeField:"link_color",unsetMissingStyle:"color",applyStyle:function(e,t,i){e.css("color",i.adjustColorForBackground(t,"#f2f2f2"))}},"theme-accent-color-on-background":{themeField:"link_color",unsetMissingStyle:"color",applyStyle:function(e,t,i){e.css("color",i.getReadableColor(t,i.get("background_color")))}},"theme-accent-color-as-background":{themeField:"link_color",unsetMissingStyle:"background-color",applyStyle:function(e,t,i){e.css("background-color",i.adjustColorForBackground(t,"#ffffff"))}},"theme-button":{themeField:function(e){var t=e.get("background_color"),i=e.get("link_color");return n.isEmpty(t)||n.isEmpty(i)?null:{text:t,background:e.getReadableColor(i,t)}},applyStyle:function(e,t,i){e.addClass("themed"),i.getHeaderImage()||e.css({"background-color":t.background,"border-color":t.background,color:t.text})}},"theme-erImage()},applyStyle:function(e,t){eint":{themegroundTint())},applyStyle:function(e,t,i){e.addClass("theme-background"+t)}},"theme-background-color-or-image-class":{themeField:"background_color",applyStyle:function(e,t,i){n.isEmpty(i.getHeaderImage())?e.css("background-color",t):e.addClass("haseld:"avatar_shape",applyStyle:function(e,t){e.addClass("avatar-shape--"+t)}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"theme"))},render:function(){this.theme&&!a.bool("aim_messenger")&&n.each(this.configuration,function(e,t){var i,s,o=e.unsetMissingStyle,r=e.applyStyle;if(i=n.isFunction(e.themeField)?e.themeField.call(this,this.theme):this.theme.get(e.themeField),s=this.js$(t),0!==s.length){if(n.isEmpty(i))return void(n.isFunction(o)?o.call(this,s,i,this.theme):n.isEmpty(o)?n.isFunction(r)||s.css(r,""):s.css(o,""));n.isFunction(r)?r.call(this,s,i,this.theme):s.css(r,i),this.get("removta-js-"+t)}},this)},setTheme:function(e){return this.theme=e,this.render()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container conversation-message-post--'+__e(postType)+" "+__e(_.isEmpty(thumbnail)?"no-thumbnail":"has-thumbnail")+__e(isDisabled?" is-disabled":"")+'"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div> ',isDisabled?__p+=' <div class="message-bubble" data-js-message-bubble><div class="message-bubble-header">'+__e(actionString)+"</div></div> ":(__p+=' <div class="message-bubble" data-js-message-bubble><div class="message-bubble-header" data-js-summary><span class="name">'+__e(actionString)+'</span></div><div class="post-content-inner"><p> ',isProjectXEnabled?__p+=' <span class="message">'+__e(__("This post may contain sensitive content."))+"</span><br> "+(null==(__t=__("%1$sLearn more%2$s",'<a class="link link-safemode-settings" href="/docs/nsfw" target="_blank" data-js-theme-accent-color>',"</a>"))?"":__t)+" ":(__p+=' <span class="message">'+__e(__("This post may contain sensitive media."))+"</span><br> ",__p+=canModifySafeMode?" "+(null==(__t=__("%1$sSafe Mode is on%2$s",'<a class="link link-safemode-settings" href="/settings/account#safe_mode" target="_blank" data-js-theme-accent-color>',"</a>"))?"":__t)+" ":" "+(null==(__t=__("%1$sWhy am I seeing this?%2$s",'<a class="link link-safemode-settings" href="/docs/nsfw" target="_blank" data-js-theme-accent-color>',"</a>"))?"":__t)+" ",__p+=" "),__p+=' </p></div><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button></div> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(277),a=i(262),l=i(331),c=i(731),u=o.extend({className:"conversation-message-image",mixins:[r],template:c,defaults:{thumbnailWidth:195,isBlurred:!1,blurClassName:"is-blur",unblurringClassName:"is-unblurring",errorClassName:"is-error",pendingClassName:"is-pending",blurAnimationDurationMs:300,blurMessageString:null},events:{"click [data-js-overlay-container]":"_onOverlayContainerClick"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","participants","conversation","model","setRetryButtonState","afterImageUnblur")),this.set("blurMessageString",s("Blurred because you don't follow this Tumblr yet. Click to reveal.")),this.image=this.model.getImage()},afterRenderSubviews:function(){this.listenTo(this,"change:isBlurred",this._onChangeIsBlurred),this.listenTo(this.model,"change:isPending",this._onModelIsPendingChange),this.listenTo(this.model,"change:isError",this._onModelIsErrorChange),this.listenTo(this.conversation,"change:is_blurred_images",this._onChangeConversationIsBlurredImages),this.listenTo(this.image.getAltSizes(),"update reset",this._onModelImagesUpdate),this._onChangeConversationIsBlurredImages(this.conversation,this.conversation.get("is_blurred_images")),this._onChangeIsBlurred(this,this.get("isBlurred"))},getTemplateData:function(){var e=this.image.getImageAtSize(this.get("thumbnailWidth")),t=this.getThumbnailDimensions(e),i=n.get(t,"width"),s=n.get(t,"height"),o=this.participants.get(this.model.get("participant"));return this.thumbnailUrl=this.thumbnailUrl||e.get("url"),{name:o?o.get("name"):null,avatarUrl:o?o.getAvatarUrl():null,blogUrl:o?o.get("url"):null,highResUrl:this.image.hasAltSizes()?this.image.getHighResImageUrl():null,lowResUrl:this.thumbnailUrl,thumbnailImageUrl:this.thumbnailUrl,originalWidth:this.image.getOriginalSize().get("width"),originalHeight:this.image.getOriginalSize().get("height"),thumbnailWidth:i,thumbnailHeight:s}},getThumbnailDimensions:function(e){var t=this.get("thumbnailWidth"),i=a.heightForWidth(t,e.get("width"),e.get("height"));return n.extend({},{width:t,height:i})},_onModelIsPendingChange:function(e,t){t?(this.imageLoaderView=new l({variation:"small centered",loading:t}),this.js$("image-loader-container").append(this.imageLoaderView.render().$el)):this._removeImageLoader(),this.$el.toggleClass(this.get("pendingClassName"),t)},_onModelIsErrorChange:function(e,t){this.$el.toggleClass(this.get("errorClassName"),t)},_removeImageLoader:function(){this.imageLoaderView&&this.imageLoaderView.remove()},_onModelImagesUpdate:function(){this.renderWithTemplate(),this._toggleBlurred(this.get("isBlurred")),n.isFunction(this.setRetryButtonState)&&this.setRetryButtonState()},_toggleBlurred:function(e){var t=this.get("unblurringClassName"),i=this.js$("overlay-text",!0),s=!e&&this.previous("isBlurred"),o=this.get("blurClassName");this.$el.toggleClass(o,e).toggleClass(t,s),e?i.text(this.get("blurMessageString")):s||i.empty(),this._unblurTimer&&clearTimeout(this._unblurTimer),s&&(this._unblurTimer=n.delay(n.bind(function(){this.rendered&&(i.empty(),this.$el.removeClass(t),delete this._unblurTimer)},this),this.get("blurAnimationDurationMs")))},_onChangeIsBlurred:function(e,t){this._toggleBlurred(t)},_onChangeConversationIsBlurredImages:function(e,t){this.set("isBlurred",t&&e.shouldBlurImageMessage(this.model))},_onOverlayContainerClick:function(e){this.get("isBlurred")&&(e.preventDefault(),e.stopImmediatePropagation(),this.set("isBlurred",!1),n.isFunction(this.afterImageUnblur)&&this.afterImageUnblur(this.model))}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container has-thumbnail"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div><div class="message-bubble" data-js-message-bubble><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button> ",_.isEmpty(highResUrl)||_.isEmpty(lowResUrl)||(__p+=' <a href="'+__e(highResUrl)+'" data-js-lightbox-url="'+__e(highResUrl)+'" data-js-lightbox-width="'+__e(originalWidth)+'" data-js-lightbox-height="'+__e(originalHeight)+'" data-js-lightbox-lowres-url="'+__e(lowResUrl)+'"> '),__p+=' <div class="thumbnail" data-js-thumbnail><div class="conversation-image-loader" data-js-image-loader-container></div><img class="full-width" data-js-message-image src="'+__e(thumbnailImageUrl)+'" width="'+__e(thumbnailWidth)+'" height="'+__e(thumbnailHeight)+'"><div class="overlay" data-js-overlay-container data-js-tumblelog-name="'+__e(name)+'"><p class="text" data-js-overlay-text></p></div></div> ',_.isEmpty(highResUrl)||_.isEmpty(lowResUrl)||(__p+=" </a> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(733),r=s.extend({className:"conversation-message-timestamp",template:o,initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,nus"))},getTemplateData:function(){return{label:this.model.get("tsHeader")}}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-js-label class="inline-activity timestamp">'+__e(label)+"</div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(735),a=s.extend({className:"conversation-message-sticker message-container",mixins:[o],template:r,defaults:{thumbnailWidth:210,rawWidth:1280,errorClassName:"is-error"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","participants","conversation"))},afterRenderSubviews:function(){this.listenTo(this.model,"change:isError",this._onModelIsErrorChange)},getTemplateData:function(){var e=this.model.toJSON(),t=e.sticker.original_size_url,i=e.sticker.url,n=this.participants.get(this.model.get("participant"));return{name:n?n.get("name"):null,avatarUrl:n?n.getAvatarUrl():null,blogUrl:n?n.get("url"):null,rawUrl:t?t:null,url:i?i:null,thumbnailWidth:this.get("thumbnailWidth"),rawWidth:this.get("rawWidth")}},_onModelIsErrorChange:function(e){this.$el.toggleClass(this.get("errorClassName"),e)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container has-thumbnail"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div><div class="message-bubble" data-js-message-bubble><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button> ",_.isEmpty(rawUrl)||(__p+=' <a href="'+__e(rawUrl)+'" data-js-lightbox-url="'+__e(rawUrl)+'" data-js-lightbox-width="'+__e(rawWidth)+'" data-js-lightbox-height="'+__e(rawWidth)+'" data-js-lightbox-lowres-url="'+__e(url)+'"> '),__p+=' <div class="thumbnail" data-js-thumbnail><img class="full-width" data-js-message-image src="'+__e(url)+'" width="'+__e(thumbnailWidth)+'"></div> ',_.isEmpty(rawUrl)||(__p+=" </a> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(277),a=i(737),l=o.extend({className:"conversation-pill hide-pill",template:a,mixins:[r],events:{"click [data-js-unread-button]":"_onClick"},defaults:{count:0,maxCount:99},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus"))},afterRender:function(){this.listenTo(this,"change:count",this._onChangeCount),this._onChangeCount(this,this.get("count"))},setCount:function(e){this.set("count",n.isFinite(e)?e:0)},getCount:function(){return this.get("count")},getTitle:function(e){var t,i;return n.isFinite(e)?(t=this.get("maxCount"),i=e>t?t+"+":e,e>1?s(,getTemplateData:function(){return{title:this.getTitle(this.get("count"))}},_onChangeCount:function(e,t){var i=this.getTitle(t);this.$el.toggleClass("hide-pill",0===t||n.isEmpty(i)),t>0&&this.js$("unread-button").text(i)},_onClick:function(e){e.preventDefault(),this.trigger("click")}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<button tabindex="-1" data-js-theme-button data-js-unread-button class="unread-button">'+__e(title)+"</button>";
return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="conversation-pagination-loader" data-js-loader-container><div data-subview="paginationLoaderView"></div></div><div data-js-header></div><div data-subview="messagesView[]" class="message-list"></div><div data-subview="statusBannerView"></div><div data-subview="pillView"></div><div data-js-footer></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(180),o=i(226),r=i(686),a=i(740),l=i(741),c=o.extend({template:a,className:"chat-status-banner",subviews:{statusIndicator:{constructor:r,options:function(e){return{isOnline:e.get("seconds_since_last_activity")!==-1,canSeeUIFlag:s.bool("status_indicator"),name:e.get("name")}}}},initialize:function(e){this.set("name",n.get(e,"name","")),this.listenTo(this,"setActiven(){return this.get("lastOnlineString")?o.prototype.render.call(this):this}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<span class="status-text"><div data-subview="statusIndicator"></div>'+__e(lastOnlineString)+"</span>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";function n(e){return!(e===-1||e>o)&&(e>=r?s("Active in the last 4 hours"):e>=a?s("Active in the last 3 hours"):e>=l?s("Active in the last 2 hours"):e>=0&&s("Active in the last hour"))}var s=i(130),o=14400,r=10800,a=7200,l=3600;e.exports=n},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(743),r=s.extend({className:"conversation-message-error",template:o,defaults:{message:null,showErrorIconClass:"show-icon",showErrorIcon:!1,actionText:null},events:{"click [data-js-action]":"_onClickAction"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","actionCallback"))},getTemplateData:function(){return{message:this.get("message"),actionText:this.get("actionText")}},afterRender:function(){this.$el.toggleClass(this.get("showErrorIconClass"),this.get("showErrorIcon"))},_onClickAction:function(e){e.preventDefault(),n.isFunction(this.actionCallback)&&this.actionCallback()}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message"> '+__e(message)+" ",_.isEmpty(actionText)||(__p+=' <span class="action-container"><a href="#" data-js-action class="action">'+__e(actionText)+"</a></span> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(226),r=i(277),a=i(262),l=i(745),c=i(235),u=i(746),h=o.extend({className:"conversation-preview",template:l,mixins:[r],events:{"click [data-js-image-container]":"_onImageContainerClick","click [data-js-preview-remove]":"_onClickPreviewRemove"},defaults:{isVisible:!1,isEditable:!1,maxHeight:150,maxWidth:210,animateInDurationMs:300,animateOutDurationMs:200,animateInEasing:[.22,.685,.03,.895],animateOutEasing:[.895,.03,.685,.22]},afterRender:function(){this.listenTo(this,"change:isVisible",this._onChangeIsVisible),this.listenTo(this,"change:isEditable",this._onChangeIsEditable),this._onChangeIsVisible(this,this.get("isEditable"))},hasImage:function(){return!s.isEmpty(this.previewImageModel)},addImage:function(e){var t=e.get("height"),i=e.get("width"),n=this.get("maxHeight"),o=this.get("maxWidth"),r=a.maxSize(i,t,o,n),l=this.js$("image-container");return this.previewImageView&&this.previewImageView.remove(),this.previewImageView=new u({src:e.get("url"),width:s.get(r,"width"),height:s.get(r,"height")}),l.append(this.previewImageView.render().$el),this.set("isVisible",!0),this.set("isEditable",s.isFunction(e.get("editCallback"))),this.previewImageModel=e,this._slideElement(l)},_slideElement:function(e,t){var i=new n.Deferred,o=e.height(),r=e.offset().top-this.$el.offset().top,a=o+r;return c.animate(e,{translateY:t?[a,0]:[0,a]},{duration:t?this.get("animateOutDurationMs"):this.get("animateInDurationMs"),easingateInEasing"),complete:s.bind(function(){i.resolve(),e.css("transform","")},this)}),i},getMessage:function(){return s.isEmpty(this.previewImageModel)?null:this.previewImageModel.get("message")},close:function(){return this.trigger("closing",this.previewImageModel),this._slideElement(this.js$("image-container"),!0).then(s.bind(this._onAfterCloseAnimation,this))},_onAfterCloseAnimation:function(){var e=this.previewImageModel;this.previewImageView.remove(),delete this.previewImageModel,delete this.previewImageView,this.set("isVisible",!1),this.trigger("close",e)},_onImageContainerClick:function(e){var t,i=this.previewImageModel;this.get("isEditable")&&!s.isEmpty(i)&&(t=i.get("editCallback"),s.isFunction(t)&&(e.preventDefault(),t(e),this.trigger("edit",i)))},_onClickPreviewRemove:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("dismiss",this.previewImageModel),this.close()},_onChangeIsVisible:function(e,t){this.$el.toggle(t)},_onChangeIsEditable:function(e,t){this.$el.toggleClass("editable",t)}});e.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="conversation-preview-image-container" data-js-image-container><a href="#" class="conversation-preview-remove" data-js-preview-remove>'+__e(__("Remove"))+"</a></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(747),r=s.extend({className:"conversation-preview-image",template:o,defaults:{width:null,height:null,src:null,context:null,loggingData:null},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults)))}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<img src="'+__e(src)+'" width="'+__e(width)+'" height="'+__e(height)+'" alt="'+__e(__("GIF"))+'">';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(235),o=i(130),r=i(277),a=i(232),l=i(226),c=i(749),u=i(706),h=i(750),d=l.extend({className:"conversation-compose",template:h,mixins:[r,a],events:{"click [data-js-submit-button]":"_onSubmitButtonClick","input [data-js-text-input]":"_onTextInputChange","keydown [data-js-text-input]":"_onTextInputKeydown","focus [data-js-text-input]":"_onTextInputFocus","blur [data-js-text-input]":"_onTextInputBlur","paste [data-js-text-input]":"_onTextInputPaste"},keycommands:{"keydown:escape":"_onKeyPressEscape"},defaults:{isValid:!0,isDisabled:!1,isOffline:!1,placeholder:null,offlinePlaceholder:null,currentPlaceholder:null,currentText:null,hasEditorFocus:!1,isAutoValidationEnabled:!0,buttonSubmittedClass:"submitted",hideComposePluginsClass:"hide-compose-plugins-container",hidingComposePluginsClass:"hiding-compose-plugins-container",isShufflePlaceholder:!0,isPluginsVisible:!0,composeAnimationSpeed:200,pluginAnimateInDurationMs:200,pluginAnimateOutDurationMs:300,pluginAnimateInEasing:[.895,.03,.685,.22],pluginAnimateOutEasing:[.22,.685,.03,.895],isLightboxOpen:!1},subviews:{composePluginsView:{constructor:c,options:function(e){return{pluginsArray:e.pluginsArray}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","keyboardManager","keyboardNamespace","pluginsArray","isGifSearchEnabled","isSendAPost")),this.getRandomPlaceholder=u([o("New message"),o("Your message here"),o("Write a message"),o("Say something"),o("Say your thing")]),n.isEmpty(this.pluginsArray)&&this.hideComposePluginsView(!0),this.set("isShufflePlaceholder",n.isEmpty(this.get("placeholder"))),n.isEmpty(this.get("placeholder"))&&this.set("placeholder",this.getRandomPlaceholder()),this.set("currentPlaceholder",this.get("placeholder")),n.isEmpty(this.get("offlinePlaceholder"))&&this.set("offlinePlaceholder",o("Currently offline")),this.keyboardManager&&this.disableKeys()},afterRenderSubviews:function(){this.listenTo(this,"change:isValid",this._onChangeIsValid),this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),this.listenTo(this,"change:isOffline",this._onChangeIsOffline),this.listenTo(this,"change:currentPlaceholder",this._onChangeCurrentPlaceholder),this.listenTo(this,"change:currentText",this._onChangeCurrentText),this.listenTo(this,"change:hasEditorFocus",this._onChangeHasEditorFocus),this.listenTo(this,"change:isAutoValidationEnabled",this._onChangeIsAutoValidationEnabled),this.listenTo(this.composePluginsView,"plugin:preview:add:image",this._onComposePluginPreviewAddImage),this.listenTo(this.composePluginsView,"plugin:click",this._onComposePluginClick),this._onChangeIsValid(this,this.get("isValid")),this._onChangeIsDisabled(this,this.get("isDisabled")),this._onChangeIsOffline(this,this.get("isOffline")),this._onChangeCurrentPlaceholder(this,this.get("currentPlaceholder")),this._onChangeCurrentText(this,this.get("currentText")),this._setValidState(),n.defer(n.bind(function(){this._resizeInput()},this))},getTemplateData:function(){return{placeholder:this.get("placeholder"),isSendAPost:this.isSendAPost}},hideComposePluginsView:function(e){var t,i=this.get("hideComposePluginsClass"),o=this.get("hidingComposePluginsClass");if(this.get("isPluginsVisible")){if(this.set("isPluginsVisible",!1),e)return void this.$el.addClass(i);this.$el.addClass(o),this._resizeInput(),t=this.composePluginsView.$el.outerWidth(),s.animate(this.$el,{marginLeft:[-t,0]},{duration:this.get("pluginAnimateOutDurationMs"),easing:this.get("pluginAnimateOutEasing"),complete:n.bind(function(){this._resizeInput(),this.$el.css("marginLeft","").addClass(i).removeClass(o)},this)})}},showComposePluginsView:function(e){var t,i=this.get("hideComposePluginsClass");if(!this.get("isPluginsVisible")){if(this.set("isPluginsVisible",!0),e)return void this.$el.removeClass(i);t=this.composePluginsView.$el.outerWidth(),this.$el.css("margin-left",-t).removeClass(i),this._resizeInput(),s.animate(this.$el,{marginLeft:[0,-t]},{duration:this.get("pluginAnimplete:n.bind(function(){this._resizeInput(),this.$el.css("marginLeft","")},this)})}},toggle:function(e){this.$el.toggle(e),e&&this.$el.css("display","")},submit:function(e){var t=this.get("currentText");this.get("isValid")&&!thisthis._startAnimation(n.bind(function(){this.trigger("submit:animated",t,e)},this)),this.clear())},escape:function(){this.get("isLightboxOpen")||(n.isEmpty(this.get("currentText"))?this.trigger("close"):this.clear())},clear:function(){this.js$("text-input").val(""),this.set("currentText",""),this.get("isShufflePlaceholder")&&this._setPlaceholderState(),this._resizeInput()},focus:function(){n.defer(n.bind(function(){this.rendered&&this.js$("text-input").focus()},this))},getMessage:function(){return this.js$("text-input").val()},setPlaceholder:function(e){this.set({placeh{this.keyboardManager&&this.keyboardManager.remove(this.keyboardNamespace)},toggleAutoValidation:function(e){this.set("isAutoValidationEnabled",e)},_onComposePluginPreviewAddImage:function(e){this.trigger("plugin:preview:add:image",e)},_onComposePluginClick:function(e){this.trigger("plugin:click",e)},_onKeyPressEscape:function(e){e.preventDefault(),this.escape()},_onTextInputChange:function(){var e=n.trim(this.js$("text-input").val());this._resizeInput(),this.set("currentText",e),this.trigger("input",e,this)},_setValidState:function(){return this.get("isAutoValidationEnabled")?void this.set("isValid",!n.isEmpty(this.get("currentText"))):void this.set("isValid",!0)},_resizeInput:function(){var e,t=this.js$("text-input"),i=t.get(0);this._originalInputHeight||(this._originalInputHeight=t.outerHeight()),this.$el.css("height",this.$el.height()),t.css("height","auto"),e=i.scrollHeight,Math.abs(e-this._originalInputHeight)<5&&(e=this._originalInputHeight),t.css("height",e),this.$el.css("height",""),this._detectResize()},_detectResize:function(){var e=this.$el.height();return this._previousHeight?void(e!==this._previousHeight&&(this.trigger("resize",e),this._previousHeight=e)):void(this._previousHeight=e)},_startAnimation:function(e){var t=this.js$("submit-button"),i=this.get("buttonSubmittedClass");return n.isEmpty(i)?void(n.isFunction(e)&&e.call(this)):(t.addClass(i),void n.delay(n.bind(function(){t.removeClass(i),n.isFunction(e)&&e.call(this)},this),this.get("composeAnimationSpeed")))},_setPlaceholderState:function(){this.set("currentPlaceholder",this.get("isShufflePlaceholder")?this.getRandomPlaceholder():this.get("placeholder"))},_onChangeCurrentText:function(e,t){this._setValidState()},_onChangeIsValid:function(e,t){this.js$("submit-button").prop("disabled",!t||this.get("isDisabled"))},_onSubmitButtonClick:function(e){e.preventDefault(),this.submit("button")},_onChangeIsDisabled:function(e,t){this.js$("text-input").prop("disabled",t),this.js$("submit-button").prop("disabled",t||!this.get("isValid")),this.composePluginsView.toggleDisabled(t)},_onChangeIsOffline:function(e,t){t?(this.set("previousPlaceholder",this.get("placeholder")),this.set("currentPlaceholder",this.get("offlinePlaceholder"))):this.set("currenrentPlaceholder:function(e,t){this.js$("text-input").attr("placeholder",t)},_onTextInputFocus:function(){this.set("hasEditorFocus",!0),this.trigger("focus",this)},_onTextInputBlur:function(){this.set("hasEditorFocus",!1),this.trigger("blur",this)},_onTextInputPaste:function(e){var t,i,s=n.get(e,"originalEvent.clipboardData.items",[]),o=n.filter(s,{kind:"file"});this.get("isDisabled")||0!==o.length&&(t=n.last(o),t&&(i=n.result(t,"getAsFile"),this.trigger("pasteBlob",i)))},_onTextInputKeydown:function(e){13!==e.keyCode||e.shifs.keyboardManager&&this.keyboardManager.toggle(this.keyboardNamespace,e,t)},_onChangeIsAutoValidationEnabled:function(e,t){this._setValidState()}});e.exports=d},function(e,t,i){"use strict";var n=i(3),s=i(226),o=s.extend({className:"conversation-compose-plugins-container",mixins:[],renderWithTemplate:n.noop,defaults:{isDisabled:!1},initialize:function(e){e=n.extend({},e),n.extend(this,n.pick(e,"pluginsArray"))},afterRender:function(){this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),n.each(this.pluginsArray,n.bind(this._addPluginView,this)),this._onChangeIsDisabled(this,this.get("isDisabled"))},toggleDisabled:function(e){this.set("isDisabled",e)},_addPluginView:function(e){e.render(),this.$el.append(e.el),this.listenTo(e,"preview:add:image",this._onPluginViewPreviewAddImage),this.listenTo(e,"click",this._onPluginViewClick)},_onPluginViewPreviewAddImage:function(e){this.trigger("plugin:preview:add:image",e)},_onPluginViewClick:function(e){this.trigger("plugin:cction(e,t){n.each(this.pluginsArray,n.bind(function(e){e.toggleDisabled(t)}),this)}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+=isSendAPost?' <div data-subview="composePluginsView" class="compose-plugins-container"></div><div class="compose-text-input-container"><div class="text-input-container"><textarea class="text-input" placeholder="'+__e(placeholder)+'" rows="1" maxlength="4096" data-js-text-input></textarea></div><div class="submit-button"><button type="submit" data-js-submit-button data-js-theme-accent-color-on-white class="submit">'+__e(__("Send"))+"</button></div></div> ":' <div class="text-input-container"><textarea class="text-input" placeholder="'+__e(placeholder)+'" rows="1" maxlength="4096" data-js-text-input></textarea></div><div class="compose-text-input-container"><div data-subview="composePluginsView" class="compose-plugins-container"></div><div class="submit-button"><button type="submit" data-js-submit-button data-js-theme-accent-color-on-white class="submit">'+__e(__("Send"))+"</button></div></div> ";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(180),o=i(226),r=i(277),a=i(686),l=i(752),c=o.extend({className:"conversation-minimized",tagName:"a",attributes:{href:"#"},template:l,mixins:[r],events:{click:"_onClick"},defaults:{maxBadgeCount:99,activeBadgeClass:"tab-notice--active",newMessageClass:"new-message"},subviews:{statusIndicator:{constructor:a,options:function(e){return{isOnline:e.get("isOnline"),canSeeUIFlag:s.bool("status_indicator"),name:e.participant.get("name")}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus")),this.participant=this.model.getOtherParticipant(),this.set({blogName:this.participant?this.participant.get("name"):null,avatarUrl:this.participant?this.participant.getAvata")})},setIsOnline:function(e){this.set("isOnline",e),this.renderSubviews()},afterRenderSubviews:function(){this.listenTo(this.model,"change:unreadCount",this._onChangeUnreadCount),this.listenTo(this.model,"sync",this._onConversationSync),this.listenTo(this,"setIsOnline",this.setIsOnline),this.listenTo(this.participant,"change:seconds_since_last_activity",function(e,t){this.setIsOnline(t!==-1)})},updateBadge:function(e){var t=this.get("maxBadgeCount"),i=this.get("activeBadgeClass");e>0&&this.js$("badge-value").text(e>t?t+"+":e),this.js$("badge").toggleClass(i,e>0)},animate:functs");this.$el.addClass(e),n.delay(n.bind(function(){this.$el.removeClass(e)},this),250)},focus:function(){this.$el.focus()},blur:function(){this.$el.blur()},_onChangeUnreadCount:function(e,t){this.updateBadge(t),t>0&&this.animate()},_onConversatio,_onClick:function(e){e.preventDefault(),this.blur(),this.trigger("click")}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="avatar"><img src="'+__e(avatarUrl)+'" title="'+__e(blogName)+'"></div><div data-subview="statusIndicator"></div><div class="conversation-minimized-badge tab_notice tab-notice--outlined '+__e(statusIndicatorUiFlag?"status-indicator-active":"")+'" data-js-badge><span class="tab_notice_value" data-js-badge-value>2</span></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(277),a=i(754),l=o.extend({className:"conversation-error",mixins:[r],template:a,defaults:{message:null,isLoading:!1,showButton:!0,buttonText:null,buttonTextLoading:null,buttonTextCurrent:null},events:{"click [data-js-button]":"_onClickButton"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","buttonCallback")),n.isEmpty(this.get("message"))&&this.set("message",s("Something went screwy.")),n.isEmpty(this.get("buttonText"))&&this.set("buttonText",s("Retry")),n.isEmpty(this.get("buttonTextLoading"))&&this.set("buttonTextLoading",s("Retrying...")),n.isEmpty(this.get("buttonTextCurrent"))&&this.set("buttonTextCurrent",this.get("buttonText"))},afterRender:function(){this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this,"change:buttonTextCurrent",this._onChangeButtonTextCurrent),this.listenTo(this,"change:showButton",this._onChangeShowButton),this._onChangeIsLoading(this,this.get("isLoading")),this._onChangeShowButton(this,this.get("showButton"))},getTemplateData:function(){return{message:this.get("message"),buttonText:this.get("buttonTextCurrent")}},_onClickButton:function(e){e.preventDefault(),this.get("isLoading")||(this.set("isLoading",!0),this.trigger("buttonClick"),n.isFunction(this.buttonCallback)&&this.buttonCallback.call(this,this))},_onChangeIsLoading:function(e,t){var i=t?this.get("buttonTextLoading"):this.get("buttonText");this.set("buttonTextCurrent",i),this.js$("button").toggleClass("disabled",t).prop("disabled",t)},_onChangeButtonTextCurrent:function(e,t){this.js$("button").text(t)},_onChangeShowButton:function(e,t){this.js$("button").toggle(t)}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="content"><label>'+__e(message)+'</label><button data-js-theme-button data-js-button class="chrome">'+__e(buttonText)+"</button></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(283),a=i(756),l=o.extend({className:"popover--conversation-actions info_popover popover_gradient popover",mixins:[r],initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"viewOptions")),this.view=new a(this.viewOptions)},render:function(){return this.$wrapper=s("<div />").addClass("popover-inner popover_inner").appendTo(this.$el),this.$wrapper.html(this.view.render().$el),this},teardown:function(){return this.remove()},getView:function(){return this.view}});e.exports=l},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(757),a=o.extend({className:"conversation-actions",tagName:"ul",template:r,events:{"click [data-js-block-blogname]":"_onBlockClick","click [data-js-delete-conversation]":"_onDeleteConversationClick"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","user","participants")),this.blockableParticipants=this.participants.getWithout(this.user.channels.pluck("uuid"))},getTemplateData:function(){return{blockableParticipants:n.invoke(this.blockableParticipants,"toJSON")}},_onBlockClick:function(e){var t=s(e.currentTarget),i=t.attr("data-js-block-blogname");e.preventeteConversationClick:function(e){e.preventDefault(),this.trigger("delete")}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<li><a class="external-link" href="/settings/dashboard">'+__e(__("Sound settings"))+'</a></li><li><a href="#" data-js-delete-conversation>'+__e(__("Delete conversation"))+"</a></li> ",_.each(blockableParticipants,function(e){__p+=' <li><a href="#" data-js-block-blogname="'+__e(e.name)+'">'+__e(__("Block %1$s",e.name))+"</a></li> "});return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(8),r=i(9),a=i(180),l=i(226),c=i(277),u=i(262),h=i(354),d=i(685),p=i(728),g=i(686),f=i(759),_=n.template('<a href="<%- blogUrl %>/tagged/<%- tag %>" data-js-tumblelog-name="<%- blogName %>" data-js-tumblelog-tag="<%- tag %>">'),m=l.extend({className:"conversation-icebreakers",template:f,mixins:[c],defaults:{isShowTags:!0,isShowRelationship:!0,isShowDescription:!0},subviews:{statusIndicator:{constructor:g,options:function(e){return{isOnline:e.participant.get("seconds_since_last_activity")!==-1,canSeeUIFlag:a.bool("status_indicator"),name:e.participant.get("name")}}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","participant"))},getTemplateData:function(){return{description:this.get("isShowDescription")?this._getCleanDescriptionString():null,relationship:this.get("isShowRelationship")?this._getRelationshipString():null,tagsMarkup:this.get("isShowTags")?this._getTagsDescriptionMarkup():null,canPixelateAvatar:this.participant.get("can_pixelate_avatar"),name:this.participant.get("name"),avatarUrl:this.participant.getAvatarUrl(),url:this.participant.get("url")}},afterRender:function(){this.theme=new p({el:this.el,theme:this.partic"isShowDescription")&&n.defer(n.bind(function(){d(this.js$("description"))},this));var e=this.$el.find(".pixelated-avatar");n.each(e,n.bind(function(e){o(e).removeClass("hide").addClass("show"),u.drawPixelatedImages(this)},this))},_getOpeningTagAnchor:function(e){var t=this.participant.get("name"),i=this.participant.get("url");return _({blogUrl:i,blogName:t,tag:e})},_getClosingTagAnchor:function(){return"</a>"},_getOpeningTagText:function(){return'<span class="text">'},_getClosingTagText:function(){return"</span>"},_getTagsDescriptionMarkup:function(){var e=this.participant.getBlogTags(),t=this._getOpeningTagText(),i=this._getClosingTagText(),o=this._getClosingTagAnchor();return e.length>1?s("%1$sPosts about%2$s %3$s#%4$s%5$s %6$sand%7$s %8$s#%9$s%10$s",t,i,this._getOpeningTagAnchor(e[0]),n.escape(e[0]),o,t,i,this._getOpeningTagAnchor(e[1]),n.escape(e[1]),o):1===e.length?s("%1$sPosts about%2$s %3$s#%4$s%5$s",t,i,this._gionString:function(){return h.stripTags(this.participant.getDescription())},_getRelationshipString:function(){var e;if(this.participant.isMutuals()){if(e=this._getRelativeTimeString(this.participant.getDurationMutualsSeconds()),!n.isEmpty(e))return s("Mutuals for %1$s",e)}else if(this.participant.isFollowingYou()){if(e=this._getRelativeTimeString(this.participant.getDurationFollowingYouSeconds()),!n.isEmpty(e))return s("Followed you %1$s ago",e)}else if(this.participant.isFollowing()&&(e=this._getRelativeTimeString(this.participant.getDurationFollowingSeconds()),!n.isEmpty(e)))return s("Following for %1$s",e);return s("Not following each other")},_getRelativeTimeString:function(e){return n.isNumber(e)?r(Date.now()-1e3*e).fromNow(!0):null}});e.exports=m},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a class="avatar" href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'" data-js-theme-avatar-shape-class> ',__p+=canPixelateAvatar?' <canvas class="avatar pixelated-avatar needs-drawing hide" data-image-url="'+__e(avatarUrl)+'" alt="'+__e(name)+'"></canvas> ':' <img src="'+__e(avatarUrl)+'"> ',__p+=' <div data-subview="statusIndicator"></div></a><div class="name"><a href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'">'+__e(name)+"</a></div> ",_.isEmpty(description)||(__p+=' <div class="description" data-js-description><a href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"> '+__e(description)+" </a></div> "),__p+=" ",_.isEmpty(relationship)||(__p+=' <div class="relationship">'+__e(relationship)+"</div> "),__p+=" ",_.isEmpty(tagsMarkup)||(__p+=' <div class="tags">'+(null==(__t=tagsMarkup)?"":__t)+"</div> ");return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(461),r=i(761),a=i(763),l=i(658),c=i(764),u=r.extend({className:"conversation-compose-plugin conversation-compose-plugin--gif-search",template:c,defaults:s.defaults({selectedGif:null,query:"",resultLimit:200,resultImageWidth:250},r.prototype.defaults),events:{click:"_onClick"},initialize:function(e){e=s.extend({},e),s.extend(this,s.pick(e,"collection")),this.popoverOptions={collection:this.collection,query:this.get("query"),resultLimit:this.get("resultLimit"),imageWidth:this.get("resultImageWidth"),loggingContext:this.getName(),loadFullImageBeforeSelect:!1,autoTeardown:!0,teardownOnEscape:!0,pinnedTarget:this.$el,pinnedSide:"top",isFixedPosition:!0}},getName:function(){return"messaging-gif"},onEdit:function(e,t,i){var s,o,r;this.$el.is(":visible")||(o=n(i.currentTarget),r=o.height(),s={pinnedTarget:o,shift:{x:0,y:Math.ceil(r*-.8)}}),this._openGifSearchPopover(e,t,s)},_onClick:function(e){e.preventDefault(),this._openGifSearchPopover(this.get("query")),this.trigger("click",this)},_openGifSearchPopover:function(e,t,i){var n;this.gifSearchPopover&&this._closePopover(),n=s.extend({},this.popoverOptions,i,{query:e,selectedImageUrl:t}),this.gifSearchPopover=new o(n),this.gifSearchPopover.render(),this.toggleActive(!0),this.listenToOnce(this.gifSearchPopover,"close",this._onGifSearchPopoverClose),this.listenToOnce(this.gifSearchPopover,"selectImage",this._onGifSearchPopoverSelectImage),this.listenTo(this.collection,"search",function(e){this.set("query",e)})},_closePopover:function(){this.stopListening(this.gifSearchPopover),this.stopListening(this.collection),this.gifSearchPopover.teardown(),this.toggleActive(!1)},_onGifSearchPopoverSelectImage:function(e){var t,i,n,o,r,c,u,h=s.get(e,"postId"),d=s.get(e,"postBlogUuid"),p=this.get("resultImageWidth"),g=this.getName();s.isEmpty(h)||s.isEmpty(d)||(n=s.get(e,"mediaUrl",""),r=s.get(e,"width"),c=s.get(e,"height"),u=this.get("query"),o=n.replace(/_\d+\./,"_"+p+"."),t=l.createImagePostMessage(h,d,o,r,c,{context:g,loggingData:{query:u}}),i=new a({url:o,width:r,height:c,message:t,context:g,editCallback:s.bind(s.partial(this.onEdit,u,n),this),loggingData:{query:u,postId:h,postBlogUuid:d}}),this.addToImagePreview(i),this._closePopover())},_onGifSearchPopoverClose:function(){this._closePopover()}});e.exports=u},function(e,t,i){"use strict";var n=i(762),s=n.extend({tagName:"button",attributes:{"data-js-theme-accent-color-on-white":!0},afterRender:function(){this.listenTo(this,"change:isActive",this._onChangeIsActive),this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),this._onChangeIsActive(this,this.get("isActive")),this._onChangeIsDisabled(this,this.get("isDisabled"))},_onChangeIsActive:function(e,t){this.$el.toggleClass("active",t)},_onChangeIsDisabled:function(e,t){this.$el.prop("disabled",t)}});e.exports=s},function(e,t,i){"use strict";var n=i(3),s=i(226),o=s.extend({defaults:{isDisabled:!1,isActive:!1},initialize:function(e){
e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults)))},getName:function(){return null},addToImagePreview:function(e){this.trigger("preview:add:image",e)},toggleActive:function(e){this.set("isActive",e)},toggleDisabled:function(e){this.set("isDisabled",e)}});e.exports=o},function(e,t,i){"use strict";var n=i(185),s=n.extend({defaults:{message:null,url:null,width:null,height:null,editCallback:null}});e.exports=s},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(__("Add GIF"));return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(8),r=i(277),a=i(213),l=i(761),c=i(763),u=i(658),h=i(766),d=i(767),p=l.extend({className:"conversation-compose-plugin conversation-compose-plugin--image-upload",template:d,mixins:[r],defaults:n.defaults({isFilePickerOpen:!1},l.prototype.defaults),events:{click:"_onClick",focus:"_onFocus","change [data-js-file-picker]":"_onFilePickerChange","click [data-js-file-picker]":"_onFilePickerClick"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,"imageUploadMaxBytes"))},getName:function(){return"messaging-image-upload"},afterRender:function(){this.listenTo(this,"change:isFilePickerOpen",this._onChangeIsFilePickerOpen),l.prototype.afterRender.apply(this,arguments)},addImageFile:function(e,t){var i=void 0,o=void 0,r=Math.floor(this.get("imageUploadMaxBytes")/1048576);this.messagingImageUploader=new h({file:e,imageUploadMaxBytes:this.get("imageUploadMaxBytes")}),this.messagingImageUploader.uploadImage().then(n.bind(function(s){var r=n.get(s,"src"),a=n.get(s,"width"),l=n.get(s,"height");o=u.createImageMessage(r,e,a,l,{context:this.getName(),loggingData:{imageSource:t}}),i=new c({url:r,file:e,width:a,height:l,message:o,context:this.getName(),editCallback:n.bind(this.onEdit,this),loggingData:{imageSource:t}}),this.addToImagePreview(i)},this),function(e){var t=n.get(e,"type");if(t)switch(t){case"format":a.alert(s("Invalid file type."));break;case"size":a.alert(s("Image must be smaller than %1$sMB",r))}else a.alert(s("Something about that file is off. Try sending something else."))})},_openFilePicker:function(){this.$el.focus(),this.set("isFilePickerOpen",!0),this.js$("file-picker").click()},onEdit:function(){this._openFilePicker()},_onFilePickerChange:function(e){var t=n.first(o(e.target).prop("files"));this.set("isFilePickerOpen",!1),this.js$("file-picker").val(""),this.addImageFile(t,"filesystem")},_onFilePickerClick:function(e){e.stopPropagation()},_onCltrigger("click",this)},_onFocus:function(){this.set("isFilePickerOpen",!1)},_onChangeIsFilePickerOpen:function(e,t){this.toggleActive(t)}});e.exports=p},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(214),r=i(259),a=i(260),l=o.extend({name:"MessagingImageUploader",defaults:{imageUploadMaxBytes:null,file:null},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults)))},uploadImage:function(){var e=new s.Deferred,t=this.get("imageUploadMaresolve.apply(this,arguments)},l=function(){e.reject.apply(this,arguments)};return i?n.get(i,"type","").match(/image\/(jpg|jpeg|png|gif)/i)?n.get(i,"size")>t?e.reject({type:"size"}):(a.read(i).then(function(e){r.load(e.objectUrl||e.base64).then(o,l)}),e):e.reject({type:"format"}):e.reject()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(__("Add Photo"))+' <input type="file" class="input-file-picker" data-js-file-picker name="messaging-photo" accept="image/*" tabindex="-1">';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="messaging-conversation messaging-conversation--open" data-js-theme-background-tint data-js-conversation-open data-js-theme-accent-color-on-white><div data-subview="headerView"></div><div class="conversation-main" data-js-theme-background-color data-js-main><div data-subview="messagesView"></div><div data-subview="conversationLoaderView"></div></div><div data-subview="previewView"></div><div data-subview="composeView"></div></div><div class="messaging-conversation messaging-conversation--minimized" data-js-conversation-minimized data-js-theme-accent-color-on-white data-js-theme-avatar-shape-class><div data-subview="minimizedView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(185),s=n.extend({defaults:n this.set("channel",e)},getId:function(){return this.get("channel").get("uuid")}revProperty:function(e){var t=this.getPrevChannel();return t?t.get(e):null},getPrevId:function(){return this.getPrevProperty("uuid")}});e.exports=s},function(e,t,i){"use strict";var n=i(3),s=i(190),o=i(668),mixins:[o],model:r,comparator:function(e){return-e.get("last_modified_ts")},_getRoot:function(e){return n.has(e,"response")?n.get(e,"response"):e},parse:function(e,t){return n.get(this._getRoot(e),"conversations")||[]},parsePreviousLink:fu},parseNextLink:function(e,t){return n.get(this._getRoot(e),"_links.next")},fetchInbox:function(e,t){t=t||{};var i=n.extend({},t.data,{participant:e});return n.extend(t,{cache:!1,remove:!1,skipParseLinks:0!==this.length,data:i,isFetchInbotion(){return n.reduce(this.models,function(e,t){return t.isUnread()?e+1:e},0)}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(190),o=i(772),r=s.extend({model:o,getSortedModels:function(e){return this.sortBy(function(t){return t.get("uuid")===e?-1:0})},getSortedIds:function(e){var t=this.getSortedModels(e);return n.pluck(n.invoke(t,"toJSON"),"uuid")}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(185),o=i(659),r=i(770),a=i(191),l=s.extend({idAttribute:"uuid",mixins:[o],relations:{conversations:r},defaults:{conversations:null,unread_messages_count_sum:0}});n.defaults(l.prototype,a.prototype),e.exports=l},function(e,t,i){"use strict";var n,s=i(8),o=i(214),r=i(774),a=i(775),l=o.extend({name:"footer",initialize:function(){this.createFooter()},createFooter:function(){s(".l-footer").length&&(this.footerView=new r({el:".l-footer"})),s(".sidebar_nav").length&&(this.sidebarFooterView=new a({el:),n}},function(e,t,i){"use strict";var n=i(226),s=n.extend({});e.exports=s},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(136),r=i(220).transition,a=s.extend({defaults:{fadeScrollDistance:2e3,visible:!0},initialize:function(){this.listenTo(o,"DOMEventor:flatscroll",this.onScroll),this.on("change:visible",this.toggleVisibility),this.$nav=this.$el.find(".sidebar_nav")},onScroll:function(e){e&&(e.windowScrollY>=this.get("fadeScrollDistance")?this.set("visible",!1):this.set("visible",!0)showElement(),n.defer(n.bind(function(){this.$nav.toggleClass("visible",t)},this))):(r(this.$nav,n.bind(function(){this.hideElement()},this)),this.$nav.toggleClass("visible",t)),o.trigger("toastr:canDisplayTog("display","none")},showElement:function(){this.$el.css("display","block")}});e.exports=a},function(e,t,i){"use strict";var n=i(8),s=i(214),o=i(136),r=i(430),a=s.extend({name:"SponsoredPosts",initialize:function(){if(this.isScrollEnabled=!1,this.transform=r.get("transform"),this.transform){this.rings=n(),this.ctas=n();var e=n.proxy(this.checkForRingsAndCTAs,this);o.on("AutoPaginator:after",e),o.on("sponsoredPosts:checkRings",e),this.checkForRingsAndCTAs()}},checkForRingsAndCTAs:function(){this.rings=this.rings.add(".sponsored_badge_icon .ring, .recommendation-reason-footer .icon_explore"),this.ctas=this.ctas.add(".tsp-cta-animated").map(function(){var e=n(this);this.$el=e,this.elHeight=e.height(),this.elBottom=e.offset().top+e.height(),this.$aCTA=e.find("a.cta"),this.$aCTA.css("color","#ffffff"),this.$overlay=e.find(".tsp-opacity-overlay");var t=/([\d]+)[^\d]+([\d]+)[^\d]+([\d]+).+/.exec(this.$overlay.css("border-top-color")),i=t[1],s=t[2],o=t[3];return this.overlayColor=i+", "+s+", "+o,this.$aCTA.addClass("cta-color-applied"),this}),!this.isScrollEnabled&&(this.rings.length>0||this.ctas.length>0)&&(this.isScrollEnabled=!0,o.on("DOMEventor:flatscroll",this.onWindowScroll,this))},onWindowScroll:function(e){var t=e.windowScrollTop,i=void 0,n=void 0;for(i=0,n=this.rings.length;i<n;i++)this.rings[i].style[this.transform]="rotate("+t+"deg)";for(i=0,n=this.ctas.length;i<n;i++)this._setCtaVisual(e,this.ctas[i])},_setCtaVisual:function(e,t){var i=200,n=e.windowHeight-(t.elBottom-e.windowScrollTop),s=void 0;n<t.elHeight?s=1:n>=0&&n<=i?s=1-n/i:(s=0,this.ctas=this.ctas.not(t),t.$el.removeClass("tsp-cta-animated"));var o=2*(s-.5),r="rgba("+t.overlayColor+", "+o+")";t.$overlay.css({opacity:s,"border-color":r});var a=s<.5?"#FFFFFF":"";t.$aCTA.css("color",a)}});e.exports=a},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(136),r=i(214),a=i(129),l=r.extend({name:"peepr",params:"",selector:"body",initialize:function(){var e=a.get("Components/Peepr")||{};this.params=e,e.blog_name&&(this.listenToOnce(o,"peepr:close",this.onPeeprClose),n(document).ready(s.bind(this.onPeeprRequestWithParams,this))),this.$container=n(this.container),this.bindEvents()},bindEvents:function(){this.listenTo(o,"peepr-open-request",this.onPeeprRequest),this.$container.on("click","[data-peepr]",s.bind(this.onPeeprTargetClicked,this))},onPeeprTargetClicked:function(e){if(!e.ctrlKey&&!e.metaKey){e.preventDefault();var t=n(e.currentTarget),i=t.data("peepr");if(i){var s=i.tumblelog,r=i.postId,a=i.searchTagTerm,l=i.replyNoteToTumblelogName;o.trigger("peepr-open-request",{tumblelog_name:s,post_id:r,searchTagTerm:a,reply)}},onPeeprClose:function(){window.Backbone.history.navigate("/dashboard")},onPeeprRequestWithParams:function(){o.trigger("peepr-open-request",{tumblelog_name:this.params.blog_name,post_id:this.params.post_id})},onPeeprRequest:function(e){e.tumblelog_name&&(e.editing_appearance="undefined"!=typeof e.editing_appearance&&e.editing_appearance,"undefined"==typeof e.should_bypass_safemode&&"undefined"!=typeof this.params.bn&&(e.should_bypass_safemode=this.params.bn),this.open(e))},open:function(e){var t="https://www.tumblr.com/blog/view/"+e.tumblelog_name;e.post_id?window.location=t+"/"+e.post_id:e.searchTagTerm?window.location=t+"/search/"+e.searchTagTerm:window.location=t}});e.exports=l},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(214),r=i(136),a=i(618),l=i(619),c=i(779),u=i(781),h=o.extend({name:"AskComponent",initialize:function(e){e=e||{},this.user=e.user,this.user&&(this.blog=this.user.getChannel(),this.question=new u({recipient:null,anonymous:!1,question:""}),this.listenTo(r,"ask:form:open",this.presentAskForm),this.listenTo(this.question,"save:success",this.onSaveSuccess))},presentAskForm:function(e){return this.askFormView?this:(this.question.set("recipient",e.recipient),n("body").addClass("postforms-open"),r.trigger("drawer:suspend"),r.trigger("keycommands:suspend"),this.glass=new a,this.modal=new l,this.askFormView=new c({model:this.question,characterLimit:500,recipient:{name:e.recipient,allowAnonymous:e.allow_anonymous},sender:this.blog}),this.askFormView.render(),this.modal.setContentSubView(this.askFormView),this.glass.render().$el.appendTo("body"),this.modal.render().$el.appendTo("body"),this.glass.show().then(s.bind(this.modal.show,this.modal)),this.listenTo(this.askFormView,"close",this.dismissAskForm),this.listenTo(this.askFormView,"submit",this.submit),this)},beforeRemove:function(){this.dismissAskForm()},dismissAskForm:function(){this.askFormView&&(this.stopListening(this.askFormView),this.modal.hide(),this.modal.remove(),this.modal=null,this.glass.hide(),this.glass.remove(),this.glass=null,this.askFormView.remove(),this.askFormView=null,r.trigger("keycommands:resume"),r.trigger("drawer:resume"),r.trigger("ask:form:hidden"),n("body").removeClass("postforms-open"))},submit:function(e){this.question.set("anonymous",!!e.anonymous),tSaveSuccess:function(){r.trigger("ask:form:success"),this.dismissAskForm()}});e.exports=h},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(250),r=i(226),a=i(232),l=i(277),c=i(780),u=r.extend({className:"ask-form",template:c,mixins:[a,l],keycommands:{"keydown:enter":"preventNewlines","keydown:escape":"dismiss"},events:{"click button.close":"dismiss","change .ask-anonymously-switch":"toggleAnonymous","submit form":"submit","input .ask-question":"onTextAreaUpdate"},initialize:function(e){this.characterLimit=e.characterLimit,this.sender=e.sender,this.recipient=e.recipient,this.onTextAreaUpdate=s.throttle(s.bind(this.onTextAreaUpdate,this),100),this.listenTo(this.model,"change:isSaving",this.toggleSubmit),this.listenTo(this.model,"save:success",this.render),this.listenTo(this.model,"save:error",this.displayErrors)},getTemplateData:function(){var e={};return e.recipient=s.clone(this.recipient)||{},e.recipient.allow_anonymous=e.recipient.allowAnonymous,e.sender=this.sender.toJSON(),e.sender.avatar_url=o(this.sender.get("avatar_url"))(128),e.character_limit=the")},toggleSubmit:function(e,t){t?this.disableSubmit():this.enableSubmit()},toggleAnonymous:function(e){var t=this.$(e.target);this.isAnonymous=t.prop("checked");var i=this.$$(".post_avatar_link"),n=this.$$(".ask-from .tumblelog_name"),s=this.$$(".ask-from .anonymous");this.isAnonymous?(i.removeClass("use_blog_avatar"),n.hide(),s.show()):(i.addClass("use_blog_avatar"),n.show(),s.hide())},submit:function(e){e.preventDefault(),this.trigger("submit",{question:this.$$(".ask-question").val(),anonymous:this.isAnonymous})},preventNewlines:function(e){e.preventDefault()},onTextAreaUpdate:function(){var e=this.$$(".ask-question").val(),t=e;e.match(/\n/g)&&(e=e.replace(/\n/g,""));var i=s.trim(e).length;0<i&&i<=this.characterLimit?this.enableSubmit():this.disableSubmit(),e!==t&&this.$$(".ask-question").val(e);var n=this.characterLimit-e.length,o=this.$$(".ask-character-count");o.text(n),n<=100?(o.addClass("active"),o.removeClass("count-ok count-warning count-danger"),n>40?o.addClass("count-ok"):n>20?o.addClass("count-warning"):o.addClass("count-danger")):o.removeClass("active")},enableSubmit:function(){this.model",!1)},disableSubmit:function(){this.$$(".ask-button").prop("disabled",!0)},showMessages:function(e,t){var i=this.$$("."+e),o=i.get(0);o&&(i.removeClass("active").hide().empty(),"string"==typeof t&&(t=[t]),s.each(t,s.bind(function(e){var t=n("<li/>",{text:e});i.append(t)},this)),i.show(),s.defer(function(){i.addClass("active")}))},displayErrors:function(e){this.showMessages("errors-ask",e)}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="post_form_wrapper v_center_el"><div class="post_avatar"><a class="post_avatar_link use_blog_avatar animating" data-user-avatar-url="'+__e(sender.avatar_url)+'" data-avatar-url="'+__e(sender.avatar_url)+'" data-blog-url="'+__e(sender.blog_url)+'"><span class="post_avatar_link blog_avatar anonymous" data-anonymous-avatar-url="/images/anonymous_avatar_64.gif" style="background-image: url(/images/anonymous_avatar_64.gif)"></span> <span class="post_avatar_link blog_avatar new" style="background-image: url('+__e(sender.avatar_url)+')"></span></a></div><div class="post-container"><form enctype="multipart/form-data" class="active"><div class="post-container-inner post post-form--asks"><div class="post-form--header"><div class="controls-container"> ';var senderMarkup='<span class="ask-from"><span class="tumblelog_name">'+sender.name+'</span><span class="anonymous">'+__("anonymous")+"</span></span>",recipientMarkup='<span class="ask-recipient-label">'+recipient.name+"</span>";if(__p+=" "+(null==(__t=__('%1$s <span class="ask-to-label">to</span> %2$s',senderMarkup,recipientMarkup))?"":__t)+' <span class="ask-character-count"></span></div></div><div class="post-form--form post-content-text"><textarea class="ask-question" name="question" placeholder="'+__e(__("Ask me anything"))+'" maxlength="'+__e(character_limit)+'" autofocus></textarea></div><div class="post-form--bottom"><div class="post-form--controls"><div class="controls-container"><div class="control left"><button type="button" class="chrome flat close">'+__e(__("Close"))+"</button></div> ",recipient.allow_anonymous){__p+=' <div class="control right"><div class="ask-anonymously"> ';var randId=Math.floor(1e6*Math.random());__p+=' <label class="binary_switch"><input id="ask_anonymously_switch_'+__e(randId)+'" class="ask-anonymously-switch" type="checkbox" name="anonymous" value="1"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label class="ask-anonymously-label" for="ask_anonymously_switch_'+__e(randId)+'">'+__e(__("Ask anonymously"))+"</label></div></div> "}__p+=' <div class="control right"><button class="chrome blue ask-button" type="submit" disabled="disabled">'+__e(__("Ask"))+'</button></div></div></div><ul class="post-form--error-bar messages errors-ask"></ul></div></div></form></div></div>'}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(185),s=i(3),o=i(130),r=n.extend({urlRoot:"/svc/post/ask",validate:function(e){return s.trim(e.question)?this.isUrl(e.question)?{error:o("Sorry, but please don't include links in questions.")}:void 0:{error:o("You need to enter a question!")}},isUrl:function(e){return!!(e.match(/(http|https):\/\//i)||e.match(/www\./i)||e.match(/[a-zA-Z0-9]+(\.arpa|\.root|\.aero|\.biz|\.cat|\.com|\.coop|\.edu|\.gov|\.info|\.int|\.jobs|\.mil|\.mobi|\.museum|\.name|\.net|\.org|\.pro|\.travel|TLD|\.ac|\.ad|\.ae|\.af|\.ag|\.ai|\.al|\.am|\.an|\.ao|\.aq|\.ar|\.as|\.at|\.au|\.aw|\.ax|\.az|\.ba|\.bb|\.bd|\.be|\.bf|\.bg|\.bh|\.bi|\.bj|\.bm|\.bn|\.bo|\.br|\.bs|\.bt|\.bv|\.bw|\.by|\.bz|\.ca|\.cc|\.cd|\.cf|\.cg|\.ch|\.ci|\.ck|\.cl|\.cm|\.cn|\.co|\.cr|\.cu|\.cv|\.cx|\.cy|\.cz|\.de|\.dj|\.dk|\.dm|\.do|\.dz|\.ec|\.ee|\.eg|\.er|\.es|\.et|\.eu|\.fi|\.fj|\.fk|\.fm|\.fo|\.fr|\.ga|\.gb|\.gd|\.ge|\.gf|\.gg|\.gh|\.gi|\.gl|\.gm|\.gn|\.gp|\.gq|\.gr|\.gs|\.gt|\.gu|\.gw|\.gy|\.hk|\.hm|\.hn|\.hr|\.ht|\.hu|\.id|\.ie|\.il|\.im|\.in|\.io|\.iq|\.ir|\.is|\.it|\.je|\.jm|\.jo|\.jp|\.ke|\.kg|\.kh|\.ki|\.km|\.kn|\.kr|\.kw|\.ky|\.kz|\.la|\.lb|\.lc|\.li|\.lk|\.lr|\.ls|\.lt|\.lu|\.lv|\.ly|\.ma|\.mc|\.md|\.mg|\.mh|\.mk|\.ml|\.mm|\.mn|\.mo|\.mp|\.mq|\.mr|\.ms|\.mt|\.mu|\.mv|\.mw|\.mx|\.my|\.mz|\.na|\.nc|\.ne|\.nf|\.ng|\.ni|\.nl|\.no|\.np|\.nr|\.nu|\.nz|\.om|\.pa|\.pe|\.pf|\.pg|\.ph|\.pk|\.pl|\.pm|\.pn|\.pr|\.ps|\.pt|\.pw|\.py|\.qa|\.re|\.ro|\.ru|\.rw|\.sa|\.sb|\.sc|\.sd|\.se|\.sg|\.sh|\.si|\.sj|\.sk|\.sl|\.sm|\.sn|\.so|\.sr|\.st|\.su|\.sv|\.sy|\.sz|\.tc|\.td|\.tf|\.tg|\.th|\.tj|\.tk|\.tl|\.tm|\.tn|\.to|\.tp|\.tr|\.tt|\.tv|\.tw|\.tz|\.ua|\.ug|\.uk|\.um|\.us|\.uy|\.uz|\.va|\.vc|\.ve|\.vg|\.vi|\.vn|\.vu|\.wf|\.ws|\.ye|\.yt|\.yu|\.za|\.zm|\.zw)/i))},save:function(e,t){t=t||{};var i=t.success,o=t.error;t.success=s.bind(function(e,t){if(s.isEmpty(s.result(t.response,"errors")))this.trigger("save:success"),i&&i.call(null,e,t);else{var n=t.response.errors[0];this.trigger("save:error",n),o&&o.call(null,e,n)}this.set("isSaving",!1)},this),t.error=s.bind(function(e,t){this.trigger("save:error",t),o&&o.call(null,e,t)},this),this.set("isSaving",!0);var r=n.prototype.save.call(this,e,t);!r&&this.validationError&&(this.trigger("save:error",this.validationError.error),this.set("isSaving",!1))}});e.exports=r},function(e,t,i){"use strict";var n=i(214),s=i(180),o=i(783),r=n.extend({name:"MobileNav",autoAppend:!0,view:function(){if(this.data)return this.data.npfMobileCreate=s.bool("redpop_post_form_mobile_create"),new o(this.data)}});e.exports=r},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(219),r=i(136),a=i(181),l=i(180),c=i(276),u=i(230),h=i(784),d=i(785),p=i(793),g=i(803),f=o.extend({className:"mobile-header",mixins:[c,u],template:h,defaults:{logged_in:!1},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),this.subViews.logoTitle=new d(e),this.subViews.navMenu=new p(e),l.bool("mobile_web_sticky_header")&&this.setSticky(),this.subViews.search=new g(e)},render:function(){return this.$el.html(this.template()),this.attachSubViews(),this},setSticky:function(){n("body").addClass("sticky-header"),this.lastPosition=a.rect().windowScrollTop,this.listenTo(r,"DOMEventor:flatscroll",this.getScrollDirection)},getScrollDirection:function(e){e.windowScrollTop>45?s.delay(s.bind(function(){this.$el.addClass("sticky")},this),500):this.$el.removeClass("sticky"),this.lastPosition<e.windowScrollTop&&e.windowScrollTop>45?this.$el.addClass("hide-nav"):this.$el.removeClass("hide-nav"),this.lastPosition=e.windowScrollTop}});e.exports=f},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="navMenu"></div><div data-subview="logoTitle"></div><div data-subview="search"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(276),r=i(230),a=i(786),l=i(787),c=i(789),u=i(791),h=s.extend({className:"nav-logo-title",mixins:[o,r],template:a,initialize:function(e){e=n.extend({},e),n.extend(this.attributes,e),this.subViews.logo=new l,this.get("page_title")&&this.get("logged_in")&&!this.get("search_term")?(this.subViews.pageTitle=new c(e),this.set("show_page_title",!0)):this.set("show_page_title",!1),this.set("show_search_field",!!this.get("search_term")),this.subViews.searchField=new u(e)},render:function(){return this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this}});e.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div class="mobile-logo-wrapper',show_page_title&&(__p+=" show-page-title "),__p+=" ",!_.isUndefined(show_search_field)&&show_search_field&&(__p+=" show-search-field "),__p+='"><div data-subview="logo"></div><div data-subview="pageTitle"></div><div data-subview="searchField"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(219),s=i(788),o=n.extend({template:s,className:"mobile-logo",render:function(){return this.$el.html(this.template()),this}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<a href="/" class="logo-link"><svg class="svg-logo" width="29px" height="39px" viewBox="0 0 29 39" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path class="inner" d="M13.4404585,32.9978573 L13.1859215,33 C5.40091922,33 3.7112324,27.2768093 3.7112324,23.9359304 L3.7112324,14.6527709 L0.644574576,14.6527709 C0.288572835,14.6527709 0,14.3641866 0,14.0082147 L0,9.6266323 C0,9.1644545 0.291787135,8.7523442 0.72736069,8.5979279 C4.72423734,7.1880393 5.97738627,3.70267176 6.16328007,1.05159549 C6.21292323,0.34336573 6.58403216,0 7.20071368,0 L11.7729503,0 C12.1289164,0 12.4175249,0.28854863 12.4175249,0.64452051 L12.4175249,8.0664341 L17.7675867,8.0664341 C18.1235885,8.0664341 18.4121613,8.3550185 18.4121613,8.7109547 L18.4121613,13.9746459 C18.4121613,14.3306178 18.1235885,14.6191665 17.7675867,14.6191665 L12.3906676,14.6191665 L12.3906676,23.2008456 C12.3906676,25.3559968 13.8110674,25.9521997 14.6886074,25.9521997 C15.5299686,25.9319513 16.3586512,25.6757572 16.7738319,25.5090561 C17.0821548,25.3853159 17.3529775,25.3033938 17.595693,25.3640676 C17.8213012,25.420456 17.9700163,25.5802291 18.0701239,25.8719917 L19.4885237,30.0155572 C19.6024885,30.3446026 19.702489,30.70361 19.464595,30.9576614 C18.3476967,32.1504243 15.7600055,32.9595389 13.4404585,32.9978573 L13.4404585,32.9978573 Z"></path></svg></a>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(230),r=i(790),a=s.extend({template:r,className:"page-title",mixins:[o],initialize:function(e){e=n.extend({},e),n.extend(this.attributes,e)},render:function(){return this.$el.html(this.template(this.toJSON())),this}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(page_title);return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(136),r=i(230),a=i(792),l=i(489),c=s.extend({template:a,className:"submit form":"__submitForm"},__submitForm:function(){this.toggleLoader(!0)},__handleSearchClick:function(){var e=this.$searchInput.val();this.$el.hasClass("search-term-exists")?e===this.get("search_term")?this.setFocus():this.$submitForm.trigger("submit"):!e&&this.$mobileLogoWrapper.hasClass("show-search-field")?this.hideSearchField():e&&this.$mobileLogoWrapper.hasClass("show-search-field")?this.$submitForm.trigger("submit"):this.showSearchField()},__handleNsfwFilterClick:function(e){this.$searchNsfwFilterInput.val(e),this.$submitForm.prop("action","/search/"+this.get("search_term")),this.$searchInput.prop("name",""),this.$submitForm.trigger("submit")},__handleFilterChange:function(e){var t="top";"CREATED_DESC"===e.get("sort")&&(t="recent");var i=e.get("post_type").toLowerCase();this.$searchFilterSortInput.val(t),this.$searchFilterPostTypeInput.val(i),this.$searchNsfwFilterInput.val(e.get("filter_nsfw")),this.$submitForm.prop("action","/search/"+this.get("search_term")),this.$searchInput.prop("name",""),this.$submitForm.trigger("submit")},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,e),this.listenTo(o,"mobileHeader:search:click",this.__handleSearchClick),this.listenTo(o,"mobileHeader:nsfw:update",this.__handleNsfwFilterClick),this.listenTo(o,"mobileHeader:filter:update",this.__handleFilterChange),this.listenTo(o,"drawer:open",this.hideSearchField)},render:function(){return this.get("search_term")&&this.$el.addClass("search-term-exists"),this.$el.html(this.template(this.toJSON())),this.$searchInput=this.$(".search-input"),this.$searchNsfwFilterInput=this.$(".search-nsfw-filter-input"),this.$searchFilterSortInput=this.$(".filter-sort-input"),this.$searchFilterPostTypeInput=this.$(".filter-post-type-input"),this.$submitForm=this.$("form"),this.$mobileLogoWrapper=this.$el.parent(),this},toggleLoader:function(e){e?this.loader?this.loader.set("loading",!0):this.loader=new l({$container:this.$el,type:"bar",classModifiers:"top",loading:!0}):this.loader.set("loading",!1)},showSearchField:function(){this.$mobileLogoWrapper.addClass("searchInput.blur(),this.$mobileLogoWrapper.removeClass("show-search-field")},setFocus:function(){var e=2*this.$searchInput.val().length;this.$searchInput.focus(),this.$searchInput.get(0).setSelectionRange(e,e)}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<form action="/search" method="get"><input type="text" placeholder="'+__e(__("Search Tumblr"))+'" autocomplete="off" class="search-input" id="search-input" name="q" value="',search_term&&(__p+=__e(search_term)),__p+='"> <input type="hidden" class="search-nsfw-filter-input" name="filter_nsfw"> <input type="hidden" class="filter-sort-input" name="sort" value="top"> <input type="hidden" class="filter-post-type-input" name="filter_post_type" value="any"> '+(null==(__t=_subview("loader"))?"":__t)+" </form>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(219),r=i(276),a=i(230),l=i(136),c=i(794),u=i(795),h=i(801),d=o.extend({className:"nav-menu",template:c,mixins:[r,a],events:{"click .menu-burger":"__clickMenuBurger","click [data-subnav]":"__clickSubnav","click .sneeze-guard":"__clickSneezeGuard"},__clickSn(e){e.preventDefav"))},__clickMenuBurger:function(e){e.preventDefault(),this.toggleDrawer()},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,e),this.get("drawer_open")&&this.openDrawer(),this.get("logged_in")?this.subViews.drawer=new u(e):this.subViews.drawer=new h(e),this.listenTo(l,"mobileHeader:search:click",this.closeDrawer)},render:function(){return this.$el.html(this.template()),this.$body=s("body"),this.$html=s("html"),this.attachSubViews(),this},toggleDrawer:function(){this.$el.hasClass("subnav-active")?this.closeSubNav():this.get("drawer_open")?this.closeDrawer():this.openDrawer()},openDrawer:function(){this.set("drawer_open",!0),this.$body.addClass("nav-drawer-open"),this.$html.addClass("nav-drawer-open"),this.$el.addClass("active"),l.trigger("drawer:open")},closeDrawer:function(){this.set("drawer_open",!1),this.$body.removeClass("nav-drawer-open"),this.$html.removeClass("nav-drawer-open"),this.$el.removeClass("active subnav-active"),l.trigger("drawer:closed")},openSubNav:function(e){this.$el.addClass("subnav-active"),l.trigger("drawer:subnav:open",e)},closeSubNav:function(){this.$el.removeClass("subnav-active"),l.trigger("drawer:subnav:close")}});e.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="menu-burger"><div class="burger bun top"></div><div class="burger patty"></div><div class="burger bun bottom"></div></div><div class="drawer" data-subview="drawer"></div><div class="sneeze-guard"></div>';return __p;
}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(230),r=i(276),a=i(796),l=i(797),c=i(799),u=s.extend({template:a,mixins:[r,o],className:"drawer logged-in",initialize:function(e){e=n.extend({},e),n.extend(this.attributes,e),this.subViews.primaryNav=new l(e),this.subViews.secondaryNav=new c(e)},render:function(){return this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="nav-wrapper"><div data-subview="primaryNav"></div><div data-subview="secondaryNav"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(230),r=i(798),a=s.extend({template:r,mixins:[o],className:"primary-nav",,render:function(){return this.$el.html(this.template(this.toJSON())),this}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<nav class="nav-site-sections"><a href="/dashboard" class="nav-item with-icon"><span class="nav-text nav-item-dashboard">'+__e(__("Dashboard"))+'</span></a><a href="/likes" class="nav-item with-icon"><span class="nav-count">',parseInt(likes,10)>0&&(__p+=__e(likes)),__p+=' </span><span class="nav-text nav-item-likes">'+__e(__("Likes"))+'</span></a><a href="/following" class="nav-item with-icon"><span class="nav-count">'+__e(following)+'</span><span class="nav-text nav-item-following">'+__e(__("Following"))+'</span></a><a href="/settings" class="nav-item with-icon" data-subnav="settings"><span class="nav-text nav-item-settings has-subnav">'+__e(__("Settings"))+'</span></a><a href="'+__e(url_prefix)+__e(npfMobileCreate?"/dashboard/new":"/new/text")+'" class="nav-item with-icon"><span class="nav-text nav-item-create-post">'+__e(__("Create a post"))+'</span></a></nav><nav class="nav-blog-list"><span class="nav-section-title">'+__e(__("Blogs"))+"</span> ",_.each(blogs,function(e){__p+=' <a href="'+__e(e.url)+'" class="nav-item"><img src="'+__e(e.avatar)+'" class="blog-avatar"><div class="blog-name-wrapper"><span class="blog-name">'+__e(e.name)+'</span><span class="blog-title">'+(null==(__t=e.safe_title)?"":__t)+"</span></div></a> "}),__p+=" </nav>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(230),r=i(136),a=s.extend({mixins:[o],className:"secondary-nav",templates:{settings:i(800)},_getTemplate:function(e){if("settings"===e)return this.templates.settings(this.toJSON())},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,e),this.listenTo(r,"drawer:subnav:open",this.render)},render:function(e){return e&&this.$el.html(this._getTemplate(e)),this}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<nav class="nav-site-sections"><a href="/settings/password" class="nav-item"><span class="nav-text">'+__e(__("Change Password"))+'</span></a><a href="/settings/tfa" class="nav-item"><span class="nav-text">'+__e(__("Two Factor Authentication"))+'</span></a><a href="/help" class="nav-item"><span class="nav-text">'+__e(__("Help"))+'</span></a><a href="/settings/account" class="nav-item" target="_blank"><span class="nav-text desktop-view">'+__e(__("Account"))+'</span></a><a href="/settings/notifications" class="nav-item" target="_blank"><span class="nav-text desktop-view">'+__e(__("Notifications"))+'</span></a><a href="/settings/apps" class="nav-item" target="_blank"><span class="nav-text desktop-view">'+__e(__("Apps"))+"</span></a></nav>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(230),r=i(136),a=i(802),l=s.extend({template:a,mixins:[o],className:"drawer logged-out",initialize:function(e){e=n.extend({},e),n.extend(this.attributes,e),this.listenToOnce(r,"drawer:open",this.downloadBackground)},downloadBackground:function(){var e=new Image,t=this.$splashBg.data("img-src");e.onload=n.bind(function(){this.$splashBg.css("background-image","url("+t+")"),this.$splashBg.addClass("loaded")},this),e.src=t},render:function(){return this.$el.html(this.template(this.toJSON())),this.$splashBg=this.$(".splash-bg"),this}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="splash-bg" data-img-src="'+__e(splash.image)+'"></div><div class="splash-sections"><div class="splash-section top"><a href="/login" class="splash-login">'+__e(__("Log in"))+'</a></div><div class="splash-section middle"><div class="middle-inner"><span class="splash-pitch">'+__e(__("Splash headline"))+'</span><a href="/register" class="signin tx-button blue" role="button">'+__e(__("Get started"))+"</a> ",has_app&&(__p+='<a href="'+__e(app_url)+'" class="tx-button get-the-app" role="button">'+__e(__("Get the app"))+"</a>"),__p+=' </div></div><div class="splash-section bottom"><a href="'+__e(splash.url)+'" target="_blank" rel="nofollow" class="splash-avatar" style="background-image:url('+__e(splash.avatar)+')"></a> <a href="'+__e(splash.url)+'" target="_blank" rel="nofollow" class="splash-name">'+__e(__("Posted by"))+"&nbsp;<strong>"+__e(splash.name)+"</strong></a></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(136),o=i(219),r=i(276),a=i(230),l=i(804),c=i(805),u=i(807),h=i(812),d=o.extend({className:"nav-search",mixins:[r,a],template:l,events:{"click .search-label":"__searchLabelClick","click .filter-icon":"__filterIconClick"},__searchLabelClick:function(){s.trigger("mobileHeader:search:click")},togglePopover:function(){this.popover||(this.popover=new u({pinnedTarget:this.subViews.filterIcon.$el,model:this.model}),this.popover.render(),this.listenTo(this.popoe))},onPopoverClose:function(){n.defer(n.bind(function(){this.popover=null},this))},__filterIconClick:function(){this.togglePopover()},onFilterChange:function(ehange),this.listenTo(this.model,"change:filter_nsfw",this.onFilterChange))},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,e),this.get("logged_in")&&(this.subViews.filterIcon=new c,this.model=new h({showOriginalPostsSwitch:!1,showNsfwSwitch:!0,sort:this.get("filter_sort").toUpperCase(),post_type:this.get("filter_post_type").toUpperCase(),filter_nsfw:this.get("filter_nsfw")}),this.bindEvents())},render:function(){return this.SubViews(),this},teardown:function(){this.popover&&this.popover.teardown()}});e.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<span class="toggle-filter"><div data-subview="filterIcon"></div><div data-subview="filters"></div></span><span class="search-label" for="search-input"></span>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";"filter-icon",render:function(){return this.$el.html(this.template()),this}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<i class="icon_filter"></i>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(808),s=i(810),o=n.extend({className:n.prototype.className+" blog-search-filters-popover",Subview:s});e.exports=o},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(220).transition,r=i(284),a=i(276),l=i(283),c=i(232),u=i(809),h=s.extend({className:"popover--blog-search",mixins:[a,l,c],template:u,keycommands:{"keydown:down":"targetNextLi","keydown:tab":"targetNextLi","keydown:up":"targetPrevLi","keydown:shift+tab":"targetPrevLi","keyup:enter":"selectLi"},defaults:{keycommands:!1,keyboardFocusClass:"keyboard_focus"},initialize:function(e){return this.options=n.defaults(e,this.defaults),this.Subview?(this.subview=new this.Subview(e),void this.bindEvents()):void this.remove()},render:function(){return this.$el.html(this.template()),this.$(".popover_inner").append(thi(function(){this.$main.addClass("popover--active"),this.bindClickOutside()},this),1),this},bindEvents:function(){this.listenTo(this.subview,"remove",this.hide),this.options.keycommands||this.disableKeys()},bindClickOutside:function(){this._popoverBase.autoTeardown&&(this.clickOutside=new r(this.eln(){this.clickOutside&&(this.clickOutside.remove(),this.clickOutside=null)},targetNextLi:function(e){e.preventDefault(),this.$active?(this.$active.removeClass(this.options.keyboardFocusClass),this.$active=this.$active.next().length?this.$active.next():this.$(".popover_menu_item").first()):this.$active=this.$(".popover_menu_item").first(),this.$active.addClass(this.options.keyboardFocusClass),this.scrollToActive()},targetPrevLi:function(e){e.preventDefault(),this.$active?(this.$active.removeClass(this.options.keyboardFocusClass),this.$active=this.$active.prev().length?this.$active.prev():this.$(".popover_menu_item").last()):this.$active=this.$(".popover_menu_item").last(),this.$activelectLi:function(){this.$active&&this.trigger("itemSelected",this.$active)},scrollToActive:function(){this.$scrollable=this.$scrollable||this.$(".popover_inner"),this.$scrollable.scrollTop(this.$scrollable.scrollTop()+this.$active.position().top-this.$scrollable.height()+this.$active.outerHeight())},hide:function(){this.$main.$el,n.bind(function(){ner"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(8),s=i(226),o=i(811),r=s.extend({template:o,events:{"click [data-filter]":"onFilterClick","click .sort_filter.toggle":"onToggleFilterClick","click .option-radio":"onCheckboxClick","change [type=checkboxge(),this.onSortChange(),this.onPostRoleChange(),this.onFilterNsfwChange()},bindEvents:function(){this.listenTo(this.model,"change:sort",this.onSortChange),this.listenTo(this.model,"change:post_type",this.onPostTypeChange),this.listenTo(this.model,"change:post_role",this.onPostRoleChange),this.listenTo(this.model,"change:filter_nsfw",this.onFilterNsfwChange)},onPostRoleChange:function(){this.$("#post_role").prop("checked",this.model.get("post_role")!==this.model.defaults.post_role)},onPostTypeChange:function(){this.$(".post_type_filter.active").removeClass("active"),this.$('[data-filter="post_type:'+this.model.get("post_type")+'"]').addClass("active")},onFilterNsfwChange:function(){this.$(".search-nsfw-filter-checkbox-input").prop("checked",this.model.get("filter_nsfw")!==this.model.defaults.filter_nsfw)},onSortChange:function(){this.$(".sort_filter.active").removeClass("active"),this.$('[data-filter="sort:'+this.model.get("sort")+'"]').addClass("active")},onFilterClick:function(e){var t=n(e.currentTarget).data("filter").split(":");this.model.set(t[0],t[1])},onCheckboxChange:function(e){var t=n(e.currentTarget),i=e.currentTarget.id,s=t.data("value"),o=t.prop("checked");this.model.set(i,o?s:this.model.defaults[i])},onCheckboxClick:function(e){e.stopPropagation()},onToggleFilterClick:function(e){var t=n(e.currentTarget).find("[type=checkbox]"),i=t.prop("checked");t.prop("checked",!i).trigger("change")}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_valuorts),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter" data-filter="sort:POPULARITY_DESC"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> '+__e(__("Top Posts"))+' </span></li><li class="popover_menu_item sort_filter" data-filter="sort:CREATED_DESC"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> '+__e(__("Recent Posts"))+" </span></li></ul> ",model.showOriginalPostsSwitch&&(__p+=' <ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter toggle"><span class="popover_menu_item_anchor"><div class="option-radio"><label class="binary_switch"><input type="checkbox" name="post_role" id="post_role" data-value="ORIGINAL"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div> '+__e(__("Original Posts"))+" </span></li></ul> "),__p+=' <ul class="popover_inner_list search_filter_items"><li class="popover_menu_item post_type_filter" data-filter="post_type:ANY"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> '+__e(__("All Types"))+' </span></li><li class="popover_menu_item post_type_filter post_text_filter" data-filter="post_type:TEXT"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_text_small"></i> '+__e(__("Text"))+' </span></li><li class="popover_menu_item post_type_filter post_photo_filter" data-filter="post_type:PHOTO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_photo_small"></i> '+__e(__("Photo"))+' </span></li><li class="popover_menu_item post_type_filter post_quote_filter" data-filter="post_type:QUOTE"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_quote_small"></i> '+__e(__("Quote"))+' </span></li><li class="popover_menu_item post_type_filter post_link_filter" data-filter="post_type:LINK"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_link_small"></i> '+__e(__("Link"))+' </span></li><li class="popover_menu_item post_type_filter post_chat_filter" data-filter="post_type:CHAT"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_chat_small"></i> '+__e(__("Chat"))+' </span></li><li class="popover_menu_item post_type_filter post_audio_filter" data-filter="post_type:AUDIO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_audio_small"></i> '+__e(__("Audio"))+' </span></li><li class="popover_menu_item post_type_filter post_video_filter" data-filter="post_type:VIDEO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_video_small"></i> '+__e(__("Video"))+" </span></li></ul> ",model.showNsfwSwitch&&(__p+=' <ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter toggle"><span class="popover_menu_item_anchor"><div class="option-radio"><label class="binary_switch"><input type="checkbox" name="filter_nsfw" id="filter_nsfw" data-value="true" class="search-nsfw-filter-checkbox-input"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div> '+__e(__("Safe search"))+" </span></li></ul> ");return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(136),o=i(185),r=i(190),a=o.extend({urlRoot:"/svc/search/blog_search",defaults:{next_offset:0,limit:10,sort:"CREATED_DESC",post_type:"ANY",term:"",unsetTerm:"",post_role:"ANY",filter_nsfw:!1,showOriginalPostsSwitch:!0,showNsfwSwitch:!1},initialize:function(){this.listenTo(this,"change:unsetTerm",this.onUnsetTermChange),this.listenTo(s,"peeprsearch:change:term",this.onTermSelect),this.listenTo(this,"change:term change:sort change:post_type change:post_role",this.resetSearch),this.posts=new r},resetSearch:function(){this.set(n.pick(this.defaults,["limit","next_offset"])),this.posts.reset(),this.trigger("search:reset")},reset:function(){this.posts.reset(),this.set(this.defaults),this.trigger("reset")},url:function(){var e=this.get("term").replac"+this.get("blogname")+"/"+e},onTermSelect:function(e){this.search(e.term)},onUnsetTermChange:function(){s.trigger("peeprsearch:change:unsetTerm",{term:this.get("unsetTerm")})},search:function(e){e=e||this.get("unsetTerm"),e.length&&this.set("term",e)},fetch:function(){this.get("next_offset")<0||o.prototype.fetch.apply(this,argrn this.posts.length?n.each(e.response.posts,function(e){this.posts.add(e)},this):this.posts.reset(e.response.posts),delete e.response.posts,e.response},sync:function(e,t,i){"read"===e&&(i.data=this.pick("next_offset","limit","sort","post_type","post_role","filter_nsfw")),o.prototype.sync.apply(this,arguments)}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(214),r=i(136),a=i(132),l=i(814),c=i(815),u=o.extend({name:"YamPlusAd",counter:1,adConfiguration:{name:"LREC",sp:1197719223,ps:"LREC",ssl:1},initialize:function(e){this.listenTo(r,"darla:ready",this.setupFirstAd),this.listenTo(r,"darla:failure",this.checkAdexist),this.listenTo(r,"darla:success",this.checkAdexist),this.listenTo(r,"component:YamPletupDarla()}urn s("#yam-plus-ad-units-"+e)},canServeAds:function(){return window.DARLA},checkAdexist:function(e){if(this.canServeAds()&&e){var t=e[0].replace("LREC",""),i=this.$placeholderFor(t);0===i.find(".darla").length&&i.parents(".yamplus-unit-container").remove()}},setupDarla:function(){window.DARLA_CONFIG=l(this.setupFirstAd(!0)),c()},setupFirstAd:function(e){var t=s(".yam-plus-ad-container, .sidebar-ad-content").eq(0);if(!t.length)return null;var i=t.find(".yam-plus-ad-target"),n=i.attr("id"),o=t.attr("data-yam-ad-id"),r={dest:n,id:o};return e?r:this.setupAd(r)},setupAd:function(e){if(this.counter=this.counter+1,a.logSaw(this.name,"setupAd",window.DARLA),!this.canServeAds())return a.logSaw(this.name,"Cannot serve ads -- NO DARLA"),!1;e=n.defaults(e,{asz:"300x250",w:"300",h:"250",pos:"LREC-"+this.counter,id:!1,dest:!1,fdb:!0});var t="LRECP",i=n.defaults({name:t},this.adConfiguration);return a.logSaw(this.name,"DARLA.add",i),window.DARLA.add(i),window.DARLA.isAutoOn()||window.DARLA.startAuto(),window.DARLA.event("AUTO"),!0}});e.exports=u},function(e,t,i){"use strict";var n=i(3),s=i(136);e.exports=function(e){e=n.extend({dest:!1,id:!1},e);var t={positions:{DEFAULT:{w:"300",h:"250"},LREC:{dest:!1,id:!1}},events:{getEm:{ps:["LREC"],sp:1197719223},AUTO:{sp:1197719223,ps:{LREC:{autoRT:1e4,autoIV:1,autoMax:25,id:"LREC"}},autoStart:1,autoRT:1e4,autoDDG:1,ssl:!0,npure",arguments)},onSuccess:function(){s.tri().forEach(function(e){""!==e.hasErr&&s.trigger("darla:failure",arguments)})}};return t.positions.LREC.dest=e.dest,t.positions.LREC.id=e.id,t}},function(e,t,i){"use strict";var n,s=("https:"===document.location.protocol?"https://":"http://")+"fc.yahoo.com/sdarla/php/client.php?f=1197719150",o=5,r=0,a=i(136),l=function e(){clearTimeout(n),n=null,window.DARLA&&!window.DARLA.inProgress()?a.trigger("darla:ready"):++r<o?n=setTimeout(e,1e3):a.trigger("darla:failure")};e.exports=function(){var e=document.createElement("script");e.async=!0;var t=document.getElement"?"+t},createPixel:function(e){var t=new Image(1,1);t.src=e}});e.exports=u},function(e,t,i){"use strict";var n=i(3),s=i(818),o=s.extend({logKey:"dashboard_embed",logOptions:{init_event:!1},events:{"/^post:((?:un)?docked)$/":"handleEvent","post:embed:stateChange":"logStateChange"},handleEvent:function(e,t){var i=n.extend({},t);i.postData&&(i.post_id=i.postData.id,i.tumblelog=i.postData.tumblelog,delete i.postData),this.log(e,i)},logStateChange:function(e,t){if(!n.isEmpty(t)&&t.state&&t.postID&&t.service){if("tumblr"===t.service)retvar o=i(3),r=i(342),a=i(822),l=a.getRealNow,c=r.get("tmgioct");e.exports=s},function(e,t,i){"use strict";var n=i(3),s=i(818),o=s.extend({logKey:"video_interactions",logEnv:{referrer:document.location.pathname},events:{"VideoPlayer:cacheUnload":"cacheUnloadLog","VideoPlayer:timeupdate":"updateLogCache","VideoPlayer:*":"handleEvent"},initialize:function(){this.excludedEvents=["cacheUnload","timeupdate"],this.unloadData={},n.each(this.loggers,function(e){e.before_unloaded=n.bind(this.beforeUnloaded,this)},this)},handleEvent:function(e,t){if(!n.contains(this.excludedEvents,e)){var i=n.extend({},t);i.postData&Data),this.log(e,i)}},cacheUnloadLog:function(e,t){this.unloadData[t.id]=t},beforeUnloaded:function(e){n.each(this.unloadData,function(e){this.handleEvent("unload",e)},this)},updateLogCache:function(e,t){var i=["elapsed","position"];this.unloadData[t.id]=n.extend(this.unloadData[t.id],n.pick(t,i))}});e.exports=o},function(e,t,i){"use strict";var n=i(3),s=i(818),o=s.extend({logKey:"vendorbutton",logEnv:{referrer:document.location.pathname},events:{"VendorButton:*":"handleEvent"},handleEvent:function(e,t){var i=n.extend({},t);i.post_id=t.postData.id,i.root_post_id=t.postData.root_id,i.tumblelog=t.postData.tumblelog,delete i.postData,this.log(e,i)}});e.exports=o},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"dashboard_sharing",events:{"dashboard-share:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){t=t||{},this.log(e,t)}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"related_recommendations",logOptions:{init_event:!1},events:{"rapid-recommendations:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"explore_trending",logOptions:{init_event:!1},events:{"explore-trending:*":"log"},logEnv:{location:document.location.pathname}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"roadblock",events:{"roadblock:*":"log"}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"linkpost_interactions",logOptions:{init_event:!1},events:{"linkpost:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=i(129),o=n.extend({logKey:"recommended_blogs",logEnv:{context:s.get("Context/name"),location:document.location.pathname},logOptions:{init_event:!1},events:{"recommendedBlogs:*":"log"}});e.exports=o},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"postform_interactions",logOptions:{init_event:!1},events:{"postform-interaction:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"header_search",logEnv:{referrer:document.location.pathname},events:{"header_search:*":"log"}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"gifsearch_interactions",logOptions:{init_event:!1},events:{"gifsearcht.location.pathname},handleEvent:function(e,t){"unload"!==e&&this.log(e,t)}});e.exports=s},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(818),o=n(s),r=i(845),a=n(r),l=i(180),c=n(l),u=o.default.extend({logKey:"little_sister",logSpots:[],events:function(){return c.default.bool("little_sister")?{"LSLog:*":"log"}:{}},log:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.pt,n=t.is_ad,s=t.video_details,o=t.extraData;i&&(a.default.log(i).trigger(e,{pt:i,eventName:e,video_details:s,extraData:o}),(n||"supply_unload"===e)&&a.default.flush())}});t.default=u},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=[];return(0,o.forEach)(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.pt,n=e.event_data,s=(0,o.find)(t,{pt:i});s||(s={pt:i,events:[]},t.push(s)),s.events.push(n)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.LsLogger=t.lsEndpoint=t.POST_TRACKER=void 0,t.logLadyFormat=s;var o=i(3),r=i(822),a=i(821),l=n(a),c=i(846),u=n(c),h=t.POST_TRACKER="pt",d=t.lsEndpoint="/services/bblog",p=t.LsLogger=l.default.extend({build_payload:function(){var e=l.default.prototype.build_payload.call(this),t=this.event_payload_name&&(0,o.isEmpty)(e[this.event_payload_name]);return(0,o.isEmpty)(e)||t?{}:(e.flushTime=(0,r.getRealNow)(),e)}name:"trackers",event_filter:function(e){var t=e.data;return(0,o.has)(t,h)},payload_formatter:s,endpoint:d});t.default=g},function(e,t,i){"use strict";function n(e,t,i){this.name=t,this.log_key=s.result(e,"log_key"),this.data=i||{};var n=r(),o={pt:this.data.pt,event_data:{timestamp:n,eventString:this.data.eventName||t}};this.data.video_details&&(o.event_data.data=this.data.video_details),this.data.extraData&&(o.event_data.data=o.event_data.data||{},s.extend(o.event_data.data,this.data.extraData)),this.json=o}var s=i(3),o=i(822),r=o.getRealNow;e.exports=n},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(818),o=n(s),r=i(848),a=n(r),l=i(180),c=n(l),u=o.default.extend({logKey:"kraken",logSpots:[],events:function(){return c.default.bool("kraken_web_logging_library")?{"Kraken:*":"log"}:{}},log:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.default.log("kraken").trigger(e,t),(t.is_ad||"supply_unload"===e)&&a.default.flush()}});t.default=u},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return u.default.groupBy(e,function(e){return u.default.has(e,p.POST_TRACKER)&&!!e.pt})}function o(){var e=argumentst=(0,p.logLadyFormat)(e),i=function(e){var t=e.kraken;return delete t.pt,t},n=function(e){return e.data=e.data||e.kraken.event_details,delete e.data.pt,delete e.kraken,e};return t.map(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.pt,s=e.events;return{pt:t,krakenEvents:s.map(i),events:s.map(n)}})}function r(){vrguments[0]:[];return e.map(function(e){var t=e.event_data;return t.kraken})}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new d.default(window,e);return{language:t.language,manufacturer:t.vendor,os_version:t.osVersion,platform:t.platform,build_version:"1704829112-70e441a3841",carrier:"",connection:"",model:""}}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return{};var t=s(e),i=o(t[_]),n=r(t[m]);return u.default.assign({krakenClientDetails:a()},i.length&&{trackers:i},n.length&&{krakenEvents:n})}Object.defineProperty(t,"__esModule",{value:!0});var c=i(3),u=n(c),h=i(849),d=n(h),p=i(845),g=i(852),f=n(g),_="true",m="false",v=new p.LsLogger({EventClass:f.default,payload_formatter:l,event_filter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,i=e.name,n=t.pt;return!!n||u.default.includes(g.allowedEventNames,i)},endpoint:p.lsEndpoint});t.default=v},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(3),a=i(850),l=n(a),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,e);var n=t.screen,o=t.location,a=t.navigator,c=a.appVersion,u=a.browserLanguage,h=a.cookieEnabled,d=a.onLine,p=a.language,g=a.languages,f=a.userAgent,_=a.vendor,m=new l.default(f).getResult(),v=m.browser,b=m.os,y=m.device,w=(new t.Date).getTime(),C=!0,k=t.outerWidth+"x"+t.outerHeight;(0,r.assign)(this,{appVersion:c,browserName:v.name,browserVersion:v.version,client:t,colorDepth:n.colorDepth,cookiesEnabled:h,createdAt:w,deviceModel:y.model,deviceType:y.type,deviceVendor:y.vendor,hasJavascript:C,isOnline:d,language:p||u,languages:g||[],location:o,osName:b.name,osVersion:b.version,resolution:k,screenHeight:n.height,screenWidth:n.width,userAgent:f,vendor:_},i)}return o(e,[{key:"toJSON",value:function(){var e=this.appVersion,t=this.colorDepth,i=this.cookiesEnabled,n=this.hasFlash,s=this.hasImages,o=this.hasJavascript,r=this.language,a=this.languages,l=this.isOnline,c=this.platform,u=this.plugins,h=this.resolution,d=this.screenHeight,p=this.screenWidth,g=this.createdAt,f=this.timezone,_=this.userAgent;return{app_version:e,color_depth:t,cookies_enabled:i,flash_enabled:n,images_enabled:s,javascript_enabled:o,language:r,languages:a,online:l,platform:c,plugins:u,resolution:h,screen_height:d,screen_width:p,time_zone_offset:f,timestamp:g,user_agent:_}}},{key:"screenType",get:function(){if(this.page)return this.page;var e=this.location.pathname,t={Dashboard:"/dashboard",Explore:"/explore",Tagged:"/tagged",SearchResults:"/search",About:"/about",Jobs:"/jobs",Logo:"/logo",Business:"/business",Buttons:"/buttons",Press:"/press",Developers:"/developers",Terms:"/terms",Policy:"/policy",Apps:"/apps",Themes:"/themes",Analytics:"/analytics"};for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if((0,r.startsWith)(e,n))return i}return"Unknown"}},{key:"timezone",get:function(){return(new this.client.Date).getTimezoneOffset()}},{key:"isHeadlessBrowser",get:function(){var e=this,t=["_phantom","Buffer","callPhantom","domAutomatiot","spawn","webdriver"];return(0,r.some)(t,function(t){return!!e.client[t]})}},{key:"plugins",get:function(){return(0,r.map)(this.client.navigator.plugins,"name")}},{key:"hasImages",get:function(){var e=this.client.document.getElementById("clp_image");return!!e&&e.width>0}},{key:"hasFlash",get:function(){var e=this.client,t=e.ActiveXObject,i=e.navigator,n=!1;try{n=new t("ShockwaveFlash.ShockwaveFlash")}catch(e){n=i.mimeTypes["application/x-shockwave-flash"]&&i.mimeTypes["application/x-shockwave-flash"].enabledPlugin}return!!n}},{key:"platform",get:function(){var e=(0,r.get)(this,"client.navigator.platform"),t=(0,r.includes)(["iPhone","iPod","iPad","iPhone Simulator","iPod Simulator","iPad Simulator"],e),i=(0,r.includes)(["Android"],e);return t?"Web:iOS":i?"Web:Android":"Web"}}]),e}();t.default=c},function(e,t,i){var n;!function(s,o){"use strict";var r="0.7.12",a="",l="?",c="function",u="undefined",h="object",d="string",p="major",g="model",f="name",_="type",m="vendor",v="version",b="architecture",y="conr n t){return"string"==typeof e&&t.toLowerCase().indexOr:function(e){return typeof e===d?e.replace(/[^\d\.]/g,"").split(".")[0]:o},trim:fune[s[[i][n],e))return i===l?o:i}else if(T.has(t[i],e))return i===l?o:i;return e}},P={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},I={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[f,v],[/(opios)[\/\s]+([\w\.]+)/i],[[f,"Opera Mini"],v],[/\s(opr)\/([\w\.]+)/i],[[f,"Opera"],v],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[f,v],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[f,"IE"],v],[/(edge)\/((\d+)?[\w\.]+)/i],[f,v],[/(yabrowser)\/([\w\.]+)/i],[[f,"Yandex"],v],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],v],[/(micromessenger)\/([\w\.]+)/i],[[f,"WeChat"],v],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[v,[f,"MIUI Browser"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[f,/(.+)/,"$1 WebView"],v],[/android.+samsungbrowser\/([\w\.]+)/i,/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[v,[f,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[f,v],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/juc.+(ucweb)[\/\s]?([\w\.]+)/i],[[f,"UCBrowser"],v],[/(dolfin)\/([\w\.]+)/i],[[f,"Dolphin"],v],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[f,"Chrome"],v],[/;fbav\/([\w\.]+);/i],[v,[f,"Facebook"]],[/fxios\/([\w\.-]+)/i],[v,[f,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[v,[f,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[v,f],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[f,[v,E.str,P.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[f,v],[/(navigator|netscape)\/([\w\.-]+)/i],[[f,"Netscape"],v],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[f,v]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[b,"amd64"]],[/(ia32(?=;))/i],[[b,T.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[b,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[b,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[b,/ower/,"",T.lowerize]],[/(sun4\w)[;\)]/i],[[b,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[b,T.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[g,m,[_,C]],[/applecoremedia\/[\w\.]+ \((ipad)/],[g,[m,"Apple"],[_,C]],[/(apple\s{0,1}tv)/i],[[g,"Apple TV"],[m,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[m,g,[_,C]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[g,[m,"Amazon"],[_,C]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[g,E.str,P.device.amazon.model],[m,"Amazon"],[_,w]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[g,m,[_,w]],[/\((ip[honed|\s\w*]+);/i],[g,[m,"Apple"],[_,w]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[m,g,[_,w]],[/\(bb10;\s(\w+)/i],[g,[m,"BlackBerry"],[_,w]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[g,[m,"Asus"],[_,C]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[m,"Sony"],[g,"Xperia Tablet"],[_,C]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[m,"Sony"],[g,"Xperia Phone"],[_,w]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[m,g,[_,y]],[/android.+;\s(shield)\sbuild/i],[g,[m,"Nvidia"],[_,y]],[/(playstation\s[34portablevi]+)/i],[g,[m,"Sony"],[_,y]],[/(sprint\s(\w+))/i],[[m,E.str,P.device.sprint.vendor],[g,E.str,P.device.sprint.model],[_,w]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[m,g,[_,C]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[m,[g,/_/g," "],[_,w]],[/(nexus\s9)/i],[g,[m,"HTC"],[_,C]],[/(nexus\s6p)/i],[g,[m,"Huawei"],[_,w]],[/(microsoft);\s(lumia[\s\w]+)/i],[m,g,[_,w]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[g,[m,"Microsoft"],[_,y]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[m,"Microsoft"],[_,w]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[g,[m,"Motorola"],[_,w]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[g,[m,"Motorola"],[_,C]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[m,T.trim],[g,T.trim],[_,k]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[m,"Samsung"],[_,k]],[/\(dtv[\);].+(aquos)/i],[g,[m,"Sharp"],[_,k]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[m,"Samsung"],g,[_,C]],[/smart-tv.+(samsung)/i],[m,[_,k],g],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[m,"Samsung"],g,[_,w]],[/sie-(\w+)*/i],[g,[m,"Siemens"],[_,w]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[m,"Nokia"],g,[_,w]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[g,[m,"Acer"],[_,C]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[m,"LG"],g,[_,C]],[/(lg) netcast\.tv/i],[m,g,[_,k]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[g,[m,"LG"],[_,w]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[g,[m,"Lenovo"],[_,C]],[/linux;.+((jolla));/i],[m,g,[_,w]],[/((pebble))app\/[\d\.]+\s/i],[m,g,[_,x]],[/android.+;\s(glass)\s\d/i],[g,[m,"Google"],[_,x]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[g,/_/g," "],[m,"Xiaomi"],[_,w]],[/android.+a000(1)\s+build/i],[g,[m,"OnePlus"],[_,w]],[/\s(tablet)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[_,T.lowerize],m,g]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[v,[f,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[f,v],[/rv\:([\w\.]+).*(gecko)/i],[v,f]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[f,v],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[f,[v,E.str,P.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[f,"Windows"],[v,E.str,P.os.windows.version]],[/\((bb)(10);/i],[[f,"BlackBerry"],v],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[f,v],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[f,"Symbian"],v],[/\((series40);/i],[f],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[f,"Firefox OS"],v],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[f,v],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[f,"Chromium OS"],v],[/(sunos)\s?([\w\.]+\d)*/i],[[f,"Solaris"],v],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[f,v],[/(haiku)\s(\w+)/i],[f,v],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[f,"iOS"],[v,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[f,"Mac OS"],[v,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[f,v]]},F=function(e,t){if(!(this instanceof F))return new F(e,t).getResult();var i=e||(s&&s.navigator&&s.navigator.uson(){var e=E.rgx.apply(this,n.browser);return e.major=T.major(e.version),e},this.getCPU=function(){return E.rgx.apply(this,n.cpu)},this.getDevice=function(){return E.rgx.apply(this,n.devic.apply(this,n.ehis.getEngine(),os:this.getOS(),device:this)}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this};F.VERSION=r,F.BROWSER={NAME:f,MAJOR:p,VERSION:v},F.CPU={ARCHITECTURE:b},F.DEVICE={MODEL:g,VENDOR:m,TYPE:_,CONSOLE:y,MOBILE:w,SMARTTV:k,TABLET:C,WEARABLE:x,EMBEDDED:S},F.ENGINE={NAME:f,VERSION:v},F.OS={NAME:f,VERSION:v},typeof t!==u?(typeof e!==u&&e.exports&&(t=e.exports=F),t.UAParser=F):"function"===c&&i(851)?(n=function(){return F}.call(t,i,t,e),!(n!==o&&(e.exports=n))):s.UAParser=F;var A=s.jQuery||s.Zepto;if(typeof A!==u){vaset=function(e){M.setUA(e);var t=M.getRef window?window:this)},functiion(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.allowedEventNames=void 0;var a=i(3),l=n(a),c=i(846),u=n(c),h=i(849),d=n(h),p=(t.allowedEventNames=["follow","impression","like","reblog","share","unfollow","unlike","supply_serve","supply_rotate","supply_unload","supply_viewable","NotificationBlogSwitch","NotificationClick","NotificationFollowClick","NotificationRebloggerClick","NotificationPostPreviewClick","NotificationReplyClick","NotificationFlagIconClick","ClickLogin","ClickSignup","ActivityClick","AccountClick","SearchPopover","SearchExecute","SignUpCTAClickRegister","NotesInteractionOpen","Messaging:inbox:open","Messaging:inbox:closed","Messaging:conversation:started","Messaging:conversation:deleted","Messaging:conversation:open","Messaging:conversation:closed","Messaging:conversation:follow","Messaging:conversation:windows:loaded","Messaging:conversation:minimized","Messaging:conversation:unminimized","Messaging:conversation:spam:intent","Messaging:conversation:spam:success","Messaging:conversation:spam:fail","Messaging:messaging-image-upload:add","Messaging:messaging-image-upload:dismiss","Messaging:messaging-image-upload:edit","Messaging:messaging-image-upload:intent","Messaging:messaging-gif:add","Messaging:messaging-gif:dismiss","Messaging:messaging-gif:edit","Messaging:messaging-gif:intent","Messaging:post-chrome:add","Messaging:post-chrome:dismiss","Messaging:post-chrome:edit","Messaging:post-chrome:intent","Messaging:message:sent","Messaging:message:failure","Messaging:block","Messaging:notification:display","Messaging:notification:permission:granted","Messaging:notification:permission:denied","Messaging:peepr:open","Messaging:conversation-permalink:open","Messaging:new:inbox:empty:new-message:button:click","Messaging:old:inbox:empty:new-message:button:click","customTheme:enabled","customTheme:disabled","cname:enabled","cname:disabled","Transparency:report","blocks:block_added","blocks:ip_block_added","blocks:blocklist:more_loaded","blocks:blocklist:opened","blocks:block_added:block_already_exists","blocks:block_removed","abuseform:open","abuseform:close","abuseform:submitted","abuseform:stepviewed","abuseform:contentpreview:close","helpform:closed","helpform:opened:withButton","helpform:close","helpform:open","helpform:opened:withLink","helpform:navigateBackToHelp","loginregister:captchaShown","loginregister:flowComplete","loginregister:beginFlow","peepr:open","peepr:postsAndBlogFetch","peepr:like_update","peepr:close","peepr:follow_update","peepr:timeline:posts-fetched","peepr:log:close","peepr:log:paginate","peepr:log:peepr_reblog","peepr:log:peepr_reblog_success","peepr:log:peepr_like_update","peepr:log:peepr_follow","peepr:log:reload","peepr:log:load","peepr:log:ajax-error","peepr:timeline:posts-fetched","MagicLink:LoginSuccess","MagicLink:Sent","MagicLink:UsePasswordButtonPressed","MagicLink:BackButtonPressed","safeMode:SafeModeToggled","safeMode:BlogFlaggedAdultByUser","safeMode:FilteringSettingLinkClicked","safeMode:SafeModeBlogPageShown","safeMode:NsfwPostPreview","safeMode:PFNSFW","safeMode:SurveyOptionSelected","safeMode:FilteringSettingLinkClicked","safeMode:NsfwDocLinkClicked","safeMode:SafeModeSafeSearchToggleClicked","ReviewExplicitClick","InfoExplicitClick","InfoExplicitReblogClick","RequestReviewExplicit","CancelReviewExplicit","LearnMoreExplicit","ScreenView","EditPost","Teads"],function(e){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n)),a=r.data,c=a.extraData,u=a.eventDetails,h=a.eventString,p=a.ts,g=a._experiments,f=a._clientOverrides;r.experiments=g||{},r.overrides=f||{},delete r.data._experiments,delete r.data._clientOverrides;var _=new d.default(window,r.overrides);return r.json.event_data.kraken={event_name:h||r.name,client_session_id:_.sessionID||"",page:_.screenType||"Unknown",section:_.section||"",client_timestamp:p||Date.now(),event_details:l.default.assign({},c,u,l.default.omit(r.data,"pt","extraData","eventDetails")),experiments:r.experiments},r}return r(t,e),t}(u.default));t.default=p},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"reactivation",logOptions:{init_event:!1},events:{"reactivation:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"notes_interactions",logOptions:{init_event:!1},logEnv:{location:document.location.pathname},events:{"notes-interactions:*":"log"}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"postchrome_interactions",logOptions:{init_event:!1},events:{"postchrome-interactions:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"toastlog",events:{"toastlog:*":"log"}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"async_loading",events:{"async-loading:*":"log"}});e.exports=s},function(e,t,i){"use strict";var n=i(818),s=n.extend({logKey:"ads_interactions",logOptions:{init_event:!1},events:{"ads-interaction:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=s},function(e,t,i){"use strict";var n=i(237);n({"Tumblr.Prima.Upload":i(523),"Tumblr.Prima.Ligature":i(293),"Tumblr.Events":i(136),"Tumblr.Prima.Events":i(136),"Tumblr.Prima.Dialog":i(213),"Tumblr.Dialog":i(213),"Tumblr.PostMessageChannel":i(861),"Tumblr.Prima.DOMEventor":i(181),"Tumblr.Prima.gutterMediaManager":i(864),"Tumblr.Prima.Vendor.when":i(192),"Tumblr.Prima.Vendor.sequence":i(239),"Tumblr.log_lady":i(865),"Tumblr.Prima.logLady":i(865),"Tumblr.Prima.Models.Post":i(347),"Tumblr.Prima.Models.Tumblelog":i(191),"Tumblr.Prima.CrtPlayer":i(428),"Tumblr.Prima.CrtControl":i(427),"Tumblr.Prima.BlogCard":i(868),"Tumblr.Prima.Url":i(265),"Tumblr.Prima.ToolTip":i(878),"Tumblr.Prima.SharePopover":i(341),"Tumblr.Prima.Messaging.SharePost":i(881),"Tumblr.Prima.utils.caniuse":i(430),"Tumblr.Prima.ConfettiView":i(911),"Tumblr.Prima.FlatSelect":i(925),"Tumblr.Prima.Mixins.loggingData":i(348),"Tumblr.Prima.Mixins.withFormKeyTrue":i(186),"Tumblr.Prima.Scrollbar":i(485),"Tumblr.Prima.MessageControlsPopover":i(927),"Tumblr.Prima.Block":i(212),"Tumblr.Prima.SafeMode":i(929),"Tumblr.Prima.PeeprSearch":i(930),"Tumblr.Prima.MessagingPopover":i(944),"Tumblr.Prima.currentUser":i(182),"Tumblr.Prima.AdsPaginationHelper":i(951),"Tumblr.Prima.SortableView":i(316),"Tumblr.Prima.getLoggingPayloadFromNote":i(952),"Tumblr.Prima.Snowman":i(873),"Tumblr.Prima.postActivityLoader":i(953),"Tumblr.Prima.KnightRiderLoader":i(331),"Tumblr.Prima.Lib.hosts":i(959),"Tumblr.Prima.LivePhotos":i(544),"Tumblr.Prima.Carousel":i(1002),"Tumblr.Prima.ExpandableTags":i(1007),"Tumblr.Prima.Translate":i(130),"Tumblr.Prima.NativeAudio":i(596),"Tumblr.Prima.CTAButton":i(1010),"Tumblr.Prima.Viewability":i(1011),"Tumblr.Prima.ViewabilityTracker":i(1021),"Tumblr.Prima.StatusIndicator":i(686),"Tumblr.Prima..apply(t,arguments),e},this.cid=t.cid}var t=this;return new e},e.exports=n},function(e,t,i){"use strict";var n=i(214),s=i(181),o=i(136),r=i(8),a=i(3),l=n.extend({name:"GutterMediaManager",gutteredView:null,gutterMargin:17,gutterWidth:300,maxViewWidth:300,viewportTransitionWidth:990,initialize:function(){this.layoutHasGutter=this.$right_colright_column||(this._$right_column=r(".right_column")),this._$right_column},toggleBackground:function(e){this.layoutHasGutter&&(e?(this.$right_column().addClass("has_docked_post"),this.$right_column().on("click.gutterManager",a.bind(this.handleGutterClick,this))):(this.$right_column().removeClass("has_docked_post"),this.$right_column().off("click.gutterManager")))},putViewInGutter:function(e,t){return t=a.defaults(t||{},{winRect:s.rect(),gutterPosition:this.gutterPosition(),animation:null,dimRadar:!0,removeOnGutterClick:!1,onDock:a.noop,onUndock:a.noop,dockLoggingName:"post:docked",dockLoggingData:null,undockLoggingName:"post:undocked",undockLoggingData:null}),!!this.isDockable(e,t)&&(t.onDock=t.onDock||a.noop,this.gutteredView&&this.removeGutteredView(),this.gutteredView={view:e,options:t},t.onDock.call(e,t),t.dimRadar&&this.toggleBackground(!0),t.dockLoggingName&&t.dockLoggingData&&o.trigger(t.dockLoggingName,{loggingData:t.dockLoggingData}),this.gutteredView)},removeGutteredView:function(){if(this.gutteredView){var e=this.gutteredView.options,t=this.gutteredView.view;e.onUndock=e.onUndock||a.noop,e.onUndock.call(t,e),this.gutteredView=null,e.dimRadar&&this.toggleBackground(!1),e.undockLoggingName&&e.undockLoggingData&&o.trigwInGutter:function(e){return this.gutteredView&&this.gutteredView.view===e},isDockable:function(e,t){if(!this.gutteredView)return!0;var i=!this.gutteredView||this.gutteredView.options.alwaysEvict,n=t.alwaysEvict;return!(this.gutteredView.view===e||n&&!i)},handleGutterClick:function(e){this.gutteredView&&(e.preventDefault(),this.gutteredView.options.removeOnGutterClick&&this.removeGutteredView())},gutterPosition:function(){var e=s.rect(),t=this.viewportTransitionWidth/2-this.gutterMargin-this.gutterWidth,i={width:this.maxViewWidth,left:"50%",bottom:20,translateX:t},n=this.maxViewWidth-this.gutterWidth+this.viewportTransitionWidth;return e.windowWidth<n&&(i.width=n-e.windowWidth),i.width<this.gutterWidth&&(i.width=this.gutterWidth),i}});e.exports=new l},function(e,t,i){"use strict";var n=i(866);e.exports=n},function(e,t,i){"use strict";var n=i(136),s=i(821),o=i(831),r=i(867),a=new s({EventClass:o,event_payload_name:"events",event_filter:r,endpoint:"/svc/log/lady"});n.on("Capture:push",function(e,t,i){a.log(e,{init_event:!1}).trigger(t,i)}),e.exports=a},fun),o=n.keys(s("keys"));e.exports=function(e){return o.indexOf(e.log_key)>=0}},function(e,t,i){"use strict";e.exports=i(869)},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(870),r=i(876),a=s.extend({defaults:{include_info_popover:!0,disableUnfollowConfirm:!1},className:"poptica_header",initialize:function(e){this.options=n.extend({},this.defaults,e);var t=n.extend({model:this.model},n.pick(this.options,"targetPost","include_info_popover","disableUnfollowConfirm"));this.header=new o(t),this.posts=new r({model:this.model}),this.bindEvents()},bindEvents:function(){this.listenToOnce(this.header,"ready",this._triggerReady)},_triggerReady:function(){this.trigger("ready")},render:function(){return this.$el.append(this.header.render().el,this.posts.render().el),this}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(180),r=i(129),a=i(219),l=i(136),c=i(672),u=i(265),h=i(130),d=i(871),p=i(872),g=i(873),f=a.extend({className:"indash_tumblelog_compact",template:d,defaults:{current_data:{},unfollow_data:{},follow_data:{},template_data:{},hide_posts_on_unfollow:!1,stripDescriptionLineBreaks:!1,include_info_popover:!0},events:{"click .description a":"_descriptionLinkClicked","click .info_popover_button":"_infoPopoverButtonClicked","click .follow":"_onFollowClick","click .unfollow":"_onFollowClick"},initialize:function(e){if(this.options=n.extend({},this.defaults,e||{}),this.bindEvents(),this.is_rendered=!1,this.assets_host=r.get("Context/hosts/assets_host")||"",this.$description=null,this.$description_inner=null,!n.isEmpty(this.current_data)){var t=n.extend({},this.current_data,this.model.toJSON());this.model.set(t,{silent:!0})}this.model.get("global_theme_params")&&n.delay(n.bind(this.render,this),1)},bindEvents:function(){this.listenTo(this.model,"change:following",this._renderFollowButton),this.listenTo(this.model,"change:global_theme_params",this.render)},render:function(){var e=this.model.toJSON();if(e.following||(e.following=!1),this.is_rendered||!e.global_theme_params)return this;var t=n.result(p,e.global_theme_params.title_font),i=c.hexToRgb(e.global_theme_params.title_color);return this.$el.html(this.template(n.merge({},e,{hide_headers_flag:o.bool("hide_default_headers_blog_cards"),blog_card_compact:!0,show_navigation:!0,show_share_controls:!1,show_user_controls:this.options.include_info_popover,show_follow_button:!0,show_dismiss_controls:!1,title_font_family:!!t&&t.family,title_color_rgb:String(n.values(i).join(",")),followText:h("Follow"),unfollowText:h("Unfollow")},this.options.template_data))),this.$description=this.$(".description"),this.$description_inner=this.$description.find(".description_inner"),this._renderFontStyles(),this._renderInlineStyles(),this.__addSnowMan(),this.is_rendered=!0,this.$description.length&&(n.delay(n.bind(this.truncateDescription,this),100),this.options.stripDescriptionLineBreaks&&this.stripDescriptionLineBreaks()),this.trigger("ready"),this},stripDescriptionLineBreaks:function(){this.$description_inner.find("br").remove();var e=this.$description_inner.html(),t=e.replace(/[\n\r]/g," ");this.$description_inner.html(t)},truncateDescription:function(){var e=this.$description_inner.get(0);if(!(e.scrollHeight<=e.clientHeight)){var t=this.model.get("global_theme_params"),i=t.background_color,s=c.hexToRgb(i);this.$description.append(this.description_gradient_template({background_color:String(n.values(s).join(","))}))}},__addSnowMan:function(){var e={el:this.$("[data-snowman-container]"),tumblelogName:this.model.get("name")};this.options.include_info_popover&&(e.infoPopover={el:this.$el,auto_show:!1,trigger:this.$el.find(".info_popover_button"),useRecipient:!0,showAsks:!0,showAnonymousAsks:!0,skip_glass:!0,targetPost:this.options.targetPost}),this.snowman=new g(e)},_onFollowClick:function(e){if(e.preventDefault(),!o.bool("is_logged_in"))return void window.open("/follow/"+this.model.get("name"),"_self");var t={follow_data:this.options.follow_data};this.model.get("following")?this._confirm_unfollow(t):(l.trigger("tumblelog:log_follow"),this.model.follow(t))},_confirm_unfollow:function(e){var t={tumblelog:this.model.get("name")},i=this.model.requestUnfollow();if(this.options.disableUnfollowConfirm)i.resolve(),l.trigger("tumblelog:log_unfollow",{loggingData:t});else{var n=h("Are you sure you want to unfollow %1$s?").replace("%1$s","<strong>"+this.model.get("name")+"</strong>"),s={text:n,text_ok:h("Ok"),text_cancel:h("Nevermind")};i.promise.then(function(){l.trigger("tumblelog:log_unfollow",{loggingDat.preventDefault(),e.stopPropagation(),l.trigger("popticainfopopover:show")},_descriptionLinkClicked:function(e){e.preventDefault();var t=s(e.currentTarget).attr("href");try{if(u&&u.hasAllowedProtocol(t)){if(!u.isAbsoluteUrl(t)){var i="http://"+this.model.get("name")+".tumblr.com/";t="/"===t.charAt(0)?t.substr(1):t,t=i+t}window.open(t,"_blank")}}catch(e){}},_renderFollowButton:function(){var e=this.model.get("following");this.$el.find(".follow").toggle(!e),this.$el.find(".unfollow").toggle(e)},_hidePosts:function(){},_open_dialog:function(e,t){function i(e,t){e.is_disabled=e.is_menu_open,t&&t()}this.is_disabled=!0,e.fail(n.bind(i,null,this)),e.done(n.bind(i,null,this,t))},_renderInlineStyles:function(){var e=this.model.get("global_theme_params"),t=this.model.get("has_default_header")&&o.bool("hide_default_headers_blog_cards"),i=!(!(e.header_image_focused&&e.header_stretch&&e.show_header_image)||t),n=c.hexToHsv(e.background_color),s=c.hexToHsv(e.link_color),r=e.link_color;return c.compare(s,n)&&(r=c.readable(n)),i||(this.$(".navigation .nav_icon").css("color",r),this.$(".navigation .blog_name").css("color",r),this.$(".navigation button").css({color:e.background_color,"background-color":r})),this.$(".description a").css("color",e.link_color),this},_renderFontStyles:function(){if(p){var e=this.model.get("global_theme_params");if(n.has(p,e.title_font)){var t=n.result(p,e.title_font),i="webfont_"+t.path;if(t.path&&!s("head #"+i).length){var o=this.assets_host+"/fonts/"+t.path+"/stylesheet.css";o+=n.has(t,"_v")?"?v="+t._v:"",s("<link>",{id:i,rel:"stylesheet",type:"text/css",href:o}).appendTo(s("head"))}}}},description_gradient_template:n.template('<div class="description_gradient" style="background: -moz-linear-gradient(top,  rgba(<%= background_color %>,0) 0%, rgba(<%= background_color %>,0.75) 50%, rgba(<%= background_color %>,1) 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(<%= background_color %>,0)), color-stop(50%,rgba(<%= background_color %>,0.75)), color-stop(100%,rgba(<%= background_color %>,1)));background: -webkit-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -o-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -ms-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: linear-gradient(to bottom, rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);"></div>')});e.exports=f},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){var is_blog_card_compact="boolean"==typeof blog_card_compact&&blog_card_compact,has_avatar=avatar_url&&global_theme_params.show_avatar,has_bg_img=global_theme_params.header_image_focused&&global_theme_params.show_header_image,has_title=title&&global_theme_params.show_title,has_description=description_sanitized&&global_theme_params.show_description,hide_default_header=!!is_blog_card_compact&&(has_default_header&&hide_headers_flag),expanded_name=cname?cname:name+".tumblr.com",description_color=title_color_rgb?"rgba("+title_color_rgb+",0.7)":global_theme_params.title_color,header_class=global_theme_params.header_stretch?"":" no_stretch_header";header_class+=has_bg_img&&!hide_default_header?"":" no_header_image",header_class+=has_avatar?"":" no_avatar",header_class+=!has_bg_img||hide_default_header||has_avatar||has_title||has_description?"":" header_image_only",header_class+=has_title||has_description?" has_info":" no_info",__p+=' <div class="indash_header_wrapper '+(null==(__t=header_class)?"":__t)+" tumblelog_name_"+__e(name)+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; color:"+(null==(__t=global_theme_params.title_color)?"":__t)+'"> ',show_navigation&&(__p+=' <div class="navigation"><div class="navigation_bg" style="background-color: '+(null==(__t=global_theme_params.background_color)?"":__t)+'"></div><div class="navigation_inner"> ',"undefined"!==name&&(__p+=' <h3><a href="'+__e(url)+'" target="_blank" class="blog_name" data-peepr=\'{"tumblelog": "'+__e(name)+'"}\'><span class="name"> '+__e(name)+' </span><span class="full_url">'+__e(expanded_name)+"</span></a></h3> "),__p+=" ",show_share_controls&&(__p+=' <a class="open_blog_button nav_icon icon_export"></a> '),__p+=" ",!customizable&&show_user_controls&&(__p+=' <a data-snowman-container class="info_popover_button nav_icon user_dropdown_lockup"><i class="user_dropdown_icon user_dropdown_icon_user icon_user_settings"></i> </a> '),__p+=" ",!customizable&&show_follow_button&&(__p+=" ",__p+=following?' <button class="chrome unfollow" type="button">'+__e(unfollowText)+'</button> <button class="chrome follow" type="button" style="display:none">'+__e(followText)+"</button> ":' <button class="chrome unfollow" type="button" style="display:none">'+__e(unfollowText)+'</button> <button class="chrome follow" type="button">'+__e(followText)+"</button> ",__p+=" "),__p+=" </div></div> "),__p+=" ",global_theme_params.header_image_focused&&global_theme_params.show_header_image&&!hide_default_header&&(__p+=' <div class="header_image_wrapper',has_avatar&&(__p+=" has_avatar"),__p+='"><div class="header_image" style="background-image:url('+__e(global_theme_params.header_image_focused)+')"> ',__p+=is_blog_card_compact||!customizable?' <a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+__e(global_theme_params.header_image_focused)+'" data-peepr=\'{"tumblelog": "'+__e(name)+'"}\' alt="'+__e(title)+'"> </a> ':' <img src="'+__e(global_theme_params.header_image_focused)+'" alt=""> ',__p+=" </div></div> "),__p+=" ",avatar_url&&global_theme_params.show_avatar&&(__p+=' <div class="avatar '+(null==(__t=global_theme_params.avatar_shape)?"":__t)+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; background-image:url("+(null==(__t=avatar_url)?"":__t)+"); color:"+(null==(__t=global_theme_params.background_color)?"":__t)+'"> ',__p+=is_blog_card_compact||!customizable?' <a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+(null==(__t=avatar_url)?"":__t)+'" data-peepr=\'{"tumblelog": "'+__e(name)+'"}\' alt="'+__e(title)+'"></a> ':' <img src="'+(null==(__t=avatar_url)?"":__t)+'" alt=""> ',__p+=" </div> "),__p+=" ",(has_title||has_description)&&(__p+=' <div class="info_wrapper"><div class="info"> ',has_title&&(__p+=' <h1 class="title" style="font-family:'+(null==(__t=title_font_family||"inherit")?"":__t)+"; font-weight:"+(null==(__t=global_theme_params.title_font_weight)?"":__t)+'">'+__e(title)+"</h1> "),__p+=" ",has_description&&(__p+=' <div class="description" style="color:'+(null==(__t=description_color)?"":__t)+'"><div class="description_inner">'+(null==(__t=description_sanitized)?"":__t)+"</div></div> "),__p+=" </div></div> "),__p+=" </div>"}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t){"use strict";var i={"1785 GLC Baskerville":{display_name:"1785 Baskerville",family:"'1785 GLC Baskerville', serif",path:"1785glcbaskerville",_v:"1"},"Alternate Gothic":{display_name:"Alternate Gothic",family:"'Alternate Gothic', sans-serif",path:"alternategothic",_v:"3"},Arquitecta:{display_name:"Arquitecta",family:"'Arquitecta', sans-serif",path:"arquitecta",_v:"3"},Avalon:{display_name:"Avalon",family:"'Avalon', sans-serif",path:"avalon",_v:"1"},Baskerville:{display_name:"Baskerville",family:"Baskerville, 'Times New Roman', Times, serif"},"Bodoni Recut FS":{display_name:"Bodoni",family:"'Bodoni Recut FS', serif",path:"bodonirecutfs",_v:"3"},Bookmania:{display_name:"Bookmania",family:"'Bookmania', serif",path:"bookmania",_v:"1"},"Brutal Type":{display_name:"Brutal Type",family:"'Brutal Type', sans-serif",path:"brutaltype",_v:"1"},Calluna:{display_name:"Calluna",family:"'Calluna', serif",path:"calluna",_v:"3"},"Calluna Sans":{display_name:"Calluna Sans",family:"'Calluna Sans', sans-serif",path:"callunasans",_v:"3"},Capita:{display_name:"Capita",family:"'Capita', serif",path:"capita",_v:"1"},"Caslon FS":{display_name:"Caslon FS",family:"'Caslon FS', serif",path:"caslonfs",_v:"3"},"Clarendon Text Pro":{display_name:"Clarendon",family:"'Clarendon Text Pro', serif",path:"clarendontextpro",_v:"3"},"Clearface FS":{display_name:"Clearface",family:"'Clearface FS', serif",path:"clearface",_v:"4"},FangSong:{display_name:"Fang Song",family:"'FangSong', 'STFangsong', sans-serif"},Favorit:{display_name:"Favorit",family:"'Favorit', sans-serif",path:"favorit",_v:"1"},"Garamond Classic FS":{display_name:"Garamond",family:"'Garamond Classic FS', serif",path:"garamondclassicfs",_v:"3"},Georgia:{display_name:"Georgia",family:"Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif"},Gibson:{display_name:"Gibson",family:"'Gibson', sans-serif",path:"gibson",_v:"3"},"Grumpy Black 48":{display_name:"Grumpy",family:"'Grumpy Black 48', serif",path:"grumpyblack48",_v:"3"},"Helvetica Neue":{display_name:"Helvetica",family:"'Helvetica Neue', Arial, Helvetica, sans-serif"},Kaiti:{display_name:"Kaiti",family:"'Kaiti TC', 'KaiTi', sans-serif"},"Lorimer No 2":{display_name:"Lorimer No 2",family:"'Lorimer No 2', sans-serif",path:"lorimerno2",_v:"3"},"Lucida Sans":{display_name:"Lucida Sans",family:"'Lucida Sans', 'Lucida Grande', 'Lucida Sans Unicode', sans-serif"},"News Gothic FS":{display_name:"News Gothic",family:"'News Gothic FS', sans-serif",path:"newsgothicfs",_v:"3"},"Pratt Pro":{display_name:"Pratt Pro",family:"'Pratt Pro', serif",path:"prattpro",_v:"1"},Quadrat:{display_name:"Quadrat",family:"'Quadrat', serif",path:"quadrat",_v:"1"},SimHei:{display_name:"Sim Hei",family:"'SimHei', 'STHeiti', sans-serif"},"Sofia Pro":{display_name:"Sofia Pro",family:"'Sofia Pro', sans-serif",path:"sofiapro",_v:"2"},Spade:{display_name:"Spade",family:"'Spade', serif",path:"spade",_v:"1"},"Square Serif":{display_name:"Square Serif",family:"'Square Serif', serif",path:"squareserif",_v:"4"},Streetscript:{display_name:"Streetscript",family:"'Streetscript', sans-serif",path:"streetscript",_v:"1"},"Typewriter FS":{display_name:"Typewriter",family:"'Typewriter FS', serif",path:"typewriterfs",_v:"1"},Verdana:{display_name:"Verdana",family:"Verdana, Geneva, Tahoma, sans-serif"},Ziclets:{display_name:"Ziclets",family:"'Ziclets', serif",path:"ziclets",_v:"1"}};e.exports=i},function(e,t,i){"use strict";var n=i(214),s=i(874),o=n.extend({name:"Snowman",autoAppend:!0,initialize:function(e){this.view=new s(e)}});e.exports=o},function(e,t,i){"use strict";var n=i(226),s=i(875),o=i(191),r=n.extend({template:s,defaults:{canSubscribe:!1},events:{click:"__toggleInfoPopover"},initialize:function(e){return this.options=e,this.model||(this.model=new o({name:this.options.tumblelogName})),this.set({canSubscribe:this.model.get("can_subscribe"),isSubscribed:this.model.get("is_subscribed"),isBlocking:this.model.get("is_blocking")}),this.listenTo(this.model,"change:is_subscribed",this.__subscribeActionSuccess),e.infoPopoverOnDemand||this.__createInfoPopover(),this},__subscribeActionSuccess:function(e){if(e.id===this.model.get("name")){var t=this.model.get("is_subscribed");this.$("[data-subscription-indicator]").toggleClass("is-subscribed",t)}},__toggleInfoPopover:function(e){e.preventDefault(),e.stopPropagation(),this.options.infoPopoverOnDemand&&!this.infoPopover&&this.__createInfoPopover(),this.infoPopover.toggle()},__createInfoPopover:function(){this.options.infoPopover&&(this.options.infoPopover.model=this.model,this.options.infoPopover.url=this.model.get("url"),this.options.infoPopover.useRecipient&&(this.options.infoPopover.recipient=this.model.get("name")),this.options.infoPopover.showAsks&&(this.options.infoPopover.asks=this.model.get("asks")),this.options.infoPopover.showAnonymousAsks&&(this.options.infoPopover.anonymous_asks=this.model.get("anonymous_asks")),this.infoPopover=new Tumblr.TumblelogPopover.PopticaInfoPopover(this.options.infoPopover))}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<span class="snowman-container"><i data-subscription-indicator class="subscribe-activity '+(null==(__t=canSubscribe&&isSubscribed?"is-subscribed":"")?"":__t)+'"></i> <i class="snowman-icon"></i></span>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(219),r=i(136),a=i(877),l=o.extend({className:"recent_posts",template:a,events:{"click a":"onPostClick",mouseenter:"onMouseEnter"},defaults:{on_bottom:!0,blog_bg_color:!0,$popover:s(),min_load_time:500,model:{},dashboard_post:{}},initialize:function(e){n.extend(this,this.defaults,e),this.model&&(this.renderLoader(),this.renderInlineStyles(),this.posts=this.model.get("highlighted_posts"),n.isUndefined(this.posts)&&this.fetchPosts(),this.bindEvents())},bindEvents:function(){this.listenTo(this.model,"change:highlighted_posts",this.render),this.listenTo(thPosts:function(){this.model.fetch_popover_data({is_tumblelog_popover:!0})},updatePosts:function(e){this.model=e,this.posts=this.model.get("highlighted_posts"),n.isUndefined(this.posts)?this.fetchPosts():this.render(!0)},renderLoader:function(){var e=this.model.toJSON();this.$el.html(this.template({loader_color:e.global_theme_params?e.global_theme_params.title_color:"#D9D9D9"}))},renderInlineStyles:function(){var e=this.model.get("global_theme_params");e&&this.blog_bg_color&&(this.$el.css("background-color",e.background_color),this.$el.css("color",e.title_color))},render:function(e){var t=this.posts||this.model.get("highlighted_posts");if(!n.iout(n.bind(function(){this.$popover.addClass("is_empty"),this.$el.html("")},this),this.min_load_time),this):(this.$el.addClass("has_"+t.lengttml(i):setTimeout(n.bind(function(){this.$el.addClass("is_loaded").html({},onMouseEnter:function(e){r.trigger("TumblelogPopover:mouseenter_posts")}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj){var color="undefined"!=typeof loader_color?loader_color:"#D9D9D9";__p+=' <div class="Knight-Rider-loader centered animate"><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div></div>'}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(214)ass_name:"tumblr_tooltip",initialize:function(e){this.toolTipView=new s(e)}});e.exports=o},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(219),r=i(880),a=o.extend({class_name:"tumblr_tooltip",template:r,defaults:{selector:"",class_name:"",offset:"50%",placement:"up"},initialize:function(e){this.options=e||{},this.options.selector=n.trim((e.selector||this.defaults.selector)+" "),this.options.class_name=e.class_name||this.defaults.class_name,this.options.offset=e.offset||this.defaults.offset,this.options.placement=e.placement||this.defaults.placement,this.tooltips=n(this.options.selector+"[data-tooltip]"),this.tooltips.on("remove",n.proxy(this.remove,this)),this.tooltips.on("mouseenter",s.bind(this.show,this)),this.tooltips.on("mouseleave",s.bind(this.hide,this))},show:function(e){var t=n(e.currentTarget);this.tooltip_template_data={tooltip:t.data("tooltip")};var i=n(this.tooltip(this.tooltip_template_data));t.append(i),this.setElement(i),this.delegateEvents(),i.removeClass("is_closed").addClass("is_open")},hide:function(e){var t=n(e.currentTarget),i=t.find("."+this.class_name);i.removeClass("is_open").addClass("is_closed"),i.on("transitionend webkitTransitionEnd oTrans(e){this.remove(e)},this))},remove:function(e){n(e.currentTarget).remove()},tooltip:function(e){return this.class_name="tooltip_wrapper",this.attributes={text:e.tooltip,placement:this.options.placement,class_name:this.options.class_name,left_css:this.options.offset},this.template(this.attributes)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="tooltip_wrapper '+__e(placement)+" "+__e(class_name)+'" style="left:'+__e(left_css)+'"><div class="tooltip"> '+(null==(__t=text)?"":__t)+" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(7),o=i(214),r=i(182),a=i(191),l=i(136),c=i(882),u=i(883),h=i(705),d=i(670),p=i(924),g=new h,f=o.extend({
name:"MessagingSharePost",initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),this.options=e,this.user=r(),this.channels=this._getChanneLogger=new c},render:function(){return this.openPopover(this.options),this},openPopover:function(e){var t,i,s=n.get(e,"postId"),o=n.get(e,"blogUuid"),r=n.get(e,"isNsfw"),a=n.get(e,"favoritesNames",[]),l=n.get(e,"popoverContainer"),c=n.get(e,"pinnedTarget"),h=n.get(e,"externalNetworksData",{}),d=new p(n.extend({post_id:s,tumblelog_name:o},h));return n.isEmpty(s)?null:n.isEmpty(o)?null:n.isEmpty(c)?null:(t={viewOptions:n.bind(function(e){return{shareData:{blogUuid:o,postId:s,isNsfw:r},popoverContainer:e.el,favoritesCollection:g,additionalFavorites:this._getAdditionalFavoritesAsParticipants(a),channels:this.channels,externalNetworksDataModel:d,isExternalSharingEnabled:this.isExternalSharingEnabled(),senderBlogUuid:this.user.getCurrentMessagingChannelUuid()}},this),autoTeardown:!0,teardownOnEscape:!1,pinnedSide:"bottom",isFixedPosition:!1,pinnedTarget:c,popoverContainer:l},this.messagingShareLogger.logShareIntent(s,o)nabled:function(){return n.get(this.data,"is_external_sharing_enabled",!1)},_afterPopoverOpen:function(e){var t=e.getView();this.listenToOnce(e,"close",function(){this._onPopoverClose(e)}),this.listenTo(t,"external:click",this._onPopoverExternalNetworkShareClick),this.listenTo(t,"external:success",this._onPopoverExternalNetworkShareSuccess),this.listenTo(t,"external:fail",this._onPopoverExternalNetworkShareFail),l.trigger("keycommands:suspend")},_onPopoverClose:function(e){this.stopListening(e),this.stopListening(e.getView()),l.trigger("keycommands:resume")},_onPopoverExternalNetworkShareClick:function(e){this.messagingShareLogger.logExternalNetworkClicked(e)},_onPopoverExternalNetworkShareSuccess:function(e){this.messagingShareLogger.logExternalNetworkShareSuccess(e)},_onPopoverExternalNetworkShareFail:function(e){this.messagingShareLogger.tion(){return new s.Collection(this.user.getChannelsEnabledForMessaging())},_getAdditionalFavoritesAsParticipants:function(e){return n.reduce(e,function(e,t){var i=new a({name:t});return i.get("uuid")&&i.get("can_receive_messages")&&e.push(new d(i.toJSON(),{parse:!0})),e},[],this)}});e.exports=f},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(214),r=i(136),a=o.extend({name:"MessagingShareLogger",defaults:{namespace:"postchrome-interactions",platform:"web",isDebugEnabled:!1},initialize:function(e){e=s.extend({},eIntent:function(e,t){this._logIt("share:intent",{postId:e,postBlogUuid:t})},logExternalNetworkClicked:function(e){var t=e.getName(),i=e.getPostModel(),o=s.extend({},this._getCommonExternalShareData(e),{viewType:e.getType()});this._logIt("share:external",o),r.trigger("dashboard-share:"+t),e.isTypePopup()&&!s.isEmpty(i)&&n.ajax({url:"/svc/share/"+t,method:"POST",withFormKey:!0,data:{post_id:i.get("post_id"),tumblelog_name:i.get("tumblelog_name"),share_fallback:!0}})},logExternalNetworkShareSuccess:function(e){this._logIt("share:external(e){this._logIt("share:external:fail",this._getCommonExternalShareData(e))},_logIt:function(e,t){t=t||{},s.extend(t,{platform:this.get("platform")}),r.trigger(this.get("namespace")+":"+e,{loggingData:t})},_getCommonExternalShareData:function(e){var t=e.getPostModel(),i={network:e.getName()};return s.isEmpty(t)||s.extend(i,{postId:t.get("post_id"),tumblelogName:t.get("tumblelog_name")}),i}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(283),a=i(884),l=o.extend({className:"popover--messaging-share-post popover popover_menu popover_gradient",mixins:[r],initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"viewOptions"))},render:function(){var e=n.isFunction(this.viewOptions)?this.viewOptions(this):this.viewOptions;return this.$wrapper=s("<div />").addClass("popover-inner popover_inner").appendTo(this.$el),this.$pinned.addClass("active"),this.sharePostView&&(this.stopListening(this.sharePostView),this.sharePostView.remove()),this.sharePostView=new a(e),this.listenToOnce(this.sharePostView,"close",this.tion(){return this.sharePostView&&this.sharePostView.remove(),this.remove()},getView:function(){return this.sharePostView}});e.exports=l},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(136),r=i(277),a=i(232),l=i(226),c=i(489),u=i(885),h=i(331),d=i(886),p=i(888),g=i(892),f=i(918),_=i(920),m=i(922),v=i(464),b=i(658),y=i(728),w=i(748),C=i(705),k=i(923),x=l.extend({className:"messaging-share-post",template:u,defaults:{senderBlog:null,isSending:!1,isLoading:!1,isLoadingFavorites:!1,isDisabled:!1,isEmpty:!1,isShowFavorites:!0,isShowMessage:!1,isShowExternalNetworksRow:!0,isExternalSharingEnabled:!0,isShowingExternalNetworkSubview:!1,closeAfterExternalNetworkShareMs:3e3,showLoadingAfterMs:250,numFavorites:10,defaultPlaceholder:null,additionalFavoritesPlaceholder:null,sendingPlaceholder:null,currentPlaceholder:null,focusIndex:0,isResultContainerFocused:!1,isExternalNetworksContainerFocused:!1,loadingClass:"is-loading",baseLoggingContext:"post-chrome",tabbingView:null},mixins:[r,a],keycommands:{"keydown:up":"_onKeyPressUp","keydown:down":"_onKeyPressDown","keydown:tab":"_onKeyPressTab","keydown:shift+tab":"_onKeyPressShiftTab","keydown:escape":"_onKeyPressEscape"},subviews:{searchView:{constructor:d,options:function(e){return{collection:e.collection,selectedRecipientModel:e.selectedRecipientModel,keyboardManager:e.keyboardManager,keybboardManager:e.keyboardManager,keyboardNamespace:"messagingshare:results"}}},messageView:{constructor:w,options:function(e){return{isAutoValidationEnabled:!1,className:"messaging-share-post-message",placeholder:e.get("currentPlaceholder"),keyboardManager:e.keyboardManager,keyboardNamespace:"messagingshare:message",buttonSubmittedClass:"submitted--send-a-post",animationSpeed:250,pluginsArray:e.pluginsArray,isSendAPost:!0}}},externalNetworksView:{constructor:g,options:function(e){return{isExternalSharingEnabled:e.get("isExternalSharingEnabled"),keyboardManager:e.keyboardManager,keyboardNamespace:"messagingshare:external",externalNetworksDataModel:e.externalNetworksDataModel}}},errorView:{constructor:_},favoritesLoaderView:{constructor:h,options:{className:"messaging-share-post-favorites-loader",variation:"small centered",loading:!1}}},initialize:function(e){var t;e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"favoritesCollection","shareData","channels","popoverContainer","additionalFavorites","externalNetworksDataModel")),this.collection=new C,t=this.channels.findWhere({uuid:n.get(e,"senderBlogUuid")})||this.channels.first(),this.keyboardManager=new v({allowMultipleActiveViews:!0}),n.isEmpty(this.get("defaultPlaceholder"))&&this.set("defaultPlaceholder",s("Say something if you like...")),n.isEmpty(this.get("additionalFavoritesPlaceholder"))&&this.set("additionalFavoritesPlaceholder",s("Discuss this post if you like...")),n.isEmpty(this.get("sendingPlaceholder"))&&this.set("sendingPlaceholder",s("Sending...")),this.set({currentPlaceholder:this.get("defaultPlaceholder"),senderBlog:t}),this.additionalFavoritesIds=n.pluck(n.invoke(this.additionalFavorites,"toJSON"),"uuid"),this.channelIds=this.channels.pluck("uuid"),this.selectedRecipientModel=new k,this.blogSelectorPlugin=new m({collection:this.channels,currentTumblelog:t,popoverOptions:{popoverContainer:this.popoverContainer}}),this.pluginsArray=[this.blogSelectorPlugin],this.disableKeys()},afterRenderSubviews:function(){this.loader=new c({$container:this.$el,type:"bar",classbind(n.debounce(function(){this._onSearchInput(this.searchView.getQuery())},250),this),this.listenTo(this.selectedRecipientModel,"change:participant",this._onChangeSelectedRecipient),this.listenTo(this,"change:isSending",this._onChangeIsSending),this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this,"change:isLoadingFavorites",this._onChangeisLoadingFavorites),this.listenTo(this,"change:isEmpty",this._onChangeIsEmpty),this.listenTo(this,"change:isShowFavorites",this._onChangeIsShowFavorites),this.listenTo(this,"change:isShowExternalNetworksRow",this._onChangeIsShowExternalNetworksRow),this.listenTo(this,"change:isShowMessage",this._onChangeIsShowMessage),this.listenTo(this,"change:currentPlaceholder",this._onChangeCurrentPlaceholder),this.listenTo(this,"change:focusIndex",this._onChangeFocusIndex),this.listenTo(this.blogSelectorPlugin.getBlogSelector(),"change:currentTumblelog",this._onBlogSelectorChange),this.listenTo(this.messageView,"submit:animated",this._onMessageSubmit),this.listenTo(this.searchView,"search",this._onSearchInputDebounced),this.listenTo(this.searchView,"clear",this._onSearchClear),this.listenTo(this.searchView,"focus",this._onViewFocusChange),this.listenTo(this.searchView,"submit",this._onSearchSubmit),this.listenTo(this.messageView,"focus",this._onViewFocusChange),this.listenTo(this.resultsView,"focus",this._onViewFocusChange),this.listenTo(this.externalNetworksView,"focus",this._onViewFocusChange),this.listenTo(this.externalNetworksView,"share:subview:show",this._onExternalNetworkShowSubview),this.listenTo(this.externalNetworksView,"share:success",this._onExternalNetworkShareSuccess),this.listenTo(this.externalNetworksView,"share:fail",this._onExternalNetworkShareFail),this.listenTo(this.externalNetworksView,"share:click",this._onExternalNetworkClick),this.listenTo(this.collection,"sync",this._onCollectionSync),this._setViewStates(),this._fetchFavorites(),this._setCollectionState(),this.messageTheme=new y({removeDataAttrAfterApplyingTheme:!1,el:this.messageView.el}),this.searchTheme=new y({removeDataAttrAfterApplyingTheme:!1,el:this.searchView.el}),n.defer(n.bind(function(){this.rendered&&this.searchView.focus()},this)),this.keyboardManager.add("messagingshare:main",this),this.focusKeys()},beforeRemove:function(){this.keyboardManager.remove("messagingshare")},fetchByQuery:function(e){n.isEmpty(e)?this.set({isEmpty:!1,isShowFavorites:!0,isLoading:!1}):(this.set("isLoading",!0),this.collection.fetchByQuery(e,this.get("senderBlog").get("uuid")).always(n.bind(function(){this.rendered&&this.set("isLoading",!1)},this)))},getSelectedRecipient:function(){return this.selectedRecipientModel.get("participant")},clearSelectedRecipient:function(){this.selectedRecipientModel.set("participant",null)},sendPost:function(e,t){var i,s,r,a=this.shareData,l=n.get(this.shareData,"postId"),c=n.get(this.shareData,"blogUuid"),u=n.get(this.shareData,"isNsfw"),h=[],d=!n.isEmpty(e),p=this._getLoggingContext();this.get("isDisabled")||this.get("isSending")||n.isEmpty(a)||(s=b.createPostMessage(l,c,{context:p,creationUserAction:t,is_nsfw:u}),h.push(s),d&&(r=b.createTextMessage(e,{context:p,creationUserAction:t}),h.push(r)),i=this._createConversation(),n.isEmpty(i)||(this.set("isSending",!0),i.appendToQueue(h),o.trigger("messaging:conversation:open:model",i,p),this.close()))},close:function(){this.trigger("close")},_createConversation:function(){var e=this.get("senderBlog"),t=this.getSelectedRecipient();if(n.isEmpty(e)||n.isEmpty(t))return null;var i=e.toJSON(),s=t.toJSON();return new b({participantUuid:e.get("uuid"),participants:[i,s]})},_onCollectionSync:function(e){var t;return!this.rendered||n.isEmpty(this.searchView.getQuery())?void this._setCollectionState():(this.clearSelectedRecipient(),t=0===this.collection.length,t&&this.errorView.setTitle(this.collection.getNoResultsFoundMessage()),this.set({isShowFavorites:!1,isEmpty:t}),void this._resetResultsScroll())},_resetResultsScroll:ernalNetworkeme:function(e){this.messageTheme.setTheme(e),this.searchTheme.setTheme(e)},_setViewStates:function(){var e=this.get("isShowMessage"),t=this.get("isEmpty"),i=this.get("isLoadingFavorites"),n=this.get("isShowExternalNetworksRow");this.js$("submission").toggleClass("show-submission",e),this.js$("external").toggle(n),this.errorView.$el.toggle(t),this.resultsView.toggle(!t),thiscusViews()},_onSearchInput:function(e){this.rendered&&this.fetchByQuery(e)},_onSearchClear:function(){this.rendered&&(this.fetchByQuery(null),this.clearSelectedRecipient())},_onSearchSubmit:function(){this.get("isShowFavorites")||1===this.collection.length&&this.selectedRecipientModel.set("participant",this.collection.first())},_setPlaceholderState:function(){var e=this.getSelectedRecipient(),t=this.get("isSending"),i=!n.isEmpty(e)&&n.contains(this.additionalFavoritesIds,e.get("uuid"));return t?void this.set("currentPlaceholder",this.get("sendingPlaceholder")):void this.set("currentPlaceholder",i?this.get("additionalFavoritesPlaceholder"):this.get("defaultPlaceholder"))},_setButtonState:function(){var e=this.get("isSending"),t=this.get("isDisabled"),i=e||t;this.messageView.set("isDisabled",i)},_setDisabledState:function(){var e=this.getSelectedRecipient(),t=this.get("senderBlog"),i=!n.isEmpty(e)&&e.get("uuid")===t.get("uuid");this.set("isDisabled",i)},_setCollectionState:function(){this.get("isShowFavorites")&&this.collection.reset(this.favoritesCollection.toJSON())},_setFocusViews:function(){var e=[this.searchView],t=[];this.get("isEmpty")||this.get("isLoadingFavorites")||(e.push(this.resultsView),t.push(this.resultsView)),this.get("isShowExternalNetworksRow")&&(e.push(this.externalNetworksView),t.push(this.externalNetworksView)),this.get("isShowMessage")&&e.push(this.messageView),this._focusViews=e,this._tabbableViews=t},_getLoggingContext:function(){var e,t,i=this.get("baseLoggingContext"),s=this.getSelectedRecipient();return n.isEmpty(s)?i:(e=n.contains(this.additionalFavoritesIds,s.get("uuid")),t=e?"trail":thIsSending:function(e,t){this._setButtonState(),this._setPlaceholderState()},_onChangeIsDisabled:function(e,t){this._setButtonState()},_onChangeSelectedRecipient:function(e,t){var i=!n.isEmpty(t);i?(this.messageView.focus(),this._applyTheme(t.get("theme"))):this.searchView.focus(),this.set("isShowMessage",i),this._setViewStates(),this._setDisabledState(),this._setPlaceholderState()},_onChangeIsEmpty:function(){this._setViewStates()},_onChangeIsShowFavorites:function(){this._setCollectionState(),this._resetResultsScroll()},_onChangeIsShowExternalNetworksRow:function(){this._setViewStates(),this._resetExternalNetworksScroll()},_onChangeIsShowMessage:function(e,t){this.set("isShowExternalNetworksRow",!t)},_onBlogSelectorChange:function(e,t){this.set("senderBlog",t),this.messageView.focus(),this._setDisabledState()},_onChangeIsLoading:function(e,t){return this._loaderTimeout&&(clearTimeout(this._loaderTimeout),this._loaderTimeout=null),t?void(this._loaderTimeout=setTimeout(n.bind(function(){this.rendered&&(this.loader.set("loading",!0),this.$el.addClass(this.get("loadingClass")))},this),this.get("showLoadingAfterMs"))):(this.$el.removeClass(this.get("loadingClass")),void this.loader.set("loading",!1))},_onChangeisLoadingFavorites:function(){this._setViewStates()},_onMessageSubmit:function(e,t){this.sendPost(e,t)},_onChangeCurrentPlaceholder:function(e,t){this.messageView.setPlaceholder(t)},_addAdditionalFavorites:function(){!n.isEmpty(this.additionalFavorites)&&n.isArray(this.additionalFavorites)&&n.each(this.additionalFavorites.reverse(),function(e){var t=e.get("uuid"),i=this.favoritesCollection.get(t);n.contains(this.channelIds,t)||(n.isEmpty(i)?this.favoritesCollection.unshift(e):(this.favoritesCollection.remove(t),this.favoritesCollection.unshift(i)))},this)},_fetchFavorites:function(){var e=this;this.set("isLoadingFavorites",!0),this.favoritesCollection.fetchFavorites(this.get("numFavorites"),null,!0,!1,"post").always(function(){e.rendered&&(e._addAdditionalFavorites(),e._setCollectionState(),e.set("isLoadingFavorites",!1))})},_getFocusViews:function(){return this._focusViews},_moveFocusUp:function(){this.set("focusIndex",Math.max(0,this.get("focusIndex")-1))},_moveFocusDown:function(){var e=this._getFocusViews()||[];this.set("focusIndex",Math.min(e.length-1,this.get("focusIndex")+1))},_onViewFocusChange:function(e){var t=this._getFocusViews(),i=n.indexOf(t,e);this.set("tabbingView",n.contains(this._tabbableViews,e)?e:null),this.set("focusIndex",i,{silent:!0})},_onChangeFocusIndex:function(e,t){var i=n.get(this._getFocusViews(),t);this.set("tabbingView",n.contains(this._tabbableViews,i)?i:null),n.result(i,"focus")},_onKeyPressTab:function(e){var t=this.get("tabbingView");e.preventDefault(),n.isEmpty(t)||t.isLastFocused()?this._moveFocusDown():t.focusNext()},_onKeyPressShiftTab:function(e){var t=this.get("tabbingView");e.preventDefault(),n.isEmpty(t)||sPrevious()},_onKeyPressEscape:function(e){this.close(),e.preventDefault()},_onKeyPressUp:function(e){e.preventDefault(),this._moveFocusUp()},_onKeyPressDown:function(e){e.preventDefault(),this._moveFocusDown()},_onExternalNetworkShowSubview:function(e){var t="messagingshare:externalnetwork",i=new f({externalNetworkSubview:e});i.render(),this.disableKeys(),this.keyboardManager.add(t,i),this.listenToOnce(i,"goBack",function(){this.stopListening(e),this.keyboardManager.remove(t,i),this.enableKeys(),i.remove(),this.set("isShowingExternalNetworkSubview",!1),this.searchView.focus()}),this.listenToOnce(i,"close",function(){this.close()}),this.js$("external-network-subview-wrapper").html(i.$el),this.set("isShowingExternalNetworccess:function(e){setTimeout(n.bind(function(){this.rendered&&this.close()},this),this.get("closeAfterExternalNetworkShareMs")),this.trigger("external:success",e)},_onExternalNetworkShareFail:function(e){this.trigger("external:fail",e)},_onExternalNetworkClick:function(e){this.trigger("external:click",e)}});e.exports=x},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="searchView"></div><div class="messaging-share-post-main"><div class="messaging-share-post-results-wrapper"><div data-subview="errorView"></div><div data-subview="resultsView"></div><div data-subview="favoritesLoaderView"></div></div><div data-subview="loader"></div></div><div data-js-external class="messaging-share-post-external-networks-wrapper"><div data-subview="externalNetworksView"></div></div><div data-js-submission class="messaging-share-post-submission"><div data-subview="messageView"></div></div><div data-js-external-network-subview-wrapper></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(277),a=i(232),l=i(887),c=o.extend({className:"messaging-share-post-search",template:l,mixins:[r,a],events:{"input [data-js-input]":"_onInputChange","focus [data-js-input]":"_onInputFocus","blur [data-js-input]":"_onInputBlur",click:"_onContainerClick"},defaults:{hasSelectedBlogNameClass:"has-selected-blog",isFocused:!1,currentQuery:""},keycommands:{"keydown:backspace":"_onKeyPressBackspace","keydown:enter":"_onKeyPressEnter"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"selectedRecipientModel","keyboardManager","keyboardNamespace")),this.disableKeys()},afterRender:function(){this.listenTo(this.selectedRecipientModel,"change:participant",this._onChangeSelectedRecipient),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this,"change:currentQuery",this._onChangeCurrentQuery),this.js$("selected-blog").hide()},focus:function(){this.js$("input").focus()},getQuery:function(){return this.get("currentQuery")},_clearInput:function(){this._setInputValue()},_setInputValue:function(e){e=e||"",this.js$("input").val(e),this._prevVal=e},_getSelectedRecipient:function(){return this.selectedRecipientModel.get("participant")},_hasSelectedRecipient:function(){return!n.isEmpty(this._getSelectedRecipient())},_onChangeSelectedRecipient:function(e,t){this._setBlogPillRecipient(t),n.isEmpty(t)?this._setInputValue(this.get("currentQuery")):this._clearInput()},_setBlogPillRecipient:function(e){var t=!n.isEmpty(e);this.js$("selected-blog").text(t?e.get("name"):"").toggle(t),this.$el.toggleClass(this.get("hasSelectedBlogNameClass"),t)},_setCurrentQuery:function(e,t){t&&this.unset("currentQuery",{silent:!0}),this.set("currentQuery",e)},_onInputChange:function(e){var t,i,n=s(e.currentTarget).val();this._prevVal!==n&&(t=this.get("currentQuery"),i=this._hasSelectedRecipient()&&n===t,this._setCurrentQuery(n,i),this._prevVal=n)},_onKeyPressBackspace:function(e){this._hasSelectedRecipient()&&(e.preventDefault(),this._setCurrentQuery("",!0))},_onKeyPressEnter:function(e){e.preventDefault(),this.trigger("submit",this)},_onContainerClick:function(){this.focus()},_onInputFocus:function(){this.set("isFocused",!0)},_onInputBlur:function(){this.set("isFocused",!1)},_onChangeIsFocused:function(e,t){t?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onChangeCurrentQuery:function(e,t){t=t||"",this._hasSelectedRecipient()&&this._setBlogPillRecipient(null),n.isEmpty(t)?this.trigger("clear"):this.trigger("search",t)}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="search-input-wrapper" data-js-search-container><div class="search-input-container"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="search-input" placeholder="'+__e(__("Message to..."))+'" data-js-input> <button class="selected-blog" data-js-selected-blog data-js-theme-accent-color-as-background></button></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(682),r=i(232),a=i(485),l=i(471),c=i(889),u=i(891),h=s.extend({className:"messaging-share-post-results",template:u,defaults:{isFocused:!1,focusedView:null,selectedView:null},mixins:[r,o,l],keycommands:{"keydown:left":"_onKeyPressLeft","keydown:right":"_onKeyPressRight","keydown:backspace":"_onKeyPressBackspace","keydown:shift+backspace":"_onKeyPressBackspace"},subviews:{resultView:{constructor:c,options:function(e){return{onSelect:n.bind(e._onSubviewSelect,e),onFocus:n.bind(n.partial(e._setIsFocusedDebounced,!0),e),onBlur:n.bind(n.partial(e._setIsFocusedDebounced,!1),e)}},collection:function(e){return e.collection}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"collection","selectedRecipientModel","keyboardNamespace","keyboardManager")),this.keyboardViewName="resultView",this.disableKeys()},afterRenderSubviews:function(){this.listenTo(this.collection,"reset update",this._onCollectionChange),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this,"change:focusedView",this._onChangeFocusedView),this.listenTo(this,"change:selectedView",this._onChangeSelectedView),this.listenTo(this.selectedRecipientModel,"change:participant",this._onChangeSelectedRecipientModel),this._setIsFocusedDebounced=n.debounce(n.bind(this._setIsFocused,this),0),this.scrollbar=new a(this.$el),this.updateScrollbar()},resetFocus:function(){this.set("focusedView",null),this.deselect(this.keyboardViewName)},toggle:function(e){this.$el.toggle(e),e||this.resetFocus()},focus:function(){var e=this.get("selectedView"),t=!n.isEmpty(e);t&&this.setSelectedIndex(this.keyboardViewName,n.indexOf(this.resultView,e)),t?this.set("focusedView",this.getSelectedView(this.keyboardViewName)):this.focusFirst()},focusFirst:function(){this.set("focusedView",this.selectFirst(this.keyboardViewName))},focusLast:function(){this.set("focusedView",this.selectLast(this.keyboardViewName))},focusNext:function(){this.set("focusedView",this.selectNext(this.keyboardViewName))},focusPrevious:function(){this.set("focusedView",this.selectPrevious(this.keyboardViewName))},isLastFocused:function(){return this.isLastSelected(this.keyboardViewName)},isFirstFocused:function(){return this.isFirstSelected(this.keyboardViewName)},updateScrollbar:function(e){this.rendered&&this.scrollbar&&n.defer(n.bind(this.scrollbar.update,this.scrollbar))},beforeRemove:function(){this.keyboardManager.remove(this.keyboardNamespace),this.scrollbar&&this.scrollbar.destroy()},_onKeyPressLeft:function(e){e.preventDefault(),this.focusPrevious()},_onKeyPressRight:function(e){e.preventDefault(),this.focusNext()},_onKeyPressBackspace:function(e){e.preventDefault()},_onChangeFocusedView:function(e,t){var i=this.previous("focusedView");i&&i.setFocused(!1),t&&t.setFocused(!0)},_onChangeSelectedView:function(e,t){var i=this.previous("selectedView");i&&i.setSelected(!1),t&&t.setSelected(!0)},_onSubviewSelect:function(e,t){var i=e!==this.get("selectedView")?e:null,s=n.isEmpty(i)?null:t;this.selectedRecipientModel.set("participant",s),this.set("selectedView",i)},_setIsFocused:function(e){this.rendered&&this.set("isFocused",e)},_onChangeIsFocused:function(e,t){t?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.set("focusedView",null),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onCollectionChange:function(){this.resetFocus(),this.updateScrollbar()},_onChangeSelectedRecipientModel:function(e,t){var i;returind(this.resultView,function(e){return e.model.get("uuid")===t.get("uuid")}),void this.set("selectedView",i))}});e.exports=h},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(890),r=i(728),a=s.extend({className:"messaging-share-post-result",tagName:"a",attributes:{href:"#",tabIndex:1},events:{click:"_onSelect",focus:"_onFocus",blur:"_onBlur"},defaults:{isSelected:!1,isFocused:!1,selectedClass:"is-selected",focusedClass:"is-focused"},template:o,initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"onSelect","onFocus","onBlur"))},afterRender:function(){this.listenTo(this,"change:isSelected",this._onChangeIsSelected),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.conversationTheme=new r({theme:this.model.get("theme"),el:this.el}).render()},getTemplateData:function(){return{name:this.model.get("name"),title:this.model.get("title"),avatarUrl:this.model.getAvatarUrl(),avatarShape:this.model.getAvatarShape()}},setSelected:function(e){this.rendered&&this.set("isSelected",e)},setFocused:function(e){this.rendered&&this.set("isFocused",e)},_onSelect:function(e){e.preventDefault(),n.isFunction(this.onSelect)&&this.onSelect(this,this.model)},_onFocus:function(e){e.preventDefault(),n.isFunction(this.onFocus)&&this.onFocus(this,this.model)},_onBlur:function(e){e.preventDefault(),n.isFunction(this.onBlur)&&this.onBlur(this,this.model)},_onChangeIsSelected:function(e,t){this.$el.toggleClass(this.get("selectedClass"),t)},_onChangeIsFocused:function(e,t){this.$el.toggleClass(this.get("focusedClass"),t),t&&this.$el.focus()}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="container" data-js-theme-accent-color-on-grey><div class="avatar" data-js-theme-avatar-shape-class><img src="'+__e(avatarUrl)+'" alt="'+__e(name)+'" title="'+__e(name)+'"></div><div class="name">'+__e(name)+'</div><div class="title">',__p+=_.isEmpty(title)?"&nbsp;":__e(title),__p+="</div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="resultView[]"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(682),r=i(232),a=i(485),l=i(347),c=i(331),u=i(471),h=i(893),d=i(895),p=i(897),g=i(917),f=s.extend({className:"messaging-share-post-external-networks",template:g,defaults:{isLoading:!1,isFocused:!1,focusedView:null,isExternalSharingEnabled:!0},mixins:[r,o,u],keycommands:{"keydown:left":"_onKeyPressLeft","keydown:right":"_onKeyPressRight","keydown:backspace":"_onKeyPressBackspace","keydown:shift+backspace":"_onKeyPressBackspace"},subviews:{networkView:{constructor:d,options:function(e){return{onFocus:n.bind(n.partial(e._setIsFocusedDebounced,!0),e),onBlur:n.bind(n.partial(e._setIsFocusedDebounced,!1),e),onShowSubview:n.bind(e._onShowSubview,e),onShareSuccess:n.bind(e._onShareSuccess,e),onShareFail:n.bind(e._onShareFail,e),onShareClick:n.bind(e._onShareClick,e)}},collection:function(e){return e.collection}},networksLoaderView:{constructor:c,options:{className:"messaging-share-post-favorites-loader",variation:"small centered",loading:!1}}},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"keyboardNamespace","keyboardManager","externalNetworksDataModel")),this._setIsFocusedDebounced=n.debounce(n.bind(this._setIsFocused,this),0),this.keyboardViewName="networkView",this.collection=new h,this.disableKeys()},afterRenderSubviews:function(){if(this.listenTo(this.collection,"reset update",this._onCollectionChange),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this,"change:focusedView",this._onChangeFocusedView),this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this.externalNetworksDataModel,"request",this._externalNetworksDataModelRequest),this.listenTo(this.externalNetworksDataModel,"sync",this._externalNetworksDataModelSync),this.scrollbar=new a(this.$el),this.updateScrollbar(!0),this._onChangeIsLoading(this,this.get("isLoading")),this.externalNetworksDataModel.isPopulated())this.updateComponents();else{if(!this.externalNetworksDataMer.remove(this.keyboardNamespace),this.scrollbar&&this.scrollbar.destroy()},resetFocus:function(){this.set("focusedView",null),this.deselect(this.keyboardViewName)},toggle:function(e){this.$el.toggle(e),e||this.resetFocus()},focus:function(){this.focusFirst()},focusFirst:function(){this.set("focusedView",this.selectFirst(this.keyboardViewName))},focusLast:function(){this.set("focusedView",this.selectLast(this.keyboardViewName))},focusNext:function(){thtion(){
this.set("focusedView",this.selectPrevious(this.keyboardViewName))},isLastFocused:function(){return this.isLastSelected(this.keyboardViewName)},isFirstFocused:function(){return this.isFirstSelected(this.keyboardViewName)},updateScrollbar:function(e){this.rendered&&this.scrollbar&&n.defer(n.bind(this.scrollbar.update,this.scrollbar))},updateCoon.reset(n.map(this._getExternalNetworks(),function(e){return{component:e}}))},_setIsFocused:function(e){this.rendered&&this.set("isFocused",e)},_getExternalNetworks:function(){var e=this.get("isExternalSharingEnabled"),t=[{Constructor:p.Flag,options:this._getFlagOptions,isExternal:!1},{Constructor:p.Permalink,options:this._getPermalinkOptions,isExternal:!1},{Constructor:p.CopyPermalink,options:this._getPermalinkOptions,isExternal:!1},{Constructor:p.Embed,options:this._getEmbedOptions,isExternal:!1,isIncluded:this._isShowEmbed},{Constructor:p.Email,options:this._getEmailOptions,isExternal:!0},{Constructor:p.Twitter,options:this._getTwitterOptions,isExternal:!0},{Constructor:p.Pinterest,options:this._getPinterestOptions,isIncluded:this._isShowPinterest,isExternal:!0},{Constructor:p.Reddit,options:this._getRedditOptions,isExternal:!0}];return n.reduce(t,n.bind(function(t,i){var s;return!e&&i.isExternal?t:n.isFunction(i.isIncluded)&&!i.isIncluded.call(this)?t:(s=new i.Constructor(this._getBaseAndNetworkOptions(i.options.call(this))),t.push(s),t)},this),[])},_getPermalinkOptions:function(){return{}},_getEmbedOptions:function(){return{}},_getEmailOptions:function(){return{}},_getTwitterOptions:function(){var e=this.externalNetworksDataModel.get("twitter_username");return{isPopup:n.isEmpty(e),username:e}},_getPinterestOptions:function(){var e=this.externalNetworksDataModel.get("pinterest_share_window"),t=n.get(e,"url"),i=n.get(e,"dimensions");return{popupOptions:i,popupUrl:t}},_isShowPinterest:function(){return this.externalNetworksDataModel.get("show_pinterest")},_isShowEmbed:function(){return this.externalNetworksDataMode_getRedditOptions:function(){return{}},_getFlagOptions:function(){return{}},_getBaseExternalNetworkOptions:function(){var e=this.externalNetworksDataModel.toJSON(),t=n.extend({},e,{id:n.get(e,"post_id")}),i=new l(t);return{postModel:i}},_getBaseAndNetworkOptions:function(e){return this._baseExternalNetworkOptions||(this._baseExternalNetworkOptions=this._getBaseExternalNetworkOptions()),n.extend({},this._baseExternalNetworkOptions,e)},_onKeyPressLeft:function(e){e.preventDefault(),this.focusPrevious()},_onKeyPressRight:function(e){e.preventDefault(),this.focusNext()},_onKeyPressBackspace:function(e){e.preventDefault()},_onChangeFocusedView:function(e,t){var i=this.previous("focusedView");i&&i.setFocused(!1),t&&t.setFocused(!0)},_onChangeIsFocused:function(e,t){t?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.set("focusedView",null),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onCollectionChange:function(){this.resetFocus(),this.updateScrollbar()},_onShowSubview:function(e){this.trigger("share:subview:show",e)},_onShareSuccess:function(e){this.trigger("share:success",e)},_onShareFail:function(e){this.trigger("share:fail",e)},_onShareClick:function(e){this.trigger("share:click",e)},_onChangeIsLoading:function(e,t){t)},_externalNetworksDataModelRDataModelSync:function(e){this.set("isLoading",!1),this.updateComponents()}});e.exports=f},function(e,t,i){"use strict";var n=i(190),s=i(894),o=n.extend({model:s});e.exports=o},function(e,t,i){"use strict";var n=i(185),s=n.extend({defaults:{component:null}});e.exports=s},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(896),r=s.extend({className:"messaging-share-post-external-network",tagName:"a",attributes:{href:"#",tabIndex:1},events:{focus:"_onFocus",blur:"_onBlur",click:"_onClick"},defaults:{isFocused:!1,focusedClass:"is-focused"},template:o,initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"onFocus","onBlur","onShareSuccess","onShareFail","onShareClick","onShowSubview")),this.component=this.model.get("component")},getTemplateData:function(){return{label:this.component.getLabel()}},afterRender:function(){this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this.component,"share:fail",this._onShareFail),this.listenToOnce(this.component,"share:success",this._onShareSuccess),this._setLinkClass(),this._setLinkHref()},remove:function(){this.stopListening(this.component)},setFocused:function(e){this.rendered&&this.set("isFocused",e)},_setLinkHref:function(){var e=this.component.getButtonHref();n.isEmpty(e)||this.$el.attr({href:e,target:"_blank"})},_setLinkClass:function(){this.$el.addClass("network--"+this.component.getName())},_onFocus:function(e){e.preventDefault(),n.isFunction(this.onFocus)&&this.onFocus(this,this.model)},_onBlur:function(e){e.preventDefault(),n.isFunction(this.onBlur)&&this.onBlur(this,this.model)},_onClick:function(e){this.onShareClick&&this.onShareClick(this.component),this.component.isTypeHref()||(e.preventDefault(),this.component.isTypeCallback()?this.component.onClickHandler(e):this.component.isTypePopup()?this._openShareWindow():thisn.bind(function(e){n.isFunction(this.onShowSubview)&&this.onShowSubview(e)},this)).catch(n.bind(function(e){},this)))},_openShareWindow:function(){var e=this.component.getPopupUrl(),t=this.component.getPopupOptions(),i=this.component.getName();n.isEmpty(e)||window.open(e,i+"-share-dialog",t)},_onChangeIsFocused:function(e,t){this.$el.toggleClass(this.get("focusedClass"),t),t&&this.$el.focus()},_onShareSuccess:function(){n.isFunction(this.onShareSuccess)&&this.onShareSuccess(this.component)},_onShareFail:function(){n.isFunction(this.onShareFail)&&this.onShareFail(this.component)}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(o,Pinterest:s,Permalink:o,Embed:a,Flag:r,Email:l,Twitter:c,CopyPermalink:u}},function(e,t,i){"use strict";var n=i(130),s=i(899),o=s.extend({getName:function(){return"reddit"},getLabel:function(){return n("Reddit")},getPopturn"https://reddit.com/submit?url="+encodeURIComponent(this.getPostUrl())}});e.exports=o},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(192),r=i(214),a=i(900),l=r.extend({name:"BaseExternalNetwork",initialize:function(e){s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"postModel"))},getName:function(){return null},getLabel:function(){return null},getType:function(){return l.TYPE_POPUP},getPopupUrl:function(){return null},getPopupOptions:function(){return null},getSubviewConstructor:function(){return null},getSubviewOptions:function(){return null},getButtonHref:function(){return null},onClickHandler:function(e){},getPostModel:function(){return this.postModel},getPostUrl:function(){return this.postModel.get("post_url")},getPospost_tiny_url")},getShareUrl:function(){return"/svc/share/"+this.getName()},isTypePopup:function(){return this.isTypeEqual(l.TYPE_POPUP)},isTypeSubview:function(){return this.isTypeEqual(l.TYPE_SUBVIEW)},isTTYPE_CALLBACsTypeEqual(l.TYPE_HREF)},isTypeEqual:function(e){return this.getType()===e},createSubviewInstance:function(e){var t,i,n;return t=this.getSubviewConstructor(),s.isEmpty(t)?null:t.prototype instanceof a?(i=s.exe(n,"remove",function(e){emoved(e)}),this.listenTo(n,"share",function(e,t){this.onSubviewShare(e,t)}),this.afterSubviewCreated(n),n):null},getSubviewInstance:function(e){var t=o.defer(),i=this.createSubviewInstance(e);return s.isEmpty(i)?t.reject("Could not create external network subview (subview constructor must extend ExternalNetworkEmbedSubview)."):t.resolve(i),t.promise},getShareRequestDataFromSubviewData:function(e){return e},sendShareRequest:function(e){return n.ajax({url:this.getShareUrl(),method:"POST",withFormKey:!0,data:e})},onSubviewShare:function(e,t){var i=this.getShareRequestDataFromSubviewData(e),n=s.extend({},this._getBaseShareRequestData(),i);return this._beforeShare(t,e),this.sendShareRequest(n).then(s.bind(function(){this._afterShareSuccess(t,e),this._afterShare(t,e)},this)).fail(s.bind(function(){this._afterShareFail(t,e),this._afterShare(t,e)},this))},afterSubviewCreated:function(e){},afterSubviewRemoved:function(e){},_getBaseShareRequestData:function(){var e=this.getPostModel(),t={post_id:e.get("post_id"),tumblelog_name:e.get("tumblelog_name")};return this.isTypeSubview()||s.extend(t,{share_fallback:!0}),t},_beforeShare:function(e,t){e.set({isSharing:!0,isShareSuccess:!1,isShareFail:!1}),this.trigger("share:start")},_afterShareSuccess:function(e,t){e.set({isShareSuccess:!0,isShareFail:!1}),e.onShareSuccess(t),this.trigger("share:success")},_afterShareFail:function(e,t){e.set({isShareFail:!0,isShareSuccess:!1}),e.onShareFail(t),this.trigger("share:fail")},_afterShare:function(e,t){e.set("isSharing",!1),e.afterShare(t),this.trigger("share:finished")}},{TYPE_POPUP:"popup",TYPE_SUBVIEW:"subview",TYPE_CALLBACK:"callback",TYPE_HREF:"href"});e.exports=l},function(e,t,i){"use strict";var n=i(3),s=i(226),o=s.extend({defaults:{isSharing:!1,isShareSuccess:!1,isShareFail:!1},initialize:function(e){n.extend(this.attributes,n.pick(e,n.keys(this.defaults)))},getTitle:function(){return null},onShareSuccess:function(e){},onShareFail:function(e){},afterShare:function(e){},isShareSuccess:function(){return this.get("isSrn this.get("isShareFail")},share:function(e){this.trigger("share",e,this)},close:function(){this.trigger("close",this)},remove:function(){return this.trigger("remove",this),s.prototype.remove.apply(this,arguments)}});e.exports=o},function(e,t,i){"use strict";var n=i(130),s=i(899),o=s.extend({defaults:{popupUrl:null,popupOptions:null},getName:function(){return"pinterest"},getLabel:function(){return n("Pinterest")},getPopupOptions:function(){return this.get("popupOptions")},getPopupUrl:function(){return this.get("popupUrl")}});e.exports=o},function(e,t,i){"use strict";var n=i(130),s=i(899),o=s.extend({getName:function(){return"permalink"},getLabel:function(){return n("Permalink")},getType:function(){return s.TYPE_HREF},getButtonHref:function(){return this.getPostUrl()}});e.exports=o},function(e,t,i){"use strict";var n=i(136),s=i(130),o=i(899),r=o.extend({getName:function(){return"flag"},getLabel:function(){return s("Report")},getType:function(){return o.TYPE_CALLBACK},onClickHandler:function(e){n.trigger("abuseform:open",{mode:"post",post:this.getPostModel()}),n.trigger("Kraken:abuseform:open",{mode:"post"})}});e.exports=r},function(e,t,i){"use strict";var n=i(130),s=i(899),o=i(905),r=s.extend({getName:function(){return"embed"},getLabel:function(){return n("Embed")},getType:function(){return s.TYPE_SUBVIEW},getSubviewConstructor:function(){return o},getSubviewOptions:function(){return{embedCode:this.postModel.getEmbedCode()}}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(900),r=i(906),a=i(277),l=o.extend({tagName:"form",className:"external-network-embed-subview external-network-form-subview",defaults:{embedCode:null},mixins:[a],events:{"click [data-js-embed-code]":"_onEmbedCodeClick"},template:r,getTitle:function(){return s("Embed")},getTemplateData:function(){return{embedCode:this.get("embedCode")}},afterRender:function(){n.defer(n.bind(this.selectEmbedCode,this))},selectEmbedCode:function(){var e=this.js$("embed-code");e.focus(),e.select()},_onEmbedCodeClick:function(e){this.selectEmbedCode()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="form-main"><textarea spellcheck="false" readonly="readonly" data-js-embed-code class="embed-code textarea" aria-label="'+__e(__("Embed code"))+'">'+__e(embedCode)+"</textarea></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(899),r=i(908),a=o.extend({getName:function(){return"email"},getLabel:function(){return s("Email")},getType:function(){return o.TYPE_SUBVIEW},getSubviewConstructor:function(){return r},getShareRequestDataFromSubviewData:function(e){var t={message:n.get(e,"message"),email_address:n.get(e,"email")};return n.get(e,"isAllowReply",!1)&&n.extend(t,{allow_reply_to:!0}),t}});e.exports=a},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(909),r=i(910),a=i(912),l=r.extend({className:"external-network-email-subview external-network-form-subview",template:a,events:n.defaults({"input [data-js-email]":"_onEmailInput"},r.prototype.events),getTitle:function(){return s("Email")},afterRender:function(){n.defer(n.bind(this.focus,this)),r.prototype.afterRender.apply(this,arguments)},focus:function(){this.js$("email").focus()},isFormFieldsValid:function(){return o.isEmail(this.js$("email").val())},onFormSubmit:function(e){var t,i,n;this.isFormValid()&&(t=this.js$("email").val(),i=this.js$("message").val(),n=this.js$("allow-reply-checkbox").is(":checked"),this.share({email:t,message:i,isAllowReply:n}))},_onEmailInput:function(e){this.validateForm()}});e.exports=l},function(e,t,i){"use strict";var n=i(8),s={tumblrUrlBasePattern:"^\\s*((https?:)?[/\\\\]+)?([a-z0-9\\.-])*(.com|.net)",tumblrUrlEolPattern:"\\/?nction(e){nction{return h>=t&&e.length<=i},pattern:function(e,t){return new RegExp(t,"gi").test(e)},isEmail:function(e){return this.pattern(e,"^[a-zA-Z0-9._+-]+@[a-zA-Z0-9][a-zA-Z0-9.-]*[.]{1}[a-zA-Z]{2,20}$")},isUrl:function(e){return this.pattern(e,"^\\s*((https?:)?[/\\\\]+)?([a-z0-9_-]+\\.){1,}([a-z\\.]{2,6})(/[^\\s]*)?\\s*$")},isReportableTumblrUrl:function(e){return this.isTumblrPostUrl(e)||this.isTumblrImageUrl(e)||this.isTumblrSubmissionsUrl(e)||this.isTumblrChatUrl(e)||this.isTumblrChatMessageUrl(e)||this.isTumblrBlogUrl(e)||this.isTumblrBlogViewUrl(e)},isTumblrBlogUrl:function(e){return this.pattern(e,this.tumblrUrlBasePattern+this.tumblrUrlEolPattern)},isTumblrSubmissionsUrl:function(e){return this.pattern(e,this.tumblrUrlBasePattern+"\\/submissions\\/[a-z0-9-_\\/\\.]{1,}"+this.tumblrUrlEolPattern)},isTumblrChatUrl:function(e){return this.pattern(e,this.tumblrUrlBasePattern+"\\/chats?\\/[0-9]{1,}"+this.tumblrUrlEolPattern)},isTumblrChatMessageUrl:function(e){return this.pattern(e,this.tumblrUrlBasePattern+"\\/chat_message\\/[a-z0-9-_\\/\\.]{1,}"+this.tumblrUrlEolPattern)},isTumblrPostUrl:function(e){return this.pattern(e,this.tumblrUrlBasePattern+"\\/(?:post|blog|private)\\/[a-z0-9-_\\/\\.]{1,}"+this.tumblrUrlEolPattern)},isTumblrBlogViewUrl:function(e){return this.pattern(e,this.tumblrUrlBasePattern+"\\/blog\\/view\\/[a-z0-9-_\\/\\.]{1,}"+this.tumblrUrlEolPattern)},isTumblrImageUrl:function(e){return this.pattern(e,this.tumblrUrlBase_\\/\\.]{1,}"+this.tumblrUrlEolPattern)},equals:function(e,t){return e===t},isPhoneNumber:function(e){return e&&/^\d+$/.test(e)&&(10===e.length||11===e.length)},isPostalCode:function(e){return e&&/^\d+$/.test(e)&&(5===e.length||9===e.length)}};e.exports=s},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(900),r=i(911),a=i(277),l=o.extend({tagName:"form",mixins:[a],className:"external-network-form-subview",defaults:n.defaults({isFormValid:!1,isShowConfetti:!0},o.prototype.defaults),events:{"click [data-js-success-container]":"_onSuccessContainerClick",submit:"_onFormSubmit"},initialize:function(e){n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),o.prototype.initialize.apply(this,arguments)},afterRender:function(){var e=this.getSubmitButtonElement();this.listenTo(this,"change:isFormValid",this._onChangeIsFormValid),this.listenTo(this,"change:isSharing",this._onChangeIsSharing),n.isEmpty(e)||(this.submitTextDefault=e.text(),this.submitTextSending=e.attr("data-text-sending")||s("Sending...")),this.validateForm(),this._setSubmitButtonState(),this._toggleElement(this.getShareFailElement(),!1),this._toggleElement(this.getShareSuccessElement(),!1)},getSubmitButtonElement:function(){return this.js$("submit-button")},getShareSuccessElement:function(){return this.js$("success-container")},getShareFailElement:function(){return this.js$("fail-container")},onShareSuccess:function(e){var t,i=this.getShareSuccessElement();this._toggleElement(i,!0),this._toggleElement(this.getShareFailElement(),!1),i&&this.get("isShowConfetti")&&(t=this._createConfettiView(),i.append(t.render().$el))},onShareFail:function(e){this._toggleElement(this.getShareFailElement(),!0),this._toggleElement(this.getSha},validateForm:function(){this.set("isFormValid",this.isFormFieldsValid())},setFormIsValid:function(e){this.set("isFormValid",e)},isFormValid:function(){return this.get("isFormValid")},onFormSubmit:function(e){},_createConfettiView:function(){return new r({className:"external-network-form-subview-confetti",autoParty:!0,amount:30,speed:.2})},_setSubmitButtonState:function(){var e=this.getSubmitButtonElement(),t=this.get("isFormValid"),i=this.get("isSharing"),n=!t||i;e.prop("disabled",n),e.text(i?this.submitTextSending:this.submitTextDefault)},_onChangonState()},_onChangeIsFor_setSubmitButtonState()},_onSuccessContainerClick:function(e){this.close()},_toggleElble",t)},_onFormSubmit:function(e){e.preventDefault(),this.onFormSubmit(e)}});e.exports=l},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(226),r=i(136),a=o.extend({id:"milestone-confetti",tagName:"canvas",defaults:{amount:100,autoParty:!1,colors:["#ff492f","#ff8a00","#e8d738","#00cf35","#00b8ff","#7c5cff"],size:40,speed:.5,onDone:n.noop},__resize:function(){this.$parent.length&&(this.el.width=this.$parent.width(),this.el.height=this.$parent.height())},_updateConfetti:function(e,t){this.confettiAngle+=.001,e.off||(e.tiltAngle+=e.tiltAngleIncrement,e.tilt=15*Math.sin(e.tiltAngle-t/3),e.y+=(Math.cos(this.confettiAngle+e.density)+.5*e.radius)*this.options.speed),e.y>this.el.height+20&&(this.isAnimating?(e.tilt=a.range(-10,10,!0),e.tileAngle=0,e.tiltAngleIncrement=a.range(.05,.1),e.x=Math.random()*this.ell(this.animationInterval),this.animationInterval=null),this.isAnimating=!1},_startAnimating:function(e){e=e||!1,this._stopAnimating(),this.animationInterval=setInterval(s.bind(this.draw,this),15),this.isAnimating=!!e||this.isAnimating},initialize:function(e){this.options=s.extend({},this.defaults,e||{}),this.colors=this.options.colors,this.$win=n(window),this.$parent=n(),this.context=this.el.getContext("2d"),this.animationInterval=null,this.confetti=[],this.confettiAngle=0,this.confettiOffscreen=0,this.isAnimating=!1},render:function(){return s.defer(s.bind(this.setup,this)),this},setup:function(){this.$parent=this.$el.parent(),this.$parent.length&&(this.el.width=this.$parent.width(),this.el.height=this.$parent.height()),this.listenTo(r,"DOMEventor:flatresize",this.__resize);for(var e=this.options.size,t=.5*e,i=0,n=this.options.amount;i<n;i++)this.confetti.push({x:Math.random()*this.el.width,y:Math.random()*-this.el.height,radius:a.range(t,e),density:a.range(10,n),tilt:a.range(-10,10,!0),tiltAngle:0,tiltAngleIncrement:a.range(.05,.1),color:this.colors[a.range(0,this.colors.length-1,!0)],off:!1});this.options.autoParty&&this.party()},draw:function(){if(this.context.clearRect(0,0,this.el.width,this.el.height),this.confettiOffscreen===this.confetti.length)return this.trigger("confetti:animation:finished"),void this.remove();for(var e=5,t=0;t<this.confetti.length;t++){var i=this.confetti[t];this.context.beginPath(),this.context.lineWidth=.5*i.radius,this.context.strokeStyle=i.color,this.context.moveTo(i.x+i.tilt+i.radius/e,i.y),this.context.lineTo(i.x+i.tilt,i.y+i.tilt+i.radius/e),this.context.stroke(),this._updateConfetti(i,t)}},party:function(){nimating(!0),this},stopPartying:function(){return this.isAnimating=!1,this},remove:function(){return this._stopAnimating(),this.options.onDone(),o.prototype.remove.call(this)}},{range:function(e,t,i){i=i||!1;var n=(t-e)*Math.random()+e;return i?Math.round(n):n}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="form-main"><input type="email" data-js-email placeholder="'+__e(__("To email"))+'" class="email input" aria-label="'+__e(__("To email"))+'"><textarea maxlength="255" data-js-message placeholder="'+__e(__("Message (Optional)"))+'" class="message textarea" aria-label="'+__e(__("Optional email message content"))+'"></textarea><label class="reply-option"><span class="binary-switch reply-switch"><input type="checkbox" data-js-allow-reply-checkbox> <span class="binary-switch-track"></span> <span class="binary-switch-button"></span> </span> '+__e(__("Let them reply to my email address"))+' </label></div><div class="form-result form-result--fail" data-js-fail-container> '+__e(__("Something went screwy."))+' </div><footer class="footer"><button type="submit" class="button tx-button blue" data-js-submit-button data-js-text-sending="'+__e(__("Sending..."))+'">'+__e(__("Send"))+'</button></footer><div class="form-result form-result--success" data-js-success-container> '+__e(__("Post shared!"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(130),s=i(899),o=i(914),r=s.extend({defaults:{isPopup:!0,username:null,urlToken:"[URL]"},getName:function(){return"twitter"},getLabel:function(){return n("Twitter")},getType:function(){return this.get("isPopup")?s.TYPE_POPUP:s.TYPE_SUBVIEW},getPopupUrl:function(){var e=this.getPostTinyUrl()||this.getPostUrl();return"https://twitter.com/intent/tweet?url="+encodeURIComponent(e)},getPopupOptions:function(){return"width=55tion(){return{username:this.get("username"),urlToken:this.get("urlToken")}}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(130),o=i(910),r=i(915),a=i(277),l=o.extend({className:"external-network-twitter-subview external-network-form-subview",template:r,mixins:[a],defaults:n.defaults({username:null,urlToken:"[URL]",shortUrlLength:23,characterLimit:280,characterCount:0,characterCountExceedsLenghClass:"exceeds-length"},o.prototype.defaults),events:n.defaults({"input [data-js-message]":"_onMessageInput"},o.prototype.events),getTitle:function(){var e=this.get("username");return n.isEmpty(e)?s("Twitter"):s("Twitter (@%1$s)",e)},getTemplateData:function(){return{urlToken:this.get("urlToken")}},afterRender:function(){this.listenTo(this,"change:characterCount",this._onChangeCharacterCount),this._updateCharacterCount(),this._onChangeCharacterCount(this,this.get("characterCount")),n.defer(n.bind(this.focus,this)),o.prototype.afterRender.apply(this,arguments)},isFormFieldsValid:function(){var e=this.get("characterCount");return e>0&&e<=this.get("characterLimit")},onFormSubmit:funcmessage:thismessage").focus()},_getMessage:function(){return this.js$("message").val()},_updateCharacterCount:function(){var e=this._calculateCharacterCount(this._getMessage());this.set("characterCount",e)},_updateCharacterCountContainer:function(e){var t=this.js$("character-count"),i=this.get("characterCountExceedsLenghClass"),n=this.get("characterLimit")-e;t.text(n).toggleClass(i,n<0)},_getUrlTokenCountFromMessage:function(e){var t=this.get("urlToken"),i=new RegExp(n.escapeRegExp(t),"ig"),s=e.match(i);return n.isEmpty(s)?0:s.length},_getAdditionalUrLengthFromMessage:function(e){var t=this.get("urlToken"),i=this.get("shortUrlLength"),n=this._getUrlTokenCountFromMessage(e);return 0===n?0:n*i-n*t.length},_calculateCharacterCount:function(e){return e.length+this._getAdditionalUrLengthFromMessage(e)},_onChangeCharacternMessageInput:function(e){this._updateCharacterCount(),this.validateForm()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<form class="form-main"><textarea data-js-message placeholder="'+__e(__("Message (Optional)"))+'" class="message textarea" aria-label="'+__e(__("Optional Twitter message content"))+'"> '+__e(urlToken)+'</textarea></form><div class="form-result form-result--fail" data-js-fail-container> '+__e(__("Something went screwy."))+' </div><footer class="footer"><button type="submit" class="button tx-button blue" data-js-submit-button data-js-text-sending="'+__e(__("Sending..."))+'">'+__e(__("Send"))+'</button><div data-js-character-count class="character-count"></div></footer><div class="form-result form-result--success" data-js-success-container> '+__e(__("Post shared!"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(130),s=i(89nction(){return"copy-permalink"},getLabel:function(){return n("Copy Link")},getType:function(){return s.TYPE_CALLBACK},getButtonHref:function(){return this.getPostUrl()},onClickHandler:function(e){e.preventDefault();var t=this._copyText(this.getPostUrl(),e.currentTarget);t?o.alert(n("It's copied! Paste it wherever!")):o.alert(n("Failed to copy permalink."))},_copyText:function(e,t){var i=document.createElement("input");i.value=e,t.appendChild(i),i.focus(),i.select();var n=!1;try{n=document.execCommand("copy")}catch(e){}return t.removeChild(i),n}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="networkView[]"></div><div data-subview="networksLoaderView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(919),r=i(277),a=i(232),l=s.extend({className:"messaging-share-post-external-network-subview-wrapper",template:o,mixins:[r,a],events:{"click [data-js-back-button]":"_onBackButtonClick"},keycommands:{"keydown:escape":"_onKeyPressEscape"},initialize:function(e){n.extend(this.attributes,n.pick(e,n.keys(this.defmplateData:function(){return{title:this.externalNetworkSubview.getTitle()}},afterRender:function(){this.externalNetworkSubview.render(),this.listenTo(this.externalNetworkSubview,"changeTitle",this._onSubviewChangeTitle),this.listenToOnce(this.externalNetworkSubview,"close",this._onSubviewClose),this.js$("external-network-subview").html(this.externalNetworkSubview.$el)},goBack:function(){this.trigger("goBack")},close:function(){this.trigger("close")},remove:function(){return this.externalNetworkSubviis,arguments)},_onSubviewChangeTitle:function(e){this.js$("title").text(e)},_onSubviewClose:function(){this.close()},_onBackButtonClick:function(e){e.preventDefault(),this.goBack()},_onKeyPressEscape:function(e){e.preventDefault(),this.externalNetworkSubview.isShareSuccess()?this.close():this.goBack()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="header"><a href="#" data-js-back-button class="back-button">'+__e(__("Back"))+'</a><div data-js-title class="title">'+__e(title)+'</div></div><div class="external-network-subview" data-js-external-network-subview></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(921),a=s.extend({className:"messaging-share-post-error",mixins:[o],template:r,defaults:{title:null},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(set("title",erRender:functiis._onChangeTit+__e(title)+"</p>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(762),o=i(696),r=s.extend({className:"conversation-compose-plugin conversation-compose-plugin--blog-selector",defaults:n.defaults({currentTumblelog:null},s.prototype.defaults),renderWithTemplate:n.noop,initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults)));var t=n.extend({className:"conversation-compose-plugin-blog-selector",showName:!1,showCaret:!1},n.pick(e,"collection","curren(){this.blogSelectorView.render(),this.$el.html(this.blogSelectorView.el)},getName:function(){return"blog-selector"},getBlogSelector:function(){return this.blogSelectorView}});e.exports=r},function(e,t,i){"use strict";var n=i(185),s=n.extend({defaults:{participant:null}});e.eturn"/svc/post/share/"+this.get("tumblelog_name")+"/"+this.get("post_id")},defaults:{post_id:null,tumblelog_name:null,twitter_username:null,pinterestrl:null},parse:function(e){return n.get(e,"response.share_popover_data",e)},isValid:function(){return!n.isEmptlog_name"))},isPopulated:function(){return!n.isEmpty(this.get("post_url"))}});e.exports=o},function(e4),s=i(926),o=n.extend({name:"FlatSelect",view:function(e){return new s(e)}});e.exports=o},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(219),r=o.extend({el:"body",default},__selectCelect(t)},initialize:function(e){this.options=s.extend({},this.defaults,e)},updateSelect:function(e){var t=e.siblings("label");t.text(e.find(":selected").text())}});e.exports=r},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(136),r=i(276),a=i(283),l=i(129),c=i(928),u=s.extend({className:"popover--message-controls-popover",mixins:[r,a],template:c,events:{'click [data-action="delete"]':"_delete",'click [data-action="block"]':"_block",'click [data-action="flag"]':"_flag"},initialize:function(e){this.options=n.extend({},e),this.showFlagAndBlock=this.options.blockString&&this._notUsersOwnBlog(),this.post=e.post},_getSender:function(){return!(!this.options.blockString||this.options.blockString.indexOf(":")!==-1)&&this.options.blockString},_notUsersOwnBlog:function(){var e=this._getSender();if(e){var t=l.get("Context/userinfo/channels");return t=n.pluck(t,"name"),!n.includes(t,e)}rs.post.delete(e)},_block:function(e){e.preventDefault(),this.post.block(e)},_flag:function(e){e.preventDefault();var t={mode:"message",post:this.post.model},i=this._getSender();i&&(t.sender=i),o.trigger("abuseform:open",t),o.trigger("Kraken:abuseform:open",t)},render:function(){return this.$el.html(this.template()),this},teardown:function(){return this.$el.remove(),this}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="popover popover_menu popover_gradient message-controls-popover"><div class="popover_inner"><ul> ',this.showFlagAndBlock&&(__p+=' <li class="popover_menu_item" data-action="block" data-block="'+__e(this.options.blockString)+'"><a class="popover_menu_item_anchor" href="#">'+__e(__("Block"))+'</a></li><li class="popover_menu_item" data-action="flag"><a class="popover_menu_item_anchor" href="#">'+__e(__("Report"))+"</a></li> "),__p+=' <li class="popover_menu_item" data-action="delete" data-confirm="'+(null==(__t=__("Are you sure you want to delete this?"))?"":__t)+'"><a class="popover_menu_item_anchor" href="#">'+__e(__("Delete"))+"</a></li></ul></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=[{id:"-1",appeal:"OWNER_APPEAL_NSFW_UNAVAILABLE",readable:"unavailable"},{id:"0",appeal:"OWNER_APPEAL_NSFW_NONE",readable:"none"},{id:"1",appeal:"OWNER_APPEAL_NSFW_AVAILABLE_PRIORITIZE",readable:"available_prioritize"},{id:"2",appeal:"OWNER_APPEAL_NSFW_AVAILABLE",readable:"available"},{id:"3",appeal:"OWNER_APPEAL_NSFW_IN_REVIEW",readable:"in_review"},{id:"4",appeal:"OWNER_APPEAL_NSFW_COMPLETE",readable:"complete"}],s=i(8),o=i(3),r=i(130),a=i(136),l=i(213),c=function(e){return this.xhr&&this.xhr.abort(),this.xhr=s.ajax({method:"POST",url:"/svc/appeal",data:{post_id:this.model.get("id"),blog_name:this.model.get("tumblelog"),state:e},withFormKey:!0}),this.xhr},u=function(e){return parseInt(o.find(n,{appeal:e}).id,10)},h={_handleProjectXBannerRequest:function(e,t,i){var a=this,c=i.model.get("classification-status");if(o.isObject(c)){var u=c.classification,h=c.status,d=!!i.model.get("reblogged_from_tumblr_url")||!!i.model.get("is_reblog"),p={type:"wide",visible_glass:!0,escape_button:0};if(h===o.find(n,{appeal:"OWNER_APPEAL_NSFW_IN_REVIEW"}).readable||h===o.find(n,{appeal:"OWNER_APPEAL_NSFW_NONE"}).readable||h===o.find(n,{appeal:"OWNER_APPEAL_NSFW_COMPLETE"}).readable){var g=d?"InfoExplicitReblogClick":"InfoExplicitClick";this.logExplicitAction(g,{postId:t,state:h})}else this.logExplicitAction("ReviewExplicitClick",{postId:t});var f={text:r("Appeal"),callback:function(){a.logExplicitAction("RequestReviewExplicit",{postId:t}),a.request(e,t,i),i.model.set("classification-status",{classification:u,status:o.find(n,{appeal:"OWNER_APPEAL_NSFW_IN_REVIEW"}).readable});var l=r(d?"This reblog is in content appeal":"Your post is in content appeal"),c=s(e.target).closest(".x-banner");c.addClass("in-review"),c.find(".message-status").text(l);var h=c.find(".review");h.addClass("question-mark"),h.removeClass("appeal"),h.html("<span>?</span>")}},_=function(e){return{text:r("Learn more"),callback:function(){a.logExplicitAction("LearnMoreExplicit",{postId:t}callback:function(){a.logExplicitAction("CancelReviewExplicit",{postId:t})}},v={none:r("This content contains sexually explicit content which violates our Community Guidelines."),available:r("This post was flagged because we think it contains sexually explicit content which violates our Community Guidelines. It has been hidden from others, but not deleted. If you think this was done in error, tap Appeal and a real, live human will review it."),in_review:r("Your post is in content appeal. Once a decision has been made, we'll send you an email."),complete:r("This post was flagged because it contains sexually explicit content which violates our Community Guidelines. It has not been deleted but is now only viewable to you. This decision cannot be appealed."),reblog:r("This post was flagged because somewhere in your reblog there might be sexually explicit content which is a violation of our Community Guidelines.")},b={contentAppeals:"https://www.tumblr.com/docs/contentappeals",adultContent:"https://www.tumblr.com/docs/adultcontentfaq"};if(d&&h!==o.find(n,{appeal:"OWNER_APPEAL_NSFW_COMPLETE"}).readable&&h!==o.find(n,{appeal:"OWNER_APPEAL_NSFW_AVAILABLE_PRIORITIZE"}).readable&&h!==o.find(n,{appeal:"OWNER_APPEAL_NSFW_AVAILABLE"}).readable)o.extend(p,{text:v.reblog,buttons:{0:_(b.adultContent),1:m}});else switch(h){case o.find(n,{appeal:"OWNER_APPEAL_NSFW_AVAILABLE_PRIORITIZE"}).readable:case o.find(n,{appeal:"OWNER_APPEAL_NSFW_AVAILABLE"}).readable:o.extend(p,{text:v.available,buttons:{0:f,1:_(b.adultContent),2:m}});break;case o.find(n,{appeal:"OWNER_APPEAL_NSFW_IN_REVIEW"}).readable:o.extend(p,{text:v.in_review,buttons:{0:_(b.contentAppeals),1:m}});break;case o.find(n,{appeal:"OWNER_APPEAL_NSFW_COMPLETE"}).readable:case o.find(n,{appeal:"OWNER_APPEAL_NSFW_UNAVAILABLE"}).readable:o.extend(p,{text:v.complete,buttons:{0:_(b.adultContent),1:m}});break;default:o.extend(p,{text:v.none,buttons:{0:_(b.adultContent),1:m}})}l.dialog(p)}},request:function(e,t,i){this._appealState=o.bind(c,i),this.xr("Okay! We'll review the status of this and email you when we're done."))},this)),this.logAction("RequestReviewButtonClicked",t)},openPeepr:function(e,t){a.trigger("peepr-open-request",{tumblelog_name:e,post_id:t,editing_appearance:!1,should_bypass_safemode_forpost:!0,should_bypass_safemode_forblog:!1}),this.logAction("ShowNsfwPostAnywaysClicked",t)},getAppealArray:function(){return n},logAction:function(e,t){(o.isNumber(t)||o.isString(t))&&a.trigger("safeMode:"+e,{loggingData:{postId:t}})},logExplicitAction:function(e,t){var i=t.postId,n=t.state;(o.isNumber(i)||o.isString(i))&&("InfoExplicitClick"!==e||o.isString(n))&&a.trigger("Kraken:"+e,{l}};e.exports=h},function(e,t,i){"use strict";function n(e){return new s(e)}var s=i(931);e.exports=n},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(136),a=i(180),l=i(182),c=i(932),u=i(933),h=i(935),d=i(942),p=i(812),g=o.extend({className:"peepr-blog-search",template:c,subviews:{filters:{constructor:u},input:{constructor:h}},events:{"submit .blog-search-form":"formSubmitHandler","click .blog-search-form":"onFormClick","click .clear-search":"clearSearch","click .toggle-search":"toggleSearch"},initialize:function(e){this.options=e,this.user=l(),this.searchActive=!1,this.blog=e.blog,this.model=new p({blogname:this.blog.tumblelog_name_or_id,themeParams:this.blog.get("global_theme_params"),isAdult:this.blog.get("nsfw"),isSafeModeEnabled:a.bool("safe_mode")&&this.user.get("safe_mode")}),n.each(this.subviews,function(e){e.options=e.options||{},e.options.model=this.model},this),this.bindEvents()},bindEvents:function(){this.listenTo(this.model.posts,"reset",this.onPostsReset),this.listenTo(this.model.posts,"add",this.onPostsAdd),this.listenTo(this.model,"search:reset",this.onSearchReset),this.listenTo(this.model,"change:next_offset",this.onOffsetChange),this.listenTo(this.model,"change:term",n.bind(this.log,this,"search-start",{})),this.listenTo(r,"indashblog:search:fetch-requested",this.onFetchRequested),this.listenTo(r,"indashblog:ready-animation-start",this.onPeeprReady)},onPeeprReady:function(){this.setWidth()},setWidth:function(){var e=this.$el.parents(".navigation_inner"),t=e.width(),i=e.find(".header_controls").outerWidth();this.$el.width(e)},formSubmitHandler:function(e){e.preventDefault(),this.model.search()},onFormClick:function(e){e.stopPropagation()},toggleSearch:function(e){return e=n.defaults(e,{force:null,focus:!0}),this.model.get("term").length&&null===e.force?void this.clearSearch():(this.searchActive=n.isBoolean(e.force)?e.force:!this.searchActive,this.$el.toggleClass("show-search",this.searchActive),s(".indash_header_wrapper").toggleClass("search-active",this.searchActive),void(this.searchActive?e.focus&&n.delay(n.bind(this.input.focusInput,this.input),300):this.model.reset()))},clearSearch:function(){this.toggleSearch({force:!1}),r.trigger("indashblog:search:clear"),this.log("search-clear")},onSearchReset:function(){var e=this.model.get("term").length>0;this.$el.toggleClass("term-entered",e),e&&(r.trigger("indashblog:search:start"),this.searchActive||this.toggleSearch({focus:!1,force:!0}))},onPostsReset:function(e){e.length&&(r.trigger("indashblog:search:complete",e.toJSON()),this.log("search-complete"))},onOffsetChange:function(e,t){t>=0||(r.trigger("indashblog:search:results-end",this.model.posts.length?nPostsAdd:function(e){r.trigger("indashblog:search:post-added",e.toJSON())},log:function(e,t){var i={loggingData:n.defaults({blogname:this.blog.tumblelog_name_or_id,term:this.model.get("term"),sort:this.model.get("sort"),post_type:this.model.get("post_type"),post_role:this.model.get("post_role"),next_offset:thremove:function(){this.model.stopListening(),o.prototype.remove.call(this)}});e.exports=g},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<form class="blog-search-form"><div data-subview="filters"></div><i class="icon_arrow_thin_left clear-search nav_icon"></i> ',model.isSafeModeEnabled&&model.isAdult||(__p+=' <i class="icon_search toggle-search nav_icon"></i> '),__p+=' <div data-subview="input"></div></form>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(934),r=i(807),a=s.extend({className:"search-filters",template:o,events:{"click .show-filter-popover":"showPopover"},initialize:function(){this.listenTo(this.model,"search:reset",this.hidePopover)},showPopover:function(){this.popover||(this.popover=new r({pinnedTarget:this.$el,model:this.model,preventInteraction:!0}),this.popover.render(),this.listenTo(this.popover,"close",this.onPopoverClose))},hidePopover:function(){this.popover&&this.popover.hide()},onPopoverClose:function(){n.defer(n.bind(function(){this.popover=null},this))}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<i class="icon_filter show-filter-popover nav_icon"></i>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(136),r=i(277),a=i(936),l=i(940),c=i(941),u=s.extend({className:"search-input",template:c,mixins:[r],$$cacheKeys:{"blog-search-input":".blog-search-input"},initialize:function(){this.autocompletePopover=null,this.bindEvents(),this.blogSearchAutocompleteModel=new l({blogname:this.model.get("blogname")})},afterRender:function(){this.blogSearchAutocompleteHelper=new a({model:this.blogSearchAutocompleteModel,el:this.$$(".blog-search-input")})},events:{"focus .blog-search-input":"inputFocusHandler","keyup .blog-search-input":"rm",this.onTermChange),this.listenTo(this.model,"reset",this.onModelReset)},inputKeyUpHandler:function(){this.model.set("unsetTerm",this.getTerm()),this.blogSearchAutocompleteModel.set("matchTerm",this.getTerm())},focusInput:function(){this.$$(".blog-search-input").focus(),this.blogSearchAutocompleteHelper.showPopover()},get").val())},seg-search-input").val(e).blur()},onTermChange:function(e,t){tnputFocusHandler:function(){o.trigger("indashblog:keycommands:suspend",!0)},inputBlurHandler:function(){o.trigger("indashblog:keycommands:resume")}});e.exports=u},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(r:"onInputBlur"},initialize:function(){this.popover=null,this.bindEvents()},bindEvents:function(){this.listenTo(this.model,"change:matchTerm",this.onMatchTermChange)},onMatchTermChange:function(){this.model.get("typeAheadMatches").length?this.showPopover():this.hidePopover()},showPopover:function(){this.model.getItems().then(n.bind(function(){!this.popover&&this.model.hasMatches()&&(this.popover=new o({pinnedTarget:this.$el,model:this.model,shift:{x:-this.getLeftOffset(),y:0},preventInteraction:!0,keycommands:!0}).render(),this.listenTo(this.popover,"close",this.onPopoverClose))},this))},getLeftOffset:function(){return this._leftOffset=this._leftOffset||this.$el.width()/2,this._leftOffset},onInputBlur:function(){n.delay(n.bind(this.hidePopover,this),100)},hidePopover:function(){this.popover&&this.popover.hide()},onPopoverClose:function(){n.defer(n.bind(function(){this.popover=null},this))}});e.exports=r},function(e,t,i){"use strict";var n=i(808),s=i(938),o=n.extend({className:n.prototype.className+" blog-search-autocomplete-popover",bindEvents:function(){n.prototype.bindEvents.apply(this,arguments),this.listenTo(this,"itemSelected",this.subview.selectTerm)},Subview:s});e.exports=o},function(e,t,i){"use strict";var n=i(8),s=i(136),o=i(226),r=i(939),a=o.extend({template:r,events:{"click [datfunction(){t,this.render)},onTermClick:function(e){this.selectTerm(n(e.currentTarget))},selectTerm:function(e){s.trigger("peeprsearch:change:term",{term:e.attr("data-term")})}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<ul class="popover_inner_list search_filter_items"><li class="popover_header"> '+__e(__("Popular Tags:"))+" </li> ";for(var i=0;i<model.maxRender&&i<model.typeAheadMatches.length;i++)__p+=' <li class="popover_menu_item" data-term="'+__e(model.typeAheadMatches[i].tag)+'"><span class="popover_menu_item_anchor">#'+__e(model.typeAheadMatches[i].tag)+" </span></li> ";__p+=" </ul>"}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(136),r=i(185),a=i(190),l=r.extend({defaults:{maxRender:20,matchTerm:"",typeAheadMatches:[]},urlRoot:"/svc/search/blog_search_typeahead",url:function(){return this.urlRoot+"/"+this.get("blogname")},initialize:function(){this.items=new a,this.fetched=!1,this.listenTo(o,"peeprsearch:change:unsetTerm",this.onUnsetTermChange),thiis.setMatches)},onUnsetTermChange:function(e){this.set("matchTerm",e.term)},hasMatches:function(){return this.items.length&&this.get("typeAheadMatches").length||!this.fetched},setMatches:function(){var e=this.get("matchTerm");if(!e.length)return void this.set("typeAheadMatches",this.items.toJSON());var t=this.items.filter(function(t){return t.get("tag").indexOf(e)>-1});this.set("typeAheadMatches",s.invoke(t,"toJSON"))},getItems:function(){if(this.items.length){var e=n.Deferred();return e.resolve(),e.promise()}return this.fetch(arguments)},parse:function(e){return this.items.reset(e.tags),this.fetched=!0,s.omit(e,"tags")}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<input type="text" class="blog-search-input" placeholder="'+__e(__("Search %s",model.blogname))+'">';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(8),s=i(3),o=i(136),r=i(226),a=i(943),l=r.extend({className:"search-no-results",template:a,afterRender:function(){this.setHeight(),this.listenTo(o,"DOMEventor:flatresize",s.throttle(this.setHeight,300))},setHeight:function(){var e=n(".indash_blog .posts"),t=e.outerHeight()-e.height(),i=n(".indash_blog .header").height();this.$el.height(n(window).height()-i-t)}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<p class="no-results-text" style="color: '+__e(model.themeParams.title_color)+'">'+(null==(__t=__("Nothing here about<br/>%s.",_.escape(model.termy(void 0,_values(_imports))},function(e,t,i){"use strict";e.exports=i(945)},function(e,t,i){"use strict";var n=i(3),s=i(136),o=i(180),r=i(226),a=i(946),l=i(950),c=i(686),u=r.extend({template:l,className:"messaging-popover-icon nav_icon",events:{click:"_onIconClick"},initialize:function(e){this.options=n.extend({},this.defaults,e),n.extend(this,n.pick(e,"model"))},subviews:{statusIndicator:{constructor:c,options:function(e){return{isOnline:e.model.get("isOnline"),canSeeUIFlag:o.bool("status_indicator"),name:e.model.get("name")}}}},showPopover:function(){this.popover||(this.popover=new a({pinnedTarget:this.$el,model:this.model,preventInteraction:!0}),this.popover.render(),this.listenTo(this.popover.getView(),"messagingSelected",this._onMessagingSelected),this.listenTo(this.popover.getView(),"askSelected",this._onAskSelected),this.listenTo(this.popover,"close",this._onPopoverClose))},openMessaging:function(){s.trigger("messaging:conversation:open:tumblelogs",[this.model],"peepr")},openAsk:function(){s.trigger("ask:form:open",{recipient:this.model.get("name"),allow_anonymous:this.model.get("anonymous_asks")})},_onIconClick:function(){this.openMessaging(),(this.model.get("asks")||this.model.get("submissions"))&&this.showPopover()},_onMessagingSelected:function(){this.openMessaging()},_onAskSelected:function(){this.openAsk()},_onPopoverClose:function(){this.stopListening(this.popover),this.stopListening(this.popover.getView()),this.popover=null}});e.exports=u},function(e,t,i){"use strict";var n=i(3),s=i(219),o=i(947),r=i(276),a=i(283),l=i(949),c=s.extend({className:"popover--messaging-peepr popover info_popover popover_gradient",template:l,mixins:[r,a],initialize:function(e){this.options=n.extend({},this.defaults,e),this.view=new o({model:this.model})},render:function(){return this.$el.html(this.template),this.$(".popover_inner").append(this.view.render().$el),this.listenTo(this.view,"popoverClose",this.teardown),this},teardown:function(){this.view.remove(),this.remove()},getView:function(){return this.view}});e.exports=c},function(e,t,i){"use strict";var n=i(3),s=i(226),o=i(948),r=s.extend({tagName:"ul",template:o,events:{"click [data-js-ask]":"_onClickAsk","click [data-js-message]":"_onClickMessage"},getTemplateData:function(){return{hasMessaging:this.model.get("can_receive_messages")===!0,hasAsks:this.model.get("asks")===!0,hasSubmissions:this.model.get("submissions")===!0,url:this.model.get("url")}},_onClickMessage:function(e){e.preventDefault(),this.trigger("messagingSelected"),this.trigger("popoverClose")},_onClickAsk:function(e){e.preventDefault(),this.trigger("askSelected"),n.delay(n.bind(function(){this.trigger("popoverClose")},this),1)}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)hasMessaging&&(__p+=' <li data-js-message><a href="#">'+__e(_("Send a message"))+"</a></li> "),__p+=" ",hasAsks&&(__p+=' <li data-js-ask><a class="ask" href="'+__e(url)+'/ask">'+__e(_("Ask a question"))+"</a></li> "),__p+=" ",hasSubmissions&&(__p+=' <li data-js-submit><a class="submit" target="_blank" href="'+__e(url)+'/submit">'+__e(_("Submit"))+"</a></li> ");return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="popover_inner"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-subview="statusIndicator"></div> '+__e(_("Send a message"));return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(21onHelper",def{this.set(this.data)},getNextAdPos:function(){return this.get("nextAdPos"se strict";function n(e){var t=e.filter(function(e){return o.includes(r,e)});return t.join("_")}function s(e){var t=e.closest(".post"),i=o.get(t.data("json"),"post-id")||t.attr("data-post-id"),s=t.find(".note_link_current").data("count"),r=n(e.attr("class").split(" "));return{postId:i,noteCount:s,noteType:r}}var o=i(3),r=["like","reblog","answer","reply","photo","with_commentary"];e.exports=s},function(e,t,i){"use strict";var n=i(248),s=function(e){i.e(3,fu"_host"),o.get(s,t)}var s,o=i(3),r=i(129),a={get:o.memoize(n)};e.exports=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n=i(1003);e.exports=n},function(e,t,i){"use strict";var n=i(226),s=i(1004),o=i(3),r=i(1006),a=i(138),l=i(136),c=i(220),u=i(348),h=n.extend({className:"carousel-container",template:r,hasPeeked:!1,mixins:[u],subviews:{carouselPositionView:{constructor:s,options:function(e){return{photoCount:e.model.get("photoset_photos").length}}}},events:{"click .carousel-item-container a":"contentLinkClick"},initialize:function(e){e=e||{},this.currentItem=0,this.redirectUrlPrimary=e.redirect_url_primary,this.setupWatcher(),this.model.set("is_carousel",!0),this.model.set("carousel_index",this.currentItem)},afterRenderSubviews:function(){var e=this;o.defer(function(){e.imageWidth=e.carouselPositionView.$el.width(),window.parent.postMessage("resize_photoset_iframe;"+e.model.get("id")+";"+e.imageWidth,"*")}),this.carouselItemContainer=this.$(".carousel-item-container"),this.listenTo(this.carouselPositionView,"switchCarouselItem",this.processCarouselItemSwitch),this.listenTo(this.carouselPositionView,"peekLeft",this.peekLeft),this.listenTo(this.carouselPositionView,"peekRight",this.peekRight),this.peekIfInViewport(),this.listenTo(l,"DOMEventor:flatscroll",o.throttle(this.peekIfInViewport,500),this)},render:function(){return this.$el.html(this.template({post:this.model,redirect_url_primary:this.redirectUrlPrimary})),this},peekIfInViewport:function(){var e=this;!this.hasPeeked&&this.watcher&&this.watcher.isFullyInViewport&&(this.carouselItemContainer,function(){e.carouselItemContainer.removeClass("peek-animation")}),this.hasPeeked=!0,this.stopListening(l,"DOMEventor:flatscroll"),this.watcher=null)},peekLeft:function(){var e=this.$(".carousel-wrapper");e.addClass("peek-left-animation"),c.animation(e,function(){e.removeClass("peek-left-animation")})},peekRight:function(){var e=this.$(".carousel-wrapper");e.addClass("peek-right-animation"),c.animation(e,function(){e.removeClass("peek-right-animation")})},processCarouselItemSwitch:function(e){this.model.get("pt")&&l.trigger("carousel:slide",{loggingData:this.loggingData({userAction:"slide",extraData:{offset:this.currentItem,target_offset:e}})}),this.carouselItemContainer.css({transform:"translate3d("+e*-this.imageWidth+"px, 0, 0)"}),this.currentItem=e,this.model.set("carousel_index",e)},setupWatcher:function(){this.watcher=a.create(this.$el,-100)},contentLinkClick:function(){this.model.get("pt")&&l.trigger("carousel:click_thru",{loggingData:this.loggingData({userAction:"click_thru",extraData:{offset:this.currentItem}})})}});e.exports=h},function(e,t,i){"use strict";var n=i(8),s=i(226),o=i(1005),r=s.extend({autoAppend:!0,template:o,events:{"click .carousel-button":"onCarouselButtonClick","click .carousel-arrow-right":"goToNextItem","click .carousel-arrow-left":"goToPrevItem"},initialize:function(e){e=etem=0},switchCarouselItem:function(e){this.trigger("switchCarouselItem",e)},goToItem:function(e){e>=0&&e<=this.photoCount-1?(this.$(".carousel-button").removeClass("current"),this.$('.carousel-button[data-carousel-button-index="'+e+'"]').addClass("current"),this.currentItem=e,this.switchCarouselItem(this.currentItem)):e<0?this.triggr("peekRight"currentItem+1)},goToPrnction(n(){return this.$el.html(this.template({photoCount:this.photoCount})),this}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){for(__p+='<div class="carousel-arrow carousel-arrow-left"></div><div class="carousel-arrow carousel-arrow-right"></div><div class="carousel-button-container"> ',i=0;i<photoCount;i++)__p+=' <span class="carousel-button'+__e(0===i?" current":"")+'" data-carousel-button-index="'+__e(i)+'">&#x25cf;</span> ';__p+=" </div>"}return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="carousel-wrapper"><div class="carousel-item-container"> ',_.forEach(post.get("photoset_photos"),function(e,t){__p+=" ",(e.primary_url||redirect_url_primary)&&(__p+=' <a target="_blank" href="'+__e(e.primary_url?e.primary_url:redirect_url_primary)+'"> '),__p+=' <img class="carousel-item carousel-item-'+__e(t)+'" src="'+__e(e.high_res)+'" alt="'+__e(e.caption)+'"> ',(e.primary_url||redirect_url_primary)&&(__p+=" </a> "),__p+=" "}),__p+=' </div></div><div data-subview="carouselPos_values(_imports))},function(e,t,i){"use strict";var n=i(1008);e.exports=n},function(e,t,i){"use strict";var n=i(226),s=i(1009),o=i(136),r=i(8),a=n.extend({events:{"click .see-all-tags":"_expandTags","click .post_tag":"_clickTag"},hasExpandedTags:!1,template:s,_expandTags:function(e){o.trigger("postchrome-interactions:expand-tags-click",{loggingData:{action:"expand-tags-click"}}),this.hasExpandedTags=!ee-all-tags").remove()},render:function(){this.$el.append(this.template())},_clickTag:function(e){var t=r(e.target);o.trigger("postchrome-interactions:tag-click",{loggingData:{action:"tag-click",tag:t.text(),hasExpandedTags:this.hasExpandedTags?"true":"false",wasHidden:this.hasExpandedTags&&t.position().top>81?"true":"false",postId:this.model.get("id"),tagIndex:t.index()}})}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="see-all-tags"><span class="ellipses">...</span> '+__e(__("See all"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var n=i(219),s=i(136),o=n.extend({events:{click:"_onLinkClick"},initialize:function(e){e&&e.postModel?ostModelJSON=""},_onLinkClick:function(){this._triggerEvent("buttonClick")},_triggerEvent:function(e){s.trigger("CTAButton:"+e,{loggingData:{postData:this.postModelJSON,userAction:"action_click"}})}});e.exports=o},function(e,t,i){"use strict";var n=i(214),s=i(1012),o=i(1015),r=i(1017),a=i(1016),l=n.extend({name:"Viewability",autoAppend:!0,defaults:{},initialize:function(e){var t=this,i=e.isVideo,n=e.beacons,a=e.beaconRules,l=e.element;this.el=l,i?this.context=new o(this.el,function(){return t.stateChanged}):this.context=new s(this.el,function(){return t.stateChanged}),this.rulesEngine=new r(a,n,this.context)},stateChanged:function(e){switch(e){case a.RESET:this.rulesEngine.resetRules(function(e){return!0});break;case a.RESET_AUDIO:this.rulesEngine.resetAudioOnContinuousRules();break;case a.RESET_CONTINUOUS:this.rulesEngine.resetContinuousRules();break;default:this.rulesEngine.checkRules(this.context)}}});e.exports=l},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return functios,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),r(t,[{key:"isMuted",value:function(){return!0}},{key:"timePosition",value:function(){return 0!==this.teOffset()-this.timeInView:0}alue:function(){return 0}},{key:"getMacroValue",value:function(e){return""}}]),t}(a);e.exports=l},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(3),r=i(8),a=i(1014),l=3e5,c=function(){function e(t,i){n(this,e),this.el=t,this.stateChangeFn=i,this.positionMonitor=new a({el:this.el,headerEl:r(".l-header-container").get(0)}),this.timeInView=0,this.isLargeElement=this.getElHeight()*this.getElWidth()>:function(){}},{key:"getTimeOffset",value:function(){return Date.now()/1e3}},{key:"percentageInView",value:function(){var e=100*this.positionMonitor.getPercentageInView();return e>0&&0===this.timeInView?this.timeInView=this.getTimeOffset():0===e&&(this.timeInVey:"timePosition",value:function(){}},{key:"maxDuration",value:function(){}},{key:"getElHeight",value:function(){var e=this.positionMonitor.getElHeight();return o.isNumber(e)?e:-1}},{key:"getElWidth",value:function(){var e=this.positionidth();return o.isNumber(e)?e:-1}},{key:"getMacroValue",value:function(e){}}]),e}();e.exports=c},function(e,t,i){"use strict";var n=i(3),s=i(8),o=i(136),r=i(226),a=r.extend({defaults:{frameLeft:null,frameTop:null,frameRight:null,frameBottom:null,isTabHidden:!1,headerHeight:0},initialize:function(e){this.listenTo(o,"DOMEventor:flatresize",this.setHeaderHeight),this.$headerEl=s(e.headerEl),this.setHeaderHeight(),this.$window=s(window),this.setFramePositions(),s(docuty:function(e){this.set("isTabHidden","hidden"===document.visibilityState)},setHeaderHeight:function(){this.set("headerHeight",this.getFramePosition(this.$headerEl.outerHeight()))},setFramePositions:function(){this.set({frameTop:this.getFramePosition(this.$window.scrollTop())+this.get("headerHeight"),frameBottom:this.getFramePosition(this.$window.scrollTop())+this.getFramePosition(this.$window.height()),frameLeft:this.getFramePosition(this.$window.scrollLeft()),frameRight:this.getFramePosition(this.$window.scrollLeft())+this.getFramePosition(this.$window.width())})},getFramePosition:function(e){return n.isNumber(e)?e:-1},getElWidth:function(){var e=this.$el.width();return n.isNumber(e)?e:-1},getElHeight:function(){var e=this.$el.height();return n.isNumber(e)?e:-1},getPercentageInView:function(){if(this.get("isTabHidden"))return 0;this.setFramePositions();var e=this.getElWidth(),t=this.getElHeight(),i=this.$el.offset(),n=i.left,s=i.top,o=i.left+e,r=i.top+t,a=0,l=0,c=0,u=0,h=0,d=0,p=0,g=0,f=0;if(this.get("frameTop")>r||this.get("frameBottom")<s||this.get("frameLeft")>o||this.get("frameRight")<n)return 0;this.get("frameTop")>s&&(d=this.get("frameTop")-s,a=d*e),this.get("frameBottom")<r&&(p=r-this.get("frameBottom"),l=p*e),this.get("frameLeft")>n&&(g=this.get("frameLeft")-n,c=g*t),this.get("frameRight")<o&&(f=o-this.get("frameRight"),u=f*t),a&&u&&(h+=d*f),a&&c&&(h+=d*g),l&&u&&(h+=p*f),l&&c&&(h+=p*g);var _bje,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(3),c=i(1013),u=i(1016),h=function(e){function t(e,i){n(this,t);var o=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.video,i));return o.videoPlayer=e,o.duration=0,o.timedMacroState={},o.currentTimePos=0,o.isInViewHalfTime=!1,o.setupMacroValues(),o.addEventListeners(),o}return o(t,e),a(t,[{key:"setupMacroValues",value:function(){this.callbackMacros={"$(V_SKIP_AVAIL)":this.macroIsSkipAvailable,"$(V_AUTOPLAYED)":this.macroIsAutoplayed,"$(V_PLAYER_WIDTH)":this.getElWidth,"$(V_PLAYER_HEIGHT)":this.getElHeight,"$(V_EXPANDED)":this.macroIsExpanded,"$(V_MUTED)":this.macroIsMuted,"$(V_AUD_INFO)":this.macroIsMuted,"$(V_MOAT_IVT)":this.getIVT,"$(V_VIEW_INFO)":this.macroIsInView,"$(V_IS_INVIEW_100_HALFTIME)":this.macroIsInViewHalfTime,"$(V_AUD_TIME_INVIEW_100)":this.getTimedMacroValue,"$(V_TIME_INVIEW_50)":this.getTimedMacroValue,"$(V_TIME_INVIEW_50_MAX_CONTINUOUS)":this.getTimedMacroValue},this.timedMacros={"$(V_AUD_TIME_INVIEW_100)":{a:!0,p:100},"$(V_TIME_INVIEW_50)":{p:50},"$(V_TIME_INVIEW_50_MAX_CONTINUOUS)":{c:!0,p:50},"$(V_IS_INVIEW_100_HALFTIME)":{c:!0,p:100}},this.setAutoplayState(),this.resetAllTimedMacroState()}},{key:"resetTimedMacroState",value:function(e){var t=this;l.forEach(this.timedMacros,function(i,n){e(i)&&(t.timedMacroState[n]=0)})}acroState",value:function(){this.resetTimedacros",value:function(){this.resetTimedMacroState(function(e){return e.c})}},{key:"resetAudioTimedMacros",value:function(){this.revalue:function(){this.autoplay=this.videoPlayer.player.crt.get("autoplay")}},{key:"isAutoplay",value:function(){return this.autoplay}},{key:"macroIsAutoplayed",value.isAutoplay())}},{key:"macroIsSkipAvailable",value:function(){return r(!1)}},{key:"macroIsInViewHalfTime",value:function(e){if(this.isInViewHalfTime===!1){var t=1e3*this.maxDuration()/2,i=this.getTimedMacroValue(e);i>=Math.min(15e3,t)&&(this.isInViewHalfTime=!0)}return r(this.isInViewHalfTime)}},{key:"macroIsInView",value:function(){return this.percentageInView()>=50?1:2}},{key:"isMuted",value:function(){return this.videoPlayer.player.crt.get("muted")}},{key:"macroIsMuted",vad",value:function(){return thien")}},{key:"macroIsExpanded",value:function(){return r(this.isExpanded())}},{key:"getIVT",value:function(){var e=l.get(window,"DARLA.metrics.getIvtSignals");return e?window.encodeURIComponent(e()):"-1"}},{key:"addEventListeners",value:function(){this.videoPlayer.on({"change:muted":this.handleMute,"change:paused":this.handlePause,"change:_position":this.positionChanged},this),this.videoPlayer.player.on("loop",l.bind(this.handleLoop,this))}},{key:"handleMute",value:function(e,t){t&&this.resetAudioTim){this.stateChangeFn(u.RESET_CONTINUOUS),this.resetContinuousTimedMacros()}},{key:"positionChanged",value:function(e,t){this.processTimedMacros(t),this.currehandleLoop",value:function(){this.resetState(),this.stateChangeFn(u.RESET)}},{key:"timePosition",value:function(){return this.currentTimePos}},{key:"maxDuration",value:function(){return 0===this.duration&&(this.duration=this.videoPlayer.player.crt.get("duration")),this.duration}},{key:"resetState",value:function(){this.resetAllTimedMacroState()}},{key:"processTimedMacros",value:function(e){var t=this;l.forEach(this.timedMacros,function(i,n){var s=!0,o=!0;if(i.a&&t.videoPlayer.player.crt.get("muted")&&(s=!1),i.p&&t.percentageInView()<i.p&&(o=!1),s&&o){var r=e-t.timePosition();t.timedMacroState[n]=Math.min(t.maxDuration(),t.timedMacroState[n]+r)}else i.c===!0&&(t.timedMacroState[n]=0)})}},{key:"getTimedMacroValue",value:function(e){return Math.round(1e3*this.timedMacroState[e])}},{key:"getDurationMacroValue",value:function(e,t){return r(this.timedMacroState[e]>=t)}},{key:"getMacroValue",value:function(e){return this.callbackMacros[e]?this.callbackMacros[e].call(this,e):"-1"}}]),t}(c);e.exports=h},function(e,t){"use strict";var i={POSITION_CHANGE:"position_change",RESET:"reset",RESET_AUDIO:"reset_audio",RESET_CONTINUOUS:"reset_continuous"};e.exports=i},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(3),r=i(1018),a=i(1019),l=i(1020),c={VIDEO_30_SEC:{d:30}},u={VIDEO_START:0,VIDEO_QUARTILE_25:25,VIDEO_QUARTILE_50:50,VIDEO_QUARTILE_75:75,VIDEO_QUARTILE_100:98},h={viewabilityDefStatic:"STATIC_VIEW",viewabilityDefStatic3P:"STATIC_VIEW_3P",viewabilityDefVideo:"VIDEO_VIEW",viewabilityDefVideo3P:"VIDEO_VIEW_3P"},d=function(){function e(t,i,s){n(this,e),this.beacons=i,this.beaconHandler=new l,this.rules=[],this.context=s,this.processRules(t,this.beacons),this.processTimedBeacons(this.beacons,s.maxDuration())}return s(e,[{key:"processTimedBeacons",value:function(e,t){var i=this;t<=0||o.forEach(e,function(n,s){c[s]&&i.processRule(s,e,c[s]),"undefined"!=typeof u[s]&&i.processRule(s,e,{d:u[s]/100*t})})}},{key:"processRules",value:tion(e,n){o.isArray(e)?o.forEach(e,function(e){return i.processRule(n,t,e)}):i.processRule(n,t,e)})}},{key:"processRule",value:function(e,t,i){var n=new r(e,i);h[e]&&t[h[e]]?n.setBeacons(t[h[e]]):"undefined"!=typeof u[e]&&t[e]?n.setBeacons(t[e]):"undefined"!=typeof c[e]&&t[e]&&n.setBeacons(t[e]),this.rules.push(n)}},{key:"checkRules",value:function(e){var t=this;o.forEach(this.rules,function(i){i.checkRule(e)&&(i.firedBeacons||(t.fireBeacons(i),i.firedBeacons=!0))})}},{key:"resetContinuousRules",value:function(){this.resetRules(function(e){return e.reqContinuunction(){this.resetRules(function(e){return e.reqContinuous&&e.reqAudioOn})}},{key:"resetRules",value:function(e){var t=o.filter(this.rules,e);o.forEach(t,function(e){return e.reset()})}},{key:"replaceMacros",value:function(e,t,i){return o.forEach(a.CONTEXT,function(t){if(e.indexOf(t)){var n=i.getMacroValue(t);"undefined"!=typeof n&&(e=e.replace(t,n))}}),o.forEach(a.RULE,function(i){if(e.indexOf(i)){var n=t.getMacroValue(i);"undefined"!=typeof n&&(e=e.replace(i,n))}}),e}},{key:"fireBeacons",value:function(e){var t=this;o.forEach(e.getBeacons(),function(i){i=t.replaceMacros(i,e,t.context),t.beaconHandler.fireBeacon(i)})}}]),e}();e.exports=d},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function(){function e(t,n){i(this,e),this.beacons=[],this.ruleKey=t,this.originalRule=n,this.reqAudioOn=n.a||!1,this.reqContinuous=n.c||!1,this.reqDuration=n.d||!1,this.reqPercentInView=n.p||!1,this.reqRuleType=n.t||!1,this.firedBeacons=!1,this.totalTimeMeetingReqs=0,this.lastMetReqTime=0,this.macroValues={"$(V_VIEW_TYPE)":this.reqRuleType,"$(S_VIEW_TYPE)":this.reqRuleType}}return n(e,[{key:"reset",value:function(){this.totalTimeMeetingReqs=0}},{key:"checkRule",value:function(e){var t=!1;return this.audioCheck(e)||(t=!0),this.percentInView(e)||(t=!0),t?(this.reqContinuous&&(this.lastMetReqTime=!1),!1):(this.lastMetReqTime===!1?this.totalTimeMeetingReqs=0:this.totalTimeMeetingReqs+=e.timePosition()-this.lastMetReqTime,this.lastMetReqTime=e.timePosition(),this.durationCheck())}},{key:"setBeacons",value:function(e){this.beacons=e}},{key:"getBeacons",value:function(){return this.beacons}},{key:"audioCheck",value:function(e){return!this.reqAudioOn||!e.isMuted()}},{key:"percentInView",value:function(e){return!(this.reqPercentInView>0&&e.percentageInView()<this.reqPercentInView)}},{key:"durationCheck",value:function(){return!(this.reqDuratiolue",value:function(e){return this.macroValues[e]?this.macroValues[e]:"-1"}},{key:"print",value:function(e){console.log(e,this.ruleKey,this.originalRule)}}]),e}();e.exports=s},function(e,t){"use strict";var i={CONTEXT:{V_SKIP_AVAIL:"$(V_SKIP_AVAIL)",V_AUTOPLAYED:"$(V_AUTOPLAYED)",V_PLAYER_WIDTH:"$(V_PLAYER_WIDTH)",V_PLAYER_HEIGHT:"$(V_PLAYER_HEIGHT)",V_EXPANDED:"$(V_EXPANDED)",V_AUD_INFO:"$(V_AUD_INFO)",V_AUD_TIME_INVIEW_100:"$(V_AUD_TIME_INVIEW_100)",V_MUTED:"$(V_MUTED)",V_MOAT_IVT:"$(V_MOAT_IVT)",V_TIME_INVIEW_50:"$(V_TIME_INVIEW_50)",V_IS_INVIEW_100_HALFTIME:"$(V_IS_INVIEW_100_HALFTIME)",V_TIME_INVIEW_50_MAX_CONTINUOUS:"$(V_TIME_INVIEW_50_MAX_CONTINUOUS)",V_VIEW_INFO:"$(V_VIEW_INFO)"},RULE:{V_VIEW_TYPE:"$(V_VIEW_TYPE)",S_VIEW_TYPE:"$(S_VIEW_TYPE)"}};e.exports=i},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return functt}}(),o=i(132),r=function(){function e(){n(this,e),this.body=document.body}return s(e,[{key:"fireBeacon",value:function(e){var t=this,i=document.createElement("iframe");i.setAttribute("src",e),i.style.display="none",i.addEventListener("load",function(){o.logSaw("moatLogs","endpoint fired: "+e),t.destroyIframe(i)}),this.body.appendChild(i)}},{key:"destroyIframe",value:function(e){this.body.removeChild(e)}}]),e}();e.exports=r},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,ifunction e(){n(this,e),this.viewabilityComponents=[],this.startHeartBeat()}returyComponents.forEach(function(e){return e.stateChanged(o.POSITION_CHANGE)})},r)}},{key:"handleNewViewabilityComponent",value:function(e){this.viewabilityComponents.push(e)}}]),e}();e.exports=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){}]);