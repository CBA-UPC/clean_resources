/*! For license information please see SPLITIOJS.94f66975.chunk.js.LICENSE.txt */
(self.webpackChunkreact_customer=self.webpackChunkreact_customer||[]).push([[7649],{9475:function(t,e,n){"use strict";n.r(e),n.d(e,{SplitFactory:function(){return ko}});var r=n(93545),i=n.n(r),a=function(t){return void 0!==t&&null!==t&&"function"===typeof t.then};nction c(t,e,n){var r=n;try{var i=e.split("."),a=t;i.forEach((),"undefined"!==typeof a&&(r=a)}catch(o){}return r}function u(t,e){if(Array.isArray(t)&&"function"===typeof e)for(var n=0;n<t.length;n++)if(!0===e(t[n],n,t))return n;return-1}function l(t,e){var n;if(d(t))for(var r=Object.keys(t),i=0;i<r.length&&!n;i++){var a=r[i];e(t[a],a,t)&&(n=t[a])}else if(Array.isArray(t))for(var o=0;o<t.length&&!n;o++){e(t[o],o,t)&&(n=t[o])}return n}unction h(t){return t instanceof Number&&(t=t.valueOf()),"number"===typeof t&&(Number.isFinite?Number.isFinite(t):isFinite(t))}function p(t){return t instanceof Number&&(t=t.valueOf()),t!==t}var g=-1;unction v(t,e){var n=t;d(e)&&Object.keys(e).forEach(();for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];if(i&&i.length){var o=i.splice(0,1)[0];n=v.apply(void 0,[n,o].concat(i))}return n}unction y(t){if(null==t)return"";if("string"===typeof t)return t;if(Array.isArray(t))return t.map(()+"";var e=t+"";return"0"===e&&1/t===Number.NEGATIVE_INFINITY?"-0":e}function S(t){if("number"===typeof t)return t;if(d(t)&&"function"===typeof t.valueOf){var e=t.valueOf();t=d(e)?e+"":e}return"string"!==typeof t?0===t?t:+t:+(t=t.replace(/^\s+|\s+$/g,""))}{DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",NONE:"NONE"},R=A.DEBUG,O=I={showLevel:!0,displayAllErrors:!1},w=function(){function t(e,n){_(this,t),this.category=e,this.options=i()({},I,n)}return k(t,[{key:"debug",value:function(t){this._shouldLog(A.DEBUG)&&this._log(A.DEBUG,t)}},{key:"info",value:function(t){this._shouldLog(A.INFO)&&this._log(A.INFO,t)}},{key:"warn",value:,{key:"error",value:,{key:"_log",value:,{key:"_generateLogMessage",value:,{key:"_shouldLog",value:function(t){var e=R,n=Object.keys(A).map((function(t){return A[t]}));return n.indexOf(t)>=n.indexOf(e)}}]),t}();ar D=M={showLevel:!0,displayAllErrors:!1},L=!1;"undefined"!==typeof process&&"undefined"!==typeof process.version&&process.version&&(L=!0);var P=String(L?{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_RUNNING_ENV:"prod",REACT_APP_VERSION:"v240131-2202"}.SPLITIO_DEBUG:C()?localStorage.getItem("splitio_debug"):""),F=function(t){return new w(t,v(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M))},K=F("splitio-utils:logger"),U={enable:function(){O(A.DEBUG)},setLogLevel:function(t){D(t)?O(t):K.error("Invalid Log Level - No changes to the logs will be applied.")},disable:LogLevel:A};/^(enabled?|on)/i.test(P)?U.enable(A.DEBUG):D(P)?U.setLogLevel(P):U.disable();var G=F,x=G("",{displayAllErrors:!0}),B={};ar W=G("");var j=G(""),Y=/^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/;function z(t,e){if(void 0==t)j.error("".concat(e,": you passed a null or undefined event_type, event_type must be a non-empty string."));else if(f(t))if(0===t.length)j.error("".concat(e,": you passed an empty event_type, event_type must be a non-empty string."));else{if(Y.test(t))return t;j.error("".concat(e,': you passed "').concat(t,'", event_type must adhere to the regular expression /^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/g. This means an event_type must be alphanumeric, cannot be more than 80 characters long, and can only include a dash, underscore, period, or colon as separators of alphanumeric characters.'))}else j.error("".concat(e,": you passed an invalid event_type, event_type must be a non-empty string."));return!1}var q=G("");function V(t,e){return h(t)||void 0==t?t:(q.error("".concat(e,": value must be a finite number.")),!1)}var Q=G(""),J={NULL:0,STRING:2,BOOLEAN:4,NUMBER:8},$=300,Z=32768,X=1024;function tt(t,e){if(void 0==t)return{properties:null,size:X};if(!d(t))return Q.error("".concat(e,": properties must be a plain object.")),{properties:!1,size:X};var n=Object.keys(t),r=function(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=t[e[r]];return n}(t),i={properties:r,size:X};n.length>$&&Q.warn("".concat(e,": Event has more than 300 properties. Some of them will be trimmed when processed."));for(var a=0;a<n.length;a++){i.size+=n[a].length*J.STRING;var o=r[n[a]],s=f(o),c=h(o),u=E(o),l=null===o;if(s||c||u||l||(r[n[a]]=null,o=null,l=!0,Q.warn("".concat(e,": Property ").concat(n[a]," is of invalid type. Setting value to null."))),l?i.size+=J.NULL:c?i.size+=J.NUMBER:u?i.size+=J.BOOLEAN:s&&(i.size+=o.length*J.STRING),i.size>Z){Q.error("".concat(e,": The maximum size allowed for the properties is 32768 bytes, which was exceeded. Event not queued.")),i.properties=!1;break}}return i}var et=G(""),nt=250;function rt(t,e,n){if(void 0==t)return et.error("".concat(e,": you passed a null or undefined ").concat(n,", ").concat(n," must be a non-empty string.")),!1;if(h(t))return et.warn("".concat(e,": ").concat(n,' "').concat(t,'" is not of type string, converting.')),y(t);if(f(t)){if((t=t.trim()).length>0&&t.length<=nt)return t;0===t.length?et.error("".concat(e,": you passed an empty string, ").concat(n," must be a non-empty string.")):t.length>nt&&et.error("".concat(e,": ").concat(n," too long, ").concat(n," must be 250 characters or less."))}else et.error("".concat(e,": you passed an invalid ").concat(n," type, ").concat(n," must be a non-empty string."));return!1}function it(t,e){if(d(t)){var n=rt(t.matchingKey,e,"matchingKey"),r=rt(t.bucketingKey,e,"bucketingKey");return n&&r?{matchingKey:n,bucketingKey:r}:(et.error("".concat(e,": Key must be an object with bucketingKey and matchingKey with valid string properties.")),!1)}return rt(t,e,"key")}var at="definition not found",ot="exception",st=G(""),ct=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/;function ut(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"split name";if(void 0==t)st.error("".concat(e,": you passed a null or undefined ").concat(n,", ").concat(n," must be a non-empty string."));else if(f(t)){if(ct.test(t)&&(st.warn("".concat(e,": ").concat(n,' "').concat(t,'" has extra whitespace, trimming.')),t=t.trim()),t.length>0)return t;st.error("".concat(e,": you passed an empty ").concat(n,", ").concat(n," must be a non-empty string."))}else st.error("".concat(e,": you passed an invalid ").concat(n,", ").concat(n," must be a non-empty string."));return!1}function lt(t,e,n,r){return!t.get(t.constants.READY,!0)||n!==at&&null!=n||(st.warn("".concat(r,': you passed "').concat(e,'" that does not exist in this environment, please double check what Splits exist in the web console.')),!1)}var ft=G("");function ht(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"split_names",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"split name";if(Array.isArray(t)&&t.length>0){var i=[];if(t.forEach((),i.length)return m(i)}return ft.error("".concat(e,": ").concat(n," must be a non-empty array.")),!1}var pt="localhost",gt="standalone",dt="producer",vt="consumer",mt="MEMORY",yt="LOCALSTORAGE",St="control",Tt={treatment:St,config:null},Et="GOOGLE_ANALYTICS_TO_SPLIT",_t="SPLIT_TO_GOOGLE_ANALYTICS",bt="IMPRESSION",Nt="EVENT",kt=[{type:"byName",maxLength:400,queryParam:"names="},{type:"byPrefix",maxLength:50,queryParam:"prefixes="}],At="DEBUG",Rt="OPTIMIZED",Ot=G(""),It=/[A-Z]/;function wt(t,e){if(void 0==t)Ot.error("".concat(e,": you passed a null or undefined traffic_type_name, traffic_type_name must be a non-empty string."));else if(f(t)){if(0!==t.length)return It.test(t)&&(Ot.warn("".concat(e,": traffic_type_name should be all lowercase - converting string to lowercase.")),t=t.toLowerCase()),t;Ot.error("".concat(e,": you passed an empty traffic_type_name, traffic_type_name must be a non-empty string."))}else Ot.error("".concat(e,": you passed an invalid traffic_type_name, traffic_type_name must be a non-empty string."));return!1}function Ct(t,e){Ot.warn("".concat(t,": Traffic Type ").concat(e," does not have any corresponding Splits in this environment, make sure you're tracking your events to a valid traffic type defined in the Split console."))}var Dt=G("",{displayAllErrors:!0});unction Lt(t,e){return!(!t.get(t.constants.READY,!0)&&!t.get(t.constants.READY_FROM_CACHE,!0))||(Dt.warn("".concat(e,": the SDK is not ready, results may be incorrect. Make sure to wait for SDK readiness before using this method.")),!1)}var Pt=function(t){var e=t.conditions,n=l(e,();return n||(n=e[0]),n?n.partitions.map((function(t){return t.treatment})):[]},Ft=Kt=function(t){var e=[];return t.forEach((function(t){var n=Ft(t);null!=n&&e.push(n)})),e};var Ut=function(t,e){var n="split",r=e.get(e.constants.STATUS_MANAGER);return i()(Object.create(r),{split:function(r){var i=ut(r,n);if(!Mt(e)||!Lt(e,n)||!i)return null;var o=t.getSplit(i);return a(o)?o.then((function(t){return lt(e,i,t,n),Ft(t)})):(lt(e,i,o,n),Ft(o))},splits:names:)};var Gt=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=0;e<t.length;e++)for(var n=t[e].matcherGroup.matchers,r=0;r<n.length;r++)if("IN_SEGMENT"===n[r].matcherType)return!0;return!1};function xt(t,e,n){var r=this,i=this.getSplit(t);return(a(i)?i:Promise.resolve(i)).then((function(i){if(i){var a=JSON.parse(i);if(!a.changeNumber||a.changeNumber<n){a.killed=!0,a.defaultTreatment=e,a.changeNumber=n;var o=JSON.stringify(a);return r.addSplit(t,o)}}return!1}))}var Bt=function(){function t(){_(this,t),this.flush()}return k(t,[{key:"addSplit",value:function(t,e){var n=this.getSplit(t);if(n){var r=JSON.parse(n);if(r.trafficTypeName){var i=r.trafficTypeName;this.ttCache[i]--,this.ttCache[i]||delete this.ttCache[i]}Gt(r.conditions)&&this.splitsWithSegmentsCount--}var a=JSON.parse(e);if(a){this.splitCache[t]=e;var o=a.trafficTypeName;return o&&(this.ttCache[o]||(this.ttCache[o]=0),this.ttCache[o]++),Gt(a.conditions)&&this.splitsWithSegmentsCount++,!0}return!1}},{key:"addSplits",value:function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.addSplit(t[0],t[1]))})),n}},{key:"removeSplit",value:function(t){var e=this.getSplit(t);if(e){delete this.splitCache[t];var n=JSON.parse(e),r=n.trafficTypeName;return r&&(this.ttCache[r]--,this.ttCache[r]||delete this.ttCache[r]),Gt(n.conditions)&&this.splitsWithSegmentsCount--,1}return 0}},{key:"removeSplits",value:function(t){var e=this;return t.forEach((function(t){return e.removeSplit(t)})),t.length}},{key:"getSplit",value:,{key:"setChangeNumber",value:,{key:"getChangeNumber",value:function(){return this.changeNumber}},{key:"getAll",value:,{key:"getKeys",value:,{key:"trafficTypeExists",value:,{key:"usesSegments",value:,{key:"flush",value:,{key:"fetchMany",value:function(t){var e=this,n={};return t.forEach((),n}},{key:"checkCache",value:function(){return!1}}]),t}();Bt.prototype.killLocally=xt;var Ht=Bt,Wt=G("splitio-storage:localstorage"),jt=function(){function t(e,n,r){_(this,t),this.keys=e,this.splitFiltersValidation=r,this.__checkExpiration(n),this.__checkFilterQuery()}return k(t,[{key:"decrementCount",value:,{key:"decrementCounts",value:function(t){try{if(t){if(t.trafficTypeName){var e=this.keys.buildTrafficTypeKey(t.trafficTypeName);this.decrementCount(e)}if(Gt(t.conditions)){var n=this.keys.buildSplitsWithSegmentCountKey();this.decrementCount(n)}}}catch(r){Wt.error(r)}}},{key:"incrementCounts",value:function(t){try{if(t){if(t.trafficTypeName){var e=this.keys.buildTrafficTypeKey(t.trafficTypeName);localStorage.setItem(e,S(localStorage.getItem(e))+1)}if(Gt(t.conditions)){var n=this.keys.buildSplitsWithSegmentCountKey();localStorage.setItem(n,S(localStorage.getItem(n))+1)}}}catch(r){Wt.error(r)}}},{key:"addSplit",value:function(t,e){try{var n=this.keys.buildSplitKey(t),r=localStorage.getItem(n),i=r?JSON.parse(r):null;this.decrementCounts(i),localStorage.setItem(n,e);var a=e?JSON.parse(e):null;return this.incrementCounts(a),!0}catch(o){return Wt.error(o),!1}}},{key:"addSplits",value:function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.addSplit(t[0],t[1]))})),n}},{key:"removeSplit",value:function(t){try{var e=this.getSplit(t);localStorage.removeItem(this.keys.buildSplitKey(t));var n=JSON.parse(e);return this.decrementCounts(n),1}catch(r){return Wt.error(r),0}}},{key:"removeSplits",value:,{key:"getSplit",value:,{key:"setChangeNumber",value:function(t){if(this.cacheReadyButNeedsToFlush&&(this.flush(),this.cacheReadyButNeedsToFlush=!1),this.updateNewFilter){Wt.info("Split filter query was modified. Updating cache.");var e=this.keys.buildSplitsFilterQueryKey(),n=this.splitFiltersValidation.queryString;try{n?localStorage.setItem(e,n):localStorage.removeItem(e)}catch(r){Wt.error(r)}this.updateNewFilter=!1}try{return localStorage.setItem(this.keys.buildSplitsTillKey(),t+""),localStorage.setItem(this.keys.buildLastUpdatedKey(),Date.now()+""),this.hasSync=!0,!0}catch(r){return Wt.error(r),!1}}},{key:"getChangeNumber",value:,{key:"getAll",value:function(){for(var t=localStorage.length,e=[],n=0;n<t;){var r=localStorage.key(n),i=r&&localStorage.getItem(r);null!=r&&this.keys.isSplitKey(r)&&i&&e.push(i),n++}return e}},{key:"getKeys",value:,{key:"trafficTypeExists",value:,{key:"usesSegments",value:,{key:"flush",value:function(){Wt.info("Flushing Splits data from localStorage");for(var t=localStorage.length,e=[],n=0;n<t;n++){var r=localStorage.key(n);null!=r&&this.keys.isSplitCacheKey(r)&&e.push(r)}e.forEach((function(t){localStorage.removeItem(t)})),this.hasSync=!1}},{key:"fetchMany",value:function(t){var e=this,n={};return t.forEach((),n}},{key:"checkCache",value:,{key:"__checkExpiration",value:function(t){var e=localStorage.getItem(this.keys.buildLastUpdatedKey());null!==e&&!p(e=parseInt(e,10))&&e<t&&this.flush()}},{key:"__checkFilterQuery",value:function(){var t=this,e=this.splitFiltersValidation,n=e.queryString,r=e.groupedFilters,i=this.keys.buildSplitsFilterQueryKey();if(localStorage.getItem(i)!==n)try{this.updateNewFilter=!0,this.checkCache()&&(localStorage.setItem(this.keys.buildSplitsTillKey(),"-1"),this.getKeys().forEach(())}catch(a){Wt.error(a)}}}]),t}();jt.prototype.killLocally=xt;var Yt=jt,zt=function(){eturn k(t,[{key:"flush",value:,{key:"addToSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return this.segmentCache[e]=!0,!0}},{key:"removeFromSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return delete this.segmentCache[e],!0}},{key:"resetSegments",value:,{key:"isInSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return!0===this.segmentCache[e]}},{key:"setChangeNumber",value:function(){return!0}},{key:"getChangeNumber",value:function(){return-1}},{key:"registerSegment",value:function(){return!1}},{key:"registerSegments",value:function(){return!1}},{key:"getRegisteredSegments",value:function(){return[]}}]),t}(),qt=G("splitio-storage:localstorage"),Vt=function(){function t(e){_(this,t),this.keys=e}return k(t,[{key:"addToSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);try{return localStorage.setItem(e,"1"),!0}catch(n){return qt.error(n),!1}}},{key:"removeFromSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);try{return localStorage.removeItem(e),!0}catch(n){return qt.error(n),!1}}},{key:"resetSegments",value:function(t){var e,n=this,r=!1,i=Object.keys(localStorage).reduce((,[]);if(0===t.length&&i.length===t.length)return r;if(i.length!==t.length)r=!0,i.forEach((function(t){return n.removeFromSegment(t)})),t.forEach((function(t){return n.addToSegment(t)}));else{for(e=0;e<t.length&&-1!==i.indexOf(t[e]);e++);e<t.length&&(r=!0,i.forEach((function(t){return n.removeFromSegment(t)})),t.forEach(())}return r}},{key:"isInSegment",value:,{key:"setChangeNumber",value:function(){return!0}},{key:"getChangeNumber",value:,{key:"registerSegment",value:function(){return!1}},{key:"registerSegments",value:,{key:"getRegisteredSegments",value:,{key:"flush",value:function(){qt.info("Flushing MySegments data from localStorage"),this.resetSegments([])}}]),t}();r $t=function(){eturn k(t,[{key:"state",value:function(){return this.queue}},{key:"track",value:function(t){var e;return(e=this.queue).push.apply(e,Jt(t)),this}},{key:"clear",value:,{key:"toJSON",value:function(){return this.queue}},{key:"isEmpty",value:function(){return 0===this.queue.length}}]),t}();var Zt=Xt=Zt.bind(null,[1,1.5,2.25,3.38,5.06,7.59,11.39,17.09,25.63,38.44,57.67,86.5,129.75,194.62,291.93,437.89,656.84,985.26,1477.89,2216.84,3325.26,4987.89,7481.83]),te=function(){function t(){_(this,t),this.clear()}return k(t,[{key:"clear",value:function(){return this.counters={},this}},{key:"state",value:function(){return this.counters}},{key:"track",value:,{key:"isEmpty",value:function(){return 0===Object.keys(this.counters).length}},{key:"toJSON",value:function(){return this.counters}}]),t}(),ee=function(){eturn k(t,[{key:"clear",value:,{key:"state",value:function(){return this.counters}},{key:"track",value:,{key:"isEmpty",value:,{key:"toJSON",value:function(){return this.counters}}]),t}(),ne=function(){function t(e){var n=this;_(this,t);var r=e.get(e.constants.SETTINGS),i=e.get(e.constants.EVENTS);this.onFullQueue=!1,this.maxQueue=r.scheduler.eventsQueueSize,this.queue=[],this.queueByteSize=0,a(i)?i.then(():"function"===typeof i.flushAndResetTimer&&(this.onFullQueue=i.flushAndResetTimer)}return k(t,[{key:"state",value:function(){return this.queue}},{key:"track",value:,{key:"clear",value:,{key:"toJSON",value:,{key:"isEmpty",value:function(){return 0===this.queue.length}},{key:"_checkForFlush",value:]),t}(),re=ne,ie=/[^.]+$/,ae=/count\.([^/]+)$/,oe=/latency\.([^/]+)\.bucket\.([0-9]+)$/,se=function(){eturn k(t,[{key:"buildSplitKey",value:function(t){return"".concat(this.settings.storage.prefix,".split.").concat(t)}},{key:"buildTrafficTypeKey",value:function(t){return"".concat(this.settings.storage.prefix,".trafficType.").concat(t)}},{key:"buildSplitsTillKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.till")}},{key:"buildSplitsReady",value:function(){return"".concat(this.settings.storage.prefix,".splits.ready")}},{key:"isSplitKey",value:function(t){return s(t,"".concat(this.settings.storage.prefix,".split."))}},{key:"buildSegmentNameKey",value:,{key:"buildSegmentTillKey",value:function(t){return"".concat(this.settings.storage.prefix,".segment.").concat(t,".till")}},{key:"buildRegisteredSegmentsKey",value:function(){return"".concat(this.settings.storage.prefix,".segments.registered")}},{key:"buildSegmentsReady",value:function(){return"".concat(this.settings.storage.prefix,".segments.ready")}},{key:"buildVersionablePrefix",value:function(){return"".concat(this.settings.storage.prefix,"/").concat(this.settings.version,"/").concat(this.settings.runtime.ip)}},{key:"buildImpressionsKey",value:function(){return"".concat(this.settings.storage.prefix,".impressions")}},{key:"buildEventsKey",value:function(){return"".concat(this.settings.storage.prefix,".events")}},{key:"buildLatencyKeyPrefix",value:function(){return"".concat(this.buildVersionablePrefix(),"/latency")}},{key:"buildLatencyKey",value:,{key:"buildCountKey",value:function(t){return"".concat(this.buildVersionablePrefix(),"/count.").concat(t)}},{key:"buildGaugeKey",value:,{key:"searchPatternForCountKeys",value:function(){return"".concat(this.buildVersionablePrefix(),"/count.*")}},{key:"searchPatternForSplitKeys",value:function(){return"".concat(this.settings.storage.prefix,".split.*")}},{key:"searchPatternForLatency",value:,{key:"extractKey",value:function(t){var e=t.match(ie);if(e&&e.length)return e[0];throw new Error("Invalid latency key provided")}},{key:"extractCounterName",value:,{key:"extractLatencyMetricNameAndBucket",value:function(t){var e=t.match(oe);if(e&&e.length>2)return{metricName:e[1],bucketNumber:e[2]};throw new Error("Invalid counter key provided")}}]),t}();tion he(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n){return d(n)?n[t]:e?void 0:n}}var pe=he("matchingKey"),ge=he("bucketingKey",!0);function de(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=fe(t);if(e){var i=fe(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return le(this,n)}}var ve=function(t){ue(n,t);var e=de(n);function n(t){var r;return _(this,n),(r=e.call(this,t)).regexSplitCacheKey=new RegExp("^".concat(r.settings.storage.prefix,"\\.(splits?|trafficType)\\.")),r}return k(n,[{key:"buildSegmentNameKey",value:function(t){return"".concat(pe(this.settings.core.key),".").concat(this.settings.storage.prefix,".segment.").concat(t)}},{key:"extractSegmentName",value:function(t){var e="".concat(pe(this.settings.core.key),".").concat(this.settings.storage.prefix,".segment.");if(s(t,e))return t.substr(e.length)}},{key:"buildSplitsWithSegmentCountKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.usingSegments")}},{key:"buildLastUpdatedKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.lastUpdated")}},{key:"isSplitCacheKey",value:,{key:"buildSplitsFilterQueryKey",value:]),n}(se),me=function(t){var e=t.get(t.constants.SETTINGS);switch(e.storage.type){case mt:var n=new se(e);return{splits:new Ht,segments:new zt(n),impressions:new $t,metrics:new te,count:new ee,events:new re(t),shared:destroy:;case yt:var r=new ve(e),i=Date.now()-864e6;return{splits:new Yt(r,i,e.sync.__splitFiltersValidation),segments:new Vt(r),impressions:new $t,metrics:new te,count:new ee,events:new re(t),shared:destroy:;default:throw new Error("Unsupported storage type")}},ye=n(16110),Se=n.n(ye),Te="init::timeout",Ee="init::ready",_e="init::cache-ready",be="state::splits-arrived",Ne="state::segments-arrived",ke="state::splits-cache-loaded",Ae="state::update",Re="state::check";var Oe=function(){var t=0,e=new(Se());e.SDK_SPLITS_CACHE_LOADED=ke,e.SDK_SPLITS_ARRIVED=be;var n=0;return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=0,a=new(Se());a.SDK_SEGMENTS_ARRIVED=Ne;var o=function(e,n){var r=new(Se()),i=0,a=0;return r.on(Re,(function(){14!==a&&t+i===6?(a=14,r.emit(Ee)):14===a&&r.emit(Ae)})),e.on(be,(function(e){e||(t=2),r.emit(Re)})),e.once(ke,(),n.on(Ne,(),r}(e,a);return r>0&&(i=setTimeout((,r),o.once(Ee,()),o.SDK_READY=Ee,o.SDK_READY_FROM_CACHE=_e,o.SDK_UPDATE=Ae,o.SDK_READY_TIMED_OUT=Te,n++,{splits:e,segments:a,gate:o,destroy:}};var Ie={startup:{requestTimeoutBeforeReady:5,retriesOnFailureBeforeReady:1,readyTimeout:10,eventsFirstPushWindow:10}},we=G("splitio-settings"),Ce=function(t){var e=t.mode,n=t.storage,r=n.type,i=void 0===r?mt:r,a=n.options,o=void 0===a?{}:a,s=n.prefix;return s?s+=".SPLITIO":s="SPLITIO",e===pt?{type:mt,prefix:s}:((i!==mt&&i!==yt||i===yt&&!C())&&(i=mt,we.warn("Invalid or unavailable storage. Fallbacking into MEMORY storage")),{type:i,options:o,prefix:s})},De=G("splitio-settings"),Me=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=t.integrations;if(!Array.isArray(n)||0===n.length)return[];var r=n.filter((),i=n.length-r.length;return i&&De.warn("".concat(i," integration ").concat(1===i?"item":"items"," at settings ").concat(1===i?"is":"are"," invalid: integration items must have a valid 'type' value")),r},Le=var Pe=function(t,e){if("localhost"===t)return pt;if(-1===[gt,dt,vt].indexOf(e))throw Error("Invalid mode provided");return e},Fe=G("splitio-settings");function Ke(t,e){var n={validFilters:[],queryString:null,groupedFilters:{}};return t?e!==gt?(Fe.warn("split filters have been configured but will have no effect if mode is not '".concat(gt,"', since synchronization is being deferred to an external tool.")),n):Array.isArray(t)&&0!==t.length?(kt.forEach((),n.validFilters=t.filter((function(t,e){return t&&(r=t.type,kt.some(())&&Array.isArray(t.values)?(n.groupedFilters[t.type]=n.groupedFilters[t.type].concat(t.values),!0):(Fe.warn("split filter at position '".concat(e,"' is invalid. It must be an object with a valid filter type ('byName' or 'byPrefix') and a list of 'values'.")),!1);var r})),kt.forEach((function(t){var e=t.type,r=t.maxLength;n.groupedFilters[e].length>0&&(n.groupedFilters[e]=function(t,e,n){var r=ht(e,"settings","".concat(t," filter"),"".concat(t," filter value"));if(r){if(r.length>n)throw new Error("".concat(n," unique values can be specified at most for '").concat(t,"' filter. You passed ").concat(r.length,". Please consider reducing the amount or using other filter."));r.sort()}return r||[]}(e,n.groupedFilters[e],r))})),n.queryString=function(t){var e=[];return kt.forEach((),e.length>0?"&"+e.join("&"):null}(n.groupedFilters),Fe.debug("splits filtering criteria is '".concat(n.queryString,"'.")),n):(Fe.warn("splitFilters configuration must be a non-empty array of filter objects."),n):n}var Ue=G("splitio-settings");var Ge=function(t){return t=t.toUpperCase(),-1===[At,Rt].indexOf(t)&&(Ue.error("You passed an invalid impressionsMode, impressionsMode should be one of the following values: '".concat(At,"' or '").concat(Rt,"'. Defaulting to '").concat(Rt,"' mode.")),t=Rt),t},xe=/^\/(testImpressions|metrics|events)/,Be=/^\/auth/,He=/^\/(sse|event-stream)/,We={mode:gt,core:{authorizationKey:void 0,key:void 0,trafficType:void 0,labelsEnabled:!0,IPAddressesEnabled:void 0},scheduler:{featuresRefreshRate:30,segmentsRefreshRate:60,metricsRefreshRate:120,impressionsRefreshRate:60,offlineRefreshRate:15,eventsPushRate:60,eventsQueueSize:500,pushRetryBackoffBase:1},urls:{sdk:"https://sdk.split.io/api",events:"https://events.split.io/api",auth:"https://auth.split.io/api",streaming:"https://streaming.split.io"},storage:{type:mt},debug:void 0,impressionListener:void 0,version:"".concat("javascript","-").concat("10.15.6"),integrations:void 0,streamingEnabled:!0,sync:{splitFilters:void 0,impressionsMode:Rt}};unction Ye(t){var e,n=v({},We,Ie,t);n.scheduler.featuresRefreshRate=je(n.scheduler.featuresRefreshRate),n.scheduler.segmentsRefreshRate=je(n.scheduler.segmentsRefreshRate),n.scheduler.metricsRefreshRate=je(n.scheduler.metricsRefreshRate),n.scheduler.impressionsRefreshRate=je(n.scheduler.impressionsRefreshRate),n.scheduler.offlineRefreshRate=je(n.scheduler.offlineRefreshRate),n.scheduler.eventsPushRate=je(n.scheduler.eventsPushRate),n.startup.requestTimeoutBeforeReady=je(n.startup.requestTimeoutBeforeReady),n.startup.readyTimeout=je(n.startup.readyTimeout),n.startup.eventsFirstPushWindow=je(n.startup.eventsFirstPushWindow),n.mode=Pe(n.core.authorizationKey,n.mode),n.storage=Ce(n),"boolean"===typeof(e=n.debug)?e?U.enable():U.disable():"string"===typeof e&&U.setLogLevel(e),n.runtime=(n.core.IPAddressesEnabled,n.mode,{ip:!1,hostname:!1}),n.integrations=Le(n),!1!==n.streamingEnabled&&(n.streamingEnabled=!0,n.scheduler.pushRetryBackoffBase=je(n.scheduler.pushRetryBackoffBase));var r=Ke(n.sync.splitFilters,n.mode);return n.sync.splitFilters=r.validFilters,n.sync.__splitFiltersValidation=r,n.sync.impressionsMode=Ge(n.sync.impressionsMode),n}var ze={url:function(t){return xe.test(t)?"".concat(this.urls.events).concat(t):Be.test(t)?"".concat(this.urls.auth).concat(t):He.test(t)?"".concat(this.urls.streaming).concat(t):"".concat(this.urls.sdk).concat(t)},overrideKeyAndTT:function(t,e){return i()(Object.create(ze),this,{core:i()({},this.core,{key:t,trafficType:e})})}},qe=function(t){return i()(Object.create(ze),Ye(t))},Ve={COLLECTORS:"metrics_collectors",DESTROYED:"is_destroyed",EVENTS:"events_publisher",HAS_TIMEDOUT:"has_timedout",INTEGRATIONS_MANAGER:"integrations_manager",MY_SEGMENTS_CHANGE_WORKER:"my_segments_change_worker",PRODUCER:"producer",READINESS:"readiness_gate",READY:"is_ready",READY_FROM_CACHE:"is_ready_from_cache",SETTINGS:"settings",STATUS_MANAGER:"status_manager",STORAGE:"storage",IMPRESSIONS_COUNTER:"impressions_counter"},Qe=function(){function t(){_(this,t),this._map={},this.constants=Ve}return k(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"===typeof t&&("string"!==typeof t||t.length)){var n=this._map[t];if(void 0!==n)return n;if(!e){var r,i=new Promise(();return i.manualResolve=r,this._map[t]=i,i}}}},{key:"getAll",value:,{key:"put",value:function(t,e){var n=this;if("string"!==typeof t||"string"===typeof t&&!t.length||void 0===e)return!1;var r=this._map[t];return(void 0===r||"function"===typeof r.manualResolve)&&(a(r)&&r.manualResolve&&r.manualResolve(e),a(e)&&e.then(().catch((),this._map[t]=e,!0)}}]),t}(),Je=Qe,$e=function(t){return d(t)?{matchingKey:t.matchingKey,bucketingKey:t.bucketingKey}:{matchingKey:t,bucketingKey:t}};ar Xe="object"===("undefined"===typeof performance?"undefined":o(performance))&&"function"===typeof performance.now?performance.now.bind(performance):Date.now;var tn,en=function(){var t=Xe();return ,nn=new w("[TIME TRACKER]",{showLevel:!1}),rn={},an={SDK_READY:"Getting ready - Split SDK",SDK_GET_TREATMENT:"SDK - Get Treatment",SDK_GET_TREATMENTS:"SDK - Get Treatments",SDK_GET_TREATMENT_WITH_CONFIG:"SDK - Get Treatment with config",SDK_GET_TREATMENTS_WITH_CONFIG:"SDK - Get Treatments with config",SPLITS_READY:"Getting ready - Splits",SEGMENTS_READY:"Getting ready - Segments",METRICS_PUSH:"Pushing - Metrics",IMPRESSIONS_PUSH:"Pushing - Impressions",EVENTS_PUSH:"Pushing - Events",MY_SEGMENTS_FETCH:"Fetching - My Segments",SEGMENTS_FETCH:"Fetching - Segments",SPLITS_FETCH:"Fetching - Splits"},on=(Ze(tn={},an.SDK_READY,{collector:"client",method:"ready"}),Ze(tn,an.SDK_GET_TREATMENT,{collector:"client",method:"getTreatment"}),Ze(tn,an.SDK_GET_TREATMENTS,{collector:"client",method:"getTreatments"}),Ze(tn,an.SDK_GET_TREATMENT_WITH_CONFIG,{collector:"client",method:"getTreatmentWithConfig"}),Ze(tn,an.SDK_GET_TREATMENTS_WITH_CONFIG,{collector:"client",method:"getTreatmentsWithConfig"}),Ze(tn,an.MY_SEGMENTS_FETCH,{collector:"mySegments",method:"latency"}),Ze(tn,an.SEGMENTS_FETCH,{collector:"segmentChanges",method:"latency"}),Ze(tn,an.SPLITS_FETCH,{collector:"splitChanges",method:"latency"}),tn),sn=function(t,e){return"string"===typeof e?t+e:t},cn=function(t,e){var n=on[t];return!(!n||!e)&&e[n.collector]},un=ln={__attachToPromise:start:function(t,e,n){var r,i=g++,o=cn(t,e);a(n)?r=this.__attachToPromise(n,t,o,i):(r=this.stop.bind(this,t,i),on[t]&&!o&&(r.setCollectorForTask=this.setCollectorForTask.bind(this,t,i)));var s=sn(t,i),c=un(t,o);return rn[s]={cb:c,timer:en()},r},setCollectorForTask:stop:function(t,e){var n=sn(t,e),r=rn[n];if(r){var i=r.timer();return nn.debug("[".concat(t,"] took ").concat(i,"ms to finish.")),r.cb&&r.cb(i),delete rn[n],i}},TaskNames:an},fn=ln,hn={ALL:1,SEGMENT:2,WHITELIST:3,EQUAL_TO:4,GREATER_THAN_OR_EQUAL_TO:5,LESS_THAN_OR_EQUAL_TO:6,BETWEEN:7,UNDEFINED:8,EQUAL_TO_SET:9,CONTAINS_ANY_OF_SET:10,CONTAINS_ALL_OF_SET:11,PART_OF_SET:12,ENDS_WITH:13,STARTS_WITH:14,CONTAINS_STRING:15,IN_SPLIT_TREATMENT:16,EQUAL_TO_BOOLEAN:17,MATCHES_STRING:18},pn={BOOLEAN:"BOOLEAN",STRING:"STRING",NUMBER:"NUMBER",SET:"SET",DATETIME:"DATETIME",NOT_SPECIFIED:"NOT_SPECIFIED"};var gn=dn=function(){function t(){var e=this;_(this,t),this.__setData__=[];var n=arguments[0];Array.isArray(n)&&n.forEach(()}return k(t,[{key:"clear",value:,{key:"add",value:,{key:"delete",value:,{key:"has",value:,{key:"forEach",value:function(t){var e=arguments[1];if("function"!==typeof t)throw new TypeError(t+" is not a function");for(var n=0;n<this.__setData__.length;n++){var r=this.__setData__[n];t.call(e,r,r,this)}}},{key:"size",get:function(){return this.__setData__.length}}]),t}();ar mn="function"===typeof Array.from&&"function"===typeof Set&&Set.prototype&&Set.prototype.values?Set:dn;var yn=var Sn=function(t){return t.whitelist};var Tn=function(t){return t.value};r bn=function(t){var e=t.map((function(t){var e=t.matcherType,n=t.negate,r=t.keySelector,i=t.userDefinedSegmentMatcherData,a=t.whitelistMatcherData,o=t.unaryNumericMatcherData,s=t.betweenMatcherData,c=t.dependencyMatcherData,u=t.booleanMatcherData,l=t.stringMatcherData,f=r&&r.attribute,h=e),p=pn.STRING,g=void 0;return h===hn.SEGMENT?g=gn(i):h===hn.WHITELIST?g=yn(a):h===hn.EQUAL_TO?(g=Tn(o),p=pn.NUMBER,"DATETIME"===o.dataType&&(g=En(g),p=pn.DATETIME)):h===hn.GREATER_THAN_OR_EQUAL_TO||h===hn.LESS_THAN_OR_EQUAL_TO?(g=Tn(o),p=pn.NUMBER,"DATETIME"===o.dataType&&(g=_n(g),p=pn.DATETIME)):h===hn.BETWEEN?(g=s,p=pn.NUMBER,"DATETIME"===s.dataType&&(g.start=_n(g.start),g.end=_n(g.end),p=pn.DATETIME)):h===hn.EQUAL_TO_SET||h===hn.CONTAINS_ANY_OF_SET||h===hn.CONTAINS_ALL_OF_SET||h===hn.PART_OF_SET?(g=Sn(a),p=pn.SET):h===hn.STARTS_WITH||h===hn.ENDS_WITH||h===hn.CONTAINS_STRING?g=Sn(a):h===hn.IN_SPLIT_TREATMENT?(g=c,p=pn.NOT_SPECIFIED):h===hn.EQUAL_TO_BOOLEAN?(p=pn.BOOLEAN,g=u):h===hn.MATCHES_STRING&&(g=l),{attribute:f,negate:n,type:h,value:g,dataType:p}}));return-1===u(e,()?e:[]};n.parse=Nn.prototype.getTreatmentFor=var kn=Nn,An=G("splitio-engine:matcher");ar On=function(){return Rn},In=G("splitio-engine:matcher");var wn=function(t,e){return function(n){var r=e.segments.isInSegment(t,n);return a(r)?r.then((function(e){return In.debug("[asyncSegmentMatcher] evaluated ".concat(t," / ").concat(n," => ").concat(r)),e})):In.debug("[segmentMatcher] evaluated ".concat(t," / ").concat(n," => ").concat(r)),r}},Cn=G("splitio-engine:matcher");var Dn=function(t){return function(e){var n=t.has(e);return Cn.debug("[whitelistMatcher] evaluated ".concat(e," in [").concat(vn(t).join(","),"] => ").concat(n)),n}},Mn=G("splitio-engine:matcher");var Ln=function(t){return function(e){var n=e===t;return Mn.debug("[equalToMatcher] is ".concat(e," equal to ").concat(t,"? ").concat(n)),n}},Pn=G("splitio-engine:matcher");var Fn=function(t){return function(e){var n=e>=t;return Pn.debug("[greaterThanEqualMatcher] is ".concat(e," greater than ").concat(t,"? ").concat(n)),n}},Kn=G("splitio-engine:matcher");var Un=function(t){return function(e){var n=e<=t;return Kn.debug("[lessThanEqualMatcher] is ".concat(e," less than ").concat(t,"? ").concat(n)),n}},Gn=G("splitio-engine:matcher");var xn=function(t){return function(e){var n=e>=t.start&&e<=t.end;return Gn.debug("[betweenMatcher] is ".concat(e," between ").concat(t.start," and ").concat(t.end,"? ").concat(n)),n}},Bn=G("splitio-engine:matcher");var Hn=function(t){return function(e){for(var n=e.length===t.length,r=function(r){u(t,(function(t){return t===e[r]}))<0&&(n=!1)},i=0;i<e.length&&n;i++)r(i);return Bn.debug("[equalToSetMatcher] is ".concat(e," equal to set ").concat(t,"? ").concat(n)),n}},Wn=G("splitio-engine:matcher");var jn=function(t){return function(e){var n=!0;if(e.length<t.length)n=!1;else for(var r=function(r){u(e,(function(e){return e===t[r]}))<0&&(n=!1)},i=0;i<t.length&&n;i++)r(i);return Wn.debug("[containsAllMatcher] ".concat(e," contains all elements of ").concat(t,"? ").concat(n)),n}},Yn=G("splitio-engine:matcher");var zn=function(t){return function(e){for(var n=!1,r=i=0;i<t.length&&!n;i++)r(i);return Yn.debug("[containsAnyMatcher] ".concat(e," contains at least an element of ").concat(t,"? ").concat(n)),n}},qn=G("splitio-engine:matcher");var Vn=function(t){return function(e){for(var n=e.length<=t.length,r=i=0;i<e.length&&n;i++)r(i);return qn.debug("[partOfMatcher] ".concat(e," is part of ").concat(t,"? ").concat(n)),n}},Qn=G("splitio-engine:matcher");var Jn=function(t){return function(e){var n=t.some((function(t){return s(e,t)}));return Qn.debug("[startsWithMatcher] ".concat(e," starts with ").concat(t,"? ").concat(n)),n}},$n=G("splitio-engine:matcher");var Zn=function(t){return function(e){var n=t.some((function(t){return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!f(t)||!f(e))&&(n&&(t=t.toLowerCase(),e=e.toLowerCase()),t.slice(t.length-e.length)===e)}(e,t)}));return $n.debug("[endsWithMatcher] ".concat(e," ends with ").concat(t,"? ").concat(n)),n}},Xn=G("splitio-engine:matcher");var tr=function(t){return function(e){var n=t.some(();return Xn.debug("[containsStringMatcher] ".concat(e," contains ").concat(t,"? ").concat(n)),n}},er=G("splitio-engine:matcher");function nr(t,e,n){var r=!1;return Array.isArray(e)&&(r=-1!==e.indexOf(t.treatment)),er.debug('[dependencyMatcher] Parent split "'.concat(n,'" evaluated to "').concat(t.treatment,'" with label "').concat(t.label,'". ').concat(n," evaluated treatment is part of [").concat(e,"] ? ").concat(r,".")),r}var rr=function(t,e){var n=t.split,r=t.treatments;return function(t,i){var o=t.key,s=t.attributes;er.debug('[dependencyMatcher] will evaluate parent split: "'.concat(n,'" with key: ').concat(JSON.stringify(o)," ").concat(s?"\n attributes: ".concat(JSON.stringify(s)):""));var c=i(o,n,s,e);return a(c)?c.then(():nr(c,r,n)}},ir=G("splitio-engine:matcher");var ar=function(t){return function(e){var n=t===e;return ir.debug("[booleanMatcher] ".concat(t," === ").concat(e)),n}},or=G("splitio-engine:matcher");var sr=function(t){return function(e){var n;try{n=new RegExp(t)}catch(i){return or.debug("[stringMatcher] ".concat(t," is an invalid regex")),!1}var r=n.test(e);return or.debug("[stringMatcher] does ".concat(e," matches with ").concat(t,"? ").concat(r?"yes":"no")),r}};var cr=function(t,e){var n,r=t.type,i=t.value;return r===hn.ALL?n=On(i):r===hn.SEGMENT?n=wn(i,e):r===hn.WHITELIST?n=Dn(i):r===hn.EQUAL_TO?n=Ln(i):r===hn.GREATER_THAN_OR_EQUAL_TO?n=Fn(i):r===hn.LESS_THAN_OR_EQUAL_TO?n=Un(i):r===hn.BETWEEN?n=xn(i):r===hn.EQUAL_TO_SET?n=Hn(i):r===hn.CONTAINS_ANY_OF_SET?n=zn(i):r===hn.CONTAINS_ALL_OF_SET?n=jn(i):r===hn.PART_OF_SET?n=Vn(i):r===hn.STARTS_WITH?n=Jn(i):r===hn.ENDS_WITH?n=Zn(i):r===hn.CONTAINS_STRING?n=tr(i):r===hn.IN_SPLIT_TREATMENT?n=rr(i,e):r===hn.EQUAL_TO_BOOLEAN?n=ar(i):r===hn.MATCHES_STRING&&(n=sr(i)),n},ur=G("splitio-engine:sanitize"),lr=hn,fr=pn;ar pr=function(t,e,n,r){var i,a=t,n);switch(n){case fr.NUMBER:case fr.DATETIME:i=e);break;case fr.STRING:i=function(t){var e=t;return d(t)&&(e=t.matchingKey?t.matchingKey:void 0),y(e)||void 0}(e);break;case fr.SET:i=e);break;case fr.BOOLEAN:i=function(t){if(!0===t||!1===t)return t;if("string"===typeof t){var e=t.toLocaleLowerCase();if("true"===e)return!0;if("false"===e)return!1}}(e);break;case fr.NOT_SPECIFIED:i=e;break;default:i=void 0}return a&&(i=a(i,r)),ur.debug("Attempted to sanitize [".concat(e,"] which should be of type [").concat(n,"]. \n Sanitized and processed value => [").concat(i instanceof Object?JSON.stringify(i):i,"]")),i},gr=G("splitio-engine:value");var dr=function(t,e,n){var r=e.attribute,i=function(t,e,n){var r=void 0;return e?n?(r=n[e],gr.debug("Extracted attribute [".concat(e,"], [").concat(r,"] will be used for matching."))):gr.warn("Defined attribute [".concat(e,"], no attributes received.")):r=t,r}(t,r,n),a=pr(e.type,i,e.dataType,n);return void 0!==a?a:void gr.warn("Value ".concat(i," ").concat(r?"for attribute ".concat(r," "):0,"doesn't match with expected type."))};function vr(t){return e=t),n=Math.pow(2,32),e-Math.floor(e/n)*n;var e,n}function mr(t){var e=vr(t);return e>=Math.pow(2,31)?e-Math.pow(2,32):e}function yr(t,e){for(var n=0,r=0;r<t.length;r++)n=mr(mr(31*n)+t.charCodeAt(r));return mr(n^e)}var Sr=function(t,e){return Math.abs(yr(t,e)%100)+1},Tr=n(40197),Er=n.n(Tr),_r=Er().stringSource,br=Er().stringDestination,Nr=Er().encodeUTF16toUTF8;ction Or(t,e){return Rr(function(t){var e;return Nr(_r(t),e=br()),e()}(t),e>>>0)}var Ir={hash:Or,bucket:function(t,e){return Math.abs(Or(t,e)%100)+1}},wr=G("splitio-engine");ar Dr={getTreatment:function(t,e,n,r){var i=Cr(r)(t,e),a=n.getTreatmentFor(i);return wr.debug("[engine] using algo ".concat(2!==r?"legacy":"murmur"," bucket ").concat(i," for key ").concat(t," using seed ").concat(e," - treatment ").concat(a)),a},shouldApplyRollout:function(t,e,n,r){if(t<100&&Cr(r)(e,n)>t)return!1;return!0}},Mr=Dr;function Lr(t,e,n,r,i,a){if(t)return{treatment:Mr.getTreatment(e,n,r,a),label:i}}var Pr=function(t,e,n,r){return function(i,o,s,c,u,l,f){if("ROLLOUT"===r&&!Mr.shouldApplyRollout(s,i.bucketingKey,c,f))return{treatment:void 0,label:"not in split"};var h=t(i,l,u);return a(h)?h.then(():Lr(h,i.bucketingKey,o,e,n,f)}},Fr=G("splitio-engine:combiner");function Kr(){return Fr.error("Invalid Split provided, no valid conditions found"),{treatment:St,label:ot}}function Ur(t){for(var e=t.length,n=0;n<e;n++){var r=t[n];if(void 0!==r)return Fr.debug("Treatment found: ".concat(r.treatment)),r}Fr.debug("All predicates evaluated, no treatment found.")}var Gr=function(t){return!Array.isArray(t)||Array.isArray(t)&&0===t.length?Kr:function(e,n,r,i,o,s,c){var l=t.map(();return-1!==u(l,a)?Promise.all(l).then((function(t){return Ur(t)})):Ur(l)}},xr=G("splitio-engine:combiner");function Br(t){for(var e,n=0,r=t.length;n<r&&t[n];n++);return e=n===r,xr.debug("[andCombiner] evaluates to ".concat(e)),e}var Hr=function(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=t.map(();return-1!==u(i,a)?Promise.all(i).then(Br):Br(i)}};var Wr=function(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r],o=i.matcherGroup.matchers,s=i.partitions,c=i.label,u=i.conditionType,l=(o=bn(o)).map(();if(0===l.length){n=[];break}n.push(Pr(Hr(l),kn.parse(s),c,u))}return Gr(n)};unction Yr(t,e){if(!(this instanceof Yr))return new Yr(t,e);var n;this.baseInfo=t,this.evaluator=e,"string"!==typeof(n=this).baseInfo.defaultTreatment&&(n.baseInfo.defaultTreatment=St)}Yr.parse=function(t,e){var n=t.conditions,r=Wr(n,e);return new Yr(i()({},t),r)},Yr.prototype.getKey=function(){return this.baseInfo.name},Yr.prototype.getTreatment=function(t,e,n){var r,i,o,s=this.baseInfo,c=s.killed,u=s.seed,l=s.defaultTreatment,f=s.trafficAllocation,h=s.trafficAllocationSeed,p=s.algo;try{r=$e(t)}catch(d){return{treatment:St,label:ot}}if(this.isGarbage())i=St,o="archived";else{if(!c){var g=this.evaluator(r,u,f,h,e,p,n);return a(g)?g.then(():jr(g,l)}i=l,o="killed"}return{treatment:i,label:o}},Yr.prototype.isGarbage=Yr.prototype.getChangeNumber=var zr=Yr,qr={treatment:St,label:ot,config:null};function Vr(t,e,n,r){var i;try{i=r.splits.getSplit(e)}catch(o){return Promise.resolve(qr)}return a(i)?i.then(():Qr(i,t,n,r)}function Qr(t,e,n,r){var i={treatment:St,label:at,config:null};if(t){var o=JSON.parse(t),s=zr.parse(o,r);if(i=s.getTreatment(e,n,Vr),a(i))return i.then((function(t){return t.changeNumber=s.getChangeNumber(),t.config=c(o,"configurations.".concat(t.treatment),null),t}));i.changeNumber=s.getChangeNumber(),i.config=c(o,"configurations.".concat(i.treatment),null)}return i}function Jr(t,e,n,r,i){var o={},s=[];return t.forEach((function(t){var c=Qr(e[t],n,r,i);a(c)?s.push(c.then((function(e){o[t]=e}))):o[t]=c})),s.length>0?Promise.all(s).then((function(){return o})):o}var $r=function t(e,n,r,i){_(this,t),this.list=i,this.value=e,n?(n.next=this,this.prev=n):this.prev=null,r?(r.prev=this,this.next=r):this.next=null},Zr=function(){eturn k(t,[{key:"removeNode",value:,{key:"unshiftNode",value:,{key:"unshift",value:]),t}(),Xr="undefined"!==typeof Map?Map:function(){eturn k(t,[{key:"set",value:,{key:"get",value:,{key:"delete",value:,{key:"size",get:]),t}(),ti=function(){function t(e){_(this,t),this.maxLen=e||1,this.items=new Xr,this.lru=new Zr}return k(t,[{key:"get",value:,{key:"set",value:]),t}(),ei=ti,ni=function(){function t(e,n){_(this,t),this.cache=new ei(e),this.hasher=n}return k(t,[{key:"testAndSet",value:function(t){if(!t)return null;var e=this.hasher(t),n=this.cache.get(e);return this.cache.set(e,t.time),n}}]),t}(),ri=ni,ii="UNKNOWN";unction oi(t){return t?Ir.hash(function(t){return"".concat(ai(t.keyName),"\n    :").concat(ai(t.feature),"\n    :").concat(ai(t.treatment),"\n    :").concat(ai(t.label),"\n    :").concat(t.changeNumber||0)}(t)).toString():null}var si=ci=36e5;ar li=G("splitio-client:impressions-tracker");function fi(t){return[dt,gt].indexOf(t.mode)>-1}var hi=function(t){var e=t.get(t.constants.STORAGE).impressions,n=t.get(t.constants.SETTINGS),r=n.impressionListener,o=t.get(t.constants.INTEGRATIONS_MANAGER,!0),s=n.runtime,c=s.ip,u=s.hostname,l=n.version,f=[],h=fi(n),p=n),g=si(),d=t.get(t.constants.IMPRESSIONS_COUNTER);return{queue:function(t,e){f.push({impression:t,attributes:e})},track:function(){var t=f.length,n=f.splice(0,t),s=[];n.forEach((function(t){var e=t.impression;h&&(e.pt=g.testAndSet(e));var n=Date.now();p&&d&&d.inc(e.feature,n,1),(!p||!e.pt||e.pt<ui(n))&&s.push(e)}));var v=e.track(s);if(a(v)&&v.then((function(){li.debug("Successfully stored ".concat(t," impression").concat(1===t?"":"s","."))})).catch((function(e){li.error("Could not store impressions bulk with ".concat(t," impression").concat(1===t?"":"s",". Error: ").concat(e))})),r||o)for(var m=function(t){var e={impression:i()({},n[t].impression),attributes:n[t].attributes,ip:c,hostname:u,sdkLanguageVersion:l};setTimeout((function(){o&&o.handleImpression(e);try{r&&r.logImpression(e)}catch(t){li.error("Impression listener logImpression method threw: ".concat(t,"."))}}),0)},y=0;y<t;y++)m(y)}}},pi=G("splitio-client:event-tracker");var gi=function(t){var e=t.get(t.constants.STORAGE).events,n=t.get(t.constants.INTEGRATIONS_MANAGER,!0);function r(t,e){var r=t.eventTypeId,a=t.trafficTypeName,o=t.key,s=t.value,c=t.timestamp,u=t.properties,l='event of type "'.concat(r,'" for traffic type "').concat(a,'". Key: ').concat(o,". Value: ").concat(s,". Timestamp: ").concat(c,". ").concat(u?"With properties.":"With no properties.");return e?(pi.info("Successfully queued ".concat(l)),n&&setTimeout((function(){var e=i()({},t);t.properties&&(e.properties=i()({},t.properties)),n.handleEvent(e)}),0)):pi.warn("Failed to queue ".concat(l)),e}return{track:function(t,n){var i=e.track(t,n);return a(i)?i.then(r.bind(null,t)):r(t,i)}}},di=G("splitio-client");var vi=function(t){var e=t.get(t.constants.STORAGE),n=t.get(t.constants.COLLECTORS),r=hi(t),i=gi(t);function o(t,i,o){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=fn.TaskNames[s?"SDK_GET_TREATMENT_WITH_CONFIG":"SDK_GET_TREATMENT"],l=fn.start(u,n),f=Vr(t,i,o,e),h=function(e){var n=c(e,i,t,o,s,"getTreatment".concat(s?"withConfig":""));return r.track(),l(),n};return a(f)?f.then((function(t){return h(t)})):h(f)}function s(t,i,o){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=fn.TaskNames[s?"SDK_GET_TREATMENTS_WITH_CONFIG":"SDK_GET_TREATMENTS"],l=fn.start(u,n),f=function(e){var n={};return Object.keys(e).forEach((function(r){n[r]=c(e[r],r,t,o,s,"getTreatments".concat(s?"withConfig":""))})),r.track(),l(),n},h=function(t,e,n,r){var i,o={};try{i=r.splits.fetchMany(e)}catch(s){return e.forEach((),Promise.resolve(o)}return a(i)?i.then(():Jr(e,i,t,n,r)}(t,i,o,e);return a(h)?h.then((function(t){return f(t)})):f(h)}function c(e,n,i,a,o,s){var c=t.get(t.constants.READY,!0)||t.get(t.constants.READY_FROM_CACHE,!0),u=pe(i),l=ge(i);c||(e={treatment:St,label:"not ready"});var f=e,h=f.treatment,p=f.label,g=f.changeNumber,d=f.config,v=void 0===d?null:d;return di.info("Split: ".concat(n,". Key: ").concat(u,". Evaluation: ").concat(h,". Label: ").concat(p)),lt(t,n,p,s)&&(di.info("Queueing corresponding impression."),r.queue({feature:n,keyName:u,treatment:h,time:Date.now(),bucketingKey:l,label:p,changeNumber:g},a)),o?{treatment:h,config:v}:h}return{getTreatment:o,getTreatmentWithConfig:function(t,e,n){return o(t,e,n,!0)},getTreatments:s,getTreatmentsWithConfig:track:function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1024,u=pe(e),l={eventTypeId:r,trafficTypeName:n,value:o,timestamp:Date.now(),key:u,properties:s};return function(t,e,n){var r=e.get(e.constants.READY,!0),i=e.get(e.constants.SETTINGS),o=e.get(e.constants.STORAGE).splits;if(!r||i.mode===pt)return!0;var s=o.trafficTypeExists(t);a(s)?s.then(():s||Ct(n,t)}(n,t,"track"),i.track(l,c)}}};var mi=function(t,e,n){var r="REDIS"!==t.get(t.constants.SETTINGS).storage.type,a=vi(t),o=a.getTreatment,c=a.getTreatmentWithConfig,u=a.getTreatments,l=a.getTreatmentsWithConfig,f=a.track;function h(n,r,i,a){var o,c,u=s(a,"getTreatments"),l=e?n:it(n,a),f=u?ht(r,a):ut(r,a),h=(c=a,d(o=i)||void 0==o?o:(W.error("".concat(c,": attributes must be a plain object.")),!1)),p=Mt(t);return Lt(t,a),{valid:p&&l&&f&&!1!==h,key:l,splitOrSplits:f,attributes:h}}return a.getTreatment=function(t,e,n){var i=h(t,e,n,"getTreatment");return i.valid?o(i.key,i.splitOrSplits,i.attributes):r?St:Promise.resolve(St)},a.getTreatmentWithConfig=function(t,e,n){var a=h(t,e,n,"getTreatmentWithConfig");return a.valid?c(a.key,a.splitOrSplits,a.attributes):r?i()({},Tt):Promise.resolve(i()({},Tt))},a.getTreatments=function(t,e,n){var i=h(t,e,n,"getTreatments");if(i.valid)return u(i.key,i.splitOrSplits,i.attributes);var a={};return i.splitOrSplits&&i.splitOrSplits.forEach((),r?a:Promise.resolve(a)},a.getTreatmentsWithConfig=function(t,e,n){var a=h(t,e,n,"getTreatmentsWithConfig");if(a.valid)return l(a.key,a.splitOrSplits,a.attributes);var o={};return a.splitOrSplits&&a.splitOrSplits.forEach((),r?o:Promise.resolve(o)},a.track=function(i,a,o,s,c){var u=e?i:it(i,"track"),l=n?a:wt(a,"track"),h=z(o,"track"),p=V(s,"track"),g=tt(c,"track"),d=g.properties,v=g.size;return Mt(t)&&u&&l&&h&&!1!==p&&!1!==d?f(u,l,h,p,d,v):!r&&Promise.resolve(!1)},a};var yi=function(t){var e,n=t.get(t.constants.SETTINGS),r=c(n,"core.key",void 0),i=c(n,"core.trafficType",void 0);n.mode===pt&&void 0===r?n.core.key="localhost_key":n.core.key=it(r,"Client instantiation");var a=[n.core.key];if(void 0!==i){var o=wt(i,"Client instantiation");n.core.trafficType=o,a.push(o)}var s=mi(t,!0,a.length>1);return s.isBrowserClient=!0,s.getTreatment=s.getTreatment.bind(s,n.core.key),s.getTreatmentWithConfig=s.getTreatmentWithConfig.bind(s,n.core.key),s.getTreatments=s.getTreatments.bind(s,n.core.key),s.getTreatmentsWithConfig=s.getTreatmentsWithConfig.bind(s,n.core.key),s.track=(e=s.track).bind.apply(e,[s].concat(a)),s};var Si=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a,o=!1;function s(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,r=arguments.length,i=new Array(r>1?r-1:0),c=1;c<r;c++)i[c-1]=arguments[c];o||(a=setTimeout((function(){t.apply(void 0,i.concat([s]))}),n))}eturn c.reset=function(){clearTimeout(a),a=void 0,s.apply(void 0,[e].concat(r))},t.apply(void 0,r.concat([s])),c};ction bi(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=fe(t);if(e){var i=fe(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return le(this,n)}}var Ni=function(t){ue(n,t);var e=bi(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Split Error";return _(this,n),(t=e.call(this,r)).message=r,t}return n}(_i(Error)),ki=function(t){ue(n,t);var e=bi(n);function n(t){return _(this,n),e.call(this,t||"Split Timeout Error")}return n}(Ni),Ai=function(t){ue(n,t);var e=bi(n);function n(t,r){var i;return _(this,n),(i=e.call(this,t||"Split Network Error")).statusCode=r,i}return n}(Ni),Ri=G("splitio-services:service");function Oi(t){var e=t.url;return("undefined"!==typeof window&&window.fetch||Ti)(e,t).then((function(t){if(!t.ok)throw{response:t};return t})).catch((function(n){var r=n.response,i="";if(r)if(404===r.status)i="Invalid API key or resource not found.";else i=r.statusText;else i=n.message;throw r&&403===r.status||Ri[t.logErrorsAsInfo?"info":"error"]("Response status is not OK. Status: ".concat(r?r.status:"NO_STATUS",". URL: ").concat(e,". Message: ").concat(i)),new Ai(i,r&&r.status)}))}var Ii=Oi;var wi=function(t,e,n,r){var a=t.core.authorizationKey,o=t.version,s=t.runtime,c=s.ip,u=s.hostname,l={},f={};return l.Accept="application/json",l["Content-Type"]="application/json",l.Authorization="Bearer ".concat(a),l.SplitSDKVersion=o,c&&(l.SplitSDKMachineIP=c),u&&(l.SplitSDKMachineName=u),r&&i()(l,r),i()({headers:l,url:t.url(e)},f,n)},Ci={"Cache-Control":"no-cache"};function Di(t){var e=[];return T(t.toJSON(),(function(t,n){e.push({name:n,latencies:t})})),e}function Mi(t){var e=[];return T(t.toJSON(),(),e}var Li=Oi;function Pi(t,e){return wi(t,"/testImpressions/bulk",i()({method:"POST"},e),{SplitSDKImpressionsMode:t.sync.impressionsMode===Rt?Rt:At})}function Fi(t,e){return wi(t,"/testImpressions/count",i()({method:"POST"},e))}function Ki(t,e){var n=e.core.labelsEnabled,r=t.state(),"feature"),i=[];return T(r,(function(t,e){i.push({f:e,i:t.map((function(t){var e={k:t.keyName,t:t.treatment,m:t.time,c:t.changeNumber};return n&&(e.r=t.label),t.bucketingKey&&(e.b=t.bucketingKey),t.pt&&(e.pt=t.pt),e}))})})),i}function Ui(t){var e=[];if(0===(t?t.size():0))return e;for(var n=t.popAll(),r=Object.keys(n),i=0;i<r.length;i++){var a=r[i].split("::");if(2===a.length){var o=a[0],s=a[1],c={f:o,m:Number(s),rc:n[r[i]]};e.push(c)}}return e}ar xi=function(){eturn k(t,[{key:"latency",value:,{key:"count",value:function(t){this.storage.count.track("".concat(this.metricType,".status.").concat(t))}},{key:"countException",value:function(){this.storage.count.track("".concat(this.metricType,".exception"))}}]),t}(),Bi=function(t){ue(n,t);var e=Gi(n);function n(t){var r;return _(this,n),(r=e.call(this,t)).metricType="segmentChangeFetcher",r}return n}(xi),Hi=function(t){ue(n,t);var e=Gi(n);function n(t){var r;return _(this,n),(r=e.call(this,t)).metricType="splitChangeFetcher",r}return n}(xi),Wi=xi),ji=function(){function t(e){_(this,t),this.storage=e,this.ready=this.ready.bind(this),this.getTreatment=this.getTreatment.bind(this),this.getTreatments=this.getTreatments.bind(this),this.getTreatmentWithConfig=this.getTreatmentWithConfig.bind(this),this.getTreatmentsWithConfig=this.getTreatmentsWithConfig.bind(this)}return k(t,[{key:"ready",value:function(t){this.storage.metrics.track("sdk.ready",t)}},{key:"getTreatment",value:function(t){this.storage.metrics.track("sdk.getTreatment",t)}},{key:"getTreatments",value:function(t){this.storage.metrics.track("sdk.getTreatments",t)}},{key:"getTreatmentWithConfig",value:function(t){this.storage.metrics.track("sdk.getTreatmentWithConfig",t)}},{key:"getTreatmentsWithConfig",value:]),t}(),Yi=G("splitio-metrics"),zi=function(t){var e=0,n=t.get(t.constants.SETTINGS),r=t.get(t.constants.STORAGE),a=t.get(t.constants.IMPRESSIONS_COUNTER),o=n.sync.impressionsMode===Rt,s=function(){if(r.metrics.isEmpty()&&r.count.isEmpty())return Promise.resolve();Yi.info("Pushing metrics");var t=fn.start(fn.TaskNames.METRICS_PUSH),e=r.metrics.isEmpty()?null:Ii(function(t,e){return wi(t,"/metrics/times",i()({method:"POST"},e,{logErrorsAsInfo:!0}))}(n,{body:JSON.stringify(Di(r.metrics))})).then((function(){return r.metrics.clear()})).catch((function(){return r.metrics.clear()})),a=r.count.isEmpty()?null:Ii(function(t,e){return wi(t,"/metrics/counters",i()({method:"POST"},e,{logErrorsAsInfo:!0}))}(n,{body:JSON.stringify(Mi(r.count))})).then((function(){return r.count.clear()})).catch(();return Promise.all([e,a]).then(()},c=function(){if(r.impressions.isEmpty())return Promise.resolve();var t=r.impressions.queue.length;Yi.info("Pushing ".concat(t," impressions"));var i=fn.start(fn.TaskNames.IMPRESSIONS_PUSH);return Li(Pi(n,{body:JSON.stringify(Ki(r.impressions,n))})).then(().catch((function(n){e?(Yi.warn("Droping ".concat(t," impressions after retry. Reason ").concat(n,".")),e=0,r.impressions.clear()):(e++,Yi.warn("Failed to push ".concat(t," impressions, keeping data to retry on next iteration. Reason ").concat(n,".")))})).then((function(){return i()}))},u=function(){var t=Ui(a),r=t.length;return 0===r?Promise.resolve():(Yi.info("Pushing count of impressions for ".concat(r," features")),Li(Fi(n,{body:JSON.stringify({pf:t})})).then(().catch((function(t){e?(Yi.warn("Droping count of impressions for ".concat(r," features after retry. Reason ").concat(t,".")),e=0):(e++,Yi.warn("Failed to push impressions count for ".concat(r," features, keeping data to retry on next iteration. Reason ").concat(t,".")))})))},l=!1,f=!1,h=!1;return{start:function(){l=Si((function(t){return c().then((function(){return t()}))}),n.scheduler.impressionsRefreshRate),f=Si((function(t){return s().then((function(){return t()}))}),n.scheduler.metricsRefreshRate),o&&(h=Si((function(t){return u().then((function(){return t()}))}),18e5))},flush:function(){return o&&u(),c()},stop:function(){l&&l(),f&&f(),h&&h()},collectors:{segmentChanges:new Bi(r),splitChanges:new Hi(r),mySegments:new Wi(r),client:new ji(r)}}},qi=Oi;ar Qi=G("splitio-events"),Ji=function(t){var e=t.get(t.constants.SETTINGS),n=t.get(t.constants.STORAGE),r=function(){if(n.events.isEmpty())return Promise.resolve();Qi.info("Pushing ".concat(n.events.state().length," queued events."));var t=fn.start(fn.TaskNames.EVENTS_PUSH),r=JSON.stringify(n.events.toJSON()),i=function(){return t()};return n.events.clear(),qi(Vi(e,{body:r})).then(i).catch(i)},i=!1,a=!1,o=return{start:function(){e.startup.eventsFirstPushWindow>0?i=setTimeout(o,e.startup.eventsFirstPushWindow):o()},flush:function(){return r()},stop:flushAndResetTimer:},$i=Oi;unction Xi(t){var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(function(t){return atob(t)}(e).split("").map(().join(""));return JSON.parse(n)}function ta(t,e){var n=$i(function(t,e){var n="/auth";if(e){var r=e.map(Zi).join("&");r&&(n+="?"+r)}return wi(t,n)}(t,e));return n.then(().then((function(t){if(t.token){var e=Xi(t.token);if("number"!==typeof e.iat||"number"!==typeof e.exp)throw new Error('token properties "issuedAt" (iat) or "expiration" (exp) are missing or invalid');var n=JSON.parse(e["x-ably-capability"]);return i()({decodedToken:e,channels:n},t)}return t}))}function ea(){return"undefined"!==typeof window&&"function"===typeof window.EventSource?window.EventSource:void 0}var na=function(){function t(e,n,r){_(this,t),this.baseMillis=n||t.DEFAULT_BASE_MILLIS,this.maxMillis=r||t.DEFAULT_MAX_MILLIS,this.attempts=0,this.cb=e}return k(t,[{key:"scheduleCall",value:,{key:"reset",value:]),t}();na.DEFAULT_BASE_MILLIS=1e3,na.DEFAULT_MAX_MILLIS=18e5;var ra=na,ia=function(){function t(e,n){_(this,t),this.mySegmentsStorage=e,this.mySegmentsProducer=n,this.maxChangeNumber=0,this.segmentList=void 0,this.currentChangeNumber=-1,this.put=this.put.bind(this),this.__handleMySegmentUpdateCall=this.__handleMySegmentUpdateCall.bind(this),this.backoff=new ra(this.__handleMySegmentUpdateCall)}return k(t,[{key:"__handleMySegmentUpdateCall",value:function(){var t=this;if(this.maxChangeNumber>this.currentChangeNumber){this.handleNewEvent=!1;var e=this.maxChangeNumber;this.mySegmentsProducer.synchronizeMySegments(this.segmentList,!0).then(()}}},{key:"put",value:]),t}(),aa=function(){function t(e,n,r){_(this,t),this.splitStorage=e,this.splitProducer=n,this.maxChangeNumber=0,this.splitsEventEmitter=r,this.put=this.put.bind(this),this.killSplit=this.killSplit.bind(this),this.__handleSplitUpdateCall=this.__handleSplitUpdateCall.bind(this),this.backoff=new ra(this.__handleSplitUpdateCall)}return k(t,[{key:"__handleSplitUpdateCall",value:function(){var t=this;this.maxChangeNumber>this.splitStorage.getChangeNumber()&&(this.handleNewEvent=!1,this.splitProducer.synchronizeSplits(!0).then((function(){t.handleNewEvent?t.__handleSplitUpdateCall():(t.splitProducer.synchronizeSegment&&t.splitProducer.synchronizeSegment(void 0,!1,!0),t.backoff.scheduleCall())})))}},{key:"put",value:function(t){t<=this.splitStorage.getChangeNumber()||t<=this.maxChangeNumber||(this.maxChangeNumber=t,this.handleNewEvent=!0,this.backoff.reset(),this.splitProducer.isSynchronizingSplits()||this.__handleSplitUpdateCall())}},{key:"killSplit",value:function(t,e,n){var r=this;this.splitStorage.killLocally(e,n,t).then((function(e){e&&r.splitsEventEmitter.emit(r.splitsEventEmitter.SDK_SPLITS_ARRIVED,!0),r.put(t)}))}}]),t}(),oa=/^control_/,sa=function(){function t(e,n){_(this,t),this.EventSource=e,this.streamingUrl=n.url("/sse"),this.reopen=this.reopen.bind(this)}return k(t,[{key:"setEventHandler",value:,{key:"open",value:function(t){this.close(),this.authToken=t;var e=Object.keys(t.channels).map(().join(","),n="".concat(this.streamingUrl,"?channels=").concat(e,"&accessToken=").concat(t.token,"&v=").concat("1.1","&heartbeats=true");this.connection=new this.EventSource(n),this.handler&&(this.connection.onopen=this.handler.handleOpen,this.connection.onmessage=this.handler.handleMessage,this.connection.onerror=this.handler.handleError)}},{key:"close",value:,{key:"reopen",value:],[{key:"getInstance",value:function(e){var n=ea();if(n)return new t(n,e)}}]),t}(),ca=600,ua="PUSH_NONRETRYABLE_ERROR",la="PUSH_RETRYABLE_ERROR",fa="PUSH_SUBSYSTEM_UP",ha="PUSH_SUBSYSTEM_DOWN",pa="MY_SEGMENTS_UPDATE",ga="SEGMENT_UPDATE",da="SPLIT_KILL",va="SPLIT_UPDATE",ma="CONTROL",ya="OCCUPANCY",Sa={STREAMING_DISABLED:"STREAMING_DISABLED",STREAMING_PAUSED:"STREAMING_PAUSED",STREAMING_RESUMED:"STREAMING_RESUMED"};var Ta=[/control_pri$/,/control_sec$/];var Ea=G("splitio-sync:sse-handler");function _a(t){var e=function(t){var e=Ta.map((),n=!0,r=!0;return{handleOpen:isStreamingUp:handleOccupancyEvent:function(i,a,o){for(var s=0;s<e.length;s++){var c=e[s];if(c.regex.test(a)){if(o>c.oTime){c.oTime=o,c.hasPublishers=0!==i;var u=e.some((function(t){return t.hasPublishers}));r&&(!u&&n?t.emit(ha):u&&!n&&t.emit(fa)),n=u}return}}},handleControlEvent:function(i,a,o){for(var s=0;s<e.length;s++){var c=e[s];if(c.regex.test(a))return void(o>c.cTime&&(c.cTime=o,i===Sa.STREAMING_DISABLED?t.emit(ua):n&&(i===Sa.STREAMING_PAUSED&&r?t.emit(ha):i!==Sa.STREAMING_RESUMED||r||t.emit(fa)),r=i===Sa.STREAMING_RESUMED))}}}}(t);return{handleOpen:function(){e.handleOpen()},handleError:function(e){var n=e;try{n=e)}catch(i){Ea.warn("Error parsing SSE error notification: ".concat(i))}var r=n.parsedData&&n.parsedData.message;Ea.error("Fail to connect to streaming".concat(r?', with error message: "'.concat(r,'"'):"")),!function(t){if(t.parsedData&&t.parsedData.code){var e=t.parsedData.code;if(40140<=e&&e<=40149)return!0;if(4e4<=e&&e<=49999)return!1}return!0}(n)?t.emit(ua):t.emit(la)},handleMessage:function(n){var r;try{r=function(t){var e=JSON.parse(t.data);return e.parsedData=JSON.parse(e.data),e.name&&"[meta]occupancy"===e.name&&(e.parsedData.type=ya),e}(n)}catch(u){return void Ea.warn("Error parsing new SSE message notification: ".concat(u))}var i=r,a=i.parsedData,o=i.data,s=i.channel,c=i.timestamp;if(Ea.debug("New SSE message received, with data: ".concat(o,".")),e.isStreamingUp()||a.type===ya||a.type===ma)switch(a.type){case va:t.emit(va,a.changeNumber);break;case ga:t.emit(ga,a.changeNumber,a.segmentName);break;case pa:t.emit(pa,a,s);break;case da:t.emit(da,a.changeNumber,a.splitName,a.defaultTreatment);break;case ya:e.handleOccupancyEvent(a.metrics.publishers,s,c);break;case ma:e.handleControlEvent(a.controlType,s,c)}}}}function ba(t){return Ir.hash(t,0).toString())}var Na=G("splitio-sync:push-manager");function ka(t,e){if(function(t){return ea()?"function"===typeof atob&&"function"===typeof btoa||(t.warn('"atob" and "btoa" functions for Base64 encoding are not available. Falling back to polling mode.'),!1):(t.warn("EventSource API is not available. Falling back to polling mode."),!1)}(Na)){var n=new(Se()),r=t.get(t.constants.READINESS).splits,a=t.get(t.constants.SETTINGS),o=t.get(t.constants.STORAGE),s=sa.getInstance(a),c=_a(n);s.setEventHandler(c);var u,l,f={},h=[],p=!1,g=new ra(y,a.scheduler.pushRetryBackoffBase);n.on(ha,T),n.on(fa,(),n.on(ua,(),n.on(la,(function(){s.close();var t=g.scheduleCall();Na.info("Attempting to reconnect in ".concat(t/1e3," seconds.")),n.emit(ha)}));var d=t.get(t.constants.PRODUCER),v=new aa(o.splits,d,r);if(h.push(v),n.on(da,v.killSplit),n.on(va,v.put),e)n.on(pa,(function(n,r){var i=r.split("_")[2],a=f[i];if(a&&e[a]){var o=e[a].get(t.constants.MY_SEGMENTS_CHANGE_WORKER,!0);o&&o.put(n.changeNumber,n.includesPayload?n.segmentList?n.segmentList:[]:void 0)}}));else{var m=new ia(o.segments,d);h.push(m),n.on(ga,m.put)}return i()(Object.create(n),{stop:S,start:y,startNewClient:function(t,e){var n=ba(t),r=e.get(e.constants.STORAGE),i=e.get(e.constants.PRODUCER);f[n]||(f[n]=t,p=!0);var a=new ia(r.segments,i);h.push(a),e.put(e.constants.MY_SEGMENTS_CHANGE_WORKER,a),setTimeout((,0)},removeClient:)}function y(){u=!1,Na.info("Connecting to push streaming.");var t=e?Object.keys(e):void 0;ta(a,t).then((function(r){if(!u){if(!r.pushEnabled)return Na.info("Streaming is not available. Switching to polling mode."),void n.emit(ua);if(!(t&&t.length<Object.keys(e).length)){var i=r.decodedToken;s.open(r),function(t,e){l&&clearTimeout(l);var n=e-t-ca;Na.info("Refreshing streaming token in ".concat(n," seconds.")),l=setTimeout(y,1e3*n)}(i.iat,i.exp)}}})).catch((function(t){u||(Na.error('Failed to authenticate for streaming. Error: "'.concat(t.message,'".')),t.statusCode>=400&&t.statusCode<500?n.emit(ua):n.emit(la))}))}function S(){u=!0,Na.info("Disconnecting from push streaming."),s.close(),l&&clearTimeout(l),g.reset(),T()}var Aa=G("splitio-producer:task"),Ra=function(t,e){var n,r=(n=t).name?n.name:(n.toString().match(/function (.+?)\(/)||["",""])[1],i=!1;return{start:function(){i||(Aa.debug("Starting ".concat(r," refreshing each ").concat(e)),i=Si((function(e){Aa.debug("Running ".concat(r)),t().then(()}),e))},stop:function(){Aa.debug("Stopping ".concat(r)),i&&i(),i=!1},isRunning:};var Oa=function(t,e){return t<1?e:new Promise((function(n,r){var i=setTimeout((,t);e.then((function(t){clearTimeout(i),n(t)}),()}))},Ia=Oi;var wa=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=t.sync.__splitFiltersValidation.queryString,s=Ia(function(t,e,n,r){return wi(t,"/splitChanges?since=".concat(e).concat(n||""),void 0,r?Ci:void 0)}(t,e,o,a)),c=n||i;return s=fn.start(fn.TaskNames.SPLITS_FETCH,!!c&&r,s),n&&(s=Oa(t.startup.requestTimeoutBeforeReady,s)),s.then((function(t){return t.json().catch((function(t){throw new Ni(t.message)}))}))},Ca=function(t){var e=new mn;return t.forEach((function(t){t.matcherGroup.matchers.forEach((function(t){var n=t.matcherType,r=t.userDefinedSegmentMatcherData;"IN_SEGMENT"===n&&e.add(r.segmentName)}))})),e},Da=G("splitio-producer:split-changes");function Ma(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.getAll(),r=n[t.constants.SETTINGS],i=n[t.constants.READINESS],o=n[t.constants.STORAGE],s=n[t.constants.COLLECTORS],c=i.splits,u=!0,l=!0;return function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;var f=o.splits.getChangeNumber();return(a(f)?f:Promise.resolve(f)).then((function(a){Da.debug("Spin up split update using since = ".concat(a));var f=wa(r,a,u,s,e,i).then((function(t){u=!1;var n=function(t){var e=t.reduce((function(t,e){return"ACTIVE"===e.status?(t.added.push([e.name,JSON.stringify(e)]),Ca(e.conditions).forEach(()):t.removed.push(e.name),t}),{added:[],removed:[],segments:new mn});return e.segments=vn(e.segments),e}(t.splits);return Da.debug("New splits ".concat(n.added.length)),Da.debug("Removed splits ".concat(n.removed.length)),Da.debug("Segment names collected ".concat(n.segments)),Promise.all([o.splits.setChangeNumber(t.till),o.splits.addSplits(n.added),o.splits.removeSplits(n.removed),o.segments.registerSegments(n.segments)]).then((function(){var n;(l||a!==t.till&&(!e||(n=o.segments).getRegisteredSegments().every(()))&&(l=!1,c.emit(c.SDK_SPLITS_ARRIVED))}))})).catch((function(e){return e instanceof Ni||(setTimeout((,0),u=!1),Da.warn("Error while doing fetch of Splits. ".concat(e)),u&&r.startup.retriesOnFailureBeforeReady>n?(n+=1,Da.info("Retrying download of splits #".concat(n,". Reason: ").concat(e)),t(n,i)):(u=!1,!1)}));return u&&o.splits.checkCache()&&c.emit(c.SDK_SPLITS_CACHE_LOADED),f}))}}var La=Oi;var Pa=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=La(function(t,e){return wi(t,"/mySegments/".concat(encodeURIComponent(pe(t.core.key))),void 0,e?Ci:void 0)}(t,arguments.length>3?arguments[3]:void 0));return r=fn.start(fn.TaskNames.MY_SEGMENTS_FETCH,!!e&&n,r),e&&(r=Oa(t.startup.requestTimeoutBeforeReady,r)),r.then((function(t){return t.json().catch(()})).then(()},Fa=G("splitio-producer:my-segments");var Ka=G("splitio-producer:mySegmentsHandler"),Ua=function(t){var e=t.get(t.constants.SETTINGS),n=t.get(t.constants.STORAGE).splits,r=t.get(t.constants.READINESS),i=r.splits,a=r.segments,o=function(t){var e=t.getAll(),n=e[t.constants.SETTINGS],r=e[t.constants.READINESS],i=e[t.constants.STORAGE],a=e[t.constants.COLLECTORS],o=r.segments,s=!0,c=!0;function u(t){var e=i.segments.resetSegments(t);i.splits.usesSegments()&&(e||s)&&(s=!1,o.emit(o.SDK_SEGMENTS_ARRIVED))}return function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;return e=i?new Promise(():Pa(n,c,a,o).then((),e.catch((function(e){return e instanceof Ni||setTimeout((function(){throw e}),0),c&&n.startup.retriesOnFailureBeforeReady>r?(r+=1,Fa.warn("Retrying download of segments #".concat(r,". Reason: ").concat(e)),t(r)):(c=!1,!1)}))}}(t),s=Ra(u,e.scheduler.segmentsRefreshRate);i.on(i.SDK_SPLITS_ARRIVED,(function(){if(!l)return;var t=n.usesSegments();t!==s.isRunning()&&(Ka.info("Turning segments data polling ".concat(t?"ON":"OFF",".")),t?s.start():s.stop())})),n.usesSegments()?i.once(i.SDK_SPLITS_ARRIVED,f):setTimeout(f,0);var c=!1;function u(t,e){return c=!0,o(0,t,e).then((function(t){return c=!1,t}))}var l=!1;function f(){t.get(t.constants.READY,!0)||n.usesSegments()||a.emit(a.SDK_SEGMENTS_ARRIVED)}return{start:stop:isRunning:function(){return l},isSynchronizingMySegments:function(){return c},synchronizeMySegments:u}},Ga=G("splitio-producer:updater"),xa=function(t){var e=t.get(t.constants.SETTINGS),n=Ma(t),r=Ra(o,e.scheduler.featuresRefreshRate),i=Ua(t),a=!1;function o(t){return a=!0,n(0,t).then(()}return{start:function(){Ga.info("Starting BROWSER producer"),r.start(),i.start()},stop:isRunning:r.isRunning,isSynchronizingSplits:function(){return a},synchronizeSplits:o,isSynchronizingMySegments:i.isSynchronizingMySegments,synchronizeMySegments:i.synchronizeMySegments}},Ba=G("splitio-sync:sync-manager");var Ha=G("splitio-client:cleanup"),Wa="unload",ja=function(){function t(e){_(this,t),this.storage=e.get(e.constants.STORAGE),this.settings=e.get(e.constants.SETTINGS),this.flushData=this.flushData.bind(this),this.settings.sync.impressionsMode===Rt&&(this.impressionsCounter=e.get(e.constants.IMPRESSIONS_COUNTER))}return k(t,[{key:"start",value:function(){"undefined"!==typeof window&&window.addEventListener&&(Ha.debug("Registering flush handler when unload page event is triggered."),window.addEventListener(Wa,this.flushData))}},{key:"stop",value:function(){"undefined"!==typeof window&&window.removeEventListener&&(Ha.debug("Deregistering flush handler when unload page event is triggered."),window.removeEventListener(Wa,this.flushData))}},{key:"flushData",value:,{key:"_flushImpressions",value:function(){var t=this.storage.impressions;if(!t.isEmpty()){var e=this.settings.url("/testImpressions/beacon"),n=Ki(t,this.settings),r={sim:this.settings.sync.impressionsMode===Rt?Rt:At};this._sendBeacon(e,n,r)||Li(Pi(this.settings,{body:JSON.stringify(n)})),t.clear()}}},{key:"_flushImpressionsCount",value:function(){var t={pf:Ui(this.impressionsCounter)};if(0!==t.pf.length){var e=this.settings.url("/testImpressions/count/beacon");this._sendBeacon(e,t)||Li(Fi(this.settings,{body:JSON.stringify(t)}))}}},{key:"_flushEvents",value:function(){var t=this.storage.events;if(!t.isEmpty()){var e=this.settings.url("/events/beacon"),n=t.toJSON();this._sendBeacon(e,n)||qi(Vi(this.settings,{body:JSON.stringify(n)})),t.clear()}}},{key:"_sendBeacon",value:function(t,e,n){if("undefined"!==typeof navigator&&navigator.sendBeacon){var r={entries:e,token:this.settings.core.authorizationKey,sdk:this.settings.version};n&&i()(r,n);var a=JSON.stringify(r);return navigator.sendBeacon(t,a)}return!1}}]),t}(),Ya={};var za=function(t,e,n){var r,a=!!n,o=t.get(t.constants.SETTINGS),s=t.get(t.constants.READINESS),c=t.get(t.constants.STORAGE),u=t.get(t.constants.STATUS_MANAGER),l=s.gate,f=s.splits,h=s.segments,p=l.SDK_READY,g=a?void 0:zi(t),d=a?void 0:Ji(t),v=a?void 0:new ja(t);switch(o.mode){case dt:case gt:t.put(t.constants.COLLECTORS,g&&g.collectors),a?r=Ya[o.core.authorizationKey].shared(t):(r=function(t){var e={},n=t.get(t.constants.SETTINGS),r=u(!1,t),i=n.streamingEnabled?ka(t,e):void 0,a=t.get(t.constants.PRODUCER);function o(){a.isRunning()?Ba.info("Streaming couldn't connect. Continue periodic fetch of data."):(Ba.info("Streaming not available. Starting periodic fetch of data."),T(e,(function(t){t.get(t.constants.PRODUCER).start()})))}function s(){a.isRunning()&&(Ba.info("PUSH (re)connected. Syncing and stopping periodic fetch of data."),T(e,(function(t){t.get(t.constants.PRODUCER).stop()}))),c()}function c(){t.get(t.constants.PRODUCER).synchronizeSplits(),T(e,()}function u(t,n){var r=t?Ua(n):xa(n),u=n.get(n.constants.SETTINGS),l=y(pe(u.core.key));return n.put(n.constants.PRODUCER,r),e[l]&&Ba.warn("A client with the same user key has already been created. Only the new instance will be properly synchronized."),e[l]=n,{start:function(){i?(t?a.isRunning()?r.start():r.synchronizeMySegments():(c(),i.on(fa,s),i.on(ha,o)),i.startNewClient(l,n)):r.start()},stop:function(){e[l]&&(delete e[l],i&&(i.removeClient(l),t||i.stop()),r.isRunning()&&r.stop())}}}return r.shared=u.bind(null,!0),r}(t),Ya[o.core.authorizationKey]=r);break;case vt:t.put(t.constants.READY_FROM_CACHE,!0)}if(e&&r&&!a){var m=e.sdkReadyTracker,S=e.splitsReadyTracker,E=e.segmentsReadyTracker;m.setCollectorForTask(g.collectors),l.once(p,m),f.once(f.SDK_SPLITS_ARRIVED,S),h.once(h.SDK_SEGMENTS_ARRIVED,E)}r&&r.start(),g&&g.start(),d&&t.put(t.constants.EVENTS,d)&&d.start(),t.put(t.constants.COLLECTORS,n);var _=i()(Object.create(u),yi(t),{destroy:function(){return r&&r.stop(),g&&g.stop(),d&&d.stop(),Promise.all([g&&g.flush(),d&&d.flush()]).then((function(){s.destroy(),v&&v.stop(),c.destroy&&c.destroy(),t.put(t.constants.DESTROYED,!0),a||(H(o.core.authorizationKey),delete Ya[o.core.authorizationKey])}))}});return!a&&v.start(_.destroy),{api:_,metricCollectors:g&&g.collectors}};function qa(t){var e=t.treatment;return t.keys?{conditionType:"WHITELIST",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"WHITELIST",negate:!1,whitelistMatcherData:{whitelist:f(t.keys)?[t.keys]:t.keys}}]},partitions:[{treatment:e,size:100}],label:"whitelisted ".concat(e)}:{conditionType:"ROLLOUT",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"ALL_KEYS",negate:!1}]},partitions:[{treatment:e,size:100}],label:"default rule"}}var Va={emptyMock:1};function Qa(t){var e=Object.keys(t);return e.length!==Object.keys(Va).length?(Va=t,!0):e.some((function(e){var n,r,i=!Va[e],a=(n=Va[e],r=t[e],o(n)!==o(r)||("string"===typeof n?n!==r:n.treatment!==r.treatment||n.config!==r.config)),s=i||a;return s&&(Va=t),s}))}var Ja=function(t){var e=t.features||{};if(!Qa(e))return!1;var n={};return T(e,(function(t,e){var r=t,i=null;d(t)&&(r=t.treatment,i=t.config||i);var a={};null!==i&&(a[r]=i),n[e]={conditions:[qa({treatment:r})],configurations:a}})),n},$a=G("splitio-producer:offline");var Za=function(t,e){var n=e.getAll(),r=n[e.constants.SETTINGS],i=n[e.constants.READINESS],a=n[e.constants.STORAGE];return function(){var e=[],n=null,o={};try{o=t(r)}catch(s){n=s,$a.error("There was an issue loading the mock Splits data, no changes will be applied to the current cache. ".concat(s))}return!n&&o?($a.debug("Splits data: "),$a.debug(JSON.stringify(o)),T(o,(function(t,n){e.push([n,JSON.stringify({name:n,status:"ACTIVE",killed:!1,trafficAllocation:100,defaultTreatment:"control",conditions:t.conditions||[],configurations:t.configurations,trafficTypeName:t.trafficTypeName})])})),Promise.all([a.splits.flush(),a.splits.addSplits(e)]).then(()):Promise.resolve()}},Xa=Za.bind(null,Ja),to=function(t){var e=t.get(t.constants.SETTINGS),n=Xa(t);return Ra(n,e.scheduler.offlineRefreshRate)};var eo=function(t,e){var n=!e,r=t.get(t.constants.READINESS),a=t.get(t.constants.STORAGE),o=t.get(t.constants.STATUS_MANAGER);n&&setTimeout((,0);var s=n?void 0:to(t);return s&&s.start(),{api:i()(Object.create(o),yi(t),{destroy:function(){return s&&s.stop(),r.destroy(),a.destroy&&a.destroy(),t.put(t.constants.DESTROYED,!0),!n&&H(),Promise.resolve()}}),metricCollectors:!1}};function no(t,e){var n=!1,r=!1;var i=function t(i){var a=new Promise((),o=a.then;return a.then=function(e,i){var s=o.call(a,e,i);return"function"===typeof e&&(n=!0),"function"===typeof i?(r=!0,s):t(s)},a}(t);return i.hasOnFulfilled=function(){return n},i}var ro=G(""),io="newListener",ao="removeListener";unction so(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.get(t.constants.READINESS).gate,r=0,a=!1,o=!1,s=n.SDK_READY,c=n.SDK_READY_FROM_CACHE,u=n.SDK_UPDATE,l=n.SDK_READY_TIMED_OUT;n.on(ao,(),n.on(io,(function(t){t!==s&&t!==l||(a?ro.error("A listener was added for ".concat(t===s?"SDK_READY":"SDK_READY_TIMED_OUT"," on the SDK, which has already fired and won't be emitted again. The callback won't be executed.")):t===s&&r++)}));var f=function(){var i=no(new Promise((function(c,u){n.once(s,(function(){ro.info("Split SDK is ready."),r!==e||i.hasOnFulfilled()||ro.warn("No listeners for SDK Readiness detected. Incorrect control treatments could have been logged if you called getTreatment/s while the SDK was not yet ready."),t.put(t.constants.READY,!0),a=!0,c()})),n.once(l,(function(e){t.put(t.constants.HAS_TIMEDOUT,!0),o=!0,u(e)}))})),oo);return i}();return n.once(c,(function(){ro.info("Split SDK is ready from cache."),t.put(t.constants.READY_FROM_CACHE,!0)})),i()(Object.create(n),{Event:{SDK_READY:s,SDK_READY_FROM_CACHE:c,SDK_UPDATE:u,SDK_READY_TIMED_OUT:l},ready:function(){return o?a?Promise.resolve():no(Promise.reject("Split SDK has emitted SDK_READY_TIMED_OUT event."),oo):f},__context:t})}var co="splitio-ga-to-split",uo=co+":mapper",lo=G(co);var fo,ho=(fo={eventTypeId:{event:"eventAction",social:"socialAction"},eventValue:{event:"eventValue",timing:"timingValue"},eventProperties:{pageview:["page"],screenview:["screenName"],event:["eventCategory","eventLabel"],social:["socialNetwork","socialTarget"],timing:["timingCategory","timingVar","timingLabel"],exception:["exDescription","exFatal"]}},;function po(t){if(!Array.isArray(t))return[];var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:JSON.stringify,n={};return t.filter(()}(t);return e.filter(()}var go=/^[^a-zA-Z0-9]+/,vo=/[^-_.:a-zA-Z0-9]+/g;var mo=function(t,e,n){var r={prefix:"ga",identities:n.key&&n.trafficType?[{key:n.key,trafficType:n.trafficType}]:void 0};!function(t,e){var n=window.GoogleAnalyticsObject||"ga";window[n]=window[n]||window[n]("provide",t,e)}("splitTracker",(function n(a,o){_(this,n);var s=i()({},r,t,o);this.tracker=a;var c=po(s.identities);if(0!==c.length){var u=c.length-s.identities.length;u&&lo.warn("".concat(u," identities were discarded because they are invalid or duplicated. Identities must be an array of objects with key and trafficType.")),s.identities=c,f(s.prefix)||(lo.warn("The provided `prefix` was ignored since it is invalid. Please check that you are passing a string object as `prefix`."),s.prefix=void 0);var l=a.get("sendHitTask");a.set("sendHitTask",(function(t){if(l(t),!1!==s.hits&&!t.get("splitHit")){try{if(s.filter&&!s.filter(t))return}catch(r){return void lo.warn("GaToSplit custom filter threw: ".concat(r))}var n=ho(t);if(s.mapper){try{n=s.mapper(t,n)}catch(r){return void lo.warn("GaToSplit custom mapper threw: ".concat(r))}if(!n)return}s.prefix&&(n.eventTypeId="".concat(s.prefix,".").concat(n.eventTypeId)),n.eventTypeId=function(t){if(!f(t)||0===t.length)return t;var e=t.replace(go,"").replace(vo,"_"),n=e.slice(0,80);return n.length<e.length&&lo.warn("EventTypeId was truncated because it cannot be more than 80 characters long."),n}(n.eventTypeId),function(t){return!!z(t.eventTypeId,uo)&&!1!==V(t.value,uo)&&!1!==tt(t.properties,uo).properties&&!(t.timestamp&&!h(t.timestamp))&&(!t.key||!1!==it(t.key,uo))&&(!t.trafficTypeName||!1!==wt(t.trafficTypeName,uo))}(n)&&(n.key&&n.trafficTypeName?e.events.track(n):s.identities.forEach((function(t){var r=i()({key:t.key,trafficTypeName:t.trafficType},n);e.events.track(r)})))}})),lo.info("Started GA-to-Split integration")}else lo.warn("No valid identities were provided. Please check that you are passing a valid list of identities or providing a traffic type at the SDK configuration.")}))},yo=G("splitio-split-to-ga"),So=function(){function t(e){if(_(this,t),"function"!==typeof t.getGa())return yo.warn("`ga` command queue not found. No hits will be sent."),{};this.trackerNames=t.defaultTrackerNames,e&&("function"===typeof e.filter&&(this.filter=e.filter),"function"===typeof e.mapper&&(this.mapper=e.mapper),Array.isArray(e.trackerNames)&&(this.trackerNames=m(e.trackerNames)),this.impressions=e.impressions,this.events=e.events),yo.info("Started Split-to-GA integration")}return k(t,[{key:"queue",value:function(e){var n=t.getGa();if(n){if(!1===this.impressions&&e.type===bt)return;if(!1===this.events&&e.type===Nt)return;var r;try{if(this.filter&&!this.filter(e))return;if(r=t.defaultMapper(e),this.mapper&&(!(r=this.mapper(e,r))||!t.validateFieldsObject(r)))return}catch(i){return void yo.warn("SplitToGa queue method threw: ".concat(i,". No hit was sent."))}this.trackerNames.forEach((function(t){var e=t?"".concat(t,".send"):"send";r.splitHit=!0,n(e,r)}))}}}],[{key:"defaultMapper",value:function(t){var e=t.type,n=t.payload;switch(e){case bt:return{hitType:"event",eventCategory:"split-impression",eventAction:"Evaluate "+n.impression.feature,eventLabel:"Treatment: "+n.impression.treatment+". Targeting rule: "+n.impression.label+".",nonInteraction:!0};case Nt:return{hitType:"event",eventCategory:"split-event",eventAction:n.eventTypeId,eventValue:n.value,nonInteraction:!0}}return null}},{key:"getGa",value:function(){return"undefined"!==typeof window?window[window.GoogleAnalyticsObject||"ga"]:void 0}},{key:"validateFieldsObject",value:function(t){return!(!t||!t.hitType)||(yo.warn("your custom mapper returned an invalid FieldsObject instance. It must be an object with at least a `hitType` field."),!1)}}]),t}();So.defaultTrackerNames=[""];var To=So,Eo=function(t){var e=t.get(t.constants.SETTINGS),n=[];if(e.integrations.forEach((function(r){var i;switch(r.type){case Et:var a=t.get(t.constants.STORAGE),o=e.core;i=mo(r,a,o);break;case _t:i=new To(r)}i&&i.queue&&n.push(i)})),0!==n.length)return{handleImpression:function(t){n.forEach((function(e){return e.queue({type:bt,payload:t})}))},handleEvent:},_o=function(){eturn k(t,[{key:"_makeKey",value:,{key:"inc",value:,{key:"popAll",value:function(){var t={};return i()(t,this.cache),this.cache={},t}},{key:"size",value:]),t}(),bo=G("splitio"),No=function(t,e){return"".concat(t.matchingKey?t.matchingKey:t,"-").concat(t.bucketingKey?t.bucketingKey:t,"-").concat(void 0!==e?e:"")};function ko(t){var e={},n={splitsReadyTracker:fn.start(fn.TaskNames.SPLITS_READY),segmentsReadyTracker:fn.start(fn.TaskNames.SEGMENTS_READY),sdkReadyTracker:fn.start(fn.TaskNames.SDK_READY)},r=new Je,i=qe(t);r.put(r.constants.SETTINGS,i),function(t){var e=!1;void 0==t?x.error("Factory instantiation: you passed a null or undefined api_key, api_key must be a non-empty string."):f(t)?t.length>0?e=t:x.error("Factory instantiation: you passed an empty api_key, api_key must be a non-empty string."):x.error("Factory instantiation: you passed an invalid api_key, api_key must be a non-empty string."),e&&(B[e]?(x.warn("Factory instantiation: You already have ".concat(B[e]," ").concat(1===B[e]?"factory":"factories"," with this API Key. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application.")),B[e]++):(B[e]=1,Object.keys(B).length>1&&x.warn("Factory instantiation: You already have an instance of the Split factory. Make sure you definitely want this additional instance. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application.")))}(i.core.authorizationKey);var a=Oe(),o=a(i.startup.readyTimeout);r.put(r.constants.READINESS,o);var s=so(r);r.put(r.constants.STATUS_MANAGER,s);var c=me(r);r.put(r.constants.STORAGE,c);var u=new _o;r.put(r.constants.IMPRESSIONS_COUNTER,u);var l=Eo(r);r.put(r.constants.INTEGRATIONS_MANAGER,l);var h=i.mode===pt?eo:za,p=h(r,n),g=p.api,d=p.metricCollectors,v=Ut(c.splits,r),m=$e(i.core.key),y=No(m,i.core.trafficType);return e[y]=g,bo.info("New Split SDK instance created."),{client:function(t,n){if(void 0===t)return bo.debug("Retrieving default SDK client."),g;if("function"!=typeof c.shared)throw new Error("Shared Client not supported by the storage mechanism. Create isolated instances instead.");var o,s=it(t,"Shared Client instantiation");if(!1===s)throw new Error("Shared Client needs a valid key.");if(void 0!==n&&!1===(o=wt(n,"Shared Client instantiation")))throw new Error("Shared Client needs a valid traffic type or no traffic type at all.");var l=No(s,o);if(e[l])bo.debug("Retrieving existing SDK client.");else{var f=i.overrideKeyAndTT(s,o),p=new Je,v=a(f.startup.readyTimeout);p.put(r.constants.READY_FROM_CACHE,r.get(r.constants.READY_FROM_CACHE,!0)),p.put(r.constants.READINESS,v),p.put(r.constants.STATUS_MANAGER,so(p,-1)),p.put(r.constants.SETTINGS,f),p.put(r.constants.STORAGE,c.shared(f)),p.put(r.constants.IMPRESSIONS_COUNTER,u),e[l]=h(p,!1,d).api,bo.info("New shared client instance created.")}return e[l]},manager:Logger:U,settings:i}}},60552:function(t,e,n){var r,i;r=function(){"use strict";Array.isArray||(Array.isArray=;var t={MAX_CODEPOINT:1114111,encodeUTF8:decodeUTF8:UTF16toUTF8:UTF8toUTF16:encodeUTF16toUTF8:function(e,n){t.UTF16toUTF8(e,(function(e){t.encodeUTF8(e,n)}))},decodeUTF8toUTF16:calculateCodePoint:calculateUTF8:calculateUTF16asUTF8:,e=String.fromCharCode;return t.arraySource=t.arrayDestination=t.stringSource=function(t){if("string"!==typeof t)throw TypeError("Illegal argument: "+typeof t);var e=0;return ,t.stringDestination=t.assertCharCode=function(t){if("number"!==typeof t||t!==t)throw TypeError("Illegal char code: "+typeof t);if(t<0||t>65535)throw RangeError("Illegal char code: "+t);return t},t.assertCodePoint=function(e){if("number"!==typeof e||e!==e)throw TypeError("Illegal code point: "+typeof e);if(e<0||e>t.MAX_CODEPOINT)throw RangeError("Illegal code point: "+e);return e},t.fromCodePoint=t.codePointAt=function(e,n){if("string"!==typeof e&&!(e&&e instanceof String)||"number"!==typeof n)throw TypeError("Illegal arguments: "+typeof e+", "+typeof n);var r,i;if(!(n<0||n>=(r=e.length)))return t.UTF16toUTF8((function(){return"undefined"===typeof i&&n<r?e.charCodeAt(n++):null}),(function(t){i=t})),i},t.polyfill=t},void 0===(i="function"===typeof r?r.call(e,n,e,t):r)||(t.exports=i)},40197:]);
//# sourceMappingURL=SPLITIOJS.94f66975.chunk.js.map