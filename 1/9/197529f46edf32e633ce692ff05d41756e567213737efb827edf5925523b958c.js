/*! For license information please see sdk.cards.js.LICENSE.txt */
(()=>{var e={483:(e,t,n)=>{e.exports={1:[function(e,t,r){(.call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);ar i={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];orts=l).prototype.catch=l.prototype.then=d.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=d.prototype.otherCallRejected=i.resolve=i.reject=l.resolve=l.reject=l.all=l.race=,{1:1}],3:[{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?o=);undefined"==typeof Promise&&e(3);var a=Promise;u="local-forage-detect-blob-support",f=void 0,g={},h=Object.prototype.toString,p="readonly",m="readwrite";nction b(e){return(e=g[e.name].deferredOperations.pop())&&(e.resolve(),e.promise)}nction C(e){return S(e,!1)}unction _(e,t){if(!e.db)return 1;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,o=e.version>e.db.version;return r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(o||n)&&(!n||(n=e.db.version+1)>e.version&&(e.version=n),1)}k={_driver:"asyncStorage",_initStorage:_support:),iterate:getItem:function(e,t){var n=this;e=l(e);var r=new a(();return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var o=new a((function(n,o){var i;r.ready().then(().then((function(t){T(r._dbInfo,m,(function(i,a){if(i)return o(i);try{var s=a.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);a.oncomplete=a.onabort=a.onerror=function(){var e=c.error||c.transaction.error;o(e)}}catch(i){o(i)}}))})).catch(o)}));return s(o,n),o},removeItem:function(e,t){var n=this;e=l(e);var r=new a(();return s(r,t),r},clear:length:key:keys:dropInstance:function(e,t){t=d.apply(this,arguments);var n,r=this.config();return(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),s(n=e.name?(n=e.name===r.name&&this._dbInfo.db?a.resolve(this._dbInfo.db):C(e).then((),e.storeName?n.then(():n.then(()):a.reject("Invalid arguments"),t),n}},O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D=/^~~local_forage_type~([^~]+)~/,N="__lfsc__:",L=N.length,R="arbf",B="blob",F=L+R.length,P=Object.prototype.toString;function $(e){var t,n,r,o,i=.75*e.length,a=e.length,s=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--),i=new ArrayBuffer(i);for(var c=new Uint8Array(i),l=0;l<a;l+=4)t=O.indexOf(e[l]),n=O.indexOf(e[l+1]),r=O.indexOf(e[l+2]),o=O.indexOf(e[l+3]),c[s++]=t<<2|n>>4,c[s++]=(15&n)<<4|r>>2,c[s++]=(3&r)<<6|63&o;return i}function M(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r+=3)n+=O[t[r]>>2],n+=O[(3&t[r])<<4|t[r+1]>>4],n+=O[(15&t[r+1])<<2|t[r+2]>>6],n+=O[63&t[r+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var j={serialize:deserialize:function(e){if(e.substring(0,L)!==N)return JSON.parse(e);var t,n=e.substring(F),r=e.substring(L,F);r===B&&D.test(n)&&(t=(e=n.match(D))[1],n=n.substring(e[0].length));var o=$(n);switch(r){case R:return o;case B:return i([o],{type:t});case"si08":return new Int8Array(o);case"ui08":return new Uint8Array(o);case"uic8":return new Uint8ClampedArray(o);case"si16":return new Int16Array(o);case"ur16":return new Uint16Array(o);case"si32":return new Int32Array(o);case"ui32":return new Uint32Array(o);case"fl32":return new Float32Array(o);case"fl64":return new Float64Array(o);default:throw new Error("Unkown type: "+r)}},stringToBuffer:$,bufferToString:M};nction W(e,t,n,r){var o=this;e=l(e);var i=new a(();return s(i,n),i}var H={_driver:"webSQLStorage",_initStorage:_support:"function"==typeof openDatabase,iterate:getItem:function(e,t){var n=this;e=l(e);var r=new a(();return s(r,t),r},setItem:removeItem:clear:length:key:keys:dropInstance:function(e,t){t=d.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r=this,o=e.name?new a(().then(():a.reject("Invalid arguments");return s(o,t),o}};{_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=q(e,this._defaultConfig),!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),void localStorage.removeItem(e)}catch(e){return 1}}()||0<localStorage.length?((this._dbInfo=t).serializer=j,a.resolve()):a.reject()},_support:),iterate:getItem:function(e,t){var n=this;e=l(e);var r=n.ready().then(();return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var o=r.ready().then(();return s(o,n),o},removeItem:clear:length:key:keys:dropInstance:;var K=Array.isArray||G={},Y={},Q={INDEXEDDB:k,WEBSQL:H,LOCALSTORAGE:e},X=(e=[Q.INDEXEDDB._driver,Q.WEBSQL._driver,Q.LOCALSTORAGE._driver],["dropInstance"]),J=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(X),Z={description:"",driver:e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};unction te(e){for(var t in this,te),Q){var n,r;Q.hasOwnProperty(t)&&(r=(n=Q[t])._driver,this[t]=r,G[r]||this.defineDriver(n))}this._defaultConfig=ee({},Z),this._config=ee({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(()}e=new(te.prototype.config=te.prototype.defineDriver=function(e,t,n){var r=new a((function(t,n){try{var r=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(o);for(var i=J.concat("_initStorage"),c=0,l=i.length;c<l;c++){var d=i[c];if((!V(X,d)||e[d])&&"function"!=typeof e[d])return void n(o)}!function(){for(var t=0,n=X.length;t<n;t++){var r=X[t];e[r]||(e[r]=r))}}();var u="_support"in e?e._support&&"function"==typeof e._support?e._support().then(u,n):u(!!e._support):u(!0)}catch(o){n(o)}}));return c(r,t,n),r},te.prototype.driver=te.prototype.getDriver=te.prototype.getSerializer=te.prototype.ready=te.prototype.setDriver=function(e,t,n){var r=this;K(e)||(e=[e]);var o=this._getSupportedDrivers(e);turn e=null!==this._driverSet?this._driverSet.catch((function(){return a.resolve()})):a.resolve(),this._driverSet=e.then(().catch((),c(this._driverSet,t,n),this._driverSet},te.prototype.supports=te.prototype._extend=te.prototype._getSupportedDrivers=te.prototype._wrapLibraryMethodsWithReady=te.prototype.createInstance=te),t.exports=e},{3:3}]},{},[4])(4)},877:(e,t,n)=>{var r=n(570),o=n(171);(n=o).v1=r,n.v4=o,e.exports=n},327:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=,217:570:(e,t,n)=>{var r,o,i=n(217),a=n(327),s=0,c=0;e.exports=function(e,t,n){var l=t&&n||0,d=t||[],u=(e=e||{}).node||r,f=void 0!==e.clockseq?e.clockseq:o;null!=u&&null!=f||(h=i(),null==u&&(u=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==f&&(f=o=16383&(h[6]<<8|h[7])));var g=void 0!==e.msecs?e.msecs:(new Date).getTime(),h=(n=void 0!==e.nsecs?e.nsecs:c+1,g-s+(n-c)/1e4);if(h<0&&void 0===e.clockseq&&(f=f+1&16383),1e4<=(n=(h<0||s<g)&&void 0===e.nsecs?0:n))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=g,o=f,n=(1e4*(268435455&(g+=122192928e5))+(c=n))%4294967296,d[l++]=n>>>24&255,d[l++]=n>>>16&255,d[l++]=n>>>8&255,d[l++]=255&n,g=g/4294967296*1e4&268435455,d[l++]=g>>>8&255,d[l++]=255&g,d[l++]=g>>>24&15|16,d[l++]=g>>>16&255,d[l++]=f>>>8|128,d[l++]=255&f;for(var p=0;p<6;++p)d[l+p]=u[p];return t||a(d)}},171:,t={};.d=n.g=),n.o=n.r=var r={};(()=>{"use strict";n.r(r),n.d(r,{MoeCards:);const e="initData",t="browserDetails",o="unifiedLogs",i={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION"},a=2,s="USER_ATTRIBUTE_UNIQUE_ID",c={DC_1:"sdk-01.moengage.com",DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",DC_5:"sdk-05.moengage.com",DC_100:"sdk-100.moengage.com",eu:"sdk-02.moengage.com",in:"sdk-03.moengage.com"},l="moe_cards",d={STORE_NAME:"campaigns"},u={STORE_NAME:"meta",LAST_FETCH_SDK_VERSION:"last_fetch_sdk_version",LAST_META_CALL_TIME:"last_meta_call_time",UNIQUE_ID:"unique_id",LAST_SYNC_CARDS:"last_sync_cards",SYNC_INTERVALS:"sync_intervals",SHOW_ALL_TAB:"show_all_tab"},f="basic",g="v1/cards/get",h="v1/cards/user",p="v1/cards/user/delete",m="categories",v="MOE_CARD_DELIVERED",y="MOE_CARD_IMPRESSION",b="MOE_CARD_CLICKED",w="MOE_CARD_DISMISSED",S="MOE_CARD_INBOX_CLICKED",C="appOpen",I="appInbox",_="moe-floating-icon-iframe",E="moe-floating-icon",x="moe-inbox",A="card-box",T="moe-card=1",k="inboxOpen",O="inboxClosed",D="cardClick",N="moe-osm-pusher";function L(e,t,n){return null!=e&&t?(e=e[(t=Array.isArray(t)?t:t.split("."))[0]])&&1<t.length?L(e,t.slice(1),n):void 0===e?n||null:e:null}class R{static set(e,t){R.baseLogTag,window&&(window.moeInternals?window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}):(window.moeInternals={},window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t)}static get(e){return L(window,"moeInternals.ephemeral."+e,null)}}R.baseLogTag="EphemeralStorage";let B="color: white; background: #41AE55; border-radius: 5px;";.baseLogTag="Logger",F.logBrand="MoEngage",F.logLevel=0,F.tagLogStyle="color: white; background: #48beab; border-radius: 5px;";class P{tatic enqueue(e,t){e=P.getLocalStorageQName(e);let n=new P;j.get(e)&&(n=j.get(e)),n.items.push(t),n.items=n.items.slice(Math.max(n.items.length-50,0)),j.set(e,n)}static dequeue(e){e=P.getLocalStorageQName(e);const t=j.get(e);let n=null;return t&&0<t.items.length&&(n=t.items[0],t.items.splice(0,1),j.set(e,t)),n}static isEmpty(e){return e=P.getLocalStorageQName(e),!(j.get(e)&&0<j.get(e).items.length)}static purge(e){var t=P.getLocalStorageQName(e);P.isEmpty(e)||j.remove(t)}class ${static set(e,t){var n=$.baseTag+".set";null==t?$.remove(e):(t="boolean"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"boolean"}):"string"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"string"}):JSON.stringify(t),F.log(3,n,"Setting ",e,":",t),n=Date.now(),n=";expires="+new Date(n+31536e6*a).toUTCString(),document.cookie=e+"="+encodeURIComponent(t)+n+";domain="+$.getOrigin()+";path=/;SameSite=None; Secure")}static get(e){var t=$.baseTag+".get",n=e+"=",r=decodeURIComponent(document.cookie).split(";");for(let o=r.length-1;0<=o;o--){let i=r[o];for(;" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(n)){let r=i.substring(n.length,i.length);try{r=JSON.parse(r),"string"===L(r,"MOE_DATA_TYPE",null)?(r=L(r,"actualValue",null),r=r?String(r):null):"boolean"===L(r,"MOE_DATA_TYPE",null)&&(r=L(r,"actualValue",null))}catch(e){}return F.log(3,t,"Got ",e,":",r),r}}return null}static remove(e){var t=$.baseTag+".remove";document.cookie=e+"=;domain="+$.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;",F.log(3,t,"Removed ",e)}static setRaw(e,t,n){var r=$.baseTag+".setRaw";if(null==t)$.remove(e);else{F.log(3,r,"Setting ",e,":",t);let o="";null!=n&&(o=";expires="+n.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+o+";domain="+$.getOrigin()+";path=/;"}}static getOrigin(){var e=$.baseTag+".getOrigin";let t=window.location.origin;return t=t.indexOf(".")!==t.lastIndexOf(".")?t.substring(t.indexOf(".")):"."+t.substring(t.lastIndexOf("/")+1),"localhost"===window.location.hostname&&(F.warn(1,e,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),t=""),t}}$.baseTag="CookieStorage";const M="MOE_DATA";class j{tatic set(e,t){if(j.baseLogTag,e=j.prefix+e,localStorage){const n=j.getMoeData();n[e]=t,localStorage.setItem(M,JSON.stringify(n))}var n=j.KEYS_SHARED_WITH_COOKIE.indexOf(e);if(j.isSharedWithCookie&&0<=n){const r="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t);0===n&&Array.isArray(r.attributes)&&(r.attributes=r.attributes.filter((e=>{switch(e.key){case s:case"USER_ID_MODIFIED_FROM":case"USER_ATTRIBUTE_USER_EMAIL":case"USER_ATTRIBUTE_USER_MOBILE":return!0;default:return!1}}))),e===i.SUBSCRIPTION_DETAILS&&(r.domain=t.domain,r.token=t.token,r.endpoint=t.endpoint,r.keys=t.keys),$.set(e,r)}}static get(e){return j.baseLogTag,e=j.prefix+e,localStorage?L(j.getMoeData(),e,null):null}static remove(e){var t=j.baseLogTag+".remove",n=j.prefix+e;if(localStorage&&null!=j.get(e)){const r=j.getMoeData();delete r[n],localStorage.setItem(M,JSON.stringify(r)),F.log(2,t,"Key",e,"removed.")}j.isSharedWithCookie&&0<=j.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&$.remove(e)}static logout(){const e=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA"];for(const t in i)e.indexOf(t)<0&&j.remove(i[t]);for(const e in i.Q)P.purge(e)}static getString(e){if(e=j.prefix+e,localStorage)return"string"==typeof(e=j.get(e))||e instanceof String?e:JSON.stringify(e)}atic getMoeData(){var e=j.baseLogTag+".getMoeData",t=localStorage.getItem(M);if(null==t)return{};try{return JSON.parse(t)}catch(t){return F.error(1,e,t),{}}}}j.baseLogTag="PersistentStorage",j.prefix="",j.isSharedWithCookie=!1,j.KEYS_SHARED_WITH_COOKIE=[i.USER_DATA,i.SUBSCRIPTION_DETAILS,i.SOFT_ASK_STATUS,i.SETUP_TIME,i.PUSH_TOKEN,i.OPT_IN_SHOWN_TIME,i.HARD_ASK_STATUS];var U,z=n(483),W=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};.baseLogTag="MOE_CARDS_STORES";class q{ic isBrowserUpdated(e,t){return function e(t,n){if(null==t||null==n)return t===n;if(t instanceof Function)return t===n;if(t instanceof RegExp)return t===n;if(t===n||t.valueOf()===n.valueOf())return!0;if(Array.isArray(t)&&t.length!==n.length)return!1;if(t instanceof Date)return!1;if(!(t instanceof Object))return!1;if(!(n instanceof Object))return!1;const r=Object.keys(t);return Object.keys(n).every(()&&r.every(()}(e,t)}sChrome(){return this.name===q.BROWSER_NAMES.CHROME}isFirefox(){return this.name===q.BROWSER_NAMES.FIREFOX}sSafari(){return this.name===q.BROWSER_NAMES.SAFARI}_e=(_e=q=q||{}).BROWSER_NAMES||(_e.BROWSER_NAMES={})).CHROME="Google Chrome",_e.FIREFOX="Mozilla Firefox",_e.OPERA="Opera",_e.OPERA_NEON="Opera Neon",_e.SAFARI="Apple Safari",_e.INTERNET_EXPLORER="Internet Explorer",_e.EDGE="Edge",_e.OTHERS="Others";class V{constructor(e){var t=V.baseLogTag+".constructor";e.placeholder||F.warn(1,t,"Placeholder for cards inbox not passed in cardsConfig: ",e),this.placeholder=L(e,"placeholder",""),this.overLayColor=L(e,"overLayColor","rgba(0, 0, 0, 0.8)"),this.backgroundColor=L(e,"backgroundColor","#F6FBFC"),this.navigationBar=new K(L(e,"navigationBar",{})),this.closeButton=new Q(L(e,"closeButton",{})),this.tab=new X(L(e,"tab",{})),this.cardDismiss=new J(L(e,"cardDismiss",{})),this.optionButtonColor=L(e,"optionButtonColor","#C4C4C4"),this.dateTimeColor=L(e,"dateTimeColor","#8E8E8E"),this.unclickedCardIndicatorColor=L(e,"unclickedIndicatorColor","blue"),this.pinIcon=L(e,"pinIcon","https://app-cdn.moengage.com/sdk/pin-icon.svg"),this.refreshIcon=L(e,"refreshIcon","https://app-cdn.moengage.com/sdk/refresh-icon.svg"),this.webFloating=new te(L(e,"webFloating",{})),this.mWebFloating=new te(L(e,"mWebFloating",{countBackgroundColor:"#FF5A5F",enable:!1,icon:"https://app-cdn.moengage.com/sdk/bell-icon.svg",countColor:"#fff",postion:"0px 10px 40px 0",iconBackgroundColor:"#D9DFED"})),this.card=new Y(L(e,"card",{})),this.errorContent=new G(L(e,"errorContent",{})),this.noDataContent=new ne(L(e,"noDataContent",{})),this.openInbox=L(e,"openInbox",(()=>{})),this.zIndex=L(e,"zIndex","999999"),this.fontFaces=(null===(e=e.fontFaces)||void 0===e?void 0:e.map((e=>new Z(e))))||[]}}V.baseLogTag="CardsConfigModel";class K{constructor(e){this.backgroundColor=L(e,"backgroundColor","#00237C"),this.text=L(e,"text","Notification"),this.color=L(e,"color","#fff"),this.fontSize=L(e,"fontSize","16px"),this.fontFamily=L(e,"fontFamily","inherit")}}class G{constructor(e={}){this.img=L(e,"img","https://app-cdn.moengage.com/sdk/cards-error.svg"),this.text=L(e,"text",'Error something went wrong <button onclick="window.location.reload();" style="color: #06A6B7; display: contents;" class="btn-icon pointer-cursor" >Refresh</button>')}}class Y{constructor(e){this.headerFontSize=L(e,"headerFontSize","16px"),this.descriptionFontSize=L(e,"descriptionFontSize","14px"),this.ctaFontSize=L(e,"ctaFontSize","12px"),this.fontFamily=L(e,"fontFamily","inherit"),this.horizontalRowColor=L(e,"horizontalRowColor","#D9DFED")}}class Q{constructor(e){this.mWebIcon=L(e,"mWebIcon","https://app-cdn.moengage.com/sdk/back-icon.svg"),this.webIcon=L(e,"webIcon","https://app-cdn.moengage.com/sdk/cross-icon.svg"),this.callBack=L(e,"callBack",()}}class X{constructor(e){this.inactiveTabFontColor=L(e,"inactiveTabFontColor","#7C7C7C"),this.fontSize=L(e,"fontSize","14px"),this.fontFamily=L(e,"fontFamily","inherit"),this.backgroundColor=L(e,"backgroundColor","#F6FBFC"),this.active=new ee(L(e,"active",{}))}}class J{constructor(e){this.color=L(e,"color","red"),this.enable=L(e,"enable",!1)}}class Z{constructor(e){this.family=L(e,"family",""),this.url=L(e,"url","")}}class ee{constructor(e){this.color=L(e,"color","#06A6B7"),this.underlineColor=L(e,"underlineColor","#06A6B7"),this.backgroundColor=L(e,"backgroundColor","transparent")}}class te{constructor(e){this.enable=L(e,"enable",!1),this.icon=L(e,"icon","https://app-cdn.moengage.com/sdk/bell-icon.svg"),this.postion=L(e,"postion","0px 10px 40px 0"),this.countBackgroundColor=L(e,"countBackgroundColor","#FF5A5F"),this.countColor=L(e,"countColor","#fff"),this.zIndex=L(e,"zIndex","999998"),this.iconBackgroundColor=L(e,"iconBackgroundColor","#D9DFED"),this.fontFamily=L(e,"fontFamily","inherit")}}class ne{constructor(e){this.img=L(e,"img","https://app-cdn.moengage.com/sdk/cards-no-result.svg"),this.text=L(e,"text","No notifications to show, check again later.")}}class re{constructor(e){this.debugLevel=0,this.cluster=null,this.environment=null,this.baseDomainName="https://sdk-01.moengage.com/",this.inapp=null,this.customSoftAsk=null;var t=re.baseLogTag+".constructor";null!=L(e,"app_id",null)?(this.appId=L(e,"app_id",null),this.integrationType=U.OLD_SDK):null!=L(e,"appId",null)?(this.appId=L(e,"appId",null),this.integrationType=U.NEW_SDK):(F.error(1,t,"App Id not specified. Please check docs page to complete the integration - ","https://docs.moengage.com/docs/web-sdk-integration"),this.integrationType=null),null!=L(e,"debug_logs",null)?this.debugLevel=L(e,"debug_logs",0):null!=L(e,"debugLevel",null)?this.debugLevel=L(e,"debugLevel",0):(F.log(2,t,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://sdk-01.moengage.com/",this.forceSwUpdate=L(e,"forceSwUpdate",!1),this.cluster=L(e,"cluster",this.cluster),this.cluster&&null!=c[this.cluster]&&(this.environment=c[this.cluster]),L(e,"environment",null)&&(this.environment=e.environment),this.environment&&(this.baseDomainName="https://"+this.environment+"/"),0<this.debugLevel&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&0<=this.appId.indexOf("_DEBUG")&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=L(e,"swPath",null),null!=e.customSoftAsk?this.customSoftAsk={mainClass:L(e,"customSoftAsk.mainClass",null),allowClass:L(e,"customSoftAsk.allowClass",null),dismissClass:L(e,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:L(e,"main_class",null),allowClass:L(e,"allow_class",null),dismissClass:L(e,"block_class",null)},null!=L(e,"inapp.host",null)&&(this.inapp={host:L(e,"inapp.host",null)}),null!=L(e,"swScope",null)&&(this.swScope=L(e,"swScope",null)),null!=L(e,"disable_onsite",null)&&(this.disableOnsite=L(e,"disable_onsite",!1)),null!=L(e,"enableSPA",null)&&(this.enableSPA=L(e,"enableSPA",!1)),null!=L(e,"cards",null)&&(this.cards=new V(L(e,"cards",{}))),null!=L(e,"api_proxy_domain",null)&&(this.apiProxyDomain=L(e,"api_proxy_domain",null),this.baseDomainName="https://"+this.apiProxyDomain+"/",this.environment=this.apiProxyDomain),null!=L(e,"disable_web_push",null)&&(this.disableWebPush=L(e,"disable_web_push",!1)))}static save(t){R.set(e,new re(t)),j.set(i.INIT_DATA,new re(t))}tatic setSoftAskConfig(e){var t=re.get();e={appId:t.appId,debugLevel:t.debugLevel,cluster:t.cluster,environment:t.environment,swPath:t.swPath,enableSPA:t.enableSPA,cards:t.cards,apiProxyDomain:t.apiProxyDomain,customSoftAsk:{mainClass:L(e,"main_class",L(e,"mainClass",null)),allowClass:L(e,"allow_class",L(e,"allowClass",null)),dismissClass:L(e,"block_class",L(e,"dismissClass",null))}},re.save(e)}}baseLogTag="InitData",(_e=U=U||{}).OLD_SDK="OLD_SDK",_e.NEW_SDK="NEW_SDK";var se=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class ce{constructor(e){this.requestId=L(e,"request_id",null),this.status=L(e,"status",!0),this.data=new le(L(e,"data",null))}static get(){return se(this,void 0,void 0,(function*(){const e=[];return yield H.campaignStore.iterate((),e}))}static getVisibleCards(){return se(this,void 0,void 0,(function*(){const e=[];var{}=j.get(i.USER_DATA);const t=(new Date).getTime();return yield H.campaignStore.iterate(((n,r)=>{var{displayControls:o,userActivity:i}=n,{first_delivered:a,first_seen:s}=i,c=le.getShowCount(n),{show_time:l,max_times_to_show:d,expire_after_delivered:u,expire_at:i,expire_after_seen:o}=o;"show"!==n.status||d<=c||l&&!function(e,t){const n=new Date,r=new Date(n.getTime());r.setHours(e.split(":")[0]),r.setMinutes(e.split(":")[1]);const o=new Date(n.getTime());return o.setHours(t.split(":")[0]),o.setMinutes(t.split(":")[1]),r<=n&&o>n}(null==l?void 0:l.start_time,null==l?void 0:l.end_time)||1e3*i<t||a+1e3*u<t||s+1e3*o<t||e.push(n)})),e}))}static getAllCardIds(){return se(this,void 0,void 0,(function*(){const e=[];return yield H.campaignStore.iterate((),e}))}static getCategories(){return se(this,void 0,void 0,(function*(){return yield H.metaStore.getItem(m)}))}static showAllTabs(){return se(this,void 0,void 0,(function*(){return yield H.metaStore.getItem(u.SHOW_ALL_TAB)}))}}class le{constructor(e){this.showAllTab=L(e,"show_all_tab",!0),this.cardCategories=L(e,"card_categories",[]),this.syncIntervals=new de(L(e,"sync_intervals")),this.deletedCardIds=L(e,"deleted_card_ids",[]);const t=L(e,"cards",[]);this.cards=t.map(()}static getCardInfo(e){return se(this,void 0,void 0,()}static setCardInfo(e,t){return se(this,void 0,void 0,()}tatic getShowCount(e,t){const n=e.userActivity.show_count;return t&&n?n&&n[t]?n[t]:0:n?Object.keys(n).reduce(((e,t)=>(0<n[t]&&(e+=n[t]),e)),0):0}}class de{constructor(e){this.appOpen=L(e,"app_open",2700),this.appInbox=L(e,"app_inbox",300),this.pullToRefresh=L(e,"pull_to_refresh",5),this.userActivity=L(e,"user_activity",0)}static get(){return se(this,void 0,void 0,(function*(){return yield H.metaStore.getItem(u.SYNC_INTERVALS)}))}}class ue{constructor(e){this.id=L(e,"id",""),this.platform=L(e,"platform","web"),this.status=L(e,"status","show"),this.category=L(e,"category",null),this.createdAt=L(e,"created_at",null),this.updatedAt=L(e,"updated_at",null),this.metaData=new fe(L(e,"meta_data")),this.templateData=new ge(L(e,"template_data","")),this.userActivity=L(e,"user_activity",""),this.displayControls=L(e,"display_controls","")}}class fe{constructor(e){this.moeCardId=L(e,"moe_card_id",""),this.cid=L(e,"cid",""),this.moeCampaignType=L(e,"moe_campaign_type","cards"),this.moeCampaignName=L(e,"moe_campaign_name",""),this.moeCampaignId=L(e,"moe_campaign_id","")}}class ge{constructor(e){this.type=L(e,"type",f),this.containers=L(e,"containers")}}var he=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};function pe(){return he(this,void 0,void 0,(function*(){return yield H.metaStore.getItem(u.LAST_META_CALL_TIME)}))}unction ve(e){return he(this,void 0,void 0,(function*(){var t=e.reduce(((e,t)=>((t.displayControls.is_pin?e.pinned:e.nonPinned).push(t),e)),{pinned:[],nonPinned:[]});const n=ye([...t.pinned]);return t=ye([...t.nonPinned]),n.concat(t)}))}function ye(e){return e.sort(()}const be=we=Se="mobile"===ie();var Ce=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class Ie{constructor(){this.mWeb="mobile"===ie(),this.baseLogTag="cardHtmlCss",this.cardsCategories=[],this.cardsConfig=new V(Object.assign({},re.get().cards))}init(){return Ce(this,void 0,void 0,(function*(){this.cardsCategories=(yield ce.showAllTabs())?["All"].concat(yield ce.getCategories()):yield ce.getCategories(),this.cards=(yield ce.getVisibleCards())||[],this.isError=this.isErrorPage()}))}cardFrame(){return Ce(this,void 0,void 0,(function*(){return`<html>\n      <head>\n        <style>\n        ${this.getFontFaces()}\n        ${(e=>{var{backgroundColor:t,tab:n,navigationBar:r,unclickedCardIndicatorColor:o,pinIcon:i,cardDismiss:a,dateTimeColor:s,optionButtonColor:c,card:l}=e,{headerFontSize:d,descriptionFontSize:u,ctaFontSize:f,fontFamily:e,horizontalRowColor:l}=l;return`\n  body {\n    font-family: 'Helvetica Neue', Helvetica, Arial, Roboto, sans-serif, sans-serif;\n    font-size: 14px;\n    margin: 0px;\n  }\n  a {\n    text-decoration: none;\n    color: black;\n  }\n  p, h3 {\n    margin: 0px;\n  }\n  h3 {\n    font-size: 16px;\n  }\n  .flex-column {\n    display: flex;\n    flex-direction: column;\n  }\n  .flex-row {\n    display: flex;\n    flex-direction: row;\n  }\n  .hr-style {\n    border: 0.5px solid ${l};\n    width: calc(100% - 16px);\n    margin: 0px auto;\n  }\n  .card-content > div {\n    padding-bottom: 16px;\n  }\n  .card-style-baisc {\n    padding: 16px 16px 0px 16px;\n    gap: 16px\n  }\n  .card-style-illustration {\n    padding: 24px 16px 0px 16px;\n    gap: 8px;\n  }\n  .color-white {\n    color: #fff;\n  }\n  @keyframes slideIn {\n    from { right: ${Se?"-100%":"-423px"};\n    }\n      to {\n        right: 0px\n      }\n    }\n    @keyframes slideOut {\n    from {\n      right: 0px;\n    }\n      to {\n        right: ${Se?"-100%":"-423px"};\n      }\n    }\n  .container-width {\n    width: ${Se?"100%":"423px"};\n  }\n  .${A} {\n    position: fixed;\n    right: 0px;\n    height: 100vh;\n    animation-duration: 0.5s;\n    animation-fill-mode: forwards;\n    display: flex;\n    flex-direction: column;\n  }\n  .cards-container-background {\n    background: ${t};\n  }\n  .cards-container {\n    width: 100%;\n    position: absolute;\n    right: 0px;\n    height: 100%;\n    overflow: auto;\n    font-family: ${e};\n  }\n  .card-box-animation {\n    width: 100%;\n    animation-duration: 0.5s;\n    animation-fill-mode: forwards;\n    position: relative;\n  }\n  .tab {\n    display: flex;\n    overflow: auto;\n    background-color: ${(null==n?void 0:n.backgroundColor)||"#fff"};\n    font-family: ${(null==n?void 0:n.fontFamily)||"inherit"};\n    font-size: ${(null==n?void 0:n.fontSize)||"14px"};\n    color: ${(null==n?void 0:n.inactiveTabFontColor)||"#7C7C7C"};\n    font-style: normal;\n    font-weight: 400;\n    line-height: 17px;\n  }\n  .tab::-webkit-scrollbar {\n    display: none;\n  }\n  .tab {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n  }\n  .tab button {\n    background-color: inherit;\n    font-family: inherit;\n    color: inherit;\n    font-size: inherit;\n    float: left;\n    border: none;\n    outline: none;\n    padding: 14px 16px;\n    transition: 0.3s;\n    position: relative;\n  }\n  .tab-links.active {\n    color: ${null===(e=null==n?void 0:n.active)||void 0===e?void 0:e.color};\n    background-color: ${null===(e=null==n?void 0:n.active)||void 0===e?void 0:e.backgroundColor}\n  }\n  .under-line.active {\n    position: absolute;\n    width: calc(100% - 32px);\n    border-bottom: 2px solid ${null===(n=null==n?void 0:n.active)||void 0===n?void 0:n.underlineColor};\n    bottom: 0;\n  }\n  .navigation-bar{\n    max-width: 300px;\n    background-color: ${null==r?void 0:r.backgroundColor};\n    color: ${null==r?void 0:r.color};\n    font-size: ${null==r?void 0:r.fontSize};\n    font-family: ${null==r?void 0:r.fontFamily};\n  }\n  .close-btn img{\n    background-color: 'transparent';\n  }\n  .btn-icon {\n    background: transparent;\n    padding: 0;\n    border: none;\n    display: flex;\n  }\n  .card-header {\n    height: 54px;\n    background-color: #00237C;\n    align-items: center;\n    padding: 0px 16px;\n    border-radius: ${me(Se,"0px","10px 0px 0px 0px")};\n    justify-content: space-between;\n  }\n  .mobile-header {\n    flex-direction: row-reverse !important;\n    justify-content: flex-end;\n    background-color: #fff;\n  }\n  .mobile-header span {\n    padding-left: 15px;\n    background-color: inherit;\n  }\n  .unclicked-indicator-color {\n    background-color: ${o};\n    width: 8px;\n    height: 8px;\n    border-radius: 8px;\n    margin: 4px;\n    position: absolute;\n    top: 26px;\n  }\n  .dismiss-btn {\n    color: ${a.color};\n  }\n  .card-footer {\n    padding: 16px 16px 8px 16px;\n    display: flex;\n    justify-content: space-between;\n  }\n  .footer {\n    font-size: 12px;\n  }\n  .date-time {\n    color: ${s};\n    font-style: normal;\n    font-weight: 400;\n    font-size: 12px;\n    line-height: 15px;\n  }\n  .view {\n    color: #06A6B7;\n    font-size: 14px;\n  }\n  .card-content-spacing {\n    gap: 8px;\n    width: -webkit-fill-available;\n  }\n  .error-container {\n    padding: 0px 50px;\n  }\n  .error-img {\n    width: 100%;\n  }\n  .cta-view {\n    display: -webkit-box;\n    max-width: 200px;\n    font-size: ${f};\n  }\n  .error-text {\n    font-style: normal;\n    font-weight: 400;\n    font-size: 13px;\n    line-height: 16px;\n    display: -webkit-box;\n    line-break: anywhere;\n    font-size: 14px;\n    -webkit-line-clamp: 5;\n    line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n  .cta-view > div, .card-text > div {\n    word-wrap: break-word;\n  }\n  .card-text {\n    display: -webkit-box;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  .remove-pointer-event {\n    pointer-events: none;\n  }\n  .single-line-text {\n    -webkit-line-clamp: 1;\n            line-clamp: 1;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  .card-text-header {\n    font-style: normal;\n    font-weight: 700;\n    line-height: 20px;\n    font-size: ${d};\n  }\n  .card-text-description {\n    font-style: normal;\n    font-weight: 400;\n    line-height: 17px;\n    font-size: ${u};\n  }\n  .three-line-text {\n    -webkit-line-clamp: 3;\n    line-clamp: 3;\n    -webkit-box-orient: vertical;\n  }\n  .img-illustration {\n    max-width: ${Se?"100%":"390px"};\n    height: 164px;\n    border-radius: 2px;\n  }\n  .img-basic {\n    width: 60px;\n    height: 60px;\n    border-radius: 2px;\n  }\n  .card-img-container {\n    -webkit-box-pack: center;\n    -webkit-justify-content: center;\n    -ms-flex-pack: center;\n    justify-content: center;\n    -webkit-align-items: center;\n    -webkit-box-align: center;\n    -ms-flex-align: center;\n    align-items: center;\n    background-color: unset;\n  }\n  .card-img-cover {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n  .card-img-contain {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n  }\n  .card-text-event > div {\n    pointer-events: none;\n  }\n  .extra-icon {\n    display: flex;\n    position: absolute;\n    right: 0;\n  }\n  .pin-icon {\n    content: url(${i});\n  }\n  .extras span {\n    width: 6px;\n    height: 6px;\n    background-color: ${c};\n    border-radius: 6px;\n    margin: 2px;\n  }\n  .extras {\n    display: flex;\n    padding: 5px 8px 0px 4px;\n    border: none;\n    background: transparent;\n  }\n  .pointer-cursor {\n    cursor: pointer;\n  }\n  .moe-more-options {\n    position: absolute;\n    z-index: 1;\n    right: 0;\n    top: 18px;\n    padding-right: 5px;\n    display: none;\n    list-style: none;\n    margin: 0px;\n  }\n  .more-opt-btn {\n    padding: 5px;\n    width: 65px;\n    height: 30px;\n    justify-content: center;\n    color: #7C7C7C;\n    border: 0px solid;\n    background: #FFFFFF;\n    box-shadow: 1px 4px 10px rgb(201 201 201 / 50%);\n    border-radius: 4px 4px 10px 10px;\n  }\n  .center-align {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .loader {\n    -webkit-animation:spin 4s linear infinite;\n    -moz-animation:spin 4s linear infinite;\n    animation:spin 4s linear infinite;\n  }\n  @-moz-keyframes spin {\n      100% { -moz-transform: rotate(360deg); }\n  }\n  @-webkit-keyframes spin {\n      100% { -webkit-transform: rotate(360deg); }\n  }\n  @keyframes spin {\n      100% {\n          -webkit-transform: rotate(360deg);\n          transform:rotate(360deg);\n      }\n  }\n  `})(this.cardsConfig)}\n        </style>\n        <script>\n        ${this.cardFrameScript()}\n        ${this.cardExtraScript()}\n        ${this.notificationHeaderScript()}\n        ${this.tabButtonsScript()}\n        <\/script>\n      </head>\n      <body ${me(!this.isError,'onload="load()"')}>\n      <div id="${A}" class="${A} container-width"\n      style="animation-name: slideIn;">\n        ${this.notificationHeader()}\n        <div style="position: relative; height: 100%;">\n        <div\n        id="cards-container"\n        class="cards-container cards-container-background"\n        >\n          ${me(!this.isError,this.cardsTab())}\n          ${this.isError||""}\n        </div>\n        </div>\n      </div>\n      ${this.insertBannerDiv()}\n      </body>\n      </html>`}))}cardFrameScript(){var e;return`\n    let impressionedCards = {}\n    let lastScrollTop = 0;\n    let startImpression = 0;\n    let endImpression = 0;\n    function debounce(func, timeout = 100){\n      let timer;\n      return (...args) => {\n        clearTimeout(timer);\n        timer = setTimeout(() => { func.apply(this, args); }, timeout);\n      };\n    }\n    window.impressionEventTrack = debounce(() => cardsInView(),300)\n\n    function isCardIntoView(elem) {\n      const mainFrame = document.getElementById("cards-container");\n      const docViewTop = mainFrame.scrollTop;\n      const docViewBottom = docViewTop + mainFrame.offsetHeight + 1;\n      const elemTop = elem.offsetTop;\n      const elemBottom = elemTop + elem.offsetHeight;\n      return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));\n    }\n    async function sendImpressionEvent(){\n      if(startImpression === endImpression)\n        return;\n\n      for(let i=startImpression; i<endImpression; i++){\n        if(!impressionedCards[categoryData[i].id]){\n          impressionedCards[categoryData[i].id] = true\n          await window.parent.${we()}.cards.cardShown(categoryData[i].id);\n        }\n      }\n    }\n    function cardsInView() {\n      let flag = false;\n      const tabName = document.querySelectorAll('.tab > .active');\n      for(let i= startImpression; i< categoryData.length; i++){\n        if(isCardIntoView(document.getElementById("card-"+ tabName[0].name + "-" + categoryData[i].id)) && !impressionedCards[categoryData[i]?.id]){\n          endImpression = i + 1;\n          flag = true;\n        }\n        else if(flag){\n          endImpression = startImpression !== endImpression ? i : i + 1;\n          flag = false;\n        }\n      }\n      sendImpressionEvent();\n    }\n\n    async function load()\n    {\n      await openNotification(event, '${null===(e=this.cardsCategories)||void 0===e?void 0:e[0]}');\n      const tabUnderLine = document.querySelectorAll(".under-line");\n      const tabLinks = document.querySelectorAll(".tab-links");\n      if(tabUnderLine && tabUnderLine[0] && tabUnderLine[0].className){\n        tabUnderLine[0].className += " active";\n      }\n      if(tabLinks && tabLinks[0] && tabLinks[0].className){\n        tabLinks[0].className += " active";\n      }\n      window.onpageshow = function(event) {\n        if (event.persisted) {\n            window.location.reload();\n        }\n      };\n      impressionEventTrack()\n      document.getElementById("cards-container").addEventListener("scroll", (evt)=> {\n        let st = evt.target.pageYOffset || evt.target.scrollTop;\n        if (st >= lastScrollTop){\n          impressionEventTrack();\n        }\n        lastScrollTop = st;\n      });\n      document.querySelector(".moe-card-tab").addEventListener('click',(e)=> {\n        const target =  e.target;\n        if(target.classList && target.classList.contains('tab-links')){\n            openNotification(event,target.name);\n          }\n      });\n    }\n    `}getFontFaces(){const e=this.cardsConfig.fontFaces;return null==e?void 0:e.map(().join("")}getFloatingIconButton(e,t){if(e){var{icon:n,countColor:r,countBackgroundColor:o,iconBackgroundColor:i,fontFamily:e}=e;return`<html>\n    <head>\n    <style>\n    ${this.getFontFaces()}\n    .new-notifications {\n      display: flex;\n      top: 10px;\n      font-size: 10px;\n      left: 40px;\n      align-items: center;\n      justify-content: center;\n      width: 20px;\n      height: 20px;\n      border-radius: 50%;\n      border: 1px solid ${o};\n      background: ${o};\n      color: ${r};\n      font-family: ${e};\n    }\n    .floatingIcon {\n      cursor: pointer;\n      width: 60px;\n      height: 60px;\n      margin: 10px 1px 1px 1px;\n      border-radius: 50%;\n      background: ${i};\n      box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.15);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    body {\n      margin: 0;\n    }\n    </style>\n    </head>\n      <body>\n      <div class="floatingIcon"\n        id="${E}"\n        >\n      <img src="${n}" style="height: 32px;" />\n      <span id="moe-floating-notifications"  style="position: absolute;" class="new-notifications">${99<t?"99+":t}</span>\n      </div>\n      </body>\n      </html>\n    `}}cardBody(e,t){const{widgets:n,style:r,id:o}=e.templateData.containers[0];let i="",a="",s="";return n.map((t=>{"image"===t.type&&(i+=this.cardImage(t,e.templateData.type)),"text"===t.type&&(a+=this.cardText(t,""===a)),"button"===t.type&&(s=this.cardButton(t,null==e?void 0:e.id))})),`<div id="card-${t}-${null==e?void 0:e.id}" class="card-box-animation" data-moe-widget-id="${o}">\n      <div style="${me(r.bgColor,`background-color: ${r.bgColor};`)} position: relative;">\n        ${this.cardExtraButtons(e,t)}\n        <${me(null===(t=null===(t=null==e?void 0:e.templateData)||void 0===t?void 0:t.containers[0].actions[0])||void 0===t?void 0:t.value,`a href=${null===(t=null===(t=null==e?void 0:e.templateData)||void 0===t?void 0:t.containers[0].actions[0])||void 0===t?void 0:t.value} target="_blank"`,'div class="pointer-cursor"')} onclick="cardClicked(event, '${e.id}')">\n          ${me(!e.userActivity.is_clicked,this.isClickedIndicators(null==e?void 0:e.id))}\n          <div class="card-data ${me("basic"===e.templateData.type,"flex-row card-style-baisc","flex-column card-style-illustration")}" style="${me(e.displayControls.is_pin&&"basic"===e.templateData.type,"padding-top: 24px;")}">\n            ${i}\n            ${this.cardTextWrapper(e.templateData.type,a)}\n          </div>\n        </${me(null===(t=null===(t=null==e?void 0:e.templateData)||void 0===t?void 0:t.containers[0].actions[0])||void 0===t?void 0:t.value,"a","div")}>\n        ${this.cardFooter((t=1e3*e.updatedAt,new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})+", "+new Date(t).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}).replace(":",".").toLowerCase()),s)}\n      </div>\n      <hr noshade class="hr-style"/>\n    </div>`}cardsTab(){var e;return""+(null===(e=this.cardsCategories)||void 0===e?void 0:e.map(().join(""))}isErrorPage(e){if(this.cardsConfig){if("errorContent"===e){var{img:t,text:n}=this.cardsConfig.errorContent;return this.errorPage(t,n,e)}if(0===(null===(t=this.cards)||void 0===t?void 0:t.length)||!this.cards||"noDataContent"===e){var{img:n,text:t}=this.cardsConfig.noDataContent;return this.errorPage(n,t,e)}}return!1}cardExtraScript(){return`\n    function deleteCard(id, cardsCategory, tabName){\n      const result = window.parent.${we()}.cards.deleteCard(id);\n      const cards = document.querySelectorAll('#card-'+tabName+'-'+id);\n        cards.forEach((card)=> {\n          card.style.animationName = 'slideOut'\n          card.addEventListener(\n            'animationend',\n            async () => {\n              card.style.display = 'none';\n              await openNotification('', tabName);\n            },\n            { once: true },\n          );\n        });\n    }\n    function moreOptions (cardId, tabName) {\n      const id = 'moe-more-options-' + tabName + '-' + cardId;\n      const moreOption = document.getElementById(id);\n      if(moreOption) {\n        moreOption.style.display = moreOption.style.display === 'none' ? 'block' : 'none';\n      }\n    }\n    async function cardClicked (event, cardId, eventTrack = true){\n      const widgetId = event.target.getAttribute('data-moe-widget-id') || null;\n      const result = await window.parent.${we()}.cards.cardClicked(cardId, widgetId, eventTrack);\n      window.parent.${we()}.cards.listeners['${D}'] &&\n          window.parent.${we()}.cards.listeners['${D}'](cardId);\n      if(result){\n        const cards = document.querySelectorAll('#unclicked-indicator-'+cardId);\n        cards.forEach((card)=> {\n          card.remove();\n        });\n      }\n    }\n    `}cardExtraButtons(e,t){var n=this.cardsConfig.cardDismiss;return`<div class="extra-icon">\n      ${me(e.displayControls.is_pin,'<img class="pin-icon extras pointer-cursor" width="12px" />')}\n      ${me(null==n?void 0:n.enable,`<button class="extras pointer-cursor" onclick="moreOptions('${e.id}','${t}')">\n          <span></span>\n          <span></span>\n          <span></span>\n        </button>`)}\n    </div>\n    `+me(null==n?void 0:n.enable,`<ul id="moe-more-options-${t}-${e.id}" class="moe-more-options" style="display: none;">\n        <li><button class="more-opt-btn pointer-cursor" id="delete-card" onclick="deleteCard('${e.id}','${e.category}', '${t}')"><span class="dismiss-btn">Delete</span></button><li>\n      </ul>`)}cardImage(e,t){var{style:n,content:r,id:e}=e;return`<div class="img-${t} card-img-container" style="background-color: ${null==n?void 0:n.bgColor}; text-align: center;" data-moe-widget-id="${e}">\n    <img alt="card-icon" class="remove-pointer-event card-img-cover" src="${r}" />\n    </div>`}cardTextWrapperardText(e,t){var{id:n,style:r,content:e}=e;return`\n    <div data-moe-widget-id="${n}" class="${t?"card-text-header card-text single-line-text":"card-text-description card-text three-line-text"} card-text-event" style="font-size: ${null==r?void 0:r.fontSize}px; color: ${null==r?void 0:r.bgColor};">\n      ${e||""}\n    </div>`}cardButton(e,t){var{id:n,content:r,actions:o}=e;return null!==(e=o[0])&&void 0!==e&&e.value?`<a data-moe-widget-id="${n}" class="cta-view single-line-text" id="${t}-button" href="${null===(o=o[0])||void 0===o?void 0:o.value}" onclick="cardClicked(event, '${t}', false)" target="_blank">${r}</a>`:`<div data-moe-widget-id="${n}" class="pointer-cursor cta-view single-line-text" id="${t}-button">${r}</div>`}cardFooterdStyleonditionValue(e,t,n){return e?t:n||""}notificationHeaderScript(){var e=this.cardsConfig.closeButton;return`\n    async function closeIframe () {\n      const close = ${null==e?void 0:e.callBack}\n      close();\n      impressionedCards = {};\n      const cardSlider = document.getElementById('${A}');\n      cardSlider.addEventListener(\n        'animationend',\n        () => {\n          if(${!1!==this.isError}){\n            window.parent.cardAPI.closeCardsFrame('${x}', true);\n          } else {\n            window.parent.cardAPI.closeCardsFrame('${x}');\n          }\n        },\n        { once: true },\n      );\n      if(cardSlider) {\n        cardSlider.style.animationName = "slideOut";\n        const cardFrame = window.parent.document.getElementById('${x}');\n        if(cardFrame.style){\n          cardFrame.style.opacity = "0";\n        }\n      }\n    }\n    function startLoader () {\n      const refreshIcon = document.getElementById('moe-notification-refresh');\n      refreshIcon.className += "loader";\n    }\n    function stopLoader () {\n      const refreshIcon = document.getElementById('moe-notification-refresh');\n      refreshIcon.className = refreshIcon.className.replace("loader", "")\n    }\n    async function syncCampaigns () {\n      startLoader();\n      window.parent.document.getElementById('${x}').setAttribute("data-moe-refresh", true);\n      await window.parent.${we()}.cards.refreshCards();\n      await syncCampaignLocaly()\n      stopLoader();\n    }\n    async function syncCampaignLocaly () {\n      window.parent.document.getElementById('${x}').removeAttribute("data-moe-refresh");\n      const tabName = document.querySelectorAll('.tab > .active');\n      if(tabName && tabName[0]){\n        await openNotification('', tabName[0].name);\n      }\n    }\n    `}notificationHeader(){var e=this.cardsConfig.navigationBar;return`<div>\n      <div\n        style="${this.addStyle("background-color",null==e?void 0:e.backgroundColor)}"\n        class="flex-row card-header">\n        ${me(this.mWeb,this.mWebHeader(),this.webHeader())}\n      </div>\n      ${me(!this.isError&&1<=this.cardsCategories.length,this.tabButtons()+'<div class="cards-container-background"><hr noshade class="hr-style"/></div>')}\n\n    </div>`}webHeader(){var{navigationBar:e,refreshIcon:t,closeButton:n}=this.cardsConfig,n=n.webIcon;return`<span class="navigation-bar single-line-text" >${null==e?void 0:e.text}</span>\n    <div class="flex-row" style="align-items: center;">\n      <button class="btn-icon pointer-cursor center-align" onclick="syncCampaigns()" style="margin: 0px 5px; position: relative;">\n      <img src="${t}" style="position: absolute;" id="moe-notification-refresh" />\n        </button>\n      <button class="btn-icon close-btn pointer-cursor" onclick="closeIframe()">\n        <img src="${n}" style="max-width: 16px; padding-left: 16px;" />\n      </button>\n    </div>`}mWebHeader(){var e,{navigationBar:t,refreshIcon:n,closeButton:e}=this.cardsConfig;return`<div class="flex-row" style="align-items: center;">\n      <button class="btn-icon close-btn pointer-cursor" onclick="closeIframe()">\n        <img src="${e=e.mWebIcon}" style="max-width: 16px;" />\n      </button>\n      <span class="navigation-bar single-line-text" style="padding-left: 16px;">\n        ${null==t?void 0:t.text}\n      </span>\n      </div>\n      <button class="btn-icon pointer-cursor center-align" onclick="syncCampaigns()" >\n        <img src="${n}" id="moe-notification-refresh"  style=" position: absolute;" />\n      </button>`}tabButtonsScriptabButtons(){var e;return`<div class="tab moe-card-tab">\n    ${null===(e=this.cardsCategories)||void 0===e?void 0:e.map(().join("")}\n    </div>`}errorPage(e,t,n){return`\n      <div class="error-container" style="height: ${n?"calc(100% - 150px);":"calc(100% - 55px);"} display: flex; justify-content: center; flex-direction: column;text-align: center;">\n        <div>\n          <img class="error-img" src=${e} />\n        <div>\n        <span class="error-text">${t}</span>\n      </div>`}var _e,Ee=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class xe{constructor(){this.isMweb="mobile"===ie();var e=xe.baseLogTag+".constructor";this.cardsConfig=new V(Object.assign({},re.get().cards)),this.initialBodyStyle=Object.assign({},window.getComputedStyle(document.body)),this.cardHtmlCss=new Ie,F.log(1,e,"Using the cards config: ",this.cardsConfig)}initialize(){return Ee(this,void 0,void 0,(function*(){const e=xe.baseLogTag+".initialize";var{mWebFloating:t,webFloating:n}=this.cardsConfig;let r;window.cardAPI=Object.assign({},window.cardAPI),this.isMweb&&null!=t&&t.enable?(this.floatingIcon=t,r=yield this.renderFloatingIcon(t)):!this.isMweb&&null!=n&&n.enable&&(this.floatingIcon=n,r=yield this.renderFloatingIcon(n)),document.querySelectorAll(this.cardsConfig.placeholder).forEach((t=>{t.addEventListener("click",(t=>Ee(this,void 0,void 0,(function*(){return F.log(1,e,"Notification Button Clicked"),t.stopImmediatePropagation(),yield this.openInbox()}))))})),F.log(1,e,"Notification Buttons and Floating Icons Created")}))}openInbox(){return Ee(this,void 0,void 0,(function*(){yield this.startRendering(),be().cards.inboxOpened(),be().cards.listeners[k]&&be().cards.listeners[k]()}))}createFloatingIcon(e){return Ee(this,void 0,void 0,(function*(){var t=xe.baseLogTag+".createFloatingIcon";F.log(2,t,"Floating Icon found for cards: ",e),t=yield be().cards.getVisibleUnClickCardCount();const{postion:n,zIndex:r}=e;let[o,i,a,s]=n.split(" ");t=this.cardHtmlCss.getFloatingIconButton(e,t);const c=this.createDefaultIframe(_,t);return c.style.width="65px",c.style.height="76px",o&&0!==parseInt(o)||(c.style.zIndex=r,o="auto"),i&&0!==parseInt(i)||(i="auto"),a&&0!==parseInt(a)||(a="auto"),s&&0!==parseInt(s)||(s="auto"),c.style.top=o,c.style.right=i,c.style.bottom=a,c.style.left=s,c}))}renderFloatingIcon(e){return Ee(this,void 0,void 0,(function*(){if(document.getElementById(_))this.updateFloatingIcon();else{const t=yield this.createFloatingIcon(e);if("FRAMESET"===document.body.nodeName){const e=document.head;e.parentNode.insertBefore(t,e)}else{const e=document.body.firstChild;e.parentNode.insertBefore(t,e)}t.onload=()=>{t.contentDocument.getElementById(E).addEventListener("click",(e=>Ee(this,void 0,void 0,(function*(){e.stopImmediatePropagation(),yield this.openInbox()}))))}}}))}getCardsTab(e,t){return e.map(().join("")}pdateURL(){var e,t,n=xe.baseLogTag+".updateURL";history.pushState&&this.isMweb&&(window.location.href.includes(T)?window.history.back():(window.location.href,e=""===window.location.search?"?":"&",t=window.location.href+e+T,window.history.pushState({path:t},"",t),F.log(1,n,`URL changed to ${t} since its a mobile web to handle close of inbox on back button.`)))}mWebBackButtonClick(){window.addEventListener("popstate",(()=>{var e,t=window.parent.document.getElementById(x);if(t&&"none"!==(null===(e=t.style)||void 0===e?void 0:e.display)&&oe()){const e=null==t?void 0:t.contentWindow;e&&e.closeIframe()}}),{once:!0})}startRendering(){return Ee(this,void 0,void 0,(function*(){var e=xe.baseLogTag+".startRendering";this.updateURL(),this.mWebBackButtonClick(),F.log(1,e,"Cards Data and Cards Categories Fetch");const t=document.getElementById(x);if(t){F.log(2,e,"Existing iframe for inbox found, just showing it.");const n=t.contentDocument||t.contentWindow.document;return n&&n.getElementById(A)&&(this.updateCardsData(),n.getElementById(A).style.animationName="slideIn",t.style.display="block",t.style.animationName="fadeIn",Ae.setScrollState(this.initialBodyStyle,!0)),t.contentWindow&&t.contentWindow.impressionEventTrack(),null}yield this.createIFrame(),Ae.setScrollState(this.initialBodyStyle,!0)}))}updateFloatingIcon(){return Ee(this,void 0,void 0,(function*(){var e=xe.baseLogTag+".updateFloatingIcon",t=yield be().cards.getVisibleUnClickCardCount();t=this.cardHtmlCss.getFloatingIconButton(this.floatingIcon,t);const n=document.getElementById(_);n&&t&&(F.log(2,e,"Update Card Frame"),n.srcdoc=t)}))}updateCardsData(){return Ee(this,void 0,void 0,(function*(){var e=xe.baseLogTag+".updateCardsData";null!=this&&this.cardHtmlCss&&(yield null==this?void 0:this.cardHtmlCss.init());var t=yield this.cardHtmlCss.cardFrame();const n=document.getElementById(x);n&&n.getAttribute("data-moe-refresh")&&n.contentWindow?n.contentWindow.syncCampaignLocaly():n&&t&&(F.log(2,e,"Update Card Frame"),n.srcdoc=t)}))}closeIframe(e){var t,n=xe.baseLogTag+".closeIframe";const r=document.getElementById(x);if(r)if(Ae.setScrollState(this.initialBodyStyle),(null!==(t=this.cardsConfig.mWebFloating)&&void 0!==t&&t.enable||null!==(t=this.cardsConfig.webFloating)&&void 0!==t&&t.enable)&&this.updateFloatingIcon(),r.style&&(r.style.display="none",r.style.opacity="1"),e)r.remove();else{try{const e=r.contentDocument||r.contentWindow.document,t=e&&e.querySelectorAll(".moe-more-options");t&&0<t.length&&t.forEach(()}catch(e){F.log(2,n,e)}F.log(2,n,"Inbox closed")}}createIFrame(){return Ee(this,void 0,void 0,(function*(){var e=xe.baseLogTag+".createIframe";F.log(1,e,"Creating new Iframe");try{F.log(1,e,"Creating Global Function for Iframe Usage"),window.cardAPI=Object.assign(Object.assign({},window.cardAPI),{cardsTabData:getErrorPage:closeCardsFrame:),null!=this&&this.cardHtmlCss&&(yield null==this?void 0:this.cardHtmlCss.init());var t=yield this.cardHtmlCss.cardFrame(),n=this.createDefaultIframe(x,t,this.cardsConfig);if("FRAMESET"===document.body.nodeName){const e=document.head;e.parentNode.insertBefore(n,e)}else{const e=document.body.firstChild;e.parentNode.insertBefore(n,e)}return F.log(1,e,"inbox Iframe Created and rendered"),n}catch(t){F.error(1,e,"Error initializing display manager:",t)}}))}createDefaultIframe(e,t,n){const r=document.createElement("iframe");return r.setAttribute("id",e),r.style.left="0px",r.style.top="0px",r.style.bottom="0px",r.style.right="0px",r.style.border="0px none",r.style.height="100%",r.style.width="100%",r.style.padding="0",r.style.overflow="hidden",r.style.overflowY="hidden",r.style.display="",r.style.position="fixed",e===x&&(r.style.transition="opacity 0.5s"),r.style.display="block",n?(({overLayColor:e,zIndex:n}=n),r.style.background=e,r.style.zIndex=n):r.style.background="transparent",r.setAttribute("srcdoc",t),r}}xe.baseLogTag="CarRenderer";class Ae{static setScrollState(e,t){document.body.style.overflow=t?"hidden":e.overflow}}class Te{static get(e,t){return Te.makeNetworkCall(Te.METHODS.GET,e,t)}static posttatic makeNetworkCall(e,t,n={}){return new Promise(((r,o)=>{var i=JSON.stringify(L(n,"postData",null));t=((e,t)=>{e+="?";for(const n in t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=n+"="+encodeURIComponent(t[n])+"&");return e})(t,L(n,"queryParams",null));const a=new XMLHttpRequest;a.open(e,t,!0),Te.addRequestHeaders(a,L(n,"headers",{})),a.onreadystatechange=()=>{4===a.readyState&&200===a.status||4===a.readyState&&410===a.status?r({status:a.status,responseText:a.responseText}):4===a.readyState&&200!==a.status&&o({code:a.status,reason:a.responseText})},a.send(i)}))}static addRequestHeaders(e,t){for(const n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n]);return e}}(_e=(_e=Te=Te||{}).METHODS||(_e.METHODS={})).GET="GET",_e.POST="POST";const ke=Te;var Oe=n(877),De=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class Ne{constructor(){var e=re.get();this.appId=e.appId,this.host=e.baseDomainName}getCards(e){return De(this,void 0,void 0,(function*(){var t=Ne.baseLogTag+".getCards";let n;const{deviceUuid:r,attributes:o}=j.get(i.USER_DATA);o.map((e=>{e.key===s&&(n=e.value)}));var a=yield ce.getAllCardIds(),c=yield pe();a={headers:{"MOE-APPKEY":this.appId,"Content-Type":"application/json"},postData:{request_id:(0,Oe.v4)(),uid:n,unique_id:r,platforms:["web"],card_category:e,last_updated_time:c||void 0,prev_sync_card_ids:a||void 0}};try{var l=yield ke.post(""+this.host+g,a),d=JSON.parse(l.responseText);return F.log(1,t,"Get Cards API call success, response: ",d),new ce(d)}catch(r){F.error(1,t,"Error getting cards campaign list: ",r)}}))}ardUpdate(e,t,n){return De(this,void 0,void 0,(function*(){var r=Ne.baseLogTag+".cardUpdate";try{let d;var o=j.get(i.USER_DATA);t=Array.isArray(t)?t:null==t?void 0:t.split(".");const{deviceUuid:u,attributes:f}=o;f.forEach((e=>{e.key===s&&(d=e.value)}));const g=[];var a,c=yield ce.get();let p=[];if(n)p=Ne.categoryFilter(c,n);else if(0<(null==t?void 0:t.length)){if(p=yield Promise.all(t.map((e=>De(this,void 0,void 0,()))),p=p.filter((),e!==b&&p.length<t.length){const e=[];t.forEach((t=>{p.find((e=>e.id===t))||e.push(t)})),0<e.length&&F.warn(1,r,"Following cardIds do not exist in the storage - "+e)}}else p=c;if(e===b?(a=yield le.getCardInfo(t[0]))&&!a.userActivity.is_clicked?g.push({card_id:t[0],is_clicked:!0}):a&&a.userActivity.is_clicked?F.log(1,r,`CardId: ${t[0]} is already clicked`):F.error(1,r,"Could not perform update. Card data not found in storage."):p.forEach((t=>{e===y?g.push({card_id:t.id,show_count:le.getShowCount(t,u)+1,first_seen:t.userActivity.first_seen||(new Date).getTime()}):e!==v||t.userActivity.first_delivered||g.push({card_id:t.id,first_delivered:(new Date).getTime()})})),!g.length)return F.log(1,r,"No difference in previous and current data. Nothing to update."),!1;var l={headers:{"MOE-APPKEY":re.get().appId,"Content-Type":"application/json"},postData:{request_id:(0,Oe.v4)(),uid:d,unique_id:u,data:g}};try{return 200===(yield ke.post(""+this.host+h,l)).status?(yield Promise.all(g.map((e=>De(this,void 0,void 0,(function*(){const t=e.card_id;yield le.getCardInfo(t).then((n=>De(this,void 0,void 0,(function*(){const r=Object.assign({},e);r.show_count&&(r.show_count=Object.assign(Object.assign({},n.userActivity.show_count),{[u]:r.show_count})),delete r.card_id,yield le.setCardInfo(t,Object.assign(Object.assign({},n),{userActivity:Object.assign(Object.assign({},n.userActivity),r)}))}))))}))))),F.log(1,r,e+" successful"),!0):(F.error(1,r,e+" failed. Please try again"),!1)}catch(e){throw F.error(1,r,"Error updating card status: ",e),new Error("Could not update card status "+e)}}catch(e){throw F.error(1,r,"Error occurred in cardUpdate method: ",e),new Error("Error occurred in cardUpdate method - "+e)}}))}deleteCard(e,t){return De(this,void 0,void 0,(function*(){var t=Ne.baseLogTag+".deleteCard",n=yield le.getCardInfo(e);if(!n)return F.error(1,t,"Card ID: "+e+" does not exist in campaigns DB"),!1;let r;yield le.removeCard(e);const{deviceUuid:o,attributes:a}=j.get(i.USER_DATA);a.forEach(();var c=c={headers:{"MOE-APPKEY":this.appId,"Content-Type":"application/json"},postData:{request_id:(0,Oe.v4)(),data:[{card_ids:c(e),unique_ids:c(o),uids:c(r)}]}};try{return 200===(yield ke.post(""+this.host+p,c)).status?(yield le.removeCard(e),F.log(1,t,"Cards deleted for this user in remote. Deleting it from campaigns DB"),!0):(yield le.setCardInfo(e,n),F.error(1,t,"Delete card operation failed, API returned non-200 status. Please try again"),!1)}catch(o){throw yield le.setCardInfo(e,n),F.error(1,t,"Error updating card click status: ",o),new Error("Could not update card click status")}}))}}Ne.baseLogTag="CardsApi";var Le=class Re{constructor(){this.initializationPomise=null,this.displayManager=null,this.listeners={},this.CardsApiClient=new Ne}initialize(){const e=Re.baseLogTag+".initialize";return null==this.initializationPomise&&(this.initializationPomise=new Promise((t=>Le(this,void 0,void 0,(function*(){try{this.displayManager=new xe,yield H.initialize(),yield this.syncCampaigns(),yield this.displayManager.initialize(),F.log(2,e,"Cards module has been initialised"),t(null)}catch(t){F.error(2,e,"Error in initialising Cards module ",t)}}))))),this.initializationPomise}refreshCards(){return Le(this,void 0,void 0,(function*(){return yield function(){return he(this,void 0,void 0,(function*(){return yield H.metaStore.removeItem(u.LAST_META_CALL_TIME)}))}(),yield this.syncCampaigns()}))}syncCampaigns(){return Le(this,void 0,void 0,(function*(){var e=Re.baseLogTag+".syncCampaigns";try{return(yield this.isSDKVersionChanged())?(F.log(1,e,"New SDK version found. Clearing and fetching Card campaign "),yield H.campaignStore.clear(),yield this.saveRemoteCampaigns()):this.checkCacheAndSaveRemote(C)}catch(t){return void F.error(1,e,"Error syncing card campaigns: ",t)}}))}checkCacheAndSaveRemote(e){return Le(this,void 0,void 0,(function*(){var t=Re.baseLogTag+".checkCacheAndSaveRemote";try{return(yield this.isCachedCampaignExpired(e))||(yield this.isUniqueIdChanged())?yield this.saveRemoteCampaigns():void F.log(1,t,"Skipping fetching campaigns from remote bcoz: \n1. Cache is not expired. \n2. Device unique ID is not changed. \n3. SDK version has not been changed")}catch(e){F.error(1,t,"Error due to fail in: \n1. Checking cached campaignExpired. \n2. Checking if unique id changed. \n3. Saving the Remote Campaign.")}}))}isSDKVersionChanged(){return Le(this,void 0,void 0,(function*(){return(yield function(){return he(this,void 0,void 0,()}())!==ae().getSdkVersion()}))}isCachedCampaignExpired(e){return Le(this,void 0,void 0,(function*(){var t=Re.baseLogTag+".isCachedCampaignExpired",n=yield pe(),r=yield function(e){return he(this,void 0,void 0,(function*(){var t=yield de.get();if(t){if(e===C)return t.appOpen;if(e===I)return t.appInbox}return 2700}))}(e),o=(new Date).getTime();return null==n||1e3*r<o-n?(F.log(1,t,`Cache expired since ${e} event is set as ${r}s and last fetch happend at ${new Date(n)}.`),!0):(F.log(1,t,`Not fetching Cards from remote since last fetch was less than ${r}s ago at ${new Date(n)}.`),!1)}))}isUniqueIdChanged(){return Le(this,void 0,void 0,(function*(){var e=Re.baseLogTag+".isUniqueIdChanged",t=yield H.metaStore.getItem(u.UNIQUE_ID),n=j.get(i.USER_DATA);if(t&&t!==(null==n?void 0:n.deviceUuid))return F.log(1,e,"Unique device id change detected. Will proceed to fetch latest cards campaigns"),!0}))}saveRemoteCampaigns(){return Le(this,void 0,void 0,(function*(){var e=Re.baseLogTag+".saveRemoteCampaigns",t=yield this.CardsApiClient.getCards();t&&(yield this.addCampaignsToDB(t),this.cardDelivered(),F.log(1,e,"Cards campaigns list saved!"))}))}addCampaignsToDB(e){return Le(this,void 0,void 0,(function*(){var t=Re.baseLogTag+".addCampaignsToDB";try{yield Promise.all(e.data.cards.map(()),F.log(1,t,`Adding/Updating ${e.data.cards.length} cards campaigns in DB`,e.data.cards.map(()),yield Promise.all(e.data.deletedCardIds.map(()),F.log(1,t,`Removing ${e.data.deletedCardIds.length} cards campaigns from DB`,e.data.deletedCardIds.toString()),yield H.metaStore.setItem(m,e.data.cardCategories),yield function(){return he(this,void 0,void 0,(function*(){yield H.metaStore.setItem(u.LAST_FETCH_SDK_VERSION,ae().getSdkVersion())}))}(),yield H.metaStore.setItem(u.SYNC_INTERVALS,e.data.syncIntervals),yield H.metaStore.setItem(u.SHOW_ALL_TAB,e.data.showAllTab),yield function(){return he(this,void 0,void 0,(function*(){return yield H.metaStore.setItem(u.LAST_META_CALL_TIME,(new Date).getTime())}))}(),this.displayManager.updateFloatingIcon()}catch(e){F.error(1,t,"Error saving remote card campaigns:",e)}}))}logout(){return Le(this,void 0,void 0,(function*(){var e=Re.baseLogTag+".logout";F.log(1,e,"Starting cards module logout"),this.initializationPomise=null,yield H.clear(),this.displayManager.updateCardsData(),this.displayManager.updateFloatingIcon(),F.log(1,e,"Finishing cards module logout")}))}setLogLeveletUnClickedCardCount(){return Le(this,void 0,void 0,(function*(){var e=Re.baseLogTag+".getUnClickedCardCount";const t=yield ce.get();let n=0;return t.forEach((e=>{e.userActivity.is_clicked||n++})),F.log(1,e,"Total number of unclicked Cards: ",n),n}))}getVisibleUnClickCardCount(){return Le(this,void 0,void 0,(function*(){var e=Re.baseLogTag+".getVisibleUnClickCardCount";const t=yield ce.getVisibleCards();let n=0;return t.forEach((e=>{null!==(e=e.userActivity)&&void 0!==e&&e.is_clicked||n++})),F.log(1,e,"Total number of UnClick Cards: ",n),n}))}getNewCardCount(){return Le(this,void 0,void 0,(function*(){var e=Re.baseLogTag+".getNewCardCount";const t=yield ce.get();let n=0;return t.forEach((e=>{null!==(e=e.userActivity)&&void 0!==e&&e.first_seen||n++})),F.log(1,e,"Total number of new Cards: ",n),n}))}getVisibleNewCardCount(){return Le(this,void 0,void 0,(function*(){var e=Re.baseLogTag+".getVisibleNewCardCount";const t=yield ce.getVisibleCards();let n=0;return t.forEach((e=>{null!==(e=e.userActivity)&&void 0!==e&&e.is_clicked||n++})),F.log(1,e,"Total number of new Cards: ",n),n}))}getCardsForCategory(e){return Le(this,void 0,void 0,(function*(){var t=Re.baseLogTag+".getCardsForCategory";const n=yield ce.get();if("All"===e)return n;var r=n.filter((t=>t.category===e));return F.log(1,t,`Cards for category "${e}": `,r),r}))}getVisibleCardsForCategory(e){return Le(this,void 0,void 0,(function*(){var t=Re.baseLogTag+".getVisibleCardsForCategory";const n=yield ce.getVisibleCards();if("All"===e)return ve(n);var r=n.filter(();return F.log(1,t,`Cards for category "${e}": `,r),ve(r)}))}getCardCategories(){return Le(this,void 0,void 0,(function*(){var e=Re.baseLogTag+".getCardCategories",t=yield ce.getCategories();return F.log(1,e,"Card categories fetched ",t),t}))}getCardsInfo(e){return Le(this,void 0,void 0,(function*(){var t=Re.baseLogTag+".getCardsInfo",n=yield le.getCardInfo(e);return F.log(1,t,`Card details for ${e} `,n),n}))}cardDelivered(){return Le(this,void 0,void 0,(function*(){const e=yield ce.get();return yield this.CardsApiClient.cardUpdate(v),e.forEach((e=>{if(!e.userActivity.first_delivered)return be().track_event(v,Object.assign({},e.metaData))}))}))}inboxOpened(){return Le(this,void 0,void 0,(function*(){return this.checkCacheAndSaveRemote(I),be().track_event(S)}))}cardShown(e){return Le(this,void 0,void 0,(function*(){const t=Re.baseLogTag+".cardShown";let n=[];return n=e?[e]:yield ce.getAllCardIds(),yield this.CardsApiClient.cardUpdate(y,n),n.forEach((n=>Le(this,void 0,void 0,(function*(){return this.getCardsInfo(n).then((e=>(F.log(1,t,"Card impression is tracked for ",e.id),be().track_event(y,Object.assign({},e.metaData))))).catch((()=>{F.error(1,t,`CardId: ${e} Not Found`)}))}))))}))}cardClicked(e,t,n){return Le(this,void 0,void 0,(function*(){const r=Re.baseLogTag+".deleteCard";return yield this.CardsApiClient.cardUpdate(b,e),!1===n||this.getCardsInfo(e).then((e=>be().track_event(b,Object.assign(Object.assign({},e.metaData),{widgetId:t})))).catch((()=>{F.error(1,r,`CardId: ${e} Not Found`)}))}))}deleteCard(e){return Le(this,void 0,void 0,(function*(){const t=Re.baseLogTag+".deleteCard";return this.getCardsInfo(e).then((t=>Le(this,void 0,void 0,(function*(){return yield this.CardsApiClient.deleteCard(e),be().track_event(w,Object.assign({},t.metaData))})))).catch((()=>{F.error(1,t,`CardId: ${e} Not Found`)}))}))}isAllCategoryEnabled(){return Le(this,void 0,void 0,()}setInboxOpenListener(e){return Le(this,void 0,void 0,(function*(){this.listeners[k]=e}))}setInboxCloseListener(e){return Le(this,void 0,void 0,(function*(){this.listeners[O]=e}))}setCardClickListener(e){return Le(this,void 0,void 0,()}updatePushBannerHeight(e,t){var n=document.querySelector("#"+x);if(n){const o=(null==n?void 0:n.contentDocument)||(null===(r=null==n?void 0:n.contentWindow)||void 0===r?void 0:r.document);var r=o.getElementById(N);!r&&t&&o.body.insertBefore(t.cloneNode(!0),o.getElementById(A)),r&&(o.getElementById(N).style.height=(null==e?void 0:e.toString())+"px"||0)}}}Re.baseLogTag="MoeCards",window.moeCards=Re})()})();