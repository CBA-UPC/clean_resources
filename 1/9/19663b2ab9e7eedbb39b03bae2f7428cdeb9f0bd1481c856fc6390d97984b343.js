import{delegate as t,isFunction as u,debug}from"../base/croco.js";import{getLocalData as i,LOGGERS as o}from"../base/config.js";import{initAlternate as l}from"../modules/lazyload.js";const h=o.DEFAULT;const m="producttile";const p=".js-product-tile-swatch";class g{constructor(t,options){this.$el=t;this.options=options||{};this.$hoverImg=this.$el.querySelector(".js-product-tile-hover-img");this.$swatchWrapper=this.$el.querySelector(".js-product-tile-swatch-wrapper");this.$swatchImg=this.$el.querySelector(".js-product-tile-swatch-img");this.$firstSwatch=[...this.$el.querySelectorAll(p)][0];this.timer=null;this.bindEvents();this.$el.dataset[m]=true;this.options.currentPage&&(this.$el.dataset.pageNumber=this.options.currentPage)}bindEvents(){if(this.$swatchWrapper&&this.$swatchImg){t(this.$el,p,"mouseenter",this.onSwatchMouseEnter.bind(this),true);this.$swatchWrapper.addEventListener("mouseleave",this.onSwatchMouseLeave.bind(this))}t(this.$el,".js-product-tile-link","click",this.onLinkClick.bind(this));if(this.$hoverImg){this.$hoverImg.addEventListener("mouseenter",this.onHoverImageMouseEnter.bind(this));this.$hoverImg.addEventListener("mouseleave",this.onHoverImageMouseLeave.bind(this))}}async onLinkClick(e){if(this.options.callback&&u(this.options.callback)){e.preventDefault();this.options.callback(e)}const t=e.delegateTarget;const i=t?.closest(".js-product-tile");const{sku:o,pageNumber:l}=i.dataset||{};if(e.ctrlKey||e.metaKey){e.preventDefault()}else if(o&&l){const searchParams=new URLSearchParams(window.location.search.slice(1));const h=searchParams.toString();history.replaceState({sku:o},null,h?.length?`?${h}`:"");setTimeout(function(){document.location=t.href},0)}}onHoverImageMouseEnter(){this.$hoverImg.style.backgroundImage="url("+this.$hoverImg.dataset.image+")";this.$hoverImg.classList.add("is-visible")}onHoverImageMouseLeave(){this.$hoverImg.classList.remove("is-visible")}onSwatchMouseEnter(e){const o=e.delegateTarget;const l=new Image;clearTimeout(this.timer);if(o===this.$firstSwatch){this.onSwatchMouseLeave();return}l.addEventListener("load",()=>{const t=this.$swatchImg.cloneNode(true);const i=this.$swatchImg.parentNode;t.style.backgroundImage="url("+o.dataset.image+")";t.classList.add("is-visible");i.appendChild(t);const interval=setInterval(()=>{if(i.contains(t)){this.$swatchImg.remove();this.$swatchImg=t;clearInterval(interval)}},200);l.remove()});l.src=o.dataset.image}onSwatchMouseLeave(){this.timer=setTimeout(()=>{this.$swatchImg.classList.remove("is-visible")},250)}}export function onCtrlKeyPressOpenWindow(e,url){if(url){if(e.ctrlKey||e.metaKey){e.preventDefault();window.open(url,"_blank");return false}else{window.location.href=url}}}export function productTileInit(u=document,options={}){const t=[...u.querySelectorAll(".js-product-tile")];import("../modules/authentication.js").then(({exclusivityFlagInit:t})=>t(u));if(t.length){[...t].forEach(t=>{if(!t.dataset[m]){new g(t,options)}});l();i("configuration.search").then(async({isQuickViewEnabled:t})=>{const i=options.context==="wishlist";if(t||i){const{quickPdpViewInit:o,CONTEXTS:l}=await import("../modules/quick-pdp-view.js");const h=[...u.querySelectorAll(".js-quick-pdp-eye")];if(h.length){h.forEach(t=>{t.classList.remove("opacity0","pointer-none");t.classList.add("pointer-auto")});o(h,l[i?"QUICK_BUY":"QUICK_VIEW"],options.context||"category")}}})}else{debug("warn",h,"[product-tile]","missing element")}}