![function(e,t,r){"use strict";r.d(t,"c",(function(){return l.c})),r.d(t,"b",(function(){return M})),r.d(t,"a",(function(){return O}));var i=r(3),n=r(0);onst o=a=var d=r(7),u=r(6),c=r(10),l=r(5);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const h=let p=!0;void 0===window.ShadyCSS?p=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),p=!1);const f=m=["html","svg"],g=new Set,_=window.JSCompiler_renameProperty=const v={toAttributefromAttribute,b=y={attribute:!0,type:String,converter:v,reflect:!1,hasChanged:b};class w extends HTMLElement{ack(){this.enableUpdating()}estUpdate(e,t){let r=!0;if(void 0!==e){const i=this.constructor,n=i.getPropertyOptions(e);i._valueHasChanged(this[e],t,n.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==n.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,n))):r=!1}!this._hasRequestedUpdate&&r&&(this._updatePromise=this._enqueueUpdate())}t _hasRequestedUpdate(){return 4&this._updateState}erformUpdate(){this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{e=this.shouldUpdate(t),e?this.update(t):this._markUpdated()}catch(t){throw e=!1,this._markUpdated(),t}e&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(t)),this.updated(t))}etUpdateComplete(){return this._updatePromise}dated(e){}w.finalized=!0;
/**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
const S="adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,E=Symbol();onst M=
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
(window.litElementVersions||(window.litElementVersions=[])).push("2.3.1");const P={};.finalized=!0,O.render=,function(e,t,r){"use strict";r.d(t,"b",(function(){return o.a})),r.d(t,"a",(function(){return i.b})),r.d(t,"c",(function(){return a}));var i=r(1);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const n=new var s=r(9),o=r(8);r(3),r(2),r(7),r(6),r(10),r(0);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.3.0");const a=,function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i={SIMPLIFIED_URL_AD_FETCH_ERROR:{message:"SIMPLIFIED_URL_AD_FETCH_ERROR",priority:"P2"},SIMPLIFIED_URL_AD_RENDER_ERROR:{message:"SIMPLIFIED_URL_AD_RENDER_ERROR",priority:"P2"},AD_POST_MESSAGE_ERROR:{message:"AD_POST_MESSAGE_ERROR",priority:"P1"},AD_IMPRESSION_URL_NOT_FOUND:{message:"AD_IMPRESSION_URL_NOT_FOUND",priority:"P3"},UCI_CONFIG_NOT_FOUND:{message:"UCI_CONFIG_NOT_FOUND",priority:"P0"},SLOT_INVALID:{message:"SLOT_INVALID",priority:"P0"},GPT_AD_CREATION_FAILED:{message:"GPT_AD_CREATION_FAILED",priority:"P0"},EXPERIMENTS_ERROR:{message:"EXPERIMENTS_ERROR",priority:"P2"},EXPERIMENTS_NOT_FOUND:{message:"EXPERIMENTS_NOT_FOUND",priority:"P2"},EXPERIMENTS_TIMED_OUT:{message:"EXPERIMENTS_TIMED_OUT",priority:"P2"},EXPERIMENTS_CONFIG_INVALID:{message:"EXPERIMENTS_CONFIG_INVALID",priority:"P2"},EXPERIMENTS_QUEUE_NOT_DEFINED:{message:"EXPERIMENTS_QUEUE_NOT_DEFINED",priority:"P2"},GPT_LAZY_LOAD_ERROR:{message:"GPT_LAZY_LOAD_ERROR",priority:"P0"},GPT_INVALID_ARGS_ERROR:{message:"GPT_INVALID_ARGS_ERROR",priority:"P0"},SLOT_RENDERED_REGISTRATION_FAILED:{message:"SLOT_RENDERED_REGISTRATION_FAILED",priority:"P3"},CAROUSEL_FETCH_ERROR:{message:"CAROUSEL_FETCH_ERROR",priority:"P1"},CAROUSEL_CLICK_ERROR:{message:"CAROUSEL_CLICK_ERROR",priority:"P1"},NATIVE_AD_INVALID_JSON:{message:"NATIVE_AD_INVALID_JSON",priority:"P0"},SCHEMA_VALIDATION_FAILURE:{message:"SCHEMA_VALIDATION_FAILURE",priority:"P0"},NATIVE_TILE_BACKGROUND_POSITION_ERROR:{message:"NATIVE_TILE_BACKGROUND_POSITION_ERROR",priority:"P1"},INVALID_IMPRESSION_LOG:{message:"INVALID_IMPRESSION_LOG",priority:"P2"},IMPRESSION_LOG_SUCCESSFUL:{message:"IMPRESSION_LOG_SUCCESSFUL",priority:"P3"},PRIVACY_SETTINGS_FAILURE:{message:"PRIVACY_SETTINGS_FAILURE",priority:"P2"},PRIVACY_SETTINGS_NOT_FOUND:{message:"PRIVACY_SETTINGS_NOT_FOUND",priority:"P2"},INVALID_ADX_RESPONSE:{message:"INVALID_ADX_RESPONSE",priority:"P2"},MISSING_PARTNER_CODE_FROM_CARS_BRL:{message:"MISSING_PARTNER_CODE_FROM_CARS_BRL",priority:"P3"},UNFILLED_AD:{message:"UNFILLED_AD",priority:"P3"},AD_RESPONSE_SERVED:{message:"AD_RESPONSE_SERVED",priority:"P3"},AD_REQUEST_ERROR:{message:"AD_REQUEST_ERROR",priority:"P2"}}},function(e,t,r){"use strict";var i=r(15),n=r(14);class s{constructor(e){this.moduleName=e,this.isDebugLoggingEnabled=window.location&&window.location.search&&window.location.search.includes("debug=true")}static setSessionConfigendLogPayload(e,t,r){window.meso=window.meso||{},window.meso.logging=window.meso.logging||[],s.setSessionConfig(window.meso.pageInfo);const o=Object.assign({type:e,moduleName:this.moduleName},t&&t.message?t:{message:t},s.config,{details:r},n.e);window.meso.logging.push({logs:o,platform:i.a.logging.platform,timestamp:n.a,epoch:Date.now()})}info(e,t){this.sendLogPayload("info",e,t)}rror(e,t,r){const i=t instanceof Error||"object"==typeof t?{message:t.message}:{message:""+t};this.sendLogPayload("error",e,Object.assign({exception:i},r))}trackEvent(e,t,r){this.sendLogPayload("track-event",{name:e,vars:t,events:r})}ebug(e,t){this.isDebugLoggingEnabled&&console.info(`${performance.now()} ${this.moduleName}:${e}`,t||{})}perf(e,t){if(t&&t.mark&&performance.getEntriesByName(t.mark).length>0){const{mark:e}=t;performance.measure("Performance Measure",e),t.duration=performance.getEntriesByType("measure")[0].toJSON().duration,performance.clearMeasures(),delete t.mark}this.sendLogPayload("perf",e,t)}}const o={};window.addEventListener("mesoRender",,t.a=e=>(o[e]||(o[e]=new s(e)),o[e])},function(e,t,r){"use strict";const i=e=>e.replace(/(^\w+:|^)\/\//,"//");t.a={promiseFetch:(e,t={})=>{const r=t&&t.timeout||5e3;return Promise.race([fetch(e,t),new Promise(])},sanitizeProtocol:i,fireBeacon:e=>{e=i(e),(new Image).src=encodeURI(e)}}},function(e,t,r){"use strict";r.d(t,"e",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"c",(function(){return d})),r.d(t,"b",(function(){return u})),r.d(t,"d",(function(){return c}));r(20),r(13);r(22);var i=r(18),n=r.n(i);const s=(()=>{if(window&&window.navigator&&window.navigator.userAgent){const e=n.a.getParser(window.navigator.userAgent);return{userAgent:e.getUA(),userAgentName:e.getBrowserName(),userAgentVersion:e.getBrowserVersion(),userAgentDeviceType:e.getPlatformType()}}})(),o=a=(()=>{const e=new Date;return`${e.getUTCFullYear()}-${o(e.getUTCMonth()+1)}-${o(e.getUTCDate())}T${o(e.getUTCHours())}:${o(e.getUTCMinutes())}:${o(e.getUTCSeconds())}`})(),d=function(e,t){return new Promise((r,i)=>{const n=setTimeout(()=>{clearTimeout(n),i(new Error(t))},e)})},u=()=>window&&window.location&&window.location.href||"",c=(e,t,r)=>{const i=new URL(e);return i.searchParams.set(t,r),i.href}},function(e,t,r){"use strict";var i=r(17);let n;n={environmentName:"Production",environmentShort:"PROD",dfp:{network:"23171577"},proxy:"https://www.uciservice.com/ds/api/v1/proxy",deeplink:"https://www.uciservice.com/deeplink"};const s=r.n(i)()({appName:"ads-templates",dfp:{gpt:"https://www.googletagservices.com/tag/js/gpt.js",network:"11850712",surl:"https://pubads.g.doubleclick.net/gampad/adx",gptlight:"https://securepubads.g.doubleclick.net/static/glade.js"},abacus:{endpoint:"/api/bucketing/v1"},proxy:"https://ads-delivery-service.us-west-2.test.meso.expedia.com/api/v1/proxy",deeplink:"https://deep-link-service.us-west-2.test.meso.expedia.com",others:{hotelLinkDirect:{holdoutPercentage:20}},logging:{platform:"Web"}},n);t.a=s},function(e,t,r){"use strict";t.a=(e,t)=>{if("string"!=typeof e)throw new Error("registerComponent requires a name of type string");if(!t)throw new Error("registerComponent requires a valid component");window&&customElements&&void 0===customElements.get(e)&&(customElements.define(e,t),document.dispatchEvent(new CustomEvent("mesoAdTagRegistered",{detail:{name:e}})))}},function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));var i={displayAd:["CM1","CM2","CM3","CM4","CM5","CM6","CT1","CT2","CT3","CT4","CT5","R1","R2"],nativeAd:["NMC1","NMC2","NMC3","NTS1","RL1","RL2"]};const n=(e,t)=>{if(!t||!t.slot)return;const r=t.slot.getAdUnitPath(),i=t.slot.getSizes();if(!r||!i||i.length<1)return;const n="fluid"===i[0]?i[0]:i[0].getWidth(),s="fluid"===i[1]?i[0]:i[0].getHeight();return(n===e.width&&s===e.height||e.isfluid)&&r===e.adpath},s=e=>"string"==typeof e?e.split("/").pop():e,o=e=>-1!==i.displayAd.indexOf(e.toUpperCase())?"displayAd":-1!==i.nativeAd.indexOf(e.toUpperCase())?"nativeAd":e},function(e,t,r){"use strict";const i=e=>{const t=document.cookie.match(`(^|;) ?${e}=([^;]*)(;|$)`);return t?t[2]:null},n=(e,t,r=30)=>{const i=new Date;i.setTime(i.getTime()+864e5*r),document.cookie=`${e}=${t};path=/;expires=${i.toGMTString()};`},s=o=()=>{const e=i("tpid");return null!==e&&e.match(/^.*,[0-9]+$/)?e.split(",")[1]:null},a=()=>{const e=i("iEAPID");return null!==e&&e.match(/^[0-9]+$/)?e:null};t.a={getGuid:s,getCookie:i,setCookie:n,deleteCookie:parseSiteInfo:()=>({user:s(),guid:s(),site:1,tpid:o(),eapid:a(),abov:i("abov")}),parseOverrideExperiments:()=>{try{const e={},t=i("meov");return(null===t?[]:t.split(",")).forEach(,e}catch(e){return{}}}}},function(e,t,r){"use strict";r.d(t,"a",();var i=r(4);class n extends i.a{quiresAdContextUpdate(e){const t=this.constructor.contextChangedAttributes;return!(Array.isArray(t)&&t.length>0)||t.some(t=>e.includes(t))}registerAdContext(){"function"==typeof this.adContextChanged&&(this.__adContextDestroyer=window.meso.adcontext.observe(this.constructor.name,e=>this.requiresAdContextUpdate(e),e=>this.adContextChanged(e)))},function(e,t,r){"use strict";t.a={isObject:isTrue:e=>!0===e||"true"===e||"1"===e||1===e||"string"==typeof e&&"true"===e.toLowerCase(),verifyModel:(e,t,r)=>{const i=t.find(t=>void 0===((e,t)=>e.split(".").reduce((e,t)=>{if(e&&e[t]){if(e[t].length&&e[t].length<1)return;return e[t]}},t))(t,e));if(i&&i.length){throw new Error(`missing component properties from GAM - creative id: ${r} - missing: ${i}`)}return!0}}},,,,function(e,t,r){"use strict";var i=()=>{const e={promise:null,resolve:null,reject:null,isResolved:!1};return e.promise=new Promise((t,r)=>{e.resolve=e.reject=r}),e},n=r(12),s=r(11);const o=Object(n.a)("experiments-handler-v2");let a={},d=[];const u=e=>{e&&e.detail&&("initialize"!==e.detail.type&&"update"!==e.detail.type||e.detail.experiments&&(a=Object.assign({},a,e.detail.experiments),d=d.filter(e=>!e.checkExperiments(a))))};window&&"function"==typeof window.addEventListener&&window.addEventListener("mesoExperiments",u),window&&"function"==typeof window.dispatchEvent&&window.dispatchEvent(new CustomEvent("mesoExperiments",{detail:{type:"register"}}));t.a=class{constructor(e=[]){this._requested=Array.isArray(e)?e:[e],this._configured=this._buildExperimentConfig(),this._resolvable=this._resolvableExperiments(),this._TIMEOUT=500,this._completePromise=i()}checkExperiments(e){const t=!(this._resolvable.length>0)||this._resolvable.every(t=>e.hasOwnProperty(t));return t&&this._completePromise.resolve(this.getBuckets()),t}_resolvableExperiments(){const{resolvable:e,missing:t}=this._requested.reduce((e,t)=>(this._configured.includes(t)?e.resolvable.push(t):e.missing.push(t),e),{resolvable:[],missing:[]});return t.length>0&&o.warn(s.a.EXPERIMENTS_NOT_FOUND,{description:"Requested experiments were not found in configuration",configured:this._configured,requested:this._requested,resolvable:e,missing:t,methodName:"_resolvableExperiments"}),e}_buildExperimentConfig(){let e=window&&window.meso&&window.meso.experiments&&window.meso.experiments.configuredExperimentNames||[];Array.isArray(e)||(o.warn(s.a.EXPERIMENTS_CONFIG_INVALID,{description:"Configured experiments was not an array as expected",configuredExperiments:e,methodName:"_buildExperimentConfig"}),e=[]);let t=window&&window.meso&&window.meso.experiments&&window.meso.experiments.configuredOverrideNames||[];return Array.isArray(t)||(o.warn(s.a.EXPERIMENTS_CONFIG_INVALID,{description:"Configured overrides was not an array as expected",configuredOverrides:t,methodName:"_buildExperimentConfig"}),t=[]),[...e,...t]}getBuckets(){return this._requested.reduce((e,t)=>(this._resolvable.includes(t)?e[t]=a.hasOwnProperty(t)?a[t]:null:e[t]=null,e),{})}xposureLog(e){if(Array.isArray(e)||"string"==typeof e){const t={type:"exposure",experiments:e=(e=Array.isArray(e)?e:[e]).map(};window.meso=window.meso||{},window.meso.experiments=window.meso.experiments||[],window.meso.experiments.push(t)}}wait(){if(window&&window.meso&&void 0===window.meso.experiments)return o.warn(s.a.EXPERIMENTS_QUEUE_NOT_DEFINED,{description:"window.meso.experiments is not defined.",requested:this._requested,methodName:"wait"}),Promise.resolve(this.getBuckets());const e=Promise.race([this._completePromise.promise,new Promise(e=>{setTimeout(()=>{const t=this._resolvable.filter(,r=this._resolvable.filter(;r.length>0&&o.warn(s.a.EXPERIMENTS_TIMED_OUT,{description:`Experiments timed out in ${this._TIMEOUT} before evaluating all requested experiments`,requested:this._requsted,resolvable:this._resolvable,configured:this._configured,resolved:t,timedout:r,methodName:"wait"}),e(this.getBuckets())},this._TIMEOUT)})]);var t;return(t=this).checkExperiments(a)||d.push(t),e},,,,,,function(e,t,r){"use strict";var i=r(26);const n=[1,2],s=[1,3];t.a=e=>new Promise(t=>{new i.a(["MeSo_HSR_Holdout_Feature_Gate","MeSo_HSR_Display_Ad_Hold_Out_AB_Test"]).wait().then(r=>{if(r.MeSo_HSR_Holdout_Feature_Gate){const i=r.MeSo_HSR_Display_Ad_Hold_Out_AB_Test;t(e?n.includes(i):s.includes(i))}t(!1)})})},function(e,t,r){"use strict";t.a={toggleHidden:(e,t)=>{let r=document.querySelectorAll(e);const i=window&&window.meso&&window.meso.breakpoints&&window.meso.breakpoints.current||null;null!==i&&Object.keys(t).forEach(e=>{const n=t[e].breakpoints;void 0!==n&&Array.isArray(n)&&!n.includes(i)||(r=[].filter.call(r,t=>{const r=t.getAttribute("uci");return r===e||null===r?(t.removeAttribute("hidden"),window.dispatchEvent(new CustomEvent("OnMediaQuery",{detail:{enabled:!0,slot:t.getAttribute("slot")},bubbles:!0,composed:!0})),!1):(window.dispatchEvent(new CustomEvent("OnMediaQuery",{detail:{enabled:!1,slot:t.getAttribute("slot")},bubbles:!0,composed:!0})),!0)})),r.forEach(})},applyBreakpointAttribute:e=>{const t=document.querySelectorAll(e),r=window&&window.meso&&window.meso.breakpoints&&window.meso.breakpoints.current||null;null!==r&&t.forEach(}}},function(e,t,r){"use strict";t.a={chunkCallback:e=>requestAnimationFrame&&requestAnimationFrame(e)||setTimeout(e,0)}},,,,,,,function(e,t,r){"use strict";r.r(t);var i=r(12),n=r(11),s=r(35),o=r(34),a=r(33);const d=Object(i.a)("admanager"),u=[],c=new Set,l=new Map,h=e=>{s.a.chunkCallback(()=>{e&&e.detail&&e.detail.content&&e.detail.content["MESO-DISPLAY-AD"]&&Object(a.a)().then(t=>{t||(e=>{const t=e.timestamp||Date.now(),r=e.params&&e.params.pageId,i=window&&window.meso&&window.meso.breakpoints&&window.meso.breakpoints.current||"none",s=e.content&&e.content["MESO-DISPLAY-AD"]||{},a=e.config&&e.config["MESO-DISPLAY-AD"]&&e.config["MESO-DISPLAY-AD"].conditions||[],h=(e=>e&&e.config&&e.config.EXPERIMENTS&&e.config.EXPERIMENTS.conditions?e.config.EXPERIMENTS.conditions.map(.join(","):"")(e);o.a.toggleHidden("meso-display-ad",s);const p=document.querySelectorAll("meso-display-ad"),f=p.length.toString();for(const e of p){const n=e.getAttribute("uci")||e.getAttribute("slot")||"",o=s[n]&&s[n].attributes||null;c.has(r)&&l.has(t)&&l.get(t)===r+i+f||(l.set(t,r+i+f),a.find()?null!==o&&(e.setAttribute("experiments",h),["slot","width","height","path","refocusrefresh","mediaquery"].forEach(t=>{t in o&&(e.hasAttribute(o[t])||e.setAttribute(t,o[t]))})):u.push(n)}u.length>0&&!c.has(r)&&(d.error(n.a.UCI_CONFIG_NOT_FOUND,new Error(`The following UCIs exist on display ad tags from the page's initial breakpoint but were not found in the Switchboard configuration for this page: ${u.join(", ")}.`),{product:"MESO-DISPLAY-AD",adProductType:"displayAd",methodName:"updateAttributes"}),c.add(r))})(e.detail)})})};window&&window.addEventListener("mesoRender",;let p=null;const f=()=>{if(document.hidden)p=new Date;else if(null!==p&&"visible"===document.visibilityState){(e=>{document.dispatchEvent(new CustomEvent("mesoPageFocus",{detail:{type:"impressionRefresh",timeaway:e}}))})((new Date-p)/1e3)}};window&&(()=>{document&&void 0!==document.hidden&&document.addEventListener("visibilitychange",f)})();var m=r(21),g=r(4),_=g.b`:host{display:inline-block}`,v=r(16),b=r(5);
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const y=new WeakMap,w=Object(b.b)(;var S=r(19);const E=Object(i.a)("meso-display-ad");class A extends m.a{static get properties(){return{enabled:{type:Boolean},height:{type:Number},mediaquery:{type:String},path:{type:String},slot:{type:String},width:{type:Number},uci:{type:String},experiments:{type:String},refocusrefresh:{type:Number},breakpoint:{type:String},collapse:{type:Boolean,reflect:!0}}}constructor(){super(),this.mediaQueryCallback=e=>{this.enabled=e.matches,window.dispatchEvent(new CustomEvent("OnMediaQuery",{detail:{enabled:this.enabled,slot:this.slot},bubbles:!0,composed:!0}))},this._handleMesoAdEvents=this._handleMesoAdEvents.bind(this)}connectedCallback(){super.connectedCallback(),window.meso=window.meso||{},window.meso.initialize=window.meso.initialize||[],window.meso.initialize.push({type:"render"}),window.performance.mark("AdComponentRender:"+this.slot)}firstUpdated(){this._nestedComponent=this.shadowRoot.querySelector("meso-default-display-ad"),this._nestedComponent&&this._nestedComponent.addEventListener("mesoAd",this._handleMesoAdEvents)}disconnectedCallback(){super.disconnectedCallback(),this.mql&&this.mql.removeListener(this.mediaQueryCallback),this._nestedComponent&&this._nestedComponent.removeEventListener("mesoAd",this._handleMesoAdEvents)}render(){return g.c`
      <meso-default-display-ad
        aria-label="Advertisement ${this.uci||this.slot}"
        role="document"
        width="${this.width}"
        height="${this.height}"
        path="${this.path}"
        slot="${this.slot}"
        data-eg-sc="true"
        ?enabled=${this.active}
        mediaquery=${w(this.mediaquery)}
        experiments="${this.experiments}"
        refocusrefresh=${this.refocusrefresh}
      ></meso-default-display-ad>
    `}_handleMesoAdEvents(e){const t=Object.assign({},e.detail);if("mesoAd"!==e.type||"AD-LOAD-FAIL"!==t.code&&"AD-LOAD-EMPTY"!==t.code||(this.collapse=!0),"AD-LOAD-PASS"===t.code){const e=this.slot,r=Object(S.b)(e);E.perf("Ad Component Rendered",{mark:"AdComponentRender:"+e,uci:e,creativeid:t.creativeid,adProductType:r})}this.dispatchEvent(new CustomEvent(e.type,{detail:t}))}shouldUpdate(e){return this.mediaquery!==e.mediaquery&&(this.mql&&this.mql.removeListener(this.mediaQueryCallback),this.mql=window.matchMedia(this.mediaquery),this.mql.addListener(this.mediaQueryCallback),this.mediaQueryCallback(this.mql)),Boolean(this.width&&this.height&&this.path&&this.slot)}get active(){return void 0!==this.mediaquery?this.enabled&&this.visible:void 0!==this.breakpoint||this.visible}get visible(){return Boolean(this.offsetWidth||this.offsetHeight||this.getClientRects().length)}static get styles(){return[super.styles,_]}}Object(v.a)("meso-display-ad",A);var M=r(27),P=r.n(M);const O=Object(i.a)("ImpressionAdRefresh");class R{constructor(e,t){this._ad=e,this._timeawayLimit=t,this._refreshcb=P()(e=>{"impressionRefresh"===(e&&e.detail||{}).type&&(this._refreshAds(),O.info("ADREFRESH",{type:"showMore",adId:this._ad._id(),methodName:"_refreshcb"}))},0,{leading:!1,trailing:!0}),this._outOfFocusRefreshcb=P()(e=>{const t=e&&e.detail||{},r=t&&t.timeaway||0;"impressionRefresh"===t.type&&r>=this._timeawayLimit&&(this._refreshAds(),O.info("ADREFRESH",{type:"refocus",timeaway:r,adId:this._ad._id(),methodName:"_outOfFocusRefreshcb"}))},0,{leading:!1,trailing:!0})}ttachImpressionRefreshEventListener(){document.addEventListener("mesoTriggeredRefresh",this._refreshcb),document.addEventListener("mesoPageFocus",this._outOfFocusRefreshcb)}_refreshAds(){this._ad.hasAttribute("data-meso-viewed")&&(this._ad.refreshAd(),this._ad.hasAttribute("data-meso-inview")||(this._ad.removeAttribute("data-meso-viewed"),this._removeEventListener()))}class N{constructor(e,t){this._ad=e,this._setRefreshListeners=t,this._boundMarkAsViewed=this._markAsViewed.bind(this),window.meso=window.meso||{},window.meso.viewability=window.meso.viewability||[],window.meso.viewability.push({type:"register",config:"image",element:this._ad})}_markAsViewed(e){this._ad.path===e.slot.getName()&&this._setRefreshListeners()}removeVisibilityEventListener(){window.meso=window.meso||{},window.meso.viewability=window.meso.viewability||[],window.meso.viewability.push({type:"deregister",element:this._ad})}}var T=g.b`:host{display:inline}:host[collapse]{display:none}.md-da-gpt{display:none}.md-da-gpt.enabled{display:inline-block}`;const x=Object(i.a)("meso-default-display-ad");class C extends m.a{static get properties(){return{collapse:{type:Boolean},enabled:{type:Boolean},height:{type:Number},mediaquery:{type:String},path:{type:String},slot:{type:String},uci:{type:String},waitforadinfo:{type:Boolean},width:{type:Number},experiments:{type:String},refocusrefresh:{type:Number,hasChanged:(e,t)=>e!==t&&!isNaN(e)&&e>0}}}constructor(){super(),this._lastAdinfoUpdate=0,this._lastTargetingUpdate=0,this.collapse=!1,this._handleMesoAdEvents=this._handleMesoAdEvents.bind(this)}refreshAd(){const e=this.renderRoot.querySelector("#"+this._id());e&&e.dispatchEvent(new CustomEvent("DisplayAdRefresh"))}connectedCallback(){super.connectedCallback(),this.waitforadinfo=!0,this.requestUpdate(),this.refreshcb=document.addEventListener("DisplayAdRefresh",this.refreshcb),this.targetingEvent=e=>{e&&e.detail&&"update"===e.detail.type&&(e.detail.targetingLastUpdated>this._lastTargetingUpdate&&(this._lastTargetingUpdate=e.detail.targetingLastUpdated,this.refreshAd()),e.detail.adinfoLastUpdated>this._lastAdinfoUpdate&&this.waitforadinfo&&(this._lastAdinfoUpdate=e.detail.adinfoLastUpdated,this.waitforadinfo=!1))},document.addEventListener("MesoTargeting",this.targetingEvent),document.dispatchEvent(new CustomEvent("MesoTargeting",{detail:{type:"register"}})),this.emptySlotHandler=document.addEventListener("mesoCollapseEmptyDisplayAdSlot",this.emptySlotHandler),this.slotFilterUpdateEvent=P()(e=>{const t=e&&e.detail||{},r=t&&t.filterData&&t.filterData.name||"",i=t&&t.type||"",n=t&&t.editType;r.length>0&&(this.refreshAd(),x.info("ADREFRESH",{type:i,editType:n,filter:r,adId:this._id()}))},0,{leading:!1,trailing:!0}),document.addEventListener("mesoSlotFilterUpdate",this.slotFilterUpdateEvent)}firstUpdated(){this._gptAd=this.shadowRoot.querySelector("meso-gpt-ad"),this._gptAd&&this._gptAd.addEventListener("mesoAd",this._handleMesoAdEvents)}disconnectedCallback(){super.disconnectedCallback(),this.refreshcb&&document.removeEventListener("DisplayAdRefresh",this.refreshcb),this.targetingEvent&&document.removeEventListener("MesoTargeting",this.targetingEvent),this.emptySlotHandler&&document.removeEventListener("mesoCollapseEmptyDisplayAdSlot",this.emptySlotHandler),this._impressionAdRefresh&&this._impressionAdRefresh.removeListeners(),this._adVisibility&&this._adVisibility.removeVisibilityEventListener(),this._gptAd&&this._gptAd.removeEventListener("mesoAd",this._handleMesoAdEvents),this.slotFilterUpdateEvent&&document.removeEventListener("mesoSlotFilterUpdate",this.slotFilterUpdateEvent)}_handleMesoAdEvents(e){this.dispatchEvent(new CustomEvent(e.type,{bubbles:!0,detail:e.detail}))}_id(){return"mesogpt-"+(this.uci||this.slot)}_renderMediaQuery(){return this.mediaquery?g.c`
        <style type="text/css">
          @media ${this.mediaquery} {
            #${this._id()} {
              max-width: ${this.width}px;
              max-height: ${this.height}px;
              display: inline-block;
            }
            #${this._id()}[collapse] {
                display: none;
              }
            }
          </style>
      `:""}render(){return g.c`
      ${this._renderMediaQuery()}
      <meso-gpt-ad
        aria-label="Advertisement ${this._id()}"
        role="document"
        id="${this._id()}"
        class="md-da-gpt ${this.active?"enabled":""}"
        style="max-width:${this.width}px;max-height:${this.height}px"
        width="${this.width}"
        height="${this.height}"
        adpath="${this.path}"
        ?enabled="${this.active}"
        ?collapse=${this.collapse}
      ></meso-gpt-ad>
    `}shouldUpdate(e){return e.has("refocusrefresh")&&(this._impressionAdRefresh=new R(this,this.refocusrefresh),this._adVisibility=new N(this,),Boolean(this.width&&this.height&&this.path&&this.slot)}handleEmptySlot(e){const t=e?e.detail:null;if(!e||!t||!t.slot)return;const r=t.slot;r.path===this.path&&r.height===this.height&&r.width===this.width&&(this.collapse=t.collapse||!1)}tatic get styles(){return[super.styles,T]}}Object(v.a)("meso-default-display-ad",C)}]);
//# sourceMappingURL=meso-displayad.js.map